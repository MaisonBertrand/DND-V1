function FS(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function $S(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ub={exports:{}},Jd={},db={exports:{}},Oe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gc=Symbol.for("react.element"),US=Symbol.for("react.portal"),BS=Symbol.for("react.fragment"),zS=Symbol.for("react.strict_mode"),qS=Symbol.for("react.profiler"),WS=Symbol.for("react.provider"),HS=Symbol.for("react.context"),GS=Symbol.for("react.forward_ref"),KS=Symbol.for("react.suspense"),QS=Symbol.for("react.memo"),YS=Symbol.for("react.lazy"),r0=Symbol.iterator;function JS(n){return n===null||typeof n!="object"?null:(n=r0&&n[r0]||n["@@iterator"],typeof n=="function"?n:null)}var hb={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},mb=Object.assign,fb={};function Io(n,e,t){this.props=n,this.context=e,this.refs=fb,this.updater=t||hb}Io.prototype.isReactComponent={};Io.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Io.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function pb(){}pb.prototype=Io.prototype;function mp(n,e,t){this.props=n,this.context=e,this.refs=fb,this.updater=t||hb}var fp=mp.prototype=new pb;fp.constructor=mp;mb(fp,Io.prototype);fp.isPureReactComponent=!0;var s0=Array.isArray,gb=Object.prototype.hasOwnProperty,pp={current:null},yb={key:!0,ref:!0,__self:!0,__source:!0};function vb(n,e,t){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)gb.call(e,r)&&!yb.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=t;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(n&&n.defaultProps)for(r in l=n.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:gc,type:n,key:i,ref:a,props:s,_owner:pp.current}}function XS(n,e){return{$$typeof:gc,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function gp(n){return typeof n=="object"&&n!==null&&n.$$typeof===gc}function ZS(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var i0=/\/+/g;function Xh(n,e){return typeof n=="object"&&n!==null&&n.key!=null?ZS(""+n.key):e.toString(36)}function ku(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case gc:case US:a=!0}}if(a)return a=n,s=s(a),n=r===""?"."+Xh(a,0):r,s0(s)?(t="",n!=null&&(t=n.replace(i0,"$&/")+"/"),ku(s,e,t,"",function(d){return d})):s!=null&&(gp(s)&&(s=XS(s,t+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(i0,"$&/")+"/")+n)),e.push(s)),1;if(a=0,r=r===""?".":r+":",s0(n))for(var l=0;l<n.length;l++){i=n[l];var c=r+Xh(i,l);a+=ku(i,e,t,c,s)}else if(c=JS(n),typeof c=="function")for(n=c.call(n),l=0;!(i=n.next()).done;)i=i.value,c=r+Xh(i,l++),a+=ku(i,e,t,c,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function su(n,e,t){if(n==null)return n;var r=[],s=0;return ku(n,r,"","",function(i){return e.call(t,i,s++)}),r}function e1(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var $n={current:null},Pu={transition:null},t1={ReactCurrentDispatcher:$n,ReactCurrentBatchConfig:Pu,ReactCurrentOwner:pp};function xb(){throw Error("act(...) is not supported in production builds of React.")}Oe.Children={map:su,forEach:function(n,e,t){su(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return su(n,function(){e++}),e},toArray:function(n){return su(n,function(e){return e})||[]},only:function(n){if(!gp(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Oe.Component=Io;Oe.Fragment=BS;Oe.Profiler=qS;Oe.PureComponent=mp;Oe.StrictMode=zS;Oe.Suspense=KS;Oe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=t1;Oe.act=xb;Oe.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=mb({},n.props),s=n.key,i=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=pp.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var l=n.type.defaultProps;for(c in e)gb.call(e,c)&&!yb.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=t;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:gc,type:n.type,key:s,ref:i,props:r,_owner:a}};Oe.createContext=function(n){return n={$$typeof:HS,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:WS,_context:n},n.Consumer=n};Oe.createElement=vb;Oe.createFactory=function(n){var e=vb.bind(null,n);return e.type=n,e};Oe.createRef=function(){return{current:null}};Oe.forwardRef=function(n){return{$$typeof:GS,render:n}};Oe.isValidElement=gp;Oe.lazy=function(n){return{$$typeof:YS,_payload:{_status:-1,_result:n},_init:e1}};Oe.memo=function(n,e){return{$$typeof:QS,type:n,compare:e===void 0?null:e}};Oe.startTransition=function(n){var e=Pu.transition;Pu.transition={};try{n()}finally{Pu.transition=e}};Oe.unstable_act=xb;Oe.useCallback=function(n,e){return $n.current.useCallback(n,e)};Oe.useContext=function(n){return $n.current.useContext(n)};Oe.useDebugValue=function(){};Oe.useDeferredValue=function(n){return $n.current.useDeferredValue(n)};Oe.useEffect=function(n,e){return $n.current.useEffect(n,e)};Oe.useId=function(){return $n.current.useId()};Oe.useImperativeHandle=function(n,e,t){return $n.current.useImperativeHandle(n,e,t)};Oe.useInsertionEffect=function(n,e){return $n.current.useInsertionEffect(n,e)};Oe.useLayoutEffect=function(n,e){return $n.current.useLayoutEffect(n,e)};Oe.useMemo=function(n,e){return $n.current.useMemo(n,e)};Oe.useReducer=function(n,e,t){return $n.current.useReducer(n,e,t)};Oe.useRef=function(n){return $n.current.useRef(n)};Oe.useState=function(n){return $n.current.useState(n)};Oe.useSyncExternalStore=function(n,e,t){return $n.current.useSyncExternalStore(n,e,t)};Oe.useTransition=function(){return $n.current.useTransition()};Oe.version="18.3.1";db.exports=Oe;var A=db.exports;const bb=$S(A),n1=FS({__proto__:null,default:bb},[A]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r1=A,s1=Symbol.for("react.element"),i1=Symbol.for("react.fragment"),a1=Object.prototype.hasOwnProperty,o1=r1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l1={key:!0,ref:!0,__self:!0,__source:!0};function wb(n,e,t){var r,s={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)a1.call(e,r)&&!l1.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:s1,type:n,key:i,ref:a,props:s,_owner:o1.current}}Jd.Fragment=i1;Jd.jsx=wb;Jd.jsxs=wb;ub.exports=Jd;var o=ub.exports,Fm={},_b={exports:{}},or={},Eb={exports:{}},Tb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(Q,J){var ne=Q.length;Q.push(J);e:for(;0<ne;){var Ne=ne-1>>>1,Ae=Q[Ne];if(0<s(Ae,J))Q[Ne]=J,Q[ne]=Ae,ne=Ne;else break e}}function t(Q){return Q.length===0?null:Q[0]}function r(Q){if(Q.length===0)return null;var J=Q[0],ne=Q.pop();if(ne!==J){Q[0]=ne;e:for(var Ne=0,Ae=Q.length,Fe=Ae>>>1;Ne<Fe;){var ut=2*(Ne+1)-1,He=Q[ut],Pt=ut+1,dt=Q[Pt];if(0>s(He,ne))Pt<Ae&&0>s(dt,He)?(Q[Ne]=dt,Q[Pt]=ne,Ne=Pt):(Q[Ne]=He,Q[ut]=ne,Ne=ut);else if(Pt<Ae&&0>s(dt,ne))Q[Ne]=dt,Q[Pt]=ne,Ne=Pt;else break e}}return J}function s(Q,J){var ne=Q.sortIndex-J.sortIndex;return ne!==0?ne:Q.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();n.unstable_now=function(){return a.now()-l}}var c=[],d=[],h=1,m=null,p=3,y=!1,_=!1,T=!1,E=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(Q){for(var J=t(d);J!==null;){if(J.callback===null)r(d);else if(J.startTime<=Q)r(d),J.sortIndex=J.expirationTime,e(c,J);else break;J=t(d)}}function P(Q){if(T=!1,S(Q),!_)if(t(c)!==null)_=!0,re(M);else{var J=t(d);J!==null&&_e(P,J.startTime-Q)}}function M(Q,J){_=!1,T&&(T=!1,x(b),b=-1),y=!0;var ne=p;try{for(S(J),m=t(c);m!==null&&(!(m.expirationTime>J)||Q&&!R());){var Ne=m.callback;if(typeof Ne=="function"){m.callback=null,p=m.priorityLevel;var Ae=Ne(m.expirationTime<=J);J=n.unstable_now(),typeof Ae=="function"?m.callback=Ae:m===t(c)&&r(c),S(J)}else r(c);m=t(c)}if(m!==null)var Fe=!0;else{var ut=t(d);ut!==null&&_e(P,ut.startTime-J),Fe=!1}return Fe}finally{m=null,p=ne,y=!1}}var $=!1,I=null,b=-1,C=5,N=-1;function R(){return!(n.unstable_now()-N<C)}function D(){if(I!==null){var Q=n.unstable_now();N=Q;var J=!0;try{J=I(!0,Q)}finally{J?k():($=!1,I=null)}}else $=!1}var k;if(typeof v=="function")k=function(){v(D)};else if(typeof MessageChannel<"u"){var je=new MessageChannel,K=je.port2;je.port1.onmessage=D,k=function(){K.postMessage(null)}}else k=function(){E(D,0)};function re(Q){I=Q,$||($=!0,k())}function _e(Q,J){b=E(function(){Q(n.unstable_now())},J)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Q){Q.callback=null},n.unstable_continueExecution=function(){_||y||(_=!0,re(M))},n.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<Q?Math.floor(1e3/Q):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(Q){switch(p){case 1:case 2:case 3:var J=3;break;default:J=p}var ne=p;p=J;try{return Q()}finally{p=ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Q,J){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var ne=p;p=Q;try{return J()}finally{p=ne}},n.unstable_scheduleCallback=function(Q,J,ne){var Ne=n.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?Ne+ne:Ne):ne=Ne,Q){case 1:var Ae=-1;break;case 2:Ae=250;break;case 5:Ae=1073741823;break;case 4:Ae=1e4;break;default:Ae=5e3}return Ae=ne+Ae,Q={id:h++,callback:J,priorityLevel:Q,startTime:ne,expirationTime:Ae,sortIndex:-1},ne>Ne?(Q.sortIndex=ne,e(d,Q),t(c)===null&&Q===t(d)&&(T?(x(b),b=-1):T=!0,_e(P,ne-Ne))):(Q.sortIndex=Ae,e(c,Q),_||y||(_=!0,re(M))),Q},n.unstable_shouldYield=R,n.unstable_wrapCallback=function(Q){var J=p;return function(){var ne=p;p=J;try{return Q.apply(this,arguments)}finally{p=ne}}}})(Tb);Eb.exports=Tb;var c1=Eb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u1=A,ir=c1;function te(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ib=new Set,Ll={};function aa(n,e){eo(n,e),eo(n+"Capture",e)}function eo(n,e){for(Ll[n]=e,n=0;n<e.length;n++)Ib.add(e[n])}var ts=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$m=Object.prototype.hasOwnProperty,d1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,a0={},o0={};function h1(n){return $m.call(o0,n)?!0:$m.call(a0,n)?!1:d1.test(n)?o0[n]=!0:(a0[n]=!0,!1)}function m1(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function f1(n,e,t,r){if(e===null||typeof e>"u"||m1(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Un(n,e,t,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var xn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){xn[n]=new Un(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];xn[e]=new Un(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){xn[n]=new Un(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){xn[n]=new Un(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){xn[n]=new Un(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){xn[n]=new Un(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){xn[n]=new Un(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){xn[n]=new Un(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){xn[n]=new Un(n,5,!1,n.toLowerCase(),null,!1,!1)});var yp=/[\-:]([a-z])/g;function vp(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(yp,vp);xn[e]=new Un(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(yp,vp);xn[e]=new Un(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(yp,vp);xn[e]=new Un(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){xn[n]=new Un(n,1,!1,n.toLowerCase(),null,!1,!1)});xn.xlinkHref=new Un("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){xn[n]=new Un(n,1,!1,n.toLowerCase(),null,!0,!0)});function xp(n,e,t,r){var s=xn.hasOwnProperty(e)?xn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(f1(e,t,s,r)&&(t=null),r||s===null?h1(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var us=u1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,iu=Symbol.for("react.element"),Aa=Symbol.for("react.portal"),ka=Symbol.for("react.fragment"),bp=Symbol.for("react.strict_mode"),Um=Symbol.for("react.profiler"),Sb=Symbol.for("react.provider"),Cb=Symbol.for("react.context"),wp=Symbol.for("react.forward_ref"),Bm=Symbol.for("react.suspense"),zm=Symbol.for("react.suspense_list"),_p=Symbol.for("react.memo"),Ss=Symbol.for("react.lazy"),Nb=Symbol.for("react.offscreen"),l0=Symbol.iterator;function Xo(n){return n===null||typeof n!="object"?null:(n=l0&&n[l0]||n["@@iterator"],typeof n=="function"?n:null)}var Nt=Object.assign,Zh;function dl(n){if(Zh===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Zh=e&&e[1]||""}return`
`+Zh+n}var em=!1;function tm(n,e){if(!n||em)return"";em=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(n,[],e)}else{try{e.call()}catch(d){r=d}n.call(e.prototype)}else{try{throw Error()}catch(d){r=d}n()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,l=i.length-1;1<=a&&0<=l&&s[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(s[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||s[a]!==i[l]){var c=`
`+s[a].replace(" at new "," at ");return n.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",n.displayName)),c}while(1<=a&&0<=l);break}}}finally{em=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?dl(n):""}function p1(n){switch(n.tag){case 5:return dl(n.type);case 16:return dl("Lazy");case 13:return dl("Suspense");case 19:return dl("SuspenseList");case 0:case 2:case 15:return n=tm(n.type,!1),n;case 11:return n=tm(n.type.render,!1),n;case 1:return n=tm(n.type,!0),n;default:return""}}function qm(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case ka:return"Fragment";case Aa:return"Portal";case Um:return"Profiler";case bp:return"StrictMode";case Bm:return"Suspense";case zm:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Cb:return(n.displayName||"Context")+".Consumer";case Sb:return(n._context.displayName||"Context")+".Provider";case wp:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case _p:return e=n.displayName||null,e!==null?e:qm(n.type)||"Memo";case Ss:e=n._payload,n=n._init;try{return qm(n(e))}catch{}}return null}function g1(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return qm(e);case 8:return e===bp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ei(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Ab(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function y1(n){var e=Ab(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function au(n){n._valueTracker||(n._valueTracker=y1(n))}function kb(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Ab(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function nd(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Wm(n,e){var t=e.checked;return Nt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function c0(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=ei(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Pb(n,e){e=e.checked,e!=null&&xp(n,"checked",e,!1)}function Hm(n,e){Pb(n,e);var t=ei(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Gm(n,e.type,t):e.hasOwnProperty("defaultValue")&&Gm(n,e.type,ei(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function u0(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Gm(n,e,t){(e!=="number"||nd(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var hl=Array.isArray;function Ba(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+ei(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function Km(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(te(91));return Nt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function d0(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(te(92));if(hl(t)){if(1<t.length)throw Error(te(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:ei(t)}}function Rb(n,e){var t=ei(e.value),r=ei(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function h0(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function jb(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Qm(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?jb(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var ou,Db=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(ou=ou||document.createElement("div"),ou.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ou.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Ol(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var wl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},v1=["Webkit","ms","Moz","O"];Object.keys(wl).forEach(function(n){v1.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),wl[e]=wl[n]})});function Mb(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||wl.hasOwnProperty(n)&&wl[n]?(""+e).trim():e+"px"}function Vb(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=Mb(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var x1=Nt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ym(n,e){if(e){if(x1[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(te(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(te(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(te(61))}if(e.style!=null&&typeof e.style!="object")throw Error(te(62))}}function Jm(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xm=null;function Ep(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Zm=null,za=null,qa=null;function m0(n){if(n=xc(n)){if(typeof Zm!="function")throw Error(te(280));var e=n.stateNode;e&&(e=nh(e),Zm(n.stateNode,n.type,e))}}function Lb(n){za?qa?qa.push(n):qa=[n]:za=n}function Ob(){if(za){var n=za,e=qa;if(qa=za=null,m0(n),e)for(n=0;n<e.length;n++)m0(e[n])}}function Fb(n,e){return n(e)}function $b(){}var nm=!1;function Ub(n,e,t){if(nm)return n(e,t);nm=!0;try{return Fb(n,e,t)}finally{nm=!1,(za!==null||qa!==null)&&($b(),Ob())}}function Fl(n,e){var t=n.stateNode;if(t===null)return null;var r=nh(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(te(231,e,typeof t));return t}var ef=!1;if(ts)try{var Zo={};Object.defineProperty(Zo,"passive",{get:function(){ef=!0}}),window.addEventListener("test",Zo,Zo),window.removeEventListener("test",Zo,Zo)}catch{ef=!1}function b1(n,e,t,r,s,i,a,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(t,d)}catch(h){this.onError(h)}}var _l=!1,rd=null,sd=!1,tf=null,w1={onError:function(n){_l=!0,rd=n}};function _1(n,e,t,r,s,i,a,l,c){_l=!1,rd=null,b1.apply(w1,arguments)}function E1(n,e,t,r,s,i,a,l,c){if(_1.apply(this,arguments),_l){if(_l){var d=rd;_l=!1,rd=null}else throw Error(te(198));sd||(sd=!0,tf=d)}}function oa(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Bb(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function f0(n){if(oa(n)!==n)throw Error(te(188))}function T1(n){var e=n.alternate;if(!e){if(e=oa(n),e===null)throw Error(te(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return f0(s),n;if(i===r)return f0(s),e;i=i.sibling}throw Error(te(188))}if(t.return!==r.return)t=s,r=i;else{for(var a=!1,l=s.child;l;){if(l===t){a=!0,t=s,r=i;break}if(l===r){a=!0,r=s,t=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===t){a=!0,t=i,r=s;break}if(l===r){a=!0,r=i,t=s;break}l=l.sibling}if(!a)throw Error(te(189))}}if(t.alternate!==r)throw Error(te(190))}if(t.tag!==3)throw Error(te(188));return t.stateNode.current===t?n:e}function zb(n){return n=T1(n),n!==null?qb(n):null}function qb(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=qb(n);if(e!==null)return e;n=n.sibling}return null}var Wb=ir.unstable_scheduleCallback,p0=ir.unstable_cancelCallback,I1=ir.unstable_shouldYield,S1=ir.unstable_requestPaint,Vt=ir.unstable_now,C1=ir.unstable_getCurrentPriorityLevel,Tp=ir.unstable_ImmediatePriority,Hb=ir.unstable_UserBlockingPriority,id=ir.unstable_NormalPriority,N1=ir.unstable_LowPriority,Gb=ir.unstable_IdlePriority,Xd=null,Dr=null;function A1(n){if(Dr&&typeof Dr.onCommitFiberRoot=="function")try{Dr.onCommitFiberRoot(Xd,n,void 0,(n.current.flags&128)===128)}catch{}}var Tr=Math.clz32?Math.clz32:R1,k1=Math.log,P1=Math.LN2;function R1(n){return n>>>=0,n===0?32:31-(k1(n)/P1|0)|0}var lu=64,cu=4194304;function ml(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ad(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,a=t&268435455;if(a!==0){var l=a&~s;l!==0?r=ml(l):(i&=a,i!==0&&(r=ml(i)))}else a=t&~s,a!==0?r=ml(a):i!==0&&(r=ml(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Tr(e),s=1<<t,r|=n[t],e&=~s;return r}function j1(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function D1(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var a=31-Tr(i),l=1<<a,c=s[a];c===-1?(!(l&t)||l&r)&&(s[a]=j1(l,e)):c<=e&&(n.expiredLanes|=l),i&=~l}}function nf(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Kb(){var n=lu;return lu<<=1,!(lu&4194240)&&(lu=64),n}function rm(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function yc(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Tr(e),n[e]=t}function M1(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-Tr(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function Ip(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Tr(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var nt=0;function Qb(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Yb,Sp,Jb,Xb,Zb,rf=!1,uu=[],Bs=null,zs=null,qs=null,$l=new Map,Ul=new Map,Ns=[],V1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function g0(n,e){switch(n){case"focusin":case"focusout":Bs=null;break;case"dragenter":case"dragleave":zs=null;break;case"mouseover":case"mouseout":qs=null;break;case"pointerover":case"pointerout":$l.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ul.delete(e.pointerId)}}function el(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=xc(e),e!==null&&Sp(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function L1(n,e,t,r,s){switch(e){case"focusin":return Bs=el(Bs,n,e,t,r,s),!0;case"dragenter":return zs=el(zs,n,e,t,r,s),!0;case"mouseover":return qs=el(qs,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return $l.set(i,el($l.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Ul.set(i,el(Ul.get(i)||null,n,e,t,r,s)),!0}return!1}function ew(n){var e=Mi(n.target);if(e!==null){var t=oa(e);if(t!==null){if(e=t.tag,e===13){if(e=Bb(t),e!==null){n.blockedOn=e,Zb(n.priority,function(){Jb(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ru(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=sf(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Xm=r,t.target.dispatchEvent(r),Xm=null}else return e=xc(t),e!==null&&Sp(e),n.blockedOn=t,!1;e.shift()}return!0}function y0(n,e,t){Ru(n)&&t.delete(e)}function O1(){rf=!1,Bs!==null&&Ru(Bs)&&(Bs=null),zs!==null&&Ru(zs)&&(zs=null),qs!==null&&Ru(qs)&&(qs=null),$l.forEach(y0),Ul.forEach(y0)}function tl(n,e){n.blockedOn===e&&(n.blockedOn=null,rf||(rf=!0,ir.unstable_scheduleCallback(ir.unstable_NormalPriority,O1)))}function Bl(n){function e(s){return tl(s,n)}if(0<uu.length){tl(uu[0],n);for(var t=1;t<uu.length;t++){var r=uu[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Bs!==null&&tl(Bs,n),zs!==null&&tl(zs,n),qs!==null&&tl(qs,n),$l.forEach(e),Ul.forEach(e),t=0;t<Ns.length;t++)r=Ns[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Ns.length&&(t=Ns[0],t.blockedOn===null);)ew(t),t.blockedOn===null&&Ns.shift()}var Wa=us.ReactCurrentBatchConfig,od=!0;function F1(n,e,t,r){var s=nt,i=Wa.transition;Wa.transition=null;try{nt=1,Cp(n,e,t,r)}finally{nt=s,Wa.transition=i}}function $1(n,e,t,r){var s=nt,i=Wa.transition;Wa.transition=null;try{nt=4,Cp(n,e,t,r)}finally{nt=s,Wa.transition=i}}function Cp(n,e,t,r){if(od){var s=sf(n,e,t,r);if(s===null)mm(n,e,r,ld,t),g0(n,r);else if(L1(s,n,e,t,r))r.stopPropagation();else if(g0(n,r),e&4&&-1<V1.indexOf(n)){for(;s!==null;){var i=xc(s);if(i!==null&&Yb(i),i=sf(n,e,t,r),i===null&&mm(n,e,r,ld,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else mm(n,e,r,null,t)}}var ld=null;function sf(n,e,t,r){if(ld=null,n=Ep(r),n=Mi(n),n!==null)if(e=oa(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Bb(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return ld=n,null}function tw(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(C1()){case Tp:return 1;case Hb:return 4;case id:case N1:return 16;case Gb:return 536870912;default:return 16}default:return 16}}var Os=null,Np=null,ju=null;function nw(){if(ju)return ju;var n,e=Np,t=e.length,r,s="value"in Os?Os.value:Os.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var a=t-n;for(r=1;r<=a&&e[t-r]===s[i-r];r++);return ju=s.slice(n,1<r?1-r:void 0)}function Du(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function du(){return!0}function v0(){return!1}function lr(n){function e(t,r,s,i,a){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in n)n.hasOwnProperty(l)&&(t=n[l],this[l]=t?t(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?du:v0,this.isPropagationStopped=v0,this}return Nt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=du)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=du)},persist:function(){},isPersistent:du}),e}var So={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ap=lr(So),vc=Nt({},So,{view:0,detail:0}),U1=lr(vc),sm,im,nl,Zd=Nt({},vc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kp,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==nl&&(nl&&n.type==="mousemove"?(sm=n.screenX-nl.screenX,im=n.screenY-nl.screenY):im=sm=0,nl=n),sm)},movementY:function(n){return"movementY"in n?n.movementY:im}}),x0=lr(Zd),B1=Nt({},Zd,{dataTransfer:0}),z1=lr(B1),q1=Nt({},vc,{relatedTarget:0}),am=lr(q1),W1=Nt({},So,{animationName:0,elapsedTime:0,pseudoElement:0}),H1=lr(W1),G1=Nt({},So,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),K1=lr(G1),Q1=Nt({},So,{data:0}),b0=lr(Q1),Y1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},J1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},X1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Z1(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=X1[n])?!!e[n]:!1}function kp(){return Z1}var eC=Nt({},vc,{key:function(n){if(n.key){var e=Y1[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Du(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?J1[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kp,charCode:function(n){return n.type==="keypress"?Du(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Du(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),tC=lr(eC),nC=Nt({},Zd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),w0=lr(nC),rC=Nt({},vc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kp}),sC=lr(rC),iC=Nt({},So,{propertyName:0,elapsedTime:0,pseudoElement:0}),aC=lr(iC),oC=Nt({},Zd,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),lC=lr(oC),cC=[9,13,27,32],Pp=ts&&"CompositionEvent"in window,El=null;ts&&"documentMode"in document&&(El=document.documentMode);var uC=ts&&"TextEvent"in window&&!El,rw=ts&&(!Pp||El&&8<El&&11>=El),_0=String.fromCharCode(32),E0=!1;function sw(n,e){switch(n){case"keyup":return cC.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function iw(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Pa=!1;function dC(n,e){switch(n){case"compositionend":return iw(e);case"keypress":return e.which!==32?null:(E0=!0,_0);case"textInput":return n=e.data,n===_0&&E0?null:n;default:return null}}function hC(n,e){if(Pa)return n==="compositionend"||!Pp&&sw(n,e)?(n=nw(),ju=Np=Os=null,Pa=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return rw&&e.locale!=="ko"?null:e.data;default:return null}}var mC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function T0(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!mC[n.type]:e==="textarea"}function aw(n,e,t,r){Lb(r),e=cd(e,"onChange"),0<e.length&&(t=new Ap("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Tl=null,zl=null;function fC(n){yw(n,0)}function eh(n){var e=Da(n);if(kb(e))return n}function pC(n,e){if(n==="change")return e}var ow=!1;if(ts){var om;if(ts){var lm="oninput"in document;if(!lm){var I0=document.createElement("div");I0.setAttribute("oninput","return;"),lm=typeof I0.oninput=="function"}om=lm}else om=!1;ow=om&&(!document.documentMode||9<document.documentMode)}function S0(){Tl&&(Tl.detachEvent("onpropertychange",lw),zl=Tl=null)}function lw(n){if(n.propertyName==="value"&&eh(zl)){var e=[];aw(e,zl,n,Ep(n)),Ub(fC,e)}}function gC(n,e,t){n==="focusin"?(S0(),Tl=e,zl=t,Tl.attachEvent("onpropertychange",lw)):n==="focusout"&&S0()}function yC(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return eh(zl)}function vC(n,e){if(n==="click")return eh(e)}function xC(n,e){if(n==="input"||n==="change")return eh(e)}function bC(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Sr=typeof Object.is=="function"?Object.is:bC;function ql(n,e){if(Sr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!$m.call(e,s)||!Sr(n[s],e[s]))return!1}return!0}function C0(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function N0(n,e){var t=C0(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=C0(t)}}function cw(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?cw(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function uw(){for(var n=window,e=nd();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=nd(n.document)}return e}function Rp(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function wC(n){var e=uw(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&cw(t.ownerDocument.documentElement,t)){if(r!==null&&Rp(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=N0(t,i);var a=N0(t,r);s&&a&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var _C=ts&&"documentMode"in document&&11>=document.documentMode,Ra=null,af=null,Il=null,of=!1;function A0(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;of||Ra==null||Ra!==nd(r)||(r=Ra,"selectionStart"in r&&Rp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Il&&ql(Il,r)||(Il=r,r=cd(af,"onSelect"),0<r.length&&(e=new Ap("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Ra)))}function hu(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var ja={animationend:hu("Animation","AnimationEnd"),animationiteration:hu("Animation","AnimationIteration"),animationstart:hu("Animation","AnimationStart"),transitionend:hu("Transition","TransitionEnd")},cm={},dw={};ts&&(dw=document.createElement("div").style,"AnimationEvent"in window||(delete ja.animationend.animation,delete ja.animationiteration.animation,delete ja.animationstart.animation),"TransitionEvent"in window||delete ja.transitionend.transition);function th(n){if(cm[n])return cm[n];if(!ja[n])return n;var e=ja[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in dw)return cm[n]=e[t];return n}var hw=th("animationend"),mw=th("animationiteration"),fw=th("animationstart"),pw=th("transitionend"),gw=new Map,k0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function di(n,e){gw.set(n,e),aa(e,[n])}for(var um=0;um<k0.length;um++){var dm=k0[um],EC=dm.toLowerCase(),TC=dm[0].toUpperCase()+dm.slice(1);di(EC,"on"+TC)}di(hw,"onAnimationEnd");di(mw,"onAnimationIteration");di(fw,"onAnimationStart");di("dblclick","onDoubleClick");di("focusin","onFocus");di("focusout","onBlur");di(pw,"onTransitionEnd");eo("onMouseEnter",["mouseout","mouseover"]);eo("onMouseLeave",["mouseout","mouseover"]);eo("onPointerEnter",["pointerout","pointerover"]);eo("onPointerLeave",["pointerout","pointerover"]);aa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));aa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));aa("onBeforeInput",["compositionend","keypress","textInput","paste"]);aa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));aa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));aa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),IC=new Set("cancel close invalid load scroll toggle".split(" ").concat(fl));function P0(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,E1(r,e,void 0,n),n.currentTarget=null}function yw(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var l=r[a],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;P0(s,l,d),i=c}else for(a=0;a<r.length;a++){if(l=r[a],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;P0(s,l,d),i=c}}}if(sd)throw n=tf,sd=!1,tf=null,n}function mt(n,e){var t=e[hf];t===void 0&&(t=e[hf]=new Set);var r=n+"__bubble";t.has(r)||(vw(e,n,2,!1),t.add(r))}function hm(n,e,t){var r=0;e&&(r|=4),vw(t,n,r,e)}var mu="_reactListening"+Math.random().toString(36).slice(2);function Wl(n){if(!n[mu]){n[mu]=!0,Ib.forEach(function(t){t!=="selectionchange"&&(IC.has(t)||hm(t,!1,n),hm(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[mu]||(e[mu]=!0,hm("selectionchange",!1,e))}}function vw(n,e,t,r){switch(tw(e)){case 1:var s=F1;break;case 4:s=$1;break;default:s=Cp}t=s.bind(null,e,t,n),s=void 0,!ef||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function mm(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;a=a.return}for(;l!==null;){if(a=Mi(l),a===null)return;if(c=a.tag,c===5||c===6){r=i=a;continue e}l=l.parentNode}}r=r.return}Ub(function(){var d=i,h=Ep(t),m=[];e:{var p=gw.get(n);if(p!==void 0){var y=Ap,_=n;switch(n){case"keypress":if(Du(t)===0)break e;case"keydown":case"keyup":y=tC;break;case"focusin":_="focus",y=am;break;case"focusout":_="blur",y=am;break;case"beforeblur":case"afterblur":y=am;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=x0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=z1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=sC;break;case hw:case mw:case fw:y=H1;break;case pw:y=aC;break;case"scroll":y=U1;break;case"wheel":y=lC;break;case"copy":case"cut":case"paste":y=K1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=w0}var T=(e&4)!==0,E=!T&&n==="scroll",x=T?p!==null?p+"Capture":null:p;T=[];for(var v=d,S;v!==null;){S=v;var P=S.stateNode;if(S.tag===5&&P!==null&&(S=P,x!==null&&(P=Fl(v,x),P!=null&&T.push(Hl(v,P,S)))),E)break;v=v.return}0<T.length&&(p=new y(p,_,null,t,h),m.push({event:p,listeners:T}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",p&&t!==Xm&&(_=t.relatedTarget||t.fromElement)&&(Mi(_)||_[ns]))break e;if((y||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,y?(_=t.relatedTarget||t.toElement,y=d,_=_?Mi(_):null,_!==null&&(E=oa(_),_!==E||_.tag!==5&&_.tag!==6)&&(_=null)):(y=null,_=d),y!==_)){if(T=x0,P="onMouseLeave",x="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(T=w0,P="onPointerLeave",x="onPointerEnter",v="pointer"),E=y==null?p:Da(y),S=_==null?p:Da(_),p=new T(P,v+"leave",y,t,h),p.target=E,p.relatedTarget=S,P=null,Mi(h)===d&&(T=new T(x,v+"enter",_,t,h),T.target=S,T.relatedTarget=E,P=T),E=P,y&&_)t:{for(T=y,x=_,v=0,S=T;S;S=xa(S))v++;for(S=0,P=x;P;P=xa(P))S++;for(;0<v-S;)T=xa(T),v--;for(;0<S-v;)x=xa(x),S--;for(;v--;){if(T===x||x!==null&&T===x.alternate)break t;T=xa(T),x=xa(x)}T=null}else T=null;y!==null&&R0(m,p,y,T,!1),_!==null&&E!==null&&R0(m,E,_,T,!0)}}e:{if(p=d?Da(d):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var M=pC;else if(T0(p))if(ow)M=xC;else{M=yC;var $=gC}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(M=vC);if(M&&(M=M(n,d))){aw(m,M,t,h);break e}$&&$(n,p,d),n==="focusout"&&($=p._wrapperState)&&$.controlled&&p.type==="number"&&Gm(p,"number",p.value)}switch($=d?Da(d):window,n){case"focusin":(T0($)||$.contentEditable==="true")&&(Ra=$,af=d,Il=null);break;case"focusout":Il=af=Ra=null;break;case"mousedown":of=!0;break;case"contextmenu":case"mouseup":case"dragend":of=!1,A0(m,t,h);break;case"selectionchange":if(_C)break;case"keydown":case"keyup":A0(m,t,h)}var I;if(Pp)e:{switch(n){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Pa?sw(n,t)&&(b="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(b="onCompositionStart");b&&(rw&&t.locale!=="ko"&&(Pa||b!=="onCompositionStart"?b==="onCompositionEnd"&&Pa&&(I=nw()):(Os=h,Np="value"in Os?Os.value:Os.textContent,Pa=!0)),$=cd(d,b),0<$.length&&(b=new b0(b,n,null,t,h),m.push({event:b,listeners:$}),I?b.data=I:(I=iw(t),I!==null&&(b.data=I)))),(I=uC?dC(n,t):hC(n,t))&&(d=cd(d,"onBeforeInput"),0<d.length&&(h=new b0("onBeforeInput","beforeinput",null,t,h),m.push({event:h,listeners:d}),h.data=I))}yw(m,e)})}function Hl(n,e,t){return{instance:n,listener:e,currentTarget:t}}function cd(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Fl(n,t),i!=null&&r.unshift(Hl(n,i,s)),i=Fl(n,e),i!=null&&r.push(Hl(n,i,s))),n=n.return}return r}function xa(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function R0(n,e,t,r,s){for(var i=e._reactName,a=[];t!==null&&t!==r;){var l=t,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=Fl(t,i),c!=null&&a.unshift(Hl(t,c,l))):s||(c=Fl(t,i),c!=null&&a.push(Hl(t,c,l)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var SC=/\r\n?/g,CC=/\u0000|\uFFFD/g;function j0(n){return(typeof n=="string"?n:""+n).replace(SC,`
`).replace(CC,"")}function fu(n,e,t){if(e=j0(e),j0(n)!==e&&t)throw Error(te(425))}function ud(){}var lf=null,cf=null;function uf(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var df=typeof setTimeout=="function"?setTimeout:void 0,NC=typeof clearTimeout=="function"?clearTimeout:void 0,D0=typeof Promise=="function"?Promise:void 0,AC=typeof queueMicrotask=="function"?queueMicrotask:typeof D0<"u"?function(n){return D0.resolve(null).then(n).catch(kC)}:df;function kC(n){setTimeout(function(){throw n})}function fm(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Bl(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Bl(e)}function Ws(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function M0(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Co=Math.random().toString(36).slice(2),kr="__reactFiber$"+Co,Gl="__reactProps$"+Co,ns="__reactContainer$"+Co,hf="__reactEvents$"+Co,PC="__reactListeners$"+Co,RC="__reactHandles$"+Co;function Mi(n){var e=n[kr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[ns]||t[kr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=M0(n);n!==null;){if(t=n[kr])return t;n=M0(n)}return e}n=t,t=n.parentNode}return null}function xc(n){return n=n[kr]||n[ns],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Da(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(te(33))}function nh(n){return n[Gl]||null}var mf=[],Ma=-1;function hi(n){return{current:n}}function pt(n){0>Ma||(n.current=mf[Ma],mf[Ma]=null,Ma--)}function lt(n,e){Ma++,mf[Ma]=n.current,n.current=e}var ti={},jn=hi(ti),Qn=hi(!1),zi=ti;function to(n,e){var t=n.type.contextTypes;if(!t)return ti;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function Yn(n){return n=n.childContextTypes,n!=null}function dd(){pt(Qn),pt(jn)}function V0(n,e,t){if(jn.current!==ti)throw Error(te(168));lt(jn,e),lt(Qn,t)}function xw(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(te(108,g1(n)||"Unknown",s));return Nt({},t,r)}function hd(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||ti,zi=jn.current,lt(jn,n),lt(Qn,Qn.current),!0}function L0(n,e,t){var r=n.stateNode;if(!r)throw Error(te(169));t?(n=xw(n,e,zi),r.__reactInternalMemoizedMergedChildContext=n,pt(Qn),pt(jn),lt(jn,n)):pt(Qn),lt(Qn,t)}var Wr=null,rh=!1,pm=!1;function bw(n){Wr===null?Wr=[n]:Wr.push(n)}function jC(n){rh=!0,bw(n)}function mi(){if(!pm&&Wr!==null){pm=!0;var n=0,e=nt;try{var t=Wr;for(nt=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Wr=null,rh=!1}catch(s){throw Wr!==null&&(Wr=Wr.slice(n+1)),Wb(Tp,mi),s}finally{nt=e,pm=!1}}return null}var Va=[],La=0,md=null,fd=0,ur=[],dr=0,qi=null,Gr=1,Kr="";function Si(n,e){Va[La++]=fd,Va[La++]=md,md=n,fd=e}function ww(n,e,t){ur[dr++]=Gr,ur[dr++]=Kr,ur[dr++]=qi,qi=n;var r=Gr;n=Kr;var s=32-Tr(r)-1;r&=~(1<<s),t+=1;var i=32-Tr(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,Gr=1<<32-Tr(e)+s|t<<s|r,Kr=i+n}else Gr=1<<i|t<<s|r,Kr=n}function jp(n){n.return!==null&&(Si(n,1),ww(n,1,0))}function Dp(n){for(;n===md;)md=Va[--La],Va[La]=null,fd=Va[--La],Va[La]=null;for(;n===qi;)qi=ur[--dr],ur[dr]=null,Kr=ur[--dr],ur[dr]=null,Gr=ur[--dr],ur[dr]=null}var sr=null,rr=null,wt=!1,Er=null;function _w(n,e){var t=hr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function O0(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,sr=n,rr=Ws(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,sr=n,rr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=qi!==null?{id:Gr,overflow:Kr}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=hr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,sr=n,rr=null,!0):!1;default:return!1}}function ff(n){return(n.mode&1)!==0&&(n.flags&128)===0}function pf(n){if(wt){var e=rr;if(e){var t=e;if(!O0(n,e)){if(ff(n))throw Error(te(418));e=Ws(t.nextSibling);var r=sr;e&&O0(n,e)?_w(r,t):(n.flags=n.flags&-4097|2,wt=!1,sr=n)}}else{if(ff(n))throw Error(te(418));n.flags=n.flags&-4097|2,wt=!1,sr=n}}}function F0(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;sr=n}function pu(n){if(n!==sr)return!1;if(!wt)return F0(n),wt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!uf(n.type,n.memoizedProps)),e&&(e=rr)){if(ff(n))throw Ew(),Error(te(418));for(;e;)_w(n,e),e=Ws(e.nextSibling)}if(F0(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(te(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){rr=Ws(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}rr=null}}else rr=sr?Ws(n.stateNode.nextSibling):null;return!0}function Ew(){for(var n=rr;n;)n=Ws(n.nextSibling)}function no(){rr=sr=null,wt=!1}function Mp(n){Er===null?Er=[n]:Er.push(n)}var DC=us.ReactCurrentBatchConfig;function rl(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(te(309));var r=t.stateNode}if(!r)throw Error(te(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var l=s.refs;a===null?delete l[i]:l[i]=a},e._stringRef=i,e)}if(typeof n!="string")throw Error(te(284));if(!t._owner)throw Error(te(290,n))}return n}function gu(n,e){throw n=Object.prototype.toString.call(e),Error(te(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function $0(n){var e=n._init;return e(n._payload)}function Tw(n){function e(x,v){if(n){var S=x.deletions;S===null?(x.deletions=[v],x.flags|=16):S.push(v)}}function t(x,v){if(!n)return null;for(;v!==null;)e(x,v),v=v.sibling;return null}function r(x,v){for(x=new Map;v!==null;)v.key!==null?x.set(v.key,v):x.set(v.index,v),v=v.sibling;return x}function s(x,v){return x=Qs(x,v),x.index=0,x.sibling=null,x}function i(x,v,S){return x.index=S,n?(S=x.alternate,S!==null?(S=S.index,S<v?(x.flags|=2,v):S):(x.flags|=2,v)):(x.flags|=1048576,v)}function a(x){return n&&x.alternate===null&&(x.flags|=2),x}function l(x,v,S,P){return v===null||v.tag!==6?(v=_m(S,x.mode,P),v.return=x,v):(v=s(v,S),v.return=x,v)}function c(x,v,S,P){var M=S.type;return M===ka?h(x,v,S.props.children,P,S.key):v!==null&&(v.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Ss&&$0(M)===v.type)?(P=s(v,S.props),P.ref=rl(x,v,S),P.return=x,P):(P=Uu(S.type,S.key,S.props,null,x.mode,P),P.ref=rl(x,v,S),P.return=x,P)}function d(x,v,S,P){return v===null||v.tag!==4||v.stateNode.containerInfo!==S.containerInfo||v.stateNode.implementation!==S.implementation?(v=Em(S,x.mode,P),v.return=x,v):(v=s(v,S.children||[]),v.return=x,v)}function h(x,v,S,P,M){return v===null||v.tag!==7?(v=$i(S,x.mode,P,M),v.return=x,v):(v=s(v,S),v.return=x,v)}function m(x,v,S){if(typeof v=="string"&&v!==""||typeof v=="number")return v=_m(""+v,x.mode,S),v.return=x,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case iu:return S=Uu(v.type,v.key,v.props,null,x.mode,S),S.ref=rl(x,null,v),S.return=x,S;case Aa:return v=Em(v,x.mode,S),v.return=x,v;case Ss:var P=v._init;return m(x,P(v._payload),S)}if(hl(v)||Xo(v))return v=$i(v,x.mode,S,null),v.return=x,v;gu(x,v)}return null}function p(x,v,S,P){var M=v!==null?v.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return M!==null?null:l(x,v,""+S,P);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case iu:return S.key===M?c(x,v,S,P):null;case Aa:return S.key===M?d(x,v,S,P):null;case Ss:return M=S._init,p(x,v,M(S._payload),P)}if(hl(S)||Xo(S))return M!==null?null:h(x,v,S,P,null);gu(x,S)}return null}function y(x,v,S,P,M){if(typeof P=="string"&&P!==""||typeof P=="number")return x=x.get(S)||null,l(v,x,""+P,M);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case iu:return x=x.get(P.key===null?S:P.key)||null,c(v,x,P,M);case Aa:return x=x.get(P.key===null?S:P.key)||null,d(v,x,P,M);case Ss:var $=P._init;return y(x,v,S,$(P._payload),M)}if(hl(P)||Xo(P))return x=x.get(S)||null,h(v,x,P,M,null);gu(v,P)}return null}function _(x,v,S,P){for(var M=null,$=null,I=v,b=v=0,C=null;I!==null&&b<S.length;b++){I.index>b?(C=I,I=null):C=I.sibling;var N=p(x,I,S[b],P);if(N===null){I===null&&(I=C);break}n&&I&&N.alternate===null&&e(x,I),v=i(N,v,b),$===null?M=N:$.sibling=N,$=N,I=C}if(b===S.length)return t(x,I),wt&&Si(x,b),M;if(I===null){for(;b<S.length;b++)I=m(x,S[b],P),I!==null&&(v=i(I,v,b),$===null?M=I:$.sibling=I,$=I);return wt&&Si(x,b),M}for(I=r(x,I);b<S.length;b++)C=y(I,x,b,S[b],P),C!==null&&(n&&C.alternate!==null&&I.delete(C.key===null?b:C.key),v=i(C,v,b),$===null?M=C:$.sibling=C,$=C);return n&&I.forEach(function(R){return e(x,R)}),wt&&Si(x,b),M}function T(x,v,S,P){var M=Xo(S);if(typeof M!="function")throw Error(te(150));if(S=M.call(S),S==null)throw Error(te(151));for(var $=M=null,I=v,b=v=0,C=null,N=S.next();I!==null&&!N.done;b++,N=S.next()){I.index>b?(C=I,I=null):C=I.sibling;var R=p(x,I,N.value,P);if(R===null){I===null&&(I=C);break}n&&I&&R.alternate===null&&e(x,I),v=i(R,v,b),$===null?M=R:$.sibling=R,$=R,I=C}if(N.done)return t(x,I),wt&&Si(x,b),M;if(I===null){for(;!N.done;b++,N=S.next())N=m(x,N.value,P),N!==null&&(v=i(N,v,b),$===null?M=N:$.sibling=N,$=N);return wt&&Si(x,b),M}for(I=r(x,I);!N.done;b++,N=S.next())N=y(I,x,b,N.value,P),N!==null&&(n&&N.alternate!==null&&I.delete(N.key===null?b:N.key),v=i(N,v,b),$===null?M=N:$.sibling=N,$=N);return n&&I.forEach(function(D){return e(x,D)}),wt&&Si(x,b),M}function E(x,v,S,P){if(typeof S=="object"&&S!==null&&S.type===ka&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case iu:e:{for(var M=S.key,$=v;$!==null;){if($.key===M){if(M=S.type,M===ka){if($.tag===7){t(x,$.sibling),v=s($,S.props.children),v.return=x,x=v;break e}}else if($.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Ss&&$0(M)===$.type){t(x,$.sibling),v=s($,S.props),v.ref=rl(x,$,S),v.return=x,x=v;break e}t(x,$);break}else e(x,$);$=$.sibling}S.type===ka?(v=$i(S.props.children,x.mode,P,S.key),v.return=x,x=v):(P=Uu(S.type,S.key,S.props,null,x.mode,P),P.ref=rl(x,v,S),P.return=x,x=P)}return a(x);case Aa:e:{for($=S.key;v!==null;){if(v.key===$)if(v.tag===4&&v.stateNode.containerInfo===S.containerInfo&&v.stateNode.implementation===S.implementation){t(x,v.sibling),v=s(v,S.children||[]),v.return=x,x=v;break e}else{t(x,v);break}else e(x,v);v=v.sibling}v=Em(S,x.mode,P),v.return=x,x=v}return a(x);case Ss:return $=S._init,E(x,v,$(S._payload),P)}if(hl(S))return _(x,v,S,P);if(Xo(S))return T(x,v,S,P);gu(x,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,v!==null&&v.tag===6?(t(x,v.sibling),v=s(v,S),v.return=x,x=v):(t(x,v),v=_m(S,x.mode,P),v.return=x,x=v),a(x)):t(x,v)}return E}var ro=Tw(!0),Iw=Tw(!1),pd=hi(null),gd=null,Oa=null,Vp=null;function Lp(){Vp=Oa=gd=null}function Op(n){var e=pd.current;pt(pd),n._currentValue=e}function gf(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Ha(n,e){gd=n,Vp=Oa=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Wn=!0),n.firstContext=null)}function fr(n){var e=n._currentValue;if(Vp!==n)if(n={context:n,memoizedValue:e,next:null},Oa===null){if(gd===null)throw Error(te(308));Oa=n,gd.dependencies={lanes:0,firstContext:n}}else Oa=Oa.next=n;return e}var Vi=null;function Fp(n){Vi===null?Vi=[n]:Vi.push(n)}function Sw(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,Fp(e)):(t.next=s.next,s.next=t),e.interleaved=t,rs(n,r)}function rs(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Cs=!1;function $p(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Cw(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Zr(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Hs(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Ge&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,rs(n,t)}return s=r.interleaved,s===null?(e.next=e,Fp(r)):(e.next=s.next,s.next=e),r.interleaved=e,rs(n,t)}function Mu(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Ip(n,t)}}function U0(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=a:i=i.next=a,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function yd(n,e,t,r){var s=n.updateQueue;Cs=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,a===null?i=d:a.next=d,a=c;var h=n.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==a&&(l===null?h.firstBaseUpdate=d:l.next=d,h.lastBaseUpdate=c))}if(i!==null){var m=s.baseState;a=0,h=d=c=null,l=i;do{var p=l.lane,y=l.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:y,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var _=n,T=l;switch(p=e,y=t,T.tag){case 1:if(_=T.payload,typeof _=="function"){m=_.call(y,m,p);break e}m=_;break e;case 3:_.flags=_.flags&-65537|128;case 0:if(_=T.payload,p=typeof _=="function"?_.call(y,m,p):_,p==null)break e;m=Nt({},m,p);break e;case 2:Cs=!0}}l.callback!==null&&l.lane!==0&&(n.flags|=64,p=s.effects,p===null?s.effects=[l]:p.push(l))}else y={eventTime:y,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(d=h=y,c=m):h=h.next=y,a|=p;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;p=l,l=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(1);if(h===null&&(c=m),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Hi|=a,n.lanes=a,n.memoizedState=m}}function B0(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(te(191,s));s.call(r)}}}var bc={},Mr=hi(bc),Kl=hi(bc),Ql=hi(bc);function Li(n){if(n===bc)throw Error(te(174));return n}function Up(n,e){switch(lt(Ql,e),lt(Kl,n),lt(Mr,bc),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Qm(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Qm(e,n)}pt(Mr),lt(Mr,e)}function so(){pt(Mr),pt(Kl),pt(Ql)}function Nw(n){Li(Ql.current);var e=Li(Mr.current),t=Qm(e,n.type);e!==t&&(lt(Kl,n),lt(Mr,t))}function Bp(n){Kl.current===n&&(pt(Mr),pt(Kl))}var It=hi(0);function vd(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var gm=[];function zp(){for(var n=0;n<gm.length;n++)gm[n]._workInProgressVersionPrimary=null;gm.length=0}var Vu=us.ReactCurrentDispatcher,ym=us.ReactCurrentBatchConfig,Wi=0,St=null,Xt=null,on=null,xd=!1,Sl=!1,Yl=0,MC=0;function Sn(){throw Error(te(321))}function qp(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Sr(n[t],e[t]))return!1;return!0}function Wp(n,e,t,r,s,i){if(Wi=i,St=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Vu.current=n===null||n.memoizedState===null?FC:$C,n=t(r,s),Sl){i=0;do{if(Sl=!1,Yl=0,25<=i)throw Error(te(301));i+=1,on=Xt=null,e.updateQueue=null,Vu.current=UC,n=t(r,s)}while(Sl)}if(Vu.current=bd,e=Xt!==null&&Xt.next!==null,Wi=0,on=Xt=St=null,xd=!1,e)throw Error(te(300));return n}function Hp(){var n=Yl!==0;return Yl=0,n}function Ar(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return on===null?St.memoizedState=on=n:on=on.next=n,on}function pr(){if(Xt===null){var n=St.alternate;n=n!==null?n.memoizedState:null}else n=Xt.next;var e=on===null?St.memoizedState:on.next;if(e!==null)on=e,Xt=n;else{if(n===null)throw Error(te(310));Xt=n,n={memoizedState:Xt.memoizedState,baseState:Xt.baseState,baseQueue:Xt.baseQueue,queue:Xt.queue,next:null},on===null?St.memoizedState=on=n:on=on.next=n}return on}function Jl(n,e){return typeof e=="function"?e(n):e}function vm(n){var e=pr(),t=e.queue;if(t===null)throw Error(te(311));t.lastRenderedReducer=n;var r=Xt,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=a=null,c=null,d=i;do{var h=d.lane;if((Wi&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:n(r,d.action);else{var m={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=m,a=r):c=c.next=m,St.lanes|=h,Hi|=h}d=d.next}while(d!==null&&d!==i);c===null?a=r:c.next=l,Sr(r,e.memoizedState)||(Wn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=c,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,St.lanes|=i,Hi|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function xm(n){var e=pr(),t=e.queue;if(t===null)throw Error(te(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var a=s=s.next;do i=n(i,a.action),a=a.next;while(a!==s);Sr(i,e.memoizedState)||(Wn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function Aw(){}function kw(n,e){var t=St,r=pr(),s=e(),i=!Sr(r.memoizedState,s);if(i&&(r.memoizedState=s,Wn=!0),r=r.queue,Gp(jw.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||on!==null&&on.memoizedState.tag&1){if(t.flags|=2048,Xl(9,Rw.bind(null,t,r,s,e),void 0,null),cn===null)throw Error(te(349));Wi&30||Pw(t,e,s)}return s}function Pw(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=St.updateQueue,e===null?(e={lastEffect:null,stores:null},St.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Rw(n,e,t,r){e.value=t,e.getSnapshot=r,Dw(e)&&Mw(n)}function jw(n,e,t){return t(function(){Dw(e)&&Mw(n)})}function Dw(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Sr(n,t)}catch{return!0}}function Mw(n){var e=rs(n,1);e!==null&&Ir(e,n,1,-1)}function z0(n){var e=Ar();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Jl,lastRenderedState:n},e.queue=n,n=n.dispatch=OC.bind(null,St,n),[e.memoizedState,n]}function Xl(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=St.updateQueue,e===null?(e={lastEffect:null,stores:null},St.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Vw(){return pr().memoizedState}function Lu(n,e,t,r){var s=Ar();St.flags|=n,s.memoizedState=Xl(1|e,t,void 0,r===void 0?null:r)}function sh(n,e,t,r){var s=pr();r=r===void 0?null:r;var i=void 0;if(Xt!==null){var a=Xt.memoizedState;if(i=a.destroy,r!==null&&qp(r,a.deps)){s.memoizedState=Xl(e,t,i,r);return}}St.flags|=n,s.memoizedState=Xl(1|e,t,i,r)}function q0(n,e){return Lu(8390656,8,n,e)}function Gp(n,e){return sh(2048,8,n,e)}function Lw(n,e){return sh(4,2,n,e)}function Ow(n,e){return sh(4,4,n,e)}function Fw(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function $w(n,e,t){return t=t!=null?t.concat([n]):null,sh(4,4,Fw.bind(null,e,n),t)}function Kp(){}function Uw(n,e){var t=pr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&qp(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Bw(n,e){var t=pr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&qp(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function zw(n,e,t){return Wi&21?(Sr(t,e)||(t=Kb(),St.lanes|=t,Hi|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Wn=!0),n.memoizedState=t)}function VC(n,e){var t=nt;nt=t!==0&&4>t?t:4,n(!0);var r=ym.transition;ym.transition={};try{n(!1),e()}finally{nt=t,ym.transition=r}}function qw(){return pr().memoizedState}function LC(n,e,t){var r=Ks(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Ww(n))Hw(e,t);else if(t=Sw(n,e,t,r),t!==null){var s=On();Ir(t,n,r,s),Gw(t,e,r)}}function OC(n,e,t){var r=Ks(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Ww(n))Hw(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,l=i(a,t);if(s.hasEagerState=!0,s.eagerState=l,Sr(l,a)){var c=e.interleaved;c===null?(s.next=s,Fp(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}t=Sw(n,e,s,r),t!==null&&(s=On(),Ir(t,n,r,s),Gw(t,e,r))}}function Ww(n){var e=n.alternate;return n===St||e!==null&&e===St}function Hw(n,e){Sl=xd=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Gw(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Ip(n,t)}}var bd={readContext:fr,useCallback:Sn,useContext:Sn,useEffect:Sn,useImperativeHandle:Sn,useInsertionEffect:Sn,useLayoutEffect:Sn,useMemo:Sn,useReducer:Sn,useRef:Sn,useState:Sn,useDebugValue:Sn,useDeferredValue:Sn,useTransition:Sn,useMutableSource:Sn,useSyncExternalStore:Sn,useId:Sn,unstable_isNewReconciler:!1},FC={readContext:fr,useCallback:function(n,e){return Ar().memoizedState=[n,e===void 0?null:e],n},useContext:fr,useEffect:q0,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Lu(4194308,4,Fw.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Lu(4194308,4,n,e)},useInsertionEffect:function(n,e){return Lu(4,2,n,e)},useMemo:function(n,e){var t=Ar();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Ar();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=LC.bind(null,St,n),[r.memoizedState,n]},useRef:function(n){var e=Ar();return n={current:n},e.memoizedState=n},useState:z0,useDebugValue:Kp,useDeferredValue:function(n){return Ar().memoizedState=n},useTransition:function(){var n=z0(!1),e=n[0];return n=VC.bind(null,n[1]),Ar().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=St,s=Ar();if(wt){if(t===void 0)throw Error(te(407));t=t()}else{if(t=e(),cn===null)throw Error(te(349));Wi&30||Pw(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,q0(jw.bind(null,r,i,n),[n]),r.flags|=2048,Xl(9,Rw.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Ar(),e=cn.identifierPrefix;if(wt){var t=Kr,r=Gr;t=(r&~(1<<32-Tr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Yl++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=MC++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},$C={readContext:fr,useCallback:Uw,useContext:fr,useEffect:Gp,useImperativeHandle:$w,useInsertionEffect:Lw,useLayoutEffect:Ow,useMemo:Bw,useReducer:vm,useRef:Vw,useState:function(){return vm(Jl)},useDebugValue:Kp,useDeferredValue:function(n){var e=pr();return zw(e,Xt.memoizedState,n)},useTransition:function(){var n=vm(Jl)[0],e=pr().memoizedState;return[n,e]},useMutableSource:Aw,useSyncExternalStore:kw,useId:qw,unstable_isNewReconciler:!1},UC={readContext:fr,useCallback:Uw,useContext:fr,useEffect:Gp,useImperativeHandle:$w,useInsertionEffect:Lw,useLayoutEffect:Ow,useMemo:Bw,useReducer:xm,useRef:Vw,useState:function(){return xm(Jl)},useDebugValue:Kp,useDeferredValue:function(n){var e=pr();return Xt===null?e.memoizedState=n:zw(e,Xt.memoizedState,n)},useTransition:function(){var n=xm(Jl)[0],e=pr().memoizedState;return[n,e]},useMutableSource:Aw,useSyncExternalStore:kw,useId:qw,unstable_isNewReconciler:!1};function wr(n,e){if(n&&n.defaultProps){e=Nt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function yf(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Nt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var ih={isMounted:function(n){return(n=n._reactInternals)?oa(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=On(),s=Ks(n),i=Zr(r,s);i.payload=e,t!=null&&(i.callback=t),e=Hs(n,i,s),e!==null&&(Ir(e,n,s,r),Mu(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=On(),s=Ks(n),i=Zr(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Hs(n,i,s),e!==null&&(Ir(e,n,s,r),Mu(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=On(),r=Ks(n),s=Zr(t,r);s.tag=2,e!=null&&(s.callback=e),e=Hs(n,s,r),e!==null&&(Ir(e,n,r,t),Mu(e,n,r))}};function W0(n,e,t,r,s,i,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!ql(t,r)||!ql(s,i):!0}function Kw(n,e,t){var r=!1,s=ti,i=e.contextType;return typeof i=="object"&&i!==null?i=fr(i):(s=Yn(e)?zi:jn.current,r=e.contextTypes,i=(r=r!=null)?to(n,s):ti),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ih,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function H0(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&ih.enqueueReplaceState(e,e.state,null)}function vf(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},$p(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=fr(i):(i=Yn(e)?zi:jn.current,s.context=to(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(yf(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&ih.enqueueReplaceState(s,s.state,null),yd(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function io(n,e){try{var t="",r=e;do t+=p1(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function bm(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function xf(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var BC=typeof WeakMap=="function"?WeakMap:Map;function Qw(n,e,t){t=Zr(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){_d||(_d=!0,Af=r),xf(n,e)},t}function Yw(n,e,t){t=Zr(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){xf(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){xf(n,e),typeof r!="function"&&(Gs===null?Gs=new Set([this]):Gs.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function G0(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new BC;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=nN.bind(null,n,e,t),e.then(n,n))}function K0(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Q0(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Zr(-1,1),e.tag=2,Hs(t,e,1))),t.lanes|=1),n)}var zC=us.ReactCurrentOwner,Wn=!1;function Ln(n,e,t,r){e.child=n===null?Iw(e,null,t,r):ro(e,n.child,t,r)}function Y0(n,e,t,r,s){t=t.render;var i=e.ref;return Ha(e,s),r=Wp(n,e,t,r,i,s),t=Hp(),n!==null&&!Wn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ss(n,e,s)):(wt&&t&&jp(e),e.flags|=1,Ln(n,e,r,s),e.child)}function J0(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!ng(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,Jw(n,e,i,r,s)):(n=Uu(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var a=i.memoizedProps;if(t=t.compare,t=t!==null?t:ql,t(a,r)&&n.ref===e.ref)return ss(n,e,s)}return e.flags|=1,n=Qs(i,r),n.ref=e.ref,n.return=e,e.child=n}function Jw(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(ql(i,r)&&n.ref===e.ref)if(Wn=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(Wn=!0);else return e.lanes=n.lanes,ss(n,e,s)}return bf(n,e,t,r,s)}function Xw(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},lt($a,nr),nr|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,lt($a,nr),nr|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,lt($a,nr),nr|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,lt($a,nr),nr|=r;return Ln(n,e,s,t),e.child}function Zw(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function bf(n,e,t,r,s){var i=Yn(t)?zi:jn.current;return i=to(e,i),Ha(e,s),t=Wp(n,e,t,r,i,s),r=Hp(),n!==null&&!Wn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ss(n,e,s)):(wt&&r&&jp(e),e.flags|=1,Ln(n,e,t,s),e.child)}function X0(n,e,t,r,s){if(Yn(t)){var i=!0;hd(e)}else i=!1;if(Ha(e,s),e.stateNode===null)Ou(n,e),Kw(e,t,r),vf(e,t,r,s),r=!0;else if(n===null){var a=e.stateNode,l=e.memoizedProps;a.props=l;var c=a.context,d=t.contextType;typeof d=="object"&&d!==null?d=fr(d):(d=Yn(t)?zi:jn.current,d=to(e,d));var h=t.getDerivedStateFromProps,m=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";m||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==r||c!==d)&&H0(e,a,r,d),Cs=!1;var p=e.memoizedState;a.state=p,yd(e,r,a,s),c=e.memoizedState,l!==r||p!==c||Qn.current||Cs?(typeof h=="function"&&(yf(e,t,h,r),c=e.memoizedState),(l=Cs||W0(e,t,l,r,p,c,d))?(m||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),a.props=r,a.state=c,a.context=d,r=l):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,Cw(n,e),l=e.memoizedProps,d=e.type===e.elementType?l:wr(e.type,l),a.props=d,m=e.pendingProps,p=a.context,c=t.contextType,typeof c=="object"&&c!==null?c=fr(c):(c=Yn(t)?zi:jn.current,c=to(e,c));var y=t.getDerivedStateFromProps;(h=typeof y=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==m||p!==c)&&H0(e,a,r,c),Cs=!1,p=e.memoizedState,a.state=p,yd(e,r,a,s);var _=e.memoizedState;l!==m||p!==_||Qn.current||Cs?(typeof y=="function"&&(yf(e,t,y,r),_=e.memoizedState),(d=Cs||W0(e,t,d,r,p,_,c)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,_,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,_,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=_),a.props=r,a.state=_,a.context=c,r=d):(typeof a.componentDidUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),r=!1)}return wf(n,e,t,r,i,s)}function wf(n,e,t,r,s,i){Zw(n,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&L0(e,t,!1),ss(n,e,i);r=e.stateNode,zC.current=e;var l=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&a?(e.child=ro(e,n.child,null,i),e.child=ro(e,null,l,i)):Ln(n,e,l,i),e.memoizedState=r.state,s&&L0(e,t,!0),e.child}function e_(n){var e=n.stateNode;e.pendingContext?V0(n,e.pendingContext,e.pendingContext!==e.context):e.context&&V0(n,e.context,!1),Up(n,e.containerInfo)}function Z0(n,e,t,r,s){return no(),Mp(s),e.flags|=256,Ln(n,e,t,r),e.child}var _f={dehydrated:null,treeContext:null,retryLane:0};function Ef(n){return{baseLanes:n,cachePool:null,transitions:null}}function t_(n,e,t){var r=e.pendingProps,s=It.current,i=!1,a=(e.flags&128)!==0,l;if((l=a)||(l=n!==null&&n.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),lt(It,s&1),n===null)return pf(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,n=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=lh(a,r,0,null),n=$i(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=Ef(t),e.memoizedState=_f,n):Qp(e,a));if(s=n.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return qC(n,e,a,r,l,s,t);if(i){i=r.fallback,a=e.mode,s=n.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Qs(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=Qs(l,i):(i=$i(i,a,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=n.child.memoizedState,a=a===null?Ef(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=n.childLanes&~t,e.memoizedState=_f,r}return i=n.child,n=i.sibling,r=Qs(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Qp(n,e){return e=lh({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function yu(n,e,t,r){return r!==null&&Mp(r),ro(e,n.child,null,t),n=Qp(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function qC(n,e,t,r,s,i,a){if(t)return e.flags&256?(e.flags&=-257,r=bm(Error(te(422))),yu(n,e,a,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=lh({mode:"visible",children:r.children},s,0,null),i=$i(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&ro(e,n.child,null,a),e.child.memoizedState=Ef(a),e.memoizedState=_f,i);if(!(e.mode&1))return yu(n,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(te(419)),r=bm(i,r,void 0),yu(n,e,a,r)}if(l=(a&n.childLanes)!==0,Wn||l){if(r=cn,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,rs(n,s),Ir(r,n,s,-1))}return tg(),r=bm(Error(te(421))),yu(n,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=rN.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,rr=Ws(s.nextSibling),sr=e,wt=!0,Er=null,n!==null&&(ur[dr++]=Gr,ur[dr++]=Kr,ur[dr++]=qi,Gr=n.id,Kr=n.overflow,qi=e),e=Qp(e,r.children),e.flags|=4096,e)}function ev(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),gf(n.return,e,t)}function wm(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function n_(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Ln(n,e,r.children,t),r=It.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&ev(n,t,e);else if(n.tag===19)ev(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(lt(It,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&vd(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),wm(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&vd(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}wm(e,!0,t,null,i);break;case"together":wm(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ou(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ss(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Hi|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(te(153));if(e.child!==null){for(n=e.child,t=Qs(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Qs(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function WC(n,e,t){switch(e.tag){case 3:e_(e),no();break;case 5:Nw(e);break;case 1:Yn(e.type)&&hd(e);break;case 4:Up(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;lt(pd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(lt(It,It.current&1),e.flags|=128,null):t&e.child.childLanes?t_(n,e,t):(lt(It,It.current&1),n=ss(n,e,t),n!==null?n.sibling:null);lt(It,It.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return n_(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),lt(It,It.current),r)break;return null;case 22:case 23:return e.lanes=0,Xw(n,e,t)}return ss(n,e,t)}var r_,Tf,s_,i_;r_=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Tf=function(){};s_=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,Li(Mr.current);var i=null;switch(t){case"input":s=Wm(n,s),r=Wm(n,r),i=[];break;case"select":s=Nt({},s,{value:void 0}),r=Nt({},r,{value:void 0}),i=[];break;case"textarea":s=Km(n,s),r=Km(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=ud)}Ym(t,r);var a;t=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(a in l)l.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Ll.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(t||(t={}),t[a]=c[a])}else t||(i||(i=[]),i.push(d,t)),t=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Ll.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&mt("scroll",n),i||l===c||(i=[])):(i=i||[]).push(d,c))}t&&(i=i||[]).push("style",t);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};i_=function(n,e,t,r){t!==r&&(e.flags|=4)};function sl(n,e){if(!wt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Cn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function HC(n,e,t){var r=e.pendingProps;switch(Dp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Cn(e),null;case 1:return Yn(e.type)&&dd(),Cn(e),null;case 3:return r=e.stateNode,so(),pt(Qn),pt(jn),zp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(pu(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Er!==null&&(Rf(Er),Er=null))),Tf(n,e),Cn(e),null;case 5:Bp(e);var s=Li(Ql.current);if(t=e.type,n!==null&&e.stateNode!=null)s_(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(te(166));return Cn(e),null}if(n=Li(Mr.current),pu(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[kr]=e,r[Gl]=i,n=(e.mode&1)!==0,t){case"dialog":mt("cancel",r),mt("close",r);break;case"iframe":case"object":case"embed":mt("load",r);break;case"video":case"audio":for(s=0;s<fl.length;s++)mt(fl[s],r);break;case"source":mt("error",r);break;case"img":case"image":case"link":mt("error",r),mt("load",r);break;case"details":mt("toggle",r);break;case"input":c0(r,i),mt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},mt("invalid",r);break;case"textarea":d0(r,i),mt("invalid",r)}Ym(t,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&fu(r.textContent,l,n),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&fu(r.textContent,l,n),s=["children",""+l]):Ll.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&mt("scroll",r)}switch(t){case"input":au(r),u0(r,i,!0);break;case"textarea":au(r),h0(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=ud)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=jb(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=a.createElement(t,{is:r.is}):(n=a.createElement(t),t==="select"&&(a=n,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):n=a.createElementNS(n,t),n[kr]=e,n[Gl]=r,r_(n,e,!1,!1),e.stateNode=n;e:{switch(a=Jm(t,r),t){case"dialog":mt("cancel",n),mt("close",n),s=r;break;case"iframe":case"object":case"embed":mt("load",n),s=r;break;case"video":case"audio":for(s=0;s<fl.length;s++)mt(fl[s],n);s=r;break;case"source":mt("error",n),s=r;break;case"img":case"image":case"link":mt("error",n),mt("load",n),s=r;break;case"details":mt("toggle",n),s=r;break;case"input":c0(n,r),s=Wm(n,r),mt("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=Nt({},r,{value:void 0}),mt("invalid",n);break;case"textarea":d0(n,r),s=Km(n,r),mt("invalid",n);break;default:s=r}Ym(t,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?Vb(n,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Db(n,c)):i==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&Ol(n,c):typeof c=="number"&&Ol(n,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ll.hasOwnProperty(i)?c!=null&&i==="onScroll"&&mt("scroll",n):c!=null&&xp(n,i,c,a))}switch(t){case"input":au(n),u0(n,r,!1);break;case"textarea":au(n),h0(n);break;case"option":r.value!=null&&n.setAttribute("value",""+ei(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Ba(n,!!r.multiple,i,!1):r.defaultValue!=null&&Ba(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=ud)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Cn(e),null;case 6:if(n&&e.stateNode!=null)i_(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(te(166));if(t=Li(Ql.current),Li(Mr.current),pu(e)){if(r=e.stateNode,t=e.memoizedProps,r[kr]=e,(i=r.nodeValue!==t)&&(n=sr,n!==null))switch(n.tag){case 3:fu(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&fu(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[kr]=e,e.stateNode=r}return Cn(e),null;case 13:if(pt(It),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(wt&&rr!==null&&e.mode&1&&!(e.flags&128))Ew(),no(),e.flags|=98560,i=!1;else if(i=pu(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(te(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(te(317));i[kr]=e}else no(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Cn(e),i=!1}else Er!==null&&(Rf(Er),Er=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||It.current&1?Zt===0&&(Zt=3):tg())),e.updateQueue!==null&&(e.flags|=4),Cn(e),null);case 4:return so(),Tf(n,e),n===null&&Wl(e.stateNode.containerInfo),Cn(e),null;case 10:return Op(e.type._context),Cn(e),null;case 17:return Yn(e.type)&&dd(),Cn(e),null;case 19:if(pt(It),i=e.memoizedState,i===null)return Cn(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)sl(i,!1);else{if(Zt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=vd(n),a!==null){for(e.flags|=128,sl(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,n=a.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return lt(It,It.current&1|2),e.child}n=n.sibling}i.tail!==null&&Vt()>ao&&(e.flags|=128,r=!0,sl(i,!1),e.lanes=4194304)}else{if(!r)if(n=vd(a),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),sl(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!wt)return Cn(e),null}else 2*Vt()-i.renderingStartTime>ao&&t!==1073741824&&(e.flags|=128,r=!0,sl(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(t=i.last,t!==null?t.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Vt(),e.sibling=null,t=It.current,lt(It,r?t&1|2:t&1),e):(Cn(e),null);case 22:case 23:return eg(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?nr&1073741824&&(Cn(e),e.subtreeFlags&6&&(e.flags|=8192)):Cn(e),null;case 24:return null;case 25:return null}throw Error(te(156,e.tag))}function GC(n,e){switch(Dp(e),e.tag){case 1:return Yn(e.type)&&dd(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return so(),pt(Qn),pt(jn),zp(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Bp(e),null;case 13:if(pt(It),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(te(340));no()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return pt(It),null;case 4:return so(),null;case 10:return Op(e.type._context),null;case 22:case 23:return eg(),null;case 24:return null;default:return null}}var vu=!1,kn=!1,KC=typeof WeakSet=="function"?WeakSet:Set,he=null;function Fa(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){jt(n,e,r)}else t.current=null}function If(n,e,t){try{t()}catch(r){jt(n,e,r)}}var tv=!1;function QC(n,e){if(lf=od,n=uw(),Rp(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var a=0,l=-1,c=-1,d=0,h=0,m=n,p=null;t:for(;;){for(var y;m!==t||s!==0&&m.nodeType!==3||(l=a+s),m!==i||r!==0&&m.nodeType!==3||(c=a+r),m.nodeType===3&&(a+=m.nodeValue.length),(y=m.firstChild)!==null;)p=m,m=y;for(;;){if(m===n)break t;if(p===t&&++d===s&&(l=a),p===i&&++h===r&&(c=a),(y=m.nextSibling)!==null)break;m=p,p=m.parentNode}m=y}t=l===-1||c===-1?null:{start:l,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(cf={focusedElem:n,selectionRange:t},od=!1,he=e;he!==null;)if(e=he,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,he=n;else for(;he!==null;){e=he;try{var _=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(_!==null){var T=_.memoizedProps,E=_.memoizedState,x=e.stateNode,v=x.getSnapshotBeforeUpdate(e.elementType===e.type?T:wr(e.type,T),E);x.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(te(163))}}catch(P){jt(e,e.return,P)}if(n=e.sibling,n!==null){n.return=e.return,he=n;break}he=e.return}return _=tv,tv=!1,_}function Cl(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&If(e,t,i)}s=s.next}while(s!==r)}}function ah(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Sf(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function a_(n){var e=n.alternate;e!==null&&(n.alternate=null,a_(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[kr],delete e[Gl],delete e[hf],delete e[PC],delete e[RC])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function o_(n){return n.tag===5||n.tag===3||n.tag===4}function nv(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||o_(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Cf(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=ud));else if(r!==4&&(n=n.child,n!==null))for(Cf(n,e,t),n=n.sibling;n!==null;)Cf(n,e,t),n=n.sibling}function Nf(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Nf(n,e,t),n=n.sibling;n!==null;)Nf(n,e,t),n=n.sibling}var pn=null,_r=!1;function _s(n,e,t){for(t=t.child;t!==null;)l_(n,e,t),t=t.sibling}function l_(n,e,t){if(Dr&&typeof Dr.onCommitFiberUnmount=="function")try{Dr.onCommitFiberUnmount(Xd,t)}catch{}switch(t.tag){case 5:kn||Fa(t,e);case 6:var r=pn,s=_r;pn=null,_s(n,e,t),pn=r,_r=s,pn!==null&&(_r?(n=pn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):pn.removeChild(t.stateNode));break;case 18:pn!==null&&(_r?(n=pn,t=t.stateNode,n.nodeType===8?fm(n.parentNode,t):n.nodeType===1&&fm(n,t),Bl(n)):fm(pn,t.stateNode));break;case 4:r=pn,s=_r,pn=t.stateNode.containerInfo,_r=!0,_s(n,e,t),pn=r,_r=s;break;case 0:case 11:case 14:case 15:if(!kn&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&If(t,e,a),s=s.next}while(s!==r)}_s(n,e,t);break;case 1:if(!kn&&(Fa(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(l){jt(t,e,l)}_s(n,e,t);break;case 21:_s(n,e,t);break;case 22:t.mode&1?(kn=(r=kn)||t.memoizedState!==null,_s(n,e,t),kn=r):_s(n,e,t);break;default:_s(n,e,t)}}function rv(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new KC),e.forEach(function(r){var s=sN.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function br(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 5:pn=l.stateNode,_r=!1;break e;case 3:pn=l.stateNode.containerInfo,_r=!0;break e;case 4:pn=l.stateNode.containerInfo,_r=!0;break e}l=l.return}if(pn===null)throw Error(te(160));l_(i,a,s),pn=null,_r=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){jt(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)c_(e,n),e=e.sibling}function c_(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(br(e,n),Nr(n),r&4){try{Cl(3,n,n.return),ah(3,n)}catch(T){jt(n,n.return,T)}try{Cl(5,n,n.return)}catch(T){jt(n,n.return,T)}}break;case 1:br(e,n),Nr(n),r&512&&t!==null&&Fa(t,t.return);break;case 5:if(br(e,n),Nr(n),r&512&&t!==null&&Fa(t,t.return),n.flags&32){var s=n.stateNode;try{Ol(s,"")}catch(T){jt(n,n.return,T)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,a=t!==null?t.memoizedProps:i,l=n.type,c=n.updateQueue;if(n.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Pb(s,i),Jm(l,a);var d=Jm(l,i);for(a=0;a<c.length;a+=2){var h=c[a],m=c[a+1];h==="style"?Vb(s,m):h==="dangerouslySetInnerHTML"?Db(s,m):h==="children"?Ol(s,m):xp(s,h,m,d)}switch(l){case"input":Hm(s,i);break;case"textarea":Rb(s,i);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?Ba(s,!!i.multiple,y,!1):p!==!!i.multiple&&(i.defaultValue!=null?Ba(s,!!i.multiple,i.defaultValue,!0):Ba(s,!!i.multiple,i.multiple?[]:"",!1))}s[Gl]=i}catch(T){jt(n,n.return,T)}}break;case 6:if(br(e,n),Nr(n),r&4){if(n.stateNode===null)throw Error(te(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(T){jt(n,n.return,T)}}break;case 3:if(br(e,n),Nr(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Bl(e.containerInfo)}catch(T){jt(n,n.return,T)}break;case 4:br(e,n),Nr(n);break;case 13:br(e,n),Nr(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Xp=Vt())),r&4&&rv(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(kn=(d=kn)||h,br(e,n),kn=d):br(e,n),Nr(n),r&8192){if(d=n.memoizedState!==null,(n.stateNode.isHidden=d)&&!h&&n.mode&1)for(he=n,h=n.child;h!==null;){for(m=he=h;he!==null;){switch(p=he,y=p.child,p.tag){case 0:case 11:case 14:case 15:Cl(4,p,p.return);break;case 1:Fa(p,p.return);var _=p.stateNode;if(typeof _.componentWillUnmount=="function"){r=p,t=p.return;try{e=r,_.props=e.memoizedProps,_.state=e.memoizedState,_.componentWillUnmount()}catch(T){jt(r,t,T)}}break;case 5:Fa(p,p.return);break;case 22:if(p.memoizedState!==null){iv(m);continue}}y!==null?(y.return=p,he=y):iv(m)}h=h.sibling}e:for(h=null,m=n;;){if(m.tag===5){if(h===null){h=m;try{s=m.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=m.stateNode,c=m.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=Mb("display",a))}catch(T){jt(n,n.return,T)}}}else if(m.tag===6){if(h===null)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(T){jt(n,n.return,T)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===n)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===n)break e;for(;m.sibling===null;){if(m.return===null||m.return===n)break e;h===m&&(h=null),m=m.return}h===m&&(h=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:br(e,n),Nr(n),r&4&&rv(n);break;case 21:break;default:br(e,n),Nr(n)}}function Nr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(o_(t)){var r=t;break e}t=t.return}throw Error(te(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Ol(s,""),r.flags&=-33);var i=nv(n);Nf(n,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,l=nv(n);Cf(n,l,a);break;default:throw Error(te(161))}}catch(c){jt(n,n.return,c)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function YC(n,e,t){he=n,u_(n)}function u_(n,e,t){for(var r=(n.mode&1)!==0;he!==null;){var s=he,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||vu;if(!a){var l=s.alternate,c=l!==null&&l.memoizedState!==null||kn;l=vu;var d=kn;if(vu=a,(kn=c)&&!d)for(he=s;he!==null;)a=he,c=a.child,a.tag===22&&a.memoizedState!==null?av(s):c!==null?(c.return=a,he=c):av(s);for(;i!==null;)he=i,u_(i),i=i.sibling;he=s,vu=l,kn=d}sv(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,he=i):sv(n)}}function sv(n){for(;he!==null;){var e=he;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:kn||ah(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!kn)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:wr(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&B0(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}B0(e,a,t)}break;case 5:var l=e.stateNode;if(t===null&&e.flags&4){t=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var m=h.dehydrated;m!==null&&Bl(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(te(163))}kn||e.flags&512&&Sf(e)}catch(p){jt(e,e.return,p)}}if(e===n){he=null;break}if(t=e.sibling,t!==null){t.return=e.return,he=t;break}he=e.return}}function iv(n){for(;he!==null;){var e=he;if(e===n){he=null;break}var t=e.sibling;if(t!==null){t.return=e.return,he=t;break}he=e.return}}function av(n){for(;he!==null;){var e=he;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{ah(4,e)}catch(c){jt(e,t,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){jt(e,s,c)}}var i=e.return;try{Sf(e)}catch(c){jt(e,i,c)}break;case 5:var a=e.return;try{Sf(e)}catch(c){jt(e,a,c)}}}catch(c){jt(e,e.return,c)}if(e===n){he=null;break}var l=e.sibling;if(l!==null){l.return=e.return,he=l;break}he=e.return}}var JC=Math.ceil,wd=us.ReactCurrentDispatcher,Yp=us.ReactCurrentOwner,mr=us.ReactCurrentBatchConfig,Ge=0,cn=null,Gt=null,vn=0,nr=0,$a=hi(0),Zt=0,Zl=null,Hi=0,oh=0,Jp=0,Nl=null,qn=null,Xp=0,ao=1/0,qr=null,_d=!1,Af=null,Gs=null,xu=!1,Fs=null,Ed=0,Al=0,kf=null,Fu=-1,$u=0;function On(){return Ge&6?Vt():Fu!==-1?Fu:Fu=Vt()}function Ks(n){return n.mode&1?Ge&2&&vn!==0?vn&-vn:DC.transition!==null?($u===0&&($u=Kb()),$u):(n=nt,n!==0||(n=window.event,n=n===void 0?16:tw(n.type)),n):1}function Ir(n,e,t,r){if(50<Al)throw Al=0,kf=null,Error(te(185));yc(n,t,r),(!(Ge&2)||n!==cn)&&(n===cn&&(!(Ge&2)&&(oh|=t),Zt===4&&As(n,vn)),Jn(n,r),t===1&&Ge===0&&!(e.mode&1)&&(ao=Vt()+500,rh&&mi()))}function Jn(n,e){var t=n.callbackNode;D1(n,e);var r=ad(n,n===cn?vn:0);if(r===0)t!==null&&p0(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&p0(t),e===1)n.tag===0?jC(ov.bind(null,n)):bw(ov.bind(null,n)),AC(function(){!(Ge&6)&&mi()}),t=null;else{switch(Qb(r)){case 1:t=Tp;break;case 4:t=Hb;break;case 16:t=id;break;case 536870912:t=Gb;break;default:t=id}t=v_(t,d_.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function d_(n,e){if(Fu=-1,$u=0,Ge&6)throw Error(te(327));var t=n.callbackNode;if(Ga()&&n.callbackNode!==t)return null;var r=ad(n,n===cn?vn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Td(n,r);else{e=r;var s=Ge;Ge|=2;var i=m_();(cn!==n||vn!==e)&&(qr=null,ao=Vt()+500,Fi(n,e));do try{eN();break}catch(l){h_(n,l)}while(1);Lp(),wd.current=i,Ge=s,Gt!==null?e=0:(cn=null,vn=0,e=Zt)}if(e!==0){if(e===2&&(s=nf(n),s!==0&&(r=s,e=Pf(n,s))),e===1)throw t=Zl,Fi(n,0),As(n,r),Jn(n,Vt()),t;if(e===6)As(n,r);else{if(s=n.current.alternate,!(r&30)&&!XC(s)&&(e=Td(n,r),e===2&&(i=nf(n),i!==0&&(r=i,e=Pf(n,i))),e===1))throw t=Zl,Fi(n,0),As(n,r),Jn(n,Vt()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(te(345));case 2:Ci(n,qn,qr);break;case 3:if(As(n,r),(r&130023424)===r&&(e=Xp+500-Vt(),10<e)){if(ad(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){On(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=df(Ci.bind(null,n,qn,qr),e);break}Ci(n,qn,qr);break;case 4:if(As(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var a=31-Tr(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=Vt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*JC(r/1960))-r,10<r){n.timeoutHandle=df(Ci.bind(null,n,qn,qr),r);break}Ci(n,qn,qr);break;case 5:Ci(n,qn,qr);break;default:throw Error(te(329))}}}return Jn(n,Vt()),n.callbackNode===t?d_.bind(null,n):null}function Pf(n,e){var t=Nl;return n.current.memoizedState.isDehydrated&&(Fi(n,e).flags|=256),n=Td(n,e),n!==2&&(e=qn,qn=t,e!==null&&Rf(e)),n}function Rf(n){qn===null?qn=n:qn.push.apply(qn,n)}function XC(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!Sr(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function As(n,e){for(e&=~Jp,e&=~oh,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Tr(e),r=1<<t;n[t]=-1,e&=~r}}function ov(n){if(Ge&6)throw Error(te(327));Ga();var e=ad(n,0);if(!(e&1))return Jn(n,Vt()),null;var t=Td(n,e);if(n.tag!==0&&t===2){var r=nf(n);r!==0&&(e=r,t=Pf(n,r))}if(t===1)throw t=Zl,Fi(n,0),As(n,e),Jn(n,Vt()),t;if(t===6)throw Error(te(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Ci(n,qn,qr),Jn(n,Vt()),null}function Zp(n,e){var t=Ge;Ge|=1;try{return n(e)}finally{Ge=t,Ge===0&&(ao=Vt()+500,rh&&mi())}}function Gi(n){Fs!==null&&Fs.tag===0&&!(Ge&6)&&Ga();var e=Ge;Ge|=1;var t=mr.transition,r=nt;try{if(mr.transition=null,nt=1,n)return n()}finally{nt=r,mr.transition=t,Ge=e,!(Ge&6)&&mi()}}function eg(){nr=$a.current,pt($a)}function Fi(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,NC(t)),Gt!==null)for(t=Gt.return;t!==null;){var r=t;switch(Dp(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&dd();break;case 3:so(),pt(Qn),pt(jn),zp();break;case 5:Bp(r);break;case 4:so();break;case 13:pt(It);break;case 19:pt(It);break;case 10:Op(r.type._context);break;case 22:case 23:eg()}t=t.return}if(cn=n,Gt=n=Qs(n.current,null),vn=nr=e,Zt=0,Zl=null,Jp=oh=Hi=0,qn=Nl=null,Vi!==null){for(e=0;e<Vi.length;e++)if(t=Vi[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}t.pending=r}Vi=null}return n}function h_(n,e){do{var t=Gt;try{if(Lp(),Vu.current=bd,xd){for(var r=St.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}xd=!1}if(Wi=0,on=Xt=St=null,Sl=!1,Yl=0,Yp.current=null,t===null||t.return===null){Zt=1,Zl=e,Gt=null;break}e:{var i=n,a=t.return,l=t,c=e;if(e=vn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=l,m=h.tag;if(!(h.mode&1)&&(m===0||m===11||m===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=K0(a);if(y!==null){y.flags&=-257,Q0(y,a,l,i,e),y.mode&1&&G0(i,d,e),e=y,c=d;var _=e.updateQueue;if(_===null){var T=new Set;T.add(c),e.updateQueue=T}else _.add(c);break e}else{if(!(e&1)){G0(i,d,e),tg();break e}c=Error(te(426))}}else if(wt&&l.mode&1){var E=K0(a);if(E!==null){!(E.flags&65536)&&(E.flags|=256),Q0(E,a,l,i,e),Mp(io(c,l));break e}}i=c=io(c,l),Zt!==4&&(Zt=2),Nl===null?Nl=[i]:Nl.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var x=Qw(i,c,e);U0(i,x);break e;case 1:l=c;var v=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Gs===null||!Gs.has(S)))){i.flags|=65536,e&=-e,i.lanes|=e;var P=Yw(i,l,e);U0(i,P);break e}}i=i.return}while(i!==null)}p_(t)}catch(M){e=M,Gt===t&&t!==null&&(Gt=t=t.return);continue}break}while(1)}function m_(){var n=wd.current;return wd.current=bd,n===null?bd:n}function tg(){(Zt===0||Zt===3||Zt===2)&&(Zt=4),cn===null||!(Hi&268435455)&&!(oh&268435455)||As(cn,vn)}function Td(n,e){var t=Ge;Ge|=2;var r=m_();(cn!==n||vn!==e)&&(qr=null,Fi(n,e));do try{ZC();break}catch(s){h_(n,s)}while(1);if(Lp(),Ge=t,wd.current=r,Gt!==null)throw Error(te(261));return cn=null,vn=0,Zt}function ZC(){for(;Gt!==null;)f_(Gt)}function eN(){for(;Gt!==null&&!I1();)f_(Gt)}function f_(n){var e=y_(n.alternate,n,nr);n.memoizedProps=n.pendingProps,e===null?p_(n):Gt=e,Yp.current=null}function p_(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=GC(t,e),t!==null){t.flags&=32767,Gt=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Zt=6,Gt=null;return}}else if(t=HC(t,e,nr),t!==null){Gt=t;return}if(e=e.sibling,e!==null){Gt=e;return}Gt=e=n}while(e!==null);Zt===0&&(Zt=5)}function Ci(n,e,t){var r=nt,s=mr.transition;try{mr.transition=null,nt=1,tN(n,e,t,r)}finally{mr.transition=s,nt=r}return null}function tN(n,e,t,r){do Ga();while(Fs!==null);if(Ge&6)throw Error(te(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(te(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(M1(n,i),n===cn&&(Gt=cn=null,vn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||xu||(xu=!0,v_(id,function(){return Ga(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=mr.transition,mr.transition=null;var a=nt;nt=1;var l=Ge;Ge|=4,Yp.current=null,QC(n,t),c_(t,n),wC(cf),od=!!lf,cf=lf=null,n.current=t,YC(t),S1(),Ge=l,nt=a,mr.transition=i}else n.current=t;if(xu&&(xu=!1,Fs=n,Ed=s),i=n.pendingLanes,i===0&&(Gs=null),A1(t.stateNode),Jn(n,Vt()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(_d)throw _d=!1,n=Af,Af=null,n;return Ed&1&&n.tag!==0&&Ga(),i=n.pendingLanes,i&1?n===kf?Al++:(Al=0,kf=n):Al=0,mi(),null}function Ga(){if(Fs!==null){var n=Qb(Ed),e=mr.transition,t=nt;try{if(mr.transition=null,nt=16>n?16:n,Fs===null)var r=!1;else{if(n=Fs,Fs=null,Ed=0,Ge&6)throw Error(te(331));var s=Ge;for(Ge|=4,he=n.current;he!==null;){var i=he,a=i.child;if(he.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(he=d;he!==null;){var h=he;switch(h.tag){case 0:case 11:case 15:Cl(8,h,i)}var m=h.child;if(m!==null)m.return=h,he=m;else for(;he!==null;){h=he;var p=h.sibling,y=h.return;if(a_(h),h===d){he=null;break}if(p!==null){p.return=y,he=p;break}he=y}}}var _=i.alternate;if(_!==null){var T=_.child;if(T!==null){_.child=null;do{var E=T.sibling;T.sibling=null,T=E}while(T!==null)}}he=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,he=a;else e:for(;he!==null;){if(i=he,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Cl(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,he=x;break e}he=i.return}}var v=n.current;for(he=v;he!==null;){a=he;var S=a.child;if(a.subtreeFlags&2064&&S!==null)S.return=a,he=S;else e:for(a=v;he!==null;){if(l=he,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:ah(9,l)}}catch(M){jt(l,l.return,M)}if(l===a){he=null;break e}var P=l.sibling;if(P!==null){P.return=l.return,he=P;break e}he=l.return}}if(Ge=s,mi(),Dr&&typeof Dr.onPostCommitFiberRoot=="function")try{Dr.onPostCommitFiberRoot(Xd,n)}catch{}r=!0}return r}finally{nt=t,mr.transition=e}}return!1}function lv(n,e,t){e=io(t,e),e=Qw(n,e,1),n=Hs(n,e,1),e=On(),n!==null&&(yc(n,1,e),Jn(n,e))}function jt(n,e,t){if(n.tag===3)lv(n,n,t);else for(;e!==null;){if(e.tag===3){lv(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Gs===null||!Gs.has(r))){n=io(t,n),n=Yw(e,n,1),e=Hs(e,n,1),n=On(),e!==null&&(yc(e,1,n),Jn(e,n));break}}e=e.return}}function nN(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=On(),n.pingedLanes|=n.suspendedLanes&t,cn===n&&(vn&t)===t&&(Zt===4||Zt===3&&(vn&130023424)===vn&&500>Vt()-Xp?Fi(n,0):Jp|=t),Jn(n,e)}function g_(n,e){e===0&&(n.mode&1?(e=cu,cu<<=1,!(cu&130023424)&&(cu=4194304)):e=1);var t=On();n=rs(n,e),n!==null&&(yc(n,e,t),Jn(n,t))}function rN(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),g_(n,t)}function sN(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(te(314))}r!==null&&r.delete(e),g_(n,t)}var y_;y_=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Qn.current)Wn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Wn=!1,WC(n,e,t);Wn=!!(n.flags&131072)}else Wn=!1,wt&&e.flags&1048576&&ww(e,fd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Ou(n,e),n=e.pendingProps;var s=to(e,jn.current);Ha(e,t),s=Wp(null,e,r,n,s,t);var i=Hp();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Yn(r)?(i=!0,hd(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,$p(e),s.updater=ih,e.stateNode=s,s._reactInternals=e,vf(e,r,n,t),e=wf(null,e,r,!0,i,t)):(e.tag=0,wt&&i&&jp(e),Ln(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Ou(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=aN(r),n=wr(r,n),s){case 0:e=bf(null,e,r,n,t);break e;case 1:e=X0(null,e,r,n,t);break e;case 11:e=Y0(null,e,r,n,t);break e;case 14:e=J0(null,e,r,wr(r.type,n),t);break e}throw Error(te(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:wr(r,s),bf(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:wr(r,s),X0(n,e,r,s,t);case 3:e:{if(e_(e),n===null)throw Error(te(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Cw(n,e),yd(e,r,null,t);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=io(Error(te(423)),e),e=Z0(n,e,r,t,s);break e}else if(r!==s){s=io(Error(te(424)),e),e=Z0(n,e,r,t,s);break e}else for(rr=Ws(e.stateNode.containerInfo.firstChild),sr=e,wt=!0,Er=null,t=Iw(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(no(),r===s){e=ss(n,e,t);break e}Ln(n,e,r,t)}e=e.child}return e;case 5:return Nw(e),n===null&&pf(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,a=s.children,uf(r,s)?a=null:i!==null&&uf(r,i)&&(e.flags|=32),Zw(n,e),Ln(n,e,a,t),e.child;case 6:return n===null&&pf(e),null;case 13:return t_(n,e,t);case 4:return Up(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=ro(e,null,r,t):Ln(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:wr(r,s),Y0(n,e,r,s,t);case 7:return Ln(n,e,e.pendingProps,t),e.child;case 8:return Ln(n,e,e.pendingProps.children,t),e.child;case 12:return Ln(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,lt(pd,r._currentValue),r._currentValue=a,i!==null)if(Sr(i.value,a)){if(i.children===s.children&&!Qn.current){e=ss(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Zr(-1,t&-t),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}i.lanes|=t,c=i.alternate,c!==null&&(c.lanes|=t),gf(i.return,t,e),l.lanes|=t;break}c=c.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(te(341));a.lanes|=t,l=a.alternate,l!==null&&(l.lanes|=t),gf(a,t,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Ln(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Ha(e,t),s=fr(s),r=r(s),e.flags|=1,Ln(n,e,r,t),e.child;case 14:return r=e.type,s=wr(r,e.pendingProps),s=wr(r.type,s),J0(n,e,r,s,t);case 15:return Jw(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:wr(r,s),Ou(n,e),e.tag=1,Yn(r)?(n=!0,hd(e)):n=!1,Ha(e,t),Kw(e,r,s),vf(e,r,s,t),wf(null,e,r,!0,n,t);case 19:return n_(n,e,t);case 22:return Xw(n,e,t)}throw Error(te(156,e.tag))};function v_(n,e){return Wb(n,e)}function iN(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hr(n,e,t,r){return new iN(n,e,t,r)}function ng(n){return n=n.prototype,!(!n||!n.isReactComponent)}function aN(n){if(typeof n=="function")return ng(n)?1:0;if(n!=null){if(n=n.$$typeof,n===wp)return 11;if(n===_p)return 14}return 2}function Qs(n,e){var t=n.alternate;return t===null?(t=hr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Uu(n,e,t,r,s,i){var a=2;if(r=n,typeof n=="function")ng(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case ka:return $i(t.children,s,i,e);case bp:a=8,s|=8;break;case Um:return n=hr(12,t,e,s|2),n.elementType=Um,n.lanes=i,n;case Bm:return n=hr(13,t,e,s),n.elementType=Bm,n.lanes=i,n;case zm:return n=hr(19,t,e,s),n.elementType=zm,n.lanes=i,n;case Nb:return lh(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Sb:a=10;break e;case Cb:a=9;break e;case wp:a=11;break e;case _p:a=14;break e;case Ss:a=16,r=null;break e}throw Error(te(130,n==null?n:typeof n,""))}return e=hr(a,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function $i(n,e,t,r){return n=hr(7,n,r,e),n.lanes=t,n}function lh(n,e,t,r){return n=hr(22,n,r,e),n.elementType=Nb,n.lanes=t,n.stateNode={isHidden:!1},n}function _m(n,e,t){return n=hr(6,n,null,e),n.lanes=t,n}function Em(n,e,t){return e=hr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function oN(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rm(0),this.expirationTimes=rm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rm(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function rg(n,e,t,r,s,i,a,l,c){return n=new oN(n,e,t,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=hr(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},$p(i),n}function lN(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Aa,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function x_(n){if(!n)return ti;n=n._reactInternals;e:{if(oa(n)!==n||n.tag!==1)throw Error(te(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Yn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(te(171))}if(n.tag===1){var t=n.type;if(Yn(t))return xw(n,t,e)}return e}function b_(n,e,t,r,s,i,a,l,c){return n=rg(t,r,!0,n,s,i,a,l,c),n.context=x_(null),t=n.current,r=On(),s=Ks(t),i=Zr(r,s),i.callback=e??null,Hs(t,i,s),n.current.lanes=s,yc(n,s,r),Jn(n,r),n}function ch(n,e,t,r){var s=e.current,i=On(),a=Ks(s);return t=x_(t),e.context===null?e.context=t:e.pendingContext=t,e=Zr(i,a),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Hs(s,e,a),n!==null&&(Ir(n,s,a,i),Mu(n,s,a)),a}function Id(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function cv(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function sg(n,e){cv(n,e),(n=n.alternate)&&cv(n,e)}function cN(){return null}var w_=typeof reportError=="function"?reportError:function(n){console.error(n)};function ig(n){this._internalRoot=n}uh.prototype.render=ig.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(te(409));ch(n,e,null,null)};uh.prototype.unmount=ig.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Gi(function(){ch(null,n,null,null)}),e[ns]=null}};function uh(n){this._internalRoot=n}uh.prototype.unstable_scheduleHydration=function(n){if(n){var e=Xb();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Ns.length&&e!==0&&e<Ns[t].priority;t++);Ns.splice(t,0,n),t===0&&ew(n)}};function ag(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function dh(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function uv(){}function uN(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=Id(a);i.call(d)}}var a=b_(e,r,n,0,null,!1,!1,"",uv);return n._reactRootContainer=a,n[ns]=a.current,Wl(n.nodeType===8?n.parentNode:n),Gi(),a}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=Id(c);l.call(d)}}var c=rg(n,0,!1,null,null,!1,!1,"",uv);return n._reactRootContainer=c,n[ns]=c.current,Wl(n.nodeType===8?n.parentNode:n),Gi(function(){ch(e,c,t,r)}),c}function hh(n,e,t,r,s){var i=t._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var l=s;s=function(){var c=Id(a);l.call(c)}}ch(e,a,n,s)}else a=uN(t,e,n,s,r);return Id(a)}Yb=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=ml(e.pendingLanes);t!==0&&(Ip(e,t|1),Jn(e,Vt()),!(Ge&6)&&(ao=Vt()+500,mi()))}break;case 13:Gi(function(){var r=rs(n,1);if(r!==null){var s=On();Ir(r,n,1,s)}}),sg(n,1)}};Sp=function(n){if(n.tag===13){var e=rs(n,134217728);if(e!==null){var t=On();Ir(e,n,134217728,t)}sg(n,134217728)}};Jb=function(n){if(n.tag===13){var e=Ks(n),t=rs(n,e);if(t!==null){var r=On();Ir(t,n,e,r)}sg(n,e)}};Xb=function(){return nt};Zb=function(n,e){var t=nt;try{return nt=n,e()}finally{nt=t}};Zm=function(n,e,t){switch(e){case"input":if(Hm(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=nh(r);if(!s)throw Error(te(90));kb(r),Hm(r,s)}}}break;case"textarea":Rb(n,t);break;case"select":e=t.value,e!=null&&Ba(n,!!t.multiple,e,!1)}};Fb=Zp;$b=Gi;var dN={usingClientEntryPoint:!1,Events:[xc,Da,nh,Lb,Ob,Zp]},il={findFiberByHostInstance:Mi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},hN={bundleType:il.bundleType,version:il.version,rendererPackageName:il.rendererPackageName,rendererConfig:il.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:us.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=zb(n),n===null?null:n.stateNode},findFiberByHostInstance:il.findFiberByHostInstance||cN,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bu.isDisabled&&bu.supportsFiber)try{Xd=bu.inject(hN),Dr=bu}catch{}}or.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dN;or.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ag(e))throw Error(te(200));return lN(n,e,null,t)};or.createRoot=function(n,e){if(!ag(n))throw Error(te(299));var t=!1,r="",s=w_;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=rg(n,1,!1,null,null,t,!1,r,s),n[ns]=e.current,Wl(n.nodeType===8?n.parentNode:n),new ig(e)};or.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(te(188)):(n=Object.keys(n).join(","),Error(te(268,n)));return n=zb(e),n=n===null?null:n.stateNode,n};or.flushSync=function(n){return Gi(n)};or.hydrate=function(n,e,t){if(!dh(e))throw Error(te(200));return hh(null,n,e,!0,t)};or.hydrateRoot=function(n,e,t){if(!ag(n))throw Error(te(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",a=w_;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=b_(e,null,n,1,t??null,s,!1,i,a),n[ns]=e.current,Wl(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new uh(e)};or.render=function(n,e,t){if(!dh(e))throw Error(te(200));return hh(null,n,e,!1,t)};or.unmountComponentAtNode=function(n){if(!dh(n))throw Error(te(40));return n._reactRootContainer?(Gi(function(){hh(null,null,n,!1,function(){n._reactRootContainer=null,n[ns]=null})}),!0):!1};or.unstable_batchedUpdates=Zp;or.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!dh(t))throw Error(te(200));if(n==null||n._reactInternals===void 0)throw Error(te(38));return hh(n,e,t,!1,r)};or.version="18.3.1-next-f1338f8080-20240426";function __(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(__)}catch(n){console.error(n)}}__(),_b.exports=or;var mN=_b.exports,dv=mN;Fm.createRoot=dv.createRoot,Fm.hydrateRoot=dv.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ec(){return ec=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ec.apply(this,arguments)}var $s;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})($s||($s={}));const hv="popstate";function fN(n){n===void 0&&(n={});function e(r,s){let{pathname:i,search:a,hash:l}=r.location;return jf("",{pathname:i,search:a,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:Sd(s)}return gN(e,t,null,n)}function Ot(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function E_(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function pN(){return Math.random().toString(36).substr(2,8)}function mv(n,e){return{usr:n.state,key:n.key,idx:e}}function jf(n,e,t,r){return t===void 0&&(t=null),ec({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?No(e):e,{state:t,key:e&&e.key||r||pN()})}function Sd(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function No(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function gN(n,e,t,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,l=$s.Pop,c=null,d=h();d==null&&(d=0,a.replaceState(ec({},a.state,{idx:d}),""));function h(){return(a.state||{idx:null}).idx}function m(){l=$s.Pop;let E=h(),x=E==null?null:E-d;d=E,c&&c({action:l,location:T.location,delta:x})}function p(E,x){l=$s.Push;let v=jf(T.location,E,x);t&&t(v,E),d=h()+1;let S=mv(v,d),P=T.createHref(v);try{a.pushState(S,"",P)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;s.location.assign(P)}i&&c&&c({action:l,location:T.location,delta:1})}function y(E,x){l=$s.Replace;let v=jf(T.location,E,x);t&&t(v,E),d=h();let S=mv(v,d),P=T.createHref(v);a.replaceState(S,"",P),i&&c&&c({action:l,location:T.location,delta:0})}function _(E){let x=s.location.origin!=="null"?s.location.origin:s.location.href,v=typeof E=="string"?E:Sd(E);return v=v.replace(/ $/,"%20"),Ot(x,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,x)}let T={get action(){return l},get location(){return n(s,a)},listen(E){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(hv,m),c=E,()=>{s.removeEventListener(hv,m),c=null}},createHref(E){return e(s,E)},createURL:_,encodeLocation(E){let x=_(E);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:p,replace:y,go(E){return a.go(E)}};return T}var fv;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(fv||(fv={}));function yN(n,e,t){return t===void 0&&(t="/"),vN(n,e,t,!1)}function vN(n,e,t,r){let s=typeof e=="string"?No(e):e,i=og(s.pathname||"/",t);if(i==null)return null;let a=T_(n);xN(a);let l=null;for(let c=0;l==null&&c<a.length;++c){let d=kN(i);l=NN(a[c],d,r)}return l}function T_(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let s=(i,a,l)=>{let c={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};c.relativePath.startsWith("/")&&(Ot(c.relativePath.startsWith(r),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(r.length));let d=Ys([r,c.relativePath]),h=t.concat(c);i.children&&i.children.length>0&&(Ot(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),T_(i.children,e,h,d)),!(i.path==null&&!i.index)&&e.push({path:d,score:SN(d,i.index),routesMeta:h})};return n.forEach((i,a)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))s(i,a);else for(let c of I_(i.path))s(i,a,c)}),e}function I_(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let a=I_(r.join("/")),l=[];return l.push(...a.map(c=>c===""?i:[i,c].join("/"))),s&&l.push(...a),l.map(c=>n.startsWith("/")&&c===""?"/":c)}function xN(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:CN(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const bN=/^:[\w-]+$/,wN=3,_N=2,EN=1,TN=10,IN=-2,pv=n=>n==="*";function SN(n,e){let t=n.split("/"),r=t.length;return t.some(pv)&&(r+=IN),e&&(r+=_N),t.filter(s=>!pv(s)).reduce((s,i)=>s+(bN.test(i)?wN:i===""?EN:TN),r)}function CN(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function NN(n,e,t){t===void 0&&(t=!1);let{routesMeta:r}=n,s={},i="/",a=[];for(let l=0;l<r.length;++l){let c=r[l],d=l===r.length-1,h=i==="/"?e:e.slice(i.length)||"/",m=gv({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},h),p=c.route;if(!m&&d&&t&&!r[r.length-1].route.index&&(m=gv({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},h)),!m)return null;Object.assign(s,m.params),a.push({params:s,pathname:Ys([i,m.pathname]),pathnameBase:DN(Ys([i,m.pathnameBase])),route:p}),m.pathnameBase!=="/"&&(i=Ys([i,m.pathnameBase]))}return a}function gv(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=AN(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,h,m)=>{let{paramName:p,isOptional:y}=h;if(p==="*"){let T=l[m]||"";a=i.slice(0,i.length-T.length).replace(/(.)\/+$/,"$1")}const _=l[m];return y&&!_?d[p]=void 0:d[p]=(_||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:a,pattern:n}}function AN(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),E_(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function kN(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return E_(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function og(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function PN(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?No(n):n;return{pathname:t?t.startsWith("/")?t:RN(t,e):e,search:MN(r),hash:VN(s)}}function RN(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function Tm(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function jN(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function lg(n,e){let t=jN(n);return e?t.map((r,s)=>s===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function cg(n,e,t,r){r===void 0&&(r=!1);let s;typeof n=="string"?s=No(n):(s=ec({},n),Ot(!s.pathname||!s.pathname.includes("?"),Tm("?","pathname","search",s)),Ot(!s.pathname||!s.pathname.includes("#"),Tm("#","pathname","hash",s)),Ot(!s.search||!s.search.includes("#"),Tm("#","search","hash",s)));let i=n===""||s.pathname==="",a=i?"/":s.pathname,l;if(a==null)l=t;else{let m=e.length-1;if(!r&&a.startsWith("..")){let p=a.split("/");for(;p[0]==="..";)p.shift(),m-=1;s.pathname=p.join("/")}l=m>=0?e[m]:"/"}let c=PN(s,l),d=a&&a!=="/"&&a.endsWith("/"),h=(i||a===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(d||h)&&(c.pathname+="/"),c}const Ys=n=>n.join("/").replace(/\/\/+/g,"/"),DN=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),MN=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,VN=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function LN(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const S_=["post","put","patch","delete"];new Set(S_);const ON=["get",...S_];new Set(ON);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tc(){return tc=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},tc.apply(this,arguments)}const ug=A.createContext(null),FN=A.createContext(null),fi=A.createContext(null),mh=A.createContext(null),ds=A.createContext({outlet:null,matches:[],isDataRoute:!1}),C_=A.createContext(null);function $N(n,e){let{relative:t}=e===void 0?{}:e;Ao()||Ot(!1);let{basename:r,navigator:s}=A.useContext(fi),{hash:i,pathname:a,search:l}=A_(n,{relative:t}),c=a;return r!=="/"&&(c=a==="/"?r:Ys([r,a])),s.createHref({pathname:c,search:l,hash:i})}function Ao(){return A.useContext(mh)!=null}function hs(){return Ao()||Ot(!1),A.useContext(mh).location}function N_(n){A.useContext(fi).static||A.useLayoutEffect(n)}function yr(){let{isDataRoute:n}=A.useContext(ds);return n?ZN():UN()}function UN(){Ao()||Ot(!1);let n=A.useContext(ug),{basename:e,future:t,navigator:r}=A.useContext(fi),{matches:s}=A.useContext(ds),{pathname:i}=hs(),a=JSON.stringify(lg(s,t.v7_relativeSplatPath)),l=A.useRef(!1);return N_(()=>{l.current=!0}),A.useCallback(function(d,h){if(h===void 0&&(h={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let m=cg(d,JSON.parse(a),i,h.relative==="path");n==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:Ys([e,m.pathname])),(h.replace?r.replace:r.push)(m,h.state,h)},[e,r,a,i,n])}function wc(){let{matches:n}=A.useContext(ds),e=n[n.length-1];return e?e.params:{}}function A_(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=A.useContext(fi),{matches:s}=A.useContext(ds),{pathname:i}=hs(),a=JSON.stringify(lg(s,r.v7_relativeSplatPath));return A.useMemo(()=>cg(n,JSON.parse(a),i,t==="path"),[n,a,i,t])}function BN(n,e){return zN(n,e)}function zN(n,e,t,r){Ao()||Ot(!1);let{navigator:s}=A.useContext(fi),{matches:i}=A.useContext(ds),a=i[i.length-1],l=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let d=hs(),h;if(e){var m;let E=typeof e=="string"?No(e):e;c==="/"||(m=E.pathname)!=null&&m.startsWith(c)||Ot(!1),h=E}else h=d;let p=h.pathname||"/",y=p;if(c!=="/"){let E=c.replace(/^\//,"").split("/");y="/"+p.replace(/^\//,"").split("/").slice(E.length).join("/")}let _=yN(n,{pathname:y}),T=KN(_&&_.map(E=>Object.assign({},E,{params:Object.assign({},l,E.params),pathname:Ys([c,s.encodeLocation?s.encodeLocation(E.pathname).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?c:Ys([c,s.encodeLocation?s.encodeLocation(E.pathnameBase).pathname:E.pathnameBase])})),i,t,r);return e&&T?A.createElement(mh.Provider,{value:{location:tc({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:$s.Pop}},T):T}function qN(){let n=XN(),e=LN(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return A.createElement(A.Fragment,null,A.createElement("h2",null,"Unexpected Application Error!"),A.createElement("h3",{style:{fontStyle:"italic"}},e),t?A.createElement("pre",{style:s},t):null,i)}const WN=A.createElement(qN,null);class HN extends A.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?A.createElement(ds.Provider,{value:this.props.routeContext},A.createElement(C_.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function GN(n){let{routeContext:e,match:t,children:r}=n,s=A.useContext(ug);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),A.createElement(ds.Provider,{value:e},r)}function KN(n,e,t,r){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var i;if(!t)return null;if(t.errors)n=t.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let a=n,l=(s=t)==null?void 0:s.errors;if(l!=null){let h=a.findIndex(m=>m.route.id&&(l==null?void 0:l[m.route.id])!==void 0);h>=0||Ot(!1),a=a.slice(0,Math.min(a.length,h+1))}let c=!1,d=-1;if(t&&r&&r.v7_partialHydration)for(let h=0;h<a.length;h++){let m=a[h];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(d=h),m.route.id){let{loaderData:p,errors:y}=t,_=m.route.loader&&p[m.route.id]===void 0&&(!y||y[m.route.id]===void 0);if(m.route.lazy||_){c=!0,d>=0?a=a.slice(0,d+1):a=[a[0]];break}}}return a.reduceRight((h,m,p)=>{let y,_=!1,T=null,E=null;t&&(y=l&&m.route.id?l[m.route.id]:void 0,T=m.route.errorElement||WN,c&&(d<0&&p===0?(eA("route-fallback",!1),_=!0,E=null):d===p&&(_=!0,E=m.route.hydrateFallbackElement||null)));let x=e.concat(a.slice(0,p+1)),v=()=>{let S;return y?S=T:_?S=E:m.route.Component?S=A.createElement(m.route.Component,null):m.route.element?S=m.route.element:S=h,A.createElement(GN,{match:m,routeContext:{outlet:h,matches:x,isDataRoute:t!=null},children:S})};return t&&(m.route.ErrorBoundary||m.route.errorElement||p===0)?A.createElement(HN,{location:t.location,revalidation:t.revalidation,component:T,error:y,children:v(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):v()},null)}var k_=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(k_||{}),Cd=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(Cd||{});function QN(n){let e=A.useContext(ug);return e||Ot(!1),e}function YN(n){let e=A.useContext(FN);return e||Ot(!1),e}function JN(n){let e=A.useContext(ds);return e||Ot(!1),e}function P_(n){let e=JN(),t=e.matches[e.matches.length-1];return t.route.id||Ot(!1),t.route.id}function XN(){var n;let e=A.useContext(C_),t=YN(Cd.UseRouteError),r=P_(Cd.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function ZN(){let{router:n}=QN(k_.UseNavigateStable),e=P_(Cd.UseNavigateStable),t=A.useRef(!1);return N_(()=>{t.current=!0}),A.useCallback(function(s,i){i===void 0&&(i={}),t.current&&(typeof s=="number"?n.navigate(s):n.navigate(s,tc({fromRouteId:e},i)))},[n,e])}const yv={};function eA(n,e,t){!e&&!yv[n]&&(yv[n]=!0)}function tA(n,e){n==null||n.v7_startTransition,(n==null?void 0:n.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function R_(n){let{to:e,replace:t,state:r,relative:s}=n;Ao()||Ot(!1);let{future:i,static:a}=A.useContext(fi),{matches:l}=A.useContext(ds),{pathname:c}=hs(),d=yr(),h=cg(e,lg(l,i.v7_relativeSplatPath),c,s==="path"),m=JSON.stringify(h);return A.useEffect(()=>d(JSON.parse(m),{replace:t,state:r,relative:s}),[d,m,s,t,r]),null}function cr(n){Ot(!1)}function nA(n){let{basename:e="/",children:t=null,location:r,navigationType:s=$s.Pop,navigator:i,static:a=!1,future:l}=n;Ao()&&Ot(!1);let c=e.replace(/^\/*/,"/"),d=A.useMemo(()=>({basename:c,navigator:i,static:a,future:tc({v7_relativeSplatPath:!1},l)}),[c,l,i,a]);typeof r=="string"&&(r=No(r));let{pathname:h="/",search:m="",hash:p="",state:y=null,key:_="default"}=r,T=A.useMemo(()=>{let E=og(h,c);return E==null?null:{location:{pathname:E,search:m,hash:p,state:y,key:_},navigationType:s}},[c,h,m,p,y,_,s]);return T==null?null:A.createElement(fi.Provider,{value:d},A.createElement(mh.Provider,{children:t,value:T}))}function rA(n){let{children:e,location:t}=n;return BN(Df(e),t)}new Promise(()=>{});function Df(n,e){e===void 0&&(e=[]);let t=[];return A.Children.forEach(n,(r,s)=>{if(!A.isValidElement(r))return;let i=[...e,s];if(r.type===A.Fragment){t.push.apply(t,Df(r.props.children,i));return}r.type!==cr&&Ot(!1),!r.props.index||!r.props.children||Ot(!1);let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Df(r.props.children,i)),t.push(a)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Mf(){return Mf=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Mf.apply(this,arguments)}function sA(n,e){if(n==null)return{};var t={},r=Object.keys(n),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function iA(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function aA(n,e){return n.button===0&&(!e||e==="_self")&&!iA(n)}const oA=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],lA="6";try{window.__reactRouterVersion=lA}catch{}const cA="startTransition",vv=n1[cA];function uA(n){let{basename:e,children:t,future:r,window:s}=n,i=A.useRef();i.current==null&&(i.current=fN({window:s,v5Compat:!0}));let a=i.current,[l,c]=A.useState({action:a.action,location:a.location}),{v7_startTransition:d}=r||{},h=A.useCallback(m=>{d&&vv?vv(()=>c(m)):c(m)},[c,d]);return A.useLayoutEffect(()=>a.listen(h),[a,h]),A.useEffect(()=>tA(r),[r]),A.createElement(nA,{basename:e,children:t,location:l.location,navigationType:l.action,navigator:a,future:r})}const dA=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",hA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ks=A.forwardRef(function(e,t){let{onClick:r,relative:s,reloadDocument:i,replace:a,state:l,target:c,to:d,preventScrollReset:h,viewTransition:m}=e,p=sA(e,oA),{basename:y}=A.useContext(fi),_,T=!1;if(typeof d=="string"&&hA.test(d)&&(_=d,dA))try{let S=new URL(window.location.href),P=d.startsWith("//")?new URL(S.protocol+d):new URL(d),M=og(P.pathname,y);P.origin===S.origin&&M!=null?d=M+P.search+P.hash:T=!0}catch{}let E=$N(d,{relative:s}),x=mA(d,{replace:a,state:l,target:c,preventScrollReset:h,relative:s,viewTransition:m});function v(S){r&&r(S),S.defaultPrevented||x(S)}return A.createElement("a",Mf({},p,{href:_||E,onClick:T||i?r:v,ref:t,target:c}))});var xv;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(xv||(xv={}));var bv;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(bv||(bv={}));function mA(n,e){let{target:t,replace:r,state:s,preventScrollReset:i,relative:a,viewTransition:l}=e===void 0?{}:e,c=yr(),d=hs(),h=A_(n,{relative:a});return A.useCallback(m=>{if(aA(m,t)){m.preventDefault();let p=r!==void 0?r:Sd(d)===Sd(h);c(n,{replace:p,state:s,preventScrollReset:i,relative:a,viewTransition:l})}},[d,c,h,r,s,t,n,i,a,l])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j_=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},fA=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],l=n[t++],c=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},D_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,l=a?n[s+1]:0,c=s+2<n.length,d=c?n[s+2]:0,h=i>>2,m=(i&3)<<4|l>>4;let p=(l&15)<<2|d>>6,y=d&63;c||(y=64,a||(p=64)),r.push(t[h],t[m],t[p],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(j_(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):fA(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const m=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||l==null||d==null||m==null)throw new pA;const p=i<<2|l>>4;if(r.push(p),d!==64){const y=l<<4&240|d>>2;if(r.push(y),m!==64){const _=d<<6&192|m;r.push(_)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class pA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const gA=function(n){const e=j_(n);return D_.encodeByteArray(e,!0)},Nd=function(n){return gA(n).replace(/\./g,"")},M_=function(n){try{return D_.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vA=()=>yA().__FIREBASE_DEFAULTS__,xA=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},bA=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&M_(n[1]);return e&&JSON.parse(e)},fh=()=>{try{return vA()||xA()||bA()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},V_=n=>{var e,t;return(t=(e=fh())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},wA=n=>{const e=V_(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},L_=()=>{var n;return(n=fh())===null||n===void 0?void 0:n.config},O_=n=>{var e;return(e=fh())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _A{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EA(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),l="";return[Nd(JSON.stringify(t)),Nd(JSON.stringify(a)),l].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function en(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function TA(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(en())}function IA(){var n;const e=(n=fh())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function SA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function CA(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function NA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function AA(){const n=en();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function F_(){return!IA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function $_(){try{return typeof indexedDB=="object"}catch{return!1}}function kA(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PA="FirebaseError";class ms extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=PA,Object.setPrototypeOf(this,ms.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_c.prototype.create)}}class _c{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?RA(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new ms(s,l,r)}}function RA(n,e){return n.replace(jA,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const jA=/\{\$([^}]+)}/g;function DA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ni(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(wv(i)&&wv(a)){if(!ni(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function wv(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ec(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function pl(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function gl(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function MA(n,e){const t=new VA(n,e);return t.subscribe.bind(t)}class VA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");LA(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Im),s.error===void 0&&(s.error=Im),s.complete===void 0&&(s.complete=Im);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function LA(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Im(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function it(n){return n&&n._delegate?n._delegate:n}class Ki{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ni="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new _A;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if($A(e))try{this.getOrInitializeService({instanceIdentifier:Ni})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Ni){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ni){return this.instances.has(e)}getOptions(e=Ni){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const a=this.instances.get(s);return a&&e(a,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:FA(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ni){return this.component?this.component.multipleInstances?e:Ni:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function FA(n){return n===Ni?void 0:n}function $A(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new OA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $e;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})($e||($e={}));const BA={debug:$e.DEBUG,verbose:$e.VERBOSE,info:$e.INFO,warn:$e.WARN,error:$e.ERROR,silent:$e.SILENT},zA=$e.INFO,qA={[$e.DEBUG]:"log",[$e.VERBOSE]:"log",[$e.INFO]:"info",[$e.WARN]:"warn",[$e.ERROR]:"error"},WA=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=qA[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class dg{constructor(e){this.name=e,this._logLevel=zA,this._logHandler=WA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in $e))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?BA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,$e.DEBUG,...e),this._logHandler(this,$e.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,$e.VERBOSE,...e),this._logHandler(this,$e.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,$e.INFO,...e),this._logHandler(this,$e.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,$e.WARN,...e),this._logHandler(this,$e.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,$e.ERROR,...e),this._logHandler(this,$e.ERROR,...e)}}const HA=(n,e)=>e.some(t=>n instanceof t);let _v,Ev;function GA(){return _v||(_v=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function KA(){return Ev||(Ev=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const U_=new WeakMap,Vf=new WeakMap,B_=new WeakMap,Sm=new WeakMap,hg=new WeakMap;function QA(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(Js(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&U_.set(t,n)}).catch(()=>{}),hg.set(e,n),e}function YA(n){if(Vf.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});Vf.set(n,e)}let Lf={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Vf.get(n);if(e==="objectStoreNames")return n.objectStoreNames||B_.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Js(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function JA(n){Lf=n(Lf)}function XA(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Cm(this),e,...t);return B_.set(r,e.sort?e.sort():[e]),Js(r)}:KA().includes(n)?function(...e){return n.apply(Cm(this),e),Js(U_.get(this))}:function(...e){return Js(n.apply(Cm(this),e))}}function ZA(n){return typeof n=="function"?XA(n):(n instanceof IDBTransaction&&YA(n),HA(n,GA())?new Proxy(n,Lf):n)}function Js(n){if(n instanceof IDBRequest)return QA(n);if(Sm.has(n))return Sm.get(n);const e=ZA(n);return e!==n&&(Sm.set(n,e),hg.set(e,n)),e}const Cm=n=>hg.get(n);function ek(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),l=Js(a);return r&&a.addEventListener("upgradeneeded",c=>{r(Js(a.result),c.oldVersion,c.newVersion,Js(a.transaction),c)}),t&&a.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const tk=["get","getKey","getAll","getAllKeys","count"],nk=["put","add","delete","clear"],Nm=new Map;function Tv(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Nm.get(e))return Nm.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=nk.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||tk.includes(t)))return;const i=async function(a,...l){const c=this.transaction(a,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),s&&c.done]))[0]};return Nm.set(e,i),i}JA(n=>({...n,get:(e,t,r)=>Tv(e,t)||n.get(e,t,r),has:(e,t)=>!!Tv(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(sk(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function sk(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Of="@firebase/app",Iv="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const is=new dg("@firebase/app"),ik="@firebase/app-compat",ak="@firebase/analytics-compat",ok="@firebase/analytics",lk="@firebase/app-check-compat",ck="@firebase/app-check",uk="@firebase/auth",dk="@firebase/auth-compat",hk="@firebase/database",mk="@firebase/data-connect",fk="@firebase/database-compat",pk="@firebase/functions",gk="@firebase/functions-compat",yk="@firebase/installations",vk="@firebase/installations-compat",xk="@firebase/messaging",bk="@firebase/messaging-compat",wk="@firebase/performance",_k="@firebase/performance-compat",Ek="@firebase/remote-config",Tk="@firebase/remote-config-compat",Ik="@firebase/storage",Sk="@firebase/storage-compat",Ck="@firebase/firestore",Nk="@firebase/vertexai-preview",Ak="@firebase/firestore-compat",kk="firebase",Pk="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ad="[DEFAULT]",Rk={[Of]:"fire-core",[ik]:"fire-core-compat",[ok]:"fire-analytics",[ak]:"fire-analytics-compat",[ck]:"fire-app-check",[lk]:"fire-app-check-compat",[uk]:"fire-auth",[dk]:"fire-auth-compat",[hk]:"fire-rtdb",[mk]:"fire-data-connect",[fk]:"fire-rtdb-compat",[pk]:"fire-fn",[gk]:"fire-fn-compat",[yk]:"fire-iid",[vk]:"fire-iid-compat",[xk]:"fire-fcm",[bk]:"fire-fcm-compat",[wk]:"fire-perf",[_k]:"fire-perf-compat",[Ek]:"fire-rc",[Tk]:"fire-rc-compat",[Ik]:"fire-gcs",[Sk]:"fire-gcs-compat",[Ck]:"fire-fst",[Ak]:"fire-fst-compat",[Nk]:"fire-vertex","fire-js":"fire-js",[kk]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kd=new Map,jk=new Map,Ff=new Map;function Sv(n,e){try{n.container.addComponent(e)}catch(t){is.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function oo(n){const e=n.name;if(Ff.has(e))return is.debug(`There were multiple attempts to register component ${e}.`),!1;Ff.set(e,n);for(const t of kd.values())Sv(t,n);for(const t of jk.values())Sv(t,n);return!0}function Tc(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Dk(n,e,t=Ad){Tc(n,e).clearInstance(t)}function Pr(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Xs=new _c("app","Firebase",Mk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vk{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ki("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Xs.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ko=Pk;function z_(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Ad,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Xs.create("bad-app-name",{appName:String(s)});if(t||(t=L_()),!t)throw Xs.create("no-options");const i=kd.get(s);if(i){if(ni(t,i.options)&&ni(r,i.config))return i;throw Xs.create("duplicate-app",{appName:s})}const a=new UA(s);for(const c of Ff.values())a.addComponent(c);const l=new Vk(t,r,a);return kd.set(s,l),l}function q_(n=Ad){const e=kd.get(n);if(!e&&n===Ad&&L_())return z_();if(!e)throw Xs.create("no-app",{appName:n});return e}function Zs(n,e,t){var r;let s=(r=Rk[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const l=[`Unable to register library "${s}" with version "${e}":`];i&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),is.warn(l.join(" "));return}oo(new Ki(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lk="firebase-heartbeat-database",Ok=1,nc="firebase-heartbeat-store";let Am=null;function W_(){return Am||(Am=ek(Lk,Ok,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(nc)}catch(t){console.warn(t)}}}}).catch(n=>{throw Xs.create("idb-open",{originalErrorMessage:n.message})})),Am}async function Fk(n){try{const t=(await W_()).transaction(nc),r=await t.objectStore(nc).get(H_(n));return await t.done,r}catch(e){if(e instanceof ms)is.warn(e.message);else{const t=Xs.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});is.warn(t.message)}}}async function Cv(n,e){try{const r=(await W_()).transaction(nc,"readwrite");await r.objectStore(nc).put(e,H_(n)),await r.done}catch(t){if(t instanceof ms)is.warn(t.message);else{const r=Xs.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});is.warn(r.message)}}}function H_(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $k=1024,Uk=30*24*60*60*1e3;class Bk{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new qk(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Nv();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const l=new Date(a.date).valueOf();return Date.now()-l<=Uk}),this._storage.overwrite(this._heartbeatsCache))}catch(r){is.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Nv(),{heartbeatsToSend:r,unsentEntries:s}=zk(this._heartbeatsCache.heartbeats),i=Nd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return is.warn(t),""}}}function Nv(){return new Date().toISOString().substring(0,10)}function zk(n,e=$k){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Av(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Av(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class qk{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return $_()?kA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Fk(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Cv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Cv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Av(n){return Nd(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wk(n){oo(new Ki("platform-logger",e=>new rk(e),"PRIVATE")),oo(new Ki("heartbeat",e=>new Bk(e),"PRIVATE")),Zs(Of,Iv,n),Zs(Of,Iv,"esm2017"),Zs("fire-js","")}Wk("");function mg(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function G_(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Hk=G_,K_=new _c("auth","Firebase",G_());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pd=new dg("@firebase/auth");function Gk(n,...e){Pd.logLevel<=$e.WARN&&Pd.warn(`Auth (${ko}): ${n}`,...e)}function Bu(n,...e){Pd.logLevel<=$e.ERROR&&Pd.error(`Auth (${ko}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cr(n,...e){throw fg(n,...e)}function Vr(n,...e){return fg(n,...e)}function Q_(n,e,t){const r=Object.assign(Object.assign({},Hk()),{[e]:t});return new _c("auth","Firebase",r).create(e,{appName:n.name})}function es(n){return Q_(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function fg(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return K_.create(n,...e)}function we(n,e,...t){if(!n)throw fg(e,...t)}function Qr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Bu(e),new Error(e)}function as(n,e){n||Qr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $f(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Kk(){return kv()==="http:"||kv()==="https:"}function kv(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qk(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Kk()||CA()||"connection"in navigator)?navigator.onLine:!0}function Yk(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(e,t){this.shortDelay=e,this.longDelay=t,as(t>e,"Short delay should be less than long delay!"),this.isMobile=TA()||NA()}get(){return Qk()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pg(n,e){as(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y_{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Qr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Qr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Qr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xk=new Ic(3e4,6e4);function fs(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function ps(n,e,t,r,s={}){return J_(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=Ec(Object.assign({key:n.config.apiKey},a)).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const d=Object.assign({method:e,headers:c},i);return SA()||(d.referrerPolicy="no-referrer"),Y_.fetch()(X_(n,n.config.apiHost,t,l),d)})}async function J_(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},Jk),e);try{const s=new eP(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw wu(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw wu(n,"credential-already-in-use",a);if(c==="EMAIL_EXISTS")throw wu(n,"email-already-in-use",a);if(c==="USER_DISABLED")throw wu(n,"user-disabled",a);const h=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Q_(n,h,d);Cr(n,h)}}catch(s){if(s instanceof ms)throw s;Cr(n,"network-request-failed",{message:String(s)})}}async function Sc(n,e,t,r,s={}){const i=await ps(n,e,t,r,s);return"mfaPendingCredential"in i&&Cr(n,"multi-factor-auth-required",{_serverResponse:i}),i}function X_(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?pg(n.config,s):`${n.config.apiScheme}://${s}`}function Zk(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class eP{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Vr(this.auth,"network-request-failed")),Xk.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function wu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Vr(n,e,r);return s.customData._tokenResponse=t,s}function Pv(n){return n!==void 0&&n.enterprise!==void 0}class tP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Zk(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function nP(n,e){return ps(n,"GET","/v2/recaptchaConfig",fs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rP(n,e){return ps(n,"POST","/v1/accounts:delete",e)}async function Z_(n,e){return ps(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kl(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function sP(n,e=!1){const t=it(n),r=await t.getIdToken(e),s=gg(r);we(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:kl(km(s.auth_time)),issuedAtTime:kl(km(s.iat)),expirationTime:kl(km(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function km(n){return Number(n)*1e3}function gg(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Bu("JWT malformed, contained fewer than 3 sections"),null;try{const s=M_(t);return s?JSON.parse(s):(Bu("Failed to decode base64 JWT payload"),null)}catch(s){return Bu("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Rv(n){const e=gg(n);return we(e,"internal-error"),we(typeof e.exp<"u","internal-error"),we(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rc(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ms&&iP(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function iP({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aP{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=kl(this.lastLoginAt),this.creationTime=kl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rd(n){var e;const t=n.auth,r=await n.getIdToken(),s=await rc(n,Z_(t,{idToken:r}));we(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const a=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?eE(i.providerUserInfo):[],l=lP(n.providerData,a),c=n.isAnonymous,d=!(n.email&&i.passwordHash)&&!(l!=null&&l.length),h=c?d:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new Uf(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,m)}async function oP(n){const e=it(n);await Rd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function lP(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function eE(n){return n.map(e=>{var{providerId:t}=e,r=mg(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cP(n,e){const t=await J_(n,{},async()=>{const r=Ec({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=X_(n,s,"/v1/token",`key=${i}`),l=await n._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",Y_.fetch()(a,{method:"POST",headers:l,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function uP(n,e){return ps(n,"POST","/v2/accounts:revokeToken",fs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ka{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){we(e.idToken,"internal-error"),we(typeof e.idToken<"u","internal-error"),we(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Rv(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){we(e.length!==0,"internal-error");const t=Rv(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(we(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await cP(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new Ka;return r&&(we(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(we(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(we(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ka,this.toJSON())}_performRefresh(){return Qr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Es(n,e){we(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Yr{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=mg(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new aP(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Uf(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await rc(this,this.stsTokenManager.getToken(this.auth,e));return we(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return sP(this,e)}reload(){return oP(this)}_assign(e){this!==e&&(we(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Yr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){we(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Rd(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Pr(this.auth.app))return Promise.reject(es(this.auth));const e=await this.getIdToken();return await rc(this,rP(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,a,l,c,d,h;const m=(r=t.displayName)!==null&&r!==void 0?r:void 0,p=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,_=(a=t.photoURL)!==null&&a!==void 0?a:void 0,T=(l=t.tenantId)!==null&&l!==void 0?l:void 0,E=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,x=(d=t.createdAt)!==null&&d!==void 0?d:void 0,v=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:S,emailVerified:P,isAnonymous:M,providerData:$,stsTokenManager:I}=t;we(S&&I,e,"internal-error");const b=Ka.fromJSON(this.name,I);we(typeof S=="string",e,"internal-error"),Es(m,e.name),Es(p,e.name),we(typeof P=="boolean",e,"internal-error"),we(typeof M=="boolean",e,"internal-error"),Es(y,e.name),Es(_,e.name),Es(T,e.name),Es(E,e.name),Es(x,e.name),Es(v,e.name);const C=new Yr({uid:S,auth:e,email:p,emailVerified:P,displayName:m,isAnonymous:M,photoURL:_,phoneNumber:y,tenantId:T,stsTokenManager:b,createdAt:x,lastLoginAt:v});return $&&Array.isArray($)&&(C.providerData=$.map(N=>Object.assign({},N))),E&&(C._redirectEventId=E),C}static async _fromIdTokenResponse(e,t,r=!1){const s=new Ka;s.updateFromServerResponse(t);const i=new Yr({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Rd(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];we(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?eE(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new Ka;l.updateFromIdToken(r);const c=new Yr({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Uf(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jv=new Map;function Jr(n){as(n instanceof Function,"Expected a class definition");let e=jv.get(n);return e?(as(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,jv.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}tE.type="NONE";const Dv=tE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zu(n,e,t){return`firebase:${n}:${e}:${t}`}class Qa{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=zu(this.userKey,s.apiKey,i),this.fullPersistenceKey=zu("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Yr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Qa(Jr(Dv),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||Jr(Dv);const a=zu(r,e.config.apiKey,e.name);let l=null;for(const d of t)try{const h=await d._get(a);if(h){const m=Yr._fromJSON(e,h);d!==i&&(l=m),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new Qa(i,e,r):(i=c[0],l&&await i._set(a,l.toJSON()),await Promise.all(t.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new Qa(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mv(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(iE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(nE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(oE(e))return"Blackberry";if(lE(e))return"Webos";if(rE(e))return"Safari";if((e.includes("chrome/")||sE(e))&&!e.includes("edge/"))return"Chrome";if(aE(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function nE(n=en()){return/firefox\//i.test(n)}function rE(n=en()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function sE(n=en()){return/crios\//i.test(n)}function iE(n=en()){return/iemobile/i.test(n)}function aE(n=en()){return/android/i.test(n)}function oE(n=en()){return/blackberry/i.test(n)}function lE(n=en()){return/webos/i.test(n)}function yg(n=en()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function dP(n=en()){var e;return yg(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function hP(){return AA()&&document.documentMode===10}function cE(n=en()){return yg(n)||aE(n)||lE(n)||oE(n)||/windows phone/i.test(n)||iE(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uE(n,e=[]){let t;switch(n){case"Browser":t=Mv(en());break;case"Worker":t=`${Mv(en())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ko}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,l)=>{try{const c=e(i);a(c)}catch(c){l(c)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fP(n,e={}){return ps(n,"GET","/v2/passwordPolicy",fs(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pP=6;class gP{constructor(e){var t,r,s,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:pP,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,a,l;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(s=c.containsLowercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(i=c.containsUppercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(a=c.containsNumericCharacter)!==null&&a!==void 0?a:!0),c.isValid&&(c.isValid=(l=c.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),c}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yP{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Vv(this),this.idTokenSubscription=new Vv(this),this.beforeStateQueue=new mP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=K_,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Jr(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Qa.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Z_(this,{idToken:e}),r=await Yr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Pr(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(l,l))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,l=s==null?void 0:s._redirectEventId,c=await this.tryRedirectSignIn(e);(!a||a===l)&&(c!=null&&c.user)&&(s=c.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return we(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Rd(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Yk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Pr(this.app))return Promise.reject(es(this));const t=e?it(e):null;return t&&we(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&we(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Pr(this.app)?Promise.reject(es(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Pr(this.app)?Promise.reject(es(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Jr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await fP(this),t=new gP(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new _c("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await uP(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Jr(e)||this._popupRedirectResolver;we(t,this,"argument-error"),this.redirectPersistenceManager=await Qa.create(this,[Jr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(we(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,r,s);return()=>{a=!0,c()}}else{const c=e.addObserver(t);return()=>{a=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return we(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=uE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&Gk(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function la(n){return it(n)}class Vv{constructor(e){this.auth=e,this.observer=null,this.addObserver=MA(t=>this.observer=t)}get next(){return we(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ph={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function vP(n){ph=n}function dE(n){return ph.loadJS(n)}function xP(){return ph.recaptchaEnterpriseScript}function bP(){return ph.gapiScript}function wP(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const _P="recaptcha-enterprise",EP="NO_RECAPTCHA";class TP{constructor(e){this.type=_P,this.auth=la(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,l)=>{nP(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new tP(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,a,l){const c=window.grecaptcha;Pv(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(EP)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,a)=>{r(this.auth).then(l=>{if(!t&&Pv(window.grecaptcha))s(l,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let c=xP();c.length!==0&&(c+=l),dE(c).then(()=>{s(l,i,a)}).catch(d=>{a(d)})}}).catch(l=>{a(l)})})}}async function Lv(n,e,t,r=!1){const s=new TP(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const a=Object.assign({},e);return r?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Bf(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Lv(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await Lv(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IP(n,e){const t=Tc(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(ni(i,e??{}))return s;Cr(s,"already-initialized")}return t.initialize({options:e})}function SP(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Jr);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function CP(n,e,t){const r=la(n);we(r._canInitEmulator,r,"emulator-config-failed"),we(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=hE(e),{host:a,port:l}=NP(e),c=l===null?"":`:${l}`;r.config.emulator={url:`${i}//${a}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||AP()}function hE(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function NP(n){const e=hE(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Ov(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:Ov(a)}}}function Ov(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function AP(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Qr("not implemented")}_getIdTokenResponse(e){return Qr("not implemented")}_linkToIdToken(e,t){return Qr("not implemented")}_getReauthenticationResolver(e){return Qr("not implemented")}}async function kP(n,e){return ps(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PP(n,e){return Sc(n,"POST","/v1/accounts:signInWithPassword",fs(n,e))}async function RP(n,e){return ps(n,"POST","/v1/accounts:sendOobCode",fs(n,e))}async function jP(n,e){return RP(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DP(n,e){return Sc(n,"POST","/v1/accounts:signInWithEmailLink",fs(n,e))}async function MP(n,e){return Sc(n,"POST","/v1/accounts:signInWithEmailLink",fs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc extends vg{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new sc(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new sc(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Bf(e,t,"signInWithPassword",PP);case"emailLink":return DP(e,{email:this._email,oobCode:this._password});default:Cr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Bf(e,r,"signUpPassword",kP);case"emailLink":return MP(e,{idToken:t,email:this._email,oobCode:this._password});default:Cr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ya(n,e){return Sc(n,"POST","/v1/accounts:signInWithIdp",fs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VP="http://localhost";class Qi extends vg{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Qi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Cr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=mg(t,["providerId","signInMethod"]);if(!r||!s)return null;const a=new Qi(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return Ya(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ya(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ya(e,t)}buildRequest(){const e={requestUri:VP,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ec(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LP(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function OP(n){const e=pl(gl(n)).link,t=e?pl(gl(e)).deep_link_id:null,r=pl(gl(n)).deep_link_id;return(r?pl(gl(r)).link:null)||r||t||e||n}class xg{constructor(e){var t,r,s,i,a,l;const c=pl(gl(e)),d=(t=c.apiKey)!==null&&t!==void 0?t:null,h=(r=c.oobCode)!==null&&r!==void 0?r:null,m=LP((s=c.mode)!==null&&s!==void 0?s:null);we(d&&h&&m,"argument-error"),this.apiKey=d,this.operation=m,this.code=h,this.continueUrl=(i=c.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(a=c.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(l=c.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const t=OP(e);try{return new xg(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Po{constructor(){this.providerId=Po.PROVIDER_ID}static credential(e,t){return sc._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=xg.parseLink(t);return we(r,"argument-error"),sc._fromEmailAndCode(e,r.code,r.tenantId)}}Po.PROVIDER_ID="password";Po.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Po.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cc extends mE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps extends Cc{constructor(){super("facebook.com")}static credential(e){return Qi._fromParams({providerId:Ps.PROVIDER_ID,signInMethod:Ps.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ps.credentialFromTaggedObject(e)}static credentialFromError(e){return Ps.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ps.credential(e.oauthAccessToken)}catch{return null}}}Ps.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ps.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs extends Cc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Qi._fromParams({providerId:Rs.PROVIDER_ID,signInMethod:Rs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Rs.credentialFromTaggedObject(e)}static credentialFromError(e){return Rs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Rs.credential(t,r)}catch{return null}}}Rs.GOOGLE_SIGN_IN_METHOD="google.com";Rs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js extends Cc{constructor(){super("github.com")}static credential(e){return Qi._fromParams({providerId:js.PROVIDER_ID,signInMethod:js.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return js.credentialFromTaggedObject(e)}static credentialFromError(e){return js.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return js.credential(e.oauthAccessToken)}catch{return null}}}js.GITHUB_SIGN_IN_METHOD="github.com";js.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds extends Cc{constructor(){super("twitter.com")}static credential(e,t){return Qi._fromParams({providerId:Ds.PROVIDER_ID,signInMethod:Ds.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ds.credentialFromTaggedObject(e)}static credentialFromError(e){return Ds.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Ds.credential(t,r)}catch{return null}}}Ds.TWITTER_SIGN_IN_METHOD="twitter.com";Ds.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FP(n,e){return Sc(n,"POST","/v1/accounts:signUp",fs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Yr._fromIdTokenResponse(e,r,s),a=Fv(r);return new Yi({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Fv(r);return new Yi({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Fv(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jd extends ms{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,jd.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new jd(e,t,r,s)}}function fE(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?jd._fromErrorAndOperation(n,i,e,r):i})}async function $P(n,e,t=!1){const r=await rc(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Yi._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UP(n,e,t=!1){const{auth:r}=n;if(Pr(r.app))return Promise.reject(es(r));const s="reauthenticate";try{const i=await rc(n,fE(r,s,e,n),t);we(i.idToken,r,"internal-error");const a=gg(i.idToken);we(a,r,"internal-error");const{sub:l}=a;return we(n.uid===l,r,"user-mismatch"),Yi._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Cr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pE(n,e,t=!1){if(Pr(n.app))return Promise.reject(es(n));const r="signIn",s=await fE(n,r,e),i=await Yi._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function BP(n,e){return pE(la(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zP(n,e,t){var r;we(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),we(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(we(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(we(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gE(n){const e=la(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function qP(n,e,t){if(Pr(n.app))return Promise.reject(es(n));const r=la(n),a=await Bf(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",FP).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&gE(n),c}),l=await Yi._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function WP(n,e,t){return Pr(n.app)?Promise.reject(es(n)):BP(it(n),Po.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&gE(n),r})}async function HP(n,e){const t=it(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&zP(t.auth,s,e);const{email:i}=await jP(t.auth,s);i!==n.email&&await n.reload()}function GP(n,e,t,r){return it(n).onIdTokenChanged(e,t,r)}function KP(n,e,t){return it(n).beforeAuthStateChanged(e,t)}function yE(n,e,t,r){return it(n).onAuthStateChanged(e,t,r)}function vE(n){return it(n).signOut()}const Dd="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Dd,"1"),this.storage.removeItem(Dd),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QP=1e3,YP=10;class bE extends xE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=cE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,c)=>{this.notifyListeners(a,c)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);hP()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,YP):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},QP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}bE.type="LOCAL";const JP=bE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wE extends xE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}wE.type="SESSION";const _E=wE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XP(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new gh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(t.origin,i)),c=await XP(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}gh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bg(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZP{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,c)=>{const d=bg("",20);s.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(m){const p=m;if(p.data.eventId===d)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(p.data.response);break;default:clearTimeout(h),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lr(){return window}function eR(n){Lr().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EE(){return typeof Lr().WorkerGlobalScope<"u"&&typeof Lr().importScripts=="function"}async function tR(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function nR(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function rR(){return EE()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TE="firebaseLocalStorageDb",sR=1,Md="firebaseLocalStorage",IE="fbase_key";class Nc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function yh(n,e){return n.transaction([Md],e?"readwrite":"readonly").objectStore(Md)}function iR(){const n=indexedDB.deleteDatabase(TE);return new Nc(n).toPromise()}function zf(){const n=indexedDB.open(TE,sR);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Md,{keyPath:IE})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Md)?e(r):(r.close(),await iR(),e(await zf()))})})}async function $v(n,e,t){const r=yh(n,!0).put({[IE]:e,value:t});return new Nc(r).toPromise()}async function aR(n,e){const t=yh(n,!1).get(e),r=await new Nc(t).toPromise();return r===void 0?null:r.value}function Uv(n,e){const t=yh(n,!0).delete(e);return new Nc(t).toPromise()}const oR=800,lR=3;class SE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await zf(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>lR)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return EE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=gh._getInstance(rR()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await tR(),!this.activeServiceWorker)return;this.sender=new ZP(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||nR()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await zf();return await $v(e,Dd,"1"),await Uv(e,Dd),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>$v(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>aR(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Uv(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=yh(s,!1).getAll();return new Nc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),oR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}SE.type="LOCAL";const cR=SE;new Ic(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uR(n,e){return e?Jr(e):(we(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg extends vg{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ya(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ya(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ya(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function dR(n){return pE(n.auth,new wg(n),n.bypassAuthState)}function hR(n){const{auth:e,user:t}=n;return we(t,e,"internal-error"),UP(t,new wg(n),n.bypassAuthState)}async function mR(n){const{auth:e,user:t}=n;return we(t,e,"internal-error"),$P(t,new wg(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const c={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return dR;case"linkViaPopup":case"linkViaRedirect":return mR;case"reauthViaPopup":case"reauthViaRedirect":return hR;default:Cr(this.auth,"internal-error")}}resolve(e){as(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){as(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fR=new Ic(2e3,1e4);class Ua extends CE{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Ua.currentPopupAction&&Ua.currentPopupAction.cancel(),Ua.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return we(e,this.auth,"internal-error"),e}async onExecution(){as(this.filter.length===1,"Popup operations only handle one event");const e=bg();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Vr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Vr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ua.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Vr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,fR.get())};e()}}Ua.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pR="pendingRedirect",qu=new Map;class gR extends CE{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=qu.get(this.auth._key());if(!e){try{const r=await yR(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}qu.set(this.auth._key(),e)}return this.bypassAuthState||qu.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function yR(n,e){const t=bR(e),r=xR(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function vR(n,e){qu.set(n._key(),e)}function xR(n){return Jr(n._redirectPersistence)}function bR(n){return zu(pR,n.config.apiKey,n.name)}async function wR(n,e,t=!1){if(Pr(n.app))return Promise.reject(es(n));const r=la(n),s=uR(r,e),a=await new gR(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _R=10*60*1e3;class ER{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!TR(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!NE(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Vr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=_R&&this.cachedEventUids.clear(),this.cachedEventUids.has(Bv(e))}saveEventToCache(e){this.cachedEventUids.add(Bv(e)),this.lastProcessedEventTime=Date.now()}}function Bv(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function NE({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function TR(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return NE(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IR(n,e={}){return ps(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SR=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,CR=/^https?/;async function NR(n){if(n.config.emulator)return;const{authorizedDomains:e}=await IR(n);for(const t of e)try{if(AR(t))return}catch{}Cr(n,"unauthorized-domain")}function AR(n){const e=$f(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!CR.test(t))return!1;if(SR.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kR=new Ic(3e4,6e4);function zv(){const n=Lr().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function PR(n){return new Promise((e,t)=>{var r,s,i;function a(){zv(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{zv(),t(Vr(n,"network-request-failed"))},timeout:kR.get()})}if(!((s=(r=Lr().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Lr().gapi)===null||i===void 0)&&i.load)a();else{const l=wP("iframefcb");return Lr()[l]=()=>{gapi.load?a():t(Vr(n,"network-request-failed"))},dE(`${bP()}?onload=${l}`).catch(c=>t(c))}}).catch(e=>{throw Wu=null,e})}let Wu=null;function RR(n){return Wu=Wu||PR(n),Wu}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jR=new Ic(5e3,15e3),DR="__/auth/iframe",MR="emulator/auth/iframe",VR={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},LR=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function OR(n){const e=n.config;we(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?pg(e,MR):`https://${n.config.authDomain}/${DR}`,r={apiKey:e.apiKey,appName:n.name,v:ko},s=LR.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Ec(r).slice(1)}`}async function FR(n){const e=await RR(n),t=Lr().gapi;return we(t,n,"internal-error"),e.open({where:document.body,url:OR(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:VR,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=Vr(n,"network-request-failed"),l=Lr().setTimeout(()=>{i(a)},jR.get());function c(){Lr().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $R={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},UR=500,BR=600,zR="_blank",qR="http://localhost";class qv{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function WR(n,e,t,r=UR,s=BR){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c=Object.assign(Object.assign({},$R),{width:r.toString(),height:s.toString(),top:i,left:a}),d=en().toLowerCase();t&&(l=sE(d)?zR:t),nE(d)&&(e=e||qR,c.scrollbars="yes");const h=Object.entries(c).reduce((p,[y,_])=>`${p}${y}=${_},`,"");if(dP(d)&&l!=="_self")return HR(e||"",l),new qv(null);const m=window.open(e||"",l,h);we(m,n,"popup-blocked");try{m.focus()}catch{}return new qv(m)}function HR(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GR="__/auth/handler",KR="emulator/auth/handler",QR=encodeURIComponent("fac");async function Wv(n,e,t,r,s,i){we(n.config.authDomain,n,"auth-domain-config-required"),we(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:ko,eventId:s};if(e instanceof mE){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",DA(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,m]of Object.entries(i||{}))a[h]=m}if(e instanceof Cc){const h=e.getScopes().filter(m=>m!=="");h.length>0&&(a.scopes=h.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const h of Object.keys(l))l[h]===void 0&&delete l[h];const c=await n._getAppCheckToken(),d=c?`#${QR}=${encodeURIComponent(c)}`:"";return`${YR(n)}?${Ec(l).slice(1)}${d}`}function YR({config:n}){return n.emulator?pg(n,KR):`https://${n.authDomain}/${GR}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pm="webStorageSupport";class JR{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=_E,this._completeRedirectFn=wR,this._overrideRedirectResult=vR}async _openPopup(e,t,r,s){var i;as((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await Wv(e,t,r,$f(),s);return WR(e,a,bg())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Wv(e,t,r,$f(),s);return eR(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(as(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await FR(e),r=new ER(e);return t.register("authEvent",s=>(we(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Pm,{type:Pm},s=>{var i;const a=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Pm];a!==void 0&&t(!!a),Cr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=NR(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return cE()||rE()||yg()}}const XR=JR;var Hv="@firebase/auth",Gv="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){we(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ej(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function tj(n){oo(new Ki("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;we(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:uE(n)},d=new yP(r,s,i,c);return SP(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),oo(new Ki("auth-internal",e=>{const t=la(e.getProvider("auth").getImmediate());return(r=>new ZR(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Zs(Hv,Gv,ej(n)),Zs(Hv,Gv,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nj=5*60,rj=O_("authIdTokenMaxAge")||nj;let Kv=null;const sj=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>rj)return;const s=t==null?void 0:t.token;Kv!==s&&(Kv=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function ij(n=q_()){const e=Tc(n,"auth");if(e.isInitialized())return e.getImmediate();const t=IP(n,{popupRedirectResolver:XR,persistence:[cR,JP,_E]}),r=O_("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=sj(i.toString());KP(t,a,()=>a(t.currentUser)),GP(t,l=>a(l))}}const s=V_("auth");return s&&CP(t,`http://${s}`),t}function aj(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}vP({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Vr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",aj().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});tj("Browser");var oj="firebase",lj="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zs(oj,lj,"app");var Qv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ui,AE;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,b){function C(){}C.prototype=b.prototype,I.D=b.prototype,I.prototype=new C,I.prototype.constructor=I,I.C=function(N,R,D){for(var k=Array(arguments.length-2),je=2;je<arguments.length;je++)k[je-2]=arguments[je];return b.prototype[R].apply(N,k)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,b,C){C||(C=0);var N=Array(16);if(typeof b=="string")for(var R=0;16>R;++R)N[R]=b.charCodeAt(C++)|b.charCodeAt(C++)<<8|b.charCodeAt(C++)<<16|b.charCodeAt(C++)<<24;else for(R=0;16>R;++R)N[R]=b[C++]|b[C++]<<8|b[C++]<<16|b[C++]<<24;b=I.g[0],C=I.g[1],R=I.g[2];var D=I.g[3],k=b+(D^C&(R^D))+N[0]+3614090360&4294967295;b=C+(k<<7&4294967295|k>>>25),k=D+(R^b&(C^R))+N[1]+3905402710&4294967295,D=b+(k<<12&4294967295|k>>>20),k=R+(C^D&(b^C))+N[2]+606105819&4294967295,R=D+(k<<17&4294967295|k>>>15),k=C+(b^R&(D^b))+N[3]+3250441966&4294967295,C=R+(k<<22&4294967295|k>>>10),k=b+(D^C&(R^D))+N[4]+4118548399&4294967295,b=C+(k<<7&4294967295|k>>>25),k=D+(R^b&(C^R))+N[5]+1200080426&4294967295,D=b+(k<<12&4294967295|k>>>20),k=R+(C^D&(b^C))+N[6]+2821735955&4294967295,R=D+(k<<17&4294967295|k>>>15),k=C+(b^R&(D^b))+N[7]+4249261313&4294967295,C=R+(k<<22&4294967295|k>>>10),k=b+(D^C&(R^D))+N[8]+1770035416&4294967295,b=C+(k<<7&4294967295|k>>>25),k=D+(R^b&(C^R))+N[9]+2336552879&4294967295,D=b+(k<<12&4294967295|k>>>20),k=R+(C^D&(b^C))+N[10]+4294925233&4294967295,R=D+(k<<17&4294967295|k>>>15),k=C+(b^R&(D^b))+N[11]+2304563134&4294967295,C=R+(k<<22&4294967295|k>>>10),k=b+(D^C&(R^D))+N[12]+1804603682&4294967295,b=C+(k<<7&4294967295|k>>>25),k=D+(R^b&(C^R))+N[13]+4254626195&4294967295,D=b+(k<<12&4294967295|k>>>20),k=R+(C^D&(b^C))+N[14]+2792965006&4294967295,R=D+(k<<17&4294967295|k>>>15),k=C+(b^R&(D^b))+N[15]+1236535329&4294967295,C=R+(k<<22&4294967295|k>>>10),k=b+(R^D&(C^R))+N[1]+4129170786&4294967295,b=C+(k<<5&4294967295|k>>>27),k=D+(C^R&(b^C))+N[6]+3225465664&4294967295,D=b+(k<<9&4294967295|k>>>23),k=R+(b^C&(D^b))+N[11]+643717713&4294967295,R=D+(k<<14&4294967295|k>>>18),k=C+(D^b&(R^D))+N[0]+3921069994&4294967295,C=R+(k<<20&4294967295|k>>>12),k=b+(R^D&(C^R))+N[5]+3593408605&4294967295,b=C+(k<<5&4294967295|k>>>27),k=D+(C^R&(b^C))+N[10]+38016083&4294967295,D=b+(k<<9&4294967295|k>>>23),k=R+(b^C&(D^b))+N[15]+3634488961&4294967295,R=D+(k<<14&4294967295|k>>>18),k=C+(D^b&(R^D))+N[4]+3889429448&4294967295,C=R+(k<<20&4294967295|k>>>12),k=b+(R^D&(C^R))+N[9]+568446438&4294967295,b=C+(k<<5&4294967295|k>>>27),k=D+(C^R&(b^C))+N[14]+3275163606&4294967295,D=b+(k<<9&4294967295|k>>>23),k=R+(b^C&(D^b))+N[3]+4107603335&4294967295,R=D+(k<<14&4294967295|k>>>18),k=C+(D^b&(R^D))+N[8]+1163531501&4294967295,C=R+(k<<20&4294967295|k>>>12),k=b+(R^D&(C^R))+N[13]+2850285829&4294967295,b=C+(k<<5&4294967295|k>>>27),k=D+(C^R&(b^C))+N[2]+4243563512&4294967295,D=b+(k<<9&4294967295|k>>>23),k=R+(b^C&(D^b))+N[7]+1735328473&4294967295,R=D+(k<<14&4294967295|k>>>18),k=C+(D^b&(R^D))+N[12]+2368359562&4294967295,C=R+(k<<20&4294967295|k>>>12),k=b+(C^R^D)+N[5]+4294588738&4294967295,b=C+(k<<4&4294967295|k>>>28),k=D+(b^C^R)+N[8]+2272392833&4294967295,D=b+(k<<11&4294967295|k>>>21),k=R+(D^b^C)+N[11]+1839030562&4294967295,R=D+(k<<16&4294967295|k>>>16),k=C+(R^D^b)+N[14]+4259657740&4294967295,C=R+(k<<23&4294967295|k>>>9),k=b+(C^R^D)+N[1]+2763975236&4294967295,b=C+(k<<4&4294967295|k>>>28),k=D+(b^C^R)+N[4]+1272893353&4294967295,D=b+(k<<11&4294967295|k>>>21),k=R+(D^b^C)+N[7]+4139469664&4294967295,R=D+(k<<16&4294967295|k>>>16),k=C+(R^D^b)+N[10]+3200236656&4294967295,C=R+(k<<23&4294967295|k>>>9),k=b+(C^R^D)+N[13]+681279174&4294967295,b=C+(k<<4&4294967295|k>>>28),k=D+(b^C^R)+N[0]+3936430074&4294967295,D=b+(k<<11&4294967295|k>>>21),k=R+(D^b^C)+N[3]+3572445317&4294967295,R=D+(k<<16&4294967295|k>>>16),k=C+(R^D^b)+N[6]+76029189&4294967295,C=R+(k<<23&4294967295|k>>>9),k=b+(C^R^D)+N[9]+3654602809&4294967295,b=C+(k<<4&4294967295|k>>>28),k=D+(b^C^R)+N[12]+3873151461&4294967295,D=b+(k<<11&4294967295|k>>>21),k=R+(D^b^C)+N[15]+530742520&4294967295,R=D+(k<<16&4294967295|k>>>16),k=C+(R^D^b)+N[2]+3299628645&4294967295,C=R+(k<<23&4294967295|k>>>9),k=b+(R^(C|~D))+N[0]+4096336452&4294967295,b=C+(k<<6&4294967295|k>>>26),k=D+(C^(b|~R))+N[7]+1126891415&4294967295,D=b+(k<<10&4294967295|k>>>22),k=R+(b^(D|~C))+N[14]+2878612391&4294967295,R=D+(k<<15&4294967295|k>>>17),k=C+(D^(R|~b))+N[5]+4237533241&4294967295,C=R+(k<<21&4294967295|k>>>11),k=b+(R^(C|~D))+N[12]+1700485571&4294967295,b=C+(k<<6&4294967295|k>>>26),k=D+(C^(b|~R))+N[3]+2399980690&4294967295,D=b+(k<<10&4294967295|k>>>22),k=R+(b^(D|~C))+N[10]+4293915773&4294967295,R=D+(k<<15&4294967295|k>>>17),k=C+(D^(R|~b))+N[1]+2240044497&4294967295,C=R+(k<<21&4294967295|k>>>11),k=b+(R^(C|~D))+N[8]+1873313359&4294967295,b=C+(k<<6&4294967295|k>>>26),k=D+(C^(b|~R))+N[15]+4264355552&4294967295,D=b+(k<<10&4294967295|k>>>22),k=R+(b^(D|~C))+N[6]+2734768916&4294967295,R=D+(k<<15&4294967295|k>>>17),k=C+(D^(R|~b))+N[13]+1309151649&4294967295,C=R+(k<<21&4294967295|k>>>11),k=b+(R^(C|~D))+N[4]+4149444226&4294967295,b=C+(k<<6&4294967295|k>>>26),k=D+(C^(b|~R))+N[11]+3174756917&4294967295,D=b+(k<<10&4294967295|k>>>22),k=R+(b^(D|~C))+N[2]+718787259&4294967295,R=D+(k<<15&4294967295|k>>>17),k=C+(D^(R|~b))+N[9]+3951481745&4294967295,I.g[0]=I.g[0]+b&4294967295,I.g[1]=I.g[1]+(R+(k<<21&4294967295|k>>>11))&4294967295,I.g[2]=I.g[2]+R&4294967295,I.g[3]=I.g[3]+D&4294967295}r.prototype.u=function(I,b){b===void 0&&(b=I.length);for(var C=b-this.blockSize,N=this.B,R=this.h,D=0;D<b;){if(R==0)for(;D<=C;)s(this,I,D),D+=this.blockSize;if(typeof I=="string"){for(;D<b;)if(N[R++]=I.charCodeAt(D++),R==this.blockSize){s(this,N),R=0;break}}else for(;D<b;)if(N[R++]=I[D++],R==this.blockSize){s(this,N),R=0;break}}this.h=R,this.o+=b},r.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var b=1;b<I.length-8;++b)I[b]=0;var C=8*this.o;for(b=I.length-8;b<I.length;++b)I[b]=C&255,C/=256;for(this.u(I),I=Array(16),b=C=0;4>b;++b)for(var N=0;32>N;N+=8)I[C++]=this.g[b]>>>N&255;return I};function i(I,b){var C=l;return Object.prototype.hasOwnProperty.call(C,I)?C[I]:C[I]=b(I)}function a(I,b){this.h=b;for(var C=[],N=!0,R=I.length-1;0<=R;R--){var D=I[R]|0;N&&D==b||(C[R]=D,N=!1)}this.g=C}var l={};function c(I){return-128<=I&&128>I?i(I,function(b){return new a([b|0],0>b?-1:0)}):new a([I|0],0>I?-1:0)}function d(I){if(isNaN(I)||!isFinite(I))return m;if(0>I)return E(d(-I));for(var b=[],C=1,N=0;I>=C;N++)b[N]=I/C|0,C*=4294967296;return new a(b,0)}function h(I,b){if(I.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(I.charAt(0)=="-")return E(h(I.substring(1),b));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var C=d(Math.pow(b,8)),N=m,R=0;R<I.length;R+=8){var D=Math.min(8,I.length-R),k=parseInt(I.substring(R,R+D),b);8>D?(D=d(Math.pow(b,D)),N=N.j(D).add(d(k))):(N=N.j(C),N=N.add(d(k)))}return N}var m=c(0),p=c(1),y=c(16777216);n=a.prototype,n.m=function(){if(T(this))return-E(this).m();for(var I=0,b=1,C=0;C<this.g.length;C++){var N=this.i(C);I+=(0<=N?N:4294967296+N)*b,b*=4294967296}return I},n.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(_(this))return"0";if(T(this))return"-"+E(this).toString(I);for(var b=d(Math.pow(I,6)),C=this,N="";;){var R=P(C,b).g;C=x(C,R.j(b));var D=((0<C.g.length?C.g[0]:C.h)>>>0).toString(I);if(C=R,_(C))return D+N;for(;6>D.length;)D="0"+D;N=D+N}},n.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function _(I){if(I.h!=0)return!1;for(var b=0;b<I.g.length;b++)if(I.g[b]!=0)return!1;return!0}function T(I){return I.h==-1}n.l=function(I){return I=x(this,I),T(I)?-1:_(I)?0:1};function E(I){for(var b=I.g.length,C=[],N=0;N<b;N++)C[N]=~I.g[N];return new a(C,~I.h).add(p)}n.abs=function(){return T(this)?E(this):this},n.add=function(I){for(var b=Math.max(this.g.length,I.g.length),C=[],N=0,R=0;R<=b;R++){var D=N+(this.i(R)&65535)+(I.i(R)&65535),k=(D>>>16)+(this.i(R)>>>16)+(I.i(R)>>>16);N=k>>>16,D&=65535,k&=65535,C[R]=k<<16|D}return new a(C,C[C.length-1]&-2147483648?-1:0)};function x(I,b){return I.add(E(b))}n.j=function(I){if(_(this)||_(I))return m;if(T(this))return T(I)?E(this).j(E(I)):E(E(this).j(I));if(T(I))return E(this.j(E(I)));if(0>this.l(y)&&0>I.l(y))return d(this.m()*I.m());for(var b=this.g.length+I.g.length,C=[],N=0;N<2*b;N++)C[N]=0;for(N=0;N<this.g.length;N++)for(var R=0;R<I.g.length;R++){var D=this.i(N)>>>16,k=this.i(N)&65535,je=I.i(R)>>>16,K=I.i(R)&65535;C[2*N+2*R]+=k*K,v(C,2*N+2*R),C[2*N+2*R+1]+=D*K,v(C,2*N+2*R+1),C[2*N+2*R+1]+=k*je,v(C,2*N+2*R+1),C[2*N+2*R+2]+=D*je,v(C,2*N+2*R+2)}for(N=0;N<b;N++)C[N]=C[2*N+1]<<16|C[2*N];for(N=b;N<2*b;N++)C[N]=0;return new a(C,0)};function v(I,b){for(;(I[b]&65535)!=I[b];)I[b+1]+=I[b]>>>16,I[b]&=65535,b++}function S(I,b){this.g=I,this.h=b}function P(I,b){if(_(b))throw Error("division by zero");if(_(I))return new S(m,m);if(T(I))return b=P(E(I),b),new S(E(b.g),E(b.h));if(T(b))return b=P(I,E(b)),new S(E(b.g),b.h);if(30<I.g.length){if(T(I)||T(b))throw Error("slowDivide_ only works with positive integers.");for(var C=p,N=b;0>=N.l(I);)C=M(C),N=M(N);var R=$(C,1),D=$(N,1);for(N=$(N,2),C=$(C,2);!_(N);){var k=D.add(N);0>=k.l(I)&&(R=R.add(C),D=k),N=$(N,1),C=$(C,1)}return b=x(I,R.j(b)),new S(R,b)}for(R=m;0<=I.l(b);){for(C=Math.max(1,Math.floor(I.m()/b.m())),N=Math.ceil(Math.log(C)/Math.LN2),N=48>=N?1:Math.pow(2,N-48),D=d(C),k=D.j(b);T(k)||0<k.l(I);)C-=N,D=d(C),k=D.j(b);_(D)&&(D=p),R=R.add(D),I=x(I,k)}return new S(R,I)}n.A=function(I){return P(this,I).h},n.and=function(I){for(var b=Math.max(this.g.length,I.g.length),C=[],N=0;N<b;N++)C[N]=this.i(N)&I.i(N);return new a(C,this.h&I.h)},n.or=function(I){for(var b=Math.max(this.g.length,I.g.length),C=[],N=0;N<b;N++)C[N]=this.i(N)|I.i(N);return new a(C,this.h|I.h)},n.xor=function(I){for(var b=Math.max(this.g.length,I.g.length),C=[],N=0;N<b;N++)C[N]=this.i(N)^I.i(N);return new a(C,this.h^I.h)};function M(I){for(var b=I.g.length+1,C=[],N=0;N<b;N++)C[N]=I.i(N)<<1|I.i(N-1)>>>31;return new a(C,I.h)}function $(I,b){var C=b>>5;b%=32;for(var N=I.g.length-C,R=[],D=0;D<N;D++)R[D]=0<b?I.i(D+C)>>>b|I.i(D+C+1)<<32-b:I.i(D+C);return new a(R,I.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,AE=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=h,Ui=a}).apply(typeof Qv<"u"?Qv:typeof self<"u"?self:typeof window<"u"?window:{});var _u=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var kE,yl,PE,Hu,qf,RE,jE,DE;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,f,g){return u==Array.prototype||u==Object.prototype||(u[f]=g.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof _u=="object"&&_u];for(var f=0;f<u.length;++f){var g=u[f];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=t(this);function s(u,f){if(f)e:{var g=r;u=u.split(".");for(var w=0;w<u.length-1;w++){var L=u[w];if(!(L in g))break e;g=g[L]}u=u[u.length-1],w=g[u],f=f(w),f!=w&&f!=null&&e(g,u,{configurable:!0,writable:!0,value:f})}}function i(u,f){u instanceof String&&(u+="");var g=0,w=!1,L={next:function(){if(!w&&g<u.length){var z=g++;return{value:f(z,u[z]),done:!1}}return w=!0,{done:!0,value:void 0}}};return L[Symbol.iterator]=function(){return L},L}s("Array.prototype.values",function(u){return u||function(){return i(this,function(f,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},l=this||self;function c(u){var f=typeof u;return f=f!="object"?f:u?Array.isArray(u)?"array":f:"null",f=="array"||f=="object"&&typeof u.length=="number"}function d(u){var f=typeof u;return f=="object"&&u!=null||f=="function"}function h(u,f,g){return u.call.apply(u.bind,arguments)}function m(u,f,g){if(!u)throw Error();if(2<arguments.length){var w=Array.prototype.slice.call(arguments,2);return function(){var L=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(L,w),u.apply(f,L)}}return function(){return u.apply(f,arguments)}}function p(u,f,g){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:m,p.apply(null,arguments)}function y(u,f){var g=Array.prototype.slice.call(arguments,1);return function(){var w=g.slice();return w.push.apply(w,arguments),u.apply(this,w)}}function _(u,f){function g(){}g.prototype=f.prototype,u.aa=f.prototype,u.prototype=new g,u.prototype.constructor=u,u.Qb=function(w,L,z){for(var ae=Array(arguments.length-2),at=2;at<arguments.length;at++)ae[at-2]=arguments[at];return f.prototype[L].apply(w,ae)}}function T(u){const f=u.length;if(0<f){const g=Array(f);for(let w=0;w<f;w++)g[w]=u[w];return g}return[]}function E(u,f){for(let g=1;g<arguments.length;g++){const w=arguments[g];if(c(w)){const L=u.length||0,z=w.length||0;u.length=L+z;for(let ae=0;ae<z;ae++)u[L+ae]=w[ae]}else u.push(w)}}class x{constructor(f,g){this.i=f,this.j=g,this.h=0,this.g=null}get(){let f;return 0<this.h?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function v(u){return/^[\s\xa0]*$/.test(u)}function S(){var u=l.navigator;return u&&(u=u.userAgent)?u:""}function P(u){return P[" "](u),u}P[" "]=function(){};var M=S().indexOf("Gecko")!=-1&&!(S().toLowerCase().indexOf("webkit")!=-1&&S().indexOf("Edge")==-1)&&!(S().indexOf("Trident")!=-1||S().indexOf("MSIE")!=-1)&&S().indexOf("Edge")==-1;function $(u,f,g){for(const w in u)f.call(g,u[w],w,u)}function I(u,f){for(const g in u)f.call(void 0,u[g],g,u)}function b(u){const f={};for(const g in u)f[g]=u[g];return f}const C="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(u,f){let g,w;for(let L=1;L<arguments.length;L++){w=arguments[L];for(g in w)u[g]=w[g];for(let z=0;z<C.length;z++)g=C[z],Object.prototype.hasOwnProperty.call(w,g)&&(u[g]=w[g])}}function R(u){var f=1;u=u.split(":");const g=[];for(;0<f&&u.length;)g.push(u.shift()),f--;return u.length&&g.push(u.join(":")),g}function D(u){l.setTimeout(()=>{throw u},0)}function k(){var u=J;let f=null;return u.g&&(f=u.g,u.g=u.g.next,u.g||(u.h=null),f.next=null),f}class je{constructor(){this.h=this.g=null}add(f,g){const w=K.get();w.set(f,g),this.h?this.h.next=w:this.g=w,this.h=w}}var K=new x(()=>new re,u=>u.reset());class re{constructor(){this.next=this.g=this.h=null}set(f,g){this.h=f,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let _e,Q=!1,J=new je,ne=()=>{const u=l.Promise.resolve(void 0);_e=()=>{u.then(Ne)}};var Ne=()=>{for(var u;u=k();){try{u.h.call(u.g)}catch(g){D(g)}var f=K;f.j(u),100>f.h&&(f.h++,u.next=f.g,f.g=u)}Q=!1};function Ae(){this.s=this.s,this.C=this.C}Ae.prototype.s=!1,Ae.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ae.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Fe(u,f){this.type=u,this.g=this.target=f,this.defaultPrevented=!1}Fe.prototype.h=function(){this.defaultPrevented=!0};var ut=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var u=!1,f=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const g=()=>{};l.addEventListener("test",g,f),l.removeEventListener("test",g,f)}catch{}return u}();function He(u,f){if(Fe.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var g=this.type=u.type,w=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=f,f=u.relatedTarget){if(M){e:{try{P(f.nodeName);var L=!0;break e}catch{}L=!1}L||(f=null)}}else g=="mouseover"?f=u.fromElement:g=="mouseout"&&(f=u.toElement);this.relatedTarget=f,w?(this.clientX=w.clientX!==void 0?w.clientX:w.pageX,this.clientY=w.clientY!==void 0?w.clientY:w.pageY,this.screenX=w.screenX||0,this.screenY=w.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:Pt[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&He.aa.h.call(this)}}_(He,Fe);var Pt={2:"touch",3:"pen",4:"mouse"};He.prototype.h=function(){He.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var dt="closure_listenable_"+(1e6*Math.random()|0),Xn=0;function Zn(u,f,g,w,L){this.listener=u,this.proxy=null,this.src=f,this.type=g,this.capture=!!w,this.ha=L,this.key=++Xn,this.da=this.fa=!1}function nn(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Qe(u){this.src=u,this.g={},this.h=0}Qe.prototype.add=function(u,f,g,w,L){var z=u.toString();u=this.g[z],u||(u=this.g[z]=[],this.h++);var ae=yt(u,f,w,L);return-1<ae?(f=u[ae],g||(f.fa=!1)):(f=new Zn(f,this.src,z,!!w,L),f.fa=g,u.push(f)),f};function Qt(u,f){var g=f.type;if(g in u.g){var w=u.g[g],L=Array.prototype.indexOf.call(w,f,void 0),z;(z=0<=L)&&Array.prototype.splice.call(w,L,1),z&&(nn(f),u.g[g].length==0&&(delete u.g[g],u.h--))}}function yt(u,f,g,w){for(var L=0;L<u.length;++L){var z=u[L];if(!z.da&&z.listener==f&&z.capture==!!g&&z.ha==w)return L}return-1}var Xe="closure_lm_"+(1e6*Math.random()|0),rn={};function vt(u,f,g,w,L){if(w&&w.once)return Yt(u,f,g,w,L);if(Array.isArray(f)){for(var z=0;z<f.length;z++)vt(u,f[z],g,w,L);return null}return g=Ee(g),u&&u[dt]?u.K(f,g,d(w)?!!w.capture:!!w,L):_n(u,f,g,!1,w,L)}function _n(u,f,g,w,L,z){if(!f)throw Error("Invalid event type");var ae=d(L)?!!L.capture:!!L,at=Bn(u);if(at||(u[Xe]=at=new Qe(u)),g=at.add(f,g,w,ae,z),g.proxy)return g;if(w=dn(),g.proxy=w,w.src=u,w.listener=g,u.addEventListener)ut||(L=ae),L===void 0&&(L=!1),u.addEventListener(f.toString(),w,L);else if(u.attachEvent)u.attachEvent(En(f.toString()),w);else if(u.addListener&&u.removeListener)u.addListener(w);else throw Error("addEventListener and attachEvent are unavailable.");return g}function dn(){function u(g){return f.call(u.src,u.listener,g)}const f=Ze;return u}function Yt(u,f,g,w,L){if(Array.isArray(f)){for(var z=0;z<f.length;z++)Yt(u,f[z],g,w,L);return null}return g=Ee(g),u&&u[dt]?u.L(f,g,d(w)?!!w.capture:!!w,L):_n(u,f,g,!0,w,L)}function hn(u,f,g,w,L){if(Array.isArray(f))for(var z=0;z<f.length;z++)hn(u,f[z],g,w,L);else w=d(w)?!!w.capture:!!w,g=Ee(g),u&&u[dt]?(u=u.i,f=String(f).toString(),f in u.g&&(z=u.g[f],g=yt(z,g,w,L),-1<g&&(nn(z[g]),Array.prototype.splice.call(z,g,1),z.length==0&&(delete u.g[f],u.h--)))):u&&(u=Bn(u))&&(f=u.g[f.toString()],u=-1,f&&(u=yt(f,g,w,L)),(g=-1<u?f[u]:null)&&Mn(g))}function Mn(u){if(typeof u!="number"&&u&&!u.da){var f=u.src;if(f&&f[dt])Qt(f.i,u);else{var g=u.type,w=u.proxy;f.removeEventListener?f.removeEventListener(g,w,u.capture):f.detachEvent?f.detachEvent(En(g),w):f.addListener&&f.removeListener&&f.removeListener(w),(g=Bn(f))?(Qt(g,u),g.h==0&&(g.src=null,f[Xe]=null)):nn(u)}}}function En(u){return u in rn?rn[u]:rn[u]="on"+u}function Ze(u,f){if(u.da)u=!0;else{f=new He(f,this);var g=u.listener,w=u.ha||u.src;u.fa&&Mn(u),u=g.call(w,f)}return u}function Bn(u){return u=u[Xe],u instanceof Qe?u:null}var Mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ee(u){return typeof u=="function"?u:(u[Mt]||(u[Mt]=function(f){return u.handleEvent(f)}),u[Mt])}function G(){Ae.call(this),this.i=new Qe(this),this.M=this,this.F=null}_(G,Ae),G.prototype[dt]=!0,G.prototype.removeEventListener=function(u,f,g,w){hn(this,u,f,g,w)};function ie(u,f){var g,w=u.F;if(w)for(g=[];w;w=w.F)g.push(w);if(u=u.M,w=f.type||f,typeof f=="string")f=new Fe(f,u);else if(f instanceof Fe)f.target=f.target||u;else{var L=f;f=new Fe(w,u),N(f,L)}if(L=!0,g)for(var z=g.length-1;0<=z;z--){var ae=f.g=g[z];L=ze(ae,w,!0,f)&&L}if(ae=f.g=u,L=ze(ae,w,!0,f)&&L,L=ze(ae,w,!1,f)&&L,g)for(z=0;z<g.length;z++)ae=f.g=g[z],L=ze(ae,w,!1,f)&&L}G.prototype.N=function(){if(G.aa.N.call(this),this.i){var u=this.i,f;for(f in u.g){for(var g=u.g[f],w=0;w<g.length;w++)nn(g[w]);delete u.g[f],u.h--}}this.F=null},G.prototype.K=function(u,f,g,w){return this.i.add(String(u),f,!1,g,w)},G.prototype.L=function(u,f,g,w){return this.i.add(String(u),f,!0,g,w)};function ze(u,f,g,w){if(f=u.i.g[String(f)],!f)return!0;f=f.concat();for(var L=!0,z=0;z<f.length;++z){var ae=f[z];if(ae&&!ae.da&&ae.capture==g){var at=ae.listener,mn=ae.ha||ae.src;ae.fa&&Qt(u.i,ae),L=at.call(mn,w)!==!1&&L}}return L&&!w.defaultPrevented}function Re(u,f,g){if(typeof u=="function")g&&(u=p(u,g));else if(u&&typeof u.handleEvent=="function")u=p(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(f)?-1:l.setTimeout(u,f||0)}function Pe(u){u.g=Re(()=>{u.g=null,u.i&&(u.i=!1,Pe(u))},u.l);const f=u.h;u.h=null,u.m.apply(null,f)}class V extends Ae{constructor(f,g){super(),this.m=f,this.l=g,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:Pe(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function H(u){Ae.call(this),this.h=u,this.g={}}_(H,Ae);var me=[];function Te(u){$(u.g,function(f,g){this.g.hasOwnProperty(g)&&Mn(f)},u),u.g={}}H.prototype.N=function(){H.aa.N.call(this),Te(this)},H.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var et=l.JSON.stringify,Ut=l.JSON.parse,Bt=class{stringify(u){return l.JSON.stringify(u,void 0)}parse(u){return l.JSON.parse(u,void 0)}};function W(){}W.prototype.h=null;function Y(u){return u.h||(u.h=u.i())}function F(){}var q={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function le(){Fe.call(this,"d")}_(le,Fe);function fe(){Fe.call(this,"c")}_(fe,Fe);var de={},Se=null;function zt(){return Se=Se||new G}de.La="serverreachability";function sn(u){Fe.call(this,de.La,u)}_(sn,Fe);function De(u){const f=zt();ie(f,new sn(f))}de.STAT_EVENT="statevent";function er(u,f){Fe.call(this,de.STAT_EVENT,u),this.stat=f}_(er,Fe);function Ye(u){const f=zt();ie(f,new er(f,u))}de.Ma="timingevent";function xt(u,f){Fe.call(this,de.Ma,u),this.size=f}_(xt,Fe);function Tt(u,f){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){u()},f)}function qe(){this.g=!0}qe.prototype.xa=function(){this.g=!1};function vr(u,f,g,w,L,z){u.info(function(){if(u.g)if(z)for(var ae="",at=z.split("&"),mn=0;mn<at.length;mn++){var Je=at[mn].split("=");if(1<Je.length){var Tn=Je[0];Je=Je[1];var In=Tn.split("_");ae=2<=In.length&&In[1]=="type"?ae+(Tn+"="+Je+"&"):ae+(Tn+"=redacted&")}}else ae=null;else ae=z;return"XMLHTTP REQ ("+w+") [attempt "+L+"]: "+f+`
`+g+`
`+ae})}function j(u,f,g,w,L,z,ae){u.info(function(){return"XMLHTTP RESP ("+w+") [ attempt "+L+"]: "+f+`
`+g+`
`+z+" "+ae})}function B(u,f,g,w){u.info(function(){return"XMLHTTP TEXT ("+f+"): "+be(u,g)+(w?" "+w:"")})}function ue(u,f){u.info(function(){return"TIMEOUT: "+f})}qe.prototype.info=function(){};function be(u,f){if(!u.g)return f;if(!f)return null;try{var g=JSON.parse(f);if(g){for(u=0;u<g.length;u++)if(Array.isArray(g[u])){var w=g[u];if(!(2>w.length)){var L=w[1];if(Array.isArray(L)&&!(1>L.length)){var z=L[0];if(z!="noop"&&z!="stop"&&z!="close")for(var ae=1;ae<L.length;ae++)L[ae]=""}}}}return et(g)}catch{return f}}var ee={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},xe={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ge;function rt(){}_(rt,W),rt.prototype.g=function(){return new XMLHttpRequest},rt.prototype.i=function(){return{}},ge=new rt;function Ve(u,f,g,w){this.j=u,this.i=f,this.l=g,this.R=w||1,this.U=new H(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Jt}function Jt(){this.i=null,this.g="",this.h=!1}var qt={},zo={};function fa(u,f,g){u.L=1,u.v=Qc(Br(f)),u.m=g,u.P=!0,qc(u,null)}function qc(u,f){u.F=Date.now(),pa(u),u.A=Br(u.v);var g=u.A,w=u.R;Array.isArray(w)||(w=[String(w)]),My(g.i,"t",w),u.C=0,g=u.j.J,u.h=new Jt,u.g=Zy(u.j,g?f:null,!u.m),0<u.O&&(u.M=new V(p(u.Y,u,u.g),u.O)),f=u.U,g=u.g,w=u.ca;var L="readystatechange";Array.isArray(L)||(L&&(me[0]=L.toString()),L=me);for(var z=0;z<L.length;z++){var ae=vt(g,L[z],w||f.handleEvent,!1,f.h||f);if(!ae)break;f.g[ae.key]=ae}f=u.H?b(u.H):{},u.m?(u.u||(u.u="POST"),f["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,f)):(u.u="GET",u.g.ea(u.A,u.u,null,f)),De(),vr(u.i,u.u,u.A,u.l,u.R,u.m)}Ve.prototype.ca=function(u){u=u.target;const f=this.M;f&&zr(u)==3?f.j():this.Y(u)},Ve.prototype.Y=function(u){try{if(u==this.g)e:{const In=zr(this.g);var f=this.g.Ba();const va=this.g.Z();if(!(3>In)&&(In!=3||this.g&&(this.h.h||this.g.oa()||By(this.g)))){this.J||In!=4||f==7||(f==8||0>=va?De(3):De(2)),zh(this);var g=this.g.Z();this.X=g;t:if(Wc(this)){var w=By(this.g);u="";var L=w.length,z=zr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){wi(this),qo(this);var ae="";break t}this.h.i=new l.TextDecoder}for(f=0;f<L;f++)this.h.h=!0,u+=this.h.i.decode(w[f],{stream:!(z&&f==L-1)});w.length=0,this.h.g+=u,this.C=0,ae=this.h.g}else ae=this.g.oa();if(this.o=g==200,j(this.i,this.u,this.A,this.l,this.R,In,g),this.o){if(this.T&&!this.K){t:{if(this.g){var at,mn=this.g;if((at=mn.g?mn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!v(at)){var Je=at;break t}}Je=null}if(g=Je)B(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,qh(this,g);else{this.o=!1,this.s=3,Ye(12),wi(this),qo(this);break e}}if(this.P){g=!0;let xr;for(;!this.J&&this.C<ae.length;)if(xr=Ey(this,ae),xr==zo){In==4&&(this.s=4,Ye(14),g=!1),B(this.i,this.l,null,"[Incomplete Response]");break}else if(xr==qt){this.s=4,Ye(15),B(this.i,this.l,ae,"[Invalid Chunk]"),g=!1;break}else B(this.i,this.l,xr,null),qh(this,xr);if(Wc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),In!=4||ae.length!=0||this.h.h||(this.s=1,Ye(16),g=!1),this.o=this.o&&g,!g)B(this.i,this.l,ae,"[Invalid Chunked Response]"),wi(this),qo(this);else if(0<ae.length&&!this.W){this.W=!0;var Tn=this.j;Tn.g==this&&Tn.ba&&!Tn.M&&(Tn.j.info("Great, no buffering proxy detected. Bytes received: "+ae.length),Yh(Tn),Tn.M=!0,Ye(11))}}else B(this.i,this.l,ae,null),qh(this,ae);In==4&&wi(this),this.o&&!this.J&&(In==4?Qy(this.j,this):(this.o=!1,pa(this)))}else LS(this.g),g==400&&0<ae.indexOf("Unknown SID")?(this.s=3,Ye(12)):(this.s=0,Ye(13)),wi(this),qo(this)}}}catch{}finally{}};function Wc(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Ey(u,f){var g=u.C,w=f.indexOf(`
`,g);return w==-1?zo:(g=Number(f.substring(g,w)),isNaN(g)?qt:(w+=1,w+g>f.length?zo:(f=f.slice(w,w+g),u.C=w+g,f)))}Ve.prototype.cancel=function(){this.J=!0,wi(this)};function pa(u){u.S=Date.now()+u.I,Hc(u,u.I)}function Hc(u,f){if(u.B!=null)throw Error("WatchDog timer not null");u.B=Tt(p(u.ba,u),f)}function zh(u){u.B&&(l.clearTimeout(u.B),u.B=null)}Ve.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(ue(this.i,this.A),this.L!=2&&(De(),Ye(17)),wi(this),this.s=2,qo(this)):Hc(this,this.S-u)};function qo(u){u.j.G==0||u.J||Qy(u.j,u)}function wi(u){zh(u);var f=u.M;f&&typeof f.ma=="function"&&f.ma(),u.M=null,Te(u.U),u.g&&(f=u.g,u.g=null,f.abort(),f.ma())}function qh(u,f){try{var g=u.j;if(g.G!=0&&(g.g==u||Wh(g.h,u))){if(!u.K&&Wh(g.h,u)&&g.G==3){try{var w=g.Da.g.parse(f)}catch{w=null}if(Array.isArray(w)&&w.length==3){var L=w;if(L[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<u.F)tu(g),Zc(g);else break e;Qh(g),Ye(18)}}else g.za=L[1],0<g.za-g.T&&37500>L[2]&&g.F&&g.v==0&&!g.C&&(g.C=Tt(p(g.Za,g),6e3));if(1>=Sy(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else Ei(g,11)}else if((u.K||g.g==u)&&tu(g),!v(f))for(L=g.Da.g.parse(f),f=0;f<L.length;f++){let Je=L[f];if(g.T=Je[0],Je=Je[1],g.G==2)if(Je[0]=="c"){g.K=Je[1],g.ia=Je[2];const Tn=Je[3];Tn!=null&&(g.la=Tn,g.j.info("VER="+g.la));const In=Je[4];In!=null&&(g.Aa=In,g.j.info("SVER="+g.Aa));const va=Je[5];va!=null&&typeof va=="number"&&0<va&&(w=1.5*va,g.L=w,g.j.info("backChannelRequestTimeoutMs_="+w)),w=g;const xr=u.g;if(xr){const ru=xr.g?xr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ru){var z=w.h;z.g||ru.indexOf("spdy")==-1&&ru.indexOf("quic")==-1&&ru.indexOf("h2")==-1||(z.j=z.l,z.g=new Set,z.h&&(Hh(z,z.h),z.h=null))}if(w.D){const Jh=xr.g?xr.g.getResponseHeader("X-HTTP-Session-Id"):null;Jh&&(w.ya=Jh,ht(w.I,w.D,Jh))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-u.F,g.j.info("Handshake RTT: "+g.R+"ms")),w=g;var ae=u;if(w.qa=Xy(w,w.J?w.ia:null,w.W),ae.K){Cy(w.h,ae);var at=ae,mn=w.L;mn&&(at.I=mn),at.B&&(zh(at),pa(at)),w.g=ae}else Gy(w);0<g.i.length&&eu(g)}else Je[0]!="stop"&&Je[0]!="close"||Ei(g,7);else g.G==3&&(Je[0]=="stop"||Je[0]=="close"?Je[0]=="stop"?Ei(g,7):Kh(g):Je[0]!="noop"&&g.l&&g.l.ta(Je),g.v=0)}}De(4)}catch{}}var wS=class{constructor(u,f){this.g=u,this.map=f}};function Ty(u){this.l=u||10,l.PerformanceNavigationTiming?(u=l.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Iy(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Sy(u){return u.h?1:u.g?u.g.size:0}function Wh(u,f){return u.h?u.h==f:u.g?u.g.has(f):!1}function Hh(u,f){u.g?u.g.add(f):u.h=f}function Cy(u,f){u.h&&u.h==f?u.h=null:u.g&&u.g.has(f)&&u.g.delete(f)}Ty.prototype.cancel=function(){if(this.i=Ny(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Ny(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let f=u.i;for(const g of u.g.values())f=f.concat(g.D);return f}return T(u.i)}function _S(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(c(u)){for(var f=[],g=u.length,w=0;w<g;w++)f.push(u[w]);return f}f=[],g=0;for(w in u)f[g++]=u[w];return f}function ES(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(c(u)||typeof u=="string"){var f=[];u=u.length;for(var g=0;g<u;g++)f.push(g);return f}f=[],g=0;for(const w in u)f[g++]=w;return f}}}function Ay(u,f){if(u.forEach&&typeof u.forEach=="function")u.forEach(f,void 0);else if(c(u)||typeof u=="string")Array.prototype.forEach.call(u,f,void 0);else for(var g=ES(u),w=_S(u),L=w.length,z=0;z<L;z++)f.call(void 0,w[z],g&&g[z],u)}var ky=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function TS(u,f){if(u){u=u.split("&");for(var g=0;g<u.length;g++){var w=u[g].indexOf("="),L=null;if(0<=w){var z=u[g].substring(0,w);L=u[g].substring(w+1)}else z=u[g];f(z,L?decodeURIComponent(L.replace(/\+/g," ")):"")}}}function _i(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof _i){this.h=u.h,Gc(this,u.j),this.o=u.o,this.g=u.g,Kc(this,u.s),this.l=u.l;var f=u.i,g=new Go;g.i=f.i,f.g&&(g.g=new Map(f.g),g.h=f.h),Py(this,g),this.m=u.m}else u&&(f=String(u).match(ky))?(this.h=!1,Gc(this,f[1]||"",!0),this.o=Wo(f[2]||""),this.g=Wo(f[3]||"",!0),Kc(this,f[4]),this.l=Wo(f[5]||"",!0),Py(this,f[6]||"",!0),this.m=Wo(f[7]||"")):(this.h=!1,this.i=new Go(null,this.h))}_i.prototype.toString=function(){var u=[],f=this.j;f&&u.push(Ho(f,Ry,!0),":");var g=this.g;return(g||f=="file")&&(u.push("//"),(f=this.o)&&u.push(Ho(f,Ry,!0),"@"),u.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&u.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&u.push("/"),u.push(Ho(g,g.charAt(0)=="/"?CS:SS,!0))),(g=this.i.toString())&&u.push("?",g),(g=this.m)&&u.push("#",Ho(g,AS)),u.join("")};function Br(u){return new _i(u)}function Gc(u,f,g){u.j=g?Wo(f,!0):f,u.j&&(u.j=u.j.replace(/:$/,""))}function Kc(u,f){if(f){if(f=Number(f),isNaN(f)||0>f)throw Error("Bad port number "+f);u.s=f}else u.s=null}function Py(u,f,g){f instanceof Go?(u.i=f,kS(u.i,u.h)):(g||(f=Ho(f,NS)),u.i=new Go(f,u.h))}function ht(u,f,g){u.i.set(f,g)}function Qc(u){return ht(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Wo(u,f){return u?f?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Ho(u,f,g){return typeof u=="string"?(u=encodeURI(u).replace(f,IS),g&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function IS(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Ry=/[#\/\?@]/g,SS=/[#\?:]/g,CS=/[#\?]/g,NS=/[#\?@]/g,AS=/#/g;function Go(u,f){this.h=this.g=null,this.i=u||null,this.j=!!f}function bs(u){u.g||(u.g=new Map,u.h=0,u.i&&TS(u.i,function(f,g){u.add(decodeURIComponent(f.replace(/\+/g," ")),g)}))}n=Go.prototype,n.add=function(u,f){bs(this),this.i=null,u=ga(this,u);var g=this.g.get(u);return g||this.g.set(u,g=[]),g.push(f),this.h+=1,this};function jy(u,f){bs(u),f=ga(u,f),u.g.has(f)&&(u.i=null,u.h-=u.g.get(f).length,u.g.delete(f))}function Dy(u,f){return bs(u),f=ga(u,f),u.g.has(f)}n.forEach=function(u,f){bs(this),this.g.forEach(function(g,w){g.forEach(function(L){u.call(f,L,w,this)},this)},this)},n.na=function(){bs(this);const u=Array.from(this.g.values()),f=Array.from(this.g.keys()),g=[];for(let w=0;w<f.length;w++){const L=u[w];for(let z=0;z<L.length;z++)g.push(f[w])}return g},n.V=function(u){bs(this);let f=[];if(typeof u=="string")Dy(this,u)&&(f=f.concat(this.g.get(ga(this,u))));else{u=Array.from(this.g.values());for(let g=0;g<u.length;g++)f=f.concat(u[g])}return f},n.set=function(u,f){return bs(this),this.i=null,u=ga(this,u),Dy(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[f]),this.h+=1,this},n.get=function(u,f){return u?(u=this.V(u),0<u.length?String(u[0]):f):f};function My(u,f,g){jy(u,f),0<g.length&&(u.i=null,u.g.set(ga(u,f),T(g)),u.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],f=Array.from(this.g.keys());for(var g=0;g<f.length;g++){var w=f[g];const z=encodeURIComponent(String(w)),ae=this.V(w);for(w=0;w<ae.length;w++){var L=z;ae[w]!==""&&(L+="="+encodeURIComponent(String(ae[w]))),u.push(L)}}return this.i=u.join("&")};function ga(u,f){return f=String(f),u.j&&(f=f.toLowerCase()),f}function kS(u,f){f&&!u.j&&(bs(u),u.i=null,u.g.forEach(function(g,w){var L=w.toLowerCase();w!=L&&(jy(this,w),My(this,L,g))},u)),u.j=f}function PS(u,f){const g=new qe;if(l.Image){const w=new Image;w.onload=y(ws,g,"TestLoadImage: loaded",!0,f,w),w.onerror=y(ws,g,"TestLoadImage: error",!1,f,w),w.onabort=y(ws,g,"TestLoadImage: abort",!1,f,w),w.ontimeout=y(ws,g,"TestLoadImage: timeout",!1,f,w),l.setTimeout(function(){w.ontimeout&&w.ontimeout()},1e4),w.src=u}else f(!1)}function RS(u,f){const g=new qe,w=new AbortController,L=setTimeout(()=>{w.abort(),ws(g,"TestPingServer: timeout",!1,f)},1e4);fetch(u,{signal:w.signal}).then(z=>{clearTimeout(L),z.ok?ws(g,"TestPingServer: ok",!0,f):ws(g,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(L),ws(g,"TestPingServer: error",!1,f)})}function ws(u,f,g,w,L){try{L&&(L.onload=null,L.onerror=null,L.onabort=null,L.ontimeout=null),w(g)}catch{}}function jS(){this.g=new Bt}function DS(u,f,g){const w=g||"";try{Ay(u,function(L,z){let ae=L;d(L)&&(ae=et(L)),f.push(w+z+"="+encodeURIComponent(ae))})}catch(L){throw f.push(w+"type="+encodeURIComponent("_badmap")),L}}function Yc(u){this.l=u.Ub||null,this.j=u.eb||!1}_(Yc,W),Yc.prototype.g=function(){return new Jc(this.l,this.j)},Yc.prototype.i=function(u){return function(){return u}}({});function Jc(u,f){G.call(this),this.D=u,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}_(Jc,G),n=Jc.prototype,n.open=function(u,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=f,this.readyState=1,Qo(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const f={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(f.body=u),(this.D||l).fetch(new Request(this.A,f)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ko(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Qo(this)),this.g&&(this.readyState=3,Qo(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Vy(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function Vy(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var f=u.value?u.value:new Uint8Array(0);(f=this.v.decode(f,{stream:!u.done}))&&(this.response=this.responseText+=f)}u.done?Ko(this):Qo(this),this.readyState==3&&Vy(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,Ko(this))},n.Qa=function(u){this.g&&(this.response=u,Ko(this))},n.ga=function(){this.g&&Ko(this)};function Ko(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Qo(u)}n.setRequestHeader=function(u,f){this.u.append(u,f)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],f=this.h.entries();for(var g=f.next();!g.done;)g=g.value,u.push(g[0]+": "+g[1]),g=f.next();return u.join(`\r
`)};function Qo(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Jc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function Ly(u){let f="";return $(u,function(g,w){f+=w,f+=":",f+=g,f+=`\r
`}),f}function Gh(u,f,g){e:{for(w in g){var w=!1;break e}w=!0}w||(g=Ly(g),typeof u=="string"?g!=null&&encodeURIComponent(String(g)):ht(u,f,g))}function Rt(u){G.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}_(Rt,G);var MS=/^https?$/i,VS=["POST","PUT"];n=Rt.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,f,g,w){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);f=f?f.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ge.g(),this.v=this.o?Y(this.o):Y(ge),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(f,String(u),!0),this.B=!1}catch(z){Oy(this,z);return}if(u=g||"",g=new Map(this.headers),w)if(Object.getPrototypeOf(w)===Object.prototype)for(var L in w)g.set(L,w[L]);else if(typeof w.keys=="function"&&typeof w.get=="function")for(const z of w.keys())g.set(z,w.get(z));else throw Error("Unknown input type for opt_headers: "+String(w));w=Array.from(g.keys()).find(z=>z.toLowerCase()=="content-type"),L=l.FormData&&u instanceof l.FormData,!(0<=Array.prototype.indexOf.call(VS,f,void 0))||w||L||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[z,ae]of g)this.g.setRequestHeader(z,ae);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Uy(this),this.u=!0,this.g.send(u),this.u=!1}catch(z){Oy(this,z)}};function Oy(u,f){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=f,u.m=5,Fy(u),Xc(u)}function Fy(u){u.A||(u.A=!0,ie(u,"complete"),ie(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,ie(this,"complete"),ie(this,"abort"),Xc(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xc(this,!0)),Rt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?$y(this):this.bb())},n.bb=function(){$y(this)};function $y(u){if(u.h&&typeof a<"u"&&(!u.v[1]||zr(u)!=4||u.Z()!=2)){if(u.u&&zr(u)==4)Re(u.Ea,0,u);else if(ie(u,"readystatechange"),zr(u)==4){u.h=!1;try{const ae=u.Z();e:switch(ae){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break e;default:f=!1}var g;if(!(g=f)){var w;if(w=ae===0){var L=String(u.D).match(ky)[1]||null;!L&&l.self&&l.self.location&&(L=l.self.location.protocol.slice(0,-1)),w=!MS.test(L?L.toLowerCase():"")}g=w}if(g)ie(u,"complete"),ie(u,"success");else{u.m=6;try{var z=2<zr(u)?u.g.statusText:""}catch{z=""}u.l=z+" ["+u.Z()+"]",Fy(u)}}finally{Xc(u)}}}}function Xc(u,f){if(u.g){Uy(u);const g=u.g,w=u.v[0]?()=>{}:null;u.g=null,u.v=null,f||ie(u,"ready");try{g.onreadystatechange=w}catch{}}}function Uy(u){u.I&&(l.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function zr(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<zr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var f=this.g.responseText;return u&&f.indexOf(u)==0&&(f=f.substring(u.length)),Ut(f)}};function By(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function LS(u){const f={};u=(u.g&&2<=zr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let w=0;w<u.length;w++){if(v(u[w]))continue;var g=R(u[w]);const L=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const z=f[L]||[];f[L]=z,z.push(g)}I(f,function(w){return w.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Yo(u,f,g){return g&&g.internalChannelParams&&g.internalChannelParams[u]||f}function zy(u){this.Aa=0,this.i=[],this.j=new qe,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Yo("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Yo("baseRetryDelayMs",5e3,u),this.cb=Yo("retryDelaySeedMs",1e4,u),this.Wa=Yo("forwardChannelMaxRetries",2,u),this.wa=Yo("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Ty(u&&u.concurrentRequestLimit),this.Da=new jS,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=zy.prototype,n.la=8,n.G=1,n.connect=function(u,f,g,w){Ye(0),this.W=u,this.H=f||{},g&&w!==void 0&&(this.H.OSID=g,this.H.OAID=w),this.F=this.X,this.I=Xy(this,null,this.W),eu(this)};function Kh(u){if(qy(u),u.G==3){var f=u.U++,g=Br(u.I);if(ht(g,"SID",u.K),ht(g,"RID",f),ht(g,"TYPE","terminate"),Jo(u,g),f=new Ve(u,u.j,f),f.L=2,f.v=Qc(Br(g)),g=!1,l.navigator&&l.navigator.sendBeacon)try{g=l.navigator.sendBeacon(f.v.toString(),"")}catch{}!g&&l.Image&&(new Image().src=f.v,g=!0),g||(f.g=Zy(f.j,null),f.g.ea(f.v)),f.F=Date.now(),pa(f)}Jy(u)}function Zc(u){u.g&&(Yh(u),u.g.cancel(),u.g=null)}function qy(u){Zc(u),u.u&&(l.clearTimeout(u.u),u.u=null),tu(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&l.clearTimeout(u.s),u.s=null)}function eu(u){if(!Iy(u.h)&&!u.s){u.s=!0;var f=u.Ga;_e||ne(),Q||(_e(),Q=!0),J.add(f,u),u.B=0}}function OS(u,f){return Sy(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=f.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=Tt(p(u.Ga,u,f),Yy(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const L=new Ve(this,this.j,u);let z=this.o;if(this.S&&(z?(z=b(z),N(z,this.S)):z=this.S),this.m!==null||this.O||(L.H=z,z=null),this.P)e:{for(var f=0,g=0;g<this.i.length;g++){t:{var w=this.i[g];if("__data__"in w.map&&(w=w.map.__data__,typeof w=="string")){w=w.length;break t}w=void 0}if(w===void 0)break;if(f+=w,4096<f){f=g;break e}if(f===4096||g===this.i.length-1){f=g+1;break e}}f=1e3}else f=1e3;f=Hy(this,L,f),g=Br(this.I),ht(g,"RID",u),ht(g,"CVER",22),this.D&&ht(g,"X-HTTP-Session-Id",this.D),Jo(this,g),z&&(this.O?f="headers="+encodeURIComponent(String(Ly(z)))+"&"+f:this.m&&Gh(g,this.m,z)),Hh(this.h,L),this.Ua&&ht(g,"TYPE","init"),this.P?(ht(g,"$req",f),ht(g,"SID","null"),L.T=!0,fa(L,g,null)):fa(L,g,f),this.G=2}}else this.G==3&&(u?Wy(this,u):this.i.length==0||Iy(this.h)||Wy(this))};function Wy(u,f){var g;f?g=f.l:g=u.U++;const w=Br(u.I);ht(w,"SID",u.K),ht(w,"RID",g),ht(w,"AID",u.T),Jo(u,w),u.m&&u.o&&Gh(w,u.m,u.o),g=new Ve(u,u.j,g,u.B+1),u.m===null&&(g.H=u.o),f&&(u.i=f.D.concat(u.i)),f=Hy(u,g,1e3),g.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Hh(u.h,g),fa(g,w,f)}function Jo(u,f){u.H&&$(u.H,function(g,w){ht(f,w,g)}),u.l&&Ay({},function(g,w){ht(f,w,g)})}function Hy(u,f,g){g=Math.min(u.i.length,g);var w=u.l?p(u.l.Na,u.l,u):null;e:{var L=u.i;let z=-1;for(;;){const ae=["count="+g];z==-1?0<g?(z=L[0].g,ae.push("ofs="+z)):z=0:ae.push("ofs="+z);let at=!0;for(let mn=0;mn<g;mn++){let Je=L[mn].g;const Tn=L[mn].map;if(Je-=z,0>Je)z=Math.max(0,L[mn].g-100),at=!1;else try{DS(Tn,ae,"req"+Je+"_")}catch{w&&w(Tn)}}if(at){w=ae.join("&");break e}}}return u=u.i.splice(0,g),f.D=u,w}function Gy(u){if(!u.g&&!u.u){u.Y=1;var f=u.Fa;_e||ne(),Q||(_e(),Q=!0),J.add(f,u),u.v=0}}function Qh(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=Tt(p(u.Fa,u),Yy(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,Ky(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=Tt(p(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ye(10),Zc(this),Ky(this))};function Yh(u){u.A!=null&&(l.clearTimeout(u.A),u.A=null)}function Ky(u){u.g=new Ve(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var f=Br(u.qa);ht(f,"RID","rpc"),ht(f,"SID",u.K),ht(f,"AID",u.T),ht(f,"CI",u.F?"0":"1"),!u.F&&u.ja&&ht(f,"TO",u.ja),ht(f,"TYPE","xmlhttp"),Jo(u,f),u.m&&u.o&&Gh(f,u.m,u.o),u.L&&(u.g.I=u.L);var g=u.g;u=u.ia,g.L=1,g.v=Qc(Br(f)),g.m=null,g.P=!0,qc(g,u)}n.Za=function(){this.C!=null&&(this.C=null,Zc(this),Qh(this),Ye(19))};function tu(u){u.C!=null&&(l.clearTimeout(u.C),u.C=null)}function Qy(u,f){var g=null;if(u.g==f){tu(u),Yh(u),u.g=null;var w=2}else if(Wh(u.h,f))g=f.D,Cy(u.h,f),w=1;else return;if(u.G!=0){if(f.o)if(w==1){g=f.m?f.m.length:0,f=Date.now()-f.F;var L=u.B;w=zt(),ie(w,new xt(w,g)),eu(u)}else Gy(u);else if(L=f.s,L==3||L==0&&0<f.X||!(w==1&&OS(u,f)||w==2&&Qh(u)))switch(g&&0<g.length&&(f=u.h,f.i=f.i.concat(g)),L){case 1:Ei(u,5);break;case 4:Ei(u,10);break;case 3:Ei(u,6);break;default:Ei(u,2)}}}function Yy(u,f){let g=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(g*=2),g*f}function Ei(u,f){if(u.j.info("Error code "+f),f==2){var g=p(u.fb,u),w=u.Xa;const L=!w;w=new _i(w||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Gc(w,"https"),Qc(w),L?PS(w.toString(),g):RS(w.toString(),g)}else Ye(2);u.G=0,u.l&&u.l.sa(f),Jy(u),qy(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),Ye(2)):(this.j.info("Failed to ping google.com"),Ye(1))};function Jy(u){if(u.G=0,u.ka=[],u.l){const f=Ny(u.h);(f.length!=0||u.i.length!=0)&&(E(u.ka,f),E(u.ka,u.i),u.h.i.length=0,T(u.i),u.i.length=0),u.l.ra()}}function Xy(u,f,g){var w=g instanceof _i?Br(g):new _i(g);if(w.g!="")f&&(w.g=f+"."+w.g),Kc(w,w.s);else{var L=l.location;w=L.protocol,f=f?f+"."+L.hostname:L.hostname,L=+L.port;var z=new _i(null);w&&Gc(z,w),f&&(z.g=f),L&&Kc(z,L),g&&(z.l=g),w=z}return g=u.D,f=u.ya,g&&f&&ht(w,g,f),ht(w,"VER",u.la),Jo(u,w),w}function Zy(u,f,g){if(f&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return f=u.Ca&&!u.pa?new Rt(new Yc({eb:g})):new Rt(u.pa),f.Ha(u.J),f}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function e0(){}n=e0.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function nu(){}nu.prototype.g=function(u,f){return new tr(u,f)};function tr(u,f){G.call(this),this.g=new zy(f),this.l=u,this.h=f&&f.messageUrlParams||null,u=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(u?u["X-WebChannel-Content-Type"]=f.messageContentType:u={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.va&&(u?u["X-WebChannel-Client-Profile"]=f.va:u={"X-WebChannel-Client-Profile":f.va}),this.g.S=u,(u=f&&f.Sb)&&!v(u)&&(this.g.m=u),this.v=f&&f.supportsCrossDomainXhr||!1,this.u=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!v(f)&&(this.g.D=f,u=this.h,u!==null&&f in u&&(u=this.h,f in u&&delete u[f])),this.j=new ya(this)}_(tr,G),tr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},tr.prototype.close=function(){Kh(this.g)},tr.prototype.o=function(u){var f=this.g;if(typeof u=="string"){var g={};g.__data__=u,u=g}else this.u&&(g={},g.__data__=et(u),u=g);f.i.push(new wS(f.Ya++,u)),f.G==3&&eu(f)},tr.prototype.N=function(){this.g.l=null,delete this.j,Kh(this.g),delete this.g,tr.aa.N.call(this)};function t0(u){le.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var f=u.__sm__;if(f){e:{for(const g in f){u=g;break e}u=void 0}(this.i=u)&&(u=this.i,f=f!==null&&u in f?f[u]:void 0),this.data=f}else this.data=u}_(t0,le);function n0(){fe.call(this),this.status=1}_(n0,fe);function ya(u){this.g=u}_(ya,e0),ya.prototype.ua=function(){ie(this.g,"a")},ya.prototype.ta=function(u){ie(this.g,new t0(u))},ya.prototype.sa=function(u){ie(this.g,new n0)},ya.prototype.ra=function(){ie(this.g,"b")},nu.prototype.createWebChannel=nu.prototype.g,tr.prototype.send=tr.prototype.o,tr.prototype.open=tr.prototype.m,tr.prototype.close=tr.prototype.close,DE=function(){return new nu},jE=function(){return zt()},RE=de,qf={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ee.NO_ERROR=0,ee.TIMEOUT=8,ee.HTTP_ERROR=6,Hu=ee,xe.COMPLETE="complete",PE=xe,F.EventType=q,q.OPEN="a",q.CLOSE="b",q.ERROR="c",q.MESSAGE="d",G.prototype.listen=G.prototype.K,yl=F,Rt.prototype.listenOnce=Rt.prototype.L,Rt.prototype.getLastError=Rt.prototype.Ka,Rt.prototype.getLastErrorCode=Rt.prototype.Ba,Rt.prototype.getStatus=Rt.prototype.Z,Rt.prototype.getResponseJson=Rt.prototype.Oa,Rt.prototype.getResponseText=Rt.prototype.oa,Rt.prototype.send=Rt.prototype.ea,Rt.prototype.setWithCredentials=Rt.prototype.Ha,kE=Rt}).apply(typeof _u<"u"?_u:typeof self<"u"?self:typeof window<"u"?window:{});const Yv="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ln.UNAUTHENTICATED=new ln(null),ln.GOOGLE_CREDENTIALS=new ln("google-credentials-uid"),ln.FIRST_PARTY=new ln("first-party-uid"),ln.MOCK_USER=new ln("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ro="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ri=new dg("@firebase/firestore");function Ia(){return ri.logLevel}function HV(n){ri.setLogLevel(n)}function X(n,...e){if(ri.logLevel<=$e.DEBUG){const t=e.map(_g);ri.debug(`Firestore (${Ro}): ${n}`,...t)}}function Lt(n,...e){if(ri.logLevel<=$e.ERROR){const t=e.map(_g);ri.error(`Firestore (${Ro}): ${n}`,...t)}}function gr(n,...e){if(ri.logLevel<=$e.WARN){const t=e.map(_g);ri.warn(`Firestore (${Ro}): ${n}`,...t)}}function _g(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ce(n="Unexpected state"){const e=`FIRESTORE (${Ro}) INTERNAL ASSERTION FAILED: `+n;throw Lt(e),new Error(e)}function pe(n,e){n||ce()}function GV(n,e){n||ce()}function se(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Z extends ms{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ME{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class cj{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ln.UNAUTHENTICATED))}shutdown(){}}class uj{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class dj{constructor(e){this.t=e,this.currentUser=ln.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){pe(this.o===void 0);let r=this.i;const s=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let i=new un;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new un,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},l=c=>{X("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(X("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new un)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(X("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(pe(typeof r.accessToken=="string"),new ME(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return pe(e===null||typeof e=="string"),new ln(e)}}class hj{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=ln.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class mj{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new hj(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ln.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class VE{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class fj{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){pe(this.o===void 0);const r=i=>{i.error!=null&&X("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.R;return this.R=i.token,X("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{X("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):X("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(pe(typeof t.token=="string"),this.R=t.token,new VE(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class KV{getToken(){return Promise.resolve(new VE(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pj(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LE{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=pj(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Ie(n,e){return n<e?-1:n>e?1:0}function lo(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function OE(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Z(U.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Z(U.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Z(U.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Z(U.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ct.fromMillis(Date.now())}static fromDate(e){return Ct.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Ct(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ie(this.nanoseconds,e.nanoseconds):Ie(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ye{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ye(e)}static min(){return new ye(new Ct(0,0))}static max(){return new ye(new Ct(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ic{constructor(e,t,r){t===void 0?t=0:t>e.length&&ce(),r===void 0?r=e.length-t:r>e.length-t&&ce(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return ic.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ic?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),a=t.get(s);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ue extends ic{construct(e,t,r){return new Ue(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Z(U.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Ue(t)}static emptyPath(){return new Ue([])}}const gj=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class _t extends ic{construct(e,t,r){return new _t(e,t,r)}static isValidIdentifier(e){return gj.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),_t.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new _t(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Z(U.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new Z(U.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new Z(U.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new Z(U.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new _t(t)}static emptyPath(){return new _t([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oe{constructor(e){this.path=e}static fromPath(e){return new oe(Ue.fromString(e))}static fromName(e){return new oe(Ue.fromString(e).popFirst(5))}static empty(){return new oe(Ue.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ue.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ue.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new oe(new Ue(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Wf(n){return n.fields.find(e=>e.kind===2)}function Ai(n){return n.fields.filter(e=>e.kind!==2)}function yj(n,e){let t=Ie(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=vj(n.fields[r],e.fields[r]),t!==0)return t;return Ie(n.fields.length,e.fields.length)}co.UNKNOWN_ID=-1;class Bi{constructor(e,t){this.fieldPath=e,this.kind=t}}function vj(n,e){const t=_t.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Ie(n.kind,e.kind)}class uo{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new uo(0,ar.min())}}function FE(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=ye.fromTimestamp(r===1e9?new Ct(t+1,0):new Ct(t,r));return new ar(s,oe.empty(),e)}function $E(n){return new ar(n.readTime,n.key,-1)}class ar{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new ar(ye.min(),oe.empty(),-1)}static max(){return new ar(ye.max(),oe.empty(),-1)}}function Eg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=oe.comparator(n.documentKey,e.documentKey),t!==0?t:Ie(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class BE{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pi(n){if(n.code!==U.FAILED_PRECONDITION||n.message!==UE)throw n;X("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ce(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new O((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof O?t:O.resolve(t)}catch(t){return O.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):O.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):O.reject(t)}static resolve(e){return new O((t,r)=>{t(e)})}static reject(e){return new O((t,r)=>{r(e)})}static waitFor(e){return new O((t,r)=>{let s=0,i=0,a=!1;e.forEach(l=>{++s,l.next(()=>{++i,a&&i===s&&t()},c=>r(c))}),a=!0,i===s&&t()})}static or(e){let t=O.resolve(!1);for(const r of e)t=t.next(s=>s?O.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new O((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let c=0;c<i;c++){const d=c;t(e[d]).next(h=>{a[d]=h,++l,l===i&&r(a)},h=>s(h))}})}static doWhile(e,t){return new O((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vh{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new un,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Pl(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Tg(r.target.error);this.V.reject(new Pl(e,s))}}static open(e,t,r,s){try{return new vh(t,e.transaction(s,r))}catch(i){throw new Pl(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(X("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new bj(t)}}class Or{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Or.S(en())===12.2&&Lt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return X("SimpleDb","Removing database:",e),Pi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!$_())return!1;if(Or.v())return!0;const e=en(),t=Or.S(e),r=0<t&&t<10,s=zE(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(X("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;t(a)},s.onblocked=()=>{r(new Pl(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?r(new Z(U.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new Z(U.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new Pl(e,a))},s.onupgradeneeded=i=>{X("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;this.p.O(a,s.transaction,i.oldVersion,this.version).next(()=>{X("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let a=0;for(;;){++a;try{this.db=await this.M(e);const l=vh.open(this.db,e,i?"readonly":"readwrite",r),c=s(l).next(d=>(l.g(),d)).catch(d=>(l.abort(d),O.reject(d))).toPromise();return c.catch(()=>{}),await l.m,c}catch(l){const c=l,d=c.name!=="FirebaseError"&&a<3;if(X("SimpleDb","Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function zE(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class xj{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Pi(this.B.delete())}}class Pl extends Z{constructor(e,t){super(U.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function gi(n){return n.name==="IndexedDbTransactionError"}class bj{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(X("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(X("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Pi(r)}add(e){return X("SimpleDb","ADD",this.store.name,e,e),Pi(this.store.add(e))}get(e){return Pi(this.store.get(e)).next(t=>(t===void 0&&(t=null),X("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return X("SimpleDb","DELETE",this.store.name,e),Pi(this.store.delete(e))}count(){return X("SimpleDb","COUNT",this.store.name),Pi(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new O((a,l)=>{i.onerror=c=>{l(c.target.error)},i.onsuccess=c=>{a(c.target.result)}})}{const i=this.cursor(r),a=[];return this.W(i,(l,c)=>{a.push(c)}).next(()=>a)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new O((s,i)=>{r.onerror=a=>{i(a.target.error)},r.onsuccess=a=>{s(a.target.result)}})}j(e,t){X("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,a,l)=>l.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new O((r,s)=>{t.onerror=i=>{const a=Tg(i.target.error);s(a)},t.onsuccess=i=>{const a=i.target.result;a?e(a.primaryKey,a.value).next(l=>{l?a.continue():r()}):r()}})}W(e,t){const r=[];return new O((s,i)=>{e.onerror=a=>{i(a.target.error)},e.onsuccess=a=>{const l=a.target.result;if(!l)return void s();const c=new xj(l),d=t(l.primaryKey,l.value,c);if(d instanceof O){const h=d.catch(m=>(c.done(),O.reject(m)));r.push(h)}c.isDone?s():c.K===null?l.continue():l.continue(c.K)}}).next(()=>O.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Pi(n){return new O((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Tg(r.target.error);t(s)}})}let Jv=!1;function Tg(n){const e=Or.S(en());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new Z("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Jv||(Jv=!0,setTimeout(()=>{throw r},0)),r}}return n}class wj{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){X("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{X("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){gi(t)?X("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await pi(t)}await this.X(6e4)})}}class _j{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return O.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!r.has(a))return X("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,s).next(l=>{s-=l,r.add(a)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(s,i)).next(l=>(X("IndexBackfiller",`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,t,l))).next(()=>a.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const a=$E(i);Eg(a,r)>0&&(r=a)}),new ar(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Hn.oe=-1;function Ac(n){return n==null}function ac(n){return n===0&&1/n==-1/0}function qE(n){return typeof n=="number"&&Number.isInteger(n)&&!ac(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Xv(e)),e=Ej(n.get(t),e);return Xv(e)}function Ej(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function Xv(n){return n+""}function Rr(n){const e=n.length;if(pe(e>=2),e===2)return pe(n.charAt(0)===""&&n.charAt(1)===""),Ue.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const a=n.indexOf("",i);switch((a<0||a>t)&&ce(),n.charAt(a+1)){case"":const l=n.substring(i,a);let c;s.length===0?c=l:(s+=l,c=s,s=""),r.push(c);break;case"":s+=n.substring(i,a),s+="\0";break;case"":s+=n.substring(i,a+1);break;default:ce()}i=a+2}return new Ue(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zv=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gu(n,e){return[n,Pn(e)]}function WE(n,e,t){return[n,Pn(e),t]}const Tj={},Ij=["prefixPath","collectionGroup","readTime","documentId"],Sj=["prefixPath","collectionGroup","documentId"],Cj=["collectionGroup","readTime","prefixPath","documentId"],Nj=["canonicalId","targetId"],Aj=["targetId","path"],kj=["path","targetId"],Pj=["collectionId","parent"],Rj=["indexId","uid"],jj=["uid","sequenceNumber"],Dj=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Mj=["indexId","uid","orderedDocumentKey"],Vj=["userId","collectionPath","documentId"],Lj=["userId","collectionPath","largestBatchId"],Oj=["userId","collectionGroup","largestBatchId"],HE=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Fj=[...HE,"documentOverlays"],GE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],KE=GE,Ig=[...KE,"indexConfiguration","indexState","indexEntries"],$j=Ig,Uj=[...Ig,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf extends BE{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function tn(n,e){const t=se(n);return Or.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ex(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function yi(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function QE(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function YE(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(e,t){this.comparator=e,this.root=t||gn.EMPTY}insert(e,t){return new ct(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,gn.BLACK,null,null))}remove(e){return new ct(this.comparator,this.root.remove(e,this.comparator).copy(null,null,gn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Eu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Eu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Eu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Eu(this.root,e,this.comparator,!0)}}class Eu{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class gn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??gn.RED,this.left=s??gn.EMPTY,this.right=i??gn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new gn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return gn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return gn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,gn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,gn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ce();const e=this.left.check();if(e!==this.right.check())throw ce();return e+(this.isRed()?0:1)}}gn.EMPTY=null,gn.RED=!0,gn.BLACK=!1;gn.EMPTY=new class{constructor(){this.size=0}get key(){throw ce()}get value(){throw ce()}get color(){throw ce()}get left(){throw ce()}get right(){throw ce()}copy(e,t,r,s,i){return this}insert(e,t,r){return new gn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class st{constructor(e){this.comparator=e,this.data=new ct(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tx(this.data.getIterator())}getIteratorFrom(e){return new tx(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof st)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new st(this.comparator);return t.data=e,t}}class tx{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ba(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{constructor(e){this.fields=e,e.sort(_t.comparator)}static empty(){return new Gn([])}unionWith(e){let t=new st(_t.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Gn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return lo(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YV(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new JE("Invalid base64 string: "+i):i}}(e);return new Dt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new Dt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ie(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Dt.EMPTY_BYTE_STRING=new Dt("");const Bj=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function os(n){if(pe(!!n),typeof n=="string"){let e=0;const t=Bj.exec(n);if(pe(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:bt(n.seconds),nanos:bt(n.nanos)}}function bt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ls(n){return typeof n=="string"?Dt.fromBase64String(n):Dt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function bh(n){const e=n.mapValue.fields.__previous_value__;return xh(e)?bh(e):e}function oc(n){const e=os(n.mapValue.fields.__local_write_time__.timestampValue);return new Ct(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zj{constructor(e,t,r,s,i,a,l,c,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=d}}class Ji{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Ji("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Ji&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Us={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ku={nullValue:"NULL_VALUE"};function si(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?xh(n)?4:XE(n)?9007199254740991:wh(n)?10:11:ce()}function Ur(n,e){if(n===e)return!0;const t=si(n);if(t!==si(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return oc(n).isEqual(oc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=os(s.timestampValue),l=os(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return ls(s.bytesValue).isEqual(ls(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return bt(s.geoPointValue.latitude)===bt(i.geoPointValue.latitude)&&bt(s.geoPointValue.longitude)===bt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return bt(s.integerValue)===bt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=bt(s.doubleValue),l=bt(i.doubleValue);return a===l?ac(a)===ac(l):isNaN(a)&&isNaN(l)}return!1}(n,e);case 9:return lo(n.arrayValue.values||[],e.arrayValue.values||[],Ur);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(ex(a)!==ex(l))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(l[c]===void 0||!Ur(a[c],l[c])))return!1;return!0}(n,e);default:return ce()}}function lc(n,e){return(n.values||[]).find(t=>Ur(t,e))!==void 0}function ii(n,e){if(n===e)return 0;const t=si(n),r=si(e);if(t!==r)return Ie(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ie(n.booleanValue,e.booleanValue);case 2:return function(i,a){const l=bt(i.integerValue||i.doubleValue),c=bt(a.integerValue||a.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(n,e);case 3:return nx(n.timestampValue,e.timestampValue);case 4:return nx(oc(n),oc(e));case 5:return Ie(n.stringValue,e.stringValue);case 6:return function(i,a){const l=ls(i),c=ls(a);return l.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(i,a){const l=i.split("/"),c=a.split("/");for(let d=0;d<l.length&&d<c.length;d++){const h=Ie(l[d],c[d]);if(h!==0)return h}return Ie(l.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,a){const l=Ie(bt(i.latitude),bt(a.latitude));return l!==0?l:Ie(bt(i.longitude),bt(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return rx(n.arrayValue,e.arrayValue);case 10:return function(i,a){var l,c,d,h;const m=i.fields||{},p=a.fields||{},y=(l=m.value)===null||l===void 0?void 0:l.arrayValue,_=(c=p.value)===null||c===void 0?void 0:c.arrayValue,T=Ie(((d=y==null?void 0:y.values)===null||d===void 0?void 0:d.length)||0,((h=_==null?void 0:_.values)===null||h===void 0?void 0:h.length)||0);return T!==0?T:rx(y,_)}(n.mapValue,e.mapValue);case 11:return function(i,a){if(i===Us.mapValue&&a===Us.mapValue)return 0;if(i===Us.mapValue)return 1;if(a===Us.mapValue)return-1;const l=i.fields||{},c=Object.keys(l),d=a.fields||{},h=Object.keys(d);c.sort(),h.sort();for(let m=0;m<c.length&&m<h.length;++m){const p=Ie(c[m],h[m]);if(p!==0)return p;const y=ii(l[c[m]],d[h[m]]);if(y!==0)return y}return Ie(c.length,h.length)}(n.mapValue,e.mapValue);default:throw ce()}}function nx(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ie(n,e);const t=os(n),r=os(e),s=Ie(t.seconds,r.seconds);return s!==0?s:Ie(t.nanos,r.nanos)}function rx(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=ii(t[s],r[s]);if(i)return i}return Ie(t.length,r.length)}function ho(n){return Gf(n)}function Gf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=os(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ls(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return oe.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Gf(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${Gf(t.fields[a])}`;return s+"}"}(n.mapValue):ce()}function Qu(n){switch(si(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=bh(n);return e?16+Qu(e):16;case 5:return 2*n.stringValue.length;case 6:return ls(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Qu(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return yi(r.fields,(i,a)=>{s+=i.length+Qu(a)}),s}(n.mapValue);default:throw ce()}}function Xi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Kf(n){return!!n&&"integerValue"in n}function cc(n){return!!n&&"arrayValue"in n}function sx(n){return!!n&&"nullValue"in n}function ix(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Yu(n){return!!n&&"mapValue"in n}function wh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Rl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return yi(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Rl(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Rl(n.arrayValue.values[t]);return e}return Object.assign({},n)}function XE(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const ZE={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function qj(n){return"nullValue"in n?Ku:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Xi(Ji.empty(),oe.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?wh(n)?ZE:{mapValue:{}}:ce()}function Wj(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Xi(Ji.empty(),oe.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?ZE:"mapValue"in n?wh(n)?{mapValue:{}}:Us:ce()}function ax(n,e){const t=ii(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function ox(n,e){const t=ii(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(e){this.value=e}static empty(){return new yn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Yu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Rl(t)}setAll(e){let t=_t.emptyPath(),r={},s=[];e.forEach((a,l)=>{if(!t.isImmediateParentOf(l)){const c=this.getFieldsMap(t);this.applyChanges(c,r,s),r={},s=[],t=l.popLast()}a?r[l.lastSegment()]=Rl(a):s.push(l.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Yu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ur(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Yu(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){yi(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new yn(Rl(this.value))}}function eT(n){const e=[];return yi(n.fields,(t,r)=>{const s=new _t([t]);if(Yu(r)){const i=eT(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new Gn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e,t,r,s,i,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new ft(e,0,ye.min(),ye.min(),ye.min(),yn.empty(),0)}static newFoundDocument(e,t,r,s){return new ft(e,1,t,ye.min(),r,s,0)}static newNoDocument(e,t){return new ft(e,2,t,ye.min(),ye.min(),yn.empty(),0)}static newUnknownDocument(e,t){return new ft(e,3,t,ye.min(),ye.min(),yn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ye.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=yn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=yn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ye.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ft&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ft(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(e,t){this.position=e,this.inclusive=t}}function lx(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=oe.comparator(oe.fromName(a.referenceValue),t.key):r=ii(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function cx(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ur(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uc{constructor(e,t="asc"){this.field=e,this.dir=t}}function Hj(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tT{}class Be extends tT{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Gj(e,t,r):t==="array-contains"?new Yj(e,r):t==="in"?new oT(e,r):t==="not-in"?new Jj(e,r):t==="array-contains-any"?new Xj(e,r):new Be(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Kj(e,r):new Qj(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ii(t,this.value)):t!==null&&si(this.value)===si(t)&&this.matchesComparison(ii(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ce()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class tt extends tT{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new tt(e,t)}matches(e){return mo(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function mo(n){return n.op==="and"}function Qf(n){return n.op==="or"}function Sg(n){return nT(n)&&mo(n)}function nT(n){for(const e of n.filters)if(e instanceof tt)return!1;return!0}function Yf(n){if(n instanceof Be)return n.field.canonicalString()+n.op.toString()+ho(n.value);if(Sg(n))return n.filters.map(e=>Yf(e)).join(",");{const e=n.filters.map(t=>Yf(t)).join(",");return`${n.op}(${e})`}}function rT(n,e){return n instanceof Be?function(r,s){return s instanceof Be&&r.op===s.op&&r.field.isEqual(s.field)&&Ur(r.value,s.value)}(n,e):n instanceof tt?function(r,s){return s instanceof tt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,l)=>i&&rT(a,s.filters[l]),!0):!1}(n,e):void ce()}function sT(n,e){const t=n.filters.concat(e);return tt.create(t,n.op)}function iT(n){return n instanceof Be?function(t){return`${t.field.canonicalString()} ${t.op} ${ho(t.value)}`}(n):n instanceof tt?function(t){return t.op.toString()+" {"+t.getFilters().map(iT).join(" ,")+"}"}(n):"Filter"}class Gj extends Be{constructor(e,t,r){super(e,t,r),this.key=oe.fromName(r.referenceValue)}matches(e){const t=oe.comparator(e.key,this.key);return this.matchesComparison(t)}}class Kj extends Be{constructor(e,t){super(e,"in",t),this.keys=aT("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Qj extends Be{constructor(e,t){super(e,"not-in",t),this.keys=aT("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function aT(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>oe.fromName(r.referenceValue))}class Yj extends Be{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return cc(t)&&lc(t.arrayValue,this.value)}}class oT extends Be{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&lc(this.value.arrayValue,t)}}class Jj extends Be{constructor(e,t){super(e,"not-in",t)}matches(e){if(lc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!lc(this.value.arrayValue,t)}}class Xj extends Be{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!cc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>lc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zj{constructor(e,t=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.ue=null}}function Jf(n,e=null,t=[],r=[],s=null,i=null,a=null){return new Zj(n,e,t,r,s,i,a)}function Zi(n){const e=se(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Yf(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Ac(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ho(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ho(r)).join(",")),e.ue=t}return e.ue}function kc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Hj(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!rT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!cx(n.startAt,e.startAt)&&cx(n.endAt,e.endAt)}function Vd(n){return oe.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Ld(n,e){return n.filters.filter(t=>t instanceof Be&&t.field.isEqual(e))}function ux(n,e,t){let r=Ku,s=!0;for(const i of Ld(n,e)){let a=Ku,l=!0;switch(i.op){case"<":case"<=":a=qj(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,l=!1;break;case"!=":case"not-in":a=Ku}ax({value:r,inclusive:s},{value:a,inclusive:l})<0&&(r=a,s=l)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const a=t.position[i];ax({value:r,inclusive:s},{value:a,inclusive:t.inclusive})<0&&(r=a,s=t.inclusive);break}}return{value:r,inclusive:s}}function dx(n,e,t){let r=Us,s=!0;for(const i of Ld(n,e)){let a=Us,l=!0;switch(i.op){case">=":case">":a=Wj(i.value),l=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,l=!1;break;case"!=":case"not-in":a=Us}ox({value:r,inclusive:s},{value:a,inclusive:l})>0&&(r=a,s=l)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const a=t.position[i];ox({value:r,inclusive:s},{value:a,inclusive:t.inclusive})>0&&(r=a,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e,t=null,r=[],s=[],i=null,a="F",l=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function lT(n,e,t,r,s,i,a,l){return new gs(n,e,t,r,s,i,a,l)}function jo(n){return new gs(n)}function hx(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Cg(n){return n.collectionGroup!==null}function Ja(n){const e=se(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new st(_t.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new uc(i,r))}),t.has(_t.keyField().canonicalString())||e.ce.push(new uc(_t.keyField(),r))}return e.ce}function Rn(n){const e=se(n);return e.le||(e.le=uT(e,Ja(n))),e.le}function cT(n){const e=se(n);return e.he||(e.he=uT(e,n.explicitOrderBy)),e.he}function uT(n,e){if(n.limitType==="F")return Jf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new uc(s.field,i)});const t=n.endAt?new ai(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ai(n.startAt.position,n.startAt.inclusive):null;return Jf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Xf(n,e){const t=n.filters.concat([e]);return new gs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Od(n,e,t){return new gs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Pc(n,e){return kc(Rn(n),Rn(e))&&n.limitType===e.limitType}function dT(n){return`${Zi(Rn(n))}|lt:${n.limitType}`}function Sa(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>iT(s)).join(", ")}]`),Ac(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>ho(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>ho(s)).join(",")),`Target(${r})`}(Rn(n))}; limitType=${n.limitType})`}function Rc(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):oe.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Ja(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(a,l,c){const d=lx(a,l,c);return a.inclusive?d<=0:d<0}(r.startAt,Ja(r),s)||r.endAt&&!function(a,l,c){const d=lx(a,l,c);return a.inclusive?d>=0:d>0}(r.endAt,Ja(r),s))}(n,e)}function hT(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function mT(n){return(e,t)=>{let r=!1;for(const s of Ja(n)){const i=e2(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function e2(n,e,t){const r=n.field.isKeyField()?oe.comparator(e.key,t.key):function(i,a,l){const c=a.data.field(i),d=l.data.field(i);return c!==null&&d!==null?ii(c,d):ce()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ce()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){yi(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return YE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t2=new ct(oe.comparator);function Kn(){return t2}const fT=new ct(oe.comparator);function vl(...n){let e=fT;for(const t of n)e=e.insert(t.key,t);return e}function pT(n){let e=fT;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function jr(){return jl()}function gT(){return jl()}function jl(){return new ys(n=>n.toString(),(n,e)=>n.isEqual(e))}const n2=new ct(oe.comparator),r2=new st(oe.comparator);function ke(...n){let e=r2;for(const t of n)e=e.add(t);return e}const s2=new st(Ie);function Ng(){return s2}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ag(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ac(e)?"-0":e}}function yT(n){return{integerValue:""+n}}function vT(n,e){return qE(e)?yT(e):Ag(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _h{constructor(){this._=void 0}}function i2(n,e,t){return n instanceof fo?function(s,i){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&xh(i)&&(i=bh(i)),i&&(a.fields.__previous_value__=i),{mapValue:a}}(t,e):n instanceof ea?bT(n,e):n instanceof ta?wT(n,e):function(s,i){const a=xT(s,i),l=mx(a)+mx(s.Pe);return Kf(a)&&Kf(s.Pe)?yT(l):Ag(s.serializer,l)}(n,e)}function a2(n,e,t){return n instanceof ea?bT(n,e):n instanceof ta?wT(n,e):t}function xT(n,e){return n instanceof po?function(r){return Kf(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class fo extends _h{}class ea extends _h{constructor(e){super(),this.elements=e}}function bT(n,e){const t=_T(e);for(const r of n.elements)t.some(s=>Ur(s,r))||t.push(r);return{arrayValue:{values:t}}}class ta extends _h{constructor(e){super(),this.elements=e}}function wT(n,e){let t=_T(e);for(const r of n.elements)t=t.filter(s=>!Ur(s,r));return{arrayValue:{values:t}}}class po extends _h{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function mx(n){return bt(n.integerValue||n.doubleValue)}function _T(n){return cc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jc{constructor(e,t){this.field=e,this.transform=t}}function o2(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof ea&&s instanceof ea||r instanceof ta&&s instanceof ta?lo(r.elements,s.elements,Ur):r instanceof po&&s instanceof po?Ur(r.Pe,s.Pe):r instanceof fo&&s instanceof fo}(n.transform,e.transform)}class l2{constructor(e,t){this.version=e,this.transformResults=t}}class Et{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Et}static exists(e){return new Et(void 0,e)}static updateTime(e){return new Et(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ju(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Eh{}function ET(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Mo(n.key,Et.none()):new Do(n.key,n.data,Et.none());{const t=n.data,r=yn.empty();let s=new st(_t.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new vs(n.key,r,new Gn(s.toArray()),Et.none())}}function c2(n,e,t){n instanceof Do?function(s,i,a){const l=s.value.clone(),c=px(s.fieldTransforms,i,a.transformResults);l.setAll(c),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):n instanceof vs?function(s,i,a){if(!Ju(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=px(s.fieldTransforms,i,a.transformResults),c=i.data;c.setAll(TT(s)),c.setAll(l),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(n,e,t):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Dl(n,e,t,r){return n instanceof Do?function(i,a,l,c){if(!Ju(i.precondition,a))return l;const d=i.value.clone(),h=gx(i.fieldTransforms,c,a);return d.setAll(h),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof vs?function(i,a,l,c){if(!Ju(i.precondition,a))return l;const d=gx(i.fieldTransforms,c,a),h=a.data;return h.setAll(TT(i)),h.setAll(d),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(m=>m.field))}(n,e,t,r):function(i,a,l){return Ju(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(n,e,t)}function u2(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=xT(r.transform,s||null);i!=null&&(t===null&&(t=yn.empty()),t.set(r.field,i))}return t||null}function fx(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&lo(r,s,(i,a)=>o2(i,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Do extends Eh{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class vs extends Eh{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function TT(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function px(n,e,t){const r=new Map;pe(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,a2(a,l,t[s]))}return r}function gx(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,i2(i,a,e))}return r}class Mo extends Eh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class kg extends Eh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&c2(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Dl(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Dl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=gT();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=t.has(s.key)?null:l;const c=ET(a,l);c!==null&&r.set(s.key,c),a.isValidDocument()||a.convertToNoDocument(ye.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ke())}isEqual(e){return this.batchId===e.batchId&&lo(this.mutations,e.mutations,(t,r)=>fx(t,r))&&lo(this.baseMutations,e.baseMutations,(t,r)=>fx(t,r))}}class Rg{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){pe(e.mutations.length===r.length);let s=function(){return n2}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new Rg(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IT{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d2{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wt,We;function ST(n){switch(n){default:return ce();case U.CANCELLED:case U.UNKNOWN:case U.DEADLINE_EXCEEDED:case U.RESOURCE_EXHAUSTED:case U.INTERNAL:case U.UNAVAILABLE:case U.UNAUTHENTICATED:return!1;case U.INVALID_ARGUMENT:case U.NOT_FOUND:case U.ALREADY_EXISTS:case U.PERMISSION_DENIED:case U.FAILED_PRECONDITION:case U.ABORTED:case U.OUT_OF_RANGE:case U.UNIMPLEMENTED:case U.DATA_LOSS:return!0}}function CT(n){if(n===void 0)return Lt("GRPC error has no .code"),U.UNKNOWN;switch(n){case Wt.OK:return U.OK;case Wt.CANCELLED:return U.CANCELLED;case Wt.UNKNOWN:return U.UNKNOWN;case Wt.DEADLINE_EXCEEDED:return U.DEADLINE_EXCEEDED;case Wt.RESOURCE_EXHAUSTED:return U.RESOURCE_EXHAUSTED;case Wt.INTERNAL:return U.INTERNAL;case Wt.UNAVAILABLE:return U.UNAVAILABLE;case Wt.UNAUTHENTICATED:return U.UNAUTHENTICATED;case Wt.INVALID_ARGUMENT:return U.INVALID_ARGUMENT;case Wt.NOT_FOUND:return U.NOT_FOUND;case Wt.ALREADY_EXISTS:return U.ALREADY_EXISTS;case Wt.PERMISSION_DENIED:return U.PERMISSION_DENIED;case Wt.FAILED_PRECONDITION:return U.FAILED_PRECONDITION;case Wt.ABORTED:return U.ABORTED;case Wt.OUT_OF_RANGE:return U.OUT_OF_RANGE;case Wt.UNIMPLEMENTED:return U.UNIMPLEMENTED;case Wt.DATA_LOSS:return U.DATA_LOSS;default:return ce()}}(We=Wt||(Wt={}))[We.OK=0]="OK",We[We.CANCELLED=1]="CANCELLED",We[We.UNKNOWN=2]="UNKNOWN",We[We.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",We[We.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",We[We.NOT_FOUND=5]="NOT_FOUND",We[We.ALREADY_EXISTS=6]="ALREADY_EXISTS",We[We.PERMISSION_DENIED=7]="PERMISSION_DENIED",We[We.UNAUTHENTICATED=16]="UNAUTHENTICATED",We[We.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",We[We.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",We[We.ABORTED=10]="ABORTED",We[We.OUT_OF_RANGE=11]="OUT_OF_RANGE",We[We.UNIMPLEMENTED=12]="UNIMPLEMENTED",We[We.INTERNAL=13]="INTERNAL",We[We.UNAVAILABLE=14]="UNAVAILABLE",We[We.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NT(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h2=new Ui([4294967295,4294967295],0);function yx(n){const e=NT().encode(n),t=new AE;return t.update(e),new Uint8Array(t.digest())}function vx(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Ui([t,r],0),new Ui([s,i],0)]}class Dg{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new xl(`Invalid padding: ${t}`);if(r<0)throw new xl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new xl(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new xl(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Ui.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Ui.fromNumber(r)));return s.compare(h2)===1&&(s=new Ui([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=yx(e),[r,s]=vx(t);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);if(!this.de(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Dg(i,s,t);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.Ie===0)return;const t=yx(e),[r,s]=vx(t);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);this.Ae(a)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class xl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Mc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Dc(ye.min(),s,new ct(Ie),Kn(),ke())}}class Mc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Mc(r,t,ke(),ke(),ke())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class AT{constructor(e,t){this.targetId=e,this.me=t}}class kT{constructor(e,t,r=Dt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class xx{constructor(){this.fe=0,this.ge=wx(),this.pe=Dt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ke(),t=ke(),r=ke();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ce()}}),new Mc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=wx()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,pe(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class m2{constructor(e){this.Le=e,this.Be=new Map,this.ke=Kn(),this.qe=bx(),this.Qe=new ct(Ie)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:ce()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(Vd(i))if(r===0){const a=new oe(i.path);this.Ue(t,a,ft.newNoDocument(a,ye.min()))}else pe(r===1);else{const a=this.Ye(t);if(a!==r){const l=this.Ze(e),c=l?this.Xe(l,e,a):1;if(c!==0){this.je(t);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,d)}Fd==null||Fd.et(function(h,m,p,y,_){var T,E,x,v,S,P;const M={localCacheCount:h,existenceFilterCount:m.count,databaseId:p.database,projectId:p.projectId},$=m.unchangedNames;return $&&(M.bloomFilter={applied:_===0,hashCount:(T=$==null?void 0:$.hashCount)!==null&&T!==void 0?T:0,bitmapLength:(v=(x=(E=$==null?void 0:$.bits)===null||E===void 0?void 0:E.bitmap)===null||x===void 0?void 0:x.length)!==null&&v!==void 0?v:0,padding:(P=(S=$==null?void 0:$.bits)===null||S===void 0?void 0:S.padding)!==null&&P!==void 0?P:0,mightContain:I=>{var b;return(b=y==null?void 0:y.mightContain(I))!==null&&b!==void 0&&b}}),M}(a,e.me,this.Le.tt(),l,c))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,l;try{a=ls(r).toUint8Array()}catch(c){if(c instanceof JE)return gr("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new Dg(a,s,i)}catch(c){return gr(c instanceof xl?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.Ie===0?null:l}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const a=this.Le.tt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,a)=>{const l=this.Je(a);if(l){if(i.current&&Vd(l.target)){const c=new oe(l.target.path);this.ke.get(c)!==null||this.it(a,c)||this.Ue(a,c,ft.newNoDocument(c,e))}i.be&&(t.set(a,i.ve()),i.Ce())}});let r=ke();this.qe.forEach((i,a)=>{let l=!0;a.forEachWhile(c=>{const d=this.Je(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.ke.forEach((i,a)=>a.setReadTime(e));const s=new Dc(e,t,this.Qe,this.ke,r);return this.ke=Kn(),this.qe=bx(),this.Qe=new ct(Ie),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new xx,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new st(Ie),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||X("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new xx),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function bx(){return new ct(oe.comparator)}function wx(){return new ct(oe.comparator)}const f2=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),p2=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),g2=(()=>({and:"AND",or:"OR"}))();class y2{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Zf(n,e){return n.useProto3Json||Ac(e)?e:{value:e}}function go(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function PT(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function v2(n,e){return go(n,e.toTimestamp())}function Ft(n){return pe(!!n),ye.fromTimestamp(function(t){const r=os(t);return new Ct(r.seconds,r.nanos)}(n))}function Mg(n,e){return ep(n,e).canonicalString()}function ep(n,e){const t=function(s){return new Ue(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function RT(n){const e=Ue.fromString(n);return pe(BT(e)),e}function dc(n,e){return Mg(n.databaseId,e.path)}function Fr(n,e){const t=RT(e);if(t.get(1)!==n.databaseId.projectId)throw new Z(U.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Z(U.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new oe(MT(t))}function jT(n,e){return Mg(n.databaseId,e)}function DT(n){const e=RT(n);return e.length===4?Ue.emptyPath():MT(e)}function tp(n){return new Ue(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function MT(n){return pe(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function _x(n,e,t){return{name:dc(n,e),fields:t.value.mapValue.fields}}function VT(n,e,t){const r=Fr(n,e.name),s=Ft(e.updateTime),i=e.createTime?Ft(e.createTime):ye.min(),a=new yn({mapValue:{fields:e.fields}}),l=ft.newFoundDocument(r,s,i,a);return t&&l.setHasCommittedMutations(),t?l.setHasCommittedMutations():l}function x2(n,e){return"found"in e?function(r,s){pe(!!s.found),s.found.name,s.found.updateTime;const i=Fr(r,s.found.name),a=Ft(s.found.updateTime),l=s.found.createTime?Ft(s.found.createTime):ye.min(),c=new yn({mapValue:{fields:s.found.fields}});return ft.newFoundDocument(i,a,l,c)}(n,e):"missing"in e?function(r,s){pe(!!s.missing),pe(!!s.readTime);const i=Fr(r,s.missing),a=Ft(s.readTime);return ft.newNoDocument(i,a)}(n,e):ce()}function b2(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:ce()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,h){return d.useProto3Json?(pe(h===void 0||typeof h=="string"),Dt.fromBase64String(h||"")):(pe(h===void 0||h instanceof Buffer||h instanceof Uint8Array),Dt.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(d){const h=d.code===void 0?U.UNKNOWN:CT(d.code);return new Z(h,d.message||"")}(a);t=new kT(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Fr(n,r.document.name),i=Ft(r.document.updateTime),a=r.document.createTime?Ft(r.document.createTime):ye.min(),l=new yn({mapValue:{fields:r.document.fields}}),c=ft.newFoundDocument(s,i,a,l),d=r.targetIds||[],h=r.removedTargetIds||[];t=new Xu(d,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Fr(n,r.document),i=r.readTime?Ft(r.readTime):ye.min(),a=ft.newNoDocument(s,i),l=r.removedTargetIds||[];t=new Xu([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Fr(n,r.document),i=r.removedTargetIds||[];t=new Xu([],i,s,null)}else{if(!("filter"in e))return ce();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new d2(s,i),l=r.targetId;t=new AT(l,a)}}return t}function hc(n,e){let t;if(e instanceof Do)t={update:_x(n,e.key,e.value)};else if(e instanceof Mo)t={delete:dc(n,e.key)};else if(e instanceof vs)t={update:_x(n,e.key,e.data),updateMask:S2(e.fieldMask)};else{if(!(e instanceof kg))return ce();t={verify:dc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,a){const l=a.transform;if(l instanceof fo)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof ea)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof ta)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof po)return{fieldPath:a.field.canonicalString(),increment:l.Pe};throw ce()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:v2(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ce()}(n,e.precondition)),t}function np(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Et.updateTime(Ft(i.updateTime)):i.exists!==void 0?Et.exists(i.exists):Et.none()}(e.currentDocument):Et.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(a,l){let c=null;if("setToServerValue"in l)pe(l.setToServerValue==="REQUEST_TIME"),c=new fo;else if("appendMissingElements"in l){const h=l.appendMissingElements.values||[];c=new ea(h)}else if("removeAllFromArray"in l){const h=l.removeAllFromArray.values||[];c=new ta(h)}else"increment"in l?c=new po(a,l.increment):ce();const d=_t.fromServerFormat(l.fieldPath);return new jc(d,c)}(n,s)):[];if(e.update){e.update.name;const s=Fr(n,e.update.name),i=new yn({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=function(c){const d=c.fieldPaths||[];return new Gn(d.map(h=>_t.fromServerFormat(h)))}(e.updateMask);return new vs(s,i,a,t,r)}return new Do(s,i,t,r)}if(e.delete){const s=Fr(n,e.delete);return new Mo(s,t)}if(e.verify){const s=Fr(n,e.verify);return new kg(s,t)}return ce()}function w2(n,e){return n&&n.length>0?(pe(e!==void 0),n.map(t=>function(s,i){let a=s.updateTime?Ft(s.updateTime):Ft(i);return a.isEqual(ye.min())&&(a=Ft(i)),new l2(a,s.transformResults||[])}(t,e))):[]}function LT(n,e){return{documents:[jT(n,e.path)]}}function Th(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=jT(n,s);const i=function(d){if(d.length!==0)return UT(tt.create(d,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const a=function(d){if(d.length!==0)return d.map(h=>function(p){return{field:Ms(p.field),direction:E2(p.dir)}}(h))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=Zf(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:t,parent:s}}function OT(n,e,t,r){const{_t:s,parent:i}=Th(n,e),a={},l=[];let c=0;return t.forEach(d=>{const h=r?d.alias:"aggregate_"+c++;a[h]=d.alias,d.aggregateType==="count"?l.push({alias:h,count:{}}):d.aggregateType==="avg"?l.push({alias:h,avg:{field:Ms(d.fieldPath)}}):d.aggregateType==="sum"&&l.push({alias:h,sum:{field:Ms(d.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:l,structuredQuery:s.structuredQuery},parent:s.parent},ut:a,parent:i}}function FT(n){let e=DT(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){pe(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(m){const p=$T(m);return p instanceof tt&&Sg(p)?p.getFilters():[p]}(t.where));let a=[];t.orderBy&&(a=function(m){return m.map(p=>function(_){return new uc(Ca(_.field),function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction))}(p))}(t.orderBy));let l=null;t.limit&&(l=function(m){let p;return p=typeof m=="object"?m.value:m,Ac(p)?null:p}(t.limit));let c=null;t.startAt&&(c=function(m){const p=!!m.before,y=m.values||[];return new ai(y,p)}(t.startAt));let d=null;return t.endAt&&(d=function(m){const p=!m.before,y=m.values||[];return new ai(y,p)}(t.endAt)),lT(e,s,a,i,l,"F",c,d)}function _2(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ce()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function $T(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Ca(t.unaryFilter.field);return Be.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ca(t.unaryFilter.field);return Be.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ca(t.unaryFilter.field);return Be.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Ca(t.unaryFilter.field);return Be.create(a,"!=",{nullValue:"NULL_VALUE"});default:return ce()}}(n):n.fieldFilter!==void 0?function(t){return Be.create(Ca(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ce()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return tt.create(t.compositeFilter.filters.map(r=>$T(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ce()}}(t.compositeFilter.op))}(n):ce()}function E2(n){return f2[n]}function T2(n){return p2[n]}function I2(n){return g2[n]}function Ms(n){return{fieldPath:n.canonicalString()}}function Ca(n){return _t.fromServerFormat(n.fieldPath)}function UT(n){return n instanceof Be?function(t){if(t.op==="=="){if(ix(t.value))return{unaryFilter:{field:Ms(t.field),op:"IS_NAN"}};if(sx(t.value))return{unaryFilter:{field:Ms(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(ix(t.value))return{unaryFilter:{field:Ms(t.field),op:"IS_NOT_NAN"}};if(sx(t.value))return{unaryFilter:{field:Ms(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ms(t.field),op:T2(t.op),value:t.value}}}(n):n instanceof tt?function(t){const r=t.getFilters().map(s=>UT(s));return r.length===1?r[0]:{compositeFilter:{op:I2(t.op),filters:r}}}(n):ce()}function S2(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function BT(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xr{constructor(e,t,r,s,i=ye.min(),a=ye.min(),l=Dt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new Xr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Xr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Xr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Xr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zT{constructor(e){this.ct=e}}function C2(n,e){let t;if(e.document)t=VT(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=oe.fromSegments(e.noDocument.path),s=ra(e.noDocument.readTime);t=ft.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ce();{const r=oe.fromSegments(e.unknownDocument.path),s=ra(e.unknownDocument.version);t=ft.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Ct(s[0],s[1]);return ye.fromTimestamp(i)}(e.readTime)),t}function Ex(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:$d(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,a){return{name:dc(i,a.key),fields:a.data.value.mapValue.fields,updateTime:go(i,a.version.toTimestamp()),createTime:go(i,a.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:na(e.version)};else{if(!e.isUnknownDocument())return ce();r.unknownDocument={path:t.path.toArray(),version:na(e.version)}}return r}function $d(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function na(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ra(n){const e=new Ct(n.seconds,n.nanoseconds);return ye.fromTimestamp(e)}function Ri(n,e){const t=(e.baseMutations||[]).map(i=>np(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const a=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const l=e.mutations[i+1];a.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>np(n.ct,i)),s=Ct.fromMillis(e.localWriteTimeMs);return new Pg(e.batchId,s,t,r)}function bl(n){const e=ra(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ra(n.lastLimboFreeSnapshotVersion):ye.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return pe(i.documents.length===1),Rn(jo(DT(i.documents[0])))}(n.query):function(i){return Rn(FT(i))}(n.query),new Xr(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Dt.fromBase64String(n.resumeToken))}function qT(n,e){const t=na(e.snapshotVersion),r=na(e.lastLimboFreeSnapshotVersion);let s;s=Vd(e.target)?LT(n.ct,e.target):Th(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Zi(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Vg(n){const e=FT({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Od(e,e.limit,"L"):e}function Rm(n,e){return new jg(e.largestBatchId,np(n.ct,e.overlayMutation))}function Tx(n,e){const t=e.path.lastSegment();return[n,Pn(e.path.popLast()),t]}function Ix(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:na(r.readTime),documentKey:Pn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N2{getBundleMetadata(e,t){return Sx(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:ra(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Sx(e).put(function(s){return{bundleId:s.id,createTime:na(Ft(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return Cx(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Vg(i.bundledQuery),readTime:ra(i.readTime)}}(r)})}saveNamedQuery(e,t){return Cx(e).put(function(s){return{name:s.name,readTime:na(Ft(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Sx(n){return tn(n,"bundles")}function Cx(n){return tn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ih{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Ih(e,r)}getOverlay(e,t){return al(e).get(Tx(this.userId,t)).next(r=>r?Rm(this.serializer,r):null)}getOverlays(e,t){const r=jr();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,a)=>{const l=new jg(t,a);s.push(this.ht(e,l))}),O.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(a=>s.add(Pn(a.getCollectionPath())));const i=[];return s.forEach(a=>{const l=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);i.push(al(e).j("collectionPathOverlayIndex",l))}),O.waitFor(i)}getOverlaysForCollection(e,t,r){const s=jr(),i=Pn(t),a=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return al(e).U("collectionPathOverlayIndex",a).next(l=>{for(const c of l){const d=Rm(this.serializer,c);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=jr();let a;const l=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return al(e).J({index:"collectionGroupOverlayIndex",range:l},(c,d,h)=>{const m=Rm(this.serializer,d);i.size()<s||m.largestBatchId===a?(i.set(m.getKey(),m),a=m.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return al(e).put(function(s,i,a){const[l,c,d]=Tx(i,a.mutation.key);return{userId:i,collectionPath:c,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:hc(s.ct,a.mutation)}}(this.serializer,this.userId,t))}}function al(n){return tn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A2{Pt(e){return tn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Dt.fromUint8Array(r):Dt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ji{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(bt(e.integerValue));else if("doubleValue"in e){const r=bt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),ac(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=os(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ls(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?XE(e)?this.dt(t,Number.MAX_SAFE_INTEGER):wh(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):ce()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const a="value",l=((s=(r=i[a].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(bt(l)),this.Vt(a,t),this.Tt(i[a],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),oe.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}ji.vt=new ji;function k2(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Nx(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const a=k2(255&r[i]);if(s+=a,a!==8)break}return s}(n);return Math.ceil(e/8)}class P2{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=Nx(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=Nx(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class R2{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class j2{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class ol{constructor(){this.jt=new P2,this.Ht=new R2(this.jt),this.Jt=new j2(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Di(this.indexId,this.documentKey,this.arrayValue,r)}}function Ts(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Ax(n.arrayValue,e.arrayValue),t!==0?t:(t=Ax(n.directionalValue,e.directionalValue),t!==0?t:oe.comparator(n.documentKey,e.documentKey)))}function Ax(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kx{constructor(e){this.Xt=new st((t,r)=>_t.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(pe(e.collectionGroup===this.collectionId),this.nn)return!1;const t=Wf(e);if(t!==void 0&&!this.sn(t))return!1;const r=Ai(e);let s=new Set,i=0,a=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const l=this.Xt.getIterator().getNext();if(!s.has(l.field.canonicalString())){const c=r[i];if(!this.on(l,c)||!this._n(this.en[a++],c))return!1}++i}for(;i<r.length;++i){const l=r[i];if(a>=this.en.length||!this._n(this.en[a++],l))return!1}return!0}an(){if(this.nn)return null;let e=new st(_t.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Bi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Bi(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Bi(r.field,r.dir==="asc"?0:1)));return new co(co.UNKNOWN_ID,this.collectionId,t,uo.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WT(n){var e,t;if(pe(n instanceof Be||n instanceof tt),n instanceof Be){if(n instanceof oT){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>Be.create(n.field,"==",i)))||[];return tt.create(s,"or")}return n}const r=n.filters.map(s=>WT(s));return tt.create(r,n.op)}function D2(n){if(n.getFilters().length===0)return[];const e=ip(WT(n));return pe(HT(e)),rp(e)||sp(e)?[e]:e.getFilters()}function rp(n){return n instanceof Be}function sp(n){return n instanceof tt&&Sg(n)}function HT(n){return rp(n)||sp(n)||function(t){if(t instanceof tt&&Qf(t)){for(const r of t.getFilters())if(!rp(r)&&!sp(r))return!1;return!0}return!1}(n)}function ip(n){if(pe(n instanceof Be||n instanceof tt),n instanceof Be)return n;if(n.filters.length===1)return ip(n.filters[0]);const e=n.filters.map(r=>ip(r));let t=tt.create(e,n.op);return t=Ud(t),HT(t)?t:(pe(t instanceof tt),pe(mo(t)),pe(t.filters.length>1),t.filters.reduce((r,s)=>Lg(r,s)))}function Lg(n,e){let t;return pe(n instanceof Be||n instanceof tt),pe(e instanceof Be||e instanceof tt),t=n instanceof Be?e instanceof Be?function(s,i){return tt.create([s,i],"and")}(n,e):Px(n,e):e instanceof Be?Px(e,n):function(s,i){if(pe(s.filters.length>0&&i.filters.length>0),mo(s)&&mo(i))return sT(s,i.getFilters());const a=Qf(s)?s:i,l=Qf(s)?i:s,c=a.filters.map(d=>Lg(d,l));return tt.create(c,"or")}(n,e),Ud(t)}function Px(n,e){if(mo(e))return sT(e,n.getFilters());{const t=e.filters.map(r=>Lg(n,r));return tt.create(t,"or")}}function Ud(n){if(pe(n instanceof Be||n instanceof tt),n instanceof Be)return n;const e=n.getFilters();if(e.length===1)return Ud(e[0]);if(nT(n))return n;const t=e.map(s=>Ud(s)),r=[];return t.forEach(s=>{s instanceof Be?r.push(s):s instanceof tt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:tt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M2{constructor(){this.un=new Og}addToCollectionParentIndex(e,t){return this.un.add(t),O.resolve()}getCollectionParents(e,t){return O.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return O.resolve()}deleteFieldIndex(e,t){return O.resolve()}deleteAllFieldIndexes(e){return O.resolve()}createTargetIndexes(e,t){return O.resolve()}getDocumentsMatchingTarget(e,t){return O.resolve(null)}getIndexType(e,t){return O.resolve(0)}getFieldIndexes(e,t){return O.resolve([])}getNextCollectionGroupToUpdate(e){return O.resolve(null)}getMinOffset(e,t){return O.resolve(ar.min())}getMinOffsetFromCollectionGroup(e,t){return O.resolve(ar.min())}updateCollectionGroup(e,t,r){return O.resolve()}updateIndexEntries(e,t){return O.resolve()}}class Og{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new st(Ue.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new st(Ue.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tu=new Uint8Array(0);class V2{constructor(e,t){this.databaseId=t,this.cn=new Og,this.ln=new ys(r=>Zi(r),(r,s)=>kc(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Pn(s)};return Rx(e).put(i)}return O.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[OE(t),""],!1,!0);return Rx(e).U(s).next(i=>{for(const a of i){if(a.collectionId!==t)break;r.push(Rr(a.parent))}return r})}addFieldIndex(e,t){const r=ll(e),s=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const a=_a(e);return i.next(l=>{a.put(Ix(l,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=ll(e),s=_a(e),i=wa(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=ll(e),r=wa(e),s=_a(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return O.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new kx(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=wa(e);let s=!0;const i=new Map;return O.forEach(this.hn(t),a=>this.Pn(e,a).next(l=>{s&&(s=!!l),i.set(a,l)})).next(()=>{if(s){let a=ke();const l=[];return O.forEach(i,(c,d)=>{X("IndexedDbIndexManager",`Using index ${function(S){return`id=${S.indexId}|cg=${S.collectionGroup}|f=${S.fields.map(P=>`${P.fieldPath}:${P.kind}`).join(",")}`}(c)} to execute ${Zi(t)}`);const h=function(S,P){const M=Wf(P);if(M===void 0)return null;for(const $ of Ld(S,M.fieldPath))switch($.op){case"array-contains-any":return $.value.arrayValue.values||[];case"array-contains":return[$.value]}return null}(d,c),m=function(S,P){const M=new Map;for(const $ of Ai(P))for(const I of Ld(S,$.fieldPath))switch(I.op){case"==":case"in":M.set($.fieldPath.canonicalString(),I.value);break;case"not-in":case"!=":return M.set($.fieldPath.canonicalString(),I.value),Array.from(M.values())}return null}(d,c),p=function(S,P){const M=[];let $=!0;for(const I of Ai(P)){const b=I.kind===0?ux(S,I.fieldPath,S.startAt):dx(S,I.fieldPath,S.startAt);M.push(b.value),$&&($=b.inclusive)}return new ai(M,$)}(d,c),y=function(S,P){const M=[];let $=!0;for(const I of Ai(P)){const b=I.kind===0?dx(S,I.fieldPath,S.endAt):ux(S,I.fieldPath,S.endAt);M.push(b.value),$&&($=b.inclusive)}return new ai(M,$)}(d,c),_=this.In(c,d,p),T=this.In(c,d,y),E=this.Tn(c,d,m),x=this.En(c.indexId,h,_,p.inclusive,T,y.inclusive,E);return O.forEach(x,v=>r.G(v,t.limit).next(S=>{S.forEach(P=>{const M=oe.fromSegments(P.documentKey);a.has(M)||(a=a.add(M),l.push(M))})}))}).next(()=>l)}return O.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=D2(tt.create(e.filters,"and")).map(r=>Jf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,a,l){const c=(t!=null?t.length:1)*Math.max(r.length,i.length),d=c/(t!=null?t.length:1),h=[];for(let m=0;m<c;++m){const p=t?this.dn(t[m/d]):Tu,y=this.An(e,p,r[m%d],s),_=this.Rn(e,p,i[m%d],a),T=l.map(E=>this.An(e,p,E,!0));h.push(...this.createRange(y,_,T))}return h}An(e,t,r,s){const i=new Di(e,oe.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Di(e,oe.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new kx(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let a=null;for(const l of i)r.rn(l)&&(!a||l.fields.length>a.fields.length)&&(a=l);return a})}getIndexType(e,t){let r=2;const s=this.hn(t);return O.forEach(s,i=>this.Pn(e,i).next(a=>{a?r!==0&&a.fields.length<function(c){let d=new st(_t.comparator),h=!1;for(const m of c.filters)for(const p of m.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?h=!0:d=d.add(p.field));for(const m of c.orderBy)m.field.isKeyField()||(d=d.add(m.field));return d.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(a){return a.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new ol;for(const s of Ai(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const a=r.Yt(s.kind);ji.vt.It(i,a)}return r.zt()}dn(e){const t=new ol;return ji.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new ol;return ji.vt.It(Xi(this.databaseId,t),r.Yt(function(i){const a=Ai(i);return a.length===0?0:a[a.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new ol);let i=0;for(const a of Ai(e)){const l=r[i++];for(const c of s)if(this.fn(t,a.fieldPath)&&cc(l))s=this.gn(s,a,l);else{const d=c.Yt(a.kind);ji.vt.It(l,d)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const a of r.arrayValue.values||[])for(const l of s){const c=new ol;c.seed(l.zt()),ji.vt.It(a,c.Yt(t.kind)),i.push(c)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof Be&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=ll(e),s=_a(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const a=[];return O.forEach(i,l=>s.get([l.indexId,this.uid]).next(c=>{a.push(function(h,m){const p=m?new uo(m.sequenceNumber,new ar(ra(m.readTime),new oe(Rr(m.documentKey)),m.largestBatchId)):uo.empty(),y=h.fields.map(([_,T])=>new Bi(_t.fromServerFormat(_),T));return new co(h.indexId,h.collectionGroup,y,p)}(l,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Ie(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=ll(e),i=_a(e);return this.yn(e).next(a=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(l=>O.forEach(l,c=>i.put(Ix(c.indexId,this.uid,a,r)))))}updateIndexEntries(e,t){const r=new Map;return O.forEach(t,(s,i)=>{const a=r.get(s.collectionGroup);return(a?O.resolve(a):this.getFieldIndexes(e,s.collectionGroup)).next(l=>(r.set(s.collectionGroup,l),O.forEach(l,c=>this.wn(e,s,c).next(d=>{const h=this.Sn(i,c);return d.isEqual(h)?O.resolve():this.bn(e,i,c,d,h)}))))})}Dn(e,t,r,s){return wa(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return wa(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=wa(e);let i=new st(Ts);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(a,l)=>{i=i.add(new Di(r.indexId,t,l.arrayValue,l.directionalValue))}).next(()=>i)}Sn(e,t){let r=new st(Ts);const s=this.Vn(t,e);if(s==null)return r;const i=Wf(t);if(i!=null){const a=e.data.field(i.fieldPath);if(cc(a))for(const l of a.arrayValue.values||[])r=r.add(new Di(t.indexId,e.key,this.dn(l),s))}else r=r.add(new Di(t.indexId,e.key,Tu,s));return r}bn(e,t,r,s,i){X("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(c,d,h,m,p){const y=c.getIterator(),_=d.getIterator();let T=ba(y),E=ba(_);for(;T||E;){let x=!1,v=!1;if(T&&E){const S=h(T,E);S<0?v=!0:S>0&&(x=!0)}else T!=null?v=!0:x=!0;x?(m(E),E=ba(_)):v?(p(T),T=ba(y)):(T=ba(y),E=ba(_))}}(s,i,Ts,l=>{a.push(this.Dn(e,t,r,l))},l=>{a.push(this.vn(e,t,r,l))}),O.waitFor(a)}yn(e){let t=1;return _a(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((a,l)=>Ts(a,l)).filter((a,l,c)=>!l||Ts(a,c[l-1])!==0);const s=[];s.push(e);for(const a of r){const l=Ts(a,e),c=Ts(a,t);if(l===0)s[0]=e.Zt();else if(l>0&&c<0)s.push(a),s.push(a.Zt());else if(c>0)break}s.push(t);const i=[];for(let a=0;a<s.length;a+=2){if(this.Cn(s[a],s[a+1]))return[];const l=[s[a].indexId,this.uid,s[a].arrayValue,s[a].directionalValue,Tu,[]],c=[s[a+1].indexId,this.uid,s[a+1].arrayValue,s[a+1].directionalValue,Tu,[]];i.push(IDBKeyRange.bound(l,c))}return i}Cn(e,t){return Ts(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(jx)}getMinOffset(e,t){return O.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||ce())).next(jx)}}function Rx(n){return tn(n,"collectionParents")}function wa(n){return tn(n,"indexEntries")}function ll(n){return tn(n,"indexConfiguration")}function _a(n){return tn(n,"indexState")}function jx(n){pe(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Eg(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new ar(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dx={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class An{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new An(e,An.DEFAULT_COLLECTION_PERCENTILE,An.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GT(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],a=IDBKeyRange.only(t.batchId);let l=0;const c=r.J({range:a},(h,m,p)=>(l++,p.delete()));i.push(c.next(()=>{pe(l===1)}));const d=[];for(const h of t.mutations){const m=WE(e,h.key.path,t.batchId);i.push(s.delete(m)),d.push(h.key)}return O.waitFor(i).next(()=>d)}function Bd(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ce();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */An.DEFAULT_COLLECTION_PERCENTILE=10,An.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,An.DEFAULT=new An(41943040,An.DEFAULT_COLLECTION_PERCENTILE,An.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),An.DISABLED=new An(-1,0,0);class Sh{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){pe(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Sh(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Is(e).J({index:"userMutationsIndex",range:r},(s,i,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Na(e),a=Is(e);return a.add({}).next(l=>{pe(typeof l=="number");const c=new Pg(l,t,r,s),d=function(y,_,T){const E=T.baseMutations.map(v=>hc(y.ct,v)),x=T.mutations.map(v=>hc(y.ct,v));return{userId:_,batchId:T.batchId,localWriteTimeMs:T.localWriteTime.toMillis(),baseMutations:E,mutations:x}}(this.serializer,this.userId,c),h=[];let m=new st((p,y)=>Ie(p.canonicalString(),y.canonicalString()));for(const p of s){const y=WE(this.userId,p.key.path,l);m=m.add(p.key.path.popLast()),h.push(a.put(d)),h.push(i.put(y,Tj))}return m.forEach(p=>{h.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Fn[l]=c.keys()}),O.waitFor(h).next(()=>c)})}lookupMutationBatch(e,t){return Is(e).get(t).next(r=>r?(pe(r.userId===this.userId),Ri(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?O.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Is(e).J({index:"userMutationsIndex",range:s},(a,l,c)=>{l.userId===this.userId&&(pe(l.batchId>=r),i=Ri(this.serializer,l)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Is(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,a)=>{r=i.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Is(e).U("userMutationsIndex",t).next(r=>r.map(s=>Ri(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Gu(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Na(e).J({range:s},(a,l,c)=>{const[d,h,m]=a,p=Rr(h);if(d===this.userId&&t.path.isEqual(p))return Is(e).get(m).next(y=>{if(!y)throw ce();pe(y.userId===this.userId),i.push(Ri(this.serializer,y))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new st(Ie);const s=[];return t.forEach(i=>{const a=Gu(this.userId,i.path),l=IDBKeyRange.lowerBound(a),c=Na(e).J({range:l},(d,h,m)=>{const[p,y,_]=d,T=Rr(y);p===this.userId&&i.path.isEqual(T)?r=r.add(_):m.done()});s.push(c)}),O.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Gu(this.userId,r),a=IDBKeyRange.lowerBound(i);let l=new st(Ie);return Na(e).J({range:a},(c,d,h)=>{const[m,p,y]=c,_=Rr(p);m===this.userId&&r.isPrefixOf(_)?_.length===s&&(l=l.add(y)):h.done()}).next(()=>this.xn(e,l))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Is(e).get(i).next(a=>{if(a===null)throw ce();pe(a.userId===this.userId),r.push(Ri(this.serializer,a))}))}),O.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return GT(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),O.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return O.resolve();const r=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return Na(e).J({range:r},(i,a,l)=>{if(i[0]===this.userId){const c=Rr(i[1]);s.push(c)}else l.done()}).next(()=>{pe(s.length===0)})})}containsKey(e,t){return KT(e,this.userId,t)}Nn(e){return QT(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function KT(n,e,t){const r=Gu(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let a=!1;return Na(n).J({range:i,H:!0},(l,c,d)=>{const[h,m,p]=l;h===e&&m===s&&(a=!0),d.done()}).next(()=>a)}function Is(n){return tn(n,"mutations")}function Na(n){return tn(n,"documentMutations")}function QT(n){return tn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new sa(0)}static kn(){return new sa(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L2{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new sa(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>ye.fromTimestamp(new Ct(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ea(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(pe(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Ea(e).J((a,l)=>{const c=bl(l);c.sequenceNumber<=t&&r.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>O.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Ea(e).J((r,s)=>{const i=bl(s);t(i)})}qn(e){return Mx(e).get("targetGlobalKey").next(t=>(pe(t!==null),t))}Qn(e,t){return Mx(e).put("targetGlobalKey",t)}Kn(e,t){return Ea(e).put(qT(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Zi(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Ea(e).J({range:s,index:"queryTargetsIndex"},(a,l,c)=>{const d=bl(l);kc(t,d.target)&&(i=d,c.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Vs(e);return t.forEach(a=>{const l=Pn(a.path);s.push(i.put({targetId:r,path:l})),s.push(this.referenceDelegate.addReference(e,r,a))}),O.waitFor(s)}removeMatchingKeys(e,t,r){const s=Vs(e);return O.forEach(t,i=>{const a=Pn(i.path);return O.waitFor([s.delete([r,a]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Vs(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Vs(e);let i=ke();return s.J({range:r,H:!0},(a,l,c)=>{const d=Rr(a[1]),h=new oe(d);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=Pn(t.path),s=IDBKeyRange.bound([r],[OE(r)],!1,!0);let i=0;return Vs(e).J({index:"documentTargetsIndex",H:!0,range:s},([a,l],c,d)=>{a!==0&&(i++,d.done())}).next(()=>i>0)}ot(e,t){return Ea(e).get(t).next(r=>r?bl(r):null)}}function Ea(n){return tn(n,"targets")}function Mx(n){return tn(n,"targetGlobal")}function Vs(n){return tn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vx([n,e],[t,r]){const s=Ie(n,t);return s===0?Ie(e,r):s}class O2{constructor(e){this.Un=e,this.buffer=new st(Vx),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Vx(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class YT{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){X("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){gi(t)?X("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await pi(t)}await this.Hn(3e5)})}}class F2{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return O.resolve(Hn.oe);const r=new O2(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(X("LruGarbageCollector","Garbage collection skipped; disabled"),O.resolve(Dx)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(X("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Dx):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,a,l,c,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(X("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,a=Date.now(),this.nthSequenceNumber(e,s))).next(m=>(r=m,l=Date.now(),this.removeTargets(e,r,t))).next(m=>(i=m,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>(d=Date.now(),Ia()<=$e.DEBUG&&X("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${i} targets in `+(c-l)+`ms
	Removed ${m} documents in `+(d-c)+`ms
Total Duration: ${d-h}ms`),O.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:m})))}}function JT(n,e){return new F2(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $2{constructor(e,t){this.db=e,this.garbageCollector=JT(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Iu(e,r)}removeReference(e,t,r){return Iu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Iu(e,t)}nr(e,t){return function(s,i){let a=!1;return QT(s).Y(l=>KT(s,l,i).next(c=>(c&&(a=!0),O.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(a,l)=>{if(l<=t){const c=this.nr(e,a).next(d=>{if(!d)return i++,r.getEntry(e,a).next(()=>(r.removeEntry(a,ye.min()),Vs(e).delete(function(m){return[0,Pn(m.path)]}(a))))});s.push(c)}}).next(()=>O.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Iu(e,t)}tr(e,t){const r=Vs(e);let s,i=Hn.oe;return r.J({index:"documentTargetsIndex"},([a,l],{path:c,sequenceNumber:d})=>{a===0?(i!==Hn.oe&&t(new oe(Rr(s)),i),i=d,s=c):i=Hn.oe}).next(()=>{i!==Hn.oe&&t(new oe(Rr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Iu(n,e){return Vs(n).put(function(r,s){return{targetId:0,path:Pn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XT{constructor(){this.changes=new ys(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ft.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?O.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U2{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ti(e).put(r)}removeEntry(e,t,r){return Ti(e).delete(function(i,a){const l=i.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],$d(a),l[l.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=ft.newInvalidDocument(t);return Ti(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(cl(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:ft.newInvalidDocument(t)};return Ti(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(cl(t))},(s,i)=>{r={document:this.ir(t,i),size:Bd(i)}}).next(()=>r)}getEntries(e,t){let r=Kn();return this._r(e,t,(s,i)=>{const a=this.ir(s,i);r=r.insert(s,a)}).next(()=>r)}ar(e,t){let r=Kn(),s=new ct(oe.comparator);return this._r(e,t,(i,a)=>{const l=this.ir(i,a);r=r.insert(i,l),s=s.insert(i,Bd(a))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return O.resolve();let s=new st(Fx);t.forEach(c=>s=s.add(c));const i=IDBKeyRange.bound(cl(s.first()),cl(s.last())),a=s.getIterator();let l=a.getNext();return Ti(e).J({index:"documentKeyIndex",range:i},(c,d,h)=>{const m=oe.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;l&&Fx(l,m)<0;)r(l,null),l=a.getNext();l&&l.isEqual(m)&&(r(l,d),l=a.hasNext()?a.getNext():null),l?h.$(cl(l)):h.done()}).next(()=>{for(;l;)r(l,null),l=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const a=t.path,l=[a.popLast().toArray(),a.lastSegment(),$d(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ti(e).U(IDBKeyRange.bound(l,c,!0)).next(d=>{i==null||i.incrementDocumentReadCount(d.length);let h=Kn();for(const m of d){const p=this.ir(oe.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);p.isFoundDocument()&&(Rc(t,p)||s.has(p.key))&&(h=h.insert(p.key,p))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=Kn();const a=Ox(t,r),l=Ox(t,ar.max());return Ti(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,l,!0)},(c,d,h)=>{const m=this.ir(oe.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(m.key,m),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new B2(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Lx(e).get("remoteDocumentGlobalKey").next(t=>(pe(!!t),t))}rr(e,t){return Lx(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=C2(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(ye.min())))return r}return ft.newInvalidDocument(e)}}function ZT(n){return new U2(n)}class B2 extends XT{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new ys(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new st((i,a)=>Ie(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{const l=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,l.readTime)),a.isValidDocument()){const c=Ex(this.cr.serializer,a);s=s.add(i.path.popLast());const d=Bd(c);r+=d-l.size,t.push(this.cr.addEntry(e,i,c))}else if(r-=l.size,this.trackRemovals){const c=Ex(this.cr.serializer,a.convertToNoDocument(ye.min()));t.push(this.cr.addEntry(e,i,c))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),O.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,a)=>{this.lr.set(i,{size:a,readTime:r.get(i).readTime})}),r))}}function Lx(n){return tn(n,"remoteDocumentGlobal")}function Ti(n){return tn(n,"remoteDocumentsV14")}function cl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Ox(n,e){const t=e.documentKey.path.toArray();return[n,$d(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Fx(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Ie(t[i],r[i]),s)return s;return s=Ie(t.length,r.length),s||(s=Ie(t[t.length-2],r[r.length-2]),s||Ie(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z2{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eI{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Dl(r.mutation,s,Gn.empty(),Ct.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ke()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ke()){const s=jr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let a=vl();return i.forEach((l,c)=>{a=a.insert(l,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=jr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ke()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,l)=>{t.set(a,l)})})}computeViews(e,t,r,s){let i=Kn();const a=jl(),l=function(){return jl()}();return t.forEach((c,d)=>{const h=r.get(d.key);s.has(d.key)&&(h===void 0||h.mutation instanceof vs)?i=i.insert(d.key,d):h!==void 0?(a.set(d.key,h.mutation.getFieldMask()),Dl(h.mutation,d,h.mutation.getFieldMask(),Ct.now())):a.set(d.key,Gn.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((d,h)=>a.set(d,h)),t.forEach((d,h)=>{var m;return l.set(d,new z2(h,(m=a.get(d))!==null&&m!==void 0?m:null))}),l))}recalculateAndSaveOverlays(e,t){const r=jl();let s=new ct((a,l)=>a-l),i=ke();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const l of a)l.keys().forEach(c=>{const d=t.get(c);if(d===null)return;let h=r.get(c)||Gn.empty();h=l.applyToLocalView(d,h),r.set(c,h);const m=(s.get(l.batchId)||ke()).add(c);s=s.insert(l.batchId,m)})}).next(()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),d=c.key,h=c.value,m=gT();h.forEach(p=>{if(!i.has(p)){const y=ET(t.get(p),r.get(p));y!==null&&m.set(p,y),i=i.add(p)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,m))}return O.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(a){return oe.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Cg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):O.resolve(jr());let l=-1,c=i;return a.next(d=>O.forEach(d,(h,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),i.get(h)?O.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{c=c.insert(h,p)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,c,d,ke())).next(h=>({batchId:l,changes:pT(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new oe(t)).next(r=>{let s=vl();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=vl();return this.indexManager.getCollectionParents(e,i).next(l=>O.forEach(l,c=>{const d=function(m,p){return new gs(p,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(h=>{h.forEach((m,p)=>{a=a.insert(m,p)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(a=>{i.forEach((c,d)=>{const h=d.getKey();a.get(h)===null&&(a=a.insert(h,ft.newInvalidDocument(h)))});let l=vl();return a.forEach((c,d)=>{const h=i.get(c);h!==void 0&&Dl(h.mutation,d,Gn.empty(),Ct.now()),Rc(t,d)&&(l=l.insert(c,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q2{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return O.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Ft(s.createTime)}}(t)),O.resolve()}getNamedQuery(e,t){return O.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Vg(s.bundledQuery),readTime:Ft(s.readTime)}}(t)),O.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W2{constructor(){this.overlays=new ct(oe.comparator),this.Ir=new Map}getOverlay(e,t){return O.resolve(this.overlays.get(t))}getOverlays(e,t){const r=jr();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),O.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),O.resolve()}getOverlaysForCollection(e,t,r){const s=jr(),i=t.length+1,a=new oe(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const c=l.getNext().value,d=c.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return O.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new ct((d,h)=>d-h);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let h=i.get(d.largestBatchId);h===null&&(h=jr(),i=i.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const l=jr(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,h)=>l.set(d,h)),!(l.size()>=s)););return O.resolve(l)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new jg(t,r));let i=this.Ir.get(t);i===void 0&&(i=ke(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H2{constructor(){this.sessionToken=Dt.EMPTY_BYTE_STRING}getSessionToken(e){return O.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,O.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fg{constructor(){this.Tr=new st(an.Er),this.dr=new st(an.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new an(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new an(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new oe(new Ue([])),r=new an(t,e),s=new an(t,e+1),i=[];return this.dr.forEachInRange([r,s],a=>{this.Vr(a),i.push(a.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new oe(new Ue([])),r=new an(t,e),s=new an(t,e+1);let i=ke();return this.dr.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){const t=new an(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class an{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return oe.comparator(e.key,t.key)||Ie(e.wr,t.wr)}static Ar(e,t){return Ie(e.wr,t.wr)||oe.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G2{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new st(an.Er)}checkEmpty(e){return O.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Pg(i,t,r,s);this.mutationQueue.push(a);for(const l of s)this.br=this.br.add(new an(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return O.resolve(a)}lookupMutationBatch(e,t){return O.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return O.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return O.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return O.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new an(t,0),s=new an(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],a=>{const l=this.Dr(a.wr);i.push(l)}),O.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new st(Ie);return t.forEach(s=>{const i=new an(s,0),a=new an(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,a],l=>{r=r.add(l.wr)})}),O.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;oe.isDocumentKey(i)||(i=i.child(""));const a=new an(new oe(i),0);let l=new st(Ie);return this.br.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(c.wr)),!0)},a),O.resolve(this.Cr(l))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){pe(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return O.forEach(t.mutations,s=>{const i=new an(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new an(t,0),s=this.br.firstAfterOrEqual(r);return O.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,O.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K2{constructor(e){this.Mr=e,this.docs=function(){return new ct(oe.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return O.resolve(r?r.document.mutableCopy():ft.newInvalidDocument(t))}getEntries(e,t){let r=Kn();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():ft.newInvalidDocument(s))}),O.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Kn();const a=t.path,l=new oe(a.child("")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:d,value:{document:h}}=c.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Eg($E(h),r)<=0||(s.has(h.key)||Rc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return O.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ce()}Or(e,t){return O.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Q2(this)}getSize(e){return O.resolve(this.size)}}class Q2 extends XT{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),O.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y2{constructor(e){this.persistence=e,this.Nr=new ys(t=>Zi(t),kc),this.lastRemoteSnapshotVersion=ye.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Fg,this.targetCount=0,this.kr=sa.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),O.resolve()}getLastRemoteSnapshotVersion(e){return O.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return O.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),O.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),O.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new sa(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,O.resolve()}updateTargetData(e,t){return this.Kn(t),O.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,O.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),O.waitFor(i).next(()=>s)}getTargetCount(e){return O.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return O.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),O.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),O.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),O.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return O.resolve(r)}containsKey(e,t){return O.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Hn(0),this.Kr=!1,this.Kr=!0,this.$r=new H2,this.referenceDelegate=e(this),this.Ur=new Y2(this),this.indexManager=new M2,this.remoteDocumentCache=function(s){return new K2(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new zT(t),this.Gr=new q2(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new W2,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new G2(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){X("MemoryPersistence","Starting transaction:",e);const s=new J2(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return O.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class J2 extends BE{constructor(e){super(),this.currentSequenceNumber=e}}class Ch{constructor(e){this.persistence=e,this.Jr=new Fg,this.Yr=null}static Zr(e){return new Ch(e)}get Xr(){if(this.Yr)return this.Yr;throw ce()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),O.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),O.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),O.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.Xr,r=>{const s=oe.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,ye.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return O.or([()=>O.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class zd{constructor(e,t){this.persistence=e,this.ti=new ys(r=>Pn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=JT(this,t)}static Zr(e,t){return new zd(e,t)}zr(){}jr(e){return O.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return O.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?O.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,a=>this.nr(e,a,t).next(l=>{l||(r++,i.removeEntry(a,ye.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),O.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),O.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),O.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),O.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Qu(e.data.value)),t}nr(e,t,r){return O.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return O.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X2{constructor(e){this.serializer=e}O(e,t,r,s){const i=new vh("createOrUpgrade",t);r<1&&s>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Zv,{unique:!0}),c.createObjectStore("documentMutations")}(e),$x(e),function(c){c.createObjectStore("remoteDocuments")}(e));let a=O.resolve();return r<3&&s>=3&&(r!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),$x(e)),a=a.next(()=>function(c){const d=c.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ye.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",h)}(i))),r<4&&s>=4&&(r!==0&&(a=a.next(()=>function(c,d){return d.store("mutations").U().next(h=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Zv,{unique:!0});const m=d.store("mutations"),p=h.map(y=>m.put(y));return O.waitFor(p)})}(e,i))),a=a.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(a=a.next(()=>this.ni(i))),r<6&&s>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(a=a.next(()=>this.ii(i))),r<8&&s>=8&&(a=a.next(()=>this.si(e,i))),r<9&&s>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(a=a.next(()=>this.oi(i))),r<11&&s>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(a=a.next(()=>{(function(c){const d=c.createObjectStore("documentOverlays",{keyPath:Vj});d.createIndex("collectionPathOverlayIndex",Lj,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",Oj,{unique:!1})})(e)})),r<13&&s>=13&&(a=a.next(()=>function(c){const d=c.createObjectStore("remoteDocumentsV14",{keyPath:Ij});d.createIndex("documentKeyIndex",Sj),d.createIndex("collectionGroupIndex",Cj)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(a=a.next(()=>this.ai(e,i))),r<15&&s>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:Rj}).createIndex("sequenceNumberIndex",jj,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:Dj}).createIndex("documentKeyIndex",Mj,{unique:!1})}(e))),r<16&&s>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(a=a.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),a}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Bd(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>O.forEach(s,i=>{const a=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",a).next(l=>O.forEach(l,c=>{pe(c.userId===i.userId);const d=Ri(this.serializer,c);return GT(e,i.userId,d).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((a,l)=>{const c=new Ue(a),d=function(m){return[0,Pn(m)]}(c);i.push(t.get(d).next(h=>h?O.resolve():(m=>t.put({targetId:0,path:Pn(m),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>O.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:Pj});const r=t.store("collectionParents"),s=new Og,i=a=>{if(s.add(a)){const l=a.lastSegment(),c=a.popLast();return r.put({collectionId:l,parent:Pn(c)})}};return t.store("remoteDocuments").J({H:!0},(a,l)=>{const c=new Ue(a);return i(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,l,c],d)=>{const h=Rr(l);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=bl(s),a=qT(this.serializer,i);return t.put(a)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,a)=>{const l=t.store("remoteDocumentsV14"),c=function(m){return m.document?new oe(Ue.fromString(m.document.name).popFirst(5)):m.noDocument?oe.fromSegments(m.noDocument.path):m.unknownDocument?oe.fromSegments(m.unknownDocument.path):ce()}(a).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(l.put(d))}).next(()=>O.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=ZT(this.serializer),i=new $g(Ch.Zr,this.serializer.ct);return r.U().next(a=>{const l=new Map;return a.forEach(c=>{var d;let h=(d=l.get(c.userId))!==null&&d!==void 0?d:ke();Ri(this.serializer,c).keys().forEach(m=>h=h.add(m)),l.set(c.userId,h)}),O.forEach(l,(c,d)=>{const h=new ln(d),m=Ih.lt(this.serializer,h),p=i.getIndexManager(h),y=Sh.lt(h,this.serializer,p,i.referenceDelegate);return new eI(s,y,m,p).recalculateAndSaveOverlaysForDocumentKeys(new Hf(t,Hn.oe),c).next()})})}}function $x(n){n.createObjectStore("targetDocuments",{keyPath:Aj}).createIndex("documentTargetsIndex",kj,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Nj,{unique:!0}),n.createObjectStore("targetGlobal")}const jm="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Ug{constructor(e,t,r,s,i,a,l,c,d,h,m=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=a,this.document=l,this.ci=d,this.li=h,this.hi=m,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=p=>Promise.resolve(),!Ug.D())throw new Z(U.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new $2(this,s),this.Ai=t+"main",this.serializer=new zT(c),this.Ri=new Or(this.Ai,this.hi,new X2(this.serializer)),this.$r=new A2,this.Ur=new L2(this.referenceDelegate,this.serializer),this.remoteDocumentCache=ZT(this.serializer),this.Gr=new N2,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&Lt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Z(U.FAILED_PRECONDITION,jm);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Hn(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Su(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(gi(e))return X("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return X("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return ul(e).get("owner").next(t=>O.resolve(this.vi(t)))}Ci(e){return Su(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=tn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),a=s.filter(l=>i.indexOf(l)===-1);return O.forEach(a,l=>r.delete(l.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?O.resolve(!0):ul(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new Z(U.FAILED_PRECONDITION,jm);return!1}}return!(!this.networkEnabled||!this.inForeground)||Su(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,l=this.networkEnabled===s.networkEnabled;if(i||a&&l)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&X("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Hf(e,Hn.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Su(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Sh.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new V2(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Ih.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){X("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(c){return c===17?Uj:c===16?$j:c===15?Ig:c===14?KE:c===13?GE:c===12?Fj:c===11?HE:void ce()}(this.hi);let a;return this.Ri.runTransaction(e,s,i,l=>(a=new Hf(l,this.Qr?this.Qr.next():Hn.oe),t==="readwrite-primary"?this.wi(a).next(c=>!!c||this.Si(a)).next(c=>{if(!c)throw Lt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new Z(U.FAILED_PRECONDITION,UE);return r(a)}).next(c=>this.Di(a).next(()=>c)):this.Ki(a).next(()=>r(a)))).then(l=>(a.raiseOnCommittedEvent(),l))}Ki(e){return ul(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Z(U.FAILED_PRECONDITION,jm)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ul(e).put("owner",t)}static D(){return Or.D()}bi(e){const t=ul(e);return t.get("owner").next(r=>this.vi(r)?(X("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):O.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Lt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;F_()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return X("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Lt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Lt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ul(n){return tn(n,"owner")}function Su(n){return tn(n,"clientMetadata")}function Bg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=ke(),s=ke();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new zg(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z2{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tI{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return F_()?8:zE(en())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new Z2;return this.Xi(e,t,a).next(l=>{if(i.result=l,this.zi)return this.es(e,t,a,l.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Ia()<=$e.DEBUG&&X("QueryEngine","SDK will not create cache indexes for query:",Sa(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),O.resolve()):(Ia()<=$e.DEBUG&&X("QueryEngine","Query:",Sa(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Ia()<=$e.DEBUG&&X("QueryEngine","The SDK decides to create cache indexes for query:",Sa(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Rn(t))):O.resolve())}Yi(e,t){if(hx(t))return O.resolve(null);let r=Rn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Od(t,null,"F"),r=Rn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const a=ke(...i);return this.Ji.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.ts(t,l);return this.ns(t,d,a,c.readTime)?this.Yi(e,Od(t,null,"F")):this.rs(e,d,t,c)}))})))}Zi(e,t,r,s){return hx(t)||s.isEqual(ye.min())?O.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const a=this.ts(t,i);return this.ns(t,a,r,s)?O.resolve(null):(Ia()<=$e.DEBUG&&X("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Sa(t)),this.rs(e,a,t,FE(s,-1)).next(l=>l))})}ts(e,t){let r=new st(mT(e));return t.forEach((s,i)=>{Rc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Ia()<=$e.DEBUG&&X("QueryEngine","Using full collection scan to execute query:",Sa(t)),this.Ji.getDocumentsMatchingQuery(e,t,ar.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eD{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new ct(Ie),this._s=new ys(i=>Zi(i),kc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new eI(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function nI(n,e,t,r){return new eD(n,e,t,r)}async function rI(n,e){const t=se(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const a=[],l=[];let c=ke();for(const d of s){a.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}for(const d of i){l.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(r,c).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:l}))})})}function tD(n,e){const t=se(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(l,c,d,h){const m=d.batch,p=m.keys();let y=O.resolve();return p.forEach(_=>{y=y.next(()=>h.getEntry(c,_)).next(T=>{const E=d.docVersions.get(_);pe(E!==null),T.version.compareTo(E)<0&&(m.applyToRemoteDocument(T,d),T.isValidDocument()&&(T.setReadTime(d.commitVersion),h.addEntry(T)))})}),y.next(()=>l.mutationQueue.removeMutationBatch(c,m))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let c=ke();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(c=c.add(l.batch.mutations[d].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function sI(n){const e=se(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function nD(n,e){const t=se(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const l=[];e.targetChanges.forEach((h,m)=>{const p=s.get(m);if(!p)return;l.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,m).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,m)));let y=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?y=y.withResumeToken(Dt.EMPTY_BYTE_STRING,ye.min()).withLastLimboFreeSnapshotVersion(ye.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(m,y),function(T,E,x){return T.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=3e8?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0}(p,y,h)&&l.push(t.Ur.updateTargetData(i,y))});let c=Kn(),d=ke();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),l.push(iI(i,a,e.documentUpdates).next(h=>{c=h.Ps,d=h.Is})),!r.isEqual(ye.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(m=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(h)}return O.waitFor(l).next(()=>a.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,c,d)).next(()=>c)}).then(i=>(t.os=s,i))}function iI(n,e,t){let r=ke(),s=ke();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let a=Kn();return t.forEach((l,c)=>{const d=i.get(l);c.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),c.isNoDocument()&&c.version.isEqual(ye.min())?(e.removeEntry(l,c.readTime),a=a.insert(l,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),a=a.insert(l,c)):X("LocalStore","Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",c.version)}),{Ps:a,Is:s}})}function rD(n,e){const t=se(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function yo(n,e){const t=se(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,O.resolve(s)):t.Ur.allocateTargetId(r).next(a=>(s=new Xr(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function vo(n,e,t){const r=se(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!gi(a))throw a;X("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function qd(n,e,t){const r=se(n);let s=ye.min(),i=ke();return r.persistence.runTransaction("Execute query","readwrite",a=>function(c,d,h){const m=se(c),p=m._s.get(h);return p!==void 0?O.resolve(m.os.get(p)):m.Ur.getTargetData(d,h)}(r,a,Rn(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,l.targetId).next(c=>{i=c})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,t?s:ye.min(),t?i:ke())).next(l=>(lI(r,hT(e),l),{documents:l,Ts:i})))}function aI(n,e){const t=se(n),r=se(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(a=>a?a.target:null))}function oI(n,e){const t=se(n),r=t.us.get(e)||ye.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,FE(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(lI(t,e,s),s))}function lI(n,e,t){let r=n.us.get(e)||ye.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function sD(n,e,t,r){const s=se(n);let i=ke(),a=Kn();for(const d of t){const h=e.Es(d.metadata.name);d.document&&(i=i.add(h));const m=e.ds(d);m.setReadTime(e.As(d.metadata.readTime)),a=a.insert(h,m)}const l=s.cs.newChangeBuffer({trackRemovals:!0}),c=await yo(s,function(h){return Rn(jo(Ue.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",d=>iI(d,l,a).next(h=>(l.apply(d),h)).next(h=>s.Ur.removeMatchingKeysForTargetId(d,c.targetId).next(()=>s.Ur.addMatchingKeys(d,i,c.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,h.Ps,h.Is)).next(()=>h.Ps)))}async function iD(n,e,t=ke()){const r=await yo(n,Rn(Vg(e.bundledQuery))),s=se(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const a=Ft(e.readTime);if(r.snapshotVersion.compareTo(a)>=0)return s.Gr.saveNamedQuery(i,e);const l=r.withResumeToken(Dt.EMPTY_BYTE_STRING,a);return s.os=s.os.insert(l.targetId,l),s.Ur.updateTargetData(i,l).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function Ux(n,e){return`firestore_clients_${n}_${e}`}function Bx(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Dm(n,e){return`firestore_targets_${n}_${e}`}class Wd{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,a=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return a&&s.error&&(a=typeof s.error.message=="string"&&typeof s.error.code=="string",a&&(i=new Z(s.error.code,s.error.message))),a?new Wd(e,t,s.state,i):(Lt("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ml{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new Z(r.error.code,r.error.message))),i?new Ml(e,r.state,s):(Lt("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Hd{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Ng();for(let a=0;s&&a<r.activeTargetIds.length;++a)s=qE(r.activeTargetIds[a]),i=i.add(r.activeTargetIds[a]);return s?new Hd(e,i):(Lt("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class qg{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new qg(t.clientId,t.onlineState):(Lt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ap{constructor(){this.activeTargetIds=Ng()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Mm{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new ct(Ie),this.started=!1,this.bs=[];const a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=Ux(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new ap),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(Ux(this.persistenceKey,r));if(s){const i=Hd.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Dm(this.persistenceKey,e));if(s){const i=Ml.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Dm(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return X("SharedClientState","READ",e,t),t}setItem(e,t){X("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){X("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(X("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Lt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let a=Hn.oe;if(i!=null)try{const l=JSON.parse(i);pe(typeof l=="number"),a=l}catch(l){Lt("SharedClientState","Failed to read sequence number from WebStorage",l)}return a}(t.newValue);r!==Hn.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Wd(this.currentUser,e,t,r),i=Bx(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=Bx(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Dm(this.persistenceKey,e),i=new Ml(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Hd.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Wd.Rs(new ln(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Ml.Rs(s,t)}Ls(e){return qg.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);X("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),a=[],l=[];return i.forEach(c=>{s.has(c)||a.push(c)}),s.forEach(c=>{i.has(c)||l.push(c)}),this.syncEngine.io(a,l).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Ng();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class cI{constructor(){this.so=new ap,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new ap,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aD{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zx{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){X("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){X("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cu=null;function Vm(){return Cu===null?Cu=function(){return 268435456+Math.round(2147483648*Math.random())}():Cu++,"0x"+Cu.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oD={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lD{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nn="WebChannelConnection";class cD extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,a){const l=Vm(),c=this.xo(t,r.toUriEncodedString());X("RestConnection",`Sending RPC '${t}' ${l}:`,c,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,i,a),this.No(t,c,d,s).then(h=>(X("RestConnection",`Received RPC '${t}' ${l}: `,h),h),h=>{throw gr("RestConnection",`RPC '${t}' ${l} failed with error: `,h,"url: ",c,"request:",s),h})}Lo(t,r,s,i,a,l){return this.Mo(t,r,s,i,a)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ro}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,a)=>t[a]=i),s&&s.headers.forEach((i,a)=>t[a]=i)}xo(t,r){const s=oD[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Vm();return new Promise((a,l)=>{const c=new kE;c.setWithCredentials(!0),c.listenOnce(PE.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Hu.NO_ERROR:const h=c.getResponseJson();X(Nn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),a(h);break;case Hu.TIMEOUT:X(Nn,`RPC '${e}' ${i} timed out`),l(new Z(U.DEADLINE_EXCEEDED,"Request time out"));break;case Hu.HTTP_ERROR:const m=c.getStatus();if(X(Nn,`RPC '${e}' ${i} failed with status:`,m,"response text:",c.getResponseText()),m>0){let p=c.getResponseJson();Array.isArray(p)&&(p=p[0]);const y=p==null?void 0:p.error;if(y&&y.status&&y.message){const _=function(E){const x=E.toLowerCase().replace(/_/g,"-");return Object.values(U).indexOf(x)>=0?x:U.UNKNOWN}(y.status);l(new Z(_,y.message))}else l(new Z(U.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new Z(U.UNAVAILABLE,"Connection failed."));break;default:ce()}}finally{X(Nn,`RPC '${e}' ${i} completed.`)}});const d=JSON.stringify(s);X(Nn,`RPC '${e}' ${i} sending request:`,s),c.send(t,"POST",d,r,15)})}Bo(e,t,r){const s=Vm(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=DE(),l=jE(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const h=i.join("");X(Nn,`Creating RPC '${e}' stream ${s}: ${h}`,c);const m=a.createWebChannel(h,c);let p=!1,y=!1;const _=new lD({Io:E=>{y?X(Nn,`Not sending because RPC '${e}' stream ${s} is closed:`,E):(p||(X(Nn,`Opening RPC '${e}' stream ${s} transport.`),m.open(),p=!0),X(Nn,`RPC '${e}' stream ${s} sending:`,E),m.send(E))},To:()=>m.close()}),T=(E,x,v)=>{E.listen(x,S=>{try{v(S)}catch(P){setTimeout(()=>{throw P},0)}})};return T(m,yl.EventType.OPEN,()=>{y||(X(Nn,`RPC '${e}' stream ${s} transport opened.`),_.yo())}),T(m,yl.EventType.CLOSE,()=>{y||(y=!0,X(Nn,`RPC '${e}' stream ${s} transport closed`),_.So())}),T(m,yl.EventType.ERROR,E=>{y||(y=!0,gr(Nn,`RPC '${e}' stream ${s} transport errored:`,E),_.So(new Z(U.UNAVAILABLE,"The operation could not be completed")))}),T(m,yl.EventType.MESSAGE,E=>{var x;if(!y){const v=E.data[0];pe(!!v);const S=v,P=S.error||((x=S[0])===null||x===void 0?void 0:x.error);if(P){X(Nn,`RPC '${e}' stream ${s} received error:`,P);const M=P.status;let $=function(C){const N=Wt[C];if(N!==void 0)return CT(N)}(M),I=P.message;$===void 0&&($=U.INTERNAL,I="Unknown error status: "+M+" with message "+P.message),y=!0,_.So(new Z($,I)),m.close()}else X(Nn,`RPC '${e}' stream ${s} received:`,v),_.bo(v)}}),T(l,RE.STAT_EVENT,E=>{E.stat===qf.PROXY?X(Nn,`RPC '${e}' stream ${s} detected buffering proxy`):E.stat===qf.NOPROXY&&X(Nn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{_.wo()},0),_}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uI(){return typeof window<"u"?window:null}function Zu(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vc(n){return new y2(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wg{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&X("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dI{constructor(e,t,r,s,i,a,l,c){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Wg(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===U.RESOURCE_EXHAUSTED?(Lt(t.toString()),Lt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===U.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new Z(U.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return X("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(X("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class uD extends dI{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=b2(this.serializer,e),r=function(i){if(!("targetChange"in i))return ye.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?ye.min():a.readTime?Ft(a.readTime):ye.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=tp(this.serializer),t.addTarget=function(i,a){let l;const c=a.target;if(l=Vd(c)?{documents:LT(i,c)}:{query:Th(i,c)._t},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=PT(i,a.resumeToken);const d=Zf(i,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(ye.min())>0){l.readTime=go(i,a.snapshotVersion.toTimestamp());const d=Zf(i,a.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=_2(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=tp(this.serializer),t.removeTarget=e,this.a_(t)}}class dD extends dI{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return pe(!!e.streamToken),this.lastStreamToken=e.streamToken,pe(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){pe(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=w2(e.writeResults,e.commitTime),r=Ft(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=tp(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>hc(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hD extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new Z(U.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Mo(e,ep(t,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===U.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Z(U.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Lo(e,ep(t,r),s,a,l,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===U.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Z(U.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class mD{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Lt(t),this.D_=!1):X("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fD{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(a=>{r.enqueueAndForget(async()=>{vi(this)&&(X("RemoteStore","Restarting streams for network reachability change."),await async function(c){const d=se(c);d.L_.add(4),await Vo(d),d.q_.set("Unknown"),d.L_.delete(4),await Lc(d)}(this))})}),this.q_=new mD(r,s)}}async function Lc(n){if(vi(n))for(const e of n.B_)await e(!0)}async function Vo(n){for(const e of n.B_)await e(!1)}function Nh(n,e){const t=se(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Kg(t)?Gg(t):Oo(t).r_()&&Hg(t,e))}function xo(n,e){const t=se(n),r=Oo(t);t.N_.delete(e),r.r_()&&hI(t,e),t.N_.size===0&&(r.r_()?r.o_():vi(t)&&t.q_.set("Unknown"))}function Hg(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ye.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Oo(n).A_(e)}function hI(n,e){n.Q_.xe(e),Oo(n).R_(e)}function Gg(n){n.Q_=new m2({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Oo(n).start(),n.q_.v_()}function Kg(n){return vi(n)&&!Oo(n).n_()&&n.N_.size>0}function vi(n){return se(n).L_.size===0}function mI(n){n.Q_=void 0}async function pD(n){n.q_.set("Online")}async function gD(n){n.N_.forEach((e,t)=>{Hg(n,e)})}async function yD(n,e){mI(n),Kg(n)?(n.q_.M_(e),Gg(n)):n.q_.set("Unknown")}async function vD(n,e,t){if(n.q_.set("Online"),e instanceof kT&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const l of i.targetIds)s.N_.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.N_.delete(l),s.Q_.removeTarget(l))}(n,e)}catch(r){X("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Gd(n,r)}else if(e instanceof Xu?n.Q_.Ke(e):e instanceof AT?n.Q_.He(e):n.Q_.We(e),!t.isEqual(ye.min()))try{const r=await sI(n.localStore);t.compareTo(r)>=0&&await function(i,a){const l=i.Q_.rt(a);return l.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const h=i.N_.get(d);h&&i.N_.set(d,h.withResumeToken(c.resumeToken,a))}}),l.targetMismatches.forEach((c,d)=>{const h=i.N_.get(c);if(!h)return;i.N_.set(c,h.withResumeToken(Dt.EMPTY_BYTE_STRING,h.snapshotVersion)),hI(i,c);const m=new Xr(h.target,c,d,h.sequenceNumber);Hg(i,m)}),i.remoteSyncer.applyRemoteEvent(l)}(n,t)}catch(r){X("RemoteStore","Failed to raise snapshot:",r),await Gd(n,r)}}async function Gd(n,e,t){if(!gi(e))throw e;n.L_.add(1),await Vo(n),n.q_.set("Offline"),t||(t=()=>sI(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{X("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Lc(n)})}function fI(n,e){return e().catch(t=>Gd(n,t,e))}async function Lo(n){const e=se(n),t=oi(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;xD(e);)try{const s=await rD(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,bD(e,s)}catch(s){await Gd(e,s)}pI(e)&&gI(e)}function xD(n){return vi(n)&&n.O_.length<10}function bD(n,e){n.O_.push(e);const t=oi(n);t.r_()&&t.V_&&t.m_(e.mutations)}function pI(n){return vi(n)&&!oi(n).n_()&&n.O_.length>0}function gI(n){oi(n).start()}async function wD(n){oi(n).p_()}async function _D(n){const e=oi(n);for(const t of n.O_)e.m_(t.mutations)}async function ED(n,e,t){const r=n.O_.shift(),s=Rg.from(r,e,t);await fI(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Lo(n)}async function TD(n,e){e&&oi(n).V_&&await async function(r,s){if(function(a){return ST(a)&&a!==U.ABORTED}(s.code)){const i=r.O_.shift();oi(r).s_(),await fI(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Lo(r)}}(n,e),pI(n)&&gI(n)}async function qx(n,e){const t=se(n);t.asyncQueue.verifyOperationInProgress(),X("RemoteStore","RemoteStore received new credentials");const r=vi(t);t.L_.add(3),await Vo(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Lc(t)}async function op(n,e){const t=se(n);e?(t.L_.delete(2),await Lc(t)):e||(t.L_.add(2),await Vo(t),t.q_.set("Unknown"))}function Oo(n){return n.K_||(n.K_=function(t,r,s){const i=se(t);return i.w_(),new uD(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:pD.bind(null,n),Ro:gD.bind(null,n),mo:yD.bind(null,n),d_:vD.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Kg(n)?Gg(n):n.q_.set("Unknown")):(await n.K_.stop(),mI(n))})),n.K_}function oi(n){return n.U_||(n.U_=function(t,r,s){const i=se(t);return i.w_(),new dD(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:wD.bind(null,n),mo:TD.bind(null,n),f_:_D.bind(null,n),g_:ED.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Lo(n)):(await n.U_.stop(),n.O_.length>0&&(X("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qg{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new un,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,l=new Qg(e,t,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Z(U.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Fo(n,e){if(Lt("AsyncQueue",`${e}: ${n}`),gi(n))return new Z(U.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(e){this.comparator=e?(t,r)=>e(t,r)||oe.comparator(t.key,r.key):(t,r)=>oe.comparator(t.key,r.key),this.keyedMap=vl(),this.sortedSet=new ct(this.comparator)}static emptySet(e){return new Xa(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Xa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Xa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wx{constructor(){this.W_=new ct(oe.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):ce():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class bo{constructor(e,t,r,s,i,a,l,c,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach(l=>{a.push({type:0,doc:l})}),new bo(e,t,Xa.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Pc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ID{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class SD{constructor(){this.queries=Hx(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=se(t),i=s.queries;s.queries=Hx(),i.forEach((a,l)=>{for(const c of l.j_)c.onError(r)})})(this,new Z(U.ABORTED,"Firestore shutting down"))}}function Hx(){return new ys(n=>dT(n),Pc)}async function Yg(n,e){const t=se(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new ID,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const l=Fo(a,`Initialization of query '${Sa(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Xg(t)}async function Jg(n,e){const t=se(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.j_.indexOf(e);a>=0&&(i.j_.splice(a,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function CD(n,e){const t=se(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const l of a.j_)l.X_(s)&&(r=!0);a.z_=s}}r&&Xg(t)}function ND(n,e,t){const r=se(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Xg(n){n.Y_.forEach(e=>{e.next()})}var lp,Gx;(Gx=lp||(lp={})).ea="default",Gx.Cache="cache";class Zg{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new bo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=bo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==lp.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AD{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kx{constructor(e){this.serializer=e}Es(e){return Fr(this.serializer,e)}ds(e){return e.metadata.exists?VT(this.serializer,e.document,!1):ft.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Ft(e)}}class kD{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=yI(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=Ue.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new Kx(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const a of s.metadata.queries){const l=(t.get(a)||ke()).add(i);t.set(a,l)}}return t}async complete(){const e=await sD(this.localStore,new Kx(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await iD(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function yI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vI{constructor(e){this.key=e}}class xI{constructor(e){this.key=e}}class bI{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ke(),this.mutatedKeys=ke(),this.Aa=mT(e),this.Ra=new Xa(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new Wx,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,l=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,m)=>{const p=s.get(h),y=Rc(this.query,m)?m:null,_=!!p&&this.mutatedKeys.has(p.key),T=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let E=!1;p&&y?p.data.isEqual(y.data)?_!==T&&(r.track({type:3,doc:y}),E=!0):this.ga(p,y)||(r.track({type:2,doc:y}),E=!0,(c&&this.Aa(y,c)>0||d&&this.Aa(y,d)<0)&&(l=!0)):!p&&y?(r.track({type:0,doc:y}),E=!0):p&&!y&&(r.track({type:1,doc:p}),E=!0,(c||d)&&(l=!0)),E&&(y?(a=a.add(y),i=T?i.add(h):i.delete(h)):(a=a.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:a,fa:r,ns:l,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((h,m)=>function(y,_){const T=E=>{switch(E){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ce()}};return T(y)-T(_)}(h.type,m.type)||this.Aa(h.doc,m.doc)),this.pa(r),s=s!=null&&s;const l=t&&!s?this.ya():[],c=this.da.size===0&&this.current&&!s?1:0,d=c!==this.Ea;return this.Ea=c,a.length!==0||d?{snapshot:new bo(this.query,e.Ra,i,a,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Wx,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ke(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new xI(r))}),this.da.forEach(r=>{e.has(r)||t.push(new vI(r))}),t}ba(e){this.Ta=e.Ts,this.da=ke();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return bo.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class PD{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class RD{constructor(e){this.key=e,this.va=!1}}class jD{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new ys(l=>dT(l),Pc),this.Ma=new Map,this.xa=new Set,this.Oa=new ct(oe.comparator),this.Na=new Map,this.La=new Fg,this.Ba={},this.ka=new Map,this.qa=sa.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function DD(n,e,t=!0){const r=Ah(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await wI(r,e,t,!0),s}async function MD(n,e){const t=Ah(n);await wI(t,e,!0,!1)}async function wI(n,e,t,r){const s=await yo(n.localStore,Rn(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let l;return r&&(l=await ey(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&Nh(n.remoteStore,s),l}async function ey(n,e,t,r,s){n.Ka=(m,p,y)=>async function(T,E,x,v){let S=E.view.ma(x);S.ns&&(S=await qd(T.localStore,E.query,!1).then(({documents:I})=>E.view.ma(I,S)));const P=v&&v.targetChanges.get(E.targetId),M=v&&v.targetMismatches.get(E.targetId)!=null,$=E.view.applyChanges(S,T.isPrimaryClient,P,M);return cp(T,E.targetId,$.wa),$.snapshot}(n,m,p,y);const i=await qd(n.localStore,e,!0),a=new bI(e,i.Ts),l=a.ma(i.documents),c=Mc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(l,n.isPrimaryClient,c);cp(n,t,d.wa);const h=new PD(e,t,a);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),d.snapshot}async function VD(n,e,t){const r=se(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(a=>!Pc(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await vo(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&xo(r.remoteStore,s.targetId),wo(r,s.targetId)}).catch(pi)):(wo(r,s.targetId),await vo(r.localStore,s.targetId,!0))}async function LD(n,e){const t=se(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),xo(t.remoteStore,r.targetId))}async function OD(n,e,t){const r=sy(n);try{const s=await function(a,l){const c=se(a),d=Ct.now(),h=l.reduce((y,_)=>y.add(_.key),ke());let m,p;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let _=Kn(),T=ke();return c.cs.getEntries(y,h).next(E=>{_=E,_.forEach((x,v)=>{v.isValidDocument()||(T=T.add(x))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,_)).next(E=>{m=E;const x=[];for(const v of l){const S=u2(v,m.get(v.key).overlayedDocument);S!=null&&x.push(new vs(v.key,S,eT(S.value.mapValue),Et.exists(!0)))}return c.mutationQueue.addMutationBatch(y,d,x,l)}).next(E=>{p=E;const x=E.applyToLocalDocumentSet(m,T);return c.documentOverlayCache.saveOverlays(y,E.batchId,x)})}).then(()=>({batchId:p.batchId,changes:pT(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,l,c){let d=a.Ba[a.currentUser.toKey()];d||(d=new ct(Ie)),d=d.insert(l,c),a.Ba[a.currentUser.toKey()]=d}(r,s.batchId,t),await xs(r,s.changes),await Lo(r.remoteStore)}catch(s){const i=Fo(s,"Failed to persist write");t.reject(i)}}async function _I(n,e){const t=se(n);try{const r=await nD(t.localStore,e);e.targetChanges.forEach((s,i)=>{const a=t.Na.get(i);a&&(pe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.va=!0:s.modifiedDocuments.size>0?pe(a.va):s.removedDocuments.size>0&&(pe(a.va),a.va=!1))}),await xs(t,r,e)}catch(r){await pi(r)}}function Qx(n,e,t){const r=se(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,a)=>{const l=a.view.Z_(e);l.snapshot&&s.push(l.snapshot)}),function(a,l){const c=se(a);c.onlineState=l;let d=!1;c.queries.forEach((h,m)=>{for(const p of m.j_)p.Z_(l)&&(d=!0)}),d&&Xg(c)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function FD(n,e,t){const r=se(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let a=new ct(oe.comparator);a=a.insert(i,ft.newNoDocument(i,ye.min()));const l=ke().add(i),c=new Dc(ye.min(),new Map,new ct(Ie),a,l);await _I(r,c),r.Oa=r.Oa.remove(i),r.Na.delete(e),ry(r)}else await vo(r.localStore,e,!1).then(()=>wo(r,e,t)).catch(pi)}async function $D(n,e){const t=se(n),r=e.batch.batchId;try{const s=await tD(t.localStore,e);ny(t,r,null),ty(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await xs(t,s)}catch(s){await pi(s)}}async function UD(n,e,t){const r=se(n);try{const s=await function(a,l){const c=se(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let h;return c.mutationQueue.lookupMutationBatch(d,l).next(m=>(pe(m!==null),h=m.keys(),c.mutationQueue.removeMutationBatch(d,m))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,h,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h)).next(()=>c.localDocuments.getDocuments(d,h))})}(r.localStore,e);ny(r,e,t),ty(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await xs(r,s)}catch(s){await pi(s)}}async function BD(n,e){const t=se(n);vi(t.remoteStore)||X("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(a){const l=se(a);return l.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>l.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Fo(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function ty(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function ny(n,e,t){const r=se(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function wo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||EI(n,r)})}function EI(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(xo(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),ry(n))}function cp(n,e,t){for(const r of t)r instanceof vI?(n.La.addReference(r.key,e),zD(n,r)):r instanceof xI?(X("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||EI(n,r.key)):ce()}function zD(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(X("SyncEngine","New document in limbo: "+t),n.xa.add(r),ry(n))}function ry(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new oe(Ue.fromString(e)),r=n.qa.next();n.Na.set(r,new RD(t)),n.Oa=n.Oa.insert(t,r),Nh(n.remoteStore,new Xr(Rn(jo(t.path)),r,"TargetPurposeLimboResolution",Hn.oe))}}async function xs(n,e,t){const r=se(n),s=[],i=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((l,c)=>{a.push(r.Ka(c,e,t).then(d=>{var h;if((d||t)&&r.isPrimaryClient){const m=d?!d.fromCache:(h=t==null?void 0:t.targetChanges.get(c.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(d){s.push(d);const m=zg.Wi(c.targetId,d);i.push(m)}}))}),await Promise.all(a),r.Ca.d_(s),await async function(c,d){const h=se(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>O.forEach(d,p=>O.forEach(p.$i,y=>h.persistence.referenceDelegate.addReference(m,p.targetId,y)).next(()=>O.forEach(p.Ui,y=>h.persistence.referenceDelegate.removeReference(m,p.targetId,y)))))}catch(m){if(!gi(m))throw m;X("LocalStore","Failed to update sequence numbers: "+m)}for(const m of d){const p=m.targetId;if(!m.fromCache){const y=h.os.get(p),_=y.snapshotVersion,T=y.withLastLimboFreeSnapshotVersion(_);h.os=h.os.insert(p,T)}}}(r.localStore,i))}async function qD(n,e){const t=se(n);if(!t.currentUser.isEqual(e)){X("SyncEngine","User change. New user:",e.toKey());const r=await rI(t.localStore,e);t.currentUser=e,function(i,a){i.ka.forEach(l=>{l.forEach(c=>{c.reject(new Z(U.CANCELLED,a))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await xs(t,r.hs)}}function WD(n,e){const t=se(n),r=t.Na.get(e);if(r&&r.va)return ke().add(r.key);{let s=ke();const i=t.Ma.get(e);if(!i)return s;for(const a of i){const l=t.Fa.get(a);s=s.unionWith(l.view.Va)}return s}}async function HD(n,e){const t=se(n),r=await qd(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&cp(t,e.targetId,s.wa),s}async function GD(n,e){const t=se(n);return oI(t.localStore,e).then(r=>xs(t,r))}async function KD(n,e,t,r){const s=se(n),i=await function(l,c){const d=se(l),h=se(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",m=>h.Mn(m,c).next(p=>p?d.localDocuments.getDocuments(m,p):O.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Lo(s.remoteStore):t==="acknowledged"||t==="rejected"?(ny(s,e,r||null),ty(s,e),function(l,c){se(se(l).mutationQueue).On(c)}(s.localStore,e)):ce(),await xs(s,i)):X("SyncEngine","Cannot apply mutation batch with id: "+e)}async function QD(n,e){const t=se(n);if(Ah(t),sy(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await Yx(t,r.toArray());t.Qa=!0,await op(t.remoteStore,!0);for(const i of s)Nh(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,a)=>{t.sharedClientState.isLocalQueryTarget(a)?r.push(a):s=s.then(()=>(wo(t,a),vo(t.localStore,a,!0))),xo(t.remoteStore,a)}),await s,await Yx(t,r),function(a){const l=se(a);l.Na.forEach((c,d)=>{xo(l.remoteStore,d)}),l.La.pr(),l.Na=new Map,l.Oa=new ct(oe.comparator)}(t),t.Qa=!1,await op(t.remoteStore,!1)}}async function Yx(n,e,t){const r=se(n),s=[],i=[];for(const a of e){let l;const c=r.Ma.get(a);if(c&&c.length!==0){l=await yo(r.localStore,Rn(c[0]));for(const d of c){const h=r.Fa.get(d),m=await HD(r,h);m.snapshot&&i.push(m.snapshot)}}else{const d=await aI(r.localStore,a);l=await yo(r.localStore,d),await ey(r,TI(d),a,!1,l.resumeToken)}s.push(l)}return r.Ca.d_(i),s}function TI(n){return lT(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function YD(n){return function(t){return se(se(t).persistence).Qi()}(se(n).localStore)}async function JD(n,e,t,r){const s=se(n);if(s.Qa)return void X("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const a=await oI(s.localStore,hT(i[0])),l=Dc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Dt.EMPTY_BYTE_STRING);await xs(s,a,l);break}case"rejected":await vo(s.localStore,e,!0),wo(s,e,r);break;default:ce()}}async function XD(n,e,t){const r=Ah(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){X("SyncEngine","Adding an already active target "+s);continue}const i=await aI(r.localStore,s),a=await yo(r.localStore,i);await ey(r,TI(i),a.targetId,!1,a.resumeToken),Nh(r.remoteStore,a)}for(const s of t)r.Ma.has(s)&&await vo(r.localStore,s,!1).then(()=>{xo(r.remoteStore,s),wo(r,s)}).catch(pi)}}function Ah(n){const e=se(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=_I.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=WD.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=FD.bind(null,e),e.Ca.d_=CD.bind(null,e.eventManager),e.Ca.$a=ND.bind(null,e.eventManager),e}function sy(n){const e=se(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=$D.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=UD.bind(null,e),e}function ZD(n,e,t){const r=se(n);(async function(i,a,l){try{const c=await a.getMetadata();if(await function(y,_){const T=se(y),E=Ft(_.createTime);return T.persistence.runTransaction("hasNewerBundle","readonly",x=>T.Gr.getBundleMetadata(x,_.id)).then(x=>!!x&&x.createTime.compareTo(E)>=0)}(i.localStore,c))return await a.close(),l._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(c)),Promise.resolve(new Set);l._updateProgress(yI(c));const d=new kD(c,i.localStore,a.serializer);let h=await a.Ua();for(;h;){const p=await d.la(h);p&&l._updateProgress(p),h=await a.Ua()}const m=await d.complete();return await xs(i,m.Ia,void 0),await function(y,_){const T=se(y);return T.persistence.runTransaction("Save bundle","readwrite",E=>T.Gr.saveBundleMetadata(E,_))}(i.localStore,c),l._completeWith(m.progress),Promise.resolve(m.Pa)}catch(c){return gr("SyncEngine",`Loading bundle failed with ${c}`),l._failWith(c),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class li{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Vc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return nI(this.persistence,new tI,e.initialUser,this.serializer)}Ga(e){return new $g(Ch.Zr,this.serializer)}Wa(e){return new cI}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}li.provider={build:()=>new li};class eM extends li{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){pe(this.persistence.referenceDelegate instanceof zd);const r=this.persistence.referenceDelegate.garbageCollector;return new YT(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?An.withCacheSize(this.cacheSizeBytes):An.DEFAULT;return new $g(r=>zd.Zr(r,t),this.serializer)}}class iy extends li{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await sy(this.Ja.syncEngine),await Lo(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return nI(this.persistence,new tI,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new YT(r,e.asyncQueue,t)}Ha(e,t){const r=new _j(t,this.persistence);return new wj(e.asyncQueue,r)}Ga(e){const t=Bg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?An.withCacheSize(this.cacheSizeBytes):An.DEFAULT;return new Ug(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,uI(),Zu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new cI}}class II extends iy{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Mm&&(this.sharedClientState.syncEngine={no:KD.bind(null,t),ro:JD.bind(null,t),io:XD.bind(null,t),Qi:YD.bind(null,t),eo:GD.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await QD(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=uI();if(!Mm.D(t))throw new Z(U.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Bg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Mm(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ci{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Qx(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=qD.bind(null,this.syncEngine),await op(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new SD}()}createDatastore(e){const t=Vc(e.databaseInfo.databaseId),r=function(i){return new cD(i)}(e.databaseInfo);return function(i,a,l,c){return new hD(i,a,l,c)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,a,l){return new fD(r,s,i,a,l)}(this.localStore,this.datastore,e.asyncQueue,t=>Qx(this.syncEngine,t,0),function(){return zx.D()?new zx:new aD}())}createSyncEngine(e,t){return function(s,i,a,l,c,d,h){const m=new jD(s,i,a,l,c,d);return h&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=se(s);X("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Vo(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}ci.provider={build:()=>new ci};function Jx(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Lt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tM{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new un,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new AD(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nM{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Z(U.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const a=se(s),l={documents:i.map(m=>dc(a.serializer,m))},c=await a.Lo("BatchGetDocuments",a.serializer.databaseId,Ue.emptyPath(),l,i.length),d=new Map;c.forEach(m=>{const p=x2(a.serializer,m);d.set(p.key.toString(),p)});const h=[];return i.forEach(m=>{const p=d.get(m.toString());pe(!!p),h.push(p)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Mo(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=oe.fromPath(r);this.mutations.push(new kg(s,this.precondition(s)))}),await async function(r,s){const i=se(r),a={writes:s.map(l=>hc(i.serializer,l))};await i.Mo("Commit",i.serializer.databaseId,Ue.emptyPath(),a)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ce();t=ye.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new Z(U.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ye.min())?Et.exists(!1):Et.updateTime(t):Et.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ye.min()))throw new Z(U.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Et.updateTime(t)}return Et.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rM{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Wg(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new nM(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Ac(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!ST(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sM{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=ln.UNAUTHENTICATED,this.clientId=LE.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{X("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(X("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new un;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Fo(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Lm(n,e){n.asyncQueue.verifyOperationInProgress(),X("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await rI(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function Xx(n,e){n.asyncQueue.verifyOperationInProgress();const t=await ay(n);X("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>qx(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>qx(e.remoteStore,s)),n._onlineComponents=e}async function ay(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){X("FirestoreClient","Using user provided OfflineComponentProvider");try{await Lm(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===U.FAILED_PRECONDITION||s.code===U.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;gr("Error using user provided cache. Falling back to memory cache: "+t),await Lm(n,new li)}}else X("FirestoreClient","Using default OfflineComponentProvider"),await Lm(n,new li);return n._offlineComponents}async function Ph(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(X("FirestoreClient","Using user provided OnlineComponentProvider"),await Xx(n,n._uninitializedComponentsProvider._online)):(X("FirestoreClient","Using default OnlineComponentProvider"),await Xx(n,new ci))),n._onlineComponents}function SI(n){return ay(n).then(e=>e.persistence)}function $o(n){return ay(n).then(e=>e.localStore)}function CI(n){return Ph(n).then(e=>e.remoteStore)}function oy(n){return Ph(n).then(e=>e.syncEngine)}function NI(n){return Ph(n).then(e=>e.datastore)}async function _o(n){const e=await Ph(n),t=e.eventManager;return t.onListen=DD.bind(null,e.syncEngine),t.onUnlisten=VD.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=MD.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=LD.bind(null,e.syncEngine),t}function iM(n){return n.asyncQueue.enqueue(async()=>{const e=await SI(n),t=await CI(n);return e.setNetworkEnabled(!0),function(s){const i=se(s);return i.L_.delete(0),Lc(i)}(t)})}function aM(n){return n.asyncQueue.enqueue(async()=>{const e=await SI(n),t=await CI(n);return e.setNetworkEnabled(!1),async function(s){const i=se(s);i.L_.add(0),await Vo(i),i.q_.set("Offline")}(t)})}function oM(n,e){const t=new un;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,a){try{const l=await function(d,h){const m=se(d);return m.persistence.runTransaction("read document","readonly",p=>m.localDocuments.getDocument(p,h))}(s,i);l.isFoundDocument()?a.resolve(l):l.isNoDocument()?a.resolve(null):a.reject(new Z(U.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(l){const c=Fo(l,`Failed to get document '${i} from cache`);a.reject(c)}}(await $o(n),e,t)),t.promise}function AI(n,e,t={}){const r=new un;return n.asyncQueue.enqueueAndForget(async()=>function(i,a,l,c,d){const h=new kh({next:p=>{h.Za(),a.enqueueAndForget(()=>Jg(i,m));const y=p.docs.has(l);!y&&p.fromCache?d.reject(new Z(U.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&p.fromCache&&c&&c.source==="server"?d.reject(new Z(U.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(p)},error:p=>d.reject(p)}),m=new Zg(jo(l.path),h,{includeMetadataChanges:!0,_a:!0});return Yg(i,m)}(await _o(n),n.asyncQueue,e,t,r)),r.promise}function lM(n,e){const t=new un;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,a){try{const l=await qd(s,i,!0),c=new bI(i,l.Ts),d=c.ma(l.documents),h=c.applyChanges(d,!1);a.resolve(h.snapshot)}catch(l){const c=Fo(l,`Failed to execute query '${i} against cache`);a.reject(c)}}(await $o(n),e,t)),t.promise}function kI(n,e,t={}){const r=new un;return n.asyncQueue.enqueueAndForget(async()=>function(i,a,l,c,d){const h=new kh({next:p=>{h.Za(),a.enqueueAndForget(()=>Jg(i,m)),p.fromCache&&c.source==="server"?d.reject(new Z(U.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(p)},error:p=>d.reject(p)}),m=new Zg(l,h,{includeMetadataChanges:!0,_a:!0});return Yg(i,m)}(await _o(n),n.asyncQueue,e,t,r)),r.promise}function cM(n,e,t){const r=new un;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await NI(n);r.resolve(async function(a,l,c){var d;const h=se(a),{request:m,ut:p,parent:y}=OT(h.serializer,cT(l),c);h.connection.Fo||delete m.parent;const _=(await h.Lo("RunAggregationQuery",h.serializer.databaseId,y,m,1)).filter(E=>!!E.result);pe(_.length===1);const T=(d=_[0].result)===null||d===void 0?void 0:d.aggregateFields;return Object.keys(T).reduce((E,x)=>(E[p[x]]=T[x],E),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function uM(n,e){const t=new kh(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){se(s).Y_.add(i),i.next()}(await _o(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){se(s).Y_.delete(i)}(await _o(n),t))}}function dM(n,e,t,r){const s=function(a,l){let c;return c=typeof a=="string"?NT().encode(a):a,function(h,m){return new tM(h,m)}(function(h,m){if(h instanceof Uint8Array)return Jx(h,m);if(h instanceof ArrayBuffer)return Jx(new Uint8Array(h),m);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),l)}(t,Vc(e));n.asyncQueue.enqueueAndForget(async()=>{ZD(await oy(n),s,r)})}function hM(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=se(r);return i.persistence.runTransaction("Get named query","readonly",a=>i.Gr.getNamedQuery(a,s))}(await $o(n),e))}function mM(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=se(r),a=i.indexManager,l=[];return i.persistence.runTransaction("Configure indexes","readwrite",c=>a.getFieldIndexes(c).next(d=>function(m,p,y,_,T){m=[...m],p=[...p],m.sort(y),p.sort(y);const E=m.length,x=p.length;let v=0,S=0;for(;v<x&&S<E;){const P=y(m[S],p[v]);P<0?T(m[S++]):P>0?_(p[v++]):(v++,S++)}for(;v<x;)_(p[v++]);for(;S<E;)T(m[S++])}(d,s,yj,h=>{l.push(a.addFieldIndex(c,h))},h=>{l.push(a.deleteFieldIndex(c,h))})).next(()=>O.waitFor(l)))}(await $o(n),e))}function fM(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){se(r).ss.zi=s}(await $o(n),e))}function pM(n){return n.asyncQueue.enqueue(async()=>function(t){const r=se(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await $o(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PI(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zx=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ly(n,e,t){if(!t)throw new Z(U.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function gM(n,e,t,r){if(e===!0&&r===!0)throw new Z(U.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function eb(n){if(!oe.isDocumentKey(n))throw new Z(U.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function tb(n){if(oe.isDocumentKey(n))throw new Z(U.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Rh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ce()}function Le(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Z(U.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Rh(n);throw new Z(U.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function RI(n,e){if(e<=0)throw new Z(U.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nb{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Z(U.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Z(U.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}gM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=PI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Z(U.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Z(U.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Z(U.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Oc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new nb({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Z(U.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Z(U.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new nb(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new cj;switch(r.type){case"firstParty":return new mj(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Z(U.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Zx.get(t);r&&(X("ComponentProvider","Removing Datastore"),Zx.delete(t),r.terminate())}(this),Promise.resolve()}}function yM(n,e,t,r={}){var s;const i=(n=Le(n,Oc))._getSettings(),a=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==a&&gr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:a,ssl:!1})),r.mockUserToken){let l,c;if(typeof r.mockUserToken=="string")l=r.mockUserToken,c=ln.MOCK_USER;else{l=EA(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new Z(U.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new ln(d)}n._authCredentials=new uj(new ME(l,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new bn(this.firestore,e,this._query)}}class $t{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new $r(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new $t(this.firestore,e,this._key)}}class $r extends bn{constructor(e,t,r){super(e,t,jo(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new $t(this.firestore,null,new oe(e))}withConverter(e){return new $r(this.firestore,e,this._path)}}function gt(n,e,...t){if(n=it(n),ly("collection","path",e),n instanceof Oc){const r=Ue.fromString(e,...t);return tb(r),new $r(n,null,r)}{if(!(n instanceof $t||n instanceof $r))throw new Z(U.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ue.fromString(e,...t));return tb(r),new $r(n.firestore,null,r)}}function ZV(n,e){if(n=Le(n,Oc),ly("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Z(U.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new bn(n,null,function(r){return new gs(Ue.emptyPath(),r)}(e))}function Ke(n,e,...t){if(n=it(n),arguments.length===1&&(e=LE.newId()),ly("doc","path",e),n instanceof Oc){const r=Ue.fromString(e,...t);return eb(r),new $t(n,null,new oe(r))}{if(!(n instanceof $t||n instanceof $r))throw new Z(U.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ue.fromString(e,...t));return eb(r),new $t(n.firestore,n instanceof $r?n.converter:null,new oe(r))}}function eL(n,e){return n=it(n),e=it(e),(n instanceof $t||n instanceof $r)&&(e instanceof $t||e instanceof $r)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function jI(n,e){return n=it(n),e=it(e),n instanceof bn&&e instanceof bn&&n.firestore===e.firestore&&Pc(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rb{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Wg(this,"async_queue_retry"),this.Vu=()=>{const r=Zu();r&&X("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Zu();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Zu();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new un;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!gi(e))throw e;X("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(a){let l=a.message||"";return a.stack&&(l=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),l}(r);throw Lt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Qg.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&ce()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function up(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class vM{constructor(){this._progressObserver={},this._taskCompletionResolver=new un,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tL=-1;class ot extends Oc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new rb,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new rb(e),this._firestoreClient=void 0,await e}}}function nL(n,e,t){t||(t="(default)");const r=Tc(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(ni(i,e))return s;throw new Z(U.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new Z(U.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Z(U.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function xM(n,e){const t=typeof n=="object"?n:q_(),r=typeof n=="string"?n:e||"(default)",s=Tc(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=wA("firestore");i&&yM(s,...i)}return s}function At(n){if(n._terminated)throw new Z(U.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||DI(n),n._firestoreClient}function DI(n){var e,t,r;const s=n._freezeSettings(),i=function(l,c,d,h){return new zj(l,c,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,PI(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new sM(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(n._componentsProvider))}function rL(n,e){gr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return MI(n,ci.provider,{build:r=>new iy(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function sL(n){gr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();MI(n,ci.provider,{build:t=>new II(t,e.cacheSizeBytes)})}function MI(n,e,t){if((n=Le(n,ot))._firestoreClient||n._terminated)throw new Z(U.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new Z(U.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},DI(n)}function iL(n){if(n._initialized&&!n._terminated)throw new Z(U.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new un;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Or.D())return Promise.resolve();const s=r+"main";await Or.delete(s)}(Bg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function aL(n){return function(t){const r=new un;return t.asyncQueue.enqueueAndForget(async()=>BD(await oy(t),r)),r.promise}(At(n=Le(n,ot)))}function oL(n){return iM(At(n=Le(n,ot)))}function lL(n){return aM(At(n=Le(n,ot)))}function cL(n){return Dk(n.app,"firestore",n._databaseId.database),n._delete()}function uL(n,e){const t=At(n=Le(n,ot)),r=new vM;return dM(t,n._databaseId,e,r),r}function dL(n,e){return hM(At(n=Le(n,ot)),e).then(t=>t?new bn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class bM{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ia(Dt.fromBase64String(e))}catch(t){throw new Z(U.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ia(Dt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Z(U.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _t(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function hL(){return new ca("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cy{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Z(U.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Z(U.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ie(this._lat,e._lat)||Ie(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wM=/^__.*__$/;class _M{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new vs(e,this.data,this.fieldMask,t,this.fieldTransforms):new Do(e,this.data,t,this.fieldTransforms)}}class VI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new vs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function LI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ce()}}class Dh{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Dh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Kd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(LI(this.Cu)&&wM.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class EM{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Vc(e)}Qu(e,t,r,s=!1){return new Dh({Cu:e,methodName:t,qu:r,path:_t.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function da(n){const e=n._freezeSettings(),t=Vc(n._databaseId);return new EM(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Mh(n,e,t,r,s,i={}){const a=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);gy("Data must be an object, but it was:",a,r);const l=$I(r,a);let c,d;if(i.merge)c=new Gn(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const h=[];for(const m of i.mergeFields){const p=fc(e,m,t);if(!a.contains(p))throw new Z(U.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);BI(h,p)||h.push(p)}c=new Gn(h),d=a.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,d=a.fieldTransforms;return new _M(new yn(l),c,d)}class Fc extends ua{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Fc}}function OI(n,e,t){return new Dh({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class uy extends ua{_toFieldTransform(e){return new jc(e.path,new fo)}isEqual(e){return e instanceof uy}}class dy extends ua{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=OI(this,e,!0),r=this.Ku.map(i=>ha(i,t)),s=new ea(r);return new jc(e.path,s)}isEqual(e){return e instanceof dy&&ni(this.Ku,e.Ku)}}class hy extends ua{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=OI(this,e,!0),r=this.Ku.map(i=>ha(i,t)),s=new ta(r);return new jc(e.path,s)}isEqual(e){return e instanceof hy&&ni(this.Ku,e.Ku)}}class my extends ua{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new po(e.serializer,vT(e.serializer,this.$u));return new jc(e.path,t)}isEqual(e){return e instanceof my&&this.$u===e.$u}}function fy(n,e,t,r){const s=n.Qu(1,e,t);gy("Data must be an object, but it was:",s,r);const i=[],a=yn.empty();yi(r,(c,d)=>{const h=Vh(e,c,t);d=it(d);const m=s.Nu(h);if(d instanceof Fc)i.push(h);else{const p=ha(d,m);p!=null&&(i.push(h),a.set(h,p))}});const l=new Gn(i);return new VI(a,l,s.fieldTransforms)}function py(n,e,t,r,s,i){const a=n.Qu(1,e,t),l=[fc(e,r,t)],c=[s];if(i.length%2!=0)throw new Z(U.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)l.push(fc(e,i[p])),c.push(i[p+1]);const d=[],h=yn.empty();for(let p=l.length-1;p>=0;--p)if(!BI(d,l[p])){const y=l[p];let _=c[p];_=it(_);const T=a.Nu(y);if(_ instanceof Fc)d.push(y);else{const E=ha(_,T);E!=null&&(d.push(y),h.set(y,E))}}const m=new Gn(d);return new VI(h,m,a.fieldTransforms)}function FI(n,e,t,r=!1){return ha(t,n.Qu(r?4:3,e))}function ha(n,e){if(UI(n=it(n)))return gy("Unsupported field value:",e,n),$I(n,e);if(n instanceof ua)return function(r,s){if(!LI(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let a=0;for(const l of r){let c=ha(l,s.Lu(a));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),a++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=it(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return vT(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Ct.fromDate(r);return{timestampValue:go(s.serializer,i)}}if(r instanceof Ct){const i=new Ct(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:go(s.serializer,i)}}if(r instanceof cy)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ia)return{bytesValue:PT(s.serializer,r._byteString)};if(r instanceof $t){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Mg(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof jh)return function(a,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(c=>{if(typeof c!="number")throw l.Bu("VectorValues must only contain numeric values.");return Ag(l.serializer,c)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Rh(r)}`)}(n,e)}function $I(n,e){const t={};return YE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):yi(n,(r,s)=>{const i=ha(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function UI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ct||n instanceof cy||n instanceof ia||n instanceof $t||n instanceof ua||n instanceof jh)}function gy(n,e,t){if(!UI(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Rh(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function fc(n,e,t){if((e=it(e))instanceof ca)return e._internalPath;if(typeof e=="string")return Vh(n,e);throw Kd("Field path arguments must be of type string or ",n,!1,void 0,t)}const TM=new RegExp("[~\\*/\\[\\]]");function Vh(n,e,t){if(e.search(TM)>=0)throw Kd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ca(...e.split("."))._internalPath}catch{throw Kd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Kd(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(i||a)&&(c+=" (found",i&&(c+=` in field ${r}`),a&&(c+=` in document ${s}`),c+=")"),new Z(U.INVALID_ARGUMENT,l+n+c)}function BI(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new $t(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new IM(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Lh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class IM extends pc{data(){return super.data()}}function Lh(n,e){return typeof e=="string"?Vh(n,e):e instanceof ca?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Z(U.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class yy{}class $c extends yy{}function wn(n,e,...t){let r=[];e instanceof yy&&r.push(e),r=r.concat(t),function(i){const a=i.filter(c=>c instanceof Uo).length,l=i.filter(c=>c instanceof Uc).length;if(a>1||a>0&&l>0)throw new Z(U.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Uc extends $c{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Uc(e,t,r)}_apply(e){const t=this._parse(e);return WI(e._query,t),new bn(e.firestore,e.converter,Xf(e._query,t))}_parse(e){const t=da(e.firestore);return function(i,a,l,c,d,h,m){let p;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new Z(U.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){ib(m,h);const y=[];for(const _ of m)y.push(sb(c,i,_));p={arrayValue:{values:y}}}else p=sb(c,i,m)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||ib(m,h),p=FI(l,a,m,h==="in"||h==="not-in");return Be.create(d,h,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Kt(n,e,t){const r=e,s=Lh("where",n);return Uc._create(s,r,t)}class Uo extends yy{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Uo(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:tt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let a=s;const l=i.getFlattenedFilters();for(const c of l)WI(a,c),a=Xf(a,c)}(e._query,t),new bn(e.firestore,e.converter,Xf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function mL(...n){return n.forEach(e=>HI("or",e)),Uo._create("or",n)}function fL(...n){return n.forEach(e=>HI("and",e)),Uo._create("and",n)}class vy extends $c{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new vy(e,t)}_apply(e){const t=function(s,i,a){if(s.startAt!==null)throw new Z(U.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Z(U.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new uc(i,a)}(e._query,this._field,this._direction);return new bn(e.firestore,e.converter,function(s,i){const a=s.explicitOrderBy.concat([i]);return new gs(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function pL(n,e="asc"){const t=e,r=Lh("orderBy",n);return vy._create(r,t)}class Oh extends $c{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Oh(e,t,r)}_apply(e){return new bn(e.firestore,e.converter,Od(e._query,this._limit,this._limitType))}}function gL(n){return RI("limit",n),Oh._create("limit",n,"F")}function yL(n){return RI("limitToLast",n),Oh._create("limitToLast",n,"L")}class Fh extends $c{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Fh(e,t,r)}_apply(e){const t=qI(e,this.type,this._docOrFields,this._inclusive);return new bn(e.firestore,e.converter,function(s,i){return new gs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function vL(...n){return Fh._create("startAt",n,!0)}function xL(...n){return Fh._create("startAfter",n,!1)}class $h extends $c{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new $h(e,t,r)}_apply(e){const t=qI(e,this.type,this._docOrFields,this._inclusive);return new bn(e.firestore,e.converter,function(s,i){return new gs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function bL(...n){return $h._create("endBefore",n,!1)}function wL(...n){return $h._create("endAt",n,!0)}function qI(n,e,t,r){if(t[0]=it(t[0]),t[0]instanceof pc)return function(i,a,l,c,d){if(!c)throw new Z(U.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);const h=[];for(const m of Ja(i))if(m.field.isKeyField())h.push(Xi(a,c.key));else{const p=c.data.field(m.field);if(xh(p))throw new Z(U.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){const y=m.field.canonicalString();throw new Z(U.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(p)}return new ai(h,d)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=da(n.firestore);return function(a,l,c,d,h,m){const p=a.explicitOrderBy;if(h.length>p.length)throw new Z(U.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let _=0;_<h.length;_++){const T=h[_];if(p[_].field.isKeyField()){if(typeof T!="string")throw new Z(U.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof T}`);if(!Cg(a)&&T.indexOf("/")!==-1)throw new Z(U.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${T}' contains a slash.`);const E=a.path.child(Ue.fromString(T));if(!oe.isDocumentKey(E))throw new Z(U.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${E}' is not because it contains an odd number of segments.`);const x=new oe(E);y.push(Xi(l,x))}else{const E=FI(c,d,T);y.push(E)}}return new ai(y,m)}(n._query,n.firestore._databaseId,s,e,t,r)}}function sb(n,e,t){if(typeof(t=it(t))=="string"){if(t==="")throw new Z(U.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Cg(e)&&t.indexOf("/")!==-1)throw new Z(U.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Ue.fromString(t));if(!oe.isDocumentKey(r))throw new Z(U.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Xi(n,new oe(r))}if(t instanceof $t)return Xi(n,t._key);throw new Z(U.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Rh(t)}.`)}function ib(n,e){if(!Array.isArray(n)||n.length===0)throw new Z(U.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function WI(n,e){const t=function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Z(U.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Z(U.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function HI(n,e){if(!(e instanceof Uc||e instanceof Uo))throw new Z(U.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class GI{convertValue(e,t="none"){switch(si(e)){case 0:return null;case 1:return e.booleanValue;case 2:return bt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ls(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ce()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return yi(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(a=>bt(a.doubleValue));return new jh(i)}convertGeoPoint(e){return new cy(bt(e.latitude),bt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=bh(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(oc(e));default:return null}}convertTimestamp(e){const t=os(e);return new Ct(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ue.fromString(e);pe(BT(r));const s=new Ji(r.get(1),r.get(3)),i=new oe(r.popFirst(5));return s.isEqual(t)||Lt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class SM extends GI{constructor(e){super(),this.firestore=e}convertBytes(e){return new ia(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $t(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _L(n){return new mc("sum",fc("sum",n))}function EL(n){return new mc("avg",fc("average",n))}function CM(){return new mc("count")}function TL(n,e){var t,r;return n instanceof mc&&e instanceof mc&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function IL(n,e){return jI(n.query,e.query)&&ni(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Eo extends pc{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ed(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Lh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class ed extends Eo{data(e={}){return super.data(e)}}class To{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Oi(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ed(this._firestore,this._userDataWriter,r.key,r,new Oi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Z(U.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(l=>{const c=new ed(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Oi(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const c=new ed(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Oi(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,h=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),h=a.indexOf(l.doc.key)),{type:NM(l.type),doc:c,oldIndex:d,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function NM(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ce()}}function SL(n,e){return n instanceof Eo&&e instanceof Eo?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof To&&e instanceof To&&n._firestore===e._firestore&&jI(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(n){n=Le(n,$t);const e=Le(n.firestore,ot);return AI(At(e),n._key).then(t=>xy(e,n,t))}class xi extends GI{constructor(e){super(),this.firestore=e}convertBytes(e){return new ia(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $t(this.firestore,null,t)}}function CL(n){n=Le(n,$t);const e=Le(n.firestore,ot),t=At(e),r=new xi(e);return oM(t,n._key).then(s=>new Eo(e,r,n._key,s,new Oi(s!==null&&s.hasLocalMutations,!0),n.converter))}function NL(n){n=Le(n,$t);const e=Le(n.firestore,ot);return AI(At(e),n._key,{source:"server"}).then(t=>xy(e,n,t))}function Fn(n){n=Le(n,bn);const e=Le(n.firestore,ot),t=At(e),r=new xi(e);return zI(n._query),kI(t,n._query).then(s=>new To(e,r,n,s))}function AL(n){n=Le(n,bn);const e=Le(n.firestore,ot),t=At(e),r=new xi(e);return lM(t,n._query).then(s=>new To(e,r,n,s))}function kL(n){n=Le(n,bn);const e=Le(n.firestore,ot),t=At(e),r=new xi(e);return kI(t,n._query,{source:"server"}).then(s=>new To(e,r,n,s))}function PL(n,e,t){n=Le(n,$t);const r=Le(n.firestore,ot),s=Uh(n.converter,e,t);return zc(r,[Mh(da(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Et.none())])}function kt(n,e,t,...r){n=Le(n,$t);const s=Le(n.firestore,ot),i=da(s);let a;return a=typeof(e=it(e))=="string"||e instanceof ca?py(i,"updateDoc",n._key,e,t,r):fy(i,"updateDoc",n._key,e),zc(s,[a.toMutation(n._key,Et.exists(!0))])}function td(n){return zc(Le(n.firestore,ot),[new Mo(n._key,Et.none())])}function bi(n,e){const t=Le(n.firestore,ot),r=Ke(n),s=Uh(n.converter,e);return zc(t,[Mh(da(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Et.exists(!1))]).then(()=>r)}function Bc(n,...e){var t,r,s;n=it(n);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||up(e[a])||(i=e[a],a++);const l={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(up(e[a])){const m=e[a];e[a]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[a+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[a+2]=(s=m.complete)===null||s===void 0?void 0:s.bind(m)}let c,d,h;if(n instanceof $t)d=Le(n.firestore,ot),h=jo(n._key.path),c={next:m=>{e[a]&&e[a](xy(d,n,m))},error:e[a+1],complete:e[a+2]};else{const m=Le(n,bn);d=Le(m.firestore,ot),h=m._query;const p=new xi(d);c={next:y=>{e[a]&&e[a](new To(d,p,m,y))},error:e[a+1],complete:e[a+2]},zI(n._query)}return function(p,y,_,T){const E=new kh(T),x=new Zg(y,E,_);return p.asyncQueue.enqueueAndForget(async()=>Yg(await _o(p),x)),()=>{E.Za(),p.asyncQueue.enqueueAndForget(async()=>Jg(await _o(p),x))}}(At(d),h,l,c)}function RL(n,e){return uM(At(n=Le(n,ot)),up(e)?e:{next:e})}function zc(n,e){return function(r,s){const i=new un;return r.asyncQueue.enqueueAndForget(async()=>OD(await oy(r),s,i)),i.promise}(At(n),e)}function xy(n,e,t){const r=t.docs.get(e._key),s=new xi(n);return new Eo(n,s,e._key,r,new Oi(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jL(n){return AM(n,{count:CM()})}function AM(n,e){const t=Le(n.firestore,ot),r=At(t),s=QE(e,(i,a)=>new IT(a,i.aggregateType,i._internalFieldPath));return cM(r,n._query,s).then(i=>function(l,c,d){const h=new xi(l);return new bM(c,h,d)}(t,n,i))}class kM{constructor(e){this.kind="memory",this._onlineComponentProvider=ci.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=li.provider}toJSON(){return{kind:this.kind}}}class PM{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=VM(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class RM{constructor(){this.kind="memoryEager",this._offlineComponentProvider=li.provider}toJSON(){return{kind:this.kind}}}class jM{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new eM(e)}}toJSON(){return{kind:this.kind}}}function DL(){return new RM}function ML(n){return new jM(n==null?void 0:n.cacheSizeBytes)}function VL(n){return new kM(n)}function LL(n){return new PM(n)}class DM{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ci.provider,this._offlineComponentProvider={build:t=>new iy(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class MM{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ci.provider,this._offlineComponentProvider={build:t=>new II(t,e==null?void 0:e.cacheSizeBytes)}}}function VM(n){return new DM(n==null?void 0:n.forceOwnership)}function OL(){return new MM}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LM={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OM{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=da(e)}set(e,t,r){this._verifyNotCommitted();const s=Ls(e,this._firestore),i=Uh(s.converter,t,r),a=Mh(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(a.toMutation(s._key,Et.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Ls(e,this._firestore);let a;return a=typeof(t=it(t))=="string"||t instanceof ca?py(this._dataReader,"WriteBatch.update",i._key,t,r,s):fy(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(a.toMutation(i._key,Et.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ls(e,this._firestore);return this._mutations=this._mutations.concat(new Mo(t._key,Et.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Z(U.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ls(n,e){if((n=it(n)).firestore!==e)throw new Z(U.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FM extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=da(t)}get(t){const r=Ls(t,this._firestore),s=new SM(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return ce();const a=i[0];if(a.isFoundDocument())return new pc(this._firestore,s,a.key,a,r.converter);if(a.isNoDocument())return new pc(this._firestore,s,r._key,null,r.converter);throw ce()})}set(t,r,s){const i=Ls(t,this._firestore),a=Uh(i.converter,r,s),l=Mh(this._dataReader,"Transaction.set",i._key,a,i.converter!==null,s);return this._transaction.set(i._key,l),this}update(t,r,s,...i){const a=Ls(t,this._firestore);let l;return l=typeof(r=it(r))=="string"||r instanceof ca?py(this._dataReader,"Transaction.update",a._key,r,s,i):fy(this._dataReader,"Transaction.update",a._key,r),this._transaction.update(a._key,l),this}delete(t){const r=Ls(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ls(e,this._firestore),r=new xi(this._firestore);return super.get(e).then(s=>new Eo(this._firestore,r,t._key,s._document,new Oi(!1,!1),t.converter))}}function $L(n,e,t){n=Le(n,ot);const r=Object.assign(Object.assign({},LM),t);return function(i){if(i.maxAttempts<1)throw new Z(U.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,a,l){const c=new un;return i.asyncQueue.enqueueAndForget(async()=>{const d=await NI(i);new rM(i.asyncQueue,d,l,a,c).au()}),c.promise}(At(n),s=>e(new FM(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UL(){return new Fc("deleteField")}function Me(){return new uy("serverTimestamp")}function BL(...n){return new dy("arrayUnion",n)}function zL(...n){return new hy("arrayRemove",n)}function qL(n){return new my("increment",n)}function WL(n){return new jh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HL(n){return At(n=Le(n,ot)),new OM(n,e=>zc(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GL(n,e){const t=At(n=Le(n,ot));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return gr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const a=typeof i=="string"?function(d){try{return JSON.parse(d)}catch(h){throw new Z(U.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,l=[];if(Array.isArray(a.indexes))for(const c of a.indexes){const d=ab(c,"collectionGroup"),h=[];if(Array.isArray(c.fields))for(const m of c.fields){const p=Vh("setIndexConfiguration",ab(m,"fieldPath"));m.arrayConfig==="CONTAINS"?h.push(new Bi(p,2)):m.order==="ASCENDING"?h.push(new Bi(p,0)):m.order==="DESCENDING"&&h.push(new Bi(p,1))}l.push(new co(co.UNKNOWN_ID,d,h,uo.empty()))}return l}(e);return mM(t,r)}function ab(n,e){if(typeof n[e]!="string")throw new Z(U.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $M{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function KL(n){var e;n=Le(n,ot);const t=ob.get(n);if(t)return t;if(((e=At(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new $M(n);return ob.set(n,r),r}function QL(n){KI(n,!0)}function YL(n){KI(n,!1)}function JL(n){pM(At(n._firestore)).then(e=>X("deleting all persistent cache indexes succeeded")).catch(e=>gr("deleting all persistent cache indexes failed",e))}function KI(n,e){fM(At(n._firestore),e).then(t=>X(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>gr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const ob=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XL(n){var e;const t=(e=At(Le(n.firestore,ot))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Th(t,Rn(n._query))._t}function ZL(n,e){var t;const r=QE(e,(i,a)=>new IT(a,i.aggregateType,i._internalFieldPath)),s=(t=At(Le(n.firestore,ot))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:OT(s,cT(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return by.instance.onExistenceFilterMismatch(e)}}class by{constructor(){this.Uu=new Map}static get instance(){return Nu||(Nu=new by,function(t){if(Fd)throw new Error("a TestingHooksSpi instance is already set");Fd=t}(Nu)),Nu}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Nu=null;(function(e,t=!0){(function(s){Ro=s})(ko),oo(new Ki("firestore",(r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new ot(new dj(r.getProvider("auth-internal")),new fj(r.getProvider("app-check-internal")),function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new Z(U.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ji(d.options.projectId,h)}(a,s),a);return i=Object.assign({useFetchStreams:t},i),l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),Zs(Yv,"4.7.3",e),Zs(Yv,"4.7.3","esm2017")})();const UM={apiKey:"AIzaSyB_1Dn63ZHRnA-jXytu95WEBWNFQ64Jo_E",authDomain:"dnd-v1-17acc.firebaseapp.com",projectId:"dnd-v1-17acc",storageBucket:"dnd-v1-17acc.firebasestorage.app",messagingSenderId:"976056329393",appId:"1:976056329393:web:7c8170e906162fe4ef2e90"},QI=z_(UM),cs=ij(QI),ve=xM(QI),BM=n=>{console.warn("Firestore connection issue:",n)},Om=Object.freeze(Object.defineProperty({__proto__:null,auth:cs,db:ve,handleFirestoreError:BM},Symbol.toStringTag,{value:"Module"})),zM=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),Ce=(n,e)=>{throw console.error(`Error in ${e}:`,n),n.code==="unavailable"||n.code==="deadline-exceeded"?new Error("Network connection issue. Please check your internet connection and try again."):n.code==="permission-denied"?new Error("Access denied. Please check your permissions."):n.code==="not-found"?new Error("The requested data was not found."):new Error(`Database error: ${n.message}`)},YI=async(n,e)=>{try{const t={...e,userId:n,createdAt:Me(),updatedAt:Me()};return{id:(await bi(gt(ve,"userProfiles"),t)).id,...t}}catch(t){Ce(t,"createUserProfile")}},ma=async n=>{try{const e=wn(gt(ve,"userProfiles"),Kt("userId","==",n)),t=await Fn(e);if(t.empty)return null;const r=t.docs[0];return{id:r.id,...r.data()}}catch(e){Ce(e,"getUserProfile")}},Qd=async n=>{try{if(!n||n.length===0)return[];const e=[];for(let s=0;s<n.length;s+=10){const i=n.slice(s,s+10),a=wn(gt(ve,"userProfiles"),Kt("userId","in",i));e.push(Fn(a))}const t=await Promise.all(e),r=[];return t.forEach(s=>{s.docs.forEach(i=>{r.push({id:i.id,...i.data()})})}),r}catch(e){Ce(e,"getUserProfiles")}},qM=async(n,e)=>{try{const t=await ma(n);if(!t)throw new Error("User profile not found");const r=Ke(ve,"userProfiles",t.id);await kt(r,{...e,updatedAt:Me()})}catch(t){Ce(t,"updateUserProfile")}},JI=async n=>{try{const e=wn(gt(ve,"userProfiles"),Kt("username","==",n));return(await Fn(e)).empty}catch(e){Ce(e,"checkUsernameAvailability")}},wy=n=>{const{class:e,level:t,constitution:r,dexterity:s,strength:i}=n,l={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[e]||8,c=Math.floor((r-10)/2),d=Math.max(1,(l+c)*t),h=10,m=Math.floor((s-10)/2),y={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[e]||0,_=h+m+y;return{hp:Math.max(1,d),maxHp:Math.max(1,d),ac:Math.max(10,_)}},XI=async(n,e,t)=>{try{const r=gt(ve,"characters"),s=wy(t),i={...t,...s,userId:n,partyId:e,createdAt:new Date,updatedAt:new Date};return{id:(await bi(r,i)).id,...i}}catch(r){throw new Error(`Failed to save character: ${r.message}`)}},Vl=async n=>{try{const e=gt(ve,"characters"),t=wn(e,Kt("userId","==",n));return(await Fn(t)).docs.map(i=>({id:i.id,...i.data()}))}catch(e){throw new Error(`Failed to get user characters: ${e.message}`)}},ZI=async(n,e)=>{try{const t=gt(ve,"characters"),r=wn(t,Kt("userId","==",n),Kt("partyId","==",e)),s=await Fn(r);if(s.empty)return null;const i=s.docs[0];return{id:i.id,...i.data()}}catch(t){throw new Error(`Failed to get character: ${t.message}`)}},ui=async n=>{try{const e=wn(gt(ve,"characters"),Kt("partyId","==",n));return(await Fn(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){Ce(e,"getPartyCharacters")}},WM=async(n,e)=>{try{const t=Ke(ve,"characters",n),r=await Dn(t);if(!r.exists())throw new Error(`Character document with ID ${n} does not exist`);const s=r.data(),i={...e,updatedAt:new Date};if(e.class||e.level||e.constitution||e.dexterity||e.strength||e.wisdom){const l={...s,...e},c=wy(l);Object.assign(i,c)}return await kt(t,i),{id:n,...s,...i}}catch(t){throw t}},Yd=async n=>{try{const e=Ke(ve,"characters",n);return await td(e),!0}catch(e){throw new Error(`Failed to delete character: ${e.message}`)}},HM=async n=>{try{console.log("Debugging characters for user:",n);const e=wn(gt(ve,"characters"),Kt("userId","==",n)),r=(await Fn(e)).docs.map(a=>({id:a.id,...a.data()}));console.log("All characters for user:",r);const s=r.filter(a=>!a.partyId);s.length>0&&console.warn("Found characters without partyId:",s);const i={};return r.forEach(a=>{a.partyId&&(i[a.partyId]||(i[a.partyId]=[]),i[a.partyId].push(a))}),Object.entries(i).forEach(([a,l])=>{l.length>1&&console.warn(`Multiple characters found for party ${a}:`,l)}),{totalCharacters:r.length,orphanedCharacters:s.length,partyGroups:i}}catch(e){throw console.error("Error debugging characters:",e),e}},GM=async n=>{try{const t=(await Vl(n)).filter(s=>!s.partyId);if(t.length===0)return{deleted:0};const r=t.map(s=>Yd(s.id));return await Promise.all(r),{deleted:t.length}}catch(e){throw new Error(`Failed to cleanup orphaned characters: ${e.message}`)}},eS=async(n,e)=>{try{const t={...e,dmId:n,members:[n],createdAt:Me(),updatedAt:Me()};return{id:(await bi(gt(ve,"parties"),t)).id,...t}}catch(t){Ce(t,"createParty")}},tS=async n=>{try{const e=wn(gt(ve,"parties"),Kt("members","array-contains",n));return(await Fn(e)).docs.map(s=>{const i=s.data();return{id:s.id,...i}})}catch(e){Ce(e,"getUserParties")}},nS=async()=>{try{const n=wn(gt(ve,"parties"),Kt("isPublic","==",!0));return(await Fn(n)).docs.map(r=>{const s=r.data();return{id:r.id,...s}}).sort((r,s)=>{var l,c,d,h;const i=((c=(l=r.createdAt)==null?void 0:l.toDate)==null?void 0:c.call(l))||r.createdAt||new Date(0);return(((h=(d=s.createdAt)==null?void 0:d.toDate)==null?void 0:h.call(d))||s.createdAt||new Date(0))-i})}catch(n){Ce(n,"getPublicParties")}},dp=async(n,e)=>{try{const t=Ke(ve,"parties",n),r=await Dn(t);if(!r.exists())throw new Error("Party not found");const s=r.data();if(s.members.includes(e))throw new Error("User already in party");await kt(t,{members:[...s.members,e],updatedAt:Me()})}catch(t){Ce(t,"joinParty")}},rS=async(n,e)=>{try{const t=Ke(ve,"parties",n),r=await Dn(t);if(!r.exists())throw new Error("Party not found");if(r.data().dmId!==e)throw new Error("Only the party leader can disband the party");await td(t);const i=wn(gt(ve,"characters"),Kt("partyId","==",n)),l=(await Fn(i)).docs.map(m=>td(m.ref));await Promise.all(l);const c=wn(gt(ve,"campaignStories"),Kt("partyId","==",n)),h=(await Fn(c)).docs.map(m=>td(m.ref));await Promise.all(h)}catch(t){Ce(t,"disbandParty")}},sS=async n=>{try{const e=wn(gt(ve,"parties"),Kt("inviteCode","==",n)),t=await Fn(e);if(t.empty)return null;const r=t.docs[0];return{id:r.id,...r.data()}}catch(e){Ce(e,"getPartyByInviteCode")}},Bh=async n=>{try{const e=Ke(ve,"parties",n),t=await Dn(e);return t.exists()?{id:t.id,...t.data()}:null}catch(e){Ce(e,"getPartyById")}},KM=async(n,e)=>{try{const t={...e,partyId:n,createdAt:Me(),updatedAt:Me()};return{id:(await bi(gt(ve,"campaigns"),t)).id,...t}}catch(t){Ce(t,"saveCampaign")}},QM=async n=>{try{const e=wn(gt(ve,"campaigns"),Kt("partyId","==",n)),t=await Fn(e);if(t.empty)return null;const r=t.docs[0];return{id:r.id,...r.data()}}catch(e){Ce(e,"getCampaignByParty")}},YM=async(n,e)=>{try{const t=Ke(ve,"campaigns",n);await kt(t,{...e,updatedAt:Me()})}catch(t){Ce(t,"updateCampaign")}},JM=async(n,e)=>{try{const t={...e,partyId:n,status:"active",createdAt:Me(),updatedAt:Me()};return{id:(await bi(gt(ve,"combats"),t)).id,...t}}catch(t){Ce(t,"saveCombat")}},XM=async n=>{try{const e=wn(gt(ve,"combats"),Kt("partyId","==",n),Kt("status","==","active")),t=await Fn(e);return t.empty?null:t.docs.map(i=>({id:i.id,...i.data()})).sort((i,a)=>{var d,h,m,p;const l=((h=(d=i.createdAt)==null?void 0:d.toDate)==null?void 0:h.call(d))||i.createdAt||new Date(0);return(((p=(m=a.createdAt)==null?void 0:m.toDate)==null?void 0:p.call(m))||a.createdAt||new Date(0))-l})[0]}catch(e){Ce(e,"getActiveCombat")}},ZM=async(n,e)=>{try{const t=Ke(ve,"combats",n);await kt(t,{...e,updatedAt:Me()})}catch(t){Ce(t,"updateCombat")}},_y=(n,e)=>{const t=Ke(ve,"parties",n);return Bc(t,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})},eV=(n,e)=>{const t=wn(gt(ve,"campaigns"),Kt("partyId","==",n));return Bc(t,r=>{if(r.empty)e(null);else{const s=r.docs[0];e({id:s.id,...s.data()})}})},tV=(n,e)=>{const t=wn(gt(ve,"combats"),Kt("partyId","==",n),Kt("status","==","active"));return Bc(t,r=>{if(r.empty)e(null);else{const s=r.docs[0];e({id:s.id,...s.data()})}})},iS=async n=>{try{const e={partyId:n,status:"ready_up",currentPlot:null,storyMessages:[],votingSession:null,readyPlayers:[],lastUpdated:Me(),createdAt:Me()};return{id:(await bi(gt(ve,"campaignStories"),e)).id,...e}}catch(e){Ce(e,"createCampaignStory")}},Za=async n=>{try{const e=wn(gt(ve,"campaignStories"),Kt("partyId","==",n)),t=await Fn(e);if(t.empty)return null;const r=t.docs[0];return{id:r.id,...r.data()}}catch(e){Ce(e,"getCampaignStory")}},Ht=async(n,e)=>{try{const t=Ke(ve,"campaignStories",n);await kt(t,{...e,lastUpdated:Me()})}catch(t){Ce(t,"updateCampaignStory")}},nV=async(n,e)=>{try{const t=Ke(ve,"campaignStories",n),s=(await Dn(t)).data(),i={id:`msg_${Date.now()}`,...e,timestamp:new Date};return await kt(t,{storyMessages:[...s.storyMessages,i],lastUpdated:Me()}),i}catch(t){Ce(t,"addStoryMessage")}},aS=async(n,e)=>{try{const t=Ke(ve,"campaignStories",n),i=(await Dn(t)).data().readyPlayers||[];i.includes(e)||await kt(t,{readyPlayers:[...i,e],lastUpdated:Me()})}catch(t){Ce(t,"setPlayerReady")}},oS=(n,e)=>{try{const t=Ke(ve,"campaignStories",n);return Bc(t,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})}catch(t){Ce(t,"subscribeToCampaignStory")}},lS=async(n,e)=>{try{const t=Ke(ve,"campaignStories",n);await kt(t,{currentSpeaker:e,lastUpdated:Me()})}catch(t){Ce(t,"setCurrentSpeaker")}},rV=async(n,e)=>{try{const t=Ke(ve,"campaignStories",n);await kt(t,{currentController:e,lastUpdated:Me()})}catch(t){Ce(t,"setCurrentController")}},sV=async(n,e)=>{try{const t={partyId:n,status:"active",storyContext:e.storyContext,partyMembers:e.partyMembers,enemies:e.enemies,combatants:e.combatants,initiative:e.initiative,currentTurn:e.currentTurn||0,round:e.round||1,combatState:e.combatState||"active",environmentalFeatures:e.environmentalFeatures,teamUpOpportunities:e.teamUpOpportunities,narrativeElements:e.narrativeElements,battleLog:e.battleLog||[],createdAt:Me(),updatedAt:Me()};return{id:(await bi(gt(ve,"combatSessions"),t)).id,...t}}catch(t){Ce(t,"createCombatSession")}},cS=async n=>{try{const e=Ke(ve,"combatSessions",n),t=await Dn(e);return t.exists()?{id:t.id,...t.data()}:null}catch(e){Ce(e,"getCombatSession")}},ki=async(n,e)=>{try{console.log(" updateCombatSession called with:",{combatId:n,updates:e});const t=Ke(ve,"combatSessions",n);await kt(t,{...e,lastUpdated:Me()}),console.log(" updateCombatSession completed successfully")}catch(t){console.error(" Error in updateCombatSession:",t),Ce(t,"updateCombatSession")}},uS=(n,e)=>{try{console.log(" Setting up combat session subscription for:",n);const t=Ke(ve,"combatSessions",n);return Bc(t,s=>{if(console.log(" Combat session subscription update received:",s.exists()?"Document exists":"Document does not exist"),s.exists()){const i={id:s.id,...s.data()};console.log(" Combat session data from subscription:",i),e(i)}else console.log(" Combat session document does not exist"),e(null)})}catch(t){console.error(" Error in subscribeToCombatSession:",t),Ce(t,"subscribeToCombatSession")}},dS=async(n,e)=>{try{const t=await ma(n);if(!t)throw new Error("User profile not found");const r={id:zM(),...e,createdAt:new Date},i=[...t.characterPresets||[],r];return await kt(Ke(ve,"userProfiles",t.id),{characterPresets:i}),r}catch(t){throw new Error(`Failed to save character preset: ${t.message}`)}},hS=async n=>{try{const e=await ma(n);return e?e.characterPresets||[]:[]}catch(e){Ce(e,"getUserCharacterPresets")}},mS=async(n,e)=>{try{const t=await ma(n);if(!t)throw new Error("User profile not found");const s=(t.characterPresets||[]).filter(a=>a.id!==e),i=Ke(ve,"userProfiles",t.id);await kt(i,{characterPresets:s,updatedAt:Me()})}catch(t){Ce(t,"deleteCharacterPreset")}},iV=async(n,e)=>{try{const t=Ke(ve,"campaignStories",n),a={...(await Dn(t)).data().campaignMetadata||{},...e,lastUpdated:Me()};return await kt(t,{campaignMetadata:a,lastUpdated:Me()}),a}catch(t){Ce(t,"updateCampaignMetadata")}},aV=async(n,e)=>{try{const t=Ke(ve,"campaignStories",n),i=(await Dn(t)).data().campaignSessions||[],a={id:`session_${Date.now()}`,...e,timestamp:Me()};return await kt(t,{campaignSessions:[...i,a],lastUpdated:Me()}),a}catch(t){Ce(t,"saveCampaignSession")}},oV=async(n,e)=>{try{const t=Ke(ve,"campaignStories",n),i=(await Dn(t)).data().campaignNotes||[],a={id:`note_${Date.now()}`,content:e.content,type:e.type||"general",timestamp:Me(),createdBy:e.createdBy};return await kt(t,{campaignNotes:[...i,a],lastUpdated:Me()}),a}catch(t){Ce(t,"addCampaignNote")}},lV=async(n,e)=>{try{const t=Ke(ve,"campaignStories",n);await kt(t,{"campaignMetadata.mainGoal":e,lastUpdated:Me()})}catch(t){Ce(t,"updateCampaignGoal")}},cV=async(n,e)=>{try{const t=Ke(ve,"campaignStories",n);return await kt(t,{storyState:{...e,lastUpdated:Me()},lastUpdated:Me()}),e}catch(t){Ce(t,"saveStoryState")}},uV=async n=>{try{const e=Ke(ve,"campaignStories",n);return(await Dn(e)).data().storyState||null}catch(e){Ce(e,"getStoryState")}},dV=async(n,e)=>{try{const t=Ke(ve,"campaignStories",n),a={...(await Dn(t)).data().storyState||{},...e,lastUpdated:Me()};return await kt(t,{storyState:a,lastUpdated:Me()}),a}catch(t){Ce(t,"updateStoryState")}},hV=async(n,e)=>{try{const t=(e.partyMembers||[]).map(l=>({...l,id:l.id,isEnemy:!1,userId:l.userId,cooldowns:{},statusEffects:[]})),r=(e.enemies||[]).map(l=>({...l,id:l.id,isEnemy:!0,userId:null,cooldowns:{},statusEffects:[]})),s=[...t,...r],i={partyId:n,status:"active",storyContext:e.storyContext,partyMembers:e.partyMembers,enemies:e.enemies,combatants:s,initiative:e.initiative||[],currentTurn:0,round:1,combatState:"preparation",environmentalFeatures:e.environmentalFeatures||[],teamUpOpportunities:e.teamUpOpportunities||[],narrativeElements:e.narrativeElements||{},statusEffects:{},cooldowns:{},createdAt:Me(),updatedAt:Me()};return{id:(await bi(gt(ve,"combatSessions"),i)).id,...i}}catch(t){Ce(t,"createEnhancedCombatSession")}},hp=async(n,e)=>{try{const t=Ke(ve,"combatSessions",n);await kt(t,{...e,updatedAt:Me()})}catch(t){Ce(t,"updateCombatSessionWithNarrative")}},fS=async(n,e)=>{try{console.log(" Adding to combat battle log:",{combatId:n,logEntry:e});const t=Ke(ve,"combatSessions",n),r=await Dn(t);if(r.exists()){const a=[...r.data().battleLog||[],e];await kt(t,{battleLog:a,lastUpdated:Me()}),console.log(" Battle log updated successfully")}}catch(t){console.error(" Error in addToCombatBattleLog:",t),Ce(t,"addToCombatBattleLog")}},mV=async(n,e,t=null)=>{var r,s;try{const i=Ke(ve,"campaignStories",n),l=(await Dn(i)).data(),c={id:`msg_${Date.now()}`,...e,timestamp:new Date,metadata:{storyStateSnapshot:t?{currentLocation:(r=t.currentLocation)==null?void 0:r.name,activeNPCs:Object.keys(t.activeNPCs||{}),activePlotThreads:((s=t.activePlotThreads)==null?void 0:s.map(d=>d.title))||[],characterRelationships:t.characterArcs?Object.entries(t.characterArcs).map(([d,h])=>({characterId:d,relationships:Object.keys(h.relationships||{})})):[]}:null}};return await kt(i,{storyMessages:[...l.storyMessages,c],lastUpdated:Me()}),c}catch(i){Ce(i,"addStoryMessageWithMetadata")}},fV=async n=>{var e,t,r,s;try{const i=Ke(ve,"campaignStories",n),l=(await Dn(i)).data();return{storyState:l.storyState||null,campaignMetadata:l.campaignMetadata||null,recentMessages:((e=l.storyMessages)==null?void 0:e.slice(-10))||[],activeNPCs:((t=l.storyState)==null?void 0:t.activeNPCs)||{},characterArcs:((r=l.storyState)==null?void 0:r.characterArcs)||{},plotThreads:((s=l.storyState)==null?void 0:s.activePlotThreads)||[]}}catch(i){Ce(i,"getStoryConsistencyData")}},pS=async n=>{try{const e=Ke(ve,"characters",n),t=await Dn(e);if(!t.exists())throw new Error(`Character document with ID ${n} does not exist`);const r=t.data(),s=wy(r);return await kt(e,{...s,updatedAt:new Date}),{id:n,...r,...s}}catch(e){throw new Error(`Failed to recalculate character stats: ${e.message}`)}},gS=async n=>{try{const t=(await ui(n)).filter(s=>!s.hp||!s.maxHp||!s.ac).map(s=>pS(s.id));return await Promise.all(t)}catch(e){throw new Error(`Failed to update party character stats: ${e.message}`)}},pV=Object.freeze(Object.defineProperty({__proto__:null,addCampaignNote:oV,addStoryMessage:nV,addStoryMessageWithMetadata:mV,addToCombatBattleLog:fS,checkUsernameAvailability:JI,cleanupOrphanedCharacters:GM,createCampaignStory:iS,createCombatSession:sV,createEnhancedCombatSession:hV,createParty:eS,createUserProfile:YI,debugUserCharacters:HM,deleteCharacter:Yd,deleteCharacterPreset:mS,disbandParty:rS,getActiveCombat:XM,getCampaignByParty:QM,getCampaignStory:Za,getCharacterByUserAndParty:ZI,getCombatSession:cS,getPartyById:Bh,getPartyByInviteCode:sS,getPartyCharacters:ui,getPublicParties:nS,getStoryConsistencyData:fV,getStoryState:uV,getUserCharacterPresets:hS,getUserCharacters:Vl,getUserParties:tS,getUserProfile:ma,getUserProfiles:Qd,joinParty:dp,recalculateCharacterStats:pS,saveCampaign:KM,saveCampaignSession:aV,saveCharacter:XI,saveCharacterPreset:dS,saveCombat:JM,saveStoryState:cV,setCurrentController:rV,setCurrentSpeaker:lS,setPlayerReady:aS,subscribeToCampaign:eV,subscribeToCampaignStory:oS,subscribeToCombat:tV,subscribeToCombatSession:uS,subscribeToParty:_y,updateCampaign:YM,updateCampaignGoal:lV,updateCampaignMetadata:iV,updateCampaignStory:Ht,updateCharacter:WM,updateCombat:ZM,updateCombatSession:ki,updateCombatSessionWithNarrative:hp,updatePartyCharacterStats:gS,updateStoryState:dV,updateUserProfile:qM},Symbol.toStringTag,{value:"Module"})),yS=()=>{const[n,e]=A.useState(null),[t,r]=A.useState(!0);return A.useEffect(()=>yE(cs,i=>{e(i),r(!1)}),[]),{user:n,loading:t}},gV=async(n,e,t)=>{try{if(console.log("Starting registration for:",n,t),!await JI(t))return console.log("Username not available:",t),{user:null,error:"Username is already taken. Please choose a different username."};console.log("Username available:",t);const s=await qP(cs,n,e);console.log("User created successfully:",s.user.uid);try{await YI(s.user.uid,{username:t,email:n,displayName:t}),console.log("User profile created successfully")}catch(a){console.error("Error creating user profile:",a)}let i=!1;try{await HP(s.user),console.log("Email verification sent successfully"),i=!0}catch(a){console.error("Error sending email verification:",a)}return await vE(cs),console.log("User signed out after registration"),{user:null,error:null,success:!0}}catch(r){return console.error("Registration error:",r),{user:null,error:r.message}}},yV=async(n,e)=>{try{return{user:(await WP(cs,n,e)).user,error:null}}catch(t){return{user:null,error:t.message}}},vV=async()=>{try{return await vE(cs),{error:null}}catch(n){return{error:n.message}}},Bo=n=>yE(cs,async e=>{n(e)}),xV=async()=>{try{return console.log("Testing Firebase connection..."),console.log("Auth domain:",cs.config.authDomain),console.log("Project ID:",cs.config.projectId),{success:!0,message:"Firebase connection successful"}}catch(n){return console.error("Firebase connection test failed:",n),{success:!1,error:n.message}}};function bV(){const[n,e]=A.useState(null),[t,r]=A.useState(null),[s,i]=A.useState(!1),[a,l]=A.useState(!1),c=yr(),h=hs().pathname==="/dashboard";A.useEffect(()=>{const y=Bo(async _=>{if(e(_),_)try{const T=await ma(_.uid);r(T)}catch(T){console.error("Error loading user profile:",T)}else r(null)});return()=>y()},[c]);const m=async()=>{const{error:y}=await vV();y||(c("/"),l(!1),i(!1))},p=()=>{if(t!=null&&t.username)return t.username;if(n!=null&&n.displayName)return n.displayName;if(n!=null&&n.email){const y=n.email.split("@")[0];if(y.length>15){const _=y.split(/[._]/)[0];return _.charAt(0).toUpperCase()+_.slice(1)}return y}return"Adventurer"};return o.jsx("nav",{className:"bg-gradient-to-r from-slate-900 to-slate-800 text-slate-100 shadow-lg border-b border-slate-600/50 backdrop-blur-sm",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsxs(ks,{to:"/",className:"flex items-center space-x-2 group",children:[o.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-amber-500 to-orange-500 rounded-lg flex items-center justify-center",children:o.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx("span",{className:"text-xl sm:text-2xl font-bold bg-gradient-to-r from-amber-400 to-orange-400 bg-clip-text text-transparent group-hover:from-amber-300 group-hover:to-orange-300 transition-all duration-300",children:"DND-V1"})]}),o.jsx("div",{className:"hidden md:flex items-center space-x-2",children:n?o.jsxs(o.Fragment,{children:[!h&&o.jsx(ks,{to:"/dashboard",className:"px-4 py-2 text-slate-200 hover:text-amber-400 font-medium transition-colors duration-300",children:"Dashboard"}),o.jsxs("div",{className:"relative ml-4",children:[o.jsxs("button",{onClick:()=>i(!s),className:"flex items-center space-x-2 px-4 py-2 bg-slate-700/50 hover:bg-slate-600/50 rounded-lg transition-all duration-300 border border-slate-600/50 hover:border-slate-500/50",children:[o.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-xs font-bold text-white",children:p().charAt(0).toUpperCase()})}),o.jsx("span",{className:"text-slate-200 font-medium",children:p()}),o.jsx("svg",{className:`w-4 h-4 text-slate-400 transition-transform duration-300 ${s?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),s&&o.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-slate-800/95 backdrop-blur-sm rounded-xl shadow-2xl border border-slate-600/50 z-50",children:o.jsxs("div",{className:"p-4",children:[o.jsxs("div",{className:"flex items-center space-x-3 pb-3 border-b border-slate-600/50",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-sm font-bold text-white",children:p().charAt(0).toUpperCase()})}),o.jsxs("div",{className:"min-w-0 flex-1",children:[o.jsx("div",{className:"font-semibold text-slate-200",children:p()}),o.jsx("div",{className:"text-xs text-slate-400 truncate",children:n.email})]})]}),o.jsxs("button",{onClick:m,className:"w-full flex items-center space-x-2 px-3 py-2 text-sm text-slate-200 hover:bg-slate-700/50 rounded-lg transition-colors duration-300 mt-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),o.jsx("span",{children:"Logout"})]})]})})]})]}):o.jsx(ks,{to:"/login",className:"px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",children:"Login"})}),o.jsx("div",{className:"md:hidden",children:o.jsx("button",{onClick:()=>l(!a),className:"p-2 text-slate-200 hover:text-amber-400 transition-colors duration-300",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a?o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})})]}),a&&o.jsx("div",{className:"md:hidden pb-4 border-t border-slate-600/50",children:n?o.jsxs("div",{className:"pt-4 space-y-2",children:[!h&&o.jsx(ks,{to:"/dashboard",className:"block px-4 py-3 text-slate-200 hover:text-amber-400 hover:bg-slate-700/50 rounded-lg transition-all duration-300",onClick:()=>l(!1),children:"Dashboard"}),o.jsxs("div",{className:"pt-4 border-t border-slate-600/50",children:[o.jsxs("div",{className:"flex items-center space-x-3 px-4 py-3",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-sm font-bold text-white",children:p().charAt(0).toUpperCase()})}),o.jsxs("div",{className:"min-w-0 flex-1",children:[o.jsx("div",{className:"font-semibold text-slate-200",children:p()}),o.jsx("div",{className:"text-xs text-slate-400 truncate",children:n.email})]})]}),o.jsxs("button",{onClick:m,className:"w-full flex items-center space-x-2 px-4 py-3 text-slate-200 hover:bg-slate-700/50 rounded-lg transition-colors duration-300",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),o.jsx("span",{children:"Logout"})]})]})]}):o.jsx("div",{className:"pt-4",children:o.jsx(ks,{to:"/login",className:"block w-full px-4 py-3 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold rounded-lg transition-all duration-300 text-center",onClick:()=>l(!1),children:"Login"})})})]})})}const wV="modulepreload",_V=function(n){return"/DND-V1/"+n},lb={},Ii=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=_V(i),i in lb)return;lb[i]=!0;const a=i.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const m=s[h];if(m.href===i&&(!a||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${l}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":wV,a||(d.as="script",d.crossOrigin=""),d.href=i,document.head.appendChild(d),a)return new Promise((h,m)=>{d.addEventListener("load",h),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i})};class vS{constructor(){this.actionTypes={attack:{name:"Attack",cooldown:0,priority:"normal",description:"A basic physical attack",narrativeTemplate:"{character} {action} with {weapon}!"},spell:{name:"Cast Spell",cooldown:1,priority:"normal",description:"Cast a magical spell",narrativeTemplate:"{character} channels arcane energy into {spell}!"},special:{name:"Special Ability",cooldown:2,priority:"high",description:"Use a special class ability",narrativeTemplate:"{character} unleashes their {ability}!"},item:{name:"Use Item",cooldown:0,priority:"low",description:"Use an item or consumable",narrativeTemplate:"{character} uses {item}!"},defend:{name:"Defend",cooldown:0,priority:"high",description:"Take a defensive stance",narrativeTemplate:"{character} takes a defensive stance!"},environmental:{name:"Environmental Action",cooldown:1,priority:"normal",description:"Use the environment to your advantage",narrativeTemplate:"{character} uses the {environment} to their advantage!"},teamUp:{name:"Team Up",cooldown:3,priority:"high",description:"Coordinate with another party member",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}},this.statusEffects={poisoned:{name:"Poisoned",duration:3,effect:"lose 1 HP per turn",narrative:"is suffering from poison"},burned:{name:"Burned",duration:2,effect:"lose 2 HP per turn",narrative:"is burning with magical flames"},frozen:{name:"Frozen",duration:1,effect:"skip next turn",narrative:"is frozen solid"},paralyzed:{name:"Paralyzed",duration:2,effect:"50% chance to skip turn",narrative:"is paralyzed and can barely move"},confused:{name:"Confused",duration:2,effect:"may attack randomly",narrative:"is confused and disoriented"},blessed:{name:"Blessed",duration:3,effect:"+2 to attack rolls",narrative:"is blessed with divine favor"},hasted:{name:"Hasted",duration:2,effect:"extra action per turn",narrative:"is moving with supernatural speed"}},this.classAbilities={fighter:{name:"Second Wind",description:"Recover some HP",effect:"heal 1d6+2 HP",cooldown:3},wizard:{name:"Arcane Surge",description:"Enhance next spell",effect:"+2 to spell damage",cooldown:2},rogue:{name:"Sneak Attack",description:"Deal extra damage from stealth",effect:"+1d6 damage if target is unaware",cooldown:1},cleric:{name:"Divine Favor",description:"Bless an ally",effect:"target gets +1 to all rolls",cooldown:2}}}initializeCombat(e,t,r){return{combatants:[...e,...t].map(a=>({...a,initiative:this.calculateInitiative(a),statusEffects:[],cooldowns:{},lastAction:null,turnCount:0})).sort((a,l)=>l.initiative-a.initiative),currentTurn:0,round:1,combatState:"active",storyContext:r,environmentalFeatures:this.extractEnvironmentalFeatures(r),teamUpOpportunities:this.identifyTeamUpOpportunities(e),narrativeElements:this.extractNarrativeElements(r)}}async createCombatSession(e,t,r,s){try{const{createCombatSession:i}=await Ii(()=>Promise.resolve().then(()=>pV),void 0);await this.cleanupOldCombatSessions(e);const a=await this.getExistingCombatSession(e);if(a)return console.log(" Found existing combat session:",a.id),a;const l=this.preparePartyMembers(t),c=this.prepareEnemies(r),d=this.initializeCombat(l,c,s),h=await i(e,{storyContext:d.storyContext,partyMembers:d.combatants.filter(m=>!m.id.startsWith("enemy_")),enemies:d.combatants.filter(m=>m.id.startsWith("enemy_")),combatants:d.combatants,initiative:d.combatants.map(m=>({id:m.id,name:m.name,initiative:m.initiative})),currentTurn:d.currentTurn,round:d.round,combatState:d.combatState,environmentalFeatures:d.environmentalFeatures,teamUpOpportunities:d.teamUpOpportunities,narrativeElements:d.narrativeElements});return console.log(" Created new combat session:",h.id),h}catch(i){throw console.error(" Error creating combat session:",i),i}}async getExistingCombatSession(e){try{const{collection:t,query:r,where:s,getDocs:i,updateDoc:a,doc:l}=await Ii(()=>import("./index.esm-9ac246db.js"),[]),{db:c}=await Ii(()=>Promise.resolve().then(()=>Om),void 0),d=t(c,"combatSessions"),h=r(d,s("partyId","==",e),s("status","==","active")),m=await i(h);if(!m.empty){const p=m.docs[0];return console.log(" Found existing combat session:",p.id),{id:p.id,...p.data()}}return null}catch(t){return console.error("Error checking for existing combat session:",t),null}}async cleanupOldCombatSessions(e){var t,r;console.log(` Starting cleanup for party ${e}`);try{const{collection:s,query:i,where:a,getDocs:l,updateDoc:c,doc:d}=await Ii(()=>import("./index.esm-9ac246db.js"),[]),{db:h}=await Ii(()=>Promise.resolve().then(()=>Om),void 0),m=s(h,"combatSessions"),p=i(m,a("partyId","==",e),a("status","==","active")),y=await l(p);if(y.size>1){console.log(` Found ${y.size} active combat sessions for party ${e}, cleaning up...`);const P=y.docs.map(M=>({id:M.id,...M.data()}));P.sort((M,$)=>{var C,N,R,D;const I=((N=(C=M.createdAt)==null?void 0:C.toDate)==null?void 0:N.call(C))||M.createdAt||new Date(0);return(((D=(R=$.createdAt)==null?void 0:R.toDate)==null?void 0:D.call(R))||$.createdAt||new Date(0))-I});for(let M=1;M<P.length;M++){const $=d(h,"combatSessions",P[M].id);await c($,{status:"ended",combatState:"ended",endedAt:new Date,reason:"cleanup_duplicate"}),console.log(` Marked old session ${P[M].id} as ended`)}}const _=i(m,a("partyId","==",e),a("status","==","active")),T=await l(_),E=new Date(Date.now()-5*60*1e3);for(const P of T.docs){const M=P.data();if((((r=(t=M.createdAt)==null?void 0:t.toDate)==null?void 0:r.call(t))||M.createdAt||new Date(0))<E){const I=P(h,"combatSessions",P.id);await c(I,{status:"ended",combatState:"ended",endedAt:new Date,reason:"cleanup_stuck"}),console.log(` Marked stuck session ${P.id} as ended (older than 5 minutes)`)}}const x=s(h,"combats"),v=i(x,a("partyId","==",e),a("status","==","active")),S=await l(v);if(!S.empty){console.log(` Found ${S.size} old combat sessions in legacy collection, cleaning up...`);for(const P of S.docs){const M=P(h,"combats",P.id);await c(M,{status:"ended",endedAt:new Date,reason:"cleanup_legacy"}),console.log(` Marked legacy combat ${P.id} as ended`)}}}catch(s){console.error("Error cleaning up old combat sessions:",s)}}async forceCleanupCombatSessions(e){console.log(` Force cleaning up all combat sessions for party ${e}`);try{const{collection:t,query:r,where:s,getDocs:i,updateDoc:a,doc:l}=await Ii(()=>import("./index.esm-9ac246db.js"),[]),{db:c}=await Ii(()=>Promise.resolve().then(()=>Om),void 0),d=t(c,"combatSessions"),h=r(d,s("partyId","==",e),s("status","==","active")),m=await i(h);if(!m.empty){console.log(` Found ${m.size} active combat sessions, marking all as ended`);for(const T of m.docs){const E=T(c,"combatSessions",T.id);await a(E,{status:"ended",combatState:"ended",endedAt:new Date,reason:"force_cleanup"}),console.log(` Force marked session ${T.id} as ended`)}}const p=t(c,"combats"),y=r(p,s("partyId","==",e),s("status","==","active")),_=await i(y);if(!_.empty){console.log(` Found ${_.size} legacy combat sessions, marking all as ended`);for(const T of _.docs){const E=T(c,"combats",T.id);await a(E,{status:"ended",endedAt:new Date,reason:"force_cleanup_legacy"}),console.log(` Force marked legacy combat ${T.id} as ended`)}}return console.log(` Force cleanup completed for party ${e}`),!0}catch(t){return console.error("Error in force cleanup:",t),!1}}preparePartyMembers(e){return e.map(t=>{var a,l,c,d,h,m,p,y;let r=t.hp,s=t.maxHp;if(!r||!s){const T={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[t.class]||8,E=((a=t.assignedScores)==null?void 0:a.constitution)||10,x=Math.floor((E-10)/2),v=Math.max(1,(T+x)*(t.level||1));r=v,s=v}let i=t.ac;if(!i){const T=((l=t.assignedScores)==null?void 0:l.dexterity)||10,E=Math.floor((T-10)/2),v={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[t.class]||0;i=Math.max(10,10+E+v)}return{...t,hp:r,maxHp:s,ac:i,initiative:Math.floor(Math.random()*20)+1,strength:((c=t.assignedScores)==null?void 0:c.strength)||10,dexterity:((d=t.assignedScores)==null?void 0:d.dexterity)||10,constitution:((h=t.assignedScores)==null?void 0:h.constitution)||10,intelligence:((m=t.assignedScores)==null?void 0:m.intelligence)||10,wisdom:((p=t.assignedScores)==null?void 0:p.wisdom)||10,charisma:((y=t.assignedScores)==null?void 0:y.charisma)||10,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0}})}prepareEnemies(e){return!e||e.length===0?[{id:"enemy_0",name:"Gnoll Pack",hp:20,maxHp:20,ac:12,level:1,class:"enemy",race:"unknown",initiative:Math.floor(Math.random()*20)+1,strength:12,dexterity:10,constitution:12,intelligence:8,wisdom:8,charisma:6},{id:"enemy_1",name:"Gnoll Pack-Leader",hp:25,maxHp:25,ac:14,level:2,class:"enemy",race:"unknown",initiative:Math.floor(Math.random()*20)+1,strength:14,dexterity:12,constitution:14,intelligence:10,wisdom:10,charisma:8}]:e.map((t,r)=>({id:t.id||`enemy_${r}`,name:t.name||`Enemy ${r+1}`,hp:t.hp||20,maxHp:t.maxHp||t.hp||20,ac:t.ac||12,level:t.level||1,class:t.class||"enemy",race:t.race||"unknown",initiative:t.initiative||Math.floor(Math.random()*20)+1,strength:t.strength||12,dexterity:t.dexterity||10,constitution:t.constitution||12,intelligence:t.intelligence||8,wisdom:t.wisdom||8,charisma:t.charisma||6,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0}))}calculateInitiative(e){var s,i,a;let t=Math.floor(Math.random()*20)+1;return t+={rogue:3,monk:2,ranger:1,fighter:0,cleric:0,wizard:-1,paladin:-1}[(s=e.class)==null?void 0:s.toLowerCase()]||0,(i=e.statusEffects)!=null&&i.includes("hasted")&&(t+=5),(a=e.statusEffects)!=null&&a.includes("paralyzed")&&(t-=3),t}extractEnvironmentalFeatures(e){const t=[],r={forest:["trees","cover","difficult terrain"],cave:["darkness","echoes","tight spaces"],tavern:["furniture","crowds","flammable materials"],castle:["stone walls","narrow corridors","defensive positions"],dungeon:["traps","darkness","confined spaces"],outdoors:["weather","open space","natural cover"]},s=e.toLowerCase();return Object.entries(r).forEach(([i,a])=>{s.includes(i)&&t.push(...a)}),t}identifyTeamUpOpportunities(e){const t=[];return[{classes:["fighter","rogue"],description:"Fighter distracts while Rogue sneaks in for a backstab"},{classes:["wizard","cleric"],description:"Wizard casts area spell while Cleric protects the party"},{classes:["fighter","cleric"],description:"Fighter tanks while Cleric provides healing support"},{classes:["rogue","wizard"],description:"Rogue scouts while Wizard provides magical backup"}].forEach(s=>{s.classes.every(a=>e.some(l=>{var c;return((c=l.class)==null?void 0:c.toLowerCase())===a}))&&t.push(s)}),t}extractNarrativeElements(e){return{mood:this.determineCombatMood(e),stakes:this.determineStakes(e),environmentalHazards:this.identifyHazards(e),npcInvolvement:this.extractNPCs(e)}}determineCombatMood(e){const t=e.toLowerCase();return t.includes("desperate")||t.includes("last stand")?"desperate":t.includes("training")||t.includes("practice")?"casual":t.includes("revenge")||t.includes("vengeance")?"vengeful":t.includes("defense")||t.includes("protect")?"defensive":"standard"}determineStakes(e){const t=e.toLowerCase();return t.includes("life")||t.includes("death")||t.includes("kill")?"life_or_death":t.includes("escape")||t.includes("flee")?"escape":t.includes("capture")||t.includes("arrest")?"capture":t.includes("treasure")||t.includes("loot")?"treasure":"standard"}identifyHazards(e){const t=[],r=e.toLowerCase();return(r.includes("fire")||r.includes("flame"))&&t.push("fire"),(r.includes("water")||r.includes("river")||r.includes("lake"))&&t.push("water"),(r.includes("height")||r.includes("cliff")||r.includes("fall"))&&t.push("height"),(r.includes("trap")||r.includes("pit"))&&t.push("traps"),t}extractNPCs(e){const t=[];return[/(\w+)\s+(?:the\s+)?(?:guard|merchant|wizard|knight|rogue|priest)/gi,/(?:named|called)\s+(\w+)/gi].forEach(s=>{[...e.matchAll(s)].forEach(a=>{t.push(a[1])})}),t}async executeAction(e,t,r,s,i={}){var T,E;console.log(" executeAction called with:",{combatantId:t,actionType:r,targetId:s,additionalData:i});const a=e.combatants.find(x=>x.id===t);let l=e.combatants.find(x=>x.id===s);if(r==="defend"&&!l&&(l=a),console.log(" Found combatant and target:",{combatant:a?{name:a.name,hp:a.hp,maxHp:a.maxHp}:null,target:l?{name:l.name,hp:l.hp,maxHp:l.maxHp}:null}),!a)throw new Error("Invalid combatant");if(!l&&r!=="defend")throw new Error("Invalid target");if(a.cooldowns&&a.cooldowns[r]>0)return{success:!1,message:`${a.name} cannot use ${r} yet (cooldown: ${a.cooldowns[r]} turns)`};const c=this.generateActionNarrative(a,r,l,i),d=this.calculateActionResults(a,r,l,i);console.log(" Action results calculated:",d),this.applyActionEffects(e,a,l,d),this.updateCooldowns(e,a,r);const h=this.checkStatusEffectApplication(a,r,l,d);let m=(e.currentTurn+1)%e.combatants.length,p=0;const y=e.combatants.length;for(;p<y;){const x=e.combatants[m];if(x&&x.hp>0)break;m=(m+1)%e.combatants.length,p++}p>=y&&(console.log(" No alive combatants found, keeping current turn"),m=e.currentTurn);const _={...e,currentTurn:m};return m===0&&(_.round=_.round+1),console.log(" Turn progression in executeAction:",{currentTurn:e.currentTurn,nextTurnIndex:m,totalCombatants:e.combatants.length,nextCombatant:(T=e.combatants[m])==null?void 0:T.name,nextCombatantHp:(E=e.combatants[m])==null?void 0:E.hp,round:_.round,attempts:p}),console.log(" executeAction returning result with damage:",d.damage),console.log(" Target HP after executeAction:",l.hp),console.log(" Updated session currentTurn:",_.currentTurn),{success:!0,narrative:c,results:d,statusEffects:h,environmentalImpact:this.calculateEnvironmentalImpact(e,r,d),targetId:s,updatedSession:_,damage:d.damage,healing:d.healing}}generateActionNarrative(e,t,r,s){let a=this.actionTypes[t].narrativeTemplate;a=a.replace("{character}",e.name),a=a.replace("{action}",this.getActionVerb(t,e.class)),a=a.replace("{weapon}",s.weapon||"their weapon"),a=a.replace("{spell}",s.spell||"a spell"),a=a.replace("{ability}",s.ability||"special ability"),a=a.replace("{item}",s.item||"an item"),a=a.replace("{environment}",s.environment||"surroundings"),a=a.replace("{ally}",s.ally||"ally"),s.specialAttack&&s.specialAttack!=="Standard Action"&&(a=`${e.name} uses ${s.specialAttack}! `+a),s.damageType&&s.damageType!=="physical"&&(a+=` The attack deals ${s.damageType} damage.`);const l=this.getClassFlavor(e.class,t);return l&&(a+=` ${l}`),a}getActionVerb(e,t){var s;return((s={fighter:{attack:"charges forward with a mighty swing",defend:"raises their shield defensively",special:"unleashes their combat expertise"},wizard:{attack:"casts a magical bolt",spell:"weaves arcane energy",special:"channels pure magical power"},rogue:{attack:"strikes from the shadows",defend:"dodges and weaves",special:"executes a perfect sneak attack"},cleric:{attack:"calls upon divine power",spell:"prays for divine intervention",special:"channels holy energy"}}[t==null?void 0:t.toLowerCase()])==null?void 0:s[e])||"performs an action"}getClassFlavor(e,t){var s;return((s={priest:{attack:"Divine energy crackles around their weapon.",spell:"Holy light emanates from their hands.",heal:"A warm, healing glow surrounds them."},wizard:{attack:"Arcane energy flows through their weapon.",spell:"Mystical runes appear in the air.",special:"Ancient magic surges through them."},warrior:{attack:"Their combat training shows in every move.",special:"Years of battle experience guide their strike.",defend:"They adopt a defensive stance with practiced ease."},rogue:{attack:"They move with deadly precision.",special:"Shadow and stealth enhance their attack.",defend:"They dodge and weave with acrobatic grace."},boss:{attack:"Their overwhelming presence fills the battlefield.",special:"Ancient power courses through their veins.",spell:"Reality itself seems to bend to their will."},undead:{attack:"Necrotic energy pulses from their form.",spell:"Death magic swirls around them.",special:"The very air grows cold with their presence."}}[e==null?void 0:e.toLowerCase()])==null?void 0:s[t])||""}calculateActionResults(e,t,r,s){const i={damage:0,healing:0,statusEffects:[],environmentalEffects:[],narrative:"",specialAttack:s.specialAttack||"Standard Action",damageType:s.damageType||"physical",attribute:s.attribute||"strength"};switch(t){case"attack":i.damage=this.calculateAttackDamage(e,r,s);break;case"spell":i.damage=this.calculateSpellDamage(e,r,s);break;case"special":i.damage=this.calculateSpecialDamage(e,r,s);break;case"item":i.healing=this.calculateItemEffect(e,r,s);break;case"defend":i.statusEffects.push({type:"defensive",duration:1});break;case"environmental":i.environmentalEffects=this.calculateEnvironmentalEffects(e,r,s);break;case"teamUp":i.damage=this.calculateTeamUpDamage(e,r,s);break}return i}calculateAttackDamage(e,t,r){console.log(" calculateAttackDamage called for:",{combatant:e.name,target:t.name,combatantClass:e.class,additionalData:r});const s=Math.floor(Math.random()*8)+1,i=Math.floor(((e.strength||10)-10)/2),a=r.weaponBonus||0;console.log(" Base damage calculation:",{baseDamage:s,strengthMod:i,weaponBonus:a,combatantStrength:e.strength||10});let l=1,c=0;if(e.id.startsWith("enemy_")){l=1+(e.level-1)*.3;const d=r.attribute||"strength";c=Math.floor(((e[d]||10)-10)/2);const h=this.calculateEnemyItemBonus(e);let m=0;r.specialAttack&&r.specialAttack!=="Standard Attack"&&(m=Math.floor(Math.random()*4)+2),r.isBossAttack&&(m+=5);let p=(s+i+a+c+h+m)*l;Math.floor(Math.random()*20)+1===20&&(p*=2),console.log(`Enhanced enemy damage calculation for ${e.name}:`,{baseDamage:s,strengthMod:i,weaponBonus:a,attributeMod:c,itemBonus:h,specialBonus:m,levelScaling:l,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,totalDamage:Math.max(1,Math.floor(p))});const y=Math.max(1,Math.floor(p));return console.log(` Enemy ${e.name} final damage: ${y}`),y}else{const d=Math.floor(((e.dexterity||10)-10)/2),h=Math.floor((e.level-1)*.5);let m=s+i+d+a+h;Math.floor(Math.random()*20)+1===20&&(m*=2);const p=Math.max(1,Math.floor(m));return console.log(` Player ${e.name} damage calculation:`,{baseDamage:s,strengthMod:i,dexterityMod:d,weaponBonus:a,levelBonus:h,totalDamage:p}),p}}getEnemyPrimaryAttribute(e){return{Warrior:"strength",Archer:"dexterity",Mage:"intelligence",Cleric:"wisdom",Rogue:"dexterity",Paladin:"strength",Ranger:"dexterity",Wizard:"intelligence",Fighter:"strength"}[e]||"strength"}calculateEnemyItemBonus(e){let t=0;return e.equipment&&(e.equipment.weapon&&(t+=e.equipment.weapon.damageBonus||0),e.equipment.armor&&(t+=e.equipment.armor.defenseBonus||0),e.equipment.accessory&&(t+=e.equipment.accessory.bonus||0)),e.level>3&&(t+=Math.floor((e.level-3)/2)),t}calculateSpellDamage(e,t,r){const s=Math.floor(Math.random()*6)+1,i=Math.floor((e.intelligence-10)/2),a=r.spellLevel||1;if(e.id.startsWith("enemy_")){const l=1+(e.level-1)*.4,c=Math.floor((e.wisdom-10)/2),d=this.calculateEnemyItemBonus(e);let h=(s+i+c+a+d)*l;return Math.floor(Math.random()*20)+1>=19&&(h*=1.5),Math.max(1,Math.floor(h))}else return Math.max(1,s+i+a)}calculateSpecialDamage(e,t,r){var l;if(!this.classAbilities[(l=e.class)==null?void 0:l.toLowerCase()])return 0;const i=Math.floor(Math.random()*10)+2,a=Math.floor((e.level||1)/2);return Math.max(1,i+a)}calculateItemEffect(e,t,r){switch(r.itemType||"potion"){case"healing":return Math.floor(Math.random()*8)+2;case"antidote":return 0;case"blessing":return 0;default:return Math.floor(Math.random()*4)+1}}calculateTeamUpDamage(e,t,r){const s=Math.floor(Math.random()*12)+3;return Math.max(1,s+2)}applyActionEffects(e,t,r,s){if(console.log(" applyActionEffects called with:",{combatant:t.name,target:r.name,results:s,targetHpBefore:r.hp}),s.damage>0){const i=r.hp;r.hp=Math.max(0,r.hp-s.damage),console.log(` Damage applied in applyActionEffects: ${t.name} deals ${s.damage} damage to ${r.name}. HP: ${i}  ${r.hp}`),console.log(" Target details:",{name:r.name,id:r.id,isEnemy:r.id.startsWith("enemy_"),userId:r.userId,oldHp:i,newHp:r.hp})}if(s.healing>0){const i=r.hp;r.hp=Math.min(r.maxHp,r.hp+s.healing),console.log(` Healing applied in applyActionEffects: ${t.name} heals ${r.name} for ${s.healing} HP. HP: ${i}  ${r.hp}`)}r.statusEffects||(r.statusEffects=[]),s.statusEffects.forEach(i=>{r.statusEffects.some(a=>a.type===i.type)||(r.statusEffects.push({type:i.type,duration:i.duration,appliedBy:t.id}),console.log(` Status effect applied: ${i.type} to ${r.name}`))}),console.log(` Final target HP after applyActionEffects: ${r.name} = ${r.hp}`)}updateCooldowns(e,t,r){const s=this.actionTypes[r];t.cooldowns||(t.cooldowns={}),t.cooldowns[r]=s.cooldown,Object.keys(t.cooldowns).forEach(i=>{i!==r&&t.cooldowns[i]>0&&t.cooldowns[i]--})}checkStatusEffectApplication(e,t,r,s){const i=[];if(r.statusEffects||(r.statusEffects=[]),s.damage>10){const a=["stunned","bleeding"],l=a[Math.floor(Math.random()*a.length)];r.statusEffects.some(c=>c.type===l)||i.push({type:l,duration:1,appliedBy:e.id})}return i}calculateEnvironmentalImpact(e,t,r){const s=[];return t==="spell"&&r.damage>8&&s.push("The magical energy disturbs the environment"),t==="environmental"&&s.push("The environment responds to the action"),s}processStatusEffects(e,t){const r=[];return t.statusEffects&&t.statusEffects.forEach((s,i)=>{switch(s.duration--,s.type){case"poisoned":t.hp=Math.max(0,t.hp-1),r.push(`${t.name} takes 1 poison damage`);break;case"burned":t.hp=Math.max(0,t.hp-2),r.push(`${t.name} takes 2 burn damage`);break;case"frozen":r.push(`${t.name} is frozen and cannot act`);break;case"paralyzed":Math.random()<.5&&r.push(`${t.name} is paralyzed and cannot act`);break;case"blessed":r.push(`${t.name} is blessed with divine favor`);break;case"hasted":r.push(`${t.name} moves with supernatural speed`);break}s.duration<=0&&(t.statusEffects.splice(i,1),r.push(`${t.name} is no longer ${s.type}`))}),r}checkCombatEnd(e){const t=e.combatants.filter(a=>!a.id.startsWith("enemy_")),r=e.combatants.filter(a=>a.id.startsWith("enemy_")),s=t.some(a=>a.hp>0),i=r.some(a=>a.hp>0);return s?i?{ended:!1}:{ended:!0,result:"victory",narrative:"The enemies have been defeated!"}:{ended:!0,result:"defeat",narrative:"The party has been defeated..."}}generateCombatSummary(e,t){return{result:t,duration:e.round,participants:e.combatants.map(s=>({name:s.name,finalHp:s.hp,actions:s.turnCount,statusEffects:s.statusEffects.length})),narrative:this.generateCombatNarrative(e,t)}}generateCombatNarrative(e,t){const r=e.combatants.filter(s=>!s.id.startsWith("enemy_"));return e.combatants.filter(s=>s.id.startsWith("enemy_")),t==="victory"?`The party emerges victorious from the battle. ${r.map(s=>s.name).join(", ")} stand triumphant over their fallen foes.`:t==="defeat"?"The battle ends in defeat. The party has been overwhelmed by their enemies.":"The battle ends in a draw, with both sides withdrawing to regroup."}chooseEnemyAction(e,t){const r=this.getAvailableActions(e);return console.log(`Enemy ${e.name} available actions:`,r),r.length===0?(console.log(`No available actions for ${e.name}, defaulting to defend`),{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}):this.makeEnemyDecision(e,r,t)}getAvailableActions(e){var s;const t=[],r=e.cooldowns||{};return console.log("Getting enemy available actions for:",e.name,{cooldowns:r,class:e.class,hasClassAbility:!!this.classAbilities[(s=e.class)==null?void 0:s.toLowerCase()]}),Object.entries(this.actionTypes).forEach(([i,a])=>{(!r.hasOwnProperty(i)||r[i]<=0)&&t.push(i)}),e.class&&this.classAbilities[e.class.toLowerCase()]&&(!r.hasOwnProperty("special")||r.special<=0)&&t.push("special"),console.log("Available actions for enemy:",e.name,t),t}getValidTargets(e,t,r){const s=[],i=r.combatants.filter(a=>a.hp>0);if(i.length===0)return console.log("No alive combatants found"),[];switch(t){case"attack":case"spell":case"special":if(e.id.startsWith("enemy_")){const a=i.filter(l=>!l.id.startsWith("enemy_"));console.log(`Enemy ${e.name} can target players:`,a.map(l=>l.name)),s.push(...a)}else s.push(...i.filter(a=>a.id.startsWith("enemy_")));break;case"heal":case"item":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_")&&a.id!==e.id)):s.push(...i.filter(a=>!a.id.startsWith("enemy_")&&a.id!==e.id));break;case"defend":case"environmental":s.push(e);break;case"teamUp":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_")&&a.id!==e.id)):s.push(...i.filter(a=>!a.id.startsWith("enemy_")&&a.id!==e.id));break;default:s.push(...i.filter(a=>a.id!==e.id))}return console.log(`Valid targets for ${e.name} (${t}):`,s.map(a=>a.name)),s}makeEnemyDecision(e,t,r){var m;if(t.length===0)return console.log("No available actions for enemy, defaulting to defend"),{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"};const s=t[Math.floor(Math.random()*t.length)],i=this.getValidTargets(e,s,r);if(console.log(`Valid targets for ${e.name} (${s}):`,i.map(p=>p.name)),i.length===0)return console.log(`No valid targets for ${e.name} with action ${s}, defaulting to defend`),{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"};const a=i[Math.floor(Math.random()*i.length)];console.log(`Enemy ${e.name} selected target: ${a.name} (ID: ${a.id})`);const l=e.hp/e.maxHp,c=(m=e.class)==null?void 0:m.toLowerCase();if(e.level,c==="priest"||c==="cleric"){if(l<.4&&t.includes("spell"))return{action:"spell",target:e.id,spellType:"healing",specialAttack:"Divine Healing",damageType:"healing",attribute:"wisdom"};if(t.includes("spell")&&a)return{action:"spell",target:a.id,spellType:"divine",specialAttack:"Divine Smite",damageType:"radiant",attribute:"wisdom"}}if((c==="wizard"||c==="mage"||c==="sorcerer")&&t.includes("spell")){const p=["fireball","lightning","ice","arcane"],y=p[Math.floor(Math.random()*p.length)];return{action:"spell",target:a.id,spellType:y,specialAttack:`${y.charAt(0).toUpperCase()+y.slice(1)} Spell`,damageType:y==="fireball"?"fire":y==="lightning"?"lightning":y==="ice"?"cold":"arcane",attribute:"intelligence"}}if((c==="boss"||c==="dragon")&&t.includes("special"))return{action:"special",target:a.id,specialAttack:"Devastating Strike",damageType:"physical",attribute:"strength",isBossAttack:!0};if((c==="undead"||c==="skeleton"||c==="zombie")&&t.includes("spell"))return{action:"spell",target:a.id,spellType:"necrotic",specialAttack:"Death Touch",damageType:"necrotic",attribute:"constitution"};if(l<.3){if(t.includes("item"))return{action:"item",target:e.id,itemType:"healing",specialAttack:"Use Healing Potion",damageType:"healing",attribute:"constitution"};if(t.includes("defend"))return{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}}return r.combatants.filter(p=>p.id.startsWith("enemy_")&&p.hp/p.maxHp<.5).length>1&&t.includes("spell")?{action:"spell",target:a.id,spellType:"area",specialAttack:"Area Attack",damageType:"mixed",attribute:"intelligence"}:t.includes("attack")?{action:"attack",target:a.id,specialAttack:"Standard Attack",damageType:"physical",attribute:"strength"}:{action:t[Math.floor(Math.random()*t.length)],target:a.id,specialAttack:"Basic Action",damageType:"physical",attribute:"strength"}}async executeEnemyTurn(e,t){if(t.hp<=0)return console.log("Enemy is dead, skipping turn:",t.name),{success:!1,message:`${t.name} is already defeated`};const r=this.chooseEnemyAction(t,e);return console.log("Enemy decision details:",{enemy:t.name,decision:r,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute}),r?r.target?await this.executeAction(e,t.id,r.action,r.target,{itemType:r.itemType,spellType:r.spellType,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,isBossAttack:r.isBossAttack}):await this.executeAction(e,t.id,"defend",t.id,{specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute}):(console.log("No decision made for enemy, defaulting to defend"),await this.executeAction(e,t.id,"defend",t.id,{specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}))}}const zn=new vS,EV="3.1.5";function TV(){const[n,e]=A.useState(!1),t=()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()};return o.jsxs("div",{className:"text-xs text-gray-400 text-center mt-2",children:[o.jsxs("div",{className:"flex items-center justify-center gap-2",children:[o.jsxs("span",{children:["Version ",EV]}),o.jsx("button",{onClick:()=>e(!n),className:"text-blue-400 hover:text-blue-300 underline",title:"Having issues? Click for help",children:"Help"})]}),n&&o.jsxs("div",{className:"mt-2 p-2 bg-gray-800 rounded text-left max-w-md mx-auto",children:[o.jsx("p",{className:"mb-2 text-yellow-300 font-semibold",children:"Need Help?"}),o.jsxs("div",{className:"mb-3",children:[o.jsx("p",{className:"mb-2 text-xs font-semibold text-amber-300",children:"Combat Session Issues:"}),o.jsxs("div",{className:"space-y-2 text-xs",children:[o.jsx("button",{onClick:async()=>{console.log(" Force refreshing combat session..."),window.dispatchEvent(new CustomEvent("refreshCombatSession"))},className:"px-2 py-1 bg-amber-600 hover:bg-amber-700 text-white text-xs rounded transition-colors",title:"Refresh combat session if players are in separate sessions",children:" Refresh Combat"}),o.jsx("button",{onClick:async()=>{console.log(" Force cleaning up all combat sessions..."),window.dispatchEvent(new CustomEvent("cleanupCombatSessions"))},className:"px-2 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded transition-colors ml-2",title:"Force cleanup all combat sessions (use if players are stuck in separate sessions)",children:" Cleanup Sessions"})]})]}),o.jsxs("div",{className:"mb-3",children:[o.jsx("p",{className:"mb-2 text-xs font-semibold text-blue-300",children:"Cache Issues:"}),o.jsx("p",{className:"mb-2 text-xs",children:"If players are ending up in separate combat sessions, try clearing your cache:"}),o.jsxs("div",{className:"space-y-1 text-xs",children:[o.jsxs("p",{children:[" ",o.jsx("strong",{children:"Browser:"})," Ctrl+Shift+R (Windows) or Cmd+Shift+R (Mac)"]}),o.jsxs("p",{children:[" ",o.jsx("strong",{children:"Or click:"}),o.jsx("button",{onClick:t,className:"ml-1 text-red-400 hover:text-red-300 underline",children:"Clear All Data & Reload"})]}),o.jsxs("p",{children:[" ",o.jsx("strong",{children:"Mobile:"})," Close and reopen the app"]})]})]}),o.jsx("button",{onClick:()=>e(!1),className:"mt-2 text-gray-500 hover:text-gray-400 text-xs",children:"Close"})]})]})}function IV(){return o.jsxs("div",{className:"relative overflow-hidden",children:[o.jsx("div",{className:"fantasy-container",children:o.jsxs("div",{className:"relative z-10 py-8 sm:py-16 lg:py-24 text-center",children:[o.jsx("h1",{className:"fantasy-title text-5xl sm:text-6xl lg:text-7xl",children:"Manage your D&D world like a real adventurer's tome"}),o.jsx("p",{className:"fantasy-subtitle max-w-2xl mx-auto",children:"Create parties, invite friends, and share story objectives in a beautifully crafted digital environment that feels like a magical grimoire."}),o.jsxs("div",{className:"mt-8 flex justify-center space-x-6",children:[o.jsx(ks,{to:"/register",className:"fantasy-button text-lg px-8 py-3",children:"Start Your Journey"}),o.jsx(ks,{to:"/login",className:"fantasy-button text-lg px-8 py-3 bg-gray-600 hover:bg-gray-700",children:"Return to Campaign"})]})]})}),o.jsx("div",{className:"absolute inset-0 bg-gray-700/10 pattern-grid-lg"})]})}function SV(){return o.jsxs("div",{children:[o.jsx(IV,{}),o.jsx("div",{className:"fantasy-container py-16",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Create Parties"}),o.jsx("p",{className:"text-gray-300",children:"Form adventuring parties with your friends and manage your campaign together in a shared space."})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Track Objectives"}),o.jsx("p",{className:"text-gray-300",children:"Keep track of your party's quests, storylines, and achievements in an organized magical tome."})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Share Stories"}),o.jsx("p",{className:"text-gray-300",children:"Document your adventures and share them with your fellow party members in an immersive fantasy setting."})]})]})})]})}function CV(){const[n,e]=A.useState(""),[t,r]=A.useState(""),[s,i]=A.useState(!1),[a,l]=A.useState(""),[c,d]=A.useState(""),h=yr(),m=hs();A.useEffect(()=>{var _;(_=m.state)!=null&&_.message&&(d(m.state.message),h(m.pathname,{replace:!0}));const y=Bo(T=>{T&&h("/dashboard")});return()=>y()},[h,m]);const p=async y=>{y.preventDefault(),i(!0),l("");const _=await yV(n,t);_.error&&(_.error.includes("auth/invalid-credential")?l("Invalid email or password. Please check your credentials or register a new account."):_.error.includes("auth/user-not-found")?l("No account found with this email. Please register first."):_.error.includes("auth/wrong-password")?l("Incorrect password. Please try again."):_.error.includes("auth/user-disabled")?l("This account has been disabled. Please contact support."):_.error.includes("auth/too-many-requests")?l("Too many failed login attempts. Please try again later."):l(_.error)),i(!1)};return o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card max-w-md mx-auto",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Login"}),c&&o.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded-lg mb-4",children:c}),o.jsxs("form",{onSubmit:p,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-200 mb-2",children:"Email"}),o.jsx("input",{id:"email",type:"email",value:n,onChange:y=>e(y.target.value),className:"fantasy-input",autoComplete:"email",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-200 mb-2",children:"Password"}),o.jsx("input",{id:"password",type:"password",value:t,onChange:y=>r(y.target.value),className:"fantasy-input",autoComplete:"current-password",required:!0})]}),a&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded-lg",children:a}),o.jsx("button",{type:"submit",disabled:s,className:"fantasy-button w-full",children:s?"Logging in...":"Login"})]}),o.jsx("div",{className:"mt-6 text-center",children:o.jsxs("p",{className:"text-gray-300",children:["Don't have an account?"," ",o.jsx("button",{onClick:()=>h("/register"),className:"text-amber-400 hover:text-amber-300 font-medium",children:"Register here"})]})})]})})}function NV(){const[n,e]=A.useState(""),[t,r]=A.useState(""),[s,i]=A.useState(""),[a,l]=A.useState(""),[c,d]=A.useState(""),[h,m]=A.useState(""),p=yr();A.useEffect(()=>{xV().then(_=>{console.log("Firebase test result:",_)})},[]);const y=async _=>{if(_.preventDefault(),d(""),m(""),s!==a){d("Passwords do not match");return}if(!t.trim()){d("Username is required");return}if(t.length<3){d("Username must be at least 3 characters long");return}if(!/^[a-zA-Z0-9_]+$/.test(t)){d("Username can only contain letters, numbers, and underscores");return}console.log("Submitting registration for:",n,t);const{user:T,error:E,success:x}=await gV(n,s,t);if(console.log("Registration result:",{user:T,error:E,success:x}),E){console.log("Setting error:",E),d(E);return}x?(console.log("Registration successful, redirecting to login"),p("/login",{state:{message:"Registration successful! Please check your email to verify your account before logging in."}})):console.log("No success received from registration")};return o.jsx("div",{className:"fantasy-container min-h-screen flex items-center justify-center",children:o.jsxs("div",{className:"fantasy-card w-full max-w-md",children:[o.jsx("h2",{className:"fantasy-title text-center",children:"Begin Your Adventure"}),c&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded mb-4",children:c}),h&&o.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded mb-4",children:h}),o.jsxs("form",{onSubmit:y,className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-200",children:"Username"}),o.jsx("input",{id:"username",type:"text",required:!0,value:t,onChange:_=>r(_.target.value),className:"fantasy-input mt-1",placeholder:"Choose a unique username"}),o.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Letters, numbers, and underscores only. 3+ characters."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-200",children:"Email"}),o.jsx("input",{id:"email",type:"email",required:!0,value:n,onChange:_=>e(_.target.value),className:"fantasy-input mt-1"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-200",children:"Password"}),o.jsx("input",{id:"password",type:"password",required:!0,value:s,onChange:_=>i(_.target.value),className:"fantasy-input mt-1"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-200",children:"Confirm Password"}),o.jsx("input",{id:"confirmPassword",type:"password",required:!0,value:a,onChange:_=>l(_.target.value),className:"fantasy-input mt-1"})]}),o.jsx("button",{type:"submit",className:"fantasy-button w-full",children:"Register"})]}),o.jsxs("p",{className:"mt-4 text-center text-sm text-gray-300",children:["Already have an account?"," ",o.jsx(ks,{to:"/login",className:"text-amber-400 hover:text-amber-300",children:"Return to your campaign"})]})]})})}function AV(){const n=yr(),{user:e,loading:t}=yS(),[r,s]=A.useState(null),[i,a]=A.useState([]),[l,c]=A.useState([]),[d,h]=A.useState({}),[m,p]=A.useState({}),[y,_]=A.useState(!0),[T,E]=A.useState(!1),[x,v]=A.useState(""),[S,P]=A.useState({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:"",campaignType:"ai-assist"});A.useEffect(()=>{t||(e?M(e.uid):n("/login"))},[e,t,n]),A.useEffect(()=>{if(!(e!=null&&e.uid))return;const K=i.map(re=>_y(re.id,_e=>{a(Q=>Q.map(J=>J.id===_e.id?_e:J)),I([_e])}));return()=>{K.forEach(re=>re())}},[e==null?void 0:e.uid,i.map(K=>K==null?void 0:K.id).filter(Boolean).join(",")]);const M=async K=>{try{const re=await ma(K);s(re);const _e=await tS(K);await I(_e),a(_e),await $()}catch(re){console.error("Error loading user data:",re)}finally{_(!1)}},$=async()=>{try{const re=(await nS()).filter(_e=>{var Q;return!((Q=_e.members)!=null&&Q.includes(e==null?void 0:e.uid))});c(re),await b(re)}catch(K){console.error("Error loading public parties:",K.message)}},I=async K=>{try{if(!K||!Array.isArray(K)){console.log("No parties to load profiles for");return}const re=new Set;if(K.forEach(J=>{J&&J.members&&Array.isArray(J.members)&&J.members.forEach(ne=>re.add(ne))}),re.size===0)return;const _e=await Qd(Array.from(re)),Q={};_e.forEach(J=>{J&&J.userId&&(Q[J.userId]=J)}),h(Q)}catch(re){console.error("Error loading party member profiles:",re)}},b=async K=>{try{if(!K||!Array.isArray(K)){console.log("No public parties to load profiles for");return}const re=new Set;if(K.forEach(J=>{J&&J.members&&Array.isArray(J.members)&&J.members.forEach(ne=>re.add(ne))}),re.size===0)return;const _e=await Qd(Array.from(re)),Q={};_e.forEach(J=>{J&&J.userId&&(Q[J.userId]=J)}),p(Q)}catch(re){console.error("Error loading public party member profiles:",re)}},C=async K=>{try{if(!K){console.error("Invalid party ID for deletion");return}await rS(K,e.uid),a(re=>re.filter(_e=>_e&&_e.id!==K)),h(re=>({...re}))}catch(re){console.error("Error deleting party:",re)}},N=async K=>{try{if(!(e!=null&&e.uid)){alert("User not authenticated. Please log in again.");return}if(!K){alert("Invalid party information.");return}const re=i.find(Q=>Q.id===K);if(!re){alert("Party not found.");return}await ZI(e.uid,K)?re.campaignType==="ai-assist"?n(`/campaign/${K}`):n(`/lobby/${K}`):n(`/character-creation/${K}`)}catch(re){console.error("Error in handleContinueCampaign:",re),n(`/character-creation/${K}`)}},R=async K=>{if(K.preventDefault(),!e){console.error("You must be logged in to create a party");return}_(!0);try{const re={...S,inviteCode:Math.random().toString(36).substr(2,8).toUpperCase()},_e=await eS(e.uid,re);E(!1),P({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:"",campaignType:"ai-assist"}),await M(e.uid),console.log("Party created successfully!")}catch(re){console.error("Error creating party:",re.message)}finally{_(!1)}},D=async()=>{if(!x.trim()){console.error("Please enter an invite code");return}if(!e){console.error("You must be logged in to join a party");return}_(!0);try{const K=await sS(x.toUpperCase());if(!K){console.error("Invalid invite code");return}await dp(K.id,e.uid),v(""),await M(e.uid),console.log("Successfully joined party!")}catch(K){console.error(K.message||"Error joining party. Please try again.")}finally{_(!1)}},k=async K=>{if(!e){console.error("You must be logged in to join a party");return}_(!0);try{await dp(K,e.uid),await M(e.uid),console.log("Successfully joined public party!")}catch(re){console.error(re.message||"Error joining party. Please try again.")}finally{_(!1)}},je=()=>r!=null&&r.username?r.username:e!=null&&e.displayName?e.displayName:e!=null&&e.email?e.email.split("@")[0]:"Adventurer";return y?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-amber-400 border-t-transparent mx-auto mb-4"}),o.jsx("p",{className:"text-slate-300 text-lg font-medium",children:"Loading your adventures..."})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"mb-8 sm:mb-12",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("h1",{className:"text-4xl sm:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 via-orange-400 to-amber-500 mb-4 leading-relaxed pb-2",children:"Campaign Dashboard"}),o.jsx("div",{className:"w-24 h-1 bg-gradient-to-r from-amber-400 to-orange-400 mx-auto rounded-full"})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("p",{className:"text-slate-300 text-lg sm:text-xl",children:["Welcome back, ",o.jsx("span",{className:"text-amber-400 font-semibold",children:je()}),"!"]}),o.jsx("p",{className:"text-slate-400 mt-2 text-sm sm:text-base",children:"Create, join, and manage your D&D campaigns"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 sm:gap-8 mb-8 sm:mb-12",children:[o.jsxs("div",{className:"group relative overflow-hidden rounded-xl bg-gradient-to-br from-amber-500/10 to-orange-500/10 border border-amber-500/20 p-6 hover:from-amber-500/20 hover:to-orange-500/20 transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-amber-500/20",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-500/5 to-orange-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-500 rounded-lg flex items-center justify-center mr-4",children:o.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),o.jsx("h3",{className:"text-xl font-bold text-slate-100",children:"Create New Campaign"})]}),o.jsx("p",{className:"text-slate-300 mb-6 text-sm leading-relaxed",children:"Start a new campaign and invite friends to join your adventures."}),o.jsx("button",{onClick:()=>E(!0),className:"w-full bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",disabled:y,children:"Create Campaign"})]})]}),o.jsxs("div",{className:"group relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-600/10 to-slate-500/10 border border-slate-500/20 p-6 hover:from-slate-600/20 hover:to-slate-500/20 transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-slate-500/20",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-slate-600/5 to-slate-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-slate-600 to-slate-500 rounded-lg flex items-center justify-center mr-4",children:o.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),o.jsx("h3",{className:"text-xl font-bold text-slate-100",children:"Join Campaign"})]}),o.jsx("p",{className:"text-slate-300 mb-6 text-sm leading-relaxed",children:"Join an existing campaign using an invite code."}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{type:"text",placeholder:"Enter invite code",value:x,onChange:K=>v(K.target.value),className:"flex-1 bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50",disabled:y}),o.jsx("button",{onClick:D,className:"bg-gradient-to-r from-slate-600 to-slate-500 hover:from-slate-700 hover:to-slate-600 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",disabled:y,children:y?"Joining...":"Join"})]})]})]})]}),T&&o.jsxs("div",{className:"relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600/50 backdrop-blur-sm mb-8",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-500/5 to-orange-500/5"}),o.jsxs("div",{className:"relative z-10 p-6 sm:p-8",children:[o.jsxs("div",{className:"flex items-center mb-6",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 rounded-lg flex items-center justify-center mr-4",children:o.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),o.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Create New Campaign"})]}),o.jsxs("form",{onSubmit:R,className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-4",children:"Campaign Type"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{className:`relative cursor-pointer rounded-xl border-2 p-4 transition-all duration-300 ${S.campaignType==="ai-assist"?"border-amber-500 bg-amber-500/10":"border-slate-600 bg-slate-700/30 hover:border-slate-500"}`,onClick:()=>P(K=>({...K,campaignType:"ai-assist"})),children:[o.jsxs("div",{className:"flex items-center mb-3",children:[o.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center mr-3 ${S.campaignType==="ai-assist"?"bg-amber-500":"bg-slate-600"}`,children:o.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),o.jsx("h3",{className:"font-semibold text-slate-100",children:"AI Assist"})]}),o.jsx("p",{className:"text-sm text-slate-300 leading-relaxed",children:"AI-powered storytelling with dynamic encounters, NPCs, and story generation. Perfect for immersive adventures."})]}),o.jsxs("div",{className:`relative cursor-pointer rounded-xl border-2 p-4 transition-all duration-300 ${S.campaignType==="manual"?"border-amber-500 bg-amber-500/10":"border-slate-600 bg-slate-700/30 hover:border-slate-500"}`,onClick:()=>P(K=>({...K,campaignType:"manual"})),children:[o.jsxs("div",{className:"flex items-center mb-3",children:[o.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center mr-3 ${S.campaignType==="manual"?"bg-amber-500":"bg-slate-600"}`,children:o.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),o.jsx("h3",{className:"font-semibold text-slate-100",children:"Manual Campaign"})]}),o.jsx("p",{className:"text-sm text-slate-300 leading-relaxed",children:"Traditional D&D experience with manual story creation. No AI dependencies - full control over your campaign."})]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"party-name",className:"block text-sm font-semibold text-slate-200 mb-2",children:"Campaign Name"}),o.jsx("input",{id:"party-name",type:"text",value:S.name,onChange:K=>P(re=>({...re,name:K.target.value})),className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"max-players",className:"block text-sm font-semibold text-slate-200 mb-2",children:"Max Players"}),o.jsx("input",{id:"max-players",type:"number",min:"2",max:"10",value:S.maxPlayers,onChange:K=>P(re=>({...re,maxPlayers:parseInt(K.target.value)})),className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50"})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"party-theme",className:"block text-sm font-semibold text-slate-200 mb-2",children:"Theme & Description"}),o.jsx("textarea",{id:"party-theme",value:S.description,onChange:K=>P(re=>({...re,description:K.target.value})),className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50",rows:"3",placeholder:"Enter the theme or atmosphere for your campaign..."})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"isPublic",checked:S.isPublic,onChange:K=>P(re=>({...re,isPublic:K.target.checked})),className:"w-4 h-4 text-amber-500 bg-slate-700 border-slate-600 rounded focus:ring-amber-500/50 focus:ring-2"}),o.jsx("label",{htmlFor:"isPublic",className:"ml-2 text-sm font-medium text-slate-300",children:"Public Campaign (visible to all users)"})]}),o.jsxs("div",{className:"flex space-x-4",children:[o.jsx("button",{type:"submit",className:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",disabled:y,children:y?"Creating...":"Create Campaign"}),o.jsx("button",{type:"button",onClick:()=>E(!1),className:"bg-gradient-to-r from-slate-600 to-slate-500 hover:from-slate-700 hover:to-slate-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",disabled:y,children:"Cancel"})]})]})]})]}),o.jsxs("div",{className:"relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600/50 backdrop-blur-sm mb-8",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-500/5 to-orange-500/5"}),o.jsxs("div",{className:"relative z-10 p-6 sm:p-8",children:[o.jsxs("div",{className:"flex items-center mb-6",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 rounded-lg flex items-center justify-center mr-4",children:o.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),o.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"My Campaigns"})]}),i.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-6",children:o.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),o.jsx("h3",{className:"text-xl font-semibold text-slate-300 mb-2",children:"No Campaigns Yet"}),o.jsx("p",{className:"text-slate-400 mb-6",children:"Create your first campaign to start adventuring!"}),o.jsx("button",{onClick:()=>E(!0),className:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold py-3 px-8 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",children:"Create Your First Campaign"})]}):o.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:i.map(K=>{var re;return o.jsxs("div",{className:"group relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-700/50 to-slate-600/50 border border-slate-500/50 p-6 hover:from-slate-700/70 hover:to-slate-600/70 transition-all duration-300 hover:scale-[1.02] hover:shadow-xl",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-500/5 to-orange-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),o.jsxs("div",{className:"relative z-10",children:[o.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-2 group-hover:text-amber-400 transition-colors duration-300",children:K.name}),o.jsx("p",{className:"text-slate-300 text-sm leading-relaxed mb-3",children:K.description}),o.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs sm:text-sm text-slate-400",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),((re=K.members)==null?void 0:re.length)||0," members"]}),o.jsx("div",{className:"flex items-center",children:o.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${K.campaignType==="ai-assist"?"bg-amber-500/20 text-amber-300 border border-amber-500/30":"bg-slate-600/20 text-slate-300 border border-slate-500/30"}`,children:K.campaignType==="ai-assist"?" AI Assist":" Manual"})}),K.members&&K.members.length>0&&o.jsxs("div",{className:"flex items-center",children:[o.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),o.jsx("span",{className:"max-w-xs truncate",children:K.members.map((_e,Q)=>{const J=d[_e];let ne="Unknown";return J!=null&&J.username?ne=J.username:J!=null&&J.displayName?ne=J.displayName:J!=null&&J.email&&(ne=J.email.split("@")[0]),o.jsxs("span",{children:[ne,Q<K.members.length-1?", ":""]},_e)})})]})]})]})}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[o.jsxs("button",{onClick:()=>N(K.id),className:"flex-1 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg flex items-center justify-center",children:[o.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Continue"]}),K.dmId===(e==null?void 0:e.uid)&&o.jsxs("button",{onClick:()=>C(K.id),className:"flex-1 bg-gradient-to-r from-slate-600 to-slate-500 hover:from-slate-700 hover:to-slate-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg flex items-center justify-center",children:[o.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]}),K.dmId===(e==null?void 0:e.uid)&&K.inviteCode&&o.jsx("div",{className:"mt-4 p-3 bg-slate-700/30 rounded-lg border border-slate-600/50",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm text-slate-300",children:"Invite Code:"}),o.jsx("span",{className:"text-sm font-mono text-amber-400 bg-slate-800 px-2 py-1 rounded select-all",children:K.inviteCode})]})})]})]},K.id)})})]})]}),l.length>0&&o.jsxs("div",{className:"relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600/50 backdrop-blur-sm mb-8",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-slate-500/5 to-slate-400/5"}),o.jsxs("div",{className:"relative z-10 p-6 sm:p-8",children:[o.jsxs("div",{className:"flex items-center mb-6",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-slate-600 to-slate-500 rounded-lg flex items-center justify-center mr-4",children:o.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})}),o.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Public Campaigns"})]}),o.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:l.map(K=>{var re,_e;return m[K.id],o.jsxs("div",{className:"group relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-700/50 to-slate-600/50 border border-slate-500/50 p-6 hover:from-slate-700/70 hover:to-slate-600/70 transition-all duration-300 hover:scale-[1.02] hover:shadow-xl",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-slate-500/5 to-slate-400/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100 group-hover:text-slate-300 transition-colors duration-300",children:K.name}),o.jsxs("span",{className:"text-sm text-slate-400 bg-slate-600/50 px-2 py-1 rounded-full",children:[((re=K.members)==null?void 0:re.length)||1,"/",K.maxPlayers," players"]})]}),K.description&&o.jsx("p",{className:"text-slate-300 text-sm leading-relaxed mb-4",children:K.description}),o.jsxs("div",{className:"mb-4",children:[o.jsxs("h4",{className:"text-sm font-semibold text-slate-200 mb-2 flex items-center",children:[o.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Members"]}),o.jsx("div",{className:"space-y-1",children:(_e=K.members)==null?void 0:_e.map((Q,J)=>{const ne=m[Q];let Ne=`User ${J+1}`;ne!=null&&ne.username?Ne=ne.username:ne!=null&&ne.displayName?Ne=ne.displayName:ne!=null&&ne.email&&(Ne=ne.email.split("@")[0]);const Ae=Q===K.dmId;return o.jsx("div",{className:"flex items-center justify-between text-sm",children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-slate-300",children:Ne}),Ae&&o.jsx("span",{className:"bg-gradient-to-r from-slate-600 to-slate-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]})},Q)})})]}),o.jsx("button",{onClick:()=>k(K.id),className:"w-full bg-gradient-to-r from-slate-600 to-slate-500 hover:from-slate-700 hover:to-slate-600 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",disabled:y,children:"Join Campaign"})]})]},K.id)})})]})]})]})})}function kV(){var ze,Re,Pe;const n=yr(),{partyId:e}=wc(),[t,r]=A.useState(null),[s,i]=A.useState(!1),[a,l]=A.useState(""),[c,d]=A.useState("");A.useState(!1);const[h,m]=A.useState(null),[p,y]=A.useState([]),[_,T]=A.useState(!1),[E,x]=A.useState(""),[v,S]=A.useState(!1),[P,M]=A.useState({name:"",race:"",class:"",level:1,background:"",alignment:"",strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10,age:"",height:"",weight:"",eyes:"",skin:"",hair:"",personality:"",ideals:"",bonds:"",flaws:"",backstory:"",equipment:[],spells:[],proficiencies:[],portrait:"/placeholder-character.png"}),[$,I]=A.useState("standard"),[b,C]=A.useState([]),[N,R]=A.useState([]),[D,k]=A.useState({}),[je,K]=A.useState(!1),[re,_e]=A.useState({}),[Q,J]=A.useState([]),[ne,Ne]=A.useState(null),[Ae,Fe]=A.useState(!1);A.useEffect(()=>{const V=Bo(H=>{if(!H){n("/login");return}r(H),e&&(ut(e,H.uid),He(H.uid,e).catch(me=>{})),Xn(H.uid).catch(me=>{})});return()=>V()},[n,e]);const ut=async(V,H)=>{try{const me=await Bh(V);Ne(me),Fe(me.dmId===H),me.dmId===H&&me.campaignType==="manual"&&n(`/lobby/${V}`)}catch(me){console.error("Error loading party info:",me)}};A.useEffect(()=>{h&&(M({name:h.name||"",race:h.race||"",class:h.class||"",level:h.level||1,background:h.background||"",alignment:h.alignment||"",strength:h.strength||10,dexterity:h.dexterity||10,constitution:h.constitution||10,intelligence:h.intelligence||10,wisdom:h.wisdom||10,charisma:h.charisma||10,age:h.age||"",height:h.height||"",weight:h.weight||"",eyes:h.eyes||"",skin:h.skin||"",hair:h.hair||"",personality:h.personality||"",ideals:h.ideals||"",bonds:h.bonds||"",flaws:h.flaws||"",backstory:h.backstory||"",equipment:h.equipment||[],spells:h.spells||[],proficiencies:h.proficiencies||[],portrait:h.portrait||"/placeholder-character.png"}),h.weaponChoices&&_e(h.weaponChoices),h.spellChoices&&J(h.spellChoices),h.abilityScoreMethod&&I(h.abilityScoreMethod),h.rolledScores&&(C(h.rolledScores),k(h.assignedScores||{}),K(h.rolledScores.length>0)))},[h]),A.useEffect(()=>{t&&e&&(async()=>{try{(await Vl(t.uid)).filter(Te=>Te.partyId===e).length>1&&(await dt(),await He(t.uid,e))}catch{}})()},[t,e]);const He=async(V,H)=>{try{const Te=(await Vl(V)).filter(Ut=>Ut.partyId===H);if(Te.length===0){m(null);return}if(Te.length===1){m(Te[0]);return}const et=Te.sort((Ut,Bt)=>{var F,q,le,fe;const W=((q=(F=Ut.updatedAt)==null?void 0:F.toDate)==null?void 0:q.call(F))||Ut.updatedAt||new Date(0);return(((fe=(le=Bt.updatedAt)==null?void 0:le.toDate)==null?void 0:fe.call(le))||Bt.updatedAt||new Date(0))-W})[0];m(et),await Pt(Te,et.id)}catch{}},Pt=async(V,H)=>{try{const me=V.filter(Te=>Te.id!==H).map(Te=>Yd(Te.id));await Promise.all(me)}catch{}},dt=async()=>{try{const H=(await Vl(t.uid)).filter(me=>me.partyId===e);if(H.length>0){const me=H.map(async Te=>{try{return await Yd(Te.id),{success:!0,id:Te.id}}catch(et){return{success:!1,id:Te.id,error:et}}});await Promise.all(me),await new Promise(Te=>setTimeout(Te,1e3))}}catch{}},Xn=async V=>{try{const H=await hS(V);y(H)}catch{}},Zn=["Human","Elf","Dwarf","Halfling","Dragonborn","Tiefling","Half-Elf","Half-Orc","Gnome","Aarakocra","Genasi","Goliath"],nn=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"],Qe=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],Qt=["Acolyte","Criminal","Folk Hero","Noble","Sage","Soldier"],yt=[15,14,13,12,10,8],Xe={Fighter:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Paladin:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Barbarian:{"Martial Melee Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"]},Bard:{Weapon:["Rapier","Longsword"]},Druid:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Monk:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Sorcerer:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Warlock:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]}},rn={Wizard:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Sorcerer:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Warlock:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Eldritch Blast",description:"A beam of crackling energy that deals force damage and can hit multiple targets."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Cleric:[{name:"Guidance",description:"Touch a creature to give them +1d4 to their next ability check."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Resistance",description:"Touch a creature to give them +1d4 to their next saving throw."},{name:"Sacred Flame",description:"Flame-like radiance descends on a creature within 60 feet, dealing radiant damage."},{name:"Spare the Dying",description:"Touch a dying creature to stabilize them at 0 hit points."},{name:"Thaumaturgy",description:"Perform minor magical tricks - make your voice boom, cause tremors, or change eye color."}],Druid:[{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Druidcraft",description:"Predict weather, make a flower bloom, or create a harmless sensory effect."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Primal Savagery",description:"Transform your hand into a claw that deals acid damage to a creature you touch."},{name:"Produce Flame",description:"Create a flickering flame in your hand that you can throw for fire damage."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shillelagh",description:"Transform a club or quarterstaff into a magical weapon that uses your spellcasting ability."},{name:"Thorn Whip",description:"Create a vine-like whip that pulls a creature toward you and deals piercing damage."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."}],Bard:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."},{name:"Vicious Mockery",description:"Insult a creature within 60 feet, dealing psychic damage and possibly giving disadvantage."}]},vt={Wizard:{cantrips:3,spells:6},Sorcerer:{cantrips:4,spells:2},Warlock:{cantrips:2,spells:2},Cleric:{cantrips:3,spells:2},Druid:{cantrips:2,spells:2},Bard:{cantrips:2,spells:4}},_n=V=>{const me=[...{Fighter:["Chain mail armor","Light crossbow and 20 bolts","Dungeoneer's pack","5 gp"],Wizard:["Arcane focus","Scholar's pack","Component pouch","5 gp"],Cleric:["Chain mail armor","Light crossbow and 20 bolts","Priest's pack","Shield","Holy symbol","5 gp"],Rogue:["Leather armor","Shortbow and 20 arrows","Burglar's pack","Thieves' tools","5 gp"],Ranger:["Scale mail armor","Longbow and 20 arrows","Explorer's pack","5 gp"],Paladin:["Chain mail armor","Javelins (5)","Priest's pack","Holy symbol","5 gp"],Barbarian:["Javelins (4)","Explorer's pack","5 gp"],Bard:["Leather armor","Diplomat's pack OR entertainer's pack","Lute OR any other musical instrument","5 gp"],Druid:["Leather armor","Druidic focus","Explorer's pack","Shield","5 gp"],Monk:["Dungeoneer's pack OR explorer's pack","5 gp"],Sorcerer:["Component pouch OR arcane focus","Dungeoneer's pack","5 gp"],Warlock:["Component pouch OR arcane focus","Scholar's pack","5 gp"]}[V]||["Adventurer's pack","Simple weapon","5 gp"]];return re.weapon&&me.push(re.weapon),re.shield&&me.push(re.shield),Q.length>0&&me.push(`Spells: ${Q.join(", ")}`),me},dn=()=>{const V=[];for(let H=0;H<4;H++)V.push(Math.floor(Math.random()*6)+1);return V.sort((H,me)=>me-H),V.slice(0,3).reduce((H,me)=>H+me,0)},Yt=()=>{const V=[];for(let H=0;H<6;H++)V.push(dn());return V.sort((H,me)=>me-H),C(V),R([...V]),k({}),K(!0),V},hn=(V,H)=>{const me=N.filter(Te=>Te!==V);R(me),k(Te=>({...Te,[H]:V})),Ze(H,V)},Mn=V=>{const H=D[V];if(H){R(Te=>[...Te,H].sort((et,Ut)=>Ut-et));const me={...D};delete me[V],k(me),Ze(V,10)}},En=()=>{const V=["strength","dexterity","constitution","intelligence","wisdom","charisma"],H={...P};yt.forEach((me,Te)=>{H[V[Te]]=me}),M(H),k({}),R([]),K(!1)},Ze=(V,H)=>{M(me=>({...me,[V]:H||""}))},Bn=async V=>{V.preventDefault(),i(!0),l("");try{const H={name:P.name,race:P.race,class:P.class,level:P.level,userId:t.uid,partyId:e,weaponChoices:re,spellChoices:Q,abilityScoreMethod:$,rolledScores:b,assignedScores:D,createdAt:new Date,updatedAt:new Date};await dt();const me=await XI(t.uid,e,H);M(me),d("Character saved successfully!");const Te=!h;setTimeout(()=>{Te?(d("Character created! You will rejoin the story where it left off..."),setTimeout(()=>{(ne==null?void 0:ne.campaignType)==="ai-assist"?n(`/campaign/${e}`):n(`/lobby/${e}`)},2e3)):(ne==null?void 0:ne.campaignType)==="ai-assist"?n(`/campaign/${e}`):n(`/lobby/${e}`)},1e3)}catch{l("Failed to save character")}finally{i(!1)}},Mt=async()=>{if(!E.trim()){alert("Please enter a name for your preset");return}if(!P.name||!P.race||!P.class){alert("Please fill in at least the basic character information (name, race, class) before saving as preset");return}try{const V={name:E,data:{...P,weaponChoices:re,spellChoices:Q,abilityScoreMethod:$,rolledScores:b,assignedScores:D}},H=await dS(t.uid,V);x(""),T(!1),await Xn(t.uid),alert("Character preset saved successfully!")}catch(V){V.message.includes("User profile not found")?alert("User profile not found. Please try logging out and back in."):V.message.includes("permission")?alert("Permission denied. Please check your account status."):alert(`Failed to save preset: ${V.message}`)}},Ee=V=>{V.key==="Enter"&&E.trim()&&Mt()},G=V=>{const H=V.data;M({name:(H.name||"")+" (Copy)",race:H.race||"",class:H.class||"",level:H.level||1,background:H.background||"",alignment:H.alignment||"",strength:H.strength||10,dexterity:H.dexterity||10,constitution:H.constitution||10,intelligence:H.intelligence||10,wisdom:H.wisdom||10,charisma:H.charisma||10,age:H.age||"",height:H.height||"",weight:H.weight||"",eyes:H.eyes||"",skin:H.skin||"",hair:H.hair||"",personality:H.personality||"",ideals:H.ideals||"",bonds:H.bonds||"",flaws:H.flaws||"",backstory:H.backstory||"",equipment:[],spells:H.spells||[],proficiencies:H.proficiencies||[],portrait:H.portrait||"/placeholder-character.png"}),H.weaponChoices&&_e(H.weaponChoices),H.spellChoices&&J(H.spellChoices),H.abilityScoreMethod&&I(H.abilityScoreMethod),H.rolledScores&&(C(H.rolledScores),k(H.assignedScores||{}),K(H.rolledScores.length>0)),S(!1)},ie=async V=>{if(confirm("Are you sure you want to delete this preset? This action cannot be undone."))try{await mS(t.uid,V),await Xn(t.uid),alert("Preset deleted successfully!")}catch{alert("Failed to delete preset. Please try again.")}};if(!t)return null;if(!e)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-300",children:"Loading character creation..."}),o.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"No party ID found"})]})})});try{return o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),Ae&&(ne==null?void 0:ne.campaignType)==="manual"&&o.jsxs("div",{className:"mb-6 p-4 bg-amber-500/20 border border-amber-500/30 rounded-lg",children:[o.jsxs("div",{className:"flex items-center justify-center mb-2",children:[o.jsx("span",{className:"text-amber-400 text-lg mr-2",children:""}),o.jsx("h3",{className:"text-amber-300 font-semibold",children:"Dungeon Master Notice"})]}),o.jsx("p",{className:"text-center text-amber-200 text-sm",children:"As the Dungeon Master in a Manual Campaign, you don't need to create a character. You'll be redirected to the campaign lobby where you can manage the story and encounters."})]}),o.jsx("p",{className:"text-center text-gray-300 mb-6",children:h?"Edit your character below. When you're ready, click 'Ready Up & Join Campaign' at the bottom!":"Create your character to join the campaign. Once created, you'll be able to ready up and join the adventure!"}),h&&o.jsx("div",{className:"mb-6 flex justify-center",children:o.jsx("button",{type:"button",className:"fantasy-button bg-blue-600 hover:bg-blue-700",onClick:()=>{(ne==null?void 0:ne.campaignType)==="ai-assist"?n(`/campaign/${e}`):n(`/lobby/${e}`)},children:" Back to Campaign"})}),o.jsxs("div",{className:"mb-8 p-4 bg-gray-700 rounded-lg border border-gray-600",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-4",children:"Character Presets"}),o.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[o.jsxs("button",{type:"button",onClick:()=>S(!0),className:"fantasy-button bg-amber-600 hover:bg-amber-700",disabled:p.length===0,children:[" Load Preset (",p.length,")"]}),o.jsx("button",{type:"button",onClick:()=>T(!0),className:"fantasy-button bg-emerald-600 hover:bg-emerald-700",children:" Save as Preset"})]}),p.length>0&&o.jsx("p",{className:"text-sm text-gray-300",children:"Save your current character configuration as a preset to easily recreate it for other parties."})]}),o.jsxs("form",{onSubmit:V=>{Bn(V)},className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-name",className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Name"}),o.jsx("input",{id:"character-name",name:"character-name",type:"text",value:P.name,onChange:V=>Ze("name",V.target.value),className:"fantasy-input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-race",className:"block text-sm font-medium text-gray-200 mb-2",children:"Race"}),o.jsxs("select",{id:"character-race",name:"character-race",value:P.race,onChange:V=>Ze("race",V.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Race"}),Zn.map(V=>o.jsx("option",{value:V,children:V},V))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-class",className:"block text-sm font-medium text-gray-200 mb-2",children:"Class"}),o.jsxs("select",{id:"character-class",name:"character-class",value:P.class,onChange:V=>Ze("class",V.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Class"}),nn.map(V=>o.jsx("option",{value:V,children:V},V))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-background",className:"block text-sm font-medium text-gray-200 mb-2",children:"Background"}),o.jsxs("select",{id:"character-background",name:"character-background",value:P.background,onChange:V=>Ze("background",V.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Background"}),Qt.map(V=>o.jsx("option",{value:V,children:V},V))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-alignment",className:"block text-sm font-medium text-gray-200 mb-2",children:"Alignment"}),o.jsxs("select",{id:"character-alignment",name:"character-alignment",value:P.alignment,onChange:V=>Ze("alignment",V.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Alignment"}),Qe.map(V=>o.jsx("option",{value:V,children:V},V))]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Ability Scores"}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{htmlFor:"ability-method-standard",className:"block text-sm font-medium text-gray-200 mb-2",children:"Ability Score Generation Method"}),o.jsxs("div",{className:"flex space-x-4 mb-4",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{id:"ability-method-standard",type:"radio",name:"abilityMethod",value:"standard",checked:$==="standard",onChange:V=>I(V.target.value),className:"mr-2"}),o.jsx("span",{className:"text-gray-200",children:"Standard Array (15, 14, 13, 12, 10, 8)"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{id:"ability-method-roll",type:"radio",name:"abilityMethod",value:"roll",checked:$==="roll",onChange:V=>I(V.target.value),className:"mr-2"}),o.jsx("span",{className:"text-gray-200",children:"Roll 4d6, Drop Lowest"})]})]}),$==="standard"&&o.jsx("button",{type:"button",onClick:En,className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Apply Standard Array"}),$==="roll"&&o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{type:"button",onClick:Yt,disabled:je,className:`fantasy-button ${je?"bg-gray-500 cursor-not-allowed":"bg-gray-600 hover:bg-gray-700"}`,children:je?"Scores Already Rolled":"Roll Ability Scores"}),je&&o.jsx("p",{className:"text-sm text-gray-300",children:"You can only roll once, but you can reassign scores as many times as you like."}),b.length>0&&o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-semibold text-gray-100 mb-2",children:"Rolled Scores"}),o.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:N.map((V,H)=>o.jsx("span",{className:"bg-amber-900 text-amber-200 border border-amber-600 px-3 py-1 rounded-full text-sm font-medium",children:V},`${V}-${H}`))}),o.jsx("p",{className:"text-sm text-gray-300",children:"Click on an ability score below to assign your rolled scores. You can reassign them as many times as you want."})]})]})]}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:["strength","dexterity","constitution","intelligence","wisdom","charisma"].map(V=>{const H=D[V],me=H||P[V]||10;return o.jsxs("div",{className:"border border-gray-600 rounded-lg p-4",children:[o.jsx("label",{htmlFor:`ability-${V}`,className:"block text-sm font-medium text-gray-200 mb-2 capitalize",children:V}),H?o.jsxs("div",{className:"space-y-2",children:[o.jsx("div",{className:"text-lg font-bold text-amber-400",children:H}),o.jsx("button",{type:"button",onClick:()=>Mn(V),className:"text-xs text-red-400 hover:text-red-300",children:"Unassign"})]}):o.jsxs("div",{className:"space-y-2",children:[o.jsx("input",{id:`ability-${V}`,name:`ability-${V}`,type:"number",min:"1",max:"20",value:me,onChange:Te=>Ze(V,parseInt(Te.target.value)),className:"fantasy-input",required:!0}),N.length>0&&o.jsx("div",{className:"flex flex-wrap gap-1",children:N.map((Te,et)=>o.jsx("button",{type:"button",onClick:()=>hn(Te,V),className:"bg-amber-900 hover:bg-amber-800 border border-amber-600 text-amber-200 px-2 py-1 rounded text-xs font-medium",children:Te},`${Te}-${et}`))})]}),o.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Modifier: ",Math.floor((me-10)/2)]})]},V)})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Physical Description"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-age",className:"block text-sm font-medium text-gray-200 mb-2",children:"Age"}),o.jsx("input",{id:"character-age",name:"character-age",type:"text",placeholder:"Age",value:P.age,onChange:V=>Ze("age",V.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-height",className:"block text-sm font-medium text-gray-200 mb-2",children:"Height"}),o.jsx("input",{id:"character-height",name:"character-height",type:"text",placeholder:"Height",value:P.height,onChange:V=>Ze("height",V.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-weight",className:"block text-sm font-medium text-gray-200 mb-2",children:"Weight"}),o.jsx("input",{id:"character-weight",name:"character-weight",type:"text",placeholder:"Weight",value:P.weight,onChange:V=>Ze("weight",V.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-eyes",className:"block text-sm font-medium text-gray-200 mb-2",children:"Eye Color"}),o.jsx("input",{id:"character-eyes",name:"character-eyes",type:"text",placeholder:"Eye Color",value:P.eyes,onChange:V=>Ze("eyes",V.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-skin",className:"block text-sm font-medium text-gray-200 mb-2",children:"Skin Color"}),o.jsx("input",{id:"character-skin",name:"character-skin",type:"text",placeholder:"Skin Color",value:P.skin,onChange:V=>Ze("skin",V.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-hair",className:"block text-sm font-medium text-gray-200 mb-2",children:"Hair Color"}),o.jsx("input",{id:"character-hair",name:"character-hair",type:"text",placeholder:"Hair Color",value:P.hair,onChange:V=>Ze("hair",V.target.value),className:"fantasy-input"})]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Personality"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-personality",className:"block text-sm font-medium text-gray-200 mb-2",children:"Personality Traits"}),o.jsx("textarea",{id:"character-personality",name:"character-personality",value:P.personality,onChange:V=>Ze("personality",V.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your character's personality..."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-ideals",className:"block text-sm font-medium text-gray-200 mb-2",children:"Ideals"}),o.jsx("textarea",{id:"character-ideals",name:"character-ideals",value:P.ideals,onChange:V=>Ze("ideals",V.target.value),className:"fantasy-input",rows:"3",placeholder:"What does your character believe in?"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-bonds",className:"block text-sm font-medium text-gray-200 mb-2",children:"Bonds"}),o.jsx("textarea",{id:"character-bonds",name:"character-bonds",value:P.bonds,onChange:V=>Ze("bonds",V.target.value),className:"fantasy-input",rows:"3",placeholder:"What connections does your character have?"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-flaws",className:"block text-sm font-medium text-gray-200 mb-2",children:"Flaws"}),o.jsx("textarea",{id:"character-flaws",name:"character-flaws",value:P.flaws,onChange:V=>Ze("flaws",V.target.value),className:"fantasy-input",rows:"3",placeholder:"What are your character's weaknesses?"})]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Backstory"}),o.jsx("textarea",{id:"character-backstory",name:"character-backstory",value:P.backstory,onChange:V=>Ze("backstory",V.target.value),className:"fantasy-input",rows:"6",placeholder:"Tell the story of your character's life before the adventure..."})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Starting Equipment"}),P.class&&Xe[P.class]&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Weapons"}),o.jsx("div",{className:"space-y-4",children:Object.entries(Xe[P.class]).map(([V,H])=>o.jsxs("div",{children:[o.jsx("label",{htmlFor:`weapon-${V.toLowerCase().replace(/\s+/g,"")}`,className:"block text-sm font-medium text-gray-200 mb-2",children:V}),o.jsxs("select",{id:`weapon-${V.toLowerCase().replace(/\s+/g,"")}`,name:`weapon-${V.toLowerCase().replace(/\s+/g,"")}`,value:re[V.toLowerCase().replace(/\s+/g,"")]||"",onChange:me=>_e(Te=>({...Te,[V.toLowerCase().replace(/\s+/g,"")]:me.target.value})),className:"fantasy-input",children:[o.jsxs("option",{value:"",children:["Select ",V]}),H.map(me=>o.jsx("option",{value:me,children:me},me))]})]},V))})]}),P.class&&rn[P.class]&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Cantrips"}),o.jsxs("p",{className:"text-sm text-gray-300 mb-3",children:["Select your starting cantrips (0-level spells). You can choose up to ",((ze=vt[P.class])==null?void 0:ze.cantrips)||0," cantrips."]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto border border-gray-600 rounded-lg p-4",children:rn[P.class].map(V=>{var Te;const H=Q.includes(V.name),me=!H&&Q.length>=(((Te=vt[P.class])==null?void 0:Te.cantrips)||0);return o.jsx("div",{className:`border rounded-lg p-3 ${H?"border-amber-500 bg-amber-900/20":"border-gray-600"} ${me?"opacity-50":"hover:border-gray-500"}`,children:o.jsxs("label",{className:`flex items-start space-x-3 cursor-pointer ${me?"cursor-not-allowed":""}`,children:[o.jsx("input",{id:`spell-${V.name.toLowerCase().replace(/\s+/g,"-")}`,name:`spell-${V.name.toLowerCase().replace(/\s+/g,"-")}`,type:"checkbox",checked:H,disabled:me,onChange:et=>{et.target.checked?J(Ut=>[...Ut,V.name]):J(Ut=>Ut.filter(Bt=>Bt!==V.name))},className:"rounded mt-1"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-medium text-gray-100",children:V.name}),o.jsx("div",{className:"text-sm text-gray-300 mt-1",children:V.description})]})]})},V.name)})}),o.jsxs("div",{className:"flex justify-between items-center mt-3",children:[o.jsxs("p",{className:"text-sm text-gray-400",children:["Selected: ",Q.length," / ",((Re=vt[P.class])==null?void 0:Re.cantrips)||0," cantrips"]}),Q.length>=(((Pe=vt[P.class])==null?void 0:Pe.cantrips)||0)&&o.jsx("p",{className:"text-sm text-green-400 font-medium",children:" Cantrip selection complete"})]})]}),P.class?o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsxs("h3",{className:"font-semibold text-gray-100 mb-3",children:[P.class," Starting Equipment"]}),o.jsx("ul",{className:"space-y-1",children:_n(P.class).map((V,H)=>o.jsxs("li",{className:"text-gray-200 flex items-start",children:[o.jsx("span",{className:"text-gray-400 mr-2",children:""}),V]},H))}),o.jsx("p",{className:"text-sm text-gray-300 mt-3",children:"This equipment will be automatically assigned to your character."})]}):o.jsx("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:o.jsx("p",{className:"text-gray-300",children:"Select a class to see your starting equipment."})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Character Portrait"}),o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("div",{className:"w-32 h-32 bg-gray-600 rounded-lg flex items-center justify-center",children:o.jsx("span",{className:"text-gray-400",children:"Portrait Placeholder"})}),o.jsx("button",{type:"button",className:"fantasy-button",onClick:()=>{},children:"Upload Image"})]})]}),o.jsx("div",{className:"flex justify-center",children:h?o.jsx("button",{type:"submit",className:"fantasy-button bg-blue-600 hover:bg-blue-700",disabled:s,children:s?"Updating Character...":"Update Character"}):o.jsx("button",{type:"submit",className:"fantasy-button",disabled:s,children:s?"Saving Character...":"Save Character"})})]}),_&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"fantasy-card max-w-md w-full mx-4",children:[o.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Save Character Preset"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"preset-name",className:"block text-sm font-medium text-gray-200 mb-2",children:"Preset Name"}),o.jsx("input",{id:"preset-name",name:"preset-name",type:"text",value:E,onChange:V=>x(V.target.value),onKeyPress:Ee,className:"fantasy-input",placeholder:"Enter a name for your preset",autoFocus:!0})]}),o.jsxs("div",{className:"flex space-x-3",children:[o.jsx("button",{type:"button",onClick:()=>{T(!1),x("")},className:"fantasy-button bg-gray-600 hover:bg-gray-700 flex-1",children:"Cancel"}),o.jsx("button",{type:"button",onClick:Mt,className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 flex-1",children:"Save Preset"})]})]})]})}),v&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"fantasy-card max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Load Character Preset"}),p.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-gray-300 mb-4",children:"No character presets found."}),o.jsx("p",{className:"text-sm text-gray-400",children:"Create a character and save it as a preset to see it here."}),o.jsx("button",{type:"button",onClick:()=>S(!1),className:"fantasy-button mt-4",children:"Close"})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"grid gap-4",children:p.map(V=>o.jsxs("div",{className:"border border-gray-600 rounded-lg p-4 hover:border-gray-500",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-100",children:V.name}),o.jsxs("p",{className:"text-sm text-gray-300",children:[V.data.race," ",V.data.class,"  Level ",V.data.level]}),V.data.background&&o.jsx("p",{className:"text-sm text-gray-400",children:V.data.background}),V.createdAt&&o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Created: ",new Date(V.createdAt.toDate()).toLocaleDateString()]})]}),o.jsx("button",{type:"button",onClick:()=>ie(V.id),className:"text-red-400 hover:text-red-300 text-sm",title:"Delete preset",children:""})]}),o.jsx("div",{className:"flex space-x-2",children:o.jsx("button",{type:"button",onClick:()=>G(V),className:"fantasy-button bg-amber-600 hover:bg-amber-700 flex-1",children:"Load Preset"})})]},V.id))}),o.jsx("div",{className:"flex justify-center",children:o.jsx("button",{type:"button",onClick:()=>S(!1),className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Cancel"})})]})]})})]})})}catch(V){return console.error("Error rendering CharacterCreation:",V),o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-red-400 text-sm",children:"An error occurred while rendering the component."}),o.jsx("p",{className:"text-gray-300",children:"Please try again later."})]})})})}}class PV{constructor(){this.tileTypes={grass:{name:"Grass",color:"bg-green-600",symbol:""},water:{name:"Water",color:"bg-blue-500",symbol:""},mountain:{name:"Mountain",color:"bg-gray-600",symbol:""},forest:{name:"Forest",color:"bg-green-800",symbol:""},desert:{name:"Desert",color:"bg-yellow-600",symbol:""},swamp:{name:"Swamp",color:"bg-green-900",symbol:""},lava:{name:"Lava",color:"bg-red-800",symbol:""},ice:{name:"Ice",color:"bg-blue-200",symbol:""},sand:{name:"Sand",color:"bg-yellow-400",symbol:""},stone:{name:"Stone",color:"bg-gray-500",symbol:""},road:{name:"Road",color:"bg-yellow-800",symbol:""},bridge:{name:"Bridge",color:"bg-amber-700",symbol:""},stairs:{name:"Stairs",color:"bg-gray-400",symbol:""},path:{name:"Path",color:"bg-yellow-700",symbol:""},wall:{name:"Wall",color:"bg-gray-800",symbol:""},door:{name:"Door",color:"bg-amber-800",symbol:""},window:{name:"Window",color:"bg-blue-300",symbol:""},tower:{name:"Tower",color:"bg-gray-700",symbol:""},castle:{name:"Castle",color:"bg-gray-600",symbol:""},house:{name:"House",color:"bg-amber-600",symbol:""},temple:{name:"Temple",color:"bg-purple-700",symbol:""},cave:{name:"Cave",color:"bg-gray-900",symbol:""},chest:{name:"Chest",color:"bg-yellow-700",symbol:""},barrel:{name:"Barrel",color:"bg-amber-900",symbol:""},table:{name:"Table",color:"bg-amber-800",symbol:""},chair:{name:"Chair",color:"bg-amber-700",symbol:""},bed:{name:"Bed",color:"bg-blue-800",symbol:""},fireplace:{name:"Fireplace",color:"bg-red-700",symbol:""},altar:{name:"Altar",color:"bg-purple-800",symbol:""},fountain:{name:"Fountain",color:"bg-blue-400",symbol:""},statue:{name:"Statue",color:"bg-gray-300",symbol:""},tree:{name:"Tree",color:"bg-green-700",symbol:""},bush:{name:"Bush",color:"bg-green-600",symbol:""},npc:{name:"NPC",color:"bg-purple-600",symbol:""},enemy:{name:"Enemy",color:"bg-red-600",symbol:""},player:{name:"Player",color:"bg-blue-600",symbol:""},boss:{name:"Boss",color:"bg-red-800",symbol:""},merchant:{name:"Merchant",color:"bg-green-500",symbol:""},guard:{name:"Guard",color:"bg-blue-700",symbol:""},animal:{name:"Animal",color:"bg-orange-600",symbol:""},portal:{name:"Portal",color:"bg-purple-500",symbol:""},trap:{name:"Trap",color:"bg-red-500",symbol:""},magic:{name:"Magic",color:"bg-purple-400",symbol:""},crystal:{name:"Crystal",color:"bg-cyan-400",symbol:""},empty:{name:"Empty",color:"bg-slate-700",symbol:""}}}async loadCampaignData(e){try{const t=await Za(e);if(t)return t;{const r={partyId:e,type:"manual",currentScene:"",storyHistory:[],status:"active",createdAt:new Date};return await Ht(e,r),r}}catch(t){throw console.error("Error loading campaign data:",t),t}}async saveScene(e,t,r){try{const s={...t,currentScene:r,storyHistory:[...(t==null?void 0:t.storyHistory)||[],{timestamp:new Date,content:r,type:"scene"}]};return await Ht(e,s),s}catch(s){throw console.error("Error saving scene:",s),s}}async endSession(e,t){try{const r={...t,status:"ended",endedAt:new Date};return await Ht(e,r),r}catch(r){throw console.error("Error ending session:",r),r}}loadMap(e){try{const t=localStorage.getItem(`campaign-map-${e}`);if(t){const r=JSON.parse(t);return{title:r.title||"Campaign Map",content:r.content||[],size:r.size||{width:15,height:10},subMaps:r.subMaps||{},updatedAt:r.updatedAt}}else return{title:"Campaign Map",content:this.initializeMap({width:15,height:10}),size:{width:15,height:10},subMaps:{},updatedAt:new Date().toISOString()}}catch(t){return console.error("Error loading map:",t),{title:"Campaign Map",content:this.initializeMap({width:15,height:10}),size:{width:15,height:10},subMaps:{},updatedAt:new Date().toISOString()}}}saveMap(e,t){try{const r={title:t.title,content:t.content,size:t.size,subMaps:t.subMaps,updatedAt:new Date().toISOString()};return localStorage.setItem(`campaign-map-${e}`,JSON.stringify(r)),!0}catch(r){throw console.error("Error saving map:",r),r}}initializeMap(e){const t=[];for(let r=0;r<e.height;r++){const s=[];for(let i=0;i<e.width;i++)s.push("empty");t.push(s)}return t}initializeSubMap(){const e=[];for(let t=0;t<8;t++){const r=[];for(let s=0;s<8;s++)r.push("empty");e.push(r)}return e}updateMapTile(e,t,r,s){const i=[...e];return i[r][t]=s,i}updateSubMapTile(e,t,r,s){const i=[...e];return i[r][t]=s,i}getTileHasSubMap(e,t,r){const s=`${t}-${r}`;return e[s]&&e[s].some(i=>i.some(a=>a!=="empty"))}saveSubMap(e,t,r,s){const i=`${t}-${r}`;return{...e,[i]:s}}async startCombat(e,t,r,s){if(!r.trim())throw new Error("Please enter enemy details before starting combat");try{const a=r.split(`
`).filter(c=>c.trim()).map((c,d)=>{const[h,m,p,y]=c.split(",").map(_=>_.trim());return{id:`enemy_${d}`,name:h||`Enemy ${d+1}`,hp:parseInt(m)||20,maxHp:parseInt(m)||20,ac:parseInt(p)||12,level:parseInt(y)||1,class:"enemy",race:"unknown"}});return await zn.createCombatSession(e,t,a,s||"Manual combat encounter")}catch(i){throw console.error("Error starting combat:",i),i}}getTileTypes(){return this.tileTypes}validateMapSize(e,t){return{width:Math.max(5,Math.min(30,e)),height:Math.max(5,Math.min(20,t))}}async setPlayerReady(e,t){try{const r=await Za(e),s=(r==null?void 0:r.readyPlayers)||[];if(!s.includes(t)){const i={...r,readyPlayers:[...s,t]};await Ht(e,i)}return!0}catch(r){throw console.error("Error setting player ready:",r),r}}async checkAllPlayersReady(e,t){try{const r=await Za(e);return((r==null?void 0:r.readyPlayers)||[]).length===t}catch(r){return console.error("Error checking player readiness:",r),!1}}}const fn=new PV;function RV(){var Te,et,Ut,Bt;const{partyId:n}=wc(),e=yr(),[t,r]=A.useState(null),[s,i]=A.useState(!0),[a,l]=A.useState(null),[c,d]=A.useState([]),[h,m]=A.useState({}),[p,y]=A.useState(null),[_,T]=A.useState(!1),[E,x]=A.useState(null),[v,S]=A.useState(!1),[P,M]=A.useState(!1),[$,I]=A.useState([]),[b,C]=A.useState("Campaign Map"),[N,R]=A.useState({width:15,height:10}),[D,k]=A.useState("grass"),[je,K]=A.useState("draw"),[re,_e]=A.useState(!1),[Q,J]=A.useState({x:0,y:0}),[ne,Ne]=A.useState({}),[Ae,Fe]=A.useState(null),[ut,He]=A.useState(!1),[Pt,dt]=A.useState(!1),[Xn,Zn]=A.useState({x:0,y:0});A.useEffect(()=>{const W=Bo(Y=>{if(!Y){e("/login");return}r(Y)});return()=>W()},[e]),A.useEffect(()=>{t&&n&&(nn(),vt())},[t,n]),A.useEffect(()=>{const W=()=>{dt(!1)};return document.addEventListener("mouseup",W),()=>{document.removeEventListener("mouseup",W)}},[]);const nn=async()=>{try{i(!0);const W=await Bh(n);l(W),T(W.dmId===t.uid);const Y=await ui(n);d(Y);const F=Y.find(q=>q.userId===t.uid);if(y(F),Y.length>0){const q=Y.map(de=>de.userId),le=await Qd(q),fe={};le.forEach(de=>{de&&de.userId&&(fe[de.userId]=de)}),m(fe)}}catch(W){console.error("Error loading lobby data:",W)}finally{i(!1)}},Qe=()=>{a.campaignType==="manual"?e(`/manual-campaign/${n}`):e(`/campaign/${n}`)},Qt=W=>{x(W),S(!0)},yt=()=>{localStorage.setItem(`campaign-map-${n}`,JSON.stringify({title:b,content:$,size:N,subMaps:ne,updatedAt:new Date().toISOString()})),M(!1)},Xe=fn.getTileTypes(),rn=()=>{const W=[];for(let Y=0;Y<N.height;Y++){const F=[];for(let q=0;q<N.width;q++)F.push("empty");W.push(F)}return W},vt=()=>{const W=localStorage.getItem(`campaign-map-${n}`);if(W){const Y=JSON.parse(W);C(Y.title),I(Y.content||[]),Ne(Y.subMaps||{}),Y.size&&R(Y.size)}else I(rn())},_n=(W,Y)=>{if(je==="draw"){const F=[...$];F[Y][W]=D,I(F)}else if(je==="erase"){const F=[...$];F[Y][W]="empty",I(F)}},dn=(W,Y)=>{dt(!0),Zn({x:W,y:Y}),_n(W,Y)},Yt=(W,Y)=>{Pt&&_n(W,Y)},hn=()=>{dt(!1)},Mn=()=>{I(rn())},En=()=>{const W=rn();I(W)},Ze=(W,Y,F)=>{F.preventDefault();const q=`${W}-${Y}`;J({x:W,y:Y}),Fe(ne[q]||Bn()),_e(!0)},Bn=()=>{const W=[];for(let Y=0;Y<8;Y++){const F=[];for(let q=0;q<8;q++)F.push("empty");W.push(F)}return W},Mt=(W,Y)=>{if(je==="draw"){const F=[...Ae];F[Y][W]=D,Fe(F)}else if(je==="erase"){const F=[...Ae];F[Y][W]="empty",Fe(F)}},Ee=(W,Y)=>{dt(!0),Zn({x:W,y:Y}),Mt(W,Y)},G=(W,Y)=>{Pt&&Mt(W,Y)},ie=()=>{const W=`${Q.x}-${Q.y}`,Y={...ne,[W]:Ae};Ne(Y),_e(!1)},ze=()=>{Fe(Bn())},Re=(W,Y)=>{const F=`${W}-${Y}`;return ne[F]&&ne[F].some(q=>q.some(le=>le!=="empty"))},Pe=W=>{const Y=h[W];return Y!=null&&Y.username?Y.username:Y!=null&&Y.displayName?Y.displayName:Y!=null&&Y.email?Y.email.split("@")[0]:"Unknown User"},V=W=>W?W.name&&W.race&&W.class?"Ready":"Incomplete":"No Character",H=W=>{switch(W){case"Ready":return"text-green-400";case"Incomplete":return"text-yellow-400";case"No Character":return"text-red-400";default:return"text-slate-400"}},me=W=>{switch(W){case"Ready":return"";case"Incomplete":return"";case"No Character":return"";default:return""}};return s?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-amber-400 border-t-transparent mx-auto mb-4"}),o.jsx("p",{className:"text-slate-300 text-lg font-medium",children:"Loading campaign lobby..."})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsx("div",{className:"mb-8",children:o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("h1",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-400 mb-4",children:"Campaign Lobby"}),o.jsx("div",{className:"w-24 h-1 bg-gradient-to-r from-amber-400 to-orange-400 mx-auto rounded-full mb-4"}),o.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-2",children:a.name}),o.jsx("p",{className:"text-slate-400 mb-4",children:a.description}),o.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[o.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${a.campaignType==="ai-assist"?"bg-amber-500/20 text-amber-300 border border-amber-500/30":"bg-slate-600/20 text-slate-300 border border-slate-500/30"}`,children:a.campaignType==="ai-assist"?" AI Assist":" Manual Campaign"}),o.jsxs("div",{className:"text-slate-400",children:[c.length," / ",a.maxPlayers," Players"]})]})]})}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:(Te=a.members)==null?void 0:Te.map(W=>{const Y=c.find(le=>le.userId===W),F=V(Y),q=W===t.uid;return o.jsxs("div",{className:`fantasy-card ${q?"ring-2 ring-amber-500/50":""}`,children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mr-3",children:o.jsx("span",{className:"text-slate-300 font-semibold",children:Pe(W).charAt(0).toUpperCase()})}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-semibold text-slate-100",children:Pe(W)}),W===a.dmId&&o.jsx("span",{className:"text-xs text-amber-400 font-medium",children:"Dungeon Master"})]})]}),o.jsxs("div",{className:`text-sm font-medium ${H(F)}`,children:[me(F)," ",F]})]}),Y&&o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-3",children:[o.jsx("h4",{className:"font-semibold text-slate-100 mb-1",children:Y.name}),o.jsxs("p",{className:"text-sm text-slate-400",children:[Y.race," ",Y.class,"  Level ",Y.level]}),Y.background&&o.jsx("p",{className:"text-xs text-slate-500 mt-1",children:Y.background})]}),_&&o.jsx("button",{onClick:()=>Qt(Y),className:"w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 text-sm",children:" View Character Sheet"})]})]},W)})}),$&&$.length>0&&o.jsxs("div",{className:"fantasy-card mb-8",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100",children:b}),_&&o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>M(!0),className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 text-sm",children:" Edit Map"}),o.jsx("button",{onClick:()=>He(!0),className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 text-sm",children:" View Characters"})]})]}),o.jsx("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4 overflow-x-auto",children:o.jsx("div",{className:"inline-block",children:$.map((W,Y)=>o.jsx("div",{className:"flex",children:W.map((F,q)=>{var le,fe,de;return o.jsxs("div",{className:`w-8 h-8 border border-slate-600 flex items-center justify-center text-xs relative ${((le=Xe[F])==null?void 0:le.color)||"bg-slate-700"}`,title:`${q}, ${Y}: ${((fe=Xe[F])==null?void 0:fe.name)||"Unknown"}${Re(q,Y)?" (Has sub-map)":""}`,onContextMenu:Se=>Ze(q,Y,Se),children:[((de=Xe[F])==null?void 0:de.symbol)||"",Re(q,Y)&&o.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-purple-500 rounded-full flex items-center justify-center text-[8px] text-white",children:""})]},`${q}-${Y}`)})},Y))})}),o.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-4 items-center justify-between",children:[o.jsxs("div",{className:"text-xs text-slate-400 text-center sm:text-left",children:[" ",o.jsx("strong",{children:"Tip:"})," Right-click on any tile to create or edit sub-maps (detailed areas within tiles)"]}),o.jsx("div",{className:"text-xs text-slate-400 text-center sm:text-right",children:" Purple pins indicate tiles with sub-maps"})]})]}),o.jsxs("div",{className:"mt-8 fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-4",children:"Campaign Information"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Campaign Type:"}),o.jsx("span",{className:"text-slate-200 ml-2",children:a.campaignType==="ai-assist"?"AI-Assisted Storytelling":"Manual D&D Experience"})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Max Players:"}),o.jsx("span",{className:"text-slate-200 ml-2",children:a.maxPlayers})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Dungeon Master:"}),o.jsx("span",{className:"text-slate-200 ml-2",children:Pe(a.dmId)})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Status:"}),o.jsx("span",{className:"text-slate-200 ml-2",children:c.length===((et=a.members)==null?void 0:et.length)?"Ready to Start":"Waiting for Characters"})]})]})]}),c.length===((Ut=a.members)==null?void 0:Ut.length)&&o.jsx("div",{className:"mt-8 text-center",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-4",children:a.campaignType==="ai-assist"?" Ready to Begin AI-Assisted Adventure!":" Ready to Begin Manual Campaign!"}),o.jsx("p",{className:"text-slate-400 mb-6",children:a.campaignType==="ai-assist"?"All players have created their characters. The AI will now generate story plots for you to choose from.":"All players have created their characters. You can now begin your manual D&D campaign."}),o.jsx("button",{onClick:Qe,className:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-bold py-4 px-8 rounded-lg transition-all duration-300 text-lg shadow-lg hover:shadow-xl transform hover:scale-105",children:a.campaignType==="ai-assist"?" Start AI Campaign":" Start Manual Campaign"})]})}),v&&E&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"fantasy-card max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h2",{className:"text-2xl font-bold text-slate-100",children:["Character Sheet: ",E.name]}),o.jsx("button",{onClick:()=>S(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:""})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Basic Information"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Name:"})," ",o.jsx("span",{className:"text-slate-200",children:E.name})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Race:"})," ",o.jsx("span",{className:"text-slate-200",children:E.race})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Class:"})," ",o.jsx("span",{className:"text-slate-200",children:E.class})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Level:"})," ",o.jsx("span",{className:"text-slate-200",children:E.level})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Background:"})," ",o.jsx("span",{className:"text-slate-200",children:E.background})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Alignment:"})," ",o.jsx("span",{className:"text-slate-200",children:E.alignment})]})]})]}),o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Ability Scores"}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Strength:"})," ",o.jsx("span",{className:"text-slate-200",children:E.strength})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Dexterity:"})," ",o.jsx("span",{className:"text-slate-200",children:E.dexterity})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Constitution:"})," ",o.jsx("span",{className:"text-slate-200",children:E.constitution})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Intelligence:"})," ",o.jsx("span",{className:"text-slate-200",children:E.intelligence})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Wisdom:"})," ",o.jsx("span",{className:"text-slate-200",children:E.wisdom})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Charisma:"})," ",o.jsx("span",{className:"text-slate-200",children:E.charisma})]})]})]}),(E.age||E.height||E.weight||E.eyes||E.skin||E.hair)&&o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Physical Description"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[E.age&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Age:"})," ",o.jsx("span",{className:"text-slate-200",children:E.age})]}),E.height&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Height:"})," ",o.jsx("span",{className:"text-slate-200",children:E.height})]}),E.weight&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Weight:"})," ",o.jsx("span",{className:"text-slate-200",children:E.weight})]}),E.eyes&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Eyes:"})," ",o.jsx("span",{className:"text-slate-200",children:E.eyes})]}),E.skin&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Skin:"})," ",o.jsx("span",{className:"text-slate-200",children:E.skin})]}),E.hair&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Hair:"})," ",o.jsx("span",{className:"text-slate-200",children:E.hair})]})]})]})]}),o.jsxs("div",{className:"space-y-4",children:[(E.personality||E.ideals||E.bonds||E.flaws)&&o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Character Traits"}),o.jsxs("div",{className:"space-y-3 text-sm",children:[E.personality&&o.jsxs("div",{children:[o.jsx("div",{className:"text-slate-400 font-medium",children:"Personality:"}),o.jsx("div",{className:"text-slate-200",children:E.personality})]}),E.ideals&&o.jsxs("div",{children:[o.jsx("div",{className:"text-slate-400 font-medium",children:"Ideals:"}),o.jsx("div",{className:"text-slate-200",children:E.ideals})]}),E.bonds&&o.jsxs("div",{children:[o.jsx("div",{className:"text-slate-400 font-medium",children:"Bonds:"}),o.jsx("div",{className:"text-slate-200",children:E.bonds})]}),E.flaws&&o.jsxs("div",{children:[o.jsx("div",{className:"text-slate-400 font-medium",children:"Flaws:"}),o.jsx("div",{className:"text-slate-200",children:E.flaws})]})]})]}),E.backstory&&o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Backstory"}),o.jsx("div",{className:"text-sm text-slate-200 leading-relaxed",children:E.backstory})]}),E.equipment&&E.equipment.length>0&&o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Equipment"}),o.jsx("ul",{className:"space-y-1 text-sm",children:E.equipment.map((W,Y)=>o.jsxs("li",{className:"text-slate-200",children:[" ",W]},Y))})]}),E.spells&&E.spells.length>0&&o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Spells"}),o.jsx("ul",{className:"space-y-1 text-sm",children:E.spells.map((W,Y)=>o.jsxs("li",{className:"text-slate-200",children:[" ",W]},Y))})]})]})]})]})}),ut&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"fantasy-card max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"All Party Character Sheets"}),o.jsx("button",{onClick:()=>He(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:""})]}),o.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:c.map(W=>o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:W.name}),o.jsx("span",{className:"text-sm text-slate-400",children:Pe(W.userId)})]}),o.jsxs("div",{className:"space-y-3 text-sm",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Race:"})," ",o.jsx("span",{className:"text-slate-200",children:W.race})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Class:"})," ",o.jsx("span",{className:"text-slate-200",children:W.class})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Level:"})," ",o.jsx("span",{className:"text-slate-200",children:W.level})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Background:"})," ",o.jsx("span",{className:"text-slate-200",children:W.background})]})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"STR:"})," ",o.jsx("span",{className:"text-slate-200",children:W.strength})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"DEX:"})," ",o.jsx("span",{className:"text-slate-200",children:W.dexterity})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"CON:"})," ",o.jsx("span",{className:"text-slate-200",children:W.constitution})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"INT:"})," ",o.jsx("span",{className:"text-slate-200",children:W.intelligence})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"WIS:"})," ",o.jsx("span",{className:"text-slate-200",children:W.wisdom})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"CHA:"})," ",o.jsx("span",{className:"text-slate-200",children:W.charisma})]})]}),o.jsxs("div",{className:"flex justify-between text-xs",children:[o.jsxs("span",{children:[o.jsx("span",{className:"text-slate-400",children:"HP:"})," ",o.jsxs("span",{className:"text-slate-200",children:[W.hp,"/",W.maxHp]})]}),o.jsxs("span",{children:[o.jsx("span",{className:"text-slate-400",children:"AC:"})," ",o.jsx("span",{className:"text-slate-200",children:W.ac})]})]}),W.backstory&&o.jsxs("div",{className:"mt-3",children:[o.jsx("div",{className:"text-slate-400 font-medium text-xs mb-1",children:"Backstory:"}),o.jsx("div",{className:"text-slate-200 text-xs leading-relaxed line-clamp-3",children:W.backstory})]})]})]},W.id))})]})}),P&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"fantasy-card max-w-6xl w-full max-h-[95vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Grid-Based Map Editor"}),o.jsx("button",{onClick:()=>M(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:""})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[o.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Map Settings"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Map Title"}),o.jsx("input",{type:"text",value:b,onChange:W=>C(W.target.value),className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50",placeholder:"Enter map title..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Map Size"}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Width"}),o.jsx("input",{type:"number",min:"5",max:"30",value:N.width,onChange:W=>{R(Y=>({...Y,width:parseInt(W.target.value)})),En()},className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Height"}),o.jsx("input",{type:"number",min:"5",max:"20",value:N.height,onChange:W=>{R(Y=>({...Y,height:parseInt(W.target.value)})),En()},className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50"})]})]})]})]})]}),o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tools"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{onClick:()=>K("draw"),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${je==="draw"?"bg-amber-500/20 text-amber-300 border border-amber-500/30":"bg-slate-700/30 text-slate-300 hover:bg-slate-700/50"}`,children:" Draw"}),o.jsx("button",{onClick:()=>K("erase"),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${je==="erase"?"bg-red-500/20 text-red-300 border border-red-500/30":"bg-slate-700/30 text-slate-300 hover:bg-slate-700/50"}`,children:" Erase"})]})]}),o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tile Palette"}),o.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-96 overflow-y-auto",children:Object.entries(Xe).map(([W,Y])=>o.jsxs("button",{onClick:()=>k(W),className:`p-2 rounded-lg border transition-colors ${D===W?"border-amber-500 bg-amber-500/20":"border-slate-600 bg-slate-700/30 hover:border-slate-500"}`,children:[o.jsx("div",{className:`w-6 h-6 ${Y.color} rounded flex items-center justify-center text-xs mx-auto mb-1`,children:Y.symbol}),o.jsx("div",{className:"text-xs text-slate-300 truncate",children:Y.name})]},W))})]}),o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Actions"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{onClick:Mn,className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:" Clear Map"}),o.jsx("button",{onClick:yt,className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:" Save Map"})]})]})]}),o.jsxs("div",{className:"lg:col-span-3",children:[o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Map Canvas"}),o.jsxs("div",{className:"text-sm text-slate-400",children:[N.width,"  ",N.height," grid"]})]}),o.jsx("div",{className:"overflow-auto",children:o.jsx("div",{className:"inline-block",children:$.map((W,Y)=>o.jsx("div",{className:"flex",children:W.map((F,q)=>{var le,fe,de;return o.jsxs("button",{onMouseDown:()=>dn(q,Y),onMouseEnter:()=>Yt(q,Y),onMouseUp:hn,onContextMenu:Se=>Ze(q,Y,Se),className:`w-10 h-10 border border-slate-600 flex items-center justify-center text-sm transition-colors hover:border-amber-400 relative select-none ${((le=Xe[F])==null?void 0:le.color)||"bg-slate-700"}`,title:`${q}, ${Y}: ${((fe=Xe[F])==null?void 0:fe.name)||"Unknown"}${Re(q,Y)?" (Right-click for sub-map)":" (Right-click to create sub-map)"}`,children:[((de=Xe[F])==null?void 0:de.symbol)||"",Re(q,Y)&&o.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-purple-500 rounded-full flex items-center justify-center text-[10px] text-white",children:""})]},`${q}-${Y}`)})},Y))})})]}),o.jsxs("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4 text-xs text-slate-400",children:[o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-3",children:[o.jsx("div",{className:"font-semibold text-slate-300 mb-1",children:"Current Status"}),o.jsxs("div",{children:["Tool: ",o.jsx("span",{className:"text-amber-300",children:je==="draw"?" Draw":" Erase"})]}),o.jsxs("div",{children:["Tile: ",o.jsx("span",{className:"text-amber-300",children:(Bt=Xe[D])==null?void 0:Bt.name})]})]}),o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-3",children:[o.jsx("div",{className:"font-semibold text-slate-300 mb-1",children:"Instructions"}),o.jsx("div",{children:" Click or drag to place/remove"}),o.jsx("div",{children:" Right-click for sub-maps"}),o.jsx("div",{children:" Purple pins = sub-maps"})]})]})]})]})]})}),re&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"fantasy-card max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h2",{className:"text-2xl font-bold text-slate-100",children:["Sub-Map Editor - Tile (",Q.x,", ",Q.y,")"]}),o.jsx("button",{onClick:()=>_e(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:""})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[o.jsx("div",{className:"lg:col-span-2",children:o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Sub-Map (8x8)"}),o.jsx("button",{onClick:ze,className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm",children:"Clear"})]}),o.jsx("div",{className:"grid grid-cols-8 gap-1 mb-4",children:Ae.map((W,Y)=>W.map((F,q)=>{var le,fe,de;return o.jsx("button",{onMouseDown:()=>Ee(q,Y),onMouseEnter:()=>G(q,Y),onMouseUp:hn,className:`w-12 h-12 border border-slate-600 flex items-center justify-center text-lg transition-colors hover:border-amber-400 select-none ${((le=Xe[F])==null?void 0:le.color)||"bg-slate-700"}`,title:`${q}, ${Y}: ${((fe=Xe[F])==null?void 0:fe.name)||"Empty"}`,children:((de=Xe[F])==null?void 0:de.symbol)||""},`sub-${q}-${Y}`)}))})]})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tools"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{onClick:()=>K("draw"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${je==="draw"?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:" Draw"}),o.jsx("button",{onClick:()=>K("erase"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${je==="erase"?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:" Erase"})]})]}),o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tile Types"}),o.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-80 overflow-y-auto",children:Object.entries(Xe).map(([W,Y])=>o.jsxs("button",{onClick:()=>k(W),className:`p-2 rounded text-sm font-medium transition-colors flex items-center gap-2 ${D===W?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[o.jsx("span",{className:"text-lg",children:Y.symbol}),o.jsx("span",{className:"truncate",children:Y.name})]},W))})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:ie,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded font-medium",children:"Save Sub-Map"}),o.jsx("button",{onClick:()=>_e(!1),className:"px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded font-medium",children:"Cancel"})]})]})]})]})})]})})}const Ta={INVESTIGATION:"investigation",COMBAT:"combat",PERSUASION:"persuasion",EXPLORATION:"exploration",SOCIAL:"social"},Hr={HIDDEN:"hidden",DISCOVERED:"discovered",IN_PROGRESS:"in_progress",COMPLETED:"completed",FAILED:"failed"},jV=n=>{const e=[{id:"investigate_area",type:Ta.INVESTIGATION,title:"Investigate the Area",description:"Search for clues and gather information about the situation",keywords:["search","investigate","examine","look around","check","explore"],state:Hr.HIDDEN,discoveredAt:null,completedAt:null},{id:"resolve_conflict",type:Ta.COMBAT,title:"Resolve the Conflict",description:"Engage in combat to overcome the threat",keywords:["fight","attack","defend","combat","battle"],state:Hr.HIDDEN,discoveredAt:null,completedAt:null},{id:"negotiate_peace",type:Ta.PERSUASION,title:"Negotiate Peace",description:"Use diplomacy and persuasion to resolve the situation peacefully",keywords:["talk","negotiate","persuade","convince","diplomacy","peace"],state:Hr.HIDDEN,discoveredAt:null,completedAt:null}],t=[];return(n.toLowerCase().includes("thief")||n.toLowerCase().includes("stealth"))&&t.push({id:"stealth_approach",type:Ta.EXPLORATION,title:"Stealth Approach",description:"Use stealth to avoid detection and gather information",keywords:["sneak","stealth","hide","silent","unnoticed"],state:Hr.HIDDEN,discoveredAt:null,completedAt:null}),(n.toLowerCase().includes("merchant")||n.toLowerCase().includes("trade"))&&t.push({id:"establish_trade",type:Ta.SOCIAL,title:"Establish Trade Relations",description:"Build economic relationships with the locals",keywords:["trade","bargain","deal","commerce","business"],state:Hr.HIDDEN,discoveredAt:null,completedAt:null}),(n.toLowerCase().includes("scholar")||n.toLowerCase().includes("knowledge"))&&t.push({id:"gather_knowledge",type:Ta.INVESTIGATION,title:"Gather Ancient Knowledge",description:"Discover and preserve valuable information",keywords:["research","study","learn","knowledge","ancient","lore"],state:Hr.HIDDEN,discoveredAt:null,completedAt:null}),[...e,...t]},cb=n=>n.filter(e=>e.state===Hr.DISCOVERED||e.state===Hr.IN_PROGRESS||e.state===Hr.COMPLETED);class xS{constructor(){this.diceTypes={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20,d100:100},this.difficultyClasses={veryEasy:5,easy:10,medium:15,hard:20,veryHard:25,nearlyImpossible:30},this.actionTypes={attack:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:10,description:"Physical attack roll"},spell:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:12,description:"Spell casting check"},dodge:{primaryAbility:"dexterity",secondaryAbility:"wisdom",baseDC:15,description:"Dodge incoming attacks"},parry:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:18,description:"Parry with weapon"},backflip:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:20,description:"Perform a backflip"},somersault:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:18,description:"Perform a somersault"},cartwheel:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:16,description:"Perform a cartwheel"},wallRun:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:22,description:"Run up a wall"},jump:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:12,description:"Jump over obstacles"},climb:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:15,description:"Climb surfaces"},swim:{primaryAbility:"strength",secondaryAbility:"constitution",baseDC:14,description:"Swim through water"},fly:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:30,description:"Fly through the air"},persuade:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:15,description:"Persuade someone"},intimidate:{primaryAbility:"charisma",secondaryAbility:"strength",baseDC:16,description:"Intimidate someone"},deceive:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:18,description:"Deceive someone"},spot:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:12,description:"Spot hidden objects or creatures"},listen:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:10,description:"Listen for sounds"},search:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:14,description:"Search for hidden items"},pickLock:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:20,description:"Pick a lock"},disarmTrap:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:22,description:"Disarm a trap"},heal:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:16,description:"Provide medical aid"},craft:{primaryAbility:"intelligence",secondaryAbility:"dexterity",baseDC:18,description:"Craft an item"}},this.impossibleActionPatterns=[/\b(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,/\b(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,/\b(?:jump|leap)\s+(?:to|over|across)\s+(?:the\s+)?(?:moon|sky|clouds?)\b/gi,/\b(?:teleport|blink|phase)\s+(?:to|through)\b/gi,/\b(?:time\s+travel|rewind|fast\s+forward)\b/gi,/\b(?:summon|create)\s+(?:a\s+)?(?:dragon|god|demon)\b/gi,/\b(?:become|turn\s+into)\s+(?:invisible|invincible|immortal)\b/gi,/\b(?:kill|destroy|eliminate)\s+(?:the\s+)?(?:dm|dungeon\s+master|narrator)\b/gi,/\b(?:break|destroy)\s+(?:the\s+)?(?:fourth\s+wall|game|story)\b/gi,/\b(?:skip|ignore)\s+(?:the\s+)?(?:quest|mission|story)\b/gi,/\b(?:teleport|go)\s+(?:to\s+)?(?:the\s+)?(?:end|final\s+boss|treasure)\b/gi,/\b(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,/\b(?:open|unlock)\s+(?:the\s+)?(?:door|chest)\s+(?:without\s+)?(?:key|lockpick)\b/gi,/\b(?:find|locate)\s+(?:the\s+)?(?:hidden\s+)?(?:passage|door)\s+(?:without\s+)?(?:searching)\b/gi],this.circumstanceModifiers={"in darkness":-2,"in bright light":1,"in difficult terrain":-2,"on slippery surface":-3,"in water":-2,"in tight space":-1,"with cover":2,"with high ground":1,"with low ground":-1,"with proper tools":2,"with improvised tools":-1,"without tools":-3,"with magical item":1,"with masterwork item":2,"while injured":-2,"while exhausted":-3,"while hasted":2,"while blessed":1,"while cursed":-2,"while poisoned":-1,"under time pressure":-2,"with preparation":1,"with careful planning":2,"in a hurry":-2,"with authority":1,"with evidence":2,"with witnesses":-1,"in private":1,"in public":-1}}rollDie(e){return Math.floor(Math.random()*e)+1}rollDice(e,t){const r=[];for(let s=0;s<e;s++)r.push(this.rollDie(t));return r}rollWithAdvantage(){const e=this.rollDie(20),t=this.rollDie(20);return{result:Math.max(e,t),rolls:[e,t],advantage:!0}}rollWithDisadvantage(){const e=this.rollDie(20),t=this.rollDie(20);return{result:Math.min(e,t),rolls:[e,t],disadvantage:!0}}getAbilityModifier(e){return Math.floor((e-10)/2)}getProficiencyBonus(e){return Math.floor((e-1)/4)+2}performSkillCheck(e,t,r=[],s=null){const i=this.actionTypes[t];if(!i)throw new Error(`Unknown action type: ${t}`);let a=s||i.baseDC,l=0;r.forEach(v=>{this.circumstanceModifiers[v]&&(l+=this.circumstanceModifiers[v])});const c=this.getAbilityModifier(e[i.primaryAbility]||10),d=this.getAbilityModifier(e[i.secondaryAbility]||10),h=this.getProficiencyBonus(e.level||1),p=this.checkProficiency(e,t)?h:0,y=this.rollDie(20),_=y+c+p+l,T=_>=a,E=_-a;let x="failure";return T?E>=10?x="critical success":E>=5?x="great success":x="success":E<=-10?x="critical failure":E<=-5?x="great failure":x="failure",{actionType:t,roll:y,totalRoll:_,dc:a,primaryMod:c,secondaryMod:d,proficiencyMod:p,circumstanceBonus:l,isSuccess:T,degree:x,margin:E,circumstances:r,character:{name:e.name,level:e.level,[i.primaryAbility]:e[i.primaryAbility],[i.secondaryAbility]:e[i.secondaryAbility]}}}checkProficiency(e,t){const r=e.proficiencies||[],i={Fighter:["attack","dodge","parry"],Rogue:["dodge","pickLock","disarmTrap","spot","listen"],Wizard:["spell","search","craft"],Cleric:["heal","persuade","spot"],Ranger:["spot","listen","climb","swim"],Paladin:["attack","parry","persuade"],Monk:["attack","dodge","backflip","somersault","cartwheel"],Bard:["persuade","deceive","intimidate"],Druid:["heal","spot","listen"],Sorcerer:["spell","persuade"],Warlock:["spell","intimidate"],Barbarian:["attack","intimidate","jump","climb"]}[e.class]||[];return r.includes(t)||i.includes(t)}validateAction(e,t,r={}){const s=e.toLowerCase();for(const T of this.impossibleActionPatterns)if(T.test(s))return{possible:!1,reason:"This action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};let i=this.extractActionsFromDescription(s);if(i=i.filter(T=>T.type!==void 0),i.length===0)return{possible:!0,reason:"No valid action detected. Action appears to be narrative or unsupported.",suggestion:"Try a different action or rephrase your input.",actions:[],overallSuccess:!0,hasCriticalFailures:!1,criticalFailures:[]};const a=r.customContext;let l=[],c=[],d=[];a&&(a.environmentalFeatures&&(c=a.environmentalFeatures,l.push(`Environmental features: ${c.join(", ")}`)),a.npcs&&(d=a.npcs,l.push(`NPCs present: ${d.map(T=>T.name).join(", ")}`)),a.circumstances&&l.push(`Circumstances: ${a.circumstances.join(", ")}`));const h=i.map((T,E)=>{const x=Math.max(0,E*2),v=Array.isArray(T.circumstances)?[...T.circumstances]:[];x>0&&v.push(`while fatigued (action ${E+1} of ${i.length})`),c.forEach(P=>{v.includes(P)||v.push(P)}),a&&a.circumstances&&a.circumstances.forEach(P=>{v.includes(P)||v.push(P)});const S=this.performSkillCheck(t,T.type,v);return{action:T.type,description:T.description,check:S,difficulty:this.getDifficultyDescription(S.dc),position:T.position||E+1,totalInSequence:T.totalInSequence||i.length,quantity:T.quantity||1,keyword:T.keyword,isSequence:T.isSequence||!1,fatiguePenalty:x,contextModifiers:l.length>0?l:null}}),m=h.every(T=>T.check.isSuccess),p=h.filter(T=>T.check.degree==="critical failure"),y=h.filter(T=>!T.check.isSuccess);let _="";if(i.length===1)_=`Single action detected: ${h[0].description}`;else{const T=[...new Set(h.map(x=>x.action))];_=`Multiple actions detected: ${h.reduce((x,v)=>x+v.quantity,0)} total actions across ${T.length} different types`}return a&&(_+=` | Context: ${a.description.substring(0,50)}${a.description.length>50?"...":""}`),{possible:!0,actions:h,overallSuccess:m,hasCriticalFailures:p.length>0,criticalFailures:p,failures:y,totalActions:i.length,summary:_,contextInfo:a?{description:a.description,environmentalFeatures:c,npcs:d,circumstances:a.circumstances||[]}:null,suggestion:this.generateActionSuggestion(h,t)}}extractActionsFromDescription(e){var c,d;const t=[],r=e.toLowerCase(),s=[/\b(\d+)\s+(backflips?|somersaults?|cartwheels?|jumps?|leaps?|hops?)\b/gi,/\b(\d+)\s+(punches?|kicks?|strikes?|attacks?|swings?|slashes?)\b/gi,/\b(\d+)\s+(spells?|casts?|magic\s+spells?)\b/gi,/\b(\d+)\s+(dodges?|evades?|parries?|blocks?)\b/gi,/\b(\d+)\s+(climbs?|scales?|swims?)\b/gi,/\b(\d+)\s+(searches?|looks?|examines?)\b/gi,/\b(\d+)\s+(persuades?|intimidates?|deceives?)\b/gi];s.forEach(h=>{var p;let m;for(;(m=h.exec(r))!==null;){const y=parseInt(m[1]),_=m[2],T=this.mapKeywordToActionType(_);if(T)for(let E=0;E<y;E++){const x=this.extractCircumstances(e);t.push({type:T,description:((p=this.actionTypes[T])==null?void 0:p.description)||`${T} action`,circumstances:x,keyword:_,quantity:y,position:E+1,totalInSequence:y})}}}),Object.entries(this.actionTypes).forEach(([h,m])=>{this.getActionKeywords(h).forEach(y=>{if(!t.some(T=>T.type===h)&&r.includes(y)&&!s.some(E=>new RegExp(E.source.replace(/\\d\+/,"\\d+"),"gi").test(r))){const E=this.extractCircumstances(e);t.push({type:h,description:m.description,circumstances:E,keyword:y,quantity:1,position:1,totalInSequence:1})}})}),[/\b(backflip|somersault|cartwheel|jump|leap|hop)\s+(?:and\s+then\s+)?(punch|kick|strike|attack|swing|slash)\b/gi,/\b(punch|kick|strike|attack|swing|slash)\s+(?:and\s+then\s+)?(backflip|somersault|cartwheel|jump|leap|hop)\b/gi,/\b(dodge|evade|parry|block)\s+(?:and\s+then\s+)?(attack|strike|punch|kick)\b/gi,/\b(attack|strike|punch|kick)\s+(?:and\s+then\s+)?(dodge|evade|parry|block)\b/gi].forEach(h=>{var p,y;let m;for(;(m=h.exec(r))!==null;){const _=this.mapKeywordToActionType(m[1]),T=this.mapKeywordToActionType(m[2]);if(_&&T){const E=this.extractCircumstances(e);t.some(x=>x.type===_&&x.keyword===m[1])||t.push({type:_,description:((p=this.actionTypes[_])==null?void 0:p.description)||`${_} action`,circumstances:E,keyword:m[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),t.some(x=>x.type===T&&x.keyword===m[2])||t.push({type:T,description:((y=this.actionTypes[T])==null?void 0:y.description)||`${T} action`,circumstances:E,keyword:m[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}});const a=/\b(\w+)\s+and\s+(\w+)\b/gi;let l;for(;(l=a.exec(r))!==null;){const h=this.mapKeywordToActionType(l[1]),m=this.mapKeywordToActionType(l[2]);if(h&&m){const p=this.extractCircumstances(e);t.some(y=>y.type===h&&y.keyword===l[1])||t.push({type:h,description:((c=this.actionTypes[h])==null?void 0:c.description)||`${h} action`,circumstances:p,keyword:l[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),t.some(y=>y.type===m&&y.keyword===l[2])||t.push({type:m,description:((d=this.actionTypes[m])==null?void 0:d.description)||`${m} action`,circumstances:p,keyword:l[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}return t}mapKeywordToActionType(e){return{punch:"attack",punches:"attack",kick:"attack",kicks:"attack",strike:"attack",strikes:"attack",attack:"attack",attacks:"attack",swing:"attack",swings:"attack",slash:"attack",slashes:"attack",thrust:"attack",thrusts:"attack",backflip:"backflip",backflips:"backflip",somersault:"somersault",somersaults:"somersault",cartwheel:"cartwheel",cartwheels:"cartwheel",jump:"jump",jumps:"jump",leap:"jump",leaps:"jump",hop:"jump",hops:"jump",climb:"climb",climbs:"climb",scale:"climb",scales:"climb",swim:"swim",swims:"swim",dodge:"dodge",dodges:"dodge",evade:"dodge",evades:"dodge",parry:"parry",parries:"parry",block:"parry",blocks:"parry",spell:"spell",spells:"spell",cast:"spell",casts:"spell","magic spell":"spell","magic spells":"spell",persuade:"persuade",persuades:"persuade",intimidate:"intimidate",intimidates:"intimidate",deceive:"deceive",deceives:"deceive",search:"search",searches:"search",look:"search",looks:"search",examine:"search",examines:"search"}[e.toLowerCase()]}getActionKeywords(e){return{attack:["attack","strike","hit","swing","slash","thrust","punch","kick"],spell:["cast","spell","magic","enchant","charm"],dodge:["dodge","evade","avoid","sidestep"],parry:["parry","block","deflect"],backflip:["backflip","back flip"],somersault:["somersault","forward roll"],cartwheel:["cartwheel"],wallRun:["wall run","run up wall"],jump:["jump","leap","hop"],climb:["climb","scale"],swim:["swim"],fly:["fly","levitate","float"],persuade:["persuade","convince","talk into"],intimidate:["intimidate","threaten","scare"],deceive:["deceive","lie","trick"],spot:["spot","see","notice","observe"],listen:["listen","hear"],search:["search","look for","find"],pickLock:["pick lock","lockpick"],disarmTrap:["disarm","trap"],heal:["heal","cure","treat"],craft:["craft","make","create","build"]}[e]||[]}extractCircumstances(e){const t=[];return Object.keys(this.circumstanceModifiers).forEach(r=>{e.includes(r)&&t.push(r)}),t}getDifficultyDescription(e){return e<=5?"Very Easy":e<=10?"Easy":e<=15?"Medium":e<=20?"Hard":e<=25?"Very Hard":"Nearly Impossible"}generateActionSuggestion(e,t){const r=e.filter(i=>!i.check.isSuccess);return r.length===0?"All actions are within your capabilities. Proceed with confidence!":r.map(i=>{const a=i.action;return i.check.degree==="critical failure"?`The ${a} is extremely difficult for you. Consider an alternative approach or ask for help.`:`The ${a} is challenging. You might want to take your time or use better equipment.`}).join(" ")}performActionSequence(e,t,r={}){const s=[];let i=0;for(let c=0;c<t.length;c++){const d=t[c],h=Array.isArray(d.circumstances)?[...d.circumstances]:[];i>0?h.push("with momentum"):i<0&&h.push("while fatigued");const m=this.performSkillCheck(e,d.type,h);s.push({action:d.type,check:m,sequencePosition:c+1}),m.isSuccess?i+=1:i-=2}const a=s.every(c=>c.check.isSuccess),l=s.filter(c=>c.check.degree==="critical failure");return{actions:s,overallSuccess:a,hasCriticalFailures:l.length>0,criticalFailures:l,sequenceLength:t.length,finalModifier:i}}generateActionNarrative(e,t){const{actionType:r,check:s,degree:i}=e;this.actionTypes[r];const a={attack:{"critical success":`${t.name} executes a perfect ${r}, striking with incredible precision!`,"great success":`${t.name} performs an excellent ${r}, hitting the target solidly.`,success:`${t.name} successfully ${r}s the target.`,failure:`${t.name} attempts to ${r} but misses the mark.`,"great failure":`${t.name} completely fails to ${r}, leaving themselves open.`,"critical failure":`${t.name} botches the ${r} spectacularly, potentially harming themselves!`},backflip:{"critical success":`${t.name} performs a flawless backflip, landing gracefully with perfect form!`,"great success":`${t.name} executes a smooth backflip, impressing onlookers.`,success:`${t.name} manages to complete the backflip successfully.`,failure:`${t.name} attempts a backflip but loses balance and stumbles.`,"great failure":`${t.name} fails the backflip badly, landing awkwardly.`,"critical failure":`${t.name} completely fails the backflip, potentially injuring themselves!`},fly:{"critical success":`${t.name} somehow defies gravity and soars through the air with supernatural grace!`,"great success":`${t.name} manages to achieve brief flight through incredible effort!`,success:`${t.name} makes a valiant attempt at flight, achieving a brief hover.`,failure:`${t.name} tries to fly but only manages an awkward hop.`,"great failure":`${t.name} attempts flight but falls flat on their face.`,"critical failure":`${t.name} tries to fly and crashes spectacularly, looking quite foolish!`}},l=a[r]||a.attack;return l[i]||l.failure}performMultipleSkillChecks(e,t,r,s=[],i=null){var y,_,T,E;const a=[];let l=0;const c=1;for(let x=1;x<=r;x++){const v=l*c,S=[...s];l>0&&S.push(`while fatigued (attempt ${x})`);const P=this.performSkillCheck(e,t,S,i),M={...P,attemptNumber:x,fatigueLevel:l,fatiguePenalty:v,adjustedTotalRoll:P.totalRoll-v,adjustedMargin:P.totalRoll-v-P.dc,adjustedSuccess:P.totalRoll-v>=P.dc};a.push(M),l++}const d=a.filter(x=>x.adjustedSuccess).length,h=a.filter(x=>x.adjustedSuccess&&x.adjustedMargin>=10).length,m=a.filter(x=>!x.adjustedSuccess&&x.adjustedMargin<=-10).length,p=d/r*100;return{actionType:t,numberOfAttempts:r,results:a,statistics:{successfulAttempts:d,criticalSuccesses:h,criticalFailures:m,successRate:p,averageRoll:a.reduce((x,v)=>x+v.roll,0)/r,averageTotalRoll:a.reduce((x,v)=>x+v.adjustedTotalRoll,0)/r,bestRoll:Math.max(...a.map(x=>x.adjustedTotalRoll)),worstRoll:Math.min(...a.map(x=>x.adjustedTotalRoll))},character:{name:e.name,level:e.level,[(y=this.actionTypes[t])==null?void 0:y.primaryAbility]:e[(_=this.actionTypes[t])==null?void 0:_.primaryAbility],[(T=this.actionTypes[t])==null?void 0:T.secondaryAbility]:e[(E=this.actionTypes[t])==null?void 0:E.secondaryAbility]}}}performMultipleDiceRolls(e,t,r="standard"){const s=[];for(let d=1;d<=e;d++){let h;switch(r){case"advantage":h=this.rollWithAdvantage();break;case"disadvantage":h=this.rollWithDisadvantage();break;default:h={result:this.rollDie(t),rolls:[this.rollDie(t)],advantage:!1,disadvantage:!1}}s.push({...h,rollNumber:d,sides:t})}const i=s.map(d=>d.result),a=i.reduce((d,h)=>d+h,0)/e,l=Math.max(...i),c=Math.min(...i);return{numberOfRolls:e,sides:t,rollType:r,results:s,statistics:{average:a,max:l,min:c,total:i.reduce((d,h)=>d+h,0),natural20s:i.filter(d=>d===20).length,natural1s:i.filter(d=>d===1).length}}}generateMultipleAttemptsNarrative(e,t){const{actionType:r,numberOfAttempts:s,statistics:i}=e,a=this.actionTypes[r];if(!a)return`${t.name} attempts ${r} ${s} times.`;const l=i.successRate,c=i.criticalSuccesses,d=i.criticalFailures;let h=`${t.name} attempts to ${a.description} ${s} times. `;return l>=80?h+=`They perform exceptionally well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:l>=60?h+=`They perform well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:l>=40?h+=`They have mixed results, succeeding ${i.successfulAttempts} out of ${s} attempts.`:l>=20?h+=`They struggle, only succeeding ${i.successfulAttempts} out of ${s} attempts.`:h+=`They perform poorly, only succeeding ${i.successfulAttempts} out of ${s} attempts.`,c>0&&(h+=` They achieve ${c} spectacular successes!`),d>0&&(h+=` They suffer ${d} embarrassing failures.`),s>10&&(h+=" The repeated attempts take their toll, and fatigue begins to set in."),h}}class bS{constructor(){this.diceService=new xS,this.storyRules={redirectPatterns:[{pattern:/\b(?:i\s+)?(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,response:"While impressive acrobatics are possible, let's focus on actions that advance the story. What's your main goal here?",suggestion:"Try describing a more focused action that helps with the current situation."},{pattern:/\b(?:i\s+)?(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,response:"Flight isn't currently possible in this situation. What are you trying to achieve?",suggestion:"Consider climbing, jumping, or finding another way to reach your destination."},{pattern:/\b(?:i\s+)?(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,response:"The quest item isn't just lying around. You'll need to find it through exploration and investigation.",suggestion:"Try searching the area, asking NPCs, or following clues to locate the item."},{pattern:/\b(?:i\s+)?(?:attack|kill|destroy)\s+(?:everyone|all|each)\s+(?:enemy|person|creature)\b/gi,response:"While combat is possible, attacking everyone at once isn't practical. Let's focus on the immediate threat.",suggestion:"Choose a specific target or describe a more strategic approach."}],expandPatterns:[{pattern:/\b(?:i\s+)?(?:search|look|examine)\b/gi,response:"What specifically are you searching for or looking at?",suggestion:"Be more specific about what you're searching for or examining."},{pattern:/\b(?:i\s+)?(?:talk|speak|ask)\b/gi,response:"Who would you like to talk to, and what would you like to discuss?",suggestion:"Specify the person and topic of conversation."},{pattern:/\b(?:i\s+)?(?:go|move|walk)\b/gi,response:"Where would you like to go?",suggestion:"Specify your destination or direction."}],encouragePatterns:[{pattern:/\b(?:i\s+)?(?:investigate|explore|examine)\b/gi,response:"Great! Investigation and exploration are key to advancing the story.",suggestion:"What specific aspect would you like to investigate?"},{pattern:/\b(?:i\s+)?(?:help|assist|aid)\b/gi,response:"Helping others is always a noble choice. Who would you like to help?",suggestion:"Specify who needs help and how you can assist them."},{pattern:/\b(?:i\s+)?(?:negotiate|diplomacy|peace)\b/gi,response:"Diplomacy can often achieve more than violence. Good thinking!",suggestion:"How would you like to approach the negotiation?"}]},this.contextResponses={combat:{impossible:"That action isn't possible in combat. Focus on your available combat options.",difficult:"That's a challenging action in combat. Are you sure you want to attempt it?",strategic:"That's a good strategic choice. How do you want to execute it?"},exploration:{impossible:"That action doesn't make sense in this environment. What are you trying to achieve?",difficult:"That will be challenging given the current circumstances.",strategic:"That's a good approach to exploration. Let's see how it goes."},social:{impossible:"That action isn't appropriate in this social situation.",difficult:"That's a bold social move. Are you prepared for the consequences?",strategic:"That's a good approach to the situation. How do you want to proceed?"}}}validatePlayerAction(e,t,r={}){const s=e.toLowerCase(),i=this.checkImpossibleActions(s);if(!i.possible)return{valid:!1,type:"impossible",response:i.response,suggestion:i.suggestion,diceResult:null};const a=this.checkRedirectPatterns(s);if(a.needsRedirect)return{valid:!1,type:"redirect",response:a.response,suggestion:a.suggestion,diceResult:null};const l=this.checkExpandPatterns(s);if(l.needsExpansion)return{valid:!1,type:"expand",response:l.response,suggestion:l.suggestion,diceResult:null};const c=this.diceService.validateAction(e,t,r);return{valid:!0,type:"valid",response:this.generateValidationResponse(c,t,r),suggestion:c.suggestion,diceResult:c}}checkImpossibleActions(e){for(const t of this.diceService.impossibleActionPatterns)if(t.test(e))return{possible:!1,response:"That action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};return{possible:!0}}checkRedirectPatterns(e){for(const t of this.storyRules.redirectPatterns)if(t.pattern.test(e))return{needsRedirect:!0,response:t.response,suggestion:t.suggestion};return{needsRedirect:!1}}checkExpandPatterns(e){for(const t of this.storyRules.expandPatterns)if(t.pattern.test(e))return{needsExpansion:!0,response:t.response,suggestion:t.suggestion};return{needsExpansion:!1}}generateValidationResponse(e,t,r){if(!e.overallSuccess)return e.actions.filter(c=>!c.check.isSuccess).filter(c=>c.check.degree==="critical failure").length>0?`The actions you described are beyond your current capabilities. ${e.suggestion}`:`The actions you described are challenging but possible. ${e.suggestion}`;const s=this.generateAtmosphericResponse(e,t,r),i=this.extractEntities(s,r);return{story:s,entities:i}}generateAtmosphericResponse(e,t,r){const{actions:s,overallSuccess:i,hasCriticalFailures:a}=e,l=r==null?void 0:r.customContext;let c=this.getAtmosphericElements(l),d=this.calculateTensionLevel(s,a),h="";return s.length===1?h=this.generateSingleActionResponse(s[0],t,c,d):h=this.generateMultiActionResponse(s,t,c,d),l&&l.environmentalFeatures&&(h+=this.addEnvironmentalDetails(l.environmentalFeatures,d)),l&&l.npcs&&(h+=this.addNPCReactions(l.npcs,s,i)),h+=this.addStoryProgressionHook(s,d,l),h}getAtmosphericElements(e){const t={lighting:"dim",weather:"calm",mood:"neutral",tension:"low"};if(!e)return t;const r=e.description.toLowerCase();return(r.includes("dark")||r.includes("shadow"))&&(t.lighting="dark"),(r.includes("bright")||r.includes("sunlight"))&&(t.lighting="bright"),(r.includes("dim")||r.includes("flickering"))&&(t.lighting="dim"),(r.includes("storm")||r.includes("rain"))&&(t.weather="stormy"),(r.includes("fog")||r.includes("mist"))&&(t.weather="foggy"),r.includes("wind")&&(t.weather="windy"),(r.includes("tension")||r.includes("danger"))&&(t.mood="tense"),(r.includes("peaceful")||r.includes("calm"))&&(t.mood="peaceful"),(r.includes("eerie")||r.includes("creepy"))&&(t.mood="eerie"),t}calculateTensionLevel(e,t){let r="low";const s=e.filter(i=>["attack","spell","dodge","parry"].includes(i.action));return s.length>0&&(r="medium"),s.length>2&&(r="high"),t&&(r="critical"),r}generateSingleActionResponse(e,t,r,s){const{action:i,check:a,keyword:l}=e,c=a.isSuccess;a.degree;const d={attack:{success:{low:`${t.name} strikes true, the blow landing with satisfying impact.`,medium:`${t.name}'s weapon finds its mark, the strike ringing out in the ${r.lighting} light.`,high:`${t.name} delivers a devastating blow, the force of the attack echoing through the ${r.weather} air.`,critical:`${t.name} executes a perfect strike, the precision of the attack leaving no room for error.`},failure:{low:`${t.name} swings wide, the attack missing its intended target.`,medium:`${t.name}'s strike goes awry, the weapon clattering against stone or wood.`,high:`${t.name} completely misses, the failed attack leaving them momentarily vulnerable.`,critical:`${t.name} stumbles in their attack, the botched strike nearly causing them to fall.`}},backflip:{success:{low:`${t.name} executes a graceful backflip, landing softly on their feet.`,medium:`${t.name} performs an impressive backflip, the acrobatic feat drawing attention.`,high:`${t.name} completes a spectacular backflip, the display of agility leaving onlookers amazed.`,critical:`${t.name} achieves a flawless backflip, the perfect form and landing drawing gasps of admiration.`},failure:{low:`${t.name} attempts a backflip but loses balance, stumbling slightly.`,medium:`${t.name} fails the backflip, landing awkwardly and looking embarrassed.`,high:`${t.name} completely botches the backflip, falling hard to the ground.`,critical:`${t.name} crashes spectacularly during the backflip, potentially injuring themselves.`}},search:{success:{low:`${t.name} searches carefully, their trained eyes picking up subtle details.`,medium:`${t.name} conducts a thorough search, methodically examining every corner.`,high:`${t.name} performs an exhaustive search, their attention to detail revealing hidden secrets.`,critical:`${t.name} discovers something extraordinary, their keen observation uncovering a crucial clue.`},failure:{low:`${t.name} looks around but finds nothing of interest.`,medium:`${t.name} searches but misses several obvious details.`,high:`${t.name} fails to notice important clues, their search proving fruitless.`,critical:`${t.name} overlooks critical information, their poor search skills costing them dearly.`}},persuade:{success:{low:`${t.name} makes a reasonable argument, their words carrying some weight.`,medium:`${t.name} presents a compelling case, their charisma swaying the listener.`,high:`${t.name} delivers a masterful persuasion, their words impossible to ignore.`,critical:`${t.name} achieves the impossible, their silver tongue turning enemies into allies.`},failure:{low:`${t.name} tries to persuade but fails to make a convincing argument.`,medium:`${t.name}'s attempt at persuasion falls flat, their words lacking impact.`,high:`${t.name} completely fails to persuade, their poor communication skills evident.`,critical:`${t.name} not only fails to persuade but manages to offend the listener.`}}},h=d[i]||d.attack,m=c?"success":"failure",p=s==="critical"?"high":s;return h[m][p]}generateMultiActionResponse(e,t,r,s){const i=e.length,a=e.filter(c=>c.check.isSuccess).length,l=i-a;return a===i?`${t.name} executes a flawless sequence of actions, each movement flowing seamlessly into the next. The display of skill and coordination is impressive to behold.`:a>l?`${t.name} performs admirably, with most actions succeeding despite the challenging circumstances. A few missteps don't diminish the overall effectiveness.`:l>a?`${t.name} struggles with the complex sequence, many actions failing to achieve their intended results. The difficulty of the task proves overwhelming.`:`${t.name} has mixed results, with some actions succeeding while others fail. The outcome remains uncertain.`}addEnvironmentalDetails(e,t){if(e.length===0)return"";const r={dark:{low:" The darkness seems to swallow sound, making every movement feel more significant.",medium:" Shadows dance in the darkness, creating an atmosphere of uncertainty.",high:" The oppressive darkness makes every action feel more dangerous and urgent.",critical:" The pitch-black environment amplifies every sound, every movement potentially deadly."},stormy:{low:" Rain patters against surfaces, adding a rhythmic backdrop to the scene.",medium:" The storm intensifies, wind and rain making movement more challenging.",high:" The raging storm creates a chaotic environment where every action is a gamble.",critical:" The violent storm threatens to overwhelm all but the most determined efforts."},foggy:{low:" Mist swirls gently, obscuring distant details.",medium:" The fog thickens, reducing visibility and creating an eerie atmosphere.",high:" Dense fog makes navigation difficult and every shadow a potential threat.",critical:" The impenetrable fog isolates you completely, each step into the unknown."}};let s="";return e.forEach(i=>{r[i]&&(s+=r[i][t]||"")}),s}addNPCReactions(e,t,r){if(e.length===0)return"";const s=e.map(i=>i.name).join(" and ");return r?` ${s} watch with growing interest, clearly impressed by your actions.`:` ${s} exchange concerned glances, their confidence in your abilities wavering.`}addStoryProgressionHook(e,t,r){const s=e.some(l=>["attack","spell","dodge","parry"].includes(l.action)),i=e.some(l=>["search","climb","jump"].includes(l.action)),a=e.some(l=>["persuade","intimidate","deceive"].includes(l.action));return s&&t==="high"?" The tension in the air is palpable. Something is about to happen...":i?" Your investigation reveals new possibilities. What will you discover next?":a?" The social dynamics shift with your words. How will others respond?":" The situation continues to unfold. What will you do next?"}generateStoryResponse(e,t,r={}){const s=this.validatePlayerAction(e,t,r);if(!s.valid)return{response:s.response,suggestion:s.suggestion,shouldProceed:!1,diceResult:null};const i=[];return s.diceResult.actions&&s.diceResult.actions.forEach(a=>{const l=this.diceService.generateActionNarrative(a.check,t);i.push(l)}),{response:i.join(" "),suggestion:s.suggestion,shouldProceed:!0,diceResult:s.diceResult}}handleComplexAction(e,t,r={}){const s=this.diceService.extractActionsFromDescription(e.toLowerCase());if(s.length===0)return{response:"I understand your intent. Let's see how this plays out in the story.",shouldProceed:!0,type:"narrative"};if(s.length===1)return this.generateStoryResponse(e,t,r);const i=this.diceService.performActionSequence(t,s,r);return i.overallSuccess?{response:i.actions.map(l=>this.diceService.generateActionNarrative(l.check,t)).join(" "),shouldProceed:!0,type:"sequence",diceResult:i}:i.actions.filter(c=>!c.check.isSuccess).filter(c=>c.check.degree==="critical failure").length>0?{response:"The sequence of actions you described is too complex for your current abilities. Try breaking it down into simpler steps.",shouldProceed:!1,type:"sequence_failure",diceResult:i}:{response:"Some parts of your action sequence are challenging. You might want to simplify your approach.",shouldProceed:!1,type:"sequence_partial",diceResult:i}}provideAlternatives(e,t,r={}){const s=e.toLowerCase(),i=[];return(s.includes("backflip")||s.includes("somersault"))&&i.push({action:"dodge",description:"Try dodging or evading instead of acrobatics",difficulty:"easier"}),(s.includes("fly")||s.includes("levitate"))&&i.push({action:"climb",description:"Try climbing or finding another way up",difficulty:"realistic"}),s.includes("attack everyone")&&i.push({action:"focus",description:"Focus on one target at a time for better effectiveness",difficulty:"strategic"}),s.includes("grab quest item")&&i.push({action:"search",description:"Search the area thoroughly to find the item",difficulty:"appropriate"}),i}maintainStoryCoherence(e,t,r){const s={storyPhase:this.checkStoryPhase(e,t),establishedFacts:this.checkEstablishedFacts(e,t),plotAdvancement:this.checkPlotAdvancement(e,t),characterDevelopment:this.checkCharacterDevelopment(e,r)},i=Object.entries(s).filter(([a,l])=>!l.valid).map(([a,l])=>l.issue);return{coherent:i.length===0,issues:i,suggestions:this.generateCoherenceSuggestions(i,t)}}checkStoryPhase(e,t){const r=t.phase||"exploration",s=e.toLowerCase(),l=({introduction:["attack","kill","destroy"],exploration:["end quest","skip to boss"],combat:["negotiate peace","run away"],resolution:["start new quest","begin adventure"]}[r]||[]).some(c=>s.includes(c));return{valid:!l,issue:l?`This action doesn't fit the current story phase (${r})`:null}}checkEstablishedFacts(e,t){const r=t.establishedFacts||[],s=e.toLowerCase();for(const i of r)if(i.contradicts&&i.contradicts.some(a=>s.includes(a.toLowerCase())))return{valid:!1,issue:`This action contradicts established story facts: ${i.description}`};return{valid:!0}}checkPlotAdvancement(e,t){const r=t.plotPoints||[],s=e.toLowerCase(),i=r.find(a=>a.active);return i&&i.keywords&&!i.keywords.some(l=>s.includes(l.toLowerCase()))?{valid:!1,issue:"This action doesn't address the current plot point"}:{valid:!0}}checkCharacterDevelopment(e,t){const r=t.alignment||"Neutral",s=e.toLowerCase(),l=({"Lawful Good":["steal","deceive","harm innocent"],"Chaotic Evil":["help others","follow rules","show mercy"],"Neutral Good":["harm innocent","betray allies"],"Lawful Evil":["break laws","show mercy","help weak"],"Chaotic Good":["follow strict rules","harm innocent"],"True Neutral":["take extreme actions","show strong emotions"],"Lawful Neutral":["break laws","show mercy","act chaotically"],"Neutral Evil":["help others","follow laws","show mercy"],"Chaotic Neutral":["follow strict rules","show strong loyalty"]}[r]||[]).some(c=>s.includes(c));return{valid:!l,issue:l?`This action doesn't align with your character's alignment (${r})`:null}}generateCoherenceSuggestions(e,t){const r=[];return e.forEach(s=>{s.includes("story phase")?r.push("Consider actions that fit the current phase of the story."):s.includes("established facts")?r.push("Remember what has already been established in the story."):s.includes("plot point")?r.push("Focus on actions that advance the current plot."):s.includes("alignment")&&r.push("Consider actions that align with your character's moral compass.")}),r}extractEntities(e,t={}){const r={enemies:[],items:[],locations:[],statusEffects:[],questHooks:[],npcs:[]};return e.toLowerCase(),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:the\s+)?(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster|boss|mini-boss)/gi,/\b(goblin|orc|troll|dragon|bandit|skeleton|zombie|ghost|spirit|demon|devil|fiend|beast|creature|monster)\b/gi,/(?:mini-boss|boss)\s*[-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/\[Combat\s+Trigger[^]]*[-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\]/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.enemies.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.enemies.push({name:p,type:"enemy",subtype:this.determineEnemySubtype(p,e),status:this.determineEnemyStatus(p,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:of\s+[A-Z][a-z]+)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:sword|dagger|staff|wand|scroll|potion|ring|amulet|crown|robe|armor|shield)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cursed|forbidden|ancient|legendary)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.items.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.items.push({name:p,type:"item",subtype:this.determineItemSubtype(p,e),status:this.determineItemStatus(p,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:shrine|temple|castle|tower|dungeon|cave|tunnel|chamber|room|hall|garden|forest|mountain|river|lake|ocean|tavern|inn)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cliffs|beach|island|valley|peak|summit|depths|heights)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.locations.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.locations.push({name:p,type:"location",subtype:this.determineLocationSubtype(p,e),tags:this.determineLocationTags(p,e)})}}),[/(?:cursed|blessed|enchanted|poisoned|paralyzed|charmed|frightened|invisible|ethereal|ethereal|flying|levitating)/gi,/(?:in\s+darkness|in\s+bright\s+light|under\s+pressure|in\s+a\s+hurry|carefully|stealthily|aggressively|defensively)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[0];p&&!r.statusEffects.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.statusEffects.push({name:p,type:"status_effect",effect:this.determineStatusEffect(p,e)})}}),[/(?:break|destroy|find|retrieve|defeat|save|protect|escort|investigate|explore)\s+(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/(?:quest|mission|objective|goal|task|duty|responsibility)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.questHooks.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.questHooks.push({name:p,type:"quest_hook",objective:this.determineQuestObjective(p,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:merchant|trader|noble|lord|lady|king|queen|prince|princess|mayor|priest|shaman|hunter|fisherman|farmer)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:quest\s+giver|guide|mentor|teacher|master)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.npcs.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.npcs.push({name:p,type:"npc",role:this.determineNPCRole(p,e),disposition:"friendly"})}}),r}determineEnemySubtype(e,t){t.toLowerCase();const r=e.toLowerCase();return r.includes("boss")||r.includes("mini-boss")?"boss":r.includes("priest")||r.includes("cleric")?"priest":r.includes("wizard")||r.includes("mage")?"wizard":r.includes("dragon")?"dragon":r.includes("undead")||r.includes("skeleton")||r.includes("zombie")?"undead":r.includes("goblin")||r.includes("orc")||r.includes("troll")?"monster":"enemy"}determineEnemyStatus(e,t){const r=t.toLowerCase();return r.includes("snarls")||r.includes("aggressive")?"hostile":r.includes("defensive")||r.includes("cautious")?"defensive":r.includes("chanting")||r.includes("casting")?"casting":"active"}determineItemSubtype(e,t){const r=e.toLowerCase();return r.includes("sword")||r.includes("dagger")||r.includes("staff")?"weapon":r.includes("potion")||r.includes("scroll")?"consumable":r.includes("ring")||r.includes("amulet")||r.includes("crown")?"accessory":r.includes("armor")||r.includes("robe")||r.includes("shield")?"armor":"item"}determineItemStatus(e,t){const r=t.toLowerCase(),s=e.toLowerCase();return s.includes("cursed")||r.includes("cursed")?"cursed":s.includes("forbidden")||r.includes("forbidden")?"forbidden":s.includes("ancient")||r.includes("ancient")?"ancient":s.includes("legendary")||r.includes("legendary")?"legendary":r.includes("magical")||r.includes("enchanted")?"magical":"normal"}determineLocationSubtype(e,t){const r=e.toLowerCase();return r.includes("shrine")||r.includes("temple")?"religious":r.includes("castle")||r.includes("tower")?"fortification":r.includes("cave")||r.includes("tunnel")?"underground":r.includes("forest")||r.includes("garden")?"natural":r.includes("tavern")||r.includes("inn")?"settlement":"location"}determineLocationTags(e,t){const r=[],s=t.toLowerCase();return(s.includes("ancient")||s.includes("old"))&&r.push("ancient"),(s.includes("dangerous")||s.includes("hostile"))&&r.push("dangerous"),(s.includes("sacred")||s.includes("holy"))&&r.push("sacred"),(s.includes("cursed")||s.includes("evil"))&&r.push("cursed"),(s.includes("coastal")||s.includes("ocean"))&&r.push("coastal"),(s.includes("mountain")||s.includes("high"))&&r.push("mountainous"),r}determineStatusEffect(e,t){const r=e.toLowerCase();return r.includes("cursed")?"disables healing":r.includes("poisoned")?"damage over time":r.includes("paralyzed")?"prevents movement":r.includes("charmed")?"mind control":r.includes("invisible")?"stealth bonus":r.includes("flying")?"flight ability":"unknown effect"}determineQuestObjective(e,t){const r=e.toLowerCase();return r.includes("break")||r.includes("destroy")?"destruction":r.includes("find")||r.includes("retrieve")?"retrieval":r.includes("defeat")||r.includes("kill")?"combat":r.includes("save")||r.includes("protect")?"protection":r.includes("escort")?"escort":r.includes("investigate")||r.includes("explore")?"exploration":"objective"}determineNPCRole(e,t){const r=e.toLowerCase();return r.includes("merchant")||r.includes("trader")?"merchant":r.includes("noble")||r.includes("lord")||r.includes("lady")?"noble":r.includes("king")||r.includes("queen")?"royalty":r.includes("priest")||r.includes("shaman")?"religious":r.includes("quest giver")||r.includes("guide")?"quest_giver":"npc"}}const DV=new bS,MV="https://dnd-v1-backend.onrender.com",Vn=async(n,e="gpt-4",t=1e3,r=.8)=>{try{const s=n.filter(l=>!l||typeof l!="object"?(console.warn("Invalid message object:",l),!1):!l.role||!l.content?(console.warn("Message missing role or content:",l),!1):!0);if(s.length===0)throw new Error("No valid messages to send to API");const i=await fetch(`${MV}/api/openai`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:s,model:e,max_tokens:t,temperature:r})});if(!i.ok){let l="Backend API request failed";try{l=(await i.json()).error||l}catch{l=`${i.status}: ${i.statusText}`}throw i.status===500?l=`AI service error: ${l}. This might be due to missing API key, rate limiting, or network issues.`:i.status===404?l="AI service endpoint not found. Please check the backend configuration.":i.status===503&&(l="AI service temporarily unavailable. Please try again later."),new Error(l)}return await i.json()}catch(s){throw console.error("Backend API Error:",s),new Error(`Failed to communicate with backend: ${s.message}`)}};class VV{constructor(){this.systemPrompt=`You are an experienced Dungeon Master for Dungeons & Dragons 5th Edition. You excel at:
- Creating engaging storylines and plot hooks
- Developing detailed character descriptions and backstories
- Generating multiple story options when specifically requested
- Providing atmospheric descriptions and immersive storytelling
- Balancing combat encounters and managing game mechanics
- Creating memorable NPCs and villains
- Adapting to player choices and creating dynamic narratives
- Maintaining story consistency and character development
- Building upon established relationships and plot threads

IMPORTANT: Only generate multiple options when explicitly requested. When asked to generate a single story introduction, campaign goal, or other content, provide ONLY ONE response.

Always respond in character as a Dungeon Master, providing rich, descriptive content that enhances the gaming experience. Maintain consistency with previous story elements, character relationships, and established plot threads.`,this.diceService=new xS,this.actionValidationService=new bS,this.combatService=new vS}async generateStoryPlots(e,t="",r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class} (${c.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 3 different story plot options for a D&D campaign.

Party Composition: ${s}${i}
Campaign Setting: ${t||"Generic fantasy world"}

IMPORTANT: You MUST format your response EXACTLY as follows for each plot option:

**Plot Option 1:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

**Plot Option 2:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

**Plot Option 3:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

Guidelines for the plots:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

CRITICAL: Do not deviate from this exact format. Each plot must start with "**Plot Option X:**" and use the numbered format exactly as shown above.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1e3,.8)).choices[0].message.content}catch(s){throw new Error(`Failed to generate story plots: ${s.message}`)}}async generateCharacterDetails(e){try{const t=`As a Dungeon Master, I need you to expand on this character's details and create a rich, detailed description.

Character: ${e.name} - Level ${e.level} ${e.race} ${e.class}
Background: ${e.background}
Alignment: ${e.alignment}
Personality: ${e.personality||"Not specified"}
Ideals: ${e.ideals||"Not specified"}
Bonds: ${e.bonds||"Not specified"}
Flaws: ${e.flaws||"Not specified"}
Backstory: ${e.backstory||"Not specified"}

Please provide:
1. A detailed physical description (appearance, mannerisms, distinctive features)
2. An expanded personality profile with quirks and habits
3. A deeper backstory with key events and relationships
4. Character motivations and goals
5. Potential story hooks and plot threads related to this character
6. How this character might interact with the party and world

Make the character feel alive and three-dimensional, with details that could drive story development.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:t}],"gpt-4",800,.7)).choices[0].message.content}catch(t){throw console.error("Error generating character details:",t),new Error(`Failed to generate character details: ${t.message}`)}}async generateStorySummary(e,t){try{const r=t.map(a=>`${a.name} (${a.race} ${a.class})`).join(", "),s=`As a Dungeon Master, I need you to create a detailed story summary and outline for this campaign plot.

Plot: ${e}
Party: ${r}

Please provide:
1. A detailed campaign overview (3-4 paragraphs)
2. Key story beats and major events
3. Important NPCs and their roles
4. Potential challenges and obstacles
5. Story themes and motifs
6. How each party member might be personally invested
7. Potential branching paths and player choices
8. Climactic moments and resolution possibilities

Make this feel like a professional campaign module with rich storytelling potential.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:s}],"gpt-4",1200,.7)).choices[0].message.content}catch(r){throw console.error("Error generating story summary:",r),new Error(`Failed to generate story summary: ${r.message}`)}}async generateMultipleStoryPlots(e,t="",r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class} (${c.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 5 different story plot options for a D&D campaign, each with a detailed summary.

Party Composition: ${s}${i}
Campaign Setting: ${t||"Generic fantasy world"}

For each of the 5 plot options, provide:
1. A compelling title
2. A detailed summary (3-4 paragraphs)
3. The main conflict or challenge
4. Key story beats and major events
5. Important NPCs and their roles
6. Potential story hooks for the party
7. Estimated campaign length (short, medium, or long)
8. Themes and motifs
9. How each party member might be personally invested

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options. Number each plot clearly (Plot 1, Plot 2, etc.).`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1500,.8)).choices[0].message.content}catch(s){throw console.error("Error generating multiple story plots:",s),new Error(`Failed to generate multiple story plots: ${s.message}`)}}async generateNPC(e,t=""){try{const r=`As a Dungeon Master, I need you to create a detailed NPC for this role and context.

NPC Role: ${e}
Context: ${t||"General campaign context"}

Please provide:
1. A detailed physical description
2. Personality traits and mannerisms
3. Background and motivations
4. Current situation and goals
5. How they might interact with the party
6. Potential story hooks or plot threads they could introduce
7. Their relationship to the world and other NPCs
8. Any secrets or hidden aspects of their character

Make this NPC feel like a real person with depth and complexity.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:r}],"gpt-4",800,.7)).choices[0].message.content}catch(r){throw console.error("Error generating NPC:",r),new Error(`Failed to generate NPC: ${r.message}`)}}async generateCombatEncounter(e,t,r="medium",s=""){try{const i=`As a Dungeon Master, I need you to create a detailed combat encounter.

Party Level: ${e}
Party Size: ${t}
Difficulty: ${r}
Theme: ${s||"General fantasy"}

Please provide:
1. A detailed description of the encounter location
2. Enemy types and their motivations
3. Tactical considerations and terrain features
4. Potential story elements or plot hooks
5. Non-combat resolution options
6. Consequences of victory or defeat
7. Environmental hazards or advantages
8. How this encounter fits into the larger story

Make this encounter feel meaningful and story-driven, not just a random fight.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:i}],"gpt-4",800,.7)).choices[0].message.content}catch(i){throw console.error("Error generating combat encounter:",i),new Error(`Failed to generate combat encounter: ${i.message}`)}}async generateStoryContinuation(e,t,r,s=null,i="individual",a=null){var l,c,d,h,m;try{const p=e.map(M=>`${M.name} - Level ${M.level} ${M.race} ${M.class}`).join(", ");let y=null,_=null,T="";if(i==="individual"){const M=e[e.length-1];if(M)if(y=this.actionValidationService.validatePlayerAction(r,M,{context:"story",storyState:s}),y.valid&&y.diceResult){if(_=y.diceResult,_.overallSuccess){if(T=`

ACTION VALIDATION: The action is within your character's capabilities.`,_.actions){const $=_.actions.map(I=>`${I.action}: ${I.check.isSuccess?"Success":"Failure"} (Roll: ${I.check.roll}, DC: ${I.check.dc})`).join(", ");T+=`
Dice Results: ${$}`}}else if(T=`

ACTION VALIDATION: Some aspects of this action are challenging for your character.`,_.actions){const I=_.actions.filter(b=>!b.check.isSuccess).map(b=>`${b.action}: Failure (Roll: ${b.check.roll}, DC: ${b.check.dc})`).join(", ");T+=`
Failed Actions: ${I}`}}else y.valid||(T=`

ACTION VALIDATION: ${y.response}`,y.suggestion&&(T+=`
Suggestion: ${y.suggestion}`))}const E=t.map(M=>({role:M.role,content:M.content}));let x="";a&&(x=`
Party Theme: ${a.description||"No theme provided"}`);let v="";s&&(v=`
STORY STATE CONTEXT:
Current Location: ${((l=s.currentLocation)==null?void 0:l.name)||"Unknown"} - ${((c=s.currentLocation)==null?void 0:c.description)||""}
Active NPCs: ${Object.keys(s.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((d=s.activePlotThreads)==null?void 0:d.map(M=>`${M.title} (${Math.round(M.progress*100)}%)`).join(", "))||"None"}
Recent Events: ${((m=(h=s.worldState)==null?void 0:h.recentEvents)==null?void 0:m.slice(-3).map(M=>M.event).join(", "))||"None"}

CHARACTER RELATIONSHIPS:
${e.map(M=>{var b;const $=((b=s.characterArcs)==null?void 0:b[M.id])||{},I=Object.entries($.relationships||{}).map(([C,N])=>`${C} (${N})`).join(", ");return`${M.name}: ${I||"No established relationships"}`}).join(`
`)}

NPC CONTEXT:
${Object.entries(s.activeNPCs||{}).map(([M,$])=>{var I;return`${M}: ${$.disposition} disposition, knowledge: ${((I=$.knowledge)==null?void 0:I.join(", "))||"none"}, goal: ${$.currentGoal||"unknown"}`}).join(`
`)}`);const S=`As a Dungeon Master, continue the story based on the player's response.

Party: ${p}${x}
Player Response: "${r}" (Type: ${i})
Response Type Context:
- individual: One character's personal action
- team: Group action or decision
- investigate: Looking for clues or information
- combat: Combat-related action
- social: Social interaction or diplomacy${v}

Previous Story Context:
${E.map(M=>`${M.role==="assistant"?"DM":"Player"}: ${M.content}`).join(`
`)}

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

ACTION VALIDATION GUIDELINES:
- If the action validation shows the action is impossible, gently redirect the player while maintaining story flow
- If the action validation shows the action is challenging, incorporate the difficulty into the narrative
- If the action validation shows the action is successful, proceed with the action as described
- Always maintain story coherence and character consistency
- Use the validation results to inform how the action plays out in the story

Please provide a compelling continuation that:
1. Acknowledges the player's action in context of the current situation and location
2. References relevant NPCs and their established relationships with the party
3. Continues or advances active plot threads appropriately
4. Updates character relationships based on the action
5. Maintains location and atmosphere consistency
6. Ends with a clear situation that invites the next player to respond
7. Encourages character interaction and roleplay
8. Provides multiple possible directions for the party to explore
9. Builds upon the established story state and character development
10. Incorporates action validation results naturally into the narrative

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.${T}`;return{content:(await Vn([{role:"system",content:this.systemPrompt},...E,{role:"user",content:S}],"gpt-4",800,.8)).choices[0].message.content,actionValidation:y,diceResult:_}}catch(p){throw console.error("Error generating story continuation:",p),new Error(`Failed to generate story continuation: ${p.message}`)}}async generatePlotOptions(e,t=null){try{const r=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class}. ${c.personality||""}. ${c.backstory||""}`).join(`
`);let s="";t&&(s=`
Party Theme: ${t.description||"No theme provided"}`);const i="You are a Dungeon Master for D&D 5e. You MUST generate exactly 3 plot options, no more, no less. Follow the exact format provided. Do not use party names in the plots. Keep summaries brief (1-2 sentences maximum). DO NOT repeat plots or generate duplicates.",a=`Generate exactly 3 distinct campaign plot options for this party. 

REQUIRED FORMAT - Follow this exact structure:

Plot 1: [Title]
[Brief summary - 1-2 sentences maximum]

Plot 2: [Title]  
[Brief summary - 1-2 sentences maximum]

Plot 3: [Title]
[Brief summary - 1-2 sentences maximum]

Party: ${r}${s}

CRITICAL REQUIREMENTS:
- Generate EXACTLY 3 plots, no more, no less
- Use the party theme to influence the plot lines and atmosphere
- Do NOT use the party name in the plots - focus on the characters and theme
- Each summary must be 1-2 sentences maximum
- Follow the exact format above with "Plot 1:", "Plot 2:", "Plot 3:" labels
- Do not add any additional text, explanations, or formatting
- Do not repeat or duplicate any plots
- Stop after Plot 3 - do not generate more plots

Make each plot distinct and appealing to different play styles.`;return(await Vn([{role:"system",content:i},{role:"user",content:a}],"gpt-4",600,.8)).choices[0].message.content}catch(r){throw console.error("Error generating plot options:",r),new Error(`Failed to generate plot options: ${r.message}`)}}async generateStoryIntroduction(e,t,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}. ${d.personality||""}. ${d.backstory||""}`).join(`
`);let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create an engaging story introduction for the beginning of this campaign.

Party: ${i}${a}
Selected Plot: ${t}
Plot Number: ${r}

IMPORTANT: Generate ONLY ONE story introduction for the selected plot above. Do NOT generate introductions for multiple plots or options.

Create an introduction that includes:
1. A vivid description of the starting town/settlement where the party begins
2. How each character arrives or is already present in this location
3. The initial situation or hook that draws the party together
4. A sense of atmosphere and setting that matches the chosen plot
5. An opening scene that gives the party their first decision or action to take

Important Guidelines:
- Use the party theme to influence the atmosphere and context
- Incorporate themes and elements from the party theme to create atmosphere and context
- Consider how the party's background and composition might influence the starting situation
- Focus on the characters and their individual stories
- The story should feel cohesive with the established theme
- Generate ONLY ONE introduction for the selected plot

Make this feel like the opening of an epic adventure. Set the tone, establish the setting, and give the party a clear starting point. End with a situation that requires the party to make a choice or take action.

Keep the introduction engaging but concise (3-4 paragraphs maximum).`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",800,.8)).choices[0].message.content}catch(i){throw console.error("Error generating story introduction:",i),new Error(`Failed to generate story introduction: ${i.message}`)}}async generateStructuredStoryResponse(e,t,r,s,i,a=null,l=null){var c,d,h;try{const m=e.map(v=>`${v.name} - Level ${v.level} ${v.race} ${v.class}`).join(", "),p=t.filter(v=>v&&typeof v=="object"&&v.role&&v.content).map(v=>({role:v.role,content:v.content}));let y="";l&&(y=`
Party Theme: ${l.description||"No theme provided"}`);const _=i.length>0?`
Discovered Objectives: ${i.map(v=>v.title).join(", ")}`:"";let T="";a&&(T=`
STORY STATE CONTEXT:
Current Location: ${((c=a.currentLocation)==null?void 0:c.name)||"Unknown"} - ${((d=a.currentLocation)==null?void 0:d.description)||""}
Active NPCs: ${Object.keys(a.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((h=a.activePlotThreads)==null?void 0:h.map(v=>`${v.title} (${Math.round(v.progress*100)}%)`).join(", "))||"None"}
Character Relationships: ${Object.entries(a.characterArcs||{}).map(([v,S])=>{const P=e.find(M=>M.id===v);return`${P==null?void 0:P.name}: ${Object.entries(S.relationships||{}).map(([M,$])=>`${M} (${$})`).join(", ")||"No relationships"}`}).join("; ")}`);const E=`As a Dungeon Master, continue the story based on the player's response, considering the current story phase and discovered objectives.

Party: ${m}${y}
Current Phase: ${s}
Player Response: "${r}"${_}${T}

Story Phases:
- Investigation: Focus on discovery, clues, and gathering information
- Conflict: Focus on tension, threats, and potential combat
- Resolution: Focus on choices, consequences, and story conclusion

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

ENEMY INFORMATION REQUIREMENTS (when in Conflict phase):
If the story involves combat or enemies, provide detailed enemy information in the following format:

**ENEMY_DETAILS:**
[For each enemy present, provide:]
Name: [Enemy name if humanoid, or descriptive name like "Alpha Wolf"]
Type: [Enemy type: humanoid, beast, undead, etc.]
Level: [Enemy level relative to party]
HP: [Hit points]
AC: [Armor class]
Basic Attack: [Description of basic attack and damage]
Special Ability: [Description of special ability or attack]
Stats: [Brief description of key stats like "Strong and aggressive" or "Quick and stealthy"]

IMPORTANT: You MUST format your response EXACTLY as follows:

**STORY_CONTENT:**
[Your main story continuation here - 2-3 paragraphs that acknowledge the player's action, continue the plot, and set up the next situation]

**CURRENT_LOCATION:**
[Updated location description or "No change" if location remains the same]

**ACTIVE_NPCS:**
[List of NPCs currently present or relevant to the scene, separated by commas]

**PLOT_DEVELOPMENTS:**
[Key plot developments or revelations from this response]

**CHARACTER_REACTIONS:**
[How NPCs react to the player's action, if applicable]

**NEXT_ACTIONS:**
[2-3 clear options or directions the party can take next]

**STORY_TONE:**
[The current mood/atmosphere: tense, mysterious, hopeful, dangerous, etc.]

**PHASE_STATUS:**
[Current story phase: investigation, conflict, or resolution]

**ENEMY_DETAILS:** (only include if enemies are present)
[Detailed enemy information as specified above]

Keep your response engaging but concise. Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.`;return(await Vn([{role:"system",content:this.systemPrompt},...p,{role:"user",content:E}],"gpt-4",1e3,.8)).choices[0].message.content}catch(m){throw console.error("Error generating structured story response:",m),new Error(`Failed to generate structured story response: ${m.message}`)}}async generatePhaseTransition(e,t,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create a phase transition message for the story.

Party: ${i}${a}
Current Phase: ${t}
Story Progress: ${r}

Create a transition that:
1. Acknowledges the progress made so far
2. Signals the shift to the new phase
3. Sets up the new challenges and opportunities
4. Maintains the established tone and atmosphere
5. Gives the party clear direction for the next phase

Make this feel like a natural progression in the story.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating phase transition:",i),new Error(`Failed to generate phase transition: ${i.message}`)}}async generateObjectiveCompletion(e,t,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create a completion message for an objective.

Party: ${i}${a}
Completed Objective: ${t.title}
Story Context: ${r}

Create a completion message that:
1. Celebrates the achievement
2. Provides closure for this objective
3. Sets up the next challenge or objective
4. Maintains story momentum
5. Acknowledges the party's efforts

Make this feel rewarding and meaningful.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating objective completion:",i),new Error(`Failed to generate objective completion: ${i.message}`)}}async generateCampaignContinuation(e,t,r,s,i=null){try{const a=e.map(m=>`${m.name} - Level ${m.level} ${m.race} ${m.class}`).join(", "),l=r.filter(m=>m&&typeof m=="object"&&m.role&&m.content).map(m=>({role:m.role,content:m.content}));let c="";i&&(c=`
Party Theme: ${i.description||"No theme provided"}`);const d=`As a Dungeon Master, continue the ongoing campaign story.

Party: ${a}${c}
Campaign Goal: ${t.mainGoal||"No specific goal"}
Campaign Progress: ${t.campaignProgress||"Beginning"}
Player Response: "${s}"

Previous Story Context:
${l.map(m=>`${m.role==="assistant"?"DM":"Player"}: ${m.content}`).join(`
`)}

Continue the story while:
1. Building toward the main campaign goal
2. Maintaining consistency with previous events
3. Developing character relationships and arcs
4. Creating meaningful choices and consequences
5. Advancing the overall plot

Keep your response engaging but concise (2-3 paragraphs maximum).`;return(await Vn([{role:"system",content:this.systemPrompt},...l,{role:"user",content:d}],"gpt-4",800,.8)).choices[0].message.content}catch(a){throw console.error("Error generating campaign continuation:",a),new Error(`Failed to generate campaign continuation: ${a.message}`)}}async generateCampaignGoal(e,t,r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class}`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, create a clear campaign goal based on the selected plot.

Party: ${s}${i}
Selected Plot: ${t}

IMPORTANT: Generate ONLY ONE campaign goal for the selected plot above. Do NOT generate multiple goals or options.

Create a campaign goal that:
1. Is clear and achievable
2. Provides direction for the entire campaign
3. Involves all party members
4. Has multiple possible paths to completion
5. Creates meaningful stakes and consequences
6. Is specific to the selected plot only

Make this goal compelling and motivating for the party. Generate ONLY ONE goal.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",600,.7)).choices[0].message.content}catch(s){throw console.error("Error generating campaign goal:",s),new Error(`Failed to generate campaign goal: ${s.message}`)}}async generateSessionSummary(e,t,r,s,i=null){try{const a=s.map(h=>`${h.name} - Level ${h.level} ${h.race} ${h.class}`).join(", ");let l="";i&&(l=`
Party Theme: ${i.description||"No theme provided"}`);const c=`As a Dungeon Master, create a session summary for this campaign session.

Party: ${a}${l}
Campaign Goal: ${e.mainGoal||"No specific goal"}
Objectives: ${r.map(h=>h.title).join(", ")}
Story Messages: ${t.length} total messages

Create a summary that:
1. Recaps the major events of the session
2. Highlights character development and relationships
3. Notes progress toward objectives
4. Sets up expectations for the next session
5. Maintains the established tone and atmosphere

Make this summary engaging and informative.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:c}],"gpt-4",800,.7)).choices[0].message.content}catch(a){throw console.error("Error generating session summary:",a),new Error(`Failed to generate session summary: ${a.message}`)}}}const Au=new VV;function LV({validation:n,onClose:e,onProceed:t,onRevise:r}){const[s,i]=A.useState(!1),[a,l]=A.useState(!1),[c,d]=A.useState(null);if(A.useEffect(()=>{if(n!=null&&n.diceResult){i(!0),l(!0);const p=setTimeout(()=>{l(!1),d(n.diceResult)},2e3);return()=>clearTimeout(p)}},[n]),!n)return null;const h=(p,y)=>y==="critical success"?"text-green-800 bg-green-200 border-green-400":y==="great success"?"text-green-700 bg-green-100 border-green-300":y==="success"?"text-green-600 bg-green-50 border-green-200":y==="failure"?"text-red-600 bg-red-50 border-red-200":y==="great failure"?"text-red-700 bg-red-100 border-red-300":y==="critical failure"?"text-red-800 bg-red-200 border-red-400":p?"text-green-600 bg-green-100 border-green-300":"text-red-600 bg-red-100 border-red-300",m=()=>n.diceResult?o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-gradient-to-br from-amber-900 to-amber-800 rounded-2xl p-8 max-w-2xl w-full mx-4 border-4 border-amber-600 shadow-2xl",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"text-amber-200 text-lg font-bold mb-2",children:" THE DICE HAVE BEEN CAST "}),o.jsx("div",{className:"text-amber-300 text-sm",children:"The fate of your party hangs in the balance..."})]}),o.jsxs("div",{className:"bg-amber-950/50 rounded-lg p-4 mb-6 border border-amber-500",children:[o.jsx("div",{className:"text-amber-200 font-bold text-lg mb-2",children:"Your Action"}),o.jsx("div",{className:"text-amber-100 text-sm",children:n.diceResult.actions?n.diceResult.actions.map((p,y)=>o.jsxs("div",{className:"mb-2",children:[o.jsx("span",{className:"font-semibold capitalize",children:p.action}),o.jsxs("span",{className:"text-amber-300",children:[": ",p.description]})]},y)).join(""):"Rolling the dice..."})]}),a?o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"text-6xl mb-4 animate-bounce",children:""}),o.jsx("div",{className:"text-amber-200 text-xl font-bold mb-2",children:"Rolling..."}),o.jsx("div",{className:"text-amber-300 text-sm",children:"The dice tumble across the table"})]}):o.jsxs("div",{className:"space-y-4",children:[n.diceResult.actions?n.diceResult.actions.map((p,y)=>o.jsxs("div",{className:`rounded-lg p-4 border-2 ${h(p.check.isSuccess,p.check.degree)}`,children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("div",{className:"text-lg font-bold capitalize",children:p.action}),o.jsx("div",{className:"text-2xl font-bold",children:p.check.degree?p.check.degree.replace("_"," ").toUpperCase():p.check.isSuccess?"SUCCESS":"FAILURE"})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center mb-3",children:[o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"ROLL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:p.check.roll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"TOTAL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:p.check.totalRoll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"DC"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:p.check.dc})]})]}),o.jsx("div",{className:"text-sm text-amber-200",children:p.description})]},y)):o.jsxs("div",{className:`rounded-lg p-6 border-2 text-center ${h(n.diceResult.isSuccess)}`,children:[o.jsx("div",{className:"text-2xl font-bold mb-4",children:n.diceResult.isSuccess?"SUCCESS!":"FAILURE!"}),o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"ROLL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:n.diceResult.roll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"TOTAL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:n.diceResult.totalRoll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"DC"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:n.diceResult.dc})]})]})]}),n.diceResult.overallSuccess!==void 0&&o.jsxs("div",{className:`rounded-lg p-4 border-2 text-center ${n.diceResult.overallSuccess?"border-green-400 bg-green-900/50":"border-red-400 bg-red-900/50"}`,children:[o.jsx("div",{className:"text-xl font-bold mb-2",children:n.diceResult.overallSuccess?" MISSION ACCOMPLISHED! ":" THE DICE HAVE SPOKEN... "}),o.jsx("div",{className:"text-sm",children:n.diceResult.overallSuccess?"Your party's combined efforts have succeeded!":"The challenge has proven too great this time..."})]})]}),!a&&o.jsxs("div",{className:"bg-amber-950/50 rounded-lg p-4 mt-6 border border-amber-500",children:[o.jsx("div",{className:"text-amber-200 font-bold mb-2",children:" Dungeon Master's Commentary"}),o.jsx("div",{className:"text-amber-100 text-sm italic",children:typeof n.response=="string"?n.response:n.response.story})]}),!a&&o.jsxs("div",{className:"mt-6 flex justify-center space-x-4",children:[n.type==="valid"?o.jsx("button",{onClick:t,className:"fantasy-button bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:" PROCEED WITH FATE"}):o.jsx("button",{onClick:r,className:"fantasy-button bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:" TRY AGAIN"}),o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:" CANCEL"})]})]})}):null;return s?m():o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-gradient-to-br from-stone-800 to-stone-900 rounded-lg p-6 max-w-2xl w-full mx-4 border-2 border-stone-600 shadow-xl",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-stone-200",children:" Action Validation"}),o.jsx("button",{onClick:e,className:"text-stone-400 hover:text-stone-200 text-xl",children:""})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"p-4 bg-stone-700 rounded-lg border border-stone-600",children:[o.jsx("h4",{className:"font-semibold text-stone-200 mb-2",children:" Dungeon Master's Response"}),o.jsx("div",{className:"text-stone-300 italic leading-relaxed",children:typeof n.response=="string"?n.response:n.response.story})]}),n.suggestion&&o.jsxs("div",{className:"p-4 bg-blue-900/50 rounded-lg border border-blue-600",children:[o.jsx("h4",{className:"font-semibold text-blue-200 mb-2",children:" Suggestion"}),o.jsx("p",{className:"text-blue-100",children:n.suggestion})]}),n.type!=="valid"&&o.jsxs("div",{className:"p-4 bg-purple-900/50 rounded-lg border border-purple-600",children:[o.jsx("h4",{className:"font-semibold text-purple-200 mb-2",children:" Alternative Approaches"}),o.jsxs("ul",{className:"text-purple-100 text-sm space-y-1",children:[o.jsx("li",{children:" Try a more focused, single action"}),o.jsx("li",{children:" Consider your character's abilities and limitations"}),o.jsx("li",{children:" Think about what would be realistic in this situation"}),o.jsx("li",{children:" Ask for clarification about what you're trying to achieve"})]})]})]}),o.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[n.type==="valid"?o.jsx("button",{onClick:t,className:"fantasy-button bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold",children:"Proceed with Action"}):o.jsx("button",{onClick:r,className:"fantasy-button bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-bold",children:"Revise Action"}),o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700 text-white px-4 py-2 rounded font-bold",children:"Cancel"})]})]})})}function OV({diceResult:n,onClose:e}){if(!n)return null;const t=s=>{switch(s){case"critical success":return"text-green-600 bg-green-100";case"great success":return"text-green-700 bg-green-50";case"success":return"text-blue-600 bg-blue-100";case"failure":return"text-yellow-600 bg-yellow-100";case"great failure":return"text-orange-600 bg-orange-100";case"critical failure":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},r=s=>{switch(s){case"critical success":return"";case"great success":return"";case"success":return"";case"failure":return"";case"great failure":return"";case"critical failure":return"";default:return""}};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Dice Roll Results"}),o.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:""})]}),n.actions?o.jsxs("div",{className:"space-y-4",children:[n.actions.map((s,i)=>o.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:s.action}),o.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${t(s.check.degree)}`,children:[r(s.check.degree)," ",s.check.degree]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Roll:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.roll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Total:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.totalRoll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"DC:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.dc})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Margin:"}),o.jsxs("span",{className:`font-mono ml-1 ${s.check.margin>=0?"text-green-600":"text-red-600"}`,children:[s.check.margin>=0?"+":"",s.check.margin]})]})]}),s.check.circumstanceBonus!==0&&o.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:["Circumstance bonus: ",s.check.circumstanceBonus>=0?"+":"",s.check.circumstanceBonus]})]},i)),o.jsxs("div",{className:"mt-4 p-3 bg-stone-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"Overall Result"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${n.overallSuccess?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:n.overallSuccess?" Success":" Partial Failure"}),n.hasCriticalFailures&&o.jsx("span",{className:"text-red-600 text-sm",children:" Critical failures occurred"})]})]})]}):o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:n.actionType}),o.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${t(n.degree)}`,children:[r(n.degree)," ",n.degree]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Roll:"}),o.jsx("span",{className:"font-mono ml-1",children:n.roll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Total:"}),o.jsx("span",{className:"font-mono ml-1",children:n.totalRoll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"DC:"}),o.jsx("span",{className:"font-mono ml-1",children:n.dc})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Margin:"}),o.jsxs("span",{className:`font-mono ml-1 ${n.margin>=0?"text-green-600":"text-red-600"}`,children:[n.margin>=0?"+":"",n.margin]})]})]}),o.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:[o.jsxs("div",{children:["Primary Mod: ",n.primaryMod>=0?"+":"",n.primaryMod]}),o.jsxs("div",{children:["Proficiency: ",n.proficiencyMod>=0?"+":"",n.proficiencyMod]}),n.circumstanceBonus!==0&&o.jsxs("div",{children:["Circumstance: ",n.circumstanceBonus>=0?"+":"",n.circumstanceBonus]})]})]})}),o.jsx("div",{className:"mt-4 flex justify-end",children:o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Close"})})]})})}function FV(){var Pe,V,H,me,Te,et,Ut,Bt,W,Y;const{user:n,loading:e}=yS(),{partyId:t}=wc(),r=yr(),[s,i]=A.useState(null),[a,l]=A.useState(null),[c,d]=A.useState([]),[h,m]=A.useState([]),[p,y]=A.useState(!0),[_,T]=A.useState(""),[E,x]=A.useState(""),[v,S]=A.useState("storytelling"),[P,M]=A.useState([]),[$,I]=A.useState(null),[b,C]=A.useState(!1),[N,R]=A.useState(null),[D,k]=A.useState(!1),[je,K]=A.useState(null),[re,_e]=A.useState(null),[Q,J]=A.useState(!1),[ne,Ne]=A.useState(!1),[Ae,Fe]=A.useState(!1),[ut,He]=A.useState(!1),[Pt,dt]=A.useState([]),[Xn,Zn]=A.useState(!1),[nn,Qe]=A.useState(!1),[Qt,yt]=A.useState(!1),Xe=()=>{var F;return((F=s==null?void 0:s.readyPlayers)==null?void 0:F.length)||0},rn=()=>c.length,vt=()=>h.sort((F,q)=>F.name.localeCompare(q.name)),_n=F=>F?F.replace(/\*\*(.*?)\*\*/g,'<strong class="text-yellow-400 font-bold">$1</strong>').replace(/\*(.*?)\*/g,'<em class="text-blue-400 italic">$1</em>').replace(/`(.*?)`/g,'<code class="bg-slate-700 px-2 py-1 rounded text-slate-200 font-mono text-sm">$1</code>').replace(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*):/g,'<span class="text-green-400 font-semibold">$1:</span>').replace(/\b(weapon|sword|shield|armor|magic|spell|dragon|monster|treasure|gold|silver|quest|adventure|hero|villain)\b/gi,'<span class="text-orange-400 font-medium">$1</span>').replace(/\b([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\b/g,q=>q.includes("<")||["The","A","An","And","Or","But","In","On","At","To","For","Of","With","By"].includes(q)?q:`<span class="text-purple-400 font-medium">${q}</span>`).replace(/\n/g,"<br>"):"";A.useEffect(()=>{!n&&!e&&r("/login")},[n,e,r]),A.useEffect(()=>{t&&n&&!e&&dn()},[t,n,e]),A.useEffect(()=>{if(s!=null&&s.id){const F=oS(s.id,async q=>{var le,fe,de,Se,zt,sn;if(q){i(q),q.deadPlayers&&q.deadPlayers.length>0&&(dt(q.deadPlayers),Zn(!0));const De=q.currentContent||"",Ye=(q.storyMetadata||{}).phaseStatus||(De.toLowerCase().includes("phase_status:")?(fe=(le=De.toLowerCase().split("phase_status:")[1])==null?void 0:le.split(`
`)[0])==null?void 0:fe.trim():null)||(De.toLowerCase().includes("conflict")?"conflict":null),Tt=["attack","battle","combat","fight","enemy","enemies","monster","creature","ghoul","bandit","goblin","troll"].some(vr=>De.toLowerCase().includes(vr));if(q.storyMetadata&&String(q.storyMetadata.phaseStatus).toLowerCase()==="conflict"&&!Qt&&!nn){Qe(!0);const vr=(a==null?void 0:a.members)||[];if(((de=q.readyPlayers)==null?void 0:de.length)===vr.length&&vr.length>0){if(!(h.length===vr.length))return;try{const ue=Re(((Se=q.storyMetadata)==null?void 0:Se.enemyDetails)||[]),be=await zn.createCombatSession(t,h.length>0?h:c,ue,q.currentContent||"Combat encounter");Qe(!1),yt(!0),r(`/combat/${be.id}`)}catch{Qe(!1),yt(!1)}setTimeout(()=>{nn&&(Qe(!1),yt(!1))},5e3)}}else q.storyMetadata&&String(q.storyMetadata.phaseStatus).toLowerCase()!=="conflict"&&(yt(!1),Qe(!1));(zt=q.readyPlayers)!=null&&zt.includes(n==null?void 0:n.uid)&&J(!0);const qe=(a==null?void 0:a.members)||[];((sn=q.readyPlayers)==null?void 0:sn.length)===qe.length&&qe.length>0?Ne(!0):Ne(!1)}});return _e(()=>F),()=>F()}},[s==null?void 0:s.id,n==null?void 0:n.uid,a==null?void 0:a.members,h,r,Qt]),A.useEffect(()=>{if(t){console.log(" Setting up real-time subscription for characters:",t);const F=_y(t,async q=>{if(q){console.log(" Party update received:",q),l(q),d(q.members||[]);try{const le=await ui(t);console.log(" Characters reloaded:",le),console.log(" Character count:",le.length),console.log(" Character details:",le.map(fe=>({id:fe.id,name:fe.name,userId:fe.userId,partyId:fe.partyId}))),m(le)}catch(le){console.error(" Error reloading characters:",le)}}});return()=>F()}},[t]),A.useEffect(()=>()=>{re&&re()},[re]);const dn=A.useCallback(async()=>{if(t)try{y(!0);const F=await Bh(t);l(F);const q=(F==null?void 0:F.members)||[];d(q);let le=await Za(t);le||(le=await iS(t)),i(le);const fe=await ui(t);m(fe);const de=jV((F==null?void 0:F.description)||"adventure");M(de)}catch(F){console.error(" Error loading story and characters:",F),T("Failed to load campaign data")}finally{y(!1)}},[t]),Yt=A.useCallback(async()=>{if(!(!n||!s))try{y(!0),await aS(s.id,n.uid)}catch(F){console.error(" Error readying up:",F),T("Failed to ready up")}finally{y(!1)}},[n,s]),hn=A.useCallback(async()=>{if(!(!n||!s))try{y(!0),Fe(!0),await Ht(s.id,{status:"generating"});try{const F=await Au.generateStoryPlots(h,(a==null?void 0:a.description)||"An epic adventure awaits!",P),q=ie(F);await Ht(s.id,{status:"voting",availablePlots:q})}catch(F){console.warn("AI service unavailable, using fallback plots:",F);const q=[{title:"The Lost Artifact",description:"A powerful artifact has been stolen and the party must track it down through dangerous territory.",summary:"An ancient artifact of great power has been stolen from the local temple. The party must follow the trail of the thieves through dangerous wilderness and hostile territory.",campaignLength:"medium"},{title:"The Dark Forest",description:"A mysterious forest has appeared overnight, and strange creatures are emerging from its depths.",summary:"A dark forest has mysteriously appeared on the outskirts of town. Strange creatures and magical phenomena are emerging, and the party must investigate the source.",campaignLength:"short"},{title:"The Dragon's Lair",description:"A dragon has been terrorizing the countryside, and the party must find a way to stop it.",summary:"A fearsome dragon has been attacking villages and stealing livestock. The party must find the dragon's lair and either defeat it or negotiate a peaceful solution.",campaignLength:"long"}];await Ht(s.id,{status:"voting",availablePlots:q}),T("AI service temporarily unavailable. Using predefined plot options.")}}catch(F){console.error(" Error starting story:",F),T("Failed to start story generation"),await Ht(s.id,{status:"ready_up"})}finally{y(!1),Fe(!1)}},[n,s,h,a==null?void 0:a.description,P]),Mn=A.useCallback(async F=>{var q;try{y(!0);const fe=(((q=s==null?void 0:s.availablePlots)==null?void 0:q.filter(de=>de.title&&!de.title.startsWith("Plot ")))||[])[F];if(!fe){T("Selected plot not found");return}await Ht(s.id,{status:"generating_story",selectedPlot:F,selectedPlotData:fe,currentContent:`Generating story content for: ${fe.title}...`});try{const de=await Au.generateStoryIntroduction(h,fe.description,fe.title,a);console.log(" Generated story content:",de),await Ht(s.id,{status:"storytelling",currentContent:de||`The adventure begins with ${fe.title}!`,currentSpeaker:{userId:a.dmId,name:"Dungeon Master",id:"dm",race:"DM",class:"Dungeon Master"}}),console.log(" Plot selected and story generated successfully")}catch(de){console.warn("AI service unavailable, using fallback story:",de);const Se=`The adventure begins with ${fe.title}!

${fe.summary}

The party finds themselves at the beginning of this epic journey. The path ahead is uncertain, but the promise of adventure and glory awaits those brave enough to take the first step.

What would you like to do?`;await Ht(s.id,{status:"storytelling",currentContent:Se,currentSpeaker:{userId:a.dmId,name:"Dungeon Master",id:"dm",race:"DM",class:"Dungeon Master"}}),console.log(" Plot selected with fallback story content"),T("AI service temporarily unavailable. Using simplified story introduction.")}}catch(le){console.error(" Error selecting plot:",le),T("Failed to select plot"),await Ht(s.id,{status:"voting"})}finally{y(!1)}},[s,h,a]),En=A.useCallback(async()=>{var F,q;if(E.trim())try{y(!0),T("");const le=h.find(fe=>fe.userId===(n==null?void 0:n.uid));if(!le){T("You need a character to participate in the story");return}try{const fe=await DV.validatePlayerAction(E,le,{storyState:s,currentContent:(s==null?void 0:s.currentContent)||"",party:a});I(fe),fe.diceResult&&(C(!0),R(fe))}catch(fe){console.warn("Action validation unavailable:",fe)}try{const fe=await Au.generateStructuredStoryResponse(h,(s==null?void 0:s.storyMessages)||[],E,v,cb(P),null,a),de=ze(fe),Se={speaker:((F=s==null?void 0:s.currentSpeaker)==null?void 0:F.name)||le.name,content:E,timestamp:new Date};await Ht(s.id,{currentContent:de.storyContent||`${(s==null?void 0:s.currentContent)||""}

${le.name}: "${E}"`,currentSpeaker:null,storyMessages:[...(s==null?void 0:s.storyMessages)||[],Se],storyMetadata:{currentLocation:de.currentLocation,activeNPCs:de.activeNPCs,plotDevelopments:de.plotDevelopments,characterReactions:de.characterReactions,nextActions:de.nextActions,storyTone:de.storyTone,phaseStatus:de.phaseStatus,enemyDetails:de.enemyDetails||[]}})}catch(fe){console.warn("AI service unavailable, continuing story manually:",fe);const de={speaker:((q=s==null?void 0:s.currentSpeaker)==null?void 0:q.name)||le.name,content:E,timestamp:new Date};await Ht(s.id,{currentContent:`${(s==null?void 0:s.currentContent)||""}

${le.name}: "${E}"`,currentSpeaker:null,storyMessages:[...(s==null?void 0:s.storyMessages)||[],de]}),T("AI service temporarily unavailable. Story continued manually.")}x(""),I(null),await dn()}catch(le){console.error("Error sending response:",le),T("Failed to send response")}finally{y(!1)}},[E,h,n==null?void 0:n.uid,s,a,v,P,dn]),Ze=A.useCallback(()=>{C(!1),R(null)},[]),Bn=A.useCallback(()=>{k(!1),K(null)},[]),Mt=A.useCallback(async()=>{C(!1)},[]),Ee=A.useCallback(()=>{C(!1),R(null)},[]),G=A.useCallback(async F=>{try{y(!0),F?await lS(s.id,F):await Ht(s.id,{currentSpeaker:null})}catch(q){console.error(" Error setting speaker:",q),T("Failed to set speaker")}finally{y(!1)}},[s==null?void 0:s.id]);A.useCallback(async()=>{try{y(!0);const F=await Au.generateStoryContinuation(h,(s==null?void 0:s.storyMessages)||[],"The story continues...",v,cb(P),null,a);await Ht(s.id,{currentContent:F||"The story continues...",currentSpeaker:null})}catch(F){console.error(" Error continuing story:",F),T("Failed to continue story")}finally{y(!1)}},[h,s,v,P,a]);const ie=F=>{try{const le=F.split(/\*\*Plot Option \d+:\*\*/).filter(fe=>fe.trim()).map((fe,de)=>{const Se=fe.trim().split(`
`).filter(Ye=>Ye.trim());let zt=`Plot ${de+1}`,sn="",De="",er="";for(let Ye=0;Ye<Se.length;Ye++){const xt=Se[Ye].trim();if(xt.startsWith("1. Title:")){const Tt=xt.match(/1\.\s*Title:\s*"([^"]+)"/);Tt&&(zt=Tt[1])}if(xt.startsWith("2. Summary:")){let Tt=xt.replace("2. Summary:","").trim(),qe=Ye+1;for(;qe<Se.length&&!Se[qe].trim().startsWith("3.");)Tt+=" "+Se[qe].trim(),qe++;De=Tt.trim(),Ye=qe-1}if(xt.startsWith("3. Main Conflict:")){let Tt=xt.replace("3. Main Conflict:","").trim(),qe=Ye+1;for(;qe<Se.length&&!Se[qe].trim().startsWith("4.");)Tt+=" "+Se[qe].trim(),qe++;sn=Tt.trim(),Ye=qe-1}if(xt.startsWith("5. Estimated Campaign Length:")){const Tt=xt.match(/5\.\s*Estimated Campaign Length:\s*(short|medium|long)/i);Tt&&(er=Tt[1].toLowerCase())}}return!sn&&De&&(sn=De),console.log(` Plot ${de+1} parsed:`,{title:zt,description:sn,summary:De,campaignLength:er}),{id:de,title:zt,description:sn||De||`Plot ${de+1} description`,summary:De,campaignLength:er,index:de}});return console.log(" Parsed plots:",le),le}catch(q){return console.error(" Error parsing plots:",q),[{id:0,title:"Plot 1",description:"Adventure awaits!",index:0},{id:1,title:"Plot 2",description:"Another exciting journey!",index:1},{id:2,title:"Plot 3",description:"A mysterious quest!",index:2}]}},ze=F=>{try{console.log(" Parsing structured response:",F);const q={storyContent:"",currentLocation:"",activeNPCs:[],plotDevelopments:"",characterReactions:"",nextActions:[],storyTone:"",phaseStatus:"",enemyDetails:[]},le=F.match(/\*\*STORY_CONTENT:\*\*\s*([\s\S]*?)(?=\*\*|$)/);le&&(q.storyContent=le[1].trim());const fe=F.match(/\*\*CURRENT_LOCATION:\*\*\s*([\s\S]*?)(?=\*\*|$)/);fe&&(q.currentLocation=fe[1].trim());const de=F.match(/\*\*ACTIVE_NPCS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);de&&(q.activeNPCs=de[1].trim().split(",").map(xt=>xt.trim()).filter(xt=>xt));const Se=F.match(/\*\*PLOT_DEVELOPMENTS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);Se&&(q.plotDevelopments=Se[1].trim());const zt=F.match(/\*\*CHARACTER_REACTIONS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);zt&&(q.characterReactions=zt[1].trim());const sn=F.match(/\*\*NEXT_ACTIONS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);sn&&(q.nextActions=sn[1].trim().split(",").map(xt=>xt.trim()).filter(xt=>xt));const De=F.match(/\*\*STORY_TONE:\*\*\s*([\s\S]*?)(?=\*\*|$)/);De&&(q.storyTone=De[1].trim());const er=F.match(/\*\*PHASE_STATUS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);er&&(q.phaseStatus=er[1].trim());const Ye=F.match(/\*\*ENEMY_DETAILS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);if(Ye){const Tt=Ye[1].trim().split(/(?=Name:)/).filter(qe=>qe.trim());q.enemyDetails=Tt.map((qe,vr)=>{const j={},B=qe.match(/Name:\s*([^\n]+)/);B&&(j.name=B[1].trim());const ue=qe.match(/Type:\s*([^\n]+)/);ue&&(j.type=ue[1].trim());const be=qe.match(/Level:\s*([^\n]+)/);be&&(j.level=parseInt(be[1].trim())||1);const ee=qe.match(/HP:\s*([^\n]+)/);if(ee){const qt=ee[1].trim().match(/(\d+)/);j.hp=qt?parseInt(qt[1]):20}const xe=qe.match(/AC:\s*([^\n]+)/);xe&&(j.ac=parseInt(xe[1].trim())||12);const ge=qe.match(/Basic Attack:\s*([^\n]+)/);ge&&(j.basicAttack=ge[1].trim());const rt=qe.match(/Special Ability:\s*([^\n]+)/);rt&&(j.specialAbility=rt[1].trim());const Ve=qe.match(/Stats:\s*([^\n]+)/);return Ve&&(j.stats=Ve[1].trim()),j})}return q}catch(q){return console.error(" Error parsing structured response:",q),{storyContent:F,currentLocation:"",activeNPCs:[],plotDevelopments:"",characterReactions:"",nextActions:[],storyTone:"",phaseStatus:"",enemyDetails:[]}}},Re=F=>!Array.isArray(F)||F.length===0?[]:F.map((q,le)=>{var Se,zt;return{id:`enemy_${le}`,name:q.name||`Enemy ${le+1}`,hp:q.hp||20,maxHp:q.hp||20,ac:q.ac||12,level:q.level||1,class:((Se=q.type)==null?void 0:Se.toLowerCase())||"enemy",race:((zt=q.type)==null?void 0:zt.toLowerCase())||"unknown",initiative:Math.floor(Math.random()*20)+1,strength:12,dexterity:10,constitution:12,intelligence:8,wisdom:8,charisma:6,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,basicAttack:q.basicAttack||"Basic attack (1d6 damage)",specialAbility:q.specialAbility||"None",type:q.type||"humanoid",stats:q.stats||"Standard enemy stats"}});return e?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),o.jsx("p",{className:"text-slate-300",children:"Loading campaign..."})]})}):_?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-red-400 mb-4",children:_}),o.jsxs("div",{className:"space-x-4",children:[o.jsx("button",{onClick:()=>{T(""),dn()},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Retry"}),o.jsx("button",{onClick:()=>r("/dashboard"),className:"bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg transition-colors",children:"Back to Dashboard"})]})]})}):s?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:o.jsxs("div",{className:"container mx-auto px-4 py-6",children:[o.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-lg p-6 mb-6",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-3xl font-bold text-slate-200 mb-2",children:(a==null?void 0:a.name)||"Campaign Story"}),o.jsx("p",{className:"text-slate-300",children:(a==null?void 0:a.description)||"Adventure awaits!"})]}),o.jsx("div",{className:"text-right",children:o.jsxs("div",{className:"text-slate-300 text-sm",children:["Status: ",o.jsx("span",{className:"font-semibold text-slate-200",children:(s==null?void 0:s.status)||"unknown"})]})})]})}),(s==null?void 0:s.status)==="ready_up"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-3",children:"Campaign Lobby"}),o.jsx("p",{className:"text-slate-300 text-lg",children:"Waiting for all players to ready up"}),o.jsxs("div",{className:"mt-8 mb-8",children:[o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-4",children:[o.jsxs("div",{className:"text-2xl font-semibold text-slate-300",children:[Xe(),"/",rn()," Players Ready"]}),o.jsxs("div",{className:"text-lg text-slate-400",children:["(",Math.round(Xe()/rn()*100),"%)"]})]}),o.jsx("div",{className:"w-full bg-slate-700 rounded-full h-4 max-w-lg mx-auto",children:o.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-400 h-4 rounded-full transition-all duration-500",style:{width:`${Xe()/rn()*100}%`}})})]})]}),o.jsxs("div",{className:"text-center",children:[Q?o.jsx("div",{className:"text-green-400 font-semibold text-xl bg-green-900/30 px-6 py-3 rounded-xl",children:"You are ready!"}):o.jsx("div",{className:"space-y-4",children:h.find(F=>F.userId===(n==null?void 0:n.uid))?o.jsx("button",{onClick:Yt,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Ready Up"}):o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-slate-300",children:"You need to create a character first"}),o.jsx("button",{onClick:()=>r(`/character-creation/${t}`),className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Create Character"})]})}),ne&&(a==null?void 0:a.dmId)===(n==null?void 0:n.uid)&&o.jsx("div",{className:"mt-6",children:o.jsx("button",{onClick:hn,disabled:p||Ae,className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:p||Ae?"Generating Story...":"Start Story Generation"})}),ne&&(a==null?void 0:a.dmId)!==(n==null?void 0:n.uid)&&o.jsx("div",{className:"mt-6",children:o.jsx("div",{className:"text-blue-400 font-semibold text-lg bg-blue-900/30 px-6 py-3 rounded-xl",children:"Waiting for Dungeon Master to start the story..."})})]})]}),(s==null?void 0:s.status)==="generating"&&o.jsx("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-4",children:"Generating Your Adventure"}),o.jsx("p",{className:"text-slate-300 text-lg mb-8",children:"The Dungeon Master is crafting your story. This may take a moment..."}),o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-400"}),o.jsx("div",{className:"text-slate-300 font-semibold text-lg",children:"Creating Story Plots..."})]})]})}),(s==null?void 0:s.status)==="generating_story"&&o.jsx("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-4",children:"Crafting Your Story"}),o.jsx("p",{className:"text-slate-300 text-lg mb-8",children:"The Dungeon Master is weaving the tale of your adventure..."}),o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-400"}),o.jsx("div",{className:"text-slate-300 font-semibold text-lg",children:"Generating Story Content..."})]}),(s==null?void 0:s.selectedPlotData)&&o.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 max-w-2xl mx-auto",children:[o.jsxs("h3",{className:"text-slate-200 font-semibold mb-2",children:["Selected Plot: ",s.selectedPlotData.title]}),o.jsx("p",{className:"text-slate-300 text-sm",children:s.selectedPlotData.description})]})]})}),(s==null?void 0:s.status)==="voting"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-6 text-center",children:"Choose Your Adventure"}),o.jsx("div",{className:"mb-4 flex justify-center",children:o.jsx("button",{onClick:()=>He(!ut),className:"bg-slate-700 hover:bg-slate-600 text-slate-300 px-4 py-2 rounded-lg text-sm transition-colors",children:ut?"Hide Debug":"Show Debug"})}),ut&&o.jsxs("div",{className:"mb-4 p-4 bg-slate-700/50 rounded-lg",children:[o.jsxs("p",{className:"text-slate-300 text-sm",children:["Debug: Available plots count: ",((Pe=s==null?void 0:s.availablePlots)==null?void 0:Pe.length)||0]}),o.jsxs("p",{className:"text-slate-300 text-sm",children:["Debug: Raw plots: ",JSON.stringify((V=s==null?void 0:s.availablePlots)==null?void 0:V.slice(0,2))]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Array.isArray(s==null?void 0:s.availablePlots)&&s.availablePlots.length>0?s.availablePlots.map((F,q)=>o.jsxs("div",{className:"bg-slate-800/70 border-2 border-slate-600 rounded-xl p-6 hover:border-slate-500 transition-all duration-300",children:[o.jsx("h3",{className:"font-bold text-slate-200 text-xl mb-3",children:F.title}),o.jsx("p",{className:"text-slate-300 mb-4",children:F.description||"Adventure description here..."}),F.campaignLength&&o.jsxs("div",{className:"mb-4",children:[o.jsx("span",{className:"text-slate-400 text-sm",children:"Length: "}),o.jsx("span",{className:"text-slate-200 font-semibold capitalize",children:F.campaignLength})]}),(a==null?void 0:a.dmId)===(n==null?void 0:n.uid)?o.jsx("button",{onClick:()=>Mn(q),disabled:p,className:"w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Selecting...":"Choose This Plot"}):o.jsx("div",{className:"text-center py-3",children:o.jsx("span",{className:"text-slate-400 text-sm",children:"Waiting for DM to choose..."})})]},q)):o.jsxs("div",{className:"col-span-3 text-center",children:[o.jsx("p",{className:"text-slate-300",children:"No plots available. Please try generating the story again."}),(a==null?void 0:a.dmId)===(n==null?void 0:n.uid)&&o.jsx("button",{onClick:hn,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors",children:"Regenerate Plots"})]})}),(a==null?void 0:a.dmId)!==(n==null?void 0:n.uid)&&o.jsx("div",{className:"text-center mt-6",children:o.jsx("p",{className:"text-slate-300 text-lg",children:"Waiting for the Dungeon Master to select a plot..."})})]}),(s==null?void 0:s.status)==="storytelling"&&o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[o.jsx("div",{className:"lg:col-span-1",children:o.jsxs("div",{className:"flex flex-col gap-y-6 lg:sticky lg:top-6",children:[o.jsxs("div",{className:"hidden lg:block bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsx("h3",{className:"font-bold text-slate-200",children:"Party Members"}),o.jsx("button",{onClick:()=>He(!ut),className:"text-xs bg-slate-600 hover:bg-slate-500 px-2 py-1 rounded text-slate-200",children:ut?"Hide Debug":"Show Debug"})]}),ut&&o.jsxs("div",{className:"mb-2 p-2 bg-slate-700/50 rounded text-xs",children:[o.jsxs("p",{className:"text-slate-300",children:["Debug: Characters loaded: ",h.length]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Party members: ",c.length]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Characters: ",JSON.stringify(h.map(F=>({name:F.name,userId:F.userId})))]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Current Speaker: ",JSON.stringify(s==null?void 0:s.currentSpeaker)]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: User UID: ",n==null?void 0:n.uid]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Party DM ID: ",a==null?void 0:a.dmId]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Is DM speaking: ",((H=s==null?void 0:s.currentSpeaker)==null?void 0:H.id)==="dm"?"Yes":"No"]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Is user DM: ",(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)?"Yes":"No"]})]}),o.jsx("div",{className:"space-y-2",children:vt().map(F=>{var fe,de,Se;const q=((fe=s==null?void 0:s.currentSpeaker)==null?void 0:fe.userId)===F.userId;n==null||n.uid,F.userId;const le=((de=s==null?void 0:s.currentSpeaker)==null?void 0:de.userId)===(n==null?void 0:n.uid)||((Se=s==null?void 0:s.currentSpeaker)==null?void 0:Se.id)==="dm"&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)||!(s!=null&&s.currentSpeaker)&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId);return o.jsxs("div",{className:`p-2 rounded transition-colors ${q?"bg-blue-600/30 border border-blue-500":le?"bg-slate-700/50 hover:bg-slate-600/50 cursor-pointer":"bg-slate-700/30 opacity-60 cursor-not-allowed"}`,onClick:le?()=>G(F):void 0,children:[o.jsx("div",{className:"font-semibold text-slate-200 text-xs",children:F.name}),o.jsxs("div",{className:"text-slate-400 text-xs",children:[F.race," ",F.class]}),q&&o.jsx("div",{className:"text-blue-400 text-xs mt-1",children:"Currently Speaking"}),!le&&!q&&o.jsx("div",{className:"text-slate-500 text-xs mt-1",children:"Waiting for turn..."}),le&&!q&&o.jsx("div",{className:"text-green-400 text-xs mt-1",children:"Click to select"})]},F.id)})})]}),(s==null?void 0:s.campaignMetadata)&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Campaign Progress"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Session:"}),o.jsx("span",{className:"text-slate-200 font-semibold",children:s.campaignMetadata.sessionNumber})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Progress:"}),o.jsxs("span",{className:"text-slate-200 font-semibold",children:[s.campaignMetadata.campaignProgress,"%"]})]})]})]}),P.length>0&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Objectives"}),o.jsx("div",{className:"space-y-2",children:P.map((F,q)=>o.jsxs("div",{className:"text-sm",children:[o.jsx("div",{className:"text-slate-300",children:F.title}),o.jsx("div",{className:"text-slate-400 text-xs",children:F.description})]},q))})]})]})}),o.jsxs("div",{className:"lg:col-span-3",children:[(s==null?void 0:s.currentContent)&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 mb-8 shadow-lg",children:[o.jsx("div",{className:"mb-6",children:o.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2 border-b border-slate-600 pb-3",children:" Current Story"})}),o.jsx("div",{className:"text-slate-200 leading-8 text-lg max-w-none prose prose-invert prose-lg prose-slate",style:{lineHeight:"1.8",fontSize:"1.125rem",letterSpacing:"0.025em"},dangerouslySetInnerHTML:{__html:_n(s.currentContent)}}),(s==null?void 0:s.storyMetadata)&&o.jsxs("div",{className:"mt-6 p-4 bg-slate-700/30 rounded-lg border border-slate-600",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.storyMetadata.currentLocation&&o.jsxs("div",{children:[o.jsx("span",{className:"text-blue-400 font-semibold",children:" Location:"}),o.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.currentLocation})]}),s.storyMetadata.storyTone&&o.jsxs("div",{children:[o.jsx("span",{className:"text-purple-400 font-semibold",children:" Tone:"}),o.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.storyTone})]}),s.storyMetadata.activeNPCs&&s.storyMetadata.activeNPCs.length>0&&o.jsxs("div",{children:[o.jsx("span",{className:"text-green-400 font-semibold",children:" Active NPCs:"}),o.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.activeNPCs.join(", ")})]}),s.storyMetadata.phaseStatus&&o.jsxs("div",{children:[o.jsx("span",{className:"text-orange-400 font-semibold",children:" Phase:"}),o.jsx("span",{className:"text-slate-300 ml-2 capitalize",children:s.storyMetadata.phaseStatus})]})]}),s.storyMetadata.nextActions&&s.storyMetadata.nextActions.length>0&&o.jsxs("div",{className:"mt-4",children:[o.jsx("span",{className:"text-yellow-400 font-semibold",children:" Possible Actions:"}),o.jsx("ul",{className:"mt-2 space-y-1",children:s.storyMetadata.nextActions.map((F,q)=>o.jsxs("li",{className:"text-slate-300 text-sm",children:[" ",F]},q))})]})]})]}),s!=null&&s.currentSpeaker?o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mb-6",children:[o.jsxs("h3",{className:"font-bold text-slate-200 mb-4",children:["Current Speaker: ",s.currentSpeaker.name]}),((me=s==null?void 0:s.currentSpeaker)==null?void 0:me.userId)===(n==null?void 0:n.uid)||((Te=s==null?void 0:s.currentSpeaker)==null?void 0:Te.id)==="dm"&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)?o.jsxs("div",{className:"space-y-4",children:[o.jsx("textarea",{value:E,onChange:F=>x(F.target.value),placeholder:((et=s==null?void 0:s.currentSpeaker)==null?void 0:et.id)==="dm"?"Continue the story or describe what happens next...":`What does ${s.currentSpeaker.name} do?`,className:"w-full bg-slate-800/50 border border-slate-600 text-slate-100 px-4 py-3 rounded-lg focus:border-slate-500 focus:outline-none transition-colors min-h-[120px] resize-none",rows:4}),o.jsx("div",{className:"flex space-x-3",children:o.jsx("button",{onClick:En,disabled:!E.trim()||p,className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Processing...":((Ut=s==null?void 0:s.currentSpeaker)==null?void 0:Ut.id)==="dm"?"Continue Story":"Send Response"})})]}):o.jsxs("p",{className:"text-slate-300",children:["Waiting for ",s.currentSpeaker.name," to respond..."]})]}):(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mb-6",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-4",children:"Dungeon Master Response"}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("textarea",{value:E,onChange:F=>x(F.target.value),placeholder:"Continue the story or describe what happens next...",className:"w-full bg-slate-800/50 border border-slate-600 text-slate-100 px-4 py-3 rounded-lg focus:border-slate-500 focus:outline-none transition-colors min-h-[120px] resize-none",rows:4}),o.jsx("div",{className:"flex space-x-3",children:o.jsx("button",{onClick:En,disabled:!E.trim()||p,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Processing...":"Continue Story"})})]})]}),o.jsxs("div",{className:"lg:hidden bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4 mb-6",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Party Members"}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:vt().map(F=>{var fe,de,Se;const q=((fe=s==null?void 0:s.currentSpeaker)==null?void 0:fe.userId)===F.userId;n==null||n.uid,F.userId;const le=((de=s==null?void 0:s.currentSpeaker)==null?void 0:de.userId)===(n==null?void 0:n.uid)||((Se=s==null?void 0:s.currentSpeaker)==null?void 0:Se.id)==="dm"&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)||!(s!=null&&s.currentSpeaker)&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId);return o.jsxs("div",{className:`p-2 rounded transition-colors ${q?"bg-blue-600/30 border border-blue-500":le?"bg-slate-700/50 hover:bg-slate-600/50 cursor-pointer":"bg-slate-700/30 opacity-60 cursor-not-allowed"}`,onClick:le?()=>G(F):void 0,children:[o.jsx("div",{className:"font-semibold text-slate-200 text-xs",children:F.name}),o.jsxs("div",{className:"text-slate-400 text-xs",children:[F.race," ",F.class]}),q&&o.jsx("div",{className:"text-blue-400 text-xs mt-1",children:"Currently Speaking"}),!le&&!q&&o.jsx("div",{className:"text-slate-500 text-xs mt-1",children:"Waiting for turn..."}),le&&!q&&o.jsx("div",{className:"text-green-400 text-xs mt-1",children:"Click to select"})]},F.id)})})]}),(s==null?void 0:s.storyMessages)&&s.storyMessages.length>0&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mt-8 shadow-lg",children:[o.jsx("div",{className:"mb-6",children:o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-2 border-b border-slate-600 pb-3",children:" Story History"})}),o.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:s.storyMessages.map((F,q)=>o.jsxs("div",{className:"border-l-4 border-slate-500 pl-4 py-2 bg-slate-800/30 rounded-r-lg",children:[o.jsxs("div",{className:"text-slate-300 text-sm font-semibold mb-2 flex items-center",children:[o.jsx("span",{className:"mr-2",children:""}),F.speaker||"Narrator"]}),o.jsx("div",{className:"text-slate-400 text-sm leading-6 pl-6 border-l border-slate-600",dangerouslySetInnerHTML:{__html:_n(F.content)}})]},q))})]}),Xn&&Pt.length>0&&o.jsx("div",{className:"bg-gradient-to-r from-red-900/50 to-red-800/50 border border-red-600 rounded-lg p-6 mb-6",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"text-red-400 text-xl",children:""}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-red-200 mb-2",children:"Combat Aftermath"}),o.jsx("p",{className:"text-red-100 text-sm mb-3",children:"The battle has ended. Some heroes have fallen, but the story continues..."}),o.jsxs("div",{className:"bg-red-800/30 border border-red-600 rounded p-3 mb-3",children:[o.jsx("h4",{className:"text-red-200 font-semibold mb-2",children:"Fallen Heroes:"}),o.jsx("div",{className:"space-y-2",children:Pt.map((F,q)=>o.jsxs("div",{className:"text-red-200 text-sm",children:[o.jsx("strong",{children:F.name})," (",F.class,", Level ",F.level,") - ",F.deathCause]},q))})]}),o.jsx("p",{className:"text-red-100 text-xs",children:"The fallen heroes will need to create new characters to rejoin the adventure."})]}),o.jsx("button",{onClick:()=>Zn(!1),className:"text-red-400 hover:text-red-200 transition-colors",children:""})]})}),_&&o.jsx("div",{className:"bg-gradient-to-r from-red-900/50 to-red-800/50 border border-red-600 rounded-lg p-4 mb-6",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"text-red-400 text-xl",children:""}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-red-200 mb-2",children:"Notice"}),o.jsx("p",{className:"text-red-100 text-sm mb-3",children:_}),_.includes("AI service")&&o.jsxs("div",{className:"bg-red-800/30 border border-red-600 rounded p-3",children:[o.jsxs("p",{className:"text-red-200 text-xs mb-2",children:[o.jsx("strong",{children:"What this means:"})," The AI storytelling service is temporarily unavailable."]}),o.jsx("p",{className:"text-red-200 text-xs mb-2",children:o.jsx("strong",{children:"You can still:"})}),o.jsxs("ul",{className:"text-red-200 text-xs list-disc list-inside space-y-1",children:[o.jsx("li",{children:"Continue the story manually by typing your responses"}),o.jsx("li",{children:"Use the predefined plot options if available"}),o.jsx("li",{children:"Wait a few minutes and try again"})]})]})]}),o.jsx("button",{onClick:()=>T(""),className:"text-red-400 hover:text-red-200 transition-colors",children:""})]})}),ut&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-900/50 to-slate-800/50 border border-slate-600 rounded-lg p-6 mb-6",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-4",children:" Debug Information"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:"Story State"}),o.jsxs("div",{className:"space-y-1 text-slate-400",children:[o.jsxs("div",{children:["Story ID: ",(s==null?void 0:s.id)||"None"]}),o.jsxs("div",{children:["Status: ",(s==null?void 0:s.status)||"None"]}),o.jsxs("div",{children:["Phase: ",((Bt=s==null?void 0:s.storyMetadata)==null?void 0:Bt.phaseStatus)||"None"]}),o.jsxs("div",{children:["Ready Players: ",((W=s==null?void 0:s.readyPlayers)==null?void 0:W.length)||0,"/",c.length]}),o.jsxs("div",{children:["Current Speaker: ",((Y=s==null?void 0:s.currentSpeaker)==null?void 0:Y.name)||"None"]})]})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:"User State"}),o.jsxs("div",{className:"space-y-1 text-slate-400",children:[o.jsxs("div",{children:["User ID: ",(n==null?void 0:n.uid)||"None"]}),o.jsxs("div",{children:["Is DM: ",(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)?"Yes":"No"]}),o.jsxs("div",{children:["Is Ready: ",Q?"Yes":"No"]}),o.jsxs("div",{children:["All Ready: ",ne?"Yes":"No"]}),o.jsxs("div",{children:["Combat Loading: ",nn?"Yes":"No"]}),o.jsxs("div",{children:["Has Navigated: ",Qt?"Yes":"No"]})]})]})]}),(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)&&o.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-600",children:[o.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:" Manual Combat Controls"}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:async()=>{console.log(" DM manually triggering combat..."),yt(!0),Qe(!0);try{const F=await zn.createCombatSession(t,h.length>0?h:c,[],(s==null?void 0:s.currentContent)||"Manual combat encounter");Qe(!1),yt(!0),r(`/combat/${F.id}`)}catch(F){console.error(" Failed to create manual combat session:",F),Qe(!1),yt(!1)}},disabled:nn||Qt,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:nn?"Loading...":"Trigger Combat"}),o.jsx("button",{onClick:()=>{yt(!1),Qe(!1),console.log(" Reset combat navigation state")},className:"bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors",children:"Reset State"})]})]})]})]})]}),b&&o.jsx(LV,{validation:N,onClose:Ze,onProceed:Mt,onRevise:Ee}),D&&o.jsx(OV,{diceResult:je,onClose:Bn})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-slate-300",children:"Story not found"}),o.jsx("button",{onClick:()=>r("/dashboard"),className:"mt-4 bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg transition-colors",children:"Back to Dashboard"})]})})}function $V(){var Ee;const{partyId:n}=wc(),e=yr(),[t,r]=A.useState(null),[s,i]=A.useState(!0),[a,l]=A.useState([]),[c,d]=A.useState(null),[h,m]=A.useState(""),[p,y]=A.useState(""),[_,T]=A.useState(!1);A.useState(null);const[E,x]=A.useState(!1),[v,S]=A.useState([]),[P,M]=A.useState("Campaign Map"),[$,I]=A.useState({width:15,height:10}),[b,C]=A.useState("grass"),[N,R]=A.useState("draw"),[D,k]=A.useState(!1),[je,K]=A.useState({x:0,y:0}),[re,_e]=A.useState({}),[Q,J]=A.useState(null),[ne,Ne]=A.useState(!1),[Ae,Fe]=A.useState({x:0,y:0});A.useEffect(()=>{const G=Bo(ie=>{if(!ie){e("/login");return}r(ie)});return()=>G()},[e]),A.useEffect(()=>{t&&n&&(En(),ut())},[t,n]),A.useEffect(()=>{const G=()=>{Ne(!1)};return document.addEventListener("mouseup",G),()=>{document.removeEventListener("mouseup",G)}},[]);const ut=()=>{const G=fn.loadMap(n);M(G.title),S(G.content),_e(G.subMaps),I(G.size)},He=fn.getTileTypes(),Pt=()=>fn.initializeMap($),dt=()=>{fn.saveMap(n,{title:P,content:v,size:$,subMaps:re}),x(!1)},Xn=(G,ie)=>{N==="draw"?S(fn.updateMapTile(v,G,ie,b)):N==="erase"&&S(fn.updateMapTile(v,G,ie,"empty"))},Zn=(G,ie)=>{Ne(!0),Fe({x:G,y:ie}),Xn(G,ie)},nn=(G,ie)=>{ne&&Xn(G,ie)},Qe=()=>{Ne(!1)},Qt=()=>{S(Pt())},yt=()=>{const G=Pt();S(G)},Xe=(G,ie,ze)=>{ze.preventDefault(),K({x:G,y:ie}),J(re[`${G}-${ie}`]||fn.initializeSubMap()),k(!0)},rn=()=>fn.initializeSubMap(),vt=(G,ie)=>{N==="draw"?J(fn.updateSubMapTile(Q,G,ie,b)):N==="erase"&&J(fn.updateSubMapTile(Q,G,ie,"empty"))},_n=(G,ie)=>{Ne(!0),Fe({x:G,y:ie}),vt(G,ie)},dn=(G,ie)=>{ne&&vt(G,ie)},Yt=()=>{_e(fn.saveSubMap(re,je.x,je.y,Q)),k(!1)},hn=()=>{J(rn())},Mn=(G,ie)=>fn.getTileHasSubMap(re,G,ie),En=async()=>{try{i(!0);const G=await ui(n);l(G);const ie=await fn.loadCampaignData(n);d(ie),m(ie.currentScene||"")}catch(G){console.error("Error loading campaign data:",G)}finally{i(!1)}},Ze=async()=>{try{const G=await fn.saveScene(n,c,h);d(G),m("")}catch(G){console.error("Error saving scene:",G)}},Bn=async()=>{try{i(!0);const G=await fn.startCombat(n,a,p,h);e(`/combat/${G.id}`)}catch(G){console.error("Error starting combat:",G),alert(G.message||"Error starting combat. Please try again.")}finally{i(!1)}},Mt=async()=>{try{await fn.endSession(n,c),e("/dashboard")}catch(G){console.error("Error ending session:",G)}};return s?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-amber-400 border-t-transparent mx-auto mb-4"}),o.jsx("p",{className:"text-slate-300 text-lg font-medium",children:"Loading manual campaign..."})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsx("div",{className:"mb-8",children:o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-400 mb-2",children:"Manual Campaign"}),o.jsx("p",{className:"text-slate-400",children:"Traditional D&D experience - full control over your story"})]}),o.jsx("button",{onClick:Mt,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:"End Session"})]})}),o.jsxs("div",{className:"fantasy-card mb-8",children:[o.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:"Campaign Map"}),v&&v.length>0?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4 overflow-x-auto",children:o.jsx("div",{className:"inline-block",children:v.map((G,ie)=>o.jsx("div",{className:"flex",children:G.map((ze,Re)=>{var Pe,V,H;return o.jsx("div",{className:`w-8 h-8 border border-slate-600 flex items-center justify-center text-xs ${((Pe=He[ze])==null?void 0:Pe.color)||"bg-slate-700"}`,title:`${Re}, ${ie}: ${((V=He[ze])==null?void 0:V.name)||"Unknown"}`,children:((H=He[ze])==null?void 0:H.symbol)||""},`${Re}-${ie}`)})},ie))})}),o.jsx("button",{onClick:()=>x(!0),className:"mt-4 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"Edit Map"})]}):o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-slate-400 mb-4",children:"No map created yet."}),o.jsx("button",{onClick:()=>x(!0),className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300",children:"Create Map"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[o.jsx("div",{className:"lg:col-span-1",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:"Party Members"}),o.jsx("div",{className:"space-y-3",children:a.map(G=>o.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"font-semibold text-slate-100",children:G.name}),o.jsxs("p",{className:"text-sm text-slate-400",children:[G.class,"  Level ",G.level]})]}),o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"text-sm text-slate-300",children:["HP: ",G.hp,"/",G.maxHp]}),o.jsxs("div",{className:"text-xs text-slate-400",children:["AC: ",G.ac]})]})]})},G.id))})]})}),o.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:"Current Scene"}),o.jsx("textarea",{value:h,onChange:G=>m(G.target.value),placeholder:"Describe the current scene, what the players see, hear, and feel...",className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50",rows:"4"}),o.jsxs("div",{className:"flex space-x-3 mt-4",children:[o.jsx("button",{onClick:Ze,className:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"Save Scene"}),o.jsx("button",{onClick:()=>T(!_),className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:_?"Hide Combat Setup":"Setup Combat"})]})]}),_&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:"Combat Setup"}),o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Enemy Details (one per line: Name, HP, AC, Level)"}),o.jsx("textarea",{value:p,onChange:G=>y(G.target.value),placeholder:`Goblin, 15, 12, 1
Orc Warrior, 25, 14, 2
Dragon, 100, 18, 5`,className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50",rows:"4"})]}),o.jsx("button",{onClick:Bn,disabled:s,className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 disabled:opacity-50",children:s?"Starting Combat...":"Start Combat"})]}),(c==null?void 0:c.storyHistory)&&c.storyHistory.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:"Story History"}),o.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:c.storyHistory.map((G,ie)=>{var ze,Re,Pe;return o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-3",children:[o.jsx("div",{className:"text-xs text-slate-400 mb-1",children:((Pe=(Re=(ze=G.timestamp)==null?void 0:ze.toDate)==null?void 0:Re.call(ze))==null?void 0:Pe.toLocaleString())||"Unknown time"}),o.jsx("p",{className:"text-slate-200 text-sm",children:G.content})]},ie)})})]})]})]}),E&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"fantasy-card max-w-6xl w-full max-h-[95vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Grid-Based Map Editor"}),o.jsx("button",{onClick:()=>x(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:""})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[o.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Map Title"}),o.jsx("input",{type:"text",value:P,onChange:G=>M(G.target.value),className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50",placeholder:"Enter map title..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Map Size"}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Width"}),o.jsx("input",{type:"number",min:"5",max:"30",value:$.width,onChange:G=>{I(ie=>({...ie,width:parseInt(G.target.value)})),yt()},className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Height"}),o.jsx("input",{type:"number",min:"5",max:"20",value:$.height,onChange:G=>{I(ie=>({...ie,height:parseInt(G.target.value)})),yt()},className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50"})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Tools"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{onClick:()=>R("draw"),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${N==="draw"?"bg-amber-500/20 text-amber-300 border border-amber-500/30":"bg-slate-700/30 text-slate-300 hover:bg-slate-700/50"}`,children:" Draw"}),o.jsx("button",{onClick:()=>R("erase"),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${N==="erase"?"bg-red-500/20 text-red-300 border border-red-500/30":"bg-slate-700/30 text-slate-300 hover:bg-slate-700/50"}`,children:" Erase"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Tiles"}),o.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-96 overflow-y-auto",children:Object.entries(He).map(([G,ie])=>o.jsxs("button",{onClick:()=>C(G),className:`p-2 rounded-lg border transition-colors ${b===G?"border-amber-500 bg-amber-500/20":"border-slate-600 bg-slate-700/30 hover:border-slate-500"}`,children:[o.jsx("div",{className:`w-6 h-6 ${ie.color} rounded flex items-center justify-center text-xs mx-auto mb-1`,children:ie.symbol}),o.jsx("div",{className:"text-xs text-slate-300 truncate",children:ie.name})]},G))})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{onClick:Qt,className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"Clear Map"}),o.jsx("button",{onClick:dt,className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"Save Map"})]})]}),o.jsxs("div",{className:"lg:col-span-3",children:[o.jsx("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4 overflow-auto",children:o.jsx("div",{className:"inline-block",children:v.map((G,ie)=>o.jsx("div",{className:"flex",children:G.map((ze,Re)=>{var Pe,V,H;return o.jsxs("button",{onMouseDown:()=>Zn(Re,ie),onMouseEnter:()=>nn(Re,ie),onMouseUp:Qe,onContextMenu:me=>Xe(Re,ie,me),className:`w-10 h-10 border border-slate-600 flex items-center justify-center text-sm transition-colors hover:border-amber-400 relative select-none ${((Pe=He[ze])==null?void 0:Pe.color)||"bg-slate-700"}`,title:`${Re}, ${ie}: ${((V=He[ze])==null?void 0:V.name)||"Unknown"}${Mn(Re,ie)?" (Right-click for sub-map)":" (Right-click to create sub-map)"}`,children:[((H=He[ze])==null?void 0:H.symbol)||"",Mn(Re,ie)&&o.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-purple-500 rounded-full flex items-center justify-center text-[10px] text-white",children:""})]},`${Re}-${ie}`)})},ie))})}),o.jsxs("div",{className:"mt-2 text-xs text-slate-400 text-center",children:["Click or drag to place/remove tiles. Current tool: ",N==="draw"?"Draw":"Erase"," | Selected tile: ",(Ee=He[b])==null?void 0:Ee.name]})]})]})]})}),D&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"fantasy-card max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h2",{className:"text-2xl font-bold text-slate-100",children:["Sub-Map Editor - Tile (",je.x,", ",je.y,")"]}),o.jsx("button",{onClick:()=>k(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:""})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[o.jsx("div",{className:"lg:col-span-2",children:o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Sub-Map (8x8)"}),o.jsx("button",{onClick:hn,className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm",children:"Clear"})]}),o.jsx("div",{className:"grid grid-cols-8 gap-1 mb-4",children:Q.map((G,ie)=>G.map((ze,Re)=>{var Pe,V,H;return o.jsx("button",{onMouseDown:()=>_n(Re,ie),onMouseEnter:()=>dn(Re,ie),onMouseUp:Qe,className:`w-12 h-12 border border-slate-600 flex items-center justify-center text-lg transition-colors hover:border-amber-400 select-none ${((Pe=He[ze])==null?void 0:Pe.color)||"bg-slate-700"}`,title:`${Re}, ${ie}: ${((V=He[ze])==null?void 0:V.name)||"Empty"}`,children:((H=He[ze])==null?void 0:H.symbol)||""},`sub-${Re}-${ie}`)}))})]})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tools"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{onClick:()=>R("draw"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${N==="draw"?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:" Draw"}),o.jsx("button",{onClick:()=>R("erase"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${N==="erase"?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:" Erase"})]})]}),o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tile Types"}),o.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-80 overflow-y-auto",children:Object.entries(He).map(([G,ie])=>o.jsxs("button",{onClick:()=>C(G),className:`p-2 rounded text-sm font-medium transition-colors flex items-center gap-2 ${b===G?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[o.jsx("span",{className:"text-lg",children:ie.symbol}),o.jsx("span",{className:"truncate",children:ie.name})]},G))})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:Yt,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded font-medium",children:"Save Sub-Map"}),o.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded font-medium",children:"Cancel"})]})]})]})]})})]})})}function UV({deadPlayer:n,combatSession:e,onSpectate:t}){var c,d;const[r,s]=A.useState(0);A.useEffect(()=>{const h=setInterval(()=>{s(m=>m+1)},1e3);return()=>clearInterval(h)},[]);const i=h=>{const m=Math.floor(h/60),p=h%60;return`${m}:${p.toString().padStart(2,"0")}`},a=((c=e==null?void 0:e.partyMembers)==null?void 0:c.filter(h=>h.hp>0))||[],l=((d=e==null?void 0:e.enemies)==null?void 0:d.filter(h=>h.hp>0))||[];return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card bg-red-50 border-red-200",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h1",{className:"text-3xl font-bold text-red-800 mb-4",children:"Character Death"}),o.jsxs("div",{className:"text-xl text-red-700 mb-6",children:[n.name," has fallen in battle..."]}),o.jsxs("div",{className:"bg-white p-6 rounded-lg border border-red-300 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-stone-800 mb-2",children:"Fallen Hero"}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Name:"})," ",n.name]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Class:"})," ",n.class]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Level:"})," ",n.level]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Final HP:"})," ",n.hp,"/",n.maxHp]}),o.jsxs("p",{className:"text-stone-600",children:[o.jsx("strong",{children:"Time of Death:"})," ",i(r)]})]}),o.jsxs("div",{className:"bg-gray-100 p-6 rounded-lg border border-gray-300 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Combat Status"}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"font-semibold text-green-700",children:"Alive Allies"}),o.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.length}),o.jsx("div",{className:"text-xs text-gray-600 mt-1",children:a.map(h=>h.name).join(", ")})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"font-semibold text-red-700",children:"Remaining Enemies"}),o.jsx("p",{className:"text-2xl font-bold text-red-600",children:l.length}),o.jsx("div",{className:"text-xs text-gray-600 mt-1",children:l.map(h=>h.name).join(", ")})]})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[o.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"What happens next?"}),o.jsxs("ul",{className:"text-blue-700 text-sm space-y-1",children:[o.jsx("li",{children:" You must wait for combat to end"}),o.jsx("li",{children:" If your allies win, you'll create a new character"}),o.jsx("li",{children:" If all allies die, the campaign ends"}),o.jsx("li",{children:" Your new character will join the story where it left off"})]})]}),o.jsx("button",{onClick:t,className:"fantasy-button bg-gray-600 hover:bg-gray-700 text-white",children:"Spectate Combat"})]})]})})})}function BV({story:n,deadCharacters:e,combatSummary:t}){var i;const r=yr(),s=()=>{r("/dashboard")};return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-8xl mb-6",children:""}),o.jsx("h1",{className:"text-4xl font-bold text-red-300 mb-4",children:"Campaign Defeat"}),o.jsx("div",{className:"text-xl text-red-200 mb-8",children:"The party has fallen... The story ends here."}),o.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg border border-red-600 mb-6 text-left",children:[o.jsx("h2",{className:"text-2xl font-semibold text-gray-100 mb-4",children:"The Complete Story"}),o.jsx("div",{className:"space-y-4 text-gray-300",children:(i=n==null?void 0:n.storyMessages)==null?void 0:i.map((a,l)=>o.jsxs("div",{className:"border-l-2 border-gray-600 pl-4",children:[o.jsxs("p",{className:"font-semibold text-gray-200",children:[a.sender,":"]}),o.jsx("p",{children:a.content})]},l))})]}),o.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg border border-red-600 mb-6",children:[o.jsx("h2",{className:"text-2xl font-semibold text-gray-100 mb-4",children:"Fallen Heroes"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e==null?void 0:e.map((a,l)=>o.jsxs("div",{className:"bg-red-900/30 p-4 rounded border border-red-600",children:[o.jsx("h3",{className:"text-lg font-semibold text-red-200 mb-2",children:a.name}),o.jsxs("p",{className:"text-gray-300 mb-1",children:[o.jsx("strong",{children:"Class:"})," ",a.class]}),o.jsxs("p",{className:"text-gray-300 mb-1",children:[o.jsx("strong",{children:"Level:"})," ",a.level]}),o.jsxs("p",{className:"text-gray-300 mb-1",children:[o.jsx("strong",{children:"Final HP:"})," ",a.hp,"/",a.maxHp]}),o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"Cause of Death:"})," ",a.deathCause||"Combat wounds"]})]},l))})]}),t&&o.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg border border-red-600 mb-6",children:[o.jsx("h2",{className:"text-2xl font-semibold text-gray-100 mb-4",children:"Final Battle"}),o.jsxs("div",{className:"text-gray-300 space-y-2",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Duration:"})," ",t.duration," rounds"]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Result:"})," ",t.result]}),t.narrative&&o.jsx("p",{className:"italic",children:t.narrative})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-gray-300",children:"The adventure has ended, but new stories await..."}),o.jsx("button",{onClick:s,className:"fantasy-button bg-amber-600 hover:bg-amber-700 text-white px-8 py-3 text-lg",children:"Begin a New Adventure"})]})]})})})}function zV(){var er,Ye,xt,Tt,qe,vr;const{sessionId:n}=wc(),e=yr(),t=hs(),[r,s]=A.useState(null),[i,a]=A.useState(null),[l,c]=A.useState(!0),[d,h]=A.useState([]),[m,p]=A.useState(null),[y,_]=A.useState(null),[T,E]=A.useState(""),[x,v]=A.useState(""),[S,P]=A.useState([]),[M,$]=A.useState([]),[I,b]=A.useState([]),[C,N]=A.useState(!1),[R,D]=A.useState(""),[k,je]=A.useState(""),[K,re]=A.useState(!1),[_e,Q]=A.useState(!1),[J,ne]=A.useState(null),[Ne,Ae]=A.useState(!1),[Fe,ut]=A.useState([]),[He,Pt]=A.useState(null),[dt,Xn]=A.useState(null),[Zn,nn]=A.useState(!1),[Qe,Qt]=A.useState(-1),[yt,Xe]=A.useState(null),[rn,vt]=A.useState(!1),[_n,dn]=A.useState(!1),[Yt,hn]=A.useState(new Set),[Mn,En]=A.useState([]),[Ze,Bn]=A.useState(!1),Mt=A.useRef(null),Ee=(er=t.state)==null?void 0:er.isTestCombat,G=t.state;A.useEffect(()=>{const j=Bo(B=>{if(!B){e("/login");return}s(B)});return()=>j()},[e]),A.useEffect(()=>{Ee&&G?ie():n&&(async()=>(console.log(" Force refreshing combat data for session:",n),await ze()))()},[Ee,G,n]),A.useEffect(()=>{const j=async()=>{console.log(" Help button: Force refreshing combat session..."),await ze()},B=async()=>{i!=null&&i.partyId&&(console.log(" Help button: Force cleaning up all combat sessions..."),await zn.forceCleanupCombatSessions(i.partyId),setTimeout(async()=>{await ze()},1e3))};return window.addEventListener("refreshCombatSession",j),window.addEventListener("cleanupCombatSessions",B),()=>{window.removeEventListener("refreshCombatSession",j),window.removeEventListener("cleanupCombatSessions",B)}},[i==null?void 0:i.partyId]),A.useEffect(()=>{if(n&&!Ee){Mt.current&&(console.log(" Cleaning up existing subscription"),Mt.current(),Mt.current=null),console.log(" Setting up combat session subscription for:",n);const j=uS(n,B=>{var ue;console.log(" Combat session update received:",{currentTurn:B==null?void 0:B.currentTurn,lastProcessedTurn:Qe,combatState:B==null?void 0:B.combatState,combatants:(ue=B==null?void 0:B.combatants)==null?void 0:ue.map(be=>({name:be.name,hp:be.hp,isEnemy:be.id.startsWith("enemy_")})),sessionId:n,isTestCombat:Ee}),a(B),c(!1),(B==null?void 0:B.currentTurn)!==void 0&&(Qe!==B.currentTurn&&!K?(console.log(" Updating lastProcessedTurn from",Qe,"to",B.currentTurn),Qt(B.currentTurn)):K&&Qe===B.currentTurn&&(console.log(" Turn processing completed, updating lastProcessedTurn to",B.currentTurn),Qt(B.currentTurn))),B&&(B.battleLog&&B.battleLog.length>0&&En(B.battleLog),Re(B),$(B.environmentalFeatures||[]),b(B.teamUpOpportunities||[]),F())});return Mt.current=j,()=>{console.log(" Component unmounting, cleaning up subscription"),Mt.current&&(Mt.current(),Mt.current=null)}}},[n,Ee]),A.useEffect(()=>{var j;if(console.log(" Co-op mode turn check:",{combatSession:i?{currentTurn:i.currentTurn,combatState:i.combatState,combatants:(j=i.combatants)==null?void 0:j.map(B=>({name:B.name,hp:B.hp,isEnemy:B.id.startsWith("enemy_")}))}:null,lastProcessedTurn:Qe,processingTurn:K,isEnemyTurn:C,isTestCombat:Ee}),i&&i.combatState==="active"){const B=W();if(console.log(" Current combatant check:",{currentCombatant:B?{name:B.name,id:B.id,isEnemy:B.id.startsWith("enemy_"),hp:B.hp}:null,currentTurn:i.currentTurn,lastProcessedTurn:Qe,shouldProcess:B&&B.id.startsWith("enemy_")&&i.currentTurn!==Qe&&!K&&!C}),B&&B.id.startsWith("enemy_")&&i.currentTurn!==Qe&&!K&&!C){console.log(" Scheduling enemy turn processing for:",B.name);const be=setTimeout(()=>{Te()},Ee?2e3:1e3);return()=>clearTimeout(be)}B&&B.id.startsWith("enemy_")&&i.currentTurn===Qe&&!K&&!C&&(console.log(" Safety check: Enemy turn appears stuck, forcing turn advance"),setTimeout(()=>{et()},3e3))}},[i==null?void 0:i.currentTurn,Qe,K,C,Ee,i==null?void 0:i.combatants]),A.useEffect(()=>{i&&_n&&de()&&setTimeout(()=>{dn(!1),hn(new Set),et()},1e3)},[_n,Yt.size,(Ye=i==null?void 0:i.partyMembers)==null?void 0:Ye.length]),A.useEffect(()=>{i&&Re(i)},[i==null?void 0:i.currentTurn,i==null?void 0:i.combatState]),A.useEffect(()=>{if(i&&i.combatState==="active"&&i.combatants){const j=i.combatants.filter(ee=>!ee.id.startsWith("enemy_")),B=i.combatants.filter(ee=>ee.id.startsWith("enemy_")),ue=j.some(ee=>ee.hp>0),be=B.some(ee=>ee.hp>0);ue?be||(Ee?e("/test-environment",{state:{...G,combatResult:"victory"}}):Bt("victory")):Ee?e("/test-environment",{state:{...G,combatResult:"defeat"}}):Ut()}},[i==null?void 0:i.combatants,i==null?void 0:i.combatState]);const ie=async()=>{try{c(!0);const B={id:"test_combat_session",partyMembers:G.partyMembers.map(ee=>{if(!ee.hp||!ee.maxHp||!ee.ac){const{class:xe,level:ge,constitution:rt,dexterity:Ve}=ee,qt={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[xe]||8,zo=Math.floor((rt-10)/2),fa=Math.max(1,(qt+zo)*ge),qc=10,Wc=Math.floor((Ve-10)/2),pa={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[xe]||0,Hc=Math.max(10,qc+Wc+pa);return{...ee,hp:fa,maxHp:fa,ac:Hc}}return ee})||[],enemies:G.enemies||[],storyContext:G.storyContext||"Test combat environment",combatState:"initialized",currentTurn:0,combatants:[],round:1};if(!B.enemies||B.enemies.length===0){a({...B,status:"no_enemies",combatState:"ended"}),c(!1);return}const ue=zn.initializeCombat(B.partyMembers,B.enemies,B.storyContext),be={...B,...ue,currentTurn:0,combatState:"active"};a(be),c(!1),Re(be),$(be.environmentalFeatures||[]),b(be.teamUpOpportunities||[])}catch(j){console.error("Error initializing test combat:",j),c(!1)}},ze=async()=>{if(n)try{c(!0);const j=Date.now();console.log(` Loading combat data with cache buster: ${j}`);const[B,ue]=await Promise.all([cS(n),Za(n)]);if(Xn(ue),!B){console.error("No combat session found with ID:",n),e("/dashboard");return}const be=B.partyId,ee=await ui(be);try{await gS(be);const ge=await ui(be);h(ge)}catch(ge){console.warn("Failed to update character stats:",ge),h(ee)}if(B.enemies&&B.enemies.length===0&&!Ee){a({...B,status:"no_enemies"});return}let xe=B.combatants||[];if(xe.length===0){const ge=(B.partyMembers||[]).map(Ve=>({...Ve,isEnemy:!1,userId:Ve.userId,cooldowns:Ve.cooldowns||{},statusEffects:Ve.statusEffects||[],hp:Ve.hp??Ve.maxHp??10,maxHp:Ve.maxHp??Ve.hp??10})),rt=(B.enemies||[]).map(Ve=>({...Ve,isEnemy:!0,userId:null,cooldowns:Ve.cooldowns||{},statusEffects:Ve.statusEffects||[],hp:Ve.hp??Ve.maxHp??10,maxHp:Ve.maxHp??Ve.hp??10}));xe=[...ge,...rt]}if(B.combatState==="initialized"){const ge={...B,combatants:xe,combatState:"active",currentTurn:0,round:1};await ki(n,ge),a(ge),Re(ge),$(ge.environmentalFeatures||[]),b(ge.teamUpOpportunities||[])}else{const ge={...B,combatants:xe};a(ge),Re(ge),$(ge.environmentalFeatures||[]),b(ge.teamUpOpportunities||[])}}catch(j){console.error("Error loading combat data:",j)}finally{c(!1)}},Re=j=>{var xe;const B=W(j);if(!B)return;const ue=[],be=B.cooldowns||{};Object.entries(zn.actionTypes).forEach(([ge,rt])=>{(be[ge]===0||be[ge]===void 0)&&ue.push({type:ge,name:rt.name,description:rt.description,priority:rt.priority,narrativeTemplate:rt.narrativeTemplate})});const ee=zn.classAbilities[(xe=B.class)==null?void 0:xe.toLowerCase()];ee&&(be.special===0||be.special===void 0)&&ue.push({type:"special",name:ee.name,description:ee.description,priority:"high",narrativeTemplate:"{character} uses their {ability}!"}),M.length>0&&ue.push({type:"environmental",name:"Use Environment",description:"Use the environment to your advantage",priority:"normal",narrativeTemplate:"{character} uses the {environment} to their advantage!"}),I.length>0&&ue.push({type:"teamUp",name:"Team Up",description:"Coordinate with another party member",priority:"high",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}),P(ue)},Pe=async j=>{const B=new Date().toLocaleTimeString(),ue={id:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:B,round:(i==null?void 0:i.round)||1,turn:(i==null?void 0:i.currentTurn)||0,...j};if(En(be=>[...be,ue]),!Ee&&n)try{await fS(n,ue)}catch(be){console.error("Failed to save battle log to database:",be)}},V=async()=>{if(i)try{re(!0),En([]);const j={...i,combatState:"ready",currentTurn:0,round:1};Ee?(a(j),Re(j)):await ki(n,j),await Pe({type:"combat_start",description:"Combat is ready to begin!"})}catch(j){console.error("Error starting combat:",j)}finally{re(!1)}},H=async()=>{if(i)try{re(!0);const j={...i,combatState:"active"};Ee?(a(j),Re(j)):await ki(n,j),await Pe({type:"combat_begin",description:"Fight!"}),Bn(!0)}catch(j){console.error("Error beginning combat:",j)}finally{re(!1)}},me=async(j,B,ue={})=>{var be;if(console.log(" executeAction called:",{actionType:j,targetId:B,isCurrentUserTurn:Y(),currentTurn:i==null?void 0:i.currentTurn,currentCombatant:(be=W())==null?void 0:be.name}),!(!i||!Y()))try{re(!0);const ee=W(),xe=i.combatants.find(Jt=>Jt.id===B),ge=await zn.executeAction(i,ee.id,j,B,ue),rt={...i,currentTurn:ge.updatedSession.currentTurn,round:ge.updatedSession.round,combatants:ge.updatedSession.combatants};if(console.log(" Action executed, updating session:",{oldTurn:i.currentTurn,newTurn:ge.updatedSession.currentTurn,isTestCombat:Ee,sessionId:n}),Ee)a(rt);else{const Jt={currentTurn:ge.updatedSession.currentTurn,round:ge.updatedSession.round,combatants:ge.updatedSession.combatants};console.log(" Sending database update:",Jt),await ki(n,Jt),console.log(" Database update completed")}await Pe({type:ge.success?"action":"action_failed",description:ge.narrative}),ge.damage>0&&xe&&await Pe({type:"damage",description:`${xe.name} takes ${ge.damage} damage!`}),ge.healing>0&&xe&&await Pe({type:"healing",description:`${xe.name} is healed for ${ge.healing} HP!`}),E(ge.narrative),ge.description&&v(ge.description);const Ve=zn.checkCombatEnd(rt);if(Ve.ended){Ee?e("/test-environment",{state:{...G,combatResult:Ve.result}}):await Bt(Ve.result);return}ee.id.startsWith("enemy_")&&(dn(!0),D(ge.narrative),je(ge.description)),ge.damage>0&&xe&&(Xe({targetId:xe.id,damage:ge.damage,type:"damage"}),vt(!0),setTimeout(()=>vt(!1),2e3)),ge.healing>0&&xe&&(Xe({targetId:xe.id,healing:ge.healing,type:"healing"}),vt(!0),setTimeout(()=>vt(!1),2e3)),p(null),_(null)}catch(ee){console.error("Error executing action:",ee),Pe({type:"error",description:"An error occurred while executing the action."})}finally{re(!1)}},Te=async()=>{if(console.log(" processEnemyTurn called"),!i||i.combatState!=="active"){console.log(" Combat not active, returning");return}const j=W();if(console.log(" Current combatant:",j),!j||!j.id.startsWith("enemy_")){console.log(" Not enemy turn, returning");return}console.log(" Processing enemy turn for:",j.name);try{re(!0),N(!0),Pe({type:"turn_start",actor:j.name,description:`${j.name}'s turn begins`}),console.log(" Choosing enemy action for:",j.name);const B=zn.chooseEnemyAction(j,i);if(console.log(" Selected action:",B),!B){console.log(" No action selected, advancing turn"),setTimeout(()=>{et()},1e3);return}const ue=B.action,be=B.target;if(!ue){setTimeout(()=>{et()},1e3);return}const ee=i.combatants.find(ge=>ge.id===be);if(!ee&&ue!=="defend"){setTimeout(()=>{et()},1e3);return}Pe({type:"action",actor:j.name,action:ue,target:(ee==null?void 0:ee.name)||"self",description:`${j.name} uses ${ue}${ee?` on ${ee.name}`:""}`}),console.log(" Executing enemy action:",{combatant:j.name,action:ue,target:be,additionalData:B});const xe=await zn.executeAction(i,j.id,ue,be,B);if(console.log(" Action result:",xe),xe.success){const ge={...i,currentTurn:xe.updatedSession.currentTurn,round:xe.updatedSession.round,combatants:xe.updatedSession.combatants};if(Ee)a(ge);else{const Jt={currentTurn:xe.updatedSession.currentTurn,round:xe.updatedSession.round,combatants:xe.updatedSession.combatants};await ki(n,Jt)}xe.damage&&Pe({type:"damage",actor:j.name,target:(ee==null?void 0:ee.name)||"self",damage:xe.damage,description:`${j.name} deals ${xe.damage} damage to ${(ee==null?void 0:ee.name)||"self"}`}),xe.healing&&Pe({type:"healing",actor:j.name,target:(ee==null?void 0:ee.name)||"self",healing:xe.healing,description:`${j.name} heals ${(ee==null?void 0:ee.name)||"self"} for ${xe.healing} HP`}),xe.statusEffects&&xe.statusEffects.length>0&&xe.statusEffects.forEach(Jt=>{Pe({type:"status_effect",actor:j.name,target:(ee==null?void 0:ee.name)||"self",effect:Jt.type,description:`${(ee==null?void 0:ee.name)||"self"} is affected by ${Jt.type}`})}),xe.targetDied&&Pe({type:"death",actor:j.name,target:(ee==null?void 0:ee.name)||"self",description:`${(ee==null?void 0:ee.name)||"self"} has been defeated!`}),xe.damage&&ee&&(Xe({targetId:ee.id,damage:xe.damage,type:"damage"}),vt(!0),setTimeout(()=>vt(!1),2e3)),xe.healing&&ee&&(Xe({targetId:ee.id,damage:xe.healing,type:"healing"}),vt(!0),setTimeout(()=>vt(!1),2e3));const rt=zn.generateActionNarrative(j,ue,ee,B);if(D(`${j.name} uses ${ue}!`),je(rt),xe.combatEnded){console.log("Combat ended"),Ee?e("/test-environment",{state:{...G,combatResult:xe.combatResult}}):await Bt(xe.combatResult);return}if(ge.combatants.filter(Jt=>!Jt.id.startsWith("enemy_")&&Jt.hp>0).length===0){console.log("All players dead, ending combat"),Ee?e("/test-environment",{state:{...G,combatResult:"defeat"}}):await Bt("defeat");return}Qt(i.currentTurn)}else console.error("Enemy action execution failed:",xe.error),Pe({type:"action_failed",actor:j.name,action:ue,description:`${j.name}'s ${ue} failed`}),setTimeout(()=>{et()},1e3)}catch(B){console.error("Error processing enemy turn:",B),Pe({type:"error",actor:j.name,description:`Error during ${j.name}'s turn`}),setTimeout(()=>{et()},1e3)}finally{re(!1),N(!1)}},et=async()=>{if(!i||i.combatState!=="active")return;const j=i.combatants.filter(qt=>!qt.id.startsWith("enemy_")),B=i.combatants.filter(qt=>qt.id.startsWith("enemy_")),ue=j.some(qt=>qt.hp>0),be=B.some(qt=>qt.hp>0);if(!ue){Ee?e("/test-environment",{state:{...G,combatResult:"defeat"}}):await Bt("defeat");return}if(!be){Ee?e("/test-environment",{state:{...G,combatResult:"victory"}}):await Bt("victory");return}let ee=(i.currentTurn+1)%i.combatants.length,xe=0;const ge=i.combatants.length;for(;xe<ge;){const qt=i.combatants[ee];if(qt&&qt.hp>0)break;ee=(ee+1)%i.combatants.length,xe++}if(xe>=ge){Ee?e("/test-environment",{state:{...G,combatResult:"draw"}}):await Bt("draw");return}const rt={currentTurn:ee};ee===0&&(rt.round=i.round+1),console.log(" Advancing turn:",{currentTurn:i.currentTurn,nextTurn:ee,updates:rt,isTestCombat:Ee,sessionId:n}),Ee?a(qt=>({...qt,...rt})):(console.log(" Sending advanceTurn database update:",rt),await ki(n,rt),console.log(" AdvanceTurn database update completed")),Qt(ee);const Ve=i.combatants[ee];Ve&&await Pe({type:"turn_advance",description:` ${Ve.name}'s turn begins`});const Jt={...i,...rt};Re(Jt)},Ut=async()=>{if(!i||!dt)return;const j=zn.generateCombatSummary(i,"defeat"),B=i.partyMembers.filter(ue=>ue.hp<=0);Pt(j),ut(B),Ae(!0),await hp(n,{status:"ended",combatState:"ended",summary:j}),await Ht(n,{status:"defeated",currentCombat:null})},Bt=async(j="victory")=>{if(!i)return;const B=zn.generateCombatSummary(i,j);if(Ee)a(ue=>({...ue,status:"ended",combatState:"ended",summary:B})),e("/test-environment");else{await hp(n,{status:"ended",combatState:"ended",summary:B});const ue=i.partyMembers.filter(be=>be.hp<=0);if(ue.length>0){await Ht(n,{status:"storytelling",currentCombat:null,deadPlayers:ue.map(ee=>({userId:ee.userId,name:ee.name,class:ee.class,level:ee.level,deathCause:"Combat wounds"}))});const be=ue.find(ee=>ee.userId===(r==null?void 0:r.uid));e(be?`/character-creation/${i.partyId}`:`/campaign/${n}`)}else await Ht(n,{status:"storytelling",currentCombat:null}),e(`/campaign/${n}`)}},W=(j=i)=>{if(!j)return null;const B=j.combatants||[],ue=j.currentTurn||0;return B.length===0||ue>=B.length?null:B[ue]},Y=()=>{const j=W();if(!j)return console.log(" No current combatant found"),!1;if(Ee){const ue=!j.isEnemy;return console.log(" Test mode turn check:",{currentCombatant:j.name,isEnemy:j.isEnemy,isCurrentUserTurn:ue}),ue}const B=j.userId===(r==null?void 0:r.uid);return console.log(" Co-op mode turn check:",{currentCombatant:j.name,currentCombatantUserId:j.userId,currentUserId:r==null?void 0:r.uid,isCurrentUserTurn:B}),B},F=()=>{if(i){if(Ee){const j=i.combatants.find(B=>!B.isEnemy);j&&j.hp<=0&&(Q(!0),ne(j))}else if(r){const j=i.partyMembers.find(B=>B.userId===r.uid)||i.combatants.find(B=>B.userId===r.uid&&!B.isEnemy);j&&j.hp<=0&&(Q(!0),ne(j))}}},q=()=>{Ee&&e("/dashboard")},le=()=>{nn(!0),Q(!1)},fe=()=>{if(Ee)dn(!1),hn(new Set),et();else{const j=r==null?void 0:r.uid;j&&hn(B=>new Set([...B,j]))}},de=()=>{if(Ee)return!0;if(!(i!=null&&i.partyMembers))return!1;const j=i.partyMembers.filter(ue=>ue.hp>0);return Yt.size>=j.length},Se=Array.isArray(i==null?void 0:i.combatants)?i.combatants:Array.isArray(i==null?void 0:i.partyMembers)&&Array.isArray(i==null?void 0:i.enemies)?[...i.partyMembers.map(j=>({...j,isEnemy:!1,userId:j.userId,cooldowns:j.cooldowns||{},statusEffects:j.statusEffects||[],hp:j.hp??j.maxHp??1,maxHp:j.maxHp??j.hp??1})),...i.enemies.map(j=>({...j,isEnemy:!0,userId:null,cooldowns:j.cooldowns||{},statusEffects:j.statusEffects||[],hp:j.hp??j.maxHp??1,maxHp:j.maxHp??j.hp??1}))]:[],zt=j=>{if(!j||!Se.length)return[];const B=Se.filter(ee=>ee.hp>0),ue=W();if(!ue)return[];const be=!ue.id.startsWith("enemy_");switch(j){case"attack":case"spell":case"special":return be?B.filter(ee=>ee.id.startsWith("enemy_")):B.filter(ee=>!ee.id.startsWith("enemy_"));case"heal":case"item":return be?B.filter(ee=>!ee.id.startsWith("enemy_")&&ee.id!==ue.id):B.filter(ee=>ee.id.startsWith("enemy_")&&ee.id!==ue.id);case"defend":case"environmental":return[ue];case"teamUp":return be?B.filter(ee=>!ee.id.startsWith("enemy_")&&ee.id!==ue.id):B.filter(ee=>ee.id.startsWith("enemy_")&&ee.id!==ue.id);default:return B}},sn=Array.isArray(i==null?void 0:i.enemies)?i.enemies:[];if(!r)return null;if(l)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Loading Combat..."}),o.jsx("p",{className:"text-gray-300 mb-6",children:"Preparing the battlefield and gathering combatants..."}),o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto"})]})})});if(!i)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("div",{className:"text-gray-400",children:"No active combat session found."})})})});if((i.status==="no_enemies"||sn.length===0)&&!Ee)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"No Enemies to Fight"}),o.jsx("p",{className:"text-gray-300 mb-6",children:"There are no enemies present in this area. Combat cannot begin."}),o.jsx("p",{className:"text-gray-400 text-sm",children:"The combat session will end automatically."})]})})});const De=W();return Ne?o.jsx(BV,{story:dt,deadCharacters:Fe,combatSummary:He}):_e&&J&&!Zn?o.jsx(UV,{deadPlayer:J,combatSession:i,onSpectate:le}):o.jsx("div",{className:"min-h-screen bg-gray-900 text-gray-100 p-4",children:o.jsxs("div",{className:"fantasy-container py-4",children:[o.jsxs("div",{className:"mb-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:" Combat Arena"}),De&&o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"text-2xl font-bold text-amber-400",children:[" ",De.name,"'s Turn"]}),o.jsxs("div",{className:"text-sm text-gray-400",children:["Round ",(i==null?void 0:i.round)||1,"  Turn ",((i==null?void 0:i.currentTurn)||0)+1]})]})]}),i.storyContext&&o.jsxs("div",{className:"fantasy-card mb-4 bg-gray-800/50 border-gray-600",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-2",children:" Story Context"}),o.jsx("p",{className:"text-gray-300 italic",children:i.storyContext})]})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[o.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[Se.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3 text-sm",children:" Turn Order"}),o.jsx("div",{className:"space-y-1",children:Se.map((j,B)=>{var ue,be;return o.jsx("div",{className:`p-2 rounded border transition-colors text-xs ${j.id===((ue=Se[i.currentTurn])==null?void 0:ue.id)?"border-amber-500 bg-amber-900/20":j.hp<=0?"border-red-600 bg-red-900/20 opacity-50":"border-gray-600 bg-gray-700"}`,children:o.jsx("div",{className:"flex justify-between items-center",children:o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"font-medium text-gray-100 truncate",children:[j.name,j.id===((be=Se[i.currentTurn])==null?void 0:be.id)&&o.jsx("span",{className:"ml-1 text-amber-400",children:""})]}),o.jsxs("div",{className:"text-gray-400",children:[j.hp,"/",j.maxHp," HP"]})]})})},j.id)})})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-sm font-semibold mb-2 text-yellow-400",children:" Battle Log"}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{onClick:()=>{const j=document.getElementById("battle-log-container");j&&(j.scrollTop-=50)},className:"absolute top-0 right-0 z-10 bg-gray-700 hover:bg-gray-600 text-gray-300 text-xs px-2 py-1 rounded-t transition-colors",children:""}),o.jsx("div",{id:"battle-log-container",className:"h-32 overflow-y-auto space-y-1 text-xs pr-8 scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:Mn.length===0?o.jsx("p",{className:"text-gray-400",children:"No actions recorded yet..."}):Mn.slice(-8).map(j=>o.jsxs("div",{className:"border-l-2 border-gray-600 pl-2 py-1",children:[o.jsx("div",{className:"flex justify-between items-start mb-1",children:o.jsxs("span",{className:"text-blue-400",children:["R",j.round]})}),o.jsx("div",{className:`${j.type==="damage"?"text-red-400":j.type==="healing"?"text-green-400":j.type==="death"?"text-red-500 font-semibold":j.type==="status_effect"?"text-purple-400":j.type==="action_failed"?"text-orange-400":j.type==="error"?"text-red-500":"text-gray-200"}`,children:j.description})]},j.id))}),o.jsx("button",{onClick:()=>{const j=document.getElementById("battle-log-container");j&&(j.scrollTop+=50)},className:"absolute bottom-0 right-0 z-10 bg-gray-700 hover:bg-gray-600 text-gray-300 text-xs px-2 py-1 rounded-b transition-colors",children:""})]})]})]}),o.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[(()=>De&&Se.length>0)()&&o.jsxs("div",{className:"fantasy-card bg-gray-800/50 border-gray-600",children:[o.jsxs("div",{className:"text-center mb-4",children:[o.jsxs("h2",{className:"text-xl font-bold text-amber-400 mb-1",children:[" ",De.name,"'s Turn"]}),o.jsx("p",{className:"text-gray-300 text-sm",children:Y()?"Select your action below":"Waiting for this player to act"})]}),Y()?o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-bold text-gray-100 mb-3 text-center",children:" Available Actions"}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:S.map((j,B)=>o.jsxs("button",{onClick:()=>p(j),className:`p-3 rounded-lg border-2 transition-all duration-200 text-left hover:scale-105 ${(m==null?void 0:m.type)===j.type?"border-amber-500 bg-amber-900/30 shadow-lg shadow-amber-500/20":"border-gray-600 bg-gray-700 hover:border-gray-500 hover:bg-gray-600"}`,children:[o.jsx("div",{className:"font-bold text-sm text-gray-100 mb-1",children:j.name}),o.jsx("div",{className:"text-xs text-gray-300 mb-1",children:j.description}),o.jsx("div",{className:"text-xs text-gray-400 bg-gray-800 px-1 py-0.5 rounded inline-block",children:j.priority})]},B))})]}),m&&o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-bold text-gray-100 mb-3 text-center",children:" Select Target"}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:zt(m.type).map(j=>o.jsxs("button",{onClick:()=>_(j),className:`p-3 rounded-lg border-2 transition-all duration-200 hover:scale-105 ${(y==null?void 0:y.id)===j.id?"border-red-500 bg-red-900/30 shadow-lg shadow-red-500/20":"border-gray-600 bg-gray-700 hover:border-gray-500 hover:bg-gray-600"}`,children:[o.jsx("div",{className:"font-bold text-sm text-gray-100 mb-1",children:j.name}),o.jsxs("div",{className:"text-xs text-gray-300 mb-1",children:["HP: ",j.hp,"/",j.maxHp," | AC: ",j.ac]}),o.jsx("div",{className:`text-xs px-1 py-0.5 rounded inline-block ${j.id.startsWith("enemy_")?"bg-red-900 text-red-200":"bg-blue-900 text-blue-200"}`,children:j.id.startsWith("enemy_")?" Enemy":" Ally"})]},j.id))}),zt(m.type).length===0&&o.jsx("div",{className:"text-center p-4 bg-gray-700 border border-gray-600 rounded-lg",children:o.jsx("p",{className:"text-gray-300",children:"No valid targets for this action."})})]}),m&&y&&o.jsx("div",{className:"text-center pt-6",children:o.jsx("button",{onClick:()=>me(m.type,y.id),disabled:K,className:"fantasy-button bg-amber-600 hover:bg-amber-700 text-xl font-bold px-8 py-4 shadow-lg hover:scale-105 transition-all duration-200",children:K?" Executing...":` Execute ${m.name}`})})]}):o.jsxs("div",{className:"bg-blue-900/20 border border-blue-700 rounded-lg p-8 text-center",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsxs("h3",{className:"text-2xl font-bold text-blue-300 mb-4",children:["Waiting for ",De.name," to act"]}),o.jsx("p",{className:"text-blue-200 text-lg",children:De.userId===(r==null?void 0:r.uid)?"It's your turn! Please select an action above.":"Please wait for the current player to make their move."})]})]}),(!Se.length||!sn.length)&&o.jsxs("div",{className:"fantasy-card bg-gray-800 border-gray-600",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3",children:"Combat Status"}),o.jsxs("div",{className:"text-gray-300 space-y-2",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Combat State:"})," ",i.combatState]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Combatants:"})," ",Se.length]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Enemies:"})," ",sn.length]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Current Turn:"})," ",i.currentTurn]}),i.combatState==="preparation"&&o.jsx("button",{onClick:V,className:"fantasy-button bg-yellow-600 hover:bg-yellow-700 mt-4",children:"Start Combat"})]})]}),T&&o.jsxs("div",{className:"fantasy-card bg-green-900/20 border-green-700",children:[o.jsx("h4",{className:"font-bold text-green-300 mb-2",children:"Action Result"}),o.jsx("p",{className:"text-green-200",children:T}),x&&o.jsx("div",{className:"mt-2 p-3 bg-gray-700 border border-green-600 rounded",children:o.jsx("p",{className:"text-gray-200 italic",children:x})})]}),C&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700 animate-pulse",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-red-300 mb-3 text-xl",children:" Enemy Turn"}),R&&o.jsx("div",{className:"text-red-200 font-bold text-lg mb-3 bg-gray-700 p-3 rounded border border-red-600",children:R}),k&&o.jsx("div",{className:"mt-3 p-4 bg-gray-700 border border-red-600 rounded",children:o.jsx("p",{className:"text-gray-200 italic",children:k})}),o.jsxs("div",{className:"mt-4 flex items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"}),o.jsx("span",{className:"ml-3 text-red-300 font-medium",children:"Enemy is acting..."})]})]})}),_n&&o.jsx("div",{className:"fantasy-card bg-blue-900/20 border-blue-700",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-blue-300 mb-3 text-xl",children:" Enemy Turn Complete"}),o.jsx("p",{className:"text-blue-200 mb-4",children:Ee?"The enemy has finished their turn. Click 'Confirm' to proceed to the next turn.":"The enemy has finished their turn. All party members must click 'Confirm' to proceed."}),!Ee&&o.jsxs("div",{className:"mb-4 p-3 bg-gray-700 border border-blue-600 rounded",children:[o.jsxs("p",{className:"text-sm text-blue-200",children:[o.jsx("strong",{children:"Ready to continue:"})," ",Yt.size," / ",((xt=i==null?void 0:i.partyMembers)==null?void 0:xt.filter(j=>j.hp>0).length)||0," party members"]}),Yt.size>0&&o.jsxs("div",{className:"mt-2 text-xs text-blue-300",children:["Waiting for: ",((vr=(qe=(Tt=i==null?void 0:i.partyMembers)==null?void 0:Tt.filter(j=>j.hp>0&&!Yt.has(j.userId)))==null?void 0:qe.map(j=>j.name))==null?void 0:vr.join(", "))||"None"]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center items-center",children:[o.jsx("button",{onClick:fe,disabled:!Ee&&Yt.has(r==null?void 0:r.uid),className:`fantasy-button px-8 py-3 text-lg font-semibold ${!Ee&&Yt.has(r==null?void 0:r.uid)?"bg-green-700 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 shadow-lg"}`,children:!Ee&&Yt.has(r==null?void 0:r.uid)?" Ready":"Confirm"}),Ee&&o.jsx("button",{onClick:()=>{dn(!1),hn(new Set),et()},className:"fantasy-button px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white",children:"Skip Confirmation"})]}),o.jsx("div",{className:"mt-4 p-3 bg-yellow-900/20 border border-yellow-600 rounded",children:o.jsxs("p",{className:"text-sm text-yellow-200",children:[o.jsx("strong",{children:"Note:"})," Review the battle log and enemy actions before continuing to the next turn."]})})]})}),K&&!C&&o.jsx("div",{className:"fantasy-card bg-amber-900/20 border-amber-700",children:o.jsxs("div",{className:"flex items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-amber-500"}),o.jsx("span",{className:"ml-2 text-amber-300 font-medium",children:"Processing turn..."})]})}),(i==null?void 0:i.combatState)==="ready"&&!Ze&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-red-300 mb-4 text-2xl",children:" Combat Ready!"}),o.jsx("p",{className:"text-red-200 mb-6 text-lg",children:"All combatants are in position. Click 'Fight!' to begin the battle."}),o.jsx("button",{onClick:H,disabled:K,className:"fantasy-button px-12 py-4 text-xl font-bold bg-red-600 hover:bg-red-700 shadow-lg",children:K?"Preparing...":"Fight!"})]})})]}),o.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3 text-sm",children:" Combat Status"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-blue-300 mb-2 text-xs",children:" Party"}),o.jsx("div",{className:"space-y-1",children:Se.filter(j=>!j.id.startsWith("enemy_")).map(j=>o.jsx("div",{className:`p-2 rounded border text-xs ${j.hp<=0?"bg-red-900/20 border-red-600":j.hp<j.maxHp*.5?"bg-yellow-900/20 border-yellow-600":"bg-blue-900/20 border-blue-600"} ${(De==null?void 0:De.id)===j.id?"ring-1 ring-amber-400":""}`,children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("span",{className:"font-medium text-gray-100 truncate",children:[j.name,(De==null?void 0:De.id)===j.id&&o.jsx("span",{className:"ml-1 text-amber-400",children:""})]}),o.jsxs("span",{className:`text-xs ${j.hp<=0?"text-red-400":j.hp<j.maxHp*.5?"text-yellow-400":"text-green-400"}`,children:[j.hp,"/",j.maxHp]})]})},j.id))})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-red-300 mb-2 text-xs",children:" Enemies"}),o.jsx("div",{className:"space-y-1",children:Se.filter(j=>j.id.startsWith("enemy_")).map(j=>o.jsx("div",{className:`p-2 rounded border text-xs ${j.hp<=0?"bg-red-900/20 border-red-600":j.hp<j.maxHp*.5?"bg-yellow-900/20 border-yellow-600":"bg-red-900/20 border-red-600"} ${(De==null?void 0:De.id)===j.id?"ring-1 ring-amber-400":""}`,children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("span",{className:"font-medium text-gray-100 truncate",children:[j.name,(De==null?void 0:De.id)===j.id&&o.jsx("span",{className:"ml-1 text-amber-400",children:""})]}),o.jsxs("span",{className:`text-xs ${j.hp<=0?"text-red-400":j.hp<j.maxHp*.5?"text-yellow-400":"text-red-400"}`,children:[j.hp,"/",j.maxHp]})]})},j.id))})]})]})]}),M.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-blue-300 mb-2 text-sm",children:" Environment"}),o.jsx("div",{className:"flex flex-wrap gap-1",children:M.map((j,B)=>o.jsx("span",{className:"px-2 py-1 bg-blue-900 text-blue-200 rounded text-xs",children:j},B))})]}),I.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-purple-300 mb-2 text-sm",children:" Team Up"}),o.jsx("div",{className:"space-y-1",children:I.map((j,B)=>o.jsxs("div",{className:"text-purple-200 text-xs",children:[o.jsxs("strong",{children:[j.classes.join("+"),":"]})," ",j.description]},B))})]}),rn&&yt&&o.jsx("div",{className:"fixed inset-0 pointer-events-none z-50 flex items-center justify-center",children:o.jsxs("div",{className:`text-6xl font-bold animate-bounce px-6 py-4 rounded-lg shadow-lg ${yt.type==="damage"?"text-red-400 bg-red-900/80":"text-green-400 bg-green-900/80"}`,children:[yt.type==="damage"?"-":"+",yt.damage]})}),_e&&J&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h1",{className:"text-3xl font-bold text-red-300 mb-4",children:"Character Death"}),o.jsxs("div",{className:"text-xl text-red-200 mb-6",children:[J.name," has fallen in battle..."]}),o.jsxs("div",{className:"bg-gray-700 p-6 rounded-lg border border-red-600 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Fallen Hero"}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Name:"})," ",J.name]}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Class:"})," ",J.class]}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Level:"})," ",J.level]}),o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"Final HP:"})," ",J.hp,"/",J.maxHp]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-gray-300",children:"Your character has been defeated. You must create a new character to continue."}),o.jsx("button",{onClick:q,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})]})]})]})})}function qV(){const n=hs(),e=n.pathname.split("/campaign-story/")[1];return console.log("Old route detected:",n.pathname),console.log("PartyId extracted:",e),console.log("Redirecting to:",`/campaign/${e}`),o.jsx(R_,{to:`/campaign/${e}`,replace:!0})}function WV(){return o.jsx(uA,{basename:"/DND-V1",future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:o.jsxs("div",{className:"min-h-screen flex flex-col",children:[o.jsx(bV,{}),o.jsx("main",{className:"flex-grow",children:o.jsxs(rA,{children:[o.jsx(cr,{path:"/",element:o.jsx(SV,{})}),o.jsx(cr,{path:"/login",element:o.jsx(CV,{})}),o.jsx(cr,{path:"/register",element:o.jsx(NV,{})}),o.jsx(cr,{path:"/dashboard",element:o.jsx(AV,{})}),o.jsx(cr,{path:"/character-creation/:partyId",element:o.jsx(kV,{})}),o.jsx(cr,{path:"/lobby/:partyId",element:o.jsx(RV,{})}),o.jsx(cr,{path:"/campaign/:partyId",element:o.jsx(FV,{})}),o.jsx(cr,{path:"/manual-campaign/:partyId",element:o.jsx($V,{})}),o.jsx(cr,{path:"/combat/:sessionId",element:o.jsx(zV,{})}),o.jsx(cr,{path:"/campaign-story/:partyId",element:o.jsx(qV,{})}),o.jsx(cr,{path:"*",element:o.jsx(R_,{to:"/dashboard",replace:!0})})]})}),o.jsx(TV,{})]})})}Fm.createRoot(document.getElementById("root")).render(o.jsx(bb.StrictMode,{children:o.jsx(WV,{})}));export{gt as $,GI as A,ia as B,$r as C,$t as D,ZL as E,ca as F,cy as G,XL as H,YV as I,gr as J,gM as K,vM as L,bi as M,TL as N,IL as O,$M as P,bn as Q,fL as R,tL as S,Ct as T,zL as U,jh as V,OM as W,BL as X,EL as Y,iL as Z,LE as _,mc as a,ZV as a0,yM as a1,CM as a2,JL as a3,td as a4,UL as a5,lL as a6,YL as a7,Ke as a8,hL as a9,dL as aA,Bc as aB,RL as aC,mL as aD,pL as aE,LL as aF,OL as aG,VM as aH,wn as aI,jI as aJ,eL as aK,$L as aL,Me as aM,PL as aN,GL as aO,HV as aP,SL as aQ,xL as aR,vL as aS,_L as aT,cL as aU,kt as aV,WL as aW,aL as aX,Kt as aY,HL as aZ,rL as aa,sL as ab,oL as ac,QL as ad,wL as ae,bL as af,At as ag,zc as ah,AM as ai,jL as aj,Dn as ak,CL as al,NL as am,Fn as an,AL as ao,kL as ap,xM as aq,KL as ar,qL as as,nL as at,gL as au,yL as av,uL as aw,DL as ax,VL as ay,ML as az,bM as b,Eo as c,ua as d,ot as e,Z as f,Uo as g,$c as h,ed as i,$h as j,Uc as k,Oh as l,vy as m,To as n,Fh as o,Oi as p,FM as q,Dt as r,Ji as s,oe as t,KV as u,cj as v,_t as w,e4 as x,Le as y,GV as z};
