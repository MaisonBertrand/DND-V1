function Eb(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function Tb(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var pv={exports:{}},Bc={},gv={exports:{}},Ce={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var So=Symbol.for("react.element"),Cb=Symbol.for("react.portal"),Sb=Symbol.for("react.fragment"),kb=Symbol.for("react.strict_mode"),Ib=Symbol.for("react.profiler"),Nb=Symbol.for("react.provider"),Pb=Symbol.for("react.context"),Ab=Symbol.for("react.forward_ref"),Rb=Symbol.for("react.suspense"),jb=Symbol.for("react.memo"),Db=Symbol.for("react.lazy"),jp=Symbol.iterator;function Mb(t){return t===null||typeof t!="object"?null:(t=jp&&t[jp]||t["@@iterator"],typeof t=="function"?t:null)}var yv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},vv=Object.assign,wv={};function Ji(t,e,n){this.props=t,this.context=e,this.refs=wv,this.updater=n||yv}Ji.prototype.isReactComponent={};Ji.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ji.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function xv(){}xv.prototype=Ji.prototype;function Yh(t,e,n){this.props=t,this.context=e,this.refs=wv,this.updater=n||yv}var Xh=Yh.prototype=new xv;Xh.constructor=Yh;vv(Xh,Ji.prototype);Xh.isPureReactComponent=!0;var Dp=Array.isArray,_v=Object.prototype.hasOwnProperty,Jh={current:null},bv={key:!0,ref:!0,__self:!0,__source:!0};function Ev(t,e,n){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)_v.call(e,r)&&!bv.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var u=Array(l),d=0;d<l;d++)u[d]=arguments[d+2];s.children=u}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:So,type:t,key:i,ref:a,props:s,_owner:Jh.current}}function Lb(t,e){return{$$typeof:So,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Zh(t){return typeof t=="object"&&t!==null&&t.$$typeof===So}function Ob(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Mp=/\/+/g;function Uu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Ob(""+t.key):e.toString(36)}function Rl(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case So:case Cb:a=!0}}if(a)return a=t,s=s(a),t=r===""?"."+Uu(a,0):r,Dp(s)?(n="",t!=null&&(n=t.replace(Mp,"$&/")+"/"),Rl(s,e,n,"",function(d){return d})):s!=null&&(Zh(s)&&(s=Lb(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(Mp,"$&/")+"/")+t)),e.push(s)),1;if(a=0,r=r===""?".":r+":",Dp(t))for(var l=0;l<t.length;l++){i=t[l];var u=r+Uu(i,l);a+=Rl(i,e,n,u,s)}else if(u=Mb(t),typeof u=="function")for(t=u.call(t),l=0;!(i=t.next()).done;)i=i.value,u=r+Uu(i,l++),a+=Rl(i,e,n,u,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function cl(t,e,n){if(t==null)return t;var r=[],s=0;return Rl(t,r,"","",function(i){return e.call(n,i,s++)}),r}function Vb(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var en={current:null},jl={transition:null},Fb={ReactCurrentDispatcher:en,ReactCurrentBatchConfig:jl,ReactCurrentOwner:Jh};function Tv(){throw Error("act(...) is not supported in production builds of React.")}Ce.Children={map:cl,forEach:function(t,e,n){cl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return cl(t,function(){e++}),e},toArray:function(t){return cl(t,function(e){return e})||[]},only:function(t){if(!Zh(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ce.Component=Ji;Ce.Fragment=Sb;Ce.Profiler=Ib;Ce.PureComponent=Yh;Ce.StrictMode=kb;Ce.Suspense=Rb;Ce.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Fb;Ce.act=Tv;Ce.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=vv({},t.props),s=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=Jh.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(u in e)_v.call(e,u)&&!bv.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&l!==void 0?l[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){l=Array(u);for(var d=0;d<u;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:So,type:t.type,key:s,ref:i,props:r,_owner:a}};Ce.createContext=function(t){return t={$$typeof:Pb,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Nb,_context:t},t.Consumer=t};Ce.createElement=Ev;Ce.createFactory=function(t){var e=Ev.bind(null,t);return e.type=t,e};Ce.createRef=function(){return{current:null}};Ce.forwardRef=function(t){return{$$typeof:Ab,render:t}};Ce.isValidElement=Zh;Ce.lazy=function(t){return{$$typeof:Db,_payload:{_status:-1,_result:t},_init:Vb}};Ce.memo=function(t,e){return{$$typeof:jb,type:t,compare:e===void 0?null:e}};Ce.startTransition=function(t){var e=jl.transition;jl.transition={};try{t()}finally{jl.transition=e}};Ce.unstable_act=Tv;Ce.useCallback=function(t,e){return en.current.useCallback(t,e)};Ce.useContext=function(t){return en.current.useContext(t)};Ce.useDebugValue=function(){};Ce.useDeferredValue=function(t){return en.current.useDeferredValue(t)};Ce.useEffect=function(t,e){return en.current.useEffect(t,e)};Ce.useId=function(){return en.current.useId()};Ce.useImperativeHandle=function(t,e,n){return en.current.useImperativeHandle(t,e,n)};Ce.useInsertionEffect=function(t,e){return en.current.useInsertionEffect(t,e)};Ce.useLayoutEffect=function(t,e){return en.current.useLayoutEffect(t,e)};Ce.useMemo=function(t,e){return en.current.useMemo(t,e)};Ce.useReducer=function(t,e,n){return en.current.useReducer(t,e,n)};Ce.useRef=function(t){return en.current.useRef(t)};Ce.useState=function(t){return en.current.useState(t)};Ce.useSyncExternalStore=function(t,e,n){return en.current.useSyncExternalStore(t,e,n)};Ce.useTransition=function(){return en.current.useTransition()};Ce.version="18.3.1";gv.exports=Ce;var R=gv.exports;const Cv=Tb(R),$b=Eb({__proto__:null,default:Cv},[R]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ub=R,Bb=Symbol.for("react.element"),zb=Symbol.for("react.fragment"),Wb=Object.prototype.hasOwnProperty,qb=Ub.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Hb={key:!0,ref:!0,__self:!0,__source:!0};function Sv(t,e,n){var r,s={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)Wb.call(e,r)&&!Hb.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:Bb,type:t,key:i,ref:a,props:s,_owner:qb.current}}Bc.Fragment=zb;Bc.jsx=Sv;Bc.jsxs=Sv;pv.exports=Bc;var o=pv.exports,Nd={},kv={exports:{}},yn={},Iv={exports:{}},Nv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(J,re){var ue=J.length;J.push(re);e:for(;0<ue;){var Q=ue-1>>>1,W=J[Q];if(0<s(W,re))J[Q]=re,J[ue]=W,ue=Q;else break e}}function n(J){return J.length===0?null:J[0]}function r(J){if(J.length===0)return null;var re=J[0],ue=J.pop();if(ue!==re){J[0]=ue;e:for(var Q=0,W=J.length,X=W>>>1;Q<X;){var le=2*(Q+1)-1,pe=J[le],Ee=le+1,ae=J[Ee];if(0>s(pe,ue))Ee<W&&0>s(ae,pe)?(J[Q]=ae,J[Ee]=ue,Q=Ee):(J[Q]=pe,J[le]=ue,Q=le);else if(Ee<W&&0>s(ae,ue))J[Q]=ae,J[Ee]=ue,Q=Ee;else break e}}return re}function s(J,re){var ue=J.sortIndex-re.sortIndex;return ue!==0?ue:J.id-re.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var u=[],d=[],f=1,m=null,g=3,b=!1,S=!1,E=!1,k=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(J){for(var re=n(d);re!==null;){if(re.callback===null)r(d);else if(re.startTime<=J)r(d),re.sortIndex=re.expirationTime,e(u,re);else break;re=n(d)}}function M(J){if(E=!1,N(J),!S)if(n(u)!==null)S=!0,$e(D);else{var re=n(d);re!==null&&qe(M,re.startTime-J)}}function D(J,re){S=!1,E&&(E=!1,_(y),y=-1),b=!0;var ue=g;try{for(N(re),m=n(u);m!==null&&(!(m.expirationTime>re)||J&&!A());){var Q=m.callback;if(typeof Q=="function"){m.callback=null,g=m.priorityLevel;var W=Q(m.expirationTime<=re);re=t.unstable_now(),typeof W=="function"?m.callback=W:m===n(u)&&r(u),N(re)}else r(u);m=n(u)}if(m!==null)var X=!0;else{var le=n(d);le!==null&&qe(M,le.startTime-re),X=!1}return X}finally{m=null,g=ue,b=!1}}var U=!1,v=null,y=-1,T=5,C=-1;function A(){return!(t.unstable_now()-C<T)}function P(){if(v!==null){var J=t.unstable_now();C=J;var re=!0;try{re=v(!0,J)}finally{re?I():(U=!1,v=null)}}else U=!1}var I;if(typeof x=="function")I=function(){x(P)};else if(typeof MessageChannel<"u"){var ke=new MessageChannel,Oe=ke.port2;ke.port1.onmessage=P,I=function(){Oe.postMessage(null)}}else I=function(){k(P,0)};function $e(J){v=J,U||(U=!0,I())}function qe(J,re){y=k(function(){J(t.unstable_now())},re)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(J){J.callback=null},t.unstable_continueExecution=function(){S||b||(S=!0,$e(D))},t.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<J?Math.floor(1e3/J):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(J){switch(g){case 1:case 2:case 3:var re=3;break;default:re=g}var ue=g;g=re;try{return J()}finally{g=ue}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(J,re){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var ue=g;g=J;try{return re()}finally{g=ue}},t.unstable_scheduleCallback=function(J,re,ue){var Q=t.unstable_now();switch(typeof ue=="object"&&ue!==null?(ue=ue.delay,ue=typeof ue=="number"&&0<ue?Q+ue:Q):ue=Q,J){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=ue+W,J={id:f++,callback:re,priorityLevel:J,startTime:ue,expirationTime:W,sortIndex:-1},ue>Q?(J.sortIndex=ue,e(d,J),n(u)===null&&J===n(d)&&(E?(_(y),y=-1):E=!0,qe(M,ue-Q))):(J.sortIndex=W,e(u,J),S||b||(S=!0,$e(D))),J},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(J){var re=g;return function(){var ue=g;g=re;try{return J.apply(this,arguments)}finally{g=ue}}}})(Nv);Iv.exports=Nv;var Gb=Iv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kb=R,pn=Gb;function Y(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Pv=new Set,Ya={};function Xs(t,e){Oi(t,e),Oi(t+"Capture",e)}function Oi(t,e){for(Ya[t]=e,t=0;t<e.length;t++)Pv.add(e[t])}var wr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Pd=Object.prototype.hasOwnProperty,Qb=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Lp={},Op={};function Yb(t){return Pd.call(Op,t)?!0:Pd.call(Lp,t)?!1:Qb.test(t)?Op[t]=!0:(Lp[t]=!0,!1)}function Xb(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Jb(t,e,n,r){if(e===null||typeof e>"u"||Xb(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function tn(t,e,n,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var Rt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Rt[t]=new tn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Rt[e]=new tn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Rt[t]=new tn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Rt[t]=new tn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Rt[t]=new tn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Rt[t]=new tn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Rt[t]=new tn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Rt[t]=new tn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Rt[t]=new tn(t,5,!1,t.toLowerCase(),null,!1,!1)});var ef=/[\-:]([a-z])/g;function tf(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(ef,tf);Rt[e]=new tn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(ef,tf);Rt[e]=new tn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(ef,tf);Rt[e]=new tn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Rt[t]=new tn(t,1,!1,t.toLowerCase(),null,!1,!1)});Rt.xlinkHref=new tn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Rt[t]=new tn(t,1,!1,t.toLowerCase(),null,!0,!0)});function nf(t,e,n,r){var s=Rt.hasOwnProperty(e)?Rt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Jb(e,n,s,r)&&(n=null),r||s===null?Yb(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var kr=Kb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ul=Symbol.for("react.element"),mi=Symbol.for("react.portal"),pi=Symbol.for("react.fragment"),rf=Symbol.for("react.strict_mode"),Ad=Symbol.for("react.profiler"),Av=Symbol.for("react.provider"),Rv=Symbol.for("react.context"),sf=Symbol.for("react.forward_ref"),Rd=Symbol.for("react.suspense"),jd=Symbol.for("react.suspense_list"),af=Symbol.for("react.memo"),Ur=Symbol.for("react.lazy"),jv=Symbol.for("react.offscreen"),Vp=Symbol.iterator;function ya(t){return t===null||typeof t!="object"?null:(t=Vp&&t[Vp]||t["@@iterator"],typeof t=="function"?t:null)}var tt=Object.assign,Bu;function Sa(t){if(Bu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Bu=e&&e[1]||""}return`
`+Bu+t}var zu=!1;function Wu(t,e){if(!t||zu)return"";zu=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,l=i.length-1;1<=a&&0<=l&&s[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(s[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||s[a]!==i[l]){var u=`
`+s[a].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=a&&0<=l);break}}}finally{zu=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Sa(t):""}function Zb(t){switch(t.tag){case 5:return Sa(t.type);case 16:return Sa("Lazy");case 13:return Sa("Suspense");case 19:return Sa("SuspenseList");case 0:case 2:case 15:return t=Wu(t.type,!1),t;case 11:return t=Wu(t.type.render,!1),t;case 1:return t=Wu(t.type,!0),t;default:return""}}function Dd(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case pi:return"Fragment";case mi:return"Portal";case Ad:return"Profiler";case rf:return"StrictMode";case Rd:return"Suspense";case jd:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Rv:return(t.displayName||"Context")+".Consumer";case Av:return(t._context.displayName||"Context")+".Provider";case sf:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case af:return e=t.displayName||null,e!==null?e:Dd(t.type)||"Memo";case Ur:e=t._payload,t=t._init;try{return Dd(t(e))}catch{}}return null}function eE(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Dd(e);case 8:return e===rf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function hs(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Dv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function tE(t){var e=Dv(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function dl(t){t._valueTracker||(t._valueTracker=tE(t))}function Mv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Dv(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Zl(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Md(t,e){var n=e.checked;return tt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Fp(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=hs(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Lv(t,e){e=e.checked,e!=null&&nf(t,"checked",e,!1)}function Ld(t,e){Lv(t,e);var n=hs(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Od(t,e.type,n):e.hasOwnProperty("defaultValue")&&Od(t,e.type,hs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function $p(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Od(t,e,n){(e!=="number"||Zl(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ka=Array.isArray;function ki(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+hs(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Vd(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Y(91));return tt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Up(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Y(92));if(ka(n)){if(1<n.length)throw Error(Y(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:hs(n)}}function Ov(t,e){var n=hs(e.value),r=hs(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Bp(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Vv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Fd(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Vv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var hl,Fv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(hl=hl||document.createElement("div"),hl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=hl.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Xa(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var La={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},nE=["Webkit","ms","Moz","O"];Object.keys(La).forEach(function(t){nE.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),La[e]=La[t]})});function $v(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||La.hasOwnProperty(t)&&La[t]?(""+e).trim():e+"px"}function Uv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=$v(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var rE=tt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $d(t,e){if(e){if(rE[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Y(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Y(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Y(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Y(62))}}function Ud(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bd=null;function of(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var zd=null,Ii=null,Ni=null;function zp(t){if(t=No(t)){if(typeof zd!="function")throw Error(Y(280));var e=t.stateNode;e&&(e=Gc(e),zd(t.stateNode,t.type,e))}}function Bv(t){Ii?Ni?Ni.push(t):Ni=[t]:Ii=t}function zv(){if(Ii){var t=Ii,e=Ni;if(Ni=Ii=null,zp(t),e)for(t=0;t<e.length;t++)zp(e[t])}}function Wv(t,e){return t(e)}function qv(){}var qu=!1;function Hv(t,e,n){if(qu)return t(e,n);qu=!0;try{return Wv(t,e,n)}finally{qu=!1,(Ii!==null||Ni!==null)&&(qv(),zv())}}function Ja(t,e){var n=t.stateNode;if(n===null)return null;var r=Gc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Y(231,e,typeof n));return n}var Wd=!1;if(wr)try{var va={};Object.defineProperty(va,"passive",{get:function(){Wd=!0}}),window.addEventListener("test",va,va),window.removeEventListener("test",va,va)}catch{Wd=!1}function sE(t,e,n,r,s,i,a,l,u){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(f){this.onError(f)}}var Oa=!1,ec=null,tc=!1,qd=null,iE={onError:function(t){Oa=!0,ec=t}};function aE(t,e,n,r,s,i,a,l,u){Oa=!1,ec=null,sE.apply(iE,arguments)}function oE(t,e,n,r,s,i,a,l,u){if(aE.apply(this,arguments),Oa){if(Oa){var d=ec;Oa=!1,ec=null}else throw Error(Y(198));tc||(tc=!0,qd=d)}}function Js(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Gv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Wp(t){if(Js(t)!==t)throw Error(Y(188))}function lE(t){var e=t.alternate;if(!e){if(e=Js(t),e===null)throw Error(Y(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Wp(s),t;if(i===r)return Wp(s),e;i=i.sibling}throw Error(Y(188))}if(n.return!==r.return)n=s,r=i;else{for(var a=!1,l=s.child;l;){if(l===n){a=!0,n=s,r=i;break}if(l===r){a=!0,r=s,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,r=s;break}if(l===r){a=!0,r=i,n=s;break}l=l.sibling}if(!a)throw Error(Y(189))}}if(n.alternate!==r)throw Error(Y(190))}if(n.tag!==3)throw Error(Y(188));return n.stateNode.current===n?t:e}function Kv(t){return t=lE(t),t!==null?Qv(t):null}function Qv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Qv(t);if(e!==null)return e;t=t.sibling}return null}var Yv=pn.unstable_scheduleCallback,qp=pn.unstable_cancelCallback,cE=pn.unstable_shouldYield,uE=pn.unstable_requestPaint,lt=pn.unstable_now,dE=pn.unstable_getCurrentPriorityLevel,lf=pn.unstable_ImmediatePriority,Xv=pn.unstable_UserBlockingPriority,nc=pn.unstable_NormalPriority,hE=pn.unstable_LowPriority,Jv=pn.unstable_IdlePriority,zc=null,Xn=null;function fE(t){if(Xn&&typeof Xn.onCommitFiberRoot=="function")try{Xn.onCommitFiberRoot(zc,t,void 0,(t.current.flags&128)===128)}catch{}}var Ln=Math.clz32?Math.clz32:gE,mE=Math.log,pE=Math.LN2;function gE(t){return t>>>=0,t===0?32:31-(mE(t)/pE|0)|0}var fl=64,ml=4194304;function Ia(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function rc(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var l=a&~s;l!==0?r=Ia(l):(i&=a,i!==0&&(r=Ia(i)))}else a=n&~s,a!==0?r=Ia(a):i!==0&&(r=Ia(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Ln(e),s=1<<n,r|=t[n],e&=~s;return r}function yE(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vE(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-Ln(i),l=1<<a,u=s[a];u===-1?(!(l&n)||l&r)&&(s[a]=yE(l,e)):u<=e&&(t.expiredLanes|=l),i&=~l}}function Hd(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Zv(){var t=fl;return fl<<=1,!(fl&4194240)&&(fl=64),t}function Hu(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ko(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ln(e),t[e]=n}function wE(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Ln(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function cf(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Ln(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Ve=0;function e0(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var t0,uf,n0,r0,s0,Gd=!1,pl=[],Zr=null,es=null,ts=null,Za=new Map,eo=new Map,zr=[],xE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Hp(t,e){switch(t){case"focusin":case"focusout":Zr=null;break;case"dragenter":case"dragleave":es=null;break;case"mouseover":case"mouseout":ts=null;break;case"pointerover":case"pointerout":Za.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":eo.delete(e.pointerId)}}function wa(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=No(e),e!==null&&uf(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function _E(t,e,n,r,s){switch(e){case"focusin":return Zr=wa(Zr,t,e,n,r,s),!0;case"dragenter":return es=wa(es,t,e,n,r,s),!0;case"mouseover":return ts=wa(ts,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Za.set(i,wa(Za.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,eo.set(i,wa(eo.get(i)||null,t,e,n,r,s)),!0}return!1}function i0(t){var e=js(t.target);if(e!==null){var n=Js(e);if(n!==null){if(e=n.tag,e===13){if(e=Gv(n),e!==null){t.blockedOn=e,s0(t.priority,function(){n0(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Dl(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Kd(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Bd=r,n.target.dispatchEvent(r),Bd=null}else return e=No(n),e!==null&&uf(e),t.blockedOn=n,!1;e.shift()}return!0}function Gp(t,e,n){Dl(t)&&n.delete(e)}function bE(){Gd=!1,Zr!==null&&Dl(Zr)&&(Zr=null),es!==null&&Dl(es)&&(es=null),ts!==null&&Dl(ts)&&(ts=null),Za.forEach(Gp),eo.forEach(Gp)}function xa(t,e){t.blockedOn===e&&(t.blockedOn=null,Gd||(Gd=!0,pn.unstable_scheduleCallback(pn.unstable_NormalPriority,bE)))}function to(t){function e(s){return xa(s,t)}if(0<pl.length){xa(pl[0],t);for(var n=1;n<pl.length;n++){var r=pl[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Zr!==null&&xa(Zr,t),es!==null&&xa(es,t),ts!==null&&xa(ts,t),Za.forEach(e),eo.forEach(e),n=0;n<zr.length;n++)r=zr[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<zr.length&&(n=zr[0],n.blockedOn===null);)i0(n),n.blockedOn===null&&zr.shift()}var Pi=kr.ReactCurrentBatchConfig,sc=!0;function EE(t,e,n,r){var s=Ve,i=Pi.transition;Pi.transition=null;try{Ve=1,df(t,e,n,r)}finally{Ve=s,Pi.transition=i}}function TE(t,e,n,r){var s=Ve,i=Pi.transition;Pi.transition=null;try{Ve=4,df(t,e,n,r)}finally{Ve=s,Pi.transition=i}}function df(t,e,n,r){if(sc){var s=Kd(t,e,n,r);if(s===null)nd(t,e,r,ic,n),Hp(t,r);else if(_E(s,t,e,n,r))r.stopPropagation();else if(Hp(t,r),e&4&&-1<xE.indexOf(t)){for(;s!==null;){var i=No(s);if(i!==null&&t0(i),i=Kd(t,e,n,r),i===null&&nd(t,e,r,ic,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else nd(t,e,r,null,n)}}var ic=null;function Kd(t,e,n,r){if(ic=null,t=of(r),t=js(t),t!==null)if(e=Js(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Gv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ic=t,null}function a0(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(dE()){case lf:return 1;case Xv:return 4;case nc:case hE:return 16;case Jv:return 536870912;default:return 16}default:return 16}}var Qr=null,hf=null,Ml=null;function o0(){if(Ml)return Ml;var t,e=hf,n=e.length,r,s="value"in Qr?Qr.value:Qr.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===s[i-r];r++);return Ml=s.slice(t,1<r?1-r:void 0)}function Ll(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function gl(){return!0}function Kp(){return!1}function vn(t){function e(n,r,s,i,a){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?gl:Kp,this.isPropagationStopped=Kp,this}return tt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=gl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=gl)},persist:function(){},isPersistent:gl}),e}var Zi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ff=vn(Zi),Io=tt({},Zi,{view:0,detail:0}),CE=vn(Io),Gu,Ku,_a,Wc=tt({},Io,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mf,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==_a&&(_a&&t.type==="mousemove"?(Gu=t.screenX-_a.screenX,Ku=t.screenY-_a.screenY):Ku=Gu=0,_a=t),Gu)},movementY:function(t){return"movementY"in t?t.movementY:Ku}}),Qp=vn(Wc),SE=tt({},Wc,{dataTransfer:0}),kE=vn(SE),IE=tt({},Io,{relatedTarget:0}),Qu=vn(IE),NE=tt({},Zi,{animationName:0,elapsedTime:0,pseudoElement:0}),PE=vn(NE),AE=tt({},Zi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),RE=vn(AE),jE=tt({},Zi,{data:0}),Yp=vn(jE),DE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ME={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},LE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function OE(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=LE[t])?!!e[t]:!1}function mf(){return OE}var VE=tt({},Io,{key:function(t){if(t.key){var e=DE[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Ll(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?ME[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mf,charCode:function(t){return t.type==="keypress"?Ll(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ll(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),FE=vn(VE),$E=tt({},Wc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Xp=vn($E),UE=tt({},Io,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mf}),BE=vn(UE),zE=tt({},Zi,{propertyName:0,elapsedTime:0,pseudoElement:0}),WE=vn(zE),qE=tt({},Wc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),HE=vn(qE),GE=[9,13,27,32],pf=wr&&"CompositionEvent"in window,Va=null;wr&&"documentMode"in document&&(Va=document.documentMode);var KE=wr&&"TextEvent"in window&&!Va,l0=wr&&(!pf||Va&&8<Va&&11>=Va),Jp=String.fromCharCode(32),Zp=!1;function c0(t,e){switch(t){case"keyup":return GE.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function u0(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var gi=!1;function QE(t,e){switch(t){case"compositionend":return u0(e);case"keypress":return e.which!==32?null:(Zp=!0,Jp);case"textInput":return t=e.data,t===Jp&&Zp?null:t;default:return null}}function YE(t,e){if(gi)return t==="compositionend"||!pf&&c0(t,e)?(t=o0(),Ml=hf=Qr=null,gi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return l0&&e.locale!=="ko"?null:e.data;default:return null}}var XE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function eg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!XE[t.type]:e==="textarea"}function d0(t,e,n,r){Bv(r),e=ac(e,"onChange"),0<e.length&&(n=new ff("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Fa=null,no=null;function JE(t){b0(t,0)}function qc(t){var e=wi(t);if(Mv(e))return t}function ZE(t,e){if(t==="change")return e}var h0=!1;if(wr){var Yu;if(wr){var Xu="oninput"in document;if(!Xu){var tg=document.createElement("div");tg.setAttribute("oninput","return;"),Xu=typeof tg.oninput=="function"}Yu=Xu}else Yu=!1;h0=Yu&&(!document.documentMode||9<document.documentMode)}function ng(){Fa&&(Fa.detachEvent("onpropertychange",f0),no=Fa=null)}function f0(t){if(t.propertyName==="value"&&qc(no)){var e=[];d0(e,no,t,of(t)),Hv(JE,e)}}function eT(t,e,n){t==="focusin"?(ng(),Fa=e,no=n,Fa.attachEvent("onpropertychange",f0)):t==="focusout"&&ng()}function tT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return qc(no)}function nT(t,e){if(t==="click")return qc(e)}function rT(t,e){if(t==="input"||t==="change")return qc(e)}function sT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Fn=typeof Object.is=="function"?Object.is:sT;function ro(t,e){if(Fn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Pd.call(e,s)||!Fn(t[s],e[s]))return!1}return!0}function rg(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function sg(t,e){var n=rg(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=rg(n)}}function m0(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?m0(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function p0(){for(var t=window,e=Zl();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Zl(t.document)}return e}function gf(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function iT(t){var e=p0(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&m0(n.ownerDocument.documentElement,n)){if(r!==null&&gf(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=sg(n,i);var a=sg(n,r);s&&a&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var aT=wr&&"documentMode"in document&&11>=document.documentMode,yi=null,Qd=null,$a=null,Yd=!1;function ig(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Yd||yi==null||yi!==Zl(r)||(r=yi,"selectionStart"in r&&gf(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),$a&&ro($a,r)||($a=r,r=ac(Qd,"onSelect"),0<r.length&&(e=new ff("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=yi)))}function yl(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var vi={animationend:yl("Animation","AnimationEnd"),animationiteration:yl("Animation","AnimationIteration"),animationstart:yl("Animation","AnimationStart"),transitionend:yl("Transition","TransitionEnd")},Ju={},g0={};wr&&(g0=document.createElement("div").style,"AnimationEvent"in window||(delete vi.animationend.animation,delete vi.animationiteration.animation,delete vi.animationstart.animation),"TransitionEvent"in window||delete vi.transitionend.transition);function Hc(t){if(Ju[t])return Ju[t];if(!vi[t])return t;var e=vi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in g0)return Ju[t]=e[n];return t}var y0=Hc("animationend"),v0=Hc("animationiteration"),w0=Hc("animationstart"),x0=Hc("transitionend"),_0=new Map,ag="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ws(t,e){_0.set(t,e),Xs(e,[t])}for(var Zu=0;Zu<ag.length;Zu++){var ed=ag[Zu],oT=ed.toLowerCase(),lT=ed[0].toUpperCase()+ed.slice(1);ws(oT,"on"+lT)}ws(y0,"onAnimationEnd");ws(v0,"onAnimationIteration");ws(w0,"onAnimationStart");ws("dblclick","onDoubleClick");ws("focusin","onFocus");ws("focusout","onBlur");ws(x0,"onTransitionEnd");Oi("onMouseEnter",["mouseout","mouseover"]);Oi("onMouseLeave",["mouseout","mouseover"]);Oi("onPointerEnter",["pointerout","pointerover"]);Oi("onPointerLeave",["pointerout","pointerover"]);Xs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Xs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Xs("onBeforeInput",["compositionend","keypress","textInput","paste"]);Xs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Xs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Xs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Na="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),cT=new Set("cancel close invalid load scroll toggle".split(" ").concat(Na));function og(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,oE(r,e,void 0,t),t.currentTarget=null}function b0(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var l=r[a],u=l.instance,d=l.currentTarget;if(l=l.listener,u!==i&&s.isPropagationStopped())break e;og(s,l,d),i=u}else for(a=0;a<r.length;a++){if(l=r[a],u=l.instance,d=l.currentTarget,l=l.listener,u!==i&&s.isPropagationStopped())break e;og(s,l,d),i=u}}}if(tc)throw t=qd,tc=!1,qd=null,t}function Qe(t,e){var n=e[th];n===void 0&&(n=e[th]=new Set);var r=t+"__bubble";n.has(r)||(E0(e,t,2,!1),n.add(r))}function td(t,e,n){var r=0;e&&(r|=4),E0(n,t,r,e)}var vl="_reactListening"+Math.random().toString(36).slice(2);function so(t){if(!t[vl]){t[vl]=!0,Pv.forEach(function(n){n!=="selectionchange"&&(cT.has(n)||td(n,!1,t),td(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[vl]||(e[vl]=!0,td("selectionchange",!1,e))}}function E0(t,e,n,r){switch(a0(e)){case 1:var s=EE;break;case 4:s=TE;break;default:s=df}n=s.bind(null,e,n,t),s=void 0,!Wd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function nd(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===s||u.nodeType===8&&u.parentNode===s))return;a=a.return}for(;l!==null;){if(a=js(l),a===null)return;if(u=a.tag,u===5||u===6){r=i=a;continue e}l=l.parentNode}}r=r.return}Hv(function(){var d=i,f=of(n),m=[];e:{var g=_0.get(t);if(g!==void 0){var b=ff,S=t;switch(t){case"keypress":if(Ll(n)===0)break e;case"keydown":case"keyup":b=FE;break;case"focusin":S="focus",b=Qu;break;case"focusout":S="blur",b=Qu;break;case"beforeblur":case"afterblur":b=Qu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":b=Qp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":b=kE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":b=BE;break;case y0:case v0:case w0:b=PE;break;case x0:b=WE;break;case"scroll":b=CE;break;case"wheel":b=HE;break;case"copy":case"cut":case"paste":b=RE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":b=Xp}var E=(e&4)!==0,k=!E&&t==="scroll",_=E?g!==null?g+"Capture":null:g;E=[];for(var x=d,N;x!==null;){N=x;var M=N.stateNode;if(N.tag===5&&M!==null&&(N=M,_!==null&&(M=Ja(x,_),M!=null&&E.push(io(x,M,N)))),k)break;x=x.return}0<E.length&&(g=new b(g,S,null,n,f),m.push({event:g,listeners:E}))}}if(!(e&7)){e:{if(g=t==="mouseover"||t==="pointerover",b=t==="mouseout"||t==="pointerout",g&&n!==Bd&&(S=n.relatedTarget||n.fromElement)&&(js(S)||S[xr]))break e;if((b||g)&&(g=f.window===f?f:(g=f.ownerDocument)?g.defaultView||g.parentWindow:window,b?(S=n.relatedTarget||n.toElement,b=d,S=S?js(S):null,S!==null&&(k=Js(S),S!==k||S.tag!==5&&S.tag!==6)&&(S=null)):(b=null,S=d),b!==S)){if(E=Qp,M="onMouseLeave",_="onMouseEnter",x="mouse",(t==="pointerout"||t==="pointerover")&&(E=Xp,M="onPointerLeave",_="onPointerEnter",x="pointer"),k=b==null?g:wi(b),N=S==null?g:wi(S),g=new E(M,x+"leave",b,n,f),g.target=k,g.relatedTarget=N,M=null,js(f)===d&&(E=new E(_,x+"enter",S,n,f),E.target=N,E.relatedTarget=k,M=E),k=M,b&&S)t:{for(E=b,_=S,x=0,N=E;N;N=ui(N))x++;for(N=0,M=_;M;M=ui(M))N++;for(;0<x-N;)E=ui(E),x--;for(;0<N-x;)_=ui(_),N--;for(;x--;){if(E===_||_!==null&&E===_.alternate)break t;E=ui(E),_=ui(_)}E=null}else E=null;b!==null&&lg(m,g,b,E,!1),S!==null&&k!==null&&lg(m,k,S,E,!0)}}e:{if(g=d?wi(d):window,b=g.nodeName&&g.nodeName.toLowerCase(),b==="select"||b==="input"&&g.type==="file")var D=ZE;else if(eg(g))if(h0)D=rT;else{D=tT;var U=eT}else(b=g.nodeName)&&b.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(D=nT);if(D&&(D=D(t,d))){d0(m,D,n,f);break e}U&&U(t,g,d),t==="focusout"&&(U=g._wrapperState)&&U.controlled&&g.type==="number"&&Od(g,"number",g.value)}switch(U=d?wi(d):window,t){case"focusin":(eg(U)||U.contentEditable==="true")&&(yi=U,Qd=d,$a=null);break;case"focusout":$a=Qd=yi=null;break;case"mousedown":Yd=!0;break;case"contextmenu":case"mouseup":case"dragend":Yd=!1,ig(m,n,f);break;case"selectionchange":if(aT)break;case"keydown":case"keyup":ig(m,n,f)}var v;if(pf)e:{switch(t){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else gi?c0(t,n)&&(y="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(y="onCompositionStart");y&&(l0&&n.locale!=="ko"&&(gi||y!=="onCompositionStart"?y==="onCompositionEnd"&&gi&&(v=o0()):(Qr=f,hf="value"in Qr?Qr.value:Qr.textContent,gi=!0)),U=ac(d,y),0<U.length&&(y=new Yp(y,t,null,n,f),m.push({event:y,listeners:U}),v?y.data=v:(v=u0(n),v!==null&&(y.data=v)))),(v=KE?QE(t,n):YE(t,n))&&(d=ac(d,"onBeforeInput"),0<d.length&&(f=new Yp("onBeforeInput","beforeinput",null,n,f),m.push({event:f,listeners:d}),f.data=v))}b0(m,e)})}function io(t,e,n){return{instance:t,listener:e,currentTarget:n}}function ac(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Ja(t,n),i!=null&&r.unshift(io(t,i,s)),i=Ja(t,e),i!=null&&r.push(io(t,i,s))),t=t.return}return r}function ui(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function lg(t,e,n,r,s){for(var i=e._reactName,a=[];n!==null&&n!==r;){var l=n,u=l.alternate,d=l.stateNode;if(u!==null&&u===r)break;l.tag===5&&d!==null&&(l=d,s?(u=Ja(n,i),u!=null&&a.unshift(io(n,u,l))):s||(u=Ja(n,i),u!=null&&a.push(io(n,u,l)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var uT=/\r\n?/g,dT=/\u0000|\uFFFD/g;function cg(t){return(typeof t=="string"?t:""+t).replace(uT,`
`).replace(dT,"")}function wl(t,e,n){if(e=cg(e),cg(t)!==e&&n)throw Error(Y(425))}function oc(){}var Xd=null,Jd=null;function Zd(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var eh=typeof setTimeout=="function"?setTimeout:void 0,hT=typeof clearTimeout=="function"?clearTimeout:void 0,ug=typeof Promise=="function"?Promise:void 0,fT=typeof queueMicrotask=="function"?queueMicrotask:typeof ug<"u"?function(t){return ug.resolve(null).then(t).catch(mT)}:eh;function mT(t){setTimeout(function(){throw t})}function rd(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),to(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);to(e)}function ns(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function dg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ea=Math.random().toString(36).slice(2),Kn="__reactFiber$"+ea,ao="__reactProps$"+ea,xr="__reactContainer$"+ea,th="__reactEvents$"+ea,pT="__reactListeners$"+ea,gT="__reactHandles$"+ea;function js(t){var e=t[Kn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[xr]||n[Kn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=dg(t);t!==null;){if(n=t[Kn])return n;t=dg(t)}return e}t=n,n=t.parentNode}return null}function No(t){return t=t[Kn]||t[xr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function wi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Y(33))}function Gc(t){return t[ao]||null}var nh=[],xi=-1;function xs(t){return{current:t}}function Xe(t){0>xi||(t.current=nh[xi],nh[xi]=null,xi--)}function We(t,e){xi++,nh[xi]=t.current,t.current=e}var fs={},Gt=xs(fs),an=xs(!1),$s=fs;function Vi(t,e){var n=t.type.contextTypes;if(!n)return fs;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function on(t){return t=t.childContextTypes,t!=null}function lc(){Xe(an),Xe(Gt)}function hg(t,e,n){if(Gt.current!==fs)throw Error(Y(168));We(Gt,e),We(an,n)}function T0(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Y(108,eE(t)||"Unknown",s));return tt({},n,r)}function cc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||fs,$s=Gt.current,We(Gt,t),We(an,an.current),!0}function fg(t,e,n){var r=t.stateNode;if(!r)throw Error(Y(169));n?(t=T0(t,e,$s),r.__reactInternalMemoizedMergedChildContext=t,Xe(an),Xe(Gt),We(Gt,t)):Xe(an),We(an,n)}var cr=null,Kc=!1,sd=!1;function C0(t){cr===null?cr=[t]:cr.push(t)}function yT(t){Kc=!0,C0(t)}function _s(){if(!sd&&cr!==null){sd=!0;var t=0,e=Ve;try{var n=cr;for(Ve=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}cr=null,Kc=!1}catch(s){throw cr!==null&&(cr=cr.slice(t+1)),Yv(lf,_s),s}finally{Ve=e,sd=!1}}return null}var _i=[],bi=0,uc=null,dc=0,xn=[],_n=0,Us=null,dr=1,hr="";function Ps(t,e){_i[bi++]=dc,_i[bi++]=uc,uc=t,dc=e}function S0(t,e,n){xn[_n++]=dr,xn[_n++]=hr,xn[_n++]=Us,Us=t;var r=dr;t=hr;var s=32-Ln(r)-1;r&=~(1<<s),n+=1;var i=32-Ln(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,dr=1<<32-Ln(e)+s|n<<s|r,hr=i+t}else dr=1<<i|n<<s|r,hr=t}function yf(t){t.return!==null&&(Ps(t,1),S0(t,1,0))}function vf(t){for(;t===uc;)uc=_i[--bi],_i[bi]=null,dc=_i[--bi],_i[bi]=null;for(;t===Us;)Us=xn[--_n],xn[_n]=null,hr=xn[--_n],xn[_n]=null,dr=xn[--_n],xn[_n]=null}var mn=null,hn=null,Je=!1,Mn=null;function k0(t,e){var n=bn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function mg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,mn=t,hn=ns(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,mn=t,hn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Us!==null?{id:dr,overflow:hr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=bn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,mn=t,hn=null,!0):!1;default:return!1}}function rh(t){return(t.mode&1)!==0&&(t.flags&128)===0}function sh(t){if(Je){var e=hn;if(e){var n=e;if(!mg(t,e)){if(rh(t))throw Error(Y(418));e=ns(n.nextSibling);var r=mn;e&&mg(t,e)?k0(r,n):(t.flags=t.flags&-4097|2,Je=!1,mn=t)}}else{if(rh(t))throw Error(Y(418));t.flags=t.flags&-4097|2,Je=!1,mn=t}}}function pg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;mn=t}function xl(t){if(t!==mn)return!1;if(!Je)return pg(t),Je=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Zd(t.type,t.memoizedProps)),e&&(e=hn)){if(rh(t))throw I0(),Error(Y(418));for(;e;)k0(t,e),e=ns(e.nextSibling)}if(pg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Y(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){hn=ns(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}hn=null}}else hn=mn?ns(t.stateNode.nextSibling):null;return!0}function I0(){for(var t=hn;t;)t=ns(t.nextSibling)}function Fi(){hn=mn=null,Je=!1}function wf(t){Mn===null?Mn=[t]:Mn.push(t)}var vT=kr.ReactCurrentBatchConfig;function ba(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Y(309));var r=n.stateNode}if(!r)throw Error(Y(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var l=s.refs;a===null?delete l[i]:l[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(Y(284));if(!n._owner)throw Error(Y(290,t))}return t}function _l(t,e){throw t=Object.prototype.toString.call(e),Error(Y(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function gg(t){var e=t._init;return e(t._payload)}function N0(t){function e(_,x){if(t){var N=_.deletions;N===null?(_.deletions=[x],_.flags|=16):N.push(x)}}function n(_,x){if(!t)return null;for(;x!==null;)e(_,x),x=x.sibling;return null}function r(_,x){for(_=new Map;x!==null;)x.key!==null?_.set(x.key,x):_.set(x.index,x),x=x.sibling;return _}function s(_,x){return _=as(_,x),_.index=0,_.sibling=null,_}function i(_,x,N){return _.index=N,t?(N=_.alternate,N!==null?(N=N.index,N<x?(_.flags|=2,x):N):(_.flags|=2,x)):(_.flags|=1048576,x)}function a(_){return t&&_.alternate===null&&(_.flags|=2),_}function l(_,x,N,M){return x===null||x.tag!==6?(x=dd(N,_.mode,M),x.return=_,x):(x=s(x,N),x.return=_,x)}function u(_,x,N,M){var D=N.type;return D===pi?f(_,x,N.props.children,M,N.key):x!==null&&(x.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===Ur&&gg(D)===x.type)?(M=s(x,N.props),M.ref=ba(_,x,N),M.return=_,M):(M=zl(N.type,N.key,N.props,null,_.mode,M),M.ref=ba(_,x,N),M.return=_,M)}function d(_,x,N,M){return x===null||x.tag!==4||x.stateNode.containerInfo!==N.containerInfo||x.stateNode.implementation!==N.implementation?(x=hd(N,_.mode,M),x.return=_,x):(x=s(x,N.children||[]),x.return=_,x)}function f(_,x,N,M,D){return x===null||x.tag!==7?(x=Vs(N,_.mode,M,D),x.return=_,x):(x=s(x,N),x.return=_,x)}function m(_,x,N){if(typeof x=="string"&&x!==""||typeof x=="number")return x=dd(""+x,_.mode,N),x.return=_,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case ul:return N=zl(x.type,x.key,x.props,null,_.mode,N),N.ref=ba(_,null,x),N.return=_,N;case mi:return x=hd(x,_.mode,N),x.return=_,x;case Ur:var M=x._init;return m(_,M(x._payload),N)}if(ka(x)||ya(x))return x=Vs(x,_.mode,N,null),x.return=_,x;_l(_,x)}return null}function g(_,x,N,M){var D=x!==null?x.key:null;if(typeof N=="string"&&N!==""||typeof N=="number")return D!==null?null:l(_,x,""+N,M);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case ul:return N.key===D?u(_,x,N,M):null;case mi:return N.key===D?d(_,x,N,M):null;case Ur:return D=N._init,g(_,x,D(N._payload),M)}if(ka(N)||ya(N))return D!==null?null:f(_,x,N,M,null);_l(_,N)}return null}function b(_,x,N,M,D){if(typeof M=="string"&&M!==""||typeof M=="number")return _=_.get(N)||null,l(x,_,""+M,D);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case ul:return _=_.get(M.key===null?N:M.key)||null,u(x,_,M,D);case mi:return _=_.get(M.key===null?N:M.key)||null,d(x,_,M,D);case Ur:var U=M._init;return b(_,x,N,U(M._payload),D)}if(ka(M)||ya(M))return _=_.get(N)||null,f(x,_,M,D,null);_l(x,M)}return null}function S(_,x,N,M){for(var D=null,U=null,v=x,y=x=0,T=null;v!==null&&y<N.length;y++){v.index>y?(T=v,v=null):T=v.sibling;var C=g(_,v,N[y],M);if(C===null){v===null&&(v=T);break}t&&v&&C.alternate===null&&e(_,v),x=i(C,x,y),U===null?D=C:U.sibling=C,U=C,v=T}if(y===N.length)return n(_,v),Je&&Ps(_,y),D;if(v===null){for(;y<N.length;y++)v=m(_,N[y],M),v!==null&&(x=i(v,x,y),U===null?D=v:U.sibling=v,U=v);return Je&&Ps(_,y),D}for(v=r(_,v);y<N.length;y++)T=b(v,_,y,N[y],M),T!==null&&(t&&T.alternate!==null&&v.delete(T.key===null?y:T.key),x=i(T,x,y),U===null?D=T:U.sibling=T,U=T);return t&&v.forEach(function(A){return e(_,A)}),Je&&Ps(_,y),D}function E(_,x,N,M){var D=ya(N);if(typeof D!="function")throw Error(Y(150));if(N=D.call(N),N==null)throw Error(Y(151));for(var U=D=null,v=x,y=x=0,T=null,C=N.next();v!==null&&!C.done;y++,C=N.next()){v.index>y?(T=v,v=null):T=v.sibling;var A=g(_,v,C.value,M);if(A===null){v===null&&(v=T);break}t&&v&&A.alternate===null&&e(_,v),x=i(A,x,y),U===null?D=A:U.sibling=A,U=A,v=T}if(C.done)return n(_,v),Je&&Ps(_,y),D;if(v===null){for(;!C.done;y++,C=N.next())C=m(_,C.value,M),C!==null&&(x=i(C,x,y),U===null?D=C:U.sibling=C,U=C);return Je&&Ps(_,y),D}for(v=r(_,v);!C.done;y++,C=N.next())C=b(v,_,y,C.value,M),C!==null&&(t&&C.alternate!==null&&v.delete(C.key===null?y:C.key),x=i(C,x,y),U===null?D=C:U.sibling=C,U=C);return t&&v.forEach(function(P){return e(_,P)}),Je&&Ps(_,y),D}function k(_,x,N,M){if(typeof N=="object"&&N!==null&&N.type===pi&&N.key===null&&(N=N.props.children),typeof N=="object"&&N!==null){switch(N.$$typeof){case ul:e:{for(var D=N.key,U=x;U!==null;){if(U.key===D){if(D=N.type,D===pi){if(U.tag===7){n(_,U.sibling),x=s(U,N.props.children),x.return=_,_=x;break e}}else if(U.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===Ur&&gg(D)===U.type){n(_,U.sibling),x=s(U,N.props),x.ref=ba(_,U,N),x.return=_,_=x;break e}n(_,U);break}else e(_,U);U=U.sibling}N.type===pi?(x=Vs(N.props.children,_.mode,M,N.key),x.return=_,_=x):(M=zl(N.type,N.key,N.props,null,_.mode,M),M.ref=ba(_,x,N),M.return=_,_=M)}return a(_);case mi:e:{for(U=N.key;x!==null;){if(x.key===U)if(x.tag===4&&x.stateNode.containerInfo===N.containerInfo&&x.stateNode.implementation===N.implementation){n(_,x.sibling),x=s(x,N.children||[]),x.return=_,_=x;break e}else{n(_,x);break}else e(_,x);x=x.sibling}x=hd(N,_.mode,M),x.return=_,_=x}return a(_);case Ur:return U=N._init,k(_,x,U(N._payload),M)}if(ka(N))return S(_,x,N,M);if(ya(N))return E(_,x,N,M);_l(_,N)}return typeof N=="string"&&N!==""||typeof N=="number"?(N=""+N,x!==null&&x.tag===6?(n(_,x.sibling),x=s(x,N),x.return=_,_=x):(n(_,x),x=dd(N,_.mode,M),x.return=_,_=x),a(_)):n(_,x)}return k}var $i=N0(!0),P0=N0(!1),hc=xs(null),fc=null,Ei=null,xf=null;function _f(){xf=Ei=fc=null}function bf(t){var e=hc.current;Xe(hc),t._currentValue=e}function ih(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Ai(t,e){fc=t,xf=Ei=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(sn=!0),t.firstContext=null)}function Cn(t){var e=t._currentValue;if(xf!==t)if(t={context:t,memoizedValue:e,next:null},Ei===null){if(fc===null)throw Error(Y(308));Ei=t,fc.dependencies={lanes:0,firstContext:t}}else Ei=Ei.next=t;return e}var Ds=null;function Ef(t){Ds===null?Ds=[t]:Ds.push(t)}function A0(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Ef(e)):(n.next=s.next,s.next=n),e.interleaved=n,_r(t,r)}function _r(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Br=!1;function Tf(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function R0(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function gr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function rs(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Re&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,_r(t,n)}return s=r.interleaved,s===null?(e.next=e,Ef(r)):(e.next=s.next,s.next=e),r.interleaved=e,_r(t,n)}function Ol(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,cf(t,n)}}function yg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function mc(t,e,n,r){var s=t.updateQueue;Br=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var u=l,d=u.next;u.next=null,a===null?i=d:a.next=d,a=u;var f=t.alternate;f!==null&&(f=f.updateQueue,l=f.lastBaseUpdate,l!==a&&(l===null?f.firstBaseUpdate=d:l.next=d,f.lastBaseUpdate=u))}if(i!==null){var m=s.baseState;a=0,f=d=u=null,l=i;do{var g=l.lane,b=l.eventTime;if((r&g)===g){f!==null&&(f=f.next={eventTime:b,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var S=t,E=l;switch(g=e,b=n,E.tag){case 1:if(S=E.payload,typeof S=="function"){m=S.call(b,m,g);break e}m=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=E.payload,g=typeof S=="function"?S.call(b,m,g):S,g==null)break e;m=tt({},m,g);break e;case 2:Br=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,g=s.effects,g===null?s.effects=[l]:g.push(l))}else b={eventTime:b,lane:g,tag:l.tag,payload:l.payload,callback:l.callback,next:null},f===null?(d=f=b,u=m):f=f.next=b,a|=g;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;g=l,l=g.next,g.next=null,s.lastBaseUpdate=g,s.shared.pending=null}}while(1);if(f===null&&(u=m),s.baseState=u,s.firstBaseUpdate=d,s.lastBaseUpdate=f,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);zs|=a,t.lanes=a,t.memoizedState=m}}function vg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Y(191,s));s.call(r)}}}var Po={},Jn=xs(Po),oo=xs(Po),lo=xs(Po);function Ms(t){if(t===Po)throw Error(Y(174));return t}function Cf(t,e){switch(We(lo,e),We(oo,t),We(Jn,Po),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Fd(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Fd(e,t)}Xe(Jn),We(Jn,e)}function Ui(){Xe(Jn),Xe(oo),Xe(lo)}function j0(t){Ms(lo.current);var e=Ms(Jn.current),n=Fd(e,t.type);e!==n&&(We(oo,t),We(Jn,n))}function Sf(t){oo.current===t&&(Xe(Jn),Xe(oo))}var Ze=xs(0);function pc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var id=[];function kf(){for(var t=0;t<id.length;t++)id[t]._workInProgressVersionPrimary=null;id.length=0}var Vl=kr.ReactCurrentDispatcher,ad=kr.ReactCurrentBatchConfig,Bs=0,et=null,yt=null,Tt=null,gc=!1,Ua=!1,co=0,wT=0;function $t(){throw Error(Y(321))}function If(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Fn(t[n],e[n]))return!1;return!0}function Nf(t,e,n,r,s,i){if(Bs=i,et=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Vl.current=t===null||t.memoizedState===null?ET:TT,t=n(r,s),Ua){i=0;do{if(Ua=!1,co=0,25<=i)throw Error(Y(301));i+=1,Tt=yt=null,e.updateQueue=null,Vl.current=CT,t=n(r,s)}while(Ua)}if(Vl.current=yc,e=yt!==null&&yt.next!==null,Bs=0,Tt=yt=et=null,gc=!1,e)throw Error(Y(300));return t}function Pf(){var t=co!==0;return co=0,t}function qn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tt===null?et.memoizedState=Tt=t:Tt=Tt.next=t,Tt}function Sn(){if(yt===null){var t=et.alternate;t=t!==null?t.memoizedState:null}else t=yt.next;var e=Tt===null?et.memoizedState:Tt.next;if(e!==null)Tt=e,yt=t;else{if(t===null)throw Error(Y(310));yt=t,t={memoizedState:yt.memoizedState,baseState:yt.baseState,baseQueue:yt.baseQueue,queue:yt.queue,next:null},Tt===null?et.memoizedState=Tt=t:Tt=Tt.next=t}return Tt}function uo(t,e){return typeof e=="function"?e(t):e}function od(t){var e=Sn(),n=e.queue;if(n===null)throw Error(Y(311));n.lastRenderedReducer=t;var r=yt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=a=null,u=null,d=i;do{var f=d.lane;if((Bs&f)===f)u!==null&&(u=u.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var m={lane:f,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};u===null?(l=u=m,a=r):u=u.next=m,et.lanes|=f,zs|=f}d=d.next}while(d!==null&&d!==i);u===null?a=r:u.next=l,Fn(r,e.memoizedState)||(sn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,et.lanes|=i,zs|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function ld(t){var e=Sn(),n=e.queue;if(n===null)throw Error(Y(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do i=t(i,a.action),a=a.next;while(a!==s);Fn(i,e.memoizedState)||(sn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function D0(){}function M0(t,e){var n=et,r=Sn(),s=e(),i=!Fn(r.memoizedState,s);if(i&&(r.memoizedState=s,sn=!0),r=r.queue,Af(V0.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Tt!==null&&Tt.memoizedState.tag&1){if(n.flags|=2048,ho(9,O0.bind(null,n,r,s,e),void 0,null),Ct===null)throw Error(Y(349));Bs&30||L0(n,e,s)}return s}function L0(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=et.updateQueue,e===null?(e={lastEffect:null,stores:null},et.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function O0(t,e,n,r){e.value=n,e.getSnapshot=r,F0(e)&&$0(t)}function V0(t,e,n){return n(function(){F0(e)&&$0(t)})}function F0(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Fn(t,n)}catch{return!0}}function $0(t){var e=_r(t,1);e!==null&&On(e,t,1,-1)}function wg(t){var e=qn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:uo,lastRenderedState:t},e.queue=t,t=t.dispatch=bT.bind(null,et,t),[e.memoizedState,t]}function ho(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=et.updateQueue,e===null?(e={lastEffect:null,stores:null},et.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function U0(){return Sn().memoizedState}function Fl(t,e,n,r){var s=qn();et.flags|=t,s.memoizedState=ho(1|e,n,void 0,r===void 0?null:r)}function Qc(t,e,n,r){var s=Sn();r=r===void 0?null:r;var i=void 0;if(yt!==null){var a=yt.memoizedState;if(i=a.destroy,r!==null&&If(r,a.deps)){s.memoizedState=ho(e,n,i,r);return}}et.flags|=t,s.memoizedState=ho(1|e,n,i,r)}function xg(t,e){return Fl(8390656,8,t,e)}function Af(t,e){return Qc(2048,8,t,e)}function B0(t,e){return Qc(4,2,t,e)}function z0(t,e){return Qc(4,4,t,e)}function W0(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function q0(t,e,n){return n=n!=null?n.concat([t]):null,Qc(4,4,W0.bind(null,e,t),n)}function Rf(){}function H0(t,e){var n=Sn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&If(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function G0(t,e){var n=Sn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&If(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function K0(t,e,n){return Bs&21?(Fn(n,e)||(n=Zv(),et.lanes|=n,zs|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,sn=!0),t.memoizedState=n)}function xT(t,e){var n=Ve;Ve=n!==0&&4>n?n:4,t(!0);var r=ad.transition;ad.transition={};try{t(!1),e()}finally{Ve=n,ad.transition=r}}function Q0(){return Sn().memoizedState}function _T(t,e,n){var r=is(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Y0(t))X0(e,n);else if(n=A0(t,e,n,r),n!==null){var s=Jt();On(n,t,r,s),J0(n,e,r)}}function bT(t,e,n){var r=is(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Y0(t))X0(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,l=i(a,n);if(s.hasEagerState=!0,s.eagerState=l,Fn(l,a)){var u=e.interleaved;u===null?(s.next=s,Ef(e)):(s.next=u.next,u.next=s),e.interleaved=s;return}}catch{}finally{}n=A0(t,e,s,r),n!==null&&(s=Jt(),On(n,t,r,s),J0(n,e,r))}}function Y0(t){var e=t.alternate;return t===et||e!==null&&e===et}function X0(t,e){Ua=gc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function J0(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,cf(t,n)}}var yc={readContext:Cn,useCallback:$t,useContext:$t,useEffect:$t,useImperativeHandle:$t,useInsertionEffect:$t,useLayoutEffect:$t,useMemo:$t,useReducer:$t,useRef:$t,useState:$t,useDebugValue:$t,useDeferredValue:$t,useTransition:$t,useMutableSource:$t,useSyncExternalStore:$t,useId:$t,unstable_isNewReconciler:!1},ET={readContext:Cn,useCallback:function(t,e){return qn().memoizedState=[t,e===void 0?null:e],t},useContext:Cn,useEffect:xg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Fl(4194308,4,W0.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Fl(4194308,4,t,e)},useInsertionEffect:function(t,e){return Fl(4,2,t,e)},useMemo:function(t,e){var n=qn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=qn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=_T.bind(null,et,t),[r.memoizedState,t]},useRef:function(t){var e=qn();return t={current:t},e.memoizedState=t},useState:wg,useDebugValue:Rf,useDeferredValue:function(t){return qn().memoizedState=t},useTransition:function(){var t=wg(!1),e=t[0];return t=xT.bind(null,t[1]),qn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=et,s=qn();if(Je){if(n===void 0)throw Error(Y(407));n=n()}else{if(n=e(),Ct===null)throw Error(Y(349));Bs&30||L0(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,xg(V0.bind(null,r,i,t),[t]),r.flags|=2048,ho(9,O0.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=qn(),e=Ct.identifierPrefix;if(Je){var n=hr,r=dr;n=(r&~(1<<32-Ln(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=co++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=wT++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},TT={readContext:Cn,useCallback:H0,useContext:Cn,useEffect:Af,useImperativeHandle:q0,useInsertionEffect:B0,useLayoutEffect:z0,useMemo:G0,useReducer:od,useRef:U0,useState:function(){return od(uo)},useDebugValue:Rf,useDeferredValue:function(t){var e=Sn();return K0(e,yt.memoizedState,t)},useTransition:function(){var t=od(uo)[0],e=Sn().memoizedState;return[t,e]},useMutableSource:D0,useSyncExternalStore:M0,useId:Q0,unstable_isNewReconciler:!1},CT={readContext:Cn,useCallback:H0,useContext:Cn,useEffect:Af,useImperativeHandle:q0,useInsertionEffect:B0,useLayoutEffect:z0,useMemo:G0,useReducer:ld,useRef:U0,useState:function(){return ld(uo)},useDebugValue:Rf,useDeferredValue:function(t){var e=Sn();return yt===null?e.memoizedState=t:K0(e,yt.memoizedState,t)},useTransition:function(){var t=ld(uo)[0],e=Sn().memoizedState;return[t,e]},useMutableSource:D0,useSyncExternalStore:M0,useId:Q0,unstable_isNewReconciler:!1};function jn(t,e){if(t&&t.defaultProps){e=tt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function ah(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:tt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Yc={isMounted:function(t){return(t=t._reactInternals)?Js(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Jt(),s=is(t),i=gr(r,s);i.payload=e,n!=null&&(i.callback=n),e=rs(t,i,s),e!==null&&(On(e,t,s,r),Ol(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Jt(),s=is(t),i=gr(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=rs(t,i,s),e!==null&&(On(e,t,s,r),Ol(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Jt(),r=is(t),s=gr(n,r);s.tag=2,e!=null&&(s.callback=e),e=rs(t,s,r),e!==null&&(On(e,t,r,n),Ol(e,t,r))}};function _g(t,e,n,r,s,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!ro(n,r)||!ro(s,i):!0}function Z0(t,e,n){var r=!1,s=fs,i=e.contextType;return typeof i=="object"&&i!==null?i=Cn(i):(s=on(e)?$s:Gt.current,r=e.contextTypes,i=(r=r!=null)?Vi(t,s):fs),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Yc,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function bg(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Yc.enqueueReplaceState(e,e.state,null)}function oh(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Tf(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Cn(i):(i=on(e)?$s:Gt.current,s.context=Vi(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(ah(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Yc.enqueueReplaceState(s,s.state,null),mc(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Bi(t,e){try{var n="",r=e;do n+=Zb(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function cd(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function lh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var ST=typeof WeakMap=="function"?WeakMap:Map;function ew(t,e,n){n=gr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){wc||(wc=!0,vh=r),lh(t,e)},n}function tw(t,e,n){n=gr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){lh(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){lh(t,e),typeof r!="function"&&(ss===null?ss=new Set([this]):ss.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function Eg(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new ST;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=$T.bind(null,t,e,n),e.then(t,t))}function Tg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Cg(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=gr(-1,1),e.tag=2,rs(n,e,1))),n.lanes|=1),t)}var kT=kr.ReactCurrentOwner,sn=!1;function Xt(t,e,n,r){e.child=t===null?P0(e,null,n,r):$i(e,t.child,n,r)}function Sg(t,e,n,r,s){n=n.render;var i=e.ref;return Ai(e,s),r=Nf(t,e,n,r,i,s),n=Pf(),t!==null&&!sn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,br(t,e,s)):(Je&&n&&yf(e),e.flags|=1,Xt(t,e,r,s),e.child)}function kg(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!$f(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,nw(t,e,i,r,s)):(t=zl(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:ro,n(a,r)&&t.ref===e.ref)return br(t,e,s)}return e.flags|=1,t=as(i,r),t.ref=e.ref,t.return=e,e.child=t}function nw(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(ro(i,r)&&t.ref===e.ref)if(sn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(sn=!0);else return e.lanes=t.lanes,br(t,e,s)}return ch(t,e,n,r,s)}function rw(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},We(Ci,dn),dn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,We(Ci,dn),dn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,We(Ci,dn),dn|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,We(Ci,dn),dn|=r;return Xt(t,e,s,n),e.child}function sw(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function ch(t,e,n,r,s){var i=on(n)?$s:Gt.current;return i=Vi(e,i),Ai(e,s),n=Nf(t,e,n,r,i,s),r=Pf(),t!==null&&!sn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,br(t,e,s)):(Je&&r&&yf(e),e.flags|=1,Xt(t,e,n,s),e.child)}function Ig(t,e,n,r,s){if(on(n)){var i=!0;cc(e)}else i=!1;if(Ai(e,s),e.stateNode===null)$l(t,e),Z0(e,n,r),oh(e,n,r,s),r=!0;else if(t===null){var a=e.stateNode,l=e.memoizedProps;a.props=l;var u=a.context,d=n.contextType;typeof d=="object"&&d!==null?d=Cn(d):(d=on(n)?$s:Gt.current,d=Vi(e,d));var f=n.getDerivedStateFromProps,m=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function";m||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==r||u!==d)&&bg(e,a,r,d),Br=!1;var g=e.memoizedState;a.state=g,mc(e,r,a,s),u=e.memoizedState,l!==r||g!==u||an.current||Br?(typeof f=="function"&&(ah(e,n,f,r),u=e.memoizedState),(l=Br||_g(e,n,l,r,g,u,d))?(m||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),a.props=r,a.state=u,a.context=d,r=l):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,R0(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:jn(e.type,l),a.props=d,m=e.pendingProps,g=a.context,u=n.contextType,typeof u=="object"&&u!==null?u=Cn(u):(u=on(n)?$s:Gt.current,u=Vi(e,u));var b=n.getDerivedStateFromProps;(f=typeof b=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==m||g!==u)&&bg(e,a,r,u),Br=!1,g=e.memoizedState,a.state=g,mc(e,r,a,s);var S=e.memoizedState;l!==m||g!==S||an.current||Br?(typeof b=="function"&&(ah(e,n,b,r),S=e.memoizedState),(d=Br||_g(e,n,d,r,g,S,u)||!1)?(f||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,S,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,S,u)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=S),a.props=r,a.state=S,a.context=u,r=d):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),r=!1)}return uh(t,e,n,r,i,s)}function uh(t,e,n,r,s,i){sw(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&fg(e,n,!1),br(t,e,i);r=e.stateNode,kT.current=e;var l=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=$i(e,t.child,null,i),e.child=$i(e,null,l,i)):Xt(t,e,l,i),e.memoizedState=r.state,s&&fg(e,n,!0),e.child}function iw(t){var e=t.stateNode;e.pendingContext?hg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&hg(t,e.context,!1),Cf(t,e.containerInfo)}function Ng(t,e,n,r,s){return Fi(),wf(s),e.flags|=256,Xt(t,e,n,r),e.child}var dh={dehydrated:null,treeContext:null,retryLane:0};function hh(t){return{baseLanes:t,cachePool:null,transitions:null}}function aw(t,e,n){var r=e.pendingProps,s=Ze.current,i=!1,a=(e.flags&128)!==0,l;if((l=a)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),We(Ze,s&1),t===null)return sh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Zc(a,r,0,null),t=Vs(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=hh(n),e.memoizedState=dh,t):jf(e,a));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return IT(t,e,a,r,l,s,n);if(i){i=r.fallback,a=e.mode,s=t.child,l=s.sibling;var u={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=as(s,u),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=as(l,i):(i=Vs(i,a,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=t.child.memoizedState,a=a===null?hh(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=dh,r}return i=t.child,t=i.sibling,r=as(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function jf(t,e){return e=Zc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function bl(t,e,n,r){return r!==null&&wf(r),$i(e,t.child,null,n),t=jf(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function IT(t,e,n,r,s,i,a){if(n)return e.flags&256?(e.flags&=-257,r=cd(Error(Y(422))),bl(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Zc({mode:"visible",children:r.children},s,0,null),i=Vs(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&$i(e,t.child,null,a),e.child.memoizedState=hh(a),e.memoizedState=dh,i);if(!(e.mode&1))return bl(t,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(Y(419)),r=cd(i,r,void 0),bl(t,e,a,r)}if(l=(a&t.childLanes)!==0,sn||l){if(r=Ct,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,_r(t,s),On(r,t,s,-1))}return Ff(),r=cd(Error(Y(421))),bl(t,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=UT.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,hn=ns(s.nextSibling),mn=e,Je=!0,Mn=null,t!==null&&(xn[_n++]=dr,xn[_n++]=hr,xn[_n++]=Us,dr=t.id,hr=t.overflow,Us=e),e=jf(e,r.children),e.flags|=4096,e)}function Pg(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),ih(t.return,e,n)}function ud(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function ow(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Xt(t,e,r.children,n),r=Ze.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Pg(t,n,e);else if(t.tag===19)Pg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(We(Ze,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&pc(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),ud(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&pc(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}ud(e,!0,n,null,i);break;case"together":ud(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function $l(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function br(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),zs|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Y(153));if(e.child!==null){for(t=e.child,n=as(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=as(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function NT(t,e,n){switch(e.tag){case 3:iw(e),Fi();break;case 5:j0(e);break;case 1:on(e.type)&&cc(e);break;case 4:Cf(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;We(hc,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(We(Ze,Ze.current&1),e.flags|=128,null):n&e.child.childLanes?aw(t,e,n):(We(Ze,Ze.current&1),t=br(t,e,n),t!==null?t.sibling:null);We(Ze,Ze.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return ow(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),We(Ze,Ze.current),r)break;return null;case 22:case 23:return e.lanes=0,rw(t,e,n)}return br(t,e,n)}var lw,fh,cw,uw;lw=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};fh=function(){};cw=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Ms(Jn.current);var i=null;switch(n){case"input":s=Md(t,s),r=Md(t,r),i=[];break;case"select":s=tt({},s,{value:void 0}),r=tt({},r,{value:void 0}),i=[];break;case"textarea":s=Vd(t,s),r=Vd(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=oc)}$d(n,r);var a;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Ya.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var u=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&u!==l&&(u!=null||l!=null))if(d==="style")if(l){for(a in l)!l.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in u)u.hasOwnProperty(a)&&l[a]!==u[a]&&(n||(n={}),n[a]=u[a])}else n||(i||(i=[]),i.push(d,n)),n=u;else d==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,l=l?l.__html:void 0,u!=null&&l!==u&&(i=i||[]).push(d,u)):d==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(d,""+u):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Ya.hasOwnProperty(d)?(u!=null&&d==="onScroll"&&Qe("scroll",t),i||l===u||(i=[])):(i=i||[]).push(d,u))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};uw=function(t,e,n,r){n!==r&&(e.flags|=4)};function Ea(t,e){if(!Je)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ut(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function PT(t,e,n){var r=e.pendingProps;switch(vf(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ut(e),null;case 1:return on(e.type)&&lc(),Ut(e),null;case 3:return r=e.stateNode,Ui(),Xe(an),Xe(Gt),kf(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(xl(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Mn!==null&&(_h(Mn),Mn=null))),fh(t,e),Ut(e),null;case 5:Sf(e);var s=Ms(lo.current);if(n=e.type,t!==null&&e.stateNode!=null)cw(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Y(166));return Ut(e),null}if(t=Ms(Jn.current),xl(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Kn]=e,r[ao]=i,t=(e.mode&1)!==0,n){case"dialog":Qe("cancel",r),Qe("close",r);break;case"iframe":case"object":case"embed":Qe("load",r);break;case"video":case"audio":for(s=0;s<Na.length;s++)Qe(Na[s],r);break;case"source":Qe("error",r);break;case"img":case"image":case"link":Qe("error",r),Qe("load",r);break;case"details":Qe("toggle",r);break;case"input":Fp(r,i),Qe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Qe("invalid",r);break;case"textarea":Up(r,i),Qe("invalid",r)}$d(n,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&wl(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&wl(r.textContent,l,t),s=["children",""+l]):Ya.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&Qe("scroll",r)}switch(n){case"input":dl(r),$p(r,i,!0);break;case"textarea":dl(r),Bp(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=oc)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Vv(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[Kn]=e,t[ao]=r,lw(t,e,!1,!1),e.stateNode=t;e:{switch(a=Ud(n,r),n){case"dialog":Qe("cancel",t),Qe("close",t),s=r;break;case"iframe":case"object":case"embed":Qe("load",t),s=r;break;case"video":case"audio":for(s=0;s<Na.length;s++)Qe(Na[s],t);s=r;break;case"source":Qe("error",t),s=r;break;case"img":case"image":case"link":Qe("error",t),Qe("load",t),s=r;break;case"details":Qe("toggle",t),s=r;break;case"input":Fp(t,r),s=Md(t,r),Qe("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=tt({},r,{value:void 0}),Qe("invalid",t);break;case"textarea":Up(t,r),s=Vd(t,r),Qe("invalid",t);break;default:s=r}$d(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var u=l[i];i==="style"?Uv(t,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&Fv(t,u)):i==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&Xa(t,u):typeof u=="number"&&Xa(t,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ya.hasOwnProperty(i)?u!=null&&i==="onScroll"&&Qe("scroll",t):u!=null&&nf(t,i,u,a))}switch(n){case"input":dl(t),$p(t,r,!1);break;case"textarea":dl(t),Bp(t);break;case"option":r.value!=null&&t.setAttribute("value",""+hs(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?ki(t,!!r.multiple,i,!1):r.defaultValue!=null&&ki(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=oc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ut(e),null;case 6:if(t&&e.stateNode!=null)uw(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Y(166));if(n=Ms(lo.current),Ms(Jn.current),xl(e)){if(r=e.stateNode,n=e.memoizedProps,r[Kn]=e,(i=r.nodeValue!==n)&&(t=mn,t!==null))switch(t.tag){case 3:wl(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&wl(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Kn]=e,e.stateNode=r}return Ut(e),null;case 13:if(Xe(Ze),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Je&&hn!==null&&e.mode&1&&!(e.flags&128))I0(),Fi(),e.flags|=98560,i=!1;else if(i=xl(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(Y(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Y(317));i[Kn]=e}else Fi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ut(e),i=!1}else Mn!==null&&(_h(Mn),Mn=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Ze.current&1?vt===0&&(vt=3):Ff())),e.updateQueue!==null&&(e.flags|=4),Ut(e),null);case 4:return Ui(),fh(t,e),t===null&&so(e.stateNode.containerInfo),Ut(e),null;case 10:return bf(e.type._context),Ut(e),null;case 17:return on(e.type)&&lc(),Ut(e),null;case 19:if(Xe(Ze),i=e.memoizedState,i===null)return Ut(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)Ea(i,!1);else{if(vt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=pc(t),a!==null){for(e.flags|=128,Ea(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return We(Ze,Ze.current&1|2),e.child}t=t.sibling}i.tail!==null&&lt()>zi&&(e.flags|=128,r=!0,Ea(i,!1),e.lanes=4194304)}else{if(!r)if(t=pc(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Ea(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!Je)return Ut(e),null}else 2*lt()-i.renderingStartTime>zi&&n!==1073741824&&(e.flags|=128,r=!0,Ea(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=lt(),e.sibling=null,n=Ze.current,We(Ze,r?n&1|2:n&1),e):(Ut(e),null);case 22:case 23:return Vf(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?dn&1073741824&&(Ut(e),e.subtreeFlags&6&&(e.flags|=8192)):Ut(e),null;case 24:return null;case 25:return null}throw Error(Y(156,e.tag))}function AT(t,e){switch(vf(e),e.tag){case 1:return on(e.type)&&lc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ui(),Xe(an),Xe(Gt),kf(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Sf(e),null;case 13:if(Xe(Ze),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Y(340));Fi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Xe(Ze),null;case 4:return Ui(),null;case 10:return bf(e.type._context),null;case 22:case 23:return Vf(),null;case 24:return null;default:return null}}var El=!1,Wt=!1,RT=typeof WeakSet=="function"?WeakSet:Set,se=null;function Ti(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){at(t,e,r)}else n.current=null}function mh(t,e,n){try{n()}catch(r){at(t,e,r)}}var Ag=!1;function jT(t,e){if(Xd=sc,t=p0(),gf(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,u=-1,d=0,f=0,m=t,g=null;t:for(;;){for(var b;m!==n||s!==0&&m.nodeType!==3||(l=a+s),m!==i||r!==0&&m.nodeType!==3||(u=a+r),m.nodeType===3&&(a+=m.nodeValue.length),(b=m.firstChild)!==null;)g=m,m=b;for(;;){if(m===t)break t;if(g===n&&++d===s&&(l=a),g===i&&++f===r&&(u=a),(b=m.nextSibling)!==null)break;m=g,g=m.parentNode}m=b}n=l===-1||u===-1?null:{start:l,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(Jd={focusedElem:t,selectionRange:n},sc=!1,se=e;se!==null;)if(e=se,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,se=t;else for(;se!==null;){e=se;try{var S=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var E=S.memoizedProps,k=S.memoizedState,_=e.stateNode,x=_.getSnapshotBeforeUpdate(e.elementType===e.type?E:jn(e.type,E),k);_.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var N=e.stateNode.containerInfo;N.nodeType===1?N.textContent="":N.nodeType===9&&N.documentElement&&N.removeChild(N.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Y(163))}}catch(M){at(e,e.return,M)}if(t=e.sibling,t!==null){t.return=e.return,se=t;break}se=e.return}return S=Ag,Ag=!1,S}function Ba(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&mh(e,n,i)}s=s.next}while(s!==r)}}function Xc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function ph(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function dw(t){var e=t.alternate;e!==null&&(t.alternate=null,dw(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Kn],delete e[ao],delete e[th],delete e[pT],delete e[gT])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function hw(t){return t.tag===5||t.tag===3||t.tag===4}function Rg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||hw(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function gh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=oc));else if(r!==4&&(t=t.child,t!==null))for(gh(t,e,n),t=t.sibling;t!==null;)gh(t,e,n),t=t.sibling}function yh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(yh(t,e,n),t=t.sibling;t!==null;)yh(t,e,n),t=t.sibling}var kt=null,Dn=!1;function Vr(t,e,n){for(n=n.child;n!==null;)fw(t,e,n),n=n.sibling}function fw(t,e,n){if(Xn&&typeof Xn.onCommitFiberUnmount=="function")try{Xn.onCommitFiberUnmount(zc,n)}catch{}switch(n.tag){case 5:Wt||Ti(n,e);case 6:var r=kt,s=Dn;kt=null,Vr(t,e,n),kt=r,Dn=s,kt!==null&&(Dn?(t=kt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):kt.removeChild(n.stateNode));break;case 18:kt!==null&&(Dn?(t=kt,n=n.stateNode,t.nodeType===8?rd(t.parentNode,n):t.nodeType===1&&rd(t,n),to(t)):rd(kt,n.stateNode));break;case 4:r=kt,s=Dn,kt=n.stateNode.containerInfo,Dn=!0,Vr(t,e,n),kt=r,Dn=s;break;case 0:case 11:case 14:case 15:if(!Wt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&mh(n,e,a),s=s.next}while(s!==r)}Vr(t,e,n);break;case 1:if(!Wt&&(Ti(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){at(n,e,l)}Vr(t,e,n);break;case 21:Vr(t,e,n);break;case 22:n.mode&1?(Wt=(r=Wt)||n.memoizedState!==null,Vr(t,e,n),Wt=r):Vr(t,e,n);break;default:Vr(t,e,n)}}function jg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new RT),e.forEach(function(r){var s=BT.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function An(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 5:kt=l.stateNode,Dn=!1;break e;case 3:kt=l.stateNode.containerInfo,Dn=!0;break e;case 4:kt=l.stateNode.containerInfo,Dn=!0;break e}l=l.return}if(kt===null)throw Error(Y(160));fw(i,a,s),kt=null,Dn=!1;var u=s.alternate;u!==null&&(u.return=null),s.return=null}catch(d){at(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)mw(e,t),e=e.sibling}function mw(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(An(e,t),Wn(t),r&4){try{Ba(3,t,t.return),Xc(3,t)}catch(E){at(t,t.return,E)}try{Ba(5,t,t.return)}catch(E){at(t,t.return,E)}}break;case 1:An(e,t),Wn(t),r&512&&n!==null&&Ti(n,n.return);break;case 5:if(An(e,t),Wn(t),r&512&&n!==null&&Ti(n,n.return),t.flags&32){var s=t.stateNode;try{Xa(s,"")}catch(E){at(t,t.return,E)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,l=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Lv(s,i),Ud(l,a);var d=Ud(l,i);for(a=0;a<u.length;a+=2){var f=u[a],m=u[a+1];f==="style"?Uv(s,m):f==="dangerouslySetInnerHTML"?Fv(s,m):f==="children"?Xa(s,m):nf(s,f,m,d)}switch(l){case"input":Ld(s,i);break;case"textarea":Ov(s,i);break;case"select":var g=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var b=i.value;b!=null?ki(s,!!i.multiple,b,!1):g!==!!i.multiple&&(i.defaultValue!=null?ki(s,!!i.multiple,i.defaultValue,!0):ki(s,!!i.multiple,i.multiple?[]:"",!1))}s[ao]=i}catch(E){at(t,t.return,E)}}break;case 6:if(An(e,t),Wn(t),r&4){if(t.stateNode===null)throw Error(Y(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(E){at(t,t.return,E)}}break;case 3:if(An(e,t),Wn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{to(e.containerInfo)}catch(E){at(t,t.return,E)}break;case 4:An(e,t),Wn(t);break;case 13:An(e,t),Wn(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Lf=lt())),r&4&&jg(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(Wt=(d=Wt)||f,An(e,t),Wt=d):An(e,t),Wn(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!f&&t.mode&1)for(se=t,f=t.child;f!==null;){for(m=se=f;se!==null;){switch(g=se,b=g.child,g.tag){case 0:case 11:case 14:case 15:Ba(4,g,g.return);break;case 1:Ti(g,g.return);var S=g.stateNode;if(typeof S.componentWillUnmount=="function"){r=g,n=g.return;try{e=r,S.props=e.memoizedProps,S.state=e.memoizedState,S.componentWillUnmount()}catch(E){at(r,n,E)}}break;case 5:Ti(g,g.return);break;case 22:if(g.memoizedState!==null){Mg(m);continue}}b!==null?(b.return=g,se=b):Mg(m)}f=f.sibling}e:for(f=null,m=t;;){if(m.tag===5){if(f===null){f=m;try{s=m.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=m.stateNode,u=m.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,l.style.display=$v("display",a))}catch(E){at(t,t.return,E)}}}else if(m.tag===6){if(f===null)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(E){at(t,t.return,E)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;f===m&&(f=null),m=m.return}f===m&&(f=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:An(e,t),Wn(t),r&4&&jg(t);break;case 21:break;default:An(e,t),Wn(t)}}function Wn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(hw(n)){var r=n;break e}n=n.return}throw Error(Y(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Xa(s,""),r.flags&=-33);var i=Rg(t);yh(t,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,l=Rg(t);gh(t,l,a);break;default:throw Error(Y(161))}}catch(u){at(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function DT(t,e,n){se=t,pw(t)}function pw(t,e,n){for(var r=(t.mode&1)!==0;se!==null;){var s=se,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||El;if(!a){var l=s.alternate,u=l!==null&&l.memoizedState!==null||Wt;l=El;var d=Wt;if(El=a,(Wt=u)&&!d)for(se=s;se!==null;)a=se,u=a.child,a.tag===22&&a.memoizedState!==null?Lg(s):u!==null?(u.return=a,se=u):Lg(s);for(;i!==null;)se=i,pw(i),i=i.sibling;se=s,El=l,Wt=d}Dg(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,se=i):Dg(t)}}function Dg(t){for(;se!==null;){var e=se;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Wt||Xc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Wt)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:jn(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&vg(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}vg(e,a,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var f=d.memoizedState;if(f!==null){var m=f.dehydrated;m!==null&&to(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Y(163))}Wt||e.flags&512&&ph(e)}catch(g){at(e,e.return,g)}}if(e===t){se=null;break}if(n=e.sibling,n!==null){n.return=e.return,se=n;break}se=e.return}}function Mg(t){for(;se!==null;){var e=se;if(e===t){se=null;break}var n=e.sibling;if(n!==null){n.return=e.return,se=n;break}se=e.return}}function Lg(t){for(;se!==null;){var e=se;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Xc(4,e)}catch(u){at(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(u){at(e,s,u)}}var i=e.return;try{ph(e)}catch(u){at(e,i,u)}break;case 5:var a=e.return;try{ph(e)}catch(u){at(e,a,u)}}}catch(u){at(e,e.return,u)}if(e===t){se=null;break}var l=e.sibling;if(l!==null){l.return=e.return,se=l;break}se=e.return}}var MT=Math.ceil,vc=kr.ReactCurrentDispatcher,Df=kr.ReactCurrentOwner,En=kr.ReactCurrentBatchConfig,Re=0,Ct=null,ht=null,Pt=0,dn=0,Ci=xs(0),vt=0,fo=null,zs=0,Jc=0,Mf=0,za=null,nn=null,Lf=0,zi=1/0,lr=null,wc=!1,vh=null,ss=null,Tl=!1,Yr=null,xc=0,Wa=0,wh=null,Ul=-1,Bl=0;function Jt(){return Re&6?lt():Ul!==-1?Ul:Ul=lt()}function is(t){return t.mode&1?Re&2&&Pt!==0?Pt&-Pt:vT.transition!==null?(Bl===0&&(Bl=Zv()),Bl):(t=Ve,t!==0||(t=window.event,t=t===void 0?16:a0(t.type)),t):1}function On(t,e,n,r){if(50<Wa)throw Wa=0,wh=null,Error(Y(185));ko(t,n,r),(!(Re&2)||t!==Ct)&&(t===Ct&&(!(Re&2)&&(Jc|=n),vt===4&&Wr(t,Pt)),ln(t,r),n===1&&Re===0&&!(e.mode&1)&&(zi=lt()+500,Kc&&_s()))}function ln(t,e){var n=t.callbackNode;vE(t,e);var r=rc(t,t===Ct?Pt:0);if(r===0)n!==null&&qp(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&qp(n),e===1)t.tag===0?yT(Og.bind(null,t)):C0(Og.bind(null,t)),fT(function(){!(Re&6)&&_s()}),n=null;else{switch(e0(r)){case 1:n=lf;break;case 4:n=Xv;break;case 16:n=nc;break;case 536870912:n=Jv;break;default:n=nc}n=Ew(n,gw.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function gw(t,e){if(Ul=-1,Bl=0,Re&6)throw Error(Y(327));var n=t.callbackNode;if(Ri()&&t.callbackNode!==n)return null;var r=rc(t,t===Ct?Pt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=_c(t,r);else{e=r;var s=Re;Re|=2;var i=vw();(Ct!==t||Pt!==e)&&(lr=null,zi=lt()+500,Os(t,e));do try{VT();break}catch(l){yw(t,l)}while(1);_f(),vc.current=i,Re=s,ht!==null?e=0:(Ct=null,Pt=0,e=vt)}if(e!==0){if(e===2&&(s=Hd(t),s!==0&&(r=s,e=xh(t,s))),e===1)throw n=fo,Os(t,0),Wr(t,r),ln(t,lt()),n;if(e===6)Wr(t,r);else{if(s=t.current.alternate,!(r&30)&&!LT(s)&&(e=_c(t,r),e===2&&(i=Hd(t),i!==0&&(r=i,e=xh(t,i))),e===1))throw n=fo,Os(t,0),Wr(t,r),ln(t,lt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(Y(345));case 2:As(t,nn,lr);break;case 3:if(Wr(t,r),(r&130023424)===r&&(e=Lf+500-lt(),10<e)){if(rc(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Jt(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=eh(As.bind(null,t,nn,lr),e);break}As(t,nn,lr);break;case 4:if(Wr(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var a=31-Ln(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=lt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*MT(r/1960))-r,10<r){t.timeoutHandle=eh(As.bind(null,t,nn,lr),r);break}As(t,nn,lr);break;case 5:As(t,nn,lr);break;default:throw Error(Y(329))}}}return ln(t,lt()),t.callbackNode===n?gw.bind(null,t):null}function xh(t,e){var n=za;return t.current.memoizedState.isDehydrated&&(Os(t,e).flags|=256),t=_c(t,e),t!==2&&(e=nn,nn=n,e!==null&&_h(e)),t}function _h(t){nn===null?nn=t:nn.push.apply(nn,t)}function LT(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Fn(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Wr(t,e){for(e&=~Mf,e&=~Jc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ln(e),r=1<<n;t[n]=-1,e&=~r}}function Og(t){if(Re&6)throw Error(Y(327));Ri();var e=rc(t,0);if(!(e&1))return ln(t,lt()),null;var n=_c(t,e);if(t.tag!==0&&n===2){var r=Hd(t);r!==0&&(e=r,n=xh(t,r))}if(n===1)throw n=fo,Os(t,0),Wr(t,e),ln(t,lt()),n;if(n===6)throw Error(Y(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,As(t,nn,lr),ln(t,lt()),null}function Of(t,e){var n=Re;Re|=1;try{return t(e)}finally{Re=n,Re===0&&(zi=lt()+500,Kc&&_s())}}function Ws(t){Yr!==null&&Yr.tag===0&&!(Re&6)&&Ri();var e=Re;Re|=1;var n=En.transition,r=Ve;try{if(En.transition=null,Ve=1,t)return t()}finally{Ve=r,En.transition=n,Re=e,!(Re&6)&&_s()}}function Vf(){dn=Ci.current,Xe(Ci)}function Os(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,hT(n)),ht!==null)for(n=ht.return;n!==null;){var r=n;switch(vf(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&lc();break;case 3:Ui(),Xe(an),Xe(Gt),kf();break;case 5:Sf(r);break;case 4:Ui();break;case 13:Xe(Ze);break;case 19:Xe(Ze);break;case 10:bf(r.type._context);break;case 22:case 23:Vf()}n=n.return}if(Ct=t,ht=t=as(t.current,null),Pt=dn=e,vt=0,fo=null,Mf=Jc=zs=0,nn=za=null,Ds!==null){for(e=0;e<Ds.length;e++)if(n=Ds[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}n.pending=r}Ds=null}return t}function yw(t,e){do{var n=ht;try{if(_f(),Vl.current=yc,gc){for(var r=et.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}gc=!1}if(Bs=0,Tt=yt=et=null,Ua=!1,co=0,Df.current=null,n===null||n.return===null){vt=1,fo=e,ht=null;break}e:{var i=t,a=n.return,l=n,u=e;if(e=Pt,l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var d=u,f=l,m=f.tag;if(!(f.mode&1)&&(m===0||m===11||m===15)){var g=f.alternate;g?(f.updateQueue=g.updateQueue,f.memoizedState=g.memoizedState,f.lanes=g.lanes):(f.updateQueue=null,f.memoizedState=null)}var b=Tg(a);if(b!==null){b.flags&=-257,Cg(b,a,l,i,e),b.mode&1&&Eg(i,d,e),e=b,u=d;var S=e.updateQueue;if(S===null){var E=new Set;E.add(u),e.updateQueue=E}else S.add(u);break e}else{if(!(e&1)){Eg(i,d,e),Ff();break e}u=Error(Y(426))}}else if(Je&&l.mode&1){var k=Tg(a);if(k!==null){!(k.flags&65536)&&(k.flags|=256),Cg(k,a,l,i,e),wf(Bi(u,l));break e}}i=u=Bi(u,l),vt!==4&&(vt=2),za===null?za=[i]:za.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var _=ew(i,u,e);yg(i,_);break e;case 1:l=u;var x=i.type,N=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||N!==null&&typeof N.componentDidCatch=="function"&&(ss===null||!ss.has(N)))){i.flags|=65536,e&=-e,i.lanes|=e;var M=tw(i,l,e);yg(i,M);break e}}i=i.return}while(i!==null)}xw(n)}catch(D){e=D,ht===n&&n!==null&&(ht=n=n.return);continue}break}while(1)}function vw(){var t=vc.current;return vc.current=yc,t===null?yc:t}function Ff(){(vt===0||vt===3||vt===2)&&(vt=4),Ct===null||!(zs&268435455)&&!(Jc&268435455)||Wr(Ct,Pt)}function _c(t,e){var n=Re;Re|=2;var r=vw();(Ct!==t||Pt!==e)&&(lr=null,Os(t,e));do try{OT();break}catch(s){yw(t,s)}while(1);if(_f(),Re=n,vc.current=r,ht!==null)throw Error(Y(261));return Ct=null,Pt=0,vt}function OT(){for(;ht!==null;)ww(ht)}function VT(){for(;ht!==null&&!cE();)ww(ht)}function ww(t){var e=bw(t.alternate,t,dn);t.memoizedProps=t.pendingProps,e===null?xw(t):ht=e,Df.current=null}function xw(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=AT(n,e),n!==null){n.flags&=32767,ht=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{vt=6,ht=null;return}}else if(n=PT(n,e,dn),n!==null){ht=n;return}if(e=e.sibling,e!==null){ht=e;return}ht=e=t}while(e!==null);vt===0&&(vt=5)}function As(t,e,n){var r=Ve,s=En.transition;try{En.transition=null,Ve=1,FT(t,e,n,r)}finally{En.transition=s,Ve=r}return null}function FT(t,e,n,r){do Ri();while(Yr!==null);if(Re&6)throw Error(Y(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Y(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(wE(t,i),t===Ct&&(ht=Ct=null,Pt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Tl||(Tl=!0,Ew(nc,function(){return Ri(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=En.transition,En.transition=null;var a=Ve;Ve=1;var l=Re;Re|=4,Df.current=null,jT(t,n),mw(n,t),iT(Jd),sc=!!Xd,Jd=Xd=null,t.current=n,DT(n),uE(),Re=l,Ve=a,En.transition=i}else t.current=n;if(Tl&&(Tl=!1,Yr=t,xc=s),i=t.pendingLanes,i===0&&(ss=null),fE(n.stateNode),ln(t,lt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(wc)throw wc=!1,t=vh,vh=null,t;return xc&1&&t.tag!==0&&Ri(),i=t.pendingLanes,i&1?t===wh?Wa++:(Wa=0,wh=t):Wa=0,_s(),null}function Ri(){if(Yr!==null){var t=e0(xc),e=En.transition,n=Ve;try{if(En.transition=null,Ve=16>t?16:t,Yr===null)var r=!1;else{if(t=Yr,Yr=null,xc=0,Re&6)throw Error(Y(331));var s=Re;for(Re|=4,se=t.current;se!==null;){var i=se,a=i.child;if(se.flags&16){var l=i.deletions;if(l!==null){for(var u=0;u<l.length;u++){var d=l[u];for(se=d;se!==null;){var f=se;switch(f.tag){case 0:case 11:case 15:Ba(8,f,i)}var m=f.child;if(m!==null)m.return=f,se=m;else for(;se!==null;){f=se;var g=f.sibling,b=f.return;if(dw(f),f===d){se=null;break}if(g!==null){g.return=b,se=g;break}se=b}}}var S=i.alternate;if(S!==null){var E=S.child;if(E!==null){S.child=null;do{var k=E.sibling;E.sibling=null,E=k}while(E!==null)}}se=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,se=a;else e:for(;se!==null;){if(i=se,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ba(9,i,i.return)}var _=i.sibling;if(_!==null){_.return=i.return,se=_;break e}se=i.return}}var x=t.current;for(se=x;se!==null;){a=se;var N=a.child;if(a.subtreeFlags&2064&&N!==null)N.return=a,se=N;else e:for(a=x;se!==null;){if(l=se,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Xc(9,l)}}catch(D){at(l,l.return,D)}if(l===a){se=null;break e}var M=l.sibling;if(M!==null){M.return=l.return,se=M;break e}se=l.return}}if(Re=s,_s(),Xn&&typeof Xn.onPostCommitFiberRoot=="function")try{Xn.onPostCommitFiberRoot(zc,t)}catch{}r=!0}return r}finally{Ve=n,En.transition=e}}return!1}function Vg(t,e,n){e=Bi(n,e),e=ew(t,e,1),t=rs(t,e,1),e=Jt(),t!==null&&(ko(t,1,e),ln(t,e))}function at(t,e,n){if(t.tag===3)Vg(t,t,n);else for(;e!==null;){if(e.tag===3){Vg(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ss===null||!ss.has(r))){t=Bi(n,t),t=tw(e,t,1),e=rs(e,t,1),t=Jt(),e!==null&&(ko(e,1,t),ln(e,t));break}}e=e.return}}function $T(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Jt(),t.pingedLanes|=t.suspendedLanes&n,Ct===t&&(Pt&n)===n&&(vt===4||vt===3&&(Pt&130023424)===Pt&&500>lt()-Lf?Os(t,0):Mf|=n),ln(t,e)}function _w(t,e){e===0&&(t.mode&1?(e=ml,ml<<=1,!(ml&130023424)&&(ml=4194304)):e=1);var n=Jt();t=_r(t,e),t!==null&&(ko(t,e,n),ln(t,n))}function UT(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),_w(t,n)}function BT(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Y(314))}r!==null&&r.delete(e),_w(t,n)}var bw;bw=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||an.current)sn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return sn=!1,NT(t,e,n);sn=!!(t.flags&131072)}else sn=!1,Je&&e.flags&1048576&&S0(e,dc,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;$l(t,e),t=e.pendingProps;var s=Vi(e,Gt.current);Ai(e,n),s=Nf(null,e,r,t,s,n);var i=Pf();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,on(r)?(i=!0,cc(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Tf(e),s.updater=Yc,e.stateNode=s,s._reactInternals=e,oh(e,r,t,n),e=uh(null,e,r,!0,i,n)):(e.tag=0,Je&&i&&yf(e),Xt(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch($l(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=WT(r),t=jn(r,t),s){case 0:e=ch(null,e,r,t,n);break e;case 1:e=Ig(null,e,r,t,n);break e;case 11:e=Sg(null,e,r,t,n);break e;case 14:e=kg(null,e,r,jn(r.type,t),n);break e}throw Error(Y(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:jn(r,s),ch(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:jn(r,s),Ig(t,e,r,s,n);case 3:e:{if(iw(e),t===null)throw Error(Y(387));r=e.pendingProps,i=e.memoizedState,s=i.element,R0(t,e),mc(e,r,null,n);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Bi(Error(Y(423)),e),e=Ng(t,e,r,n,s);break e}else if(r!==s){s=Bi(Error(Y(424)),e),e=Ng(t,e,r,n,s);break e}else for(hn=ns(e.stateNode.containerInfo.firstChild),mn=e,Je=!0,Mn=null,n=P0(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Fi(),r===s){e=br(t,e,n);break e}Xt(t,e,r,n)}e=e.child}return e;case 5:return j0(e),t===null&&sh(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,a=s.children,Zd(r,s)?a=null:i!==null&&Zd(r,i)&&(e.flags|=32),sw(t,e),Xt(t,e,a,n),e.child;case 6:return t===null&&sh(e),null;case 13:return aw(t,e,n);case 4:return Cf(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=$i(e,null,r,n):Xt(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:jn(r,s),Sg(t,e,r,s,n);case 7:return Xt(t,e,e.pendingProps,n),e.child;case 8:return Xt(t,e,e.pendingProps.children,n),e.child;case 12:return Xt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,We(hc,r._currentValue),r._currentValue=a,i!==null)if(Fn(i.value,a)){if(i.children===s.children&&!an.current){e=br(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var u=l.firstContext;u!==null;){if(u.context===r){if(i.tag===1){u=gr(-1,n&-n),u.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var f=d.pending;f===null?u.next=u:(u.next=f.next,f.next=u),d.pending=u}}i.lanes|=n,u=i.alternate,u!==null&&(u.lanes|=n),ih(i.return,n,e),l.lanes|=n;break}u=u.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(Y(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),ih(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Xt(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Ai(e,n),s=Cn(s),r=r(s),e.flags|=1,Xt(t,e,r,n),e.child;case 14:return r=e.type,s=jn(r,e.pendingProps),s=jn(r.type,s),kg(t,e,r,s,n);case 15:return nw(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:jn(r,s),$l(t,e),e.tag=1,on(r)?(t=!0,cc(e)):t=!1,Ai(e,n),Z0(e,r,s),oh(e,r,s,n),uh(null,e,r,!0,t,n);case 19:return ow(t,e,n);case 22:return rw(t,e,n)}throw Error(Y(156,e.tag))};function Ew(t,e){return Yv(t,e)}function zT(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function bn(t,e,n,r){return new zT(t,e,n,r)}function $f(t){return t=t.prototype,!(!t||!t.isReactComponent)}function WT(t){if(typeof t=="function")return $f(t)?1:0;if(t!=null){if(t=t.$$typeof,t===sf)return 11;if(t===af)return 14}return 2}function as(t,e){var n=t.alternate;return n===null?(n=bn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function zl(t,e,n,r,s,i){var a=2;if(r=t,typeof t=="function")$f(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case pi:return Vs(n.children,s,i,e);case rf:a=8,s|=8;break;case Ad:return t=bn(12,n,e,s|2),t.elementType=Ad,t.lanes=i,t;case Rd:return t=bn(13,n,e,s),t.elementType=Rd,t.lanes=i,t;case jd:return t=bn(19,n,e,s),t.elementType=jd,t.lanes=i,t;case jv:return Zc(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Av:a=10;break e;case Rv:a=9;break e;case sf:a=11;break e;case af:a=14;break e;case Ur:a=16,r=null;break e}throw Error(Y(130,t==null?t:typeof t,""))}return e=bn(a,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Vs(t,e,n,r){return t=bn(7,t,r,e),t.lanes=n,t}function Zc(t,e,n,r){return t=bn(22,t,r,e),t.elementType=jv,t.lanes=n,t.stateNode={isHidden:!1},t}function dd(t,e,n){return t=bn(6,t,null,e),t.lanes=n,t}function hd(t,e,n){return e=bn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function qT(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Hu(0),this.expirationTimes=Hu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Hu(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Uf(t,e,n,r,s,i,a,l,u){return t=new qT(t,e,n,l,u),e===1?(e=1,i===!0&&(e|=8)):e=0,i=bn(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Tf(i),t}function HT(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:mi,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Tw(t){if(!t)return fs;t=t._reactInternals;e:{if(Js(t)!==t||t.tag!==1)throw Error(Y(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(on(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Y(171))}if(t.tag===1){var n=t.type;if(on(n))return T0(t,n,e)}return e}function Cw(t,e,n,r,s,i,a,l,u){return t=Uf(n,r,!0,t,s,i,a,l,u),t.context=Tw(null),n=t.current,r=Jt(),s=is(n),i=gr(r,s),i.callback=e??null,rs(n,i,s),t.current.lanes=s,ko(t,s,r),ln(t,r),t}function eu(t,e,n,r){var s=e.current,i=Jt(),a=is(s);return n=Tw(n),e.context===null?e.context=n:e.pendingContext=n,e=gr(i,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=rs(s,e,a),t!==null&&(On(t,s,a,i),Ol(t,s,a)),a}function bc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Fg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Bf(t,e){Fg(t,e),(t=t.alternate)&&Fg(t,e)}function GT(){return null}var Sw=typeof reportError=="function"?reportError:function(t){console.error(t)};function zf(t){this._internalRoot=t}tu.prototype.render=zf.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Y(409));eu(t,e,null,null)};tu.prototype.unmount=zf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ws(function(){eu(null,t,null,null)}),e[xr]=null}};function tu(t){this._internalRoot=t}tu.prototype.unstable_scheduleHydration=function(t){if(t){var e=r0();t={blockedOn:null,target:t,priority:e};for(var n=0;n<zr.length&&e!==0&&e<zr[n].priority;n++);zr.splice(n,0,t),n===0&&i0(t)}};function Wf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function nu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function $g(){}function KT(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=bc(a);i.call(d)}}var a=Cw(e,r,t,0,null,!1,!1,"",$g);return t._reactRootContainer=a,t[xr]=a.current,so(t.nodeType===8?t.parentNode:t),Ws(),a}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=bc(u);l.call(d)}}var u=Uf(t,0,!1,null,null,!1,!1,"",$g);return t._reactRootContainer=u,t[xr]=u.current,so(t.nodeType===8?t.parentNode:t),Ws(function(){eu(e,u,n,r)}),u}function ru(t,e,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var l=s;s=function(){var u=bc(a);l.call(u)}}eu(e,a,t,s)}else a=KT(n,e,t,s,r);return bc(a)}t0=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ia(e.pendingLanes);n!==0&&(cf(e,n|1),ln(e,lt()),!(Re&6)&&(zi=lt()+500,_s()))}break;case 13:Ws(function(){var r=_r(t,1);if(r!==null){var s=Jt();On(r,t,1,s)}}),Bf(t,1)}};uf=function(t){if(t.tag===13){var e=_r(t,134217728);if(e!==null){var n=Jt();On(e,t,134217728,n)}Bf(t,134217728)}};n0=function(t){if(t.tag===13){var e=is(t),n=_r(t,e);if(n!==null){var r=Jt();On(n,t,e,r)}Bf(t,e)}};r0=function(){return Ve};s0=function(t,e){var n=Ve;try{return Ve=t,e()}finally{Ve=n}};zd=function(t,e,n){switch(e){case"input":if(Ld(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Gc(r);if(!s)throw Error(Y(90));Mv(r),Ld(r,s)}}}break;case"textarea":Ov(t,n);break;case"select":e=n.value,e!=null&&ki(t,!!n.multiple,e,!1)}};Wv=Of;qv=Ws;var QT={usingClientEntryPoint:!1,Events:[No,wi,Gc,Bv,zv,Of]},Ta={findFiberByHostInstance:js,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},YT={bundleType:Ta.bundleType,version:Ta.version,rendererPackageName:Ta.rendererPackageName,rendererConfig:Ta.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:kr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Kv(t),t===null?null:t.stateNode},findFiberByHostInstance:Ta.findFiberByHostInstance||GT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Cl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Cl.isDisabled&&Cl.supportsFiber)try{zc=Cl.inject(YT),Xn=Cl}catch{}}yn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=QT;yn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Wf(e))throw Error(Y(200));return HT(t,e,null,n)};yn.createRoot=function(t,e){if(!Wf(t))throw Error(Y(299));var n=!1,r="",s=Sw;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Uf(t,1,!1,null,null,n,!1,r,s),t[xr]=e.current,so(t.nodeType===8?t.parentNode:t),new zf(e)};yn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Y(188)):(t=Object.keys(t).join(","),Error(Y(268,t)));return t=Kv(e),t=t===null?null:t.stateNode,t};yn.flushSync=function(t){return Ws(t)};yn.hydrate=function(t,e,n){if(!nu(e))throw Error(Y(200));return ru(null,t,e,!0,n)};yn.hydrateRoot=function(t,e,n){if(!Wf(t))throw Error(Y(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",a=Sw;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=Cw(e,null,t,1,n??null,s,!1,i,a),t[xr]=e.current,so(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new tu(e)};yn.render=function(t,e,n){if(!nu(e))throw Error(Y(200));return ru(null,t,e,!1,n)};yn.unmountComponentAtNode=function(t){if(!nu(t))throw Error(Y(40));return t._reactRootContainer?(Ws(function(){ru(null,null,t,!1,function(){t._reactRootContainer=null,t[xr]=null})}),!0):!1};yn.unstable_batchedUpdates=Of;yn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!nu(n))throw Error(Y(200));if(t==null||t._reactInternals===void 0)throw Error(Y(38));return ru(t,e,n,!1,r)};yn.version="18.3.1-next-f1338f8080-20240426";function kw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(kw)}catch(t){console.error(t)}}kw(),kv.exports=yn;var XT=kv.exports,Ug=XT;Nd.createRoot=Ug.createRoot,Nd.hydrateRoot=Ug.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function mo(){return mo=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},mo.apply(this,arguments)}var Xr;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Xr||(Xr={}));const Bg="popstate";function JT(t){t===void 0&&(t={});function e(r,s){let{pathname:i,search:a,hash:l}=r.location;return bh("",{pathname:i,search:a,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:Ec(s)}return e1(e,n,null,t)}function mt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Iw(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function ZT(){return Math.random().toString(36).substr(2,8)}function zg(t,e){return{usr:t.state,key:t.key,idx:e}}function bh(t,e,n,r){return n===void 0&&(n=null),mo({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?ta(e):e,{state:n,key:e&&e.key||r||ZT()})}function Ec(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function ta(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function e1(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,l=Xr.Pop,u=null,d=f();d==null&&(d=0,a.replaceState(mo({},a.state,{idx:d}),""));function f(){return(a.state||{idx:null}).idx}function m(){l=Xr.Pop;let k=f(),_=k==null?null:k-d;d=k,u&&u({action:l,location:E.location,delta:_})}function g(k,_){l=Xr.Push;let x=bh(E.location,k,_);n&&n(x,k),d=f()+1;let N=zg(x,d),M=E.createHref(x);try{a.pushState(N,"",M)}catch(D){if(D instanceof DOMException&&D.name==="DataCloneError")throw D;s.location.assign(M)}i&&u&&u({action:l,location:E.location,delta:1})}function b(k,_){l=Xr.Replace;let x=bh(E.location,k,_);n&&n(x,k),d=f();let N=zg(x,d),M=E.createHref(x);a.replaceState(N,"",M),i&&u&&u({action:l,location:E.location,delta:0})}function S(k){let _=s.location.origin!=="null"?s.location.origin:s.location.href,x=typeof k=="string"?k:Ec(k);return x=x.replace(/ $/,"%20"),mt(_,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,_)}let E={get action(){return l},get location(){return t(s,a)},listen(k){if(u)throw new Error("A history only accepts one active listener");return s.addEventListener(Bg,m),u=k,()=>{s.removeEventListener(Bg,m),u=null}},createHref(k){return e(s,k)},createURL:S,encodeLocation(k){let _=S(k);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:g,replace:b,go(k){return a.go(k)}};return E}var Wg;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Wg||(Wg={}));function t1(t,e,n){return n===void 0&&(n="/"),n1(t,e,n,!1)}function n1(t,e,n,r){let s=typeof e=="string"?ta(e):e,i=qf(s.pathname||"/",n);if(i==null)return null;let a=Nw(t);r1(a);let l=null;for(let u=0;l==null&&u<a.length;++u){let d=m1(i);l=h1(a[u],d,r)}return l}function Nw(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(i,a,l)=>{let u={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};u.relativePath.startsWith("/")&&(mt(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=os([r,u.relativePath]),f=n.concat(u);i.children&&i.children.length>0&&(mt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),Nw(i.children,e,f,d)),!(i.path==null&&!i.index)&&e.push({path:d,score:u1(d,i.index),routesMeta:f})};return t.forEach((i,a)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))s(i,a);else for(let u of Pw(i.path))s(i,a,u)}),e}function Pw(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let a=Pw(r.join("/")),l=[];return l.push(...a.map(u=>u===""?i:[i,u].join("/"))),s&&l.push(...a),l.map(u=>t.startsWith("/")&&u===""?"/":u)}function r1(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:d1(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const s1=/^:[\w-]+$/,i1=3,a1=2,o1=1,l1=10,c1=-2,qg=t=>t==="*";function u1(t,e){let n=t.split("/"),r=n.length;return n.some(qg)&&(r+=c1),e&&(r+=a1),n.filter(s=>!qg(s)).reduce((s,i)=>s+(s1.test(i)?i1:i===""?o1:l1),r)}function d1(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function h1(t,e,n){n===void 0&&(n=!1);let{routesMeta:r}=t,s={},i="/",a=[];for(let l=0;l<r.length;++l){let u=r[l],d=l===r.length-1,f=i==="/"?e:e.slice(i.length)||"/",m=Hg({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},f),g=u.route;if(!m&&d&&n&&!r[r.length-1].route.index&&(m=Hg({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},f)),!m)return null;Object.assign(s,m.params),a.push({params:s,pathname:os([i,m.pathname]),pathnameBase:v1(os([i,m.pathnameBase])),route:g}),m.pathnameBase!=="/"&&(i=os([i,m.pathnameBase]))}return a}function Hg(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=f1(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,f,m)=>{let{paramName:g,isOptional:b}=f;if(g==="*"){let E=l[m]||"";a=i.slice(0,i.length-E.length).replace(/(.)\/+$/,"$1")}const S=l[m];return b&&!S?d[g]=void 0:d[g]=(S||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:a,pattern:t}}function f1(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Iw(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,u)=>(r.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function m1(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Iw(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function qf(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function p1(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?ta(t):t;return{pathname:n?n.startsWith("/")?n:g1(n,e):e,search:w1(r),hash:x1(s)}}function g1(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function fd(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function y1(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Aw(t,e){let n=y1(t);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function Rw(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=ta(t):(s=mo({},t),mt(!s.pathname||!s.pathname.includes("?"),fd("?","pathname","search",s)),mt(!s.pathname||!s.pathname.includes("#"),fd("#","pathname","hash",s)),mt(!s.search||!s.search.includes("#"),fd("#","search","hash",s)));let i=t===""||s.pathname==="",a=i?"/":s.pathname,l;if(a==null)l=n;else{let m=e.length-1;if(!r&&a.startsWith("..")){let g=a.split("/");for(;g[0]==="..";)g.shift(),m-=1;s.pathname=g.join("/")}l=m>=0?e[m]:"/"}let u=p1(s,l),d=a&&a!=="/"&&a.endsWith("/"),f=(i||a===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(d||f)&&(u.pathname+="/"),u}const os=t=>t.join("/").replace(/\/\/+/g,"/"),v1=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),w1=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,x1=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function _1(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const jw=["post","put","patch","delete"];new Set(jw);const b1=["get",...jw];new Set(b1);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function po(){return po=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},po.apply(this,arguments)}const Hf=R.createContext(null),E1=R.createContext(null),Zs=R.createContext(null),su=R.createContext(null),bs=R.createContext({outlet:null,matches:[],isDataRoute:!1}),Dw=R.createContext(null);function T1(t,e){let{relative:n}=e===void 0?{}:e;Ao()||mt(!1);let{basename:r,navigator:s}=R.useContext(Zs),{hash:i,pathname:a,search:l}=Lw(t,{relative:n}),u=a;return r!=="/"&&(u=a==="/"?r:os([r,a])),s.createHref({pathname:u,search:l,hash:i})}function Ao(){return R.useContext(su)!=null}function ei(){return Ao()||mt(!1),R.useContext(su).location}function Mw(t){R.useContext(Zs).static||R.useLayoutEffect(t)}function zn(){let{isDataRoute:t}=R.useContext(bs);return t?O1():C1()}function C1(){Ao()||mt(!1);let t=R.useContext(Hf),{basename:e,future:n,navigator:r}=R.useContext(Zs),{matches:s}=R.useContext(bs),{pathname:i}=ei(),a=JSON.stringify(Aw(s,n.v7_relativeSplatPath)),l=R.useRef(!1);return Mw(()=>{l.current=!0}),R.useCallback(function(d,f){if(f===void 0&&(f={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let m=Rw(d,JSON.parse(a),i,f.relative==="path");t==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:os([e,m.pathname])),(f.replace?r.replace:r.push)(m,f.state,f)},[e,r,a,i,t])}function iu(){let{matches:t}=R.useContext(bs),e=t[t.length-1];return e?e.params:{}}function Lw(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=R.useContext(Zs),{matches:s}=R.useContext(bs),{pathname:i}=ei(),a=JSON.stringify(Aw(s,r.v7_relativeSplatPath));return R.useMemo(()=>Rw(t,JSON.parse(a),i,n==="path"),[t,a,i,n])}function S1(t,e){return k1(t,e)}function k1(t,e,n,r){Ao()||mt(!1);let{navigator:s}=R.useContext(Zs),{matches:i}=R.useContext(bs),a=i[i.length-1],l=a?a.params:{};a&&a.pathname;let u=a?a.pathnameBase:"/";a&&a.route;let d=ei(),f;if(e){var m;let k=typeof e=="string"?ta(e):e;u==="/"||(m=k.pathname)!=null&&m.startsWith(u)||mt(!1),f=k}else f=d;let g=f.pathname||"/",b=g;if(u!=="/"){let k=u.replace(/^\//,"").split("/");b="/"+g.replace(/^\//,"").split("/").slice(k.length).join("/")}let S=t1(t,{pathname:b}),E=R1(S&&S.map(k=>Object.assign({},k,{params:Object.assign({},l,k.params),pathname:os([u,s.encodeLocation?s.encodeLocation(k.pathname).pathname:k.pathname]),pathnameBase:k.pathnameBase==="/"?u:os([u,s.encodeLocation?s.encodeLocation(k.pathnameBase).pathname:k.pathnameBase])})),i,n,r);return e&&E?R.createElement(su.Provider,{value:{location:po({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:Xr.Pop}},E):E}function I1(){let t=L1(),e=_1(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return R.createElement(R.Fragment,null,R.createElement("h2",null,"Unexpected Application Error!"),R.createElement("h3",{style:{fontStyle:"italic"}},e),n?R.createElement("pre",{style:s},n):null,i)}const N1=R.createElement(I1,null);class P1 extends R.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?R.createElement(bs.Provider,{value:this.props.routeContext},R.createElement(Dw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function A1(t){let{routeContext:e,match:n,children:r}=t,s=R.useContext(Hf);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),R.createElement(bs.Provider,{value:e},r)}function R1(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var i;if(!n)return null;if(n.errors)t=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let a=t,l=(s=n)==null?void 0:s.errors;if(l!=null){let f=a.findIndex(m=>m.route.id&&(l==null?void 0:l[m.route.id])!==void 0);f>=0||mt(!1),a=a.slice(0,Math.min(a.length,f+1))}let u=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let f=0;f<a.length;f++){let m=a[f];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(d=f),m.route.id){let{loaderData:g,errors:b}=n,S=m.route.loader&&g[m.route.id]===void 0&&(!b||b[m.route.id]===void 0);if(m.route.lazy||S){u=!0,d>=0?a=a.slice(0,d+1):a=[a[0]];break}}}return a.reduceRight((f,m,g)=>{let b,S=!1,E=null,k=null;n&&(b=l&&m.route.id?l[m.route.id]:void 0,E=m.route.errorElement||N1,u&&(d<0&&g===0?(V1("route-fallback",!1),S=!0,k=null):d===g&&(S=!0,k=m.route.hydrateFallbackElement||null)));let _=e.concat(a.slice(0,g+1)),x=()=>{let N;return b?N=E:S?N=k:m.route.Component?N=R.createElement(m.route.Component,null):m.route.element?N=m.route.element:N=f,R.createElement(A1,{match:m,routeContext:{outlet:f,matches:_,isDataRoute:n!=null},children:N})};return n&&(m.route.ErrorBoundary||m.route.errorElement||g===0)?R.createElement(P1,{location:n.location,revalidation:n.revalidation,component:E,error:b,children:x(),routeContext:{outlet:null,matches:_,isDataRoute:!0}}):x()},null)}var Ow=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Ow||{}),Tc=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Tc||{});function j1(t){let e=R.useContext(Hf);return e||mt(!1),e}function D1(t){let e=R.useContext(E1);return e||mt(!1),e}function M1(t){let e=R.useContext(bs);return e||mt(!1),e}function Vw(t){let e=M1(),n=e.matches[e.matches.length-1];return n.route.id||mt(!1),n.route.id}function L1(){var t;let e=R.useContext(Dw),n=D1(Tc.UseRouteError),r=Vw(Tc.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function O1(){let{router:t}=j1(Ow.UseNavigateStable),e=Vw(Tc.UseNavigateStable),n=R.useRef(!1);return Mw(()=>{n.current=!0}),R.useCallback(function(s,i){i===void 0&&(i={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,po({fromRouteId:e},i)))},[t,e])}const Gg={};function V1(t,e,n){!e&&!Gg[t]&&(Gg[t]=!0)}function F1(t,e){t==null||t.v7_startTransition,(t==null?void 0:t.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function Rn(t){mt(!1)}function $1(t){let{basename:e="/",children:n=null,location:r,navigationType:s=Xr.Pop,navigator:i,static:a=!1,future:l}=t;Ao()&&mt(!1);let u=e.replace(/^\/*/,"/"),d=R.useMemo(()=>({basename:u,navigator:i,static:a,future:po({v7_relativeSplatPath:!1},l)}),[u,l,i,a]);typeof r=="string"&&(r=ta(r));let{pathname:f="/",search:m="",hash:g="",state:b=null,key:S="default"}=r,E=R.useMemo(()=>{let k=qf(f,u);return k==null?null:{location:{pathname:k,search:m,hash:g,state:b,key:S},navigationType:s}},[u,f,m,g,b,S,s]);return E==null?null:R.createElement(Zs.Provider,{value:d},R.createElement(su.Provider,{children:n,value:E}))}function U1(t){let{children:e,location:n}=t;return S1(Eh(e),n)}new Promise(()=>{});function Eh(t,e){e===void 0&&(e=[]);let n=[];return R.Children.forEach(t,(r,s)=>{if(!R.isValidElement(r))return;let i=[...e,s];if(r.type===R.Fragment){n.push.apply(n,Eh(r.props.children,i));return}r.type!==Rn&&mt(!1),!r.props.index||!r.props.children||mt(!1);let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Eh(r.props.children,i)),n.push(a)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Th(){return Th=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Th.apply(this,arguments)}function B1(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function z1(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function W1(t,e){return t.button===0&&(!e||e==="_self")&&!z1(t)}const q1=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],H1="6";try{window.__reactRouterVersion=H1}catch{}const G1="startTransition",Kg=$b[G1];function K1(t){let{basename:e,children:n,future:r,window:s}=t,i=R.useRef();i.current==null&&(i.current=JT({window:s,v5Compat:!0}));let a=i.current,[l,u]=R.useState({action:a.action,location:a.location}),{v7_startTransition:d}=r||{},f=R.useCallback(m=>{d&&Kg?Kg(()=>u(m)):u(m)},[u,d]);return R.useLayoutEffect(()=>a.listen(f),[a,f]),R.useEffect(()=>F1(r),[r]),R.createElement($1,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:a,future:r})}const Q1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Y1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Gn=R.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:i,replace:a,state:l,target:u,to:d,preventScrollReset:f,viewTransition:m}=e,g=B1(e,q1),{basename:b}=R.useContext(Zs),S,E=!1;if(typeof d=="string"&&Y1.test(d)&&(S=d,Q1))try{let N=new URL(window.location.href),M=d.startsWith("//")?new URL(N.protocol+d):new URL(d),D=qf(M.pathname,b);M.origin===N.origin&&D!=null?d=D+M.search+M.hash:E=!0}catch{}let k=T1(d,{relative:s}),_=X1(d,{replace:a,state:l,target:u,preventScrollReset:f,relative:s,viewTransition:m});function x(N){r&&r(N),N.defaultPrevented||_(N)}return R.createElement("a",Th({},g,{href:S||k,onClick:E||i?r:x,ref:n,target:u}))});var Qg;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Qg||(Qg={}));var Yg;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Yg||(Yg={}));function X1(t,e){let{target:n,replace:r,state:s,preventScrollReset:i,relative:a,viewTransition:l}=e===void 0?{}:e,u=zn(),d=ei(),f=Lw(t,{relative:a});return R.useCallback(m=>{if(W1(m,n)){m.preventDefault();let g=r!==void 0?r:Ec(d)===Ec(f);u(t,{replace:g,state:s,preventScrollReset:i,relative:a,viewTransition:l})}},[d,u,f,r,s,n,t,i,a,l])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fw=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},J1=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],a=t[n++],l=t[n++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=t[n++],a=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},$w={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],a=s+1<t.length,l=a?t[s+1]:0,u=s+2<t.length,d=u?t[s+2]:0,f=i>>2,m=(i&3)<<4|l>>4;let g=(l&15)<<2|d>>6,b=d&63;u||(b=64,a||(g=64)),r.push(n[f],n[m],n[g],n[b])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Fw(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):J1(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const m=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||m==null)throw new Z1;const g=i<<2|l>>4;if(r.push(g),d!==64){const b=l<<4&240|d>>2;if(r.push(b),m!==64){const S=d<<6&192|m;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Z1 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const eC=function(t){const e=Fw(t);return $w.encodeByteArray(e,!0)},Cc=function(t){return eC(t).replace(/\./g,"")},Uw=function(t){try{return $w.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nC=()=>tC().__FIREBASE_DEFAULTS__,rC=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},sC=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Uw(t[1]);return e&&JSON.parse(e)},au=()=>{try{return nC()||rC()||sC()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Bw=t=>{var e,n;return(n=(e=au())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},iC=t=>{const e=Bw(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},zw=()=>{var t;return(t=au())===null||t===void 0?void 0:t.config},Ww=t=>{var e;return(e=au())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aC{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oC(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t),l="";return[Cc(JSON.stringify(n)),Cc(JSON.stringify(a)),l].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function lC(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Kt())}function cC(){var t;const e=(t=au())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function uC(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function dC(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function hC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function fC(){const t=Kt();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function mC(){return!cC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function pC(){try{return typeof indexedDB=="object"}catch{return!1}}function gC(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yC="FirebaseError";class Ir extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=yC,Object.setPrototypeOf(this,Ir.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ro.prototype.create)}}class Ro{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?vC(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new Ir(s,l,r)}}function vC(t,e){return t.replace(wC,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const wC=/\{\$([^}]+)}/g;function xC(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Sc(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],a=e[s];if(Xg(i)&&Xg(a)){if(!Sc(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function Xg(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jo(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Pa(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Aa(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function _C(t,e){const n=new bC(t,e);return n.subscribe.bind(n)}class bC{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");EC(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=md),s.error===void 0&&(s.error=md),s.complete===void 0&&(s.complete=md);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function EC(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function md(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pt(t){return t&&t._delegate?t._delegate:t}class qs{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rs="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TC{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new aC;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(SC(e))try{this.getOrInitializeService({instanceIdentifier:Rs})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Rs){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Rs){return this.instances.has(e)}getOptions(e=Rs){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,n){var r;const s=this.normalizeInstanceIdentifier(n),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const a=this.instances.get(s);return a&&e(a,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:CC(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Rs){return this.component?this.component.multipleInstances?e:Rs:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function CC(t){return t===Rs?void 0:t}function SC(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new TC(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ne;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Ne||(Ne={}));const IC={debug:Ne.DEBUG,verbose:Ne.VERBOSE,info:Ne.INFO,warn:Ne.WARN,error:Ne.ERROR,silent:Ne.SILENT},NC=Ne.INFO,PC={[Ne.DEBUG]:"log",[Ne.VERBOSE]:"log",[Ne.INFO]:"info",[Ne.WARN]:"warn",[Ne.ERROR]:"error"},AC=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=PC[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Gf{constructor(e){this.name=e,this._logLevel=NC,this._logHandler=AC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ne))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?IC[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ne.DEBUG,...e),this._logHandler(this,Ne.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ne.VERBOSE,...e),this._logHandler(this,Ne.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ne.INFO,...e),this._logHandler(this,Ne.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ne.WARN,...e),this._logHandler(this,Ne.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ne.ERROR,...e),this._logHandler(this,Ne.ERROR,...e)}}const RC=(t,e)=>e.some(n=>t instanceof n);let Jg,Zg;function jC(){return Jg||(Jg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function DC(){return Zg||(Zg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const qw=new WeakMap,Ch=new WeakMap,Hw=new WeakMap,pd=new WeakMap,Kf=new WeakMap;function MC(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",a)},i=()=>{n(ls(t.result)),s()},a=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",a)});return e.then(n=>{n instanceof IDBCursor&&qw.set(n,t)}).catch(()=>{}),Kf.set(e,t),e}function LC(t){if(Ch.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",a),t.removeEventListener("abort",a)},i=()=>{n(),s()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",a),t.addEventListener("abort",a)});Ch.set(t,e)}let Sh={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Ch.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Hw.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ls(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function OC(t){Sh=t(Sh)}function VC(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(gd(this),e,...n);return Hw.set(r,e.sort?e.sort():[e]),ls(r)}:DC().includes(t)?function(...e){return t.apply(gd(this),e),ls(qw.get(this))}:function(...e){return ls(t.apply(gd(this),e))}}function FC(t){return typeof t=="function"?VC(t):(t instanceof IDBTransaction&&LC(t),RC(t,jC())?new Proxy(t,Sh):t)}function ls(t){if(t instanceof IDBRequest)return MC(t);if(pd.has(t))return pd.get(t);const e=FC(t);return e!==t&&(pd.set(t,e),Kf.set(e,t)),e}const gd=t=>Kf.get(t);function $C(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(t,e),l=ls(a);return r&&a.addEventListener("upgradeneeded",u=>{r(ls(a.result),u.oldVersion,u.newVersion,ls(a.transaction),u)}),n&&a.addEventListener("blocked",u=>n(u.oldVersion,u.newVersion,u)),l.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const UC=["get","getKey","getAll","getAllKeys","count"],BC=["put","add","delete","clear"],yd=new Map;function ey(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(yd.get(e))return yd.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=BC.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||UC.includes(n)))return;const i=async function(a,...l){const u=this.transaction(a,s?"readwrite":"readonly");let d=u.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&u.done]))[0]};return yd.set(e,i),i}OC(t=>({...t,get:(e,n,r)=>ey(e,n)||t.get(e,n,r),has:(e,n)=>!!ey(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(WC(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function WC(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const kh="@firebase/app",ty="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Er=new Gf("@firebase/app"),qC="@firebase/app-compat",HC="@firebase/analytics-compat",GC="@firebase/analytics",KC="@firebase/app-check-compat",QC="@firebase/app-check",YC="@firebase/auth",XC="@firebase/auth-compat",JC="@firebase/database",ZC="@firebase/data-connect",eS="@firebase/database-compat",tS="@firebase/functions",nS="@firebase/functions-compat",rS="@firebase/installations",sS="@firebase/installations-compat",iS="@firebase/messaging",aS="@firebase/messaging-compat",oS="@firebase/performance",lS="@firebase/performance-compat",cS="@firebase/remote-config",uS="@firebase/remote-config-compat",dS="@firebase/storage",hS="@firebase/storage-compat",fS="@firebase/firestore",mS="@firebase/vertexai-preview",pS="@firebase/firestore-compat",gS="firebase",yS="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ih="[DEFAULT]",vS={[kh]:"fire-core",[qC]:"fire-core-compat",[GC]:"fire-analytics",[HC]:"fire-analytics-compat",[QC]:"fire-app-check",[KC]:"fire-app-check-compat",[YC]:"fire-auth",[XC]:"fire-auth-compat",[JC]:"fire-rtdb",[ZC]:"fire-data-connect",[eS]:"fire-rtdb-compat",[tS]:"fire-fn",[nS]:"fire-fn-compat",[rS]:"fire-iid",[sS]:"fire-iid-compat",[iS]:"fire-fcm",[aS]:"fire-fcm-compat",[oS]:"fire-perf",[lS]:"fire-perf-compat",[cS]:"fire-rc",[uS]:"fire-rc-compat",[dS]:"fire-gcs",[hS]:"fire-gcs-compat",[fS]:"fire-fst",[pS]:"fire-fst-compat",[mS]:"fire-vertex","fire-js":"fire-js",[gS]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kc=new Map,wS=new Map,Nh=new Map;function ny(t,e){try{t.container.addComponent(e)}catch(n){Er.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Wi(t){const e=t.name;if(Nh.has(e))return Er.debug(`There were multiple attempts to register component ${e}.`),!1;Nh.set(e,t);for(const n of kc.values())ny(n,t);for(const n of wS.values())ny(n,t);return!0}function Qf(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Yn(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},cs=new Ro("app","Firebase",xS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _S{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new qs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw cs.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const na=yS;function Gw(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Ih,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw cs.create("bad-app-name",{appName:String(s)});if(n||(n=zw()),!n)throw cs.create("no-options");const i=kc.get(s);if(i){if(Sc(n,i.options)&&Sc(r,i.config))return i;throw cs.create("duplicate-app",{appName:s})}const a=new kC(s);for(const u of Nh.values())a.addComponent(u);const l=new _S(n,r,a);return kc.set(s,l),l}function Kw(t=Ih){const e=kc.get(t);if(!e&&t===Ih&&zw())return Gw();if(!e)throw cs.create("no-app",{appName:t});return e}function us(t,e,n){var r;let s=(r=vS[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const l=[`Unable to register library "${s}" with version "${e}":`];i&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Er.warn(l.join(" "));return}Wi(new qs(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bS="firebase-heartbeat-database",ES=1,go="firebase-heartbeat-store";let vd=null;function Qw(){return vd||(vd=$C(bS,ES,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(go)}catch(n){console.warn(n)}}}}).catch(t=>{throw cs.create("idb-open",{originalErrorMessage:t.message})})),vd}async function TS(t){try{const n=(await Qw()).transaction(go),r=await n.objectStore(go).get(Yw(t));return await n.done,r}catch(e){if(e instanceof Ir)Er.warn(e.message);else{const n=cs.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Er.warn(n.message)}}}async function ry(t,e){try{const r=(await Qw()).transaction(go,"readwrite");await r.objectStore(go).put(e,Yw(t)),await r.done}catch(n){if(n instanceof Ir)Er.warn(n.message);else{const r=cs.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Er.warn(r.message)}}}function Yw(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CS=1024,SS=30*24*60*60*1e3;class kS{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new NS(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=sy();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const l=new Date(a.date).valueOf();return Date.now()-l<=SS}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Er.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=sy(),{heartbeatsToSend:r,unsentEntries:s}=IS(this._heartbeatsCache.heartbeats),i=Cc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Er.warn(n),""}}}function sy(){return new Date().toISOString().substring(0,10)}function IS(t,e=CS){const n=[];let r=t.slice();for(const s of t){const i=n.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),iy(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),iy(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class NS{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return pC()?gC().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await TS(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return ry(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return ry(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function iy(t){return Cc(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PS(t){Wi(new qs("platform-logger",e=>new zC(e),"PRIVATE")),Wi(new qs("heartbeat",e=>new kS(e),"PRIVATE")),us(kh,ty,t),us(kh,ty,"esm2017"),us("fire-js","")}PS("");function Yf(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function Xw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const AS=Xw,Jw=new Ro("auth","Firebase",Xw());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ic=new Gf("@firebase/auth");function RS(t,...e){Ic.logLevel<=Ne.WARN&&Ic.warn(`Auth (${na}): ${t}`,...e)}function Wl(t,...e){Ic.logLevel<=Ne.ERROR&&Ic.error(`Auth (${na}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $n(t,...e){throw Xf(t,...e)}function Zn(t,...e){return Xf(t,...e)}function Zw(t,e,n){const r=Object.assign(Object.assign({},AS()),{[e]:n});return new Ro("auth","Firebase",r).create(e,{appName:t.name})}function yr(t){return Zw(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Xf(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return Jw.create(t,...e)}function he(t,e,...n){if(!t)throw Xf(e,...n)}function fr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Wl(e),new Error(e)}function Tr(t,e){t||fr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ph(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function jS(){return ay()==="http:"||ay()==="https:"}function ay(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DS(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(jS()||dC()||"connection"in navigator)?navigator.onLine:!0}function MS(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(e,n){this.shortDelay=e,this.longDelay=n,Tr(n>e,"Short delay should be less than long delay!"),this.isMobile=lC()||hC()}get(){return DS()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jf(t,e){Tr(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ex{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;fr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;fr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;fr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LS={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OS=new Do(3e4,6e4);function Nr(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Pr(t,e,n,r,s={}){return tx(t,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=jo(Object.assign({key:t.config.apiKey},a)).slice(1),u=await t._getAdditionalHeaders();u["Content-Type"]="application/json",t.languageCode&&(u["X-Firebase-Locale"]=t.languageCode);const d=Object.assign({method:e,headers:u},i);return uC()||(d.referrerPolicy="no-referrer"),ex.fetch()(nx(t,t.config.apiHost,n,l),d)})}async function tx(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},LS),e);try{const s=new FS(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Sl(t,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[u,d]=l.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Sl(t,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw Sl(t,"email-already-in-use",a);if(u==="USER_DISABLED")throw Sl(t,"user-disabled",a);const f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Zw(t,f,d);$n(t,f)}}catch(s){if(s instanceof Ir)throw s;$n(t,"network-request-failed",{message:String(s)})}}async function Mo(t,e,n,r,s={}){const i=await Pr(t,e,n,r,s);return"mfaPendingCredential"in i&&$n(t,"multi-factor-auth-required",{_serverResponse:i}),i}function nx(t,e,n,r){const s=`${e}${n}?${r}`;return t.config.emulator?Jf(t.config,s):`${t.config.apiScheme}://${s}`}function VS(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class FS{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Zn(this.auth,"network-request-failed")),OS.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Sl(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Zn(t,e,r);return s.customData._tokenResponse=n,s}function oy(t){return t!==void 0&&t.enterprise!==void 0}class $S{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return VS(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function US(t,e){return Pr(t,"GET","/v2/recaptchaConfig",Nr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BS(t,e){return Pr(t,"POST","/v1/accounts:delete",e)}async function rx(t,e){return Pr(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qa(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function zS(t,e=!1){const n=pt(t),r=await n.getIdToken(e),s=Zf(r);he(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:qa(wd(s.auth_time)),issuedAtTime:qa(wd(s.iat)),expirationTime:qa(wd(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function wd(t){return Number(t)*1e3}function Zf(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Wl("JWT malformed, contained fewer than 3 sections"),null;try{const s=Uw(n);return s?JSON.parse(s):(Wl("Failed to decode base64 JWT payload"),null)}catch(s){return Wl("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function ly(t){const e=Zf(t);return he(e,"internal-error"),he(typeof e.exp<"u","internal-error"),he(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yo(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Ir&&WS(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function WS({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qS{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=qa(this.lastLoginAt),this.creationTime=qa(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nc(t){var e;const n=t.auth,r=await t.getIdToken(),s=await yo(t,rx(n,{idToken:r}));he(s==null?void 0:s.users.length,n,"internal-error");const i=s.users[0];t._notifyReloadListener(i);const a=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?sx(i.providerUserInfo):[],l=GS(t.providerData,a),u=t.isAnonymous,d=!(t.email&&i.passwordHash)&&!(l!=null&&l.length),f=u?d:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new Ah(i.createdAt,i.lastLoginAt),isAnonymous:f};Object.assign(t,m)}async function HS(t){const e=pt(t);await Nc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function GS(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function sx(t){return t.map(e=>{var{providerId:n}=e,r=Yf(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KS(t,e){const n=await tx(t,{},async()=>{const r=jo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,a=nx(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",ex.fetch()(a,{method:"POST",headers:l,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function QS(t,e){return Pr(t,"POST","/v2/accounts:revokeToken",Nr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ji{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){he(e.idToken,"internal-error"),he(typeof e.idToken<"u","internal-error"),he(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ly(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){he(e.length!==0,"internal-error");const n=ly(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(he(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await KS(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,a=new ji;return r&&(he(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(he(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(he(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ji,this.toJSON())}_performRefresh(){return fr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fr(t,e){he(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class mr{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,i=Yf(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new qS(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Ah(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await yo(this,this.stsTokenManager.getToken(this.auth,e));return he(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return zS(this,e)}reload(){return HS(this)}_assign(e){this!==e&&(he(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new mr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){he(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Nc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Yn(this.auth.app))return Promise.reject(yr(this.auth));const e=await this.getIdToken();return await yo(this,BS(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,i,a,l,u,d,f;const m=(r=n.displayName)!==null&&r!==void 0?r:void 0,g=(s=n.email)!==null&&s!==void 0?s:void 0,b=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,S=(a=n.photoURL)!==null&&a!==void 0?a:void 0,E=(l=n.tenantId)!==null&&l!==void 0?l:void 0,k=(u=n._redirectEventId)!==null&&u!==void 0?u:void 0,_=(d=n.createdAt)!==null&&d!==void 0?d:void 0,x=(f=n.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:N,emailVerified:M,isAnonymous:D,providerData:U,stsTokenManager:v}=n;he(N&&v,e,"internal-error");const y=ji.fromJSON(this.name,v);he(typeof N=="string",e,"internal-error"),Fr(m,e.name),Fr(g,e.name),he(typeof M=="boolean",e,"internal-error"),he(typeof D=="boolean",e,"internal-error"),Fr(b,e.name),Fr(S,e.name),Fr(E,e.name),Fr(k,e.name),Fr(_,e.name),Fr(x,e.name);const T=new mr({uid:N,auth:e,email:g,emailVerified:M,displayName:m,isAnonymous:D,photoURL:S,phoneNumber:b,tenantId:E,stsTokenManager:y,createdAt:_,lastLoginAt:x});return U&&Array.isArray(U)&&(T.providerData=U.map(C=>Object.assign({},C))),k&&(T._redirectEventId=k),T}static async _fromIdTokenResponse(e,n,r=!1){const s=new ji;s.updateFromServerResponse(n);const i=new mr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Nc(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];he(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?sx(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new ji;l.updateFromIdToken(r);const u=new mr({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Ah(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(u,d),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cy=new Map;function pr(t){Tr(t instanceof Function,"Expected a class definition");let e=cy.get(t);return e?(Tr(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,cy.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ix{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}ix.type="NONE";const uy=ix;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ql(t,e,n){return`firebase:${t}:${e}:${n}`}class Di{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=ql(this.userKey,s.apiKey,i),this.fullPersistenceKey=ql("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?mr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Di(pr(uy),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||pr(uy);const a=ql(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const f=await d._get(a);if(f){const m=mr._fromJSON(e,f);d!==i&&(l=m),i=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new Di(i,e,r):(i=u[0],l&&await i._set(a,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new Di(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dy(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(cx(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ax(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(dx(e))return"Blackberry";if(hx(e))return"Webos";if(ox(e))return"Safari";if((e.includes("chrome/")||lx(e))&&!e.includes("edge/"))return"Chrome";if(ux(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function ax(t=Kt()){return/firefox\//i.test(t)}function ox(t=Kt()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function lx(t=Kt()){return/crios\//i.test(t)}function cx(t=Kt()){return/iemobile/i.test(t)}function ux(t=Kt()){return/android/i.test(t)}function dx(t=Kt()){return/blackberry/i.test(t)}function hx(t=Kt()){return/webos/i.test(t)}function em(t=Kt()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function YS(t=Kt()){var e;return em(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function XS(){return fC()&&document.documentMode===10}function fx(t=Kt()){return em(t)||ux(t)||hx(t)||dx(t)||/windows phone/i.test(t)||cx(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mx(t,e=[]){let n;switch(t){case"Browser":n=dy(Kt());break;case"Worker":n=`${dy(Kt())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${na}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JS{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((a,l)=>{try{const u=e(i);a(u)}catch(u){l(u)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZS(t,e={}){return Pr(t,"GET","/v2/passwordPolicy",Nr(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ek=6;class tk{constructor(e){var n,r,s,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=a.minPasswordLength)!==null&&n!==void 0?n:ek,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,s,i,a,l;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(n=u.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(s=u.containsLowercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(i=u.containsUppercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(a=u.containsNumericCharacter)!==null&&a!==void 0?a:!0),u.isValid&&(u.isValid=(l=u.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),u}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nk{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new hy(this),this.idTokenSubscription=new hy(this),this.beforeStateQueue=new JS(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Jw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=pr(n)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Di.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await rx(this,{idToken:e}),r=await mr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(Yn(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(l,l))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,l=s==null?void 0:s._redirectEventId,u=await this.tryRedirectSignIn(e);(!a||a===l)&&(u!=null&&u.user)&&(s=u.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return he(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Nc(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=MS()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Yn(this.app))return Promise.reject(yr(this));const n=e?pt(e):null;return n&&he(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&he(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Yn(this.app)?Promise.reject(yr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Yn(this.app)?Promise.reject(yr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(pr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await ZS(this),n=new tk(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ro("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await QS(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&pr(e)||this._popupRedirectResolver;he(n,this,"argument-error"),this.redirectPersistenceManager=await Di.create(this,[pr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(he(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof n=="function"){const u=e.addObserver(n,r,s);return()=>{a=!0,u()}}else{const u=e.addObserver(n);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return he(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=mx(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&RS(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function ti(t){return pt(t)}class hy{constructor(e){this.auth=e,this.observer=null,this.addObserver=_C(n=>this.observer=n)}get next(){return he(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ou={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function rk(t){ou=t}function px(t){return ou.loadJS(t)}function sk(){return ou.recaptchaEnterpriseScript}function ik(){return ou.gapiScript}function ak(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const ok="recaptcha-enterprise",lk="NO_RECAPTCHA";class ck{constructor(e){this.type=ok,this.auth=ti(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,l)=>{US(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new $S(u);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(u=>{l(u)})})}function s(i,a,l){const u=window.grecaptcha;oy(u)?u.enterprise.ready(()=>{u.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(lk)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,a)=>{r(this.auth).then(l=>{if(!n&&oy(window.grecaptcha))s(l,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=sk();u.length!==0&&(u+=l),px(u).then(()=>{s(l,i,a)}).catch(d=>{a(d)})}}).catch(l=>{a(l)})})}}async function fy(t,e,n,r=!1){const s=new ck(t);let i;try{i=await s.verify(n)}catch{i=await s.verify(n,!0)}const a=Object.assign({},e);return r?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Rh(t,e,n,r){var s;if(!((s=t._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await fy(t,e,n,n==="getOobCode");return r(t,i)}else return r(t,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await fy(t,e,n,n==="getOobCode");return r(t,a)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uk(t,e){const n=Qf(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Sc(i,e??{}))return s;$n(s,"already-initialized")}return n.initialize({options:e})}function dk(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(pr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function hk(t,e,n){const r=ti(t);he(r._canInitEmulator,r,"emulator-config-failed"),he(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(n!=null&&n.disableWarnings),i=gx(e),{host:a,port:l}=fk(e),u=l===null?"":`:${l}`;r.config.emulator={url:`${i}//${a}${u}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||mk()}function gx(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function fk(t){const e=gx(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:my(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:my(a)}}}function my(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function mk(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tm{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return fr("not implemented")}_getIdTokenResponse(e){return fr("not implemented")}_linkToIdToken(e,n){return fr("not implemented")}_getReauthenticationResolver(e){return fr("not implemented")}}async function pk(t,e){return Pr(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gk(t,e){return Mo(t,"POST","/v1/accounts:signInWithPassword",Nr(t,e))}async function yk(t,e){return Pr(t,"POST","/v1/accounts:sendOobCode",Nr(t,e))}async function vk(t,e){return yk(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wk(t,e){return Mo(t,"POST","/v1/accounts:signInWithEmailLink",Nr(t,e))}async function xk(t,e){return Mo(t,"POST","/v1/accounts:signInWithEmailLink",Nr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo extends tm{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new vo(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new vo(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Rh(e,n,"signInWithPassword",gk);case"emailLink":return wk(e,{email:this._email,oobCode:this._password});default:$n(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Rh(e,r,"signUpPassword",pk);case"emailLink":return xk(e,{idToken:n,email:this._email,oobCode:this._password});default:$n(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mi(t,e){return Mo(t,"POST","/v1/accounts:signInWithIdp",Nr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _k="http://localhost";class Hs extends tm{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Hs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):$n("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,i=Yf(n,["providerId","signInMethod"]);if(!r||!s)return null;const a=new Hs(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const n=this.buildRequest();return Mi(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Mi(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Mi(e,n)}buildRequest(){const e={requestUri:_k,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=jo(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bk(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Ek(t){const e=Pa(Aa(t)).link,n=e?Pa(Aa(e)).deep_link_id:null,r=Pa(Aa(t)).deep_link_id;return(r?Pa(Aa(r)).link:null)||r||n||e||t}class nm{constructor(e){var n,r,s,i,a,l;const u=Pa(Aa(e)),d=(n=u.apiKey)!==null&&n!==void 0?n:null,f=(r=u.oobCode)!==null&&r!==void 0?r:null,m=bk((s=u.mode)!==null&&s!==void 0?s:null);he(d&&f&&m,"argument-error"),this.apiKey=d,this.operation=m,this.code=f,this.continueUrl=(i=u.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(a=u.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(l=u.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const n=Ek(e);try{return new nm(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(){this.providerId=ra.PROVIDER_ID}static credential(e,n){return vo._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=nm.parseLink(n);return he(r,"argument-error"),vo._fromEmailAndCode(e,r.code,r.tenantId)}}ra.PROVIDER_ID="password";ra.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ra.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yx{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo extends yx{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qr extends Lo{constructor(){super("facebook.com")}static credential(e){return Hs._fromParams({providerId:qr.PROVIDER_ID,signInMethod:qr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qr.credentialFromTaggedObject(e)}static credentialFromError(e){return qr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qr.credential(e.oauthAccessToken)}catch{return null}}}qr.FACEBOOK_SIGN_IN_METHOD="facebook.com";qr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hr extends Lo{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Hs._fromParams({providerId:Hr.PROVIDER_ID,signInMethod:Hr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Hr.credentialFromTaggedObject(e)}static credentialFromError(e){return Hr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Hr.credential(n,r)}catch{return null}}}Hr.GOOGLE_SIGN_IN_METHOD="google.com";Hr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr extends Lo{constructor(){super("github.com")}static credential(e){return Hs._fromParams({providerId:Gr.PROVIDER_ID,signInMethod:Gr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Gr.credentialFromTaggedObject(e)}static credentialFromError(e){return Gr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Gr.credential(e.oauthAccessToken)}catch{return null}}}Gr.GITHUB_SIGN_IN_METHOD="github.com";Gr.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kr extends Lo{constructor(){super("twitter.com")}static credential(e,n){return Hs._fromParams({providerId:Kr.PROVIDER_ID,signInMethod:Kr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Kr.credentialFromTaggedObject(e)}static credentialFromError(e){return Kr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Kr.credential(n,r)}catch{return null}}}Kr.TWITTER_SIGN_IN_METHOD="twitter.com";Kr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tk(t,e){return Mo(t,"POST","/v1/accounts:signUp",Nr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await mr._fromIdTokenResponse(e,r,s),a=py(r);return new Gs({user:i,providerId:a,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=py(r);return new Gs({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function py(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc extends Ir{constructor(e,n,r,s){var i;super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Pc.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new Pc(e,n,r,s)}}function vx(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Pc._fromErrorAndOperation(t,i,e,r):i})}async function Ck(t,e,n=!1){const r=await yo(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Gs._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sk(t,e,n=!1){const{auth:r}=t;if(Yn(r.app))return Promise.reject(yr(r));const s="reauthenticate";try{const i=await yo(t,vx(r,s,e,t),n);he(i.idToken,r,"internal-error");const a=Zf(i.idToken);he(a,r,"internal-error");const{sub:l}=a;return he(t.uid===l,r,"user-mismatch"),Gs._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&$n(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wx(t,e,n=!1){if(Yn(t.app))return Promise.reject(yr(t));const r="signIn",s=await vx(t,r,e),i=await Gs._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function kk(t,e){return wx(ti(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ik(t,e,n){var r;he(((r=n.url)===null||r===void 0?void 0:r.length)>0,t,"invalid-continue-uri"),he(typeof n.dynamicLinkDomain>"u"||n.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=n.url,e.dynamicLinkDomain=n.dynamicLinkDomain,e.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(he(n.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=n.iOS.bundleId),n.android&&(he(n.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=n.android.installApp,e.androidMinimumVersionCode=n.android.minimumVersion,e.androidPackageName=n.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xx(t){const e=ti(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Nk(t,e,n){if(Yn(t.app))return Promise.reject(yr(t));const r=ti(t),a=await Rh(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Tk).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&xx(t),u}),l=await Gs._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function Pk(t,e,n){return Yn(t.app)?Promise.reject(yr(t)):kk(pt(t),ra.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&xx(t),r})}async function Ak(t,e){const n=pt(t),s={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()};e&&Ik(n.auth,s,e);const{email:i}=await vk(n.auth,s);i!==t.email&&await t.reload()}function Rk(t,e,n,r){return pt(t).onIdTokenChanged(e,n,r)}function jk(t,e,n){return pt(t).beforeAuthStateChanged(e,n)}function Dk(t,e,n,r){return pt(t).onAuthStateChanged(e,n,r)}function _x(t){return pt(t).signOut()}const Ac="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bx{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Ac,"1"),this.storage.removeItem(Ac),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mk=1e3,Lk=10;class Ex extends bx{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=fx(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((a,l,u)=>{this.notifyListeners(a,u)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!n&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);XS()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Lk):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},Mk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ex.type="LOCAL";const Ok=Ex;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tx extends bx{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}Tx.type="SESSION";const Cx=Tx;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vk(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lu{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new lu(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(n.origin,i)),u=await Vk(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}lu.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rm(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,u)=>{const d=rm("",20);s.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(m){const g=m;if(g.data.eventId===d)switch(g.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(g.data.response);break;default:clearTimeout(f),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function er(){return window}function $k(t){er().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sx(){return typeof er().WorkerGlobalScope<"u"&&typeof er().importScripts=="function"}async function Uk(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Bk(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function zk(){return Sx()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kx="firebaseLocalStorageDb",Wk=1,Rc="firebaseLocalStorage",Ix="fbase_key";class Oo{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function cu(t,e){return t.transaction([Rc],e?"readwrite":"readonly").objectStore(Rc)}function qk(){const t=indexedDB.deleteDatabase(kx);return new Oo(t).toPromise()}function jh(){const t=indexedDB.open(kx,Wk);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Rc,{keyPath:Ix})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Rc)?e(r):(r.close(),await qk(),e(await jh()))})})}async function gy(t,e,n){const r=cu(t,!0).put({[Ix]:e,value:n});return new Oo(r).toPromise()}async function Hk(t,e){const n=cu(t,!1).get(e),r=await new Oo(n).toPromise();return r===void 0?null:r.value}function yy(t,e){const n=cu(t,!0).delete(e);return new Oo(n).toPromise()}const Gk=800,Kk=3;class Nx{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await jh(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>Kk)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Sx()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=lu._getInstance(zk()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await Uk(),!this.activeServiceWorker)return;this.sender=new Fk(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Bk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await jh();return await gy(e,Ac,"1"),await yy(e,Ac),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>gy(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>Hk(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>yy(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=cu(s,!1).getAll();return new Oo(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Gk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Nx.type="LOCAL";const Qk=Nx;new Do(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yk(t,e){return e?pr(e):(he(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sm extends tm{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Mi(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Mi(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Mi(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function Xk(t){return wx(t.auth,new sm(t),t.bypassAuthState)}function Jk(t){const{auth:e,user:n}=t;return he(n,e,"internal-error"),Sk(n,new sm(t),t.bypassAuthState)}async function Zk(t){const{auth:e,user:n}=t;return he(n,e,"internal-error"),Ck(n,new sm(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Px{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Xk;case"linkViaPopup":case"linkViaRedirect":return Zk;case"reauthViaPopup":case"reauthViaRedirect":return Jk;default:$n(this.auth,"internal-error")}}resolve(e){Tr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Tr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eI=new Do(2e3,1e4);class Si extends Px{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Si.currentPopupAction&&Si.currentPopupAction.cancel(),Si.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return he(e,this.auth,"internal-error"),e}async onExecution(){Tr(this.filter.length===1,"Popup operations only handle one event");const e=rm();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Zn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Zn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Si.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Zn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,eI.get())};e()}}Si.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tI="pendingRedirect",Hl=new Map;class nI extends Px{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Hl.get(this.auth._key());if(!e){try{const r=await rI(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Hl.set(this.auth._key(),e)}return this.bypassAuthState||Hl.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function rI(t,e){const n=aI(e),r=iI(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function sI(t,e){Hl.set(t._key(),e)}function iI(t){return pr(t._redirectPersistence)}function aI(t){return ql(tI,t.config.apiKey,t.name)}async function oI(t,e,n=!1){if(Yn(t.app))return Promise.reject(yr(t));const r=ti(t),s=Yk(r,e),a=await new nI(r,s,n).execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lI=10*60*1e3;class cI{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!uI(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!Ax(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(Zn(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=lI&&this.cachedEventUids.clear(),this.cachedEventUids.has(vy(e))}saveEventToCache(e){this.cachedEventUids.add(vy(e)),this.lastProcessedEventTime=Date.now()}}function vy(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Ax({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function uI(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ax(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dI(t,e={}){return Pr(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hI=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,fI=/^https?/;async function mI(t){if(t.config.emulator)return;const{authorizedDomains:e}=await dI(t);for(const n of e)try{if(pI(n))return}catch{}$n(t,"unauthorized-domain")}function pI(t){const e=Ph(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&a.hostname===r}if(!fI.test(n))return!1;if(hI.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gI=new Do(3e4,6e4);function wy(){const t=er().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function yI(t){return new Promise((e,n)=>{var r,s,i;function a(){wy(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{wy(),n(Zn(t,"network-request-failed"))},timeout:gI.get()})}if(!((s=(r=er().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=er().gapi)===null||i===void 0)&&i.load)a();else{const l=ak("iframefcb");return er()[l]=()=>{gapi.load?a():n(Zn(t,"network-request-failed"))},px(`${ik()}?onload=${l}`).catch(u=>n(u))}}).catch(e=>{throw Gl=null,e})}let Gl=null;function vI(t){return Gl=Gl||yI(t),Gl}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wI=new Do(5e3,15e3),xI="__/auth/iframe",_I="emulator/auth/iframe",bI={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},EI=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function TI(t){const e=t.config;he(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Jf(e,_I):`https://${t.config.authDomain}/${xI}`,r={apiKey:e.apiKey,appName:t.name,v:na},s=EI.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${jo(r).slice(1)}`}async function CI(t){const e=await vI(t),n=er().gapi;return he(n,t,"internal-error"),e.open({where:document.body,url:TI(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:bI,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=Zn(t,"network-request-failed"),l=er().setTimeout(()=>{i(a)},wI.get());function u(){er().clearTimeout(l),s(r)}r.ping(u).then(u,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SI={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},kI=500,II=600,NI="_blank",PI="http://localhost";class xy{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function AI(t,e,n,r=kI,s=II){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const u=Object.assign(Object.assign({},SI),{width:r.toString(),height:s.toString(),top:i,left:a}),d=Kt().toLowerCase();n&&(l=lx(d)?NI:n),ax(d)&&(e=e||PI,u.scrollbars="yes");const f=Object.entries(u).reduce((g,[b,S])=>`${g}${b}=${S},`,"");if(YS(d)&&l!=="_self")return RI(e||"",l),new xy(null);const m=window.open(e||"",l,f);he(m,t,"popup-blocked");try{m.focus()}catch{}return new xy(m)}function RI(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jI="__/auth/handler",DI="emulator/auth/handler",MI=encodeURIComponent("fac");async function _y(t,e,n,r,s,i){he(t.config.authDomain,t,"auth-domain-config-required"),he(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:na,eventId:s};if(e instanceof yx){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",xC(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,m]of Object.entries(i||{}))a[f]=m}if(e instanceof Lo){const f=e.getScopes().filter(m=>m!=="");f.length>0&&(a.scopes=f.join(","))}t.tenantId&&(a.tid=t.tenantId);const l=a;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const u=await t._getAppCheckToken(),d=u?`#${MI}=${encodeURIComponent(u)}`:"";return`${LI(t)}?${jo(l).slice(1)}${d}`}function LI({config:t}){return t.emulator?Jf(t,DI):`https://${t.authDomain}/${jI}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xd="webStorageSupport";class OI{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Cx,this._completeRedirectFn=oI,this._overrideRedirectResult=sI}async _openPopup(e,n,r,s){var i;Tr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await _y(e,n,r,Ph(),s);return AI(e,a,rm())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await _y(e,n,r,Ph(),s);return $k(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(Tr(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await CI(e),r=new cI(e);return n.register("authEvent",s=>(he(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(xd,{type:xd},s=>{var i;const a=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[xd];a!==void 0&&n(!!a),$n(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=mI(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return fx()||ox()||em()}}const VI=OI;var by="@firebase/auth",Ey="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FI{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){he(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $I(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function UI(t){Wi(new qs("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;he(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:mx(t)},d=new nk(r,s,i,u);return dk(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Wi(new qs("auth-internal",e=>{const n=ti(e.getProvider("auth").getImmediate());return(r=>new FI(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),us(by,Ey,$I(t)),us(by,Ey,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BI=5*60,zI=Ww("authIdTokenMaxAge")||BI;let Ty=null;const WI=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>zI)return;const s=n==null?void 0:n.token;Ty!==s&&(Ty=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function qI(t=Kw()){const e=Qf(t,"auth");if(e.isInitialized())return e.getImmediate();const n=uk(t,{popupRedirectResolver:VI,persistence:[Qk,Ok,Cx]}),r=Ww("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=WI(i.toString());jk(n,a,()=>a(n.currentUser)),Rk(n,l=>a(l))}}const s=Bw("auth");return s&&hk(n,`http://${s}`),n}function HI(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}rk({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Zn("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",HI().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});UI("Browser");var GI="firebase",KI="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */us(GI,KI,"app");var Cy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Fs,Rx;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(v,y){function T(){}T.prototype=y.prototype,v.D=y.prototype,v.prototype=new T,v.prototype.constructor=v,v.C=function(C,A,P){for(var I=Array(arguments.length-2),ke=2;ke<arguments.length;ke++)I[ke-2]=arguments[ke];return y.prototype[A].apply(C,I)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,y,T){T||(T=0);var C=Array(16);if(typeof y=="string")for(var A=0;16>A;++A)C[A]=y.charCodeAt(T++)|y.charCodeAt(T++)<<8|y.charCodeAt(T++)<<16|y.charCodeAt(T++)<<24;else for(A=0;16>A;++A)C[A]=y[T++]|y[T++]<<8|y[T++]<<16|y[T++]<<24;y=v.g[0],T=v.g[1],A=v.g[2];var P=v.g[3],I=y+(P^T&(A^P))+C[0]+3614090360&4294967295;y=T+(I<<7&4294967295|I>>>25),I=P+(A^y&(T^A))+C[1]+3905402710&4294967295,P=y+(I<<12&4294967295|I>>>20),I=A+(T^P&(y^T))+C[2]+606105819&4294967295,A=P+(I<<17&4294967295|I>>>15),I=T+(y^A&(P^y))+C[3]+3250441966&4294967295,T=A+(I<<22&4294967295|I>>>10),I=y+(P^T&(A^P))+C[4]+4118548399&4294967295,y=T+(I<<7&4294967295|I>>>25),I=P+(A^y&(T^A))+C[5]+1200080426&4294967295,P=y+(I<<12&4294967295|I>>>20),I=A+(T^P&(y^T))+C[6]+2821735955&4294967295,A=P+(I<<17&4294967295|I>>>15),I=T+(y^A&(P^y))+C[7]+4249261313&4294967295,T=A+(I<<22&4294967295|I>>>10),I=y+(P^T&(A^P))+C[8]+1770035416&4294967295,y=T+(I<<7&4294967295|I>>>25),I=P+(A^y&(T^A))+C[9]+2336552879&4294967295,P=y+(I<<12&4294967295|I>>>20),I=A+(T^P&(y^T))+C[10]+4294925233&4294967295,A=P+(I<<17&4294967295|I>>>15),I=T+(y^A&(P^y))+C[11]+2304563134&4294967295,T=A+(I<<22&4294967295|I>>>10),I=y+(P^T&(A^P))+C[12]+1804603682&4294967295,y=T+(I<<7&4294967295|I>>>25),I=P+(A^y&(T^A))+C[13]+4254626195&4294967295,P=y+(I<<12&4294967295|I>>>20),I=A+(T^P&(y^T))+C[14]+2792965006&4294967295,A=P+(I<<17&4294967295|I>>>15),I=T+(y^A&(P^y))+C[15]+1236535329&4294967295,T=A+(I<<22&4294967295|I>>>10),I=y+(A^P&(T^A))+C[1]+4129170786&4294967295,y=T+(I<<5&4294967295|I>>>27),I=P+(T^A&(y^T))+C[6]+3225465664&4294967295,P=y+(I<<9&4294967295|I>>>23),I=A+(y^T&(P^y))+C[11]+643717713&4294967295,A=P+(I<<14&4294967295|I>>>18),I=T+(P^y&(A^P))+C[0]+3921069994&4294967295,T=A+(I<<20&4294967295|I>>>12),I=y+(A^P&(T^A))+C[5]+3593408605&4294967295,y=T+(I<<5&4294967295|I>>>27),I=P+(T^A&(y^T))+C[10]+38016083&4294967295,P=y+(I<<9&4294967295|I>>>23),I=A+(y^T&(P^y))+C[15]+3634488961&4294967295,A=P+(I<<14&4294967295|I>>>18),I=T+(P^y&(A^P))+C[4]+3889429448&4294967295,T=A+(I<<20&4294967295|I>>>12),I=y+(A^P&(T^A))+C[9]+568446438&4294967295,y=T+(I<<5&4294967295|I>>>27),I=P+(T^A&(y^T))+C[14]+3275163606&4294967295,P=y+(I<<9&4294967295|I>>>23),I=A+(y^T&(P^y))+C[3]+4107603335&4294967295,A=P+(I<<14&4294967295|I>>>18),I=T+(P^y&(A^P))+C[8]+1163531501&4294967295,T=A+(I<<20&4294967295|I>>>12),I=y+(A^P&(T^A))+C[13]+2850285829&4294967295,y=T+(I<<5&4294967295|I>>>27),I=P+(T^A&(y^T))+C[2]+4243563512&4294967295,P=y+(I<<9&4294967295|I>>>23),I=A+(y^T&(P^y))+C[7]+1735328473&4294967295,A=P+(I<<14&4294967295|I>>>18),I=T+(P^y&(A^P))+C[12]+2368359562&4294967295,T=A+(I<<20&4294967295|I>>>12),I=y+(T^A^P)+C[5]+4294588738&4294967295,y=T+(I<<4&4294967295|I>>>28),I=P+(y^T^A)+C[8]+2272392833&4294967295,P=y+(I<<11&4294967295|I>>>21),I=A+(P^y^T)+C[11]+1839030562&4294967295,A=P+(I<<16&4294967295|I>>>16),I=T+(A^P^y)+C[14]+4259657740&4294967295,T=A+(I<<23&4294967295|I>>>9),I=y+(T^A^P)+C[1]+2763975236&4294967295,y=T+(I<<4&4294967295|I>>>28),I=P+(y^T^A)+C[4]+1272893353&4294967295,P=y+(I<<11&4294967295|I>>>21),I=A+(P^y^T)+C[7]+4139469664&4294967295,A=P+(I<<16&4294967295|I>>>16),I=T+(A^P^y)+C[10]+3200236656&4294967295,T=A+(I<<23&4294967295|I>>>9),I=y+(T^A^P)+C[13]+681279174&4294967295,y=T+(I<<4&4294967295|I>>>28),I=P+(y^T^A)+C[0]+3936430074&4294967295,P=y+(I<<11&4294967295|I>>>21),I=A+(P^y^T)+C[3]+3572445317&4294967295,A=P+(I<<16&4294967295|I>>>16),I=T+(A^P^y)+C[6]+76029189&4294967295,T=A+(I<<23&4294967295|I>>>9),I=y+(T^A^P)+C[9]+3654602809&4294967295,y=T+(I<<4&4294967295|I>>>28),I=P+(y^T^A)+C[12]+3873151461&4294967295,P=y+(I<<11&4294967295|I>>>21),I=A+(P^y^T)+C[15]+530742520&4294967295,A=P+(I<<16&4294967295|I>>>16),I=T+(A^P^y)+C[2]+3299628645&4294967295,T=A+(I<<23&4294967295|I>>>9),I=y+(A^(T|~P))+C[0]+4096336452&4294967295,y=T+(I<<6&4294967295|I>>>26),I=P+(T^(y|~A))+C[7]+1126891415&4294967295,P=y+(I<<10&4294967295|I>>>22),I=A+(y^(P|~T))+C[14]+2878612391&4294967295,A=P+(I<<15&4294967295|I>>>17),I=T+(P^(A|~y))+C[5]+4237533241&4294967295,T=A+(I<<21&4294967295|I>>>11),I=y+(A^(T|~P))+C[12]+1700485571&4294967295,y=T+(I<<6&4294967295|I>>>26),I=P+(T^(y|~A))+C[3]+2399980690&4294967295,P=y+(I<<10&4294967295|I>>>22),I=A+(y^(P|~T))+C[10]+4293915773&4294967295,A=P+(I<<15&4294967295|I>>>17),I=T+(P^(A|~y))+C[1]+2240044497&4294967295,T=A+(I<<21&4294967295|I>>>11),I=y+(A^(T|~P))+C[8]+1873313359&4294967295,y=T+(I<<6&4294967295|I>>>26),I=P+(T^(y|~A))+C[15]+4264355552&4294967295,P=y+(I<<10&4294967295|I>>>22),I=A+(y^(P|~T))+C[6]+2734768916&4294967295,A=P+(I<<15&4294967295|I>>>17),I=T+(P^(A|~y))+C[13]+1309151649&4294967295,T=A+(I<<21&4294967295|I>>>11),I=y+(A^(T|~P))+C[4]+4149444226&4294967295,y=T+(I<<6&4294967295|I>>>26),I=P+(T^(y|~A))+C[11]+3174756917&4294967295,P=y+(I<<10&4294967295|I>>>22),I=A+(y^(P|~T))+C[2]+718787259&4294967295,A=P+(I<<15&4294967295|I>>>17),I=T+(P^(A|~y))+C[9]+3951481745&4294967295,v.g[0]=v.g[0]+y&4294967295,v.g[1]=v.g[1]+(A+(I<<21&4294967295|I>>>11))&4294967295,v.g[2]=v.g[2]+A&4294967295,v.g[3]=v.g[3]+P&4294967295}r.prototype.u=function(v,y){y===void 0&&(y=v.length);for(var T=y-this.blockSize,C=this.B,A=this.h,P=0;P<y;){if(A==0)for(;P<=T;)s(this,v,P),P+=this.blockSize;if(typeof v=="string"){for(;P<y;)if(C[A++]=v.charCodeAt(P++),A==this.blockSize){s(this,C),A=0;break}}else for(;P<y;)if(C[A++]=v[P++],A==this.blockSize){s(this,C),A=0;break}}this.h=A,this.o+=y},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var y=1;y<v.length-8;++y)v[y]=0;var T=8*this.o;for(y=v.length-8;y<v.length;++y)v[y]=T&255,T/=256;for(this.u(v),v=Array(16),y=T=0;4>y;++y)for(var C=0;32>C;C+=8)v[T++]=this.g[y]>>>C&255;return v};function i(v,y){var T=l;return Object.prototype.hasOwnProperty.call(T,v)?T[v]:T[v]=y(v)}function a(v,y){this.h=y;for(var T=[],C=!0,A=v.length-1;0<=A;A--){var P=v[A]|0;C&&P==y||(T[A]=P,C=!1)}this.g=T}var l={};function u(v){return-128<=v&&128>v?i(v,function(y){return new a([y|0],0>y?-1:0)}):new a([v|0],0>v?-1:0)}function d(v){if(isNaN(v)||!isFinite(v))return m;if(0>v)return k(d(-v));for(var y=[],T=1,C=0;v>=T;C++)y[C]=v/T|0,T*=4294967296;return new a(y,0)}function f(v,y){if(v.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(v.charAt(0)=="-")return k(f(v.substring(1),y));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=d(Math.pow(y,8)),C=m,A=0;A<v.length;A+=8){var P=Math.min(8,v.length-A),I=parseInt(v.substring(A,A+P),y);8>P?(P=d(Math.pow(y,P)),C=C.j(P).add(d(I))):(C=C.j(T),C=C.add(d(I)))}return C}var m=u(0),g=u(1),b=u(16777216);t=a.prototype,t.m=function(){if(E(this))return-k(this).m();for(var v=0,y=1,T=0;T<this.g.length;T++){var C=this.i(T);v+=(0<=C?C:4294967296+C)*y,y*=4294967296}return v},t.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(S(this))return"0";if(E(this))return"-"+k(this).toString(v);for(var y=d(Math.pow(v,6)),T=this,C="";;){var A=M(T,y).g;T=_(T,A.j(y));var P=((0<T.g.length?T.g[0]:T.h)>>>0).toString(v);if(T=A,S(T))return P+C;for(;6>P.length;)P="0"+P;C=P+C}},t.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function S(v){if(v.h!=0)return!1;for(var y=0;y<v.g.length;y++)if(v.g[y]!=0)return!1;return!0}function E(v){return v.h==-1}t.l=function(v){return v=_(this,v),E(v)?-1:S(v)?0:1};function k(v){for(var y=v.g.length,T=[],C=0;C<y;C++)T[C]=~v.g[C];return new a(T,~v.h).add(g)}t.abs=function(){return E(this)?k(this):this},t.add=function(v){for(var y=Math.max(this.g.length,v.g.length),T=[],C=0,A=0;A<=y;A++){var P=C+(this.i(A)&65535)+(v.i(A)&65535),I=(P>>>16)+(this.i(A)>>>16)+(v.i(A)>>>16);C=I>>>16,P&=65535,I&=65535,T[A]=I<<16|P}return new a(T,T[T.length-1]&-2147483648?-1:0)};function _(v,y){return v.add(k(y))}t.j=function(v){if(S(this)||S(v))return m;if(E(this))return E(v)?k(this).j(k(v)):k(k(this).j(v));if(E(v))return k(this.j(k(v)));if(0>this.l(b)&&0>v.l(b))return d(this.m()*v.m());for(var y=this.g.length+v.g.length,T=[],C=0;C<2*y;C++)T[C]=0;for(C=0;C<this.g.length;C++)for(var A=0;A<v.g.length;A++){var P=this.i(C)>>>16,I=this.i(C)&65535,ke=v.i(A)>>>16,Oe=v.i(A)&65535;T[2*C+2*A]+=I*Oe,x(T,2*C+2*A),T[2*C+2*A+1]+=P*Oe,x(T,2*C+2*A+1),T[2*C+2*A+1]+=I*ke,x(T,2*C+2*A+1),T[2*C+2*A+2]+=P*ke,x(T,2*C+2*A+2)}for(C=0;C<y;C++)T[C]=T[2*C+1]<<16|T[2*C];for(C=y;C<2*y;C++)T[C]=0;return new a(T,0)};function x(v,y){for(;(v[y]&65535)!=v[y];)v[y+1]+=v[y]>>>16,v[y]&=65535,y++}function N(v,y){this.g=v,this.h=y}function M(v,y){if(S(y))throw Error("division by zero");if(S(v))return new N(m,m);if(E(v))return y=M(k(v),y),new N(k(y.g),k(y.h));if(E(y))return y=M(v,k(y)),new N(k(y.g),y.h);if(30<v.g.length){if(E(v)||E(y))throw Error("slowDivide_ only works with positive integers.");for(var T=g,C=y;0>=C.l(v);)T=D(T),C=D(C);var A=U(T,1),P=U(C,1);for(C=U(C,2),T=U(T,2);!S(C);){var I=P.add(C);0>=I.l(v)&&(A=A.add(T),P=I),C=U(C,1),T=U(T,1)}return y=_(v,A.j(y)),new N(A,y)}for(A=m;0<=v.l(y);){for(T=Math.max(1,Math.floor(v.m()/y.m())),C=Math.ceil(Math.log(T)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),P=d(T),I=P.j(y);E(I)||0<I.l(v);)T-=C,P=d(T),I=P.j(y);S(P)&&(P=g),A=A.add(P),v=_(v,I)}return new N(A,v)}t.A=function(v){return M(this,v).h},t.and=function(v){for(var y=Math.max(this.g.length,v.g.length),T=[],C=0;C<y;C++)T[C]=this.i(C)&v.i(C);return new a(T,this.h&v.h)},t.or=function(v){for(var y=Math.max(this.g.length,v.g.length),T=[],C=0;C<y;C++)T[C]=this.i(C)|v.i(C);return new a(T,this.h|v.h)},t.xor=function(v){for(var y=Math.max(this.g.length,v.g.length),T=[],C=0;C<y;C++)T[C]=this.i(C)^v.i(C);return new a(T,this.h^v.h)};function D(v){for(var y=v.g.length+1,T=[],C=0;C<y;C++)T[C]=v.i(C)<<1|v.i(C-1)>>>31;return new a(T,v.h)}function U(v,y){var T=y>>5;y%=32;for(var C=v.g.length-T,A=[],P=0;P<C;P++)A[P]=0<y?v.i(P+T)>>>y|v.i(P+T+1)<<32-y:v.i(P+T);return new a(A,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Rx=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,Fs=a}).apply(typeof Cy<"u"?Cy:typeof self<"u"?self:typeof window<"u"?window:{});var kl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var jx,Ra,Dx,Kl,Dh,Mx,Lx,Ox;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,h,p){return c==Array.prototype||c==Object.prototype||(c[h]=p.value),c};function n(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof kl=="object"&&kl];for(var h=0;h<c.length;++h){var p=c[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=n(this);function s(c,h){if(h)e:{var p=r;c=c.split(".");for(var w=0;w<c.length-1;w++){var L=c[w];if(!(L in p))break e;p=p[L]}c=c[c.length-1],w=p[c],h=h(w),h!=w&&h!=null&&e(p,c,{configurable:!0,writable:!0,value:h})}}function i(c,h){c instanceof String&&(c+="");var p=0,w=!1,L={next:function(){if(!w&&p<c.length){var $=p++;return{value:h($,c[$]),done:!1}}return w=!0,{done:!0,value:void 0}}};return L[Symbol.iterator]=function(){return L},L}s("Array.prototype.values",function(c){return c||function(){return i(this,function(h,p){return p})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},l=this||self;function u(c){var h=typeof c;return h=h!="object"?h:c?Array.isArray(c)?"array":h:"null",h=="array"||h=="object"&&typeof c.length=="number"}function d(c){var h=typeof c;return h=="object"&&c!=null||h=="function"}function f(c,h,p){return c.call.apply(c.bind,arguments)}function m(c,h,p){if(!c)throw Error();if(2<arguments.length){var w=Array.prototype.slice.call(arguments,2);return function(){var L=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(L,w),c.apply(h,L)}}return function(){return c.apply(h,arguments)}}function g(c,h,p){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:m,g.apply(null,arguments)}function b(c,h){var p=Array.prototype.slice.call(arguments,1);return function(){var w=p.slice();return w.push.apply(w,arguments),c.apply(this,w)}}function S(c,h){function p(){}p.prototype=h.prototype,c.aa=h.prototype,c.prototype=new p,c.prototype.constructor=c,c.Qb=function(w,L,$){for(var Z=Array(arguments.length-2),Be=2;Be<arguments.length;Be++)Z[Be-2]=arguments[Be];return h.prototype[L].apply(w,Z)}}function E(c){const h=c.length;if(0<h){const p=Array(h);for(let w=0;w<h;w++)p[w]=c[w];return p}return[]}function k(c,h){for(let p=1;p<arguments.length;p++){const w=arguments[p];if(u(w)){const L=c.length||0,$=w.length||0;c.length=L+$;for(let Z=0;Z<$;Z++)c[L+Z]=w[Z]}else c.push(w)}}class _{constructor(h,p){this.i=h,this.j=p,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function x(c){return/^[\s\xa0]*$/.test(c)}function N(){var c=l.navigator;return c&&(c=c.userAgent)?c:""}function M(c){return M[" "](c),c}M[" "]=function(){};var D=N().indexOf("Gecko")!=-1&&!(N().toLowerCase().indexOf("webkit")!=-1&&N().indexOf("Edge")==-1)&&!(N().indexOf("Trident")!=-1||N().indexOf("MSIE")!=-1)&&N().indexOf("Edge")==-1;function U(c,h,p){for(const w in c)h.call(p,c[w],w,c)}function v(c,h){for(const p in c)h.call(void 0,c[p],p,c)}function y(c){const h={};for(const p in c)h[p]=c[p];return h}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(c,h){let p,w;for(let L=1;L<arguments.length;L++){w=arguments[L];for(p in w)c[p]=w[p];for(let $=0;$<T.length;$++)p=T[$],Object.prototype.hasOwnProperty.call(w,p)&&(c[p]=w[p])}}function A(c){var h=1;c=c.split(":");const p=[];for(;0<h&&c.length;)p.push(c.shift()),h--;return c.length&&p.push(c.join(":")),p}function P(c){l.setTimeout(()=>{throw c},0)}function I(){var c=re;let h=null;return c.g&&(h=c.g,c.g=c.g.next,c.g||(c.h=null),h.next=null),h}class ke{constructor(){this.h=this.g=null}add(h,p){const w=Oe.get();w.set(h,p),this.h?this.h.next=w:this.g=w,this.h=w}}var Oe=new _(()=>new $e,c=>c.reset());class $e{constructor(){this.next=this.g=this.h=null}set(h,p){this.h=h,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let qe,J=!1,re=new ke,ue=()=>{const c=l.Promise.resolve(void 0);qe=()=>{c.then(Q)}};var Q=()=>{for(var c;c=I();){try{c.h.call(c.g)}catch(p){P(p)}var h=Oe;h.j(c),100>h.h&&(h.h++,c.next=h.g,h.g=c)}J=!1};function W(){this.s=this.s,this.C=this.C}W.prototype.s=!1,W.prototype.ma=function(){this.s||(this.s=!0,this.N())},W.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function X(c,h){this.type=c,this.g=this.target=h,this.defaultPrevented=!1}X.prototype.h=function(){this.defaultPrevented=!0};var le=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var c=!1,h=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const p=()=>{};l.addEventListener("test",p,h),l.removeEventListener("test",p,h)}catch{}return c}();function pe(c,h){if(X.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var p=this.type=c.type,w=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=h,h=c.relatedTarget){if(D){e:{try{M(h.nodeName);var L=!0;break e}catch{}L=!1}L||(h=null)}}else p=="mouseover"?h=c.fromElement:p=="mouseout"&&(h=c.toElement);this.relatedTarget=h,w?(this.clientX=w.clientX!==void 0?w.clientX:w.pageX,this.clientY=w.clientY!==void 0?w.clientY:w.pageY,this.screenX=w.screenX||0,this.screenY=w.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:Ee[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&pe.aa.h.call(this)}}S(pe,X);var Ee={2:"touch",3:"pen",4:"mouse"};pe.prototype.h=function(){pe.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var ae="closure_listenable_"+(1e6*Math.random()|0),fe=0;function be(c,h,p,w,L){this.listener=c,this.proxy=null,this.src=h,this.type=p,this.capture=!!w,this.ha=L,this.key=++fe,this.da=this.fa=!1}function _e(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function Ae(c){this.src=c,this.g={},this.h=0}Ae.prototype.add=function(c,h,p,w,L){var $=c.toString();c=this.g[$],c||(c=this.g[$]=[],this.h++);var Z=ut(c,h,w,L);return-1<Z?(h=c[Z],p||(h.fa=!1)):(h=new be(h,this.src,$,!!w,L),h.fa=p,c.push(h)),h};function me(c,h){var p=h.type;if(p in c.g){var w=c.g[p],L=Array.prototype.indexOf.call(w,h,void 0),$;($=0<=L)&&Array.prototype.splice.call(w,L,1),$&&(_e(h),c.g[p].length==0&&(delete c.g[p],c.h--))}}function ut(c,h,p,w){for(var L=0;L<c.length;++L){var $=c[L];if(!$.da&&$.listener==h&&$.capture==!!p&&$.ha==w)return L}return-1}var cn="closure_lm_"+(1e6*Math.random()|0),ge={};function xt(c,h,p,w,L){if(w&&w.once)return Lt(c,h,p,w,L);if(Array.isArray(h)){for(var $=0;$<h.length;$++)xt(c,h[$],p,w,L);return null}return p=_t(p),c&&c[ae]?c.K(h,p,d(w)?!!w.capture:!!w,L):Ar(c,h,p,!1,w,L)}function Ar(c,h,p,w,L,$){if(!h)throw Error("Invalid event type");var Z=d(L)?!!L.capture:!!L,Be=Ie(c);if(Be||(c[cn]=Be=new Ae(c)),p=Be.add(h,p,w,Z,$),p.proxy)return p;if(w=sr(),p.proxy=w,w.src=c,w.listener=p,c.addEventListener)le||(L=Z),L===void 0&&(L=!1),c.addEventListener(h.toString(),w,L);else if(c.attachEvent)c.attachEvent(te(h.toString()),w);else if(c.addListener&&c.removeListener)c.addListener(w);else throw Error("addEventListener and attachEvent are unavailable.");return p}function sr(){function c(p){return h.call(c.src,c.listener,p)}const h=ve;return c}function Lt(c,h,p,w,L){if(Array.isArray(h)){for(var $=0;$<h.length;$++)Lt(c,h[$],p,w,L);return null}return p=_t(p),c&&c[ae]?c.L(h,p,d(w)?!!w.capture:!!w,L):Ar(c,h,p,!0,w,L)}function ze(c,h,p,w,L){if(Array.isArray(h))for(var $=0;$<h.length;$++)ze(c,h[$],p,w,L);else w=d(w)?!!w.capture:!!w,p=_t(p),c&&c[ae]?(c=c.i,h=String(h).toString(),h in c.g&&($=c.g[h],p=ut($,p,w,L),-1<p&&(_e($[p]),Array.prototype.splice.call($,p,1),$.length==0&&(delete c.g[h],c.h--)))):c&&(c=Ie(c))&&(h=c.g[h.toString()],c=-1,h&&(c=ut(h,p,w,L)),(p=-1<c?h[c]:null)&&O(p))}function O(c){if(typeof c!="number"&&c&&!c.da){var h=c.src;if(h&&h[ae])me(h.i,c);else{var p=c.type,w=c.proxy;h.removeEventListener?h.removeEventListener(p,w,c.capture):h.detachEvent?h.detachEvent(te(p),w):h.addListener&&h.removeListener&&h.removeListener(w),(p=Ie(h))?(me(p,c),p.h==0&&(p.src=null,h[cn]=null)):_e(c)}}}function te(c){return c in ge?ge[c]:ge[c]="on"+c}function ve(c,h){if(c.da)c=!0;else{h=new pe(h,this);var p=c.listener,w=c.ha||c.src;c.fa&&O(c),c=p.call(w,h)}return c}function Ie(c){return c=c[cn],c instanceof Ae?c:null}var rt="__closure_events_fn_"+(1e9*Math.random()>>>0);function _t(c){return typeof c=="function"?c:(c[rt]||(c[rt]=function(h){return c.handleEvent(h)}),c[rt])}function Ue(){W.call(this),this.i=new Ae(this),this.M=this,this.F=null}S(Ue,W),Ue.prototype[ae]=!0,Ue.prototype.removeEventListener=function(c,h,p,w){ze(this,c,h,p,w)};function st(c,h){var p,w=c.F;if(w)for(p=[];w;w=w.F)p.push(w);if(c=c.M,w=h.type||h,typeof h=="string")h=new X(h,c);else if(h instanceof X)h.target=h.target||c;else{var L=h;h=new X(w,c),C(h,L)}if(L=!0,p)for(var $=p.length-1;0<=$;$--){var Z=h.g=p[$];L=In(Z,w,!0,h)&&L}if(Z=h.g=c,L=In(Z,w,!0,h)&&L,L=In(Z,w,!1,h)&&L,p)for($=0;$<p.length;$++)Z=h.g=p[$],L=In(Z,w,!1,h)&&L}Ue.prototype.N=function(){if(Ue.aa.N.call(this),this.i){var c=this.i,h;for(h in c.g){for(var p=c.g[h],w=0;w<p.length;w++)_e(p[w]);delete c.g[h],c.h--}}this.F=null},Ue.prototype.K=function(c,h,p,w){return this.i.add(String(c),h,!1,p,w)},Ue.prototype.L=function(c,h,p,w){return this.i.add(String(c),h,!0,p,w)};function In(c,h,p,w){if(h=c.i.g[String(h)],!h)return!0;h=h.concat();for(var L=!0,$=0;$<h.length;++$){var Z=h[$];if(Z&&!Z.da&&Z.capture==p){var Be=Z.listener,St=Z.ha||Z.src;Z.fa&&me(c.i,Z),L=Be.call(St,w)!==!1&&L}}return L&&!w.defaultPrevented}function Ts(c,h,p){if(typeof c=="function")p&&(c=g(c,p));else if(c&&typeof c.handleEvent=="function")c=g(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:l.setTimeout(c,h||0)}function Cs(c){c.g=Ts(()=>{c.g=null,c.i&&(c.i=!1,Cs(c))},c.l);const h=c.h;c.h=null,c.m.apply(null,h)}class Ss extends W{constructor(h,p){super(),this.m=h,this.l=p,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:Cs(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function wn(c){W.call(this),this.h=c,this.g={}}S(wn,W);var Rr=[];function V(c){U(c.g,function(h,p){this.g.hasOwnProperty(p)&&O(h)},c),c.g={}}wn.prototype.N=function(){wn.aa.N.call(this),V(this)},wn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var H=l.JSON.stringify,ee=l.JSON.parse,de=class{stringify(c){return l.JSON.stringify(c,void 0)}parse(c){return l.JSON.parse(c,void 0)}};function j(){}j.prototype.h=null;function F(c){return c.h||(c.h=c.i())}function z(){}var B={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Te(){X.call(this,"d")}S(Te,X);function K(){X.call(this,"c")}S(K,X);var ne={},De=null;function He(){return De=De||new Ue}ne.La="serverreachability";function Ge(c){X.call(this,ne.La,c)}S(Ge,X);function Ot(c){const h=He();st(h,new Ge(h))}ne.STAT_EVENT="statevent";function oa(c,h){X.call(this,ne.STAT_EVENT,c),this.stat=h}S(oa,X);function bt(c){const h=He();st(h,new oa(h,c))}ne.Ma="timingevent";function la(c,h){X.call(this,ne.Ma,c),this.size=h}S(la,X);function jr(c,h){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){c()},h)}function Dr(){this.g=!0}Dr.prototype.xa=function(){this.g=!1};function Go(c,h,p,w,L,$){c.info(function(){if(c.g)if($)for(var Z="",Be=$.split("&"),St=0;St<Be.length;St++){var Me=Be[St].split("=");if(1<Me.length){var Vt=Me[0];Me=Me[1];var Ft=Vt.split("_");Z=2<=Ft.length&&Ft[1]=="type"?Z+(Vt+"="+Me+"&"):Z+(Vt+"=redacted&")}}else Z=null;else Z=$;return"XMLHTTP REQ ("+w+") [attempt "+L+"]: "+h+`
`+p+`
`+Z})}function Ko(c,h,p,w,L,$,Z){c.info(function(){return"XMLHTTP RESP ("+w+") [ attempt "+L+"]: "+h+`
`+p+`
`+$+" "+Z})}function ir(c,h,p,w){c.info(function(){return"XMLHTTP TEXT ("+h+"): "+rb(c,p)+(w?" "+w:"")})}function Nn(c,h){c.info(function(){return"TIMEOUT: "+h})}Dr.prototype.info=function(){};function rb(c,h){if(!c.g)return h;if(!h)return null;try{var p=JSON.parse(h);if(p){for(c=0;c<p.length;c++)if(Array.isArray(p[c])){var w=p[c];if(!(2>w.length)){var L=w[1];if(Array.isArray(L)&&!(1>L.length)){var $=L[0];if($!="noop"&&$!="stop"&&$!="close")for(var Z=1;Z<L.length;Z++)L[Z]=""}}}}return H(p)}catch{return h}}var Qo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Km={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Nu;function Yo(){}S(Yo,j),Yo.prototype.g=function(){return new XMLHttpRequest},Yo.prototype.i=function(){return{}},Nu=new Yo;function Mr(c,h,p,w){this.j=c,this.i=h,this.l=p,this.R=w||1,this.U=new wn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Qm}function Qm(){this.i=null,this.g="",this.h=!1}var Ym={},Pu={};function Au(c,h,p){c.L=1,c.v=el(ar(h)),c.m=p,c.P=!0,Xm(c,null)}function Xm(c,h){c.F=Date.now(),Xo(c),c.A=ar(c.v);var p=c.A,w=c.R;Array.isArray(w)||(w=[String(w)]),dp(p.i,"t",w),c.C=0,p=c.j.J,c.h=new Qm,c.g=Np(c.j,p?h:null,!c.m),0<c.O&&(c.M=new Ss(g(c.Y,c,c.g),c.O)),h=c.U,p=c.g,w=c.ca;var L="readystatechange";Array.isArray(L)||(L&&(Rr[0]=L.toString()),L=Rr);for(var $=0;$<L.length;$++){var Z=xt(p,L[$],w||h.handleEvent,!1,h.h||h);if(!Z)break;h.g[Z.key]=Z}h=c.H?y(c.H):{},c.m?(c.u||(c.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,h)):(c.u="GET",c.g.ea(c.A,c.u,null,h)),Ot(),Go(c.i,c.u,c.A,c.l,c.R,c.m)}Mr.prototype.ca=function(c){c=c.target;const h=this.M;h&&or(c)==3?h.j():this.Y(c)},Mr.prototype.Y=function(c){try{if(c==this.g)e:{const Ft=or(this.g);var h=this.g.Ba();const ci=this.g.Z();if(!(3>Ft)&&(Ft!=3||this.g&&(this.h.h||this.g.oa()||vp(this.g)))){this.J||Ft!=4||h==7||(h==8||0>=ci?Ot(3):Ot(2)),Ru(this);var p=this.g.Z();this.X=p;t:if(Jm(this)){var w=vp(this.g);c="";var L=w.length,$=or(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ks(this),ca(this);var Z="";break t}this.h.i=new l.TextDecoder}for(h=0;h<L;h++)this.h.h=!0,c+=this.h.i.decode(w[h],{stream:!($&&h==L-1)});w.length=0,this.h.g+=c,this.C=0,Z=this.h.g}else Z=this.g.oa();if(this.o=p==200,Ko(this.i,this.u,this.A,this.l,this.R,Ft,p),this.o){if(this.T&&!this.K){t:{if(this.g){var Be,St=this.g;if((Be=St.g?St.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(Be)){var Me=Be;break t}}Me=null}if(p=Me)ir(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ju(this,p);else{this.o=!1,this.s=3,bt(12),ks(this),ca(this);break e}}if(this.P){p=!0;let Pn;for(;!this.J&&this.C<Z.length;)if(Pn=sb(this,Z),Pn==Pu){Ft==4&&(this.s=4,bt(14),p=!1),ir(this.i,this.l,null,"[Incomplete Response]");break}else if(Pn==Ym){this.s=4,bt(15),ir(this.i,this.l,Z,"[Invalid Chunk]"),p=!1;break}else ir(this.i,this.l,Pn,null),ju(this,Pn);if(Jm(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ft!=4||Z.length!=0||this.h.h||(this.s=1,bt(16),p=!1),this.o=this.o&&p,!p)ir(this.i,this.l,Z,"[Invalid Chunked Response]"),ks(this),ca(this);else if(0<Z.length&&!this.W){this.W=!0;var Vt=this.j;Vt.g==this&&Vt.ba&&!Vt.M&&(Vt.j.info("Great, no buffering proxy detected. Bytes received: "+Z.length),Fu(Vt),Vt.M=!0,bt(11))}}else ir(this.i,this.l,Z,null),ju(this,Z);Ft==4&&ks(this),this.o&&!this.J&&(Ft==4?Cp(this.j,this):(this.o=!1,Xo(this)))}else _b(this.g),p==400&&0<Z.indexOf("Unknown SID")?(this.s=3,bt(12)):(this.s=0,bt(13)),ks(this),ca(this)}}}catch{}finally{}};function Jm(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function sb(c,h){var p=c.C,w=h.indexOf(`
`,p);return w==-1?Pu:(p=Number(h.substring(p,w)),isNaN(p)?Ym:(w+=1,w+p>h.length?Pu:(h=h.slice(w,w+p),c.C=w+p,h)))}Mr.prototype.cancel=function(){this.J=!0,ks(this)};function Xo(c){c.S=Date.now()+c.I,Zm(c,c.I)}function Zm(c,h){if(c.B!=null)throw Error("WatchDog timer not null");c.B=jr(g(c.ba,c),h)}function Ru(c){c.B&&(l.clearTimeout(c.B),c.B=null)}Mr.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(Nn(this.i,this.A),this.L!=2&&(Ot(),bt(17)),ks(this),this.s=2,ca(this)):Zm(this,this.S-c)};function ca(c){c.j.G==0||c.J||Cp(c.j,c)}function ks(c){Ru(c);var h=c.M;h&&typeof h.ma=="function"&&h.ma(),c.M=null,V(c.U),c.g&&(h=c.g,c.g=null,h.abort(),h.ma())}function ju(c,h){try{var p=c.j;if(p.G!=0&&(p.g==c||Du(p.h,c))){if(!c.K&&Du(p.h,c)&&p.G==3){try{var w=p.Da.g.parse(h)}catch{w=null}if(Array.isArray(w)&&w.length==3){var L=w;if(L[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<c.F)al(p),sl(p);else break e;Vu(p),bt(18)}}else p.za=L[1],0<p.za-p.T&&37500>L[2]&&p.F&&p.v==0&&!p.C&&(p.C=jr(g(p.Za,p),6e3));if(1>=np(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else Ns(p,11)}else if((c.K||p.g==c)&&al(p),!x(h))for(L=p.Da.g.parse(h),h=0;h<L.length;h++){let Me=L[h];if(p.T=Me[0],Me=Me[1],p.G==2)if(Me[0]=="c"){p.K=Me[1],p.ia=Me[2];const Vt=Me[3];Vt!=null&&(p.la=Vt,p.j.info("VER="+p.la));const Ft=Me[4];Ft!=null&&(p.Aa=Ft,p.j.info("SVER="+p.Aa));const ci=Me[5];ci!=null&&typeof ci=="number"&&0<ci&&(w=1.5*ci,p.L=w,p.j.info("backChannelRequestTimeoutMs_="+w)),w=p;const Pn=c.g;if(Pn){const ll=Pn.g?Pn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ll){var $=w.h;$.g||ll.indexOf("spdy")==-1&&ll.indexOf("quic")==-1&&ll.indexOf("h2")==-1||($.j=$.l,$.g=new Set,$.h&&(Mu($,$.h),$.h=null))}if(w.D){const $u=Pn.g?Pn.g.getResponseHeader("X-HTTP-Session-Id"):null;$u&&(w.ya=$u,Ke(w.I,w.D,$u))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-c.F,p.j.info("Handshake RTT: "+p.R+"ms")),w=p;var Z=c;if(w.qa=Ip(w,w.J?w.ia:null,w.W),Z.K){rp(w.h,Z);var Be=Z,St=w.L;St&&(Be.I=St),Be.B&&(Ru(Be),Xo(Be)),w.g=Z}else Ep(w);0<p.i.length&&il(p)}else Me[0]!="stop"&&Me[0]!="close"||Ns(p,7);else p.G==3&&(Me[0]=="stop"||Me[0]=="close"?Me[0]=="stop"?Ns(p,7):Ou(p):Me[0]!="noop"&&p.l&&p.l.ta(Me),p.v=0)}}Ot(4)}catch{}}var ib=class{constructor(c,h){this.g=c,this.map=h}};function ep(c){this.l=c||10,l.PerformanceNavigationTiming?(c=l.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function tp(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function np(c){return c.h?1:c.g?c.g.size:0}function Du(c,h){return c.h?c.h==h:c.g?c.g.has(h):!1}function Mu(c,h){c.g?c.g.add(h):c.h=h}function rp(c,h){c.h&&c.h==h?c.h=null:c.g&&c.g.has(h)&&c.g.delete(h)}ep.prototype.cancel=function(){if(this.i=sp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function sp(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let h=c.i;for(const p of c.g.values())h=h.concat(p.D);return h}return E(c.i)}function ab(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(u(c)){for(var h=[],p=c.length,w=0;w<p;w++)h.push(c[w]);return h}h=[],p=0;for(w in c)h[p++]=c[w];return h}function ob(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(u(c)||typeof c=="string"){var h=[];c=c.length;for(var p=0;p<c;p++)h.push(p);return h}h=[],p=0;for(const w in c)h[p++]=w;return h}}}function ip(c,h){if(c.forEach&&typeof c.forEach=="function")c.forEach(h,void 0);else if(u(c)||typeof c=="string")Array.prototype.forEach.call(c,h,void 0);else for(var p=ob(c),w=ab(c),L=w.length,$=0;$<L;$++)h.call(void 0,w[$],p&&p[$],c)}var ap=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lb(c,h){if(c){c=c.split("&");for(var p=0;p<c.length;p++){var w=c[p].indexOf("="),L=null;if(0<=w){var $=c[p].substring(0,w);L=c[p].substring(w+1)}else $=c[p];h($,L?decodeURIComponent(L.replace(/\+/g," ")):"")}}}function Is(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof Is){this.h=c.h,Jo(this,c.j),this.o=c.o,this.g=c.g,Zo(this,c.s),this.l=c.l;var h=c.i,p=new ha;p.i=h.i,h.g&&(p.g=new Map(h.g),p.h=h.h),op(this,p),this.m=c.m}else c&&(h=String(c).match(ap))?(this.h=!1,Jo(this,h[1]||"",!0),this.o=ua(h[2]||""),this.g=ua(h[3]||"",!0),Zo(this,h[4]),this.l=ua(h[5]||"",!0),op(this,h[6]||"",!0),this.m=ua(h[7]||"")):(this.h=!1,this.i=new ha(null,this.h))}Is.prototype.toString=function(){var c=[],h=this.j;h&&c.push(da(h,lp,!0),":");var p=this.g;return(p||h=="file")&&(c.push("//"),(h=this.o)&&c.push(da(h,lp,!0),"@"),c.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&c.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&c.push("/"),c.push(da(p,p.charAt(0)=="/"?db:ub,!0))),(p=this.i.toString())&&c.push("?",p),(p=this.m)&&c.push("#",da(p,fb)),c.join("")};function ar(c){return new Is(c)}function Jo(c,h,p){c.j=p?ua(h,!0):h,c.j&&(c.j=c.j.replace(/:$/,""))}function Zo(c,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);c.s=h}else c.s=null}function op(c,h,p){h instanceof ha?(c.i=h,mb(c.i,c.h)):(p||(h=da(h,hb)),c.i=new ha(h,c.h))}function Ke(c,h,p){c.i.set(h,p)}function el(c){return Ke(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function ua(c,h){return c?h?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function da(c,h,p){return typeof c=="string"?(c=encodeURI(c).replace(h,cb),p&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function cb(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var lp=/[#\/\?@]/g,ub=/[#\?:]/g,db=/[#\?]/g,hb=/[#\?@]/g,fb=/#/g;function ha(c,h){this.h=this.g=null,this.i=c||null,this.j=!!h}function Lr(c){c.g||(c.g=new Map,c.h=0,c.i&&lb(c.i,function(h,p){c.add(decodeURIComponent(h.replace(/\+/g," ")),p)}))}t=ha.prototype,t.add=function(c,h){Lr(this),this.i=null,c=oi(this,c);var p=this.g.get(c);return p||this.g.set(c,p=[]),p.push(h),this.h+=1,this};function cp(c,h){Lr(c),h=oi(c,h),c.g.has(h)&&(c.i=null,c.h-=c.g.get(h).length,c.g.delete(h))}function up(c,h){return Lr(c),h=oi(c,h),c.g.has(h)}t.forEach=function(c,h){Lr(this),this.g.forEach(function(p,w){p.forEach(function(L){c.call(h,L,w,this)},this)},this)},t.na=function(){Lr(this);const c=Array.from(this.g.values()),h=Array.from(this.g.keys()),p=[];for(let w=0;w<h.length;w++){const L=c[w];for(let $=0;$<L.length;$++)p.push(h[w])}return p},t.V=function(c){Lr(this);let h=[];if(typeof c=="string")up(this,c)&&(h=h.concat(this.g.get(oi(this,c))));else{c=Array.from(this.g.values());for(let p=0;p<c.length;p++)h=h.concat(c[p])}return h},t.set=function(c,h){return Lr(this),this.i=null,c=oi(this,c),up(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[h]),this.h+=1,this},t.get=function(c,h){return c?(c=this.V(c),0<c.length?String(c[0]):h):h};function dp(c,h,p){cp(c,h),0<p.length&&(c.i=null,c.g.set(oi(c,h),E(p)),c.h+=p.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],h=Array.from(this.g.keys());for(var p=0;p<h.length;p++){var w=h[p];const $=encodeURIComponent(String(w)),Z=this.V(w);for(w=0;w<Z.length;w++){var L=$;Z[w]!==""&&(L+="="+encodeURIComponent(String(Z[w]))),c.push(L)}}return this.i=c.join("&")};function oi(c,h){return h=String(h),c.j&&(h=h.toLowerCase()),h}function mb(c,h){h&&!c.j&&(Lr(c),c.i=null,c.g.forEach(function(p,w){var L=w.toLowerCase();w!=L&&(cp(this,w),dp(this,L,p))},c)),c.j=h}function pb(c,h){const p=new Dr;if(l.Image){const w=new Image;w.onload=b(Or,p,"TestLoadImage: loaded",!0,h,w),w.onerror=b(Or,p,"TestLoadImage: error",!1,h,w),w.onabort=b(Or,p,"TestLoadImage: abort",!1,h,w),w.ontimeout=b(Or,p,"TestLoadImage: timeout",!1,h,w),l.setTimeout(function(){w.ontimeout&&w.ontimeout()},1e4),w.src=c}else h(!1)}function gb(c,h){const p=new Dr,w=new AbortController,L=setTimeout(()=>{w.abort(),Or(p,"TestPingServer: timeout",!1,h)},1e4);fetch(c,{signal:w.signal}).then($=>{clearTimeout(L),$.ok?Or(p,"TestPingServer: ok",!0,h):Or(p,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(L),Or(p,"TestPingServer: error",!1,h)})}function Or(c,h,p,w,L){try{L&&(L.onload=null,L.onerror=null,L.onabort=null,L.ontimeout=null),w(p)}catch{}}function yb(){this.g=new de}function vb(c,h,p){const w=p||"";try{ip(c,function(L,$){let Z=L;d(L)&&(Z=H(L)),h.push(w+$+"="+encodeURIComponent(Z))})}catch(L){throw h.push(w+"type="+encodeURIComponent("_badmap")),L}}function tl(c){this.l=c.Ub||null,this.j=c.eb||!1}S(tl,j),tl.prototype.g=function(){return new nl(this.l,this.j)},tl.prototype.i=function(c){return function(){return c}}({});function nl(c,h){Ue.call(this),this.D=c,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}S(nl,Ue),t=nl.prototype,t.open=function(c,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=h,this.readyState=1,ma(this)},t.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(h.body=c),(this.D||l).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,fa(this)),this.readyState=0},t.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,ma(this)),this.g&&(this.readyState=3,ma(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;hp(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function hp(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}t.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var h=c.value?c.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!c.done}))&&(this.response=this.responseText+=h)}c.done?fa(this):ma(this),this.readyState==3&&hp(this)}},t.Ra=function(c){this.g&&(this.response=this.responseText=c,fa(this))},t.Qa=function(c){this.g&&(this.response=c,fa(this))},t.ga=function(){this.g&&fa(this)};function fa(c){c.readyState=4,c.l=null,c.j=null,c.v=null,ma(c)}t.setRequestHeader=function(c,h){this.u.append(c,h)},t.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],h=this.h.entries();for(var p=h.next();!p.done;)p=p.value,c.push(p[0]+": "+p[1]),p=h.next();return c.join(`\r
`)};function ma(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(nl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function fp(c){let h="";return U(c,function(p,w){h+=w,h+=":",h+=p,h+=`\r
`}),h}function Lu(c,h,p){e:{for(w in p){var w=!1;break e}w=!0}w||(p=fp(p),typeof c=="string"?p!=null&&encodeURIComponent(String(p)):Ke(c,h,p))}function it(c){Ue.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}S(it,Ue);var wb=/^https?$/i,xb=["POST","PUT"];t=it.prototype,t.Ha=function(c){this.J=c},t.ea=function(c,h,p,w){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);h=h?h.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Nu.g(),this.v=this.o?F(this.o):F(Nu),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(h,String(c),!0),this.B=!1}catch($){mp(this,$);return}if(c=p||"",p=new Map(this.headers),w)if(Object.getPrototypeOf(w)===Object.prototype)for(var L in w)p.set(L,w[L]);else if(typeof w.keys=="function"&&typeof w.get=="function")for(const $ of w.keys())p.set($,w.get($));else throw Error("Unknown input type for opt_headers: "+String(w));w=Array.from(p.keys()).find($=>$.toLowerCase()=="content-type"),L=l.FormData&&c instanceof l.FormData,!(0<=Array.prototype.indexOf.call(xb,h,void 0))||w||L||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[$,Z]of p)this.g.setRequestHeader($,Z);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{yp(this),this.u=!0,this.g.send(c),this.u=!1}catch($){mp(this,$)}};function mp(c,h){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=h,c.m=5,pp(c),rl(c)}function pp(c){c.A||(c.A=!0,st(c,"complete"),st(c,"error"))}t.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,st(this,"complete"),st(this,"abort"),rl(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),rl(this,!0)),it.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?gp(this):this.bb())},t.bb=function(){gp(this)};function gp(c){if(c.h&&typeof a<"u"&&(!c.v[1]||or(c)!=4||c.Z()!=2)){if(c.u&&or(c)==4)Ts(c.Ea,0,c);else if(st(c,"readystatechange"),or(c)==4){c.h=!1;try{const Z=c.Z();e:switch(Z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var p;if(!(p=h)){var w;if(w=Z===0){var L=String(c.D).match(ap)[1]||null;!L&&l.self&&l.self.location&&(L=l.self.location.protocol.slice(0,-1)),w=!wb.test(L?L.toLowerCase():"")}p=w}if(p)st(c,"complete"),st(c,"success");else{c.m=6;try{var $=2<or(c)?c.g.statusText:""}catch{$=""}c.l=$+" ["+c.Z()+"]",pp(c)}}finally{rl(c)}}}}function rl(c,h){if(c.g){yp(c);const p=c.g,w=c.v[0]?()=>{}:null;c.g=null,c.v=null,h||st(c,"ready");try{p.onreadystatechange=w}catch{}}}function yp(c){c.I&&(l.clearTimeout(c.I),c.I=null)}t.isActive=function(){return!!this.g};function or(c){return c.g?c.g.readyState:0}t.Z=function(){try{return 2<or(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(c){if(this.g){var h=this.g.responseText;return c&&h.indexOf(c)==0&&(h=h.substring(c.length)),ee(h)}};function vp(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function _b(c){const h={};c=(c.g&&2<=or(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let w=0;w<c.length;w++){if(x(c[w]))continue;var p=A(c[w]);const L=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();const $=h[L]||[];h[L]=$,$.push(p)}v(h,function(w){return w.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function pa(c,h,p){return p&&p.internalChannelParams&&p.internalChannelParams[c]||h}function wp(c){this.Aa=0,this.i=[],this.j=new Dr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=pa("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=pa("baseRetryDelayMs",5e3,c),this.cb=pa("retryDelaySeedMs",1e4,c),this.Wa=pa("forwardChannelMaxRetries",2,c),this.wa=pa("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new ep(c&&c.concurrentRequestLimit),this.Da=new yb,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=wp.prototype,t.la=8,t.G=1,t.connect=function(c,h,p,w){bt(0),this.W=c,this.H=h||{},p&&w!==void 0&&(this.H.OSID=p,this.H.OAID=w),this.F=this.X,this.I=Ip(this,null,this.W),il(this)};function Ou(c){if(xp(c),c.G==3){var h=c.U++,p=ar(c.I);if(Ke(p,"SID",c.K),Ke(p,"RID",h),Ke(p,"TYPE","terminate"),ga(c,p),h=new Mr(c,c.j,h),h.L=2,h.v=el(ar(p)),p=!1,l.navigator&&l.navigator.sendBeacon)try{p=l.navigator.sendBeacon(h.v.toString(),"")}catch{}!p&&l.Image&&(new Image().src=h.v,p=!0),p||(h.g=Np(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Xo(h)}kp(c)}function sl(c){c.g&&(Fu(c),c.g.cancel(),c.g=null)}function xp(c){sl(c),c.u&&(l.clearTimeout(c.u),c.u=null),al(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&l.clearTimeout(c.s),c.s=null)}function il(c){if(!tp(c.h)&&!c.s){c.s=!0;var h=c.Ga;qe||ue(),J||(qe(),J=!0),re.add(h,c),c.B=0}}function bb(c,h){return np(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=h.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=jr(g(c.Ga,c,h),Sp(c,c.B)),c.B++,!0)}t.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const L=new Mr(this,this.j,c);let $=this.o;if(this.S&&($?($=y($),C($,this.S)):$=this.S),this.m!==null||this.O||(L.H=$,$=null),this.P)e:{for(var h=0,p=0;p<this.i.length;p++){t:{var w=this.i[p];if("__data__"in w.map&&(w=w.map.__data__,typeof w=="string")){w=w.length;break t}w=void 0}if(w===void 0)break;if(h+=w,4096<h){h=p;break e}if(h===4096||p===this.i.length-1){h=p+1;break e}}h=1e3}else h=1e3;h=bp(this,L,h),p=ar(this.I),Ke(p,"RID",c),Ke(p,"CVER",22),this.D&&Ke(p,"X-HTTP-Session-Id",this.D),ga(this,p),$&&(this.O?h="headers="+encodeURIComponent(String(fp($)))+"&"+h:this.m&&Lu(p,this.m,$)),Mu(this.h,L),this.Ua&&Ke(p,"TYPE","init"),this.P?(Ke(p,"$req",h),Ke(p,"SID","null"),L.T=!0,Au(L,p,null)):Au(L,p,h),this.G=2}}else this.G==3&&(c?_p(this,c):this.i.length==0||tp(this.h)||_p(this))};function _p(c,h){var p;h?p=h.l:p=c.U++;const w=ar(c.I);Ke(w,"SID",c.K),Ke(w,"RID",p),Ke(w,"AID",c.T),ga(c,w),c.m&&c.o&&Lu(w,c.m,c.o),p=new Mr(c,c.j,p,c.B+1),c.m===null&&(p.H=c.o),h&&(c.i=h.D.concat(c.i)),h=bp(c,p,1e3),p.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),Mu(c.h,p),Au(p,w,h)}function ga(c,h){c.H&&U(c.H,function(p,w){Ke(h,w,p)}),c.l&&ip({},function(p,w){Ke(h,w,p)})}function bp(c,h,p){p=Math.min(c.i.length,p);var w=c.l?g(c.l.Na,c.l,c):null;e:{var L=c.i;let $=-1;for(;;){const Z=["count="+p];$==-1?0<p?($=L[0].g,Z.push("ofs="+$)):$=0:Z.push("ofs="+$);let Be=!0;for(let St=0;St<p;St++){let Me=L[St].g;const Vt=L[St].map;if(Me-=$,0>Me)$=Math.max(0,L[St].g-100),Be=!1;else try{vb(Vt,Z,"req"+Me+"_")}catch{w&&w(Vt)}}if(Be){w=Z.join("&");break e}}}return c=c.i.splice(0,p),h.D=c,w}function Ep(c){if(!c.g&&!c.u){c.Y=1;var h=c.Fa;qe||ue(),J||(qe(),J=!0),re.add(h,c),c.v=0}}function Vu(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=jr(g(c.Fa,c),Sp(c,c.v)),c.v++,!0)}t.Fa=function(){if(this.u=null,Tp(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=jr(g(this.ab,this),c)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,bt(10),sl(this),Tp(this))};function Fu(c){c.A!=null&&(l.clearTimeout(c.A),c.A=null)}function Tp(c){c.g=new Mr(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var h=ar(c.qa);Ke(h,"RID","rpc"),Ke(h,"SID",c.K),Ke(h,"AID",c.T),Ke(h,"CI",c.F?"0":"1"),!c.F&&c.ja&&Ke(h,"TO",c.ja),Ke(h,"TYPE","xmlhttp"),ga(c,h),c.m&&c.o&&Lu(h,c.m,c.o),c.L&&(c.g.I=c.L);var p=c.g;c=c.ia,p.L=1,p.v=el(ar(h)),p.m=null,p.P=!0,Xm(p,c)}t.Za=function(){this.C!=null&&(this.C=null,sl(this),Vu(this),bt(19))};function al(c){c.C!=null&&(l.clearTimeout(c.C),c.C=null)}function Cp(c,h){var p=null;if(c.g==h){al(c),Fu(c),c.g=null;var w=2}else if(Du(c.h,h))p=h.D,rp(c.h,h),w=1;else return;if(c.G!=0){if(h.o)if(w==1){p=h.m?h.m.length:0,h=Date.now()-h.F;var L=c.B;w=He(),st(w,new la(w,p)),il(c)}else Ep(c);else if(L=h.s,L==3||L==0&&0<h.X||!(w==1&&bb(c,h)||w==2&&Vu(c)))switch(p&&0<p.length&&(h=c.h,h.i=h.i.concat(p)),L){case 1:Ns(c,5);break;case 4:Ns(c,10);break;case 3:Ns(c,6);break;default:Ns(c,2)}}}function Sp(c,h){let p=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(p*=2),p*h}function Ns(c,h){if(c.j.info("Error code "+h),h==2){var p=g(c.fb,c),w=c.Xa;const L=!w;w=new Is(w||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Jo(w,"https"),el(w),L?pb(w.toString(),p):gb(w.toString(),p)}else bt(2);c.G=0,c.l&&c.l.sa(h),kp(c),xp(c)}t.fb=function(c){c?(this.j.info("Successfully pinged google.com"),bt(2)):(this.j.info("Failed to ping google.com"),bt(1))};function kp(c){if(c.G=0,c.ka=[],c.l){const h=sp(c.h);(h.length!=0||c.i.length!=0)&&(k(c.ka,h),k(c.ka,c.i),c.h.i.length=0,E(c.i),c.i.length=0),c.l.ra()}}function Ip(c,h,p){var w=p instanceof Is?ar(p):new Is(p);if(w.g!="")h&&(w.g=h+"."+w.g),Zo(w,w.s);else{var L=l.location;w=L.protocol,h=h?h+"."+L.hostname:L.hostname,L=+L.port;var $=new Is(null);w&&Jo($,w),h&&($.g=h),L&&Zo($,L),p&&($.l=p),w=$}return p=c.D,h=c.ya,p&&h&&Ke(w,p,h),Ke(w,"VER",c.la),ga(c,w),w}function Np(c,h,p){if(h&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=c.Ca&&!c.pa?new it(new tl({eb:p})):new it(c.pa),h.Ha(c.J),h}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Pp(){}t=Pp.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function ol(){}ol.prototype.g=function(c,h){return new un(c,h)};function un(c,h){Ue.call(this),this.g=new wp(h),this.l=c,this.h=h&&h.messageUrlParams||null,c=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(c?c["X-WebChannel-Content-Type"]=h.messageContentType:c={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(c?c["X-WebChannel-Client-Profile"]=h.va:c={"X-WebChannel-Client-Profile":h.va}),this.g.S=c,(c=h&&h.Sb)&&!x(c)&&(this.g.m=c),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!x(h)&&(this.g.D=h,c=this.h,c!==null&&h in c&&(c=this.h,h in c&&delete c[h])),this.j=new li(this)}S(un,Ue),un.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},un.prototype.close=function(){Ou(this.g)},un.prototype.o=function(c){var h=this.g;if(typeof c=="string"){var p={};p.__data__=c,c=p}else this.u&&(p={},p.__data__=H(c),c=p);h.i.push(new ib(h.Ya++,c)),h.G==3&&il(h)},un.prototype.N=function(){this.g.l=null,delete this.j,Ou(this.g),delete this.g,un.aa.N.call(this)};function Ap(c){Te.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var h=c.__sm__;if(h){e:{for(const p in h){c=p;break e}c=void 0}(this.i=c)&&(c=this.i,h=h!==null&&c in h?h[c]:void 0),this.data=h}else this.data=c}S(Ap,Te);function Rp(){K.call(this),this.status=1}S(Rp,K);function li(c){this.g=c}S(li,Pp),li.prototype.ua=function(){st(this.g,"a")},li.prototype.ta=function(c){st(this.g,new Ap(c))},li.prototype.sa=function(c){st(this.g,new Rp)},li.prototype.ra=function(){st(this.g,"b")},ol.prototype.createWebChannel=ol.prototype.g,un.prototype.send=un.prototype.o,un.prototype.open=un.prototype.m,un.prototype.close=un.prototype.close,Ox=function(){return new ol},Lx=function(){return He()},Mx=ne,Dh={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Qo.NO_ERROR=0,Qo.TIMEOUT=8,Qo.HTTP_ERROR=6,Kl=Qo,Km.COMPLETE="complete",Dx=Km,z.EventType=B,B.OPEN="a",B.CLOSE="b",B.ERROR="c",B.MESSAGE="d",Ue.prototype.listen=Ue.prototype.K,Ra=z,it.prototype.listenOnce=it.prototype.L,it.prototype.getLastError=it.prototype.Ka,it.prototype.getLastErrorCode=it.prototype.Ba,it.prototype.getStatus=it.prototype.Z,it.prototype.getResponseJson=it.prototype.Oa,it.prototype.getResponseText=it.prototype.oa,it.prototype.send=it.prototype.ea,it.prototype.setWithCredentials=it.prototype.Ha,jx=it}).apply(typeof kl<"u"?kl:typeof self<"u"?self:typeof window<"u"?window:{});const Sy="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}zt.UNAUTHENTICATED=new zt(null),zt.GOOGLE_CREDENTIALS=new zt("google-credentials-uid"),zt.FIRST_PARTY=new zt("first-party-uid"),zt.MOCK_USER=new zt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sa="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ks=new Gf("@firebase/firestore");function Ca(){return Ks.logLevel}function oe(t,...e){if(Ks.logLevel<=Ne.DEBUG){const n=e.map(im);Ks.debug(`Firestore (${sa}): ${t}`,...n)}}function Cr(t,...e){if(Ks.logLevel<=Ne.ERROR){const n=e.map(im);Ks.error(`Firestore (${sa}): ${t}`,...n)}}function qi(t,...e){if(Ks.logLevel<=Ne.WARN){const n=e.map(im);Ks.warn(`Firestore (${sa}): ${t}`,...n)}}function im(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ye(t="Unexpected state"){const e=`FIRESTORE (${sa}) INTERNAL ASSERTION FAILED: `+t;throw Cr(e),new Error(e)}function Fe(t,e){t||ye()}function xe(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ie extends Ir{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vx{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class QI{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(zt.UNAUTHENTICATED))}shutdown(){}}class YI{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class XI{constructor(e){this.t=e,this.currentUser=zt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Fe(this.o===void 0);let r=this.i;const s=u=>this.i!==r?(r=this.i,n(u)):Promise.resolve();let i=new vr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new vr,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const u=i;e.enqueueRetryable(async()=>{await u.promise,await s(this.currentUser)})},l=u=>{oe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(u=>l(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(oe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new vr)}},0),a()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(oe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Fe(typeof r.accessToken=="string"),new Vx(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Fe(e===null||typeof e=="string"),new zt(e)}}class JI{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=zt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class ZI{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new JI(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(zt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class eN{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class tN{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){Fe(this.o===void 0);const r=i=>{i.error!=null&&oe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.R;return this.R=i.token,oe("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{oe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):oe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Fe(typeof n.token=="string"),this.R=n.token,new eN(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nN(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fx{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=nN(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%e.length))}return r}}function Le(t,e){return t<e?-1:t>e?1:0}function Hi(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new ie(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ie(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new ie(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ie(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return wt.fromMillis(Date.now())}static fromDate(e){return wt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new wt(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Le(this.nanoseconds,e.nanoseconds):Le(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{constructor(e){this.timestamp=e}static fromTimestamp(e){return new we(e)}static min(){return new we(new wt(0,0))}static max(){return new we(new wt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wo{constructor(e,n,r){n===void 0?n=0:n>e.length&&ye(),r===void 0?r=e.length-n:r>e.length-n&&ye(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return wo.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof wo?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=e.get(s),a=n.get(s);if(i<a)return-1;if(i>a)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class Ye extends wo{construct(e,n,r){return new Ye(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new ie(q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new Ye(n)}static emptyPath(){return new Ye([])}}const rN=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Nt extends wo{construct(e,n,r){return new Nt(e,n,r)}static isValidIdentifier(e){return rN.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Nt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Nt(["__name__"])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ie(q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new ie(q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new ie(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new ie(q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Nt(n)}static emptyPath(){return new Nt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ce{constructor(e){this.path=e}static fromPath(e){return new ce(Ye.fromString(e))}static fromName(e){return new ce(Ye.fromString(e).popFirst(5))}static empty(){return new ce(Ye.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ye.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ye.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ce(new Ye(e.slice()))}}function sN(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=we.fromTimestamp(r===1e9?new wt(n+1,0):new wt(n,r));return new ms(s,ce.empty(),e)}function iN(t){return new ms(t.readTime,t.key,-1)}class ms{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new ms(we.min(),ce.empty(),-1)}static max(){return new ms(we.max(),ce.empty(),-1)}}function aN(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=ce.comparator(t.documentKey,e.documentKey),n!==0?n:Le(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oN="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class lN{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vo(t){if(t.code!==q.FAILED_PRECONDITION||t.message!==oN)throw t;oe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ye(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new G((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof G?n:G.resolve(n)}catch(n){return G.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):G.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):G.reject(n)}static resolve(e){return new G((n,r)=>{n(e)})}static reject(e){return new G((n,r)=>{r(e)})}static waitFor(e){return new G((n,r)=>{let s=0,i=0,a=!1;e.forEach(l=>{++s,l.next(()=>{++i,a&&i===s&&n()},u=>r(u))}),a=!0,i===s&&n()})}static or(e){let n=G.resolve(!1);for(const r of e)n=n.next(s=>s?G.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new G((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let u=0;u<i;u++){const d=u;n(e[d]).next(f=>{a[d]=f,++l,l===i&&r(a)},f=>s(f))}})}static doWhile(e,n){return new G((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}function cN(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Fo(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}am.oe=-1;function uu(t){return t==null}function jc(t){return t===0&&1/t==-1/0}function uN(t){return typeof t=="number"&&Number.isInteger(t)&&!jc(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ky(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ni(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function $x(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nt{constructor(e,n){this.comparator=e,this.root=n||It.EMPTY}insert(e,n){return new nt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,It.BLACK,null,null))}remove(e){return new nt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,It.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Il(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Il(this.root,e,this.comparator,!1)}getReverseIterator(){return new Il(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Il(this.root,e,this.comparator,!0)}}class Il{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class It{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??It.RED,this.left=s??It.EMPTY,this.right=i??It.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new It(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return It.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return It.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,It.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,It.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ye();const e=this.left.check();if(e!==this.right.check())throw ye();return e+(this.isRed()?0:1)}}It.EMPTY=null,It.RED=!0,It.BLACK=!1;It.EMPTY=new class{constructor(){this.size=0}get key(){throw ye()}get value(){throw ye()}get color(){throw ye()}get left(){throw ye()}get right(){throw ye()}copy(e,n,r,s,i){return this}insert(e,n,r){return new It(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(e){this.comparator=e,this.data=new nt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Iy(this.data.getIterator())}getIteratorFrom(e){return new Iy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof At)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new At(this.comparator);return n.data=e,n}}class Iy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e){this.fields=e,e.sort(Nt.comparator)}static empty(){return new fn([])}unionWith(e){let n=new At(Nt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new fn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Hi(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ux extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Ux("Invalid base64 string: "+i):i}}(e);return new jt(n)}static fromUint8Array(e){const n=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new jt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Le(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}jt.EMPTY_BYTE_STRING=new jt("");const dN=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ps(t){if(Fe(!!t),typeof t=="string"){let e=0;const n=dN.exec(t);if(Fe(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ot(t.seconds),nanos:ot(t.nanos)}}function ot(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Qs(t){return typeof t=="string"?jt.fromBase64String(t):jt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function om(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function lm(t){const e=t.mapValue.fields.__previous_value__;return om(e)?lm(e):e}function xo(t){const e=ps(t.mapValue.fields.__local_write_time__.timestampValue);return new wt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{constructor(e,n,r,s,i,a,l,u,d){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=d}}class _o{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new _o("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof _o&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nl={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Ys(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?om(t)?4:mN(t)?9007199254740991:fN(t)?10:11:ye()}function rr(t,e){if(t===e)return!0;const n=Ys(t);if(n!==Ys(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return xo(t).isEqual(xo(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=ps(s.timestampValue),l=ps(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return Qs(s.bytesValue).isEqual(Qs(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return ot(s.geoPointValue.latitude)===ot(i.geoPointValue.latitude)&&ot(s.geoPointValue.longitude)===ot(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return ot(s.integerValue)===ot(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=ot(s.doubleValue),l=ot(i.doubleValue);return a===l?jc(a)===jc(l):isNaN(a)&&isNaN(l)}return!1}(t,e);case 9:return Hi(t.arrayValue.values||[],e.arrayValue.values||[],rr);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(ky(a)!==ky(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!rr(a[u],l[u])))return!1;return!0}(t,e);default:return ye()}}function bo(t,e){return(t.values||[]).find(n=>rr(n,e))!==void 0}function Gi(t,e){if(t===e)return 0;const n=Ys(t),r=Ys(e);if(n!==r)return Le(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Le(t.booleanValue,e.booleanValue);case 2:return function(i,a){const l=ot(i.integerValue||i.doubleValue),u=ot(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1}(t,e);case 3:return Ny(t.timestampValue,e.timestampValue);case 4:return Ny(xo(t),xo(e));case 5:return Le(t.stringValue,e.stringValue);case 6:return function(i,a){const l=Qs(i),u=Qs(a);return l.compareTo(u)}(t.bytesValue,e.bytesValue);case 7:return function(i,a){const l=i.split("/"),u=a.split("/");for(let d=0;d<l.length&&d<u.length;d++){const f=Le(l[d],u[d]);if(f!==0)return f}return Le(l.length,u.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,a){const l=Le(ot(i.latitude),ot(a.latitude));return l!==0?l:Le(ot(i.longitude),ot(a.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Py(t.arrayValue,e.arrayValue);case 10:return function(i,a){var l,u,d,f;const m=i.fields||{},g=a.fields||{},b=(l=m.value)===null||l===void 0?void 0:l.arrayValue,S=(u=g.value)===null||u===void 0?void 0:u.arrayValue,E=Le(((d=b==null?void 0:b.values)===null||d===void 0?void 0:d.length)||0,((f=S==null?void 0:S.values)===null||f===void 0?void 0:f.length)||0);return E!==0?E:Py(b,S)}(t.mapValue,e.mapValue);case 11:return function(i,a){if(i===Nl.mapValue&&a===Nl.mapValue)return 0;if(i===Nl.mapValue)return 1;if(a===Nl.mapValue)return-1;const l=i.fields||{},u=Object.keys(l),d=a.fields||{},f=Object.keys(d);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){const g=Le(u[m],f[m]);if(g!==0)return g;const b=Gi(l[u[m]],d[f[m]]);if(b!==0)return b}return Le(u.length,f.length)}(t.mapValue,e.mapValue);default:throw ye()}}function Ny(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Le(t,e);const n=ps(t),r=ps(e),s=Le(n.seconds,r.seconds);return s!==0?s:Le(n.nanos,r.nanos)}function Py(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=Gi(n[s],r[s]);if(i)return i}return Le(n.length,r.length)}function Ki(t){return Mh(t)}function Mh(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=ps(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Qs(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return ce.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=Mh(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${Mh(n.fields[a])}`;return s+"}"}(t.mapValue):ye()}function Ay(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Lh(t){return!!t&&"integerValue"in t}function cm(t){return!!t&&"arrayValue"in t}function Ry(t){return!!t&&"nullValue"in t}function jy(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ql(t){return!!t&&"mapValue"in t}function fN(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function Ha(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ni(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Ha(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ha(t.arrayValue.values[n]);return e}return Object.assign({},t)}function mN(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(e){this.value=e}static empty(){return new rn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Ql(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ha(n)}setAll(e){let n=Nt.emptyPath(),r={},s=[];e.forEach((a,l)=>{if(!n.isImmediateParentOf(l)){const u=this.getFieldsMap(n);this.applyChanges(u,r,s),r={},s=[],n=l.popLast()}a?r[l.lastSegment()]=Ha(a):s.push(l.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());Ql(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return rr(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Ql(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){ni(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new rn(Ha(this.value))}}function Bx(t){const e=[];return ni(t.fields,(n,r)=>{const s=new Nt([n]);if(Ql(r)){const i=Bx(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new fn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e,n,r,s,i,a,l){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new qt(e,0,we.min(),we.min(),we.min(),rn.empty(),0)}static newFoundDocument(e,n,r,s){return new qt(e,1,n,we.min(),r,s,0)}static newNoDocument(e,n){return new qt(e,2,n,we.min(),we.min(),rn.empty(),0)}static newUnknownDocument(e,n){return new qt(e,3,n,we.min(),we.min(),rn.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(we.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=rn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=rn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=we.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof qt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new qt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dc{constructor(e,n){this.position=e,this.inclusive=n}}function Dy(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],a=t.position[s];if(i.field.isKeyField()?r=ce.comparator(ce.fromName(a.referenceValue),n.key):r=Gi(a,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function My(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!rr(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc{constructor(e,n="asc"){this.field=e,this.dir=n}}function pN(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zx{}class ft extends zx{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new yN(e,n,r):n==="array-contains"?new xN(e,r):n==="in"?new _N(e,r):n==="not-in"?new bN(e,r):n==="array-contains-any"?new EN(e,r):new ft(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new vN(e,r):new wN(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(Gi(n,this.value)):n!==null&&Ys(this.value)===Ys(n)&&this.matchesComparison(Gi(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ye()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Un extends zx{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new Un(e,n)}matches(e){return Wx(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Wx(t){return t.op==="and"}function qx(t){return gN(t)&&Wx(t)}function gN(t){for(const e of t.filters)if(e instanceof Un)return!1;return!0}function Oh(t){if(t instanceof ft)return t.field.canonicalString()+t.op.toString()+Ki(t.value);if(qx(t))return t.filters.map(e=>Oh(e)).join(",");{const e=t.filters.map(n=>Oh(n)).join(",");return`${t.op}(${e})`}}function Hx(t,e){return t instanceof ft?function(r,s){return s instanceof ft&&r.op===s.op&&r.field.isEqual(s.field)&&rr(r.value,s.value)}(t,e):t instanceof Un?function(r,s){return s instanceof Un&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,l)=>i&&Hx(a,s.filters[l]),!0):!1}(t,e):void ye()}function Gx(t){return t instanceof ft?function(n){return`${n.field.canonicalString()} ${n.op} ${Ki(n.value)}`}(t):t instanceof Un?function(n){return n.op.toString()+" {"+n.getFilters().map(Gx).join(" ,")+"}"}(t):"Filter"}class yN extends ft{constructor(e,n,r){super(e,n,r),this.key=ce.fromName(r.referenceValue)}matches(e){const n=ce.comparator(e.key,this.key);return this.matchesComparison(n)}}class vN extends ft{constructor(e,n){super(e,"in",n),this.keys=Kx("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class wN extends ft{constructor(e,n){super(e,"not-in",n),this.keys=Kx("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function Kx(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>ce.fromName(r.referenceValue))}class xN extends ft{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return cm(n)&&bo(n.arrayValue,this.value)}}class _N extends ft{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&bo(this.value.arrayValue,n)}}class bN extends ft{constructor(e,n){super(e,"not-in",n)}matches(e){if(bo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!bo(this.value.arrayValue,n)}}class EN extends ft{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!cm(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>bo(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TN{constructor(e,n=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.ue=null}}function Ly(t,e=null,n=[],r=[],s=null,i=null,a=null){return new TN(t,e,n,r,s,i,a)}function um(t){const e=xe(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>Oh(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),uu(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Ki(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Ki(r)).join(",")),e.ue=n}return e.ue}function dm(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!pN(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Hx(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!My(t.startAt,e.startAt)&&My(t.endAt,e.endAt)}function Vh(t){return ce.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(e,n=null,r=[],s=[],i=null,a="F",l=null,u=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function CN(t,e,n,r,s,i,a,l){return new $o(t,e,n,r,s,i,a,l)}function du(t){return new $o(t)}function Oy(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Qx(t){return t.collectionGroup!==null}function Ga(t){const e=xe(t);if(e.ce===null){e.ce=[];const n=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new At(Nt.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.ce.push(new Mc(i,r))}),n.has(Nt.keyField().canonicalString())||e.ce.push(new Mc(Nt.keyField(),r))}return e.ce}function tr(t){const e=xe(t);return e.le||(e.le=SN(e,Ga(t))),e.le}function SN(t,e){if(t.limitType==="F")return Ly(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Mc(s.field,i)});const n=t.endAt?new Dc(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Dc(t.startAt.position,t.startAt.inclusive):null;return Ly(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Fh(t,e){const n=t.filters.concat([e]);return new $o(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function $h(t,e,n){return new $o(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function hu(t,e){return dm(tr(t),tr(e))&&t.limitType===e.limitType}function Yx(t){return`${um(tr(t))}|lt:${t.limitType}`}function di(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>Gx(s)).join(", ")}]`),uu(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Ki(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Ki(s)).join(",")),`Target(${r})`}(tr(t))}; limitType=${t.limitType})`}function fu(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ce.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of Ga(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(a,l,u){const d=Dy(a,l,u);return a.inclusive?d<=0:d<0}(r.startAt,Ga(r),s)||r.endAt&&!function(a,l,u){const d=Dy(a,l,u);return a.inclusive?d>=0:d>0}(r.endAt,Ga(r),s))}(t,e)}function kN(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Xx(t){return(e,n)=>{let r=!1;for(const s of Ga(t)){const i=IN(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function IN(t,e,n){const r=t.field.isKeyField()?ce.comparator(e.key,n.key):function(i,a,l){const u=a.data.field(i),d=l.data.field(i);return u!==null&&d!==null?Gi(u,d):ye()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ye()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){ni(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return $x(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NN=new nt(ce.comparator);function Sr(){return NN}const Jx=new nt(ce.comparator);function ja(...t){let e=Jx;for(const n of t)e=e.insert(n.key,n);return e}function Zx(t){let e=Jx;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Ls(){return Ka()}function e_(){return Ka()}function Ka(){return new ia(t=>t.toString(),(t,e)=>t.isEqual(e))}const PN=new nt(ce.comparator),AN=new At(ce.comparator);function Se(...t){let e=AN;for(const n of t)e=e.add(n);return e}const RN=new At(Le);function jN(){return RN}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hm(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:jc(e)?"-0":e}}function t_(t){return{integerValue:""+t}}function DN(t,e){return uN(e)?t_(e):hm(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mu{constructor(){this._=void 0}}function MN(t,e,n){return t instanceof Eo?function(s,i){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&om(i)&&(i=lm(i)),i&&(a.fields.__previous_value__=i),{mapValue:a}}(n,e):t instanceof To?r_(t,e):t instanceof Co?s_(t,e):function(s,i){const a=n_(s,i),l=Vy(a)+Vy(s.Pe);return Lh(a)&&Lh(s.Pe)?t_(l):hm(s.serializer,l)}(t,e)}function LN(t,e,n){return t instanceof To?r_(t,e):t instanceof Co?s_(t,e):n}function n_(t,e){return t instanceof Lc?function(r){return Lh(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Eo extends mu{}class To extends mu{constructor(e){super(),this.elements=e}}function r_(t,e){const n=i_(e);for(const r of t.elements)n.some(s=>rr(s,r))||n.push(r);return{arrayValue:{values:n}}}class Co extends mu{constructor(e){super(),this.elements=e}}function s_(t,e){let n=i_(e);for(const r of t.elements)n=n.filter(s=>!rr(s,r));return{arrayValue:{values:n}}}class Lc extends mu{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function Vy(t){return ot(t.integerValue||t.doubleValue)}function i_(t){return cm(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ON{constructor(e,n){this.field=e,this.transform=n}}function VN(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof To&&s instanceof To||r instanceof Co&&s instanceof Co?Hi(r.elements,s.elements,rr):r instanceof Lc&&s instanceof Lc?rr(r.Pe,s.Pe):r instanceof Eo&&s instanceof Eo}(t.transform,e.transform)}class FN{constructor(e,n){this.version=e,this.transformResults=n}}class Vn{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Vn}static exists(e){return new Vn(void 0,e)}static updateTime(e){return new Vn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Yl(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class pu{}function a_(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new fm(t.key,Vn.none()):new Uo(t.key,t.data,Vn.none());{const n=t.data,r=rn.empty();let s=new At(Nt.comparator);for(let i of e.fields)if(!s.has(i)){let a=n.field(i);a===null&&i.length>1&&(i=i.popLast(),a=n.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Es(t.key,r,new fn(s.toArray()),Vn.none())}}function $N(t,e,n){t instanceof Uo?function(s,i,a){const l=s.value.clone(),u=$y(s.fieldTransforms,i,a.transformResults);l.setAll(u),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(t,e,n):t instanceof Es?function(s,i,a){if(!Yl(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=$y(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(o_(s)),u.setAll(l),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(t,e,n):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,n)}function Qa(t,e,n,r){return t instanceof Uo?function(i,a,l,u){if(!Yl(i.precondition,a))return l;const d=i.value.clone(),f=Uy(i.fieldTransforms,u,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof Es?function(i,a,l,u){if(!Yl(i.precondition,a))return l;const d=Uy(i.fieldTransforms,u,a),f=a.data;return f.setAll(o_(i)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(m=>m.field))}(t,e,n,r):function(i,a,l){return Yl(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(t,e,n)}function UN(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=n_(r.transform,s||null);i!=null&&(n===null&&(n=rn.empty()),n.set(r.field,i))}return n||null}function Fy(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Hi(r,s,(i,a)=>VN(i,a))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Uo extends pu{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Es extends pu{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function o_(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function $y(t,e,n){const r=new Map;Fe(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,LN(a,l,n[s]))}return r}function Uy(t,e,n){const r=new Map;for(const s of t){const i=s.transform,a=n.data.field(s.field);r.set(s.field,MN(i,a,e))}return r}class fm extends pu{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class BN extends pu{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zN{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&$N(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Qa(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Qa(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=e_();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=n.has(s.key)?null:l;const u=a_(a,l);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(we.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Se())}isEqual(e){return this.batchId===e.batchId&&Hi(this.mutations,e.mutations,(n,r)=>Fy(n,r))&&Hi(this.baseMutations,e.baseMutations,(n,r)=>Fy(n,r))}}class mm{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Fe(e.mutations.length===r.length);let s=function(){return PN}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new mm(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WN{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qN{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var dt,Pe;function HN(t){switch(t){default:return ye();case q.CANCELLED:case q.UNKNOWN:case q.DEADLINE_EXCEEDED:case q.RESOURCE_EXHAUSTED:case q.INTERNAL:case q.UNAVAILABLE:case q.UNAUTHENTICATED:return!1;case q.INVALID_ARGUMENT:case q.NOT_FOUND:case q.ALREADY_EXISTS:case q.PERMISSION_DENIED:case q.FAILED_PRECONDITION:case q.ABORTED:case q.OUT_OF_RANGE:case q.UNIMPLEMENTED:case q.DATA_LOSS:return!0}}function l_(t){if(t===void 0)return Cr("GRPC error has no .code"),q.UNKNOWN;switch(t){case dt.OK:return q.OK;case dt.CANCELLED:return q.CANCELLED;case dt.UNKNOWN:return q.UNKNOWN;case dt.DEADLINE_EXCEEDED:return q.DEADLINE_EXCEEDED;case dt.RESOURCE_EXHAUSTED:return q.RESOURCE_EXHAUSTED;case dt.INTERNAL:return q.INTERNAL;case dt.UNAVAILABLE:return q.UNAVAILABLE;case dt.UNAUTHENTICATED:return q.UNAUTHENTICATED;case dt.INVALID_ARGUMENT:return q.INVALID_ARGUMENT;case dt.NOT_FOUND:return q.NOT_FOUND;case dt.ALREADY_EXISTS:return q.ALREADY_EXISTS;case dt.PERMISSION_DENIED:return q.PERMISSION_DENIED;case dt.FAILED_PRECONDITION:return q.FAILED_PRECONDITION;case dt.ABORTED:return q.ABORTED;case dt.OUT_OF_RANGE:return q.OUT_OF_RANGE;case dt.UNIMPLEMENTED:return q.UNIMPLEMENTED;case dt.DATA_LOSS:return q.DATA_LOSS;default:return ye()}}(Pe=dt||(dt={}))[Pe.OK=0]="OK",Pe[Pe.CANCELLED=1]="CANCELLED",Pe[Pe.UNKNOWN=2]="UNKNOWN",Pe[Pe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Pe[Pe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Pe[Pe.NOT_FOUND=5]="NOT_FOUND",Pe[Pe.ALREADY_EXISTS=6]="ALREADY_EXISTS",Pe[Pe.PERMISSION_DENIED=7]="PERMISSION_DENIED",Pe[Pe.UNAUTHENTICATED=16]="UNAUTHENTICATED",Pe[Pe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Pe[Pe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Pe[Pe.ABORTED=10]="ABORTED",Pe[Pe.OUT_OF_RANGE=11]="OUT_OF_RANGE",Pe[Pe.UNIMPLEMENTED=12]="UNIMPLEMENTED",Pe[Pe.INTERNAL=13]="INTERNAL",Pe[Pe.UNAVAILABLE=14]="UNAVAILABLE",Pe[Pe.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GN(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KN=new Fs([4294967295,4294967295],0);function By(t){const e=GN().encode(t),n=new Rx;return n.update(e),new Uint8Array(n.digest())}function zy(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Fs([n,r],0),new Fs([s,i],0)]}class pm{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Da(`Invalid padding: ${n}`);if(r<0)throw new Da(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Da(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Da(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=Fs.fromNumber(this.Ie)}Ee(e,n,r){let s=e.add(n.multiply(Fs.fromNumber(r)));return s.compare(KN)===1&&(s=new Fs([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const n=By(e),[r,s]=zy(n);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);if(!this.de(a))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new pm(i,s,n);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.Ie===0)return;const n=By(e),[r,s]=zy(n);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);this.Ae(a)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Da extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,Bo.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new gu(we.min(),s,new nt(Le),Sr(),Se())}}class Bo{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Bo(r,n,Se(),Se(),Se())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl{constructor(e,n,r,s){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=s}}class c_{constructor(e,n){this.targetId=e,this.me=n}}class u_{constructor(e,n,r=jt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class Wy{constructor(){this.fe=0,this.ge=Hy(),this.pe=jt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Se(),n=Se(),r=Se();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:ye()}}),new Bo(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=Hy()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Fe(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class QN{constructor(e){this.Le=e,this.Be=new Map,this.ke=Sr(),this.qe=qy(),this.Qe=new nt(Le)}Ke(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{const r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:ye()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,s)=>{this.ze(s)&&n(s)})}He(e){const n=e.targetId,r=e.me.count,s=this.Je(n);if(s){const i=s.target;if(Vh(i))if(r===0){const a=new ce(i.path);this.Ue(n,a,qt.newNoDocument(a,we.min()))}else Fe(r===1);else{const a=this.Ye(n);if(a!==r){const l=this.Ze(e),u=l?this.Xe(l,e,a):1;if(u!==0){this.je(n);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,d)}}}}}Ze(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let a,l;try{a=Qs(r).toUint8Array()}catch(u){if(u instanceof Ux)return qi("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new pm(a,s,i)}catch(u){return qi(u instanceof Da?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.Ie===0?null:l}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const a=this.Le.tt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.Ue(n,i,null),s++)}),s}rt(e){const n=new Map;this.Be.forEach((i,a)=>{const l=this.Je(a);if(l){if(i.current&&Vh(l.target)){const u=new ce(l.target.path);this.ke.get(u)!==null||this.it(a,u)||this.Ue(a,u,qt.newNoDocument(u,e))}i.be&&(n.set(a,i.ve()),i.Ce())}});let r=Se();this.qe.forEach((i,a)=>{let l=!0;a.forEachWhile(u=>{const d=this.Je(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.ke.forEach((i,a)=>a.setReadTime(e));const s=new gu(e,n,this.Qe,this.ke,r);return this.ke=Sr(),this.qe=qy(),this.Qe=new nt(Le),s}$e(e,n){if(!this.ze(e))return;const r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,n)?s.Fe(n,1):s.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const n=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new Wy,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new At(Le),this.qe=this.qe.insert(e,n)),n}ze(e){const n=this.Je(e)!==null;return n||oe("WatchChangeAggregator","Detected inactive target",e),n}Je(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Wy),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function qy(){return new nt(ce.comparator)}function Hy(){return new nt(ce.comparator)}const YN=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),XN=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),JN=(()=>({and:"AND",or:"OR"}))();class ZN{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Uh(t,e){return t.useProto3Json||uu(e)?e:{value:e}}function Oc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function d_(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function eP(t,e){return Oc(t,e.toTimestamp())}function nr(t){return Fe(!!t),we.fromTimestamp(function(n){const r=ps(n);return new wt(r.seconds,r.nanos)}(t))}function gm(t,e){return Bh(t,e).canonicalString()}function Bh(t,e){const n=function(s){return new Ye(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function h_(t){const e=Ye.fromString(t);return Fe(y_(e)),e}function zh(t,e){return gm(t.databaseId,e.path)}function _d(t,e){const n=h_(e);if(n.get(1)!==t.databaseId.projectId)throw new ie(q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ie(q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ce(m_(n))}function f_(t,e){return gm(t.databaseId,e)}function tP(t){const e=h_(t);return e.length===4?Ye.emptyPath():m_(e)}function Wh(t){return new Ye(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function m_(t){return Fe(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Gy(t,e,n){return{name:zh(t,e),fields:n.value.mapValue.fields}}function nP(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:ye()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,f){return d.useProto3Json?(Fe(f===void 0||typeof f=="string"),jt.fromBase64String(f||"")):(Fe(f===void 0||f instanceof Buffer||f instanceof Uint8Array),jt.fromUint8Array(f||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(d){const f=d.code===void 0?q.UNKNOWN:l_(d.code);return new ie(f,d.message||"")}(a);n=new u_(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=_d(t,r.document.name),i=nr(r.document.updateTime),a=r.document.createTime?nr(r.document.createTime):we.min(),l=new rn({mapValue:{fields:r.document.fields}}),u=qt.newFoundDocument(s,i,a,l),d=r.targetIds||[],f=r.removedTargetIds||[];n=new Xl(d,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=_d(t,r.document),i=r.readTime?nr(r.readTime):we.min(),a=qt.newNoDocument(s,i),l=r.removedTargetIds||[];n=new Xl([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=_d(t,r.document),i=r.removedTargetIds||[];n=new Xl([],i,s,null)}else{if(!("filter"in e))return ye();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new qN(s,i),l=r.targetId;n=new c_(l,a)}}return n}function rP(t,e){let n;if(e instanceof Uo)n={update:Gy(t,e.key,e.value)};else if(e instanceof fm)n={delete:zh(t,e.key)};else if(e instanceof Es)n={update:Gy(t,e.key,e.data),updateMask:hP(e.fieldMask)};else{if(!(e instanceof BN))return ye();n={verify:zh(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,a){const l=a.transform;if(l instanceof Eo)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof To)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Co)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Lc)return{fieldPath:a.field.canonicalString(),increment:l.Pe};throw ye()}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:eP(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ye()}(t,e.precondition)),n}function sP(t,e){return t&&t.length>0?(Fe(e!==void 0),t.map(n=>function(s,i){let a=s.updateTime?nr(s.updateTime):nr(i);return a.isEqual(we.min())&&(a=nr(i)),new FN(a,s.transformResults||[])}(n,e))):[]}function iP(t,e){return{documents:[f_(t,e.path)]}}function aP(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=f_(t,s);const i=function(d){if(d.length!==0)return g_(Un.create(d,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const a=function(d){if(d.length!==0)return d.map(f=>function(g){return{field:hi(g.field),direction:cP(g.dir)}}(f))}(e.orderBy);a&&(n.structuredQuery.orderBy=a);const l=Uh(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:n,parent:s}}function oP(t){let e=tP(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Fe(r===1);const f=n.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];n.where&&(i=function(m){const g=p_(m);return g instanceof Un&&qx(g)?g.getFilters():[g]}(n.where));let a=[];n.orderBy&&(a=function(m){return m.map(g=>function(S){return new Mc(fi(S.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(S.direction))}(g))}(n.orderBy));let l=null;n.limit&&(l=function(m){let g;return g=typeof m=="object"?m.value:m,uu(g)?null:g}(n.limit));let u=null;n.startAt&&(u=function(m){const g=!!m.before,b=m.values||[];return new Dc(b,g)}(n.startAt));let d=null;return n.endAt&&(d=function(m){const g=!m.before,b=m.values||[];return new Dc(b,g)}(n.endAt)),CN(e,s,a,i,l,"F",u,d)}function lP(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ye()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function p_(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=fi(n.unaryFilter.field);return ft.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=fi(n.unaryFilter.field);return ft.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=fi(n.unaryFilter.field);return ft.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=fi(n.unaryFilter.field);return ft.create(a,"!=",{nullValue:"NULL_VALUE"});default:return ye()}}(t):t.fieldFilter!==void 0?function(n){return ft.create(fi(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ye()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Un.create(n.compositeFilter.filters.map(r=>p_(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ye()}}(n.compositeFilter.op))}(t):ye()}function cP(t){return YN[t]}function uP(t){return XN[t]}function dP(t){return JN[t]}function hi(t){return{fieldPath:t.canonicalString()}}function fi(t){return Nt.fromServerFormat(t.fieldPath)}function g_(t){return t instanceof ft?function(n){if(n.op==="=="){if(jy(n.value))return{unaryFilter:{field:hi(n.field),op:"IS_NAN"}};if(Ry(n.value))return{unaryFilter:{field:hi(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(jy(n.value))return{unaryFilter:{field:hi(n.field),op:"IS_NOT_NAN"}};if(Ry(n.value))return{unaryFilter:{field:hi(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hi(n.field),op:uP(n.op),value:n.value}}}(t):t instanceof Un?function(n){const r=n.getFilters().map(s=>g_(s));return r.length===1?r[0]:{compositeFilter:{op:dP(n.op),filters:r}}}(t):ye()}function hP(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function y_(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e,n,r,s,i=we.min(),a=we.min(),l=jt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new Jr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Jr(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Jr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Jr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fP{constructor(e){this.ct=e}}function mP(t){const e=oP({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?$h(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pP{constructor(){this.un=new gP}addToCollectionParentIndex(e,n){return this.un.add(n),G.resolve()}getCollectionParents(e,n){return G.resolve(this.un.getEntries(n))}addFieldIndex(e,n){return G.resolve()}deleteFieldIndex(e,n){return G.resolve()}deleteAllFieldIndexes(e){return G.resolve()}createTargetIndexes(e,n){return G.resolve()}getDocumentsMatchingTarget(e,n){return G.resolve(null)}getIndexType(e,n){return G.resolve(0)}getFieldIndexes(e,n){return G.resolve([])}getNextCollectionGroupToUpdate(e){return G.resolve(null)}getMinOffset(e,n){return G.resolve(ms.min())}getMinOffsetFromCollectionGroup(e,n){return G.resolve(ms.min())}updateCollectionGroup(e,n,r){return G.resolve()}updateIndexEntries(e,n){return G.resolve()}}class gP{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new At(Ye.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new At(Ye.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Qi(0)}static kn(){return new Qi(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yP{constructor(){this.changes=new ia(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,qt.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?G.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vP{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wP{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&Qa(r.mutation,s,fn.empty(),wt.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Se()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Se()){const s=Ls();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let a=ja();return i.forEach((l,u)=>{a=a.insert(l,u.overlayedDocument)}),a}))}getOverlayedDocuments(e,n){const r=Ls();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Se()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,l)=>{n.set(a,l)})})}computeViews(e,n,r,s){let i=Sr();const a=Ka(),l=function(){return Ka()}();return n.forEach((u,d)=>{const f=r.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof Es)?i=i.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),Qa(f.mutation,d,f.mutation.getFieldMask(),wt.now())):a.set(d.key,fn.empty())}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((d,f)=>a.set(d,f)),n.forEach((d,f)=>{var m;return l.set(d,new vP(f,(m=a.get(d))!==null&&m!==void 0?m:null))}),l))}recalculateAndSaveOverlays(e,n){const r=Ka();let s=new nt((a,l)=>a-l),i=Se();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(a=>{for(const l of a)l.keys().forEach(u=>{const d=n.get(u);if(d===null)return;let f=r.get(u)||fn.empty();f=l.applyToLocalView(d,f),r.set(u,f);const m=(s.get(l.batchId)||Se()).add(u);s=s.insert(l.batchId,m)})}).next(()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),d=u.key,f=u.value,m=e_();f.forEach(g=>{if(!i.has(g)){const b=a_(n.get(g),r.get(g));b!==null&&m.set(g,b),i=i.add(g)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,m))}return G.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(a){return ce.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):Qx(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):G.resolve(Ls());let l=-1,u=i;return a.next(d=>G.forEach(d,(f,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),i.get(f)?G.resolve():this.remoteDocumentCache.getEntry(e,f).next(g=>{u=u.insert(f,g)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,u,d,Se())).next(f=>({batchId:l,changes:Zx(f)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new ce(n)).next(r=>{let s=ja();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let a=ja();return this.indexManager.getCollectionParents(e,i).next(l=>G.forEach(l,u=>{const d=function(m,g){return new $o(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(n,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(f=>{f.forEach((m,g)=>{a=a.insert(m,g)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(a=>{i.forEach((u,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,qt.newInvalidDocument(f)))});let l=ja();return a.forEach((u,d)=>{const f=i.get(u);f!==void 0&&Qa(f.mutation,d,fn.empty(),wt.now()),fu(n,d)&&(l=l.insert(u,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xP{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,n){return G.resolve(this.hr.get(n))}saveBundleMetadata(e,n){return this.hr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:nr(s.createTime)}}(n)),G.resolve()}getNamedQuery(e,n){return G.resolve(this.Pr.get(n))}saveNamedQuery(e,n){return this.Pr.set(n.name,function(s){return{name:s.name,query:mP(s.bundledQuery),readTime:nr(s.readTime)}}(n)),G.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _P{constructor(){this.overlays=new nt(ce.comparator),this.Ir=new Map}getOverlay(e,n){return G.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Ls();return G.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.ht(e,n,i)}),G.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),G.resolve()}getOverlaysForCollection(e,n,r){const s=Ls(),i=n.length+1,a=new ce(n.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const u=l.getNext().value,d=u.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return G.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new nt((d,f)=>d-f);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let f=i.get(d.largestBatchId);f===null&&(f=Ls(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const l=Ls(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((d,f)=>l.set(d,f)),!(l.size()>=s)););return G.resolve(l)}ht(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new WN(n,r));let i=this.Ir.get(n);i===void 0&&(i=Se(),this.Ir.set(n,i)),this.Ir.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bP{constructor(){this.sessionToken=jt.EMPTY_BYTE_STRING}getSessionToken(e){return G.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,G.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ym{constructor(){this.Tr=new At(Et.Er),this.dr=new At(Et.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,n){const r=new Et(e,n);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Vr(new Et(e,n))}mr(e,n){e.forEach(r=>this.removeReference(r,n))}gr(e){const n=new ce(new Ye([])),r=new Et(n,e),s=new Et(n,e+1),i=[];return this.dr.forEachInRange([r,s],a=>{this.Vr(a),i.push(a.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const n=new ce(new Ye([])),r=new Et(n,e),s=new Et(n,e+1);let i=Se();return this.dr.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){const n=new Et(e,0),r=this.Tr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Et{constructor(e,n){this.key=e,this.wr=n}static Er(e,n){return ce.comparator(e.key,n.key)||Le(e.wr,n.wr)}static Ar(e,n){return Le(e.wr,n.wr)||ce.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EP{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new At(Et.Er)}checkEmpty(e){return G.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new zN(i,n,r,s);this.mutationQueue.push(a);for(const l of s)this.br=this.br.add(new Et(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return G.resolve(a)}lookupMutationBatch(e,n){return G.resolve(this.Dr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.vr(r),i=s<0?0:s;return G.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return G.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return G.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Et(n,0),s=new Et(n,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],a=>{const l=this.Dr(a.wr);i.push(l)}),G.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new At(Le);return n.forEach(s=>{const i=new Et(s,0),a=new Et(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,a],l=>{r=r.add(l.wr)})}),G.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;ce.isDocumentKey(i)||(i=i.child(""));const a=new Et(new ce(i),0);let l=new At(Le);return this.br.forEachWhile(u=>{const d=u.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(u.wr)),!0)},a),G.resolve(this.Cr(l))}Cr(e){const n=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){Fe(this.Fr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return G.forEach(n.mutations,s=>{const i=new Et(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,n){const r=new Et(n,0),s=this.br.firstAfterOrEqual(r);return G.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,G.resolve()}Fr(e,n){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const n=this.vr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TP{constructor(e){this.Mr=e,this.docs=function(){return new nt(ce.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,a=this.Mr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return G.resolve(r?r.document.mutableCopy():qt.newInvalidDocument(n))}getEntries(e,n){let r=Sr();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():qt.newInvalidDocument(s))}),G.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=Sr();const a=n.path,l=new ce(a.child("")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||aN(iN(f),r)<=0||(s.has(f.key)||fu(n,f))&&(i=i.insert(f.key,f.mutableCopy()))}return G.resolve(i)}getAllFromCollectionGroup(e,n,r,s){ye()}Or(e,n){return G.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new CP(this)}getSize(e){return G.resolve(this.size)}}class CP extends yP{constructor(e){super(),this.cr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),G.waitFor(n)}getFromCache(e,n){return this.cr.getEntry(e,n)}getAllFromCache(e,n){return this.cr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SP{constructor(e){this.persistence=e,this.Nr=new ia(n=>um(n),dm),this.lastRemoteSnapshotVersion=we.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ym,this.targetCount=0,this.kr=Qi.Bn()}forEachTarget(e,n){return this.Nr.forEach((r,s)=>n(s)),G.resolve()}getLastRemoteSnapshotVersion(e){return G.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return G.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),G.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Lr&&(this.Lr=n),G.resolve()}Kn(e){this.Nr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.kr=new Qi(n),this.highestTargetId=n),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,n){return this.Kn(n),this.targetCount+=1,G.resolve()}updateTargetData(e,n){return this.Kn(n),G.resolve()}removeTargetData(e,n){return this.Nr.delete(n.target),this.Br.gr(n.targetId),this.targetCount-=1,G.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.Nr.forEach((a,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),G.waitFor(i).next(()=>s)}getTargetCount(e){return G.resolve(this.targetCount)}getTargetData(e,n){const r=this.Nr.get(n)||null;return G.resolve(r)}addMatchingKeys(e,n,r){return this.Br.Rr(n,r),G.resolve()}removeMatchingKeys(e,n,r){this.Br.mr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),G.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.Br.gr(n),G.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Br.yr(n);return G.resolve(r)}containsKey(e,n){return G.resolve(this.Br.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kP{constructor(e,n){this.qr={},this.overlays={},this.Qr=new am(0),this.Kr=!1,this.Kr=!0,this.$r=new bP,this.referenceDelegate=e(this),this.Ur=new SP(this),this.indexManager=new pP,this.remoteDocumentCache=function(s){return new TP(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new fP(n),this.Gr=new xP(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new _P,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.qr[e.toKey()];return r||(r=new EP(n,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,n,r){oe("MemoryPersistence","Starting transaction:",e);const s=new IP(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,n){return G.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,n)))}}class IP extends lN{constructor(e){super(),this.currentSequenceNumber=e}}class vm{constructor(e){this.persistence=e,this.Jr=new ym,this.Yr=null}static Zr(e){return new vm(e)}get Xr(){if(this.Yr)return this.Yr;throw ye()}addReference(e,n,r){return this.Jr.addReference(r,n),this.Xr.delete(r.toString()),G.resolve()}removeReference(e,n,r){return this.Jr.removeReference(r,n),this.Xr.add(r.toString()),G.resolve()}markPotentiallyOrphaned(e,n){return this.Xr.add(n.toString()),G.resolve()}removeTarget(e,n){this.Jr.gr(n.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}zr(){this.Yr=new Set}jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return G.forEach(this.Xr,r=>{const s=ce.fromPath(r);return this.ei(e,s).next(i=>{i||n.removeEntry(s,we.min())})}).next(()=>(this.Yr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ei(e,n).next(r=>{r?this.Xr.delete(n.toString()):this.Xr.add(n.toString())})}Wr(e){return 0}ei(e,n){return G.or([()=>G.resolve(this.Jr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Hr(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wm{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.$i=r,this.Ui=s}static Wi(e,n){let r=Se(),s=Se();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new wm(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NP{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return mC()?8:cN(Kt())>0?6:4}()}initialize(e,n){this.Ji=e,this.indexManager=n,this.Gi=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.Yi(e,n).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.Zi(e,n,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new NP;return this.Xi(e,n,a).next(l=>{if(i.result=l,this.zi)return this.es(e,n,a,l.size)})}).next(()=>i.result)}es(e,n,r,s){return r.documentReadCount<this.ji?(Ca()<=Ne.DEBUG&&oe("QueryEngine","SDK will not create cache indexes for query:",di(n),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),G.resolve()):(Ca()<=Ne.DEBUG&&oe("QueryEngine","Query:",di(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Ca()<=Ne.DEBUG&&oe("QueryEngine","The SDK decides to create cache indexes for query:",di(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,tr(n))):G.resolve())}Yi(e,n){if(Oy(n))return G.resolve(null);let r=tr(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=$h(n,null,"F"),r=tr(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const a=Se(...i);return this.Ji.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(u=>{const d=this.ts(n,l);return this.ns(n,d,a,u.readTime)?this.Yi(e,$h(n,null,"F")):this.rs(e,d,n,u)}))})))}Zi(e,n,r,s){return Oy(n)||s.isEqual(we.min())?G.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const a=this.ts(n,i);return this.ns(n,a,r,s)?G.resolve(null):(Ca()<=Ne.DEBUG&&oe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),di(n)),this.rs(e,a,n,sN(s,-1)).next(l=>l))})}ts(e,n){let r=new At(Xx(e));return n.forEach((s,i)=>{fu(e,i)&&(r=r.add(i))}),r}ns(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,n,r){return Ca()<=Ne.DEBUG&&oe("QueryEngine","Using full collection scan to execute query:",di(n)),this.Ji.getDocumentsMatchingQuery(e,n,ms.min(),r)}rs(e,n,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AP{constructor(e,n,r,s){this.persistence=e,this.ss=n,this.serializer=s,this.os=new nt(Le),this._s=new ia(i=>um(i),dm),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new wP(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.os))}}function RP(t,e,n,r){return new AP(t,e,n,r)}async function v_(t,e){const n=xe(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.ls(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const a=[],l=[];let u=Se();for(const d of s){a.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}for(const d of i){l.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}return n.localDocuments.getDocuments(r,u).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:l}))})})}function jP(t,e){const n=xe(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(l,u,d,f){const m=d.batch,g=m.keys();let b=G.resolve();return g.forEach(S=>{b=b.next(()=>f.getEntry(u,S)).next(E=>{const k=d.docVersions.get(S);Fe(k!==null),E.version.compareTo(k)<0&&(m.applyToRemoteDocument(E,d),E.isValidDocument()&&(E.setReadTime(d.commitVersion),f.addEntry(E)))})}),b.next(()=>l.mutationQueue.removeMutationBatch(u,m))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let u=Se();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(u=u.add(l.batch.mutations[d].key));return u}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function w_(t){const e=xe(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ur.getLastRemoteSnapshotVersion(n))}function DP(t,e){const n=xe(t),r=e.snapshotVersion;let s=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=n.cs.newChangeBuffer({trackRemovals:!0});s=n.os;const l=[];e.targetChanges.forEach((f,m)=>{const g=s.get(m);if(!g)return;l.push(n.Ur.removeMatchingKeys(i,f.removedDocuments,m).next(()=>n.Ur.addMatchingKeys(i,f.addedDocuments,m)));let b=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?b=b.withResumeToken(jt.EMPTY_BYTE_STRING,we.min()).withLastLimboFreeSnapshotVersion(we.min()):f.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(f.resumeToken,r)),s=s.insert(m,b),function(E,k,_){return E.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=3e8?!0:_.addedDocuments.size+_.modifiedDocuments.size+_.removedDocuments.size>0}(g,b,f)&&l.push(n.Ur.updateTargetData(i,b))});let u=Sr(),d=Se();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(i,f))}),l.push(MP(i,a,e.documentUpdates).next(f=>{u=f.Ps,d=f.Is})),!r.isEqual(we.min())){const f=n.Ur.getLastRemoteSnapshotVersion(i).next(m=>n.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(f)}return G.waitFor(l).next(()=>a.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,u,d)).next(()=>u)}).then(i=>(n.os=s,i))}function MP(t,e,n){let r=Se(),s=Se();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let a=Sr();return n.forEach((l,u)=>{const d=i.get(l);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),u.isNoDocument()&&u.version.isEqual(we.min())?(e.removeEntry(l,u.readTime),a=a.insert(l,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),a=a.insert(l,u)):oe("LocalStore","Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",u.version)}),{Ps:a,Is:s}})}function LP(t,e){const n=xe(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function OP(t,e){const n=xe(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Ur.getTargetData(r,e).next(i=>i?(s=i,G.resolve(s)):n.Ur.allocateTargetId(r).next(a=>(s=new Jr(e,a,"TargetPurposeListen",r.currentSequenceNumber),n.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.os=n.os.insert(r.targetId,r),n._s.set(e,r.targetId)),r})}async function qh(t,e,n){const r=xe(t),s=r.os.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!Fo(a))throw a;oe("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Ky(t,e,n){const r=xe(t);let s=we.min(),i=Se();return r.persistence.runTransaction("Execute query","readwrite",a=>function(u,d,f){const m=xe(u),g=m._s.get(f);return g!==void 0?G.resolve(m.os.get(g)):m.Ur.getTargetData(d,f)}(r,a,tr(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,l.targetId).next(u=>{i=u})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,n?s:we.min(),n?i:Se())).next(l=>(VP(r,kN(e),l),{documents:l,Ts:i})))}function VP(t,e,n){let r=t.us.get(e)||we.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.us.set(e,r)}class Qy{constructor(){this.activeTargetIds=jN()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class FP{constructor(){this.so=new Qy,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,n,r){this.oo[e]=n}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Qy,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $P{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yy{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){oe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){oe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Pl=null;function bd(){return Pl===null?Pl=function(){return 268435456+Math.round(2147483648*Math.random())}():Pl++,"0x"+Pl.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BP{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bt="WebChannelConnection";class zP extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+n.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(n,r,s,i,a){const l=bd(),u=this.xo(n,r.toUriEncodedString());oe("RestConnection",`Sending RPC '${n}' ${l}:`,u,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,i,a),this.No(n,u,d,s).then(f=>(oe("RestConnection",`Received RPC '${n}' ${l}: `,f),f),f=>{throw qi("RestConnection",`RPC '${n}' ${l} failed with error: `,f,"url: ",u,"request:",s),f})}Lo(n,r,s,i,a,l){return this.Mo(n,r,s,i,a)}Oo(n,r,s){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+sa}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,a)=>n[a]=i),s&&s.headers.forEach((i,a)=>n[a]=i)}xo(n,r){const s=UP[n];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,n,r,s){const i=bd();return new Promise((a,l)=>{const u=new jx;u.setWithCredentials(!0),u.listenOnce(Dx.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Kl.NO_ERROR:const f=u.getResponseJson();oe(Bt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(f)),a(f);break;case Kl.TIMEOUT:oe(Bt,`RPC '${e}' ${i} timed out`),l(new ie(q.DEADLINE_EXCEEDED,"Request time out"));break;case Kl.HTTP_ERROR:const m=u.getStatus();if(oe(Bt,`RPC '${e}' ${i} failed with status:`,m,"response text:",u.getResponseText()),m>0){let g=u.getResponseJson();Array.isArray(g)&&(g=g[0]);const b=g==null?void 0:g.error;if(b&&b.status&&b.message){const S=function(k){const _=k.toLowerCase().replace(/_/g,"-");return Object.values(q).indexOf(_)>=0?_:q.UNKNOWN}(b.status);l(new ie(S,b.message))}else l(new ie(q.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new ie(q.UNAVAILABLE,"Connection failed."));break;default:ye()}}finally{oe(Bt,`RPC '${e}' ${i} completed.`)}});const d=JSON.stringify(s);oe(Bt,`RPC '${e}' ${i} sending request:`,s),u.send(n,"POST",d,r,15)})}Bo(e,n,r){const s=bd(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Ox(),l=Lx(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,n,r),u.encodeInitMessageHeaders=!0;const f=i.join("");oe(Bt,`Creating RPC '${e}' stream ${s}: ${f}`,u);const m=a.createWebChannel(f,u);let g=!1,b=!1;const S=new BP({Io:k=>{b?oe(Bt,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(g||(oe(Bt,`Opening RPC '${e}' stream ${s} transport.`),m.open(),g=!0),oe(Bt,`RPC '${e}' stream ${s} sending:`,k),m.send(k))},To:()=>m.close()}),E=(k,_,x)=>{k.listen(_,N=>{try{x(N)}catch(M){setTimeout(()=>{throw M},0)}})};return E(m,Ra.EventType.OPEN,()=>{b||(oe(Bt,`RPC '${e}' stream ${s} transport opened.`),S.yo())}),E(m,Ra.EventType.CLOSE,()=>{b||(b=!0,oe(Bt,`RPC '${e}' stream ${s} transport closed`),S.So())}),E(m,Ra.EventType.ERROR,k=>{b||(b=!0,qi(Bt,`RPC '${e}' stream ${s} transport errored:`,k),S.So(new ie(q.UNAVAILABLE,"The operation could not be completed")))}),E(m,Ra.EventType.MESSAGE,k=>{var _;if(!b){const x=k.data[0];Fe(!!x);const N=x,M=N.error||((_=N[0])===null||_===void 0?void 0:_.error);if(M){oe(Bt,`RPC '${e}' stream ${s} received error:`,M);const D=M.status;let U=function(T){const C=dt[T];if(C!==void 0)return l_(C)}(D),v=M.message;U===void 0&&(U=q.INTERNAL,v="Unknown error status: "+D+" with message "+M.message),b=!0,S.So(new ie(U,v)),m.close()}else oe(Bt,`RPC '${e}' stream ${s} received:`,x),S.bo(x)}}),E(l,Mx.STAT_EVENT,k=>{k.stat===Dh.PROXY?oe(Bt,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===Dh.NOPROXY&&oe(Bt,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{S.wo()},0),S}}function Ed(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yu(t){return new ZN(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_{constructor(e,n,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=n,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,n-r);s>0&&oe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __{constructor(e,n,r,s,i,a,l,u){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new x_(e,n)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,n){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():n&&n.code===q.RESOURCE_EXHAUSTED?(Cr(n.toString()),Cr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(n)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===n&&this.P_(r,s)},r=>{e(()=>{const s=new ie(q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,n){const r=this.h_(this.Yo);this.stream=this.T_(e,n),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return oe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return n=>{this.ui.enqueueAndForget(()=>this.Yo===e?n():(oe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class WP extends __{constructor(e,n,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}T_(e,n){return this.connection.Bo("Listen",e,n)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const n=nP(this.serializer,e),r=function(i){if(!("targetChange"in i))return we.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?we.min():a.readTime?nr(a.readTime):we.min()}(e);return this.listener.d_(n,r)}A_(e){const n={};n.database=Wh(this.serializer),n.addTarget=function(i,a){let l;const u=a.target;if(l=Vh(u)?{documents:iP(i,u)}:{query:aP(i,u)._t},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=d_(i,a.resumeToken);const d=Uh(i,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(we.min())>0){l.readTime=Oc(i,a.snapshotVersion.toTimestamp());const d=Uh(i,a.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=lP(this.serializer,e);r&&(n.labels=r),this.a_(n)}R_(e){const n={};n.database=Wh(this.serializer),n.removeTarget=e,this.a_(n)}}class qP extends __{constructor(e,n,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,n){return this.connection.Bo("Write",e,n)}E_(e){return Fe(!!e.streamToken),this.lastStreamToken=e.streamToken,Fe(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Fe(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const n=sP(e.writeResults,e.commitTime),r=nr(e.commitTime);return this.listener.g_(r,n)}p_(){const e={};e.database=Wh(this.serializer),this.a_(e)}m_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>rP(this.serializer,r))};this.a_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HP extends class{}{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new ie(q.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,n,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Mo(e,Bh(n,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ie(q.UNKNOWN,i.toString())})}Lo(e,n,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Lo(e,Bh(n,r),s,a,l,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new ie(q.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class GP{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Cr(n),this.D_=!1):oe("OnlineStateTracker",n)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(a=>{r.enqueueAndForget(async()=>{ri(this)&&(oe("RemoteStore","Restarting streams for network reachability change."),await async function(u){const d=xe(u);d.L_.add(4),await zo(d),d.q_.set("Unknown"),d.L_.delete(4),await vu(d)}(this))})}),this.q_=new GP(r,s)}}async function vu(t){if(ri(t))for(const e of t.B_)await e(!0)}async function zo(t){for(const e of t.B_)await e(!1)}function b_(t,e){const n=xe(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),Em(n)?bm(n):aa(n).r_()&&_m(n,e))}function xm(t,e){const n=xe(t),r=aa(n);n.N_.delete(e),r.r_()&&E_(n,e),n.N_.size===0&&(r.r_()?r.o_():ri(n)&&n.q_.set("Unknown"))}function _m(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(we.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}aa(t).A_(e)}function E_(t,e){t.Q_.xe(e),aa(t).R_(e)}function bm(t){t.Q_=new QN({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),aa(t).start(),t.q_.v_()}function Em(t){return ri(t)&&!aa(t).n_()&&t.N_.size>0}function ri(t){return xe(t).L_.size===0}function T_(t){t.Q_=void 0}async function QP(t){t.q_.set("Online")}async function YP(t){t.N_.forEach((e,n)=>{_m(t,e)})}async function XP(t,e){T_(t),Em(t)?(t.q_.M_(e),bm(t)):t.q_.set("Unknown")}async function JP(t,e,n){if(t.q_.set("Online"),e instanceof u_&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const l of i.targetIds)s.N_.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.N_.delete(l),s.Q_.removeTarget(l))}(t,e)}catch(r){oe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Vc(t,r)}else if(e instanceof Xl?t.Q_.Ke(e):e instanceof c_?t.Q_.He(e):t.Q_.We(e),!n.isEqual(we.min()))try{const r=await w_(t.localStore);n.compareTo(r)>=0&&await function(i,a){const l=i.Q_.rt(a);return l.targetChanges.forEach((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const f=i.N_.get(d);f&&i.N_.set(d,f.withResumeToken(u.resumeToken,a))}}),l.targetMismatches.forEach((u,d)=>{const f=i.N_.get(u);if(!f)return;i.N_.set(u,f.withResumeToken(jt.EMPTY_BYTE_STRING,f.snapshotVersion)),E_(i,u);const m=new Jr(f.target,u,d,f.sequenceNumber);_m(i,m)}),i.remoteSyncer.applyRemoteEvent(l)}(t,n)}catch(r){oe("RemoteStore","Failed to raise snapshot:",r),await Vc(t,r)}}async function Vc(t,e,n){if(!Fo(e))throw e;t.L_.add(1),await zo(t),t.q_.set("Offline"),n||(n=()=>w_(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{oe("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await vu(t)})}function C_(t,e){return e().catch(n=>Vc(t,n,e))}async function wu(t){const e=xe(t),n=gs(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;ZP(e);)try{const s=await LP(e.localStore,r);if(s===null){e.O_.length===0&&n.o_();break}r=s.batchId,eA(e,s)}catch(s){await Vc(e,s)}S_(e)&&k_(e)}function ZP(t){return ri(t)&&t.O_.length<10}function eA(t,e){t.O_.push(e);const n=gs(t);n.r_()&&n.V_&&n.m_(e.mutations)}function S_(t){return ri(t)&&!gs(t).n_()&&t.O_.length>0}function k_(t){gs(t).start()}async function tA(t){gs(t).p_()}async function nA(t){const e=gs(t);for(const n of t.O_)e.m_(n.mutations)}async function rA(t,e,n){const r=t.O_.shift(),s=mm.from(r,e,n);await C_(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await wu(t)}async function sA(t,e){e&&gs(t).V_&&await async function(r,s){if(function(a){return HN(a)&&a!==q.ABORTED}(s.code)){const i=r.O_.shift();gs(r).s_(),await C_(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await wu(r)}}(t,e),S_(t)&&k_(t)}async function Xy(t,e){const n=xe(t);n.asyncQueue.verifyOperationInProgress(),oe("RemoteStore","RemoteStore received new credentials");const r=ri(n);n.L_.add(3),await zo(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await vu(n)}async function iA(t,e){const n=xe(t);e?(n.L_.delete(2),await vu(n)):e||(n.L_.add(2),await zo(n),n.q_.set("Unknown"))}function aa(t){return t.K_||(t.K_=function(n,r,s){const i=xe(n);return i.w_(),new WP(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:QP.bind(null,t),Ro:YP.bind(null,t),mo:XP.bind(null,t),d_:JP.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),Em(t)?bm(t):t.q_.set("Unknown")):(await t.K_.stop(),T_(t))})),t.K_}function gs(t){return t.U_||(t.U_=function(n,r,s){const i=xe(n);return i.w_(),new qP(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:tA.bind(null,t),mo:sA.bind(null,t),f_:nA.bind(null,t),g_:rA.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await wu(t)):(await t.U_.stop(),t.O_.length>0&&(oe("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tm{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new vr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const a=Date.now()+r,l=new Tm(e,n,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ie(q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Cm(t,e){if(Cr("AsyncQueue",`${e}: ${t}`),Fo(t))return new ie(q.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Li{constructor(e){this.comparator=e?(n,r)=>e(n,r)||ce.comparator(n.key,r.key):(n,r)=>ce.comparator(n.key,r.key),this.keyedMap=ja(),this.sortedSet=new nt(this.comparator)}static emptySet(e){return new Li(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Li)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Li;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jy{constructor(){this.W_=new nt(ce.comparator)}track(e){const n=e.doc.key,r=this.W_.get(n);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(n,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(n):e.type===1&&r.type===2?this.W_=this.W_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):ye():this.W_=this.W_.insert(n,e)}G_(){const e=[];return this.W_.inorderTraversal((n,r)=>{e.push(r)}),e}}class Yi{constructor(e,n,r,s,i,a,l,u,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,i){const a=[];return n.forEach(l=>{a.push({type:0,doc:l})}),new Yi(e,n,Li.emptySet(n),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aA{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class oA{constructor(){this.queries=Zy(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(n,r){const s=xe(n),i=s.queries;s.queries=Zy(),i.forEach((a,l)=>{for(const u of l.j_)u.onError(r)})})(this,new ie(q.ABORTED,"Firestore shutting down"))}}function Zy(){return new ia(t=>Yx(t),hu)}async function Sm(t,e){const n=xe(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new aA,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await n.onListen(s,!0);break;case 1:i.z_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(a){const l=Cm(a,`Initialization of query '${di(e.query)}' failed`);return void e.onError(l)}n.queries.set(s,i),i.j_.push(e),e.Z_(n.onlineState),i.z_&&e.X_(i.z_)&&Im(n)}async function km(t,e){const n=xe(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const a=i.j_.indexOf(e);a>=0&&(i.j_.splice(a,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function lA(t,e){const n=xe(t);let r=!1;for(const s of e){const i=s.query,a=n.queries.get(i);if(a){for(const l of a.j_)l.X_(s)&&(r=!0);a.z_=s}}r&&Im(n)}function cA(t,e,n){const r=xe(t),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(n);r.queries.delete(e)}function Im(t){t.Y_.forEach(e=>{e.next()})}var Hh,ev;(ev=Hh||(Hh={})).ea="default",ev.Cache="cache";class Nm{constructor(e,n,r){this.query=e,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Yi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.na?this.ia(e)&&(this.ta.next(e),n=!0):this.sa(e,this.onlineState)&&(this.oa(e),n=!0),this.ra=e,n}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let n=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),n=!0),n}sa(e,n){if(!e.fromCache||!this.J_())return!0;const r=n!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const n=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}oa(e){e=Yi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Hh.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I_{constructor(e){this.key=e}}class N_{constructor(e){this.key=e}}class uA{constructor(e,n){this.query=e,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Se(),this.mutatedKeys=Se(),this.Aa=Xx(e),this.Ra=new Li(this.Aa)}get Va(){return this.Ta}ma(e,n){const r=n?n.fa:new Jy,s=n?n.Ra:this.Ra;let i=n?n.mutatedKeys:this.mutatedKeys,a=s,l=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((f,m)=>{const g=s.get(f),b=fu(this.query,m)?m:null,S=!!g&&this.mutatedKeys.has(g.key),E=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let k=!1;g&&b?g.data.isEqual(b.data)?S!==E&&(r.track({type:3,doc:b}),k=!0):this.ga(g,b)||(r.track({type:2,doc:b}),k=!0,(u&&this.Aa(b,u)>0||d&&this.Aa(b,d)<0)&&(l=!0)):!g&&b?(r.track({type:0,doc:b}),k=!0):g&&!b&&(r.track({type:1,doc:g}),k=!0,(u||d)&&(l=!0)),k&&(b?(a=a.add(b),i=E?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{Ra:a,fa:r,ns:l,mutatedKeys:i}}ga(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((f,m)=>function(b,S){const E=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ye()}};return E(b)-E(S)}(f.type,m.type)||this.Aa(f.doc,m.doc)),this.pa(r),s=s!=null&&s;const l=n&&!s?this.ya():[],u=this.da.size===0&&this.current&&!s?1:0,d=u!==this.Ea;return this.Ea=u,a.length!==0||d?{snapshot:new Yi(this.query,e.Ra,i,a,e.mutatedKeys,u===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Jy,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(n=>this.Ta=this.Ta.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ta=this.Ta.delete(n)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Se(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const n=[];return e.forEach(r=>{this.da.has(r)||n.push(new N_(r))}),this.da.forEach(r=>{e.has(r)||n.push(new I_(r))}),n}ba(e){this.Ta=e.Ts,this.da=Se();const n=this.ma(e.documents);return this.applyChanges(n,!0)}Da(){return Yi.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class dA{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class hA{constructor(e){this.key=e,this.va=!1}}class fA{constructor(e,n,r,s,i,a){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new ia(l=>Yx(l),hu),this.Ma=new Map,this.xa=new Set,this.Oa=new nt(ce.comparator),this.Na=new Map,this.La=new ym,this.Ba={},this.ka=new Map,this.qa=Qi.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function mA(t,e,n=!0){const r=M_(t);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await P_(r,e,n,!0),s}async function pA(t,e){const n=M_(t);await P_(n,e,!0,!1)}async function P_(t,e,n,r){const s=await OP(t.localStore,tr(e)),i=s.targetId,a=t.sharedClientState.addLocalQueryTarget(i,n);let l;return r&&(l=await gA(t,e,i,a==="current",s.resumeToken)),t.isPrimaryClient&&n&&b_(t.remoteStore,s),l}async function gA(t,e,n,r,s){t.Ka=(m,g,b)=>async function(E,k,_,x){let N=k.view.ma(_);N.ns&&(N=await Ky(E.localStore,k.query,!1).then(({documents:v})=>k.view.ma(v,N)));const M=x&&x.targetChanges.get(k.targetId),D=x&&x.targetMismatches.get(k.targetId)!=null,U=k.view.applyChanges(N,E.isPrimaryClient,M,D);return nv(E,k.targetId,U.wa),U.snapshot}(t,m,g,b);const i=await Ky(t.localStore,e,!0),a=new uA(e,i.Ts),l=a.ma(i.documents),u=Bo.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=a.applyChanges(l,t.isPrimaryClient,u);nv(t,n,d.wa);const f=new dA(e,n,a);return t.Fa.set(e,f),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),d.snapshot}async function yA(t,e,n){const r=xe(t),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(a=>!hu(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await qh(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&xm(r.remoteStore,s.targetId),Gh(r,s.targetId)}).catch(Vo)):(Gh(r,s.targetId),await qh(r.localStore,s.targetId,!0))}async function vA(t,e){const n=xe(t),r=n.Fa.get(e),s=n.Ma.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),xm(n.remoteStore,r.targetId))}async function wA(t,e,n){const r=SA(t);try{const s=await function(a,l){const u=xe(a),d=wt.now(),f=l.reduce((b,S)=>b.add(S.key),Se());let m,g;return u.persistence.runTransaction("Locally write mutations","readwrite",b=>{let S=Sr(),E=Se();return u.cs.getEntries(b,f).next(k=>{S=k,S.forEach((_,x)=>{x.isValidDocument()||(E=E.add(_))})}).next(()=>u.localDocuments.getOverlayedDocuments(b,S)).next(k=>{m=k;const _=[];for(const x of l){const N=UN(x,m.get(x.key).overlayedDocument);N!=null&&_.push(new Es(x.key,N,Bx(N.value.mapValue),Vn.exists(!0)))}return u.mutationQueue.addMutationBatch(b,d,_,l)}).next(k=>{g=k;const _=k.applyToLocalDocumentSet(m,E);return u.documentOverlayCache.saveOverlays(b,k.batchId,_)})}).then(()=>({batchId:g.batchId,changes:Zx(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,l,u){let d=a.Ba[a.currentUser.toKey()];d||(d=new nt(Le)),d=d.insert(l,u),a.Ba[a.currentUser.toKey()]=d}(r,s.batchId,n),await Wo(r,s.changes),await wu(r.remoteStore)}catch(s){const i=Cm(s,"Failed to persist write");n.reject(i)}}async function A_(t,e){const n=xe(t);try{const r=await DP(n.localStore,e);e.targetChanges.forEach((s,i)=>{const a=n.Na.get(i);a&&(Fe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.va=!0:s.modifiedDocuments.size>0?Fe(a.va):s.removedDocuments.size>0&&(Fe(a.va),a.va=!1))}),await Wo(n,r,e)}catch(r){await Vo(r)}}function tv(t,e,n){const r=xe(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Fa.forEach((i,a)=>{const l=a.view.Z_(e);l.snapshot&&s.push(l.snapshot)}),function(a,l){const u=xe(a);u.onlineState=l;let d=!1;u.queries.forEach((f,m)=>{for(const g of m.j_)g.Z_(l)&&(d=!0)}),d&&Im(u)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function xA(t,e,n){const r=xe(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Na.get(e),i=s&&s.key;if(i){let a=new nt(ce.comparator);a=a.insert(i,qt.newNoDocument(i,we.min()));const l=Se().add(i),u=new gu(we.min(),new Map,new nt(Le),a,l);await A_(r,u),r.Oa=r.Oa.remove(i),r.Na.delete(e),Pm(r)}else await qh(r.localStore,e,!1).then(()=>Gh(r,e,n)).catch(Vo)}async function _A(t,e){const n=xe(t),r=e.batch.batchId;try{const s=await jP(n.localStore,e);j_(n,r,null),R_(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Wo(n,s)}catch(s){await Vo(s)}}async function bA(t,e,n){const r=xe(t);try{const s=await function(a,l){const u=xe(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return u.mutationQueue.lookupMutationBatch(d,l).next(m=>(Fe(m!==null),f=m.keys(),u.mutationQueue.removeMutationBatch(d,m))).next(()=>u.mutationQueue.performConsistencyCheck(d)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(d,f,l)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>u.localDocuments.getDocuments(d,f))})}(r.localStore,e);j_(r,e,n),R_(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Wo(r,s)}catch(s){await Vo(s)}}function R_(t,e){(t.ka.get(e)||[]).forEach(n=>{n.resolve()}),t.ka.delete(e)}function j_(t,e,n){const r=xe(t);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Gh(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||D_(t,r)})}function D_(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);n!==null&&(xm(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),Pm(t))}function nv(t,e,n){for(const r of n)r instanceof I_?(t.La.addReference(r.key,e),EA(t,r)):r instanceof N_?(oe("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||D_(t,r.key)):ye()}function EA(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(oe("SyncEngine","New document in limbo: "+n),t.xa.add(r),Pm(t))}function Pm(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new ce(Ye.fromString(e)),r=t.qa.next();t.Na.set(r,new hA(n)),t.Oa=t.Oa.insert(n,r),b_(t.remoteStore,new Jr(tr(du(n.path)),r,"TargetPurposeLimboResolution",am.oe))}}async function Wo(t,e,n){const r=xe(t),s=[],i=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((l,u)=>{a.push(r.Ka(u,e,n).then(d=>{var f;if((d||n)&&r.isPrimaryClient){const m=d?!d.fromCache:(f=n==null?void 0:n.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(u.targetId,m?"current":"not-current")}if(d){s.push(d);const m=wm.Wi(u.targetId,d);i.push(m)}}))}),await Promise.all(a),r.Ca.d_(s),await async function(u,d){const f=xe(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>G.forEach(d,g=>G.forEach(g.$i,b=>f.persistence.referenceDelegate.addReference(m,g.targetId,b)).next(()=>G.forEach(g.Ui,b=>f.persistence.referenceDelegate.removeReference(m,g.targetId,b)))))}catch(m){if(!Fo(m))throw m;oe("LocalStore","Failed to update sequence numbers: "+m)}for(const m of d){const g=m.targetId;if(!m.fromCache){const b=f.os.get(g),S=b.snapshotVersion,E=b.withLastLimboFreeSnapshotVersion(S);f.os=f.os.insert(g,E)}}}(r.localStore,i))}async function TA(t,e){const n=xe(t);if(!n.currentUser.isEqual(e)){oe("SyncEngine","User change. New user:",e.toKey());const r=await v_(n.localStore,e);n.currentUser=e,function(i,a){i.ka.forEach(l=>{l.forEach(u=>{u.reject(new ie(q.CANCELLED,a))})}),i.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Wo(n,r.hs)}}function CA(t,e){const n=xe(t),r=n.Na.get(e);if(r&&r.va)return Se().add(r.key);{let s=Se();const i=n.Ma.get(e);if(!i)return s;for(const a of i){const l=n.Fa.get(a);s=s.unionWith(l.view.Va)}return s}}function M_(t){const e=xe(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=A_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=CA.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xA.bind(null,e),e.Ca.d_=lA.bind(null,e.eventManager),e.Ca.$a=cA.bind(null,e.eventManager),e}function SA(t){const e=xe(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=_A.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=bA.bind(null,e),e}class Fc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=yu(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,n){return null}Ha(e,n){return null}za(e){return RP(this.persistence,new PP,e.initialUser,this.serializer)}Ga(e){return new kP(vm.Zr,this.serializer)}Wa(e){return new FP}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Fc.provider={build:()=>new Fc};class Kh{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>tv(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=TA.bind(null,this.syncEngine),await iA(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new oA}()}createDatastore(e){const n=yu(e.databaseInfo.databaseId),r=function(i){return new zP(i)}(e.databaseInfo);return function(i,a,l,u){return new HP(i,a,l,u)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,a,l){return new KP(r,s,i,a,l)}(this.localStore,this.datastore,e.asyncQueue,n=>tv(this.syncEngine,n,0),function(){return Yy.D()?new Yy:new $P}())}createSyncEngine(e,n){return function(s,i,a,l,u,d,f){const m=new fA(s,i,a,l,u,d);return f&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=xe(s);oe("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await zo(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}Kh.provider={build:()=>new Kh};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Am{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Cr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kA{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=zt.UNAUTHENTICATED,this.clientId=Fx.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{oe("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(oe("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new vr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Cm(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Td(t,e){t.asyncQueue.verifyOperationInProgress(),oe("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await v_(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function rv(t,e){t.asyncQueue.verifyOperationInProgress();const n=await IA(t);oe("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>Xy(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>Xy(e.remoteStore,s)),t._onlineComponents=e}async function IA(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){oe("FirestoreClient","Using user provided OfflineComponentProvider");try{await Td(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===q.FAILED_PRECONDITION||s.code===q.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;qi("Error using user provided cache. Falling back to memory cache: "+n),await Td(t,new Fc)}}else oe("FirestoreClient","Using default OfflineComponentProvider"),await Td(t,new Fc);return t._offlineComponents}async function L_(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(oe("FirestoreClient","Using user provided OnlineComponentProvider"),await rv(t,t._uninitializedComponentsProvider._online)):(oe("FirestoreClient","Using default OnlineComponentProvider"),await rv(t,new Kh))),t._onlineComponents}function NA(t){return L_(t).then(e=>e.syncEngine)}async function $c(t){const e=await L_(t),n=e.eventManager;return n.onListen=mA.bind(null,e.syncEngine),n.onUnlisten=yA.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=pA.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=vA.bind(null,e.syncEngine),n}function PA(t,e,n={}){const r=new vr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,l,u,d){const f=new Am({next:g=>{f.Za(),a.enqueueAndForget(()=>km(i,m));const b=g.docs.has(l);!b&&g.fromCache?d.reject(new ie(q.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&g.fromCache&&u&&u.source==="server"?d.reject(new ie(q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(g)},error:g=>d.reject(g)}),m=new Nm(du(l.path),f,{includeMetadataChanges:!0,_a:!0});return Sm(i,m)}(await $c(t),t.asyncQueue,e,n,r)),r.promise}function AA(t,e,n={}){const r=new vr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,l,u,d){const f=new Am({next:g=>{f.Za(),a.enqueueAndForget(()=>km(i,m)),g.fromCache&&u.source==="server"?d.reject(new ie(q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(g)},error:g=>d.reject(g)}),m=new Nm(l,f,{includeMetadataChanges:!0,_a:!0});return Sm(i,m)}(await $c(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O_(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sv=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V_(t,e,n){if(!n)throw new ie(q.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function RA(t,e,n,r){if(e===!0&&r===!0)throw new ie(q.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function iv(t){if(!ce.isDocumentKey(t))throw new ie(q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function av(t){if(ce.isDocumentKey(t))throw new ie(q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function xu(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ye()}function Tn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ie(q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=xu(t);throw new ie(q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ov{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new ie(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ie(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}RA("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=O_((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ie(q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ie(q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ie(q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class _u{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ov({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ie(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ie(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ov(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new QI;switch(r.type){case"firstParty":return new ZI(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ie(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=sv.get(n);r&&(oe("ComponentProvider","Removing Datastore"),sv.delete(n),r.terminate())}(this),Promise.resolve()}}function jA(t,e,n,r={}){var s;const i=(t=Tn(t,_u))._getSettings(),a=`${e}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==a&&qi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:a,ssl:!1})),r.mockUserToken){let l,u;if(typeof r.mockUserToken=="string")l=r.mockUserToken,u=zt.MOCK_USER;else{l=oC(r.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new ie(q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new zt(d)}t._authCredentials=new YI(new Vx(l,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class si{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new si(this.firestore,e,this._query)}}class Zt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ds(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Zt(this.firestore,e,this._key)}}class ds extends si{constructor(e,n,r){super(e,n,du(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Zt(this.firestore,null,new ce(e))}withConverter(e){return new ds(this.firestore,e,this._path)}}function Dt(t,e,...n){if(t=pt(t),V_("collection","path",e),t instanceof _u){const r=Ye.fromString(e,...n);return av(r),new ds(t,null,r)}{if(!(t instanceof Zt||t instanceof ds))throw new ie(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ye.fromString(e,...n));return av(r),new ds(t.firestore,null,r)}}function Mt(t,e,...n){if(t=pt(t),arguments.length===1&&(e=Fx.newId()),V_("doc","path",e),t instanceof _u){const r=Ye.fromString(e,...n);return iv(r),new Zt(t,null,new ce(r))}{if(!(t instanceof Zt||t instanceof ds))throw new ie(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ye.fromString(e,...n));return iv(r),new Zt(t.firestore,t instanceof ds?t.converter:null,new ce(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new x_(this,"async_queue_retry"),this.Vu=()=>{const r=Ed();r&&oe("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const n=Ed();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const n=Ed();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const n=new vr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Fo(e))throw e;oe("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const n=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(a){let l=a.message||"";return a.stack&&(l=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),l}(r);throw Cr("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=n,n}enqueueAfterDelay(e,n,r){this.fu(),this.Ru.indexOf(e)>-1&&(n=0);const s=Tm.createAndSchedule(this,e,n,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&ye()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const n of this.Tu)if(n.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Tu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const n=this.Tu.indexOf(e);this.Tu.splice(n,1)}}function cv(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class ys extends _u{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new lv,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new lv(e),this._firestoreClient=void 0,await e}}}function DA(t,e){const n=typeof t=="object"?t:Kw(),r=typeof t=="string"?t:e||"(default)",s=Qf(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=iC("firestore");i&&jA(s,...i)}return s}function bu(t){if(t._terminated)throw new ie(q.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||MA(t),t._firestoreClient}function MA(t){var e,n,r;const s=t._freezeSettings(),i=function(l,u,d,f){return new hN(l,u,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,O_(f.experimentalLongPollingOptions),f.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new kA(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(l){const u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Xi(jt.fromBase64String(e))}catch(n){throw new ie(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Xi(jt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new ie(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Nt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tu{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new ie(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new ie(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Le(this._lat,e._lat)||Le(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LA=/^__.*__$/;class OA{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Es(e,this.data,this.fieldMask,n,this.fieldTransforms):new Uo(e,this.data,n,this.fieldTransforms)}}class F_{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Es(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function $_(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ye()}}class Dm{constructor(e,n,r,s,i,a){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Dm(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Uc(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if($_(this.Cu)&&LA.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class VA{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||yu(e)}Qu(e,n,r,s=!1){return new Dm({Cu:e,methodName:n,qu:r,path:Nt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Mm(t){const e=t._freezeSettings(),n=yu(t._databaseId);return new VA(t._databaseId,!!e.ignoreUndefinedProperties,n)}function FA(t,e,n,r,s,i={}){const a=t.Qu(i.merge||i.mergeFields?2:0,e,n,s);Om("Data must be an object, but it was:",a,r);const l=U_(r,a);let u,d;if(i.merge)u=new fn(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const m of i.mergeFields){const g=Qh(e,m,n);if(!a.contains(g))throw new ie(q.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);z_(f,g)||f.push(g)}u=new fn(f),d=a.fieldTransforms.filter(m=>u.covers(m.field))}else u=null,d=a.fieldTransforms;return new OA(new rn(l),u,d)}class Cu extends Tu{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Cu}}class Lm extends Tu{_toFieldTransform(e){return new ON(e.path,new Eo)}isEqual(e){return e instanceof Lm}}function $A(t,e,n,r){const s=t.Qu(1,e,n);Om("Data must be an object, but it was:",s,r);const i=[],a=rn.empty();ni(r,(u,d)=>{const f=Vm(e,u,n);d=pt(d);const m=s.Nu(f);if(d instanceof Cu)i.push(f);else{const g=qo(d,m);g!=null&&(i.push(f),a.set(f,g))}});const l=new fn(i);return new F_(a,l,s.fieldTransforms)}function UA(t,e,n,r,s,i){const a=t.Qu(1,e,n),l=[Qh(e,r,n)],u=[s];if(i.length%2!=0)throw new ie(q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)l.push(Qh(e,i[g])),u.push(i[g+1]);const d=[],f=rn.empty();for(let g=l.length-1;g>=0;--g)if(!z_(d,l[g])){const b=l[g];let S=u[g];S=pt(S);const E=a.Nu(b);if(S instanceof Cu)d.push(b);else{const k=qo(S,E);k!=null&&(d.push(b),f.set(b,k))}}const m=new fn(d);return new F_(f,m,a.fieldTransforms)}function BA(t,e,n,r=!1){return qo(n,t.Qu(r?4:3,e))}function qo(t,e){if(B_(t=pt(t)))return Om("Unsupported field value:",e,t),U_(t,e);if(t instanceof Tu)return function(r,s){if(!$_(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let a=0;for(const l of r){let u=qo(l,s.Lu(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=pt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return DN(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=wt.fromDate(r);return{timestampValue:Oc(s.serializer,i)}}if(r instanceof wt){const i=new wt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Oc(s.serializer,i)}}if(r instanceof Rm)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Xi)return{bytesValue:d_(s.serializer,r._byteString)};if(r instanceof Zt){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:gm(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof jm)return function(a,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(u=>{if(typeof u!="number")throw l.Bu("VectorValues must only contain numeric values.");return hm(l.serializer,u)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${xu(r)}`)}(t,e)}function U_(t,e){const n={};return $x(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ni(t,(r,s)=>{const i=qo(s,e.Mu(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function B_(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof wt||t instanceof Rm||t instanceof Xi||t instanceof Zt||t instanceof Tu||t instanceof jm)}function Om(t,e,n){if(!B_(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const r=xu(n);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function Qh(t,e,n){if((e=pt(e))instanceof Eu)return e._internalPath;if(typeof e=="string")return Vm(t,e);throw Uc("Field path arguments must be of type string or ",t,!1,void 0,n)}const zA=new RegExp("[~\\*/\\[\\]]");function Vm(t,e,n){if(e.search(zA)>=0)throw Uc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Eu(...e.split("."))._internalPath}catch{throw Uc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Uc(t,e,n,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new ie(q.INVALID_ARGUMENT,l+t+u)}function z_(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W_{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Zt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new WA(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Fm("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class WA extends W_{data(){return super.data()}}function Fm(t,e){return typeof e=="string"?Vm(t,e):e instanceof Eu?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q_(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new ie(q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class $m{}class qA extends $m{}function gn(t,e,...n){let r=[];e instanceof $m&&r.push(e),r=r.concat(n),function(i){const a=i.filter(u=>u instanceof Um).length,l=i.filter(u=>u instanceof Su).length;if(a>1||a>0&&l>0)throw new ie(q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Su extends qA{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Su(e,n,r)}_apply(e){const n=this._parse(e);return H_(e._query,n),new si(e.firestore,e.converter,Fh(e._query,n))}_parse(e){const n=Mm(e.firestore);return function(i,a,l,u,d,f,m){let g;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new ie(q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){dv(m,f);const b=[];for(const S of m)b.push(uv(u,i,S));g={arrayValue:{values:b}}}else g=uv(u,i,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||dv(m,f),g=BA(l,a,m,f==="in"||f==="not-in");return ft.create(d,f,g)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function Qt(t,e,n){const r=e,s=Fm("where",t);return Su._create(s,r,n)}class Um extends $m{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Um(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Un.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let a=s;const l=i.getFlattenedFilters();for(const u of l)H_(a,u),a=Fh(a,u)}(e._query,n),new si(e.firestore,e.converter,Fh(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function uv(t,e,n){if(typeof(n=pt(n))=="string"){if(n==="")throw new ie(q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Qx(e)&&n.indexOf("/")!==-1)throw new ie(q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ye.fromString(n));if(!ce.isDocumentKey(r))throw new ie(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ay(t,new ce(r))}if(n instanceof Zt)return Ay(t,n._key);throw new ie(q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${xu(n)}.`)}function dv(t,e){if(!Array.isArray(t)||t.length===0)throw new ie(q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function H_(t,e){const n=function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new ie(q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ie(q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class HA{convertValue(e,n="none"){switch(Ys(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ot(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Qs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw ye()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return ni(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var n,r,s;const i=(s=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(a=>ot(a.doubleValue));return new jm(i)}convertGeoPoint(e){return new Rm(ot(e.latitude),ot(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=lm(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(xo(e));default:return null}}convertTimestamp(e){const n=ps(e);return new wt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ye.fromString(e);Fe(y_(r));const s=new _o(r.get(1),r.get(3)),i=new ce(r.popFirst(5));return s.isEqual(n)||Cr(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GA(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class G_ extends W_{constructor(e,n,r,s,i,a){super(e,n,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Jl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Fm("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class Jl extends G_{data(e={}){return super.data(e)}}class K_{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Ma(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Jl(this._firestore,this._userDataWriter,r.key,r,new Ma(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new ie(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(l=>{const u=new Jl(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Ma(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const u=new Jl(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Ma(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:KA(l.type),doc:u,oldIndex:d,newIndex:f}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function KA(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ye()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ii(t){t=Tn(t,Zt);const e=Tn(t.firestore,ys);return PA(bu(e),t._key).then(n=>Q_(e,t,n))}class Bm extends HA{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xi(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Zt(this.firestore,null,n)}}function Bn(t){t=Tn(t,si);const e=Tn(t.firestore,ys),n=bu(e),r=new Bm(e);return q_(t._query),AA(n,t._query).then(s=>new K_(e,r,t,s))}function kn(t,e,n,...r){t=Tn(t,Zt);const s=Tn(t.firestore,ys),i=Mm(s);let a;return a=typeof(e=pt(e))=="string"||e instanceof Eu?UA(i,"updateDoc",t._key,e,n,r):$A(i,"updateDoc",t._key,e),Wm(s,[a.toMutation(t._key,Vn.exists(!0))])}function Cd(t){return Wm(Tn(t.firestore,ys),[new fm(t._key,Vn.none())])}function ku(t,e){const n=Tn(t.firestore,ys),r=Mt(t),s=GA(t.converter,e);return Wm(n,[FA(Mm(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,Vn.exists(!1))]).then(()=>r)}function zm(t,...e){var n,r,s;t=pt(t);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||cv(e[a])||(i=e[a],a++);const l={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(cv(e[a])){const m=e[a];e[a]=(n=m.next)===null||n===void 0?void 0:n.bind(m),e[a+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[a+2]=(s=m.complete)===null||s===void 0?void 0:s.bind(m)}let u,d,f;if(t instanceof Zt)d=Tn(t.firestore,ys),f=du(t._key.path),u={next:m=>{e[a]&&e[a](Q_(d,t,m))},error:e[a+1],complete:e[a+2]};else{const m=Tn(t,si);d=Tn(m.firestore,ys),f=m._query;const g=new Bm(d);u={next:b=>{e[a]&&e[a](new K_(d,g,m,b))},error:e[a+1],complete:e[a+2]},q_(t._query)}return function(g,b,S,E){const k=new Am(E),_=new Nm(b,k,S);return g.asyncQueue.enqueueAndForget(async()=>Sm(await $c(g),_)),()=>{k.Za(),g.asyncQueue.enqueueAndForget(async()=>km(await $c(g),_))}}(bu(d),f,l,u)}function Wm(t,e){return function(r,s){const i=new vr;return r.asyncQueue.enqueueAndForget(async()=>wA(await NA(r),s,i)),i.promise}(bu(t),e)}function Q_(t,e,n){const r=n.docs.get(e._key),s=new Bm(t);return new G_(t,s,e._key,r,new Ma(n.hasPendingWrites,n.fromCache),e.converter)}function ct(){return new Lm("serverTimestamp")}(function(e,n=!0){(function(s){sa=s})(na),Wi(new qs("firestore",(r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new ys(new XI(r.getProvider("auth-internal")),new tN(r.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new ie(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _o(d.options.projectId,f)}(a,s),a);return i=Object.assign({useFetchStreams:n},i),l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),us(Sy,"4.7.3",e),us(Sy,"4.7.3","esm2017")})();const QA={apiKey:"AIzaSyB_1Dn63ZHRnA-jXytu95WEBWNFQ64Jo_E",authDomain:"dnd-v1-17acc.firebaseapp.com",projectId:"dnd-v1-17acc",storageBucket:"dnd-v1-17acc.firebasestorage.app",messagingSenderId:"976056329393",appId:"1:976056329393:web:7c8170e906162fe4ef2e90"},Y_=Gw(QA),vs=qI(Y_),je=DA(Y_),YA=async(t,e)=>{try{const n={...e,userId:t,createdAt:ct(),updatedAt:ct()};return{id:(await ku(Dt(je,"userProfiles"),n)).id,...n}}catch(n){throw console.error("Error creating user profile:",n),n}},Ho=async t=>{try{const e=gn(Dt(je,"userProfiles"),Qt("userId","==",t)),n=await Bn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting user profile:",e),e}},XA=async t=>{try{if(!t||t.length===0)return[];const e=[];for(let s=0;s<t.length;s+=10){const i=t.slice(s,s+10),a=gn(Dt(je,"userProfiles"),Qt("userId","in",i));e.push(Bn(a))}const n=await Promise.all(e),r=[];return n.forEach(s=>{s.docs.forEach(i=>{r.push({id:i.id,...i.data()})})}),r}catch(e){throw console.error("Error getting user profiles:",e),e}},JA=async t=>{try{const e=gn(Dt(je,"userProfiles"),Qt("username","==",t));return(await Bn(e)).empty}catch(e){throw console.error("Error checking username availability:",e),e}},ZA=async(t,e,n)=>{try{const r={...n,userId:t,partyId:e,createdAt:ct(),updatedAt:ct()};return{id:(await ku(Dt(je,"characters"),r)).id,...r}}catch(r){throw console.error("Error saving character:",r),r}},X_=async(t,e)=>{try{const n=gn(Dt(je,"characters"),Qt("userId","==",t),Qt("partyId","==",e)),r=await Bn(n);if(r.empty)return null;const s=r.docs[0];return{id:s.id,...s.data()}}catch(n){throw console.error("Error getting character by user and party:",n),n}},qm=async t=>{try{const e=gn(Dt(je,"characters"),Qt("partyId","==",t));return(await Bn(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){throw console.error("Error getting party characters:",e),e}},eR=async(t,e)=>{try{const n=Mt(je,"characters",t);await kn(n,{...e,updatedAt:ct()})}catch(n){throw console.error("Error updating character:",n),n}},tR=async(t,e)=>{try{const n={...e,dmId:t,members:[t],createdAt:ct(),updatedAt:ct()};return{id:(await ku(Dt(je,"parties"),n)).id,...n}}catch(n){throw console.error("Error creating party:",n),n}},Hm=async t=>{try{const e=gn(Dt(je,"parties"),Qt("members","array-contains",t));return(await Bn(e)).docs.map(s=>{const i=s.data();return{id:s.id,...i}})}catch(e){throw e}},nR=async(t,e)=>{try{const n=Mt(je,"parties",t),r=await ii(n);if(!r.exists())throw new Error("Party not found");const s=r.data();if(s.members.includes(e))throw new Error("User already in party");await kn(n,{members:[...s.members,e],updatedAt:ct()})}catch(n){throw console.error("Error joining party:",n),n}},J_=async(t,e)=>{try{const n=Mt(je,"parties",t),r=await ii(n);if(!r.exists())throw new Error("Party not found");if(r.data().dmId!==e)throw new Error("Only the party leader can disband the party");await Cd(n);const i=gn(Dt(je,"characters"),Qt("partyId","==",t)),l=(await Bn(i)).docs.map(m=>Cd(m.ref));await Promise.all(l);const u=gn(Dt(je,"campaignStories"),Qt("partyId","==",t)),f=(await Bn(u)).docs.map(m=>Cd(m.ref));await Promise.all(f)}catch(n){throw console.error("Error disbanding party:",n),n}},rR=async t=>{try{const e=gn(Dt(je,"parties"),Qt("inviteCode","==",t)),n=await Bn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting party by invite code:",e),e}},Z_=async t=>{try{const e=Mt(je,"parties",t),n=await ii(e);return n.exists()?{id:n.id,...n.data()}:null}catch(e){throw console.error("Error getting party by ID:",e),e}},sR=async t=>{try{const e={partyId:t,status:"ready_up",currentPlot:null,storyMessages:[],votingSession:null,readyPlayers:[],lastUpdated:ct(),createdAt:ct()};return{id:(await ku(Dt(je,"campaignStories"),e)).id,...e}}catch(e){throw console.error("Error creating campaign story:",e),e}},iR=async t=>{try{const e=gn(Dt(je,"campaignStories"),Qt("partyId","==",t)),n=await Bn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting campaign story:",e),e}},$r=async(t,e)=>{try{const n=Mt(je,"campaignStories",t);await kn(n,{...e,lastUpdated:ct()})}catch(n){throw console.error("Error updating campaign story:",n),n}},Sd=async(t,e)=>{try{const n=Mt(je,"campaignStories",t),s=(await ii(n)).data(),i={id:`msg_${Date.now()}`,...e,timestamp:new Date};return await kn(n,{storyMessages:[...s.storyMessages,i],lastUpdated:ct()}),i}catch(n){throw console.error("Error adding story message:",n),n}},aR=async(t,e)=>{try{const n=Mt(je,"campaignStories",t),i=(await ii(n)).data().readyPlayers||[];i.includes(e)||await kn(n,{readyPlayers:[...i,e],lastUpdated:ct()})}catch(n){throw console.error("Error setting player ready:",n),n}},oR=(t,e)=>{try{const n=Mt(je,"campaignStories",t);return zm(n,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})}catch(n){throw console.error("Error subscribing to campaign story:",n),n}},hv=async(t,e)=>{try{const n=Mt(je,"campaignStories",t);await kn(n,{currentSpeaker:e,lastUpdated:ct()})}catch(n){throw console.error("Error setting current speaker:",n),n}},kd=async(t,e)=>{try{const n=Mt(je,"campaignStories",t);await kn(n,{currentController:e,lastUpdated:ct()})}catch(n){throw console.error("Error setting current controller:",n),n}},fv=async t=>{try{const e=gn(Dt(je,"combatSessions"),Qt("partyId","==",t),Qt("status","==","active")),n=await Bn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting combat session:",e),e}},Al=async(t,e)=>{try{const n=Mt(je,"combatSessions",t);await kn(n,{...e,updatedAt:ct()})}catch(n){throw console.error("Error updating combat session:",n),n}},eb=(t,e)=>{try{const n=gn(Dt(je,"combatSessions"),Qt("partyId","==",t),Qt("status","==","active"));return zm(n,r=>{if(r.empty)e(null);else{const s=r.docs[0];e({id:s.id,...s.data()})}})}catch(n){throw console.error("Error subscribing to combat session:",n),n}},lR=async(t,e)=>{try{console.log("saveCharacterPreset called with:",{userId:t,presetData:e});const n=await Ho(t);if(console.log("User profile retrieved:",n),!n)throw console.error("User profile not found for userId:",t),new Error("User profile not found");const r={id:Date.now().toString(),name:e.name,data:e.data,createdAt:new Date};console.log("Created preset object:",r);const s=n.characterPresets||[];console.log("Existing presets:",s);const i=[...s,r];console.log("Updated presets array:",i);const a=Mt(je,"userProfiles",n.id);return console.log("Updating profile with ID:",n.id),await kn(a,{characterPresets:i,updatedAt:ct()}),console.log("Profile updated successfully"),r}catch(n){throw console.error("Error saving character preset:",n),console.error("Error details:",{message:n.message,code:n.code,stack:n.stack}),n}},cR=async t=>{try{const e=await Ho(t);return e?e.characterPresets||[]:[]}catch(e){throw console.error("Error getting user character presets:",e),e}},uR=async(t,e)=>{try{const n=await Ho(t);if(!n)throw new Error("User profile not found");const s=(n.characterPresets||[]).filter(a=>a.id!==e),i=Mt(je,"userProfiles",n.id);await kn(i,{characterPresets:s,updatedAt:ct()})}catch(n){throw console.error("Error deleting character preset:",n),n}},dR=async t=>{try{const e=Mt(je,"campaignStories",t);return(await ii(e)).data().storyState||null}catch(e){throw console.error("Error getting story state:",e),e}},hR=async(t,e)=>{try{const n=Mt(je,"campaignStories",t),a={...(await ii(n)).data().storyState||{},...e,lastUpdated:ct()};return await kn(n,{storyState:a,lastUpdated:ct()}),a}catch(n){throw console.error("Error updating story state:",n),n}},fR=async(t,e)=>{try{const n=Mt(je,"combatSessions",t);await kn(n,{...e,updatedAt:ct()})}catch(n){throw console.error("Error updating combat session with narrative:",n),n}},mR=async(t,e,n)=>{try{if(console.log("Starting registration for:",t,n),!await JA(n))return console.log("Username not available:",n),{user:null,error:"Username is already taken. Please choose a different username."};console.log("Username available:",n);const s=await Nk(vs,t,e);console.log("User created successfully:",s.user.uid);try{await YA(s.user.uid,{username:n,email:t,displayName:n}),console.log("User profile created successfully")}catch(a){console.error("Error creating user profile:",a)}let i=!1;try{await Ak(s.user),console.log("Email verification sent successfully"),i=!0}catch(a){console.error("Error sending email verification:",a)}return await _x(vs),console.log("User signed out after registration"),{user:null,error:null,success:!0}}catch(r){return console.error("Registration error:",r),{user:null,error:r.message}}},pR=async(t,e)=>{try{return{user:(await Pk(vs,t,e)).user,error:null}}catch(n){return{user:null,error:n.message}}},gR=async()=>{try{return await _x(vs),{error:null}}catch(t){return{error:t.message}}},ai=t=>Dk(vs,async e=>{t(e)}),yR=async()=>{try{return console.log("Testing Firebase connection..."),console.log("Auth domain:",vs.config.authDomain),console.log("Project ID:",vs.config.projectId),{success:!0,message:"Firebase connection successful"}}catch(t){return console.error("Firebase connection test failed:",t),{success:!1,error:t.message}}};function vR(){const[t,e]=R.useState(null),[n,r]=R.useState(null),[s,i]=R.useState(!1),[a,l]=R.useState(!1),u=zn();R.useEffect(()=>{const m=ai(async g=>{if(e(g),g)try{const b=await Ho(g.uid);r(b)}catch(b){console.error("Error loading user profile:",b)}else r(null)});return()=>m()},[]);const d=async()=>{const{error:m}=await gR();m||(u("/"),l(!1),i(!1))},f=(n==null?void 0:n.username)||(t==null?void 0:t.email);return o.jsx("nav",{className:"bg-gray-900 text-gray-100 shadow-lg border-b border-gray-700",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx(Gn,{to:"/",className:"text-xl sm:text-2xl font-bold font-['Cinzel'] text-amber-400",children:"DND-V1"}),o.jsx("div",{className:"hidden md:flex items-center space-x-4",children:t?o.jsxs(o.Fragment,{children:[o.jsx(Gn,{to:"/dashboard",className:"fantasy-button",children:"Dashboard"}),o.jsx(Gn,{to:"/party-management",className:"fantasy-button",children:"Parties"}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{onClick:()=>i(!s),className:"fantasy-button bg-gray-700 hover:bg-gray-600",children:f}),s&&o.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-600 z-50",children:o.jsxs("div",{className:"py-2",children:[o.jsxs("div",{className:"px-4 py-2 text-sm text-gray-200 border-b border-gray-600",children:[o.jsx("div",{className:"font-medium",children:f}),o.jsx("div",{className:"text-xs text-gray-400",children:t.email})]}),o.jsx("button",{onClick:d,className:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-700",children:"Logout"})]})})]})]}):o.jsx(Gn,{to:"/login",className:"fantasy-button",children:"Login"})}),o.jsx("div",{className:"md:hidden",children:o.jsx("button",{onClick:()=>l(!a),className:"fantasy-button bg-gray-700 hover:bg-gray-600 p-2",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a?o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})})]}),a&&o.jsx("div",{className:"md:hidden mt-4 pb-4 border-t border-gray-700",children:t?o.jsxs("div",{className:"pt-4 space-y-3",children:[o.jsx(Gn,{to:"/dashboard",className:"fantasy-button block w-full text-center",onClick:()=>l(!1),children:"Dashboard"}),o.jsx(Gn,{to:"/party-management",className:"fantasy-button block w-full text-center",onClick:()=>l(!1),children:"Parties"}),o.jsxs("div",{className:"pt-3 border-t border-gray-700",children:[o.jsxs("div",{className:"px-4 py-2 text-sm text-gray-200",children:[o.jsx("div",{className:"font-medium",children:f}),o.jsx("div",{className:"text-xs text-gray-400",children:t.email})]}),o.jsx("button",{onClick:d,className:"w-full text-left px-4 py-3 text-sm text-gray-200 hover:bg-gray-700 rounded-lg mt-2",children:"Logout"})]})]}):o.jsx("div",{className:"pt-4",children:o.jsx(Gn,{to:"/login",className:"fantasy-button block w-full text-center",onClick:()=>l(!1),children:"Login"})})})]})})}function wR(){return o.jsx("div",{className:"text-xs text-gray-400 text-center mt-2",children:"Version 3.1.0"})}function xR(){return o.jsxs("div",{className:"relative overflow-hidden",children:[o.jsx("div",{className:"fantasy-container",children:o.jsxs("div",{className:"relative z-10 py-8 sm:py-16 lg:py-24 text-center",children:[o.jsx("h1",{className:"fantasy-title text-5xl sm:text-6xl lg:text-7xl",children:"Manage your D&D world like a real adventurer's tome"}),o.jsx("p",{className:"fantasy-subtitle max-w-2xl mx-auto",children:"Create parties, invite friends, and share story objectives in a beautifully crafted digital environment that feels like a magical grimoire."}),o.jsxs("div",{className:"mt-8 flex justify-center space-x-6",children:[o.jsx(Gn,{to:"/register",className:"fantasy-button text-lg px-8 py-3",children:"Start Your Journey"}),o.jsx(Gn,{to:"/login",className:"fantasy-button text-lg px-8 py-3 bg-gray-600 hover:bg-gray-700",children:"Return to Campaign"})]})]})}),o.jsx("div",{className:"absolute inset-0 bg-gray-700/10 pattern-grid-lg"})]})}function _R(){return o.jsxs("div",{children:[o.jsx(xR,{}),o.jsx("div",{className:"fantasy-container py-16",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Create Parties"}),o.jsx("p",{className:"text-gray-300",children:"Form adventuring parties with your friends and manage your campaign together in a shared space."})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Track Objectives"}),o.jsx("p",{className:"text-gray-300",children:"Keep track of your party's quests, storylines, and achievements in an organized magical tome."})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Share Stories"}),o.jsx("p",{className:"text-gray-300",children:"Document your adventures and share them with your fellow party members in an immersive fantasy setting."})]})]})})]})}function bR(){const[t,e]=R.useState(""),[n,r]=R.useState(""),[s,i]=R.useState(!1),[a,l]=R.useState(""),[u,d]=R.useState(""),f=zn(),m=ei();R.useEffect(()=>{var S;(S=m.state)!=null&&S.message&&(d(m.state.message),f(m.pathname,{replace:!0}));const b=ai(E=>{E&&f("/dashboard")});return()=>b()},[f,m]);const g=async b=>{b.preventDefault(),i(!0),l("");const S=await pR(t,n);S.error&&(S.error.includes("auth/invalid-credential")?l("Invalid email or password. Please check your credentials or register a new account."):S.error.includes("auth/user-not-found")?l("No account found with this email. Please register first."):S.error.includes("auth/wrong-password")?l("Incorrect password. Please try again."):S.error.includes("auth/user-disabled")?l("This account has been disabled. Please contact support."):S.error.includes("auth/too-many-requests")?l("Too many failed login attempts. Please try again later."):l(S.error)),i(!1)};return o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card max-w-md mx-auto",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Login"}),u&&o.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded-lg mb-4",children:u}),o.jsxs("form",{onSubmit:g,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Email"}),o.jsx("input",{type:"email",value:t,onChange:b=>e(b.target.value),className:"fantasy-input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Password"}),o.jsx("input",{type:"password",value:n,onChange:b=>r(b.target.value),className:"fantasy-input",required:!0})]}),a&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded-lg",children:a}),o.jsx("button",{type:"submit",disabled:s,className:"fantasy-button w-full",children:s?"Logging in...":"Login"})]}),o.jsx("div",{className:"mt-6 text-center",children:o.jsxs("p",{className:"text-gray-300",children:["Don't have an account?"," ",o.jsx("button",{onClick:()=>f("/register"),className:"text-amber-400 hover:text-amber-300 font-medium",children:"Register here"})]})})]})})}function ER(){const[t,e]=R.useState(""),[n,r]=R.useState(""),[s,i]=R.useState(""),[a,l]=R.useState(""),[u,d]=R.useState(""),[f,m]=R.useState(""),g=zn();R.useEffect(()=>{yR().then(S=>{console.log("Firebase test result:",S)})},[]);const b=async S=>{if(S.preventDefault(),d(""),m(""),s!==a){d("Passwords do not match");return}if(!n.trim()){d("Username is required");return}if(n.length<3){d("Username must be at least 3 characters long");return}if(!/^[a-zA-Z0-9_]+$/.test(n)){d("Username can only contain letters, numbers, and underscores");return}console.log("Submitting registration for:",t,n);const{user:E,error:k,success:_}=await mR(t,s,n);if(console.log("Registration result:",{user:E,error:k,success:_}),k){console.log("Setting error:",k),d(k);return}_?(console.log("Registration successful, redirecting to login"),g("/login",{state:{message:"Registration successful! Please check your email to verify your account before logging in."}})):console.log("No success received from registration")};return o.jsx("div",{className:"fantasy-container min-h-screen flex items-center justify-center",children:o.jsxs("div",{className:"fantasy-card w-full max-w-md",children:[o.jsx("h2",{className:"fantasy-title text-center",children:"Begin Your Adventure"}),u&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded mb-4",children:u}),f&&o.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded mb-4",children:f}),o.jsxs("form",{onSubmit:b,className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-200",children:"Username"}),o.jsx("input",{id:"username",type:"text",required:!0,value:n,onChange:S=>r(S.target.value),className:"fantasy-input mt-1",placeholder:"Choose a unique username"}),o.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Letters, numbers, and underscores only. 3+ characters."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-200",children:"Email"}),o.jsx("input",{id:"email",type:"email",required:!0,value:t,onChange:S=>e(S.target.value),className:"fantasy-input mt-1"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-200",children:"Password"}),o.jsx("input",{id:"password",type:"password",required:!0,value:s,onChange:S=>i(S.target.value),className:"fantasy-input mt-1"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-200",children:"Confirm Password"}),o.jsx("input",{id:"confirmPassword",type:"password",required:!0,value:a,onChange:S=>l(S.target.value),className:"fantasy-input mt-1"})]}),o.jsx("button",{type:"submit",className:"fantasy-button w-full",children:"Register"})]}),o.jsxs("p",{className:"mt-4 text-center text-sm text-gray-300",children:["Already have an account?"," ",o.jsx(Gn,{to:"/login",className:"text-amber-400 hover:text-amber-300",children:"Return to your campaign"})]})]})})}function tb({validation:t,onClose:e,onProceed:n,onRevise:r}){if(!t)return null;const s=l=>{switch(l){case"valid":return"";case"redirect":return"";case"expand":return"";case"impossible":return"";default:return""}},i=l=>{switch(l){case"valid":return"text-green-600 bg-green-100";case"redirect":return"text-yellow-600 bg-yellow-100";case"expand":return"text-blue-600 bg-blue-100";case"impossible":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},a=(l,u)=>u==="critical success"?"text-green-800 bg-green-200":u==="great success"?"text-green-700 bg-green-100":u==="success"?"text-green-600 bg-green-50":u==="failure"?"text-red-600 bg-red-50":u==="great failure"?"text-red-700 bg-red-100":u==="critical failure"?"text-red-800 bg-red-200":l?"text-green-600 bg-green-100":"text-red-600 bg-red-100";return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Action Validation"}),o.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:""})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:`p-3 rounded-lg ${i(t.type)}`,children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-xl",children:s(t.type)}),o.jsx("span",{className:"font-semibold capitalize",children:t.type==="valid"?"Action Validated":t.type==="redirect"?"Action Needs Redirection":t.type==="expand"?"Action Needs Clarification":"Action Not Possible"})]})}),o.jsxs("div",{className:"p-4 bg-stone-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"DM Response"}),o.jsx("div",{className:"text-stone-600 italic leading-relaxed",children:typeof t.response=="string"?t.response:t.response.story})]}),t.suggestion&&o.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-blue-700 mb-2",children:"Suggestion"}),o.jsx("p",{className:"text-blue-600",children:t.suggestion})]}),t.diceResult&&o.jsxs("div",{className:"p-4 bg-amber-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-amber-700 mb-2",children:"Action Analysis"}),t.diceResult.summary&&o.jsx("div",{className:"mb-3 p-2 bg-amber-100 rounded text-sm font-medium",children:t.diceResult.summary}),t.diceResult.contextInfo&&o.jsxs("div",{className:"mb-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[o.jsx("h5",{className:"font-semibold text-blue-700 mb-2 text-sm",children:"Story Context"}),o.jsx("p",{className:"text-blue-600 text-sm mb-2",children:t.diceResult.contextInfo.description}),t.diceResult.contextInfo.environmentalFeatures.length>0&&o.jsxs("div",{className:"mb-2",children:[o.jsx("span",{className:"text-xs font-medium text-blue-700",children:"Environment:"}),o.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.diceResult.contextInfo.environmentalFeatures.map((l,u)=>o.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:l},u))})]}),t.diceResult.contextInfo.npcs.length>0&&o.jsxs("div",{className:"mb-2",children:[o.jsx("span",{className:"text-xs font-medium text-blue-700",children:"NPCs:"}),o.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.diceResult.contextInfo.npcs.map((l,u)=>o.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded",children:l.name},u))})]}),t.diceResult.contextInfo.circumstances.length>0&&o.jsxs("div",{children:[o.jsx("span",{className:"text-xs font-medium text-blue-700",children:"Circumstances:"}),o.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.diceResult.contextInfo.circumstances.map((l,u)=>o.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",children:l},u))})]})]}),t.diceResult.actions?o.jsxs("div",{className:"space-y-3",children:[t.diceResult.actions.map((l,u)=>o.jsxs("div",{className:"border border-amber-200 rounded-lg p-3 bg-white",children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-semibold capitalize text-stone-800",children:l.action}),l.quantity>1&&o.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:["",l.quantity]}),l.isSequence&&o.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",children:"Sequence"})]}),o.jsx("p",{className:"text-sm text-stone-600",children:l.description})]}),o.jsx("span",{className:`px-3 py-1 rounded text-sm font-medium ${a(l.check.isSuccess,l.check.degree)}`,children:l.check.degree?l.check.degree.replace("_"," ").toUpperCase():l.check.isSuccess?"SUCCESS":"FAILURE"})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs text-stone-600",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Roll:"})," ",l.check.roll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Total:"})," ",l.check.totalRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"DC:"})," ",l.check.dc]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Difficulty:"})," ",l.difficulty]})]}),l.fatiguePenalty>0&&o.jsxs("div",{className:"mt-2 text-xs text-orange-600 bg-orange-50 p-2 rounded",children:[" Fatigue penalty: +",l.fatiguePenalty," DC (Action ",l.position," of ",l.totalInSequence,")"]}),l.contextModifiers&&o.jsxs("div",{className:"mt-2 text-xs text-blue-600 bg-blue-50 p-2 rounded",children:[o.jsx("span",{className:"font-medium",children:"Context modifiers:"}),o.jsx("ul",{className:"mt-1 space-y-1",children:l.contextModifiers.map((d,f)=>o.jsxs("li",{children:[" ",d]},f))})]}),l.check.circumstances&&l.check.circumstances.length>0&&o.jsxs("div",{className:"mt-2 text-xs text-blue-600",children:[o.jsx("span",{className:"font-medium",children:"Circumstances:"})," ",l.check.circumstances.join(", ")]})]},u)),o.jsxs("div",{className:"mt-4 p-3 bg-amber-100 rounded-lg",children:[o.jsxs("div",{className:"flex justify-between items-center text-sm font-medium",children:[o.jsx("span",{children:"Overall Success:"}),o.jsx("span",{className:`px-2 py-1 rounded ${t.diceResult.overallSuccess?"text-green-700 bg-green-200":"text-red-700 bg-red-200"}`,children:t.diceResult.overallSuccess?"SUCCESS":"FAILURE"})]}),t.diceResult.criticalFailures&&t.diceResult.criticalFailures.length>0&&o.jsxs("div",{className:"mt-2 text-xs text-red-600",children:[" ",t.diceResult.criticalFailures.length," critical failure(s) detected"]})]})]}):o.jsxs("div",{className:"text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Roll:"}),o.jsx("span",{className:"font-mono",children:t.diceResult.roll})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Total:"}),o.jsx("span",{className:"font-mono",children:t.diceResult.totalRoll})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"DC:"}),o.jsx("span",{className:"font-mono",children:t.diceResult.dc})]})]})]}),t.type!=="valid"&&o.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-purple-700 mb-2",children:"Alternative Approaches"}),o.jsxs("ul",{className:"text-purple-600 text-sm space-y-1",children:[o.jsx("li",{children:" Try a more focused, single action"}),o.jsx("li",{children:" Consider your character's abilities and limitations"}),o.jsx("li",{children:" Think about what would be realistic in this situation"}),o.jsx("li",{children:" Ask for clarification about what you're trying to achieve"})]})]})]}),o.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[t.type==="valid"?o.jsx("button",{onClick:n,className:"fantasy-button bg-green-600 hover:bg-green-700",children:"Proceed with Action"}):o.jsx("button",{onClick:r,className:"fantasy-button bg-blue-600 hover:bg-blue-700",children:"Revise Action"}),o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Cancel"})]})]})})}function nb({diceResult:t,onClose:e}){if(!t)return null;const n=s=>{switch(s){case"critical success":return"text-green-600 bg-green-100";case"great success":return"text-green-700 bg-green-50";case"success":return"text-blue-600 bg-blue-100";case"failure":return"text-yellow-600 bg-yellow-100";case"great failure":return"text-orange-600 bg-orange-100";case"critical failure":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},r=s=>{switch(s){case"critical success":return"";case"great success":return"";case"success":return"";case"failure":return"";case"great failure":return"";case"critical failure":return"";default:return""}};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Dice Roll Results"}),o.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:""})]}),t.actions?o.jsxs("div",{className:"space-y-4",children:[t.actions.map((s,i)=>o.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:s.action}),o.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${n(s.check.degree)}`,children:[r(s.check.degree)," ",s.check.degree]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Roll:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.roll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Total:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.totalRoll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"DC:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.dc})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Margin:"}),o.jsxs("span",{className:`font-mono ml-1 ${s.check.margin>=0?"text-green-600":"text-red-600"}`,children:[s.check.margin>=0?"+":"",s.check.margin]})]})]}),s.check.circumstanceBonus!==0&&o.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:["Circumstance bonus: ",s.check.circumstanceBonus>=0?"+":"",s.check.circumstanceBonus]})]},i)),o.jsxs("div",{className:"mt-4 p-3 bg-stone-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"Overall Result"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${t.overallSuccess?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:t.overallSuccess?" Success":" Partial Failure"}),t.hasCriticalFailures&&o.jsx("span",{className:"text-red-600 text-sm",children:" Critical failures occurred"})]})]})]}):o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:t.actionType}),o.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${n(t.degree)}`,children:[r(t.degree)," ",t.degree]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Roll:"}),o.jsx("span",{className:"font-mono ml-1",children:t.roll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Total:"}),o.jsx("span",{className:"font-mono ml-1",children:t.totalRoll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"DC:"}),o.jsx("span",{className:"font-mono ml-1",children:t.dc})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Margin:"}),o.jsxs("span",{className:`font-mono ml-1 ${t.margin>=0?"text-green-600":"text-red-600"}`,children:[t.margin>=0?"+":"",t.margin]})]})]}),o.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:[o.jsxs("div",{children:["Primary Mod: ",t.primaryMod>=0?"+":"",t.primaryMod]}),o.jsxs("div",{children:["Proficiency: ",t.proficiencyMod>=0?"+":"",t.proficiencyMod]}),t.circumstanceBonus!==0&&o.jsxs("div",{children:["Circumstance: ",t.circumstanceBonus>=0?"+":"",t.circumstanceBonus]})]})]})}),o.jsx("div",{className:"mt-4 flex justify-end",children:o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Close"})})]})})}function TR({multipleResults:t,onClose:e}){const[n,r]=R.useState(!1),[s,i]=R.useState(null);if(!t)return null;const{actionType:a,numberOfAttempts:l,results:u,statistics:d}=t,f=E=>E.adjustedSuccess&&E.adjustedMargin>=10?"bg-green-500":E.adjustedSuccess?"bg-green-400":!E.adjustedSuccess&&E.adjustedMargin<=-10?"bg-red-500":"bg-red-400",m=E=>E.adjustedSuccess&&E.adjustedMargin>=10?"":E.adjustedSuccess?"":!E.adjustedSuccess&&E.adjustedMargin<=-10?"":"",g=E=>{const k=`Attempt ${E.attemptNumber}: ${E.roll} + ${E.primaryMod} + ${E.proficiencyMod}`,_=E.fatiguePenalty>0?` - ${E.fatiguePenalty} (fatigue)`:"",x=` = ${E.adjustedTotalRoll} vs DC ${E.dc}`,N=E.adjustedSuccess?" (Success)":" (Failure)";return k+_+x+N},S=((E,k=50)=>{const _=[];for(let x=0;x<E.length;x+=k)_.push(E.slice(x,x+k));return _})(u);return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsxs("h3",{className:"text-lg font-bold text-stone-800",children:["Multiple Attempts: ",a," (",l," attempts)"]}),o.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:""})]}),o.jsxs("div",{className:"mb-6 p-4 bg-stone-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-stone-700 mb-3",children:"Overall Statistics"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.successfulAttempts}),o.jsx("div",{className:"text-sm text-stone-600",children:"Successful"})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[d.successRate.toFixed(1),"%"]}),o.jsx("div",{className:"text-sm text-stone-600",children:"Success Rate"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-amber-600",children:d.criticalSuccesses}),o.jsx("div",{className:"text-sm text-stone-600",children:"Critical Successes"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-red-600",children:d.criticalFailures}),o.jsx("div",{className:"text-sm text-stone-600",children:"Critical Failures"})]})]}),o.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Average Roll:"})," ",d.averageRoll.toFixed(1)]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Best Roll:"})," ",d.bestRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Worst Roll:"})," ",d.worstRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Average Total:"})," ",d.averageTotalRoll.toFixed(1)]})]})]}),o.jsxs("div",{className:"mb-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700",children:"Individual Attempts"}),o.jsx("button",{onClick:()=>r(!n),className:"text-sm text-blue-600 hover:text-blue-800",children:n?"Hide Details":"Show Details"})]}),o.jsx("div",{className:"space-y-2",children:S.map((E,k)=>o.jsxs("div",{className:"flex flex-wrap gap-1",children:[E.map(_=>o.jsx("div",{className:`w-6 h-6 rounded text-xs flex items-center justify-center cursor-pointer transition-colors ${f(_)} text-white font-bold`,title:g(_),onClick:()=>i(_),children:m(_)},_.attemptNumber)),k<S.length-1&&o.jsx("div",{className:"w-full h-px bg-stone-300 my-2"})]},k))})]}),o.jsxs("div",{className:"mb-4 p-3 bg-stone-50 rounded-lg",children:[o.jsx("h5",{className:"font-semibold text-stone-700 mb-2",children:"Legend"}),o.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-green-500 rounded text-white text-xs flex items-center justify-center",children:""}),o.jsx("span",{children:"Critical Success"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-green-400 rounded text-white text-xs flex items-center justify-center",children:""}),o.jsx("span",{children:"Success"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-red-400 rounded text-white text-xs flex items-center justify-center",children:""}),o.jsx("span",{children:"Failure"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-red-500 rounded text-white text-xs flex items-center justify-center",children:""}),o.jsx("span",{children:"Critical Failure"})]})]})]}),s&&o.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[o.jsxs("h5",{className:"font-semibold text-blue-700 mb-2",children:["Attempt ",s.attemptNumber," Details"]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Roll:"})," ",s.roll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Primary Mod:"})," ",s.primaryMod>=0?"+":"",s.primaryMod]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Proficiency:"})," ",s.proficiencyMod>=0?"+":"",s.proficiencyMod]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Fatigue Penalty:"})," -",s.fatiguePenalty]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Total:"})," ",s.adjustedTotalRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"DC:"})," ",s.dc]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Margin:"})," ",s.adjustedMargin>=0?"+":"",s.adjustedMargin]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Result:"}),o.jsx("span",{className:`ml-1 px-2 py-1 rounded text-xs font-medium ${s.adjustedSuccess?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.adjustedSuccess?"Success":"Failure"})]})]}),o.jsx("button",{onClick:()=>i(null),className:"mt-2 text-sm text-blue-600 hover:text-blue-800",children:"Close Details"})]}),n&&o.jsxs("div",{className:"mb-4",children:[o.jsx("h5",{className:"font-semibold text-stone-700 mb-2",children:"Detailed Results"}),o.jsx("div",{className:"max-h-64 overflow-y-auto",children:o.jsxs("table",{className:"w-full text-sm",children:[o.jsx("thead",{className:"bg-stone-100",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-2 py-1 text-left",children:"#"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Roll"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Total"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"DC"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Fatigue"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Result"})]})}),o.jsx("tbody",{children:u.map(E=>o.jsxs("tr",{className:"border-b border-stone-200",children:[o.jsx("td",{className:"px-2 py-1",children:E.attemptNumber}),o.jsx("td",{className:"px-2 py-1",children:E.roll}),o.jsx("td",{className:"px-2 py-1",children:E.adjustedTotalRoll}),o.jsx("td",{className:"px-2 py-1",children:E.dc}),o.jsxs("td",{className:"px-2 py-1",children:["-",E.fatiguePenalty]}),o.jsx("td",{className:"px-2 py-1",children:o.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${E.adjustedSuccess?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:E.adjustedSuccess?"Success":"Failure"})})]},E.attemptNumber))})]})})]}),o.jsx("div",{className:"flex justify-end",children:o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Close"})})]})})}function CR(){const t=zn(),[e,n]=R.useState(null),[r,s]=R.useState([]),[i,a]=R.useState(!0);R.useState(""),R.useState(""),R.useState(null),R.useState(!1),R.useState(!1),R.useState(!1),R.useState(null),R.useState(null),R.useState(null),R.useEffect(()=>{const m=vs.onAuthStateChanged(async g=>{g?(n(g),await l(g.uid)):t("/login")});return()=>m()},[t]);const l=async m=>{try{const g=await Hm(m);await u(g),s(g)}catch(g){console.error("Error loading user data:",g)}finally{a(!1)}},u=async m=>{for(const g of m)if(g.members)for(const b of g.members)b.profileId},d=async m=>{try{await J_(m,e.uid),s(g=>g.filter(b=>b.id!==m))}catch(g){console.error("Error deleting party:",g)}},f=()=>{t("/test-environment")};return i?o.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto"}),o.jsx("p",{className:"mt-4 text-gray-300",children:"Loading..."})]})}):o.jsx("div",{className:"min-h-screen bg-gray-900",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"mb-6 sm:mb-8",children:[o.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-100",children:"Dashboard"}),o.jsxs("p",{className:"text-gray-300 mt-2 text-sm sm:text-base",children:["Welcome back, ",(e==null?void 0:e.displayName)||(e==null?void 0:e.email),"! Manage your campaigns and test the system."]})]}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Test Environment"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Test action validation, dice rolling, and combat detection in a controlled environment."}),o.jsx("button",{onClick:f,className:"w-full fantasy-button bg-green-600 hover:bg-green-700",children:"Open Test Environment"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Create New Campaign"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Start a new campaign with your party."}),o.jsx("button",{onClick:()=>t("/campaign-management"),className:"w-full fantasy-button bg-blue-600 hover:bg-blue-700",children:"Create Campaign"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Character Creation"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Create new characters for your campaigns."}),o.jsx("button",{onClick:()=>t("/character-creation"),className:"w-full fantasy-button bg-purple-600 hover:bg-purple-700",children:"Create Character"})]})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("div",{className:"border-b border-gray-700 pb-4 mb-4",children:o.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:"Your Campaigns"})}),r.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-gray-300 mb-4",children:"You haven't created any campaigns yet."}),o.jsx("button",{onClick:()=>t("/campaign-management"),className:"fantasy-button bg-blue-600 hover:bg-blue-700",children:"Create Your First Campaign"})]}):o.jsx("div",{className:"space-y-4",children:r.map(m=>{var g;return o.jsx("div",{className:"border border-gray-600 rounded-lg p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100",children:m.name}),o.jsx("p",{className:"text-gray-300 mt-1 text-sm",children:m.description}),o.jsxs("div",{className:"flex flex-wrap items-center mt-2 gap-2 text-xs sm:text-sm text-gray-400",children:[o.jsxs("span",{children:[((g=m.members)==null?void 0:g.length)||0," members"]}),o.jsx("span",{children:""}),o.jsxs("span",{children:["Theme: ",m.theme]}),o.jsx("span",{children:""}),o.jsxs("span",{children:["Created: ",new Date(m.createdAt).toLocaleDateString()]})]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[o.jsx("button",{onClick:()=>t(`/campaign/${m.id}`),className:"fantasy-button bg-blue-600 hover:bg-blue-700 flex-1",children:"Continue"}),o.jsx("button",{onClick:()=>d(m.id),className:"fantasy-button bg-red-600 hover:bg-red-700 flex-1",children:"Delete"})]})]})},m.id)})})]})]})})}class Iu{constructor(){this.diceTypes={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20,d100:100},this.difficultyClasses={veryEasy:5,easy:10,medium:15,hard:20,veryHard:25,nearlyImpossible:30},this.actionTypes={attack:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:10,description:"Physical attack roll"},spell:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:12,description:"Spell casting check"},dodge:{primaryAbility:"dexterity",secondaryAbility:"wisdom",baseDC:15,description:"Dodge incoming attacks"},parry:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:18,description:"Parry with weapon"},backflip:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:20,description:"Perform a backflip"},somersault:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:18,description:"Perform a somersault"},cartwheel:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:16,description:"Perform a cartwheel"},wallRun:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:22,description:"Run up a wall"},jump:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:12,description:"Jump over obstacles"},climb:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:15,description:"Climb surfaces"},swim:{primaryAbility:"strength",secondaryAbility:"constitution",baseDC:14,description:"Swim through water"},fly:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:30,description:"Fly through the air"},persuade:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:15,description:"Persuade someone"},intimidate:{primaryAbility:"charisma",secondaryAbility:"strength",baseDC:16,description:"Intimidate someone"},deceive:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:18,description:"Deceive someone"},spot:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:12,description:"Spot hidden objects or creatures"},listen:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:10,description:"Listen for sounds"},search:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:14,description:"Search for hidden items"},pickLock:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:20,description:"Pick a lock"},disarmTrap:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:22,description:"Disarm a trap"},heal:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:16,description:"Provide medical aid"},craft:{primaryAbility:"intelligence",secondaryAbility:"dexterity",baseDC:18,description:"Craft an item"}},this.impossibleActionPatterns=[/\b(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,/\b(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,/\b(?:jump|leap)\s+(?:to|over|across)\s+(?:the\s+)?(?:moon|sky|clouds?)\b/gi,/\b(?:teleport|blink|phase)\s+(?:to|through)\b/gi,/\b(?:time\s+travel|rewind|fast\s+forward)\b/gi,/\b(?:summon|create)\s+(?:a\s+)?(?:dragon|god|demon)\b/gi,/\b(?:become|turn\s+into)\s+(?:invisible|invincible|immortal)\b/gi,/\b(?:kill|destroy|eliminate)\s+(?:the\s+)?(?:dm|dungeon\s+master|narrator)\b/gi,/\b(?:break|destroy)\s+(?:the\s+)?(?:fourth\s+wall|game|story)\b/gi,/\b(?:skip|ignore)\s+(?:the\s+)?(?:quest|mission|story)\b/gi,/\b(?:teleport|go)\s+(?:to\s+)?(?:the\s+)?(?:end|final\s+boss|treasure)\b/gi,/\b(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,/\b(?:open|unlock)\s+(?:the\s+)?(?:door|chest)\s+(?:without\s+)?(?:key|lockpick)\b/gi,/\b(?:find|locate)\s+(?:the\s+)?(?:hidden\s+)?(?:passage|door)\s+(?:without\s+)?(?:searching)\b/gi],this.circumstanceModifiers={"in darkness":-2,"in bright light":1,"in difficult terrain":-2,"on slippery surface":-3,"in water":-2,"in tight space":-1,"with cover":2,"with high ground":1,"with low ground":-1,"with proper tools":2,"with improvised tools":-1,"without tools":-3,"with magical item":1,"with masterwork item":2,"while injured":-2,"while exhausted":-3,"while hasted":2,"while blessed":1,"while cursed":-2,"while poisoned":-1,"under time pressure":-2,"with preparation":1,"with careful planning":2,"in a hurry":-2,"with authority":1,"with evidence":2,"with witnesses":-1,"in private":1,"in public":-1}}rollDie(e){return Math.floor(Math.random()*e)+1}rollDice(e,n){const r=[];for(let s=0;s<e;s++)r.push(this.rollDie(n));return r}rollWithAdvantage(){const e=this.rollDie(20),n=this.rollDie(20);return{result:Math.max(e,n),rolls:[e,n],advantage:!0}}rollWithDisadvantage(){const e=this.rollDie(20),n=this.rollDie(20);return{result:Math.min(e,n),rolls:[e,n],disadvantage:!0}}getAbilityModifier(e){return Math.floor((e-10)/2)}getProficiencyBonus(e){return Math.floor((e-1)/4)+2}performSkillCheck(e,n,r=[],s=null){const i=this.actionTypes[n];if(!i)throw new Error(`Unknown action type: ${n}`);let a=s||i.baseDC,l=0;r.forEach(x=>{this.circumstanceModifiers[x]&&(l+=this.circumstanceModifiers[x])});const u=this.getAbilityModifier(e[i.primaryAbility]||10),d=this.getAbilityModifier(e[i.secondaryAbility]||10),f=this.getProficiencyBonus(e.level||1),g=this.checkProficiency(e,n)?f:0,b=this.rollDie(20),S=b+u+g+l,E=S>=a,k=S-a;let _="failure";return E?k>=10?_="critical success":k>=5?_="great success":_="success":k<=-10?_="critical failure":k<=-5?_="great failure":_="failure",{actionType:n,roll:b,totalRoll:S,dc:a,primaryMod:u,secondaryMod:d,proficiencyMod:g,circumstanceBonus:l,isSuccess:E,degree:_,margin:k,circumstances:r,character:{name:e.name,level:e.level,[i.primaryAbility]:e[i.primaryAbility],[i.secondaryAbility]:e[i.secondaryAbility]}}}checkProficiency(e,n){const r=e.proficiencies||[],i={Fighter:["attack","dodge","parry"],Rogue:["dodge","pickLock","disarmTrap","spot","listen"],Wizard:["spell","search","craft"],Cleric:["heal","persuade","spot"],Ranger:["spot","listen","climb","swim"],Paladin:["attack","parry","persuade"],Monk:["attack","dodge","backflip","somersault","cartwheel"],Bard:["persuade","deceive","intimidate"],Druid:["heal","spot","listen"],Sorcerer:["spell","persuade"],Warlock:["spell","intimidate"],Barbarian:["attack","intimidate","jump","climb"]}[e.class]||[];return r.includes(n)||i.includes(n)}validateAction(e,n,r={}){const s=e.toLowerCase();for(const E of this.impossibleActionPatterns)if(E.test(s))return{possible:!1,reason:"This action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};let i=this.extractActionsFromDescription(s);if(i=i.filter(E=>E.type!==void 0),i.length===0)return{possible:!0,reason:"No valid action detected. Action appears to be narrative or unsupported.",suggestion:"Try a different action or rephrase your input.",actions:[],overallSuccess:!0,hasCriticalFailures:!1,criticalFailures:[]};const a=r.customContext;let l=[],u=[],d=[];a&&(a.environmentalFeatures&&(u=a.environmentalFeatures,l.push(`Environmental features: ${u.join(", ")}`)),a.npcs&&(d=a.npcs,l.push(`NPCs present: ${d.map(E=>E.name).join(", ")}`)),a.circumstances&&l.push(`Circumstances: ${a.circumstances.join(", ")}`));const f=i.map((E,k)=>{const _=Math.max(0,k*2),x=Array.isArray(E.circumstances)?[...E.circumstances]:[];_>0&&x.push(`while fatigued (action ${k+1} of ${i.length})`),u.forEach(M=>{x.includes(M)||x.push(M)}),a&&a.circumstances&&a.circumstances.forEach(M=>{x.includes(M)||x.push(M)});const N=this.performSkillCheck(n,E.type,x);return{action:E.type,description:E.description,check:N,difficulty:this.getDifficultyDescription(N.dc),position:E.position||k+1,totalInSequence:E.totalInSequence||i.length,quantity:E.quantity||1,keyword:E.keyword,isSequence:E.isSequence||!1,fatiguePenalty:_,contextModifiers:l.length>0?l:null}}),m=f.every(E=>E.check.isSuccess),g=f.filter(E=>E.check.degree==="critical failure"),b=f.filter(E=>!E.check.isSuccess);let S="";if(i.length===1)S=`Single action detected: ${f[0].description}`;else{const E=[...new Set(f.map(_=>_.action))];S=`Multiple actions detected: ${f.reduce((_,x)=>_+x.quantity,0)} total actions across ${E.length} different types`}return a&&(S+=` | Context: ${a.description.substring(0,50)}${a.description.length>50?"...":""}`),{possible:!0,actions:f,overallSuccess:m,hasCriticalFailures:g.length>0,criticalFailures:g,failures:b,totalActions:i.length,summary:S,contextInfo:a?{description:a.description,environmentalFeatures:u,npcs:d,circumstances:a.circumstances||[]}:null,suggestion:this.generateActionSuggestion(f,n)}}extractActionsFromDescription(e){var u,d;const n=[],r=e.toLowerCase(),s=[/\b(\d+)\s+(backflips?|somersaults?|cartwheels?|jumps?|leaps?|hops?)\b/gi,/\b(\d+)\s+(punches?|kicks?|strikes?|attacks?|swings?|slashes?)\b/gi,/\b(\d+)\s+(spells?|casts?|magic\s+spells?)\b/gi,/\b(\d+)\s+(dodges?|evades?|parries?|blocks?)\b/gi,/\b(\d+)\s+(climbs?|scales?|swims?)\b/gi,/\b(\d+)\s+(searches?|looks?|examines?)\b/gi,/\b(\d+)\s+(persuades?|intimidates?|deceives?)\b/gi];s.forEach(f=>{var g;let m;for(;(m=f.exec(r))!==null;){const b=parseInt(m[1]),S=m[2],E=this.mapKeywordToActionType(S);if(E)for(let k=0;k<b;k++){const _=this.extractCircumstances(e);n.push({type:E,description:((g=this.actionTypes[E])==null?void 0:g.description)||`${E} action`,circumstances:_,keyword:S,quantity:b,position:k+1,totalInSequence:b})}}}),Object.entries(this.actionTypes).forEach(([f,m])=>{this.getActionKeywords(f).forEach(b=>{if(!n.some(E=>E.type===f)&&r.includes(b)&&!s.some(k=>new RegExp(k.source.replace(/\\d\+/,"\\d+"),"gi").test(r))){const k=this.extractCircumstances(e);n.push({type:f,description:m.description,circumstances:k,keyword:b,quantity:1,position:1,totalInSequence:1})}})}),[/\b(backflip|somersault|cartwheel|jump|leap|hop)\s+(?:and\s+then\s+)?(punch|kick|strike|attack|swing|slash)\b/gi,/\b(punch|kick|strike|attack|swing|slash)\s+(?:and\s+then\s+)?(backflip|somersault|cartwheel|jump|leap|hop)\b/gi,/\b(dodge|evade|parry|block)\s+(?:and\s+then\s+)?(attack|strike|punch|kick)\b/gi,/\b(attack|strike|punch|kick)\s+(?:and\s+then\s+)?(dodge|evade|parry|block)\b/gi].forEach(f=>{var g,b;let m;for(;(m=f.exec(r))!==null;){const S=this.mapKeywordToActionType(m[1]),E=this.mapKeywordToActionType(m[2]);if(S&&E){const k=this.extractCircumstances(e);n.some(_=>_.type===S&&_.keyword===m[1])||n.push({type:S,description:((g=this.actionTypes[S])==null?void 0:g.description)||`${S} action`,circumstances:k,keyword:m[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),n.some(_=>_.type===E&&_.keyword===m[2])||n.push({type:E,description:((b=this.actionTypes[E])==null?void 0:b.description)||`${E} action`,circumstances:k,keyword:m[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}});const a=/\b(\w+)\s+and\s+(\w+)\b/gi;let l;for(;(l=a.exec(r))!==null;){const f=this.mapKeywordToActionType(l[1]),m=this.mapKeywordToActionType(l[2]);if(f&&m){const g=this.extractCircumstances(e);n.some(b=>b.type===f&&b.keyword===l[1])||n.push({type:f,description:((u=this.actionTypes[f])==null?void 0:u.description)||`${f} action`,circumstances:g,keyword:l[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),n.some(b=>b.type===m&&b.keyword===l[2])||n.push({type:m,description:((d=this.actionTypes[m])==null?void 0:d.description)||`${m} action`,circumstances:g,keyword:l[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}return n}mapKeywordToActionType(e){return{punch:"attack",punches:"attack",kick:"attack",kicks:"attack",strike:"attack",strikes:"attack",attack:"attack",attacks:"attack",swing:"attack",swings:"attack",slash:"attack",slashes:"attack",thrust:"attack",thrusts:"attack",backflip:"backflip",backflips:"backflip",somersault:"somersault",somersaults:"somersault",cartwheel:"cartwheel",cartwheels:"cartwheel",jump:"jump",jumps:"jump",leap:"jump",leaps:"jump",hop:"jump",hops:"jump",climb:"climb",climbs:"climb",scale:"climb",scales:"climb",swim:"swim",swims:"swim",dodge:"dodge",dodges:"dodge",evade:"dodge",evades:"dodge",parry:"parry",parries:"parry",block:"parry",blocks:"parry",spell:"spell",spells:"spell",cast:"spell",casts:"spell","magic spell":"spell","magic spells":"spell",persuade:"persuade",persuades:"persuade",intimidate:"intimidate",intimidates:"intimidate",deceive:"deceive",deceives:"deceive",search:"search",searches:"search",look:"search",looks:"search",examine:"search",examines:"search"}[e.toLowerCase()]}getActionKeywords(e){return{attack:["attack","strike","hit","swing","slash","thrust","punch","kick"],spell:["cast","spell","magic","enchant","charm"],dodge:["dodge","evade","avoid","sidestep"],parry:["parry","block","deflect"],backflip:["backflip","back flip"],somersault:["somersault","forward roll"],cartwheel:["cartwheel"],wallRun:["wall run","run up wall"],jump:["jump","leap","hop"],climb:["climb","scale"],swim:["swim"],fly:["fly","levitate","float"],persuade:["persuade","convince","talk into"],intimidate:["intimidate","threaten","scare"],deceive:["deceive","lie","trick"],spot:["spot","see","notice","observe"],listen:["listen","hear"],search:["search","look for","find"],pickLock:["pick lock","lockpick"],disarmTrap:["disarm","trap"],heal:["heal","cure","treat"],craft:["craft","make","create","build"]}[e]||[]}extractCircumstances(e){const n=[];return Object.keys(this.circumstanceModifiers).forEach(r=>{e.includes(r)&&n.push(r)}),n}getDifficultyDescription(e){return e<=5?"Very Easy":e<=10?"Easy":e<=15?"Medium":e<=20?"Hard":e<=25?"Very Hard":"Nearly Impossible"}generateActionSuggestion(e,n){const r=e.filter(i=>!i.check.isSuccess);return r.length===0?"All actions are within your capabilities. Proceed with confidence!":r.map(i=>{const a=i.action;return i.check.degree==="critical failure"?`The ${a} is extremely difficult for you. Consider an alternative approach or ask for help.`:`The ${a} is challenging. You might want to take your time or use better equipment.`}).join(" ")}performActionSequence(e,n,r={}){const s=[];let i=0;for(let u=0;u<n.length;u++){const d=n[u],f=Array.isArray(d.circumstances)?[...d.circumstances]:[];i>0?f.push("with momentum"):i<0&&f.push("while fatigued");const m=this.performSkillCheck(e,d.type,f);s.push({action:d.type,check:m,sequencePosition:u+1}),m.isSuccess?i+=1:i-=2}const a=s.every(u=>u.check.isSuccess),l=s.filter(u=>u.check.degree==="critical failure");return{actions:s,overallSuccess:a,hasCriticalFailures:l.length>0,criticalFailures:l,sequenceLength:n.length,finalModifier:i}}generateActionNarrative(e,n){const{actionType:r,check:s,degree:i}=e;this.actionTypes[r];const a={attack:{"critical success":`${n.name} executes a perfect ${r}, striking with incredible precision!`,"great success":`${n.name} performs an excellent ${r}, hitting the target solidly.`,success:`${n.name} successfully ${r}s the target.`,failure:`${n.name} attempts to ${r} but misses the mark.`,"great failure":`${n.name} completely fails to ${r}, leaving themselves open.`,"critical failure":`${n.name} botches the ${r} spectacularly, potentially harming themselves!`},backflip:{"critical success":`${n.name} performs a flawless backflip, landing gracefully with perfect form!`,"great success":`${n.name} executes a smooth backflip, impressing onlookers.`,success:`${n.name} manages to complete the backflip successfully.`,failure:`${n.name} attempts a backflip but loses balance and stumbles.`,"great failure":`${n.name} fails the backflip badly, landing awkwardly.`,"critical failure":`${n.name} completely fails the backflip, potentially injuring themselves!`},fly:{"critical success":`${n.name} somehow defies gravity and soars through the air with supernatural grace!`,"great success":`${n.name} manages to achieve brief flight through incredible effort!`,success:`${n.name} makes a valiant attempt at flight, achieving a brief hover.`,failure:`${n.name} tries to fly but only manages an awkward hop.`,"great failure":`${n.name} attempts flight but falls flat on their face.`,"critical failure":`${n.name} tries to fly and crashes spectacularly, looking quite foolish!`}},l=a[r]||a.attack;return l[i]||l.failure}performMultipleSkillChecks(e,n,r,s=[],i=null){var b,S,E,k;const a=[];let l=0;const u=1;for(let _=1;_<=r;_++){const x=l*u,N=[...s];l>0&&N.push(`while fatigued (attempt ${_})`);const M=this.performSkillCheck(e,n,N,i),D={...M,attemptNumber:_,fatigueLevel:l,fatiguePenalty:x,adjustedTotalRoll:M.totalRoll-x,adjustedMargin:M.totalRoll-x-M.dc,adjustedSuccess:M.totalRoll-x>=M.dc};a.push(D),l++}const d=a.filter(_=>_.adjustedSuccess).length,f=a.filter(_=>_.adjustedSuccess&&_.adjustedMargin>=10).length,m=a.filter(_=>!_.adjustedSuccess&&_.adjustedMargin<=-10).length,g=d/r*100;return{actionType:n,numberOfAttempts:r,results:a,statistics:{successfulAttempts:d,criticalSuccesses:f,criticalFailures:m,successRate:g,averageRoll:a.reduce((_,x)=>_+x.roll,0)/r,averageTotalRoll:a.reduce((_,x)=>_+x.adjustedTotalRoll,0)/r,bestRoll:Math.max(...a.map(_=>_.adjustedTotalRoll)),worstRoll:Math.min(...a.map(_=>_.adjustedTotalRoll))},character:{name:e.name,level:e.level,[(b=this.actionTypes[n])==null?void 0:b.primaryAbility]:e[(S=this.actionTypes[n])==null?void 0:S.primaryAbility],[(E=this.actionTypes[n])==null?void 0:E.secondaryAbility]:e[(k=this.actionTypes[n])==null?void 0:k.secondaryAbility]}}}performMultipleDiceRolls(e,n,r="standard"){const s=[];for(let d=1;d<=e;d++){let f;switch(r){case"advantage":f=this.rollWithAdvantage();break;case"disadvantage":f=this.rollWithDisadvantage();break;default:f={result:this.rollDie(n),rolls:[this.rollDie(n)],advantage:!1,disadvantage:!1}}s.push({...f,rollNumber:d,sides:n})}const i=s.map(d=>d.result),a=i.reduce((d,f)=>d+f,0)/e,l=Math.max(...i),u=Math.min(...i);return{numberOfRolls:e,sides:n,rollType:r,results:s,statistics:{average:a,max:l,min:u,total:i.reduce((d,f)=>d+f,0),natural20s:i.filter(d=>d===20).length,natural1s:i.filter(d=>d===1).length}}}generateMultipleAttemptsNarrative(e,n){const{actionType:r,numberOfAttempts:s,statistics:i}=e,a=this.actionTypes[r];if(!a)return`${n.name} attempts ${r} ${s} times.`;const l=i.successRate,u=i.criticalSuccesses,d=i.criticalFailures;let f=`${n.name} attempts to ${a.description} ${s} times. `;return l>=80?f+=`They perform exceptionally well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:l>=60?f+=`They perform well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:l>=40?f+=`They have mixed results, succeeding ${i.successfulAttempts} out of ${s} attempts.`:l>=20?f+=`They struggle, only succeeding ${i.successfulAttempts} out of ${s} attempts.`:f+=`They perform poorly, only succeeding ${i.successfulAttempts} out of ${s} attempts.`,u>0&&(f+=` They achieve ${u} spectacular successes!`),d>0&&(f+=` They suffer ${d} embarrassing failures.`),s>10&&(f+=" The repeated attempts take their toll, and fatigue begins to set in."),f}}class Gm{constructor(){this.diceService=new Iu,this.storyRules={redirectPatterns:[{pattern:/\b(?:i\s+)?(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,response:"While impressive acrobatics are possible, let's focus on actions that advance the story. What's your main goal here?",suggestion:"Try describing a more focused action that helps with the current situation."},{pattern:/\b(?:i\s+)?(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,response:"Flight isn't currently possible in this situation. What are you trying to achieve?",suggestion:"Consider climbing, jumping, or finding another way to reach your destination."},{pattern:/\b(?:i\s+)?(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,response:"The quest item isn't just lying around. You'll need to find it through exploration and investigation.",suggestion:"Try searching the area, asking NPCs, or following clues to locate the item."},{pattern:/\b(?:i\s+)?(?:attack|kill|destroy)\s+(?:everyone|all|each)\s+(?:enemy|person|creature)\b/gi,response:"While combat is possible, attacking everyone at once isn't practical. Let's focus on the immediate threat.",suggestion:"Choose a specific target or describe a more strategic approach."}],expandPatterns:[{pattern:/\b(?:i\s+)?(?:search|look|examine)\b/gi,response:"What specifically are you searching for or looking at?",suggestion:"Be more specific about what you're searching for or examining."},{pattern:/\b(?:i\s+)?(?:talk|speak|ask)\b/gi,response:"Who would you like to talk to, and what would you like to discuss?",suggestion:"Specify the person and topic of conversation."},{pattern:/\b(?:i\s+)?(?:go|move|walk)\b/gi,response:"Where would you like to go?",suggestion:"Specify your destination or direction."}],encouragePatterns:[{pattern:/\b(?:i\s+)?(?:investigate|explore|examine)\b/gi,response:"Great! Investigation and exploration are key to advancing the story.",suggestion:"What specific aspect would you like to investigate?"},{pattern:/\b(?:i\s+)?(?:help|assist|aid)\b/gi,response:"Helping others is always a noble choice. Who would you like to help?",suggestion:"Specify who needs help and how you can assist them."},{pattern:/\b(?:i\s+)?(?:negotiate|diplomacy|peace)\b/gi,response:"Diplomacy can often achieve more than violence. Good thinking!",suggestion:"How would you like to approach the negotiation?"}]},this.contextResponses={combat:{impossible:"That action isn't possible in combat. Focus on your available combat options.",difficult:"That's a challenging action in combat. Are you sure you want to attempt it?",strategic:"That's a good strategic choice. How do you want to execute it?"},exploration:{impossible:"That action doesn't make sense in this environment. What are you trying to achieve?",difficult:"That will be challenging given the current circumstances.",strategic:"That's a good approach to exploration. Let's see how it goes."},social:{impossible:"That action isn't appropriate in this social situation.",difficult:"That's a bold social move. Are you prepared for the consequences?",strategic:"That's a good approach to the situation. How do you want to proceed?"}}}validatePlayerAction(e,n,r={}){const s=e.toLowerCase(),i=this.checkImpossibleActions(s);if(!i.possible)return{valid:!1,type:"impossible",response:i.response,suggestion:i.suggestion,diceResult:null};const a=this.checkRedirectPatterns(s);if(a.needsRedirect)return{valid:!1,type:"redirect",response:a.response,suggestion:a.suggestion,diceResult:null};const l=this.checkExpandPatterns(s);if(l.needsExpansion)return{valid:!1,type:"expand",response:l.response,suggestion:l.suggestion,diceResult:null};const u=this.diceService.validateAction(e,n,r);return{valid:!0,type:"valid",response:this.generateValidationResponse(u,n,r),suggestion:u.suggestion,diceResult:u}}checkImpossibleActions(e){for(const n of this.diceService.impossibleActionPatterns)if(n.test(e))return{possible:!1,response:"That action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};return{possible:!0}}checkRedirectPatterns(e){for(const n of this.storyRules.redirectPatterns)if(n.pattern.test(e))return{needsRedirect:!0,response:n.response,suggestion:n.suggestion};return{needsRedirect:!1}}checkExpandPatterns(e){for(const n of this.storyRules.expandPatterns)if(n.pattern.test(e))return{needsExpansion:!0,response:n.response,suggestion:n.suggestion};return{needsExpansion:!1}}generateValidationResponse(e,n,r){if(!e.overallSuccess)return e.actions.filter(u=>!u.check.isSuccess).filter(u=>u.check.degree==="critical failure").length>0?`The actions you described are beyond your current capabilities. ${e.suggestion}`:`The actions you described are challenging but possible. ${e.suggestion}`;const s=this.generateAtmosphericResponse(e,n,r),i=this.extractEntities(s,r);return{story:s,entities:i}}generateAtmosphericResponse(e,n,r){const{actions:s,overallSuccess:i,hasCriticalFailures:a}=e,l=r==null?void 0:r.customContext;let u=this.getAtmosphericElements(l),d=this.calculateTensionLevel(s,a),f="";return s.length===1?f=this.generateSingleActionResponse(s[0],n,u,d):f=this.generateMultiActionResponse(s,n,u,d),l&&l.environmentalFeatures&&(f+=this.addEnvironmentalDetails(l.environmentalFeatures,d)),l&&l.npcs&&(f+=this.addNPCReactions(l.npcs,s,i)),f+=this.addStoryProgressionHook(s,d,l),f}getAtmosphericElements(e){const n={lighting:"dim",weather:"calm",mood:"neutral",tension:"low"};if(!e)return n;const r=e.description.toLowerCase();return(r.includes("dark")||r.includes("shadow"))&&(n.lighting="dark"),(r.includes("bright")||r.includes("sunlight"))&&(n.lighting="bright"),(r.includes("dim")||r.includes("flickering"))&&(n.lighting="dim"),(r.includes("storm")||r.includes("rain"))&&(n.weather="stormy"),(r.includes("fog")||r.includes("mist"))&&(n.weather="foggy"),r.includes("wind")&&(n.weather="windy"),(r.includes("tension")||r.includes("danger"))&&(n.mood="tense"),(r.includes("peaceful")||r.includes("calm"))&&(n.mood="peaceful"),(r.includes("eerie")||r.includes("creepy"))&&(n.mood="eerie"),n}calculateTensionLevel(e,n){let r="low";const s=e.filter(i=>["attack","spell","dodge","parry"].includes(i.action));return s.length>0&&(r="medium"),s.length>2&&(r="high"),n&&(r="critical"),r}generateSingleActionResponse(e,n,r,s){const{action:i,check:a,keyword:l}=e,u=a.isSuccess;a.degree;const d={attack:{success:{low:`${n.name} strikes true, the blow landing with satisfying impact.`,medium:`${n.name}'s weapon finds its mark, the strike ringing out in the ${r.lighting} light.`,high:`${n.name} delivers a devastating blow, the force of the attack echoing through the ${r.weather} air.`,critical:`${n.name} executes a perfect strike, the precision of the attack leaving no room for error.`},failure:{low:`${n.name} swings wide, the attack missing its intended target.`,medium:`${n.name}'s strike goes awry, the weapon clattering against stone or wood.`,high:`${n.name} completely misses, the failed attack leaving them momentarily vulnerable.`,critical:`${n.name} stumbles in their attack, the botched strike nearly causing them to fall.`}},backflip:{success:{low:`${n.name} executes a graceful backflip, landing softly on their feet.`,medium:`${n.name} performs an impressive backflip, the acrobatic feat drawing attention.`,high:`${n.name} completes a spectacular backflip, the display of agility leaving onlookers amazed.`,critical:`${n.name} achieves a flawless backflip, the perfect form and landing drawing gasps of admiration.`},failure:{low:`${n.name} attempts a backflip but loses balance, stumbling slightly.`,medium:`${n.name} fails the backflip, landing awkwardly and looking embarrassed.`,high:`${n.name} completely botches the backflip, falling hard to the ground.`,critical:`${n.name} crashes spectacularly during the backflip, potentially injuring themselves.`}},search:{success:{low:`${n.name} searches carefully, their trained eyes picking up subtle details.`,medium:`${n.name} conducts a thorough search, methodically examining every corner.`,high:`${n.name} performs an exhaustive search, their attention to detail revealing hidden secrets.`,critical:`${n.name} discovers something extraordinary, their keen observation uncovering a crucial clue.`},failure:{low:`${n.name} looks around but finds nothing of interest.`,medium:`${n.name} searches but misses several obvious details.`,high:`${n.name} fails to notice important clues, their search proving fruitless.`,critical:`${n.name} overlooks critical information, their poor search skills costing them dearly.`}},persuade:{success:{low:`${n.name} makes a reasonable argument, their words carrying some weight.`,medium:`${n.name} presents a compelling case, their charisma swaying the listener.`,high:`${n.name} delivers a masterful persuasion, their words impossible to ignore.`,critical:`${n.name} achieves the impossible, their silver tongue turning enemies into allies.`},failure:{low:`${n.name} tries to persuade but fails to make a convincing argument.`,medium:`${n.name}'s attempt at persuasion falls flat, their words lacking impact.`,high:`${n.name} completely fails to persuade, their poor communication skills evident.`,critical:`${n.name} not only fails to persuade but manages to offend the listener.`}}},f=d[i]||d.attack,m=u?"success":"failure",g=s==="critical"?"high":s;return f[m][g]}generateMultiActionResponse(e,n,r,s){const i=e.length,a=e.filter(u=>u.check.isSuccess).length,l=i-a;return a===i?`${n.name} executes a flawless sequence of actions, each movement flowing seamlessly into the next. The display of skill and coordination is impressive to behold.`:a>l?`${n.name} performs admirably, with most actions succeeding despite the challenging circumstances. A few missteps don't diminish the overall effectiveness.`:l>a?`${n.name} struggles with the complex sequence, many actions failing to achieve their intended results. The difficulty of the task proves overwhelming.`:`${n.name} has mixed results, with some actions succeeding while others fail. The outcome remains uncertain.`}addEnvironmentalDetails(e,n){if(e.length===0)return"";const r={dark:{low:" The darkness seems to swallow sound, making every movement feel more significant.",medium:" Shadows dance in the darkness, creating an atmosphere of uncertainty.",high:" The oppressive darkness makes every action feel more dangerous and urgent.",critical:" The pitch-black environment amplifies every sound, every movement potentially deadly."},stormy:{low:" Rain patters against surfaces, adding a rhythmic backdrop to the scene.",medium:" The storm intensifies, wind and rain making movement more challenging.",high:" The raging storm creates a chaotic environment where every action is a gamble.",critical:" The violent storm threatens to overwhelm all but the most determined efforts."},foggy:{low:" Mist swirls gently, obscuring distant details.",medium:" The fog thickens, reducing visibility and creating an eerie atmosphere.",high:" Dense fog makes navigation difficult and every shadow a potential threat.",critical:" The impenetrable fog isolates you completely, each step into the unknown."}};let s="";return e.forEach(i=>{r[i]&&(s+=r[i][n]||"")}),s}addNPCReactions(e,n,r){if(e.length===0)return"";const s=e.map(i=>i.name).join(" and ");return r?` ${s} watch with growing interest, clearly impressed by your actions.`:` ${s} exchange concerned glances, their confidence in your abilities wavering.`}addStoryProgressionHook(e,n,r){const s=e.some(l=>["attack","spell","dodge","parry"].includes(l.action)),i=e.some(l=>["search","climb","jump"].includes(l.action)),a=e.some(l=>["persuade","intimidate","deceive"].includes(l.action));return s&&n==="high"?" The tension in the air is palpable. Something is about to happen...":i?" Your investigation reveals new possibilities. What will you discover next?":a?" The social dynamics shift with your words. How will others respond?":" The situation continues to unfold. What will you do next?"}generateStoryResponse(e,n,r={}){const s=this.validatePlayerAction(e,n,r);if(!s.valid)return{response:s.response,suggestion:s.suggestion,shouldProceed:!1,diceResult:null};const i=[];return s.diceResult.actions&&s.diceResult.actions.forEach(a=>{const l=this.diceService.generateActionNarrative(a.check,n);i.push(l)}),{response:i.join(" "),suggestion:s.suggestion,shouldProceed:!0,diceResult:s.diceResult}}handleComplexAction(e,n,r={}){const s=this.diceService.extractActionsFromDescription(e.toLowerCase());if(s.length===0)return{response:"I understand your intent. Let's see how this plays out in the story.",shouldProceed:!0,type:"narrative"};if(s.length===1)return this.generateStoryResponse(e,n,r);const i=this.diceService.performActionSequence(n,s,r);return i.overallSuccess?{response:i.actions.map(l=>this.diceService.generateActionNarrative(l.check,n)).join(" "),shouldProceed:!0,type:"sequence",diceResult:i}:i.actions.filter(u=>!u.check.isSuccess).filter(u=>u.check.degree==="critical failure").length>0?{response:"The sequence of actions you described is too complex for your current abilities. Try breaking it down into simpler steps.",shouldProceed:!1,type:"sequence_failure",diceResult:i}:{response:"Some parts of your action sequence are challenging. You might want to simplify your approach.",shouldProceed:!1,type:"sequence_partial",diceResult:i}}provideAlternatives(e,n,r={}){const s=e.toLowerCase(),i=[];return(s.includes("backflip")||s.includes("somersault"))&&i.push({action:"dodge",description:"Try dodging or evading instead of acrobatics",difficulty:"easier"}),(s.includes("fly")||s.includes("levitate"))&&i.push({action:"climb",description:"Try climbing or finding another way up",difficulty:"realistic"}),s.includes("attack everyone")&&i.push({action:"focus",description:"Focus on one target at a time for better effectiveness",difficulty:"strategic"}),s.includes("grab quest item")&&i.push({action:"search",description:"Search the area thoroughly to find the item",difficulty:"appropriate"}),i}maintainStoryCoherence(e,n,r){const s={storyPhase:this.checkStoryPhase(e,n),establishedFacts:this.checkEstablishedFacts(e,n),plotAdvancement:this.checkPlotAdvancement(e,n),characterDevelopment:this.checkCharacterDevelopment(e,r)},i=Object.entries(s).filter(([a,l])=>!l.valid).map(([a,l])=>l.issue);return{coherent:i.length===0,issues:i,suggestions:this.generateCoherenceSuggestions(i,n)}}checkStoryPhase(e,n){const r=n.phase||"exploration",s=e.toLowerCase(),l=({introduction:["attack","kill","destroy"],exploration:["end quest","skip to boss"],combat:["negotiate peace","run away"],resolution:["start new quest","begin adventure"]}[r]||[]).some(u=>s.includes(u));return{valid:!l,issue:l?`This action doesn't fit the current story phase (${r})`:null}}checkEstablishedFacts(e,n){const r=n.establishedFacts||[],s=e.toLowerCase();for(const i of r)if(i.contradicts&&i.contradicts.some(a=>s.includes(a.toLowerCase())))return{valid:!1,issue:`This action contradicts established story facts: ${i.description}`};return{valid:!0}}checkPlotAdvancement(e,n){const r=n.plotPoints||[],s=e.toLowerCase(),i=r.find(a=>a.active);return i&&i.keywords&&!i.keywords.some(l=>s.includes(l.toLowerCase()))?{valid:!1,issue:"This action doesn't address the current plot point"}:{valid:!0}}checkCharacterDevelopment(e,n){const r=n.alignment||"Neutral",s=e.toLowerCase(),l=({"Lawful Good":["steal","deceive","harm innocent"],"Chaotic Evil":["help others","follow rules","show mercy"],"Neutral Good":["harm innocent","betray allies"],"Lawful Evil":["break laws","show mercy","help weak"],"Chaotic Good":["follow strict rules","harm innocent"],"True Neutral":["take extreme actions","show strong emotions"],"Lawful Neutral":["break laws","show mercy","act chaotically"],"Neutral Evil":["help others","follow laws","show mercy"],"Chaotic Neutral":["follow strict rules","show strong loyalty"]}[r]||[]).some(u=>s.includes(u));return{valid:!l,issue:l?`This action doesn't align with your character's alignment (${r})`:null}}generateCoherenceSuggestions(e,n){const r=[];return e.forEach(s=>{s.includes("story phase")?r.push("Consider actions that fit the current phase of the story."):s.includes("established facts")?r.push("Remember what has already been established in the story."):s.includes("plot point")?r.push("Focus on actions that advance the current plot."):s.includes("alignment")&&r.push("Consider actions that align with your character's moral compass.")}),r}extractEntities(e,n={}){const r={enemies:[],items:[],locations:[],statusEffects:[],questHooks:[],npcs:[]};return e.toLowerCase(),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:the\s+)?(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster|boss|mini-boss)/gi,/\b(goblin|orc|troll|dragon|bandit|skeleton|zombie|ghost|spirit|demon|devil|fiend|beast|creature|monster)\b/gi,/(?:mini-boss|boss)\s*[-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/\[Combat\s+Trigger[^]]*[-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\]/gi].forEach(f=>{let m;for(;(m=f.exec(e))!==null;){const g=m[1]||m[0];g&&!r.enemies.some(b=>b.name.toLowerCase()===g.toLowerCase())&&r.enemies.push({name:g,type:"enemy",subtype:this.determineEnemySubtype(g,e),status:this.determineEnemyStatus(g,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:of\s+[A-Z][a-z]+)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:sword|dagger|staff|wand|scroll|potion|ring|amulet|crown|robe|armor|shield)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cursed|forbidden|ancient|legendary)/gi].forEach(f=>{let m;for(;(m=f.exec(e))!==null;){const g=m[1]||m[0];g&&!r.items.some(b=>b.name.toLowerCase()===g.toLowerCase())&&r.items.push({name:g,type:"item",subtype:this.determineItemSubtype(g,e),status:this.determineItemStatus(g,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:shrine|temple|castle|tower|dungeon|cave|tunnel|chamber|room|hall|garden|forest|mountain|river|lake|ocean|tavern|inn)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cliffs|beach|island|valley|peak|summit|depths|heights)/gi].forEach(f=>{let m;for(;(m=f.exec(e))!==null;){const g=m[1]||m[0];g&&!r.locations.some(b=>b.name.toLowerCase()===g.toLowerCase())&&r.locations.push({name:g,type:"location",subtype:this.determineLocationSubtype(g,e),tags:this.determineLocationTags(g,e)})}}),[/(?:cursed|blessed|enchanted|poisoned|paralyzed|charmed|frightened|invisible|ethereal|ethereal|flying|levitating)/gi,/(?:in\s+darkness|in\s+bright\s+light|under\s+pressure|in\s+a\s+hurry|carefully|stealthily|aggressively|defensively)/gi].forEach(f=>{let m;for(;(m=f.exec(e))!==null;){const g=m[0];g&&!r.statusEffects.some(b=>b.name.toLowerCase()===g.toLowerCase())&&r.statusEffects.push({name:g,type:"status_effect",effect:this.determineStatusEffect(g,e)})}}),[/(?:break|destroy|find|retrieve|defeat|save|protect|escort|investigate|explore)\s+(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/(?:quest|mission|objective|goal|task|duty|responsibility)/gi].forEach(f=>{let m;for(;(m=f.exec(e))!==null;){const g=m[1]||m[0];g&&!r.questHooks.some(b=>b.name.toLowerCase()===g.toLowerCase())&&r.questHooks.push({name:g,type:"quest_hook",objective:this.determineQuestObjective(g,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:merchant|trader|noble|lord|lady|king|queen|prince|princess|mayor|priest|shaman|hunter|fisherman|farmer)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:quest\s+giver|guide|mentor|teacher|master)/gi].forEach(f=>{let m;for(;(m=f.exec(e))!==null;){const g=m[1]||m[0];g&&!r.npcs.some(b=>b.name.toLowerCase()===g.toLowerCase())&&r.npcs.push({name:g,type:"npc",role:this.determineNPCRole(g,e),disposition:"friendly"})}}),r}determineEnemySubtype(e,n){n.toLowerCase();const r=e.toLowerCase();return r.includes("boss")||r.includes("mini-boss")?"boss":r.includes("priest")||r.includes("cleric")?"priest":r.includes("wizard")||r.includes("mage")?"wizard":r.includes("dragon")?"dragon":r.includes("undead")||r.includes("skeleton")||r.includes("zombie")?"undead":r.includes("goblin")||r.includes("orc")||r.includes("troll")?"monster":"enemy"}determineEnemyStatus(e,n){const r=n.toLowerCase();return r.includes("snarls")||r.includes("aggressive")?"hostile":r.includes("defensive")||r.includes("cautious")?"defensive":r.includes("chanting")||r.includes("casting")?"casting":"active"}determineItemSubtype(e,n){const r=e.toLowerCase();return r.includes("sword")||r.includes("dagger")||r.includes("staff")?"weapon":r.includes("potion")||r.includes("scroll")?"consumable":r.includes("ring")||r.includes("amulet")||r.includes("crown")?"accessory":r.includes("armor")||r.includes("robe")||r.includes("shield")?"armor":"item"}determineItemStatus(e,n){const r=n.toLowerCase(),s=e.toLowerCase();return s.includes("cursed")||r.includes("cursed")?"cursed":s.includes("forbidden")||r.includes("forbidden")?"forbidden":s.includes("ancient")||r.includes("ancient")?"ancient":s.includes("legendary")||r.includes("legendary")?"legendary":r.includes("magical")||r.includes("enchanted")?"magical":"normal"}determineLocationSubtype(e,n){const r=e.toLowerCase();return r.includes("shrine")||r.includes("temple")?"religious":r.includes("castle")||r.includes("tower")?"fortification":r.includes("cave")||r.includes("tunnel")?"underground":r.includes("forest")||r.includes("garden")?"natural":r.includes("tavern")||r.includes("inn")?"settlement":"location"}determineLocationTags(e,n){const r=[],s=n.toLowerCase();return(s.includes("ancient")||s.includes("old"))&&r.push("ancient"),(s.includes("dangerous")||s.includes("hostile"))&&r.push("dangerous"),(s.includes("sacred")||s.includes("holy"))&&r.push("sacred"),(s.includes("cursed")||s.includes("evil"))&&r.push("cursed"),(s.includes("coastal")||s.includes("ocean"))&&r.push("coastal"),(s.includes("mountain")||s.includes("high"))&&r.push("mountainous"),r}determineStatusEffect(e,n){const r=e.toLowerCase();return r.includes("cursed")?"disables healing":r.includes("poisoned")?"damage over time":r.includes("paralyzed")?"prevents movement":r.includes("charmed")?"mind control":r.includes("invisible")?"stealth bonus":r.includes("flying")?"flight ability":"unknown effect"}determineQuestObjective(e,n){const r=e.toLowerCase();return r.includes("break")||r.includes("destroy")?"destruction":r.includes("find")||r.includes("retrieve")?"retrieval":r.includes("defeat")||r.includes("kill")?"combat":r.includes("save")||r.includes("protect")?"protection":r.includes("escort")?"escort":r.includes("investigate")||r.includes("explore")?"exploration":"objective"}determineNPCRole(e,n){const r=e.toLowerCase();return r.includes("merchant")||r.includes("trader")?"merchant":r.includes("noble")||r.includes("lord")||r.includes("lady")?"noble":r.includes("king")||r.includes("queen")?"royalty":r.includes("priest")||r.includes("shaman")?"religious":r.includes("quest giver")||r.includes("guide")?"quest_giver":"npc"}}const SR=new Gm,Id=new Iu;function kR(){const t=zn(),[e,n]=R.useState(""),[r,s]=R.useState(""),[i,a]=R.useState(null),[l,u]=R.useState(!1),[d,f]=R.useState(!1),[m,g]=R.useState(!1),[b,S]=R.useState(null),[E,k]=R.useState(null),[_,x]=R.useState(null),[N,M]=R.useState("Fighter"),D=[{name:"Drowned Priest Boss Fight",storyContext:"In a dark, misty swamp, a Drowned Priest emerges from the murky water, chanting dark spells. The air is thick with malevolence as undead minions rise from the depths. The water bubbles with dark energy, and the priest's glowing eyes pierce through the fog.",suggestedAction:"I charge forward and attack the Drowned Priest with my sword"},{name:"Forest Ambush",storyContext:"The party is traveling through a dense forest when suddenly, goblin archers emerge from the trees above. The forest floor is covered in fallen leaves that crunch underfoot, and the canopy blocks most of the sunlight. The goblins are well-hidden in the branches, their green skin blending with the foliage.",suggestedAction:"I take cover behind a large tree and cast a fireball at the goblin archers"},{name:"Tavern Brawl",storyContext:"A rowdy group of bandits has taken over the local tavern, threatening the patrons. The tavern is filled with overturned tables, broken chairs, and spilled ale. The bandit leader, a scarred warrior with a wicked grin, stands on the bar counter brandishing his sword.",suggestedAction:"I leap over a table and tackle the bandit leader to the ground"}],v={Fighter:{id:"test_fighter_1",name:"Test Fighter",level:5,class:"Fighter",strength:18,dexterity:14,constitution:16,intelligence:10,wisdom:10,charisma:12,hp:45,maxHp:45,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Longsword",damageBonus:2},armor:{name:"Chain Mail",defenseBonus:4},shield:{name:"Shield",defenseBonus:2}}},Wizard:{id:"test_wizard_1",name:"Test Wizard",level:5,class:"Wizard",strength:8,dexterity:14,constitution:12,intelligence:18,wisdom:12,charisma:10,hp:32,maxHp:32,ac:14,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["spell","attack","defend"],equipment:{weapon:{name:"Staff",damageBonus:0},armor:{name:"Robe",defenseBonus:2},focus:{name:"Arcane Focus",spellBonus:1}}},Rogue:{id:"test_rogue_1",name:"Test Rogue",level:5,class:"Rogue",strength:12,dexterity:18,constitution:14,intelligence:12,wisdom:10,charisma:14,hp:38,maxHp:38,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Daggers",damageBonus:1},armor:{name:"Leather Armor",defenseBonus:2},tools:{name:"Thieves Tools",utilityBonus:2}}},Cleric:{id:"test_cleric_1",name:"Test Cleric",level:5,class:"Cleric",strength:14,dexterity:10,constitution:16,intelligence:12,wisdom:18,charisma:12,hp:42,maxHp:42,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["spell","attack","defend"],equipment:{weapon:{name:"Mace",damageBonus:1},armor:{name:"Scale Mail",defenseBonus:3},holySymbol:{name:"Holy Symbol",spellBonus:1}}},Ranger:{id:"test_ranger_1",name:"Test Ranger",level:5,class:"Ranger",strength:14,dexterity:16,constitution:14,intelligence:12,wisdom:16,charisma:10,hp:40,maxHp:40,ac:15,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Longbow",damageBonus:1},armor:{name:"Studded Leather",defenseBonus:2},companion:{name:"Wolf Companion",utilityBonus:1}}},Paladin:{id:"test_paladin_1",name:"Test Paladin",level:5,class:"Paladin",strength:16,dexterity:10,constitution:16,intelligence:10,wisdom:12,charisma:16,hp:44,maxHp:44,ac:17,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","defend"],equipment:{weapon:{name:"Greatsword",damageBonus:2},armor:{name:"Plate Mail",defenseBonus:5},holySymbol:{name:"Holy Symbol",spellBonus:1}}}}[N],y=Q=>{s(Q.storyContext),n(Q.suggestedAction)},T=async()=>{if(e.trim())try{const Q={environmentalFeatures:I(r),npcs:ke(r),circumstances:Oe(r)},W=SR.validatePlayerAction(e,v,Q);S(W);const X=C(e,r,W);if(X.shouldInitiate){const le=A(X.enemyType,X.specificEnemyName);if(console.log("Combat detected, generated enemies:",le),a({type:"combat",message:` Combat Detected! ${X.reason==="action_triggered_combat"?"Your action has triggered combat with the enemies in the area.":"The situation has escalated to combat."}`,context:Q,enemyType:X.enemyType,enemies:le,storyContext:r}),W.valid&&W.diceResult){const pe=(W.diceResult.actions||[]).filter(Ee=>Ee.type!==void 0);if(pe.length>0){const Ee=Id.performActionSequence(v,pe,Q);k(Ee),f(!0)}}}else if(W.valid){if(W.diceResult){const pe=(W.diceResult.actions||[]).filter(Ee=>Ee.type!==void 0);if(pe.length>0){const Ee=Id.performActionSequence(v,pe,Q);k(Ee),f(!0)}else a({type:"invalid",message:"No valid actions detected. Try a different action or rephrase your input.",context:Q})}else a({type:"simple",message:`The ${v.name} performs the action successfully.`,context:Q});const le=P(W,v,Q);a(pe=>({...pe,message:le}))}else{const le=P(W,v,Q);a({type:"invalid",message:le,context:Q})}u(!0)}catch(Q){console.error("Error processing test message:",Q),a({type:"error",message:"An error occurred while processing your action."})}},C=(Q,W,X)=>{var ut,cn;const le=["attack","fight","battle","combat","strike","slash","stab","shoot","cast spell","fire spell","magic"],pe=["enemy","monster","goblin","orc","troll","dragon","bandit","skeleton","zombie","priest","boss","creature","beast","fiend","demon","devil","ghost","spirit","undead","abomination","horror","terror","nightmare","phantom","specter","wraith","lich","vampire","werewolf","shapeshifter","elemental","construct"],Ee=le.some(ge=>Q.toLowerCase().includes(ge)),ae=W.toLowerCase(),fe=pe.some(ge=>ae.includes(ge))||ae.includes("hostile")||ae.includes("aggressive")||ae.includes("snarls")||ae.includes("chanting")||ae.includes("combat trigger")||ae.includes("mini-boss")||ae.includes("boss")||/\b(?:the\s+)?(\w+)\s+(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster)\b/i.test(W)||ae.includes("raises")&&ae.includes("staff")||ae.includes("emerges")&&ae.includes("mist")||ae.includes("glowing")&&ae.includes("eyes"),be=(cn=(ut=X==null?void 0:X.diceResult)==null?void 0:ut.actions)==null?void 0:cn.some(ge=>["attack","spell","dodge","parry","cast"].includes(ge.action));let _e="bandit",Ae=null;const me=W.match(/\b(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster|boss)\b/i);return me&&(Ae=me[1]),ae.includes("drowned priest")&&(Ae="Drowned Priest",_e="priest"),ae.includes("goblin")?_e="goblin":ae.includes("orc")?_e="orc":ae.includes("troll")?_e="troll":ae.includes("dragon")?_e="dragon":ae.includes("undead")||ae.includes("skeleton")||ae.includes("zombie")?_e="skeleton":ae.includes("priest")||ae.includes("cleric")||ae.includes("paladin")?_e="priest":ae.includes("wizard")||ae.includes("mage")||ae.includes("sorcerer")?_e="wizard":ae.includes("dragon")||ae.includes("wyrm")||ae.includes("wyvern")?_e="dragon":(ae.includes("boss")||ae.includes("mini-boss"))&&(_e="boss"),Ae&&_e==="bandit"&&(_e="boss"),{shouldInitiate:Ee&&fe||be&&fe,reason:Ee?"action_triggered_combat":"context_triggered_combat",enemyType:_e,specificEnemyName:Ae}},A=(Q="bandit",W=null)=>{const X={goblin:{name:"Goblin",hp:12,ac:14,level:1,strength:8,dexterity:14,constitution:10,intelligence:10,wisdom:8,charisma:8},orc:{name:"Orc",hp:30,ac:16,level:3,strength:16,dexterity:12,constitution:16,intelligence:7,wisdom:11,charisma:10},troll:{name:"Troll",hp:84,ac:15,level:5,strength:18,dexterity:13,constitution:20,intelligence:7,wisdom:9,charisma:7},dragon:{name:"Dragon",hp:200,ac:19,level:10,strength:27,dexterity:14,constitution:25,intelligence:16,wisdom:13,charisma:15},bandit:{name:"Bandit",hp:16,ac:12,level:1,strength:12,dexterity:12,constitution:12,intelligence:10,wisdom:10,charisma:10},skeleton:{name:"Skeleton",hp:13,ac:13,level:1,strength:10,dexterity:14,constitution:15,intelligence:6,wisdom:8,charisma:5},zombie:{name:"Zombie",hp:22,ac:8,level:1,strength:13,dexterity:6,constitution:16,intelligence:3,wisdom:6,charisma:5},priest:{name:"Priest",hp:45,ac:16,level:5,strength:12,dexterity:10,constitution:14,intelligence:12,wisdom:16,charisma:14},wizard:{name:"Wizard",hp:40,ac:15,level:5,strength:9,dexterity:14,constitution:12,intelligence:16,wisdom:12,charisma:10},boss:{name:"Boss",hp:120,ac:18,level:8,strength:18,dexterity:16,constitution:18,intelligence:14,wisdom:16,charisma:16},undead:{name:"Undead",hp:15,ac:12,level:1,strength:12,dexterity:10,constitution:14,intelligence:6,wisdom:8,charisma:5}},le=X[Q]||X.bandit;let pe=1,Ee=!1;W||Q==="boss"?(Ee=!0,pe=1):pe=Math.min(3,4);const ae=[];for(let fe=0;fe<pe;fe++){let be,_e=le.hp,Ae=le.ac,me=le.level,ut=Q;W?(be=W,_e=Math.max(le.hp*2,80),Ae=le.ac+2,me=Math.max(le.level+2,7),ut="boss"):Ee?(be="Drowned Priest",_e=Math.max(le.hp*2,80),Ae=le.ac+2,me=Math.max(le.level+2,7),ut="boss"):(be=`${le.name} ${fe+1}`,_e=le.hp+Math.floor(Math.random()*10),Ae=le.ac+Math.floor(Math.random()*3)),ae.push({id:`enemy_${fe}`,name:be,type:le.name,class:ut,hp:_e,maxHp:_e,ac:Ae,level:me,strength:le.strength,dexterity:le.dexterity,constitution:le.constitution,intelligence:le.intelligence,wisdom:le.wisdom,charisma:le.charisma,initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","special","defend"]})}if(W==="Drowned Priest"||Ee&&Q==="priest")for(let be=0;be<2;be++)ae.push({id:`enemy_minion_${be}`,name:`Undead Minion ${be+1}`,type:"Skeleton",class:"undead",hp:15+Math.floor(Math.random()*8),maxHp:15+Math.floor(Math.random()*8),ac:12+Math.floor(Math.random()*3),level:1,strength:12,dexterity:10,constitution:14,intelligence:6,wisdom:8,charisma:5,initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","defend"]});return ae},P=(Q,W,X)=>{const{environmentalFeatures:le,npcs:pe,circumstances:Ee}=X,ae=pe.some(be=>be.role==="enemy")||le.some(be=>["dangerous","hostile","threatening","eerie","creepy"].includes(be));let fe="";if(Q.valid)if(Q.diceResult){const be=Q.diceResult.actions||[],_e=be.length;if(ae){if(fe=`The ${W.name} ${be.map(me=>me.action).join(" and ")} with determination. `,le.length>0){const me=le.filter(ut=>["dark","fog","mist","eerie","creepy","dangerous"].includes(ut));me.length>0&&(fe+=`The ${me.join(" and ")} ${me.length===1?"adds":"add"} to the tension. `)}const Ae=pe.filter(me=>me.role==="enemy");if(Ae.length>0){const me=Ae.map(ut=>ut.name).join(", ");fe+=`${me} ${Ae.length===1?"reacts":"react"} with ${["hostility","anger","defiance","malice"].sort(()=>.5-Math.random())[0]}. `}_e>1&&(fe+="Multiple actions detected - this complex maneuver will require precise timing and coordination. "),fe+=`

The outcome hangs in the balance. Roll the dice to determine your fate.`}else{if(fe=`The ${W.name} prepares to ${be.map(Ae=>Ae.action).join(" and ")}. `,_e>1&&(fe+="Multiple actions detected - this will require careful coordination and may incur fatigue penalties. "),le.length>0&&(fe+=`The ${le.join(" and ")} ${le.length===1?"affects":"affect"} the situation. `),pe.length>0){const Ae=pe.map(me=>me.name).join(", ");fe+=`${Ae} ${pe.length===1?"watches":"watch"} with interest. `}Ee.length>0&&(fe+=`The circumstances (${Ee.join(", ")}) ${Ee.length===1?"adds":"add"} complexity to the action. `),fe+=`

Roll the dice to determine the outcome of this challenging action.`}}else if(ae){fe=`${W.name}'s action is straightforward but the situation remains tense. `;const be=pe.filter(_e=>_e.role==="enemy");if(be.length>0){const _e=be.map(Ae=>Ae.name).join(", ");fe+=`${_e} ${be.length===1?"maintains":"maintain"} a defensive stance. `}fe+=`

The action proceeds, but danger still lurks nearby.`}else{if(fe=`${W.name}'s action is straightforward and doesn't require a skill check. `,le.length>0&&(fe+=`The ${le.join(" and ")} ${le.length===1?"provides":"provide"} a suitable backdrop. `),pe.length>0){const be=pe.map(_e=>_e.name).join(", ");fe+=`${be} ${pe.length===1?"responds":"respond"} appropriately to the action. `}fe+=`

The action proceeds smoothly.`}else ae?(fe="The proposed action doesn't seem feasible in this dangerous situation. ",Q.reason&&(fe+=`${Q.reason} `),fe+=`

In combat, every action must be precise and deliberate. Consider a different approach.`):(fe="The proposed action doesn't seem feasible. ",Q.reason&&(fe+=`${Q.reason} `),fe+=`

Try a different approach or rephrase your action.`);return fe},I=Q=>{if(!Q)return[];const W=Q.toLowerCase(),X=[];return(W.includes("dark")||W.includes("shadow"))&&X.push("darkness"),(W.includes("fog")||W.includes("mist"))&&X.push("fog"),(W.includes("forest")||W.includes("tree"))&&X.push("forest"),(W.includes("cave")||W.includes("cavern"))&&X.push("cave"),(W.includes("tavern")||W.includes("inn"))&&X.push("tavern"),(W.includes("castle")||W.includes("fortress"))&&X.push("castle"),(W.includes("dungeon")||W.includes("underground"))&&X.push("dungeon"),(W.includes("water")||W.includes("swamp"))&&X.push("water"),(W.includes("fire")||W.includes("flame"))&&X.push("fire"),(W.includes("ice")||W.includes("cold"))&&X.push("ice"),(W.includes("wind")||W.includes("storm"))&&X.push("wind"),(W.includes("eerie")||W.includes("creepy"))&&X.push("eerie"),(W.includes("dangerous")||W.includes("hostile"))&&X.push("dangerous"),X},ke=Q=>{if(!Q)return[];const W=[],X=Q.toLowerCase();return X.includes("drowned priest")&&W.push({name:"Drowned Priest",role:"enemy",type:"boss"}),X.includes("goblin")&&W.push({name:"Goblin Archers",role:"enemy",type:"goblin"}),X.includes("bandit")&&W.push({name:"Bandit Leader",role:"enemy",type:"bandit"}),(X.includes("undead")||X.includes("skeleton")||X.includes("zombie"))&&W.push({name:"Undead Minions",role:"enemy",type:"undead"}),(X.includes("patron")||X.includes("customer"))&&W.push({name:"Tavern Patrons",role:"friendly",type:"civilian"}),(X.includes("party")||X.includes("companion"))&&W.push({name:"Party Members",role:"ally",type:"adventurer"}),W},Oe=Q=>{if(!Q)return[];const W=[],X=Q.toLowerCase();return(X.includes("dark")||X.includes("night"))&&W.push("low visibility"),(X.includes("wet")||X.includes("slippery"))&&W.push("difficult footing"),(X.includes("crowded")||X.includes("tight"))&&W.push("confined space"),(X.includes("noisy")||X.includes("loud"))&&W.push("distracting environment"),(X.includes("hurry")||X.includes("rush"))&&W.push("time pressure"),(X.includes("stealth")||X.includes("sneak"))&&W.push("stealth required"),W},$e=()=>{u(!1)},qe=()=>{f(!1)},J=async()=>{var Q,W;if((i==null?void 0:i.type)==="combat")console.log("Combat detected, preparing to navigate with data:",{partyMembers:[v],enemies:i.enemies,storyContext:i.storyContext,enemyCount:(Q=i.enemies)==null?void 0:Q.length}),t("/combat",{state:{isTestCombat:!0,partyMembers:[v],enemies:i.enemies,storyContext:i.storyContext}});else if(E&&E.actions&&E.actions.length>1){const X=Id.performMultipleSkillChecks(v,"attack",3,((W=i==null?void 0:i.context)==null?void 0:W.circumstances)||[]);x(X),g(!0)}f(!1)},re=()=>{u(!1),f(!1),a(null)},ue=()=>{t("/dashboard")};return o.jsx("div",{className:"min-h-screen bg-gray-100",children:o.jsxs("div",{className:"container mx-auto px-4 py-8",children:[o.jsxs("div",{className:"mb-8",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Test Environment"}),o.jsx("button",{onClick:ue,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Back to Dashboard"})]}),o.jsx("p",{className:"text-gray-600 mt-2",children:"Test action validation, dice rolling, and combat detection in a controlled environment."})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Character Class"}),o.jsxs("select",{value:N,onChange:Q=>M(Q.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[o.jsx("option",{value:"Fighter",children:" Fighter"}),o.jsx("option",{value:"Wizard",children:" Wizard"}),o.jsx("option",{value:"Rogue",children:" Rogue"}),o.jsx("option",{value:"Cleric",children:" Cleric"}),o.jsx("option",{value:"Ranger",children:" Ranger"}),o.jsx("option",{value:"Paladin",children:" Paladin"})]}),o.jsxs("div",{className:"mt-3 p-3 bg-white border border-gray-300 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:v.name}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("strong",{children:"HP:"})," ",v.hp,"/",v.maxHp]}),o.jsxs("div",{children:[o.jsx("strong",{children:"AC:"})," ",v.ac]}),o.jsxs("div",{children:[o.jsx("strong",{children:"STR:"})," ",v.strength]}),o.jsxs("div",{children:[o.jsx("strong",{children:"DEX:"})," ",v.dexterity]}),o.jsxs("div",{children:[o.jsx("strong",{children:"CON:"})," ",v.constitution]}),o.jsxs("div",{children:[o.jsx("strong",{children:"INT:"})," ",v.intelligence]}),o.jsxs("div",{children:[o.jsx("strong",{children:"WIS:"})," ",v.wisdom]}),o.jsxs("div",{children:[o.jsx("strong",{children:"CHA:"})," ",v.charisma]})]}),o.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[o.jsx("strong",{children:"Equipment:"})," ",v.equipment.weapon.name,", ",v.equipment.armor.name]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quick Test Scenarios"}),o.jsx("div",{className:"space-y-2",children:D.map((Q,W)=>o.jsxs("button",{onClick:()=>y(Q),className:"w-full p-3 text-left bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[o.jsx("div",{className:"font-medium text-gray-800",children:Q.name}),o.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[Q.storyContext.substring(0,80),"..."]})]},W))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Story Context"}),o.jsx("textarea",{value:r,onChange:Q=>s(Q.target.value),placeholder:"Describe the environment, NPCs, and circumstances. For example: 'In a dark, misty swamp, a Drowned Priest emerges from the water, chanting dark spells. The air is thick with malevolence.'",className:"w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Character Action"}),o.jsx("textarea",{value:e,onChange:Q=>n(Q.target.value),placeholder:"Describe any action your character would take. The system will analyze it for skill checks, combat actions, or story interactions.",className:"w-full h-24 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),o.jsx("button",{onClick:T,disabled:!e.trim(),className:"w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:"Test Action"})]}),o.jsx("div",{className:"space-y-6",children:i&&o.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[i.type==="combat"&&o.jsx("span",{className:"text-2xl mr-2",children:""}),o.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:i.type==="combat"?"Combat Detected":i.type==="story"?"Story Response":i.type==="invalid"?"Invalid Action":"Test Result"})]}),o.jsxs("div",{className:"prose max-w-none",children:[o.jsx("p",{className:"text-gray-700 mb-4",children:i.message}),i.type==="combat"&&o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[o.jsx("h4",{className:"text-lg font-bold text-red-800",children:"Combat Initiated!"}),o.jsxs("p",{className:"text-red-700 mb-2",children:["Enemy Type: ",i.enemyType]}),o.jsx("div",{className:"space-y-2",children:i.enemies.map((Q,W)=>o.jsxs("div",{className:"flex justify-between items-center bg-white p-2 rounded",children:[o.jsx("span",{className:"font-medium",children:Q.name}),o.jsxs("span",{className:"text-sm text-gray-600",children:["HP: ",Q.hp," | AC: ",Q.ac," | Level: ",Q.level]})]},W))}),o.jsx("button",{onClick:()=>t("/combat",{state:{isTestCombat:!0,partyMembers:[v],enemies:i.enemies,storyContext:i.storyContext}}),className:"mt-3 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Enter Combat"})]}),i.context&&o.jsxs("div",{className:"mt-4 space-y-2",children:[o.jsx("h5",{className:"font-semibold text-gray-800",children:"Context Analysis:"}),i.context.environmentalFeatures.length>0&&o.jsxs("p",{children:[o.jsx("strong",{children:"Environment:"})," ",i.context.environmentalFeatures.join(", ")]}),i.context.npcs.length>0&&o.jsxs("p",{children:[o.jsx("strong",{children:"NPCs:"})," ",i.context.npcs.map(Q=>`${Q.name} (${Q.role})`).join(", ")]})]})]})]})})]}),l&&b&&o.jsx(tb,{result:b,onClose:$e,onProceed:J,onRevise:re}),d&&E&&o.jsx(nb,{result:E,onClose:qe,onProceed:J,onRevise:re}),m&&_&&o.jsx(TR,{result:_,onClose:()=>g(!1)})]})})}const IR="https://dnd-v1-backend.onrender.com",Yt=async(t,e="gpt-4",n=1e3,r=.8)=>{try{const s=await fetch(`${IR}/api/openai`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t,model:e,max_tokens:n,temperature:r})});if(!s.ok){const a=await s.json();throw new Error(a.error||"Backend API request failed")}return await s.json()}catch(s){throw console.error("Backend API Error:",s),new Error(`Failed to communicate with backend: ${s.message}`)}};class NR{constructor(){this.systemPrompt=`You are an experienced Dungeon Master for Dungeons & Dragons 5th Edition. You excel at:
- Creating engaging storylines and plot hooks
- Developing detailed character descriptions and backstories
- Generating multiple story options and summarizing them
- Providing atmospheric descriptions and immersive storytelling
- Balancing combat encounters and managing game mechanics
- Creating memorable NPCs and villains
- Adapting to player choices and creating dynamic narratives
- Maintaining story consistency and character development
- Building upon established relationships and plot threads

Always respond in character as a Dungeon Master, providing rich, descriptive content that enhances the gaming experience. Maintain consistency with previous story elements, character relationships, and established plot threads.`,this.diceService=new Iu,this.actionValidationService=new Gm}async generateStoryPlots(e,n="",r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class} (${u.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 3 different story plot options for a D&D campaign.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

For each plot option, provide:
1. A compelling title
2. A brief summary (2-3 sentences)
3. The main conflict or challenge
4. Potential story hooks for the party
5. Estimated campaign length (short, medium, or long)

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1e3,.8)).choices[0].message.content}catch(s){throw new Error(`Failed to generate story plots: ${s.message}`)}}async generateCharacterDetails(e){try{const n=`As a Dungeon Master, I need you to expand on this character's details and create a rich, detailed description.

Character: ${e.name} - Level ${e.level} ${e.race} ${e.class}
Background: ${e.background}
Alignment: ${e.alignment}
Personality: ${e.personality||"Not specified"}
Ideals: ${e.ideals||"Not specified"}
Bonds: ${e.bonds||"Not specified"}
Flaws: ${e.flaws||"Not specified"}
Backstory: ${e.backstory||"Not specified"}

Please provide:
1. A detailed physical description (appearance, mannerisms, distinctive features)
2. An expanded personality profile with quirks and habits
3. A deeper backstory with key events and relationships
4. Character motivations and goals
5. Potential story hooks and plot threads related to this character
6. How this character might interact with the party and world

Make the character feel alive and three-dimensional, with details that could drive story development.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:n}],"gpt-4",800,.7)).choices[0].message.content}catch(n){throw console.error("Error generating character details:",n),new Error(`Failed to generate character details: ${n.message}`)}}async generateStorySummary(e,n){try{const r=n.map(a=>`${a.name} (${a.race} ${a.class})`).join(", "),s=`As a Dungeon Master, I need you to create a detailed story summary and outline for this campaign plot.

Plot: ${e}
Party: ${r}

Please provide:
1. A detailed campaign overview (3-4 paragraphs)
2. Key story beats and major events
3. Important NPCs and their roles
4. Potential challenges and obstacles
5. Story themes and motifs
6. How each party member might be personally invested
7. Potential branching paths and player choices
8. Climactic moments and resolution possibilities

Make this feel like a professional campaign module with rich storytelling potential.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:s}],"gpt-4",1200,.7)).choices[0].message.content}catch(r){throw console.error("Error generating story summary:",r),new Error(`Failed to generate story summary: ${r.message}`)}}async generateMultipleStoryPlots(e,n="",r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class} (${u.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 5 different story plot options for a D&D campaign, each with a detailed summary.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

For each of the 5 plot options, provide:
1. A compelling title
2. A detailed summary (3-4 paragraphs)
3. The main conflict or challenge
4. Key story beats and major events
5. Important NPCs and their roles
6. Potential story hooks for the party
7. Estimated campaign length (short, medium, or long)
8. Themes and motifs
9. How each party member might be personally invested

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options. Number each plot clearly (Plot 1, Plot 2, etc.).`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1500,.8)).choices[0].message.content}catch(s){throw console.error("Error generating multiple story plots:",s),new Error(`Failed to generate multiple story plots: ${s.message}`)}}async generateNPC(e,n=""){try{const r=`As a Dungeon Master, I need you to create a detailed NPC for this role and context.

NPC Role: ${e}
Context: ${n||"General campaign context"}

Please provide:
1. A detailed physical description
2. Personality traits and mannerisms
3. Background and motivations
4. Current situation and goals
5. How they might interact with the party
6. Potential story hooks or plot threads they could introduce
7. Their relationship to the world and other NPCs
8. Any secrets or hidden aspects of their character

Make this NPC feel like a real person with depth and complexity.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:r}],"gpt-4",800,.7)).choices[0].message.content}catch(r){throw console.error("Error generating NPC:",r),new Error(`Failed to generate NPC: ${r.message}`)}}async generateCombatEncounter(e,n,r="medium",s=""){try{const i=`As a Dungeon Master, I need you to create a detailed combat encounter.

Party Level: ${e}
Party Size: ${n}
Difficulty: ${r}
Theme: ${s||"General fantasy"}

Please provide:
1. A detailed description of the encounter location
2. Enemy types and their motivations
3. Tactical considerations and terrain features
4. Potential story elements or plot hooks
5. Non-combat resolution options
6. Consequences of victory or defeat
7. Environmental hazards or advantages
8. How this encounter fits into the larger story

Make this encounter feel meaningful and story-driven, not just a random fight.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:i}],"gpt-4",800,.7)).choices[0].message.content}catch(i){throw console.error("Error generating combat encounter:",i),new Error(`Failed to generate combat encounter: ${i.message}`)}}async generateStoryContinuation(e,n,r,s=null,i="individual",a=null){var l,u,d,f,m;try{const g=e.map(D=>`${D.name} - Level ${D.level} ${D.race} ${D.class}`).join(", ");let b=null,S=null,E="";if(i==="individual"){const D=e[e.length-1];if(D)if(b=this.actionValidationService.validatePlayerAction(r,D,{context:"story",storyState:s}),b.valid&&b.diceResult){if(S=b.diceResult,S.overallSuccess){if(E=`

ACTION VALIDATION: The action is within your character's capabilities.`,S.actions){const U=S.actions.map(v=>`${v.action}: ${v.check.isSuccess?"Success":"Failure"} (Roll: ${v.check.roll}, DC: ${v.check.dc})`).join(", ");E+=`
Dice Results: ${U}`}}else if(E=`

ACTION VALIDATION: Some aspects of this action are challenging for your character.`,S.actions){const v=S.actions.filter(y=>!y.check.isSuccess).map(y=>`${y.action}: Failure (Roll: ${y.check.roll}, DC: ${y.check.dc})`).join(", ");E+=`
Failed Actions: ${v}`}}else b.valid||(E=`

ACTION VALIDATION: ${b.response}`,b.suggestion&&(E+=`
Suggestion: ${b.suggestion}`))}const k=n.map(D=>({role:D.role,content:D.content}));let _="";a&&(_=`
Party Theme: ${a.description||"No theme provided"}`);let x="";s&&(x=`
STORY STATE CONTEXT:
Current Location: ${((l=s.currentLocation)==null?void 0:l.name)||"Unknown"} - ${((u=s.currentLocation)==null?void 0:u.description)||""}
Active NPCs: ${Object.keys(s.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((d=s.activePlotThreads)==null?void 0:d.map(D=>`${D.title} (${Math.round(D.progress*100)}%)`).join(", "))||"None"}
Recent Events: ${((m=(f=s.worldState)==null?void 0:f.recentEvents)==null?void 0:m.slice(-3).map(D=>D.event).join(", "))||"None"}

CHARACTER RELATIONSHIPS:
${e.map(D=>{var y;const U=((y=s.characterArcs)==null?void 0:y[D.id])||{},v=Object.entries(U.relationships||{}).map(([T,C])=>`${T} (${C})`).join(", ");return`${D.name}: ${v||"No established relationships"}`}).join(`
`)}

NPC CONTEXT:
${Object.entries(s.activeNPCs||{}).map(([D,U])=>{var v;return`${D}: ${U.disposition} disposition, knowledge: ${((v=U.knowledge)==null?void 0:v.join(", "))||"none"}, goal: ${U.currentGoal||"unknown"}`}).join(`
`)}`);const N=`As a Dungeon Master, continue the story based on the player's response.

Party: ${g}${_}
Player Response: "${r}" (Type: ${i})
Response Type Context:
- individual: One character's personal action
- team: Group action or decision
- investigate: Looking for clues or information
- combat: Combat-related action
- social: Social interaction or diplomacy${x}

Previous Story Context:
${k.map(D=>`${D.role==="assistant"?"DM":"Player"}: ${D.content}`).join(`
`)}

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

ACTION VALIDATION GUIDELINES:
- If the action validation shows the action is impossible, gently redirect the player while maintaining story flow
- If the action validation shows the action is challenging, incorporate the difficulty into the narrative
- If the action validation shows the action is successful, proceed with the action as described
- Always maintain story coherence and character consistency
- Use the validation results to inform how the action plays out in the story

Please provide a compelling continuation that:
1. Acknowledges the player's action in context of the current situation and location
2. References relevant NPCs and their established relationships with the party
3. Continues or advances active plot threads appropriately
4. Updates character relationships based on the action
5. Maintains location and atmosphere consistency
6. Ends with a clear situation that invites the next player to respond
7. Encourages character interaction and roleplay
8. Provides multiple possible directions for the party to explore
9. Builds upon the established story state and character development
10. Incorporates action validation results naturally into the narrative

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.${E}`;return{content:(await Yt([{role:"system",content:this.systemPrompt},...k,{role:"user",content:N}],"gpt-4",800,.8)).choices[0].message.content,actionValidation:b,diceResult:S}}catch(g){throw console.error("Error generating story continuation:",g),new Error(`Failed to generate story continuation: ${g.message}`)}}async generatePlotOptions(e,n=null){try{const r=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class}. ${u.personality||""}. ${u.backstory||""}`).join(`
`);let s="";n&&(s=`
Party Theme: ${n.description||"No theme provided"}`);const i="You are a Dungeon Master for D&D 5e. You MUST generate exactly 3 plot options, no more, no less. Follow the exact format provided. Do not use party names in the plots. Keep summaries brief (1-2 sentences maximum). DO NOT repeat plots or generate duplicates.",a=`Generate exactly 3 distinct campaign plot options for this party. 

REQUIRED FORMAT - Follow this exact structure:

Plot 1: [Title]
[Brief summary - 1-2 sentences maximum]

Plot 2: [Title]  
[Brief summary - 1-2 sentences maximum]

Plot 3: [Title]
[Brief summary - 1-2 sentences maximum]

Party: ${r}${s}

CRITICAL REQUIREMENTS:
- Generate EXACTLY 3 plots, no more, no less
- Use the party theme to influence the plot lines and atmosphere
- Do NOT use the party name in the plots - focus on the characters and theme
- Each summary must be 1-2 sentences maximum
- Follow the exact format above with "Plot 1:", "Plot 2:", "Plot 3:" labels
- Do not add any additional text, explanations, or formatting
- Do not repeat or duplicate any plots
- Stop after Plot 3 - do not generate more plots

Make each plot distinct and appealing to different play styles.`;return(await Yt([{role:"system",content:i},{role:"user",content:a}],"gpt-4",600,.8)).choices[0].message.content}catch(r){throw console.error("Error generating plot options:",r),new Error(`Failed to generate plot options: ${r.message}`)}}async generateStoryIntroduction(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}. ${d.personality||""}. ${d.backstory||""}`).join(`
`);let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create an engaging story introduction for the beginning of this campaign.

Party: ${i}${a}
Selected Plot: Plot ${r}
Plot Details: ${n}

Create an introduction that includes:
1. A vivid description of the starting town/settlement where the party begins
2. How each character arrives or is already present in this location
3. The initial situation or hook that draws the party together
4. A sense of atmosphere and setting that matches the chosen plot
5. An opening scene that gives the party their first decision or action to take

Important Guidelines:
- Use the party theme to influence the atmosphere and context
- Incorporate themes and elements from the party theme to create atmosphere and context
- Consider how the party's background and composition might influence the starting situation
- Focus on the characters and their individual stories
- The story should feel cohesive with the established theme

Make this feel like the opening of an epic adventure. Set the tone, establish the setting, and give the party a clear starting point. End with a situation that requires the party to make a choice or take action.

Keep the introduction engaging but concise (3-4 paragraphs maximum).`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",800,.8)).choices[0].message.content}catch(i){throw console.error("Error generating story introduction:",i),new Error(`Failed to generate story introduction: ${i.message}`)}}async generateStructuredStoryResponse(e,n,r,s,i,a=null,l=null){var u,d,f;try{const m=e.map(x=>`${x.name} - Level ${x.level} ${x.race} ${x.class}`).join(", "),g=n.map(x=>({role:x.role,content:x.content}));let b="";l&&(b=`
Party Theme: ${l.description||"No theme provided"}`);const S=i.length>0?`
Discovered Objectives: ${i.map(x=>x.title).join(", ")}`:"";let E="";a&&(E=`
STORY STATE CONTEXT:
Current Location: ${((u=a.currentLocation)==null?void 0:u.name)||"Unknown"} - ${((d=a.currentLocation)==null?void 0:d.description)||""}
Active NPCs: ${Object.keys(a.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((f=a.activePlotThreads)==null?void 0:f.map(x=>`${x.title} (${Math.round(x.progress*100)}%)`).join(", "))||"None"}
Character Relationships: ${Object.entries(a.characterArcs||{}).map(([x,N])=>{const M=e.find(D=>D.id===x);return`${M==null?void 0:M.name}: ${Object.entries(N.relationships||{}).map(([D,U])=>`${D} (${U})`).join(", ")||"No relationships"}`}).join("; ")}`);const k=`As a Dungeon Master, continue the story based on the player's response, considering the current story phase and discovered objectives.

Party: ${m}${b}
Current Phase: ${s}
Player Response: "${r}"${S}${E}

Story Phases:
- Investigation: Focus on discovery, clues, and gathering information
- Conflict: Focus on tension, threats, and potential combat
- Resolution: Focus on choices, consequences, and story conclusion

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

Please provide a compelling continuation that:
1. Acknowledges the player's action in context of the current situation and location
2. References relevant NPCs and their established relationships with the party
3. Continues or advances active plot threads appropriately
4. Updates character relationships based on the action
5. Maintains location and atmosphere consistency
6. Ends with a clear situation that invites the next player to respond
7. Encourages character interaction and roleplay
8. Provides multiple possible directions for the party to explore
9. Builds upon the established story state and character development

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.`;return(await Yt([{role:"system",content:this.systemPrompt},...g,{role:"user",content:k}],"gpt-4",800,.8)).choices[0].message.content}catch(m){throw console.error("Error generating structured story response:",m),new Error(`Failed to generate structured story response: ${m.message}`)}}async generatePhaseTransition(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create a phase transition message for the story.

Party: ${i}${a}
Current Phase: ${n}
Story Progress: ${r}

Create a transition that:
1. Acknowledges the progress made so far
2. Signals the shift to the new phase
3. Sets up the new challenges and opportunities
4. Maintains the established tone and atmosphere
5. Gives the party clear direction for the next phase

Make this feel like a natural progression in the story.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating phase transition:",i),new Error(`Failed to generate phase transition: ${i.message}`)}}async generateObjectiveCompletion(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create a completion message for an objective.

Party: ${i}${a}
Completed Objective: ${n.title}
Story Context: ${r}

Create a completion message that:
1. Celebrates the achievement
2. Provides closure for this objective
3. Sets up the next challenge or objective
4. Maintains story momentum
5. Acknowledges the party's efforts

Make this feel rewarding and meaningful.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating objective completion:",i),new Error(`Failed to generate objective completion: ${i.message}`)}}async generateCampaignContinuation(e,n,r,s,i=null){try{const a=e.map(m=>`${m.name} - Level ${m.level} ${m.race} ${m.class}`).join(", "),l=r.map(m=>({role:m.role,content:m.content}));let u="";i&&(u=`
Party Theme: ${i.description||"No theme provided"}`);const d=`As a Dungeon Master, continue the ongoing campaign story.

Party: ${a}${u}
Campaign Goal: ${n.mainGoal||"No specific goal"}
Campaign Progress: ${n.campaignProgress||"Beginning"}
Player Response: "${s}"

Previous Story Context:
${l.map(m=>`${m.role==="assistant"?"DM":"Player"}: ${m.content}`).join(`
`)}

Continue the story while:
1. Building toward the main campaign goal
2. Maintaining consistency with previous events
3. Developing character relationships and arcs
4. Creating meaningful choices and consequences
5. Advancing the overall plot

Keep your response engaging but concise (2-3 paragraphs maximum).`;return(await Yt([{role:"system",content:this.systemPrompt},...l,{role:"user",content:d}],"gpt-4",800,.8)).choices[0].message.content}catch(a){throw console.error("Error generating campaign continuation:",a),new Error(`Failed to generate campaign continuation: ${a.message}`)}}async generateCampaignGoal(e,n,r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class}`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, create a clear campaign goal based on the selected plot.

Party: ${s}${i}
Plot Content: ${n}

Create a campaign goal that:
1. Is clear and achievable
2. Provides direction for the entire campaign
3. Involves all party members
4. Has multiple possible paths to completion
5. Creates meaningful stakes and consequences

Make this goal compelling and motivating for the party.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",600,.7)).choices[0].message.content}catch(s){throw console.error("Error generating campaign goal:",s),new Error(`Failed to generate campaign goal: ${s.message}`)}}async generateSessionSummary(e,n,r,s,i=null){try{const a=s.map(f=>`${f.name} - Level ${f.level} ${f.race} ${f.class}`).join(", ");let l="";i&&(l=`
Party Theme: ${i.description||"No theme provided"}`);const u=`As a Dungeon Master, create a session summary for this campaign session.

Party: ${a}${l}
Campaign Goal: ${e.mainGoal||"No specific goal"}
Objectives: ${r.map(f=>f.title).join(", ")}
Story Messages: ${n.length} total messages

Create a summary that:
1. Recaps the major events of the session
2. Highlights character development and relationships
3. Notes progress toward objectives
4. Sets up expectations for the next session
5. Maintains the established tone and atmosphere

Make this summary engaging and informative.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:u}],"gpt-4",800,.7)).choices[0].message.content}catch(a){throw console.error("Error generating session summary:",a),new Error(`Failed to generate session summary: ${a.message}`)}}}const Qn=new NR;function PR({partyCharacters:t,onStoryGenerated:e,onCharacterDetailsGenerated:n,partyInfo:r=null}){const[s,i]=R.useState("plots"),[a,l]=R.useState(!1),[u,d]=R.useState(""),[f,m]=R.useState(""),[g,b]=R.useState(""),[S,E]=R.useState(""),[k,_]=R.useState(""),[x,N]=R.useState(""),[M,D]=R.useState({partyLevel:1,partySize:t.length,difficulty:"medium",theme:""}),U=async()=>{if(t.length===0){d("No party characters available. Please create characters first.");return}l(!0),d("");try{const P=await Qn.generateStoryPlots(t,g,r);m(P),e&&e(P)}catch{d("Failed to generate story plots. Please check your API key and try again.")}finally{l(!1)}},v=async()=>{if(t.length===0){d("No party characters available. Please create characters first.");return}l(!0),d("");try{const P=await Qn.generateMultipleStoryPlots(t,g,r);m(P),e&&e(P)}catch{d("Failed to generate story plots. Please check your API key and try again.")}finally{l(!1)}},y=async()=>{if(!S){d("Please select a character first.");return}const P=t.find(I=>I.id===S);if(!P){d("Selected character not found.");return}l(!0),d("");try{const I=await Qn.generateCharacterDetails(P);m(I),n&&n(P.id,I)}catch{d("Failed to generate character details. Please check your API key and try again.")}finally{l(!1)}},T=async()=>{if(!k.trim()){d("Please enter an NPC role.");return}l(!0),d("");try{const P=await Qn.generateNPC(k,x);m(P)}catch{d("Failed to generate NPC. Please check your API key and try again.")}finally{l(!1)}},C=async()=>{l(!0),d("");try{const P=await Qn.generateCombatEncounter(M.partyLevel,M.partySize,M.difficulty,M.theme);m(P)}catch{d("Failed to generate encounter. Please check your API key and try again.")}finally{l(!1)}},A=[{id:"plots",label:"Story Plots",icon:""},{id:"characters",label:"Character Details",icon:""},{id:"npcs",label:"NPCs",icon:""},{id:"encounters",label:"Combat Encounters",icon:""}];return o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"fantasy-title mb-0",children:" AI Dungeon Master"}),o.jsx("div",{className:"text-sm text-stone-600",children:"Powered by ChatGPT"})]}),o.jsx("div",{className:"flex space-x-1 mb-6 bg-stone-100 p-1 rounded-lg",children:A.map(P=>o.jsxs("button",{onClick:()=>i(P.id),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center space-x-2 ${s===P.id?"bg-amber-600 text-white":"text-stone-600 hover:text-stone-800"}`,children:[o.jsx("span",{children:P.icon}),o.jsx("span",{children:P.label})]},P.id))}),u&&o.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:u}),s==="plots"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Setting (Optional)"}),o.jsx("textarea",{value:g,onChange:P=>b(P.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your campaign setting, world, or any specific themes..."})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsx("button",{onClick:U,disabled:a||t.length===0,className:"fantasy-button",children:a?"Generating...":"Generate Basic Plots"}),o.jsx("button",{onClick:v,disabled:a||t.length===0,className:"fantasy-button bg-amber-700 hover:bg-amber-800",children:a?"Generating...":"Generate Detailed Plots"})]}),o.jsxs("div",{className:"text-sm text-stone-600 text-center",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Basic Plots:"})," 3 plot options with brief summaries"]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Detailed Plots:"})," 5 plot options with full story summaries and character integration"]})]}),t.length===0&&o.jsx("p",{className:"text-sm text-stone-600 text-center",children:"Create party characters first to generate story plots."})]}),s==="characters"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Select Character"}),o.jsxs("select",{value:S,onChange:P=>E(P.target.value),className:"fantasy-input",children:[o.jsx("option",{value:"",children:"Choose a character..."}),t.map(P=>o.jsxs("option",{value:P.id,children:[P.name," - ",P.race," ",P.class]},P.id))]})]}),o.jsx("button",{onClick:y,disabled:a||!S,className:"fantasy-button w-full",children:a?"Generating Details...":"Generate Character Details"})]}),s==="npcs"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"NPC Role"}),o.jsx("input",{type:"text",value:k,onChange:P=>_(P.target.value),className:"fantasy-input",placeholder:"e.g., Town Mayor, Mysterious Wizard, Bandit Leader..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Context (Optional)"}),o.jsx("textarea",{value:x,onChange:P=>N(P.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe the context, location, or situation..."})]}),o.jsx("button",{onClick:T,disabled:a||!k.trim(),className:"fantasy-button w-full",children:a?"Generating NPC...":"Generate NPC"})]}),s==="encounters"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Party Level"}),o.jsx("input",{type:"number",min:"1",max:"20",value:M.partyLevel,onChange:P=>D(I=>({...I,partyLevel:parseInt(P.target.value)})),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Party Size"}),o.jsx("input",{type:"number",min:"1",max:"10",value:M.partySize,onChange:P=>D(I=>({...I,partySize:parseInt(P.target.value)})),className:"fantasy-input"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Difficulty"}),o.jsxs("select",{value:M.difficulty,onChange:P=>D(I=>({...I,difficulty:P.target.value})),className:"fantasy-input",children:[o.jsx("option",{value:"easy",children:"Easy"}),o.jsx("option",{value:"medium",children:"Medium"}),o.jsx("option",{value:"hard",children:"Hard"}),o.jsx("option",{value:"deadly",children:"Deadly"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Theme (Optional)"}),o.jsx("input",{type:"text",value:M.theme,onChange:P=>D(I=>({...I,theme:P.target.value})),className:"fantasy-input",placeholder:"e.g., Forest ambush, Dungeon crawl..."})]})]}),o.jsx("button",{onClick:C,disabled:a,className:"fantasy-button w-full",children:a?"Generating Encounter...":"Generate Combat Encounter"})]}),f&&o.jsxs("div",{className:"mt-8",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Generated Content"}),o.jsx("button",{onClick:()=>m(""),className:"text-sm text-stone-600 hover:text-stone-800",children:"Clear"})]}),o.jsx("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:o.jsx("div",{className:"prose prose-sm max-w-none",children:o.jsx("pre",{className:"whitespace-pre-wrap text-stone-800 font-sans text-sm leading-relaxed",children:f})})})]})]})}function AR(){const{partyId:t}=iu(),e=zn(),[n,r]=R.useState(null),[s,i]=R.useState(null),[a,l]=R.useState([]),[u,d]=R.useState(null),[f,m]=R.useState(!0),[g,b]=R.useState("story"),[S,E]=R.useState({title:"",description:"",chapters:[]}),[k,_]=R.useState({image:"/placeholder-map.png",description:""});R.useEffect(()=>{const v=ai(y=>{if(!y){e("/login");return}r(y),t&&x(y.uid,t)});return()=>v()},[e,t]);const x=async(v,y)=>{try{m(!0);const[T,C,A]=await Promise.all([X_(v,y),qm(y),Z_(y)]);i(T),l(C),d(A)}catch{}finally{m(!1)}},N=[{id:"story",label:"Story Planning"},{id:"ai-dm",label:" AI Dungeon Master"},{id:"map",label:"Campaign Map"},{id:"characters",label:"Party Characters"},{id:"enemies",label:"Enemies & NPCs"}],M=()=>{const v={id:Date.now(),title:"",description:"",objectives:[],completed:!1};E(y=>({...y,chapters:[...y.chapters,v]}))},D=(v,y,T)=>{E(C=>({...C,chapters:C.chapters.map(A=>A.id===v?{...A,[y]:T}:A)}))},U=v=>{const y={id:Date.now(),description:"",completed:!1};D(v,"objectives",[...S.chapters.find(T=>T.id===v).objectives,y])};return!n||f?o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-stone-600",children:"Loading..."})})})}):s?o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:"Campaign Management"}),o.jsxs("div",{className:"text-sm text-stone-600",children:["Playing as: ",o.jsx("span",{className:"font-medium",children:s.name})]})]}),o.jsx("div",{className:"flex space-x-1 mb-6 bg-stone-100 p-1 rounded-lg",children:N.map(v=>o.jsx("button",{onClick:()=>b(v.id),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${g===v.id?"bg-amber-600 text-white":"text-stone-600 hover:text-stone-800"}`,children:v.label},v.id))}),g==="story"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Title"}),o.jsx("input",{type:"text",value:S.title,onChange:v=>E(y=>({...y,title:v.target.value})),className:"fantasy-input",placeholder:"Enter campaign title..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Description"}),o.jsx("textarea",{value:S.description,onChange:v=>E(y=>({...y,description:v.target.value})),className:"fantasy-input",rows:"4",placeholder:"Describe your campaign's main plot..."})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-stone-800",children:"Chapters"}),o.jsx("button",{onClick:M,className:"fantasy-button",children:"Add Chapter"})]}),o.jsx("div",{className:"space-y-4",children:S.chapters.map(v=>o.jsxs("div",{className:"fantasy-card bg-amber-50",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[o.jsx("input",{type:"text",value:v.title,onChange:y=>D(v.id,"title",y.target.value),className:"fantasy-input",placeholder:"Chapter title..."}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",checked:v.completed,onChange:y=>D(v.id,"completed",y.target.checked),className:"mr-2"}),o.jsx("label",{className:"text-sm font-medium text-stone-700",children:"Completed"})]})]}),o.jsx("textarea",{value:v.description,onChange:y=>D(v.id,"description",y.target.value),className:"fantasy-input mb-4",rows:"3",placeholder:"Chapter description..."}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h4",{className:"font-medium text-stone-800",children:"Objectives"}),o.jsx("button",{onClick:()=>U(v.id),className:"fantasy-button text-sm",children:"Add Objective"})]}),o.jsx("div",{className:"space-y-2",children:v.objectives.map(y=>o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{type:"checkbox",checked:y.completed,onChange:T=>{const C=v.objectives.map(A=>A.id===y.id?{...A,completed:T.target.checked}:A);D(v.id,"objectives",C)}}),o.jsx("input",{type:"text",value:y.description,onChange:T=>{const C=v.objectives.map(A=>A.id===y.id?{...A,description:T.target.value}:A);D(v.id,"objectives",C)},className:"fantasy-input flex-1",placeholder:"Objective description..."})]},y.id))})]})]},v.id))})]})]}),g==="ai-dm"&&o.jsx(PR,{partyCharacters:a,partyInfo:u,onStoryGenerated:v=>{},onCharacterDetailsGenerated:(v,y)=>{}}),g==="map"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Campaign Map"}),o.jsxs("div",{className:"bg-stone-200 rounded-lg p-8 text-center",children:[o.jsx("div",{className:"w-full h-64 bg-stone-300 rounded-lg flex items-center justify-center mb-4",children:o.jsx("span",{className:"text-stone-500",children:"Map Placeholder"})}),o.jsx("button",{className:"fantasy-button",children:"Upload Map Image"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Map Description"}),o.jsx("textarea",{value:k.description,onChange:v=>_(y=>({...y,description:v.target.value})),className:"fantasy-input",rows:"4",placeholder:"Describe the locations and points of interest on your map..."})]})]}),g==="characters"&&o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Party Characters"}),a.length===0?o.jsx("div",{className:"text-center py-8 text-stone-600",children:o.jsx("p",{children:"No characters have been created yet."})}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:a.map(v=>o.jsx("div",{className:"fantasy-card bg-amber-50",children:o.jsxs("div",{className:"flex items-start space-x-4",children:[o.jsx("div",{className:"w-16 h-16 bg-stone-300 rounded-lg flex items-center justify-center",children:o.jsx("span",{className:"text-xs text-stone-600",children:"IMG"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-bold text-stone-800",children:v.name}),o.jsxs("p",{className:"text-sm text-stone-600",children:["Level ",v.level," ",v.race," ",v.class]}),o.jsxs("p",{className:"text-sm text-stone-600 mt-1",children:[v.background,"  ",v.alignment]})]})]})},v.id))})]}),g==="enemies"&&o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Enemies & NPCs"}),o.jsx("div",{className:"text-center py-8 text-stone-600",children:o.jsx("p",{children:"Enemy and NPC management will be available here."})})]})]})}):o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-stone-600 mb-6",children:"You need to create a character before you can access the campaign."}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("button",{onClick:()=>e(`/character-creation/${t}`),className:"fantasy-button text-lg px-8 py-3",children:"Create Character"}),o.jsx("button",{onClick:()=>e("/party-management"),className:"fantasy-button text-lg px-8 py-3 bg-stone-600 hover:bg-stone-700",children:"Back to Parties"})]})]})]})})}function RR(){var sr,Lt,ze;const t=zn(),{partyId:e}=iu(),[n,r]=R.useState(null),[s,i]=R.useState(!1),[a,l]=R.useState(null),[u,d]=R.useState([]),[f,m]=R.useState(!1),[g,b]=R.useState(""),[S,E]=R.useState(!1),[k,_]=R.useState({name:"",race:"",class:"",level:1,background:"",alignment:"",strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10,age:"",height:"",weight:"",eyes:"",skin:"",hair:"",personality:"",ideals:"",bonds:"",flaws:"",backstory:"",equipment:[],spells:[],proficiencies:[],portrait:"/placeholder-character.png"}),[x,N]=R.useState("standard"),[M,D]=R.useState([]),[U,v]=R.useState([]),[y,T]=R.useState({}),[C,A]=R.useState(!1),[P,I]=R.useState({}),[ke,Oe]=R.useState([]);R.useEffect(()=>{const O=ai(te=>{if(!te){t("/login");return}r(te),e&&$e(te.uid,e),qe(te.uid)});return()=>O()},[t,e]),R.useEffect(()=>{a&&(_({...a}),a.weaponChoices&&I(a.weaponChoices),a.spellChoices&&Oe(a.spellChoices),a.abilityScoreMethod&&N(a.abilityScoreMethod),a.rolledScores&&D(a.rolledScores),a.assignedScores&&T(a.assignedScores),a.rolledScores&&A(a.rolledScores.length>0))},[a]);const $e=async(O,te)=>{try{const ve=await X_(O,te);l(ve)}catch{}},qe=async O=>{try{const te=await cR(O);d(te)}catch(te){console.error("Error loading character presets:",te)}},J=["Human","Elf","Dwarf","Halfling","Dragonborn","Tiefling","Half-Elf","Half-Orc","Gnome","Aarakocra","Genasi","Goliath"],re=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"],ue=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],Q=["Acolyte","Criminal","Folk Hero","Noble","Sage","Soldier"],W=[15,14,13,12,10,8],X={Fighter:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Paladin:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Barbarian:{"Martial Melee Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"]},Bard:{Weapon:["Rapier","Longsword"]},Druid:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Monk:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Sorcerer:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Warlock:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]}},le={Wizard:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Sorcerer:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Warlock:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Eldritch Blast",description:"A beam of crackling energy that deals force damage and can hit multiple targets."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Cleric:[{name:"Guidance",description:"Touch a creature to give them +1d4 to their next ability check."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Resistance",description:"Touch a creature to give them +1d4 to their next saving throw."},{name:"Sacred Flame",description:"Flame-like radiance descends on a creature within 60 feet, dealing radiant damage."},{name:"Spare the Dying",description:"Touch a dying creature to stabilize them at 0 hit points."},{name:"Thaumaturgy",description:"Perform minor magical tricks - make your voice boom, cause tremors, or change eye color."}],Druid:[{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Druidcraft",description:"Predict weather, make a flower bloom, or create a harmless sensory effect."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Primal Savagery",description:"Transform your hand into a claw that deals acid damage to a creature you touch."},{name:"Produce Flame",description:"Create a flickering flame in your hand that you can throw for fire damage."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shillelagh",description:"Transform a club or quarterstaff into a magical weapon that uses your spellcasting ability."},{name:"Thorn Whip",description:"Create a vine-like whip that pulls a creature toward you and deals piercing damage."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."}],Bard:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."},{name:"Vicious Mockery",description:"Insult a creature within 60 feet, dealing psychic damage and possibly giving disadvantage."}]},pe={Wizard:{cantrips:3,spells:6},Sorcerer:{cantrips:4,spells:2},Warlock:{cantrips:2,spells:2},Cleric:{cantrips:3,spells:2},Druid:{cantrips:2,spells:2},Bard:{cantrips:2,spells:4}},Ee=O=>{const ve=[...{Fighter:["Chain mail armor","Light crossbow and 20 bolts","Dungeoneer's pack","5 gp"],Wizard:["Arcane focus","Scholar's pack","Component pouch","5 gp"],Cleric:["Chain mail armor","Light crossbow and 20 bolts","Priest's pack","Shield","Holy symbol","5 gp"],Rogue:["Leather armor","Shortbow and 20 arrows","Burglar's pack","Thieves' tools","5 gp"],Ranger:["Scale mail armor","Longbow and 20 arrows","Explorer's pack","5 gp"],Paladin:["Chain mail armor","Javelins (5)","Priest's pack","Holy symbol","5 gp"],Barbarian:["Javelins (4)","Explorer's pack","5 gp"],Bard:["Leather armor","Diplomat's pack OR entertainer's pack","Lute OR any other musical instrument","5 gp"],Druid:["Leather armor","Druidic focus","Explorer's pack","Shield","5 gp"],Monk:["Dungeoneer's pack OR explorer's pack","5 gp"],Sorcerer:["Component pouch OR arcane focus","Dungeoneer's pack","5 gp"],Warlock:["Component pouch OR arcane focus","Scholar's pack","5 gp"]}[O]||["Adventurer's pack","Simple weapon","5 gp"]];return P.weapon&&ve.push(P.weapon),P.shield&&ve.push(P.shield),ke.length>0&&ve.push(`Spells: ${ke.join(", ")}`),ve},ae=()=>{const O=[];for(let te=0;te<4;te++)O.push(Math.floor(Math.random()*6)+1);return O.sort((te,ve)=>ve-te),O.slice(0,3).reduce((te,ve)=>te+ve,0)},fe=()=>{const O=[];for(let te=0;te<6;te++)O.push(ae());return O.sort((te,ve)=>ve-te),D(O),v([...O]),T({}),A(!0),O},be=(O,te)=>{const ve=U.filter(Ie=>Ie!==O);v(ve),T(Ie=>({...Ie,[te]:O})),me(te,O)},_e=O=>{const te=y[O];if(te){v(Ie=>[...Ie,te].sort((rt,_t)=>_t-rt));const ve={...y};delete ve[O],T(ve),me(O,10)}},Ae=()=>{const O=["strength","dexterity","constitution","intelligence","wisdom","charisma"],te={...k};W.forEach((ve,Ie)=>{te[O[Ie]]=ve}),_(te),T({}),v([]),A(!1)},me=(O,te)=>{_(ve=>({...ve,[O]:te}))},ut=async O=>{if(O.preventDefault(),!n){console.error("You must be logged in to create a character");return}if(!e){console.error("Party ID is missing. Please try again or contact support.");return}const ve=["name","race","class"].filter(Ie=>!k[Ie]);if(ve.length>0){console.error(`Please fill in all required fields: ${ve.join(", ")}`);return}i(!0);try{const Ie={...k,userId:n.uid,partyId:e,equipment:Ee(k.class),weapons:P,spells:ke,createdAt:a?a.createdAt:new Date,updatedAt:new Date};a?(await eR(a.id,Ie),console.log("Character updated successfully!")):(await ZA(n.uid,e,Ie),console.log("Character created successfully!")),t(`/campaign-story/${e}`)}catch(Ie){console.error("Character creation/update error:",Ie),console.error("Error creating/updating character:",Ie.message)}finally{i(!1)}},cn=async()=>{if(!g.trim()){alert("Please enter a name for your preset");return}if(!k.name||!k.race||!k.class){alert("Please fill in at least the basic character information (name, race, class) before saving as preset");return}try{console.log("Saving preset with data:",{userId:n.uid,presetName:g,characterData:k,weaponChoices:P,spellChoices:ke});const O={name:g,data:{...k,weaponChoices:P,spellChoices:ke,abilityScoreMethod:x,rolledScores:M,assignedScores:y}};console.log("Calling saveCharacterPreset with:",O);const te=await lR(n.uid,O);console.log("Preset saved successfully:",te),b(""),m(!1),await qe(n.uid),alert("Character preset saved successfully!")}catch(O){console.error("Error saving preset:",O),console.error("Error details:",{message:O.message,code:O.code,stack:O.stack}),O.message.includes("User profile not found")?alert("User profile not found. Please try logging out and back in."):O.message.includes("permission")?alert("Permission denied. Please check your account status."):alert(`Failed to save preset: ${O.message}`)}},ge=O=>{O.key==="Enter"&&g.trim()&&cn()},xt=O=>{const te=O.data;_({...te,name:te.name+" (Copy)",equipment:[],spells:te.spells||[],proficiencies:te.proficiencies||[]}),te.weaponChoices&&I(te.weaponChoices),te.spellChoices&&Oe(te.spellChoices),te.abilityScoreMethod&&N(te.abilityScoreMethod),te.rolledScores&&(D(te.rolledScores),T(te.assignedScores||{}),A(te.rolledScores.length>0)),E(!1)},Ar=async O=>{if(confirm("Are you sure you want to delete this preset? This action cannot be undone."))try{await uR(n.uid,O),await qe(n.uid),alert("Preset deleted successfully!")}catch(te){console.error("Error deleting preset:",te),alert("Failed to delete preset. Please try again.")}};return n?o.jsxs("div",{className:"fantasy-container py-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),o.jsx("p",{className:"text-center text-gray-300 mb-6",children:"Create your character to join the campaign. Once created, you'll be automatically ready to start the adventure!"}),o.jsxs("div",{className:"mb-8 p-4 bg-gray-700 rounded-lg border border-gray-600",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-4",children:"Character Presets"}),o.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[o.jsxs("button",{type:"button",onClick:()=>E(!0),className:"fantasy-button bg-amber-600 hover:bg-amber-700",disabled:u.length===0,children:[" Load Preset (",u.length,")"]}),o.jsx("button",{type:"button",onClick:()=>m(!0),className:"fantasy-button bg-emerald-600 hover:bg-emerald-700",children:" Save as Preset"})]}),u.length>0&&o.jsx("p",{className:"text-sm text-gray-300",children:"Save your current character configuration as a preset to easily recreate it for other parties."})]}),o.jsxs("form",{onSubmit:ut,className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Name"}),o.jsx("input",{type:"text",value:k.name,onChange:O=>me("name",O.target.value),className:"fantasy-input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Race"}),o.jsxs("select",{value:k.race,onChange:O=>me("race",O.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Race"}),J.map(O=>o.jsx("option",{value:O,children:O},O))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Class"}),o.jsxs("select",{value:k.class,onChange:O=>me("class",O.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Class"}),re.map(O=>o.jsx("option",{value:O,children:O},O))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Background"}),o.jsxs("select",{value:k.background,onChange:O=>me("background",O.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Background"}),Q.map(O=>o.jsx("option",{value:O,children:O},O))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Alignment"}),o.jsxs("select",{value:k.alignment,onChange:O=>me("alignment",O.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Alignment"}),ue.map(O=>o.jsx("option",{value:O,children:O},O))]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Ability Scores"}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Ability Score Generation Method"}),o.jsxs("div",{className:"flex space-x-4 mb-4",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"abilityMethod",value:"standard",checked:x==="standard",onChange:O=>N(O.target.value),className:"mr-2"}),o.jsx("span",{className:"text-gray-200",children:"Standard Array (15, 14, 13, 12, 10, 8)"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"abilityMethod",value:"roll",checked:x==="roll",onChange:O=>N(O.target.value),className:"mr-2"}),o.jsx("span",{className:"text-gray-200",children:"Roll 4d6, Drop Lowest"})]})]}),x==="standard"&&o.jsx("button",{type:"button",onClick:Ae,className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Apply Standard Array"}),x==="roll"&&o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{type:"button",onClick:fe,disabled:C,className:`fantasy-button ${C?"bg-gray-500 cursor-not-allowed":"bg-gray-600 hover:bg-gray-700"}`,children:C?"Scores Already Rolled":"Roll Ability Scores"}),C&&o.jsx("p",{className:"text-sm text-gray-300",children:"You can only roll once, but you can reassign scores as many times as you like."}),M.length>0&&o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-semibold text-gray-100 mb-2",children:"Rolled Scores"}),o.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:U.map((O,te)=>o.jsx("span",{className:"bg-amber-900 text-amber-200 border border-amber-600 px-3 py-1 rounded-full text-sm font-medium",children:O},`${O}-${te}`))}),o.jsx("p",{className:"text-sm text-gray-300",children:"Click on an ability score below to assign your rolled scores. You can reassign them as many times as you want."})]})]})]}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:["strength","dexterity","constitution","intelligence","wisdom","charisma"].map(O=>{const te=y[O],ve=k[O];return o.jsxs("div",{className:"border border-gray-600 rounded-lg p-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 capitalize",children:O}),te?o.jsxs("div",{className:"space-y-2",children:[o.jsx("div",{className:"text-lg font-bold text-amber-400",children:te}),o.jsx("button",{type:"button",onClick:()=>_e(O),className:"text-xs text-red-400 hover:text-red-300",children:"Unassign"})]}):o.jsxs("div",{className:"space-y-2",children:[o.jsx("input",{type:"number",min:"1",max:"20",value:ve,onChange:Ie=>me(O,parseInt(Ie.target.value)),className:"fantasy-input",required:!0}),U.length>0&&o.jsx("div",{className:"flex flex-wrap gap-1",children:U.map((Ie,rt)=>o.jsx("button",{type:"button",onClick:()=>be(Ie,O),className:"bg-amber-900 hover:bg-amber-800 border border-amber-600 text-amber-200 px-2 py-1 rounded text-xs font-medium",children:Ie},`${Ie}-${rt}`))})]}),o.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Modifier: ",Math.floor((ve-10)/2)]})]},O)})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Physical Description"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsx("input",{type:"text",placeholder:"Age",value:k.age,onChange:O=>me("age",O.target.value),className:"fantasy-input"}),o.jsx("input",{type:"text",placeholder:"Height",value:k.height,onChange:O=>me("height",O.target.value),className:"fantasy-input"}),o.jsx("input",{type:"text",placeholder:"Weight",value:k.weight,onChange:O=>me("weight",O.target.value),className:"fantasy-input"}),o.jsx("input",{type:"text",placeholder:"Eye Color",value:k.eyes,onChange:O=>me("eyes",O.target.value),className:"fantasy-input"}),o.jsx("input",{type:"text",placeholder:"Skin Color",value:k.skin,onChange:O=>me("skin",O.target.value),className:"fantasy-input"}),o.jsx("input",{type:"text",placeholder:"Hair Color",value:k.hair,onChange:O=>me("hair",O.target.value),className:"fantasy-input"})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Personality"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Personality Traits"}),o.jsx("textarea",{value:k.personality,onChange:O=>me("personality",O.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your character's personality..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Ideals"}),o.jsx("textarea",{value:k.ideals,onChange:O=>me("ideals",O.target.value),className:"fantasy-input",rows:"3",placeholder:"What does your character believe in?"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Bonds"}),o.jsx("textarea",{value:k.bonds,onChange:O=>me("bonds",O.target.value),className:"fantasy-input",rows:"3",placeholder:"What connections does your character have?"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Flaws"}),o.jsx("textarea",{value:k.flaws,onChange:O=>me("flaws",O.target.value),className:"fantasy-input",rows:"3",placeholder:"What are your character's weaknesses?"})]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Backstory"}),o.jsx("textarea",{value:k.backstory,onChange:O=>me("backstory",O.target.value),className:"fantasy-input",rows:"6",placeholder:"Tell the story of your character's life before the adventure..."})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Starting Equipment"}),k.class&&X[k.class]&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Weapons"}),o.jsx("div",{className:"space-y-4",children:Object.entries(X[k.class]).map(([O,te])=>o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:O}),o.jsxs("select",{value:P[O.toLowerCase().replace(/\s+/g,"")]||"",onChange:ve=>I(Ie=>({...Ie,[O.toLowerCase().replace(/\s+/g,"")]:ve.target.value})),className:"fantasy-input",children:[o.jsxs("option",{value:"",children:["Select ",O]}),te.map(ve=>o.jsx("option",{value:ve,children:ve},ve))]})]},O))})]}),k.class&&le[k.class]&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Cantrips"}),o.jsxs("p",{className:"text-sm text-gray-300 mb-3",children:["Select your starting cantrips (0-level spells). You can choose up to ",((sr=pe[k.class])==null?void 0:sr.cantrips)||0," cantrips."]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto border border-gray-600 rounded-lg p-4",children:le[k.class].map(O=>{var Ie;const te=ke.includes(O.name),ve=!te&&ke.length>=(((Ie=pe[k.class])==null?void 0:Ie.cantrips)||0);return o.jsx("div",{className:`border rounded-lg p-3 ${te?"border-amber-500 bg-amber-900/20":"border-gray-600"} ${ve?"opacity-50":"hover:border-gray-500"}`,children:o.jsxs("label",{className:`flex items-start space-x-3 cursor-pointer ${ve?"cursor-not-allowed":""}`,children:[o.jsx("input",{type:"checkbox",checked:te,disabled:ve,onChange:rt=>{rt.target.checked?Oe(_t=>[..._t,O.name]):Oe(_t=>_t.filter(Ue=>Ue!==O.name))},className:"rounded mt-1"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-medium text-gray-100",children:O.name}),o.jsx("div",{className:"text-sm text-gray-300 mt-1",children:O.description})]})]})},O.name)})}),o.jsxs("div",{className:"flex justify-between items-center mt-3",children:[o.jsxs("p",{className:"text-sm text-gray-400",children:["Selected: ",ke.length," / ",((Lt=pe[k.class])==null?void 0:Lt.cantrips)||0," cantrips"]}),ke.length>=(((ze=pe[k.class])==null?void 0:ze.cantrips)||0)&&o.jsx("p",{className:"text-sm text-green-400 font-medium",children:" Cantrip selection complete"})]})]}),k.class?o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsxs("h3",{className:"font-semibold text-gray-100 mb-3",children:[k.class," Starting Equipment"]}),o.jsx("ul",{className:"space-y-1",children:Ee(k.class).map((O,te)=>o.jsxs("li",{className:"text-gray-200 flex items-start",children:[o.jsx("span",{className:"text-gray-400 mr-2",children:""}),O]},te))}),o.jsx("p",{className:"text-sm text-gray-300 mt-3",children:"This equipment will be automatically assigned to your character."})]}):o.jsx("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:o.jsx("p",{className:"text-gray-300",children:"Select a class to see your starting equipment."})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Character Portrait"}),o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("div",{className:"w-32 h-32 bg-gray-600 rounded-lg flex items-center justify-center",children:o.jsx("span",{className:"text-gray-400",children:"Portrait Placeholder"})}),o.jsx("button",{type:"button",className:"fantasy-button",onClick:()=>{},children:"Upload Image"})]})]}),o.jsxs("div",{className:"flex justify-center space-x-4",children:[o.jsx("button",{type:"button",onClick:()=>t(`/campaign-story/${e}`),className:"fantasy-button bg-gray-600 hover:bg-gray-700",disabled:s,children:"Back to Campaign"}),o.jsx("button",{type:"submit",className:"fantasy-button",disabled:s,children:s?"Creating Character...":"Create Character"})]})]})]}),f&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"fantasy-card max-w-md w-full mx-4",children:[o.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Save Character Preset"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Preset Name"}),o.jsx("input",{type:"text",value:g,onChange:O=>b(O.target.value),onKeyPress:ge,className:"fantasy-input",placeholder:"Enter a name for your preset",autoFocus:!0})]}),o.jsxs("div",{className:"flex space-x-3",children:[o.jsx("button",{type:"button",onClick:()=>{m(!1),b("")},className:"fantasy-button bg-gray-600 hover:bg-gray-700 flex-1",children:"Cancel"}),o.jsx("button",{type:"button",onClick:cn,className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 flex-1",children:"Save Preset"})]})]})]})}),S&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"fantasy-card max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Load Character Preset"}),u.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-gray-300 mb-4",children:"No character presets found."}),o.jsx("p",{className:"text-sm text-gray-400",children:"Create a character and save it as a preset to see it here."}),o.jsx("button",{type:"button",onClick:()=>E(!1),className:"fantasy-button mt-4",children:"Close"})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"grid gap-4",children:u.map(O=>o.jsxs("div",{className:"border border-gray-600 rounded-lg p-4 hover:border-gray-500",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-100",children:O.name}),o.jsxs("p",{className:"text-sm text-gray-300",children:[O.data.race," ",O.data.class,"  Level ",O.data.level]}),O.data.background&&o.jsx("p",{className:"text-sm text-gray-400",children:O.data.background}),O.createdAt&&o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Created: ",new Date(O.createdAt.toDate()).toLocaleDateString()]})]}),o.jsx("button",{type:"button",onClick:()=>Ar(O.id),className:"text-red-400 hover:text-red-300 text-sm",title:"Delete preset",children:""})]}),o.jsx("div",{className:"flex space-x-2",children:o.jsx("button",{type:"button",onClick:()=>xt(O),className:"fantasy-button bg-amber-600 hover:bg-amber-700 flex-1",children:"Load Preset"})})]},O.id))}),o.jsx("div",{className:"flex justify-center",children:o.jsx("button",{type:"button",onClick:()=>E(!1),className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Cancel"})})]})]})})]}):null}const ur={INVESTIGATION:"investigation",COMBAT:"combat",PERSUASION:"persuasion",EXPLORATION:"exploration",SOCIAL:"social"},Ht={HIDDEN:"hidden",DISCOVERED:"discovered",IN_PROGRESS:"in_progress",COMPLETED:"completed",FAILED:"failed"},mv=t=>{const e=[{id:"investigate_area",type:ur.INVESTIGATION,title:"Investigate the Area",description:"Search for clues and gather information about the situation",keywords:["search","investigate","examine","look around","check","explore"],state:Ht.HIDDEN,discoveredAt:null,completedAt:null},{id:"resolve_conflict",type:ur.COMBAT,title:"Resolve the Conflict",description:"Engage in combat to overcome the threat",keywords:["fight","attack","defend","combat","battle"],state:Ht.HIDDEN,discoveredAt:null,completedAt:null},{id:"negotiate_peace",type:ur.PERSUASION,title:"Negotiate Peace",description:"Use diplomacy and persuasion to resolve the situation peacefully",keywords:["talk","negotiate","persuade","convince","diplomacy","peace"],state:Ht.HIDDEN,discoveredAt:null,completedAt:null}],n=[];return(t.toLowerCase().includes("thief")||t.toLowerCase().includes("stealth"))&&n.push({id:"stealth_approach",type:ur.EXPLORATION,title:"Stealth Approach",description:"Use stealth to avoid detection and gather information",keywords:["sneak","stealth","hide","silent","unnoticed"],state:Ht.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("merchant")||t.toLowerCase().includes("trade"))&&n.push({id:"establish_trade",type:ur.SOCIAL,title:"Establish Trade Relations",description:"Build economic relationships with the locals",keywords:["trade","bargain","deal","commerce","business"],state:Ht.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("scholar")||t.toLowerCase().includes("knowledge"))&&n.push({id:"gather_knowledge",type:ur.INVESTIGATION,title:"Gather Ancient Knowledge",description:"Discover and preserve valuable information",keywords:["research","study","learn","knowledge","ancient","lore"],state:Ht.HIDDEN,discoveredAt:null,completedAt:null}),[...e,...n]},jR=(t,e)=>{const n=[];return e.forEach(r=>{if(r.state===Ht.HIDDEN){const s=t.toLowerCase();r.keywords.some(a=>s.includes(a.toLowerCase()))&&n.push({...r,state:Ht.DISCOVERED,discoveredAt:new Date})}}),n},DR=(t,e)=>t.filter(n=>n.state===e),MR=t=>t.filter(e=>e.state===Ht.DISCOVERED||e.state===Ht.IN_PROGRESS||e.state===Ht.COMPLETED),LR=(t,e)=>{const n=DR(t,Ht.HIDDEN),r=[];return n.forEach(s=>{const i=e.toLowerCase();s.type===ur.INVESTIGATION&&(i.includes("mystery")||i.includes("unknown"))&&r.push("There might be more to discover here..."),s.type===ur.PERSUASION&&(i.includes("tension")||i.includes("conflict"))&&r.push("Perhaps words could resolve this..."),s.type===ur.COMBAT&&(i.includes("threat")||i.includes("danger"))&&r.push("The situation seems dangerous...")}),r},gt={SETUP:"setup",INTRODUCTION:"introduction",RISING_ACTION:"rising_action",CLIMAX:"climax",RESOLUTION:"resolution",COMPLETED:"completed"},OR=(t,e)=>{const n={importantNPCs:[],keyLocations:[],majorEvents:[],partyDecisions:[],currentSituation:null,activeThreats:[],availableResources:[]};if(t.slice(-10).forEach(s=>{if(s.role==="assistant"){const i=s.content.toLowerCase(),a=i.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:the\s+)?([a-z\s]+)/g);a&&a.forEach(d=>{n.importantNPCs.find(f=>f.name===d)||n.importantNPCs.push({name:d,firstMentioned:s.timestamp,role:"unknown"})}),["town","city","village","castle","temple","dungeon","forest","mountain"].forEach(d=>{if(i.includes(d)){const f=i.match(new RegExp(`([A-Z][a-z]+(?:s+[A-Z][a-z]+)*\\s+${d})`,"i"));f&&!n.keyLocations.find(m=>m.name===f[1])&&n.keyLocations.push({name:f[1],type:d,firstMentioned:s.timestamp})}}),["danger","threat","enemy","monster","evil","dark","cursed"].forEach(d=>{i.includes(d)&&n.activeThreats.push({type:d,mentioned:s.timestamp,description:i.substring(Math.max(0,i.indexOf(d)-50),i.indexOf(d)+50)})})}}),t.length>0){const s=t[t.length-1];s.role==="assistant"&&(n.currentSituation=s.content)}return n},VR=(t,e,n)=>{var i,a;t||(console.warn("Campaign metadata is undefined, using fallback values"),t={campaignPhase:gt.SETUP,mainGoal:null,activeObjectives:[],completedObjectives:[],importantNPCs:[],keyLocations:[],partyDecisions:[],storyContext:{currentSituation:null,worldState:{}},sessionNumber:1,campaignProgress:0}),t.storyContext||(t.storyContext={currentSituation:null,worldState:{}});const r={campaignPhase:t.campaignPhase||gt.SETUP,mainGoal:t.mainGoal||null,activeObjectives:t.activeObjectives||[],completedObjectives:t.completedObjectives||[],importantNPCs:t.importantNPCs||[],keyLocations:t.keyLocations||[],currentSituation:((i=t.storyContext)==null?void 0:i.currentSituation)||null,partyDecisions:t.partyDecisions||[],worldState:((a=t.storyContext)==null?void 0:a.worldState)||{},sessionNumber:t.sessionNumber||1,campaignProgress:t.campaignProgress||0},s=OR(e);return{...r,recentNPCs:s.importantNPCs,recentLocations:s.keyLocations,recentThreats:s.activeThreats,currentSituation:s.currentSituation||r.currentSituation}},FR=(t,e,n)=>{let r=0;const s={[gt.SETUP]:0,[gt.INTRODUCTION]:10,[gt.RISING_ACTION]:30,[gt.CLIMAX]:70,[gt.RESOLUTION]:90,[gt.COMPLETED]:100};r+=s[t.campaignPhase]||0;const a=n.filter(d=>d.state==="completed").length/Math.max(n.length,1)*30;r+=a;const l=e.length,u=Math.min(l/50*20,20);return r+=u,Math.min(Math.round(r),100)},$R=(t,e,n)=>{const r=e.length,s=n.filter(a=>a.state==="completed");let i=t.campaignPhase;return t.campaignPhase===gt.SETUP&&r>0?i=gt.INTRODUCTION:t.campaignPhase===gt.INTRODUCTION&&r>=5?i=gt.RISING_ACTION:t.campaignPhase===gt.RISING_ACTION&&(r>=15||s.length>=2)?i=gt.CLIMAX:t.campaignPhase===gt.CLIMAX&&(r>=25||s.length>=3)?i=gt.RESOLUTION:t.campaignPhase===gt.RESOLUTION&&(r>=30||s.length>=4)&&(i=gt.COMPLETED),i!==t.campaignPhase?i:null};class UR{constructor(){this.defaultState={currentLocation:{name:"",description:"",npcs:[],features:[],atmosphere:"",exits:[]},activeNPCs:{},activePlotThreads:[],characterArcs:{},worldState:{timeOfDay:"day",weather:"clear",recentEvents:[],factionRelations:{},discoveredLocations:[],completedObjectives:[]},storyMetadata:{sessionStartTime:null,totalMessages:0,currentPhase:"introduction",campaignMood:"neutral",tensionLevel:0}}}initializeStoryState(e,n,r=null){const s={...this.defaultState};return e.forEach(i=>{s.characterArcs[i.id]={relationships:{},discoveries:[],motivations:[i.ideals||"adventure"],characterGrowth:[],currentGoals:[],personalityTraits:i.personality?i.personality.split(",").map(a=>a.trim()):[],backstoryElements:i.backstory?this.extractBackstoryElements(i.backstory):[]}}),s.currentLocation=this.extractInitialLocation(n),r&&r.description&&(s.storyMetadata.campaignMood=this.determineMoodFromTheme(r.description)),s}extractStoryElements(e){const n={npcInteractions:[],plotAdvancement:null,locationChanges:null,newDiscoveries:[],characterDevelopment:{},worldStateUpdates:{}};return[/(\w+)\s+(?:becomes?|grows?|seems?)\s+(friendly|hostile|neutral|suspicious|trusting)/gi,/(\w+)\s+(?:reacts?|responds?)\s+(?:with|in)\s+(joy|anger|fear|surprise|curiosity)/gi,/(\w+)\s+(?:shows?|displays?)\s+(gratitude|distrust|interest|concern)/gi].forEach(a=>{[...e.matchAll(a)].forEach(u=>{n.npcInteractions.push({npc:u[1],newDisposition:u[2],context:u[0]})})}),[/(?:discovers?|finds?|learns?)\s+(?:that\s+)?(.+?)(?:\.|!)/gi,/(?:new\s+)?(?:clue|evidence|information)\s+(?:about|regarding)\s+(.+?)(?:\.|!)/gi,/(?:progress|advance)\s+(?:in|on)\s+(.+?)(?:\.|!)/gi].forEach(a=>{const l=[...e.matchAll(a)];l.length>0&&(n.plotAdvancement={discovery:l[0][1],progress:.1})}),[/(?:moves?|goes?|travels?)\s+(?:to|towards?)\s+(.+?)(?:\.|!)/gi,/(?:enters?|approaches?)\s+(.+?)(?:\.|!)/gi,/(?:arrives?|reaches?)\s+(?:at|in)\s+(.+?)(?:\.|!)/gi].forEach(a=>{const l=[...e.matchAll(a)];l.length>0&&(n.locationChanges={newLocation:l[0][1],transition:l[0][0]})}),n}updateStoryState(e,n,r,s){const i={...e},a=this.extractStoryElements(n);if(a.npcInteractions.length>0&&a.npcInteractions.forEach(l=>{i.activeNPCs[l.npc]||(i.activeNPCs[l.npc]={disposition:"neutral",knowledge:[],relationships:{},currentGoal:"",firstAppearance:new Date().toISOString()}),i.activeNPCs[l.npc].disposition=l.newDisposition,i.activeNPCs[l.npc].lastInteraction=new Date().toISOString()}),a.plotAdvancement){const l=i.activePlotThreads.find(u=>u.id===this.generateThreadId(a.plotAdvancement.discovery));l?(l.progress=Math.min(1,l.progress+a.plotAdvancement.progress),l.lastUpdated=new Date().toISOString()):i.activePlotThreads.push({id:this.generateThreadId(a.plotAdvancement.discovery),title:a.plotAdvancement.discovery,status:"active",progress:a.plotAdvancement.progress,discoveredAt:new Date().toISOString(),lastUpdated:new Date().toISOString(),involvedNPCs:[],clues:[]})}if(s&&i.characterArcs[s]){const l=i.characterArcs[s],u=this.extractCharacterDevelopment(r,n);u.relationships&&(l.relationships={...l.relationships,...u.relationships}),u.discoveries&&(l.discoveries=[...new Set([...l.discoveries,...u.discoveries])]),u.motivations&&(l.motivations=[...new Set([...l.motivations,...u.motivations])]),u.growth&&(l.characterGrowth=[...new Set([...l.characterGrowth,...u.growth])])}return a.locationChanges&&(i.currentLocation={...i.currentLocation,name:a.locationChanges.newLocation,description:this.generateLocationDescription(a.locationChanges.newLocation),lastUpdated:new Date().toISOString()}),i.worldState.recentEvents=[...i.worldState.recentEvents.slice(-4),{event:r.substring(0,100)+"...",timestamp:new Date().toISOString(),characterId:s}],i.storyMetadata.totalMessages+=1,i.storyMetadata.lastUpdated=new Date().toISOString(),i}extractCharacterDevelopment(e,n){const r={relationships:{},discoveries:[],motivations:[],growth:[]};return[/(?:trusts?|likes?|respects?)\s+(\w+)/gi,/(?:distrusts?|dislikes?|fears?)\s+(\w+)/gi,/(?:befriends?|allies?\s+with)\s+(\w+)/gi].forEach(l=>{[...e.matchAll(l)].forEach(d=>{const f=d[1],m=d[0].toLowerCase();m.includes("trust")||m.includes("like")||m.includes("respect")?r.relationships[f]="positive":m.includes("distrust")||m.includes("dislike")||m.includes("fear")?r.relationships[f]="negative":(m.includes("friend")||m.includes("ally"))&&(r.relationships[f]="allied")})}),[/(?:discovers?|finds?|learns?)\s+(.+?)(?:\.|!)/gi,/(?:realizes?|understands?)\s+(.+?)(?:\.|!)/gi].forEach(l=>{[...e.matchAll(l)].forEach(d=>{r.discoveries.push(d[1].trim())})}),[/(?:wants?|desires?|seeks?)\s+(?:to\s+)?(.+?)(?:\.|!)/gi,/(?:motivated\s+by|driven\s+by)\s+(.+?)(?:\.|!)/gi].forEach(l=>{[...e.matchAll(l)].forEach(d=>{r.motivations.push(d[1].trim())})}),r}generateContextPrompt(e,n,r,s){const i={currentLocation:e.currentLocation,activeNPCs:e.activeNPCs,activePlotThreads:e.activePlotThreads,characterArcs:e.characterArcs,worldState:e.worldState,storyMetadata:e.storyMetadata};return`
STORY STATE SUMMARY:
Current Location: ${i.currentLocation.name} - ${i.currentLocation.description}
Atmosphere: ${i.currentLocation.atmosphere}
Active NPCs: ${Object.keys(i.activeNPCs).join(", ")||"None"}
Active Plot Threads: ${i.activePlotThreads.map(l=>`${l.title} (${Math.round(l.progress*100)}%)`).join(", ")||"None"}
Recent Events: ${i.worldState.recentEvents.slice(-3).map(l=>l.event).join(", ")||"None"}

CHARACTER CONTEXT:
${n.map(l=>{const u=i.characterArcs[l.id]||{},d=Object.entries(u.relationships||{}).map(([m,g])=>`${m} (${g})`).join(", "),f=u.discoveries?u.discoveries.slice(-3).join(", "):"";return`${l.name}: Relationships: ${d||"None"}. Recent discoveries: ${f||"None"}`}).join(`
`)}

NPC RELATIONSHIPS:
${Object.entries(i.activeNPCs).map(([l,u])=>`${l}: ${u.disposition} disposition, ${u.knowledge.length} pieces of knowledge, goal: ${u.currentGoal||"unknown"}`).join(`
`)}

STORY HISTORY (Last 5 messages):
${r.slice(-5).map(l=>`${l.role}: ${l.content}`).join(`
`)}

PLAYER RESPONSE: "${s}"

CRITICAL CONSISTENCY RULES:
1. Maintain all established NPC relationships and dispositions
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

RESPONSE REQUIREMENTS:
- Acknowledge the player's action in context of the current situation and location
- Reference relevant NPCs and their established relationships with the party
- Continue or advance active plot threads appropriately
- Update character relationships based on the action
- Maintain location and atmosphere consistency
- End with a clear situation that invites the next player response
- Keep the story flowing naturally without jarring transitions
`}extractInitialLocation(e){const n=[/(?:in|at|near)\s+(.+?)(?:\.|,|!)/gi,/(?:town|city|village|castle|tower|dungeon|forest|mountain)\s+(?:of|in|near)\s+(.+?)(?:\.|,|!)/gi];for(const r of n){const s=[...e.matchAll(r)];if(s.length>0)return{name:s[0][1].trim(),description:"A location mentioned in the plot",npcs:[],features:[],atmosphere:"mysterious",exits:[]}}return{name:"Starting Location",description:"Where the adventure begins",npcs:[],features:[],atmosphere:"neutral",exits:[]}}extractBackstoryElements(e){const n=[];return[/(?:family|parents?|siblings?)\s+(.+?)(?:\.|,)/gi,/(?:trained|learned|studied)\s+(.+?)(?:\.|,)/gi,/(?:worked|served|lived)\s+(?:as|in)\s+(.+?)(?:\.|,)/gi].forEach(s=>{[...e.matchAll(s)].forEach(a=>{n.push(a[1].trim())})}),n}determineMoodFromTheme(e){const n=e.toLowerCase();return n.includes("dark")||n.includes("gothic")||n.includes("horror")?"dark":n.includes("light")||n.includes("happy")||n.includes("cheerful")?"light":n.includes("mysterious")||n.includes("enigmatic")?"mysterious":n.includes("epic")||n.includes("grand")?"epic":"neutral"}generateThreadId(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"_").substring(0,20)}generateLocationDescription(e){const n=["A place of mystery and adventure","An area with its own unique character","A location that holds many secrets","A place where stories unfold","An area rich with history and possibility"];return n[Math.floor(Math.random()*n.length)]}}const BR=new UR;class zR{constructor(){this.actionTypes={attack:{name:"Attack",cooldown:0,priority:"normal",description:"A basic physical attack",narrativeTemplate:"{character} {action} with {weapon}!"},spell:{name:"Cast Spell",cooldown:1,priority:"normal",description:"Cast a magical spell",narrativeTemplate:"{character} channels arcane energy into {spell}!"},special:{name:"Special Ability",cooldown:2,priority:"high",description:"Use a special class ability",narrativeTemplate:"{character} unleashes their {ability}!"},item:{name:"Use Item",cooldown:0,priority:"low",description:"Use an item or consumable",narrativeTemplate:"{character} uses {item}!"},defend:{name:"Defend",cooldown:0,priority:"high",description:"Take a defensive stance",narrativeTemplate:"{character} takes a defensive stance!"},environmental:{name:"Environmental Action",cooldown:1,priority:"normal",description:"Use the environment to your advantage",narrativeTemplate:"{character} uses the {environment} to their advantage!"},teamUp:{name:"Team Up",cooldown:3,priority:"high",description:"Coordinate with another party member",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}},this.statusEffects={poisoned:{name:"Poisoned",duration:3,effect:"lose 1 HP per turn",narrative:"is suffering from poison"},burned:{name:"Burned",duration:2,effect:"lose 2 HP per turn",narrative:"is burning with magical flames"},frozen:{name:"Frozen",duration:1,effect:"skip next turn",narrative:"is frozen solid"},paralyzed:{name:"Paralyzed",duration:2,effect:"50% chance to skip turn",narrative:"is paralyzed and can barely move"},confused:{name:"Confused",duration:2,effect:"may attack randomly",narrative:"is confused and disoriented"},blessed:{name:"Blessed",duration:3,effect:"+2 to attack rolls",narrative:"is blessed with divine favor"},hasted:{name:"Hasted",duration:2,effect:"extra action per turn",narrative:"is moving with supernatural speed"}},this.classAbilities={fighter:{name:"Second Wind",description:"Recover some HP",effect:"heal 1d6+2 HP",cooldown:3},wizard:{name:"Arcane Surge",description:"Enhance next spell",effect:"+2 to spell damage",cooldown:2},rogue:{name:"Sneak Attack",description:"Deal extra damage from stealth",effect:"+1d6 damage if target is unaware",cooldown:1},cleric:{name:"Divine Favor",description:"Bless an ally",effect:"target gets +1 to all rolls",cooldown:2}}}initializeCombat(e,n,r){return{combatants:[...e,...n].map(a=>({...a,initiative:this.calculateInitiative(a),statusEffects:[],cooldowns:{},lastAction:null,turnCount:0})).sort((a,l)=>l.initiative-a.initiative),currentTurn:0,round:1,phase:"preparation",storyContext:r,environmentalFeatures:this.extractEnvironmentalFeatures(r),teamUpOpportunities:this.identifyTeamUpOpportunities(e),narrativeElements:this.extractNarrativeElements(r)}}calculateInitiative(e){var s,i,a;let n=Math.floor(Math.random()*20)+1;return n+={rogue:3,monk:2,ranger:1,fighter:0,cleric:0,wizard:-1,paladin:-1}[(s=e.class)==null?void 0:s.toLowerCase()]||0,(i=e.statusEffects)!=null&&i.includes("hasted")&&(n+=5),(a=e.statusEffects)!=null&&a.includes("paralyzed")&&(n-=3),n}extractEnvironmentalFeatures(e){const n=[],r={forest:["trees","cover","difficult terrain"],cave:["darkness","echoes","tight spaces"],tavern:["furniture","crowds","flammable materials"],castle:["stone walls","narrow corridors","defensive positions"],dungeon:["traps","darkness","confined spaces"],outdoors:["weather","open space","natural cover"]},s=e.toLowerCase();return Object.entries(r).forEach(([i,a])=>{s.includes(i)&&n.push(...a)}),n}identifyTeamUpOpportunities(e){const n=[];return[{classes:["fighter","rogue"],description:"Fighter distracts while Rogue sneaks in for a backstab"},{classes:["wizard","cleric"],description:"Wizard casts area spell while Cleric protects the party"},{classes:["fighter","cleric"],description:"Fighter tanks while Cleric provides healing support"},{classes:["rogue","wizard"],description:"Rogue scouts while Wizard provides magical backup"}].forEach(s=>{s.classes.every(a=>e.some(l=>{var u;return((u=l.class)==null?void 0:u.toLowerCase())===a}))&&n.push(s)}),n}extractNarrativeElements(e){return{mood:this.determineCombatMood(e),stakes:this.determineStakes(e),environmentalHazards:this.identifyHazards(e),npcInvolvement:this.extractNPCs(e)}}determineCombatMood(e){const n=e.toLowerCase();return n.includes("desperate")||n.includes("last stand")?"desperate":n.includes("training")||n.includes("practice")?"casual":n.includes("revenge")||n.includes("vengeance")?"vengeful":n.includes("defense")||n.includes("protect")?"defensive":"standard"}determineStakes(e){const n=e.toLowerCase();return n.includes("life")||n.includes("death")||n.includes("kill")?"life_or_death":n.includes("escape")||n.includes("flee")?"escape":n.includes("capture")||n.includes("arrest")?"capture":n.includes("treasure")||n.includes("loot")?"treasure":"standard"}identifyHazards(e){const n=[],r=e.toLowerCase();return(r.includes("fire")||r.includes("flame"))&&n.push("fire"),(r.includes("water")||r.includes("river")||r.includes("lake"))&&n.push("water"),(r.includes("height")||r.includes("cliff")||r.includes("fall"))&&n.push("height"),(r.includes("trap")||r.includes("pit"))&&n.push("traps"),n}extractNPCs(e){const n=[];return[/(\w+)\s+(?:the\s+)?(?:guard|merchant|wizard|knight|rogue|priest)/gi,/(?:named|called)\s+(\w+)/gi].forEach(s=>{[...e.matchAll(s)].forEach(a=>{n.push(a[1])})}),n}async executeAction(e,n,r,s,i={}){const a=e.combatants.find(m=>m.id===n),l=e.combatants.find(m=>m.id===s);if(!a||!l)throw new Error("Invalid combatant or target");if(a.cooldowns&&a.cooldowns[r]>0)return{success:!1,message:`${a.name} cannot use ${r} yet (cooldown: ${a.cooldowns[r]} turns)`};const u=this.generateActionNarrative(a,r,l,i),d=this.calculateActionResults(a,r,l,i);this.applyActionEffects(e,a,l,d),this.updateCooldowns(e,a,r);const f=this.checkStatusEffectApplication(a,r,l,d);return{success:!0,narrative:u,results:d,statusEffects:f,environmentalImpact:this.calculateEnvironmentalImpact(e,r,d),targetId:s,combatSession:e}}generateActionNarrative(e,n,r,s){let a=this.actionTypes[n].narrativeTemplate;a=a.replace("{character}",e.name),a=a.replace("{action}",this.getActionVerb(n,e.class)),a=a.replace("{weapon}",s.weapon||"their weapon"),a=a.replace("{spell}",s.spell||"a spell"),a=a.replace("{ability}",s.ability||"special ability"),a=a.replace("{item}",s.item||"an item"),a=a.replace("{environment}",s.environment||"surroundings"),a=a.replace("{ally}",s.ally||"ally"),s.specialAttack&&s.specialAttack!=="Standard Action"&&(a=`${e.name} uses ${s.specialAttack}! `+a),s.damageType&&s.damageType!=="physical"&&(a+=` The attack deals ${s.damageType} damage.`);const l=this.getClassFlavor(e.class,n);return l&&(a+=` ${l}`),a}getActionVerb(e,n){var s;return((s={fighter:{attack:"charges forward with a mighty swing",defend:"raises their shield defensively",special:"unleashes their combat expertise"},wizard:{attack:"casts a magical bolt",spell:"weaves arcane energy",special:"channels pure magical power"},rogue:{attack:"strikes from the shadows",defend:"dodges and weaves",special:"executes a perfect sneak attack"},cleric:{attack:"calls upon divine power",spell:"prays for divine intervention",special:"channels holy energy"}}[n==null?void 0:n.toLowerCase()])==null?void 0:s[e])||"performs an action"}getClassFlavor(e,n){var s;return((s={priest:{attack:"Divine energy crackles around their weapon.",spell:"Holy light emanates from their hands.",heal:"A warm, healing glow surrounds them."},wizard:{attack:"Arcane energy flows through their weapon.",spell:"Mystical runes appear in the air.",special:"Ancient magic surges through them."},warrior:{attack:"Their combat training shows in every move.",special:"Years of battle experience guide their strike.",defend:"They adopt a defensive stance with practiced ease."},rogue:{attack:"They move with deadly precision.",special:"Shadow and stealth enhance their attack.",defend:"They dodge and weave with acrobatic grace."},boss:{attack:"Their overwhelming presence fills the battlefield.",special:"Ancient power courses through their veins.",spell:"Reality itself seems to bend to their will."},undead:{attack:"Necrotic energy pulses from their form.",spell:"Death magic swirls around them.",special:"The very air grows cold with their presence."}}[e==null?void 0:e.toLowerCase()])==null?void 0:s[n])||""}calculateActionResults(e,n,r,s){const i={damage:0,healing:0,statusEffects:[],environmentalEffects:[],narrative:"",specialAttack:s.specialAttack||"Standard Action",damageType:s.damageType||"physical",attribute:s.attribute||"strength"};switch(n){case"attack":i.damage=this.calculateAttackDamage(e,r,s);break;case"spell":i.damage=this.calculateSpellDamage(e,r,s);break;case"special":i.damage=this.calculateSpecialDamage(e,r,s);break;case"item":i.healing=this.calculateItemEffect(e,r,s);break;case"defend":i.statusEffects.push({type:"defensive",duration:1});break;case"environmental":i.environmentalEffects=this.calculateEnvironmentalEffects(e,r,s);break;case"teamUp":i.damage=this.calculateTeamUpDamage(e,r,s);break}return i}calculateAttackDamage(e,n,r){const s=Math.floor(Math.random()*8)+1,i=Math.floor((e.strength-10)/2),a=r.weaponBonus||0;let l=1,u=0;if(e.id.startsWith("enemy_")){l=1+(e.level-1)*.3;const d=r.attribute||"strength";u=Math.floor((e[d]-10)/2);const f=this.calculateEnemyItemBonus(e);let m=0;r.specialAttack&&r.specialAttack!=="Standard Attack"&&(m=Math.floor(Math.random()*4)+2),r.isBossAttack&&(m+=5);let g=(s+i+a+u+f+m)*l;return Math.floor(Math.random()*20)+1===20&&(g*=2),console.log(`Enhanced enemy damage calculation for ${e.name}:`,{baseDamage:s,strengthMod:i,weaponBonus:a,attributeMod:u,itemBonus:f,specialBonus:m,levelScaling:l,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,totalDamage:Math.max(1,Math.floor(g))}),Math.max(1,Math.floor(g))}else{const d=Math.floor((e.dexterity-10)/2),f=Math.floor((e.level-1)*.5);let m=s+i+d+a+f;return Math.floor(Math.random()*20)+1===20&&(m*=2),Math.max(1,Math.floor(m))}}getEnemyPrimaryAttribute(e){return{Warrior:"strength",Archer:"dexterity",Mage:"intelligence",Cleric:"wisdom",Rogue:"dexterity",Paladin:"strength",Ranger:"dexterity",Wizard:"intelligence",Fighter:"strength"}[e]||"strength"}calculateEnemyItemBonus(e){let n=0;return e.equipment&&(e.equipment.weapon&&(n+=e.equipment.weapon.damageBonus||0),e.equipment.armor&&(n+=e.equipment.armor.defenseBonus||0),e.equipment.accessory&&(n+=e.equipment.accessory.bonus||0)),e.level>3&&(n+=Math.floor((e.level-3)/2)),n}calculateSpellDamage(e,n,r){const s=Math.floor(Math.random()*6)+1,i=Math.floor((e.intelligence-10)/2),a=r.spellLevel||1;if(e.id.startsWith("enemy_")){const l=1+(e.level-1)*.4,u=Math.floor((e.wisdom-10)/2),d=this.calculateEnemyItemBonus(e);let f=(s+i+u+a+d)*l;return Math.floor(Math.random()*20)+1>=19&&(f*=1.5),Math.max(1,Math.floor(f))}else return Math.max(1,s+i+a)}calculateSpecialDamage(e,n,r){var l;if(!this.classAbilities[(l=e.class)==null?void 0:l.toLowerCase()])return 0;const i=Math.floor(Math.random()*10)+2,a=Math.floor((e.level||1)/2);return Math.max(1,i+a)}calculateItemEffect(e,n,r){switch(r.itemType||"potion"){case"healing":return Math.floor(Math.random()*8)+2;case"antidote":return 0;case"blessing":return 0;default:return Math.floor(Math.random()*4)+1}}calculateTeamUpDamage(e,n,r){const s=Math.floor(Math.random()*12)+3;return Math.max(1,s+2)}applyActionEffects(e,n,r,s){s.damage>0&&(r.hp=Math.max(0,r.hp-s.damage)),s.healing>0&&(r.hp=Math.min(r.maxHp,r.hp+s.healing)),r.statusEffects||(r.statusEffects=[]),s.statusEffects.forEach(i=>{r.statusEffects.some(a=>a.type===i.type)||r.statusEffects.push({type:i.type,duration:i.duration,appliedBy:n.id})})}updateCooldowns(e,n,r){const s=this.actionTypes[r];n.cooldowns||(n.cooldowns={}),n.cooldowns[r]=s.cooldown,Object.keys(n.cooldowns).forEach(i=>{i!==r&&n.cooldowns[i]>0&&n.cooldowns[i]--})}checkStatusEffectApplication(e,n,r,s){const i=[];if(r.statusEffects||(r.statusEffects=[]),s.damage>10){const a=["stunned","bleeding"],l=a[Math.floor(Math.random()*a.length)];r.statusEffects.some(u=>u.type===l)||i.push({type:l,duration:1,appliedBy:e.id})}return i}calculateEnvironmentalImpact(e,n,r){const s=[];return n==="spell"&&r.damage>8&&s.push("The magical energy disturbs the environment"),n==="environmental"&&s.push("The environment responds to the action"),s}processStatusEffects(e,n){const r=[];return n.statusEffects&&n.statusEffects.forEach((s,i)=>{switch(s.duration--,s.type){case"poisoned":n.hp=Math.max(0,n.hp-1),r.push(`${n.name} takes 1 poison damage`);break;case"burned":n.hp=Math.max(0,n.hp-2),r.push(`${n.name} takes 2 burn damage`);break;case"frozen":r.push(`${n.name} is frozen and cannot act`);break;case"paralyzed":Math.random()<.5&&r.push(`${n.name} is paralyzed and cannot act`);break;case"blessed":r.push(`${n.name} is blessed with divine favor`);break;case"hasted":r.push(`${n.name} moves with supernatural speed`);break}s.duration<=0&&(n.statusEffects.splice(i,1),r.push(`${n.name} is no longer ${s.type}`))}),r}checkCombatEnd(e){const n=e.combatants.filter(a=>!a.id.startsWith("enemy_")),r=e.combatants.filter(a=>a.id.startsWith("enemy_")),s=n.some(a=>a.hp>0),i=r.some(a=>a.hp>0);return s?i?{ended:!1}:{ended:!0,result:"victory",narrative:"The enemies have been defeated!"}:{ended:!0,result:"defeat",narrative:"The party has been defeated..."}}generateCombatSummary(e,n){return{result:n,duration:e.round,participants:e.combatants.map(s=>({name:s.name,finalHp:s.hp,actions:s.turnCount,statusEffects:s.statusEffects.length})),narrative:this.generateCombatNarrative(e,n)}}generateCombatNarrative(e,n){const r=e.combatants.filter(s=>!s.id.startsWith("enemy_"));return e.combatants.filter(s=>s.id.startsWith("enemy_")),n==="victory"?`The party emerges victorious from the battle. ${r.map(s=>s.name).join(", ")} stand triumphant over their fallen foes.`:n==="defeat"?"The battle ends in defeat. The party has been overwhelmed by their enemies.":"The battle ends in a draw, with both sides withdrawing to regroup."}chooseEnemyAction(e,n){const r=this.getAvailableActions(e),s=this.getValidTargets(e,"attack",n);return console.log(`Enemy ${e.name} available actions:`,r),console.log(`Enemy ${e.name} valid targets:`,s.map(i=>i.name)),s.length===0?(console.log(`No valid targets for ${e.name}, defaulting to defend`),{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}):this.makeEnemyDecision(e,r,s,n)}getAvailableActions(e){var s;const n=[],r=e.cooldowns||{};return console.log("Getting enemy available actions for:",e.name,{cooldowns:r,class:e.class,hasClassAbility:!!this.classAbilities[(s=e.class)==null?void 0:s.toLowerCase()]}),Object.entries(this.actionTypes).forEach(([i,a])=>{(r[i]===0||r[i]===void 0)&&n.push(i)}),e.class&&this.classAbilities[e.class.toLowerCase()]&&(r.special===0||r.special===void 0)&&n.push("special"),console.log("Available actions for enemy:",e.name,n),n}getValidTargets(e,n,r){const s=[],i=r.combatants.filter(a=>a.hp>0);if(i.length===0)return console.log("No alive combatants found"),[];switch(n){case"attack":case"spell":case"special":e.id.startsWith("enemy_")?s.push(...i.filter(a=>!a.id.startsWith("enemy_"))):s.push(...i.filter(a=>a.id.startsWith("enemy_")));break;case"heal":case"item":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_"))):s.push(...i.filter(a=>!a.id.startsWith("enemy_")));break;case"defend":case"environmental":s.push(e);break;case"teamUp":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_")&&a.id!==e.id)):s.push(...i.filter(a=>!a.id.startsWith("enemy_")&&a.id!==e.id));break;default:s.push(...i)}return console.log(`Valid targets for ${e.name} (${n}):`,s.map(a=>a.name)),s}makeEnemyDecision(e,n,r,s){var f;const i=r[Math.floor(Math.random()*r.length)],a=e.hp/e.maxHp,l=(f=e.class)==null?void 0:f.toLowerCase();if(e.level,l==="priest"||l==="cleric"){if(a<.4&&n.includes("spell"))return{action:"spell",target:e.id,spellType:"healing",specialAttack:"Divine Healing",damageType:"healing",attribute:"wisdom"};if(n.includes("spell"))return{action:"spell",target:i.id,spellType:"divine",specialAttack:"Divine Smite",damageType:"radiant",attribute:"wisdom"}}if((l==="wizard"||l==="mage"||l==="sorcerer")&&n.includes("spell")){const m=["fireball","lightning","ice","arcane"],g=m[Math.floor(Math.random()*m.length)];return{action:"spell",target:i.id,spellType:g,specialAttack:`${g.charAt(0).toUpperCase()+g.slice(1)} Spell`,damageType:g==="fireball"?"fire":g==="lightning"?"lightning":g==="ice"?"cold":"arcane",attribute:"intelligence"}}if((l==="boss"||l==="dragon")&&n.includes("special"))return{action:"special",target:i.id,specialAttack:"Devastating Strike",damageType:"physical",attribute:"strength",isBossAttack:!0};if((l==="undead"||l==="skeleton"||l==="zombie")&&n.includes("spell"))return{action:"spell",target:i.id,spellType:"necrotic",specialAttack:"Death Touch",damageType:"necrotic",attribute:"constitution"};if(a<.3){if(n.includes("item"))return{action:"item",target:e.id,itemType:"healing",specialAttack:"Use Healing Potion",damageType:"healing",attribute:"constitution"};if(n.includes("defend"))return{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}}return s.combatants.filter(m=>m.id.startsWith("enemy_")&&m.hp/m.maxHp<.5).length>1&&n.includes("spell")?{action:"spell",target:i.id,spellType:"area",specialAttack:"Area Attack",damageType:"mixed",attribute:"intelligence"}:n.includes("attack")?{action:"attack",target:i.id,specialAttack:"Standard Attack",damageType:"physical",attribute:"strength"}:{action:n[Math.floor(Math.random()*n.length)],target:i.id,specialAttack:"Basic Action",damageType:"physical",attribute:"strength"}}async executeEnemyTurn(e,n){const r=this.chooseEnemyAction(n,e);return console.log("Enemy decision details:",{enemy:n.name,decision:r,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute}),r.target?await this.executeAction(e,n.id,r.action,r.target,{itemType:r.itemType,spellType:r.spellType,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,isBossAttack:r.isBossAttack}):await this.executeAction(e,n.id,"defend",n.id,{specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute})}}const Hn=new zR;function WR(){var Rr;const{partyId:t}=iu(),e=zn(),r=ei().pathname,[s,i]=R.useState(null),[a,l]=R.useState(null),[u,d]=R.useState(null),[f,m]=R.useState([]),[g,b]=R.useState([]),[S,E]=R.useState({}),[k,_]=R.useState(!0),[x,N]=R.useState(""),[M,D]=R.useState(""),[U,v]=R.useState(!1),[y,T]=R.useState(!1),[C,A]=R.useState(!1),P=R.useRef(!1),I=R.useRef(!1),[ke,Oe]=R.useState([]),[$e,qe]=R.useState("Investigation"),[J,re]=R.useState([]),[ue,Q]=R.useState(!1),[W,X]=R.useState(null),[le,pe]=R.useState(!1),[Ee,ae]=R.useState(!1),[fe,be]=R.useState(null),[_e,Ae]=R.useState(null),[me]=R.useState(()=>new Gm),[ut]=R.useState(()=>new Iu);R.useEffect(()=>{const V=ai(H=>{if(!H){e("/login");return}i(H)});return()=>V()},[e]),R.useEffect(()=>{s&&t&&cn()},[s,t]),R.useEffect(()=>{if(t)try{const V=eb(t,H=>{H&&H.status==="active"&&(r.includes("/combat/")||e(`/combat/${t}`))});return()=>V()}catch(V){console.error("Error subscribing to combat session:",V)}},[t,e,r]),R.useEffect(()=>{if(t)try{const V=zm(gn(Dt(je,"characters"),Qt("partyId","==",t)),H=>{const ee=H.docs.map(de=>({id:de.id,...de.data()}));console.log("Characters updated in real-time:",ee),m(ee)},H=>{console.error("Error subscribing to character updates:",H)});return()=>V()}catch(V){console.error("Error setting up character subscription:",V)}},[t]),R.useEffect(()=>()=>{A(!1)},[]),R.useEffect(()=>{(a==null?void 0:a.status)==="ready_up"&&(I.current=!1,P.current=!1)},[a==null?void 0:a.status]),R.useEffect(()=>{var V;if(s&&f.length>0&&a){const H=f.find(de=>de.userId===s.uid),ee=(V=a.readyPlayers)==null?void 0:V.includes(s.uid);H&&!ee&&a.status==="ready_up"&&ge()}},[f,a,s]);const cn=async()=>{var V,H;try{_(!0),console.log("Loading story and characters for partyId:",t);const[ee,de,j]=await Promise.all([iR(t),qm(t),Z_(t)]);if(console.log("Loaded characters:",de),console.log("Loaded story:",ee),console.log("Loaded party:",j),m(de),d(j),de.length===0&&s)try{const z=(await Hm(s.uid)).find(B=>B.id===t);if(z){b(z.members||[]),console.log("Loaded party members:",z.members);const B={};for(const Te of z.members)try{const K=await Ho(Te);B[Te]=K}catch(K){console.error("Error loading profile for member:",Te,K),B[Te]=null}E(B)}}catch(F){console.error("Error loading party members:",F)}if(ee){if(ee.votingSession&&ee.status==="voting"&&(await $r(ee.id,{votingSession:null}),ee.votingSession=null),ee.storyMessages){const F=ee.storyMessages.filter(z=>{var B,Te;return!((B=z.content)!=null&&B.includes("tie"))&&!((Te=z.content)!=null&&Te.includes("vote again"))&&z.type!=="tie_break"});F.length!==ee.storyMessages.length&&(await $r(ee.id,{storyMessages:F}),ee.storyMessages=F)}if(l(ee),v(((V=ee.readyPlayers)==null?void 0:V.includes(s==null?void 0:s.uid))||!1),ee.status==="storytelling"&&j){const F=mv(j.description||"");Oe(F);const z=((H=ee.storyMessages)==null?void 0:H.length)||0;z<5?qe("Investigation"):z<15?qe("Conflict"):qe("Resolution")}}else{const F=await sR(t);l(F)}}catch(ee){console.error("Error in loadStoryAndCharacters:",ee),N("Failed to load campaign story")}finally{_(!1)}};R.useEffect(()=>{if(a!=null&&a.id&&s){const V=oR(a.id,H=>{var ee,de,j;if(H&&(l(H),v(((ee=H.readyPlayers)==null?void 0:ee.includes(s.uid))||!1),H.status==="voting"&&(T(!1),I.current=!1),H.status==="storytelling"&&u)){if(ke.length===0){const B=mv(u.description||"");Oe(B)}const F=((de=H.storyMessages)==null?void 0:de.length)||0;F<5&&$e!=="Investigation"?qe("Investigation"):F>=5&&F<15&&$e!=="Conflict"?qe("Conflict"):F>=15&&$e!=="Resolution"&&qe("Resolution");const z=(j=H.storyMessages)==null?void 0:j[H.storyMessages.length-1];if(z&&z.role==="assistant"){const B=LR(ke,z.content);re(B)}}});return()=>V()}},[a==null?void 0:a.id,s==null?void 0:s.uid,u,ke,$e]);const ge=async()=>{if(!s)return;if(!f.find(H=>H.userId===s.uid)){e(`/character-creation/${t}`);return}try{await aR(a.id,s.uid),v(!0)}catch{N("Failed to ready up")}},xt=async()=>{var H;if(P.current||I.current||(a==null?void 0:a.status)==="voting"||(a==null?void 0:a.status)==="storytelling"){console.log("Plot generation already in progress or completed");return}const V=(H=a==null?void 0:a.storyMessages)==null?void 0:H.filter(ee=>ee.type==="plot_selection");if(V&&V.length>0){console.log("Plots already exist, skipping generation"),(a==null?void 0:a.status)==="ready_up"&&await $r(a.id,{status:"voting",votingSession:null});return}if(k){console.log("Already loading, skipping request");return}try{if(P.current=!0,I.current=!0,T(!0),_(!0),(a==null?void 0:a.status)!=="ready_up"){console.log("Story is no longer in ready_up status");return}const de=`Generate 3 distinct campaign plot options for this party. For each plot, provide a compelling title and a brief summary (2-3 sentences). Format as:

Plot 1: [Title]
[Summary]

Plot 2: [Title]  
[Summary]

Plot 3: [Title]
[Summary]

Party: ${f.map(F=>`${F.name} - Level ${F.level} ${F.race} ${F.class}. ${F.personality||""}. ${F.backstory||""}`).join(`
`)}`,j=await Qn.generatePlotOptions(f,u);await Sd(a.id,{role:"assistant",content:j,type:"plot_selection"}),await $r(a.id,{status:"voting",votingSession:null})}catch(ee){N("Failed to start story generation"),console.error(ee)}finally{P.current=!1,T(!1),_(!1)}},Ar=async V=>{if(!(!s||!u)){if(u.dmId!==s.uid){N("Only the campaign creator can select the plot");return}if((a==null?void 0:a.status)==="storytelling"){console.log("Plot already selected, story in progress");return}try{_(!0);const H=a.storyMessages.find(j=>j.type==="plot_selection"),ee=await Qn.generateCampaignGoal(f,(H==null?void 0:H.content)||"",u);await $r(a.id,{status:"storytelling",currentPlot:V,votingSession:null,campaignMetadata:{...a.campaignMetadata,mainGoal:ee,campaignPhase:gt.INTRODUCTION,plotDetails:(H==null?void 0:H.content)||""}}),await Sd(a.id,{role:"assistant",content:`The Dungeon Master has chosen Plot ${V}! Let the story begin...`,type:"plot_selected"});const de=await Qn.generateStoryIntroduction(f,(H==null?void 0:H.content)||"",V,u);await Sd(a.id,{role:"assistant",content:de,type:"story_introduction"}),await kd(a.id,u.dmId)}catch(H){N("Failed to select plot"),console.error(H)}finally{_(!1)}}},sr=async()=>{var V,H;if(!(!M.trim()||!s||!a))try{_(!0);const ee=W||await dR(a.id),de=f.find(z=>z.userId===s.uid);if(!de){N("You need a character to participate in the story");return}const j={context:"campaign_story",storyState:ee,customContext:{description:((V=ee==null?void 0:ee.currentLocation)==null?void 0:V.description)||"A mysterious location",environmentalFeatures:((H=ee==null?void 0:ee.currentLocation)==null?void 0:H.features)||[],npcs:(ee==null?void 0:ee.npcs)||[],circumstances:ze(ee)}},F=me.validatePlayerAction(M,de,j);if(F.valid&&F.diceResult){be(F),pe(!0),F.diceResult.actions&&(Ae(F.diceResult),ae(!0));return}await Lt(M,de,ee,F)}catch(ee){N("Failed to send response"),console.error(ee)}finally{_(!1)}},Lt=async(V,H,ee,de)=>{var K;await addStoryMessageWithMetadata(a.id,{role:"user",content:V,userId:s.uid,characterName:H.name},ee);const j=jR(V,ke);j.length>0&&Oe(ne=>{const De=[...ne];return j.forEach(He=>{const Ge=De.findIndex(Ot=>Ot.id===He.id);Ge!==-1&&(De[Ge]=He)}),De});let F;a.campaignMetadata&&a.campaignMetadata.mainGoal?F=await Qn.generateCampaignContinuation(f,a.campaignMetadata,a.storyMessages,V,u):F=await Qn.generateStoryContinuation(f,a.storyMessages,V,ee,"individual",u);let z=null;de&&de.entities?z=de.entities:z=me.extractEntities(F,{storyState:ee,partyCharacters:f});const B=BR.updateStoryState(ee,F,V,H.id);if(z&&(B.extractedEntities=z,B.knownEntities||(B.knownEntities={enemies:[],items:[],locations:[],statusEffects:[],questHooks:[],npcs:[]}),Object.keys(z).forEach(ne=>{z[ne]&&z[ne].length>0&&z[ne].forEach(De=>{const He=B.knownEntities[ne].findIndex(Ge=>Ge.name.toLowerCase()===De.name.toLowerCase());He===-1?B.knownEntities[ne].push(De):B.knownEntities[ne][He]={...B.knownEntities[ne][He],...De}})})),await hR(a.id,B),X(B),await addStoryMessageWithMetadata(a.id,{role:"assistant",content:F,type:"story_continuation",entities:z},B),a.campaignMetadata){const ne=VR(a.campaignMetadata,a.storyMessages),De=FR(a.campaignMetadata,a.storyMessages,ke),He=$R(a.campaignMetadata,a.storyMessages,ke),Ge={"campaignMetadata.storyContext":{...a.campaignMetadata.storyContext,...ne},"campaignMetadata.campaignProgress":De};He&&(Ge["campaignMetadata.campaignPhase"]=He),await $r(a.id,Ge)}else console.warn("No campaign metadata found, skipping campaign updates");D("");const Te=O(F,B,V,de);if(Te.shouldInitiate){A(!0);const ne={storyContext:F,partyMembers:f,enemies:_t(F,f.length,Te.enemyType),environmentalFeatures:((K=B.currentLocation)==null?void 0:K.features)||[],teamUpOpportunities:Hn.identifyTeamUpOpportunities(f),narrativeElements:Hn.extractNarrativeElements(F),extractedEntities:z},De=await createEnhancedCombatSession(t,ne);await $r(a.id,{status:"paused",currentCombat:De.id}),setTimeout(()=>{e(`/combat/${t}`)},2e3)}},ze=V=>{var ee,de,j,F;const H=[];if(!V)return H;if(V.currentLocation){const z=V.currentLocation;(ee=z.atmosphere)!=null&&ee.includes("dangerous")&&H.push("in danger"),(de=z.atmosphere)!=null&&de.includes("hostile")&&H.push("in hostile environment"),(j=z.atmosphere)!=null&&j.includes("peaceful")&&H.push("in peaceful environment"),z.lighting==="dark"&&H.push("in darkness"),z.weather==="stormy"&&H.push("in storm")}return((F=V.npcs)==null?void 0:F.length)>0&&V.npcs.filter(B=>B.disposition==="hostile").length>0&&H.push("with hostile NPCs"),H},O=(V,H,ee,de)=>{var Ot,oa,bt,la,jr,Dr,Go,Ko,ir;const j=["combat","battle","fight","attack","enemy","monster"],F=["tension","threat","danger","hostile","aggressive"],z=j.some(Nn=>V.toLowerCase().includes(Nn)),B=F.some(Nn=>V.toLowerCase().includes(Nn)),Te=((oa=(Ot=H==null?void 0:H.currentLocation)==null?void 0:Ot.atmosphere)==null?void 0:oa.includes("dangerous"))||((la=(bt=H==null?void 0:H.currentLocation)==null?void 0:bt.atmosphere)==null?void 0:la.includes("hostile"))||((Dr=(jr=H==null?void 0:H.currentLocation)==null?void 0:jr.atmosphere)==null?void 0:Dr.includes("threatening")),K=j.some(Nn=>ee.toLowerCase().includes(Nn)),ne=(Ko=(Go=de==null?void 0:de.diceResult)==null?void 0:Go.actions)==null?void 0:Ko.some(Nn=>["attack","spell","dodge","parry"].includes(Nn.action)),De=((ir=H==null?void 0:H.npcs)==null?void 0:ir.some(Nn=>Nn.disposition==="hostile"))||V.toLowerCase().includes("enemy")||V.toLowerCase().includes("monster")||V.toLowerCase().includes("creature");let He="bandit";const Ge=V.toLowerCase();return Ge.includes("goblin")?He="goblin":Ge.includes("orc")?He="orc":Ge.includes("troll")?He="troll":Ge.includes("dragon")?He="dragon":Ge.includes("undead")||Ge.includes("skeleton")?He="skeleton":Ge.includes("zombie")&&(He="zombie"),{shouldInitiate:z||B&&Te||K||ne&&De,reason:z?"explicit_combat":B&&Te?"escalating_tension":K?"player_intent":ne&&De?"action_triggered_combat":"none",enemyType:He}},te=()=>{pe(!1),be(null)},ve=()=>{ae(!1),Ae(null)},Ie=async()=>{if(!fe)return;const V=f.find(ee=>ee.userId===s.uid);if(!V)return;const H=ut.validateAction(M,V,{context:"campaign_story",validation:fe});Ae(H),ae(!0),pe(!1)},rt=()=>{pe(!1),be(null)},_t=(V,H,ee="bandit")=>{const de={goblin:{name:"Goblin",hp:12,ac:14,level:1,charisma:8},orc:{name:"Orc",hp:30,ac:16,level:3,charisma:12},troll:{name:"Troll",hp:84,ac:15,level:5,charisma:7},dragon:{name:"Dragon",hp:200,ac:19,level:10,charisma:19},bandit:{name:"Bandit",hp:16,ac:12,level:1,charisma:10},skeleton:{name:"Skeleton",hp:13,ac:13,level:1,charisma:5},zombie:{name:"Zombie",hp:22,ac:8,level:1,charisma:3}},j=de[ee]||de.bandit,F=Math.min(H+1,6),z=[];for(let B=0;B<F;B++)z.push({id:`enemy_${B}`,name:`${j.name} ${B+1}`,type:j.name,hp:j.hp+Math.floor(Math.random()*10),maxHp:j.hp+Math.floor(Math.random()*10),ac:j.ac+Math.floor(Math.random()*3),initiative:Math.floor(Math.random()*20)+1,charisma:j.charisma,portrait:"/placeholder-enemy.png"});return z},Ue=V=>{if(!V)return V;const H=["enemy","enemies","monster","monsters","bandit","bandits","goblin","goblins","orc","orcs","dragon","dragons","troll","trolls","zombie","zombies","skeleton","skeletons","assassin","assassins","guard","guards","soldier","soldiers","thief","thieves","brigand","brigands","raider","raiders","cultist","cultists","demon","demons","devil","devils","ghost","ghosts","specter","specters","wraith","wraiths","hobgoblin","hobgoblins","bugbear","bugbears","kobold","kobolds","ogre","ogres","giant","giants","beholder","beholders","lich","liches","vampire","vampires","werewolf","werewolves","hag","hags","witch","witches","necromancer","necromancers"],ee=["search","investigate","examine","look around","check","explore","clue","clues","evidence","footprint","footprints","track","tracks","marking","markings","sign","signs","trace","traces","remains","ruin","ruins","artifact","artifacts","scroll","scrolls","book","books","map","maps","diary","journal","note","notes","door","doors","passage","passages","tunnel","tunnels","chamber","chambers","room","rooms","area","areas","mystery","mysterious","hidden","secret","secrets","concealed","strange","unusual","curious","suspicious","odd","peculiar","trap","traps","pressure plate","pressure plates","lever","levers","button","buttons","switch","switches","key","keys","lock","locks"],de=["tavern","inn","shop","market","temple","castle","fortress","tower","dungeon","cave","forest","mountain","river","bridge","gate","wall","street","alley","square","plaza","district","village","town","city","settlement","outpost","camp","crypt","tomb","grave","cemetery","shrine","altar","library","archive","guild","hall","mansion","palace","basement","cellar","attic","rooftop","balcony","courtyard","garden","park","field","meadow","swamp","desert","island"],j=["attack","fight","battle","combat","defend","strike","sword","swords","axe","axes","bow","bows","arrow","arrows","spell","spells","magic","magical","cast","casting","initiative","turn","round","action","movement","charge","retreat","advance","position","formation","shield","armor","helmet","dagger","daggers","mace","maces","fireball","lightning","heal","healing","cure","bless","curse"];let F=V;return[...H,...ee,...de,...j].forEach(B=>{const Te=new RegExp(`\\b${B}\\b`,"gi");F=F.replace(Te,`<strong>${B}</strong>`)}),F},st=()=>{var V;return((V=a==null?void 0:a.readyPlayers)==null?void 0:V.length)||0},In=()=>u&&u.members&&Array.isArray(u.members)?u.members.length:f.length>0?f.length:g.length>0?g.length:1,Ts=st()===In(),Cs=()=>{const V=a.storyMessages.filter(H=>H.type==="plot_selection");if(V.length>0){const ee=V[V.length-1].content.split(`
`),de=[];let j=null;const F=new Set;return ee.forEach(z=>{var Te;const B=z.trim();if(B.startsWith("Plot 1:")||B.startsWith("Plot 2:")||B.startsWith("Plot 3:")){j&&!F.has(j.title)&&(de.push(j),F.add(j.title));const K=(Te=B.match(/Plot (\d+):/))==null?void 0:Te[1],ne=B.replace(/Plot \d+:\s*/,"").trim();F.has(ne)?j=null:j={number:parseInt(K),title:ne,summary:""}}else j&&B&&!B.startsWith("Party:")&&!B.startsWith("CRITICAL")&&!B.startsWith("Make each")&&(j.summary+=(j.summary?" ":"")+B)}),j&&!F.has(j.title)&&de.push(j),de.slice(0,3)}return[{number:1,title:"Plot 1",summary:"No plot data available"},{number:2,title:"Plot 2",summary:"No plot data available"},{number:3,title:"Plot 3",summary:"No plot data available"}]},Ss=()=>!f.length||!s?f:[...f].sort((V,H)=>V.userId===s.uid?-1:H.userId===s.uid?1:0),wn=()=>{if(!(a!=null&&a.campaignMetadata))return null;const V=a.campaignMetadata;return o.jsxs("div",{className:"bg-purple-900/20 border border-purple-600 rounded-lg p-4 mb-6",children:[o.jsx("h3",{className:"font-bold text-purple-200 mb-2",children:" Campaign Progress"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Session:"})," ",V.sessionNumber]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Phase:"})," ",V.campaignPhase.replace("_"," ")]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Progress:"})," ",V.campaignProgress,"%"]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Goal:"})," ",V.mainGoal?"Set":"Pending"]})]}),V.mainGoal&&o.jsxs("div",{className:"mt-2 text-purple-200",children:[o.jsx("span",{className:"font-semibold",children:"Main Goal:"})," ",V.mainGoal]})]})};return s?k?o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("div",{className:"text-gray-400",children:"Loading campaign story..."})})})}):o.jsxs("div",{className:"fantasy-container py-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:"Campaign Story"}),o.jsx("button",{onClick:()=>e("/dashboard"),className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Back to Dashboard"})]}),x&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded-lg mb-6",children:x}),C&&o.jsx("div",{className:"bg-orange-900/20 border border-orange-600 text-orange-200 px-4 py-3 rounded-lg mb-6",children:o.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[o.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-orange-500"}),o.jsx("span",{className:"font-semibold",children:" Combat is being initiated! Redirecting to battle arena..."})]})}),(a==null?void 0:a.status)==="paused"&&(a==null?void 0:a.currentCombat)&&o.jsx("div",{className:"bg-blue-900/20 border border-blue-600 text-blue-200 px-4 py-3 rounded-lg mb-6",children:o.jsx("div",{className:"flex items-center justify-center space-x-2",children:o.jsx("span",{className:"font-semibold",children:" Story is paused for combat. Please wait for the battle to conclude."})})}),(a==null?void 0:a.status)==="ready_up"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-4",children:"Ready Up"}),o.jsx("p",{className:"text-gray-300 mb-4",children:"All players must ready up before the story begins"}),o.jsxs("div",{className:"mb-6",children:[o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-2",children:[o.jsxs("div",{className:"text-lg font-semibold text-amber-400",children:[st(),"/",In()," Players Ready"]}),o.jsxs("div",{className:"text-sm text-gray-400",children:["(",Math.round(st()/In()*100),"%)"]})]}),o.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 max-w-md mx-auto",children:o.jsx("div",{className:"bg-amber-500 h-2 rounded-full transition-all duration-300",style:{width:`${st()/In()*100}%`}})})]}),f.length===0&&o.jsx("div",{className:"bg-blue-900/20 border border-blue-600 rounded-lg p-4 mb-4",children:o.jsxs("p",{className:"text-blue-200",children:[o.jsx("strong",{children:"No characters created yet!"})," Players should create their characters first. You can still ready up and start the story, but characters will need to be created before the adventure begins."]})})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.length>0?Ss().map(V=>{var de;const H=(de=a.readyPlayers)==null?void 0:de.includes(V.userId),ee=V.userId===(s==null?void 0:s.uid);return o.jsx("div",{className:`fantasy-card transition-all duration-200 ${H?"bg-green-900/20 border-green-600":"bg-amber-900/20 border-amber-600"}`,children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 bg-gray-600 rounded-full mx-auto mb-2 flex items-center justify-center",children:o.jsx("span",{className:"text-xs text-gray-300",children:"IMG"})}),o.jsx("h3",{className:"font-bold text-gray-100",children:V.name}),o.jsxs("p",{className:"text-sm text-gray-300",children:["Level ",V.level," ",V.race," ",V.class]}),ee&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"text-blue-400 text-xs font-medium",children:"(You)"}),o.jsx("div",{className:"mt-2",children:o.jsx("button",{className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 text-xs px-3 py-1 mt-2",onClick:()=>e(`/character-creation/${t}`),children:"Edit Character"})})]}),o.jsx("div",{className:"mt-2",children:H?o.jsxs("div",{className:"flex items-center justify-center space-x-1 text-green-400 font-semibold",children:[o.jsx("span",{children:""}),o.jsx("span",{children:"Ready"})]}):o.jsxs("div",{className:"flex items-center justify-center space-x-1 text-gray-400",children:[o.jsx("div",{className:"w-3 h-3 border-2 border-gray-500 border-t-gray-300 rounded-full animate-spin"}),o.jsx("span",{children:"Waiting..."})]})})]})},V.id)}):g.map((V,H)=>{var z;const ee=S[V],de=(ee==null?void 0:ee.username)||`Player ${H+1}`,j=(z=a.readyPlayers)==null?void 0:z.includes(V),F=V===(s==null?void 0:s.uid);return o.jsx("div",{className:`fantasy-card transition-all duration-200 ${j?"bg-green-900/20 border-green-600":"bg-amber-900/20 border-amber-600"}`,children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 bg-gray-600 rounded-full mx-auto mb-2 flex items-center justify-center",children:o.jsx("span",{className:"text-xs text-gray-300",children:"IMG"})}),o.jsx("h3",{className:"font-bold text-gray-100",children:de}),o.jsx("p",{className:"text-sm text-gray-300",children:"No character created yet"}),F&&o.jsx("span",{className:"text-blue-400 text-xs font-medium",children:"(You)"}),o.jsx("div",{className:"mt-2",children:j?o.jsxs("div",{className:"flex items-center justify-center space-x-1 text-green-400 font-semibold",children:[o.jsx("span",{children:""}),o.jsx("span",{children:"Ready"})]}):o.jsxs("div",{className:"flex items-center justify-center space-x-1 text-gray-400",children:[o.jsx("div",{className:"w-3 h-3 border-2 border-gray-500 border-t-gray-300 rounded-full animate-spin"}),o.jsx("span",{children:"Waiting..."})]})})]})},V)})}),o.jsxs("div",{className:"text-center",children:[U?o.jsx("div",{className:"text-green-400 font-semibold",children:"You are ready!"}):o.jsx("button",{onClick:ge,className:"fantasy-button",children:f.find(V=>V.userId===(s==null?void 0:s.uid))?"Ready Up":"Create Character & Ready Up"}),Ts&&o.jsx("button",{onClick:xt,disabled:k||y||(a==null?void 0:a.status)==="voting",className:"fantasy-button bg-amber-600 hover:bg-amber-700 ml-4",children:k||y?"Generating Story...":"Start Story Generation"})]})]}),(a==null?void 0:a.status)==="voting"&&o.jsxs("div",{className:"space-y-6",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-100",children:"Choose Your Adventure"}),u&&u.dmId===(s==null?void 0:s.uid)?o.jsx("div",{className:"space-y-4",children:o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Cs().map(V=>o.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-2 text-lg",children:V.title}),o.jsx("p",{className:"text-gray-300 text-sm mb-4",children:V.summary}),o.jsx("button",{onClick:()=>Ar(V.number),disabled:k,className:"fantasy-button w-full bg-amber-600 hover:bg-amber-700",children:k?"Selecting...":`Choose Plot ${V.number}`})]},V.number))})}):o.jsxs("div",{className:"bg-blue-900/20 border border-blue-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-blue-200 mb-2",children:" Waiting for Dungeon Master"}),o.jsx("p",{className:"text-blue-200",children:"The campaign creator is choosing which plot to pursue. Please wait while they make their decision."}),o.jsx("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:Cs().map(V=>o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-3",children:[o.jsx("h4",{className:"font-bold text-gray-100 mb-2",children:V.title}),o.jsx("p",{className:"text-gray-300 text-sm",children:V.summary})]},V.number))})]})]}),((a==null?void 0:a.status)==="storytelling"||(a==null?void 0:a.status)==="paused")&&o.jsxs("div",{className:"space-y-6",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-100",children:"Your Adventure"}),(u==null?void 0:u.dmId)===(s==null?void 0:s.uid)&&o.jsxs("div",{className:"bg-purple-900/20 border border-purple-600 rounded-lg p-4",children:[o.jsxs("h3",{className:"font-bold text-purple-200 mb-2",children:[" Story Phase: ",$e]}),o.jsxs("p",{className:"text-purple-200 text-sm",children:[$e==="Investigation"&&"Explore, discover clues, and gather information about the situation.",$e==="Conflict"&&"Face challenges, threats, and make difficult choices.",$e==="Resolution"&&"Conclude the story arc and see the consequences of your actions."]})]}),(u==null?void 0:u.dmId)===(s==null?void 0:s.uid)&&ke.length>0&&o.jsxs("div",{className:"bg-emerald-900/20 border border-emerald-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-emerald-200 mb-3",children:" Discovered Objectives"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:MR(ke).map(V=>o.jsxs("div",{className:"bg-gray-700 border border-emerald-500 rounded-lg p-3",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-emerald-200 text-sm",children:V.title}),o.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${V.state===Ht.COMPLETED?"bg-green-900 text-green-200":V.state===Ht.IN_PROGRESS?"bg-blue-900 text-blue-200":"bg-yellow-900 text-yellow-200"}`,children:V.state===Ht.COMPLETED?" Complete":V.state===Ht.IN_PROGRESS?" In Progress":" Discovered"})]}),o.jsx("p",{className:"text-emerald-200 text-xs",children:V.description})]},V.id))}),J.length>0&&o.jsxs("div",{className:"mt-4 pt-4 border-t border-emerald-500",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-emerald-200 text-sm",children:" Subtle Hints"}),o.jsxs("button",{onClick:()=>Q(!ue),className:"text-emerald-300 hover:text-emerald-100 text-xs",children:[ue?"Hide":"Show"," Hints"]})]}),ue&&o.jsx("div",{className:"space-y-2",children:J.map((V,H)=>o.jsx("div",{className:"text-emerald-200 text-xs italic",children:V},H))})]})]}),o.jsxs("div",{className:"bg-blue-900/20 border border-blue-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-blue-200 mb-2",children:" Storytelling Guidelines"}),o.jsxs("p",{className:"text-blue-200 text-sm",children:[o.jsx("strong",{children:"Turn-taking:"})," Respond to the story or let someone else speak. Only one person can respond at a time."]})]}),o.jsx("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4 max-h-96 overflow-y-auto",children:a.storyMessages.filter(V=>V.type!=="plot_selection").map(V=>o.jsx("div",{className:"mb-4",children:V.role==="assistant"?o.jsxs("div",{className:"bg-blue-900/20 border border-blue-600 rounded-lg p-3",children:[o.jsx("div",{className:"font-semibold text-blue-200 mb-1",children:"Game Master"}),o.jsx("div",{className:"text-blue-100 whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:Ue(V.content)}})]}):o.jsxs("div",{className:"bg-green-900/20 border border-green-600 rounded-lg p-3",children:[o.jsx("div",{className:"font-semibold text-green-200 mb-1",children:V.playerName}),o.jsx("div",{className:"text-green-100",dangerouslySetInnerHTML:{__html:Ue(V.content)}})]})},V.id))}),(a==null?void 0:a.status)==="storytelling"&&(a!=null&&a.currentSpeaker)?o.jsxs("div",{className:"space-y-4",children:[a.currentSpeaker.userId===(s==null?void 0:s.uid)?o.jsxs("div",{className:"bg-amber-900/20 border border-amber-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-amber-200 mb-3",children:"How will you respond?"}),o.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[o.jsx("div",{className:"w-10 h-10 bg-amber-600 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-amber-100 font-bold",children:a.currentSpeaker.name.charAt(0)})}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium text-amber-200",children:a.currentSpeaker.name}),o.jsxs("div",{className:"text-sm text-amber-300",children:[a.currentSpeaker.race," ",a.currentSpeaker.class]})]})]}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("input",{type:"text",value:M,onChange:V=>D(V.target.value),placeholder:`What does ${a.currentSpeaker.name} do?`,className:"fantasy-input flex-1",onKeyPress:V=>V.key==="Enter"&&sr()}),o.jsx("button",{onClick:sr,disabled:!M.trim(),className:"fantasy-button",children:"Send"})]})]}):o.jsxs("div",{className:"bg-blue-900/20 border border-blue-600 rounded-lg p-4",children:[o.jsxs("h3",{className:"font-bold text-blue-200 mb-3",children:["Waiting for ",a.currentSpeaker.name," to respond"]}),o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-blue-100 font-bold",children:a.currentSpeaker.name.charAt(0)})}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium text-blue-200",children:a.currentSpeaker.name}),o.jsxs("div",{className:"text-sm text-blue-300",children:[a.currentSpeaker.race," ",a.currentSpeaker.class]})]})]}),o.jsxs("p",{className:"text-blue-200 mt-2",children:[a.currentSpeaker.name," is currently speaking. Please wait for their response."]})]}),(((Rr=a==null?void 0:a.currentSpeaker)==null?void 0:Rr.userId)===(s==null?void 0:s.uid)||(a==null?void 0:a.currentController)===(s==null?void 0:s.uid))&&o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsx("h4",{className:"font-bold text-gray-100 mb-3 text-center",children:"Let someone else speak"}),o.jsx("div",{className:"flex justify-center",children:o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-4xl",children:Ss().map(V=>{var ee,de;const H=V.userId===(s==null?void 0:s.uid);return o.jsxs("button",{onClick:async()=>{await hv(a.id,V),await kd(a.id,V.userId)},disabled:V.id===((ee=a==null?void 0:a.currentSpeaker)==null?void 0:ee.id),className:`p-4 rounded-lg border-2 transition-colors text-center ${V.id===((de=a==null?void 0:a.currentSpeaker)==null?void 0:de.id)?"border-gray-500 bg-gray-600 text-gray-400 cursor-not-allowed":"border-gray-600 bg-gray-700 hover:border-gray-500 text-gray-200"}`,children:[o.jsxs("div",{className:"font-medium mb-1",children:[o.jsx("span",{children:V.name}),H&&o.jsx("span",{className:"text-blue-400 text-xs font-medium ml-1",children:"(you)"})]}),o.jsxs("div",{className:"text-sm opacity-75",children:[V.race," ",V.class]})]},V.id)})})})]})]}):(u==null?void 0:u.dmId)===(s==null?void 0:s.uid)||(a==null?void 0:a.currentController)===(s==null?void 0:s.uid)?o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3 text-center",children:"Choose who speaks"}),o.jsx("div",{className:"flex justify-center",children:o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-4xl",children:Ss().map(V=>{const H=V.userId===(s==null?void 0:s.uid);return o.jsxs("button",{onClick:async()=>{await hv(a.id,V),await kd(a.id,V.userId)},className:"p-4 rounded-lg border-2 border-gray-600 bg-gray-700 hover:border-gray-500 text-gray-200 transition-colors text-center",children:[o.jsxs("div",{className:"font-medium mb-1",children:[o.jsx("span",{children:V.name}),H&&o.jsx("span",{className:"text-blue-400 text-xs font-medium ml-1",children:"(you)"})]}),o.jsxs("div",{className:"text-sm opacity-75",children:[V.race," ",V.class]})]},V.id)})})})]}):o.jsxs("div",{className:"bg-blue-900/20 border border-blue-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-blue-200 mb-3",children:a.storyMessages.length>0?"Waiting for next speaker":"Waiting for the story to begin"}),o.jsx("p",{className:"text-blue-200",children:a.storyMessages.length>0?"The Dungeon Master is choosing who will speak next. Please wait.":"The Dungeon Master is choosing who will speak first. Please wait."})]}),(a==null?void 0:a.status)==="storytelling"&&wn()]})]}),le&&fe&&o.jsx(tb,{validation:fe,onClose:te,onProceed:Ie,onRevise:rt,context:"campaign"}),Ee&&_e&&o.jsx(nb,{diceResult:_e,onClose:ve,onProceed:async()=>{if(ve(),fe){const V=f.find(H=>H.userId===s.uid);V&&await Lt(M,V,W,fe)}},context:"campaign"})]}):o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("div",{className:"text-gray-400",children:"Loading..."})})})})}function qR(){var Rr,V,H,ee,de;const{partyId:t}=iu(),e=zn(),n=ei(),[r,s]=R.useState(null),[i,a]=R.useState(null),[l,u]=R.useState(!0),[d,f]=R.useState([]),[m,g]=R.useState(null),[b,S]=R.useState(null),[E,k]=R.useState(""),[_,x]=R.useState(""),[N,M]=R.useState([]),[D,U]=R.useState([]),[v,y]=R.useState([]),[T,C]=R.useState(!1),[A,P]=R.useState(""),[I,ke]=R.useState(""),[Oe,$e]=R.useState(!1),[qe,J]=R.useState(!1),[re,ue]=R.useState(null),[Q,W]=R.useState(-1),[X,le]=R.useState(null),[pe,Ee]=R.useState(!1),[ae,fe]=R.useState(!1),[be,_e]=R.useState(new Set),[Ae,me]=R.useState([]),[ut,cn]=R.useState(!1),ge=(Rr=n.state)==null?void 0:Rr.isTestCombat,xt=n.state;R.useEffect(()=>{const j=ai(F=>{if(!F){e("/login");return}s(F)});return()=>j()},[e]),R.useEffect(()=>{ge&&xt?Ar():t&&sr()},[ge,xt,t]),R.useEffect(()=>{if(t&&!ge){const j=eb(t,F=>{var z;if(a(F),u(!1),F){Lt(F),U(F.environmentalFeatures||[]),y(F.teamUpOpportunities||[]),In();const B=(z=F.combatants)==null?void 0:z[F.currentTurn];B&&B.id.startsWith("enemy_")&&F.combatState==="active"&&F.currentTurn!==Q&&!Oe&&!T&&(console.log("Auto-processing enemy turn for:",B.name,"turn:",F.currentTurn),W(F.currentTurn),setTimeout(()=>{Ie()},1e3))}});return()=>j()}},[t,Q,Oe,T,ge]),R.useEffect(()=>{var j,F;if(i&&ge&&i.combatState==="active"){const z=(j=i.combatants)==null?void 0:j[i.currentTurn];console.log("Test combat useEffect check:",{currentTurn:i.currentTurn,currentCombatant:z==null?void 0:z.name,isEnemy:z==null?void 0:z.id.startsWith("enemy_"),lastProcessedTurn:Q,processingTurn:Oe,isEnemyTurn:T,totalCombatants:(F=i.combatants)==null?void 0:F.length,combatState:i.combatState}),z&&z.id.startsWith("enemy_")&&i.currentTurn!==Q&&!Oe&&!T&&(console.log("Auto-processing test enemy turn for:",z.name,"turn:",i.currentTurn),W(i.currentTurn),setTimeout(()=>{Ie()},1e3))}},[i==null?void 0:i.currentTurn,ge,Q,Oe,T]),R.useEffect(()=>{i&&i.combatState==="active"&&Lt(i)},[i==null?void 0:i.currentTurn,i==null?void 0:i.combatState]),R.useEffect(()=>{ae&&Ss()&&(console.log("All party members ready, advancing to next turn"),fe(!1),_e(new Set),rt())},[ae,be]);const Ar=async()=>{try{u(!0),console.log("Initializing test combat with data:",xt);const j={id:"test_combat_session",partyMembers:xt.partyMembers||[],enemies:xt.enemies||[],storyContext:xt.storyContext||"Test combat environment",combatState:"initialized",currentTurn:0,combatants:[],round:1};if(console.log("Test session created:",{partyMembers:j.partyMembers.length,enemies:j.enemies.length,enemyList:j.enemies}),!j.enemies||j.enemies.length===0){console.error("No enemies provided for test combat!"),a({...j,status:"no_enemies",combatState:"ended"}),u(!1);return}const F=Hn.initializeCombat(j.partyMembers,j.enemies,j.storyContext);console.log("Combat initialized:",{combatants:F.combatants.length,enemies:F.combatants.filter(B=>B.id.startsWith("enemy_")).length,players:F.combatants.filter(B=>!B.id.startsWith("enemy_")).length,turnOrder:F.combatants.map(B=>`${B.name} (${B.initiative})`)});const z={...j,...F,currentTurn:0,combatState:"active"};console.log("Final test session:",{combatants:z.combatants.length,enemies:z.combatants.filter(B=>B.id.startsWith("enemy_")).map(B=>B.name),players:z.combatants.filter(B=>!B.id.startsWith("enemy_")).map(B=>B.name),enemyIds:z.combatants.filter(B=>B.id.startsWith("enemy_")).map(B=>B.id),playerIds:z.combatants.filter(B=>!B.id.startsWith("enemy_")).map(B=>B.id),turnOrder:z.combatants.map((B,Te)=>`${Te}: ${B.name} (${B.initiative})`)}),a(z),u(!1),Lt(z),U(z.environmentalFeatures||[]),y(z.teamUpOpportunities||[])}catch(j){console.error("Error initializing test combat:",j),u(!1)}},sr=async()=>{var j,F;if(!t){console.log("No partyId provided, skipping loadCombatData");return}try{u(!0);const z=await fv(t);if(!z){console.log("No combat session found, navigating to story with partyId:",t);try{e(`/campaign-story/${t}`)}catch(Te){console.error("Navigation error in loadCombatData:",Te),e("/dashboard")}return}const B=await qm(t);if(f(B),z.enemies&&z.enemies.length===0&&!ge){console.log("No enemies found in regular combat session"),a({...z,status:"no_enemies"});return}console.log("Setting combat session:",{enemies:(j=z.enemies)==null?void 0:j.length,combatants:(F=z.combatants)==null?void 0:F.length,isTestCombat:ge}),a(z),Lt(z),U(z.environmentalFeatures||[]),y(z.teamUpOpportunities||[])}catch(z){console.error("Error loading combat data:",z)}finally{u(!1)}},Lt=j=>{var K;const F=Ue(j);if(!F){console.log("No current combatant found for updateAvailableActions");return}console.log("Updating available actions for:",F.name,{class:F.class,cooldowns:F.cooldowns,isEnemy:F.id.startsWith("enemy_")});const z=[],B=F.cooldowns||{};Object.entries(Hn.actionTypes).forEach(([ne,De])=>{(B[ne]===0||B[ne]===void 0)&&z.push({type:ne,name:De.name,description:De.description,priority:De.priority,narrativeTemplate:De.narrativeTemplate})});const Te=Hn.classAbilities[(K=F.class)==null?void 0:K.toLowerCase()];Te&&(B.special===0||B.special===void 0)&&z.push({type:"special",name:Te.name,description:Te.description,priority:"high",narrativeTemplate:"{character} uses their {ability}!"}),D.length>0&&z.push({type:"environmental",name:"Use Environment",description:"Use the environment to your advantage",priority:"normal",narrativeTemplate:"{character} uses the {environment} to their advantage!"}),v.length>0&&z.push({type:"teamUp",name:"Team Up",description:"Coordinate with another party member",priority:"high",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}),console.log("Generated actions for:",F.name,z),M(z)},ze=j=>{const F=new Date().toLocaleTimeString(),z={id:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:F,round:(i==null?void 0:i.round)||1,turn:(i==null?void 0:i.currentTurn)||0,...j};me(B=>[...B,z])},O=async()=>{if(i)try{$e(!0),me([]);const j={...i,combatState:"ready",currentTurn:0,round:1};ge?(a(j),Lt(j)):await Al(t,j),ze({type:"combat_start",description:"Combat is ready to begin!"})}catch(j){console.error("Error starting combat:",j)}finally{$e(!1)}},te=async()=>{if(i)try{$e(!0);const j={...i,combatState:"active"};ge?(a(j),Lt(j)):await Al(t,j),ze({type:"combat_begin",description:"Fight!"}),cn(!0)}catch(j){console.error("Error beginning combat:",j)}finally{$e(!1)}},ve=async(j,F,z={})=>{var Te;if(!i||i.combatState!=="active"){console.error("Combat not active");return}const B=Ue();if(!B){console.error("No current combatant");return}console.log("Executing action:",{actionType:j,targetId:F,currentCombatant:B.name,additionalData:z});try{$e(!0);const K=i.combatants.find(De=>De.id===F);ze({type:"action",actor:B.name,action:j,target:(K==null?void 0:K.name)||"Unknown",description:`${B.name} uses ${j}${K?` on ${K.name}`:""}`});const ne=await Hn.executeAction(i,B.id,j,F,z);if(ne.success){console.log("Action executed successfully:",ne);const De={...i,...ne.updatedSession||{},currentTurn:((Te=ne.updatedSession)==null?void 0:Te.currentTurn)!==void 0?ne.updatedSession.currentTurn:i.currentTurn};if(ne.damage&&ze({type:"damage",actor:B.name,target:(K==null?void 0:K.name)||"Unknown",damage:ne.damage,description:`${B.name} deals ${ne.damage} damage to ${(K==null?void 0:K.name)||"Unknown"}`}),ne.healing&&ze({type:"healing",actor:B.name,target:(K==null?void 0:K.name)||"Unknown",healing:ne.healing,description:`${B.name} heals ${(K==null?void 0:K.name)||"Unknown"} for ${ne.healing} HP`}),ne.statusEffects&&ne.statusEffects.length>0&&ne.statusEffects.forEach(Ge=>{ze({type:"status_effect",actor:B.name,target:(K==null?void 0:K.name)||"Unknown",effect:Ge.type,description:`${(K==null?void 0:K.name)||"Unknown"} is affected by ${Ge.type}`})}),ne.targetDied&&ze({type:"death",actor:B.name,target:(K==null?void 0:K.name)||"Unknown",description:`${(K==null?void 0:K.name)||"Unknown"} has been defeated!`}),a(De),ne.damage&&K&&(le({targetId:K.id,damage:ne.damage,type:"damage"}),Ee(!0),setTimeout(()=>Ee(!1),2e3)),ne.combatEnded){console.log("Combat ended"),ge?e("/test-environment",{state:{...xt,combatResult:ne.combatResult}}):await _t();return}if(De.combatants.filter(Ge=>Ge.id.startsWith("enemy_")&&Ge.hp>0).length===0){console.log("No more enemies, ending combat"),ge?e("/test-environment",{state:{...xt,combatResult:"victory"}}):await _t();return}setTimeout(()=>{rt()},1e3)}else console.error("Action execution failed:",ne.error),k(ne.error||"Action failed")}catch(K){console.error("Error executing action:",K),k("Error executing action")}finally{$e(!1)}},Ie=async()=>{var F;if(!i||i.combatState!=="active"){console.error("Combat not active");return}const j=Ue();if(!j||!j.id.startsWith("enemy_")){console.error("Not an enemy turn");return}console.log("Processing enemy turn for:",j.name);try{$e(!0),C(!0),ze({type:"turn_start",actor:j.name,description:`${j.name}'s turn begins`});const z=Hn.chooseEnemyAction(j,i);if(console.log("Selected enemy action:",z),!z){console.log("No action selected for enemy"),ze({type:"no_action",actor:j.name,description:`${j.name} cannot decide on an action`}),setTimeout(()=>{rt()},1e3);return}const B=z.action,Te=z.target;if(!B){console.log("No action type in selected action"),ze({type:"no_action",actor:j.name,description:`${j.name} has no valid action type`}),setTimeout(()=>{rt()},1e3);return}const K=i.combatants.find(De=>De.id===Te);if(!K&&B!=="defend"){console.log("No target found for enemy action"),ze({type:"no_target",actor:j.name,action:B,description:`${j.name} cannot find a target for ${B}`}),setTimeout(()=>{rt()},1e3);return}ze({type:"action",actor:j.name,action:B,target:(K==null?void 0:K.name)||"self",description:`${j.name} uses ${B}${K?` on ${K.name}`:""}`});const ne=await Hn.executeAction(i,j.id,B,Te,z);if(ne.success){console.log("Enemy action executed successfully:",ne);const De={...i,...ne.updatedSession||{},currentTurn:((F=ne.updatedSession)==null?void 0:F.currentTurn)!==void 0?ne.updatedSession.currentTurn:i.currentTurn};ne.damage&&ze({type:"damage",actor:j.name,target:(K==null?void 0:K.name)||"self",damage:ne.damage,description:`${j.name} deals ${ne.damage} damage to ${(K==null?void 0:K.name)||"self"}`}),ne.healing&&ze({type:"healing",actor:j.name,target:(K==null?void 0:K.name)||"self",healing:ne.healing,description:`${j.name} heals ${(K==null?void 0:K.name)||"self"} for ${ne.healing} HP`}),ne.statusEffects&&ne.statusEffects.length>0&&ne.statusEffects.forEach(Ot=>{ze({type:"status_effect",actor:j.name,target:(K==null?void 0:K.name)||"self",effect:Ot.type,description:`${(K==null?void 0:K.name)||"self"} is affected by ${Ot.type}`})}),ne.targetDied&&ze({type:"death",actor:j.name,target:(K==null?void 0:K.name)||"self",description:`${(K==null?void 0:K.name)||"self"} has been defeated!`}),a(De),ne.damage&&K&&(le({targetId:K.id,damage:ne.damage,type:"damage"}),Ee(!0),setTimeout(()=>Ee(!1),2e3));const He=Hn.generateActionNarrative(j,B,K,z);if(P(`${j.name} uses ${B}!`),ke(He),ne.combatEnded){console.log("Combat ended"),ge?e("/test-environment",{state:{...xt,combatResult:ne.combatResult}}):await _t();return}if(De.combatants.filter(Ot=>!Ot.id.startsWith("enemy_")&&Ot.hp>0).length===0){console.log("All players dead, ending combat"),ge?e("/test-environment",{state:{...xt,combatResult:"defeat"}}):await _t();return}setTimeout(()=>{rt()},1e3)}else console.error("Enemy action execution failed:",ne.error),ze({type:"action_failed",actor:j.name,action:B,description:`${j.name}'s ${B} failed`}),setTimeout(()=>{rt()},1e3)}catch(z){console.error("Error processing enemy turn:",z),ze({type:"error",actor:j.name,description:`Error during ${j.name}'s turn`}),setTimeout(()=>{rt()},1e3)}finally{$e(!1),C(!1)}},rt=async()=>{var Te;if(!i||i.combatState!=="active"){console.error("Combat not active");return}console.log("Advancing turn from:",i.currentTurn);let j=(i.currentTurn+1)%i.combatants.length,F=0;const z=i.combatants.length;for(;F<z;){const K=i.combatants[j];if(K&&K.hp>0)break;j=(j+1)%i.combatants.length,F++}if(F>=z){console.log("No alive combatants found, ending combat"),ge?e("/test-environment",{state:{...xt,combatResult:"draw"}}):await _t();return}if(j===0){const K={...i,currentTurn:j,round:i.round+1};ge?a(K):await Al(t,K)}else{const K={...i,currentTurn:j};ge?a(K):await Al(t,K)}console.log("Turn advanced to:",j,"combatant:",(Te=i.combatants[j])==null?void 0:Te.name);const B=ge?i:await fv(t);B&&Lt(B)},_t=async()=>{if(!i)return;const j=Hn.generateCombatSummary(i,"victory");if(ge)a(F=>({...F,status:"ended",combatState:"ended",summary:j})),e("/test-environment");else{await fR(i.id,{status:"ended",combatState:"ended",summary:j}),await $r(t,{status:"storytelling",currentCombat:null});try{console.log("Ending combat, navigating to story with partyId:",t),e(`/campaign-story/${t}`)}catch(F){console.error("Navigation error in endCombat:",F),e("/dashboard")}}},Ue=(j=i)=>{if(!(j!=null&&j.combatants)||j.currentTurn===void 0)return console.log("getCurrentCombatant: No session or combatants"),null;const F=j.combatants[j.currentTurn];return console.log("getCurrentCombatant:",{currentTurn:j.currentTurn,totalCombatants:j.combatants.length,combatant:F==null?void 0:F.name,isEnemy:F==null?void 0:F.id.startsWith("enemy_"),hp:F==null?void 0:F.hp}),F},st=()=>{const j=Ue();return j?ge?!j.id.startsWith("enemy_"):j.userId===(r==null?void 0:r.uid):!1},In=()=>{if(i){if(ge){const j=i.combatants.find(F=>!F.id.startsWith("enemy_"));j&&j.hp<=0&&(J(!0),ue(j))}else if(r){const j=i.partyMembers.find(F=>F.userId===r.uid)||i.combatants.find(F=>F.userId===r.uid&&!F.id.startsWith("enemy_"));j&&j.hp<=0&&(J(!0),ue(j))}}},Ts=()=>{e(ge?"/dashboard":`/character-creation/${t}`)},Cs=()=>{if(ge)fe(!1),_e(new Set),rt();else{const j=r==null?void 0:r.uid;j&&_e(F=>new Set([...F,j]))}},Ss=()=>{if(ge)return!0;if(!(i!=null&&i.partyMembers))return!1;const j=i.partyMembers.filter(z=>z.hp>0);return be.size>=j.length};if(!r)return null;if(l)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Loading Combat..."}),o.jsx("p",{className:"text-gray-300 mb-6",children:"Preparing the battlefield and gathering combatants..."}),o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto"})]})})});if(!i)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("div",{className:"text-gray-400",children:"No active combat session found."})})})});if((i.status==="no_enemies"||i.enemies&&i.enemies.length===0)&&!ge)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"No Enemies to Fight"}),o.jsx("p",{className:"text-gray-300 mb-6",children:"There are no enemies present in this area. Combat cannot begin."}),o.jsx("p",{className:"text-gray-400 text-sm",children:"The combat session will end automatically."})]})})});const wn=Ue();return qe&&re?o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card bg-red-50 border-red-200",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h1",{className:"text-3xl font-bold text-red-800 mb-4",children:"Character Death"}),o.jsxs("div",{className:"text-xl text-red-700 mb-6",children:[re.name," has fallen in battle..."]}),o.jsxs("div",{className:"bg-white p-6 rounded-lg border border-red-300 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-stone-800 mb-2",children:"Fallen Hero"}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Name:"})," ",re.name]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Class:"})," ",re.class]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Level:"})," ",re.level]}),o.jsxs("p",{className:"text-stone-600",children:[o.jsx("strong",{children:"Final HP:"})," ",re.hp,"/",re.maxHp]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-stone-600",children:"Your character has been defeated. You must create a new character to continue."}),o.jsx("button",{onClick:Ts,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})}):o.jsx("div",{className:"min-h-screen bg-gray-900 text-gray-100 p-4",children:o.jsxs("div",{className:"fantasy-container py-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:" Combat Arena"}),o.jsxs("div",{className:"flex space-x-2",children:[i.combatState==="preparation"&&o.jsx("button",{onClick:O,className:"bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"Start Combat"}),i.combatState==="active"&&o.jsx("button",{onClick:_t,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"End Combat"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6",children:[o.jsxs("div",{className:"xl:col-span-1 space-y-6",children:[i.storyContext&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-2",children:"Story Context"}),o.jsx("p",{className:"text-gray-300 italic text-sm",children:i.storyContext})]}),D.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-blue-300 mb-2",children:" Environmental Features"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:D.map((j,F)=>o.jsx("span",{className:"px-3 py-1 bg-blue-900 text-blue-200 rounded-full text-sm",children:j},F))})]}),v.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-purple-300 mb-2",children:" Team Up Opportunities"}),o.jsx("div",{className:"space-y-2",children:v.map((j,F)=>o.jsxs("div",{className:"text-purple-200 text-sm",children:[o.jsxs("strong",{children:[j.classes.join(" + "),":"]})," ",j.description]},F))})]}),o.jsxs("div",{className:"fantasy-card h-96",children:[o.jsx("h3",{className:"text-lg font-semibold mb-4 text-yellow-400",children:"Battle Log"}),o.jsx("div",{className:"space-y-2 h-80 overflow-y-auto",children:Ae.length===0?o.jsx("p",{className:"text-gray-400 text-sm",children:"No actions recorded yet..."}):Ae.map(j=>o.jsxs("div",{className:"text-sm border-l-2 border-gray-600 pl-3 py-1",children:[o.jsxs("div",{className:"flex justify-between items-start mb-1",children:[o.jsx("span",{className:"text-gray-400 text-xs",children:j.timestamp}),o.jsxs("span",{className:"text-blue-400 text-xs",children:["R",j.round," T",j.turn]})]}),o.jsx("div",{className:`${j.type==="damage"?"text-red-400":j.type==="healing"?"text-green-400":j.type==="death"?"text-red-500 font-semibold":j.type==="status_effect"?"text-purple-400":j.type==="action_failed"?"text-orange-400":j.type==="error"?"text-red-500":"text-gray-200"}`,children:j.description})]},j.id))})]})]}),o.jsxs("div",{className:"xl:col-span-2 space-y-6",children:[i.combatState==="active"&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3",children:" Turn Order"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:i.combatants.map(j=>{var F,z;return o.jsx("div",{className:`p-3 rounded-lg border-2 transition-colors ${j.id===((F=i.combatants[i.currentTurn])==null?void 0:F.id)?"border-amber-500 bg-amber-900/20":"border-gray-600 bg-gray-700"}`,children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"font-medium text-gray-100",children:[j.name,j.id===((z=i.combatants[i.currentTurn])==null?void 0:z.id)&&o.jsx("span",{className:"ml-2 text-amber-400",children:" Current Turn"})]}),o.jsxs("div",{className:"text-sm text-gray-300",children:["HP: ",j.hp,"/",j.maxHp," | AC: ",j.ac]}),j.statusEffects&&j.statusEffects.length>0&&o.jsx("div",{className:"text-xs text-red-400 mt-1",children:j.statusEffects.map(B=>B.type).join(", ")})]}),o.jsxs("div",{className:"text-sm text-gray-400",children:["Initiative: ",j.initiative]})]})},j.id)})})]}),i.combatState==="active"&&wn&&o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("h3",{className:"font-bold text-gray-100 mb-3",children:[" ",wn.name,"'s Turn"]}),st()?o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-200 mb-2",children:"Available Actions:"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:N.map((j,F)=>o.jsxs("button",{onClick:()=>g(j),className:`p-3 rounded-lg border-2 transition-colors text-left ${(m==null?void 0:m.type)===j.type?"border-amber-500 bg-amber-900/20":"border-gray-600 bg-gray-700 hover:border-gray-500"}`,children:[o.jsx("div",{className:"font-medium text-gray-100",children:j.name}),o.jsx("div",{className:"text-sm text-gray-300",children:j.description}),o.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Priority: ",j.priority]})]},F))})]}),m&&o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-200 mb-2",children:"Select Target:"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:i.enemies.map(j=>o.jsxs("button",{onClick:()=>S(j),className:`p-3 rounded-lg border-2 transition-colors ${(b==null?void 0:b.id)===j.id?"border-red-500 bg-red-900/20":"border-gray-600 bg-gray-700 hover:border-gray-500"}`,children:[o.jsx("div",{className:"font-medium text-gray-100",children:j.name}),o.jsxs("div",{className:"text-sm text-gray-300",children:["HP: ",j.hp,"/",j.maxHp," | AC: ",j.ac]})]},j.id))})]}),m&&b&&o.jsx("div",{className:"text-center",children:o.jsx("button",{onClick:()=>ve(m.type,b.id),disabled:Oe,className:"fantasy-button bg-amber-600 hover:bg-amber-700",children:Oe?"Executing...":`Execute ${m.name}`})})]}):o.jsxs("div",{className:"bg-blue-900/20 border border-blue-700 rounded-lg p-4",children:[o.jsxs("h4",{className:"font-bold text-blue-300 mb-2",children:["Waiting for ",wn.name," to act"]}),o.jsx("p",{className:"text-blue-200",children:wn.userId===(r==null?void 0:r.uid)?"It's your turn! Please select an action.":"Please wait for the current player to make their move."})]})]}),E&&o.jsxs("div",{className:"fantasy-card bg-green-900/20 border-green-700",children:[o.jsx("h4",{className:"font-bold text-green-300 mb-2",children:"Action Result"}),o.jsx("p",{className:"text-green-200",children:E}),_&&o.jsx("div",{className:"mt-2 p-3 bg-gray-700 border border-green-600 rounded",children:o.jsx("p",{className:"text-gray-200 italic",children:_})})]}),T&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700 animate-pulse",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-red-300 mb-3 text-xl",children:" Enemy Turn"}),A&&o.jsx("div",{className:"text-red-200 font-bold text-lg mb-3 bg-gray-700 p-3 rounded border border-red-600",children:A}),I&&o.jsx("div",{className:"mt-3 p-4 bg-gray-700 border border-red-600 rounded",children:o.jsx("p",{className:"text-gray-200 italic",children:I})}),o.jsxs("div",{className:"mt-4 flex items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"}),o.jsx("span",{className:"ml-3 text-red-300 font-medium",children:"Enemy is acting..."})]})]})}),ae&&o.jsx("div",{className:"fantasy-card bg-blue-900/20 border-blue-700",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-blue-300 mb-3 text-xl",children:" Enemy Turn Complete"}),o.jsx("p",{className:"text-blue-200 mb-4",children:ge?"The enemy has finished their turn. Click 'Confirm' to proceed to the next turn.":"The enemy has finished their turn. All party members must click 'Confirm' to proceed."}),!ge&&o.jsxs("div",{className:"mb-4 p-3 bg-gray-700 border border-blue-600 rounded",children:[o.jsxs("p",{className:"text-sm text-blue-200",children:[o.jsx("strong",{children:"Ready to continue:"})," ",be.size," / ",((V=i==null?void 0:i.partyMembers)==null?void 0:V.filter(j=>j.hp>0).length)||0," party members"]}),be.size>0&&o.jsxs("div",{className:"mt-2 text-xs text-blue-300",children:["Waiting for: ",((de=(ee=(H=i==null?void 0:i.partyMembers)==null?void 0:H.filter(j=>j.hp>0&&!be.has(j.userId)))==null?void 0:ee.map(j=>j.name))==null?void 0:de.join(", "))||"None"]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center items-center",children:[o.jsx("button",{onClick:Cs,disabled:!ge&&be.has(r==null?void 0:r.uid),className:`fantasy-button px-8 py-3 text-lg font-semibold ${!ge&&be.has(r==null?void 0:r.uid)?"bg-green-700 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 shadow-lg"}`,children:!ge&&be.has(r==null?void 0:r.uid)?" Ready":"Confirm"}),ge&&o.jsx("button",{onClick:()=>{fe(!1),_e(new Set),rt()},className:"fantasy-button px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white",children:"Skip Confirmation"})]}),o.jsx("div",{className:"mt-4 p-3 bg-yellow-900/20 border border-yellow-600 rounded",children:o.jsxs("p",{className:"text-sm text-yellow-200",children:[o.jsx("strong",{children:"Note:"})," Review the battle log and enemy actions before continuing to the next turn."]})})]})}),Oe&&!T&&o.jsx("div",{className:"fantasy-card bg-amber-900/20 border-amber-700",children:o.jsxs("div",{className:"flex items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-amber-500"}),o.jsx("span",{className:"ml-2 text-amber-300 font-medium",children:"Processing turn..."})]})}),(i==null?void 0:i.combatState)==="ready"&&!ut&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-red-300 mb-4 text-2xl",children:" Combat Ready!"}),o.jsx("p",{className:"text-red-200 mb-6 text-lg",children:"All combatants are in position. Click 'Fight!' to begin the battle."}),o.jsx("button",{onClick:te,disabled:Oe,className:"fantasy-button px-12 py-4 text-xl font-bold bg-red-600 hover:bg-red-700 shadow-lg",children:Oe?"Preparing...":"Fight!"})]})})]}),o.jsxs("div",{className:"xl:col-span-1 space-y-6",children:[pe&&X&&o.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 pointer-events-none",children:o.jsxs("div",{className:`animate-bounce text-6xl font-bold px-6 py-4 rounded-lg shadow-lg ${X.type==="healing"?"text-green-400 bg-green-900/80":"text-red-400 bg-red-900/80"}`,children:[X.type==="healing"?"+":"-",X.damage]})}),qe&&re&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h1",{className:"text-3xl font-bold text-red-300 mb-4",children:"Character Death"}),o.jsxs("div",{className:"text-xl text-red-200 mb-6",children:[re.name," has fallen in battle..."]}),o.jsxs("div",{className:"bg-gray-700 p-6 rounded-lg border border-red-600 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Fallen Hero"}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Name:"})," ",re.name]}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Class:"})," ",re.class]}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Level:"})," ",re.level]}),o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"Final HP:"})," ",re.hp,"/",re.maxHp]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-gray-300",children:"Your character has been defeated. You must create a new character to continue."}),o.jsx("button",{onClick:Ts,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})]})]})]})})}function HR(){const t=zn(),[e,n]=R.useState(null),[r,s]=R.useState([]),[i,a]=R.useState({}),[l,u]=R.useState(!1),[d,f]=R.useState(!1),[m,g]=R.useState(""),[b,S]=R.useState({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""});R.useEffect(()=>{const D=ai(U=>{if(!U){t("/login");return}n(U),E(U.uid)});return()=>D()},[t]);const E=async D=>{try{const U=await Hm(D);s(U),await k(U)}catch(U){console.error("Error loading parties:",U.message)}},k=async D=>{try{const U=new Set;if(D.forEach(C=>{C.members&&Array.isArray(C.members)&&C.members.forEach(A=>U.add(A))}),U.size===0)return;const v=await XA(Array.from(U)),y={};v.forEach(C=>{y[C.userId]=C});const T={};D.forEach(C=>{C.members&&Array.isArray(C.members)&&(T[C.id]=C.members.map(A=>({userId:A,profile:y[A]||null})))}),a(T)}catch(U){console.error("Error loading party member profiles:",U)}},_=async D=>{if(D.preventDefault(),!e){console.error("You must be logged in to create a party");return}u(!0);try{const U={...b,inviteCode:Math.random().toString(36).substr(2,8).toUpperCase()},v=await tR(e.uid,U);f(!1),S({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""}),await E(e.uid),console.log("Party created successfully!")}catch(U){console.error("Error creating party:",U.message)}finally{u(!1)}},x=async()=>{if(!m.trim()){console.error("Please enter an invite code");return}if(!e){console.error("You must be logged in to join a party");return}u(!0);try{const D=await rR(m.toUpperCase());if(!D){console.error("Invalid invite code");return}await nR(D.id,e.uid),g(""),await E(e.uid),console.log("Successfully joined party!")}catch(D){console.error(D.message||"Error joining party. Please try again.")}finally{u(!1)}},N=D=>{navigator.clipboard.writeText(D),console.log("Invite code copied to clipboard!")},M=async(D,U)=>{if(confirm(`Are you sure you want to disband "${U}"? This action cannot be undone and will remove all party members and characters.`)){u(!0);try{await J_(D,e.uid),await E(e.uid),console.log("Party disbanded successfully")}catch(v){console.error("Error disbanding party:",v.message)}finally{u(!1)}}};return e?o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:"Party Management"}),o.jsx("button",{onClick:()=>f(!0),className:"fantasy-button",disabled:l,children:"Create New Party"})]}),d&&o.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600 mb-6",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-4",children:"Create New Party"}),o.jsxs("form",{onSubmit:_,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Party Name"}),o.jsx("input",{type:"text",value:b.name,onChange:D=>S(U=>({...U,name:D.target.value})),className:"fantasy-input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Theme"}),o.jsx("textarea",{value:b.description,onChange:D=>S(U=>({...U,description:D.target.value})),className:"fantasy-input",rows:"3",placeholder:"Enter the theme or atmosphere for your campaign..."})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Max Players"}),o.jsx("input",{type:"number",min:"2",max:"10",value:b.maxPlayers,onChange:D=>S(U=>({...U,maxPlayers:parseInt(D.target.value)})),className:"fantasy-input"})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"isPublic",checked:b.isPublic,onChange:D=>S(U=>({...U,isPublic:D.target.checked})),className:"mr-2"}),o.jsx("label",{htmlFor:"isPublic",className:"text-sm font-medium text-gray-200",children:"Public Party (visible to all users)"})]})]}),o.jsxs("div",{className:"flex space-x-4",children:[o.jsx("button",{type:"submit",className:"fantasy-button",disabled:l,children:l?"Creating...":"Create Party"}),o.jsx("button",{type:"button",onClick:()=>f(!1),className:"fantasy-button bg-gray-600 hover:bg-gray-700",disabled:l,children:"Cancel"})]})]})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"My Parties"}),r.length===0?o.jsxs("div",{className:"text-center py-8 text-gray-300",children:[o.jsx("p",{children:"You haven't joined any parties yet."}),o.jsx("p",{children:'Click "Create New Party" to get started!'})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:r.map(D=>{var v;const U=i[D.id]||[];return o.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100",children:D.name}),o.jsxs("span",{className:"text-sm text-gray-300",children:[((v=D.members)==null?void 0:v.length)||1,"/",D.maxPlayers," players"]})]}),D.description&&o.jsxs("div",{className:"mb-4",children:[o.jsx("span",{className:"text-sm font-semibold text-gray-200",children:"Theme: "}),o.jsx("span",{className:"text-gray-300",children:D.description})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-200 mb-2",children:"Party Members:"}),o.jsx("div",{className:"space-y-1",children:U.map((y,T)=>{var P;const C=((P=y.profile)==null?void 0:P.username)||`User ${T+1}`,A=y.userId===D.dmId;return o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-gray-300",children:C}),A&&o.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),y.userId===(e==null?void 0:e.uid)&&o.jsx("span",{className:"text-blue-400 text-xs font-medium",children:"(You)"})]},y.userId)})})]}),D.dmId===e.uid&&o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Invite Code"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{type:"text",value:D.inviteCode,readOnly:!0,className:"fantasy-input bg-gray-700"}),o.jsx("button",{onClick:()=>N(D.inviteCode),className:"fantasy-button text-sm",children:"Copy"})]})]}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>t(`/campaign-story/${D.id}`),className:"fantasy-button",children:"Campaign"}),D.dmId===e.uid&&o.jsx("button",{onClick:()=>M(D.id,D.name),className:"fantasy-button bg-red-600 hover:bg-red-700",disabled:l,children:"Disband"})]})]},D.id)})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Join a Party"}),o.jsx("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("input",{type:"text",placeholder:"Enter invite code",value:m,onChange:D=>g(D.target.value),className:"fantasy-input flex-1",disabled:l}),o.jsx("button",{onClick:x,className:"fantasy-button",disabled:l,children:l?"Joining...":"Join Party"})]})})]})]})}):null}function GR(){return o.jsx(K1,{basename:"/DND-V1",children:o.jsxs("div",{className:"min-h-screen flex flex-col",children:[o.jsx(vR,{}),o.jsx("main",{className:"flex-grow",children:o.jsxs(U1,{children:[o.jsx(Rn,{path:"/",element:o.jsx(_R,{})}),o.jsx(Rn,{path:"/login",element:o.jsx(bR,{})}),o.jsx(Rn,{path:"/register",element:o.jsx(ER,{})}),o.jsx(Rn,{path:"/dashboard",element:o.jsx(CR,{})}),o.jsx(Rn,{path:"/test-environment",element:o.jsx(kR,{})}),o.jsx(Rn,{path:"/campaign-management",element:o.jsx(AR,{})}),o.jsx(Rn,{path:"/character-creation",element:o.jsx(RR,{})}),o.jsx(Rn,{path:"/campaign/:partyId",element:o.jsx(WR,{})}),o.jsx(Rn,{path:"/combat",element:o.jsx(qR,{})}),o.jsx(Rn,{path:"/party-management",element:o.jsx(HR,{})})]})}),o.jsx(wR,{})]})})}Nd.createRoot(document.getElementById("root")).render(o.jsx(Cv.StrictMode,{children:o.jsx(GR,{})}));
