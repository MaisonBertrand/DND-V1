function Pb(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function Ab(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var bv={exports:{}},Hc={},Ev={exports:{}},Pe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Io=Symbol.for("react.element"),Rb=Symbol.for("react.portal"),jb=Symbol.for("react.fragment"),Db=Symbol.for("react.strict_mode"),Mb=Symbol.for("react.profiler"),Lb=Symbol.for("react.provider"),Ob=Symbol.for("react.context"),Vb=Symbol.for("react.forward_ref"),Fb=Symbol.for("react.suspense"),$b=Symbol.for("react.memo"),Ub=Symbol.for("react.lazy"),Vp=Symbol.iterator;function Bb(t){return t===null||typeof t!="object"?null:(t=Vp&&t[Vp]||t["@@iterator"],typeof t=="function"?t:null)}var Tv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Cv=Object.assign,Sv={};function Zi(t,e,n){this.props=t,this.context=e,this.refs=Sv,this.updater=n||Tv}Zi.prototype.isReactComponent={};Zi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Zi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function kv(){}kv.prototype=Zi.prototype;function Jh(t,e,n){this.props=t,this.context=e,this.refs=Sv,this.updater=n||Tv}var Zh=Jh.prototype=new kv;Zh.constructor=Jh;Cv(Zh,Zi.prototype);Zh.isPureReactComponent=!0;var Fp=Array.isArray,Nv=Object.prototype.hasOwnProperty,ef={current:null},Iv={key:!0,ref:!0,__self:!0,__source:!0};function Pv(t,e,n){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)Nv.call(e,r)&&!Iv.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var u=Array(l),d=0;d<l;d++)u[d]=arguments[d+2];s.children=u}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Io,type:t,key:i,ref:a,props:s,_owner:ef.current}}function zb(t,e){return{$$typeof:Io,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function tf(t){return typeof t=="object"&&t!==null&&t.$$typeof===Io}function Wb(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var $p=/\/+/g;function Wu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Wb(""+t.key):e.toString(36)}function Ll(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Io:case Rb:a=!0}}if(a)return a=t,s=s(a),t=r===""?"."+Wu(a,0):r,Fp(s)?(n="",t!=null&&(n=t.replace($p,"$&/")+"/"),Ll(s,e,n,"",function(d){return d})):s!=null&&(tf(s)&&(s=zb(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace($p,"$&/")+"/")+t)),e.push(s)),1;if(a=0,r=r===""?".":r+":",Fp(t))for(var l=0;l<t.length;l++){i=t[l];var u=r+Wu(i,l);a+=Ll(i,e,n,u,s)}else if(u=Bb(t),typeof u=="function")for(t=u.call(t),l=0;!(i=t.next()).done;)i=i.value,u=r+Wu(i,l++),a+=Ll(i,e,n,u,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function fl(t,e,n){if(t==null)return t;var r=[],s=0;return Ll(t,r,"","",function(i){return e.call(n,i,s++)}),r}function qb(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var nn={current:null},Ol={transition:null},Hb={ReactCurrentDispatcher:nn,ReactCurrentBatchConfig:Ol,ReactCurrentOwner:ef};function Av(){throw Error("act(...) is not supported in production builds of React.")}Pe.Children={map:fl,forEach:function(t,e,n){fl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return fl(t,function(){e++}),e},toArray:function(t){return fl(t,function(e){return e})||[]},only:function(t){if(!tf(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Pe.Component=Zi;Pe.Fragment=jb;Pe.Profiler=Mb;Pe.PureComponent=Jh;Pe.StrictMode=Db;Pe.Suspense=Fb;Pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hb;Pe.act=Av;Pe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Cv({},t.props),s=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=ef.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(u in e)Nv.call(e,u)&&!Iv.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&l!==void 0?l[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){l=Array(u);for(var d=0;d<u;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Io,type:t.type,key:s,ref:i,props:r,_owner:a}};Pe.createContext=function(t){return t={$$typeof:Ob,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Lb,_context:t},t.Consumer=t};Pe.createElement=Pv;Pe.createFactory=function(t){var e=Pv.bind(null,t);return e.type=t,e};Pe.createRef=function(){return{current:null}};Pe.forwardRef=function(t){return{$$typeof:Vb,render:t}};Pe.isValidElement=tf;Pe.lazy=function(t){return{$$typeof:Ub,_payload:{_status:-1,_result:t},_init:qb}};Pe.memo=function(t,e){return{$$typeof:$b,type:t,compare:e===void 0?null:e}};Pe.startTransition=function(t){var e=Ol.transition;Ol.transition={};try{t()}finally{Ol.transition=e}};Pe.unstable_act=Av;Pe.useCallback=function(t,e){return nn.current.useCallback(t,e)};Pe.useContext=function(t){return nn.current.useContext(t)};Pe.useDebugValue=function(){};Pe.useDeferredValue=function(t){return nn.current.useDeferredValue(t)};Pe.useEffect=function(t,e){return nn.current.useEffect(t,e)};Pe.useId=function(){return nn.current.useId()};Pe.useImperativeHandle=function(t,e,n){return nn.current.useImperativeHandle(t,e,n)};Pe.useInsertionEffect=function(t,e){return nn.current.useInsertionEffect(t,e)};Pe.useLayoutEffect=function(t,e){return nn.current.useLayoutEffect(t,e)};Pe.useMemo=function(t,e){return nn.current.useMemo(t,e)};Pe.useReducer=function(t,e,n){return nn.current.useReducer(t,e,n)};Pe.useRef=function(t){return nn.current.useRef(t)};Pe.useState=function(t){return nn.current.useState(t)};Pe.useSyncExternalStore=function(t,e,n){return nn.current.useSyncExternalStore(t,e,n)};Pe.useTransition=function(){return nn.current.useTransition()};Pe.version="18.3.1";Ev.exports=Pe;var A=Ev.exports;const Rv=Ab(A),Gb=Pb({__proto__:null,default:Rv},[A]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kb=A,Qb=Symbol.for("react.element"),Yb=Symbol.for("react.fragment"),Xb=Object.prototype.hasOwnProperty,Jb=Kb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Zb={key:!0,ref:!0,__self:!0,__source:!0};function jv(t,e,n){var r,s={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)Xb.call(e,r)&&!Zb.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:Qb,type:t,key:i,ref:a,props:s,_owner:Jb.current}}Hc.Fragment=Yb;Hc.jsx=jv;Hc.jsxs=jv;bv.exports=Hc;var o=bv.exports,Rd={},Dv={exports:{}},xn={},Mv={exports:{}},Lv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(K,re){var ce=K.length;K.push(re);e:for(;0<ce;){var Y=ce-1>>>1,W=K[Y];if(0<s(W,re))K[Y]=re,K[ce]=W,ce=Y;else break e}}function n(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var re=K[0],ce=K.pop();if(ce!==re){K[0]=ce;e:for(var Y=0,W=K.length,J=W>>>1;Y<J;){var le=2*(Y+1)-1,ve=K[le],ke=le+1,ae=K[ke];if(0>s(ve,ce))ke<W&&0>s(ae,ve)?(K[Y]=ae,K[ke]=ce,Y=ke):(K[Y]=ve,K[le]=ce,Y=le);else if(ke<W&&0>s(ae,ce))K[Y]=ae,K[ke]=ce,Y=ke;else break e}}return re}function s(K,re){var ce=K.sortIndex-re.sortIndex;return ce!==0?ce:K.id-re.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var u=[],d=[],f=1,m=null,g=3,b=!1,k=!1,C=!1,N=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function I(K){for(var re=n(d);re!==null;){if(re.callback===null)r(d);else if(re.startTime<=K)r(d),re.sortIndex=re.expirationTime,e(u,re);else break;re=n(d)}}function D(K){if(C=!1,I(K),!k)if(n(u)!==null)k=!0,Se(F);else{var re=n(d);re!==null&&de(D,re.startTime-K)}}function F(K,re){k=!1,C&&(C=!1,_(y),y=-1),b=!0;var ce=g;try{for(I(re),m=n(u);m!==null&&(!(m.expirationTime>re)||K&&!R());){var Y=m.callback;if(typeof Y=="function"){m.callback=null,g=m.priorityLevel;var W=Y(m.expirationTime<=re);re=t.unstable_now(),typeof W=="function"?m.callback=W:m===n(u)&&r(u),I(re)}else r(u);m=n(u)}if(m!==null)var J=!0;else{var le=n(d);le!==null&&de(D,le.startTime-re),J=!1}return J}finally{m=null,g=ce,b=!1}}var q=!1,v=null,y=-1,S=5,P=-1;function R(){return!(t.unstable_now()-P<S)}function E(){if(v!==null){var K=t.unstable_now();P=K;var re=!0;try{re=v(!0,K)}finally{re?T():(q=!1,v=null)}}else q=!1}var T;if(typeof x=="function")T=function(){x(E)};else if(typeof MessageChannel<"u"){var me=new MessageChannel,ye=me.port2;me.port1.onmessage=E,T=function(){ye.postMessage(null)}}else T=function(){N(E,0)};function Se(K){v=K,q||(q=!0,T())}function de(K,re){y=N(function(){K(t.unstable_now())},re)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(K){K.callback=null},t.unstable_continueExecution=function(){k||b||(k=!0,Se(F))},t.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<K?Math.floor(1e3/K):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(K){switch(g){case 1:case 2:case 3:var re=3;break;default:re=g}var ce=g;g=re;try{return K()}finally{g=ce}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(K,re){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var ce=g;g=K;try{return re()}finally{g=ce}},t.unstable_scheduleCallback=function(K,re,ce){var Y=t.unstable_now();switch(typeof ce=="object"&&ce!==null?(ce=ce.delay,ce=typeof ce=="number"&&0<ce?Y+ce:Y):ce=Y,K){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=ce+W,K={id:f++,callback:re,priorityLevel:K,startTime:ce,expirationTime:W,sortIndex:-1},ce>Y?(K.sortIndex=ce,e(d,K),n(u)===null&&K===n(d)&&(C?(_(y),y=-1):C=!0,de(D,ce-Y))):(K.sortIndex=W,e(u,K),k||b||(k=!0,Se(F))),K},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(K){var re=g;return function(){var ce=g;g=re;try{return K.apply(this,arguments)}finally{g=ce}}}})(Lv);Mv.exports=Lv;var eE=Mv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tE=A,vn=eE;function X(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ov=new Set,Ja={};function Zs(t,e){Vi(t,e),Vi(t+"Capture",e)}function Vi(t,e){for(Ja[t]=e,t=0;t<e.length;t++)Ov.add(e[t])}var xr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),jd=Object.prototype.hasOwnProperty,nE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Up={},Bp={};function rE(t){return jd.call(Bp,t)?!0:jd.call(Up,t)?!1:nE.test(t)?Bp[t]=!0:(Up[t]=!0,!1)}function sE(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function iE(t,e,n,r){if(e===null||typeof e>"u"||sE(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function rn(t,e,n,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var Dt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Dt[t]=new rn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Dt[e]=new rn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Dt[t]=new rn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Dt[t]=new rn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Dt[t]=new rn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Dt[t]=new rn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Dt[t]=new rn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Dt[t]=new rn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Dt[t]=new rn(t,5,!1,t.toLowerCase(),null,!1,!1)});var nf=/[\-:]([a-z])/g;function rf(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(nf,rf);Dt[e]=new rn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(nf,rf);Dt[e]=new rn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(nf,rf);Dt[e]=new rn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Dt[t]=new rn(t,1,!1,t.toLowerCase(),null,!1,!1)});Dt.xlinkHref=new rn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Dt[t]=new rn(t,1,!1,t.toLowerCase(),null,!0,!0)});function sf(t,e,n,r){var s=Dt.hasOwnProperty(e)?Dt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(iE(e,n,s,r)&&(n=null),r||s===null?rE(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Ir=tE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ml=Symbol.for("react.element"),pi=Symbol.for("react.portal"),gi=Symbol.for("react.fragment"),af=Symbol.for("react.strict_mode"),Dd=Symbol.for("react.profiler"),Vv=Symbol.for("react.provider"),Fv=Symbol.for("react.context"),of=Symbol.for("react.forward_ref"),Md=Symbol.for("react.suspense"),Ld=Symbol.for("react.suspense_list"),lf=Symbol.for("react.memo"),Wr=Symbol.for("react.lazy"),$v=Symbol.for("react.offscreen"),zp=Symbol.iterator;function wa(t){return t===null||typeof t!="object"?null:(t=zp&&t[zp]||t["@@iterator"],typeof t=="function"?t:null)}var nt=Object.assign,qu;function Na(t){if(qu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);qu=e&&e[1]||""}return`
`+qu+t}var Hu=!1;function Gu(t,e){if(!t||Hu)return"";Hu=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,l=i.length-1;1<=a&&0<=l&&s[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(s[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||s[a]!==i[l]){var u=`
`+s[a].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=a&&0<=l);break}}}finally{Hu=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Na(t):""}function aE(t){switch(t.tag){case 5:return Na(t.type);case 16:return Na("Lazy");case 13:return Na("Suspense");case 19:return Na("SuspenseList");case 0:case 2:case 15:return t=Gu(t.type,!1),t;case 11:return t=Gu(t.type.render,!1),t;case 1:return t=Gu(t.type,!0),t;default:return""}}function Od(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case gi:return"Fragment";case pi:return"Portal";case Dd:return"Profiler";case af:return"StrictMode";case Md:return"Suspense";case Ld:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Fv:return(t.displayName||"Context")+".Consumer";case Vv:return(t._context.displayName||"Context")+".Provider";case of:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case lf:return e=t.displayName||null,e!==null?e:Od(t.type)||"Memo";case Wr:e=t._payload,t=t._init;try{return Od(t(e))}catch{}}return null}function oE(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Od(e);case 8:return e===af?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ps(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Uv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function lE(t){var e=Uv(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function pl(t){t._valueTracker||(t._valueTracker=lE(t))}function Bv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Uv(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function rc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Vd(t,e){var n=e.checked;return nt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Wp(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=ps(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function zv(t,e){e=e.checked,e!=null&&sf(t,"checked",e,!1)}function Fd(t,e){zv(t,e);var n=ps(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?$d(t,e.type,n):e.hasOwnProperty("defaultValue")&&$d(t,e.type,ps(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function qp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function $d(t,e,n){(e!=="number"||rc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ia=Array.isArray;function Ni(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+ps(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Ud(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(X(91));return nt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Hp(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(X(92));if(Ia(n)){if(1<n.length)throw Error(X(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ps(n)}}function Wv(t,e){var n=ps(e.value),r=ps(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Gp(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function qv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Bd(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?qv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var gl,Hv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(gl=gl||document.createElement("div"),gl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=gl.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Za(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Va={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},cE=["Webkit","ms","Moz","O"];Object.keys(Va).forEach(function(t){cE.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Va[e]=Va[t]})});function Gv(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Va.hasOwnProperty(t)&&Va[t]?(""+e).trim():e+"px"}function Kv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Gv(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var uE=nt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function zd(t,e){if(e){if(uE[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(X(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(X(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(X(61))}if(e.style!=null&&typeof e.style!="object")throw Error(X(62))}}function Wd(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qd=null;function cf(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Hd=null,Ii=null,Pi=null;function Kp(t){if(t=Ro(t)){if(typeof Hd!="function")throw Error(X(280));var e=t.stateNode;e&&(e=Xc(e),Hd(t.stateNode,t.type,e))}}function Qv(t){Ii?Pi?Pi.push(t):Pi=[t]:Ii=t}function Yv(){if(Ii){var t=Ii,e=Pi;if(Pi=Ii=null,Kp(t),e)for(t=0;t<e.length;t++)Kp(e[t])}}function Xv(t,e){return t(e)}function Jv(){}var Ku=!1;function Zv(t,e,n){if(Ku)return t(e,n);Ku=!0;try{return Xv(t,e,n)}finally{Ku=!1,(Ii!==null||Pi!==null)&&(Jv(),Yv())}}function eo(t,e){var n=t.stateNode;if(n===null)return null;var r=Xc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(X(231,e,typeof n));return n}var Gd=!1;if(xr)try{var xa={};Object.defineProperty(xa,"passive",{get:function(){Gd=!0}}),window.addEventListener("test",xa,xa),window.removeEventListener("test",xa,xa)}catch{Gd=!1}function dE(t,e,n,r,s,i,a,l,u){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(f){this.onError(f)}}var Fa=!1,sc=null,ic=!1,Kd=null,hE={onError:function(t){Fa=!0,sc=t}};function fE(t,e,n,r,s,i,a,l,u){Fa=!1,sc=null,dE.apply(hE,arguments)}function mE(t,e,n,r,s,i,a,l,u){if(fE.apply(this,arguments),Fa){if(Fa){var d=sc;Fa=!1,sc=null}else throw Error(X(198));ic||(ic=!0,Kd=d)}}function ei(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function e0(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Qp(t){if(ei(t)!==t)throw Error(X(188))}function pE(t){var e=t.alternate;if(!e){if(e=ei(t),e===null)throw Error(X(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Qp(s),t;if(i===r)return Qp(s),e;i=i.sibling}throw Error(X(188))}if(n.return!==r.return)n=s,r=i;else{for(var a=!1,l=s.child;l;){if(l===n){a=!0,n=s,r=i;break}if(l===r){a=!0,r=s,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,r=s;break}if(l===r){a=!0,r=i,n=s;break}l=l.sibling}if(!a)throw Error(X(189))}}if(n.alternate!==r)throw Error(X(190))}if(n.tag!==3)throw Error(X(188));return n.stateNode.current===n?t:e}function t0(t){return t=pE(t),t!==null?n0(t):null}function n0(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=n0(t);if(e!==null)return e;t=t.sibling}return null}var r0=vn.unstable_scheduleCallback,Yp=vn.unstable_cancelCallback,gE=vn.unstable_shouldYield,yE=vn.unstable_requestPaint,ct=vn.unstable_now,vE=vn.unstable_getCurrentPriorityLevel,uf=vn.unstable_ImmediatePriority,s0=vn.unstable_UserBlockingPriority,ac=vn.unstable_NormalPriority,wE=vn.unstable_LowPriority,i0=vn.unstable_IdlePriority,Gc=null,Jn=null;function xE(t){if(Jn&&typeof Jn.onCommitFiberRoot=="function")try{Jn.onCommitFiberRoot(Gc,t,void 0,(t.current.flags&128)===128)}catch{}}var Vn=Math.clz32?Math.clz32:EE,_E=Math.log,bE=Math.LN2;function EE(t){return t>>>=0,t===0?32:31-(_E(t)/bE|0)|0}var yl=64,vl=4194304;function Pa(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function oc(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var l=a&~s;l!==0?r=Pa(l):(i&=a,i!==0&&(r=Pa(i)))}else a=n&~s,a!==0?r=Pa(a):i!==0&&(r=Pa(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Vn(e),s=1<<n,r|=t[n],e&=~s;return r}function TE(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function CE(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-Vn(i),l=1<<a,u=s[a];u===-1?(!(l&n)||l&r)&&(s[a]=TE(l,e)):u<=e&&(t.expiredLanes|=l),i&=~l}}function Qd(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function a0(){var t=yl;return yl<<=1,!(yl&4194240)&&(yl=64),t}function Qu(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Po(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Vn(e),t[e]=n}function SE(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Vn(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function df(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Vn(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Ue=0;function o0(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var l0,hf,c0,u0,d0,Yd=!1,wl=[],ns=null,rs=null,ss=null,to=new Map,no=new Map,Hr=[],kE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xp(t,e){switch(t){case"focusin":case"focusout":ns=null;break;case"dragenter":case"dragleave":rs=null;break;case"mouseover":case"mouseout":ss=null;break;case"pointerover":case"pointerout":to.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":no.delete(e.pointerId)}}function _a(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Ro(e),e!==null&&hf(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function NE(t,e,n,r,s){switch(e){case"focusin":return ns=_a(ns,t,e,n,r,s),!0;case"dragenter":return rs=_a(rs,t,e,n,r,s),!0;case"mouseover":return ss=_a(ss,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return to.set(i,_a(to.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,no.set(i,_a(no.get(i)||null,t,e,n,r,s)),!0}return!1}function h0(t){var e=Ms(t.target);if(e!==null){var n=ei(e);if(n!==null){if(e=n.tag,e===13){if(e=e0(n),e!==null){t.blockedOn=e,d0(t.priority,function(){c0(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Vl(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Xd(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);qd=r,n.target.dispatchEvent(r),qd=null}else return e=Ro(n),e!==null&&hf(e),t.blockedOn=n,!1;e.shift()}return!0}function Jp(t,e,n){Vl(t)&&n.delete(e)}function IE(){Yd=!1,ns!==null&&Vl(ns)&&(ns=null),rs!==null&&Vl(rs)&&(rs=null),ss!==null&&Vl(ss)&&(ss=null),to.forEach(Jp),no.forEach(Jp)}function ba(t,e){t.blockedOn===e&&(t.blockedOn=null,Yd||(Yd=!0,vn.unstable_scheduleCallback(vn.unstable_NormalPriority,IE)))}function ro(t){function e(s){return ba(s,t)}if(0<wl.length){ba(wl[0],t);for(var n=1;n<wl.length;n++){var r=wl[n];r.blockedOn===t&&(r.blockedOn=null)}}for(ns!==null&&ba(ns,t),rs!==null&&ba(rs,t),ss!==null&&ba(ss,t),to.forEach(e),no.forEach(e),n=0;n<Hr.length;n++)r=Hr[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Hr.length&&(n=Hr[0],n.blockedOn===null);)h0(n),n.blockedOn===null&&Hr.shift()}var Ai=Ir.ReactCurrentBatchConfig,lc=!0;function PE(t,e,n,r){var s=Ue,i=Ai.transition;Ai.transition=null;try{Ue=1,ff(t,e,n,r)}finally{Ue=s,Ai.transition=i}}function AE(t,e,n,r){var s=Ue,i=Ai.transition;Ai.transition=null;try{Ue=4,ff(t,e,n,r)}finally{Ue=s,Ai.transition=i}}function ff(t,e,n,r){if(lc){var s=Xd(t,e,n,r);if(s===null)id(t,e,r,cc,n),Xp(t,r);else if(NE(s,t,e,n,r))r.stopPropagation();else if(Xp(t,r),e&4&&-1<kE.indexOf(t)){for(;s!==null;){var i=Ro(s);if(i!==null&&l0(i),i=Xd(t,e,n,r),i===null&&id(t,e,r,cc,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else id(t,e,r,null,n)}}var cc=null;function Xd(t,e,n,r){if(cc=null,t=cf(r),t=Ms(t),t!==null)if(e=ei(t),e===null)t=null;else if(n=e.tag,n===13){if(t=e0(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return cc=t,null}function f0(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(vE()){case uf:return 1;case s0:return 4;case ac:case wE:return 16;case i0:return 536870912;default:return 16}default:return 16}}var Jr=null,mf=null,Fl=null;function m0(){if(Fl)return Fl;var t,e=mf,n=e.length,r,s="value"in Jr?Jr.value:Jr.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===s[i-r];r++);return Fl=s.slice(t,1<r?1-r:void 0)}function $l(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function xl(){return!0}function Zp(){return!1}function _n(t){function e(n,r,s,i,a){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?xl:Zp,this.isPropagationStopped=Zp,this}return nt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=xl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=xl)},persist:function(){},isPersistent:xl}),e}var ea={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pf=_n(ea),Ao=nt({},ea,{view:0,detail:0}),RE=_n(Ao),Yu,Xu,Ea,Kc=nt({},Ao,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gf,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ea&&(Ea&&t.type==="mousemove"?(Yu=t.screenX-Ea.screenX,Xu=t.screenY-Ea.screenY):Xu=Yu=0,Ea=t),Yu)},movementY:function(t){return"movementY"in t?t.movementY:Xu}}),eg=_n(Kc),jE=nt({},Kc,{dataTransfer:0}),DE=_n(jE),ME=nt({},Ao,{relatedTarget:0}),Ju=_n(ME),LE=nt({},ea,{animationName:0,elapsedTime:0,pseudoElement:0}),OE=_n(LE),VE=nt({},ea,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),FE=_n(VE),$E=nt({},ea,{data:0}),tg=_n($E),UE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},BE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function WE(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=zE[t])?!!e[t]:!1}function gf(){return WE}var qE=nt({},Ao,{key:function(t){if(t.key){var e=UE[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=$l(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?BE[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gf,charCode:function(t){return t.type==="keypress"?$l(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?$l(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),HE=_n(qE),GE=nt({},Kc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ng=_n(GE),KE=nt({},Ao,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gf}),QE=_n(KE),YE=nt({},ea,{propertyName:0,elapsedTime:0,pseudoElement:0}),XE=_n(YE),JE=nt({},Kc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),ZE=_n(JE),eT=[9,13,27,32],yf=xr&&"CompositionEvent"in window,$a=null;xr&&"documentMode"in document&&($a=document.documentMode);var tT=xr&&"TextEvent"in window&&!$a,p0=xr&&(!yf||$a&&8<$a&&11>=$a),rg=String.fromCharCode(32),sg=!1;function g0(t,e){switch(t){case"keyup":return eT.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function y0(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var yi=!1;function nT(t,e){switch(t){case"compositionend":return y0(e);case"keypress":return e.which!==32?null:(sg=!0,rg);case"textInput":return t=e.data,t===rg&&sg?null:t;default:return null}}function rT(t,e){if(yi)return t==="compositionend"||!yf&&g0(t,e)?(t=m0(),Fl=mf=Jr=null,yi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return p0&&e.locale!=="ko"?null:e.data;default:return null}}var sT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ig(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!sT[t.type]:e==="textarea"}function v0(t,e,n,r){Qv(r),e=uc(e,"onChange"),0<e.length&&(n=new pf("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ua=null,so=null;function iT(t){I0(t,0)}function Qc(t){var e=xi(t);if(Bv(e))return t}function aT(t,e){if(t==="change")return e}var w0=!1;if(xr){var Zu;if(xr){var ed="oninput"in document;if(!ed){var ag=document.createElement("div");ag.setAttribute("oninput","return;"),ed=typeof ag.oninput=="function"}Zu=ed}else Zu=!1;w0=Zu&&(!document.documentMode||9<document.documentMode)}function og(){Ua&&(Ua.detachEvent("onpropertychange",x0),so=Ua=null)}function x0(t){if(t.propertyName==="value"&&Qc(so)){var e=[];v0(e,so,t,cf(t)),Zv(iT,e)}}function oT(t,e,n){t==="focusin"?(og(),Ua=e,so=n,Ua.attachEvent("onpropertychange",x0)):t==="focusout"&&og()}function lT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Qc(so)}function cT(t,e){if(t==="click")return Qc(e)}function uT(t,e){if(t==="input"||t==="change")return Qc(e)}function dT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Un=typeof Object.is=="function"?Object.is:dT;function io(t,e){if(Un(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!jd.call(e,s)||!Un(t[s],e[s]))return!1}return!0}function lg(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function cg(t,e){var n=lg(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=lg(n)}}function _0(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?_0(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function b0(){for(var t=window,e=rc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=rc(t.document)}return e}function vf(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function hT(t){var e=b0(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&_0(n.ownerDocument.documentElement,n)){if(r!==null&&vf(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=cg(n,i);var a=cg(n,r);s&&a&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var fT=xr&&"documentMode"in document&&11>=document.documentMode,vi=null,Jd=null,Ba=null,Zd=!1;function ug(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Zd||vi==null||vi!==rc(r)||(r=vi,"selectionStart"in r&&vf(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ba&&io(Ba,r)||(Ba=r,r=uc(Jd,"onSelect"),0<r.length&&(e=new pf("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=vi)))}function _l(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var wi={animationend:_l("Animation","AnimationEnd"),animationiteration:_l("Animation","AnimationIteration"),animationstart:_l("Animation","AnimationStart"),transitionend:_l("Transition","TransitionEnd")},td={},E0={};xr&&(E0=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);function Yc(t){if(td[t])return td[t];if(!wi[t])return t;var e=wi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in E0)return td[t]=e[n];return t}var T0=Yc("animationend"),C0=Yc("animationiteration"),S0=Yc("animationstart"),k0=Yc("transitionend"),N0=new Map,dg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _s(t,e){N0.set(t,e),Zs(e,[t])}for(var nd=0;nd<dg.length;nd++){var rd=dg[nd],mT=rd.toLowerCase(),pT=rd[0].toUpperCase()+rd.slice(1);_s(mT,"on"+pT)}_s(T0,"onAnimationEnd");_s(C0,"onAnimationIteration");_s(S0,"onAnimationStart");_s("dblclick","onDoubleClick");_s("focusin","onFocus");_s("focusout","onBlur");_s(k0,"onTransitionEnd");Vi("onMouseEnter",["mouseout","mouseover"]);Vi("onMouseLeave",["mouseout","mouseover"]);Vi("onPointerEnter",["pointerout","pointerover"]);Vi("onPointerLeave",["pointerout","pointerover"]);Zs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Zs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Zs("onBeforeInput",["compositionend","keypress","textInput","paste"]);Zs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Zs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Zs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Aa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),gT=new Set("cancel close invalid load scroll toggle".split(" ").concat(Aa));function hg(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,mE(r,e,void 0,t),t.currentTarget=null}function I0(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var l=r[a],u=l.instance,d=l.currentTarget;if(l=l.listener,u!==i&&s.isPropagationStopped())break e;hg(s,l,d),i=u}else for(a=0;a<r.length;a++){if(l=r[a],u=l.instance,d=l.currentTarget,l=l.listener,u!==i&&s.isPropagationStopped())break e;hg(s,l,d),i=u}}}if(ic)throw t=Kd,ic=!1,Kd=null,t}function Ye(t,e){var n=e[sh];n===void 0&&(n=e[sh]=new Set);var r=t+"__bubble";n.has(r)||(P0(e,t,2,!1),n.add(r))}function sd(t,e,n){var r=0;e&&(r|=4),P0(n,t,r,e)}var bl="_reactListening"+Math.random().toString(36).slice(2);function ao(t){if(!t[bl]){t[bl]=!0,Ov.forEach(function(n){n!=="selectionchange"&&(gT.has(n)||sd(n,!1,t),sd(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[bl]||(e[bl]=!0,sd("selectionchange",!1,e))}}function P0(t,e,n,r){switch(f0(e)){case 1:var s=PE;break;case 4:s=AE;break;default:s=ff}n=s.bind(null,e,n,t),s=void 0,!Gd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function id(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===s||u.nodeType===8&&u.parentNode===s))return;a=a.return}for(;l!==null;){if(a=Ms(l),a===null)return;if(u=a.tag,u===5||u===6){r=i=a;continue e}l=l.parentNode}}r=r.return}Zv(function(){var d=i,f=cf(n),m=[];e:{var g=N0.get(t);if(g!==void 0){var b=pf,k=t;switch(t){case"keypress":if($l(n)===0)break e;case"keydown":case"keyup":b=HE;break;case"focusin":k="focus",b=Ju;break;case"focusout":k="blur",b=Ju;break;case"beforeblur":case"afterblur":b=Ju;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":b=eg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":b=DE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":b=QE;break;case T0:case C0:case S0:b=OE;break;case k0:b=XE;break;case"scroll":b=RE;break;case"wheel":b=ZE;break;case"copy":case"cut":case"paste":b=FE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":b=ng}var C=(e&4)!==0,N=!C&&t==="scroll",_=C?g!==null?g+"Capture":null:g;C=[];for(var x=d,I;x!==null;){I=x;var D=I.stateNode;if(I.tag===5&&D!==null&&(I=D,_!==null&&(D=eo(x,_),D!=null&&C.push(oo(x,D,I)))),N)break;x=x.return}0<C.length&&(g=new b(g,k,null,n,f),m.push({event:g,listeners:C}))}}if(!(e&7)){e:{if(g=t==="mouseover"||t==="pointerover",b=t==="mouseout"||t==="pointerout",g&&n!==qd&&(k=n.relatedTarget||n.fromElement)&&(Ms(k)||k[_r]))break e;if((b||g)&&(g=f.window===f?f:(g=f.ownerDocument)?g.defaultView||g.parentWindow:window,b?(k=n.relatedTarget||n.toElement,b=d,k=k?Ms(k):null,k!==null&&(N=ei(k),k!==N||k.tag!==5&&k.tag!==6)&&(k=null)):(b=null,k=d),b!==k)){if(C=eg,D="onMouseLeave",_="onMouseEnter",x="mouse",(t==="pointerout"||t==="pointerover")&&(C=ng,D="onPointerLeave",_="onPointerEnter",x="pointer"),N=b==null?g:xi(b),I=k==null?g:xi(k),g=new C(D,x+"leave",b,n,f),g.target=N,g.relatedTarget=I,D=null,Ms(f)===d&&(C=new C(_,x+"enter",k,n,f),C.target=I,C.relatedTarget=N,D=C),N=D,b&&k)t:{for(C=b,_=k,x=0,I=C;I;I=di(I))x++;for(I=0,D=_;D;D=di(D))I++;for(;0<x-I;)C=di(C),x--;for(;0<I-x;)_=di(_),I--;for(;x--;){if(C===_||_!==null&&C===_.alternate)break t;C=di(C),_=di(_)}C=null}else C=null;b!==null&&fg(m,g,b,C,!1),k!==null&&N!==null&&fg(m,N,k,C,!0)}}e:{if(g=d?xi(d):window,b=g.nodeName&&g.nodeName.toLowerCase(),b==="select"||b==="input"&&g.type==="file")var F=aT;else if(ig(g))if(w0)F=uT;else{F=lT;var q=oT}else(b=g.nodeName)&&b.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(F=cT);if(F&&(F=F(t,d))){v0(m,F,n,f);break e}q&&q(t,g,d),t==="focusout"&&(q=g._wrapperState)&&q.controlled&&g.type==="number"&&$d(g,"number",g.value)}switch(q=d?xi(d):window,t){case"focusin":(ig(q)||q.contentEditable==="true")&&(vi=q,Jd=d,Ba=null);break;case"focusout":Ba=Jd=vi=null;break;case"mousedown":Zd=!0;break;case"contextmenu":case"mouseup":case"dragend":Zd=!1,ug(m,n,f);break;case"selectionchange":if(fT)break;case"keydown":case"keyup":ug(m,n,f)}var v;if(yf)e:{switch(t){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else yi?g0(t,n)&&(y="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(y="onCompositionStart");y&&(p0&&n.locale!=="ko"&&(yi||y!=="onCompositionStart"?y==="onCompositionEnd"&&yi&&(v=m0()):(Jr=f,mf="value"in Jr?Jr.value:Jr.textContent,yi=!0)),q=uc(d,y),0<q.length&&(y=new tg(y,t,null,n,f),m.push({event:y,listeners:q}),v?y.data=v:(v=y0(n),v!==null&&(y.data=v)))),(v=tT?nT(t,n):rT(t,n))&&(d=uc(d,"onBeforeInput"),0<d.length&&(f=new tg("onBeforeInput","beforeinput",null,n,f),m.push({event:f,listeners:d}),f.data=v))}I0(m,e)})}function oo(t,e,n){return{instance:t,listener:e,currentTarget:n}}function uc(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=eo(t,n),i!=null&&r.unshift(oo(t,i,s)),i=eo(t,e),i!=null&&r.push(oo(t,i,s))),t=t.return}return r}function di(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function fg(t,e,n,r,s){for(var i=e._reactName,a=[];n!==null&&n!==r;){var l=n,u=l.alternate,d=l.stateNode;if(u!==null&&u===r)break;l.tag===5&&d!==null&&(l=d,s?(u=eo(n,i),u!=null&&a.unshift(oo(n,u,l))):s||(u=eo(n,i),u!=null&&a.push(oo(n,u,l)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var yT=/\r\n?/g,vT=/\u0000|\uFFFD/g;function mg(t){return(typeof t=="string"?t:""+t).replace(yT,`
`).replace(vT,"")}function El(t,e,n){if(e=mg(e),mg(t)!==e&&n)throw Error(X(425))}function dc(){}var eh=null,th=null;function nh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var rh=typeof setTimeout=="function"?setTimeout:void 0,wT=typeof clearTimeout=="function"?clearTimeout:void 0,pg=typeof Promise=="function"?Promise:void 0,xT=typeof queueMicrotask=="function"?queueMicrotask:typeof pg<"u"?function(t){return pg.resolve(null).then(t).catch(_T)}:rh;function _T(t){setTimeout(function(){throw t})}function ad(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),ro(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);ro(e)}function is(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function gg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ta=Math.random().toString(36).slice(2),Qn="__reactFiber$"+ta,lo="__reactProps$"+ta,_r="__reactContainer$"+ta,sh="__reactEvents$"+ta,bT="__reactListeners$"+ta,ET="__reactHandles$"+ta;function Ms(t){var e=t[Qn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[_r]||n[Qn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=gg(t);t!==null;){if(n=t[Qn])return n;t=gg(t)}return e}t=n,n=t.parentNode}return null}function Ro(t){return t=t[Qn]||t[_r],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function xi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(X(33))}function Xc(t){return t[lo]||null}var ih=[],_i=-1;function bs(t){return{current:t}}function Je(t){0>_i||(t.current=ih[_i],ih[_i]=null,_i--)}function He(t,e){_i++,ih[_i]=t.current,t.current=e}var gs={},Qt=bs(gs),ln=bs(!1),Bs=gs;function Fi(t,e){var n=t.type.contextTypes;if(!n)return gs;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function cn(t){return t=t.childContextTypes,t!=null}function hc(){Je(ln),Je(Qt)}function yg(t,e,n){if(Qt.current!==gs)throw Error(X(168));He(Qt,e),He(ln,n)}function A0(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(X(108,oE(t)||"Unknown",s));return nt({},n,r)}function fc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||gs,Bs=Qt.current,He(Qt,t),He(ln,ln.current),!0}function vg(t,e,n){var r=t.stateNode;if(!r)throw Error(X(169));n?(t=A0(t,e,Bs),r.__reactInternalMemoizedMergedChildContext=t,Je(ln),Je(Qt),He(Qt,t)):Je(ln),He(ln,n)}var ur=null,Jc=!1,od=!1;function R0(t){ur===null?ur=[t]:ur.push(t)}function TT(t){Jc=!0,R0(t)}function Es(){if(!od&&ur!==null){od=!0;var t=0,e=Ue;try{var n=ur;for(Ue=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}ur=null,Jc=!1}catch(s){throw ur!==null&&(ur=ur.slice(t+1)),r0(uf,Es),s}finally{Ue=e,od=!1}}return null}var bi=[],Ei=0,mc=null,pc=0,En=[],Tn=0,zs=null,hr=1,fr="";function Rs(t,e){bi[Ei++]=pc,bi[Ei++]=mc,mc=t,pc=e}function j0(t,e,n){En[Tn++]=hr,En[Tn++]=fr,En[Tn++]=zs,zs=t;var r=hr;t=fr;var s=32-Vn(r)-1;r&=~(1<<s),n+=1;var i=32-Vn(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,hr=1<<32-Vn(e)+s|n<<s|r,fr=i+t}else hr=1<<i|n<<s|r,fr=t}function wf(t){t.return!==null&&(Rs(t,1),j0(t,1,0))}function xf(t){for(;t===mc;)mc=bi[--Ei],bi[Ei]=null,pc=bi[--Ei],bi[Ei]=null;for(;t===zs;)zs=En[--Tn],En[Tn]=null,fr=En[--Tn],En[Tn]=null,hr=En[--Tn],En[Tn]=null}var gn=null,mn=null,Ze=!1,On=null;function D0(t,e){var n=Cn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function wg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,gn=t,mn=is(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,gn=t,mn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=zs!==null?{id:hr,overflow:fr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Cn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,gn=t,mn=null,!0):!1;default:return!1}}function ah(t){return(t.mode&1)!==0&&(t.flags&128)===0}function oh(t){if(Ze){var e=mn;if(e){var n=e;if(!wg(t,e)){if(ah(t))throw Error(X(418));e=is(n.nextSibling);var r=gn;e&&wg(t,e)?D0(r,n):(t.flags=t.flags&-4097|2,Ze=!1,gn=t)}}else{if(ah(t))throw Error(X(418));t.flags=t.flags&-4097|2,Ze=!1,gn=t}}}function xg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;gn=t}function Tl(t){if(t!==gn)return!1;if(!Ze)return xg(t),Ze=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!nh(t.type,t.memoizedProps)),e&&(e=mn)){if(ah(t))throw M0(),Error(X(418));for(;e;)D0(t,e),e=is(e.nextSibling)}if(xg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(X(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){mn=is(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}mn=null}}else mn=gn?is(t.stateNode.nextSibling):null;return!0}function M0(){for(var t=mn;t;)t=is(t.nextSibling)}function $i(){mn=gn=null,Ze=!1}function _f(t){On===null?On=[t]:On.push(t)}var CT=Ir.ReactCurrentBatchConfig;function Ta(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(X(309));var r=n.stateNode}if(!r)throw Error(X(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var l=s.refs;a===null?delete l[i]:l[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(X(284));if(!n._owner)throw Error(X(290,t))}return t}function Cl(t,e){throw t=Object.prototype.toString.call(e),Error(X(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function _g(t){var e=t._init;return e(t._payload)}function L0(t){function e(_,x){if(t){var I=_.deletions;I===null?(_.deletions=[x],_.flags|=16):I.push(x)}}function n(_,x){if(!t)return null;for(;x!==null;)e(_,x),x=x.sibling;return null}function r(_,x){for(_=new Map;x!==null;)x.key!==null?_.set(x.key,x):_.set(x.index,x),x=x.sibling;return _}function s(_,x){return _=cs(_,x),_.index=0,_.sibling=null,_}function i(_,x,I){return _.index=I,t?(I=_.alternate,I!==null?(I=I.index,I<x?(_.flags|=2,x):I):(_.flags|=2,x)):(_.flags|=1048576,x)}function a(_){return t&&_.alternate===null&&(_.flags|=2),_}function l(_,x,I,D){return x===null||x.tag!==6?(x=md(I,_.mode,D),x.return=_,x):(x=s(x,I),x.return=_,x)}function u(_,x,I,D){var F=I.type;return F===gi?f(_,x,I.props.children,D,I.key):x!==null&&(x.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===Wr&&_g(F)===x.type)?(D=s(x,I.props),D.ref=Ta(_,x,I),D.return=_,D):(D=Gl(I.type,I.key,I.props,null,_.mode,D),D.ref=Ta(_,x,I),D.return=_,D)}function d(_,x,I,D){return x===null||x.tag!==4||x.stateNode.containerInfo!==I.containerInfo||x.stateNode.implementation!==I.implementation?(x=pd(I,_.mode,D),x.return=_,x):(x=s(x,I.children||[]),x.return=_,x)}function f(_,x,I,D,F){return x===null||x.tag!==7?(x=$s(I,_.mode,D,F),x.return=_,x):(x=s(x,I),x.return=_,x)}function m(_,x,I){if(typeof x=="string"&&x!==""||typeof x=="number")return x=md(""+x,_.mode,I),x.return=_,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case ml:return I=Gl(x.type,x.key,x.props,null,_.mode,I),I.ref=Ta(_,null,x),I.return=_,I;case pi:return x=pd(x,_.mode,I),x.return=_,x;case Wr:var D=x._init;return m(_,D(x._payload),I)}if(Ia(x)||wa(x))return x=$s(x,_.mode,I,null),x.return=_,x;Cl(_,x)}return null}function g(_,x,I,D){var F=x!==null?x.key:null;if(typeof I=="string"&&I!==""||typeof I=="number")return F!==null?null:l(_,x,""+I,D);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case ml:return I.key===F?u(_,x,I,D):null;case pi:return I.key===F?d(_,x,I,D):null;case Wr:return F=I._init,g(_,x,F(I._payload),D)}if(Ia(I)||wa(I))return F!==null?null:f(_,x,I,D,null);Cl(_,I)}return null}function b(_,x,I,D,F){if(typeof D=="string"&&D!==""||typeof D=="number")return _=_.get(I)||null,l(x,_,""+D,F);if(typeof D=="object"&&D!==null){switch(D.$$typeof){case ml:return _=_.get(D.key===null?I:D.key)||null,u(x,_,D,F);case pi:return _=_.get(D.key===null?I:D.key)||null,d(x,_,D,F);case Wr:var q=D._init;return b(_,x,I,q(D._payload),F)}if(Ia(D)||wa(D))return _=_.get(I)||null,f(x,_,D,F,null);Cl(x,D)}return null}function k(_,x,I,D){for(var F=null,q=null,v=x,y=x=0,S=null;v!==null&&y<I.length;y++){v.index>y?(S=v,v=null):S=v.sibling;var P=g(_,v,I[y],D);if(P===null){v===null&&(v=S);break}t&&v&&P.alternate===null&&e(_,v),x=i(P,x,y),q===null?F=P:q.sibling=P,q=P,v=S}if(y===I.length)return n(_,v),Ze&&Rs(_,y),F;if(v===null){for(;y<I.length;y++)v=m(_,I[y],D),v!==null&&(x=i(v,x,y),q===null?F=v:q.sibling=v,q=v);return Ze&&Rs(_,y),F}for(v=r(_,v);y<I.length;y++)S=b(v,_,y,I[y],D),S!==null&&(t&&S.alternate!==null&&v.delete(S.key===null?y:S.key),x=i(S,x,y),q===null?F=S:q.sibling=S,q=S);return t&&v.forEach(function(R){return e(_,R)}),Ze&&Rs(_,y),F}function C(_,x,I,D){var F=wa(I);if(typeof F!="function")throw Error(X(150));if(I=F.call(I),I==null)throw Error(X(151));for(var q=F=null,v=x,y=x=0,S=null,P=I.next();v!==null&&!P.done;y++,P=I.next()){v.index>y?(S=v,v=null):S=v.sibling;var R=g(_,v,P.value,D);if(R===null){v===null&&(v=S);break}t&&v&&R.alternate===null&&e(_,v),x=i(R,x,y),q===null?F=R:q.sibling=R,q=R,v=S}if(P.done)return n(_,v),Ze&&Rs(_,y),F;if(v===null){for(;!P.done;y++,P=I.next())P=m(_,P.value,D),P!==null&&(x=i(P,x,y),q===null?F=P:q.sibling=P,q=P);return Ze&&Rs(_,y),F}for(v=r(_,v);!P.done;y++,P=I.next())P=b(v,_,y,P.value,D),P!==null&&(t&&P.alternate!==null&&v.delete(P.key===null?y:P.key),x=i(P,x,y),q===null?F=P:q.sibling=P,q=P);return t&&v.forEach(function(E){return e(_,E)}),Ze&&Rs(_,y),F}function N(_,x,I,D){if(typeof I=="object"&&I!==null&&I.type===gi&&I.key===null&&(I=I.props.children),typeof I=="object"&&I!==null){switch(I.$$typeof){case ml:e:{for(var F=I.key,q=x;q!==null;){if(q.key===F){if(F=I.type,F===gi){if(q.tag===7){n(_,q.sibling),x=s(q,I.props.children),x.return=_,_=x;break e}}else if(q.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===Wr&&_g(F)===q.type){n(_,q.sibling),x=s(q,I.props),x.ref=Ta(_,q,I),x.return=_,_=x;break e}n(_,q);break}else e(_,q);q=q.sibling}I.type===gi?(x=$s(I.props.children,_.mode,D,I.key),x.return=_,_=x):(D=Gl(I.type,I.key,I.props,null,_.mode,D),D.ref=Ta(_,x,I),D.return=_,_=D)}return a(_);case pi:e:{for(q=I.key;x!==null;){if(x.key===q)if(x.tag===4&&x.stateNode.containerInfo===I.containerInfo&&x.stateNode.implementation===I.implementation){n(_,x.sibling),x=s(x,I.children||[]),x.return=_,_=x;break e}else{n(_,x);break}else e(_,x);x=x.sibling}x=pd(I,_.mode,D),x.return=_,_=x}return a(_);case Wr:return q=I._init,N(_,x,q(I._payload),D)}if(Ia(I))return k(_,x,I,D);if(wa(I))return C(_,x,I,D);Cl(_,I)}return typeof I=="string"&&I!==""||typeof I=="number"?(I=""+I,x!==null&&x.tag===6?(n(_,x.sibling),x=s(x,I),x.return=_,_=x):(n(_,x),x=md(I,_.mode,D),x.return=_,_=x),a(_)):n(_,x)}return N}var Ui=L0(!0),O0=L0(!1),gc=bs(null),yc=null,Ti=null,bf=null;function Ef(){bf=Ti=yc=null}function Tf(t){var e=gc.current;Je(gc),t._currentValue=e}function lh(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Ri(t,e){yc=t,bf=Ti=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(on=!0),t.firstContext=null)}function kn(t){var e=t._currentValue;if(bf!==t)if(t={context:t,memoizedValue:e,next:null},Ti===null){if(yc===null)throw Error(X(308));Ti=t,yc.dependencies={lanes:0,firstContext:t}}else Ti=Ti.next=t;return e}var Ls=null;function Cf(t){Ls===null?Ls=[t]:Ls.push(t)}function V0(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Cf(e)):(n.next=s.next,s.next=n),e.interleaved=n,br(t,r)}function br(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var qr=!1;function Sf(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function F0(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function yr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function as(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Le&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,br(t,n)}return s=r.interleaved,s===null?(e.next=e,Cf(r)):(e.next=s.next,s.next=e),r.interleaved=e,br(t,n)}function Ul(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,df(t,n)}}function bg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function vc(t,e,n,r){var s=t.updateQueue;qr=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var u=l,d=u.next;u.next=null,a===null?i=d:a.next=d,a=u;var f=t.alternate;f!==null&&(f=f.updateQueue,l=f.lastBaseUpdate,l!==a&&(l===null?f.firstBaseUpdate=d:l.next=d,f.lastBaseUpdate=u))}if(i!==null){var m=s.baseState;a=0,f=d=u=null,l=i;do{var g=l.lane,b=l.eventTime;if((r&g)===g){f!==null&&(f=f.next={eventTime:b,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var k=t,C=l;switch(g=e,b=n,C.tag){case 1:if(k=C.payload,typeof k=="function"){m=k.call(b,m,g);break e}m=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=C.payload,g=typeof k=="function"?k.call(b,m,g):k,g==null)break e;m=nt({},m,g);break e;case 2:qr=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,g=s.effects,g===null?s.effects=[l]:g.push(l))}else b={eventTime:b,lane:g,tag:l.tag,payload:l.payload,callback:l.callback,next:null},f===null?(d=f=b,u=m):f=f.next=b,a|=g;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;g=l,l=g.next,g.next=null,s.lastBaseUpdate=g,s.shared.pending=null}}while(1);if(f===null&&(u=m),s.baseState=u,s.firstBaseUpdate=d,s.lastBaseUpdate=f,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);qs|=a,t.lanes=a,t.memoizedState=m}}function Eg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(X(191,s));s.call(r)}}}var jo={},Zn=bs(jo),co=bs(jo),uo=bs(jo);function Os(t){if(t===jo)throw Error(X(174));return t}function kf(t,e){switch(He(uo,e),He(co,t),He(Zn,jo),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Bd(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Bd(e,t)}Je(Zn),He(Zn,e)}function Bi(){Je(Zn),Je(co),Je(uo)}function $0(t){Os(uo.current);var e=Os(Zn.current),n=Bd(e,t.type);e!==n&&(He(co,t),He(Zn,n))}function Nf(t){co.current===t&&(Je(Zn),Je(co))}var et=bs(0);function wc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ld=[];function If(){for(var t=0;t<ld.length;t++)ld[t]._workInProgressVersionPrimary=null;ld.length=0}var Bl=Ir.ReactCurrentDispatcher,cd=Ir.ReactCurrentBatchConfig,Ws=0,tt=null,vt=null,St=null,xc=!1,za=!1,ho=0,ST=0;function Bt(){throw Error(X(321))}function Pf(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Un(t[n],e[n]))return!1;return!0}function Af(t,e,n,r,s,i){if(Ws=i,tt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Bl.current=t===null||t.memoizedState===null?PT:AT,t=n(r,s),za){i=0;do{if(za=!1,ho=0,25<=i)throw Error(X(301));i+=1,St=vt=null,e.updateQueue=null,Bl.current=RT,t=n(r,s)}while(za)}if(Bl.current=_c,e=vt!==null&&vt.next!==null,Ws=0,St=vt=tt=null,xc=!1,e)throw Error(X(300));return t}function Rf(){var t=ho!==0;return ho=0,t}function Hn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return St===null?tt.memoizedState=St=t:St=St.next=t,St}function Nn(){if(vt===null){var t=tt.alternate;t=t!==null?t.memoizedState:null}else t=vt.next;var e=St===null?tt.memoizedState:St.next;if(e!==null)St=e,vt=t;else{if(t===null)throw Error(X(310));vt=t,t={memoizedState:vt.memoizedState,baseState:vt.baseState,baseQueue:vt.baseQueue,queue:vt.queue,next:null},St===null?tt.memoizedState=St=t:St=St.next=t}return St}function fo(t,e){return typeof e=="function"?e(t):e}function ud(t){var e=Nn(),n=e.queue;if(n===null)throw Error(X(311));n.lastRenderedReducer=t;var r=vt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=a=null,u=null,d=i;do{var f=d.lane;if((Ws&f)===f)u!==null&&(u=u.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var m={lane:f,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};u===null?(l=u=m,a=r):u=u.next=m,tt.lanes|=f,qs|=f}d=d.next}while(d!==null&&d!==i);u===null?a=r:u.next=l,Un(r,e.memoizedState)||(on=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,tt.lanes|=i,qs|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function dd(t){var e=Nn(),n=e.queue;if(n===null)throw Error(X(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do i=t(i,a.action),a=a.next;while(a!==s);Un(i,e.memoizedState)||(on=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function U0(){}function B0(t,e){var n=tt,r=Nn(),s=e(),i=!Un(r.memoizedState,s);if(i&&(r.memoizedState=s,on=!0),r=r.queue,jf(q0.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||St!==null&&St.memoizedState.tag&1){if(n.flags|=2048,mo(9,W0.bind(null,n,r,s,e),void 0,null),kt===null)throw Error(X(349));Ws&30||z0(n,e,s)}return s}function z0(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=tt.updateQueue,e===null?(e={lastEffect:null,stores:null},tt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function W0(t,e,n,r){e.value=n,e.getSnapshot=r,H0(e)&&G0(t)}function q0(t,e,n){return n(function(){H0(e)&&G0(t)})}function H0(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Un(t,n)}catch{return!0}}function G0(t){var e=br(t,1);e!==null&&Fn(e,t,1,-1)}function Tg(t){var e=Hn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:fo,lastRenderedState:t},e.queue=t,t=t.dispatch=IT.bind(null,tt,t),[e.memoizedState,t]}function mo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=tt.updateQueue,e===null?(e={lastEffect:null,stores:null},tt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function K0(){return Nn().memoizedState}function zl(t,e,n,r){var s=Hn();tt.flags|=t,s.memoizedState=mo(1|e,n,void 0,r===void 0?null:r)}function Zc(t,e,n,r){var s=Nn();r=r===void 0?null:r;var i=void 0;if(vt!==null){var a=vt.memoizedState;if(i=a.destroy,r!==null&&Pf(r,a.deps)){s.memoizedState=mo(e,n,i,r);return}}tt.flags|=t,s.memoizedState=mo(1|e,n,i,r)}function Cg(t,e){return zl(8390656,8,t,e)}function jf(t,e){return Zc(2048,8,t,e)}function Q0(t,e){return Zc(4,2,t,e)}function Y0(t,e){return Zc(4,4,t,e)}function X0(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function J0(t,e,n){return n=n!=null?n.concat([t]):null,Zc(4,4,X0.bind(null,e,t),n)}function Df(){}function Z0(t,e){var n=Nn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Pf(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function ew(t,e){var n=Nn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Pf(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function tw(t,e,n){return Ws&21?(Un(n,e)||(n=a0(),tt.lanes|=n,qs|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,on=!0),t.memoizedState=n)}function kT(t,e){var n=Ue;Ue=n!==0&&4>n?n:4,t(!0);var r=cd.transition;cd.transition={};try{t(!1),e()}finally{Ue=n,cd.transition=r}}function nw(){return Nn().memoizedState}function NT(t,e,n){var r=ls(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rw(t))sw(e,n);else if(n=V0(t,e,n,r),n!==null){var s=Zt();Fn(n,t,r,s),iw(n,e,r)}}function IT(t,e,n){var r=ls(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rw(t))sw(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,l=i(a,n);if(s.hasEagerState=!0,s.eagerState=l,Un(l,a)){var u=e.interleaved;u===null?(s.next=s,Cf(e)):(s.next=u.next,u.next=s),e.interleaved=s;return}}catch{}finally{}n=V0(t,e,s,r),n!==null&&(s=Zt(),Fn(n,t,r,s),iw(n,e,r))}}function rw(t){var e=t.alternate;return t===tt||e!==null&&e===tt}function sw(t,e){za=xc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function iw(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,df(t,n)}}var _c={readContext:kn,useCallback:Bt,useContext:Bt,useEffect:Bt,useImperativeHandle:Bt,useInsertionEffect:Bt,useLayoutEffect:Bt,useMemo:Bt,useReducer:Bt,useRef:Bt,useState:Bt,useDebugValue:Bt,useDeferredValue:Bt,useTransition:Bt,useMutableSource:Bt,useSyncExternalStore:Bt,useId:Bt,unstable_isNewReconciler:!1},PT={readContext:kn,useCallback:function(t,e){return Hn().memoizedState=[t,e===void 0?null:e],t},useContext:kn,useEffect:Cg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,zl(4194308,4,X0.bind(null,e,t),n)},useLayoutEffect:function(t,e){return zl(4194308,4,t,e)},useInsertionEffect:function(t,e){return zl(4,2,t,e)},useMemo:function(t,e){var n=Hn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Hn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=NT.bind(null,tt,t),[r.memoizedState,t]},useRef:function(t){var e=Hn();return t={current:t},e.memoizedState=t},useState:Tg,useDebugValue:Df,useDeferredValue:function(t){return Hn().memoizedState=t},useTransition:function(){var t=Tg(!1),e=t[0];return t=kT.bind(null,t[1]),Hn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=tt,s=Hn();if(Ze){if(n===void 0)throw Error(X(407));n=n()}else{if(n=e(),kt===null)throw Error(X(349));Ws&30||z0(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Cg(q0.bind(null,r,i,t),[t]),r.flags|=2048,mo(9,W0.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Hn(),e=kt.identifierPrefix;if(Ze){var n=fr,r=hr;n=(r&~(1<<32-Vn(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ho++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=ST++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},AT={readContext:kn,useCallback:Z0,useContext:kn,useEffect:jf,useImperativeHandle:J0,useInsertionEffect:Q0,useLayoutEffect:Y0,useMemo:ew,useReducer:ud,useRef:K0,useState:function(){return ud(fo)},useDebugValue:Df,useDeferredValue:function(t){var e=Nn();return tw(e,vt.memoizedState,t)},useTransition:function(){var t=ud(fo)[0],e=Nn().memoizedState;return[t,e]},useMutableSource:U0,useSyncExternalStore:B0,useId:nw,unstable_isNewReconciler:!1},RT={readContext:kn,useCallback:Z0,useContext:kn,useEffect:jf,useImperativeHandle:J0,useInsertionEffect:Q0,useLayoutEffect:Y0,useMemo:ew,useReducer:dd,useRef:K0,useState:function(){return dd(fo)},useDebugValue:Df,useDeferredValue:function(t){var e=Nn();return vt===null?e.memoizedState=t:tw(e,vt.memoizedState,t)},useTransition:function(){var t=dd(fo)[0],e=Nn().memoizedState;return[t,e]},useMutableSource:U0,useSyncExternalStore:B0,useId:nw,unstable_isNewReconciler:!1};function Mn(t,e){if(t&&t.defaultProps){e=nt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function ch(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:nt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var eu={isMounted:function(t){return(t=t._reactInternals)?ei(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Zt(),s=ls(t),i=yr(r,s);i.payload=e,n!=null&&(i.callback=n),e=as(t,i,s),e!==null&&(Fn(e,t,s,r),Ul(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Zt(),s=ls(t),i=yr(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=as(t,i,s),e!==null&&(Fn(e,t,s,r),Ul(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Zt(),r=ls(t),s=yr(n,r);s.tag=2,e!=null&&(s.callback=e),e=as(t,s,r),e!==null&&(Fn(e,t,r,n),Ul(e,t,r))}};function Sg(t,e,n,r,s,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!io(n,r)||!io(s,i):!0}function aw(t,e,n){var r=!1,s=gs,i=e.contextType;return typeof i=="object"&&i!==null?i=kn(i):(s=cn(e)?Bs:Qt.current,r=e.contextTypes,i=(r=r!=null)?Fi(t,s):gs),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=eu,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function kg(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&eu.enqueueReplaceState(e,e.state,null)}function uh(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Sf(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=kn(i):(i=cn(e)?Bs:Qt.current,s.context=Fi(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(ch(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&eu.enqueueReplaceState(s,s.state,null),vc(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function zi(t,e){try{var n="",r=e;do n+=aE(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function hd(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function dh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var jT=typeof WeakMap=="function"?WeakMap:Map;function ow(t,e,n){n=yr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Ec||(Ec=!0,_h=r),dh(t,e)},n}function lw(t,e,n){n=yr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){dh(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){dh(t,e),typeof r!="function"&&(os===null?os=new Set([this]):os.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function Ng(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new jT;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=GT.bind(null,t,e,n),e.then(t,t))}function Ig(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Pg(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=yr(-1,1),e.tag=2,as(n,e,1))),n.lanes|=1),t)}var DT=Ir.ReactCurrentOwner,on=!1;function Jt(t,e,n,r){e.child=t===null?O0(e,null,n,r):Ui(e,t.child,n,r)}function Ag(t,e,n,r,s){n=n.render;var i=e.ref;return Ri(e,s),r=Af(t,e,n,r,i,s),n=Rf(),t!==null&&!on?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Er(t,e,s)):(Ze&&n&&wf(e),e.flags|=1,Jt(t,e,r,s),e.child)}function Rg(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!Bf(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,cw(t,e,i,r,s)):(t=Gl(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:io,n(a,r)&&t.ref===e.ref)return Er(t,e,s)}return e.flags|=1,t=cs(i,r),t.ref=e.ref,t.return=e,e.child=t}function cw(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(io(i,r)&&t.ref===e.ref)if(on=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(on=!0);else return e.lanes=t.lanes,Er(t,e,s)}return hh(t,e,n,r,s)}function uw(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},He(Si,fn),fn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,He(Si,fn),fn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,He(Si,fn),fn|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,He(Si,fn),fn|=r;return Jt(t,e,s,n),e.child}function dw(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function hh(t,e,n,r,s){var i=cn(n)?Bs:Qt.current;return i=Fi(e,i),Ri(e,s),n=Af(t,e,n,r,i,s),r=Rf(),t!==null&&!on?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Er(t,e,s)):(Ze&&r&&wf(e),e.flags|=1,Jt(t,e,n,s),e.child)}function jg(t,e,n,r,s){if(cn(n)){var i=!0;fc(e)}else i=!1;if(Ri(e,s),e.stateNode===null)Wl(t,e),aw(e,n,r),uh(e,n,r,s),r=!0;else if(t===null){var a=e.stateNode,l=e.memoizedProps;a.props=l;var u=a.context,d=n.contextType;typeof d=="object"&&d!==null?d=kn(d):(d=cn(n)?Bs:Qt.current,d=Fi(e,d));var f=n.getDerivedStateFromProps,m=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function";m||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==r||u!==d)&&kg(e,a,r,d),qr=!1;var g=e.memoizedState;a.state=g,vc(e,r,a,s),u=e.memoizedState,l!==r||g!==u||ln.current||qr?(typeof f=="function"&&(ch(e,n,f,r),u=e.memoizedState),(l=qr||Sg(e,n,l,r,g,u,d))?(m||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),a.props=r,a.state=u,a.context=d,r=l):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,F0(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:Mn(e.type,l),a.props=d,m=e.pendingProps,g=a.context,u=n.contextType,typeof u=="object"&&u!==null?u=kn(u):(u=cn(n)?Bs:Qt.current,u=Fi(e,u));var b=n.getDerivedStateFromProps;(f=typeof b=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==m||g!==u)&&kg(e,a,r,u),qr=!1,g=e.memoizedState,a.state=g,vc(e,r,a,s);var k=e.memoizedState;l!==m||g!==k||ln.current||qr?(typeof b=="function"&&(ch(e,n,b,r),k=e.memoizedState),(d=qr||Sg(e,n,d,r,g,k,u)||!1)?(f||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,k,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,k,u)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=k),a.props=r,a.state=k,a.context=u,r=d):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),r=!1)}return fh(t,e,n,r,i,s)}function fh(t,e,n,r,s,i){dw(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&vg(e,n,!1),Er(t,e,i);r=e.stateNode,DT.current=e;var l=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=Ui(e,t.child,null,i),e.child=Ui(e,null,l,i)):Jt(t,e,l,i),e.memoizedState=r.state,s&&vg(e,n,!0),e.child}function hw(t){var e=t.stateNode;e.pendingContext?yg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&yg(t,e.context,!1),kf(t,e.containerInfo)}function Dg(t,e,n,r,s){return $i(),_f(s),e.flags|=256,Jt(t,e,n,r),e.child}var mh={dehydrated:null,treeContext:null,retryLane:0};function ph(t){return{baseLanes:t,cachePool:null,transitions:null}}function fw(t,e,n){var r=e.pendingProps,s=et.current,i=!1,a=(e.flags&128)!==0,l;if((l=a)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),He(et,s&1),t===null)return oh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=ru(a,r,0,null),t=$s(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=ph(n),e.memoizedState=mh,t):Mf(e,a));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return MT(t,e,a,r,l,s,n);if(i){i=r.fallback,a=e.mode,s=t.child,l=s.sibling;var u={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=cs(s,u),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=cs(l,i):(i=$s(i,a,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=t.child.memoizedState,a=a===null?ph(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=mh,r}return i=t.child,t=i.sibling,r=cs(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Mf(t,e){return e=ru({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Sl(t,e,n,r){return r!==null&&_f(r),Ui(e,t.child,null,n),t=Mf(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function MT(t,e,n,r,s,i,a){if(n)return e.flags&256?(e.flags&=-257,r=hd(Error(X(422))),Sl(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=ru({mode:"visible",children:r.children},s,0,null),i=$s(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Ui(e,t.child,null,a),e.child.memoizedState=ph(a),e.memoizedState=mh,i);if(!(e.mode&1))return Sl(t,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(X(419)),r=hd(i,r,void 0),Sl(t,e,a,r)}if(l=(a&t.childLanes)!==0,on||l){if(r=kt,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,br(t,s),Fn(r,t,s,-1))}return Uf(),r=hd(Error(X(421))),Sl(t,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=KT.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,mn=is(s.nextSibling),gn=e,Ze=!0,On=null,t!==null&&(En[Tn++]=hr,En[Tn++]=fr,En[Tn++]=zs,hr=t.id,fr=t.overflow,zs=e),e=Mf(e,r.children),e.flags|=4096,e)}function Mg(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),lh(t.return,e,n)}function fd(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function mw(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Jt(t,e,r.children,n),r=et.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Mg(t,n,e);else if(t.tag===19)Mg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(He(et,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&wc(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),fd(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&wc(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}fd(e,!0,n,null,i);break;case"together":fd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Wl(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Er(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),qs|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(X(153));if(e.child!==null){for(t=e.child,n=cs(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=cs(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function LT(t,e,n){switch(e.tag){case 3:hw(e),$i();break;case 5:$0(e);break;case 1:cn(e.type)&&fc(e);break;case 4:kf(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;He(gc,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(He(et,et.current&1),e.flags|=128,null):n&e.child.childLanes?fw(t,e,n):(He(et,et.current&1),t=Er(t,e,n),t!==null?t.sibling:null);He(et,et.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return mw(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),He(et,et.current),r)break;return null;case 22:case 23:return e.lanes=0,uw(t,e,n)}return Er(t,e,n)}var pw,gh,gw,yw;pw=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};gh=function(){};gw=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Os(Zn.current);var i=null;switch(n){case"input":s=Vd(t,s),r=Vd(t,r),i=[];break;case"select":s=nt({},s,{value:void 0}),r=nt({},r,{value:void 0}),i=[];break;case"textarea":s=Ud(t,s),r=Ud(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=dc)}zd(n,r);var a;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Ja.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var u=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&u!==l&&(u!=null||l!=null))if(d==="style")if(l){for(a in l)!l.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in u)u.hasOwnProperty(a)&&l[a]!==u[a]&&(n||(n={}),n[a]=u[a])}else n||(i||(i=[]),i.push(d,n)),n=u;else d==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,l=l?l.__html:void 0,u!=null&&l!==u&&(i=i||[]).push(d,u)):d==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(d,""+u):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Ja.hasOwnProperty(d)?(u!=null&&d==="onScroll"&&Ye("scroll",t),i||l===u||(i=[])):(i=i||[]).push(d,u))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};yw=function(t,e,n,r){n!==r&&(e.flags|=4)};function Ca(t,e){if(!Ze)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function zt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function OT(t,e,n){var r=e.pendingProps;switch(xf(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zt(e),null;case 1:return cn(e.type)&&hc(),zt(e),null;case 3:return r=e.stateNode,Bi(),Je(ln),Je(Qt),If(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Tl(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,On!==null&&(Th(On),On=null))),gh(t,e),zt(e),null;case 5:Nf(e);var s=Os(uo.current);if(n=e.type,t!==null&&e.stateNode!=null)gw(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(X(166));return zt(e),null}if(t=Os(Zn.current),Tl(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Qn]=e,r[lo]=i,t=(e.mode&1)!==0,n){case"dialog":Ye("cancel",r),Ye("close",r);break;case"iframe":case"object":case"embed":Ye("load",r);break;case"video":case"audio":for(s=0;s<Aa.length;s++)Ye(Aa[s],r);break;case"source":Ye("error",r);break;case"img":case"image":case"link":Ye("error",r),Ye("load",r);break;case"details":Ye("toggle",r);break;case"input":Wp(r,i),Ye("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Ye("invalid",r);break;case"textarea":Hp(r,i),Ye("invalid",r)}zd(n,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&El(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&El(r.textContent,l,t),s=["children",""+l]):Ja.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&Ye("scroll",r)}switch(n){case"input":pl(r),qp(r,i,!0);break;case"textarea":pl(r),Gp(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=dc)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=qv(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[Qn]=e,t[lo]=r,pw(t,e,!1,!1),e.stateNode=t;e:{switch(a=Wd(n,r),n){case"dialog":Ye("cancel",t),Ye("close",t),s=r;break;case"iframe":case"object":case"embed":Ye("load",t),s=r;break;case"video":case"audio":for(s=0;s<Aa.length;s++)Ye(Aa[s],t);s=r;break;case"source":Ye("error",t),s=r;break;case"img":case"image":case"link":Ye("error",t),Ye("load",t),s=r;break;case"details":Ye("toggle",t),s=r;break;case"input":Wp(t,r),s=Vd(t,r),Ye("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=nt({},r,{value:void 0}),Ye("invalid",t);break;case"textarea":Hp(t,r),s=Ud(t,r),Ye("invalid",t);break;default:s=r}zd(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var u=l[i];i==="style"?Kv(t,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&Hv(t,u)):i==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&Za(t,u):typeof u=="number"&&Za(t,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ja.hasOwnProperty(i)?u!=null&&i==="onScroll"&&Ye("scroll",t):u!=null&&sf(t,i,u,a))}switch(n){case"input":pl(t),qp(t,r,!1);break;case"textarea":pl(t),Gp(t);break;case"option":r.value!=null&&t.setAttribute("value",""+ps(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Ni(t,!!r.multiple,i,!1):r.defaultValue!=null&&Ni(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=dc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return zt(e),null;case 6:if(t&&e.stateNode!=null)yw(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(X(166));if(n=Os(uo.current),Os(Zn.current),Tl(e)){if(r=e.stateNode,n=e.memoizedProps,r[Qn]=e,(i=r.nodeValue!==n)&&(t=gn,t!==null))switch(t.tag){case 3:El(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&El(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Qn]=e,e.stateNode=r}return zt(e),null;case 13:if(Je(et),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ze&&mn!==null&&e.mode&1&&!(e.flags&128))M0(),$i(),e.flags|=98560,i=!1;else if(i=Tl(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(X(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(X(317));i[Qn]=e}else $i(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;zt(e),i=!1}else On!==null&&(Th(On),On=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||et.current&1?wt===0&&(wt=3):Uf())),e.updateQueue!==null&&(e.flags|=4),zt(e),null);case 4:return Bi(),gh(t,e),t===null&&ao(e.stateNode.containerInfo),zt(e),null;case 10:return Tf(e.type._context),zt(e),null;case 17:return cn(e.type)&&hc(),zt(e),null;case 19:if(Je(et),i=e.memoizedState,i===null)return zt(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)Ca(i,!1);else{if(wt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=wc(t),a!==null){for(e.flags|=128,Ca(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return He(et,et.current&1|2),e.child}t=t.sibling}i.tail!==null&&ct()>Wi&&(e.flags|=128,r=!0,Ca(i,!1),e.lanes=4194304)}else{if(!r)if(t=wc(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Ca(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!Ze)return zt(e),null}else 2*ct()-i.renderingStartTime>Wi&&n!==1073741824&&(e.flags|=128,r=!0,Ca(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=ct(),e.sibling=null,n=et.current,He(et,r?n&1|2:n&1),e):(zt(e),null);case 22:case 23:return $f(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?fn&1073741824&&(zt(e),e.subtreeFlags&6&&(e.flags|=8192)):zt(e),null;case 24:return null;case 25:return null}throw Error(X(156,e.tag))}function VT(t,e){switch(xf(e),e.tag){case 1:return cn(e.type)&&hc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Bi(),Je(ln),Je(Qt),If(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Nf(e),null;case 13:if(Je(et),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(X(340));$i()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Je(et),null;case 4:return Bi(),null;case 10:return Tf(e.type._context),null;case 22:case 23:return $f(),null;case 24:return null;default:return null}}var kl=!1,Ht=!1,FT=typeof WeakSet=="function"?WeakSet:Set,ie=null;function Ci(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ot(t,e,r)}else n.current=null}function yh(t,e,n){try{n()}catch(r){ot(t,e,r)}}var Lg=!1;function $T(t,e){if(eh=lc,t=b0(),vf(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,u=-1,d=0,f=0,m=t,g=null;t:for(;;){for(var b;m!==n||s!==0&&m.nodeType!==3||(l=a+s),m!==i||r!==0&&m.nodeType!==3||(u=a+r),m.nodeType===3&&(a+=m.nodeValue.length),(b=m.firstChild)!==null;)g=m,m=b;for(;;){if(m===t)break t;if(g===n&&++d===s&&(l=a),g===i&&++f===r&&(u=a),(b=m.nextSibling)!==null)break;m=g,g=m.parentNode}m=b}n=l===-1||u===-1?null:{start:l,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(th={focusedElem:t,selectionRange:n},lc=!1,ie=e;ie!==null;)if(e=ie,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ie=t;else for(;ie!==null;){e=ie;try{var k=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var C=k.memoizedProps,N=k.memoizedState,_=e.stateNode,x=_.getSnapshotBeforeUpdate(e.elementType===e.type?C:Mn(e.type,C),N);_.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var I=e.stateNode.containerInfo;I.nodeType===1?I.textContent="":I.nodeType===9&&I.documentElement&&I.removeChild(I.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(X(163))}}catch(D){ot(e,e.return,D)}if(t=e.sibling,t!==null){t.return=e.return,ie=t;break}ie=e.return}return k=Lg,Lg=!1,k}function Wa(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&yh(e,n,i)}s=s.next}while(s!==r)}}function tu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function vh(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function vw(t){var e=t.alternate;e!==null&&(t.alternate=null,vw(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Qn],delete e[lo],delete e[sh],delete e[bT],delete e[ET])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function ww(t){return t.tag===5||t.tag===3||t.tag===4}function Og(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||ww(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function wh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=dc));else if(r!==4&&(t=t.child,t!==null))for(wh(t,e,n),t=t.sibling;t!==null;)wh(t,e,n),t=t.sibling}function xh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(xh(t,e,n),t=t.sibling;t!==null;)xh(t,e,n),t=t.sibling}var It=null,Ln=!1;function Ur(t,e,n){for(n=n.child;n!==null;)xw(t,e,n),n=n.sibling}function xw(t,e,n){if(Jn&&typeof Jn.onCommitFiberUnmount=="function")try{Jn.onCommitFiberUnmount(Gc,n)}catch{}switch(n.tag){case 5:Ht||Ci(n,e);case 6:var r=It,s=Ln;It=null,Ur(t,e,n),It=r,Ln=s,It!==null&&(Ln?(t=It,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):It.removeChild(n.stateNode));break;case 18:It!==null&&(Ln?(t=It,n=n.stateNode,t.nodeType===8?ad(t.parentNode,n):t.nodeType===1&&ad(t,n),ro(t)):ad(It,n.stateNode));break;case 4:r=It,s=Ln,It=n.stateNode.containerInfo,Ln=!0,Ur(t,e,n),It=r,Ln=s;break;case 0:case 11:case 14:case 15:if(!Ht&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&yh(n,e,a),s=s.next}while(s!==r)}Ur(t,e,n);break;case 1:if(!Ht&&(Ci(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){ot(n,e,l)}Ur(t,e,n);break;case 21:Ur(t,e,n);break;case 22:n.mode&1?(Ht=(r=Ht)||n.memoizedState!==null,Ur(t,e,n),Ht=r):Ur(t,e,n);break;default:Ur(t,e,n)}}function Vg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new FT),e.forEach(function(r){var s=QT.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function jn(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 5:It=l.stateNode,Ln=!1;break e;case 3:It=l.stateNode.containerInfo,Ln=!0;break e;case 4:It=l.stateNode.containerInfo,Ln=!0;break e}l=l.return}if(It===null)throw Error(X(160));xw(i,a,s),It=null,Ln=!1;var u=s.alternate;u!==null&&(u.return=null),s.return=null}catch(d){ot(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)_w(e,t),e=e.sibling}function _w(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(jn(e,t),qn(t),r&4){try{Wa(3,t,t.return),tu(3,t)}catch(C){ot(t,t.return,C)}try{Wa(5,t,t.return)}catch(C){ot(t,t.return,C)}}break;case 1:jn(e,t),qn(t),r&512&&n!==null&&Ci(n,n.return);break;case 5:if(jn(e,t),qn(t),r&512&&n!==null&&Ci(n,n.return),t.flags&32){var s=t.stateNode;try{Za(s,"")}catch(C){ot(t,t.return,C)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,l=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&zv(s,i),Wd(l,a);var d=Wd(l,i);for(a=0;a<u.length;a+=2){var f=u[a],m=u[a+1];f==="style"?Kv(s,m):f==="dangerouslySetInnerHTML"?Hv(s,m):f==="children"?Za(s,m):sf(s,f,m,d)}switch(l){case"input":Fd(s,i);break;case"textarea":Wv(s,i);break;case"select":var g=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var b=i.value;b!=null?Ni(s,!!i.multiple,b,!1):g!==!!i.multiple&&(i.defaultValue!=null?Ni(s,!!i.multiple,i.defaultValue,!0):Ni(s,!!i.multiple,i.multiple?[]:"",!1))}s[lo]=i}catch(C){ot(t,t.return,C)}}break;case 6:if(jn(e,t),qn(t),r&4){if(t.stateNode===null)throw Error(X(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(C){ot(t,t.return,C)}}break;case 3:if(jn(e,t),qn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ro(e.containerInfo)}catch(C){ot(t,t.return,C)}break;case 4:jn(e,t),qn(t);break;case 13:jn(e,t),qn(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Vf=ct())),r&4&&Vg(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(Ht=(d=Ht)||f,jn(e,t),Ht=d):jn(e,t),qn(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!f&&t.mode&1)for(ie=t,f=t.child;f!==null;){for(m=ie=f;ie!==null;){switch(g=ie,b=g.child,g.tag){case 0:case 11:case 14:case 15:Wa(4,g,g.return);break;case 1:Ci(g,g.return);var k=g.stateNode;if(typeof k.componentWillUnmount=="function"){r=g,n=g.return;try{e=r,k.props=e.memoizedProps,k.state=e.memoizedState,k.componentWillUnmount()}catch(C){ot(r,n,C)}}break;case 5:Ci(g,g.return);break;case 22:if(g.memoizedState!==null){$g(m);continue}}b!==null?(b.return=g,ie=b):$g(m)}f=f.sibling}e:for(f=null,m=t;;){if(m.tag===5){if(f===null){f=m;try{s=m.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=m.stateNode,u=m.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,l.style.display=Gv("display",a))}catch(C){ot(t,t.return,C)}}}else if(m.tag===6){if(f===null)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(C){ot(t,t.return,C)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;f===m&&(f=null),m=m.return}f===m&&(f=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:jn(e,t),qn(t),r&4&&Vg(t);break;case 21:break;default:jn(e,t),qn(t)}}function qn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(ww(n)){var r=n;break e}n=n.return}throw Error(X(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Za(s,""),r.flags&=-33);var i=Og(t);xh(t,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,l=Og(t);wh(t,l,a);break;default:throw Error(X(161))}}catch(u){ot(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function UT(t,e,n){ie=t,bw(t)}function bw(t,e,n){for(var r=(t.mode&1)!==0;ie!==null;){var s=ie,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||kl;if(!a){var l=s.alternate,u=l!==null&&l.memoizedState!==null||Ht;l=kl;var d=Ht;if(kl=a,(Ht=u)&&!d)for(ie=s;ie!==null;)a=ie,u=a.child,a.tag===22&&a.memoizedState!==null?Ug(s):u!==null?(u.return=a,ie=u):Ug(s);for(;i!==null;)ie=i,bw(i),i=i.sibling;ie=s,kl=l,Ht=d}Fg(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ie=i):Fg(t)}}function Fg(t){for(;ie!==null;){var e=ie;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ht||tu(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ht)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Mn(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Eg(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Eg(e,a,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var f=d.memoizedState;if(f!==null){var m=f.dehydrated;m!==null&&ro(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(X(163))}Ht||e.flags&512&&vh(e)}catch(g){ot(e,e.return,g)}}if(e===t){ie=null;break}if(n=e.sibling,n!==null){n.return=e.return,ie=n;break}ie=e.return}}function $g(t){for(;ie!==null;){var e=ie;if(e===t){ie=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ie=n;break}ie=e.return}}function Ug(t){for(;ie!==null;){var e=ie;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{tu(4,e)}catch(u){ot(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(u){ot(e,s,u)}}var i=e.return;try{vh(e)}catch(u){ot(e,i,u)}break;case 5:var a=e.return;try{vh(e)}catch(u){ot(e,a,u)}}}catch(u){ot(e,e.return,u)}if(e===t){ie=null;break}var l=e.sibling;if(l!==null){l.return=e.return,ie=l;break}ie=e.return}}var BT=Math.ceil,bc=Ir.ReactCurrentDispatcher,Lf=Ir.ReactCurrentOwner,Sn=Ir.ReactCurrentBatchConfig,Le=0,kt=null,ft=null,Rt=0,fn=0,Si=bs(0),wt=0,po=null,qs=0,nu=0,Of=0,qa=null,sn=null,Vf=0,Wi=1/0,cr=null,Ec=!1,_h=null,os=null,Nl=!1,Zr=null,Tc=0,Ha=0,bh=null,ql=-1,Hl=0;function Zt(){return Le&6?ct():ql!==-1?ql:ql=ct()}function ls(t){return t.mode&1?Le&2&&Rt!==0?Rt&-Rt:CT.transition!==null?(Hl===0&&(Hl=a0()),Hl):(t=Ue,t!==0||(t=window.event,t=t===void 0?16:f0(t.type)),t):1}function Fn(t,e,n,r){if(50<Ha)throw Ha=0,bh=null,Error(X(185));Po(t,n,r),(!(Le&2)||t!==kt)&&(t===kt&&(!(Le&2)&&(nu|=n),wt===4&&Gr(t,Rt)),un(t,r),n===1&&Le===0&&!(e.mode&1)&&(Wi=ct()+500,Jc&&Es()))}function un(t,e){var n=t.callbackNode;CE(t,e);var r=oc(t,t===kt?Rt:0);if(r===0)n!==null&&Yp(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Yp(n),e===1)t.tag===0?TT(Bg.bind(null,t)):R0(Bg.bind(null,t)),xT(function(){!(Le&6)&&Es()}),n=null;else{switch(o0(r)){case 1:n=uf;break;case 4:n=s0;break;case 16:n=ac;break;case 536870912:n=i0;break;default:n=ac}n=Pw(n,Ew.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Ew(t,e){if(ql=-1,Hl=0,Le&6)throw Error(X(327));var n=t.callbackNode;if(ji()&&t.callbackNode!==n)return null;var r=oc(t,t===kt?Rt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Cc(t,r);else{e=r;var s=Le;Le|=2;var i=Cw();(kt!==t||Rt!==e)&&(cr=null,Wi=ct()+500,Fs(t,e));do try{qT();break}catch(l){Tw(t,l)}while(1);Ef(),bc.current=i,Le=s,ft!==null?e=0:(kt=null,Rt=0,e=wt)}if(e!==0){if(e===2&&(s=Qd(t),s!==0&&(r=s,e=Eh(t,s))),e===1)throw n=po,Fs(t,0),Gr(t,r),un(t,ct()),n;if(e===6)Gr(t,r);else{if(s=t.current.alternate,!(r&30)&&!zT(s)&&(e=Cc(t,r),e===2&&(i=Qd(t),i!==0&&(r=i,e=Eh(t,i))),e===1))throw n=po,Fs(t,0),Gr(t,r),un(t,ct()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(X(345));case 2:js(t,sn,cr);break;case 3:if(Gr(t,r),(r&130023424)===r&&(e=Vf+500-ct(),10<e)){if(oc(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Zt(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=rh(js.bind(null,t,sn,cr),e);break}js(t,sn,cr);break;case 4:if(Gr(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var a=31-Vn(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=ct()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*BT(r/1960))-r,10<r){t.timeoutHandle=rh(js.bind(null,t,sn,cr),r);break}js(t,sn,cr);break;case 5:js(t,sn,cr);break;default:throw Error(X(329))}}}return un(t,ct()),t.callbackNode===n?Ew.bind(null,t):null}function Eh(t,e){var n=qa;return t.current.memoizedState.isDehydrated&&(Fs(t,e).flags|=256),t=Cc(t,e),t!==2&&(e=sn,sn=n,e!==null&&Th(e)),t}function Th(t){sn===null?sn=t:sn.push.apply(sn,t)}function zT(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Un(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Gr(t,e){for(e&=~Of,e&=~nu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Vn(e),r=1<<n;t[n]=-1,e&=~r}}function Bg(t){if(Le&6)throw Error(X(327));ji();var e=oc(t,0);if(!(e&1))return un(t,ct()),null;var n=Cc(t,e);if(t.tag!==0&&n===2){var r=Qd(t);r!==0&&(e=r,n=Eh(t,r))}if(n===1)throw n=po,Fs(t,0),Gr(t,e),un(t,ct()),n;if(n===6)throw Error(X(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,js(t,sn,cr),un(t,ct()),null}function Ff(t,e){var n=Le;Le|=1;try{return t(e)}finally{Le=n,Le===0&&(Wi=ct()+500,Jc&&Es())}}function Hs(t){Zr!==null&&Zr.tag===0&&!(Le&6)&&ji();var e=Le;Le|=1;var n=Sn.transition,r=Ue;try{if(Sn.transition=null,Ue=1,t)return t()}finally{Ue=r,Sn.transition=n,Le=e,!(Le&6)&&Es()}}function $f(){fn=Si.current,Je(Si)}function Fs(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,wT(n)),ft!==null)for(n=ft.return;n!==null;){var r=n;switch(xf(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&hc();break;case 3:Bi(),Je(ln),Je(Qt),If();break;case 5:Nf(r);break;case 4:Bi();break;case 13:Je(et);break;case 19:Je(et);break;case 10:Tf(r.type._context);break;case 22:case 23:$f()}n=n.return}if(kt=t,ft=t=cs(t.current,null),Rt=fn=e,wt=0,po=null,Of=nu=qs=0,sn=qa=null,Ls!==null){for(e=0;e<Ls.length;e++)if(n=Ls[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}n.pending=r}Ls=null}return t}function Tw(t,e){do{var n=ft;try{if(Ef(),Bl.current=_c,xc){for(var r=tt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}xc=!1}if(Ws=0,St=vt=tt=null,za=!1,ho=0,Lf.current=null,n===null||n.return===null){wt=1,po=e,ft=null;break}e:{var i=t,a=n.return,l=n,u=e;if(e=Rt,l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var d=u,f=l,m=f.tag;if(!(f.mode&1)&&(m===0||m===11||m===15)){var g=f.alternate;g?(f.updateQueue=g.updateQueue,f.memoizedState=g.memoizedState,f.lanes=g.lanes):(f.updateQueue=null,f.memoizedState=null)}var b=Ig(a);if(b!==null){b.flags&=-257,Pg(b,a,l,i,e),b.mode&1&&Ng(i,d,e),e=b,u=d;var k=e.updateQueue;if(k===null){var C=new Set;C.add(u),e.updateQueue=C}else k.add(u);break e}else{if(!(e&1)){Ng(i,d,e),Uf();break e}u=Error(X(426))}}else if(Ze&&l.mode&1){var N=Ig(a);if(N!==null){!(N.flags&65536)&&(N.flags|=256),Pg(N,a,l,i,e),_f(zi(u,l));break e}}i=u=zi(u,l),wt!==4&&(wt=2),qa===null?qa=[i]:qa.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var _=ow(i,u,e);bg(i,_);break e;case 1:l=u;var x=i.type,I=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(os===null||!os.has(I)))){i.flags|=65536,e&=-e,i.lanes|=e;var D=lw(i,l,e);bg(i,D);break e}}i=i.return}while(i!==null)}kw(n)}catch(F){e=F,ft===n&&n!==null&&(ft=n=n.return);continue}break}while(1)}function Cw(){var t=bc.current;return bc.current=_c,t===null?_c:t}function Uf(){(wt===0||wt===3||wt===2)&&(wt=4),kt===null||!(qs&268435455)&&!(nu&268435455)||Gr(kt,Rt)}function Cc(t,e){var n=Le;Le|=2;var r=Cw();(kt!==t||Rt!==e)&&(cr=null,Fs(t,e));do try{WT();break}catch(s){Tw(t,s)}while(1);if(Ef(),Le=n,bc.current=r,ft!==null)throw Error(X(261));return kt=null,Rt=0,wt}function WT(){for(;ft!==null;)Sw(ft)}function qT(){for(;ft!==null&&!gE();)Sw(ft)}function Sw(t){var e=Iw(t.alternate,t,fn);t.memoizedProps=t.pendingProps,e===null?kw(t):ft=e,Lf.current=null}function kw(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=VT(n,e),n!==null){n.flags&=32767,ft=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{wt=6,ft=null;return}}else if(n=OT(n,e,fn),n!==null){ft=n;return}if(e=e.sibling,e!==null){ft=e;return}ft=e=t}while(e!==null);wt===0&&(wt=5)}function js(t,e,n){var r=Ue,s=Sn.transition;try{Sn.transition=null,Ue=1,HT(t,e,n,r)}finally{Sn.transition=s,Ue=r}return null}function HT(t,e,n,r){do ji();while(Zr!==null);if(Le&6)throw Error(X(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(X(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(SE(t,i),t===kt&&(ft=kt=null,Rt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Nl||(Nl=!0,Pw(ac,function(){return ji(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Sn.transition,Sn.transition=null;var a=Ue;Ue=1;var l=Le;Le|=4,Lf.current=null,$T(t,n),_w(n,t),hT(th),lc=!!eh,th=eh=null,t.current=n,UT(n),yE(),Le=l,Ue=a,Sn.transition=i}else t.current=n;if(Nl&&(Nl=!1,Zr=t,Tc=s),i=t.pendingLanes,i===0&&(os=null),xE(n.stateNode),un(t,ct()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Ec)throw Ec=!1,t=_h,_h=null,t;return Tc&1&&t.tag!==0&&ji(),i=t.pendingLanes,i&1?t===bh?Ha++:(Ha=0,bh=t):Ha=0,Es(),null}function ji(){if(Zr!==null){var t=o0(Tc),e=Sn.transition,n=Ue;try{if(Sn.transition=null,Ue=16>t?16:t,Zr===null)var r=!1;else{if(t=Zr,Zr=null,Tc=0,Le&6)throw Error(X(331));var s=Le;for(Le|=4,ie=t.current;ie!==null;){var i=ie,a=i.child;if(ie.flags&16){var l=i.deletions;if(l!==null){for(var u=0;u<l.length;u++){var d=l[u];for(ie=d;ie!==null;){var f=ie;switch(f.tag){case 0:case 11:case 15:Wa(8,f,i)}var m=f.child;if(m!==null)m.return=f,ie=m;else for(;ie!==null;){f=ie;var g=f.sibling,b=f.return;if(vw(f),f===d){ie=null;break}if(g!==null){g.return=b,ie=g;break}ie=b}}}var k=i.alternate;if(k!==null){var C=k.child;if(C!==null){k.child=null;do{var N=C.sibling;C.sibling=null,C=N}while(C!==null)}}ie=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,ie=a;else e:for(;ie!==null;){if(i=ie,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Wa(9,i,i.return)}var _=i.sibling;if(_!==null){_.return=i.return,ie=_;break e}ie=i.return}}var x=t.current;for(ie=x;ie!==null;){a=ie;var I=a.child;if(a.subtreeFlags&2064&&I!==null)I.return=a,ie=I;else e:for(a=x;ie!==null;){if(l=ie,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:tu(9,l)}}catch(F){ot(l,l.return,F)}if(l===a){ie=null;break e}var D=l.sibling;if(D!==null){D.return=l.return,ie=D;break e}ie=l.return}}if(Le=s,Es(),Jn&&typeof Jn.onPostCommitFiberRoot=="function")try{Jn.onPostCommitFiberRoot(Gc,t)}catch{}r=!0}return r}finally{Ue=n,Sn.transition=e}}return!1}function zg(t,e,n){e=zi(n,e),e=ow(t,e,1),t=as(t,e,1),e=Zt(),t!==null&&(Po(t,1,e),un(t,e))}function ot(t,e,n){if(t.tag===3)zg(t,t,n);else for(;e!==null;){if(e.tag===3){zg(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(os===null||!os.has(r))){t=zi(n,t),t=lw(e,t,1),e=as(e,t,1),t=Zt(),e!==null&&(Po(e,1,t),un(e,t));break}}e=e.return}}function GT(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Zt(),t.pingedLanes|=t.suspendedLanes&n,kt===t&&(Rt&n)===n&&(wt===4||wt===3&&(Rt&130023424)===Rt&&500>ct()-Vf?Fs(t,0):Of|=n),un(t,e)}function Nw(t,e){e===0&&(t.mode&1?(e=vl,vl<<=1,!(vl&130023424)&&(vl=4194304)):e=1);var n=Zt();t=br(t,e),t!==null&&(Po(t,e,n),un(t,n))}function KT(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Nw(t,n)}function QT(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(X(314))}r!==null&&r.delete(e),Nw(t,n)}var Iw;Iw=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||ln.current)on=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return on=!1,LT(t,e,n);on=!!(t.flags&131072)}else on=!1,Ze&&e.flags&1048576&&j0(e,pc,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Wl(t,e),t=e.pendingProps;var s=Fi(e,Qt.current);Ri(e,n),s=Af(null,e,r,t,s,n);var i=Rf();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,cn(r)?(i=!0,fc(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Sf(e),s.updater=eu,e.stateNode=s,s._reactInternals=e,uh(e,r,t,n),e=fh(null,e,r,!0,i,n)):(e.tag=0,Ze&&i&&wf(e),Jt(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Wl(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=XT(r),t=Mn(r,t),s){case 0:e=hh(null,e,r,t,n);break e;case 1:e=jg(null,e,r,t,n);break e;case 11:e=Ag(null,e,r,t,n);break e;case 14:e=Rg(null,e,r,Mn(r.type,t),n);break e}throw Error(X(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Mn(r,s),hh(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Mn(r,s),jg(t,e,r,s,n);case 3:e:{if(hw(e),t===null)throw Error(X(387));r=e.pendingProps,i=e.memoizedState,s=i.element,F0(t,e),vc(e,r,null,n);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=zi(Error(X(423)),e),e=Dg(t,e,r,n,s);break e}else if(r!==s){s=zi(Error(X(424)),e),e=Dg(t,e,r,n,s);break e}else for(mn=is(e.stateNode.containerInfo.firstChild),gn=e,Ze=!0,On=null,n=O0(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if($i(),r===s){e=Er(t,e,n);break e}Jt(t,e,r,n)}e=e.child}return e;case 5:return $0(e),t===null&&oh(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,a=s.children,nh(r,s)?a=null:i!==null&&nh(r,i)&&(e.flags|=32),dw(t,e),Jt(t,e,a,n),e.child;case 6:return t===null&&oh(e),null;case 13:return fw(t,e,n);case 4:return kf(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Ui(e,null,r,n):Jt(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Mn(r,s),Ag(t,e,r,s,n);case 7:return Jt(t,e,e.pendingProps,n),e.child;case 8:return Jt(t,e,e.pendingProps.children,n),e.child;case 12:return Jt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,He(gc,r._currentValue),r._currentValue=a,i!==null)if(Un(i.value,a)){if(i.children===s.children&&!ln.current){e=Er(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var u=l.firstContext;u!==null;){if(u.context===r){if(i.tag===1){u=yr(-1,n&-n),u.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var f=d.pending;f===null?u.next=u:(u.next=f.next,f.next=u),d.pending=u}}i.lanes|=n,u=i.alternate,u!==null&&(u.lanes|=n),lh(i.return,n,e),l.lanes|=n;break}u=u.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(X(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),lh(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Jt(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Ri(e,n),s=kn(s),r=r(s),e.flags|=1,Jt(t,e,r,n),e.child;case 14:return r=e.type,s=Mn(r,e.pendingProps),s=Mn(r.type,s),Rg(t,e,r,s,n);case 15:return cw(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Mn(r,s),Wl(t,e),e.tag=1,cn(r)?(t=!0,fc(e)):t=!1,Ri(e,n),aw(e,r,s),uh(e,r,s,n),fh(null,e,r,!0,t,n);case 19:return mw(t,e,n);case 22:return uw(t,e,n)}throw Error(X(156,e.tag))};function Pw(t,e){return r0(t,e)}function YT(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cn(t,e,n,r){return new YT(t,e,n,r)}function Bf(t){return t=t.prototype,!(!t||!t.isReactComponent)}function XT(t){if(typeof t=="function")return Bf(t)?1:0;if(t!=null){if(t=t.$$typeof,t===of)return 11;if(t===lf)return 14}return 2}function cs(t,e){var n=t.alternate;return n===null?(n=Cn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Gl(t,e,n,r,s,i){var a=2;if(r=t,typeof t=="function")Bf(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case gi:return $s(n.children,s,i,e);case af:a=8,s|=8;break;case Dd:return t=Cn(12,n,e,s|2),t.elementType=Dd,t.lanes=i,t;case Md:return t=Cn(13,n,e,s),t.elementType=Md,t.lanes=i,t;case Ld:return t=Cn(19,n,e,s),t.elementType=Ld,t.lanes=i,t;case $v:return ru(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Vv:a=10;break e;case Fv:a=9;break e;case of:a=11;break e;case lf:a=14;break e;case Wr:a=16,r=null;break e}throw Error(X(130,t==null?t:typeof t,""))}return e=Cn(a,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function $s(t,e,n,r){return t=Cn(7,t,r,e),t.lanes=n,t}function ru(t,e,n,r){return t=Cn(22,t,r,e),t.elementType=$v,t.lanes=n,t.stateNode={isHidden:!1},t}function md(t,e,n){return t=Cn(6,t,null,e),t.lanes=n,t}function pd(t,e,n){return e=Cn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function JT(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Qu(0),this.expirationTimes=Qu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qu(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function zf(t,e,n,r,s,i,a,l,u){return t=new JT(t,e,n,l,u),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Cn(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Sf(i),t}function ZT(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pi,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Aw(t){if(!t)return gs;t=t._reactInternals;e:{if(ei(t)!==t||t.tag!==1)throw Error(X(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(cn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(X(171))}if(t.tag===1){var n=t.type;if(cn(n))return A0(t,n,e)}return e}function Rw(t,e,n,r,s,i,a,l,u){return t=zf(n,r,!0,t,s,i,a,l,u),t.context=Aw(null),n=t.current,r=Zt(),s=ls(n),i=yr(r,s),i.callback=e??null,as(n,i,s),t.current.lanes=s,Po(t,s,r),un(t,r),t}function su(t,e,n,r){var s=e.current,i=Zt(),a=ls(s);return n=Aw(n),e.context===null?e.context=n:e.pendingContext=n,e=yr(i,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=as(s,e,a),t!==null&&(Fn(t,s,a,i),Ul(t,s,a)),a}function Sc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Wg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Wf(t,e){Wg(t,e),(t=t.alternate)&&Wg(t,e)}function e1(){return null}var jw=typeof reportError=="function"?reportError:function(t){console.error(t)};function qf(t){this._internalRoot=t}iu.prototype.render=qf.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(X(409));su(t,e,null,null)};iu.prototype.unmount=qf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Hs(function(){su(null,t,null,null)}),e[_r]=null}};function iu(t){this._internalRoot=t}iu.prototype.unstable_scheduleHydration=function(t){if(t){var e=u0();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Hr.length&&e!==0&&e<Hr[n].priority;n++);Hr.splice(n,0,t),n===0&&h0(t)}};function Hf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function au(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function qg(){}function t1(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=Sc(a);i.call(d)}}var a=Rw(e,r,t,0,null,!1,!1,"",qg);return t._reactRootContainer=a,t[_r]=a.current,ao(t.nodeType===8?t.parentNode:t),Hs(),a}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=Sc(u);l.call(d)}}var u=zf(t,0,!1,null,null,!1,!1,"",qg);return t._reactRootContainer=u,t[_r]=u.current,ao(t.nodeType===8?t.parentNode:t),Hs(function(){su(e,u,n,r)}),u}function ou(t,e,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var l=s;s=function(){var u=Sc(a);l.call(u)}}su(e,a,t,s)}else a=t1(n,e,t,s,r);return Sc(a)}l0=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Pa(e.pendingLanes);n!==0&&(df(e,n|1),un(e,ct()),!(Le&6)&&(Wi=ct()+500,Es()))}break;case 13:Hs(function(){var r=br(t,1);if(r!==null){var s=Zt();Fn(r,t,1,s)}}),Wf(t,1)}};hf=function(t){if(t.tag===13){var e=br(t,134217728);if(e!==null){var n=Zt();Fn(e,t,134217728,n)}Wf(t,134217728)}};c0=function(t){if(t.tag===13){var e=ls(t),n=br(t,e);if(n!==null){var r=Zt();Fn(n,t,e,r)}Wf(t,e)}};u0=function(){return Ue};d0=function(t,e){var n=Ue;try{return Ue=t,e()}finally{Ue=n}};Hd=function(t,e,n){switch(e){case"input":if(Fd(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Xc(r);if(!s)throw Error(X(90));Bv(r),Fd(r,s)}}}break;case"textarea":Wv(t,n);break;case"select":e=n.value,e!=null&&Ni(t,!!n.multiple,e,!1)}};Xv=Ff;Jv=Hs;var n1={usingClientEntryPoint:!1,Events:[Ro,xi,Xc,Qv,Yv,Ff]},Sa={findFiberByHostInstance:Ms,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},r1={bundleType:Sa.bundleType,version:Sa.version,rendererPackageName:Sa.rendererPackageName,rendererConfig:Sa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ir.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=t0(t),t===null?null:t.stateNode},findFiberByHostInstance:Sa.findFiberByHostInstance||e1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Il=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Il.isDisabled&&Il.supportsFiber)try{Gc=Il.inject(r1),Jn=Il}catch{}}xn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=n1;xn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Hf(e))throw Error(X(200));return ZT(t,e,null,n)};xn.createRoot=function(t,e){if(!Hf(t))throw Error(X(299));var n=!1,r="",s=jw;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=zf(t,1,!1,null,null,n,!1,r,s),t[_r]=e.current,ao(t.nodeType===8?t.parentNode:t),new qf(e)};xn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(X(188)):(t=Object.keys(t).join(","),Error(X(268,t)));return t=t0(e),t=t===null?null:t.stateNode,t};xn.flushSync=function(t){return Hs(t)};xn.hydrate=function(t,e,n){if(!au(e))throw Error(X(200));return ou(null,t,e,!0,n)};xn.hydrateRoot=function(t,e,n){if(!Hf(t))throw Error(X(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",a=jw;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=Rw(e,null,t,1,n??null,s,!1,i,a),t[_r]=e.current,ao(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new iu(e)};xn.render=function(t,e,n){if(!au(e))throw Error(X(200));return ou(null,t,e,!1,n)};xn.unmountComponentAtNode=function(t){if(!au(t))throw Error(X(40));return t._reactRootContainer?(Hs(function(){ou(null,null,t,!1,function(){t._reactRootContainer=null,t[_r]=null})}),!0):!1};xn.unstable_batchedUpdates=Ff;xn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!au(n))throw Error(X(200));if(t==null||t._reactInternals===void 0)throw Error(X(38));return ou(t,e,n,!1,r)};xn.version="18.3.1-next-f1338f8080-20240426";function Dw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Dw)}catch(t){console.error(t)}}Dw(),Dv.exports=xn;var s1=Dv.exports,Hg=s1;Rd.createRoot=Hg.createRoot,Rd.hydrateRoot=Hg.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function go(){return go=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},go.apply(this,arguments)}var es;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(es||(es={}));const Gg="popstate";function i1(t){t===void 0&&(t={});function e(r,s){let{pathname:i,search:a,hash:l}=r.location;return Ch("",{pathname:i,search:a,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:kc(s)}return o1(e,n,null,t)}function pt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Mw(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function a1(){return Math.random().toString(36).substr(2,8)}function Kg(t,e){return{usr:t.state,key:t.key,idx:e}}function Ch(t,e,n,r){return n===void 0&&(n=null),go({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?na(e):e,{state:n,key:e&&e.key||r||a1()})}function kc(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function na(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function o1(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,l=es.Pop,u=null,d=f();d==null&&(d=0,a.replaceState(go({},a.state,{idx:d}),""));function f(){return(a.state||{idx:null}).idx}function m(){l=es.Pop;let N=f(),_=N==null?null:N-d;d=N,u&&u({action:l,location:C.location,delta:_})}function g(N,_){l=es.Push;let x=Ch(C.location,N,_);n&&n(x,N),d=f()+1;let I=Kg(x,d),D=C.createHref(x);try{a.pushState(I,"",D)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;s.location.assign(D)}i&&u&&u({action:l,location:C.location,delta:1})}function b(N,_){l=es.Replace;let x=Ch(C.location,N,_);n&&n(x,N),d=f();let I=Kg(x,d),D=C.createHref(x);a.replaceState(I,"",D),i&&u&&u({action:l,location:C.location,delta:0})}function k(N){let _=s.location.origin!=="null"?s.location.origin:s.location.href,x=typeof N=="string"?N:kc(N);return x=x.replace(/ $/,"%20"),pt(_,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,_)}let C={get action(){return l},get location(){return t(s,a)},listen(N){if(u)throw new Error("A history only accepts one active listener");return s.addEventListener(Gg,m),u=N,()=>{s.removeEventListener(Gg,m),u=null}},createHref(N){return e(s,N)},createURL:k,encodeLocation(N){let _=k(N);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:g,replace:b,go(N){return a.go(N)}};return C}var Qg;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Qg||(Qg={}));function l1(t,e,n){return n===void 0&&(n="/"),c1(t,e,n,!1)}function c1(t,e,n,r){let s=typeof e=="string"?na(e):e,i=Gf(s.pathname||"/",n);if(i==null)return null;let a=Lw(t);u1(a);let l=null;for(let u=0;l==null&&u<a.length;++u){let d=_1(i);l=w1(a[u],d,r)}return l}function Lw(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(i,a,l)=>{let u={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};u.relativePath.startsWith("/")&&(pt(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=us([r,u.relativePath]),f=n.concat(u);i.children&&i.children.length>0&&(pt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),Lw(i.children,e,f,d)),!(i.path==null&&!i.index)&&e.push({path:d,score:y1(d,i.index),routesMeta:f})};return t.forEach((i,a)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))s(i,a);else for(let u of Ow(i.path))s(i,a,u)}),e}function Ow(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let a=Ow(r.join("/")),l=[];return l.push(...a.map(u=>u===""?i:[i,u].join("/"))),s&&l.push(...a),l.map(u=>t.startsWith("/")&&u===""?"/":u)}function u1(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:v1(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const d1=/^:[\w-]+$/,h1=3,f1=2,m1=1,p1=10,g1=-2,Yg=t=>t==="*";function y1(t,e){let n=t.split("/"),r=n.length;return n.some(Yg)&&(r+=g1),e&&(r+=f1),n.filter(s=>!Yg(s)).reduce((s,i)=>s+(d1.test(i)?h1:i===""?m1:p1),r)}function v1(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function w1(t,e,n){n===void 0&&(n=!1);let{routesMeta:r}=t,s={},i="/",a=[];for(let l=0;l<r.length;++l){let u=r[l],d=l===r.length-1,f=i==="/"?e:e.slice(i.length)||"/",m=Xg({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},f),g=u.route;if(!m&&d&&n&&!r[r.length-1].route.index&&(m=Xg({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},f)),!m)return null;Object.assign(s,m.params),a.push({params:s,pathname:us([i,m.pathname]),pathnameBase:C1(us([i,m.pathnameBase])),route:g}),m.pathnameBase!=="/"&&(i=us([i,m.pathnameBase]))}return a}function Xg(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=x1(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,f,m)=>{let{paramName:g,isOptional:b}=f;if(g==="*"){let C=l[m]||"";a=i.slice(0,i.length-C.length).replace(/(.)\/+$/,"$1")}const k=l[m];return b&&!k?d[g]=void 0:d[g]=(k||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:a,pattern:t}}function x1(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Mw(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,u)=>(r.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function _1(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Mw(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Gf(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function b1(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?na(t):t;return{pathname:n?n.startsWith("/")?n:E1(n,e):e,search:S1(r),hash:k1(s)}}function E1(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function gd(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function T1(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Vw(t,e){let n=T1(t);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function Fw(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=na(t):(s=go({},t),pt(!s.pathname||!s.pathname.includes("?"),gd("?","pathname","search",s)),pt(!s.pathname||!s.pathname.includes("#"),gd("#","pathname","hash",s)),pt(!s.search||!s.search.includes("#"),gd("#","search","hash",s)));let i=t===""||s.pathname==="",a=i?"/":s.pathname,l;if(a==null)l=n;else{let m=e.length-1;if(!r&&a.startsWith("..")){let g=a.split("/");for(;g[0]==="..";)g.shift(),m-=1;s.pathname=g.join("/")}l=m>=0?e[m]:"/"}let u=b1(s,l),d=a&&a!=="/"&&a.endsWith("/"),f=(i||a===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(d||f)&&(u.pathname+="/"),u}const us=t=>t.join("/").replace(/\/\/+/g,"/"),C1=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),S1=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,k1=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function N1(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const $w=["post","put","patch","delete"];new Set($w);const I1=["get",...$w];new Set(I1);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yo(){return yo=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},yo.apply(this,arguments)}const Kf=A.createContext(null),P1=A.createContext(null),ti=A.createContext(null),lu=A.createContext(null),Ts=A.createContext({outlet:null,matches:[],isDataRoute:!1}),Uw=A.createContext(null);function A1(t,e){let{relative:n}=e===void 0?{}:e;Do()||pt(!1);let{basename:r,navigator:s}=A.useContext(ti),{hash:i,pathname:a,search:l}=zw(t,{relative:n}),u=a;return r!=="/"&&(u=a==="/"?r:us([r,a])),s.createHref({pathname:u,search:l,hash:i})}function Do(){return A.useContext(lu)!=null}function ni(){return Do()||pt(!1),A.useContext(lu).location}function Bw(t){A.useContext(ti).static||A.useLayoutEffect(t)}function Wn(){let{isDataRoute:t}=A.useContext(Ts);return t?W1():R1()}function R1(){Do()||pt(!1);let t=A.useContext(Kf),{basename:e,future:n,navigator:r}=A.useContext(ti),{matches:s}=A.useContext(Ts),{pathname:i}=ni(),a=JSON.stringify(Vw(s,n.v7_relativeSplatPath)),l=A.useRef(!1);return Bw(()=>{l.current=!0}),A.useCallback(function(d,f){if(f===void 0&&(f={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let m=Fw(d,JSON.parse(a),i,f.relative==="path");t==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:us([e,m.pathname])),(f.replace?r.replace:r.push)(m,f.state,f)},[e,r,a,i,t])}function cu(){let{matches:t}=A.useContext(Ts),e=t[t.length-1];return e?e.params:{}}function zw(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=A.useContext(ti),{matches:s}=A.useContext(Ts),{pathname:i}=ni(),a=JSON.stringify(Vw(s,r.v7_relativeSplatPath));return A.useMemo(()=>Fw(t,JSON.parse(a),i,n==="path"),[t,a,i,n])}function j1(t,e){return D1(t,e)}function D1(t,e,n,r){Do()||pt(!1);let{navigator:s}=A.useContext(ti),{matches:i}=A.useContext(Ts),a=i[i.length-1],l=a?a.params:{};a&&a.pathname;let u=a?a.pathnameBase:"/";a&&a.route;let d=ni(),f;if(e){var m;let N=typeof e=="string"?na(e):e;u==="/"||(m=N.pathname)!=null&&m.startsWith(u)||pt(!1),f=N}else f=d;let g=f.pathname||"/",b=g;if(u!=="/"){let N=u.replace(/^\//,"").split("/");b="/"+g.replace(/^\//,"").split("/").slice(N.length).join("/")}let k=l1(t,{pathname:b}),C=F1(k&&k.map(N=>Object.assign({},N,{params:Object.assign({},l,N.params),pathname:us([u,s.encodeLocation?s.encodeLocation(N.pathname).pathname:N.pathname]),pathnameBase:N.pathnameBase==="/"?u:us([u,s.encodeLocation?s.encodeLocation(N.pathnameBase).pathname:N.pathnameBase])})),i,n,r);return e&&C?A.createElement(lu.Provider,{value:{location:yo({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:es.Pop}},C):C}function M1(){let t=z1(),e=N1(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return A.createElement(A.Fragment,null,A.createElement("h2",null,"Unexpected Application Error!"),A.createElement("h3",{style:{fontStyle:"italic"}},e),n?A.createElement("pre",{style:s},n):null,i)}const L1=A.createElement(M1,null);class O1 extends A.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?A.createElement(Ts.Provider,{value:this.props.routeContext},A.createElement(Uw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function V1(t){let{routeContext:e,match:n,children:r}=t,s=A.useContext(Kf);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),A.createElement(Ts.Provider,{value:e},r)}function F1(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var i;if(!n)return null;if(n.errors)t=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let a=t,l=(s=n)==null?void 0:s.errors;if(l!=null){let f=a.findIndex(m=>m.route.id&&(l==null?void 0:l[m.route.id])!==void 0);f>=0||pt(!1),a=a.slice(0,Math.min(a.length,f+1))}let u=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let f=0;f<a.length;f++){let m=a[f];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(d=f),m.route.id){let{loaderData:g,errors:b}=n,k=m.route.loader&&g[m.route.id]===void 0&&(!b||b[m.route.id]===void 0);if(m.route.lazy||k){u=!0,d>=0?a=a.slice(0,d+1):a=[a[0]];break}}}return a.reduceRight((f,m,g)=>{let b,k=!1,C=null,N=null;n&&(b=l&&m.route.id?l[m.route.id]:void 0,C=m.route.errorElement||L1,u&&(d<0&&g===0?(q1("route-fallback",!1),k=!0,N=null):d===g&&(k=!0,N=m.route.hydrateFallbackElement||null)));let _=e.concat(a.slice(0,g+1)),x=()=>{let I;return b?I=C:k?I=N:m.route.Component?I=A.createElement(m.route.Component,null):m.route.element?I=m.route.element:I=f,A.createElement(V1,{match:m,routeContext:{outlet:f,matches:_,isDataRoute:n!=null},children:I})};return n&&(m.route.ErrorBoundary||m.route.errorElement||g===0)?A.createElement(O1,{location:n.location,revalidation:n.revalidation,component:C,error:b,children:x(),routeContext:{outlet:null,matches:_,isDataRoute:!0}}):x()},null)}var Ww=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Ww||{}),Nc=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Nc||{});function $1(t){let e=A.useContext(Kf);return e||pt(!1),e}function U1(t){let e=A.useContext(P1);return e||pt(!1),e}function B1(t){let e=A.useContext(Ts);return e||pt(!1),e}function qw(t){let e=B1(),n=e.matches[e.matches.length-1];return n.route.id||pt(!1),n.route.id}function z1(){var t;let e=A.useContext(Uw),n=U1(Nc.UseRouteError),r=qw(Nc.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function W1(){let{router:t}=$1(Ww.UseNavigateStable),e=qw(Nc.UseNavigateStable),n=A.useRef(!1);return Bw(()=>{n.current=!0}),A.useCallback(function(s,i){i===void 0&&(i={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,yo({fromRouteId:e},i)))},[t,e])}const Jg={};function q1(t,e,n){!e&&!Jg[t]&&(Jg[t]=!0)}function H1(t,e){t==null||t.v7_startTransition,(t==null?void 0:t.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function Dn(t){pt(!1)}function G1(t){let{basename:e="/",children:n=null,location:r,navigationType:s=es.Pop,navigator:i,static:a=!1,future:l}=t;Do()&&pt(!1);let u=e.replace(/^\/*/,"/"),d=A.useMemo(()=>({basename:u,navigator:i,static:a,future:yo({v7_relativeSplatPath:!1},l)}),[u,l,i,a]);typeof r=="string"&&(r=na(r));let{pathname:f="/",search:m="",hash:g="",state:b=null,key:k="default"}=r,C=A.useMemo(()=>{let N=Gf(f,u);return N==null?null:{location:{pathname:N,search:m,hash:g,state:b,key:k},navigationType:s}},[u,f,m,g,b,k,s]);return C==null?null:A.createElement(ti.Provider,{value:d},A.createElement(lu.Provider,{children:n,value:C}))}function K1(t){let{children:e,location:n}=t;return j1(Sh(e),n)}new Promise(()=>{});function Sh(t,e){e===void 0&&(e=[]);let n=[];return A.Children.forEach(t,(r,s)=>{if(!A.isValidElement(r))return;let i=[...e,s];if(r.type===A.Fragment){n.push.apply(n,Sh(r.props.children,i));return}r.type!==Dn&&pt(!1),!r.props.index||!r.props.children||pt(!1);let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Sh(r.props.children,i)),n.push(a)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function kh(){return kh=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},kh.apply(this,arguments)}function Q1(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function Y1(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function X1(t,e){return t.button===0&&(!e||e==="_self")&&!Y1(t)}const J1=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Z1="6";try{window.__reactRouterVersion=Z1}catch{}const eC="startTransition",Zg=Gb[eC];function tC(t){let{basename:e,children:n,future:r,window:s}=t,i=A.useRef();i.current==null&&(i.current=i1({window:s,v5Compat:!0}));let a=i.current,[l,u]=A.useState({action:a.action,location:a.location}),{v7_startTransition:d}=r||{},f=A.useCallback(m=>{d&&Zg?Zg(()=>u(m)):u(m)},[u,d]);return A.useLayoutEffect(()=>a.listen(f),[a,f]),A.useEffect(()=>H1(r),[r]),A.createElement(G1,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:a,future:r})}const nC=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",rC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Kn=A.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:i,replace:a,state:l,target:u,to:d,preventScrollReset:f,viewTransition:m}=e,g=Q1(e,J1),{basename:b}=A.useContext(ti),k,C=!1;if(typeof d=="string"&&rC.test(d)&&(k=d,nC))try{let I=new URL(window.location.href),D=d.startsWith("//")?new URL(I.protocol+d):new URL(d),F=Gf(D.pathname,b);D.origin===I.origin&&F!=null?d=F+D.search+D.hash:C=!0}catch{}let N=A1(d,{relative:s}),_=sC(d,{replace:a,state:l,target:u,preventScrollReset:f,relative:s,viewTransition:m});function x(I){r&&r(I),I.defaultPrevented||_(I)}return A.createElement("a",kh({},g,{href:k||N,onClick:C||i?r:x,ref:n,target:u}))});var ey;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(ey||(ey={}));var ty;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(ty||(ty={}));function sC(t,e){let{target:n,replace:r,state:s,preventScrollReset:i,relative:a,viewTransition:l}=e===void 0?{}:e,u=Wn(),d=ni(),f=zw(t,{relative:a});return A.useCallback(m=>{if(X1(m,n)){m.preventDefault();let g=r!==void 0?r:kc(d)===kc(f);u(t,{replace:g,state:s,preventScrollReset:i,relative:a,viewTransition:l})}},[d,u,f,r,s,n,t,i,a,l])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hw=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},iC=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],a=t[n++],l=t[n++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=t[n++],a=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},Gw={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],a=s+1<t.length,l=a?t[s+1]:0,u=s+2<t.length,d=u?t[s+2]:0,f=i>>2,m=(i&3)<<4|l>>4;let g=(l&15)<<2|d>>6,b=d&63;u||(b=64,a||(g=64)),r.push(n[f],n[m],n[g],n[b])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Hw(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):iC(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const m=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||m==null)throw new aC;const g=i<<2|l>>4;if(r.push(g),d!==64){const b=l<<4&240|d>>2;if(r.push(b),m!==64){const k=d<<6&192|m;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class aC extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const oC=function(t){const e=Hw(t);return Gw.encodeByteArray(e,!0)},Ic=function(t){return oC(t).replace(/\./g,"")},Kw=function(t){try{return Gw.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cC=()=>lC().__FIREBASE_DEFAULTS__,uC=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},dC=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Kw(t[1]);return e&&JSON.parse(e)},uu=()=>{try{return cC()||uC()||dC()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Qw=t=>{var e,n;return(n=(e=uu())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},hC=t=>{const e=Qw(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Yw=()=>{var t;return(t=uu())===null||t===void 0?void 0:t.config},Xw=t=>{var e;return(e=uu())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fC{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mC(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t),l="";return[Ic(JSON.stringify(n)),Ic(JSON.stringify(a)),l].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function pC(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Yt())}function gC(){var t;const e=(t=uu())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function yC(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function vC(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function wC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function xC(){const t=Yt();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function _C(){return!gC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function bC(){try{return typeof indexedDB=="object"}catch{return!1}}function EC(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TC="FirebaseError";class Pr extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=TC,Object.setPrototypeOf(this,Pr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Mo.prototype.create)}}class Mo{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?CC(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new Pr(s,l,r)}}function CC(t,e){return t.replace(SC,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const SC=/\{\$([^}]+)}/g;function kC(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Pc(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],a=e[s];if(ny(i)&&ny(a)){if(!Pc(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function ny(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lo(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Ra(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function ja(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function NC(t,e){const n=new IC(t,e);return n.subscribe.bind(n)}class IC{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");PC(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=yd),s.error===void 0&&(s.error=yd),s.complete===void 0&&(s.complete=yd);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function PC(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function yd(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gt(t){return t&&t._delegate?t._delegate:t}class Gs{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ds="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AC{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new fC;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(jC(e))try{this.getOrInitializeService({instanceIdentifier:Ds})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Ds){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ds){return this.instances.has(e)}getOptions(e=Ds){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,n){var r;const s=this.normalizeInstanceIdentifier(n),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const a=this.instances.get(s);return a&&e(a,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:RC(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ds){return this.component?this.component.multipleInstances?e:Ds:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function RC(t){return t===Ds?void 0:t}function jC(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new AC(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var je;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(je||(je={}));const MC={debug:je.DEBUG,verbose:je.VERBOSE,info:je.INFO,warn:je.WARN,error:je.ERROR,silent:je.SILENT},LC=je.INFO,OC={[je.DEBUG]:"log",[je.VERBOSE]:"log",[je.INFO]:"info",[je.WARN]:"warn",[je.ERROR]:"error"},VC=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=OC[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Qf{constructor(e){this.name=e,this._logLevel=LC,this._logHandler=VC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in je))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?MC[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,je.DEBUG,...e),this._logHandler(this,je.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,je.VERBOSE,...e),this._logHandler(this,je.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,je.INFO,...e),this._logHandler(this,je.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,je.WARN,...e),this._logHandler(this,je.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,je.ERROR,...e),this._logHandler(this,je.ERROR,...e)}}const FC=(t,e)=>e.some(n=>t instanceof n);let ry,sy;function $C(){return ry||(ry=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function UC(){return sy||(sy=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Jw=new WeakMap,Nh=new WeakMap,Zw=new WeakMap,vd=new WeakMap,Yf=new WeakMap;function BC(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",a)},i=()=>{n(ds(t.result)),s()},a=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",a)});return e.then(n=>{n instanceof IDBCursor&&Jw.set(n,t)}).catch(()=>{}),Yf.set(e,t),e}function zC(t){if(Nh.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",a),t.removeEventListener("abort",a)},i=()=>{n(),s()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",a),t.addEventListener("abort",a)});Nh.set(t,e)}let Ih={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Nh.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Zw.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ds(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function WC(t){Ih=t(Ih)}function qC(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(wd(this),e,...n);return Zw.set(r,e.sort?e.sort():[e]),ds(r)}:UC().includes(t)?function(...e){return t.apply(wd(this),e),ds(Jw.get(this))}:function(...e){return ds(t.apply(wd(this),e))}}function HC(t){return typeof t=="function"?qC(t):(t instanceof IDBTransaction&&zC(t),FC(t,$C())?new Proxy(t,Ih):t)}function ds(t){if(t instanceof IDBRequest)return BC(t);if(vd.has(t))return vd.get(t);const e=HC(t);return e!==t&&(vd.set(t,e),Yf.set(e,t)),e}const wd=t=>Yf.get(t);function GC(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(t,e),l=ds(a);return r&&a.addEventListener("upgradeneeded",u=>{r(ds(a.result),u.oldVersion,u.newVersion,ds(a.transaction),u)}),n&&a.addEventListener("blocked",u=>n(u.oldVersion,u.newVersion,u)),l.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const KC=["get","getKey","getAll","getAllKeys","count"],QC=["put","add","delete","clear"],xd=new Map;function iy(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(xd.get(e))return xd.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=QC.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||KC.includes(n)))return;const i=async function(a,...l){const u=this.transaction(a,s?"readwrite":"readonly");let d=u.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&u.done]))[0]};return xd.set(e,i),i}WC(t=>({...t,get:(e,n,r)=>iy(e,n)||t.get(e,n,r),has:(e,n)=>!!iy(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(XC(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function XC(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Ph="@firebase/app",ay="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tr=new Qf("@firebase/app"),JC="@firebase/app-compat",ZC="@firebase/analytics-compat",eS="@firebase/analytics",tS="@firebase/app-check-compat",nS="@firebase/app-check",rS="@firebase/auth",sS="@firebase/auth-compat",iS="@firebase/database",aS="@firebase/data-connect",oS="@firebase/database-compat",lS="@firebase/functions",cS="@firebase/functions-compat",uS="@firebase/installations",dS="@firebase/installations-compat",hS="@firebase/messaging",fS="@firebase/messaging-compat",mS="@firebase/performance",pS="@firebase/performance-compat",gS="@firebase/remote-config",yS="@firebase/remote-config-compat",vS="@firebase/storage",wS="@firebase/storage-compat",xS="@firebase/firestore",_S="@firebase/vertexai-preview",bS="@firebase/firestore-compat",ES="firebase",TS="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ah="[DEFAULT]",CS={[Ph]:"fire-core",[JC]:"fire-core-compat",[eS]:"fire-analytics",[ZC]:"fire-analytics-compat",[nS]:"fire-app-check",[tS]:"fire-app-check-compat",[rS]:"fire-auth",[sS]:"fire-auth-compat",[iS]:"fire-rtdb",[aS]:"fire-data-connect",[oS]:"fire-rtdb-compat",[lS]:"fire-fn",[cS]:"fire-fn-compat",[uS]:"fire-iid",[dS]:"fire-iid-compat",[hS]:"fire-fcm",[fS]:"fire-fcm-compat",[mS]:"fire-perf",[pS]:"fire-perf-compat",[gS]:"fire-rc",[yS]:"fire-rc-compat",[vS]:"fire-gcs",[wS]:"fire-gcs-compat",[xS]:"fire-fst",[bS]:"fire-fst-compat",[_S]:"fire-vertex","fire-js":"fire-js",[ES]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ac=new Map,SS=new Map,Rh=new Map;function oy(t,e){try{t.container.addComponent(e)}catch(n){Tr.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function qi(t){const e=t.name;if(Rh.has(e))return Tr.debug(`There were multiple attempts to register component ${e}.`),!1;Rh.set(e,t);for(const n of Ac.values())oy(n,t);for(const n of SS.values())oy(n,t);return!0}function Xf(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Xn(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},hs=new Mo("app","Firebase",kS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NS{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Gs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw hs.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ra=TS;function ex(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Ah,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw hs.create("bad-app-name",{appName:String(s)});if(n||(n=Yw()),!n)throw hs.create("no-options");const i=Ac.get(s);if(i){if(Pc(n,i.options)&&Pc(r,i.config))return i;throw hs.create("duplicate-app",{appName:s})}const a=new DC(s);for(const u of Rh.values())a.addComponent(u);const l=new NS(n,r,a);return Ac.set(s,l),l}function tx(t=Ah){const e=Ac.get(t);if(!e&&t===Ah&&Yw())return ex();if(!e)throw hs.create("no-app",{appName:t});return e}function fs(t,e,n){var r;let s=(r=CS[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const l=[`Unable to register library "${s}" with version "${e}":`];i&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Tr.warn(l.join(" "));return}qi(new Gs(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IS="firebase-heartbeat-database",PS=1,vo="firebase-heartbeat-store";let _d=null;function nx(){return _d||(_d=GC(IS,PS,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(vo)}catch(n){console.warn(n)}}}}).catch(t=>{throw hs.create("idb-open",{originalErrorMessage:t.message})})),_d}async function AS(t){try{const n=(await nx()).transaction(vo),r=await n.objectStore(vo).get(rx(t));return await n.done,r}catch(e){if(e instanceof Pr)Tr.warn(e.message);else{const n=hs.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Tr.warn(n.message)}}}async function ly(t,e){try{const r=(await nx()).transaction(vo,"readwrite");await r.objectStore(vo).put(e,rx(t)),await r.done}catch(n){if(n instanceof Pr)Tr.warn(n.message);else{const r=hs.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Tr.warn(r.message)}}}function rx(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RS=1024,jS=30*24*60*60*1e3;class DS{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new LS(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=cy();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const l=new Date(a.date).valueOf();return Date.now()-l<=jS}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Tr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=cy(),{heartbeatsToSend:r,unsentEntries:s}=MS(this._heartbeatsCache.heartbeats),i=Ic(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Tr.warn(n),""}}}function cy(){return new Date().toISOString().substring(0,10)}function MS(t,e=RS){const n=[];let r=t.slice();for(const s of t){const i=n.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),uy(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),uy(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class LS{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return bC()?EC().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await AS(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return ly(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return ly(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function uy(t){return Ic(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OS(t){qi(new Gs("platform-logger",e=>new YC(e),"PRIVATE")),qi(new Gs("heartbeat",e=>new DS(e),"PRIVATE")),fs(Ph,ay,t),fs(Ph,ay,"esm2017"),fs("fire-js","")}OS("");function Jf(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function sx(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const VS=sx,ix=new Mo("auth","Firebase",sx());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rc=new Qf("@firebase/auth");function FS(t,...e){Rc.logLevel<=je.WARN&&Rc.warn(`Auth (${ra}): ${t}`,...e)}function Kl(t,...e){Rc.logLevel<=je.ERROR&&Rc.error(`Auth (${ra}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bn(t,...e){throw Zf(t,...e)}function er(t,...e){return Zf(t,...e)}function ax(t,e,n){const r=Object.assign(Object.assign({},VS()),{[e]:n});return new Mo("auth","Firebase",r).create(e,{appName:t.name})}function vr(t){return ax(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Zf(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return ix.create(t,...e)}function fe(t,e,...n){if(!t)throw Zf(e,...n)}function mr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Kl(e),new Error(e)}function Cr(t,e){t||mr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jh(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function $S(){return dy()==="http:"||dy()==="https:"}function dy(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function US(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&($S()||vC()||"connection"in navigator)?navigator.onLine:!0}function BS(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oo{constructor(e,n){this.shortDelay=e,this.longDelay=n,Cr(n>e,"Short delay should be less than long delay!"),this.isMobile=pC()||wC()}get(){return US()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function em(t,e){Cr(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ox{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;mr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;mr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;mr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zS={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WS=new Oo(3e4,6e4);function Ar(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Rr(t,e,n,r,s={}){return lx(t,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=Lo(Object.assign({key:t.config.apiKey},a)).slice(1),u=await t._getAdditionalHeaders();u["Content-Type"]="application/json",t.languageCode&&(u["X-Firebase-Locale"]=t.languageCode);const d=Object.assign({method:e,headers:u},i);return yC()||(d.referrerPolicy="no-referrer"),ox.fetch()(cx(t,t.config.apiHost,n,l),d)})}async function lx(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},zS),e);try{const s=new HS(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Pl(t,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[u,d]=l.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Pl(t,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw Pl(t,"email-already-in-use",a);if(u==="USER_DISABLED")throw Pl(t,"user-disabled",a);const f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw ax(t,f,d);Bn(t,f)}}catch(s){if(s instanceof Pr)throw s;Bn(t,"network-request-failed",{message:String(s)})}}async function Vo(t,e,n,r,s={}){const i=await Rr(t,e,n,r,s);return"mfaPendingCredential"in i&&Bn(t,"multi-factor-auth-required",{_serverResponse:i}),i}function cx(t,e,n,r){const s=`${e}${n}?${r}`;return t.config.emulator?em(t.config,s):`${t.config.apiScheme}://${s}`}function qS(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class HS{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(er(this.auth,"network-request-failed")),WS.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Pl(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=er(t,e,r);return s.customData._tokenResponse=n,s}function hy(t){return t!==void 0&&t.enterprise!==void 0}class GS{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return qS(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function KS(t,e){return Rr(t,"GET","/v2/recaptchaConfig",Ar(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QS(t,e){return Rr(t,"POST","/v1/accounts:delete",e)}async function ux(t,e){return Rr(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ga(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function YS(t,e=!1){const n=gt(t),r=await n.getIdToken(e),s=tm(r);fe(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Ga(bd(s.auth_time)),issuedAtTime:Ga(bd(s.iat)),expirationTime:Ga(bd(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function bd(t){return Number(t)*1e3}function tm(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Kl("JWT malformed, contained fewer than 3 sections"),null;try{const s=Kw(n);return s?JSON.parse(s):(Kl("Failed to decode base64 JWT payload"),null)}catch(s){return Kl("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function fy(t){const e=tm(t);return fe(e,"internal-error"),fe(typeof e.exp<"u","internal-error"),fe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wo(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Pr&&XS(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function XS({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JS{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ga(this.lastLoginAt),this.creationTime=Ga(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jc(t){var e;const n=t.auth,r=await t.getIdToken(),s=await wo(t,ux(n,{idToken:r}));fe(s==null?void 0:s.users.length,n,"internal-error");const i=s.users[0];t._notifyReloadListener(i);const a=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?dx(i.providerUserInfo):[],l=ek(t.providerData,a),u=t.isAnonymous,d=!(t.email&&i.passwordHash)&&!(l!=null&&l.length),f=u?d:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new Dh(i.createdAt,i.lastLoginAt),isAnonymous:f};Object.assign(t,m)}async function ZS(t){const e=gt(t);await jc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function ek(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function dx(t){return t.map(e=>{var{providerId:n}=e,r=Jf(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tk(t,e){const n=await lx(t,{},async()=>{const r=Lo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,a=cx(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",ox.fetch()(a,{method:"POST",headers:l,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function nk(t,e){return Rr(t,"POST","/v2/accounts:revokeToken",Ar(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){fe(e.idToken,"internal-error"),fe(typeof e.idToken<"u","internal-error"),fe(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):fy(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){fe(e.length!==0,"internal-error");const n=fy(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(fe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await tk(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,a=new Di;return r&&(fe(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(fe(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(fe(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Di,this.toJSON())}_performRefresh(){return mr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Br(t,e){fe(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class pr{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,i=Jf(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new JS(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Dh(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await wo(this,this.stsTokenManager.getToken(this.auth,e));return fe(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return YS(this,e)}reload(){return ZS(this)}_assign(e){this!==e&&(fe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new pr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){fe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await jc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Xn(this.auth.app))return Promise.reject(vr(this.auth));const e=await this.getIdToken();return await wo(this,QS(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,i,a,l,u,d,f;const m=(r=n.displayName)!==null&&r!==void 0?r:void 0,g=(s=n.email)!==null&&s!==void 0?s:void 0,b=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,k=(a=n.photoURL)!==null&&a!==void 0?a:void 0,C=(l=n.tenantId)!==null&&l!==void 0?l:void 0,N=(u=n._redirectEventId)!==null&&u!==void 0?u:void 0,_=(d=n.createdAt)!==null&&d!==void 0?d:void 0,x=(f=n.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:I,emailVerified:D,isAnonymous:F,providerData:q,stsTokenManager:v}=n;fe(I&&v,e,"internal-error");const y=Di.fromJSON(this.name,v);fe(typeof I=="string",e,"internal-error"),Br(m,e.name),Br(g,e.name),fe(typeof D=="boolean",e,"internal-error"),fe(typeof F=="boolean",e,"internal-error"),Br(b,e.name),Br(k,e.name),Br(C,e.name),Br(N,e.name),Br(_,e.name),Br(x,e.name);const S=new pr({uid:I,auth:e,email:g,emailVerified:D,displayName:m,isAnonymous:F,photoURL:k,phoneNumber:b,tenantId:C,stsTokenManager:y,createdAt:_,lastLoginAt:x});return q&&Array.isArray(q)&&(S.providerData=q.map(P=>Object.assign({},P))),N&&(S._redirectEventId=N),S}static async _fromIdTokenResponse(e,n,r=!1){const s=new Di;s.updateFromServerResponse(n);const i=new pr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await jc(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];fe(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?dx(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new Di;l.updateFromIdToken(r);const u=new pr({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Dh(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(u,d),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const my=new Map;function gr(t){Cr(t instanceof Function,"Expected a class definition");let e=my.get(t);return e?(Cr(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,my.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hx{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}hx.type="NONE";const py=hx;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ql(t,e,n){return`firebase:${t}:${e}:${n}`}class Mi{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Ql(this.userKey,s.apiKey,i),this.fullPersistenceKey=Ql("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?pr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Mi(gr(py),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||gr(py);const a=Ql(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const f=await d._get(a);if(f){const m=pr._fromJSON(e,f);d!==i&&(l=m),i=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new Mi(i,e,r):(i=u[0],l&&await i._set(a,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new Mi(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gy(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(gx(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(fx(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(vx(e))return"Blackberry";if(wx(e))return"Webos";if(mx(e))return"Safari";if((e.includes("chrome/")||px(e))&&!e.includes("edge/"))return"Chrome";if(yx(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function fx(t=Yt()){return/firefox\//i.test(t)}function mx(t=Yt()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function px(t=Yt()){return/crios\//i.test(t)}function gx(t=Yt()){return/iemobile/i.test(t)}function yx(t=Yt()){return/android/i.test(t)}function vx(t=Yt()){return/blackberry/i.test(t)}function wx(t=Yt()){return/webos/i.test(t)}function nm(t=Yt()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function rk(t=Yt()){var e;return nm(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function sk(){return xC()&&document.documentMode===10}function xx(t=Yt()){return nm(t)||yx(t)||wx(t)||vx(t)||/windows phone/i.test(t)||gx(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _x(t,e=[]){let n;switch(t){case"Browser":n=gy(Yt());break;case"Worker":n=`${gy(Yt())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${ra}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((a,l)=>{try{const u=e(i);a(u)}catch(u){l(u)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ak(t,e={}){return Rr(t,"GET","/v2/passwordPolicy",Ar(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ok=6;class lk{constructor(e){var n,r,s,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=a.minPasswordLength)!==null&&n!==void 0?n:ok,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,s,i,a,l;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(n=u.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(s=u.containsLowercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(i=u.containsUppercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(a=u.containsNumericCharacter)!==null&&a!==void 0?a:!0),u.isValid&&(u.isValid=(l=u.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),u}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new yy(this),this.idTokenSubscription=new yy(this),this.beforeStateQueue=new ik(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ix,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=gr(n)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Mi.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await ux(this,{idToken:e}),r=await pr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(Xn(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(l,l))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,l=s==null?void 0:s._redirectEventId,u=await this.tryRedirectSignIn(e);(!a||a===l)&&(u!=null&&u.user)&&(s=u.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return fe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await jc(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=BS()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Xn(this.app))return Promise.reject(vr(this));const n=e?gt(e):null;return n&&fe(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&fe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Xn(this.app)?Promise.reject(vr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Xn(this.app)?Promise.reject(vr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(gr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await ak(this),n=new lk(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Mo("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await nk(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&gr(e)||this._popupRedirectResolver;fe(n,this,"argument-error"),this.redirectPersistenceManager=await Mi.create(this,[gr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(fe(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof n=="function"){const u=e.addObserver(n,r,s);return()=>{a=!0,u()}}else{const u=e.addObserver(n);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return fe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=_x(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&FS(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function ri(t){return gt(t)}class yy{constructor(e){this.auth=e,this.observer=null,this.addObserver=NC(n=>this.observer=n)}get next(){return fe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let du={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function uk(t){du=t}function bx(t){return du.loadJS(t)}function dk(){return du.recaptchaEnterpriseScript}function hk(){return du.gapiScript}function fk(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const mk="recaptcha-enterprise",pk="NO_RECAPTCHA";class gk{constructor(e){this.type=mk,this.auth=ri(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,l)=>{KS(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new GS(u);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(u=>{l(u)})})}function s(i,a,l){const u=window.grecaptcha;hy(u)?u.enterprise.ready(()=>{u.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(pk)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,a)=>{r(this.auth).then(l=>{if(!n&&hy(window.grecaptcha))s(l,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=dk();u.length!==0&&(u+=l),bx(u).then(()=>{s(l,i,a)}).catch(d=>{a(d)})}}).catch(l=>{a(l)})})}}async function vy(t,e,n,r=!1){const s=new gk(t);let i;try{i=await s.verify(n)}catch{i=await s.verify(n,!0)}const a=Object.assign({},e);return r?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Mh(t,e,n,r){var s;if(!((s=t._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await vy(t,e,n,n==="getOobCode");return r(t,i)}else return r(t,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await vy(t,e,n,n==="getOobCode");return r(t,a)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yk(t,e){const n=Xf(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Pc(i,e??{}))return s;Bn(s,"already-initialized")}return n.initialize({options:e})}function vk(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(gr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function wk(t,e,n){const r=ri(t);fe(r._canInitEmulator,r,"emulator-config-failed"),fe(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(n!=null&&n.disableWarnings),i=Ex(e),{host:a,port:l}=xk(e),u=l===null?"":`:${l}`;r.config.emulator={url:`${i}//${a}${u}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||_k()}function Ex(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function xk(t){const e=Ex(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:wy(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:wy(a)}}}function wy(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function _k(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return mr("not implemented")}_getIdTokenResponse(e){return mr("not implemented")}_linkToIdToken(e,n){return mr("not implemented")}_getReauthenticationResolver(e){return mr("not implemented")}}async function bk(t,e){return Rr(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ek(t,e){return Vo(t,"POST","/v1/accounts:signInWithPassword",Ar(t,e))}async function Tk(t,e){return Rr(t,"POST","/v1/accounts:sendOobCode",Ar(t,e))}async function Ck(t,e){return Tk(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sk(t,e){return Vo(t,"POST","/v1/accounts:signInWithEmailLink",Ar(t,e))}async function kk(t,e){return Vo(t,"POST","/v1/accounts:signInWithEmailLink",Ar(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo extends rm{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new xo(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new xo(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Mh(e,n,"signInWithPassword",Ek);case"emailLink":return Sk(e,{email:this._email,oobCode:this._password});default:Bn(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Mh(e,r,"signUpPassword",bk);case"emailLink":return kk(e,{idToken:n,email:this._email,oobCode:this._password});default:Bn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Li(t,e){return Vo(t,"POST","/v1/accounts:signInWithIdp",Ar(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk="http://localhost";class Ks extends rm{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Ks(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Bn("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,i=Jf(n,["providerId","signInMethod"]);if(!r||!s)return null;const a=new Ks(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const n=this.buildRequest();return Li(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Li(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Li(e,n)}buildRequest(){const e={requestUri:Nk,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Lo(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ik(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Pk(t){const e=Ra(ja(t)).link,n=e?Ra(ja(e)).deep_link_id:null,r=Ra(ja(t)).deep_link_id;return(r?Ra(ja(r)).link:null)||r||n||e||t}class sm{constructor(e){var n,r,s,i,a,l;const u=Ra(ja(e)),d=(n=u.apiKey)!==null&&n!==void 0?n:null,f=(r=u.oobCode)!==null&&r!==void 0?r:null,m=Ik((s=u.mode)!==null&&s!==void 0?s:null);fe(d&&f&&m,"argument-error"),this.apiKey=d,this.operation=m,this.code=f,this.continueUrl=(i=u.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(a=u.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(l=u.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const n=Pk(e);try{return new sm(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(){this.providerId=sa.PROVIDER_ID}static credential(e,n){return xo._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=sm.parseLink(n);return fe(r,"argument-error"),xo._fromEmailAndCode(e,r.code,r.tenantId)}}sa.PROVIDER_ID="password";sa.EMAIL_PASSWORD_SIGN_IN_METHOD="password";sa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tx{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo extends Tx{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kr extends Fo{constructor(){super("facebook.com")}static credential(e){return Ks._fromParams({providerId:Kr.PROVIDER_ID,signInMethod:Kr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Kr.credentialFromTaggedObject(e)}static credentialFromError(e){return Kr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Kr.credential(e.oauthAccessToken)}catch{return null}}}Kr.FACEBOOK_SIGN_IN_METHOD="facebook.com";Kr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qr extends Fo{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Ks._fromParams({providerId:Qr.PROVIDER_ID,signInMethod:Qr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Qr.credentialFromTaggedObject(e)}static credentialFromError(e){return Qr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Qr.credential(n,r)}catch{return null}}}Qr.GOOGLE_SIGN_IN_METHOD="google.com";Qr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yr extends Fo{constructor(){super("github.com")}static credential(e){return Ks._fromParams({providerId:Yr.PROVIDER_ID,signInMethod:Yr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Yr.credentialFromTaggedObject(e)}static credentialFromError(e){return Yr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Yr.credential(e.oauthAccessToken)}catch{return null}}}Yr.GITHUB_SIGN_IN_METHOD="github.com";Yr.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xr extends Fo{constructor(){super("twitter.com")}static credential(e,n){return Ks._fromParams({providerId:Xr.PROVIDER_ID,signInMethod:Xr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Xr.credentialFromTaggedObject(e)}static credentialFromError(e){return Xr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Xr.credential(n,r)}catch{return null}}}Xr.TWITTER_SIGN_IN_METHOD="twitter.com";Xr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ak(t,e){return Vo(t,"POST","/v1/accounts:signUp",Ar(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await pr._fromIdTokenResponse(e,r,s),a=xy(r);return new Qs({user:i,providerId:a,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=xy(r);return new Qs({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function xy(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dc extends Pr{constructor(e,n,r,s){var i;super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Dc.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new Dc(e,n,r,s)}}function Cx(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Dc._fromErrorAndOperation(t,i,e,r):i})}async function Rk(t,e,n=!1){const r=await wo(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Qs._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jk(t,e,n=!1){const{auth:r}=t;if(Xn(r.app))return Promise.reject(vr(r));const s="reauthenticate";try{const i=await wo(t,Cx(r,s,e,t),n);fe(i.idToken,r,"internal-error");const a=tm(i.idToken);fe(a,r,"internal-error");const{sub:l}=a;return fe(t.uid===l,r,"user-mismatch"),Qs._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Bn(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sx(t,e,n=!1){if(Xn(t.app))return Promise.reject(vr(t));const r="signIn",s=await Cx(t,r,e),i=await Qs._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function Dk(t,e){return Sx(ri(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mk(t,e,n){var r;fe(((r=n.url)===null||r===void 0?void 0:r.length)>0,t,"invalid-continue-uri"),fe(typeof n.dynamicLinkDomain>"u"||n.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=n.url,e.dynamicLinkDomain=n.dynamicLinkDomain,e.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(fe(n.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=n.iOS.bundleId),n.android&&(fe(n.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=n.android.installApp,e.androidMinimumVersionCode=n.android.minimumVersion,e.androidPackageName=n.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kx(t){const e=ri(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Lk(t,e,n){if(Xn(t.app))return Promise.reject(vr(t));const r=ri(t),a=await Mh(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ak).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&kx(t),u}),l=await Qs._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function Ok(t,e,n){return Xn(t.app)?Promise.reject(vr(t)):Dk(gt(t),sa.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&kx(t),r})}async function Vk(t,e){const n=gt(t),s={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()};e&&Mk(n.auth,s,e);const{email:i}=await Ck(n.auth,s);i!==t.email&&await t.reload()}function Fk(t,e,n,r){return gt(t).onIdTokenChanged(e,n,r)}function $k(t,e,n){return gt(t).beforeAuthStateChanged(e,n)}function Uk(t,e,n,r){return gt(t).onAuthStateChanged(e,n,r)}function Nx(t){return gt(t).signOut()}const Mc="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ix{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Mc,"1"),this.storage.removeItem(Mc),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bk=1e3,zk=10;class Px extends Ix{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=xx(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((a,l,u)=>{this.notifyListeners(a,u)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!n&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);sk()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,zk):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},Bk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}Px.type="LOCAL";const Wk=Px;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ax extends Ix{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}Ax.type="SESSION";const Rx=Ax;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qk(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new hu(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(n.origin,i)),u=await qk(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}hu.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function im(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,u)=>{const d=im("",20);s.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(m){const g=m;if(g.data.eventId===d)switch(g.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(g.data.response);break;default:clearTimeout(f),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tr(){return window}function Gk(t){tr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jx(){return typeof tr().WorkerGlobalScope<"u"&&typeof tr().importScripts=="function"}async function Kk(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Qk(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function Yk(){return jx()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dx="firebaseLocalStorageDb",Xk=1,Lc="firebaseLocalStorage",Mx="fbase_key";class $o{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function fu(t,e){return t.transaction([Lc],e?"readwrite":"readonly").objectStore(Lc)}function Jk(){const t=indexedDB.deleteDatabase(Dx);return new $o(t).toPromise()}function Lh(){const t=indexedDB.open(Dx,Xk);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Lc,{keyPath:Mx})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Lc)?e(r):(r.close(),await Jk(),e(await Lh()))})})}async function _y(t,e,n){const r=fu(t,!0).put({[Mx]:e,value:n});return new $o(r).toPromise()}async function Zk(t,e){const n=fu(t,!1).get(e),r=await new $o(n).toPromise();return r===void 0?null:r.value}function by(t,e){const n=fu(t,!0).delete(e);return new $o(n).toPromise()}const eN=800,tN=3;class Lx{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Lh(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>tN)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return jx()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=hu._getInstance(Yk()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await Kk(),!this.activeServiceWorker)return;this.sender=new Hk(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Qk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Lh();return await _y(e,Mc,"1"),await by(e,Mc),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>_y(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>Zk(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>by(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=fu(s,!1).getAll();return new $o(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),eN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Lx.type="LOCAL";const nN=Lx;new Oo(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rN(t,e){return e?gr(e):(fe(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am extends rm{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Li(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Li(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Li(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function sN(t){return Sx(t.auth,new am(t),t.bypassAuthState)}function iN(t){const{auth:e,user:n}=t;return fe(n,e,"internal-error"),jk(n,new am(t),t.bypassAuthState)}async function aN(t){const{auth:e,user:n}=t;return fe(n,e,"internal-error"),Rk(n,new am(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ox{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return sN;case"linkViaPopup":case"linkViaRedirect":return aN;case"reauthViaPopup":case"reauthViaRedirect":return iN;default:Bn(this.auth,"internal-error")}}resolve(e){Cr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Cr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oN=new Oo(2e3,1e4);class ki extends Ox{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,ki.currentPopupAction&&ki.currentPopupAction.cancel(),ki.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return fe(e,this.auth,"internal-error"),e}async onExecution(){Cr(this.filter.length===1,"Popup operations only handle one event");const e=im();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(er(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(er(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ki.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(er(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,oN.get())};e()}}ki.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lN="pendingRedirect",Yl=new Map;class cN extends Ox{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Yl.get(this.auth._key());if(!e){try{const r=await uN(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Yl.set(this.auth._key(),e)}return this.bypassAuthState||Yl.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function uN(t,e){const n=fN(e),r=hN(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function dN(t,e){Yl.set(t._key(),e)}function hN(t){return gr(t._redirectPersistence)}function fN(t){return Ql(lN,t.config.apiKey,t.name)}async function mN(t,e,n=!1){if(Xn(t.app))return Promise.reject(vr(t));const r=ri(t),s=rN(r,e),a=await new cN(r,s,n).execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pN=10*60*1e3;class gN{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!yN(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!Vx(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(er(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=pN&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ey(e))}saveEventToCache(e){this.cachedEventUids.add(Ey(e)),this.lastProcessedEventTime=Date.now()}}function Ey(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Vx({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function yN(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Vx(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vN(t,e={}){return Rr(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wN=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,xN=/^https?/;async function _N(t){if(t.config.emulator)return;const{authorizedDomains:e}=await vN(t);for(const n of e)try{if(bN(n))return}catch{}Bn(t,"unauthorized-domain")}function bN(t){const e=jh(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&a.hostname===r}if(!xN.test(n))return!1;if(wN.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EN=new Oo(3e4,6e4);function Ty(){const t=tr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function TN(t){return new Promise((e,n)=>{var r,s,i;function a(){Ty(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ty(),n(er(t,"network-request-failed"))},timeout:EN.get()})}if(!((s=(r=tr().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=tr().gapi)===null||i===void 0)&&i.load)a();else{const l=fk("iframefcb");return tr()[l]=()=>{gapi.load?a():n(er(t,"network-request-failed"))},bx(`${hk()}?onload=${l}`).catch(u=>n(u))}}).catch(e=>{throw Xl=null,e})}let Xl=null;function CN(t){return Xl=Xl||TN(t),Xl}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SN=new Oo(5e3,15e3),kN="__/auth/iframe",NN="emulator/auth/iframe",IN={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},PN=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function AN(t){const e=t.config;fe(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?em(e,NN):`https://${t.config.authDomain}/${kN}`,r={apiKey:e.apiKey,appName:t.name,v:ra},s=PN.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Lo(r).slice(1)}`}async function RN(t){const e=await CN(t),n=tr().gapi;return fe(n,t,"internal-error"),e.open({where:document.body,url:AN(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:IN,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=er(t,"network-request-failed"),l=tr().setTimeout(()=>{i(a)},SN.get());function u(){tr().clearTimeout(l),s(r)}r.ping(u).then(u,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jN={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},DN=500,MN=600,LN="_blank",ON="http://localhost";class Cy{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function VN(t,e,n,r=DN,s=MN){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const u=Object.assign(Object.assign({},jN),{width:r.toString(),height:s.toString(),top:i,left:a}),d=Yt().toLowerCase();n&&(l=px(d)?LN:n),fx(d)&&(e=e||ON,u.scrollbars="yes");const f=Object.entries(u).reduce((g,[b,k])=>`${g}${b}=${k},`,"");if(rk(d)&&l!=="_self")return FN(e||"",l),new Cy(null);const m=window.open(e||"",l,f);fe(m,t,"popup-blocked");try{m.focus()}catch{}return new Cy(m)}function FN(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $N="__/auth/handler",UN="emulator/auth/handler",BN=encodeURIComponent("fac");async function Sy(t,e,n,r,s,i){fe(t.config.authDomain,t,"auth-domain-config-required"),fe(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:ra,eventId:s};if(e instanceof Tx){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",kC(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,m]of Object.entries(i||{}))a[f]=m}if(e instanceof Fo){const f=e.getScopes().filter(m=>m!=="");f.length>0&&(a.scopes=f.join(","))}t.tenantId&&(a.tid=t.tenantId);const l=a;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const u=await t._getAppCheckToken(),d=u?`#${BN}=${encodeURIComponent(u)}`:"";return`${zN(t)}?${Lo(l).slice(1)}${d}`}function zN({config:t}){return t.emulator?em(t,UN):`https://${t.authDomain}/${$N}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ed="webStorageSupport";class WN{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Rx,this._completeRedirectFn=mN,this._overrideRedirectResult=dN}async _openPopup(e,n,r,s){var i;Cr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await Sy(e,n,r,jh(),s);return VN(e,a,im())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await Sy(e,n,r,jh(),s);return Gk(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(Cr(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await RN(e),r=new gN(e);return n.register("authEvent",s=>(fe(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Ed,{type:Ed},s=>{var i;const a=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Ed];a!==void 0&&n(!!a),Bn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=_N(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return xx()||mx()||nm()}}const qN=WN;var ky="@firebase/auth",Ny="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HN{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){fe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GN(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function KN(t){qi(new Gs("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;fe(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_x(t)},d=new ck(r,s,i,u);return vk(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),qi(new Gs("auth-internal",e=>{const n=ri(e.getProvider("auth").getImmediate());return(r=>new HN(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),fs(ky,Ny,GN(t)),fs(ky,Ny,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QN=5*60,YN=Xw("authIdTokenMaxAge")||QN;let Iy=null;const XN=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>YN)return;const s=n==null?void 0:n.token;Iy!==s&&(Iy=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function JN(t=tx()){const e=Xf(t,"auth");if(e.isInitialized())return e.getImmediate();const n=yk(t,{popupRedirectResolver:qN,persistence:[nN,Wk,Rx]}),r=Xw("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=XN(i.toString());$k(n,a,()=>a(n.currentUser)),Fk(n,l=>a(l))}}const s=Qw("auth");return s&&wk(n,`http://${s}`),n}function ZN(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}uk({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=er("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",ZN().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});KN("Browser");var eI="firebase",tI="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */fs(eI,tI,"app");var Py=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Us,Fx;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(v,y){function S(){}S.prototype=y.prototype,v.D=y.prototype,v.prototype=new S,v.prototype.constructor=v,v.C=function(P,R,E){for(var T=Array(arguments.length-2),me=2;me<arguments.length;me++)T[me-2]=arguments[me];return y.prototype[R].apply(P,T)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,y,S){S||(S=0);var P=Array(16);if(typeof y=="string")for(var R=0;16>R;++R)P[R]=y.charCodeAt(S++)|y.charCodeAt(S++)<<8|y.charCodeAt(S++)<<16|y.charCodeAt(S++)<<24;else for(R=0;16>R;++R)P[R]=y[S++]|y[S++]<<8|y[S++]<<16|y[S++]<<24;y=v.g[0],S=v.g[1],R=v.g[2];var E=v.g[3],T=y+(E^S&(R^E))+P[0]+3614090360&4294967295;y=S+(T<<7&4294967295|T>>>25),T=E+(R^y&(S^R))+P[1]+3905402710&4294967295,E=y+(T<<12&4294967295|T>>>20),T=R+(S^E&(y^S))+P[2]+606105819&4294967295,R=E+(T<<17&4294967295|T>>>15),T=S+(y^R&(E^y))+P[3]+3250441966&4294967295,S=R+(T<<22&4294967295|T>>>10),T=y+(E^S&(R^E))+P[4]+4118548399&4294967295,y=S+(T<<7&4294967295|T>>>25),T=E+(R^y&(S^R))+P[5]+1200080426&4294967295,E=y+(T<<12&4294967295|T>>>20),T=R+(S^E&(y^S))+P[6]+2821735955&4294967295,R=E+(T<<17&4294967295|T>>>15),T=S+(y^R&(E^y))+P[7]+4249261313&4294967295,S=R+(T<<22&4294967295|T>>>10),T=y+(E^S&(R^E))+P[8]+1770035416&4294967295,y=S+(T<<7&4294967295|T>>>25),T=E+(R^y&(S^R))+P[9]+2336552879&4294967295,E=y+(T<<12&4294967295|T>>>20),T=R+(S^E&(y^S))+P[10]+4294925233&4294967295,R=E+(T<<17&4294967295|T>>>15),T=S+(y^R&(E^y))+P[11]+2304563134&4294967295,S=R+(T<<22&4294967295|T>>>10),T=y+(E^S&(R^E))+P[12]+1804603682&4294967295,y=S+(T<<7&4294967295|T>>>25),T=E+(R^y&(S^R))+P[13]+4254626195&4294967295,E=y+(T<<12&4294967295|T>>>20),T=R+(S^E&(y^S))+P[14]+2792965006&4294967295,R=E+(T<<17&4294967295|T>>>15),T=S+(y^R&(E^y))+P[15]+1236535329&4294967295,S=R+(T<<22&4294967295|T>>>10),T=y+(R^E&(S^R))+P[1]+4129170786&4294967295,y=S+(T<<5&4294967295|T>>>27),T=E+(S^R&(y^S))+P[6]+3225465664&4294967295,E=y+(T<<9&4294967295|T>>>23),T=R+(y^S&(E^y))+P[11]+643717713&4294967295,R=E+(T<<14&4294967295|T>>>18),T=S+(E^y&(R^E))+P[0]+3921069994&4294967295,S=R+(T<<20&4294967295|T>>>12),T=y+(R^E&(S^R))+P[5]+3593408605&4294967295,y=S+(T<<5&4294967295|T>>>27),T=E+(S^R&(y^S))+P[10]+38016083&4294967295,E=y+(T<<9&4294967295|T>>>23),T=R+(y^S&(E^y))+P[15]+3634488961&4294967295,R=E+(T<<14&4294967295|T>>>18),T=S+(E^y&(R^E))+P[4]+3889429448&4294967295,S=R+(T<<20&4294967295|T>>>12),T=y+(R^E&(S^R))+P[9]+568446438&4294967295,y=S+(T<<5&4294967295|T>>>27),T=E+(S^R&(y^S))+P[14]+3275163606&4294967295,E=y+(T<<9&4294967295|T>>>23),T=R+(y^S&(E^y))+P[3]+4107603335&4294967295,R=E+(T<<14&4294967295|T>>>18),T=S+(E^y&(R^E))+P[8]+1163531501&4294967295,S=R+(T<<20&4294967295|T>>>12),T=y+(R^E&(S^R))+P[13]+2850285829&4294967295,y=S+(T<<5&4294967295|T>>>27),T=E+(S^R&(y^S))+P[2]+4243563512&4294967295,E=y+(T<<9&4294967295|T>>>23),T=R+(y^S&(E^y))+P[7]+1735328473&4294967295,R=E+(T<<14&4294967295|T>>>18),T=S+(E^y&(R^E))+P[12]+2368359562&4294967295,S=R+(T<<20&4294967295|T>>>12),T=y+(S^R^E)+P[5]+4294588738&4294967295,y=S+(T<<4&4294967295|T>>>28),T=E+(y^S^R)+P[8]+2272392833&4294967295,E=y+(T<<11&4294967295|T>>>21),T=R+(E^y^S)+P[11]+1839030562&4294967295,R=E+(T<<16&4294967295|T>>>16),T=S+(R^E^y)+P[14]+4259657740&4294967295,S=R+(T<<23&4294967295|T>>>9),T=y+(S^R^E)+P[1]+2763975236&4294967295,y=S+(T<<4&4294967295|T>>>28),T=E+(y^S^R)+P[4]+1272893353&4294967295,E=y+(T<<11&4294967295|T>>>21),T=R+(E^y^S)+P[7]+4139469664&4294967295,R=E+(T<<16&4294967295|T>>>16),T=S+(R^E^y)+P[10]+3200236656&4294967295,S=R+(T<<23&4294967295|T>>>9),T=y+(S^R^E)+P[13]+681279174&4294967295,y=S+(T<<4&4294967295|T>>>28),T=E+(y^S^R)+P[0]+3936430074&4294967295,E=y+(T<<11&4294967295|T>>>21),T=R+(E^y^S)+P[3]+3572445317&4294967295,R=E+(T<<16&4294967295|T>>>16),T=S+(R^E^y)+P[6]+76029189&4294967295,S=R+(T<<23&4294967295|T>>>9),T=y+(S^R^E)+P[9]+3654602809&4294967295,y=S+(T<<4&4294967295|T>>>28),T=E+(y^S^R)+P[12]+3873151461&4294967295,E=y+(T<<11&4294967295|T>>>21),T=R+(E^y^S)+P[15]+530742520&4294967295,R=E+(T<<16&4294967295|T>>>16),T=S+(R^E^y)+P[2]+3299628645&4294967295,S=R+(T<<23&4294967295|T>>>9),T=y+(R^(S|~E))+P[0]+4096336452&4294967295,y=S+(T<<6&4294967295|T>>>26),T=E+(S^(y|~R))+P[7]+1126891415&4294967295,E=y+(T<<10&4294967295|T>>>22),T=R+(y^(E|~S))+P[14]+2878612391&4294967295,R=E+(T<<15&4294967295|T>>>17),T=S+(E^(R|~y))+P[5]+4237533241&4294967295,S=R+(T<<21&4294967295|T>>>11),T=y+(R^(S|~E))+P[12]+1700485571&4294967295,y=S+(T<<6&4294967295|T>>>26),T=E+(S^(y|~R))+P[3]+2399980690&4294967295,E=y+(T<<10&4294967295|T>>>22),T=R+(y^(E|~S))+P[10]+4293915773&4294967295,R=E+(T<<15&4294967295|T>>>17),T=S+(E^(R|~y))+P[1]+2240044497&4294967295,S=R+(T<<21&4294967295|T>>>11),T=y+(R^(S|~E))+P[8]+1873313359&4294967295,y=S+(T<<6&4294967295|T>>>26),T=E+(S^(y|~R))+P[15]+4264355552&4294967295,E=y+(T<<10&4294967295|T>>>22),T=R+(y^(E|~S))+P[6]+2734768916&4294967295,R=E+(T<<15&4294967295|T>>>17),T=S+(E^(R|~y))+P[13]+1309151649&4294967295,S=R+(T<<21&4294967295|T>>>11),T=y+(R^(S|~E))+P[4]+4149444226&4294967295,y=S+(T<<6&4294967295|T>>>26),T=E+(S^(y|~R))+P[11]+3174756917&4294967295,E=y+(T<<10&4294967295|T>>>22),T=R+(y^(E|~S))+P[2]+718787259&4294967295,R=E+(T<<15&4294967295|T>>>17),T=S+(E^(R|~y))+P[9]+3951481745&4294967295,v.g[0]=v.g[0]+y&4294967295,v.g[1]=v.g[1]+(R+(T<<21&4294967295|T>>>11))&4294967295,v.g[2]=v.g[2]+R&4294967295,v.g[3]=v.g[3]+E&4294967295}r.prototype.u=function(v,y){y===void 0&&(y=v.length);for(var S=y-this.blockSize,P=this.B,R=this.h,E=0;E<y;){if(R==0)for(;E<=S;)s(this,v,E),E+=this.blockSize;if(typeof v=="string"){for(;E<y;)if(P[R++]=v.charCodeAt(E++),R==this.blockSize){s(this,P),R=0;break}}else for(;E<y;)if(P[R++]=v[E++],R==this.blockSize){s(this,P),R=0;break}}this.h=R,this.o+=y},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var y=1;y<v.length-8;++y)v[y]=0;var S=8*this.o;for(y=v.length-8;y<v.length;++y)v[y]=S&255,S/=256;for(this.u(v),v=Array(16),y=S=0;4>y;++y)for(var P=0;32>P;P+=8)v[S++]=this.g[y]>>>P&255;return v};function i(v,y){var S=l;return Object.prototype.hasOwnProperty.call(S,v)?S[v]:S[v]=y(v)}function a(v,y){this.h=y;for(var S=[],P=!0,R=v.length-1;0<=R;R--){var E=v[R]|0;P&&E==y||(S[R]=E,P=!1)}this.g=S}var l={};function u(v){return-128<=v&&128>v?i(v,function(y){return new a([y|0],0>y?-1:0)}):new a([v|0],0>v?-1:0)}function d(v){if(isNaN(v)||!isFinite(v))return m;if(0>v)return N(d(-v));for(var y=[],S=1,P=0;v>=S;P++)y[P]=v/S|0,S*=4294967296;return new a(y,0)}function f(v,y){if(v.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(v.charAt(0)=="-")return N(f(v.substring(1),y));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var S=d(Math.pow(y,8)),P=m,R=0;R<v.length;R+=8){var E=Math.min(8,v.length-R),T=parseInt(v.substring(R,R+E),y);8>E?(E=d(Math.pow(y,E)),P=P.j(E).add(d(T))):(P=P.j(S),P=P.add(d(T)))}return P}var m=u(0),g=u(1),b=u(16777216);t=a.prototype,t.m=function(){if(C(this))return-N(this).m();for(var v=0,y=1,S=0;S<this.g.length;S++){var P=this.i(S);v+=(0<=P?P:4294967296+P)*y,y*=4294967296}return v},t.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(k(this))return"0";if(C(this))return"-"+N(this).toString(v);for(var y=d(Math.pow(v,6)),S=this,P="";;){var R=D(S,y).g;S=_(S,R.j(y));var E=((0<S.g.length?S.g[0]:S.h)>>>0).toString(v);if(S=R,k(S))return E+P;for(;6>E.length;)E="0"+E;P=E+P}},t.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function k(v){if(v.h!=0)return!1;for(var y=0;y<v.g.length;y++)if(v.g[y]!=0)return!1;return!0}function C(v){return v.h==-1}t.l=function(v){return v=_(this,v),C(v)?-1:k(v)?0:1};function N(v){for(var y=v.g.length,S=[],P=0;P<y;P++)S[P]=~v.g[P];return new a(S,~v.h).add(g)}t.abs=function(){return C(this)?N(this):this},t.add=function(v){for(var y=Math.max(this.g.length,v.g.length),S=[],P=0,R=0;R<=y;R++){var E=P+(this.i(R)&65535)+(v.i(R)&65535),T=(E>>>16)+(this.i(R)>>>16)+(v.i(R)>>>16);P=T>>>16,E&=65535,T&=65535,S[R]=T<<16|E}return new a(S,S[S.length-1]&-2147483648?-1:0)};function _(v,y){return v.add(N(y))}t.j=function(v){if(k(this)||k(v))return m;if(C(this))return C(v)?N(this).j(N(v)):N(N(this).j(v));if(C(v))return N(this.j(N(v)));if(0>this.l(b)&&0>v.l(b))return d(this.m()*v.m());for(var y=this.g.length+v.g.length,S=[],P=0;P<2*y;P++)S[P]=0;for(P=0;P<this.g.length;P++)for(var R=0;R<v.g.length;R++){var E=this.i(P)>>>16,T=this.i(P)&65535,me=v.i(R)>>>16,ye=v.i(R)&65535;S[2*P+2*R]+=T*ye,x(S,2*P+2*R),S[2*P+2*R+1]+=E*ye,x(S,2*P+2*R+1),S[2*P+2*R+1]+=T*me,x(S,2*P+2*R+1),S[2*P+2*R+2]+=E*me,x(S,2*P+2*R+2)}for(P=0;P<y;P++)S[P]=S[2*P+1]<<16|S[2*P];for(P=y;P<2*y;P++)S[P]=0;return new a(S,0)};function x(v,y){for(;(v[y]&65535)!=v[y];)v[y+1]+=v[y]>>>16,v[y]&=65535,y++}function I(v,y){this.g=v,this.h=y}function D(v,y){if(k(y))throw Error("division by zero");if(k(v))return new I(m,m);if(C(v))return y=D(N(v),y),new I(N(y.g),N(y.h));if(C(y))return y=D(v,N(y)),new I(N(y.g),y.h);if(30<v.g.length){if(C(v)||C(y))throw Error("slowDivide_ only works with positive integers.");for(var S=g,P=y;0>=P.l(v);)S=F(S),P=F(P);var R=q(S,1),E=q(P,1);for(P=q(P,2),S=q(S,2);!k(P);){var T=E.add(P);0>=T.l(v)&&(R=R.add(S),E=T),P=q(P,1),S=q(S,1)}return y=_(v,R.j(y)),new I(R,y)}for(R=m;0<=v.l(y);){for(S=Math.max(1,Math.floor(v.m()/y.m())),P=Math.ceil(Math.log(S)/Math.LN2),P=48>=P?1:Math.pow(2,P-48),E=d(S),T=E.j(y);C(T)||0<T.l(v);)S-=P,E=d(S),T=E.j(y);k(E)&&(E=g),R=R.add(E),v=_(v,T)}return new I(R,v)}t.A=function(v){return D(this,v).h},t.and=function(v){for(var y=Math.max(this.g.length,v.g.length),S=[],P=0;P<y;P++)S[P]=this.i(P)&v.i(P);return new a(S,this.h&v.h)},t.or=function(v){for(var y=Math.max(this.g.length,v.g.length),S=[],P=0;P<y;P++)S[P]=this.i(P)|v.i(P);return new a(S,this.h|v.h)},t.xor=function(v){for(var y=Math.max(this.g.length,v.g.length),S=[],P=0;P<y;P++)S[P]=this.i(P)^v.i(P);return new a(S,this.h^v.h)};function F(v){for(var y=v.g.length+1,S=[],P=0;P<y;P++)S[P]=v.i(P)<<1|v.i(P-1)>>>31;return new a(S,v.h)}function q(v,y){var S=y>>5;y%=32;for(var P=v.g.length-S,R=[],E=0;E<P;E++)R[E]=0<y?v.i(E+S)>>>y|v.i(E+S+1)<<32-y:v.i(E+S);return new a(R,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Fx=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,Us=a}).apply(typeof Py<"u"?Py:typeof self<"u"?self:typeof window<"u"?window:{});var Al=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var $x,Da,Ux,Jl,Oh,Bx,zx,Wx;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,h,p){return c==Array.prototype||c==Object.prototype||(c[h]=p.value),c};function n(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof Al=="object"&&Al];for(var h=0;h<c.length;++h){var p=c[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=n(this);function s(c,h){if(h)e:{var p=r;c=c.split(".");for(var w=0;w<c.length-1;w++){var M=c[w];if(!(M in p))break e;p=p[M]}c=c[c.length-1],w=p[c],h=h(w),h!=w&&h!=null&&e(p,c,{configurable:!0,writable:!0,value:h})}}function i(c,h){c instanceof String&&(c+="");var p=0,w=!1,M={next:function(){if(!w&&p<c.length){var $=p++;return{value:h($,c[$]),done:!1}}return w=!0,{done:!0,value:void 0}}};return M[Symbol.iterator]=function(){return M},M}s("Array.prototype.values",function(c){return c||function(){return i(this,function(h,p){return p})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},l=this||self;function u(c){var h=typeof c;return h=h!="object"?h:c?Array.isArray(c)?"array":h:"null",h=="array"||h=="object"&&typeof c.length=="number"}function d(c){var h=typeof c;return h=="object"&&c!=null||h=="function"}function f(c,h,p){return c.call.apply(c.bind,arguments)}function m(c,h,p){if(!c)throw Error();if(2<arguments.length){var w=Array.prototype.slice.call(arguments,2);return function(){var M=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(M,w),c.apply(h,M)}}return function(){return c.apply(h,arguments)}}function g(c,h,p){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:m,g.apply(null,arguments)}function b(c,h){var p=Array.prototype.slice.call(arguments,1);return function(){var w=p.slice();return w.push.apply(w,arguments),c.apply(this,w)}}function k(c,h){function p(){}p.prototype=h.prototype,c.aa=h.prototype,c.prototype=new p,c.prototype.constructor=c,c.Qb=function(w,M,$){for(var Z=Array(arguments.length-2),We=2;We<arguments.length;We++)Z[We-2]=arguments[We];return h.prototype[M].apply(w,Z)}}function C(c){const h=c.length;if(0<h){const p=Array(h);for(let w=0;w<h;w++)p[w]=c[w];return p}return[]}function N(c,h){for(let p=1;p<arguments.length;p++){const w=arguments[p];if(u(w)){const M=c.length||0,$=w.length||0;c.length=M+$;for(let Z=0;Z<$;Z++)c[M+Z]=w[Z]}else c.push(w)}}class _{constructor(h,p){this.i=h,this.j=p,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function x(c){return/^[\s\xa0]*$/.test(c)}function I(){var c=l.navigator;return c&&(c=c.userAgent)?c:""}function D(c){return D[" "](c),c}D[" "]=function(){};var F=I().indexOf("Gecko")!=-1&&!(I().toLowerCase().indexOf("webkit")!=-1&&I().indexOf("Edge")==-1)&&!(I().indexOf("Trident")!=-1||I().indexOf("MSIE")!=-1)&&I().indexOf("Edge")==-1;function q(c,h,p){for(const w in c)h.call(p,c[w],w,c)}function v(c,h){for(const p in c)h.call(void 0,c[p],p,c)}function y(c){const h={};for(const p in c)h[p]=c[p];return h}const S="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function P(c,h){let p,w;for(let M=1;M<arguments.length;M++){w=arguments[M];for(p in w)c[p]=w[p];for(let $=0;$<S.length;$++)p=S[$],Object.prototype.hasOwnProperty.call(w,p)&&(c[p]=w[p])}}function R(c){var h=1;c=c.split(":");const p=[];for(;0<h&&c.length;)p.push(c.shift()),h--;return c.length&&p.push(c.join(":")),p}function E(c){l.setTimeout(()=>{throw c},0)}function T(){var c=re;let h=null;return c.g&&(h=c.g,c.g=c.g.next,c.g||(c.h=null),h.next=null),h}class me{constructor(){this.h=this.g=null}add(h,p){const w=ye.get();w.set(h,p),this.h?this.h.next=w:this.g=w,this.h=w}}var ye=new _(()=>new Se,c=>c.reset());class Se{constructor(){this.next=this.g=this.h=null}set(h,p){this.h=h,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let de,K=!1,re=new me,ce=()=>{const c=l.Promise.resolve(void 0);de=()=>{c.then(Y)}};var Y=()=>{for(var c;c=T();){try{c.h.call(c.g)}catch(p){E(p)}var h=ye;h.j(c),100>h.h&&(h.h++,c.next=h.g,h.g=c)}K=!1};function W(){this.s=this.s,this.C=this.C}W.prototype.s=!1,W.prototype.ma=function(){this.s||(this.s=!0,this.N())},W.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function J(c,h){this.type=c,this.g=this.target=h,this.defaultPrevented=!1}J.prototype.h=function(){this.defaultPrevented=!0};var le=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var c=!1,h=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const p=()=>{};l.addEventListener("test",p,h),l.removeEventListener("test",p,h)}catch{}return c}();function ve(c,h){if(J.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var p=this.type=c.type,w=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=h,h=c.relatedTarget){if(F){e:{try{D(h.nodeName);var M=!0;break e}catch{}M=!1}M||(h=null)}}else p=="mouseover"?h=c.fromElement:p=="mouseout"&&(h=c.toElement);this.relatedTarget=h,w?(this.clientX=w.clientX!==void 0?w.clientX:w.pageX,this.clientY=w.clientY!==void 0?w.clientY:w.pageY,this.screenX=w.screenX||0,this.screenY=w.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:ke[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&ve.aa.h.call(this)}}k(ve,J);var ke={2:"touch",3:"pen",4:"mouse"};ve.prototype.h=function(){ve.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var ae="closure_listenable_"+(1e6*Math.random()|0),pe=0;function Ce(c,h,p,w,M){this.listener=c,this.proxy=null,this.src=h,this.type=p,this.capture=!!w,this.ha=M,this.key=++pe,this.da=this.fa=!1}function Te(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function Me(c){this.src=c,this.g={},this.h=0}Me.prototype.add=function(c,h,p,w,M){var $=c.toString();c=this.g[$],c||(c=this.g[$]=[],this.h++);var Z=dt(c,h,w,M);return-1<Z?(h=c[Z],p||(h.fa=!1)):(h=new Ce(h,this.src,$,!!w,M),h.fa=p,c.push(h)),h};function ge(c,h){var p=h.type;if(p in c.g){var w=c.g[p],M=Array.prototype.indexOf.call(w,h,void 0),$;($=0<=M)&&Array.prototype.splice.call(w,M,1),$&&(Te(h),c.g[p].length==0&&(delete c.g[p],c.h--))}}function dt(c,h,p,w){for(var M=0;M<c.length;++M){var $=c[M];if(!$.da&&$.listener==h&&$.capture==!!p&&$.ha==w)return M}return-1}var dn="closure_lm_"+(1e6*Math.random()|0),we={};function bt(c,h,p,w,M){if(w&&w.once)return Vt(c,h,p,w,M);if(Array.isArray(h)){for(var $=0;$<h.length;$++)bt(c,h[$],p,w,M);return null}return p=Et(p),c&&c[ae]?c.K(h,p,d(w)?!!w.capture:!!w,M):Dr(c,h,p,!1,w,M)}function Dr(c,h,p,w,M,$){if(!h)throw Error("Invalid event type");var Z=d(M)?!!M.capture:!!M,We=Re(c);if(We||(c[dn]=We=new Me(c)),p=We.add(h,p,w,Z,$),p.proxy)return p;if(w=ir(),p.proxy=w,w.src=c,w.listener=p,c.addEventListener)le||(M=Z),M===void 0&&(M=!1),c.addEventListener(h.toString(),w,M);else if(c.attachEvent)c.attachEvent(te(h.toString()),w);else if(c.addListener&&c.removeListener)c.addListener(w);else throw Error("addEventListener and attachEvent are unavailable.");return p}function ir(){function c(p){return h.call(c.src,c.listener,p)}const h=_e;return c}function Vt(c,h,p,w,M){if(Array.isArray(h)){for(var $=0;$<h.length;$++)Vt(c,h[$],p,w,M);return null}return p=Et(p),c&&c[ae]?c.L(h,p,d(w)?!!w.capture:!!w,M):Dr(c,h,p,!0,w,M)}function qe(c,h,p,w,M){if(Array.isArray(h))for(var $=0;$<h.length;$++)qe(c,h[$],p,w,M);else w=d(w)?!!w.capture:!!w,p=Et(p),c&&c[ae]?(c=c.i,h=String(h).toString(),h in c.g&&($=c.g[h],p=dt($,p,w,M),-1<p&&(Te($[p]),Array.prototype.splice.call($,p,1),$.length==0&&(delete c.g[h],c.h--)))):c&&(c=Re(c))&&(h=c.g[h.toString()],c=-1,h&&(c=dt(h,p,w,M)),(p=-1<c?h[c]:null)&&L(p))}function L(c){if(typeof c!="number"&&c&&!c.da){var h=c.src;if(h&&h[ae])ge(h.i,c);else{var p=c.type,w=c.proxy;h.removeEventListener?h.removeEventListener(p,w,c.capture):h.detachEvent?h.detachEvent(te(p),w):h.addListener&&h.removeListener&&h.removeListener(w),(p=Re(h))?(ge(p,c),p.h==0&&(p.src=null,h[dn]=null)):Te(c)}}}function te(c){return c in we?we[c]:we[c]="on"+c}function _e(c,h){if(c.da)c=!0;else{h=new ve(h,this);var p=c.listener,w=c.ha||c.src;c.fa&&L(c),c=p.call(w,h)}return c}function Re(c){return c=c[dn],c instanceof Me?c:null}var st="__closure_events_fn_"+(1e9*Math.random()>>>0);function Et(c){return typeof c=="function"?c:(c[st]||(c[st]=function(h){return c.handleEvent(h)}),c[st])}function ze(){W.call(this),this.i=new Me(this),this.M=this,this.F=null}k(ze,W),ze.prototype[ae]=!0,ze.prototype.removeEventListener=function(c,h,p,w){qe(this,c,h,p,w)};function it(c,h){var p,w=c.F;if(w)for(p=[];w;w=w.F)p.push(w);if(c=c.M,w=h.type||h,typeof h=="string")h=new J(h,c);else if(h instanceof J)h.target=h.target||c;else{var M=h;h=new J(w,c),P(h,M)}if(M=!0,p)for(var $=p.length-1;0<=$;$--){var Z=h.g=p[$];M=Pn(Z,w,!0,h)&&M}if(Z=h.g=c,M=Pn(Z,w,!0,h)&&M,M=Pn(Z,w,!1,h)&&M,p)for($=0;$<p.length;$++)Z=h.g=p[$],M=Pn(Z,w,!1,h)&&M}ze.prototype.N=function(){if(ze.aa.N.call(this),this.i){var c=this.i,h;for(h in c.g){for(var p=c.g[h],w=0;w<p.length;w++)Te(p[w]);delete c.g[h],c.h--}}this.F=null},ze.prototype.K=function(c,h,p,w){return this.i.add(String(c),h,!1,p,w)},ze.prototype.L=function(c,h,p,w){return this.i.add(String(c),h,!0,p,w)};function Pn(c,h,p,w){if(h=c.i.g[String(h)],!h)return!0;h=h.concat();for(var M=!0,$=0;$<h.length;++$){var Z=h[$];if(Z&&!Z.da&&Z.capture==p){var We=Z.listener,Nt=Z.ha||Z.src;Z.fa&&ge(c.i,Z),M=We.call(Nt,w)!==!1&&M}}return M&&!w.defaultPrevented}function Ss(c,h,p){if(typeof c=="function")p&&(c=g(c,p));else if(c&&typeof c.handleEvent=="function")c=g(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:l.setTimeout(c,h||0)}function ks(c){c.g=Ss(()=>{c.g=null,c.i&&(c.i=!1,ks(c))},c.l);const h=c.h;c.h=null,c.m.apply(null,h)}class Ns extends W{constructor(h,p){super(),this.m=h,this.l=p,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:ks(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function bn(c){W.call(this),this.h=c,this.g={}}k(bn,W);var Mr=[];function O(c){q(c.g,function(h,p){this.g.hasOwnProperty(p)&&L(h)},c),c.g={}}bn.prototype.N=function(){bn.aa.N.call(this),O(this)},bn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var H=l.JSON.stringify,ee=l.JSON.parse,he=class{stringify(c){return l.JSON.stringify(c,void 0)}parse(c){return l.JSON.parse(c,void 0)}};function j(){}j.prototype.h=null;function V(c){return c.h||(c.h=c.i())}function B(){}var U={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ne(){J.call(this,"d")}k(Ne,J);function Q(){J.call(this,"c")}k(Q,J);var ne={},Oe=null;function Ge(){return Oe=Oe||new ze}ne.La="serverreachability";function Ke(c){J.call(this,ne.La,c)}k(Ke,J);function Ft(c){const h=Ge();it(h,new Ke(h))}ne.STAT_EVENT="statevent";function ca(c,h){J.call(this,ne.STAT_EVENT,c),this.stat=h}k(ca,J);function Tt(c){const h=Ge();it(h,new ca(h,c))}ne.Ma="timingevent";function ua(c,h){J.call(this,ne.Ma,c),this.size=h}k(ua,J);function Lr(c,h){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){c()},h)}function Or(){this.g=!0}Or.prototype.xa=function(){this.g=!1};function Xo(c,h,p,w,M,$){c.info(function(){if(c.g)if($)for(var Z="",We=$.split("&"),Nt=0;Nt<We.length;Nt++){var Ve=We[Nt].split("=");if(1<Ve.length){var $t=Ve[0];Ve=Ve[1];var Ut=$t.split("_");Z=2<=Ut.length&&Ut[1]=="type"?Z+($t+"="+Ve+"&"):Z+($t+"=redacted&")}}else Z=null;else Z=$;return"XMLHTTP REQ ("+w+") [attempt "+M+"]: "+h+`
`+p+`
`+Z})}function Jo(c,h,p,w,M,$,Z){c.info(function(){return"XMLHTTP RESP ("+w+") [ attempt "+M+"]: "+h+`
`+p+`
`+$+" "+Z})}function ar(c,h,p,w){c.info(function(){return"XMLHTTP TEXT ("+h+"): "+ub(c,p)+(w?" "+w:"")})}function An(c,h){c.info(function(){return"TIMEOUT: "+h})}Or.prototype.info=function(){};function ub(c,h){if(!c.g)return h;if(!h)return null;try{var p=JSON.parse(h);if(p){for(c=0;c<p.length;c++)if(Array.isArray(p[c])){var w=p[c];if(!(2>w.length)){var M=w[1];if(Array.isArray(M)&&!(1>M.length)){var $=M[0];if($!="noop"&&$!="stop"&&$!="close")for(var Z=1;Z<M.length;Z++)M[Z]=""}}}}return H(p)}catch{return h}}var Zo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Zm={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ru;function el(){}k(el,j),el.prototype.g=function(){return new XMLHttpRequest},el.prototype.i=function(){return{}},Ru=new el;function Vr(c,h,p,w){this.j=c,this.i=h,this.l=p,this.R=w||1,this.U=new bn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ep}function ep(){this.i=null,this.g="",this.h=!1}var tp={},ju={};function Du(c,h,p){c.L=1,c.v=sl(or(h)),c.m=p,c.P=!0,np(c,null)}function np(c,h){c.F=Date.now(),tl(c),c.A=or(c.v);var p=c.A,w=c.R;Array.isArray(w)||(w=[String(w)]),gp(p.i,"t",w),c.C=0,p=c.j.J,c.h=new ep,c.g=Dp(c.j,p?h:null,!c.m),0<c.O&&(c.M=new Ns(g(c.Y,c,c.g),c.O)),h=c.U,p=c.g,w=c.ca;var M="readystatechange";Array.isArray(M)||(M&&(Mr[0]=M.toString()),M=Mr);for(var $=0;$<M.length;$++){var Z=bt(p,M[$],w||h.handleEvent,!1,h.h||h);if(!Z)break;h.g[Z.key]=Z}h=c.H?y(c.H):{},c.m?(c.u||(c.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,h)):(c.u="GET",c.g.ea(c.A,c.u,null,h)),Ft(),Xo(c.i,c.u,c.A,c.l,c.R,c.m)}Vr.prototype.ca=function(c){c=c.target;const h=this.M;h&&lr(c)==3?h.j():this.Y(c)},Vr.prototype.Y=function(c){try{if(c==this.g)e:{const Ut=lr(this.g);var h=this.g.Ba();const ui=this.g.Z();if(!(3>Ut)&&(Ut!=3||this.g&&(this.h.h||this.g.oa()||Ep(this.g)))){this.J||Ut!=4||h==7||(h==8||0>=ui?Ft(3):Ft(2)),Mu(this);var p=this.g.Z();this.X=p;t:if(rp(this)){var w=Ep(this.g);c="";var M=w.length,$=lr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Is(this),da(this);var Z="";break t}this.h.i=new l.TextDecoder}for(h=0;h<M;h++)this.h.h=!0,c+=this.h.i.decode(w[h],{stream:!($&&h==M-1)});w.length=0,this.h.g+=c,this.C=0,Z=this.h.g}else Z=this.g.oa();if(this.o=p==200,Jo(this.i,this.u,this.A,this.l,this.R,Ut,p),this.o){if(this.T&&!this.K){t:{if(this.g){var We,Nt=this.g;if((We=Nt.g?Nt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(We)){var Ve=We;break t}}Ve=null}if(p=Ve)ar(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Lu(this,p);else{this.o=!1,this.s=3,Tt(12),Is(this),da(this);break e}}if(this.P){p=!0;let Rn;for(;!this.J&&this.C<Z.length;)if(Rn=db(this,Z),Rn==ju){Ut==4&&(this.s=4,Tt(14),p=!1),ar(this.i,this.l,null,"[Incomplete Response]");break}else if(Rn==tp){this.s=4,Tt(15),ar(this.i,this.l,Z,"[Invalid Chunk]"),p=!1;break}else ar(this.i,this.l,Rn,null),Lu(this,Rn);if(rp(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ut!=4||Z.length!=0||this.h.h||(this.s=1,Tt(16),p=!1),this.o=this.o&&p,!p)ar(this.i,this.l,Z,"[Invalid Chunked Response]"),Is(this),da(this);else if(0<Z.length&&!this.W){this.W=!0;var $t=this.j;$t.g==this&&$t.ba&&!$t.M&&($t.j.info("Great, no buffering proxy detected. Bytes received: "+Z.length),Bu($t),$t.M=!0,Tt(11))}}else ar(this.i,this.l,Z,null),Lu(this,Z);Ut==4&&Is(this),this.o&&!this.J&&(Ut==4?Pp(this.j,this):(this.o=!1,tl(this)))}else Nb(this.g),p==400&&0<Z.indexOf("Unknown SID")?(this.s=3,Tt(12)):(this.s=0,Tt(13)),Is(this),da(this)}}}catch{}finally{}};function rp(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function db(c,h){var p=c.C,w=h.indexOf(`
`,p);return w==-1?ju:(p=Number(h.substring(p,w)),isNaN(p)?tp:(w+=1,w+p>h.length?ju:(h=h.slice(w,w+p),c.C=w+p,h)))}Vr.prototype.cancel=function(){this.J=!0,Is(this)};function tl(c){c.S=Date.now()+c.I,sp(c,c.I)}function sp(c,h){if(c.B!=null)throw Error("WatchDog timer not null");c.B=Lr(g(c.ba,c),h)}function Mu(c){c.B&&(l.clearTimeout(c.B),c.B=null)}Vr.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(An(this.i,this.A),this.L!=2&&(Ft(),Tt(17)),Is(this),this.s=2,da(this)):sp(this,this.S-c)};function da(c){c.j.G==0||c.J||Pp(c.j,c)}function Is(c){Mu(c);var h=c.M;h&&typeof h.ma=="function"&&h.ma(),c.M=null,O(c.U),c.g&&(h=c.g,c.g=null,h.abort(),h.ma())}function Lu(c,h){try{var p=c.j;if(p.G!=0&&(p.g==c||Ou(p.h,c))){if(!c.K&&Ou(p.h,c)&&p.G==3){try{var w=p.Da.g.parse(h)}catch{w=null}if(Array.isArray(w)&&w.length==3){var M=w;if(M[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<c.F)ul(p),ll(p);else break e;Uu(p),Tt(18)}}else p.za=M[1],0<p.za-p.T&&37500>M[2]&&p.F&&p.v==0&&!p.C&&(p.C=Lr(g(p.Za,p),6e3));if(1>=op(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else As(p,11)}else if((c.K||p.g==c)&&ul(p),!x(h))for(M=p.Da.g.parse(h),h=0;h<M.length;h++){let Ve=M[h];if(p.T=Ve[0],Ve=Ve[1],p.G==2)if(Ve[0]=="c"){p.K=Ve[1],p.ia=Ve[2];const $t=Ve[3];$t!=null&&(p.la=$t,p.j.info("VER="+p.la));const Ut=Ve[4];Ut!=null&&(p.Aa=Ut,p.j.info("SVER="+p.Aa));const ui=Ve[5];ui!=null&&typeof ui=="number"&&0<ui&&(w=1.5*ui,p.L=w,p.j.info("backChannelRequestTimeoutMs_="+w)),w=p;const Rn=c.g;if(Rn){const hl=Rn.g?Rn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(hl){var $=w.h;$.g||hl.indexOf("spdy")==-1&&hl.indexOf("quic")==-1&&hl.indexOf("h2")==-1||($.j=$.l,$.g=new Set,$.h&&(Vu($,$.h),$.h=null))}if(w.D){const zu=Rn.g?Rn.g.getResponseHeader("X-HTTP-Session-Id"):null;zu&&(w.ya=zu,Qe(w.I,w.D,zu))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-c.F,p.j.info("Handshake RTT: "+p.R+"ms")),w=p;var Z=c;if(w.qa=jp(w,w.J?w.ia:null,w.W),Z.K){lp(w.h,Z);var We=Z,Nt=w.L;Nt&&(We.I=Nt),We.B&&(Mu(We),tl(We)),w.g=Z}else Np(w);0<p.i.length&&cl(p)}else Ve[0]!="stop"&&Ve[0]!="close"||As(p,7);else p.G==3&&(Ve[0]=="stop"||Ve[0]=="close"?Ve[0]=="stop"?As(p,7):$u(p):Ve[0]!="noop"&&p.l&&p.l.ta(Ve),p.v=0)}}Ft(4)}catch{}}var hb=class{constructor(c,h){this.g=c,this.map=h}};function ip(c){this.l=c||10,l.PerformanceNavigationTiming?(c=l.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ap(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function op(c){return c.h?1:c.g?c.g.size:0}function Ou(c,h){return c.h?c.h==h:c.g?c.g.has(h):!1}function Vu(c,h){c.g?c.g.add(h):c.h=h}function lp(c,h){c.h&&c.h==h?c.h=null:c.g&&c.g.has(h)&&c.g.delete(h)}ip.prototype.cancel=function(){if(this.i=cp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function cp(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let h=c.i;for(const p of c.g.values())h=h.concat(p.D);return h}return C(c.i)}function fb(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(u(c)){for(var h=[],p=c.length,w=0;w<p;w++)h.push(c[w]);return h}h=[],p=0;for(w in c)h[p++]=c[w];return h}function mb(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(u(c)||typeof c=="string"){var h=[];c=c.length;for(var p=0;p<c;p++)h.push(p);return h}h=[],p=0;for(const w in c)h[p++]=w;return h}}}function up(c,h){if(c.forEach&&typeof c.forEach=="function")c.forEach(h,void 0);else if(u(c)||typeof c=="string")Array.prototype.forEach.call(c,h,void 0);else for(var p=mb(c),w=fb(c),M=w.length,$=0;$<M;$++)h.call(void 0,w[$],p&&p[$],c)}var dp=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pb(c,h){if(c){c=c.split("&");for(var p=0;p<c.length;p++){var w=c[p].indexOf("="),M=null;if(0<=w){var $=c[p].substring(0,w);M=c[p].substring(w+1)}else $=c[p];h($,M?decodeURIComponent(M.replace(/\+/g," ")):"")}}}function Ps(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof Ps){this.h=c.h,nl(this,c.j),this.o=c.o,this.g=c.g,rl(this,c.s),this.l=c.l;var h=c.i,p=new ma;p.i=h.i,h.g&&(p.g=new Map(h.g),p.h=h.h),hp(this,p),this.m=c.m}else c&&(h=String(c).match(dp))?(this.h=!1,nl(this,h[1]||"",!0),this.o=ha(h[2]||""),this.g=ha(h[3]||"",!0),rl(this,h[4]),this.l=ha(h[5]||"",!0),hp(this,h[6]||"",!0),this.m=ha(h[7]||"")):(this.h=!1,this.i=new ma(null,this.h))}Ps.prototype.toString=function(){var c=[],h=this.j;h&&c.push(fa(h,fp,!0),":");var p=this.g;return(p||h=="file")&&(c.push("//"),(h=this.o)&&c.push(fa(h,fp,!0),"@"),c.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&c.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&c.push("/"),c.push(fa(p,p.charAt(0)=="/"?vb:yb,!0))),(p=this.i.toString())&&c.push("?",p),(p=this.m)&&c.push("#",fa(p,xb)),c.join("")};function or(c){return new Ps(c)}function nl(c,h,p){c.j=p?ha(h,!0):h,c.j&&(c.j=c.j.replace(/:$/,""))}function rl(c,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);c.s=h}else c.s=null}function hp(c,h,p){h instanceof ma?(c.i=h,_b(c.i,c.h)):(p||(h=fa(h,wb)),c.i=new ma(h,c.h))}function Qe(c,h,p){c.i.set(h,p)}function sl(c){return Qe(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function ha(c,h){return c?h?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function fa(c,h,p){return typeof c=="string"?(c=encodeURI(c).replace(h,gb),p&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function gb(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var fp=/[#\/\?@]/g,yb=/[#\?:]/g,vb=/[#\?]/g,wb=/[#\?@]/g,xb=/#/g;function ma(c,h){this.h=this.g=null,this.i=c||null,this.j=!!h}function Fr(c){c.g||(c.g=new Map,c.h=0,c.i&&pb(c.i,function(h,p){c.add(decodeURIComponent(h.replace(/\+/g," ")),p)}))}t=ma.prototype,t.add=function(c,h){Fr(this),this.i=null,c=li(this,c);var p=this.g.get(c);return p||this.g.set(c,p=[]),p.push(h),this.h+=1,this};function mp(c,h){Fr(c),h=li(c,h),c.g.has(h)&&(c.i=null,c.h-=c.g.get(h).length,c.g.delete(h))}function pp(c,h){return Fr(c),h=li(c,h),c.g.has(h)}t.forEach=function(c,h){Fr(this),this.g.forEach(function(p,w){p.forEach(function(M){c.call(h,M,w,this)},this)},this)},t.na=function(){Fr(this);const c=Array.from(this.g.values()),h=Array.from(this.g.keys()),p=[];for(let w=0;w<h.length;w++){const M=c[w];for(let $=0;$<M.length;$++)p.push(h[w])}return p},t.V=function(c){Fr(this);let h=[];if(typeof c=="string")pp(this,c)&&(h=h.concat(this.g.get(li(this,c))));else{c=Array.from(this.g.values());for(let p=0;p<c.length;p++)h=h.concat(c[p])}return h},t.set=function(c,h){return Fr(this),this.i=null,c=li(this,c),pp(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[h]),this.h+=1,this},t.get=function(c,h){return c?(c=this.V(c),0<c.length?String(c[0]):h):h};function gp(c,h,p){mp(c,h),0<p.length&&(c.i=null,c.g.set(li(c,h),C(p)),c.h+=p.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],h=Array.from(this.g.keys());for(var p=0;p<h.length;p++){var w=h[p];const $=encodeURIComponent(String(w)),Z=this.V(w);for(w=0;w<Z.length;w++){var M=$;Z[w]!==""&&(M+="="+encodeURIComponent(String(Z[w]))),c.push(M)}}return this.i=c.join("&")};function li(c,h){return h=String(h),c.j&&(h=h.toLowerCase()),h}function _b(c,h){h&&!c.j&&(Fr(c),c.i=null,c.g.forEach(function(p,w){var M=w.toLowerCase();w!=M&&(mp(this,w),gp(this,M,p))},c)),c.j=h}function bb(c,h){const p=new Or;if(l.Image){const w=new Image;w.onload=b($r,p,"TestLoadImage: loaded",!0,h,w),w.onerror=b($r,p,"TestLoadImage: error",!1,h,w),w.onabort=b($r,p,"TestLoadImage: abort",!1,h,w),w.ontimeout=b($r,p,"TestLoadImage: timeout",!1,h,w),l.setTimeout(function(){w.ontimeout&&w.ontimeout()},1e4),w.src=c}else h(!1)}function Eb(c,h){const p=new Or,w=new AbortController,M=setTimeout(()=>{w.abort(),$r(p,"TestPingServer: timeout",!1,h)},1e4);fetch(c,{signal:w.signal}).then($=>{clearTimeout(M),$.ok?$r(p,"TestPingServer: ok",!0,h):$r(p,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(M),$r(p,"TestPingServer: error",!1,h)})}function $r(c,h,p,w,M){try{M&&(M.onload=null,M.onerror=null,M.onabort=null,M.ontimeout=null),w(p)}catch{}}function Tb(){this.g=new he}function Cb(c,h,p){const w=p||"";try{up(c,function(M,$){let Z=M;d(M)&&(Z=H(M)),h.push(w+$+"="+encodeURIComponent(Z))})}catch(M){throw h.push(w+"type="+encodeURIComponent("_badmap")),M}}function il(c){this.l=c.Ub||null,this.j=c.eb||!1}k(il,j),il.prototype.g=function(){return new al(this.l,this.j)},il.prototype.i=function(c){return function(){return c}}({});function al(c,h){ze.call(this),this.D=c,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(al,ze),t=al.prototype,t.open=function(c,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=h,this.readyState=1,ga(this)},t.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(h.body=c),(this.D||l).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,pa(this)),this.readyState=0},t.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,ga(this)),this.g&&(this.readyState=3,ga(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;yp(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function yp(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}t.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var h=c.value?c.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!c.done}))&&(this.response=this.responseText+=h)}c.done?pa(this):ga(this),this.readyState==3&&yp(this)}},t.Ra=function(c){this.g&&(this.response=this.responseText=c,pa(this))},t.Qa=function(c){this.g&&(this.response=c,pa(this))},t.ga=function(){this.g&&pa(this)};function pa(c){c.readyState=4,c.l=null,c.j=null,c.v=null,ga(c)}t.setRequestHeader=function(c,h){this.u.append(c,h)},t.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],h=this.h.entries();for(var p=h.next();!p.done;)p=p.value,c.push(p[0]+": "+p[1]),p=h.next();return c.join(`\r
`)};function ga(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(al.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function vp(c){let h="";return q(c,function(p,w){h+=w,h+=":",h+=p,h+=`\r
`}),h}function Fu(c,h,p){e:{for(w in p){var w=!1;break e}w=!0}w||(p=vp(p),typeof c=="string"?p!=null&&encodeURIComponent(String(p)):Qe(c,h,p))}function at(c){ze.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(at,ze);var Sb=/^https?$/i,kb=["POST","PUT"];t=at.prototype,t.Ha=function(c){this.J=c},t.ea=function(c,h,p,w){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);h=h?h.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ru.g(),this.v=this.o?V(this.o):V(Ru),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(h,String(c),!0),this.B=!1}catch($){wp(this,$);return}if(c=p||"",p=new Map(this.headers),w)if(Object.getPrototypeOf(w)===Object.prototype)for(var M in w)p.set(M,w[M]);else if(typeof w.keys=="function"&&typeof w.get=="function")for(const $ of w.keys())p.set($,w.get($));else throw Error("Unknown input type for opt_headers: "+String(w));w=Array.from(p.keys()).find($=>$.toLowerCase()=="content-type"),M=l.FormData&&c instanceof l.FormData,!(0<=Array.prototype.indexOf.call(kb,h,void 0))||w||M||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[$,Z]of p)this.g.setRequestHeader($,Z);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{bp(this),this.u=!0,this.g.send(c),this.u=!1}catch($){wp(this,$)}};function wp(c,h){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=h,c.m=5,xp(c),ol(c)}function xp(c){c.A||(c.A=!0,it(c,"complete"),it(c,"error"))}t.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,it(this,"complete"),it(this,"abort"),ol(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ol(this,!0)),at.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?_p(this):this.bb())},t.bb=function(){_p(this)};function _p(c){if(c.h&&typeof a<"u"&&(!c.v[1]||lr(c)!=4||c.Z()!=2)){if(c.u&&lr(c)==4)Ss(c.Ea,0,c);else if(it(c,"readystatechange"),lr(c)==4){c.h=!1;try{const Z=c.Z();e:switch(Z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var p;if(!(p=h)){var w;if(w=Z===0){var M=String(c.D).match(dp)[1]||null;!M&&l.self&&l.self.location&&(M=l.self.location.protocol.slice(0,-1)),w=!Sb.test(M?M.toLowerCase():"")}p=w}if(p)it(c,"complete"),it(c,"success");else{c.m=6;try{var $=2<lr(c)?c.g.statusText:""}catch{$=""}c.l=$+" ["+c.Z()+"]",xp(c)}}finally{ol(c)}}}}function ol(c,h){if(c.g){bp(c);const p=c.g,w=c.v[0]?()=>{}:null;c.g=null,c.v=null,h||it(c,"ready");try{p.onreadystatechange=w}catch{}}}function bp(c){c.I&&(l.clearTimeout(c.I),c.I=null)}t.isActive=function(){return!!this.g};function lr(c){return c.g?c.g.readyState:0}t.Z=function(){try{return 2<lr(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(c){if(this.g){var h=this.g.responseText;return c&&h.indexOf(c)==0&&(h=h.substring(c.length)),ee(h)}};function Ep(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function Nb(c){const h={};c=(c.g&&2<=lr(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let w=0;w<c.length;w++){if(x(c[w]))continue;var p=R(c[w]);const M=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();const $=h[M]||[];h[M]=$,$.push(p)}v(h,function(w){return w.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ya(c,h,p){return p&&p.internalChannelParams&&p.internalChannelParams[c]||h}function Tp(c){this.Aa=0,this.i=[],this.j=new Or,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ya("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ya("baseRetryDelayMs",5e3,c),this.cb=ya("retryDelaySeedMs",1e4,c),this.Wa=ya("forwardChannelMaxRetries",2,c),this.wa=ya("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new ip(c&&c.concurrentRequestLimit),this.Da=new Tb,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=Tp.prototype,t.la=8,t.G=1,t.connect=function(c,h,p,w){Tt(0),this.W=c,this.H=h||{},p&&w!==void 0&&(this.H.OSID=p,this.H.OAID=w),this.F=this.X,this.I=jp(this,null,this.W),cl(this)};function $u(c){if(Cp(c),c.G==3){var h=c.U++,p=or(c.I);if(Qe(p,"SID",c.K),Qe(p,"RID",h),Qe(p,"TYPE","terminate"),va(c,p),h=new Vr(c,c.j,h),h.L=2,h.v=sl(or(p)),p=!1,l.navigator&&l.navigator.sendBeacon)try{p=l.navigator.sendBeacon(h.v.toString(),"")}catch{}!p&&l.Image&&(new Image().src=h.v,p=!0),p||(h.g=Dp(h.j,null),h.g.ea(h.v)),h.F=Date.now(),tl(h)}Rp(c)}function ll(c){c.g&&(Bu(c),c.g.cancel(),c.g=null)}function Cp(c){ll(c),c.u&&(l.clearTimeout(c.u),c.u=null),ul(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&l.clearTimeout(c.s),c.s=null)}function cl(c){if(!ap(c.h)&&!c.s){c.s=!0;var h=c.Ga;de||ce(),K||(de(),K=!0),re.add(h,c),c.B=0}}function Ib(c,h){return op(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=h.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=Lr(g(c.Ga,c,h),Ap(c,c.B)),c.B++,!0)}t.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const M=new Vr(this,this.j,c);let $=this.o;if(this.S&&($?($=y($),P($,this.S)):$=this.S),this.m!==null||this.O||(M.H=$,$=null),this.P)e:{for(var h=0,p=0;p<this.i.length;p++){t:{var w=this.i[p];if("__data__"in w.map&&(w=w.map.__data__,typeof w=="string")){w=w.length;break t}w=void 0}if(w===void 0)break;if(h+=w,4096<h){h=p;break e}if(h===4096||p===this.i.length-1){h=p+1;break e}}h=1e3}else h=1e3;h=kp(this,M,h),p=or(this.I),Qe(p,"RID",c),Qe(p,"CVER",22),this.D&&Qe(p,"X-HTTP-Session-Id",this.D),va(this,p),$&&(this.O?h="headers="+encodeURIComponent(String(vp($)))+"&"+h:this.m&&Fu(p,this.m,$)),Vu(this.h,M),this.Ua&&Qe(p,"TYPE","init"),this.P?(Qe(p,"$req",h),Qe(p,"SID","null"),M.T=!0,Du(M,p,null)):Du(M,p,h),this.G=2}}else this.G==3&&(c?Sp(this,c):this.i.length==0||ap(this.h)||Sp(this))};function Sp(c,h){var p;h?p=h.l:p=c.U++;const w=or(c.I);Qe(w,"SID",c.K),Qe(w,"RID",p),Qe(w,"AID",c.T),va(c,w),c.m&&c.o&&Fu(w,c.m,c.o),p=new Vr(c,c.j,p,c.B+1),c.m===null&&(p.H=c.o),h&&(c.i=h.D.concat(c.i)),h=kp(c,p,1e3),p.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),Vu(c.h,p),Du(p,w,h)}function va(c,h){c.H&&q(c.H,function(p,w){Qe(h,w,p)}),c.l&&up({},function(p,w){Qe(h,w,p)})}function kp(c,h,p){p=Math.min(c.i.length,p);var w=c.l?g(c.l.Na,c.l,c):null;e:{var M=c.i;let $=-1;for(;;){const Z=["count="+p];$==-1?0<p?($=M[0].g,Z.push("ofs="+$)):$=0:Z.push("ofs="+$);let We=!0;for(let Nt=0;Nt<p;Nt++){let Ve=M[Nt].g;const $t=M[Nt].map;if(Ve-=$,0>Ve)$=Math.max(0,M[Nt].g-100),We=!1;else try{Cb($t,Z,"req"+Ve+"_")}catch{w&&w($t)}}if(We){w=Z.join("&");break e}}}return c=c.i.splice(0,p),h.D=c,w}function Np(c){if(!c.g&&!c.u){c.Y=1;var h=c.Fa;de||ce(),K||(de(),K=!0),re.add(h,c),c.v=0}}function Uu(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=Lr(g(c.Fa,c),Ap(c,c.v)),c.v++,!0)}t.Fa=function(){if(this.u=null,Ip(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=Lr(g(this.ab,this),c)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Tt(10),ll(this),Ip(this))};function Bu(c){c.A!=null&&(l.clearTimeout(c.A),c.A=null)}function Ip(c){c.g=new Vr(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var h=or(c.qa);Qe(h,"RID","rpc"),Qe(h,"SID",c.K),Qe(h,"AID",c.T),Qe(h,"CI",c.F?"0":"1"),!c.F&&c.ja&&Qe(h,"TO",c.ja),Qe(h,"TYPE","xmlhttp"),va(c,h),c.m&&c.o&&Fu(h,c.m,c.o),c.L&&(c.g.I=c.L);var p=c.g;c=c.ia,p.L=1,p.v=sl(or(h)),p.m=null,p.P=!0,np(p,c)}t.Za=function(){this.C!=null&&(this.C=null,ll(this),Uu(this),Tt(19))};function ul(c){c.C!=null&&(l.clearTimeout(c.C),c.C=null)}function Pp(c,h){var p=null;if(c.g==h){ul(c),Bu(c),c.g=null;var w=2}else if(Ou(c.h,h))p=h.D,lp(c.h,h),w=1;else return;if(c.G!=0){if(h.o)if(w==1){p=h.m?h.m.length:0,h=Date.now()-h.F;var M=c.B;w=Ge(),it(w,new ua(w,p)),cl(c)}else Np(c);else if(M=h.s,M==3||M==0&&0<h.X||!(w==1&&Ib(c,h)||w==2&&Uu(c)))switch(p&&0<p.length&&(h=c.h,h.i=h.i.concat(p)),M){case 1:As(c,5);break;case 4:As(c,10);break;case 3:As(c,6);break;default:As(c,2)}}}function Ap(c,h){let p=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(p*=2),p*h}function As(c,h){if(c.j.info("Error code "+h),h==2){var p=g(c.fb,c),w=c.Xa;const M=!w;w=new Ps(w||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||nl(w,"https"),sl(w),M?bb(w.toString(),p):Eb(w.toString(),p)}else Tt(2);c.G=0,c.l&&c.l.sa(h),Rp(c),Cp(c)}t.fb=function(c){c?(this.j.info("Successfully pinged google.com"),Tt(2)):(this.j.info("Failed to ping google.com"),Tt(1))};function Rp(c){if(c.G=0,c.ka=[],c.l){const h=cp(c.h);(h.length!=0||c.i.length!=0)&&(N(c.ka,h),N(c.ka,c.i),c.h.i.length=0,C(c.i),c.i.length=0),c.l.ra()}}function jp(c,h,p){var w=p instanceof Ps?or(p):new Ps(p);if(w.g!="")h&&(w.g=h+"."+w.g),rl(w,w.s);else{var M=l.location;w=M.protocol,h=h?h+"."+M.hostname:M.hostname,M=+M.port;var $=new Ps(null);w&&nl($,w),h&&($.g=h),M&&rl($,M),p&&($.l=p),w=$}return p=c.D,h=c.ya,p&&h&&Qe(w,p,h),Qe(w,"VER",c.la),va(c,w),w}function Dp(c,h,p){if(h&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=c.Ca&&!c.pa?new at(new il({eb:p})):new at(c.pa),h.Ha(c.J),h}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Mp(){}t=Mp.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function dl(){}dl.prototype.g=function(c,h){return new hn(c,h)};function hn(c,h){ze.call(this),this.g=new Tp(h),this.l=c,this.h=h&&h.messageUrlParams||null,c=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(c?c["X-WebChannel-Content-Type"]=h.messageContentType:c={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(c?c["X-WebChannel-Client-Profile"]=h.va:c={"X-WebChannel-Client-Profile":h.va}),this.g.S=c,(c=h&&h.Sb)&&!x(c)&&(this.g.m=c),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!x(h)&&(this.g.D=h,c=this.h,c!==null&&h in c&&(c=this.h,h in c&&delete c[h])),this.j=new ci(this)}k(hn,ze),hn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},hn.prototype.close=function(){$u(this.g)},hn.prototype.o=function(c){var h=this.g;if(typeof c=="string"){var p={};p.__data__=c,c=p}else this.u&&(p={},p.__data__=H(c),c=p);h.i.push(new hb(h.Ya++,c)),h.G==3&&cl(h)},hn.prototype.N=function(){this.g.l=null,delete this.j,$u(this.g),delete this.g,hn.aa.N.call(this)};function Lp(c){Ne.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var h=c.__sm__;if(h){e:{for(const p in h){c=p;break e}c=void 0}(this.i=c)&&(c=this.i,h=h!==null&&c in h?h[c]:void 0),this.data=h}else this.data=c}k(Lp,Ne);function Op(){Q.call(this),this.status=1}k(Op,Q);function ci(c){this.g=c}k(ci,Mp),ci.prototype.ua=function(){it(this.g,"a")},ci.prototype.ta=function(c){it(this.g,new Lp(c))},ci.prototype.sa=function(c){it(this.g,new Op)},ci.prototype.ra=function(){it(this.g,"b")},dl.prototype.createWebChannel=dl.prototype.g,hn.prototype.send=hn.prototype.o,hn.prototype.open=hn.prototype.m,hn.prototype.close=hn.prototype.close,Wx=function(){return new dl},zx=function(){return Ge()},Bx=ne,Oh={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Zo.NO_ERROR=0,Zo.TIMEOUT=8,Zo.HTTP_ERROR=6,Jl=Zo,Zm.COMPLETE="complete",Ux=Zm,B.EventType=U,U.OPEN="a",U.CLOSE="b",U.ERROR="c",U.MESSAGE="d",ze.prototype.listen=ze.prototype.K,Da=B,at.prototype.listenOnce=at.prototype.L,at.prototype.getLastError=at.prototype.Ka,at.prototype.getLastErrorCode=at.prototype.Ba,at.prototype.getStatus=at.prototype.Z,at.prototype.getResponseJson=at.prototype.Oa,at.prototype.getResponseText=at.prototype.oa,at.prototype.send=at.prototype.ea,at.prototype.setWithCredentials=at.prototype.Ha,$x=at}).apply(typeof Al<"u"?Al:typeof self<"u"?self:typeof window<"u"?window:{});const Ay="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}qt.UNAUTHENTICATED=new qt(null),qt.GOOGLE_CREDENTIALS=new qt("google-credentials-uid"),qt.FIRST_PARTY=new qt("first-party-uid"),qt.MOCK_USER=new qt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ia="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ys=new Qf("@firebase/firestore");function ka(){return Ys.logLevel}function oe(t,...e){if(Ys.logLevel<=je.DEBUG){const n=e.map(om);Ys.debug(`Firestore (${ia}): ${t}`,...n)}}function Sr(t,...e){if(Ys.logLevel<=je.ERROR){const n=e.map(om);Ys.error(`Firestore (${ia}): ${t}`,...n)}}function Hi(t,...e){if(Ys.logLevel<=je.WARN){const n=e.map(om);Ys.warn(`Firestore (${ia}): ${t}`,...n)}}function om(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xe(t="Unexpected state"){const e=`FIRESTORE (${ia}) INTERNAL ASSERTION FAILED: `+t;throw Sr(e),new Error(e)}function Be(t,e){t||xe()}function be(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class se extends Pr{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qx{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class nI{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(qt.UNAUTHENTICATED))}shutdown(){}}class rI{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class sI{constructor(e){this.t=e,this.currentUser=qt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Be(this.o===void 0);let r=this.i;const s=u=>this.i!==r?(r=this.i,n(u)):Promise.resolve();let i=new wr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new wr,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const u=i;e.enqueueRetryable(async()=>{await u.promise,await s(this.currentUser)})},l=u=>{oe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(u=>l(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(oe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new wr)}},0),a()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(oe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Be(typeof r.accessToken=="string"),new qx(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Be(e===null||typeof e=="string"),new qt(e)}}class iI{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=qt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class aI{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new iI(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(qt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class oI{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class lI{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){Be(this.o===void 0);const r=i=>{i.error!=null&&oe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.R;return this.R=i.token,oe("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{oe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):oe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Be(typeof n.token=="string"),this.R=n.token,new oI(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cI(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hx{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=cI(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%e.length))}return r}}function Fe(t,e){return t<e?-1:t>e?1:0}function Gi(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new se(z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new se(z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new se(z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new se(z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return xt.fromMillis(Date.now())}static fromDate(e){return xt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new xt(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Fe(this.nanoseconds,e.nanoseconds):Fe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ee{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ee(e)}static min(){return new Ee(new xt(0,0))}static max(){return new Ee(new xt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(e,n,r){n===void 0?n=0:n>e.length&&xe(),r===void 0?r=e.length-n:r>e.length-n&&xe(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return _o.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof _o?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=e.get(s),a=n.get(s);if(i<a)return-1;if(i>a)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class Xe extends _o{construct(e,n,r){return new Xe(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new se(z.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new Xe(n)}static emptyPath(){return new Xe([])}}const uI=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class At extends _o{construct(e,n,r){return new At(e,n,r)}static isValidIdentifier(e){return uI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),At.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new At(["__name__"])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new se(z.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new se(z.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new se(z.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new se(z.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new At(n)}static emptyPath(){return new At([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{constructor(e){this.path=e}static fromPath(e){return new ue(Xe.fromString(e))}static fromName(e){return new ue(Xe.fromString(e).popFirst(5))}static empty(){return new ue(Xe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Xe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Xe.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ue(new Xe(e.slice()))}}function dI(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=Ee.fromTimestamp(r===1e9?new xt(n+1,0):new xt(n,r));return new ys(s,ue.empty(),e)}function hI(t){return new ys(t.readTime,t.key,-1)}class ys{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new ys(Ee.min(),ue.empty(),-1)}static max(){return new ys(Ee.max(),ue.empty(),-1)}}function fI(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=ue.comparator(t.documentKey,e.documentKey),n!==0?n:Fe(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class pI{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uo(t){if(t.code!==z.FAILED_PRECONDITION||t.message!==mI)throw t;oe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&xe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new G((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof G?n:G.resolve(n)}catch(n){return G.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):G.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):G.reject(n)}static resolve(e){return new G((n,r)=>{n(e)})}static reject(e){return new G((n,r)=>{r(e)})}static waitFor(e){return new G((n,r)=>{let s=0,i=0,a=!1;e.forEach(l=>{++s,l.next(()=>{++i,a&&i===s&&n()},u=>r(u))}),a=!0,i===s&&n()})}static or(e){let n=G.resolve(!1);for(const r of e)n=n.next(s=>s?G.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new G((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let u=0;u<i;u++){const d=u;n(e[d]).next(f=>{a[d]=f,++l,l===i&&r(a)},f=>s(f))}})}static doWhile(e,n){return new G((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}function gI(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Bo(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lm{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}lm.oe=-1;function mu(t){return t==null}function Oc(t){return t===0&&1/t==-1/0}function yI(t){return typeof t=="number"&&Number.isInteger(t)&&!Oc(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ry(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function si(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Gx(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rt{constructor(e,n){this.comparator=e,this.root=n||Pt.EMPTY}insert(e,n){return new rt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Pt.BLACK,null,null))}remove(e){return new rt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Pt.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Rl(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Rl(this.root,e,this.comparator,!1)}getReverseIterator(){return new Rl(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Rl(this.root,e,this.comparator,!0)}}class Rl{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Pt{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??Pt.RED,this.left=s??Pt.EMPTY,this.right=i??Pt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new Pt(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Pt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return Pt.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Pt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Pt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw xe();const e=this.left.check();if(e!==this.right.check())throw xe();return e+(this.isRed()?0:1)}}Pt.EMPTY=null,Pt.RED=!0,Pt.BLACK=!1;Pt.EMPTY=new class{constructor(){this.size=0}get key(){throw xe()}get value(){throw xe()}get color(){throw xe()}get left(){throw xe()}get right(){throw xe()}copy(e,n,r,s,i){return this}insert(e,n,r){return new Pt(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e){this.comparator=e,this.data=new rt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new jy(this.data.getIterator())}getIteratorFrom(e){return new jy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof jt)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new jt(this.comparator);return n.data=e,n}}class jy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(e){this.fields=e,e.sort(At.comparator)}static empty(){return new pn([])}unionWith(e){let n=new jt(At.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new pn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Gi(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kx extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Kx("Invalid base64 string: "+i):i}}(e);return new Mt(n)}static fromUint8Array(e){const n=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new Mt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Fe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Mt.EMPTY_BYTE_STRING=new Mt("");const vI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vs(t){if(Be(!!t),typeof t=="string"){let e=0;const n=vI.exec(t);if(Be(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:lt(t.seconds),nanos:lt(t.nanos)}}function lt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Xs(t){return typeof t=="string"?Mt.fromBase64String(t):Mt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cm(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function um(t){const e=t.mapValue.fields.__previous_value__;return cm(e)?um(e):e}function bo(t){const e=vs(t.mapValue.fields.__local_write_time__.timestampValue);return new xt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wI{constructor(e,n,r,s,i,a,l,u,d){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=d}}class Eo{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new Eo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Eo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jl={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Js(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?cm(t)?4:_I(t)?9007199254740991:xI(t)?10:11:xe()}function sr(t,e){if(t===e)return!0;const n=Js(t);if(n!==Js(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return bo(t).isEqual(bo(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=vs(s.timestampValue),l=vs(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return Xs(s.bytesValue).isEqual(Xs(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return lt(s.geoPointValue.latitude)===lt(i.geoPointValue.latitude)&&lt(s.geoPointValue.longitude)===lt(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return lt(s.integerValue)===lt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=lt(s.doubleValue),l=lt(i.doubleValue);return a===l?Oc(a)===Oc(l):isNaN(a)&&isNaN(l)}return!1}(t,e);case 9:return Gi(t.arrayValue.values||[],e.arrayValue.values||[],sr);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(Ry(a)!==Ry(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!sr(a[u],l[u])))return!1;return!0}(t,e);default:return xe()}}function To(t,e){return(t.values||[]).find(n=>sr(n,e))!==void 0}function Ki(t,e){if(t===e)return 0;const n=Js(t),r=Js(e);if(n!==r)return Fe(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Fe(t.booleanValue,e.booleanValue);case 2:return function(i,a){const l=lt(i.integerValue||i.doubleValue),u=lt(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1}(t,e);case 3:return Dy(t.timestampValue,e.timestampValue);case 4:return Dy(bo(t),bo(e));case 5:return Fe(t.stringValue,e.stringValue);case 6:return function(i,a){const l=Xs(i),u=Xs(a);return l.compareTo(u)}(t.bytesValue,e.bytesValue);case 7:return function(i,a){const l=i.split("/"),u=a.split("/");for(let d=0;d<l.length&&d<u.length;d++){const f=Fe(l[d],u[d]);if(f!==0)return f}return Fe(l.length,u.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,a){const l=Fe(lt(i.latitude),lt(a.latitude));return l!==0?l:Fe(lt(i.longitude),lt(a.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return My(t.arrayValue,e.arrayValue);case 10:return function(i,a){var l,u,d,f;const m=i.fields||{},g=a.fields||{},b=(l=m.value)===null||l===void 0?void 0:l.arrayValue,k=(u=g.value)===null||u===void 0?void 0:u.arrayValue,C=Fe(((d=b==null?void 0:b.values)===null||d===void 0?void 0:d.length)||0,((f=k==null?void 0:k.values)===null||f===void 0?void 0:f.length)||0);return C!==0?C:My(b,k)}(t.mapValue,e.mapValue);case 11:return function(i,a){if(i===jl.mapValue&&a===jl.mapValue)return 0;if(i===jl.mapValue)return 1;if(a===jl.mapValue)return-1;const l=i.fields||{},u=Object.keys(l),d=a.fields||{},f=Object.keys(d);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){const g=Fe(u[m],f[m]);if(g!==0)return g;const b=Ki(l[u[m]],d[f[m]]);if(b!==0)return b}return Fe(u.length,f.length)}(t.mapValue,e.mapValue);default:throw xe()}}function Dy(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Fe(t,e);const n=vs(t),r=vs(e),s=Fe(n.seconds,r.seconds);return s!==0?s:Fe(n.nanos,r.nanos)}function My(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=Ki(n[s],r[s]);if(i)return i}return Fe(n.length,r.length)}function Qi(t){return Vh(t)}function Vh(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=vs(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Xs(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return ue.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=Vh(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${Vh(n.fields[a])}`;return s+"}"}(t.mapValue):xe()}function Ly(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Fh(t){return!!t&&"integerValue"in t}function dm(t){return!!t&&"arrayValue"in t}function Oy(t){return!!t&&"nullValue"in t}function Vy(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Zl(t){return!!t&&"mapValue"in t}function xI(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function Ka(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return si(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Ka(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ka(t.arrayValue.values[n]);return e}return Object.assign({},t)}function _I(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e){this.value=e}static empty(){return new an({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Zl(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ka(n)}setAll(e){let n=At.emptyPath(),r={},s=[];e.forEach((a,l)=>{if(!n.isImmediateParentOf(l)){const u=this.getFieldsMap(n);this.applyChanges(u,r,s),r={},s=[],n=l.popLast()}a?r[l.lastSegment()]=Ka(a):s.push(l.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());Zl(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return sr(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Zl(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){si(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new an(Ka(this.value))}}function Qx(t){const e=[];return si(t.fields,(n,r)=>{const s=new At([n]);if(Zl(r)){const i=Qx(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new pn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{constructor(e,n,r,s,i,a,l){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Gt(e,0,Ee.min(),Ee.min(),Ee.min(),an.empty(),0)}static newFoundDocument(e,n,r,s){return new Gt(e,1,n,Ee.min(),r,s,0)}static newNoDocument(e,n){return new Gt(e,2,n,Ee.min(),Ee.min(),an.empty(),0)}static newUnknownDocument(e,n){return new Gt(e,3,n,Ee.min(),Ee.min(),an.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Ee.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=an.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=an.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ee.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Gt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Gt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vc{constructor(e,n){this.position=e,this.inclusive=n}}function Fy(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],a=t.position[s];if(i.field.isKeyField()?r=ue.comparator(ue.fromName(a.referenceValue),n.key):r=Ki(a,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function $y(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!sr(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Co{constructor(e,n="asc"){this.field=e,this.dir=n}}function bI(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yx{}class mt extends Yx{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new TI(e,n,r):n==="array-contains"?new kI(e,r):n==="in"?new NI(e,r):n==="not-in"?new II(e,r):n==="array-contains-any"?new PI(e,r):new mt(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new CI(e,r):new SI(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(Ki(n,this.value)):n!==null&&Js(this.value)===Js(n)&&this.matchesComparison(Ki(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return xe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class zn extends Yx{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new zn(e,n)}matches(e){return Xx(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Xx(t){return t.op==="and"}function Jx(t){return EI(t)&&Xx(t)}function EI(t){for(const e of t.filters)if(e instanceof zn)return!1;return!0}function $h(t){if(t instanceof mt)return t.field.canonicalString()+t.op.toString()+Qi(t.value);if(Jx(t))return t.filters.map(e=>$h(e)).join(",");{const e=t.filters.map(n=>$h(n)).join(",");return`${t.op}(${e})`}}function Zx(t,e){return t instanceof mt?function(r,s){return s instanceof mt&&r.op===s.op&&r.field.isEqual(s.field)&&sr(r.value,s.value)}(t,e):t instanceof zn?function(r,s){return s instanceof zn&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,l)=>i&&Zx(a,s.filters[l]),!0):!1}(t,e):void xe()}function e_(t){return t instanceof mt?function(n){return`${n.field.canonicalString()} ${n.op} ${Qi(n.value)}`}(t):t instanceof zn?function(n){return n.op.toString()+" {"+n.getFilters().map(e_).join(" ,")+"}"}(t):"Filter"}class TI extends mt{constructor(e,n,r){super(e,n,r),this.key=ue.fromName(r.referenceValue)}matches(e){const n=ue.comparator(e.key,this.key);return this.matchesComparison(n)}}class CI extends mt{constructor(e,n){super(e,"in",n),this.keys=t_("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class SI extends mt{constructor(e,n){super(e,"not-in",n),this.keys=t_("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function t_(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>ue.fromName(r.referenceValue))}class kI extends mt{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return dm(n)&&To(n.arrayValue,this.value)}}class NI extends mt{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&To(this.value.arrayValue,n)}}class II extends mt{constructor(e,n){super(e,"not-in",n)}matches(e){if(To(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!To(this.value.arrayValue,n)}}class PI extends mt{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!dm(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>To(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AI{constructor(e,n=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.ue=null}}function Uy(t,e=null,n=[],r=[],s=null,i=null,a=null){return new AI(t,e,n,r,s,i,a)}function hm(t){const e=be(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>$h(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),mu(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Qi(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Qi(r)).join(",")),e.ue=n}return e.ue}function fm(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!bI(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Zx(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!$y(t.startAt,e.startAt)&&$y(t.endAt,e.endAt)}function Uh(t){return ue.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e,n=null,r=[],s=[],i=null,a="F",l=null,u=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function RI(t,e,n,r,s,i,a,l){return new aa(t,e,n,r,s,i,a,l)}function pu(t){return new aa(t)}function By(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function n_(t){return t.collectionGroup!==null}function Qa(t){const e=be(t);if(e.ce===null){e.ce=[];const n=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new jt(At.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.ce.push(new Co(i,r))}),n.has(At.keyField().canonicalString())||e.ce.push(new Co(At.keyField(),r))}return e.ce}function nr(t){const e=be(t);return e.le||(e.le=jI(e,Qa(t))),e.le}function jI(t,e){if(t.limitType==="F")return Uy(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Co(s.field,i)});const n=t.endAt?new Vc(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Vc(t.startAt.position,t.startAt.inclusive):null;return Uy(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Bh(t,e){const n=t.filters.concat([e]);return new aa(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Fc(t,e,n){return new aa(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function gu(t,e){return fm(nr(t),nr(e))&&t.limitType===e.limitType}function r_(t){return`${hm(nr(t))}|lt:${t.limitType}`}function hi(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>e_(s)).join(", ")}]`),mu(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Qi(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Qi(s)).join(",")),`Target(${r})`}(nr(t))}; limitType=${t.limitType})`}function yu(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ue.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of Qa(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(a,l,u){const d=Fy(a,l,u);return a.inclusive?d<=0:d<0}(r.startAt,Qa(r),s)||r.endAt&&!function(a,l,u){const d=Fy(a,l,u);return a.inclusive?d>=0:d>0}(r.endAt,Qa(r),s))}(t,e)}function DI(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function s_(t){return(e,n)=>{let r=!1;for(const s of Qa(t)){const i=MI(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function MI(t,e,n){const r=t.field.isKeyField()?ue.comparator(e.key,n.key):function(i,a,l){const u=a.data.field(i),d=l.data.field(i);return u!==null&&d!==null?Ki(u,d):xe()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return xe()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){si(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Gx(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LI=new rt(ue.comparator);function kr(){return LI}const i_=new rt(ue.comparator);function Ma(...t){let e=i_;for(const n of t)e=e.insert(n.key,n);return e}function a_(t){let e=i_;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Vs(){return Ya()}function o_(){return Ya()}function Ya(){return new oa(t=>t.toString(),(t,e)=>t.isEqual(e))}const OI=new rt(ue.comparator),VI=new jt(ue.comparator);function Ae(...t){let e=VI;for(const n of t)e=e.add(n);return e}const FI=new jt(Fe);function $I(){return FI}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mm(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Oc(e)?"-0":e}}function l_(t){return{integerValue:""+t}}function UI(t,e){return yI(e)?l_(e):mm(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vu{constructor(){this._=void 0}}function BI(t,e,n){return t instanceof So?function(s,i){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&cm(i)&&(i=um(i)),i&&(a.fields.__previous_value__=i),{mapValue:a}}(n,e):t instanceof ko?u_(t,e):t instanceof No?d_(t,e):function(s,i){const a=c_(s,i),l=zy(a)+zy(s.Pe);return Fh(a)&&Fh(s.Pe)?l_(l):mm(s.serializer,l)}(t,e)}function zI(t,e,n){return t instanceof ko?u_(t,e):t instanceof No?d_(t,e):n}function c_(t,e){return t instanceof $c?function(r){return Fh(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class So extends vu{}class ko extends vu{constructor(e){super(),this.elements=e}}function u_(t,e){const n=h_(e);for(const r of t.elements)n.some(s=>sr(s,r))||n.push(r);return{arrayValue:{values:n}}}class No extends vu{constructor(e){super(),this.elements=e}}function d_(t,e){let n=h_(e);for(const r of t.elements)n=n.filter(s=>!sr(s,r));return{arrayValue:{values:n}}}class $c extends vu{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function zy(t){return lt(t.integerValue||t.doubleValue)}function h_(t){return dm(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WI{constructor(e,n){this.field=e,this.transform=n}}function qI(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof ko&&s instanceof ko||r instanceof No&&s instanceof No?Gi(r.elements,s.elements,sr):r instanceof $c&&s instanceof $c?sr(r.Pe,s.Pe):r instanceof So&&s instanceof So}(t.transform,e.transform)}class HI{constructor(e,n){this.version=e,this.transformResults=n}}class $n{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new $n}static exists(e){return new $n(void 0,e)}static updateTime(e){return new $n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ec(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class wu{}function f_(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new pm(t.key,$n.none()):new zo(t.key,t.data,$n.none());{const n=t.data,r=an.empty();let s=new jt(At.comparator);for(let i of e.fields)if(!s.has(i)){let a=n.field(i);a===null&&i.length>1&&(i=i.popLast(),a=n.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Cs(t.key,r,new pn(s.toArray()),$n.none())}}function GI(t,e,n){t instanceof zo?function(s,i,a){const l=s.value.clone(),u=qy(s.fieldTransforms,i,a.transformResults);l.setAll(u),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(t,e,n):t instanceof Cs?function(s,i,a){if(!ec(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=qy(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(m_(s)),u.setAll(l),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(t,e,n):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,n)}function Xa(t,e,n,r){return t instanceof zo?function(i,a,l,u){if(!ec(i.precondition,a))return l;const d=i.value.clone(),f=Hy(i.fieldTransforms,u,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof Cs?function(i,a,l,u){if(!ec(i.precondition,a))return l;const d=Hy(i.fieldTransforms,u,a),f=a.data;return f.setAll(m_(i)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(m=>m.field))}(t,e,n,r):function(i,a,l){return ec(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(t,e,n)}function KI(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=c_(r.transform,s||null);i!=null&&(n===null&&(n=an.empty()),n.set(r.field,i))}return n||null}function Wy(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Gi(r,s,(i,a)=>qI(i,a))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class zo extends wu{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Cs extends wu{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function m_(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function qy(t,e,n){const r=new Map;Be(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,zI(a,l,n[s]))}return r}function Hy(t,e,n){const r=new Map;for(const s of t){const i=s.transform,a=n.data.field(s.field);r.set(s.field,BI(i,a,e))}return r}class pm extends wu{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class QI extends wu{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YI{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&GI(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Xa(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Xa(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=o_();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=n.has(s.key)?null:l;const u=f_(a,l);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(Ee.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ae())}isEqual(e){return this.batchId===e.batchId&&Gi(this.mutations,e.mutations,(n,r)=>Wy(n,r))&&Gi(this.baseMutations,e.baseMutations,(n,r)=>Wy(n,r))}}class gm{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Be(e.mutations.length===r.length);let s=function(){return OI}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new gm(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XI{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JI{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ht,De;function ZI(t){switch(t){default:return xe();case z.CANCELLED:case z.UNKNOWN:case z.DEADLINE_EXCEEDED:case z.RESOURCE_EXHAUSTED:case z.INTERNAL:case z.UNAVAILABLE:case z.UNAUTHENTICATED:return!1;case z.INVALID_ARGUMENT:case z.NOT_FOUND:case z.ALREADY_EXISTS:case z.PERMISSION_DENIED:case z.FAILED_PRECONDITION:case z.ABORTED:case z.OUT_OF_RANGE:case z.UNIMPLEMENTED:case z.DATA_LOSS:return!0}}function p_(t){if(t===void 0)return Sr("GRPC error has no .code"),z.UNKNOWN;switch(t){case ht.OK:return z.OK;case ht.CANCELLED:return z.CANCELLED;case ht.UNKNOWN:return z.UNKNOWN;case ht.DEADLINE_EXCEEDED:return z.DEADLINE_EXCEEDED;case ht.RESOURCE_EXHAUSTED:return z.RESOURCE_EXHAUSTED;case ht.INTERNAL:return z.INTERNAL;case ht.UNAVAILABLE:return z.UNAVAILABLE;case ht.UNAUTHENTICATED:return z.UNAUTHENTICATED;case ht.INVALID_ARGUMENT:return z.INVALID_ARGUMENT;case ht.NOT_FOUND:return z.NOT_FOUND;case ht.ALREADY_EXISTS:return z.ALREADY_EXISTS;case ht.PERMISSION_DENIED:return z.PERMISSION_DENIED;case ht.FAILED_PRECONDITION:return z.FAILED_PRECONDITION;case ht.ABORTED:return z.ABORTED;case ht.OUT_OF_RANGE:return z.OUT_OF_RANGE;case ht.UNIMPLEMENTED:return z.UNIMPLEMENTED;case ht.DATA_LOSS:return z.DATA_LOSS;default:return xe()}}(De=ht||(ht={}))[De.OK=0]="OK",De[De.CANCELLED=1]="CANCELLED",De[De.UNKNOWN=2]="UNKNOWN",De[De.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",De[De.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",De[De.NOT_FOUND=5]="NOT_FOUND",De[De.ALREADY_EXISTS=6]="ALREADY_EXISTS",De[De.PERMISSION_DENIED=7]="PERMISSION_DENIED",De[De.UNAUTHENTICATED=16]="UNAUTHENTICATED",De[De.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",De[De.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",De[De.ABORTED=10]="ABORTED",De[De.OUT_OF_RANGE=11]="OUT_OF_RANGE",De[De.UNIMPLEMENTED=12]="UNIMPLEMENTED",De[De.INTERNAL=13]="INTERNAL",De[De.UNAVAILABLE=14]="UNAVAILABLE",De[De.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eP(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tP=new Us([4294967295,4294967295],0);function Gy(t){const e=eP().encode(t),n=new Fx;return n.update(e),new Uint8Array(n.digest())}function Ky(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Us([n,r],0),new Us([s,i],0)]}class ym{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new La(`Invalid padding: ${n}`);if(r<0)throw new La(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new La(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new La(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=Us.fromNumber(this.Ie)}Ee(e,n,r){let s=e.add(n.multiply(Us.fromNumber(r)));return s.compare(tP)===1&&(s=new Us([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const n=Gy(e),[r,s]=Ky(n);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);if(!this.de(a))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new ym(i,s,n);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.Ie===0)return;const n=Gy(e),[r,s]=Ky(n);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);this.Ae(a)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class La extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xu{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,Wo.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new xu(Ee.min(),s,new rt(Fe),kr(),Ae())}}class Wo{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Wo(r,n,Ae(),Ae(),Ae())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e,n,r,s){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=s}}class g_{constructor(e,n){this.targetId=e,this.me=n}}class y_{constructor(e,n,r=Mt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class Qy{constructor(){this.fe=0,this.ge=Xy(),this.pe=Mt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ae(),n=Ae(),r=Ae();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:xe()}}),new Wo(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=Xy()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Be(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class nP{constructor(e){this.Le=e,this.Be=new Map,this.ke=kr(),this.qe=Yy(),this.Qe=new rt(Fe)}Ke(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{const r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:xe()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,s)=>{this.ze(s)&&n(s)})}He(e){const n=e.targetId,r=e.me.count,s=this.Je(n);if(s){const i=s.target;if(Uh(i))if(r===0){const a=new ue(i.path);this.Ue(n,a,Gt.newNoDocument(a,Ee.min()))}else Be(r===1);else{const a=this.Ye(n);if(a!==r){const l=this.Ze(e),u=l?this.Xe(l,e,a):1;if(u!==0){this.je(n);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,d)}}}}}Ze(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let a,l;try{a=Xs(r).toUint8Array()}catch(u){if(u instanceof Kx)return Hi("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new ym(a,s,i)}catch(u){return Hi(u instanceof La?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.Ie===0?null:l}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const a=this.Le.tt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.Ue(n,i,null),s++)}),s}rt(e){const n=new Map;this.Be.forEach((i,a)=>{const l=this.Je(a);if(l){if(i.current&&Uh(l.target)){const u=new ue(l.target.path);this.ke.get(u)!==null||this.it(a,u)||this.Ue(a,u,Gt.newNoDocument(u,e))}i.be&&(n.set(a,i.ve()),i.Ce())}});let r=Ae();this.qe.forEach((i,a)=>{let l=!0;a.forEachWhile(u=>{const d=this.Je(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.ke.forEach((i,a)=>a.setReadTime(e));const s=new xu(e,n,this.Qe,this.ke,r);return this.ke=kr(),this.qe=Yy(),this.Qe=new rt(Fe),s}$e(e,n){if(!this.ze(e))return;const r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,n)?s.Fe(n,1):s.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const n=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new Qy,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new jt(Fe),this.qe=this.qe.insert(e,n)),n}ze(e){const n=this.Je(e)!==null;return n||oe("WatchChangeAggregator","Detected inactive target",e),n}Je(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Qy),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function Yy(){return new rt(ue.comparator)}function Xy(){return new rt(ue.comparator)}const rP=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),sP=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),iP=(()=>({and:"AND",or:"OR"}))();class aP{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function zh(t,e){return t.useProto3Json||mu(e)?e:{value:e}}function Uc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function v_(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function oP(t,e){return Uc(t,e.toTimestamp())}function rr(t){return Be(!!t),Ee.fromTimestamp(function(n){const r=vs(n);return new xt(r.seconds,r.nanos)}(t))}function vm(t,e){return Wh(t,e).canonicalString()}function Wh(t,e){const n=function(s){return new Xe(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function w_(t){const e=Xe.fromString(t);return Be(T_(e)),e}function qh(t,e){return vm(t.databaseId,e.path)}function Td(t,e){const n=w_(e);if(n.get(1)!==t.databaseId.projectId)throw new se(z.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new se(z.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ue(__(n))}function x_(t,e){return vm(t.databaseId,e)}function lP(t){const e=w_(t);return e.length===4?Xe.emptyPath():__(e)}function Hh(t){return new Xe(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function __(t){return Be(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Jy(t,e,n){return{name:qh(t,e),fields:n.value.mapValue.fields}}function cP(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:xe()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,f){return d.useProto3Json?(Be(f===void 0||typeof f=="string"),Mt.fromBase64String(f||"")):(Be(f===void 0||f instanceof Buffer||f instanceof Uint8Array),Mt.fromUint8Array(f||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(d){const f=d.code===void 0?z.UNKNOWN:p_(d.code);return new se(f,d.message||"")}(a);n=new y_(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Td(t,r.document.name),i=rr(r.document.updateTime),a=r.document.createTime?rr(r.document.createTime):Ee.min(),l=new an({mapValue:{fields:r.document.fields}}),u=Gt.newFoundDocument(s,i,a,l),d=r.targetIds||[],f=r.removedTargetIds||[];n=new tc(d,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Td(t,r.document),i=r.readTime?rr(r.readTime):Ee.min(),a=Gt.newNoDocument(s,i),l=r.removedTargetIds||[];n=new tc([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Td(t,r.document),i=r.removedTargetIds||[];n=new tc([],i,s,null)}else{if(!("filter"in e))return xe();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new JI(s,i),l=r.targetId;n=new g_(l,a)}}return n}function uP(t,e){let n;if(e instanceof zo)n={update:Jy(t,e.key,e.value)};else if(e instanceof pm)n={delete:qh(t,e.key)};else if(e instanceof Cs)n={update:Jy(t,e.key,e.data),updateMask:wP(e.fieldMask)};else{if(!(e instanceof QI))return xe();n={verify:qh(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,a){const l=a.transform;if(l instanceof So)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof ko)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof No)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof $c)return{fieldPath:a.field.canonicalString(),increment:l.Pe};throw xe()}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:oP(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:xe()}(t,e.precondition)),n}function dP(t,e){return t&&t.length>0?(Be(e!==void 0),t.map(n=>function(s,i){let a=s.updateTime?rr(s.updateTime):rr(i);return a.isEqual(Ee.min())&&(a=rr(i)),new HI(a,s.transformResults||[])}(n,e))):[]}function hP(t,e){return{documents:[x_(t,e.path)]}}function fP(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=x_(t,s);const i=function(d){if(d.length!==0)return E_(zn.create(d,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const a=function(d){if(d.length!==0)return d.map(f=>function(g){return{field:fi(g.field),direction:gP(g.dir)}}(f))}(e.orderBy);a&&(n.structuredQuery.orderBy=a);const l=zh(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:n,parent:s}}function mP(t){let e=lP(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Be(r===1);const f=n.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];n.where&&(i=function(m){const g=b_(m);return g instanceof zn&&Jx(g)?g.getFilters():[g]}(n.where));let a=[];n.orderBy&&(a=function(m){return m.map(g=>function(k){return new Co(mi(k.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(g))}(n.orderBy));let l=null;n.limit&&(l=function(m){let g;return g=typeof m=="object"?m.value:m,mu(g)?null:g}(n.limit));let u=null;n.startAt&&(u=function(m){const g=!!m.before,b=m.values||[];return new Vc(b,g)}(n.startAt));let d=null;return n.endAt&&(d=function(m){const g=!m.before,b=m.values||[];return new Vc(b,g)}(n.endAt)),RI(e,s,a,i,l,"F",u,d)}function pP(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return xe()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function b_(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=mi(n.unaryFilter.field);return mt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=mi(n.unaryFilter.field);return mt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=mi(n.unaryFilter.field);return mt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=mi(n.unaryFilter.field);return mt.create(a,"!=",{nullValue:"NULL_VALUE"});default:return xe()}}(t):t.fieldFilter!==void 0?function(n){return mt.create(mi(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return xe()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return zn.create(n.compositeFilter.filters.map(r=>b_(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return xe()}}(n.compositeFilter.op))}(t):xe()}function gP(t){return rP[t]}function yP(t){return sP[t]}function vP(t){return iP[t]}function fi(t){return{fieldPath:t.canonicalString()}}function mi(t){return At.fromServerFormat(t.fieldPath)}function E_(t){return t instanceof mt?function(n){if(n.op==="=="){if(Vy(n.value))return{unaryFilter:{field:fi(n.field),op:"IS_NAN"}};if(Oy(n.value))return{unaryFilter:{field:fi(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Vy(n.value))return{unaryFilter:{field:fi(n.field),op:"IS_NOT_NAN"}};if(Oy(n.value))return{unaryFilter:{field:fi(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fi(n.field),op:yP(n.op),value:n.value}}}(t):t instanceof zn?function(n){const r=n.getFilters().map(s=>E_(s));return r.length===1?r[0]:{compositeFilter:{op:vP(n.op),filters:r}}}(t):xe()}function wP(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function T_(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(e,n,r,s,i=Ee.min(),a=Ee.min(),l=Mt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new ts(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ts(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ts(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ts(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xP{constructor(e){this.ct=e}}function _P(t){const e=mP({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Fc(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bP{constructor(){this.un=new EP}addToCollectionParentIndex(e,n){return this.un.add(n),G.resolve()}getCollectionParents(e,n){return G.resolve(this.un.getEntries(n))}addFieldIndex(e,n){return G.resolve()}deleteFieldIndex(e,n){return G.resolve()}deleteAllFieldIndexes(e){return G.resolve()}createTargetIndexes(e,n){return G.resolve()}getDocumentsMatchingTarget(e,n){return G.resolve(null)}getIndexType(e,n){return G.resolve(0)}getFieldIndexes(e,n){return G.resolve([])}getNextCollectionGroupToUpdate(e){return G.resolve(null)}getMinOffset(e,n){return G.resolve(ys.min())}getMinOffsetFromCollectionGroup(e,n){return G.resolve(ys.min())}updateCollectionGroup(e,n,r){return G.resolve()}updateIndexEntries(e,n){return G.resolve()}}class EP{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new jt(Xe.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new jt(Xe.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Yi(0)}static kn(){return new Yi(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TP{constructor(){this.changes=new oa(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Gt.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?G.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SP{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&Xa(r.mutation,s,pn.empty(),xt.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Ae()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Ae()){const s=Vs();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let a=Ma();return i.forEach((l,u)=>{a=a.insert(l,u.overlayedDocument)}),a}))}getOverlayedDocuments(e,n){const r=Vs();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Ae()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,l)=>{n.set(a,l)})})}computeViews(e,n,r,s){let i=kr();const a=Ya(),l=function(){return Ya()}();return n.forEach((u,d)=>{const f=r.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof Cs)?i=i.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),Xa(f.mutation,d,f.mutation.getFieldMask(),xt.now())):a.set(d.key,pn.empty())}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((d,f)=>a.set(d,f)),n.forEach((d,f)=>{var m;return l.set(d,new CP(f,(m=a.get(d))!==null&&m!==void 0?m:null))}),l))}recalculateAndSaveOverlays(e,n){const r=Ya();let s=new rt((a,l)=>a-l),i=Ae();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(a=>{for(const l of a)l.keys().forEach(u=>{const d=n.get(u);if(d===null)return;let f=r.get(u)||pn.empty();f=l.applyToLocalView(d,f),r.set(u,f);const m=(s.get(l.batchId)||Ae()).add(u);s=s.insert(l.batchId,m)})}).next(()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),d=u.key,f=u.value,m=o_();f.forEach(g=>{if(!i.has(g)){const b=f_(n.get(g),r.get(g));b!==null&&m.set(g,b),i=i.add(g)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,m))}return G.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(a){return ue.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):n_(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):G.resolve(Vs());let l=-1,u=i;return a.next(d=>G.forEach(d,(f,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),i.get(f)?G.resolve():this.remoteDocumentCache.getEntry(e,f).next(g=>{u=u.insert(f,g)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,u,d,Ae())).next(f=>({batchId:l,changes:a_(f)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new ue(n)).next(r=>{let s=Ma();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let a=Ma();return this.indexManager.getCollectionParents(e,i).next(l=>G.forEach(l,u=>{const d=function(m,g){return new aa(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(n,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(f=>{f.forEach((m,g)=>{a=a.insert(m,g)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(a=>{i.forEach((u,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,Gt.newInvalidDocument(f)))});let l=Ma();return a.forEach((u,d)=>{const f=i.get(u);f!==void 0&&Xa(f.mutation,d,pn.empty(),xt.now()),yu(n,d)&&(l=l.insert(u,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kP{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,n){return G.resolve(this.hr.get(n))}saveBundleMetadata(e,n){return this.hr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:rr(s.createTime)}}(n)),G.resolve()}getNamedQuery(e,n){return G.resolve(this.Pr.get(n))}saveNamedQuery(e,n){return this.Pr.set(n.name,function(s){return{name:s.name,query:_P(s.bundledQuery),readTime:rr(s.readTime)}}(n)),G.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NP{constructor(){this.overlays=new rt(ue.comparator),this.Ir=new Map}getOverlay(e,n){return G.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Vs();return G.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.ht(e,n,i)}),G.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),G.resolve()}getOverlaysForCollection(e,n,r){const s=Vs(),i=n.length+1,a=new ue(n.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const u=l.getNext().value,d=u.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return G.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new rt((d,f)=>d-f);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let f=i.get(d.largestBatchId);f===null&&(f=Vs(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const l=Vs(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((d,f)=>l.set(d,f)),!(l.size()>=s)););return G.resolve(l)}ht(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new XI(n,r));let i=this.Ir.get(n);i===void 0&&(i=Ae(),this.Ir.set(n,i)),this.Ir.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IP{constructor(){this.sessionToken=Mt.EMPTY_BYTE_STRING}getSessionToken(e){return G.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,G.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wm{constructor(){this.Tr=new jt(Ct.Er),this.dr=new jt(Ct.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,n){const r=new Ct(e,n);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Vr(new Ct(e,n))}mr(e,n){e.forEach(r=>this.removeReference(r,n))}gr(e){const n=new ue(new Xe([])),r=new Ct(n,e),s=new Ct(n,e+1),i=[];return this.dr.forEachInRange([r,s],a=>{this.Vr(a),i.push(a.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const n=new ue(new Xe([])),r=new Ct(n,e),s=new Ct(n,e+1);let i=Ae();return this.dr.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){const n=new Ct(e,0),r=this.Tr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Ct{constructor(e,n){this.key=e,this.wr=n}static Er(e,n){return ue.comparator(e.key,n.key)||Fe(e.wr,n.wr)}static Ar(e,n){return Fe(e.wr,n.wr)||ue.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new jt(Ct.Er)}checkEmpty(e){return G.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new YI(i,n,r,s);this.mutationQueue.push(a);for(const l of s)this.br=this.br.add(new Ct(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return G.resolve(a)}lookupMutationBatch(e,n){return G.resolve(this.Dr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.vr(r),i=s<0?0:s;return G.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return G.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return G.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Ct(n,0),s=new Ct(n,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],a=>{const l=this.Dr(a.wr);i.push(l)}),G.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new jt(Fe);return n.forEach(s=>{const i=new Ct(s,0),a=new Ct(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,a],l=>{r=r.add(l.wr)})}),G.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;ue.isDocumentKey(i)||(i=i.child(""));const a=new Ct(new ue(i),0);let l=new jt(Fe);return this.br.forEachWhile(u=>{const d=u.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(u.wr)),!0)},a),G.resolve(this.Cr(l))}Cr(e){const n=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){Be(this.Fr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return G.forEach(n.mutations,s=>{const i=new Ct(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,n){const r=new Ct(n,0),s=this.br.firstAfterOrEqual(r);return G.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,G.resolve()}Fr(e,n){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const n=this.vr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AP{constructor(e){this.Mr=e,this.docs=function(){return new rt(ue.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,a=this.Mr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return G.resolve(r?r.document.mutableCopy():Gt.newInvalidDocument(n))}getEntries(e,n){let r=kr();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Gt.newInvalidDocument(s))}),G.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=kr();const a=n.path,l=new ue(a.child("")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||fI(hI(f),r)<=0||(s.has(f.key)||yu(n,f))&&(i=i.insert(f.key,f.mutableCopy()))}return G.resolve(i)}getAllFromCollectionGroup(e,n,r,s){xe()}Or(e,n){return G.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new RP(this)}getSize(e){return G.resolve(this.size)}}class RP extends TP{constructor(e){super(),this.cr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),G.waitFor(n)}getFromCache(e,n){return this.cr.getEntry(e,n)}getAllFromCache(e,n){return this.cr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jP{constructor(e){this.persistence=e,this.Nr=new oa(n=>hm(n),fm),this.lastRemoteSnapshotVersion=Ee.min(),this.highestTargetId=0,this.Lr=0,this.Br=new wm,this.targetCount=0,this.kr=Yi.Bn()}forEachTarget(e,n){return this.Nr.forEach((r,s)=>n(s)),G.resolve()}getLastRemoteSnapshotVersion(e){return G.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return G.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),G.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Lr&&(this.Lr=n),G.resolve()}Kn(e){this.Nr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.kr=new Yi(n),this.highestTargetId=n),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,n){return this.Kn(n),this.targetCount+=1,G.resolve()}updateTargetData(e,n){return this.Kn(n),G.resolve()}removeTargetData(e,n){return this.Nr.delete(n.target),this.Br.gr(n.targetId),this.targetCount-=1,G.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.Nr.forEach((a,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),G.waitFor(i).next(()=>s)}getTargetCount(e){return G.resolve(this.targetCount)}getTargetData(e,n){const r=this.Nr.get(n)||null;return G.resolve(r)}addMatchingKeys(e,n,r){return this.Br.Rr(n,r),G.resolve()}removeMatchingKeys(e,n,r){this.Br.mr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),G.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.Br.gr(n),G.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Br.yr(n);return G.resolve(r)}containsKey(e,n){return G.resolve(this.Br.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP{constructor(e,n){this.qr={},this.overlays={},this.Qr=new lm(0),this.Kr=!1,this.Kr=!0,this.$r=new IP,this.referenceDelegate=e(this),this.Ur=new jP(this),this.indexManager=new bP,this.remoteDocumentCache=function(s){return new AP(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new xP(n),this.Gr=new kP(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new NP,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.qr[e.toKey()];return r||(r=new PP(n,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,n,r){oe("MemoryPersistence","Starting transaction:",e);const s=new MP(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,n){return G.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,n)))}}class MP extends pI{constructor(e){super(),this.currentSequenceNumber=e}}class xm{constructor(e){this.persistence=e,this.Jr=new wm,this.Yr=null}static Zr(e){return new xm(e)}get Xr(){if(this.Yr)return this.Yr;throw xe()}addReference(e,n,r){return this.Jr.addReference(r,n),this.Xr.delete(r.toString()),G.resolve()}removeReference(e,n,r){return this.Jr.removeReference(r,n),this.Xr.add(r.toString()),G.resolve()}markPotentiallyOrphaned(e,n){return this.Xr.add(n.toString()),G.resolve()}removeTarget(e,n){this.Jr.gr(n.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}zr(){this.Yr=new Set}jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return G.forEach(this.Xr,r=>{const s=ue.fromPath(r);return this.ei(e,s).next(i=>{i||n.removeEntry(s,Ee.min())})}).next(()=>(this.Yr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ei(e,n).next(r=>{r?this.Xr.delete(n.toString()):this.Xr.add(n.toString())})}Wr(e){return 0}ei(e,n){return G.or([()=>G.resolve(this.Jr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Hr(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.$i=r,this.Ui=s}static Wi(e,n){let r=Ae(),s=Ae();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new _m(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LP{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OP{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return _C()?8:gI(Yt())>0?6:4}()}initialize(e,n){this.Ji=e,this.indexManager=n,this.Gi=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.Yi(e,n).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.Zi(e,n,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new LP;return this.Xi(e,n,a).next(l=>{if(i.result=l,this.zi)return this.es(e,n,a,l.size)})}).next(()=>i.result)}es(e,n,r,s){return r.documentReadCount<this.ji?(ka()<=je.DEBUG&&oe("QueryEngine","SDK will not create cache indexes for query:",hi(n),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),G.resolve()):(ka()<=je.DEBUG&&oe("QueryEngine","Query:",hi(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(ka()<=je.DEBUG&&oe("QueryEngine","The SDK decides to create cache indexes for query:",hi(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,nr(n))):G.resolve())}Yi(e,n){if(By(n))return G.resolve(null);let r=nr(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=Fc(n,null,"F"),r=nr(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const a=Ae(...i);return this.Ji.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(u=>{const d=this.ts(n,l);return this.ns(n,d,a,u.readTime)?this.Yi(e,Fc(n,null,"F")):this.rs(e,d,n,u)}))})))}Zi(e,n,r,s){return By(n)||s.isEqual(Ee.min())?G.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const a=this.ts(n,i);return this.ns(n,a,r,s)?G.resolve(null):(ka()<=je.DEBUG&&oe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),hi(n)),this.rs(e,a,n,dI(s,-1)).next(l=>l))})}ts(e,n){let r=new jt(s_(e));return n.forEach((s,i)=>{yu(e,i)&&(r=r.add(i))}),r}ns(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,n,r){return ka()<=je.DEBUG&&oe("QueryEngine","Using full collection scan to execute query:",hi(n)),this.Ji.getDocumentsMatchingQuery(e,n,ys.min(),r)}rs(e,n,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{constructor(e,n,r,s){this.persistence=e,this.ss=n,this.serializer=s,this.os=new rt(Fe),this._s=new oa(i=>hm(i),fm),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new SP(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.os))}}function FP(t,e,n,r){return new VP(t,e,n,r)}async function C_(t,e){const n=be(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.ls(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const a=[],l=[];let u=Ae();for(const d of s){a.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}for(const d of i){l.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}return n.localDocuments.getDocuments(r,u).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:l}))})})}function $P(t,e){const n=be(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(l,u,d,f){const m=d.batch,g=m.keys();let b=G.resolve();return g.forEach(k=>{b=b.next(()=>f.getEntry(u,k)).next(C=>{const N=d.docVersions.get(k);Be(N!==null),C.version.compareTo(N)<0&&(m.applyToRemoteDocument(C,d),C.isValidDocument()&&(C.setReadTime(d.commitVersion),f.addEntry(C)))})}),b.next(()=>l.mutationQueue.removeMutationBatch(u,m))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let u=Ae();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(u=u.add(l.batch.mutations[d].key));return u}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function S_(t){const e=be(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ur.getLastRemoteSnapshotVersion(n))}function UP(t,e){const n=be(t),r=e.snapshotVersion;let s=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=n.cs.newChangeBuffer({trackRemovals:!0});s=n.os;const l=[];e.targetChanges.forEach((f,m)=>{const g=s.get(m);if(!g)return;l.push(n.Ur.removeMatchingKeys(i,f.removedDocuments,m).next(()=>n.Ur.addMatchingKeys(i,f.addedDocuments,m)));let b=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?b=b.withResumeToken(Mt.EMPTY_BYTE_STRING,Ee.min()).withLastLimboFreeSnapshotVersion(Ee.min()):f.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(f.resumeToken,r)),s=s.insert(m,b),function(C,N,_){return C.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=3e8?!0:_.addedDocuments.size+_.modifiedDocuments.size+_.removedDocuments.size>0}(g,b,f)&&l.push(n.Ur.updateTargetData(i,b))});let u=kr(),d=Ae();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(i,f))}),l.push(BP(i,a,e.documentUpdates).next(f=>{u=f.Ps,d=f.Is})),!r.isEqual(Ee.min())){const f=n.Ur.getLastRemoteSnapshotVersion(i).next(m=>n.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(f)}return G.waitFor(l).next(()=>a.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,u,d)).next(()=>u)}).then(i=>(n.os=s,i))}function BP(t,e,n){let r=Ae(),s=Ae();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let a=kr();return n.forEach((l,u)=>{const d=i.get(l);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),u.isNoDocument()&&u.version.isEqual(Ee.min())?(e.removeEntry(l,u.readTime),a=a.insert(l,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),a=a.insert(l,u)):oe("LocalStore","Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",u.version)}),{Ps:a,Is:s}})}function zP(t,e){const n=be(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function WP(t,e){const n=be(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Ur.getTargetData(r,e).next(i=>i?(s=i,G.resolve(s)):n.Ur.allocateTargetId(r).next(a=>(s=new ts(e,a,"TargetPurposeListen",r.currentSequenceNumber),n.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.os=n.os.insert(r.targetId,r),n._s.set(e,r.targetId)),r})}async function Gh(t,e,n){const r=be(t),s=r.os.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!Bo(a))throw a;oe("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Zy(t,e,n){const r=be(t);let s=Ee.min(),i=Ae();return r.persistence.runTransaction("Execute query","readwrite",a=>function(u,d,f){const m=be(u),g=m._s.get(f);return g!==void 0?G.resolve(m.os.get(g)):m.Ur.getTargetData(d,f)}(r,a,nr(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,l.targetId).next(u=>{i=u})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,n?s:Ee.min(),n?i:Ae())).next(l=>(qP(r,DI(e),l),{documents:l,Ts:i})))}function qP(t,e,n){let r=t.us.get(e)||Ee.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.us.set(e,r)}class ev{constructor(){this.activeTargetIds=$I()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class HP{constructor(){this.so=new ev,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,n,r){this.oo[e]=n}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new ev,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GP{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tv{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){oe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){oe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dl=null;function Cd(){return Dl===null?Dl=function(){return 268435456+Math.round(2147483648*Math.random())}():Dl++,"0x"+Dl.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QP{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wt="WebChannelConnection";class YP extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+n.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(n,r,s,i,a){const l=Cd(),u=this.xo(n,r.toUriEncodedString());oe("RestConnection",`Sending RPC '${n}' ${l}:`,u,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,i,a),this.No(n,u,d,s).then(f=>(oe("RestConnection",`Received RPC '${n}' ${l}: `,f),f),f=>{throw Hi("RestConnection",`RPC '${n}' ${l} failed with error: `,f,"url: ",u,"request:",s),f})}Lo(n,r,s,i,a,l){return this.Mo(n,r,s,i,a)}Oo(n,r,s){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ia}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,a)=>n[a]=i),s&&s.headers.forEach((i,a)=>n[a]=i)}xo(n,r){const s=KP[n];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,n,r,s){const i=Cd();return new Promise((a,l)=>{const u=new $x;u.setWithCredentials(!0),u.listenOnce(Ux.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Jl.NO_ERROR:const f=u.getResponseJson();oe(Wt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(f)),a(f);break;case Jl.TIMEOUT:oe(Wt,`RPC '${e}' ${i} timed out`),l(new se(z.DEADLINE_EXCEEDED,"Request time out"));break;case Jl.HTTP_ERROR:const m=u.getStatus();if(oe(Wt,`RPC '${e}' ${i} failed with status:`,m,"response text:",u.getResponseText()),m>0){let g=u.getResponseJson();Array.isArray(g)&&(g=g[0]);const b=g==null?void 0:g.error;if(b&&b.status&&b.message){const k=function(N){const _=N.toLowerCase().replace(/_/g,"-");return Object.values(z).indexOf(_)>=0?_:z.UNKNOWN}(b.status);l(new se(k,b.message))}else l(new se(z.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new se(z.UNAVAILABLE,"Connection failed."));break;default:xe()}}finally{oe(Wt,`RPC '${e}' ${i} completed.`)}});const d=JSON.stringify(s);oe(Wt,`RPC '${e}' ${i} sending request:`,s),u.send(n,"POST",d,r,15)})}Bo(e,n,r){const s=Cd(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Wx(),l=zx(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,n,r),u.encodeInitMessageHeaders=!0;const f=i.join("");oe(Wt,`Creating RPC '${e}' stream ${s}: ${f}`,u);const m=a.createWebChannel(f,u);let g=!1,b=!1;const k=new QP({Io:N=>{b?oe(Wt,`Not sending because RPC '${e}' stream ${s} is closed:`,N):(g||(oe(Wt,`Opening RPC '${e}' stream ${s} transport.`),m.open(),g=!0),oe(Wt,`RPC '${e}' stream ${s} sending:`,N),m.send(N))},To:()=>m.close()}),C=(N,_,x)=>{N.listen(_,I=>{try{x(I)}catch(D){setTimeout(()=>{throw D},0)}})};return C(m,Da.EventType.OPEN,()=>{b||(oe(Wt,`RPC '${e}' stream ${s} transport opened.`),k.yo())}),C(m,Da.EventType.CLOSE,()=>{b||(b=!0,oe(Wt,`RPC '${e}' stream ${s} transport closed`),k.So())}),C(m,Da.EventType.ERROR,N=>{b||(b=!0,Hi(Wt,`RPC '${e}' stream ${s} transport errored:`,N),k.So(new se(z.UNAVAILABLE,"The operation could not be completed")))}),C(m,Da.EventType.MESSAGE,N=>{var _;if(!b){const x=N.data[0];Be(!!x);const I=x,D=I.error||((_=I[0])===null||_===void 0?void 0:_.error);if(D){oe(Wt,`RPC '${e}' stream ${s} received error:`,D);const F=D.status;let q=function(S){const P=ht[S];if(P!==void 0)return p_(P)}(F),v=D.message;q===void 0&&(q=z.INTERNAL,v="Unknown error status: "+F+" with message "+D.message),b=!0,k.So(new se(q,v)),m.close()}else oe(Wt,`RPC '${e}' stream ${s} received:`,x),k.bo(x)}}),C(l,Bx.STAT_EVENT,N=>{N.stat===Oh.PROXY?oe(Wt,`RPC '${e}' stream ${s} detected buffering proxy`):N.stat===Oh.NOPROXY&&oe(Wt,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{k.wo()},0),k}}function Sd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _u(t){return new aP(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k_{constructor(e,n,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=n,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,n-r);s>0&&oe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N_{constructor(e,n,r,s,i,a,l,u){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new k_(e,n)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,n){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():n&&n.code===z.RESOURCE_EXHAUSTED?(Sr(n.toString()),Sr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===z.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(n)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===n&&this.P_(r,s)},r=>{e(()=>{const s=new se(z.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,n){const r=this.h_(this.Yo);this.stream=this.T_(e,n),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return oe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return n=>{this.ui.enqueueAndForget(()=>this.Yo===e?n():(oe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class XP extends N_{constructor(e,n,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}T_(e,n){return this.connection.Bo("Listen",e,n)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const n=cP(this.serializer,e),r=function(i){if(!("targetChange"in i))return Ee.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?Ee.min():a.readTime?rr(a.readTime):Ee.min()}(e);return this.listener.d_(n,r)}A_(e){const n={};n.database=Hh(this.serializer),n.addTarget=function(i,a){let l;const u=a.target;if(l=Uh(u)?{documents:hP(i,u)}:{query:fP(i,u)._t},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=v_(i,a.resumeToken);const d=zh(i,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(Ee.min())>0){l.readTime=Uc(i,a.snapshotVersion.toTimestamp());const d=zh(i,a.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=pP(this.serializer,e);r&&(n.labels=r),this.a_(n)}R_(e){const n={};n.database=Hh(this.serializer),n.removeTarget=e,this.a_(n)}}class JP extends N_{constructor(e,n,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,n){return this.connection.Bo("Write",e,n)}E_(e){return Be(!!e.streamToken),this.lastStreamToken=e.streamToken,Be(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Be(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const n=dP(e.writeResults,e.commitTime),r=rr(e.commitTime);return this.listener.g_(r,n)}p_(){const e={};e.database=Hh(this.serializer),this.a_(e)}m_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>uP(this.serializer,r))};this.a_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZP extends class{}{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new se(z.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,n,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Mo(e,Wh(n,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new se(z.UNKNOWN,i.toString())})}Lo(e,n,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Lo(e,Wh(n,r),s,a,l,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new se(z.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class eA{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Sr(n),this.D_=!1):oe("OnlineStateTracker",n)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tA{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(a=>{r.enqueueAndForget(async()=>{ii(this)&&(oe("RemoteStore","Restarting streams for network reachability change."),await async function(u){const d=be(u);d.L_.add(4),await Ho(d),d.q_.set("Unknown"),d.L_.delete(4),await qo(d)}(this))})}),this.q_=new eA(r,s)}}async function qo(t){if(ii(t))for(const e of t.B_)await e(!0)}async function Ho(t){for(const e of t.B_)await e(!1)}function I_(t,e){const n=be(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),Cm(n)?Tm(n):la(n).r_()&&Em(n,e))}function bm(t,e){const n=be(t),r=la(n);n.N_.delete(e),r.r_()&&P_(n,e),n.N_.size===0&&(r.r_()?r.o_():ii(n)&&n.q_.set("Unknown"))}function Em(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ee.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}la(t).A_(e)}function P_(t,e){t.Q_.xe(e),la(t).R_(e)}function Tm(t){t.Q_=new nP({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),la(t).start(),t.q_.v_()}function Cm(t){return ii(t)&&!la(t).n_()&&t.N_.size>0}function ii(t){return be(t).L_.size===0}function A_(t){t.Q_=void 0}async function nA(t){t.q_.set("Online")}async function rA(t){t.N_.forEach((e,n)=>{Em(t,e)})}async function sA(t,e){A_(t),Cm(t)?(t.q_.M_(e),Tm(t)):t.q_.set("Unknown")}async function iA(t,e,n){if(t.q_.set("Online"),e instanceof y_&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const l of i.targetIds)s.N_.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.N_.delete(l),s.Q_.removeTarget(l))}(t,e)}catch(r){oe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Bc(t,r)}else if(e instanceof tc?t.Q_.Ke(e):e instanceof g_?t.Q_.He(e):t.Q_.We(e),!n.isEqual(Ee.min()))try{const r=await S_(t.localStore);n.compareTo(r)>=0&&await function(i,a){const l=i.Q_.rt(a);return l.targetChanges.forEach((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const f=i.N_.get(d);f&&i.N_.set(d,f.withResumeToken(u.resumeToken,a))}}),l.targetMismatches.forEach((u,d)=>{const f=i.N_.get(u);if(!f)return;i.N_.set(u,f.withResumeToken(Mt.EMPTY_BYTE_STRING,f.snapshotVersion)),P_(i,u);const m=new ts(f.target,u,d,f.sequenceNumber);Em(i,m)}),i.remoteSyncer.applyRemoteEvent(l)}(t,n)}catch(r){oe("RemoteStore","Failed to raise snapshot:",r),await Bc(t,r)}}async function Bc(t,e,n){if(!Bo(e))throw e;t.L_.add(1),await Ho(t),t.q_.set("Offline"),n||(n=()=>S_(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{oe("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await qo(t)})}function R_(t,e){return e().catch(n=>Bc(t,n,e))}async function bu(t){const e=be(t),n=ws(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;aA(e);)try{const s=await zP(e.localStore,r);if(s===null){e.O_.length===0&&n.o_();break}r=s.batchId,oA(e,s)}catch(s){await Bc(e,s)}j_(e)&&D_(e)}function aA(t){return ii(t)&&t.O_.length<10}function oA(t,e){t.O_.push(e);const n=ws(t);n.r_()&&n.V_&&n.m_(e.mutations)}function j_(t){return ii(t)&&!ws(t).n_()&&t.O_.length>0}function D_(t){ws(t).start()}async function lA(t){ws(t).p_()}async function cA(t){const e=ws(t);for(const n of t.O_)e.m_(n.mutations)}async function uA(t,e,n){const r=t.O_.shift(),s=gm.from(r,e,n);await R_(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await bu(t)}async function dA(t,e){e&&ws(t).V_&&await async function(r,s){if(function(a){return ZI(a)&&a!==z.ABORTED}(s.code)){const i=r.O_.shift();ws(r).s_(),await R_(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await bu(r)}}(t,e),j_(t)&&D_(t)}async function nv(t,e){const n=be(t);n.asyncQueue.verifyOperationInProgress(),oe("RemoteStore","RemoteStore received new credentials");const r=ii(n);n.L_.add(3),await Ho(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await qo(n)}async function hA(t,e){const n=be(t);e?(n.L_.delete(2),await qo(n)):e||(n.L_.add(2),await Ho(n),n.q_.set("Unknown"))}function la(t){return t.K_||(t.K_=function(n,r,s){const i=be(n);return i.w_(),new XP(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:nA.bind(null,t),Ro:rA.bind(null,t),mo:sA.bind(null,t),d_:iA.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),Cm(t)?Tm(t):t.q_.set("Unknown")):(await t.K_.stop(),A_(t))})),t.K_}function ws(t){return t.U_||(t.U_=function(n,r,s){const i=be(n);return i.w_(),new JP(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:lA.bind(null,t),mo:dA.bind(null,t),f_:cA.bind(null,t),g_:uA.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await bu(t)):(await t.U_.stop(),t.O_.length>0&&(oe("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new wr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const a=Date.now()+r,l=new Sm(e,n,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new se(z.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function km(t,e){if(Sr("AsyncQueue",`${e}: ${t}`),Bo(t))return new se(z.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e){this.comparator=e?(n,r)=>e(n,r)||ue.comparator(n.key,r.key):(n,r)=>ue.comparator(n.key,r.key),this.keyedMap=Ma(),this.sortedSet=new rt(this.comparator)}static emptySet(e){return new Oi(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Oi)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Oi;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rv{constructor(){this.W_=new rt(ue.comparator)}track(e){const n=e.doc.key,r=this.W_.get(n);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(n,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(n):e.type===1&&r.type===2?this.W_=this.W_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):xe():this.W_=this.W_.insert(n,e)}G_(){const e=[];return this.W_.inorderTraversal((n,r)=>{e.push(r)}),e}}class Xi{constructor(e,n,r,s,i,a,l,u,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,i){const a=[];return n.forEach(l=>{a.push({type:0,doc:l})}),new Xi(e,n,Oi.emptySet(n),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&gu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fA{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class mA{constructor(){this.queries=sv(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(n,r){const s=be(n),i=s.queries;s.queries=sv(),i.forEach((a,l)=>{for(const u of l.j_)u.onError(r)})})(this,new se(z.ABORTED,"Firestore shutting down"))}}function sv(){return new oa(t=>r_(t),gu)}async function Nm(t,e){const n=be(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new fA,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await n.onListen(s,!0);break;case 1:i.z_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(a){const l=km(a,`Initialization of query '${hi(e.query)}' failed`);return void e.onError(l)}n.queries.set(s,i),i.j_.push(e),e.Z_(n.onlineState),i.z_&&e.X_(i.z_)&&Pm(n)}async function Im(t,e){const n=be(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const a=i.j_.indexOf(e);a>=0&&(i.j_.splice(a,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function pA(t,e){const n=be(t);let r=!1;for(const s of e){const i=s.query,a=n.queries.get(i);if(a){for(const l of a.j_)l.X_(s)&&(r=!0);a.z_=s}}r&&Pm(n)}function gA(t,e,n){const r=be(t),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(n);r.queries.delete(e)}function Pm(t){t.Y_.forEach(e=>{e.next()})}var Kh,iv;(iv=Kh||(Kh={})).ea="default",iv.Cache="cache";class Am{constructor(e,n,r){this.query=e,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Xi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.na?this.ia(e)&&(this.ta.next(e),n=!0):this.sa(e,this.onlineState)&&(this.oa(e),n=!0),this.ra=e,n}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let n=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),n=!0),n}sa(e,n){if(!e.fromCache||!this.J_())return!0;const r=n!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const n=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}oa(e){e=Xi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Kh.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M_{constructor(e){this.key=e}}class L_{constructor(e){this.key=e}}class yA{constructor(e,n){this.query=e,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ae(),this.mutatedKeys=Ae(),this.Aa=s_(e),this.Ra=new Oi(this.Aa)}get Va(){return this.Ta}ma(e,n){const r=n?n.fa:new rv,s=n?n.Ra:this.Ra;let i=n?n.mutatedKeys:this.mutatedKeys,a=s,l=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((f,m)=>{const g=s.get(f),b=yu(this.query,m)?m:null,k=!!g&&this.mutatedKeys.has(g.key),C=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let N=!1;g&&b?g.data.isEqual(b.data)?k!==C&&(r.track({type:3,doc:b}),N=!0):this.ga(g,b)||(r.track({type:2,doc:b}),N=!0,(u&&this.Aa(b,u)>0||d&&this.Aa(b,d)<0)&&(l=!0)):!g&&b?(r.track({type:0,doc:b}),N=!0):g&&!b&&(r.track({type:1,doc:g}),N=!0,(u||d)&&(l=!0)),N&&(b?(a=a.add(b),i=C?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{Ra:a,fa:r,ns:l,mutatedKeys:i}}ga(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((f,m)=>function(b,k){const C=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xe()}};return C(b)-C(k)}(f.type,m.type)||this.Aa(f.doc,m.doc)),this.pa(r),s=s!=null&&s;const l=n&&!s?this.ya():[],u=this.da.size===0&&this.current&&!s?1:0,d=u!==this.Ea;return this.Ea=u,a.length!==0||d?{snapshot:new Xi(this.query,e.Ra,i,a,e.mutatedKeys,u===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new rv,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(n=>this.Ta=this.Ta.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ta=this.Ta.delete(n)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Ae(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const n=[];return e.forEach(r=>{this.da.has(r)||n.push(new L_(r))}),this.da.forEach(r=>{e.has(r)||n.push(new M_(r))}),n}ba(e){this.Ta=e.Ts,this.da=Ae();const n=this.ma(e.documents);return this.applyChanges(n,!0)}Da(){return Xi.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class vA{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class wA{constructor(e){this.key=e,this.va=!1}}class xA{constructor(e,n,r,s,i,a){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new oa(l=>r_(l),gu),this.Ma=new Map,this.xa=new Set,this.Oa=new rt(ue.comparator),this.Na=new Map,this.La=new wm,this.Ba={},this.ka=new Map,this.qa=Yi.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function _A(t,e,n=!0){const r=B_(t);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await O_(r,e,n,!0),s}async function bA(t,e){const n=B_(t);await O_(n,e,!0,!1)}async function O_(t,e,n,r){const s=await WP(t.localStore,nr(e)),i=s.targetId,a=t.sharedClientState.addLocalQueryTarget(i,n);let l;return r&&(l=await EA(t,e,i,a==="current",s.resumeToken)),t.isPrimaryClient&&n&&I_(t.remoteStore,s),l}async function EA(t,e,n,r,s){t.Ka=(m,g,b)=>async function(C,N,_,x){let I=N.view.ma(_);I.ns&&(I=await Zy(C.localStore,N.query,!1).then(({documents:v})=>N.view.ma(v,I)));const D=x&&x.targetChanges.get(N.targetId),F=x&&x.targetMismatches.get(N.targetId)!=null,q=N.view.applyChanges(I,C.isPrimaryClient,D,F);return ov(C,N.targetId,q.wa),q.snapshot}(t,m,g,b);const i=await Zy(t.localStore,e,!0),a=new yA(e,i.Ts),l=a.ma(i.documents),u=Wo.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=a.applyChanges(l,t.isPrimaryClient,u);ov(t,n,d.wa);const f=new vA(e,n,a);return t.Fa.set(e,f),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),d.snapshot}async function TA(t,e,n){const r=be(t),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(a=>!gu(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Gh(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&bm(r.remoteStore,s.targetId),Qh(r,s.targetId)}).catch(Uo)):(Qh(r,s.targetId),await Gh(r.localStore,s.targetId,!0))}async function CA(t,e){const n=be(t),r=n.Fa.get(e),s=n.Ma.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),bm(n.remoteStore,r.targetId))}async function SA(t,e,n){const r=jA(t);try{const s=await function(a,l){const u=be(a),d=xt.now(),f=l.reduce((b,k)=>b.add(k.key),Ae());let m,g;return u.persistence.runTransaction("Locally write mutations","readwrite",b=>{let k=kr(),C=Ae();return u.cs.getEntries(b,f).next(N=>{k=N,k.forEach((_,x)=>{x.isValidDocument()||(C=C.add(_))})}).next(()=>u.localDocuments.getOverlayedDocuments(b,k)).next(N=>{m=N;const _=[];for(const x of l){const I=KI(x,m.get(x.key).overlayedDocument);I!=null&&_.push(new Cs(x.key,I,Qx(I.value.mapValue),$n.exists(!0)))}return u.mutationQueue.addMutationBatch(b,d,_,l)}).next(N=>{g=N;const _=N.applyToLocalDocumentSet(m,C);return u.documentOverlayCache.saveOverlays(b,N.batchId,_)})}).then(()=>({batchId:g.batchId,changes:a_(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,l,u){let d=a.Ba[a.currentUser.toKey()];d||(d=new rt(Fe)),d=d.insert(l,u),a.Ba[a.currentUser.toKey()]=d}(r,s.batchId,n),await Go(r,s.changes),await bu(r.remoteStore)}catch(s){const i=km(s,"Failed to persist write");n.reject(i)}}async function V_(t,e){const n=be(t);try{const r=await UP(n.localStore,e);e.targetChanges.forEach((s,i)=>{const a=n.Na.get(i);a&&(Be(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.va=!0:s.modifiedDocuments.size>0?Be(a.va):s.removedDocuments.size>0&&(Be(a.va),a.va=!1))}),await Go(n,r,e)}catch(r){await Uo(r)}}function av(t,e,n){const r=be(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Fa.forEach((i,a)=>{const l=a.view.Z_(e);l.snapshot&&s.push(l.snapshot)}),function(a,l){const u=be(a);u.onlineState=l;let d=!1;u.queries.forEach((f,m)=>{for(const g of m.j_)g.Z_(l)&&(d=!0)}),d&&Pm(u)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function kA(t,e,n){const r=be(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Na.get(e),i=s&&s.key;if(i){let a=new rt(ue.comparator);a=a.insert(i,Gt.newNoDocument(i,Ee.min()));const l=Ae().add(i),u=new xu(Ee.min(),new Map,new rt(Fe),a,l);await V_(r,u),r.Oa=r.Oa.remove(i),r.Na.delete(e),Rm(r)}else await Gh(r.localStore,e,!1).then(()=>Qh(r,e,n)).catch(Uo)}async function NA(t,e){const n=be(t),r=e.batch.batchId;try{const s=await $P(n.localStore,e);$_(n,r,null),F_(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Go(n,s)}catch(s){await Uo(s)}}async function IA(t,e,n){const r=be(t);try{const s=await function(a,l){const u=be(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return u.mutationQueue.lookupMutationBatch(d,l).next(m=>(Be(m!==null),f=m.keys(),u.mutationQueue.removeMutationBatch(d,m))).next(()=>u.mutationQueue.performConsistencyCheck(d)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(d,f,l)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>u.localDocuments.getDocuments(d,f))})}(r.localStore,e);$_(r,e,n),F_(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Go(r,s)}catch(s){await Uo(s)}}function F_(t,e){(t.ka.get(e)||[]).forEach(n=>{n.resolve()}),t.ka.delete(e)}function $_(t,e,n){const r=be(t);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Qh(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||U_(t,r)})}function U_(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);n!==null&&(bm(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),Rm(t))}function ov(t,e,n){for(const r of n)r instanceof M_?(t.La.addReference(r.key,e),PA(t,r)):r instanceof L_?(oe("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||U_(t,r.key)):xe()}function PA(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(oe("SyncEngine","New document in limbo: "+n),t.xa.add(r),Rm(t))}function Rm(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new ue(Xe.fromString(e)),r=t.qa.next();t.Na.set(r,new wA(n)),t.Oa=t.Oa.insert(n,r),I_(t.remoteStore,new ts(nr(pu(n.path)),r,"TargetPurposeLimboResolution",lm.oe))}}async function Go(t,e,n){const r=be(t),s=[],i=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((l,u)=>{a.push(r.Ka(u,e,n).then(d=>{var f;if((d||n)&&r.isPrimaryClient){const m=d?!d.fromCache:(f=n==null?void 0:n.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(u.targetId,m?"current":"not-current")}if(d){s.push(d);const m=_m.Wi(u.targetId,d);i.push(m)}}))}),await Promise.all(a),r.Ca.d_(s),await async function(u,d){const f=be(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>G.forEach(d,g=>G.forEach(g.$i,b=>f.persistence.referenceDelegate.addReference(m,g.targetId,b)).next(()=>G.forEach(g.Ui,b=>f.persistence.referenceDelegate.removeReference(m,g.targetId,b)))))}catch(m){if(!Bo(m))throw m;oe("LocalStore","Failed to update sequence numbers: "+m)}for(const m of d){const g=m.targetId;if(!m.fromCache){const b=f.os.get(g),k=b.snapshotVersion,C=b.withLastLimboFreeSnapshotVersion(k);f.os=f.os.insert(g,C)}}}(r.localStore,i))}async function AA(t,e){const n=be(t);if(!n.currentUser.isEqual(e)){oe("SyncEngine","User change. New user:",e.toKey());const r=await C_(n.localStore,e);n.currentUser=e,function(i,a){i.ka.forEach(l=>{l.forEach(u=>{u.reject(new se(z.CANCELLED,a))})}),i.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Go(n,r.hs)}}function RA(t,e){const n=be(t),r=n.Na.get(e);if(r&&r.va)return Ae().add(r.key);{let s=Ae();const i=n.Ma.get(e);if(!i)return s;for(const a of i){const l=n.Fa.get(a);s=s.unionWith(l.view.Va)}return s}}function B_(t){const e=be(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=V_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=RA.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=kA.bind(null,e),e.Ca.d_=pA.bind(null,e.eventManager),e.Ca.$a=gA.bind(null,e.eventManager),e}function jA(t){const e=be(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=NA.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=IA.bind(null,e),e}class zc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=_u(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,n){return null}Ha(e,n){return null}za(e){return FP(this.persistence,new OP,e.initialUser,this.serializer)}Ga(e){return new DP(xm.Zr,this.serializer)}Wa(e){return new HP}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}zc.provider={build:()=>new zc};class Yh{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>av(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=AA.bind(null,this.syncEngine),await hA(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new mA}()}createDatastore(e){const n=_u(e.databaseInfo.databaseId),r=function(i){return new YP(i)}(e.databaseInfo);return function(i,a,l,u){return new ZP(i,a,l,u)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,a,l){return new tA(r,s,i,a,l)}(this.localStore,this.datastore,e.asyncQueue,n=>av(this.syncEngine,n,0),function(){return tv.D()?new tv:new GP}())}createSyncEngine(e,n){return function(s,i,a,l,u,d,f){const m=new xA(s,i,a,l,u,d);return f&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=be(s);oe("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Ho(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}Yh.provider={build:()=>new Yh};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Sr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DA{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=qt.UNAUTHENTICATED,this.clientId=Hx.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{oe("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(oe("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new wr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=km(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function kd(t,e){t.asyncQueue.verifyOperationInProgress(),oe("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await C_(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function lv(t,e){t.asyncQueue.verifyOperationInProgress();const n=await z_(t);oe("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>nv(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>nv(e.remoteStore,s)),t._onlineComponents=e}async function z_(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){oe("FirestoreClient","Using user provided OfflineComponentProvider");try{await kd(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===z.FAILED_PRECONDITION||s.code===z.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;Hi("Error using user provided cache. Falling back to memory cache: "+n),await kd(t,new zc)}}else oe("FirestoreClient","Using default OfflineComponentProvider"),await kd(t,new zc);return t._offlineComponents}async function Dm(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(oe("FirestoreClient","Using user provided OnlineComponentProvider"),await lv(t,t._uninitializedComponentsProvider._online)):(oe("FirestoreClient","Using default OnlineComponentProvider"),await lv(t,new Yh))),t._onlineComponents}function MA(t){return z_(t).then(e=>e.persistence)}function LA(t){return Dm(t).then(e=>e.remoteStore)}function OA(t){return Dm(t).then(e=>e.syncEngine)}async function Wc(t){const e=await Dm(t),n=e.eventManager;return n.onListen=_A.bind(null,e.syncEngine),n.onUnlisten=TA.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=bA.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=CA.bind(null,e.syncEngine),n}function VA(t){return t.asyncQueue.enqueue(async()=>{const e=await MA(t),n=await LA(t);return e.setNetworkEnabled(!0),function(s){const i=be(s);return i.L_.delete(0),qo(i)}(n)})}function FA(t,e,n={}){const r=new wr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,l,u,d){const f=new jm({next:g=>{f.Za(),a.enqueueAndForget(()=>Im(i,m));const b=g.docs.has(l);!b&&g.fromCache?d.reject(new se(z.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&g.fromCache&&u&&u.source==="server"?d.reject(new se(z.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(g)},error:g=>d.reject(g)}),m=new Am(pu(l.path),f,{includeMetadataChanges:!0,_a:!0});return Nm(i,m)}(await Wc(t),t.asyncQueue,e,n,r)),r.promise}function $A(t,e,n={}){const r=new wr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,l,u,d){const f=new jm({next:g=>{f.Za(),a.enqueueAndForget(()=>Im(i,m)),g.fromCache&&u.source==="server"?d.reject(new se(z.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(g)},error:g=>d.reject(g)}),m=new Am(l,f,{includeMetadataChanges:!0,_a:!0});return Nm(i,m)}(await Wc(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W_(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cv=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q_(t,e,n){if(!n)throw new se(z.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function UA(t,e,n,r){if(e===!0&&r===!0)throw new se(z.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function uv(t){if(!ue.isDocumentKey(t))throw new se(z.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function dv(t){if(ue.isDocumentKey(t))throw new se(z.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Eu(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":xe()}function yn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new se(z.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Eu(t);throw new se(z.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function BA(t,e){if(e<=0)throw new se(z.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hv{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new se(z.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new se(z.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}UA("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=W_((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new se(z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new se(z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new se(z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Tu{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hv({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new se(z.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new se(z.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hv(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new nI;switch(r.type){case"firstParty":return new aI(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new se(z.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=cv.get(n);r&&(oe("ComponentProvider","Removing Datastore"),cv.delete(n),r.terminate())}(this),Promise.resolve()}}function zA(t,e,n,r={}){var s;const i=(t=yn(t,Tu))._getSettings(),a=`${e}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==a&&Hi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:a,ssl:!1})),r.mockUserToken){let l,u;if(typeof r.mockUserToken=="string")l=r.mockUserToken,u=qt.MOCK_USER;else{l=mC(r.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new se(z.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new qt(d)}t._authCredentials=new rI(new qx(l,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new jr(this.firestore,e,this._query)}}class en{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ms(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new en(this.firestore,e,this._key)}}class ms extends jr{constructor(e,n,r){super(e,n,pu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new en(this.firestore,null,new ue(e))}withConverter(e){return new ms(this.firestore,e,this._path)}}function _t(t,e,...n){if(t=gt(t),q_("collection","path",e),t instanceof Tu){const r=Xe.fromString(e,...n);return dv(r),new ms(t,null,r)}{if(!(t instanceof en||t instanceof ms))throw new se(z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Xe.fromString(e,...n));return dv(r),new ms(t.firestore,null,r)}}function Ot(t,e,...n){if(t=gt(t),arguments.length===1&&(e=Hx.newId()),q_("doc","path",e),t instanceof Tu){const r=Xe.fromString(e,...n);return uv(r),new en(t,null,new ue(r))}{if(!(t instanceof en||t instanceof ms))throw new se(z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Xe.fromString(e,...n));return uv(r),new en(t.firestore,t instanceof ms?t.converter:null,new ue(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fv{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new k_(this,"async_queue_retry"),this.Vu=()=>{const r=Sd();r&&oe("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const n=Sd();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const n=Sd();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const n=new wr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Bo(e))throw e;oe("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const n=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(a){let l=a.message||"";return a.stack&&(l=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),l}(r);throw Sr("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=n,n}enqueueAfterDelay(e,n,r){this.fu(),this.Ru.indexOf(e)>-1&&(n=0);const s=Sm.createAndSchedule(this,e,n,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&xe()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const n of this.Tu)if(n.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Tu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const n=this.Tu.indexOf(e);this.Tu.splice(n,1)}}function mv(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class Nr extends Tu{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new fv,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new fv(e),this._firestoreClient=void 0,await e}}}function WA(t,e){const n=typeof t=="object"?t:tx(),r=typeof t=="string"?t:e||"(default)",s=Xf(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=hC("firestore");i&&zA(s,...i)}return s}function Ko(t){if(t._terminated)throw new se(z.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||qA(t),t._firestoreClient}function qA(t){var e,n,r;const s=t._freezeSettings(),i=function(l,u,d,f){return new wI(l,u,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,W_(f.experimentalLongPollingOptions),f.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new DA(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(l){const u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(t._componentsProvider))}function HA(t){return VA(Ko(t=yn(t,Nr)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ji(Mt.fromBase64String(e))}catch(n){throw new se(z.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Ji(Mt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new se(z.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new At(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Su{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mm{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new se(z.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new se(z.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Fe(this._lat,e._lat)||Fe(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lm{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GA=/^__.*__$/;class KA{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Cs(e,this.data,this.fieldMask,n,this.fieldTransforms):new zo(e,this.data,n,this.fieldTransforms)}}class H_{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Cs(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function G_(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw xe()}}class Om{constructor(e,n,r,s,i,a){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Om(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return qc(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(G_(this.Cu)&&GA.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class QA{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||_u(e)}Qu(e,n,r,s=!1){return new Om({Cu:e,methodName:n,qu:r,path:At.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Vm(t){const e=t._freezeSettings(),n=_u(t._databaseId);return new QA(t._databaseId,!!e.ignoreUndefinedProperties,n)}function YA(t,e,n,r,s,i={}){const a=t.Qu(i.merge||i.mergeFields?2:0,e,n,s);$m("Data must be an object, but it was:",a,r);const l=K_(r,a);let u,d;if(i.merge)u=new pn(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const m of i.mergeFields){const g=Xh(e,m,n);if(!a.contains(g))throw new se(z.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);Y_(f,g)||f.push(g)}u=new pn(f),d=a.fieldTransforms.filter(m=>u.covers(m.field))}else u=null,d=a.fieldTransforms;return new KA(new an(l),u,d)}class ku extends Su{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ku}}class Fm extends Su{_toFieldTransform(e){return new WI(e.path,new So)}isEqual(e){return e instanceof Fm}}function XA(t,e,n,r){const s=t.Qu(1,e,n);$m("Data must be an object, but it was:",s,r);const i=[],a=an.empty();si(r,(u,d)=>{const f=Um(e,u,n);d=gt(d);const m=s.Nu(f);if(d instanceof ku)i.push(f);else{const g=Qo(d,m);g!=null&&(i.push(f),a.set(f,g))}});const l=new pn(i);return new H_(a,l,s.fieldTransforms)}function JA(t,e,n,r,s,i){const a=t.Qu(1,e,n),l=[Xh(e,r,n)],u=[s];if(i.length%2!=0)throw new se(z.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)l.push(Xh(e,i[g])),u.push(i[g+1]);const d=[],f=an.empty();for(let g=l.length-1;g>=0;--g)if(!Y_(d,l[g])){const b=l[g];let k=u[g];k=gt(k);const C=a.Nu(b);if(k instanceof ku)d.push(b);else{const N=Qo(k,C);N!=null&&(d.push(b),f.set(b,N))}}const m=new pn(d);return new H_(f,m,a.fieldTransforms)}function ZA(t,e,n,r=!1){return Qo(n,t.Qu(r?4:3,e))}function Qo(t,e){if(Q_(t=gt(t)))return $m("Unsupported field value:",e,t),K_(t,e);if(t instanceof Su)return function(r,s){if(!G_(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let a=0;for(const l of r){let u=Qo(l,s.Lu(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=gt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return UI(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=xt.fromDate(r);return{timestampValue:Uc(s.serializer,i)}}if(r instanceof xt){const i=new xt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Uc(s.serializer,i)}}if(r instanceof Mm)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ji)return{bytesValue:v_(s.serializer,r._byteString)};if(r instanceof en){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:vm(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Lm)return function(a,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(u=>{if(typeof u!="number")throw l.Bu("VectorValues must only contain numeric values.");return mm(l.serializer,u)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Eu(r)}`)}(t,e)}function K_(t,e){const n={};return Gx(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):si(t,(r,s)=>{const i=Qo(s,e.Mu(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function Q_(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof xt||t instanceof Mm||t instanceof Ji||t instanceof en||t instanceof Su||t instanceof Lm)}function $m(t,e,n){if(!Q_(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const r=Eu(n);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function Xh(t,e,n){if((e=gt(e))instanceof Cu)return e._internalPath;if(typeof e=="string")return Um(t,e);throw qc("Field path arguments must be of type string or ",t,!1,void 0,n)}const eR=new RegExp("[~\\*/\\[\\]]");function Um(t,e,n){if(e.search(eR)>=0)throw qc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Cu(...e.split("."))._internalPath}catch{throw qc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function qc(t,e,n,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new se(z.INVALID_ARGUMENT,l+t+u)}function Y_(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new en(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new tR(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Nu("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class tR extends X_{data(){return super.data()}}function Nu(t,e){return typeof e=="string"?Um(t,e):e instanceof Cu?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J_(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new se(z.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Bm{}class zm extends Bm{}function tn(t,e,...n){let r=[];e instanceof Bm&&r.push(e),r=r.concat(n),function(i){const a=i.filter(u=>u instanceof Wm).length,l=i.filter(u=>u instanceof Iu).length;if(a>1||a>0&&l>0)throw new se(z.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Iu extends zm{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Iu(e,n,r)}_apply(e){const n=this._parse(e);return Z_(e._query,n),new jr(e.firestore,e.converter,Bh(e._query,n))}_parse(e){const n=Vm(e.firestore);return function(i,a,l,u,d,f,m){let g;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new se(z.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){gv(m,f);const b=[];for(const k of m)b.push(pv(u,i,k));g={arrayValue:{values:b}}}else g=pv(u,i,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||gv(m,f),g=ZA(l,a,m,f==="in"||f==="not-in");return mt.create(d,f,g)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function Lt(t,e,n){const r=e,s=Nu("where",t);return Iu._create(s,r,n)}class Wm extends Bm{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Wm(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:zn.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let a=s;const l=i.getFlattenedFilters();for(const u of l)Z_(a,u),a=Bh(a,u)}(e._query,n),new jr(e.firestore,e.converter,Bh(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class qm extends zm{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new qm(e,n)}_apply(e){const n=function(s,i,a){if(s.startAt!==null)throw new se(z.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new se(z.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Co(i,a)}(e._query,this._field,this._direction);return new jr(e.firestore,e.converter,function(s,i){const a=s.explicitOrderBy.concat([i]);return new aa(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function nR(t,e="asc"){const n=e,r=Nu("orderBy",t);return qm._create(r,n)}class Hm extends zm{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new Hm(e,n,r)}_apply(e){return new jr(e.firestore,e.converter,Fc(e._query,this._limit,this._limitType))}}function rR(t){return BA("limit",t),Hm._create("limit",t,"F")}function pv(t,e,n){if(typeof(n=gt(n))=="string"){if(n==="")throw new se(z.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!n_(e)&&n.indexOf("/")!==-1)throw new se(z.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Xe.fromString(n));if(!ue.isDocumentKey(r))throw new se(z.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ly(t,new ue(r))}if(n instanceof en)return Ly(t,n._key);throw new se(z.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Eu(n)}.`)}function gv(t,e){if(!Array.isArray(t)||t.length===0)throw new se(z.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Z_(t,e){const n=function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new se(z.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new se(z.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class sR{convertValue(e,n="none"){switch(Js(e)){case 0:return null;case 1:return e.booleanValue;case 2:return lt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Xs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw xe()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return si(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var n,r,s;const i=(s=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(a=>lt(a.doubleValue));return new Lm(i)}convertGeoPoint(e){return new Mm(lt(e.latitude),lt(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=um(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(bo(e));default:return null}}convertTimestamp(e){const n=vs(e);return new xt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Xe.fromString(e);Be(T_(r));const s=new Eo(r.get(1),r.get(3)),i=new ue(r.popFirst(5));return s.isEqual(n)||Sr(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iR(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class eb extends X_{constructor(e,n,r,s,i,a){super(e,n,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new nc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Nu("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class nc extends eb{data(e={}){return super.data(e)}}class tb{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Oa(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new nc(this._firestore,this._userDataWriter,r.key,r,new Oa(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new se(z.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(l=>{const u=new nc(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Oa(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const u=new nc(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Oa(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:aR(l.type),doc:u,oldIndex:d,newIndex:f}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function aR(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xe()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ai(t){t=yn(t,en);const e=yn(t.firestore,Nr);return FA(Ko(e),t._key).then(n=>nb(e,t,n))}class Gm extends sR{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ji(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new en(this.firestore,null,n)}}function wn(t){t=yn(t,jr);const e=yn(t.firestore,Nr),n=Ko(e),r=new Gm(e);return J_(t._query),$A(n,t._query).then(s=>new tb(e,r,t,s))}function In(t,e,n,...r){t=yn(t,en);const s=yn(t.firestore,Nr),i=Vm(s);let a;return a=typeof(e=gt(e))=="string"||e instanceof Cu?JA(i,"updateDoc",t._key,e,n,r):XA(i,"updateDoc",t._key,e),Qm(s,[a.toMutation(t._key,$n.exists(!0))])}function Nd(t){return Qm(yn(t.firestore,Nr),[new pm(t._key,$n.none())])}function Pu(t,e){const n=yn(t.firestore,Nr),r=Ot(t),s=iR(t.converter,e);return Qm(n,[YA(Vm(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,$n.exists(!1))]).then(()=>r)}function Km(t,...e){var n,r,s;t=gt(t);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||mv(e[a])||(i=e[a],a++);const l={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(mv(e[a])){const m=e[a];e[a]=(n=m.next)===null||n===void 0?void 0:n.bind(m),e[a+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[a+2]=(s=m.complete)===null||s===void 0?void 0:s.bind(m)}let u,d,f;if(t instanceof en)d=yn(t.firestore,Nr),f=pu(t._key.path),u={next:m=>{e[a]&&e[a](nb(d,t,m))},error:e[a+1],complete:e[a+2]};else{const m=yn(t,jr);d=yn(m.firestore,Nr),f=m._query;const g=new Gm(d);u={next:b=>{e[a]&&e[a](new tb(d,g,m,b))},error:e[a+1],complete:e[a+2]},J_(t._query)}return function(g,b,k,C){const N=new jm(C),_=new Am(b,N,k);return g.asyncQueue.enqueueAndForget(async()=>Nm(await Wc(g),_)),()=>{N.Za(),g.asyncQueue.enqueueAndForget(async()=>Im(await Wc(g),_))}}(Ko(d),f,l,u)}function Qm(t,e){return function(r,s){const i=new wr;return r.asyncQueue.enqueueAndForget(async()=>SA(await OA(r),s,i)),i.promise}(Ko(t),e)}function nb(t,e,n){const r=n.docs.get(e._key),s=new Gm(t);return new eb(t,s,e._key,r,new Oa(n.hasPendingWrites,n.fromCache),e.converter)}function ut(){return new Fm("serverTimestamp")}(function(e,n=!0){(function(s){ia=s})(ra),qi(new Gs("firestore",(r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new Nr(new sI(r.getProvider("auth-internal")),new lI(r.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new se(z.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Eo(d.options.projectId,f)}(a,s),a);return i=Object.assign({useFetchStreams:n},i),l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),fs(Ay,"4.7.3",e),fs(Ay,"4.7.3","esm2017")})();const oR={apiKey:"AIzaSyB_1Dn63ZHRnA-jXytu95WEBWNFQ64Jo_E",authDomain:"dnd-v1-17acc.firebaseapp.com",projectId:"dnd-v1-17acc",storageBucket:"dnd-v1-17acc.firebasestorage.app",messagingSenderId:"976056329393",appId:"1:976056329393:web:7c8170e906162fe4ef2e90"},rb=ex(oR),xs=JN(rb),Ie=WA(rb);Ie.settings({cacheSizeBytes:50*1024*1024,ignoreUndefinedProperties:!0});const lR=t=>{console.warn("Firestore connection issue:",t),(t.code==="unavailable"||t.code==="deadline-exceeded")&&(console.log("Attempting to reconnect to Firestore..."),HA(Ie).catch(console.error))};Ie.enableNetwork().catch(lR);const $e=(t,e)=>{throw console.error(`Error in ${e}:`,t),t.code==="unavailable"||t.code==="deadline-exceeded"?new Error("Network connection issue. Please check your internet connection and try again."):t.code==="permission-denied"?new Error("Access denied. Please check your permissions."):t.code==="not-found"?new Error("The requested data was not found."):new Error(`Database error: ${t.message}`)},cR=async(t,e)=>{try{const n={...e,userId:t,createdAt:ut(),updatedAt:ut()};return{id:(await Pu(_t(Ie,"userProfiles"),n)).id,...n}}catch(n){$e(n,"createUserProfile")}},Yo=async t=>{try{const e=tn(_t(Ie,"userProfiles"),Lt("userId","==",t)),n=await wn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){$e(e,"getUserProfile")}},yv=async t=>{try{if(!t||t.length===0)return[];const e=[];for(let s=0;s<t.length;s+=10){const i=t.slice(s,s+10),a=tn(_t(Ie,"userProfiles"),Lt("userId","in",i));e.push(wn(a))}const n=await Promise.all(e),r=[];return n.forEach(s=>{s.docs.forEach(i=>{r.push({id:i.id,...i.data()})})}),r}catch(e){$e(e,"getUserProfiles")}},uR=async t=>{try{const e=tn(_t(Ie,"userProfiles"),Lt("username","==",t));return(await wn(e)).empty}catch(e){$e(e,"checkUsernameAvailability")}},dR=async(t,e,n)=>{try{const r={...n,userId:t,partyId:e,createdAt:ut(),updatedAt:ut()};return{id:(await Pu(_t(Ie,"characters"),r)).id,...r}}catch(r){$e(r,"saveCharacter")}},sb=async(t,e)=>{try{const n=tn(_t(Ie,"characters"),Lt("userId","==",t),Lt("partyId","==",e)),r=await wn(n);if(r.empty)return null;const s=r.docs[0];return{id:s.id,...s.data()}}catch(n){$e(n,"getCharacterByUserAndParty")}},Ym=async t=>{try{const e=tn(_t(Ie,"characters"),Lt("partyId","==",t));return(await wn(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){$e(e,"getPartyCharacters")}},hR=async(t,e)=>{try{const n=Ot(Ie,"characters",t);await In(n,{...e,updatedAt:ut()})}catch(n){$e(n,"updateCharacter")}},fR=async(t,e)=>{try{const n={...e,dmId:t,members:[t],createdAt:ut(),updatedAt:ut()};return{id:(await Pu(_t(Ie,"parties"),n)).id,...n}}catch(n){$e(n,"createParty")}},Xm=async t=>{try{const e=tn(_t(Ie,"parties"),Lt("members","array-contains",t));return(await wn(e)).docs.map(s=>{const i=s.data();return{id:s.id,...i}})}catch(e){$e(e,"getUserParties")}},mR=async()=>{try{const t=tn(_t(Ie,"parties"),Lt("isPublic","==",!0),nR("createdAt","desc"));return(await wn(t)).docs.map(r=>{const s=r.data();return{id:r.id,...s}})}catch(t){$e(t,"getPublicParties")}},vv=async(t,e)=>{try{const n=Ot(Ie,"parties",t),r=await ai(n);if(!r.exists())throw new Error("Party not found");const s=r.data();if(s.members.includes(e))throw new Error("User already in party");await In(n,{members:[...s.members,e],updatedAt:ut()})}catch(n){$e(n,"joinParty")}},ib=async(t,e)=>{try{const n=Ot(Ie,"parties",t),r=await ai(n);if(!r.exists())throw new Error("Party not found");if(r.data().dmId!==e)throw new Error("Only the party leader can disband the party");await Nd(n);const i=tn(_t(Ie,"characters"),Lt("partyId","==",t)),l=(await wn(i)).docs.map(m=>Nd(m.ref));await Promise.all(l);const u=tn(_t(Ie,"campaignStories"),Lt("partyId","==",t)),f=(await wn(u)).docs.map(m=>Nd(m.ref));await Promise.all(f)}catch(n){$e(n,"disbandParty")}},pR=async t=>{try{const e=tn(_t(Ie,"parties"),Lt("inviteCode","==",t)),n=await wn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){$e(e,"getPartyByInviteCode")}},ab=async t=>{try{const e=Ot(Ie,"parties",t),n=await ai(e);return n.exists()?{id:n.id,...n.data()}:null}catch(e){$e(e,"getPartyById")}},gR=async t=>{try{const e={partyId:t,status:"ready_up",currentPlot:null,storyMessages:[],votingSession:null,readyPlayers:[],lastUpdated:ut(),createdAt:ut()};return{id:(await Pu(_t(Ie,"campaignStories"),e)).id,...e}}catch(e){$e(e,"createCampaignStory")}},yR=async t=>{try{const e=tn(_t(Ie,"campaignStories"),Lt("partyId","==",t)),n=await wn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){$e(e,"getCampaignStory")}},zr=async(t,e)=>{try{const n=Ot(Ie,"campaignStories",t);await In(n,{...e,lastUpdated:ut()})}catch(n){$e(n,"updateCampaignStory")}},Id=async(t,e)=>{try{const n=Ot(Ie,"campaignStories",t),s=(await ai(n)).data(),i={id:`msg_${Date.now()}`,...e,timestamp:new Date};return await In(n,{storyMessages:[...s.storyMessages,i],lastUpdated:ut()}),i}catch(n){$e(n,"addStoryMessage")}},vR=async(t,e)=>{try{const n=Ot(Ie,"campaignStories",t),i=(await ai(n)).data().readyPlayers||[];i.includes(e)||await In(n,{readyPlayers:[...i,e],lastUpdated:ut()})}catch(n){$e(n,"setPlayerReady")}},wR=(t,e)=>{try{const n=Ot(Ie,"campaignStories",t);return Km(n,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})}catch(n){$e(n,"subscribeToCampaignStory")}},wv=async(t,e)=>{try{const n=Ot(Ie,"campaignStories",t);await In(n,{currentSpeaker:e,lastUpdated:ut()})}catch(n){$e(n,"setCurrentSpeaker")}},Pd=async(t,e)=>{try{const n=Ot(Ie,"campaignStories",t);await In(n,{currentController:e,lastUpdated:ut()})}catch(n){$e(n,"setCurrentController")}},xv=async t=>{try{const e=tn(_t(Ie,"combatSessions"),Lt("partyId","==",t),Lt("status","==","active")),n=await wn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){$e(e,"getCombatSession")}},Ml=async(t,e)=>{try{const n=Ot(Ie,"combatSessions",t);await In(n,{...e,updatedAt:ut()})}catch(n){$e(n,"updateCombatSession")}},ob=(t,e)=>{try{const n=tn(_t(Ie,"combatSessions"),Lt("partyId","==",t),Lt("status","==","active"));return Km(n,r=>{if(r.empty)e(null);else{const s=r.docs[0];e({id:s.id,...s.data()})}})}catch(n){$e(n,"subscribeToCombatSession")}},xR=async(t,e)=>{try{console.log("saveCharacterPreset called with:",{userId:t,presetData:e});const n=await Yo(t);if(console.log("User profile retrieved:",n),!n)throw console.error("User profile not found for userId:",t),new Error("User profile not found");const r={id:Date.now().toString(),name:e.name,data:e.data,createdAt:new Date};console.log("Created preset object:",r);const s=n.characterPresets||[];console.log("Existing presets:",s);const i=[...s,r];console.log("Updated presets array:",i);const a=Ot(Ie,"userProfiles",n.id);return console.log("Updating profile with ID:",n.id),await In(a,{characterPresets:i,updatedAt:ut()}),console.log("Profile updated successfully"),r}catch(n){$e(n,"saveCharacterPreset")}},_R=async t=>{try{const e=await Yo(t);return e?e.characterPresets||[]:[]}catch(e){$e(e,"getUserCharacterPresets")}},bR=async(t,e)=>{try{const n=await Yo(t);if(!n)throw new Error("User profile not found");const s=(n.characterPresets||[]).filter(a=>a.id!==e),i=Ot(Ie,"userProfiles",n.id);await In(i,{characterPresets:s,updatedAt:ut()})}catch(n){$e(n,"deleteCharacterPreset")}},ER=async t=>{try{const e=Ot(Ie,"campaignStories",t);return(await ai(e)).data().storyState||null}catch(e){$e(e,"getStoryState")}},TR=async(t,e)=>{try{const n=Ot(Ie,"campaignStories",t),a={...(await ai(n)).data().storyState||{},...e,lastUpdated:ut()};return await In(n,{storyState:a,lastUpdated:ut()}),a}catch(n){$e(n,"updateStoryState")}},CR=async(t,e)=>{try{const n=Ot(Ie,"combatSessions",t);await In(n,{...e,updatedAt:ut()})}catch(n){$e(n,"updateCombatSessionWithNarrative")}},SR=async(t,e,n)=>{try{if(console.log("Starting registration for:",t,n),!await uR(n))return console.log("Username not available:",n),{user:null,error:"Username is already taken. Please choose a different username."};console.log("Username available:",n);const s=await Lk(xs,t,e);console.log("User created successfully:",s.user.uid);try{await cR(s.user.uid,{username:n,email:t,displayName:n}),console.log("User profile created successfully")}catch(a){console.error("Error creating user profile:",a)}let i=!1;try{await Vk(s.user),console.log("Email verification sent successfully"),i=!0}catch(a){console.error("Error sending email verification:",a)}return await Nx(xs),console.log("User signed out after registration"),{user:null,error:null,success:!0}}catch(r){return console.error("Registration error:",r),{user:null,error:r.message}}},kR=async(t,e)=>{try{return{user:(await Ok(xs,t,e)).user,error:null}}catch(n){return{user:null,error:n.message}}},NR=async()=>{try{return await Nx(xs),{error:null}}catch(t){return{error:t.message}}},oi=t=>Uk(xs,async e=>{t(e)}),IR=async()=>{try{return console.log("Testing Firebase connection..."),console.log("Auth domain:",xs.config.authDomain),console.log("Project ID:",xs.config.projectId),{success:!0,message:"Firebase connection successful"}}catch(t){return console.error("Firebase connection test failed:",t),{success:!1,error:t.message}}};function PR(){const[t,e]=A.useState(null),[n,r]=A.useState(null),[s,i]=A.useState(!1),[a,l]=A.useState(!1),[u,d]=A.useState("connected"),f=Wn();A.useEffect(()=>{const b=oi(async k=>{if(e(k),k)try{const C=await Yo(k.uid);r(C)}catch(C){console.error("Error loading user profile:",C)}else r(null)});return()=>b()},[f]),A.useEffect(()=>{const b=async()=>{try{const C=tn(_t(Ie,"_test"),rR(1));await wn(C),d("connected")}catch(C){console.warn("Firestore connection issue detected:",C),d("disconnected"),setTimeout(()=>{d("reconnecting"),b()},5e3)}};b();const k=setInterval(b,3e4);return()=>clearInterval(k)},[]);const m=async()=>{const{error:b}=await NR();b||(f("/"),l(!1),i(!1))},g=(n==null?void 0:n.username)||(t==null?void 0:t.email);return o.jsx("nav",{className:"bg-gray-900 text-gray-100 shadow-lg border-b border-gray-700",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx(Kn,{to:"/",className:"text-xl sm:text-2xl font-bold font-['Cinzel'] text-amber-400",children:"DND-V1"}),o.jsxs("div",{className:"flex items-center space-x-2 mr-4",children:[o.jsx("div",{className:`w-2 h-2 rounded-full ${u==="connected"?"bg-green-500":u==="reconnecting"?"bg-yellow-500":"bg-red-500"}`}),o.jsx("span",{className:"text-xs text-gray-400 hidden sm:inline",children:u==="connected"?"Connected":u==="reconnecting"?"Reconnecting...":"Disconnected"})]}),o.jsx("div",{className:"hidden md:flex items-center space-x-4",children:t?o.jsxs(o.Fragment,{children:[o.jsx(Kn,{to:"/dashboard",className:"fantasy-button",children:"Dashboard"}),o.jsx(Kn,{to:"/party-management",className:"fantasy-button",children:"Parties"}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{onClick:()=>i(!s),className:"fantasy-button bg-gray-700 hover:bg-gray-600",children:g}),s&&o.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-600 z-50",children:o.jsxs("div",{className:"py-2",children:[o.jsxs("div",{className:"px-4 py-2 text-sm text-gray-200 border-b border-gray-600",children:[o.jsx("div",{className:"font-medium",children:g}),o.jsx("div",{className:"text-xs text-gray-400",children:t.email})]}),o.jsx("button",{onClick:m,className:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-700",children:"Logout"})]})})]})]}):o.jsx(Kn,{to:"/login",className:"fantasy-button",children:"Login"})}),o.jsx("div",{className:"md:hidden",children:o.jsx("button",{onClick:()=>l(!a),className:"fantasy-button bg-gray-700 hover:bg-gray-600 p-2",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a?o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})})]}),a&&o.jsx("div",{className:"md:hidden mt-4 pb-4 border-t border-gray-700",children:t?o.jsxs("div",{className:"pt-4 space-y-3",children:[o.jsx(Kn,{to:"/dashboard",className:"fantasy-button block w-full text-center",onClick:()=>l(!1),children:"Dashboard"}),o.jsx(Kn,{to:"/party-management",className:"fantasy-button block w-full text-center",onClick:()=>l(!1),children:"Parties"}),o.jsxs("div",{className:"pt-3 border-t border-gray-700",children:[o.jsxs("div",{className:"px-4 py-2 text-sm text-gray-200",children:[o.jsx("div",{className:"font-medium",children:g}),o.jsx("div",{className:"text-xs text-gray-400",children:t.email})]}),o.jsx("button",{onClick:m,className:"w-full text-left px-4 py-3 text-sm text-gray-200 hover:bg-gray-700 rounded-lg mt-2",children:"Logout"})]})]}):o.jsx("div",{className:"pt-4",children:o.jsx(Kn,{to:"/login",className:"fantasy-button block w-full text-center",onClick:()=>l(!1),children:"Login"})})})]})})}function AR(){return o.jsx("div",{className:"text-xs text-gray-400 text-center mt-2",children:"Version 3.1.0"})}function RR(){return o.jsxs("div",{className:"relative overflow-hidden",children:[o.jsx("div",{className:"fantasy-container",children:o.jsxs("div",{className:"relative z-10 py-8 sm:py-16 lg:py-24 text-center",children:[o.jsx("h1",{className:"fantasy-title text-5xl sm:text-6xl lg:text-7xl",children:"Manage your D&D world like a real adventurer's tome"}),o.jsx("p",{className:"fantasy-subtitle max-w-2xl mx-auto",children:"Create parties, invite friends, and share story objectives in a beautifully crafted digital environment that feels like a magical grimoire."}),o.jsxs("div",{className:"mt-8 flex justify-center space-x-6",children:[o.jsx(Kn,{to:"/register",className:"fantasy-button text-lg px-8 py-3",children:"Start Your Journey"}),o.jsx(Kn,{to:"/login",className:"fantasy-button text-lg px-8 py-3 bg-gray-600 hover:bg-gray-700",children:"Return to Campaign"})]})]})}),o.jsx("div",{className:"absolute inset-0 bg-gray-700/10 pattern-grid-lg"})]})}function jR(){return o.jsxs("div",{children:[o.jsx(RR,{}),o.jsx("div",{className:"fantasy-container py-16",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Create Parties"}),o.jsx("p",{className:"text-gray-300",children:"Form adventuring parties with your friends and manage your campaign together in a shared space."})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Track Objectives"}),o.jsx("p",{className:"text-gray-300",children:"Keep track of your party's quests, storylines, and achievements in an organized magical tome."})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Share Stories"}),o.jsx("p",{className:"text-gray-300",children:"Document your adventures and share them with your fellow party members in an immersive fantasy setting."})]})]})})]})}function DR(){const[t,e]=A.useState(""),[n,r]=A.useState(""),[s,i]=A.useState(!1),[a,l]=A.useState(""),[u,d]=A.useState(""),f=Wn(),m=ni();A.useEffect(()=>{var k;(k=m.state)!=null&&k.message&&(d(m.state.message),f(m.pathname,{replace:!0}));const b=oi(C=>{C&&f("/dashboard")});return()=>b()},[f,m]);const g=async b=>{b.preventDefault(),i(!0),l("");const k=await kR(t,n);k.error&&(k.error.includes("auth/invalid-credential")?l("Invalid email or password. Please check your credentials or register a new account."):k.error.includes("auth/user-not-found")?l("No account found with this email. Please register first."):k.error.includes("auth/wrong-password")?l("Incorrect password. Please try again."):k.error.includes("auth/user-disabled")?l("This account has been disabled. Please contact support."):k.error.includes("auth/too-many-requests")?l("Too many failed login attempts. Please try again later."):l(k.error)),i(!1)};return o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card max-w-md mx-auto",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Login"}),u&&o.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded-lg mb-4",children:u}),o.jsxs("form",{onSubmit:g,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Email"}),o.jsx("input",{type:"email",value:t,onChange:b=>e(b.target.value),className:"fantasy-input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Password"}),o.jsx("input",{type:"password",value:n,onChange:b=>r(b.target.value),className:"fantasy-input",required:!0})]}),a&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded-lg",children:a}),o.jsx("button",{type:"submit",disabled:s,className:"fantasy-button w-full",children:s?"Logging in...":"Login"})]}),o.jsx("div",{className:"mt-6 text-center",children:o.jsxs("p",{className:"text-gray-300",children:["Don't have an account?"," ",o.jsx("button",{onClick:()=>f("/register"),className:"text-amber-400 hover:text-amber-300 font-medium",children:"Register here"})]})})]})})}function MR(){const[t,e]=A.useState(""),[n,r]=A.useState(""),[s,i]=A.useState(""),[a,l]=A.useState(""),[u,d]=A.useState(""),[f,m]=A.useState(""),g=Wn();A.useEffect(()=>{IR().then(k=>{console.log("Firebase test result:",k)})},[]);const b=async k=>{if(k.preventDefault(),d(""),m(""),s!==a){d("Passwords do not match");return}if(!n.trim()){d("Username is required");return}if(n.length<3){d("Username must be at least 3 characters long");return}if(!/^[a-zA-Z0-9_]+$/.test(n)){d("Username can only contain letters, numbers, and underscores");return}console.log("Submitting registration for:",t,n);const{user:C,error:N,success:_}=await SR(t,s,n);if(console.log("Registration result:",{user:C,error:N,success:_}),N){console.log("Setting error:",N),d(N);return}_?(console.log("Registration successful, redirecting to login"),g("/login",{state:{message:"Registration successful! Please check your email to verify your account before logging in."}})):console.log("No success received from registration")};return o.jsx("div",{className:"fantasy-container min-h-screen flex items-center justify-center",children:o.jsxs("div",{className:"fantasy-card w-full max-w-md",children:[o.jsx("h2",{className:"fantasy-title text-center",children:"Begin Your Adventure"}),u&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded mb-4",children:u}),f&&o.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded mb-4",children:f}),o.jsxs("form",{onSubmit:b,className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-200",children:"Username"}),o.jsx("input",{id:"username",type:"text",required:!0,value:n,onChange:k=>r(k.target.value),className:"fantasy-input mt-1",placeholder:"Choose a unique username"}),o.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Letters, numbers, and underscores only. 3+ characters."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-200",children:"Email"}),o.jsx("input",{id:"email",type:"email",required:!0,value:t,onChange:k=>e(k.target.value),className:"fantasy-input mt-1"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-200",children:"Password"}),o.jsx("input",{id:"password",type:"password",required:!0,value:s,onChange:k=>i(k.target.value),className:"fantasy-input mt-1"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-200",children:"Confirm Password"}),o.jsx("input",{id:"confirmPassword",type:"password",required:!0,value:a,onChange:k=>l(k.target.value),className:"fantasy-input mt-1"})]}),o.jsx("button",{type:"submit",className:"fantasy-button w-full",children:"Register"})]}),o.jsxs("p",{className:"mt-4 text-center text-sm text-gray-300",children:["Already have an account?"," ",o.jsx(Kn,{to:"/login",className:"text-amber-400 hover:text-amber-300",children:"Return to your campaign"})]})]})})}function lb({validation:t,onClose:e,onProceed:n,onRevise:r}){if(!t)return null;const s=l=>{switch(l){case"valid":return"✅";case"redirect":return"🔄";case"expand":return"❓";case"impossible":return"🚫";default:return"🎲"}},i=l=>{switch(l){case"valid":return"text-green-600 bg-green-100";case"redirect":return"text-yellow-600 bg-yellow-100";case"expand":return"text-blue-600 bg-blue-100";case"impossible":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},a=(l,u)=>u==="critical success"?"text-green-800 bg-green-200":u==="great success"?"text-green-700 bg-green-100":u==="success"?"text-green-600 bg-green-50":u==="failure"?"text-red-600 bg-red-50":u==="great failure"?"text-red-700 bg-red-100":u==="critical failure"?"text-red-800 bg-red-200":l?"text-green-600 bg-green-100":"text-red-600 bg-red-100";return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Action Validation"}),o.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:`p-3 rounded-lg ${i(t.type)}`,children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-xl",children:s(t.type)}),o.jsx("span",{className:"font-semibold capitalize",children:t.type==="valid"?"Action Validated":t.type==="redirect"?"Action Needs Redirection":t.type==="expand"?"Action Needs Clarification":"Action Not Possible"})]})}),o.jsxs("div",{className:"p-4 bg-stone-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"DM Response"}),o.jsx("div",{className:"text-stone-600 italic leading-relaxed",children:typeof t.response=="string"?t.response:t.response.story})]}),t.suggestion&&o.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-blue-700 mb-2",children:"Suggestion"}),o.jsx("p",{className:"text-blue-600",children:t.suggestion})]}),t.diceResult&&o.jsxs("div",{className:"p-4 bg-amber-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-amber-700 mb-2",children:"Action Analysis"}),t.diceResult.summary&&o.jsx("div",{className:"mb-3 p-2 bg-amber-100 rounded text-sm font-medium",children:t.diceResult.summary}),t.diceResult.contextInfo&&o.jsxs("div",{className:"mb-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[o.jsx("h5",{className:"font-semibold text-blue-700 mb-2 text-sm",children:"Story Context"}),o.jsx("p",{className:"text-blue-600 text-sm mb-2",children:t.diceResult.contextInfo.description}),t.diceResult.contextInfo.environmentalFeatures.length>0&&o.jsxs("div",{className:"mb-2",children:[o.jsx("span",{className:"text-xs font-medium text-blue-700",children:"Environment:"}),o.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.diceResult.contextInfo.environmentalFeatures.map((l,u)=>o.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:l},u))})]}),t.diceResult.contextInfo.npcs.length>0&&o.jsxs("div",{className:"mb-2",children:[o.jsx("span",{className:"text-xs font-medium text-blue-700",children:"NPCs:"}),o.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.diceResult.contextInfo.npcs.map((l,u)=>o.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded",children:l.name},u))})]}),t.diceResult.contextInfo.circumstances.length>0&&o.jsxs("div",{children:[o.jsx("span",{className:"text-xs font-medium text-blue-700",children:"Circumstances:"}),o.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.diceResult.contextInfo.circumstances.map((l,u)=>o.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",children:l},u))})]})]}),t.diceResult.actions?o.jsxs("div",{className:"space-y-3",children:[t.diceResult.actions.map((l,u)=>o.jsxs("div",{className:"border border-amber-200 rounded-lg p-3 bg-white",children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"font-semibold capitalize text-stone-800",children:l.action}),l.quantity>1&&o.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:["×",l.quantity]}),l.isSequence&&o.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",children:"Sequence"})]}),o.jsx("p",{className:"text-sm text-stone-600",children:l.description})]}),o.jsx("span",{className:`px-3 py-1 rounded text-sm font-medium ${a(l.check.isSuccess,l.check.degree)}`,children:l.check.degree?l.check.degree.replace("_"," ").toUpperCase():l.check.isSuccess?"SUCCESS":"FAILURE"})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs text-stone-600",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Roll:"})," ",l.check.roll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Total:"})," ",l.check.totalRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"DC:"})," ",l.check.dc]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Difficulty:"})," ",l.difficulty]})]}),l.fatiguePenalty>0&&o.jsxs("div",{className:"mt-2 text-xs text-orange-600 bg-orange-50 p-2 rounded",children:["⚠️ Fatigue penalty: +",l.fatiguePenalty," DC (Action ",l.position," of ",l.totalInSequence,")"]}),l.contextModifiers&&o.jsxs("div",{className:"mt-2 text-xs text-blue-600 bg-blue-50 p-2 rounded",children:[o.jsx("span",{className:"font-medium",children:"Context modifiers:"}),o.jsx("ul",{className:"mt-1 space-y-1",children:l.contextModifiers.map((d,f)=>o.jsxs("li",{children:["• ",d]},f))})]}),l.check.circumstances&&l.check.circumstances.length>0&&o.jsxs("div",{className:"mt-2 text-xs text-blue-600",children:[o.jsx("span",{className:"font-medium",children:"Circumstances:"})," ",l.check.circumstances.join(", ")]})]},u)),o.jsxs("div",{className:"mt-4 p-3 bg-amber-100 rounded-lg",children:[o.jsxs("div",{className:"flex justify-between items-center text-sm font-medium",children:[o.jsx("span",{children:"Overall Success:"}),o.jsx("span",{className:`px-2 py-1 rounded ${t.diceResult.overallSuccess?"text-green-700 bg-green-200":"text-red-700 bg-red-200"}`,children:t.diceResult.overallSuccess?"SUCCESS":"FAILURE"})]}),t.diceResult.criticalFailures&&t.diceResult.criticalFailures.length>0&&o.jsxs("div",{className:"mt-2 text-xs text-red-600",children:["⚠️ ",t.diceResult.criticalFailures.length," critical failure(s) detected"]})]})]}):o.jsxs("div",{className:"text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Roll:"}),o.jsx("span",{className:"font-mono",children:t.diceResult.roll})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Total:"}),o.jsx("span",{className:"font-mono",children:t.diceResult.totalRoll})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"DC:"}),o.jsx("span",{className:"font-mono",children:t.diceResult.dc})]})]})]}),t.type!=="valid"&&o.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-purple-700 mb-2",children:"Alternative Approaches"}),o.jsxs("ul",{className:"text-purple-600 text-sm space-y-1",children:[o.jsx("li",{children:"• Try a more focused, single action"}),o.jsx("li",{children:"• Consider your character's abilities and limitations"}),o.jsx("li",{children:"• Think about what would be realistic in this situation"}),o.jsx("li",{children:"• Ask for clarification about what you're trying to achieve"})]})]})]}),o.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[t.type==="valid"?o.jsx("button",{onClick:n,className:"fantasy-button bg-green-600 hover:bg-green-700",children:"Proceed with Action"}):o.jsx("button",{onClick:r,className:"fantasy-button bg-blue-600 hover:bg-blue-700",children:"Revise Action"}),o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Cancel"})]})]})})}function cb({diceResult:t,onClose:e}){if(!t)return null;const n=s=>{switch(s){case"critical success":return"text-green-600 bg-green-100";case"great success":return"text-green-700 bg-green-50";case"success":return"text-blue-600 bg-blue-100";case"failure":return"text-yellow-600 bg-yellow-100";case"great failure":return"text-orange-600 bg-orange-100";case"critical failure":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},r=s=>{switch(s){case"critical success":return"🎯";case"great success":return"✅";case"success":return"✓";case"failure":return"⚠️";case"great failure":return"❌";case"critical failure":return"💥";default:return"🎲"}};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Dice Roll Results"}),o.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),t.actions?o.jsxs("div",{className:"space-y-4",children:[t.actions.map((s,i)=>o.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:s.action}),o.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${n(s.check.degree)}`,children:[r(s.check.degree)," ",s.check.degree]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Roll:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.roll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Total:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.totalRoll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"DC:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.dc})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Margin:"}),o.jsxs("span",{className:`font-mono ml-1 ${s.check.margin>=0?"text-green-600":"text-red-600"}`,children:[s.check.margin>=0?"+":"",s.check.margin]})]})]}),s.check.circumstanceBonus!==0&&o.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:["Circumstance bonus: ",s.check.circumstanceBonus>=0?"+":"",s.check.circumstanceBonus]})]},i)),o.jsxs("div",{className:"mt-4 p-3 bg-stone-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"Overall Result"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${t.overallSuccess?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:t.overallSuccess?"✅ Success":"❌ Partial Failure"}),t.hasCriticalFailures&&o.jsx("span",{className:"text-red-600 text-sm",children:"⚠️ Critical failures occurred"})]})]})]}):o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:t.actionType}),o.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${n(t.degree)}`,children:[r(t.degree)," ",t.degree]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Roll:"}),o.jsx("span",{className:"font-mono ml-1",children:t.roll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Total:"}),o.jsx("span",{className:"font-mono ml-1",children:t.totalRoll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"DC:"}),o.jsx("span",{className:"font-mono ml-1",children:t.dc})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Margin:"}),o.jsxs("span",{className:`font-mono ml-1 ${t.margin>=0?"text-green-600":"text-red-600"}`,children:[t.margin>=0?"+":"",t.margin]})]})]}),o.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:[o.jsxs("div",{children:["Primary Mod: ",t.primaryMod>=0?"+":"",t.primaryMod]}),o.jsxs("div",{children:["Proficiency: ",t.proficiencyMod>=0?"+":"",t.proficiencyMod]}),t.circumstanceBonus!==0&&o.jsxs("div",{children:["Circumstance: ",t.circumstanceBonus>=0?"+":"",t.circumstanceBonus]})]})]})}),o.jsx("div",{className:"mt-4 flex justify-end",children:o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Close"})})]})})}function LR({multipleResults:t,onClose:e}){const[n,r]=A.useState(!1),[s,i]=A.useState(null);if(!t)return null;const{actionType:a,numberOfAttempts:l,results:u,statistics:d}=t,f=C=>C.adjustedSuccess&&C.adjustedMargin>=10?"bg-green-500":C.adjustedSuccess?"bg-green-400":!C.adjustedSuccess&&C.adjustedMargin<=-10?"bg-red-500":"bg-red-400",m=C=>C.adjustedSuccess&&C.adjustedMargin>=10?"🎯":C.adjustedSuccess?"✅":!C.adjustedSuccess&&C.adjustedMargin<=-10?"💥":"❌",g=C=>{const N=`Attempt ${C.attemptNumber}: ${C.roll} + ${C.primaryMod} + ${C.proficiencyMod}`,_=C.fatiguePenalty>0?` - ${C.fatiguePenalty} (fatigue)`:"",x=` = ${C.adjustedTotalRoll} vs DC ${C.dc}`,I=C.adjustedSuccess?" (Success)":" (Failure)";return N+_+x+I},k=((C,N=50)=>{const _=[];for(let x=0;x<C.length;x+=N)_.push(C.slice(x,x+N));return _})(u);return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsxs("h3",{className:"text-lg font-bold text-stone-800",children:["Multiple Attempts: ",a," (",l," attempts)"]}),o.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),o.jsxs("div",{className:"mb-6 p-4 bg-stone-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-stone-700 mb-3",children:"Overall Statistics"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.successfulAttempts}),o.jsx("div",{className:"text-sm text-stone-600",children:"Successful"})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[d.successRate.toFixed(1),"%"]}),o.jsx("div",{className:"text-sm text-stone-600",children:"Success Rate"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-amber-600",children:d.criticalSuccesses}),o.jsx("div",{className:"text-sm text-stone-600",children:"Critical Successes"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-red-600",children:d.criticalFailures}),o.jsx("div",{className:"text-sm text-stone-600",children:"Critical Failures"})]})]}),o.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Average Roll:"})," ",d.averageRoll.toFixed(1)]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Best Roll:"})," ",d.bestRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Worst Roll:"})," ",d.worstRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Average Total:"})," ",d.averageTotalRoll.toFixed(1)]})]})]}),o.jsxs("div",{className:"mb-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700",children:"Individual Attempts"}),o.jsx("button",{onClick:()=>r(!n),className:"text-sm text-blue-600 hover:text-blue-800",children:n?"Hide Details":"Show Details"})]}),o.jsx("div",{className:"space-y-2",children:k.map((C,N)=>o.jsxs("div",{className:"flex flex-wrap gap-1",children:[C.map(_=>o.jsx("div",{className:`w-6 h-6 rounded text-xs flex items-center justify-center cursor-pointer transition-colors ${f(_)} text-white font-bold`,title:g(_),onClick:()=>i(_),children:m(_)},_.attemptNumber)),N<k.length-1&&o.jsx("div",{className:"w-full h-px bg-stone-300 my-2"})]},N))})]}),o.jsxs("div",{className:"mb-4 p-3 bg-stone-50 rounded-lg",children:[o.jsx("h5",{className:"font-semibold text-stone-700 mb-2",children:"Legend"}),o.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-green-500 rounded text-white text-xs flex items-center justify-center",children:"🎯"}),o.jsx("span",{children:"Critical Success"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-green-400 rounded text-white text-xs flex items-center justify-center",children:"✅"}),o.jsx("span",{children:"Success"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-red-400 rounded text-white text-xs flex items-center justify-center",children:"❌"}),o.jsx("span",{children:"Failure"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-red-500 rounded text-white text-xs flex items-center justify-center",children:"💥"}),o.jsx("span",{children:"Critical Failure"})]})]})]}),s&&o.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[o.jsxs("h5",{className:"font-semibold text-blue-700 mb-2",children:["Attempt ",s.attemptNumber," Details"]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Roll:"})," ",s.roll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Primary Mod:"})," ",s.primaryMod>=0?"+":"",s.primaryMod]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Proficiency:"})," ",s.proficiencyMod>=0?"+":"",s.proficiencyMod]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Fatigue Penalty:"})," -",s.fatiguePenalty]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Total:"})," ",s.adjustedTotalRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"DC:"})," ",s.dc]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Margin:"})," ",s.adjustedMargin>=0?"+":"",s.adjustedMargin]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Result:"}),o.jsx("span",{className:`ml-1 px-2 py-1 rounded text-xs font-medium ${s.adjustedSuccess?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.adjustedSuccess?"Success":"Failure"})]})]}),o.jsx("button",{onClick:()=>i(null),className:"mt-2 text-sm text-blue-600 hover:text-blue-800",children:"Close Details"})]}),n&&o.jsxs("div",{className:"mb-4",children:[o.jsx("h5",{className:"font-semibold text-stone-700 mb-2",children:"Detailed Results"}),o.jsx("div",{className:"max-h-64 overflow-y-auto",children:o.jsxs("table",{className:"w-full text-sm",children:[o.jsx("thead",{className:"bg-stone-100",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-2 py-1 text-left",children:"#"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Roll"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Total"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"DC"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Fatigue"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Result"})]})}),o.jsx("tbody",{children:u.map(C=>o.jsxs("tr",{className:"border-b border-stone-200",children:[o.jsx("td",{className:"px-2 py-1",children:C.attemptNumber}),o.jsx("td",{className:"px-2 py-1",children:C.roll}),o.jsx("td",{className:"px-2 py-1",children:C.adjustedTotalRoll}),o.jsx("td",{className:"px-2 py-1",children:C.dc}),o.jsxs("td",{className:"px-2 py-1",children:["-",C.fatiguePenalty]}),o.jsx("td",{className:"px-2 py-1",children:o.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${C.adjustedSuccess?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:C.adjustedSuccess?"Success":"Failure"})})]},C.attemptNumber))})]})})]}),o.jsx("div",{className:"flex justify-end",children:o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Close"})})]})})}function OR(){const t=Wn(),[e,n]=A.useState(null),[r,s]=A.useState([]),[i,a]=A.useState(!0);A.useState(""),A.useState(""),A.useState(null),A.useState(!1),A.useState(!1),A.useState(!1),A.useState(null),A.useState(null),A.useState(null),A.useEffect(()=>{const m=xs.onAuthStateChanged(async g=>{g?(n(g),await l(g.uid)):t("/login")});return()=>m()},[t]);const l=async m=>{try{const g=await Xm(m);await u(g),s(g)}catch(g){console.error("Error loading user data:",g)}finally{a(!1)}},u=async m=>{for(const g of m)if(g.members)for(const b of g.members)b.profileId},d=async m=>{try{await ib(m,e.uid),s(g=>g.filter(b=>b.id!==m))}catch(g){console.error("Error deleting party:",g)}},f=()=>{t("/test-environment")};return i?o.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto"}),o.jsx("p",{className:"mt-4 text-gray-300",children:"Loading..."})]})}):o.jsx("div",{className:"min-h-screen bg-gray-900",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"mb-6 sm:mb-8",children:[o.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-100",children:"Dashboard"}),o.jsxs("p",{className:"text-gray-300 mt-2 text-sm sm:text-base",children:["Welcome back, ",(e==null?void 0:e.displayName)||(e==null?void 0:e.email),"! Manage your campaigns and test the system."]})]}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Test Environment"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Test action validation, dice rolling, and combat detection in a controlled environment."}),o.jsx("button",{onClick:f,className:"w-full fantasy-button bg-green-600 hover:bg-green-700",children:"Open Test Environment"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Create New Campaign"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Start a new campaign with your party."}),o.jsx("button",{onClick:()=>t("/campaign-management"),className:"w-full fantasy-button bg-blue-600 hover:bg-blue-700",children:"Create Campaign"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Character Creation"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Create new characters for your campaigns."}),o.jsx("button",{onClick:()=>t("/character-creation"),className:"w-full fantasy-button bg-purple-600 hover:bg-purple-700",children:"Create Character"})]})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("div",{className:"border-b border-gray-700 pb-4 mb-4",children:o.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:"Your Campaigns"})}),r.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-gray-300 mb-4",children:"You haven't created any campaigns yet."}),o.jsx("button",{onClick:()=>t("/campaign-management"),className:"fantasy-button bg-blue-600 hover:bg-blue-700",children:"Create Your First Campaign"})]}):o.jsx("div",{className:"space-y-4",children:r.map(m=>{var g;return o.jsx("div",{className:"border border-gray-600 rounded-lg p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100",children:m.name}),o.jsx("p",{className:"text-gray-300 mt-1 text-sm",children:m.description}),o.jsxs("div",{className:"flex flex-wrap items-center mt-2 gap-2 text-xs sm:text-sm text-gray-400",children:[o.jsxs("span",{children:[((g=m.members)==null?void 0:g.length)||0," members"]}),o.jsx("span",{children:"•"}),o.jsxs("span",{children:["Theme: ",m.theme]}),o.jsx("span",{children:"•"}),o.jsxs("span",{children:["Created: ",new Date(m.createdAt).toLocaleDateString()]})]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[o.jsx("button",{onClick:()=>t(`/campaign/${m.id}`),className:"fantasy-button bg-blue-600 hover:bg-blue-700 flex-1",children:"Continue"}),o.jsx("button",{onClick:()=>d(m.id),className:"fantasy-button bg-red-600 hover:bg-red-700 flex-1",children:"Delete"})]})]})},m.id)})})]})]})})}class Au{constructor(){this.diceTypes={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20,d100:100},this.difficultyClasses={veryEasy:5,easy:10,medium:15,hard:20,veryHard:25,nearlyImpossible:30},this.actionTypes={attack:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:10,description:"Physical attack roll"},spell:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:12,description:"Spell casting check"},dodge:{primaryAbility:"dexterity",secondaryAbility:"wisdom",baseDC:15,description:"Dodge incoming attacks"},parry:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:18,description:"Parry with weapon"},backflip:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:20,description:"Perform a backflip"},somersault:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:18,description:"Perform a somersault"},cartwheel:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:16,description:"Perform a cartwheel"},wallRun:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:22,description:"Run up a wall"},jump:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:12,description:"Jump over obstacles"},climb:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:15,description:"Climb surfaces"},swim:{primaryAbility:"strength",secondaryAbility:"constitution",baseDC:14,description:"Swim through water"},fly:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:30,description:"Fly through the air"},persuade:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:15,description:"Persuade someone"},intimidate:{primaryAbility:"charisma",secondaryAbility:"strength",baseDC:16,description:"Intimidate someone"},deceive:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:18,description:"Deceive someone"},spot:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:12,description:"Spot hidden objects or creatures"},listen:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:10,description:"Listen for sounds"},search:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:14,description:"Search for hidden items"},pickLock:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:20,description:"Pick a lock"},disarmTrap:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:22,description:"Disarm a trap"},heal:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:16,description:"Provide medical aid"},craft:{primaryAbility:"intelligence",secondaryAbility:"dexterity",baseDC:18,description:"Craft an item"}},this.impossibleActionPatterns=[/\b(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,/\b(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,/\b(?:jump|leap)\s+(?:to|over|across)\s+(?:the\s+)?(?:moon|sky|clouds?)\b/gi,/\b(?:teleport|blink|phase)\s+(?:to|through)\b/gi,/\b(?:time\s+travel|rewind|fast\s+forward)\b/gi,/\b(?:summon|create)\s+(?:a\s+)?(?:dragon|god|demon)\b/gi,/\b(?:become|turn\s+into)\s+(?:invisible|invincible|immortal)\b/gi,/\b(?:kill|destroy|eliminate)\s+(?:the\s+)?(?:dm|dungeon\s+master|narrator)\b/gi,/\b(?:break|destroy)\s+(?:the\s+)?(?:fourth\s+wall|game|story)\b/gi,/\b(?:skip|ignore)\s+(?:the\s+)?(?:quest|mission|story)\b/gi,/\b(?:teleport|go)\s+(?:to\s+)?(?:the\s+)?(?:end|final\s+boss|treasure)\b/gi,/\b(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,/\b(?:open|unlock)\s+(?:the\s+)?(?:door|chest)\s+(?:without\s+)?(?:key|lockpick)\b/gi,/\b(?:find|locate)\s+(?:the\s+)?(?:hidden\s+)?(?:passage|door)\s+(?:without\s+)?(?:searching)\b/gi],this.circumstanceModifiers={"in darkness":-2,"in bright light":1,"in difficult terrain":-2,"on slippery surface":-3,"in water":-2,"in tight space":-1,"with cover":2,"with high ground":1,"with low ground":-1,"with proper tools":2,"with improvised tools":-1,"without tools":-3,"with magical item":1,"with masterwork item":2,"while injured":-2,"while exhausted":-3,"while hasted":2,"while blessed":1,"while cursed":-2,"while poisoned":-1,"under time pressure":-2,"with preparation":1,"with careful planning":2,"in a hurry":-2,"with authority":1,"with evidence":2,"with witnesses":-1,"in private":1,"in public":-1}}rollDie(e){return Math.floor(Math.random()*e)+1}rollDice(e,n){const r=[];for(let s=0;s<e;s++)r.push(this.rollDie(n));return r}rollWithAdvantage(){const e=this.rollDie(20),n=this.rollDie(20);return{result:Math.max(e,n),rolls:[e,n],advantage:!0}}rollWithDisadvantage(){const e=this.rollDie(20),n=this.rollDie(20);return{result:Math.min(e,n),rolls:[e,n],disadvantage:!0}}getAbilityModifier(e){return Math.floor((e-10)/2)}getProficiencyBonus(e){return Math.floor((e-1)/4)+2}performSkillCheck(e,n,r=[],s=null){const i=this.actionTypes[n];if(!i)throw new Error(`Unknown action type: ${n}`);let a=s||i.baseDC,l=0;r.forEach(x=>{this.circumstanceModifiers[x]&&(l+=this.circumstanceModifiers[x])});const u=this.getAbilityModifier(e[i.primaryAbility]||10),d=this.getAbilityModifier(e[i.secondaryAbility]||10),f=this.getProficiencyBonus(e.level||1),g=this.checkProficiency(e,n)?f:0,b=this.rollDie(20),k=b+u+g+l,C=k>=a,N=k-a;let _="failure";return C?N>=10?_="critical success":N>=5?_="great success":_="success":N<=-10?_="critical failure":N<=-5?_="great failure":_="failure",{actionType:n,roll:b,totalRoll:k,dc:a,primaryMod:u,secondaryMod:d,proficiencyMod:g,circumstanceBonus:l,isSuccess:C,degree:_,margin:N,circumstances:r,character:{name:e.name,level:e.level,[i.primaryAbility]:e[i.primaryAbility],[i.secondaryAbility]:e[i.secondaryAbility]}}}checkProficiency(e,n){const r=e.proficiencies||[],i={Fighter:["attack","dodge","parry"],Rogue:["dodge","pickLock","disarmTrap","spot","listen"],Wizard:["spell","search","craft"],Cleric:["heal","persuade","spot"],Ranger:["spot","listen","climb","swim"],Paladin:["attack","parry","persuade"],Monk:["attack","dodge","backflip","somersault","cartwheel"],Bard:["persuade","deceive","intimidate"],Druid:["heal","spot","listen"],Sorcerer:["spell","persuade"],Warlock:["spell","intimidate"],Barbarian:["attack","intimidate","jump","climb"]}[e.class]||[];return r.includes(n)||i.includes(n)}validateAction(e,n,r={}){const s=e.toLowerCase();for(const C of this.impossibleActionPatterns)if(C.test(s))return{possible:!1,reason:"This action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};let i=this.extractActionsFromDescription(s);if(i=i.filter(C=>C.type!==void 0),i.length===0)return{possible:!0,reason:"No valid action detected. Action appears to be narrative or unsupported.",suggestion:"Try a different action or rephrase your input.",actions:[],overallSuccess:!0,hasCriticalFailures:!1,criticalFailures:[]};const a=r.customContext;let l=[],u=[],d=[];a&&(a.environmentalFeatures&&(u=a.environmentalFeatures,l.push(`Environmental features: ${u.join(", ")}`)),a.npcs&&(d=a.npcs,l.push(`NPCs present: ${d.map(C=>C.name).join(", ")}`)),a.circumstances&&l.push(`Circumstances: ${a.circumstances.join(", ")}`));const f=i.map((C,N)=>{const _=Math.max(0,N*2),x=Array.isArray(C.circumstances)?[...C.circumstances]:[];_>0&&x.push(`while fatigued (action ${N+1} of ${i.length})`),u.forEach(D=>{x.includes(D)||x.push(D)}),a&&a.circumstances&&a.circumstances.forEach(D=>{x.includes(D)||x.push(D)});const I=this.performSkillCheck(n,C.type,x);return{action:C.type,description:C.description,check:I,difficulty:this.getDifficultyDescription(I.dc),position:C.position||N+1,totalInSequence:C.totalInSequence||i.length,quantity:C.quantity||1,keyword:C.keyword,isSequence:C.isSequence||!1,fatiguePenalty:_,contextModifiers:l.length>0?l:null}}),m=f.every(C=>C.check.isSuccess),g=f.filter(C=>C.check.degree==="critical failure"),b=f.filter(C=>!C.check.isSuccess);let k="";if(i.length===1)k=`Single action detected: ${f[0].description}`;else{const C=[...new Set(f.map(_=>_.action))];k=`Multiple actions detected: ${f.reduce((_,x)=>_+x.quantity,0)} total actions across ${C.length} different types`}return a&&(k+=` | Context: ${a.description.substring(0,50)}${a.description.length>50?"...":""}`),{possible:!0,actions:f,overallSuccess:m,hasCriticalFailures:g.length>0,criticalFailures:g,failures:b,totalActions:i.length,summary:k,contextInfo:a?{description:a.description,environmentalFeatures:u,npcs:d,circumstances:a.circumstances||[]}:null,suggestion:this.generateActionSuggestion(f,n)}}extractActionsFromDescription(e){var u,d;const n=[],r=e.toLowerCase(),s=[/\b(\d+)\s+(backflips?|somersaults?|cartwheels?|jumps?|leaps?|hops?)\b/gi,/\b(\d+)\s+(punches?|kicks?|strikes?|attacks?|swings?|slashes?)\b/gi,/\b(\d+)\s+(spells?|casts?|magic\s+spells?)\b/gi,/\b(\d+)\s+(dodges?|evades?|parries?|blocks?)\b/gi,/\b(\d+)\s+(climbs?|scales?|swims?)\b/gi,/\b(\d+)\s+(searches?|looks?|examines?)\b/gi,/\b(\d+)\s+(persuades?|intimidates?|deceives?)\b/gi];s.forEach(f=>{var g;let m;for(;(m=f.exec(r))!==null;){const b=parseInt(m[1]),k=m[2],C=this.mapKeywordToActionType(k);if(C)for(let N=0;N<b;N++){const _=this.extractCircumstances(e);n.push({type:C,description:((g=this.actionTypes[C])==null?void 0:g.description)||`${C} action`,circumstances:_,keyword:k,quantity:b,position:N+1,totalInSequence:b})}}}),Object.entries(this.actionTypes).forEach(([f,m])=>{this.getActionKeywords(f).forEach(b=>{if(!n.some(C=>C.type===f)&&r.includes(b)&&!s.some(N=>new RegExp(N.source.replace(/\\d\+/,"\\d+"),"gi").test(r))){const N=this.extractCircumstances(e);n.push({type:f,description:m.description,circumstances:N,keyword:b,quantity:1,position:1,totalInSequence:1})}})}),[/\b(backflip|somersault|cartwheel|jump|leap|hop)\s+(?:and\s+then\s+)?(punch|kick|strike|attack|swing|slash)\b/gi,/\b(punch|kick|strike|attack|swing|slash)\s+(?:and\s+then\s+)?(backflip|somersault|cartwheel|jump|leap|hop)\b/gi,/\b(dodge|evade|parry|block)\s+(?:and\s+then\s+)?(attack|strike|punch|kick)\b/gi,/\b(attack|strike|punch|kick)\s+(?:and\s+then\s+)?(dodge|evade|parry|block)\b/gi].forEach(f=>{var g,b;let m;for(;(m=f.exec(r))!==null;){const k=this.mapKeywordToActionType(m[1]),C=this.mapKeywordToActionType(m[2]);if(k&&C){const N=this.extractCircumstances(e);n.some(_=>_.type===k&&_.keyword===m[1])||n.push({type:k,description:((g=this.actionTypes[k])==null?void 0:g.description)||`${k} action`,circumstances:N,keyword:m[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),n.some(_=>_.type===C&&_.keyword===m[2])||n.push({type:C,description:((b=this.actionTypes[C])==null?void 0:b.description)||`${C} action`,circumstances:N,keyword:m[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}});const a=/\b(\w+)\s+and\s+(\w+)\b/gi;let l;for(;(l=a.exec(r))!==null;){const f=this.mapKeywordToActionType(l[1]),m=this.mapKeywordToActionType(l[2]);if(f&&m){const g=this.extractCircumstances(e);n.some(b=>b.type===f&&b.keyword===l[1])||n.push({type:f,description:((u=this.actionTypes[f])==null?void 0:u.description)||`${f} action`,circumstances:g,keyword:l[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),n.some(b=>b.type===m&&b.keyword===l[2])||n.push({type:m,description:((d=this.actionTypes[m])==null?void 0:d.description)||`${m} action`,circumstances:g,keyword:l[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}return n}mapKeywordToActionType(e){return{punch:"attack",punches:"attack",kick:"attack",kicks:"attack",strike:"attack",strikes:"attack",attack:"attack",attacks:"attack",swing:"attack",swings:"attack",slash:"attack",slashes:"attack",thrust:"attack",thrusts:"attack",backflip:"backflip",backflips:"backflip",somersault:"somersault",somersaults:"somersault",cartwheel:"cartwheel",cartwheels:"cartwheel",jump:"jump",jumps:"jump",leap:"jump",leaps:"jump",hop:"jump",hops:"jump",climb:"climb",climbs:"climb",scale:"climb",scales:"climb",swim:"swim",swims:"swim",dodge:"dodge",dodges:"dodge",evade:"dodge",evades:"dodge",parry:"parry",parries:"parry",block:"parry",blocks:"parry",spell:"spell",spells:"spell",cast:"spell",casts:"spell","magic spell":"spell","magic spells":"spell",persuade:"persuade",persuades:"persuade",intimidate:"intimidate",intimidates:"intimidate",deceive:"deceive",deceives:"deceive",search:"search",searches:"search",look:"search",looks:"search",examine:"search",examines:"search"}[e.toLowerCase()]}getActionKeywords(e){return{attack:["attack","strike","hit","swing","slash","thrust","punch","kick"],spell:["cast","spell","magic","enchant","charm"],dodge:["dodge","evade","avoid","sidestep"],parry:["parry","block","deflect"],backflip:["backflip","back flip"],somersault:["somersault","forward roll"],cartwheel:["cartwheel"],wallRun:["wall run","run up wall"],jump:["jump","leap","hop"],climb:["climb","scale"],swim:["swim"],fly:["fly","levitate","float"],persuade:["persuade","convince","talk into"],intimidate:["intimidate","threaten","scare"],deceive:["deceive","lie","trick"],spot:["spot","see","notice","observe"],listen:["listen","hear"],search:["search","look for","find"],pickLock:["pick lock","lockpick"],disarmTrap:["disarm","trap"],heal:["heal","cure","treat"],craft:["craft","make","create","build"]}[e]||[]}extractCircumstances(e){const n=[];return Object.keys(this.circumstanceModifiers).forEach(r=>{e.includes(r)&&n.push(r)}),n}getDifficultyDescription(e){return e<=5?"Very Easy":e<=10?"Easy":e<=15?"Medium":e<=20?"Hard":e<=25?"Very Hard":"Nearly Impossible"}generateActionSuggestion(e,n){const r=e.filter(i=>!i.check.isSuccess);return r.length===0?"All actions are within your capabilities. Proceed with confidence!":r.map(i=>{const a=i.action;return i.check.degree==="critical failure"?`The ${a} is extremely difficult for you. Consider an alternative approach or ask for help.`:`The ${a} is challenging. You might want to take your time or use better equipment.`}).join(" ")}performActionSequence(e,n,r={}){const s=[];let i=0;for(let u=0;u<n.length;u++){const d=n[u],f=Array.isArray(d.circumstances)?[...d.circumstances]:[];i>0?f.push("with momentum"):i<0&&f.push("while fatigued");const m=this.performSkillCheck(e,d.type,f);s.push({action:d.type,check:m,sequencePosition:u+1}),m.isSuccess?i+=1:i-=2}const a=s.every(u=>u.check.isSuccess),l=s.filter(u=>u.check.degree==="critical failure");return{actions:s,overallSuccess:a,hasCriticalFailures:l.length>0,criticalFailures:l,sequenceLength:n.length,finalModifier:i}}generateActionNarrative(e,n){const{actionType:r,check:s,degree:i}=e;this.actionTypes[r];const a={attack:{"critical success":`${n.name} executes a perfect ${r}, striking with incredible precision!`,"great success":`${n.name} performs an excellent ${r}, hitting the target solidly.`,success:`${n.name} successfully ${r}s the target.`,failure:`${n.name} attempts to ${r} but misses the mark.`,"great failure":`${n.name} completely fails to ${r}, leaving themselves open.`,"critical failure":`${n.name} botches the ${r} spectacularly, potentially harming themselves!`},backflip:{"critical success":`${n.name} performs a flawless backflip, landing gracefully with perfect form!`,"great success":`${n.name} executes a smooth backflip, impressing onlookers.`,success:`${n.name} manages to complete the backflip successfully.`,failure:`${n.name} attempts a backflip but loses balance and stumbles.`,"great failure":`${n.name} fails the backflip badly, landing awkwardly.`,"critical failure":`${n.name} completely fails the backflip, potentially injuring themselves!`},fly:{"critical success":`${n.name} somehow defies gravity and soars through the air with supernatural grace!`,"great success":`${n.name} manages to achieve brief flight through incredible effort!`,success:`${n.name} makes a valiant attempt at flight, achieving a brief hover.`,failure:`${n.name} tries to fly but only manages an awkward hop.`,"great failure":`${n.name} attempts flight but falls flat on their face.`,"critical failure":`${n.name} tries to fly and crashes spectacularly, looking quite foolish!`}},l=a[r]||a.attack;return l[i]||l.failure}performMultipleSkillChecks(e,n,r,s=[],i=null){var b,k,C,N;const a=[];let l=0;const u=1;for(let _=1;_<=r;_++){const x=l*u,I=[...s];l>0&&I.push(`while fatigued (attempt ${_})`);const D=this.performSkillCheck(e,n,I,i),F={...D,attemptNumber:_,fatigueLevel:l,fatiguePenalty:x,adjustedTotalRoll:D.totalRoll-x,adjustedMargin:D.totalRoll-x-D.dc,adjustedSuccess:D.totalRoll-x>=D.dc};a.push(F),l++}const d=a.filter(_=>_.adjustedSuccess).length,f=a.filter(_=>_.adjustedSuccess&&_.adjustedMargin>=10).length,m=a.filter(_=>!_.adjustedSuccess&&_.adjustedMargin<=-10).length,g=d/r*100;return{actionType:n,numberOfAttempts:r,results:a,statistics:{successfulAttempts:d,criticalSuccesses:f,criticalFailures:m,successRate:g,averageRoll:a.reduce((_,x)=>_+x.roll,0)/r,averageTotalRoll:a.reduce((_,x)=>_+x.adjustedTotalRoll,0)/r,bestRoll:Math.max(...a.map(_=>_.adjustedTotalRoll)),worstRoll:Math.min(...a.map(_=>_.adjustedTotalRoll))},character:{name:e.name,level:e.level,[(b=this.actionTypes[n])==null?void 0:b.primaryAbility]:e[(k=this.actionTypes[n])==null?void 0:k.primaryAbility],[(C=this.actionTypes[n])==null?void 0:C.secondaryAbility]:e[(N=this.actionTypes[n])==null?void 0:N.secondaryAbility]}}}performMultipleDiceRolls(e,n,r="standard"){const s=[];for(let d=1;d<=e;d++){let f;switch(r){case"advantage":f=this.rollWithAdvantage();break;case"disadvantage":f=this.rollWithDisadvantage();break;default:f={result:this.rollDie(n),rolls:[this.rollDie(n)],advantage:!1,disadvantage:!1}}s.push({...f,rollNumber:d,sides:n})}const i=s.map(d=>d.result),a=i.reduce((d,f)=>d+f,0)/e,l=Math.max(...i),u=Math.min(...i);return{numberOfRolls:e,sides:n,rollType:r,results:s,statistics:{average:a,max:l,min:u,total:i.reduce((d,f)=>d+f,0),natural20s:i.filter(d=>d===20).length,natural1s:i.filter(d=>d===1).length}}}generateMultipleAttemptsNarrative(e,n){const{actionType:r,numberOfAttempts:s,statistics:i}=e,a=this.actionTypes[r];if(!a)return`${n.name} attempts ${r} ${s} times.`;const l=i.successRate,u=i.criticalSuccesses,d=i.criticalFailures;let f=`${n.name} attempts to ${a.description} ${s} times. `;return l>=80?f+=`They perform exceptionally well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:l>=60?f+=`They perform well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:l>=40?f+=`They have mixed results, succeeding ${i.successfulAttempts} out of ${s} attempts.`:l>=20?f+=`They struggle, only succeeding ${i.successfulAttempts} out of ${s} attempts.`:f+=`They perform poorly, only succeeding ${i.successfulAttempts} out of ${s} attempts.`,u>0&&(f+=` They achieve ${u} spectacular successes!`),d>0&&(f+=` They suffer ${d} embarrassing failures.`),s>10&&(f+=" The repeated attempts take their toll, and fatigue begins to set in."),f}}class Jm{constructor(){this.diceService=new Au,this.storyRules={redirectPatterns:[{pattern:/\b(?:i\s+)?(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,response:"While impressive acrobatics are possible, let's focus on actions that advance the story. What's your main goal here?",suggestion:"Try describing a more focused action that helps with the current situation."},{pattern:/\b(?:i\s+)?(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,response:"Flight isn't currently possible in this situation. What are you trying to achieve?",suggestion:"Consider climbing, jumping, or finding another way to reach your destination."},{pattern:/\b(?:i\s+)?(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,response:"The quest item isn't just lying around. You'll need to find it through exploration and investigation.",suggestion:"Try searching the area, asking NPCs, or following clues to locate the item."},{pattern:/\b(?:i\s+)?(?:attack|kill|destroy)\s+(?:everyone|all|each)\s+(?:enemy|person|creature)\b/gi,response:"While combat is possible, attacking everyone at once isn't practical. Let's focus on the immediate threat.",suggestion:"Choose a specific target or describe a more strategic approach."}],expandPatterns:[{pattern:/\b(?:i\s+)?(?:search|look|examine)\b/gi,response:"What specifically are you searching for or looking at?",suggestion:"Be more specific about what you're searching for or examining."},{pattern:/\b(?:i\s+)?(?:talk|speak|ask)\b/gi,response:"Who would you like to talk to, and what would you like to discuss?",suggestion:"Specify the person and topic of conversation."},{pattern:/\b(?:i\s+)?(?:go|move|walk)\b/gi,response:"Where would you like to go?",suggestion:"Specify your destination or direction."}],encouragePatterns:[{pattern:/\b(?:i\s+)?(?:investigate|explore|examine)\b/gi,response:"Great! Investigation and exploration are key to advancing the story.",suggestion:"What specific aspect would you like to investigate?"},{pattern:/\b(?:i\s+)?(?:help|assist|aid)\b/gi,response:"Helping others is always a noble choice. Who would you like to help?",suggestion:"Specify who needs help and how you can assist them."},{pattern:/\b(?:i\s+)?(?:negotiate|diplomacy|peace)\b/gi,response:"Diplomacy can often achieve more than violence. Good thinking!",suggestion:"How would you like to approach the negotiation?"}]},this.contextResponses={combat:{impossible:"That action isn't possible in combat. Focus on your available combat options.",difficult:"That's a challenging action in combat. Are you sure you want to attempt it?",strategic:"That's a good strategic choice. How do you want to execute it?"},exploration:{impossible:"That action doesn't make sense in this environment. What are you trying to achieve?",difficult:"That will be challenging given the current circumstances.",strategic:"That's a good approach to exploration. Let's see how it goes."},social:{impossible:"That action isn't appropriate in this social situation.",difficult:"That's a bold social move. Are you prepared for the consequences?",strategic:"That's a good approach to the situation. How do you want to proceed?"}}}validatePlayerAction(e,n,r={}){const s=e.toLowerCase(),i=this.checkImpossibleActions(s);if(!i.possible)return{valid:!1,type:"impossible",response:i.response,suggestion:i.suggestion,diceResult:null};const a=this.checkRedirectPatterns(s);if(a.needsRedirect)return{valid:!1,type:"redirect",response:a.response,suggestion:a.suggestion,diceResult:null};const l=this.checkExpandPatterns(s);if(l.needsExpansion)return{valid:!1,type:"expand",response:l.response,suggestion:l.suggestion,diceResult:null};const u=this.diceService.validateAction(e,n,r);return{valid:!0,type:"valid",response:this.generateValidationResponse(u,n,r),suggestion:u.suggestion,diceResult:u}}checkImpossibleActions(e){for(const n of this.diceService.impossibleActionPatterns)if(n.test(e))return{possible:!1,response:"That action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};return{possible:!0}}checkRedirectPatterns(e){for(const n of this.storyRules.redirectPatterns)if(n.pattern.test(e))return{needsRedirect:!0,response:n.response,suggestion:n.suggestion};return{needsRedirect:!1}}checkExpandPatterns(e){for(const n of this.storyRules.expandPatterns)if(n.pattern.test(e))return{needsExpansion:!0,response:n.response,suggestion:n.suggestion};return{needsExpansion:!1}}generateValidationResponse(e,n,r){if(!e.overallSuccess)return e.actions.filter(u=>!u.check.isSuccess).filter(u=>u.check.degree==="critical failure").length>0?`The actions you described are beyond your current capabilities. ${e.suggestion}`:`The actions you described are challenging but possible. ${e.suggestion}`;const s=this.generateAtmosphericResponse(e,n,r),i=this.extractEntities(s,r);return{story:s,entities:i}}generateAtmosphericResponse(e,n,r){const{actions:s,overallSuccess:i,hasCriticalFailures:a}=e,l=r==null?void 0:r.customContext;let u=this.getAtmosphericElements(l),d=this.calculateTensionLevel(s,a),f="";return s.length===1?f=this.generateSingleActionResponse(s[0],n,u,d):f=this.generateMultiActionResponse(s,n,u,d),l&&l.environmentalFeatures&&(f+=this.addEnvironmentalDetails(l.environmentalFeatures,d)),l&&l.npcs&&(f+=this.addNPCReactions(l.npcs,s,i)),f+=this.addStoryProgressionHook(s,d,l),f}getAtmosphericElements(e){const n={lighting:"dim",weather:"calm",mood:"neutral",tension:"low"};if(!e)return n;const r=e.description.toLowerCase();return(r.includes("dark")||r.includes("shadow"))&&(n.lighting="dark"),(r.includes("bright")||r.includes("sunlight"))&&(n.lighting="bright"),(r.includes("dim")||r.includes("flickering"))&&(n.lighting="dim"),(r.includes("storm")||r.includes("rain"))&&(n.weather="stormy"),(r.includes("fog")||r.includes("mist"))&&(n.weather="foggy"),r.includes("wind")&&(n.weather="windy"),(r.includes("tension")||r.includes("danger"))&&(n.mood="tense"),(r.includes("peaceful")||r.includes("calm"))&&(n.mood="peaceful"),(r.includes("eerie")||r.includes("creepy"))&&(n.mood="eerie"),n}calculateTensionLevel(e,n){let r="low";const s=e.filter(i=>["attack","spell","dodge","parry"].includes(i.action));return s.length>0&&(r="medium"),s.length>2&&(r="high"),n&&(r="critical"),r}generateSingleActionResponse(e,n,r,s){const{action:i,check:a,keyword:l}=e,u=a.isSuccess;a.degree;const d={attack:{success:{low:`${n.name} strikes true, the blow landing with satisfying impact.`,medium:`${n.name}'s weapon finds its mark, the strike ringing out in the ${r.lighting} light.`,high:`${n.name} delivers a devastating blow, the force of the attack echoing through the ${r.weather} air.`,critical:`${n.name} executes a perfect strike, the precision of the attack leaving no room for error.`},failure:{low:`${n.name} swings wide, the attack missing its intended target.`,medium:`${n.name}'s strike goes awry, the weapon clattering against stone or wood.`,high:`${n.name} completely misses, the failed attack leaving them momentarily vulnerable.`,critical:`${n.name} stumbles in their attack, the botched strike nearly causing them to fall.`}},backflip:{success:{low:`${n.name} executes a graceful backflip, landing softly on their feet.`,medium:`${n.name} performs an impressive backflip, the acrobatic feat drawing attention.`,high:`${n.name} completes a spectacular backflip, the display of agility leaving onlookers amazed.`,critical:`${n.name} achieves a flawless backflip, the perfect form and landing drawing gasps of admiration.`},failure:{low:`${n.name} attempts a backflip but loses balance, stumbling slightly.`,medium:`${n.name} fails the backflip, landing awkwardly and looking embarrassed.`,high:`${n.name} completely botches the backflip, falling hard to the ground.`,critical:`${n.name} crashes spectacularly during the backflip, potentially injuring themselves.`}},search:{success:{low:`${n.name} searches carefully, their trained eyes picking up subtle details.`,medium:`${n.name} conducts a thorough search, methodically examining every corner.`,high:`${n.name} performs an exhaustive search, their attention to detail revealing hidden secrets.`,critical:`${n.name} discovers something extraordinary, their keen observation uncovering a crucial clue.`},failure:{low:`${n.name} looks around but finds nothing of interest.`,medium:`${n.name} searches but misses several obvious details.`,high:`${n.name} fails to notice important clues, their search proving fruitless.`,critical:`${n.name} overlooks critical information, their poor search skills costing them dearly.`}},persuade:{success:{low:`${n.name} makes a reasonable argument, their words carrying some weight.`,medium:`${n.name} presents a compelling case, their charisma swaying the listener.`,high:`${n.name} delivers a masterful persuasion, their words impossible to ignore.`,critical:`${n.name} achieves the impossible, their silver tongue turning enemies into allies.`},failure:{low:`${n.name} tries to persuade but fails to make a convincing argument.`,medium:`${n.name}'s attempt at persuasion falls flat, their words lacking impact.`,high:`${n.name} completely fails to persuade, their poor communication skills evident.`,critical:`${n.name} not only fails to persuade but manages to offend the listener.`}}},f=d[i]||d.attack,m=u?"success":"failure",g=s==="critical"?"high":s;return f[m][g]}generateMultiActionResponse(e,n,r,s){const i=e.length,a=e.filter(u=>u.check.isSuccess).length,l=i-a;return a===i?`${n.name} executes a flawless sequence of actions, each movement flowing seamlessly into the next. The display of skill and coordination is impressive to behold.`:a>l?`${n.name} performs admirably, with most actions succeeding despite the challenging circumstances. A few missteps don't diminish the overall effectiveness.`:l>a?`${n.name} struggles with the complex sequence, many actions failing to achieve their intended results. The difficulty of the task proves overwhelming.`:`${n.name} has mixed results, with some actions succeeding while others fail. The outcome remains uncertain.`}addEnvironmentalDetails(e,n){if(e.length===0)return"";const r={dark:{low:" The darkness seems to swallow sound, making every movement feel more significant.",medium:" Shadows dance in the darkness, creating an atmosphere of uncertainty.",high:" The oppressive darkness makes every action feel more dangerous and urgent.",critical:" The pitch-black environment amplifies every sound, every movement potentially deadly."},stormy:{low:" Rain patters against surfaces, adding a rhythmic backdrop to the scene.",medium:" The storm intensifies, wind and rain making movement more challenging.",high:" The raging storm creates a chaotic environment where every action is a gamble.",critical:" The violent storm threatens to overwhelm all but the most determined efforts."},foggy:{low:" Mist swirls gently, obscuring distant details.",medium:" The fog thickens, reducing visibility and creating an eerie atmosphere.",high:" Dense fog makes navigation difficult and every shadow a potential threat.",critical:" The impenetrable fog isolates you completely, each step into the unknown."}};let s="";return e.forEach(i=>{r[i]&&(s+=r[i][n]||"")}),s}addNPCReactions(e,n,r){if(e.length===0)return"";const s=e.map(i=>i.name).join(" and ");return r?` ${s} watch with growing interest, clearly impressed by your actions.`:` ${s} exchange concerned glances, their confidence in your abilities wavering.`}addStoryProgressionHook(e,n,r){const s=e.some(l=>["attack","spell","dodge","parry"].includes(l.action)),i=e.some(l=>["search","climb","jump"].includes(l.action)),a=e.some(l=>["persuade","intimidate","deceive"].includes(l.action));return s&&n==="high"?" The tension in the air is palpable. Something is about to happen...":i?" Your investigation reveals new possibilities. What will you discover next?":a?" The social dynamics shift with your words. How will others respond?":" The situation continues to unfold. What will you do next?"}generateStoryResponse(e,n,r={}){const s=this.validatePlayerAction(e,n,r);if(!s.valid)return{response:s.response,suggestion:s.suggestion,shouldProceed:!1,diceResult:null};const i=[];return s.diceResult.actions&&s.diceResult.actions.forEach(a=>{const l=this.diceService.generateActionNarrative(a.check,n);i.push(l)}),{response:i.join(" "),suggestion:s.suggestion,shouldProceed:!0,diceResult:s.diceResult}}handleComplexAction(e,n,r={}){const s=this.diceService.extractActionsFromDescription(e.toLowerCase());if(s.length===0)return{response:"I understand your intent. Let's see how this plays out in the story.",shouldProceed:!0,type:"narrative"};if(s.length===1)return this.generateStoryResponse(e,n,r);const i=this.diceService.performActionSequence(n,s,r);return i.overallSuccess?{response:i.actions.map(l=>this.diceService.generateActionNarrative(l.check,n)).join(" "),shouldProceed:!0,type:"sequence",diceResult:i}:i.actions.filter(u=>!u.check.isSuccess).filter(u=>u.check.degree==="critical failure").length>0?{response:"The sequence of actions you described is too complex for your current abilities. Try breaking it down into simpler steps.",shouldProceed:!1,type:"sequence_failure",diceResult:i}:{response:"Some parts of your action sequence are challenging. You might want to simplify your approach.",shouldProceed:!1,type:"sequence_partial",diceResult:i}}provideAlternatives(e,n,r={}){const s=e.toLowerCase(),i=[];return(s.includes("backflip")||s.includes("somersault"))&&i.push({action:"dodge",description:"Try dodging or evading instead of acrobatics",difficulty:"easier"}),(s.includes("fly")||s.includes("levitate"))&&i.push({action:"climb",description:"Try climbing or finding another way up",difficulty:"realistic"}),s.includes("attack everyone")&&i.push({action:"focus",description:"Focus on one target at a time for better effectiveness",difficulty:"strategic"}),s.includes("grab quest item")&&i.push({action:"search",description:"Search the area thoroughly to find the item",difficulty:"appropriate"}),i}maintainStoryCoherence(e,n,r){const s={storyPhase:this.checkStoryPhase(e,n),establishedFacts:this.checkEstablishedFacts(e,n),plotAdvancement:this.checkPlotAdvancement(e,n),characterDevelopment:this.checkCharacterDevelopment(e,r)},i=Object.entries(s).filter(([a,l])=>!l.valid).map(([a,l])=>l.issue);return{coherent:i.length===0,issues:i,suggestions:this.generateCoherenceSuggestions(i,n)}}checkStoryPhase(e,n){const r=n.phase||"exploration",s=e.toLowerCase(),l=({introduction:["attack","kill","destroy"],exploration:["end quest","skip to boss"],combat:["negotiate peace","run away"],resolution:["start new quest","begin adventure"]}[r]||[]).some(u=>s.includes(u));return{valid:!l,issue:l?`This action doesn't fit the current story phase (${r})`:null}}checkEstablishedFacts(e,n){const r=n.establishedFacts||[],s=e.toLowerCase();for(const i of r)if(i.contradicts&&i.contradicts.some(a=>s.includes(a.toLowerCase())))return{valid:!1,issue:`This action contradicts established story facts: ${i.description}`};return{valid:!0}}checkPlotAdvancement(e,n){const r=n.plotPoints||[],s=e.toLowerCase(),i=r.find(a=>a.active);return i&&i.keywords&&!i.keywords.some(l=>s.includes(l.toLowerCase()))?{valid:!1,issue:"This action doesn't address the current plot point"}:{valid:!0}}checkCharacterDevelopment(e,n){const r=n.alignment||"Neutral",s=e.toLowerCase(),l=({"Lawful Good":["steal","deceive","harm innocent"],"Chaotic Evil":["help others","follow rules","show mercy"],"Neutral Good":["harm innocent","betray allies"],"Lawful Evil":["break laws","show mercy","help weak"],"Chaotic Good":["follow strict rules","harm innocent"],"True Neutral":["take extreme actions","show strong emotions"],"Lawful Neutral":["break laws","show mercy","act chaotically"],"Neutral Evil":["help others","follow laws","show mercy"],"Chaotic Neutral":["follow strict rules","show strong loyalty"]}[r]||[]).some(u=>s.includes(u));return{valid:!l,issue:l?`This action doesn't align with your character's alignment (${r})`:null}}generateCoherenceSuggestions(e,n){const r=[];return e.forEach(s=>{s.includes("story phase")?r.push("Consider actions that fit the current phase of the story."):s.includes("established facts")?r.push("Remember what has already been established in the story."):s.includes("plot point")?r.push("Focus on actions that advance the current plot."):s.includes("alignment")&&r.push("Consider actions that align with your character's moral compass.")}),r}extractEntities(e,n={}){const r={enemies:[],items:[],locations:[],statusEffects:[],questHooks:[],npcs:[]};return e.toLowerCase(),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:the\s+)?(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster|boss|mini-boss)/gi,/\b(goblin|orc|troll|dragon|bandit|skeleton|zombie|ghost|spirit|demon|devil|fiend|beast|creature|monster)\b/gi,/(?:mini-boss|boss)\s*[–-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/\[Combat\s+Trigger[^]]*[–-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\]/gi].forEach(f=>{let m;for(;(m=f.exec(e))!==null;){const g=m[1]||m[0];g&&!r.enemies.some(b=>b.name.toLowerCase()===g.toLowerCase())&&r.enemies.push({name:g,type:"enemy",subtype:this.determineEnemySubtype(g,e),status:this.determineEnemyStatus(g,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:of\s+[A-Z][a-z]+)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:sword|dagger|staff|wand|scroll|potion|ring|amulet|crown|robe|armor|shield)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cursed|forbidden|ancient|legendary)/gi].forEach(f=>{let m;for(;(m=f.exec(e))!==null;){const g=m[1]||m[0];g&&!r.items.some(b=>b.name.toLowerCase()===g.toLowerCase())&&r.items.push({name:g,type:"item",subtype:this.determineItemSubtype(g,e),status:this.determineItemStatus(g,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:shrine|temple|castle|tower|dungeon|cave|tunnel|chamber|room|hall|garden|forest|mountain|river|lake|ocean|tavern|inn)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cliffs|beach|island|valley|peak|summit|depths|heights)/gi].forEach(f=>{let m;for(;(m=f.exec(e))!==null;){const g=m[1]||m[0];g&&!r.locations.some(b=>b.name.toLowerCase()===g.toLowerCase())&&r.locations.push({name:g,type:"location",subtype:this.determineLocationSubtype(g,e),tags:this.determineLocationTags(g,e)})}}),[/(?:cursed|blessed|enchanted|poisoned|paralyzed|charmed|frightened|invisible|ethereal|ethereal|flying|levitating)/gi,/(?:in\s+darkness|in\s+bright\s+light|under\s+pressure|in\s+a\s+hurry|carefully|stealthily|aggressively|defensively)/gi].forEach(f=>{let m;for(;(m=f.exec(e))!==null;){const g=m[0];g&&!r.statusEffects.some(b=>b.name.toLowerCase()===g.toLowerCase())&&r.statusEffects.push({name:g,type:"status_effect",effect:this.determineStatusEffect(g,e)})}}),[/(?:break|destroy|find|retrieve|defeat|save|protect|escort|investigate|explore)\s+(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/(?:quest|mission|objective|goal|task|duty|responsibility)/gi].forEach(f=>{let m;for(;(m=f.exec(e))!==null;){const g=m[1]||m[0];g&&!r.questHooks.some(b=>b.name.toLowerCase()===g.toLowerCase())&&r.questHooks.push({name:g,type:"quest_hook",objective:this.determineQuestObjective(g,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:merchant|trader|noble|lord|lady|king|queen|prince|princess|mayor|priest|shaman|hunter|fisherman|farmer)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:quest\s+giver|guide|mentor|teacher|master)/gi].forEach(f=>{let m;for(;(m=f.exec(e))!==null;){const g=m[1]||m[0];g&&!r.npcs.some(b=>b.name.toLowerCase()===g.toLowerCase())&&r.npcs.push({name:g,type:"npc",role:this.determineNPCRole(g,e),disposition:"friendly"})}}),r}determineEnemySubtype(e,n){n.toLowerCase();const r=e.toLowerCase();return r.includes("boss")||r.includes("mini-boss")?"boss":r.includes("priest")||r.includes("cleric")?"priest":r.includes("wizard")||r.includes("mage")?"wizard":r.includes("dragon")?"dragon":r.includes("undead")||r.includes("skeleton")||r.includes("zombie")?"undead":r.includes("goblin")||r.includes("orc")||r.includes("troll")?"monster":"enemy"}determineEnemyStatus(e,n){const r=n.toLowerCase();return r.includes("snarls")||r.includes("aggressive")?"hostile":r.includes("defensive")||r.includes("cautious")?"defensive":r.includes("chanting")||r.includes("casting")?"casting":"active"}determineItemSubtype(e,n){const r=e.toLowerCase();return r.includes("sword")||r.includes("dagger")||r.includes("staff")?"weapon":r.includes("potion")||r.includes("scroll")?"consumable":r.includes("ring")||r.includes("amulet")||r.includes("crown")?"accessory":r.includes("armor")||r.includes("robe")||r.includes("shield")?"armor":"item"}determineItemStatus(e,n){const r=n.toLowerCase(),s=e.toLowerCase();return s.includes("cursed")||r.includes("cursed")?"cursed":s.includes("forbidden")||r.includes("forbidden")?"forbidden":s.includes("ancient")||r.includes("ancient")?"ancient":s.includes("legendary")||r.includes("legendary")?"legendary":r.includes("magical")||r.includes("enchanted")?"magical":"normal"}determineLocationSubtype(e,n){const r=e.toLowerCase();return r.includes("shrine")||r.includes("temple")?"religious":r.includes("castle")||r.includes("tower")?"fortification":r.includes("cave")||r.includes("tunnel")?"underground":r.includes("forest")||r.includes("garden")?"natural":r.includes("tavern")||r.includes("inn")?"settlement":"location"}determineLocationTags(e,n){const r=[],s=n.toLowerCase();return(s.includes("ancient")||s.includes("old"))&&r.push("ancient"),(s.includes("dangerous")||s.includes("hostile"))&&r.push("dangerous"),(s.includes("sacred")||s.includes("holy"))&&r.push("sacred"),(s.includes("cursed")||s.includes("evil"))&&r.push("cursed"),(s.includes("coastal")||s.includes("ocean"))&&r.push("coastal"),(s.includes("mountain")||s.includes("high"))&&r.push("mountainous"),r}determineStatusEffect(e,n){const r=e.toLowerCase();return r.includes("cursed")?"disables healing":r.includes("poisoned")?"damage over time":r.includes("paralyzed")?"prevents movement":r.includes("charmed")?"mind control":r.includes("invisible")?"stealth bonus":r.includes("flying")?"flight ability":"unknown effect"}determineQuestObjective(e,n){const r=e.toLowerCase();return r.includes("break")||r.includes("destroy")?"destruction":r.includes("find")||r.includes("retrieve")?"retrieval":r.includes("defeat")||r.includes("kill")?"combat":r.includes("save")||r.includes("protect")?"protection":r.includes("escort")?"escort":r.includes("investigate")||r.includes("explore")?"exploration":"objective"}determineNPCRole(e,n){const r=e.toLowerCase();return r.includes("merchant")||r.includes("trader")?"merchant":r.includes("noble")||r.includes("lord")||r.includes("lady")?"noble":r.includes("king")||r.includes("queen")?"royalty":r.includes("priest")||r.includes("shaman")?"religious":r.includes("quest giver")||r.includes("guide")?"quest_giver":"npc"}}const VR=new Jm,Ad=new Au;function FR(){const t=Wn(),[e,n]=A.useState(""),[r,s]=A.useState(""),[i,a]=A.useState(null),[l,u]=A.useState(!1),[d,f]=A.useState(!1),[m,g]=A.useState(!1),[b,k]=A.useState(null),[C,N]=A.useState(null),[_,x]=A.useState(null),[I,D]=A.useState("Fighter"),F=[{name:"Drowned Priest Boss Fight",storyContext:"In a dark, misty swamp, a Drowned Priest emerges from the murky water, chanting dark spells. The air is thick with malevolence as undead minions rise from the depths. The water bubbles with dark energy, and the priest's glowing eyes pierce through the fog.",suggestedAction:"I charge forward and attack the Drowned Priest with my sword"},{name:"Forest Ambush",storyContext:"The party is traveling through a dense forest when suddenly, goblin archers emerge from the trees above. The forest floor is covered in fallen leaves that crunch underfoot, and the canopy blocks most of the sunlight. The goblins are well-hidden in the branches, their green skin blending with the foliage.",suggestedAction:"I take cover behind a large tree and cast a fireball at the goblin archers"},{name:"Tavern Brawl",storyContext:"A rowdy group of bandits has taken over the local tavern, threatening the patrons. The tavern is filled with overturned tables, broken chairs, and spilled ale. The bandit leader, a scarred warrior with a wicked grin, stands on the bar counter brandishing his sword.",suggestedAction:"I leap over a table and tackle the bandit leader to the ground"}],v={Fighter:{id:"test_fighter_1",name:"Test Fighter",level:5,class:"Fighter",strength:18,dexterity:14,constitution:16,intelligence:10,wisdom:10,charisma:12,hp:45,maxHp:45,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Longsword",damageBonus:2},armor:{name:"Chain Mail",defenseBonus:4},shield:{name:"Shield",defenseBonus:2}}},Wizard:{id:"test_wizard_1",name:"Test Wizard",level:5,class:"Wizard",strength:8,dexterity:14,constitution:12,intelligence:18,wisdom:12,charisma:10,hp:32,maxHp:32,ac:14,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["spell","attack","defend"],equipment:{weapon:{name:"Staff",damageBonus:0},armor:{name:"Robe",defenseBonus:2},focus:{name:"Arcane Focus",spellBonus:1}}},Rogue:{id:"test_rogue_1",name:"Test Rogue",level:5,class:"Rogue",strength:12,dexterity:18,constitution:14,intelligence:12,wisdom:10,charisma:14,hp:38,maxHp:38,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Daggers",damageBonus:1},armor:{name:"Leather Armor",defenseBonus:2},tools:{name:"Thieves Tools",utilityBonus:2}}},Cleric:{id:"test_cleric_1",name:"Test Cleric",level:5,class:"Cleric",strength:14,dexterity:10,constitution:16,intelligence:12,wisdom:18,charisma:12,hp:42,maxHp:42,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["spell","attack","defend"],equipment:{weapon:{name:"Mace",damageBonus:1},armor:{name:"Scale Mail",defenseBonus:3},holySymbol:{name:"Holy Symbol",spellBonus:1}}},Ranger:{id:"test_ranger_1",name:"Test Ranger",level:5,class:"Ranger",strength:14,dexterity:16,constitution:14,intelligence:12,wisdom:16,charisma:10,hp:40,maxHp:40,ac:15,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Longbow",damageBonus:1},armor:{name:"Studded Leather",defenseBonus:2},companion:{name:"Wolf Companion",utilityBonus:1}}},Paladin:{id:"test_paladin_1",name:"Test Paladin",level:5,class:"Paladin",strength:16,dexterity:10,constitution:16,intelligence:10,wisdom:12,charisma:16,hp:44,maxHp:44,ac:17,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","defend"],equipment:{weapon:{name:"Greatsword",damageBonus:2},armor:{name:"Plate Mail",defenseBonus:5},holySymbol:{name:"Holy Symbol",spellBonus:1}}}}[I],y=Y=>{s(Y.storyContext),n(Y.suggestedAction)},S=async()=>{if(e.trim())try{const Y={environmentalFeatures:T(r),npcs:me(r),circumstances:ye(r)},W=VR.validatePlayerAction(e,v,Y);k(W);const J=P(e,r,W);if(J.shouldInitiate){const le=R(J.enemyType,J.specificEnemyName);if(console.log("Combat detected, generated enemies:",le),a({type:"combat",message:`⚔️ Combat Detected! ${J.reason==="action_triggered_combat"?"Your action has triggered combat with the enemies in the area.":"The situation has escalated to combat."}`,context:Y,enemyType:J.enemyType,enemies:le,storyContext:r}),W.valid&&W.diceResult){const ve=(W.diceResult.actions||[]).filter(ke=>ke.type!==void 0);if(ve.length>0){const ke=Ad.performActionSequence(v,ve,Y);N(ke),f(!0)}}}else if(W.valid){if(W.diceResult){const ve=(W.diceResult.actions||[]).filter(ke=>ke.type!==void 0);if(ve.length>0){const ke=Ad.performActionSequence(v,ve,Y);N(ke),f(!0)}else a({type:"invalid",message:"No valid actions detected. Try a different action or rephrase your input.",context:Y})}else a({type:"simple",message:`The ${v.name} performs the action successfully.`,context:Y});const le=E(W,v,Y);a(ve=>({...ve,message:le}))}else{const le=E(W,v,Y);a({type:"invalid",message:le,context:Y})}u(!0)}catch(Y){console.error("Error processing test message:",Y),a({type:"error",message:"An error occurred while processing your action."})}},P=(Y,W,J)=>{var dt,dn;const le=["attack","fight","battle","combat","strike","slash","stab","shoot","cast spell","fire spell","magic"],ve=["enemy","monster","goblin","orc","troll","dragon","bandit","skeleton","zombie","priest","boss","creature","beast","fiend","demon","devil","ghost","spirit","undead","abomination","horror","terror","nightmare","phantom","specter","wraith","lich","vampire","werewolf","shapeshifter","elemental","construct"],ke=le.some(we=>Y.toLowerCase().includes(we)),ae=W.toLowerCase(),pe=ve.some(we=>ae.includes(we))||ae.includes("hostile")||ae.includes("aggressive")||ae.includes("snarls")||ae.includes("chanting")||ae.includes("combat trigger")||ae.includes("mini-boss")||ae.includes("boss")||/\b(?:the\s+)?(\w+)\s+(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster)\b/i.test(W)||ae.includes("raises")&&ae.includes("staff")||ae.includes("emerges")&&ae.includes("mist")||ae.includes("glowing")&&ae.includes("eyes"),Ce=(dn=(dt=J==null?void 0:J.diceResult)==null?void 0:dt.actions)==null?void 0:dn.some(we=>["attack","spell","dodge","parry","cast"].includes(we.action));let Te="bandit",Me=null;const ge=W.match(/\b(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster|boss)\b/i);return ge&&(Me=ge[1]),ae.includes("drowned priest")&&(Me="Drowned Priest",Te="priest"),ae.includes("goblin")?Te="goblin":ae.includes("orc")?Te="orc":ae.includes("troll")?Te="troll":ae.includes("dragon")?Te="dragon":ae.includes("undead")||ae.includes("skeleton")||ae.includes("zombie")?Te="skeleton":ae.includes("priest")||ae.includes("cleric")||ae.includes("paladin")?Te="priest":ae.includes("wizard")||ae.includes("mage")||ae.includes("sorcerer")?Te="wizard":ae.includes("dragon")||ae.includes("wyrm")||ae.includes("wyvern")?Te="dragon":(ae.includes("boss")||ae.includes("mini-boss"))&&(Te="boss"),Me&&Te==="bandit"&&(Te="boss"),{shouldInitiate:ke&&pe||Ce&&pe,reason:ke?"action_triggered_combat":"context_triggered_combat",enemyType:Te,specificEnemyName:Me}},R=(Y="bandit",W=null)=>{const J={goblin:{name:"Goblin",hp:12,ac:14,level:1,strength:8,dexterity:14,constitution:10,intelligence:10,wisdom:8,charisma:8},orc:{name:"Orc",hp:30,ac:16,level:3,strength:16,dexterity:12,constitution:16,intelligence:7,wisdom:11,charisma:10},troll:{name:"Troll",hp:84,ac:15,level:5,strength:18,dexterity:13,constitution:20,intelligence:7,wisdom:9,charisma:7},dragon:{name:"Dragon",hp:200,ac:19,level:10,strength:27,dexterity:14,constitution:25,intelligence:16,wisdom:13,charisma:15},bandit:{name:"Bandit",hp:16,ac:12,level:1,strength:12,dexterity:12,constitution:12,intelligence:10,wisdom:10,charisma:10},skeleton:{name:"Skeleton",hp:13,ac:13,level:1,strength:10,dexterity:14,constitution:15,intelligence:6,wisdom:8,charisma:5},zombie:{name:"Zombie",hp:22,ac:8,level:1,strength:13,dexterity:6,constitution:16,intelligence:3,wisdom:6,charisma:5},priest:{name:"Priest",hp:45,ac:16,level:5,strength:12,dexterity:10,constitution:14,intelligence:12,wisdom:16,charisma:14},wizard:{name:"Wizard",hp:40,ac:15,level:5,strength:9,dexterity:14,constitution:12,intelligence:16,wisdom:12,charisma:10},boss:{name:"Boss",hp:120,ac:18,level:8,strength:18,dexterity:16,constitution:18,intelligence:14,wisdom:16,charisma:16},undead:{name:"Undead",hp:15,ac:12,level:1,strength:12,dexterity:10,constitution:14,intelligence:6,wisdom:8,charisma:5}},le=J[Y]||J.bandit;let ve=1,ke=!1;W||Y==="boss"?(ke=!0,ve=1):ve=Math.min(3,4);const ae=[];for(let pe=0;pe<ve;pe++){let Ce,Te=le.hp,Me=le.ac,ge=le.level,dt=Y;W?(Ce=W,Te=Math.max(le.hp*2,80),Me=le.ac+2,ge=Math.max(le.level+2,7),dt="boss"):ke?(Ce="Drowned Priest",Te=Math.max(le.hp*2,80),Me=le.ac+2,ge=Math.max(le.level+2,7),dt="boss"):(Ce=`${le.name} ${pe+1}`,Te=le.hp+Math.floor(Math.random()*10),Me=le.ac+Math.floor(Math.random()*3)),ae.push({id:`enemy_${pe}`,name:Ce,type:le.name,class:dt,hp:Te,maxHp:Te,ac:Me,level:ge,strength:le.strength,dexterity:le.dexterity,constitution:le.constitution,intelligence:le.intelligence,wisdom:le.wisdom,charisma:le.charisma,initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","special","defend"]})}if(W==="Drowned Priest"||ke&&Y==="priest")for(let Ce=0;Ce<2;Ce++)ae.push({id:`enemy_minion_${Ce}`,name:`Undead Minion ${Ce+1}`,type:"Skeleton",class:"undead",hp:15+Math.floor(Math.random()*8),maxHp:15+Math.floor(Math.random()*8),ac:12+Math.floor(Math.random()*3),level:1,strength:12,dexterity:10,constitution:14,intelligence:6,wisdom:8,charisma:5,initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","defend"]});return ae},E=(Y,W,J)=>{const{environmentalFeatures:le,npcs:ve,circumstances:ke}=J,ae=ve.some(Ce=>Ce.role==="enemy")||le.some(Ce=>["dangerous","hostile","threatening","eerie","creepy"].includes(Ce));let pe="";if(Y.valid)if(Y.diceResult){const Ce=Y.diceResult.actions||[],Te=Ce.length;if(ae){if(pe=`The ${W.name} ${Ce.map(ge=>ge.action).join(" and ")} with determination. `,le.length>0){const ge=le.filter(dt=>["dark","fog","mist","eerie","creepy","dangerous"].includes(dt));ge.length>0&&(pe+=`The ${ge.join(" and ")} ${ge.length===1?"adds":"add"} to the tension. `)}const Me=ve.filter(ge=>ge.role==="enemy");if(Me.length>0){const ge=Me.map(dt=>dt.name).join(", ");pe+=`${ge} ${Me.length===1?"reacts":"react"} with ${["hostility","anger","defiance","malice"].sort(()=>.5-Math.random())[0]}. `}Te>1&&(pe+="Multiple actions detected - this complex maneuver will require precise timing and coordination. "),pe+=`

The outcome hangs in the balance. Roll the dice to determine your fate.`}else{if(pe=`The ${W.name} prepares to ${Ce.map(Me=>Me.action).join(" and ")}. `,Te>1&&(pe+="Multiple actions detected - this will require careful coordination and may incur fatigue penalties. "),le.length>0&&(pe+=`The ${le.join(" and ")} ${le.length===1?"affects":"affect"} the situation. `),ve.length>0){const Me=ve.map(ge=>ge.name).join(", ");pe+=`${Me} ${ve.length===1?"watches":"watch"} with interest. `}ke.length>0&&(pe+=`The circumstances (${ke.join(", ")}) ${ke.length===1?"adds":"add"} complexity to the action. `),pe+=`

Roll the dice to determine the outcome of this challenging action.`}}else if(ae){pe=`${W.name}'s action is straightforward but the situation remains tense. `;const Ce=ve.filter(Te=>Te.role==="enemy");if(Ce.length>0){const Te=Ce.map(Me=>Me.name).join(", ");pe+=`${Te} ${Ce.length===1?"maintains":"maintain"} a defensive stance. `}pe+=`

The action proceeds, but danger still lurks nearby.`}else{if(pe=`${W.name}'s action is straightforward and doesn't require a skill check. `,le.length>0&&(pe+=`The ${le.join(" and ")} ${le.length===1?"provides":"provide"} a suitable backdrop. `),ve.length>0){const Ce=ve.map(Te=>Te.name).join(", ");pe+=`${Ce} ${ve.length===1?"responds":"respond"} appropriately to the action. `}pe+=`

The action proceeds smoothly.`}else ae?(pe="The proposed action doesn't seem feasible in this dangerous situation. ",Y.reason&&(pe+=`${Y.reason} `),pe+=`

In combat, every action must be precise and deliberate. Consider a different approach.`):(pe="The proposed action doesn't seem feasible. ",Y.reason&&(pe+=`${Y.reason} `),pe+=`

Try a different approach or rephrase your action.`);return pe},T=Y=>{if(!Y)return[];const W=Y.toLowerCase(),J=[];return(W.includes("dark")||W.includes("shadow"))&&J.push("darkness"),(W.includes("fog")||W.includes("mist"))&&J.push("fog"),(W.includes("forest")||W.includes("tree"))&&J.push("forest"),(W.includes("cave")||W.includes("cavern"))&&J.push("cave"),(W.includes("tavern")||W.includes("inn"))&&J.push("tavern"),(W.includes("castle")||W.includes("fortress"))&&J.push("castle"),(W.includes("dungeon")||W.includes("underground"))&&J.push("dungeon"),(W.includes("water")||W.includes("swamp"))&&J.push("water"),(W.includes("fire")||W.includes("flame"))&&J.push("fire"),(W.includes("ice")||W.includes("cold"))&&J.push("ice"),(W.includes("wind")||W.includes("storm"))&&J.push("wind"),(W.includes("eerie")||W.includes("creepy"))&&J.push("eerie"),(W.includes("dangerous")||W.includes("hostile"))&&J.push("dangerous"),J},me=Y=>{if(!Y)return[];const W=[],J=Y.toLowerCase();return J.includes("drowned priest")&&W.push({name:"Drowned Priest",role:"enemy",type:"boss"}),J.includes("goblin")&&W.push({name:"Goblin Archers",role:"enemy",type:"goblin"}),J.includes("bandit")&&W.push({name:"Bandit Leader",role:"enemy",type:"bandit"}),(J.includes("undead")||J.includes("skeleton")||J.includes("zombie"))&&W.push({name:"Undead Minions",role:"enemy",type:"undead"}),(J.includes("patron")||J.includes("customer"))&&W.push({name:"Tavern Patrons",role:"friendly",type:"civilian"}),(J.includes("party")||J.includes("companion"))&&W.push({name:"Party Members",role:"ally",type:"adventurer"}),W},ye=Y=>{if(!Y)return[];const W=[],J=Y.toLowerCase();return(J.includes("dark")||J.includes("night"))&&W.push("low visibility"),(J.includes("wet")||J.includes("slippery"))&&W.push("difficult footing"),(J.includes("crowded")||J.includes("tight"))&&W.push("confined space"),(J.includes("noisy")||J.includes("loud"))&&W.push("distracting environment"),(J.includes("hurry")||J.includes("rush"))&&W.push("time pressure"),(J.includes("stealth")||J.includes("sneak"))&&W.push("stealth required"),W},Se=()=>{u(!1)},de=()=>{f(!1)},K=async()=>{var Y,W;if((i==null?void 0:i.type)==="combat")console.log("Combat detected, preparing to navigate with data:",{partyMembers:[v],enemies:i.enemies,storyContext:i.storyContext,enemyCount:(Y=i.enemies)==null?void 0:Y.length}),t("/combat",{state:{isTestCombat:!0,partyMembers:[v],enemies:i.enemies,storyContext:i.storyContext}});else if(C&&C.actions&&C.actions.length>1){const J=Ad.performMultipleSkillChecks(v,"attack",3,((W=i==null?void 0:i.context)==null?void 0:W.circumstances)||[]);x(J),g(!0)}f(!1)},re=()=>{u(!1),f(!1),a(null)},ce=()=>{t("/dashboard")};return o.jsx("div",{className:"min-h-screen bg-gray-900",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"mb-6 sm:mb-8",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[o.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-100",children:"Test Environment"}),o.jsx("button",{onClick:ce,className:"fantasy-button bg-blue-600 hover:bg-blue-700",children:"Back to Dashboard"})]}),o.jsx("p",{className:"text-gray-300 mt-2 text-sm sm:text-base",children:"Test action validation, dice rolling, and combat detection in a controlled environment."})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8",children:[o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Class"}),o.jsxs("select",{value:I,onChange:Y=>D(Y.target.value),className:"fantasy-input",children:[o.jsx("option",{value:"Fighter",children:"⚔️ Fighter"}),o.jsx("option",{value:"Wizard",children:"🔮 Wizard"}),o.jsx("option",{value:"Rogue",children:"🗡️ Rogue"}),o.jsx("option",{value:"Cleric",children:"⛪ Cleric"}),o.jsx("option",{value:"Ranger",children:"🏹 Ranger"}),o.jsx("option",{value:"Paladin",children:"️ Paladin"})]}),o.jsxs("div",{className:"mt-3 p-3 bg-gray-700 border border-gray-600 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-gray-100 mb-2",children:v.name}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"HP:"})," ",o.jsxs("span",{className:"text-gray-300",children:[v.hp,"/",v.maxHp]})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"AC:"})," ",o.jsx("span",{className:"text-gray-300",children:v.ac})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"STR:"})," ",o.jsx("span",{className:"text-gray-300",children:v.strength})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"DEX:"})," ",o.jsx("span",{className:"text-gray-300",children:v.dexterity})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"CON:"})," ",o.jsx("span",{className:"text-gray-300",children:v.constitution})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"INT:"})," ",o.jsx("span",{className:"text-gray-300",children:v.intelligence})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"WIS:"})," ",o.jsx("span",{className:"text-gray-300",children:v.wisdom})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"CHA:"})," ",o.jsx("span",{className:"text-gray-300",children:v.charisma})]})]}),o.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:[o.jsx("strong",{children:"Equipment:"})," ",v.equipment.weapon.name,", ",v.equipment.armor.name]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Quick Test Scenarios"}),o.jsx("div",{className:"space-y-2",children:F.map((Y,W)=>o.jsxs("button",{onClick:()=>y(Y),className:"w-full p-3 text-left bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 transition-colors",children:[o.jsx("div",{className:"font-medium text-gray-100",children:Y.name}),o.jsxs("div",{className:"text-sm text-gray-300 mt-1",children:[Y.storyContext.substring(0,80),"..."]})]},W))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Story Context"}),o.jsx("textarea",{value:r,onChange:Y=>s(Y.target.value),placeholder:"Describe the environment, NPCs, and circumstances. For example: 'In a dark, misty swamp, a Drowned Priest emerges from the water, chanting dark spells. The air is thick with malevolence.'",className:"fantasy-input h-32 resize-none"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Action"}),o.jsx("textarea",{value:e,onChange:Y=>n(Y.target.value),placeholder:"Describe any action your character would take. The system will analyze it for skill checks, combat actions, or story interactions.",className:"fantasy-input h-24 resize-none"})]}),o.jsx("button",{onClick:S,disabled:!e.trim(),className:"w-full fantasy-button bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed",children:"Test Action"})]}),o.jsx("div",{className:"space-y-6",children:i&&o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[i.type==="combat"&&o.jsx("span",{className:"text-2xl mr-2",children:"⚔️"}),o.jsx("h3",{className:"text-lg font-semibold text-gray-100",children:i.type==="combat"?"Combat Detected":i.type==="story"?"Story Response":i.type==="invalid"?"Invalid Action":"Test Result"})]}),o.jsxs("div",{className:"prose max-w-none",children:[o.jsx("p",{className:"text-gray-300 mb-4",children:i.message}),i.type==="combat"&&o.jsxs("div",{className:"bg-red-900/20 border border-red-600 rounded-lg p-4",children:[o.jsx("h4",{className:"text-lg font-bold text-red-400",children:"Combat Initiated!"}),o.jsxs("p",{className:"text-red-300 mb-2",children:["Enemy Type: ",i.enemyType]}),o.jsx("div",{className:"space-y-2",children:i.enemies.map((Y,W)=>o.jsxs("div",{className:"flex justify-between items-center bg-gray-700 p-2 rounded",children:[o.jsx("span",{className:"font-medium text-gray-100",children:Y.name}),o.jsxs("span",{className:"text-sm text-gray-300",children:["HP: ",Y.hp," | AC: ",Y.ac," | Level: ",Y.level]})]},W))}),o.jsx("button",{onClick:()=>t("/combat",{state:{isTestCombat:!0,partyMembers:[v],enemies:i.enemies,storyContext:i.storyContext}}),className:"mt-3 fantasy-button bg-red-600 hover:bg-red-700",children:"Enter Combat"})]}),i.context&&o.jsxs("div",{className:"mt-4 space-y-2",children:[o.jsx("h5",{className:"font-semibold text-gray-100",children:"Context Analysis:"}),i.context.environmentalFeatures.length>0&&o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"Environment:"})," ",i.context.environmentalFeatures.join(", ")]}),i.context.npcs.length>0&&o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"NPCs:"})," ",i.context.npcs.map(Y=>`${Y.name} (${Y.role})`).join(", ")]})]})]})]})})]}),l&&b&&o.jsx(lb,{result:b,onClose:Se,onProceed:K,onRevise:re}),d&&C&&o.jsx(cb,{result:C,onClose:de,onProceed:K,onRevise:re}),m&&_&&o.jsx(LR,{result:_,onClose:()=>g(!1)})]})})}const $R="https://dnd-v1-backend.onrender.com",Xt=async(t,e="gpt-4",n=1e3,r=.8)=>{try{const s=await fetch(`${$R}/api/openai`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t,model:e,max_tokens:n,temperature:r})});if(!s.ok){const a=await s.json();throw new Error(a.error||"Backend API request failed")}return await s.json()}catch(s){throw console.error("Backend API Error:",s),new Error(`Failed to communicate with backend: ${s.message}`)}};class UR{constructor(){this.systemPrompt=`You are an experienced Dungeon Master for Dungeons & Dragons 5th Edition. You excel at:
- Creating engaging storylines and plot hooks
- Developing detailed character descriptions and backstories
- Generating multiple story options and summarizing them
- Providing atmospheric descriptions and immersive storytelling
- Balancing combat encounters and managing game mechanics
- Creating memorable NPCs and villains
- Adapting to player choices and creating dynamic narratives
- Maintaining story consistency and character development
- Building upon established relationships and plot threads

Always respond in character as a Dungeon Master, providing rich, descriptive content that enhances the gaming experience. Maintain consistency with previous story elements, character relationships, and established plot threads.`,this.diceService=new Au,this.actionValidationService=new Jm}async generateStoryPlots(e,n="",r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class} (${u.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 3 different story plot options for a D&D campaign.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

For each plot option, provide:
1. A compelling title
2. A brief summary (2-3 sentences)
3. The main conflict or challenge
4. Potential story hooks for the party
5. Estimated campaign length (short, medium, or long)

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options.`;return(await Xt([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1e3,.8)).choices[0].message.content}catch(s){throw new Error(`Failed to generate story plots: ${s.message}`)}}async generateCharacterDetails(e){try{const n=`As a Dungeon Master, I need you to expand on this character's details and create a rich, detailed description.

Character: ${e.name} - Level ${e.level} ${e.race} ${e.class}
Background: ${e.background}
Alignment: ${e.alignment}
Personality: ${e.personality||"Not specified"}
Ideals: ${e.ideals||"Not specified"}
Bonds: ${e.bonds||"Not specified"}
Flaws: ${e.flaws||"Not specified"}
Backstory: ${e.backstory||"Not specified"}

Please provide:
1. A detailed physical description (appearance, mannerisms, distinctive features)
2. An expanded personality profile with quirks and habits
3. A deeper backstory with key events and relationships
4. Character motivations and goals
5. Potential story hooks and plot threads related to this character
6. How this character might interact with the party and world

Make the character feel alive and three-dimensional, with details that could drive story development.`;return(await Xt([{role:"system",content:this.systemPrompt},{role:"user",content:n}],"gpt-4",800,.7)).choices[0].message.content}catch(n){throw console.error("Error generating character details:",n),new Error(`Failed to generate character details: ${n.message}`)}}async generateStorySummary(e,n){try{const r=n.map(a=>`${a.name} (${a.race} ${a.class})`).join(", "),s=`As a Dungeon Master, I need you to create a detailed story summary and outline for this campaign plot.

Plot: ${e}
Party: ${r}

Please provide:
1. A detailed campaign overview (3-4 paragraphs)
2. Key story beats and major events
3. Important NPCs and their roles
4. Potential challenges and obstacles
5. Story themes and motifs
6. How each party member might be personally invested
7. Potential branching paths and player choices
8. Climactic moments and resolution possibilities

Make this feel like a professional campaign module with rich storytelling potential.`;return(await Xt([{role:"system",content:this.systemPrompt},{role:"user",content:s}],"gpt-4",1200,.7)).choices[0].message.content}catch(r){throw console.error("Error generating story summary:",r),new Error(`Failed to generate story summary: ${r.message}`)}}async generateMultipleStoryPlots(e,n="",r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class} (${u.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 5 different story plot options for a D&D campaign, each with a detailed summary.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

For each of the 5 plot options, provide:
1. A compelling title
2. A detailed summary (3-4 paragraphs)
3. The main conflict or challenge
4. Key story beats and major events
5. Important NPCs and their roles
6. Potential story hooks for the party
7. Estimated campaign length (short, medium, or long)
8. Themes and motifs
9. How each party member might be personally invested

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options. Number each plot clearly (Plot 1, Plot 2, etc.).`;return(await Xt([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1500,.8)).choices[0].message.content}catch(s){throw console.error("Error generating multiple story plots:",s),new Error(`Failed to generate multiple story plots: ${s.message}`)}}async generateNPC(e,n=""){try{const r=`As a Dungeon Master, I need you to create a detailed NPC for this role and context.

NPC Role: ${e}
Context: ${n||"General campaign context"}

Please provide:
1. A detailed physical description
2. Personality traits and mannerisms
3. Background and motivations
4. Current situation and goals
5. How they might interact with the party
6. Potential story hooks or plot threads they could introduce
7. Their relationship to the world and other NPCs
8. Any secrets or hidden aspects of their character

Make this NPC feel like a real person with depth and complexity.`;return(await Xt([{role:"system",content:this.systemPrompt},{role:"user",content:r}],"gpt-4",800,.7)).choices[0].message.content}catch(r){throw console.error("Error generating NPC:",r),new Error(`Failed to generate NPC: ${r.message}`)}}async generateCombatEncounter(e,n,r="medium",s=""){try{const i=`As a Dungeon Master, I need you to create a detailed combat encounter.

Party Level: ${e}
Party Size: ${n}
Difficulty: ${r}
Theme: ${s||"General fantasy"}

Please provide:
1. A detailed description of the encounter location
2. Enemy types and their motivations
3. Tactical considerations and terrain features
4. Potential story elements or plot hooks
5. Non-combat resolution options
6. Consequences of victory or defeat
7. Environmental hazards or advantages
8. How this encounter fits into the larger story

Make this encounter feel meaningful and story-driven, not just a random fight.`;return(await Xt([{role:"system",content:this.systemPrompt},{role:"user",content:i}],"gpt-4",800,.7)).choices[0].message.content}catch(i){throw console.error("Error generating combat encounter:",i),new Error(`Failed to generate combat encounter: ${i.message}`)}}async generateStoryContinuation(e,n,r,s=null,i="individual",a=null){var l,u,d,f,m;try{const g=e.map(F=>`${F.name} - Level ${F.level} ${F.race} ${F.class}`).join(", ");let b=null,k=null,C="";if(i==="individual"){const F=e[e.length-1];if(F)if(b=this.actionValidationService.validatePlayerAction(r,F,{context:"story",storyState:s}),b.valid&&b.diceResult){if(k=b.diceResult,k.overallSuccess){if(C=`

ACTION VALIDATION: The action is within your character's capabilities.`,k.actions){const q=k.actions.map(v=>`${v.action}: ${v.check.isSuccess?"Success":"Failure"} (Roll: ${v.check.roll}, DC: ${v.check.dc})`).join(", ");C+=`
Dice Results: ${q}`}}else if(C=`

ACTION VALIDATION: Some aspects of this action are challenging for your character.`,k.actions){const v=k.actions.filter(y=>!y.check.isSuccess).map(y=>`${y.action}: Failure (Roll: ${y.check.roll}, DC: ${y.check.dc})`).join(", ");C+=`
Failed Actions: ${v}`}}else b.valid||(C=`

ACTION VALIDATION: ${b.response}`,b.suggestion&&(C+=`
Suggestion: ${b.suggestion}`))}const N=n.map(F=>({role:F.role,content:F.content}));let _="";a&&(_=`
Party Theme: ${a.description||"No theme provided"}`);let x="";s&&(x=`
STORY STATE CONTEXT:
Current Location: ${((l=s.currentLocation)==null?void 0:l.name)||"Unknown"} - ${((u=s.currentLocation)==null?void 0:u.description)||""}
Active NPCs: ${Object.keys(s.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((d=s.activePlotThreads)==null?void 0:d.map(F=>`${F.title} (${Math.round(F.progress*100)}%)`).join(", "))||"None"}
Recent Events: ${((m=(f=s.worldState)==null?void 0:f.recentEvents)==null?void 0:m.slice(-3).map(F=>F.event).join(", "))||"None"}

CHARACTER RELATIONSHIPS:
${e.map(F=>{var y;const q=((y=s.characterArcs)==null?void 0:y[F.id])||{},v=Object.entries(q.relationships||{}).map(([S,P])=>`${S} (${P})`).join(", ");return`${F.name}: ${v||"No established relationships"}`}).join(`
`)}

NPC CONTEXT:
${Object.entries(s.activeNPCs||{}).map(([F,q])=>{var v;return`${F}: ${q.disposition} disposition, knowledge: ${((v=q.knowledge)==null?void 0:v.join(", "))||"none"}, goal: ${q.currentGoal||"unknown"}`}).join(`
`)}`);const I=`As a Dungeon Master, continue the story based on the player's response.

Party: ${g}${_}
Player Response: "${r}" (Type: ${i})
Response Type Context:
- individual: One character's personal action
- team: Group action or decision
- investigate: Looking for clues or information
- combat: Combat-related action
- social: Social interaction or diplomacy${x}

Previous Story Context:
${N.map(F=>`${F.role==="assistant"?"DM":"Player"}: ${F.content}`).join(`
`)}

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

ACTION VALIDATION GUIDELINES:
- If the action validation shows the action is impossible, gently redirect the player while maintaining story flow
- If the action validation shows the action is challenging, incorporate the difficulty into the narrative
- If the action validation shows the action is successful, proceed with the action as described
- Always maintain story coherence and character consistency
- Use the validation results to inform how the action plays out in the story

Please provide a compelling continuation that:
1. Acknowledges the player's action in context of the current situation and location
2. References relevant NPCs and their established relationships with the party
3. Continues or advances active plot threads appropriately
4. Updates character relationships based on the action
5. Maintains location and atmosphere consistency
6. Ends with a clear situation that invites the next player to respond
7. Encourages character interaction and roleplay
8. Provides multiple possible directions for the party to explore
9. Builds upon the established story state and character development
10. Incorporates action validation results naturally into the narrative

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.${C}`;return{content:(await Xt([{role:"system",content:this.systemPrompt},...N,{role:"user",content:I}],"gpt-4",800,.8)).choices[0].message.content,actionValidation:b,diceResult:k}}catch(g){throw console.error("Error generating story continuation:",g),new Error(`Failed to generate story continuation: ${g.message}`)}}async generatePlotOptions(e,n=null){try{const r=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class}. ${u.personality||""}. ${u.backstory||""}`).join(`
`);let s="";n&&(s=`
Party Theme: ${n.description||"No theme provided"}`);const i="You are a Dungeon Master for D&D 5e. You MUST generate exactly 3 plot options, no more, no less. Follow the exact format provided. Do not use party names in the plots. Keep summaries brief (1-2 sentences maximum). DO NOT repeat plots or generate duplicates.",a=`Generate exactly 3 distinct campaign plot options for this party. 

REQUIRED FORMAT - Follow this exact structure:

Plot 1: [Title]
[Brief summary - 1-2 sentences maximum]

Plot 2: [Title]  
[Brief summary - 1-2 sentences maximum]

Plot 3: [Title]
[Brief summary - 1-2 sentences maximum]

Party: ${r}${s}

CRITICAL REQUIREMENTS:
- Generate EXACTLY 3 plots, no more, no less
- Use the party theme to influence the plot lines and atmosphere
- Do NOT use the party name in the plots - focus on the characters and theme
- Each summary must be 1-2 sentences maximum
- Follow the exact format above with "Plot 1:", "Plot 2:", "Plot 3:" labels
- Do not add any additional text, explanations, or formatting
- Do not repeat or duplicate any plots
- Stop after Plot 3 - do not generate more plots

Make each plot distinct and appealing to different play styles.`;return(await Xt([{role:"system",content:i},{role:"user",content:a}],"gpt-4",600,.8)).choices[0].message.content}catch(r){throw console.error("Error generating plot options:",r),new Error(`Failed to generate plot options: ${r.message}`)}}async generateStoryIntroduction(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}. ${d.personality||""}. ${d.backstory||""}`).join(`
`);let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create an engaging story introduction for the beginning of this campaign.

Party: ${i}${a}
Selected Plot: Plot ${r}
Plot Details: ${n}

Create an introduction that includes:
1. A vivid description of the starting town/settlement where the party begins
2. How each character arrives or is already present in this location
3. The initial situation or hook that draws the party together
4. A sense of atmosphere and setting that matches the chosen plot
5. An opening scene that gives the party their first decision or action to take

Important Guidelines:
- Use the party theme to influence the atmosphere and context
- Incorporate themes and elements from the party theme to create atmosphere and context
- Consider how the party's background and composition might influence the starting situation
- Focus on the characters and their individual stories
- The story should feel cohesive with the established theme

Make this feel like the opening of an epic adventure. Set the tone, establish the setting, and give the party a clear starting point. End with a situation that requires the party to make a choice or take action.

Keep the introduction engaging but concise (3-4 paragraphs maximum).`;return(await Xt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",800,.8)).choices[0].message.content}catch(i){throw console.error("Error generating story introduction:",i),new Error(`Failed to generate story introduction: ${i.message}`)}}async generateStructuredStoryResponse(e,n,r,s,i,a=null,l=null){var u,d,f;try{const m=e.map(x=>`${x.name} - Level ${x.level} ${x.race} ${x.class}`).join(", "),g=n.map(x=>({role:x.role,content:x.content}));let b="";l&&(b=`
Party Theme: ${l.description||"No theme provided"}`);const k=i.length>0?`
Discovered Objectives: ${i.map(x=>x.title).join(", ")}`:"";let C="";a&&(C=`
STORY STATE CONTEXT:
Current Location: ${((u=a.currentLocation)==null?void 0:u.name)||"Unknown"} - ${((d=a.currentLocation)==null?void 0:d.description)||""}
Active NPCs: ${Object.keys(a.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((f=a.activePlotThreads)==null?void 0:f.map(x=>`${x.title} (${Math.round(x.progress*100)}%)`).join(", "))||"None"}
Character Relationships: ${Object.entries(a.characterArcs||{}).map(([x,I])=>{const D=e.find(F=>F.id===x);return`${D==null?void 0:D.name}: ${Object.entries(I.relationships||{}).map(([F,q])=>`${F} (${q})`).join(", ")||"No relationships"}`}).join("; ")}`);const N=`As a Dungeon Master, continue the story based on the player's response, considering the current story phase and discovered objectives.

Party: ${m}${b}
Current Phase: ${s}
Player Response: "${r}"${k}${C}

Story Phases:
- Investigation: Focus on discovery, clues, and gathering information
- Conflict: Focus on tension, threats, and potential combat
- Resolution: Focus on choices, consequences, and story conclusion

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

Please provide a compelling continuation that:
1. Acknowledges the player's action in context of the current situation and location
2. References relevant NPCs and their established relationships with the party
3. Continues or advances active plot threads appropriately
4. Updates character relationships based on the action
5. Maintains location and atmosphere consistency
6. Ends with a clear situation that invites the next player to respond
7. Encourages character interaction and roleplay
8. Provides multiple possible directions for the party to explore
9. Builds upon the established story state and character development

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.`;return(await Xt([{role:"system",content:this.systemPrompt},...g,{role:"user",content:N}],"gpt-4",800,.8)).choices[0].message.content}catch(m){throw console.error("Error generating structured story response:",m),new Error(`Failed to generate structured story response: ${m.message}`)}}async generatePhaseTransition(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create a phase transition message for the story.

Party: ${i}${a}
Current Phase: ${n}
Story Progress: ${r}

Create a transition that:
1. Acknowledges the progress made so far
2. Signals the shift to the new phase
3. Sets up the new challenges and opportunities
4. Maintains the established tone and atmosphere
5. Gives the party clear direction for the next phase

Make this feel like a natural progression in the story.`;return(await Xt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating phase transition:",i),new Error(`Failed to generate phase transition: ${i.message}`)}}async generateObjectiveCompletion(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create a completion message for an objective.

Party: ${i}${a}
Completed Objective: ${n.title}
Story Context: ${r}

Create a completion message that:
1. Celebrates the achievement
2. Provides closure for this objective
3. Sets up the next challenge or objective
4. Maintains story momentum
5. Acknowledges the party's efforts

Make this feel rewarding and meaningful.`;return(await Xt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating objective completion:",i),new Error(`Failed to generate objective completion: ${i.message}`)}}async generateCampaignContinuation(e,n,r,s,i=null){try{const a=e.map(m=>`${m.name} - Level ${m.level} ${m.race} ${m.class}`).join(", "),l=r.map(m=>({role:m.role,content:m.content}));let u="";i&&(u=`
Party Theme: ${i.description||"No theme provided"}`);const d=`As a Dungeon Master, continue the ongoing campaign story.

Party: ${a}${u}
Campaign Goal: ${n.mainGoal||"No specific goal"}
Campaign Progress: ${n.campaignProgress||"Beginning"}
Player Response: "${s}"

Previous Story Context:
${l.map(m=>`${m.role==="assistant"?"DM":"Player"}: ${m.content}`).join(`
`)}

Continue the story while:
1. Building toward the main campaign goal
2. Maintaining consistency with previous events
3. Developing character relationships and arcs
4. Creating meaningful choices and consequences
5. Advancing the overall plot

Keep your response engaging but concise (2-3 paragraphs maximum).`;return(await Xt([{role:"system",content:this.systemPrompt},...l,{role:"user",content:d}],"gpt-4",800,.8)).choices[0].message.content}catch(a){throw console.error("Error generating campaign continuation:",a),new Error(`Failed to generate campaign continuation: ${a.message}`)}}async generateCampaignGoal(e,n,r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class}`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, create a clear campaign goal based on the selected plot.

Party: ${s}${i}
Plot Content: ${n}

Create a campaign goal that:
1. Is clear and achievable
2. Provides direction for the entire campaign
3. Involves all party members
4. Has multiple possible paths to completion
5. Creates meaningful stakes and consequences

Make this goal compelling and motivating for the party.`;return(await Xt([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",600,.7)).choices[0].message.content}catch(s){throw console.error("Error generating campaign goal:",s),new Error(`Failed to generate campaign goal: ${s.message}`)}}async generateSessionSummary(e,n,r,s,i=null){try{const a=s.map(f=>`${f.name} - Level ${f.level} ${f.race} ${f.class}`).join(", ");let l="";i&&(l=`
Party Theme: ${i.description||"No theme provided"}`);const u=`As a Dungeon Master, create a session summary for this campaign session.

Party: ${a}${l}
Campaign Goal: ${e.mainGoal||"No specific goal"}
Objectives: ${r.map(f=>f.title).join(", ")}
Story Messages: ${n.length} total messages

Create a summary that:
1. Recaps the major events of the session
2. Highlights character development and relationships
3. Notes progress toward objectives
4. Sets up expectations for the next session
5. Maintains the established tone and atmosphere

Make this summary engaging and informative.`;return(await Xt([{role:"system",content:this.systemPrompt},{role:"user",content:u}],"gpt-4",800,.7)).choices[0].message.content}catch(a){throw console.error("Error generating session summary:",a),new Error(`Failed to generate session summary: ${a.message}`)}}}const Yn=new UR;function BR({partyCharacters:t,onStoryGenerated:e,onCharacterDetailsGenerated:n,partyInfo:r=null}){const[s,i]=A.useState("plots"),[a,l]=A.useState(!1),[u,d]=A.useState(""),[f,m]=A.useState(""),[g,b]=A.useState(""),[k,C]=A.useState(""),[N,_]=A.useState(""),[x,I]=A.useState(""),[D,F]=A.useState({partyLevel:1,partySize:t.length,difficulty:"medium",theme:""}),q=async()=>{if(t.length===0){d("No party characters available. Please create characters first.");return}l(!0),d("");try{const E=await Yn.generateStoryPlots(t,g,r);m(E),e&&e(E)}catch{d("Failed to generate story plots. Please check your API key and try again.")}finally{l(!1)}},v=async()=>{if(t.length===0){d("No party characters available. Please create characters first.");return}l(!0),d("");try{const E=await Yn.generateMultipleStoryPlots(t,g,r);m(E),e&&e(E)}catch{d("Failed to generate story plots. Please check your API key and try again.")}finally{l(!1)}},y=async()=>{if(!k){d("Please select a character first.");return}const E=t.find(T=>T.id===k);if(!E){d("Selected character not found.");return}l(!0),d("");try{const T=await Yn.generateCharacterDetails(E);m(T),n&&n(E.id,T)}catch{d("Failed to generate character details. Please check your API key and try again.")}finally{l(!1)}},S=async()=>{if(!N.trim()){d("Please enter an NPC role.");return}l(!0),d("");try{const E=await Yn.generateNPC(N,x);m(E)}catch{d("Failed to generate NPC. Please check your API key and try again.")}finally{l(!1)}},P=async()=>{l(!0),d("");try{const E=await Yn.generateCombatEncounter(D.partyLevel,D.partySize,D.difficulty,D.theme);m(E)}catch{d("Failed to generate encounter. Please check your API key and try again.")}finally{l(!1)}},R=[{id:"plots",label:"Story Plots",icon:"📖"},{id:"characters",label:"Character Details",icon:"👤"},{id:"npcs",label:"NPCs",icon:"🏰"},{id:"encounters",label:"Combat Encounters",icon:"⚔️"}];return o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"fantasy-title mb-0",children:"🤖 AI Dungeon Master"}),o.jsx("div",{className:"text-sm text-stone-600",children:"Powered by ChatGPT"})]}),o.jsx("div",{className:"flex space-x-1 mb-6 bg-stone-100 p-1 rounded-lg",children:R.map(E=>o.jsxs("button",{onClick:()=>i(E.id),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center space-x-2 ${s===E.id?"bg-amber-600 text-white":"text-stone-600 hover:text-stone-800"}`,children:[o.jsx("span",{children:E.icon}),o.jsx("span",{children:E.label})]},E.id))}),u&&o.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:u}),s==="plots"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Setting (Optional)"}),o.jsx("textarea",{value:g,onChange:E=>b(E.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your campaign setting, world, or any specific themes..."})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsx("button",{onClick:q,disabled:a||t.length===0,className:"fantasy-button",children:a?"Generating...":"Generate Basic Plots"}),o.jsx("button",{onClick:v,disabled:a||t.length===0,className:"fantasy-button bg-amber-700 hover:bg-amber-800",children:a?"Generating...":"Generate Detailed Plots"})]}),o.jsxs("div",{className:"text-sm text-stone-600 text-center",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Basic Plots:"})," 3 plot options with brief summaries"]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Detailed Plots:"})," 5 plot options with full story summaries and character integration"]})]}),t.length===0&&o.jsx("p",{className:"text-sm text-stone-600 text-center",children:"Create party characters first to generate story plots."})]}),s==="characters"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Select Character"}),o.jsxs("select",{value:k,onChange:E=>C(E.target.value),className:"fantasy-input",children:[o.jsx("option",{value:"",children:"Choose a character..."}),t.map(E=>o.jsxs("option",{value:E.id,children:[E.name," - ",E.race," ",E.class]},E.id))]})]}),o.jsx("button",{onClick:y,disabled:a||!k,className:"fantasy-button w-full",children:a?"Generating Details...":"Generate Character Details"})]}),s==="npcs"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"NPC Role"}),o.jsx("input",{type:"text",value:N,onChange:E=>_(E.target.value),className:"fantasy-input",placeholder:"e.g., Town Mayor, Mysterious Wizard, Bandit Leader..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Context (Optional)"}),o.jsx("textarea",{value:x,onChange:E=>I(E.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe the context, location, or situation..."})]}),o.jsx("button",{onClick:S,disabled:a||!N.trim(),className:"fantasy-button w-full",children:a?"Generating NPC...":"Generate NPC"})]}),s==="encounters"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Party Level"}),o.jsx("input",{type:"number",min:"1",max:"20",value:D.partyLevel,onChange:E=>F(T=>({...T,partyLevel:parseInt(E.target.value)})),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Party Size"}),o.jsx("input",{type:"number",min:"1",max:"10",value:D.partySize,onChange:E=>F(T=>({...T,partySize:parseInt(E.target.value)})),className:"fantasy-input"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Difficulty"}),o.jsxs("select",{value:D.difficulty,onChange:E=>F(T=>({...T,difficulty:E.target.value})),className:"fantasy-input",children:[o.jsx("option",{value:"easy",children:"Easy"}),o.jsx("option",{value:"medium",children:"Medium"}),o.jsx("option",{value:"hard",children:"Hard"}),o.jsx("option",{value:"deadly",children:"Deadly"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Theme (Optional)"}),o.jsx("input",{type:"text",value:D.theme,onChange:E=>F(T=>({...T,theme:E.target.value})),className:"fantasy-input",placeholder:"e.g., Forest ambush, Dungeon crawl..."})]})]}),o.jsx("button",{onClick:P,disabled:a,className:"fantasy-button w-full",children:a?"Generating Encounter...":"Generate Combat Encounter"})]}),f&&o.jsxs("div",{className:"mt-8",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Generated Content"}),o.jsx("button",{onClick:()=>m(""),className:"text-sm text-stone-600 hover:text-stone-800",children:"Clear"})]}),o.jsx("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:o.jsx("div",{className:"prose prose-sm max-w-none",children:o.jsx("pre",{className:"whitespace-pre-wrap text-stone-800 font-sans text-sm leading-relaxed",children:f})})})]})]})}function zR(){const{partyId:t}=cu(),e=Wn(),[n,r]=A.useState(null),[s,i]=A.useState(null),[a,l]=A.useState([]),[u,d]=A.useState(null),[f,m]=A.useState(!0),[g,b]=A.useState("story"),[k,C]=A.useState({title:"",description:"",chapters:[]}),[N,_]=A.useState({image:"/placeholder-map.png",description:""});A.useEffect(()=>{const v=oi(y=>{if(!y){e("/login");return}r(y),t&&x(y.uid,t)});return()=>v()},[e,t]);const x=async(v,y)=>{try{m(!0);const[S,P,R]=await Promise.all([sb(v,y),Ym(y),ab(y)]);i(S),l(P),d(R)}catch{}finally{m(!1)}},I=[{id:"story",label:"Story Planning"},{id:"ai-dm",label:"🤖 AI Dungeon Master"},{id:"map",label:"Campaign Map"},{id:"characters",label:"Party Characters"},{id:"enemies",label:"Enemies & NPCs"}],D=()=>{const v={id:Date.now(),title:"",description:"",objectives:[],completed:!1};C(y=>({...y,chapters:[...y.chapters,v]}))},F=(v,y,S)=>{C(P=>({...P,chapters:P.chapters.map(R=>R.id===v?{...R,[y]:S}:R)}))},q=v=>{const y={id:Date.now(),description:"",completed:!1};F(v,"objectives",[...k.chapters.find(S=>S.id===v).objectives,y])};return!n||f?o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-stone-600",children:"Loading..."})})})}):s?o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:"Campaign Management"}),o.jsxs("div",{className:"text-sm text-stone-600",children:["Playing as: ",o.jsx("span",{className:"font-medium",children:s.name})]})]}),o.jsx("div",{className:"flex space-x-1 mb-6 bg-stone-100 p-1 rounded-lg",children:I.map(v=>o.jsx("button",{onClick:()=>b(v.id),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${g===v.id?"bg-amber-600 text-white":"text-stone-600 hover:text-stone-800"}`,children:v.label},v.id))}),g==="story"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Title"}),o.jsx("input",{type:"text",value:k.title,onChange:v=>C(y=>({...y,title:v.target.value})),className:"fantasy-input",placeholder:"Enter campaign title..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Description"}),o.jsx("textarea",{value:k.description,onChange:v=>C(y=>({...y,description:v.target.value})),className:"fantasy-input",rows:"4",placeholder:"Describe your campaign's main plot..."})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-stone-800",children:"Chapters"}),o.jsx("button",{onClick:D,className:"fantasy-button",children:"Add Chapter"})]}),o.jsx("div",{className:"space-y-4",children:k.chapters.map(v=>o.jsxs("div",{className:"fantasy-card bg-amber-50",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[o.jsx("input",{type:"text",value:v.title,onChange:y=>F(v.id,"title",y.target.value),className:"fantasy-input",placeholder:"Chapter title..."}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",checked:v.completed,onChange:y=>F(v.id,"completed",y.target.checked),className:"mr-2"}),o.jsx("label",{className:"text-sm font-medium text-stone-700",children:"Completed"})]})]}),o.jsx("textarea",{value:v.description,onChange:y=>F(v.id,"description",y.target.value),className:"fantasy-input mb-4",rows:"3",placeholder:"Chapter description..."}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h4",{className:"font-medium text-stone-800",children:"Objectives"}),o.jsx("button",{onClick:()=>q(v.id),className:"fantasy-button text-sm",children:"Add Objective"})]}),o.jsx("div",{className:"space-y-2",children:v.objectives.map(y=>o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{type:"checkbox",checked:y.completed,onChange:S=>{const P=v.objectives.map(R=>R.id===y.id?{...R,completed:S.target.checked}:R);F(v.id,"objectives",P)}}),o.jsx("input",{type:"text",value:y.description,onChange:S=>{const P=v.objectives.map(R=>R.id===y.id?{...R,description:S.target.value}:R);F(v.id,"objectives",P)},className:"fantasy-input flex-1",placeholder:"Objective description..."})]},y.id))})]})]},v.id))})]})]}),g==="ai-dm"&&o.jsx(BR,{partyCharacters:a,partyInfo:u,onStoryGenerated:v=>{},onCharacterDetailsGenerated:(v,y)=>{}}),g==="map"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Campaign Map"}),o.jsxs("div",{className:"bg-stone-200 rounded-lg p-8 text-center",children:[o.jsx("div",{className:"w-full h-64 bg-stone-300 rounded-lg flex items-center justify-center mb-4",children:o.jsx("span",{className:"text-stone-500",children:"Map Placeholder"})}),o.jsx("button",{className:"fantasy-button",children:"Upload Map Image"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Map Description"}),o.jsx("textarea",{value:N.description,onChange:v=>_(y=>({...y,description:v.target.value})),className:"fantasy-input",rows:"4",placeholder:"Describe the locations and points of interest on your map..."})]})]}),g==="characters"&&o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Party Characters"}),a.length===0?o.jsx("div",{className:"text-center py-8 text-stone-600",children:o.jsx("p",{children:"No characters have been created yet."})}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:a.map(v=>o.jsx("div",{className:"fantasy-card bg-amber-50",children:o.jsxs("div",{className:"flex items-start space-x-4",children:[o.jsx("div",{className:"w-16 h-16 bg-stone-300 rounded-lg flex items-center justify-center",children:o.jsx("span",{className:"text-xs text-stone-600",children:"IMG"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-bold text-stone-800",children:v.name}),o.jsxs("p",{className:"text-sm text-stone-600",children:["Level ",v.level," ",v.race," ",v.class]}),o.jsxs("p",{className:"text-sm text-stone-600 mt-1",children:[v.background," • ",v.alignment]})]})]})},v.id))})]}),g==="enemies"&&o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Enemies & NPCs"}),o.jsx("div",{className:"text-center py-8 text-stone-600",children:o.jsx("p",{children:"Enemy and NPC management will be available here."})})]})]})}):o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-stone-600 mb-6",children:"You need to create a character before you can access the campaign."}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("button",{onClick:()=>e(`/character-creation/${t}`),className:"fantasy-button text-lg px-8 py-3",children:"Create Character"}),o.jsx("button",{onClick:()=>e("/party-management"),className:"fantasy-button text-lg px-8 py-3 bg-stone-600 hover:bg-stone-700",children:"Back to Parties"})]})]})]})})}function WR(){var ir,Vt,qe;const t=Wn(),{partyId:e}=cu(),[n,r]=A.useState(null),[s,i]=A.useState(!1),[a,l]=A.useState(null),[u,d]=A.useState([]),[f,m]=A.useState(!1),[g,b]=A.useState(""),[k,C]=A.useState(!1),[N,_]=A.useState({name:"",race:"",class:"",level:1,background:"",alignment:"",strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10,age:"",height:"",weight:"",eyes:"",skin:"",hair:"",personality:"",ideals:"",bonds:"",flaws:"",backstory:"",equipment:[],spells:[],proficiencies:[],portrait:"/placeholder-character.png"}),[x,I]=A.useState("standard"),[D,F]=A.useState([]),[q,v]=A.useState([]),[y,S]=A.useState({}),[P,R]=A.useState(!1),[E,T]=A.useState({}),[me,ye]=A.useState([]);A.useEffect(()=>{const L=oi(te=>{if(!te){t("/login");return}r(te),e&&Se(te.uid,e),de(te.uid)});return()=>L()},[t,e]),A.useEffect(()=>{a&&(_({...a}),a.weaponChoices&&T(a.weaponChoices),a.spellChoices&&ye(a.spellChoices),a.abilityScoreMethod&&I(a.abilityScoreMethod),a.rolledScores&&F(a.rolledScores),a.assignedScores&&S(a.assignedScores),a.rolledScores&&R(a.rolledScores.length>0))},[a]);const Se=async(L,te)=>{try{const _e=await sb(L,te);l(_e)}catch{}},de=async L=>{try{const te=await _R(L);d(te)}catch(te){console.error("Error loading character presets:",te)}},K=["Human","Elf","Dwarf","Halfling","Dragonborn","Tiefling","Half-Elf","Half-Orc","Gnome","Aarakocra","Genasi","Goliath"],re=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"],ce=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],Y=["Acolyte","Criminal","Folk Hero","Noble","Sage","Soldier"],W=[15,14,13,12,10,8],J={Fighter:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Paladin:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Barbarian:{"Martial Melee Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"]},Bard:{Weapon:["Rapier","Longsword"]},Druid:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Monk:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Sorcerer:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Warlock:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]}},le={Wizard:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Sorcerer:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Warlock:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Eldritch Blast",description:"A beam of crackling energy that deals force damage and can hit multiple targets."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Cleric:[{name:"Guidance",description:"Touch a creature to give them +1d4 to their next ability check."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Resistance",description:"Touch a creature to give them +1d4 to their next saving throw."},{name:"Sacred Flame",description:"Flame-like radiance descends on a creature within 60 feet, dealing radiant damage."},{name:"Spare the Dying",description:"Touch a dying creature to stabilize them at 0 hit points."},{name:"Thaumaturgy",description:"Perform minor magical tricks - make your voice boom, cause tremors, or change eye color."}],Druid:[{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Druidcraft",description:"Predict weather, make a flower bloom, or create a harmless sensory effect."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Primal Savagery",description:"Transform your hand into a claw that deals acid damage to a creature you touch."},{name:"Produce Flame",description:"Create a flickering flame in your hand that you can throw for fire damage."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shillelagh",description:"Transform a club or quarterstaff into a magical weapon that uses your spellcasting ability."},{name:"Thorn Whip",description:"Create a vine-like whip that pulls a creature toward you and deals piercing damage."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."}],Bard:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."},{name:"Vicious Mockery",description:"Insult a creature within 60 feet, dealing psychic damage and possibly giving disadvantage."}]},ve={Wizard:{cantrips:3,spells:6},Sorcerer:{cantrips:4,spells:2},Warlock:{cantrips:2,spells:2},Cleric:{cantrips:3,spells:2},Druid:{cantrips:2,spells:2},Bard:{cantrips:2,spells:4}},ke=L=>{const _e=[...{Fighter:["Chain mail armor","Light crossbow and 20 bolts","Dungeoneer's pack","5 gp"],Wizard:["Arcane focus","Scholar's pack","Component pouch","5 gp"],Cleric:["Chain mail armor","Light crossbow and 20 bolts","Priest's pack","Shield","Holy symbol","5 gp"],Rogue:["Leather armor","Shortbow and 20 arrows","Burglar's pack","Thieves' tools","5 gp"],Ranger:["Scale mail armor","Longbow and 20 arrows","Explorer's pack","5 gp"],Paladin:["Chain mail armor","Javelins (5)","Priest's pack","Holy symbol","5 gp"],Barbarian:["Javelins (4)","Explorer's pack","5 gp"],Bard:["Leather armor","Diplomat's pack OR entertainer's pack","Lute OR any other musical instrument","5 gp"],Druid:["Leather armor","Druidic focus","Explorer's pack","Shield","5 gp"],Monk:["Dungeoneer's pack OR explorer's pack","5 gp"],Sorcerer:["Component pouch OR arcane focus","Dungeoneer's pack","5 gp"],Warlock:["Component pouch OR arcane focus","Scholar's pack","5 gp"]}[L]||["Adventurer's pack","Simple weapon","5 gp"]];return E.weapon&&_e.push(E.weapon),E.shield&&_e.push(E.shield),me.length>0&&_e.push(`Spells: ${me.join(", ")}`),_e},ae=()=>{const L=[];for(let te=0;te<4;te++)L.push(Math.floor(Math.random()*6)+1);return L.sort((te,_e)=>_e-te),L.slice(0,3).reduce((te,_e)=>te+_e,0)},pe=()=>{const L=[];for(let te=0;te<6;te++)L.push(ae());return L.sort((te,_e)=>_e-te),F(L),v([...L]),S({}),R(!0),L},Ce=(L,te)=>{const _e=q.filter(Re=>Re!==L);v(_e),S(Re=>({...Re,[te]:L})),ge(te,L)},Te=L=>{const te=y[L];if(te){v(Re=>[...Re,te].sort((st,Et)=>Et-st));const _e={...y};delete _e[L],S(_e),ge(L,10)}},Me=()=>{const L=["strength","dexterity","constitution","intelligence","wisdom","charisma"],te={...N};W.forEach((_e,Re)=>{te[L[Re]]=_e}),_(te),S({}),v([]),R(!1)},ge=(L,te)=>{_(_e=>({..._e,[L]:te}))},dt=async L=>{if(L.preventDefault(),!n){console.error("You must be logged in to create a character");return}if(!e){console.error("Party ID is missing. Please try again or contact support.");return}const _e=["name","race","class"].filter(Re=>!N[Re]);if(_e.length>0){console.error(`Please fill in all required fields: ${_e.join(", ")}`);return}i(!0);try{const Re={...N,userId:n.uid,partyId:e,equipment:ke(N.class),weapons:E,spells:me,createdAt:a?a.createdAt:new Date,updatedAt:new Date};a?(await hR(a.id,Re),console.log("Character updated successfully!")):(await dR(n.uid,e,Re),console.log("Character created successfully!")),t(`/campaign-story/${e}`)}catch(Re){console.error("Character creation/update error:",Re),console.error("Error creating/updating character:",Re.message)}finally{i(!1)}},dn=async()=>{if(!g.trim()){alert("Please enter a name for your preset");return}if(!N.name||!N.race||!N.class){alert("Please fill in at least the basic character information (name, race, class) before saving as preset");return}try{console.log("Saving preset with data:",{userId:n.uid,presetName:g,characterData:N,weaponChoices:E,spellChoices:me});const L={name:g,data:{...N,weaponChoices:E,spellChoices:me,abilityScoreMethod:x,rolledScores:D,assignedScores:y}};console.log("Calling saveCharacterPreset with:",L);const te=await xR(n.uid,L);console.log("Preset saved successfully:",te),b(""),m(!1),await de(n.uid),alert("Character preset saved successfully!")}catch(L){console.error("Error saving preset:",L),console.error("Error details:",{message:L.message,code:L.code,stack:L.stack}),L.message.includes("User profile not found")?alert("User profile not found. Please try logging out and back in."):L.message.includes("permission")?alert("Permission denied. Please check your account status."):alert(`Failed to save preset: ${L.message}`)}},we=L=>{L.key==="Enter"&&g.trim()&&dn()},bt=L=>{const te=L.data;_({...te,name:te.name+" (Copy)",equipment:[],spells:te.spells||[],proficiencies:te.proficiencies||[]}),te.weaponChoices&&T(te.weaponChoices),te.spellChoices&&ye(te.spellChoices),te.abilityScoreMethod&&I(te.abilityScoreMethod),te.rolledScores&&(F(te.rolledScores),S(te.assignedScores||{}),R(te.rolledScores.length>0)),C(!1)},Dr=async L=>{if(confirm("Are you sure you want to delete this preset? This action cannot be undone."))try{await bR(n.uid,L),await de(n.uid),alert("Preset deleted successfully!")}catch(te){console.error("Error deleting preset:",te),alert("Failed to delete preset. Please try again.")}};return n?o.jsxs("div",{className:"fantasy-container py-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),o.jsx("p",{className:"text-center text-gray-300 mb-6",children:"Create your character to join the campaign. Once created, you'll be automatically ready to start the adventure!"}),o.jsxs("div",{className:"mb-8 p-4 bg-gray-700 rounded-lg border border-gray-600",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-4",children:"Character Presets"}),o.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[o.jsxs("button",{type:"button",onClick:()=>C(!0),className:"fantasy-button bg-amber-600 hover:bg-amber-700",disabled:u.length===0,children:["📋 Load Preset (",u.length,")"]}),o.jsx("button",{type:"button",onClick:()=>m(!0),className:"fantasy-button bg-emerald-600 hover:bg-emerald-700",children:"💾 Save as Preset"})]}),u.length>0&&o.jsx("p",{className:"text-sm text-gray-300",children:"Save your current character configuration as a preset to easily recreate it for other parties."})]}),o.jsxs("form",{onSubmit:dt,className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Name"}),o.jsx("input",{type:"text",value:N.name,onChange:L=>ge("name",L.target.value),className:"fantasy-input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Race"}),o.jsxs("select",{value:N.race,onChange:L=>ge("race",L.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Race"}),K.map(L=>o.jsx("option",{value:L,children:L},L))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Class"}),o.jsxs("select",{value:N.class,onChange:L=>ge("class",L.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Class"}),re.map(L=>o.jsx("option",{value:L,children:L},L))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Background"}),o.jsxs("select",{value:N.background,onChange:L=>ge("background",L.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Background"}),Y.map(L=>o.jsx("option",{value:L,children:L},L))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Alignment"}),o.jsxs("select",{value:N.alignment,onChange:L=>ge("alignment",L.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Alignment"}),ce.map(L=>o.jsx("option",{value:L,children:L},L))]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Ability Scores"}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Ability Score Generation Method"}),o.jsxs("div",{className:"flex space-x-4 mb-4",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"abilityMethod",value:"standard",checked:x==="standard",onChange:L=>I(L.target.value),className:"mr-2"}),o.jsx("span",{className:"text-gray-200",children:"Standard Array (15, 14, 13, 12, 10, 8)"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{type:"radio",name:"abilityMethod",value:"roll",checked:x==="roll",onChange:L=>I(L.target.value),className:"mr-2"}),o.jsx("span",{className:"text-gray-200",children:"Roll 4d6, Drop Lowest"})]})]}),x==="standard"&&o.jsx("button",{type:"button",onClick:Me,className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Apply Standard Array"}),x==="roll"&&o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{type:"button",onClick:pe,disabled:P,className:`fantasy-button ${P?"bg-gray-500 cursor-not-allowed":"bg-gray-600 hover:bg-gray-700"}`,children:P?"Scores Already Rolled":"Roll Ability Scores"}),P&&o.jsx("p",{className:"text-sm text-gray-300",children:"You can only roll once, but you can reassign scores as many times as you like."}),D.length>0&&o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-semibold text-gray-100 mb-2",children:"Rolled Scores"}),o.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:q.map((L,te)=>o.jsx("span",{className:"bg-amber-900 text-amber-200 border border-amber-600 px-3 py-1 rounded-full text-sm font-medium",children:L},`${L}-${te}`))}),o.jsx("p",{className:"text-sm text-gray-300",children:"Click on an ability score below to assign your rolled scores. You can reassign them as many times as you want."})]})]})]}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:["strength","dexterity","constitution","intelligence","wisdom","charisma"].map(L=>{const te=y[L],_e=N[L];return o.jsxs("div",{className:"border border-gray-600 rounded-lg p-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 capitalize",children:L}),te?o.jsxs("div",{className:"space-y-2",children:[o.jsx("div",{className:"text-lg font-bold text-amber-400",children:te}),o.jsx("button",{type:"button",onClick:()=>Te(L),className:"text-xs text-red-400 hover:text-red-300",children:"Unassign"})]}):o.jsxs("div",{className:"space-y-2",children:[o.jsx("input",{type:"number",min:"1",max:"20",value:_e,onChange:Re=>ge(L,parseInt(Re.target.value)),className:"fantasy-input",required:!0}),q.length>0&&o.jsx("div",{className:"flex flex-wrap gap-1",children:q.map((Re,st)=>o.jsx("button",{type:"button",onClick:()=>Ce(Re,L),className:"bg-amber-900 hover:bg-amber-800 border border-amber-600 text-amber-200 px-2 py-1 rounded text-xs font-medium",children:Re},`${Re}-${st}`))})]}),o.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Modifier: ",Math.floor((_e-10)/2)]})]},L)})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Physical Description"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsx("input",{type:"text",placeholder:"Age",value:N.age,onChange:L=>ge("age",L.target.value),className:"fantasy-input"}),o.jsx("input",{type:"text",placeholder:"Height",value:N.height,onChange:L=>ge("height",L.target.value),className:"fantasy-input"}),o.jsx("input",{type:"text",placeholder:"Weight",value:N.weight,onChange:L=>ge("weight",L.target.value),className:"fantasy-input"}),o.jsx("input",{type:"text",placeholder:"Eye Color",value:N.eyes,onChange:L=>ge("eyes",L.target.value),className:"fantasy-input"}),o.jsx("input",{type:"text",placeholder:"Skin Color",value:N.skin,onChange:L=>ge("skin",L.target.value),className:"fantasy-input"}),o.jsx("input",{type:"text",placeholder:"Hair Color",value:N.hair,onChange:L=>ge("hair",L.target.value),className:"fantasy-input"})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Personality"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Personality Traits"}),o.jsx("textarea",{value:N.personality,onChange:L=>ge("personality",L.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your character's personality..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Ideals"}),o.jsx("textarea",{value:N.ideals,onChange:L=>ge("ideals",L.target.value),className:"fantasy-input",rows:"3",placeholder:"What does your character believe in?"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Bonds"}),o.jsx("textarea",{value:N.bonds,onChange:L=>ge("bonds",L.target.value),className:"fantasy-input",rows:"3",placeholder:"What connections does your character have?"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Flaws"}),o.jsx("textarea",{value:N.flaws,onChange:L=>ge("flaws",L.target.value),className:"fantasy-input",rows:"3",placeholder:"What are your character's weaknesses?"})]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Backstory"}),o.jsx("textarea",{value:N.backstory,onChange:L=>ge("backstory",L.target.value),className:"fantasy-input",rows:"6",placeholder:"Tell the story of your character's life before the adventure..."})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Starting Equipment"}),N.class&&J[N.class]&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Weapons"}),o.jsx("div",{className:"space-y-4",children:Object.entries(J[N.class]).map(([L,te])=>o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:L}),o.jsxs("select",{value:E[L.toLowerCase().replace(/\s+/g,"")]||"",onChange:_e=>T(Re=>({...Re,[L.toLowerCase().replace(/\s+/g,"")]:_e.target.value})),className:"fantasy-input",children:[o.jsxs("option",{value:"",children:["Select ",L]}),te.map(_e=>o.jsx("option",{value:_e,children:_e},_e))]})]},L))})]}),N.class&&le[N.class]&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Cantrips"}),o.jsxs("p",{className:"text-sm text-gray-300 mb-3",children:["Select your starting cantrips (0-level spells). You can choose up to ",((ir=ve[N.class])==null?void 0:ir.cantrips)||0," cantrips."]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto border border-gray-600 rounded-lg p-4",children:le[N.class].map(L=>{var Re;const te=me.includes(L.name),_e=!te&&me.length>=(((Re=ve[N.class])==null?void 0:Re.cantrips)||0);return o.jsx("div",{className:`border rounded-lg p-3 ${te?"border-amber-500 bg-amber-900/20":"border-gray-600"} ${_e?"opacity-50":"hover:border-gray-500"}`,children:o.jsxs("label",{className:`flex items-start space-x-3 cursor-pointer ${_e?"cursor-not-allowed":""}`,children:[o.jsx("input",{type:"checkbox",checked:te,disabled:_e,onChange:st=>{st.target.checked?ye(Et=>[...Et,L.name]):ye(Et=>Et.filter(ze=>ze!==L.name))},className:"rounded mt-1"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-medium text-gray-100",children:L.name}),o.jsx("div",{className:"text-sm text-gray-300 mt-1",children:L.description})]})]})},L.name)})}),o.jsxs("div",{className:"flex justify-between items-center mt-3",children:[o.jsxs("p",{className:"text-sm text-gray-400",children:["Selected: ",me.length," / ",((Vt=ve[N.class])==null?void 0:Vt.cantrips)||0," cantrips"]}),me.length>=(((qe=ve[N.class])==null?void 0:qe.cantrips)||0)&&o.jsx("p",{className:"text-sm text-green-400 font-medium",children:"✓ Cantrip selection complete"})]})]}),N.class?o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsxs("h3",{className:"font-semibold text-gray-100 mb-3",children:[N.class," Starting Equipment"]}),o.jsx("ul",{className:"space-y-1",children:ke(N.class).map((L,te)=>o.jsxs("li",{className:"text-gray-200 flex items-start",children:[o.jsx("span",{className:"text-gray-400 mr-2",children:"•"}),L]},te))}),o.jsx("p",{className:"text-sm text-gray-300 mt-3",children:"This equipment will be automatically assigned to your character."})]}):o.jsx("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:o.jsx("p",{className:"text-gray-300",children:"Select a class to see your starting equipment."})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Character Portrait"}),o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("div",{className:"w-32 h-32 bg-gray-600 rounded-lg flex items-center justify-center",children:o.jsx("span",{className:"text-gray-400",children:"Portrait Placeholder"})}),o.jsx("button",{type:"button",className:"fantasy-button",onClick:()=>{},children:"Upload Image"})]})]}),o.jsxs("div",{className:"flex justify-center space-x-4",children:[o.jsx("button",{type:"button",onClick:()=>t(`/campaign-story/${e}`),className:"fantasy-button bg-gray-600 hover:bg-gray-700",disabled:s,children:"Back to Campaign"}),o.jsx("button",{type:"submit",className:"fantasy-button",disabled:s,children:s?"Creating Character...":"Create Character"})]})]})]}),f&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"fantasy-card max-w-md w-full mx-4",children:[o.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Save Character Preset"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Preset Name"}),o.jsx("input",{type:"text",value:g,onChange:L=>b(L.target.value),onKeyPress:we,className:"fantasy-input",placeholder:"Enter a name for your preset",autoFocus:!0})]}),o.jsxs("div",{className:"flex space-x-3",children:[o.jsx("button",{type:"button",onClick:()=>{m(!1),b("")},className:"fantasy-button bg-gray-600 hover:bg-gray-700 flex-1",children:"Cancel"}),o.jsx("button",{type:"button",onClick:dn,className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 flex-1",children:"Save Preset"})]})]})]})}),k&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"fantasy-card max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Load Character Preset"}),u.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-gray-300 mb-4",children:"No character presets found."}),o.jsx("p",{className:"text-sm text-gray-400",children:"Create a character and save it as a preset to see it here."}),o.jsx("button",{type:"button",onClick:()=>C(!1),className:"fantasy-button mt-4",children:"Close"})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"grid gap-4",children:u.map(L=>o.jsxs("div",{className:"border border-gray-600 rounded-lg p-4 hover:border-gray-500",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-100",children:L.name}),o.jsxs("p",{className:"text-sm text-gray-300",children:[L.data.race," ",L.data.class," • Level ",L.data.level]}),L.data.background&&o.jsx("p",{className:"text-sm text-gray-400",children:L.data.background}),L.createdAt&&o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Created: ",new Date(L.createdAt.toDate()).toLocaleDateString()]})]}),o.jsx("button",{type:"button",onClick:()=>Dr(L.id),className:"text-red-400 hover:text-red-300 text-sm",title:"Delete preset",children:"🗑️"})]}),o.jsx("div",{className:"flex space-x-2",children:o.jsx("button",{type:"button",onClick:()=>bt(L),className:"fantasy-button bg-amber-600 hover:bg-amber-700 flex-1",children:"Load Preset"})})]},L.id))}),o.jsx("div",{className:"flex justify-center",children:o.jsx("button",{type:"button",onClick:()=>C(!1),className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Cancel"})})]})]})})]}):null}const dr={INVESTIGATION:"investigation",COMBAT:"combat",PERSUASION:"persuasion",EXPLORATION:"exploration",SOCIAL:"social"},Kt={HIDDEN:"hidden",DISCOVERED:"discovered",IN_PROGRESS:"in_progress",COMPLETED:"completed",FAILED:"failed"},_v=t=>{const e=[{id:"investigate_area",type:dr.INVESTIGATION,title:"Investigate the Area",description:"Search for clues and gather information about the situation",keywords:["search","investigate","examine","look around","check","explore"],state:Kt.HIDDEN,discoveredAt:null,completedAt:null},{id:"resolve_conflict",type:dr.COMBAT,title:"Resolve the Conflict",description:"Engage in combat to overcome the threat",keywords:["fight","attack","defend","combat","battle"],state:Kt.HIDDEN,discoveredAt:null,completedAt:null},{id:"negotiate_peace",type:dr.PERSUASION,title:"Negotiate Peace",description:"Use diplomacy and persuasion to resolve the situation peacefully",keywords:["talk","negotiate","persuade","convince","diplomacy","peace"],state:Kt.HIDDEN,discoveredAt:null,completedAt:null}],n=[];return(t.toLowerCase().includes("thief")||t.toLowerCase().includes("stealth"))&&n.push({id:"stealth_approach",type:dr.EXPLORATION,title:"Stealth Approach",description:"Use stealth to avoid detection and gather information",keywords:["sneak","stealth","hide","silent","unnoticed"],state:Kt.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("merchant")||t.toLowerCase().includes("trade"))&&n.push({id:"establish_trade",type:dr.SOCIAL,title:"Establish Trade Relations",description:"Build economic relationships with the locals",keywords:["trade","bargain","deal","commerce","business"],state:Kt.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("scholar")||t.toLowerCase().includes("knowledge"))&&n.push({id:"gather_knowledge",type:dr.INVESTIGATION,title:"Gather Ancient Knowledge",description:"Discover and preserve valuable information",keywords:["research","study","learn","knowledge","ancient","lore"],state:Kt.HIDDEN,discoveredAt:null,completedAt:null}),[...e,...n]},qR=(t,e)=>{const n=[];return e.forEach(r=>{if(r.state===Kt.HIDDEN){const s=t.toLowerCase();r.keywords.some(a=>s.includes(a.toLowerCase()))&&n.push({...r,state:Kt.DISCOVERED,discoveredAt:new Date})}}),n},HR=(t,e)=>t.filter(n=>n.state===e),GR=t=>t.filter(e=>e.state===Kt.DISCOVERED||e.state===Kt.IN_PROGRESS||e.state===Kt.COMPLETED),KR=(t,e)=>{const n=HR(t,Kt.HIDDEN),r=[];return n.forEach(s=>{const i=e.toLowerCase();s.type===dr.INVESTIGATION&&(i.includes("mystery")||i.includes("unknown"))&&r.push("There might be more to discover here..."),s.type===dr.PERSUASION&&(i.includes("tension")||i.includes("conflict"))&&r.push("Perhaps words could resolve this..."),s.type===dr.COMBAT&&(i.includes("threat")||i.includes("danger"))&&r.push("The situation seems dangerous...")}),r},yt={SETUP:"setup",INTRODUCTION:"introduction",RISING_ACTION:"rising_action",CLIMAX:"climax",RESOLUTION:"resolution",COMPLETED:"completed"},QR=(t,e)=>{const n={importantNPCs:[],keyLocations:[],majorEvents:[],partyDecisions:[],currentSituation:null,activeThreats:[],availableResources:[]};if(t.slice(-10).forEach(s=>{if(s.role==="assistant"){const i=s.content.toLowerCase(),a=i.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:the\s+)?([a-z\s]+)/g);a&&a.forEach(d=>{n.importantNPCs.find(f=>f.name===d)||n.importantNPCs.push({name:d,firstMentioned:s.timestamp,role:"unknown"})}),["town","city","village","castle","temple","dungeon","forest","mountain"].forEach(d=>{if(i.includes(d)){const f=i.match(new RegExp(`([A-Z][a-z]+(?:s+[A-Z][a-z]+)*\\s+${d})`,"i"));f&&!n.keyLocations.find(m=>m.name===f[1])&&n.keyLocations.push({name:f[1],type:d,firstMentioned:s.timestamp})}}),["danger","threat","enemy","monster","evil","dark","cursed"].forEach(d=>{i.includes(d)&&n.activeThreats.push({type:d,mentioned:s.timestamp,description:i.substring(Math.max(0,i.indexOf(d)-50),i.indexOf(d)+50)})})}}),t.length>0){const s=t[t.length-1];s.role==="assistant"&&(n.currentSituation=s.content)}return n},YR=(t,e,n)=>{var i,a;t||(console.warn("Campaign metadata is undefined, using fallback values"),t={campaignPhase:yt.SETUP,mainGoal:null,activeObjectives:[],completedObjectives:[],importantNPCs:[],keyLocations:[],partyDecisions:[],storyContext:{currentSituation:null,worldState:{}},sessionNumber:1,campaignProgress:0}),t.storyContext||(t.storyContext={currentSituation:null,worldState:{}});const r={campaignPhase:t.campaignPhase||yt.SETUP,mainGoal:t.mainGoal||null,activeObjectives:t.activeObjectives||[],completedObjectives:t.completedObjectives||[],importantNPCs:t.importantNPCs||[],keyLocations:t.keyLocations||[],currentSituation:((i=t.storyContext)==null?void 0:i.currentSituation)||null,partyDecisions:t.partyDecisions||[],worldState:((a=t.storyContext)==null?void 0:a.worldState)||{},sessionNumber:t.sessionNumber||1,campaignProgress:t.campaignProgress||0},s=QR(e);return{...r,recentNPCs:s.importantNPCs,recentLocations:s.keyLocations,recentThreats:s.activeThreats,currentSituation:s.currentSituation||r.currentSituation}},XR=(t,e,n)=>{let r=0;const s={[yt.SETUP]:0,[yt.INTRODUCTION]:10,[yt.RISING_ACTION]:30,[yt.CLIMAX]:70,[yt.RESOLUTION]:90,[yt.COMPLETED]:100};r+=s[t.campaignPhase]||0;const a=n.filter(d=>d.state==="completed").length/Math.max(n.length,1)*30;r+=a;const l=e.length,u=Math.min(l/50*20,20);return r+=u,Math.min(Math.round(r),100)},JR=(t,e,n)=>{const r=e.length,s=n.filter(a=>a.state==="completed");let i=t.campaignPhase;return t.campaignPhase===yt.SETUP&&r>0?i=yt.INTRODUCTION:t.campaignPhase===yt.INTRODUCTION&&r>=5?i=yt.RISING_ACTION:t.campaignPhase===yt.RISING_ACTION&&(r>=15||s.length>=2)?i=yt.CLIMAX:t.campaignPhase===yt.CLIMAX&&(r>=25||s.length>=3)?i=yt.RESOLUTION:t.campaignPhase===yt.RESOLUTION&&(r>=30||s.length>=4)&&(i=yt.COMPLETED),i!==t.campaignPhase?i:null};class ZR{constructor(){this.defaultState={currentLocation:{name:"",description:"",npcs:[],features:[],atmosphere:"",exits:[]},activeNPCs:{},activePlotThreads:[],characterArcs:{},worldState:{timeOfDay:"day",weather:"clear",recentEvents:[],factionRelations:{},discoveredLocations:[],completedObjectives:[]},storyMetadata:{sessionStartTime:null,totalMessages:0,currentPhase:"introduction",campaignMood:"neutral",tensionLevel:0}}}initializeStoryState(e,n,r=null){const s={...this.defaultState};return e.forEach(i=>{s.characterArcs[i.id]={relationships:{},discoveries:[],motivations:[i.ideals||"adventure"],characterGrowth:[],currentGoals:[],personalityTraits:i.personality?i.personality.split(",").map(a=>a.trim()):[],backstoryElements:i.backstory?this.extractBackstoryElements(i.backstory):[]}}),s.currentLocation=this.extractInitialLocation(n),r&&r.description&&(s.storyMetadata.campaignMood=this.determineMoodFromTheme(r.description)),s}extractStoryElements(e){const n={npcInteractions:[],plotAdvancement:null,locationChanges:null,newDiscoveries:[],characterDevelopment:{},worldStateUpdates:{}};return[/(\w+)\s+(?:becomes?|grows?|seems?)\s+(friendly|hostile|neutral|suspicious|trusting)/gi,/(\w+)\s+(?:reacts?|responds?)\s+(?:with|in)\s+(joy|anger|fear|surprise|curiosity)/gi,/(\w+)\s+(?:shows?|displays?)\s+(gratitude|distrust|interest|concern)/gi].forEach(a=>{[...e.matchAll(a)].forEach(u=>{n.npcInteractions.push({npc:u[1],newDisposition:u[2],context:u[0]})})}),[/(?:discovers?|finds?|learns?)\s+(?:that\s+)?(.+?)(?:\.|!)/gi,/(?:new\s+)?(?:clue|evidence|information)\s+(?:about|regarding)\s+(.+?)(?:\.|!)/gi,/(?:progress|advance)\s+(?:in|on)\s+(.+?)(?:\.|!)/gi].forEach(a=>{const l=[...e.matchAll(a)];l.length>0&&(n.plotAdvancement={discovery:l[0][1],progress:.1})}),[/(?:moves?|goes?|travels?)\s+(?:to|towards?)\s+(.+?)(?:\.|!)/gi,/(?:enters?|approaches?)\s+(.+?)(?:\.|!)/gi,/(?:arrives?|reaches?)\s+(?:at|in)\s+(.+?)(?:\.|!)/gi].forEach(a=>{const l=[...e.matchAll(a)];l.length>0&&(n.locationChanges={newLocation:l[0][1],transition:l[0][0]})}),n}updateStoryState(e,n,r,s){const i={...e},a=this.extractStoryElements(n);if(a.npcInteractions.length>0&&a.npcInteractions.forEach(l=>{i.activeNPCs[l.npc]||(i.activeNPCs[l.npc]={disposition:"neutral",knowledge:[],relationships:{},currentGoal:"",firstAppearance:new Date().toISOString()}),i.activeNPCs[l.npc].disposition=l.newDisposition,i.activeNPCs[l.npc].lastInteraction=new Date().toISOString()}),a.plotAdvancement){const l=i.activePlotThreads.find(u=>u.id===this.generateThreadId(a.plotAdvancement.discovery));l?(l.progress=Math.min(1,l.progress+a.plotAdvancement.progress),l.lastUpdated=new Date().toISOString()):i.activePlotThreads.push({id:this.generateThreadId(a.plotAdvancement.discovery),title:a.plotAdvancement.discovery,status:"active",progress:a.plotAdvancement.progress,discoveredAt:new Date().toISOString(),lastUpdated:new Date().toISOString(),involvedNPCs:[],clues:[]})}if(s&&i.characterArcs[s]){const l=i.characterArcs[s],u=this.extractCharacterDevelopment(r,n);u.relationships&&(l.relationships={...l.relationships,...u.relationships}),u.discoveries&&(l.discoveries=[...new Set([...l.discoveries,...u.discoveries])]),u.motivations&&(l.motivations=[...new Set([...l.motivations,...u.motivations])]),u.growth&&(l.characterGrowth=[...new Set([...l.characterGrowth,...u.growth])])}return a.locationChanges&&(i.currentLocation={...i.currentLocation,name:a.locationChanges.newLocation,description:this.generateLocationDescription(a.locationChanges.newLocation),lastUpdated:new Date().toISOString()}),i.worldState.recentEvents=[...i.worldState.recentEvents.slice(-4),{event:r.substring(0,100)+"...",timestamp:new Date().toISOString(),characterId:s}],i.storyMetadata.totalMessages+=1,i.storyMetadata.lastUpdated=new Date().toISOString(),i}extractCharacterDevelopment(e,n){const r={relationships:{},discoveries:[],motivations:[],growth:[]};return[/(?:trusts?|likes?|respects?)\s+(\w+)/gi,/(?:distrusts?|dislikes?|fears?)\s+(\w+)/gi,/(?:befriends?|allies?\s+with)\s+(\w+)/gi].forEach(l=>{[...e.matchAll(l)].forEach(d=>{const f=d[1],m=d[0].toLowerCase();m.includes("trust")||m.includes("like")||m.includes("respect")?r.relationships[f]="positive":m.includes("distrust")||m.includes("dislike")||m.includes("fear")?r.relationships[f]="negative":(m.includes("friend")||m.includes("ally"))&&(r.relationships[f]="allied")})}),[/(?:discovers?|finds?|learns?)\s+(.+?)(?:\.|!)/gi,/(?:realizes?|understands?)\s+(.+?)(?:\.|!)/gi].forEach(l=>{[...e.matchAll(l)].forEach(d=>{r.discoveries.push(d[1].trim())})}),[/(?:wants?|desires?|seeks?)\s+(?:to\s+)?(.+?)(?:\.|!)/gi,/(?:motivated\s+by|driven\s+by)\s+(.+?)(?:\.|!)/gi].forEach(l=>{[...e.matchAll(l)].forEach(d=>{r.motivations.push(d[1].trim())})}),r}generateContextPrompt(e,n,r,s){const i={currentLocation:e.currentLocation,activeNPCs:e.activeNPCs,activePlotThreads:e.activePlotThreads,characterArcs:e.characterArcs,worldState:e.worldState,storyMetadata:e.storyMetadata};return`
STORY STATE SUMMARY:
Current Location: ${i.currentLocation.name} - ${i.currentLocation.description}
Atmosphere: ${i.currentLocation.atmosphere}
Active NPCs: ${Object.keys(i.activeNPCs).join(", ")||"None"}
Active Plot Threads: ${i.activePlotThreads.map(l=>`${l.title} (${Math.round(l.progress*100)}%)`).join(", ")||"None"}
Recent Events: ${i.worldState.recentEvents.slice(-3).map(l=>l.event).join(", ")||"None"}

CHARACTER CONTEXT:
${n.map(l=>{const u=i.characterArcs[l.id]||{},d=Object.entries(u.relationships||{}).map(([m,g])=>`${m} (${g})`).join(", "),f=u.discoveries?u.discoveries.slice(-3).join(", "):"";return`${l.name}: Relationships: ${d||"None"}. Recent discoveries: ${f||"None"}`}).join(`
`)}

NPC RELATIONSHIPS:
${Object.entries(i.activeNPCs).map(([l,u])=>`${l}: ${u.disposition} disposition, ${u.knowledge.length} pieces of knowledge, goal: ${u.currentGoal||"unknown"}`).join(`
`)}

STORY HISTORY (Last 5 messages):
${r.slice(-5).map(l=>`${l.role}: ${l.content}`).join(`
`)}

PLAYER RESPONSE: "${s}"

CRITICAL CONSISTENCY RULES:
1. Maintain all established NPC relationships and dispositions
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

RESPONSE REQUIREMENTS:
- Acknowledge the player's action in context of the current situation and location
- Reference relevant NPCs and their established relationships with the party
- Continue or advance active plot threads appropriately
- Update character relationships based on the action
- Maintain location and atmosphere consistency
- End with a clear situation that invites the next player response
- Keep the story flowing naturally without jarring transitions
`}extractInitialLocation(e){const n=[/(?:in|at|near)\s+(.+?)(?:\.|,|!)/gi,/(?:town|city|village|castle|tower|dungeon|forest|mountain)\s+(?:of|in|near)\s+(.+?)(?:\.|,|!)/gi];for(const r of n){const s=[...e.matchAll(r)];if(s.length>0)return{name:s[0][1].trim(),description:"A location mentioned in the plot",npcs:[],features:[],atmosphere:"mysterious",exits:[]}}return{name:"Starting Location",description:"Where the adventure begins",npcs:[],features:[],atmosphere:"neutral",exits:[]}}extractBackstoryElements(e){const n=[];return[/(?:family|parents?|siblings?)\s+(.+?)(?:\.|,)/gi,/(?:trained|learned|studied)\s+(.+?)(?:\.|,)/gi,/(?:worked|served|lived)\s+(?:as|in)\s+(.+?)(?:\.|,)/gi].forEach(s=>{[...e.matchAll(s)].forEach(a=>{n.push(a[1].trim())})}),n}determineMoodFromTheme(e){const n=e.toLowerCase();return n.includes("dark")||n.includes("gothic")||n.includes("horror")?"dark":n.includes("light")||n.includes("happy")||n.includes("cheerful")?"light":n.includes("mysterious")||n.includes("enigmatic")?"mysterious":n.includes("epic")||n.includes("grand")?"epic":"neutral"}generateThreadId(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"_").substring(0,20)}generateLocationDescription(e){const n=["A place of mystery and adventure","An area with its own unique character","A location that holds many secrets","A place where stories unfold","An area rich with history and possibility"];return n[Math.floor(Math.random()*n.length)]}}const ej=new ZR;class tj{constructor(){this.actionTypes={attack:{name:"Attack",cooldown:0,priority:"normal",description:"A basic physical attack",narrativeTemplate:"{character} {action} with {weapon}!"},spell:{name:"Cast Spell",cooldown:1,priority:"normal",description:"Cast a magical spell",narrativeTemplate:"{character} channels arcane energy into {spell}!"},special:{name:"Special Ability",cooldown:2,priority:"high",description:"Use a special class ability",narrativeTemplate:"{character} unleashes their {ability}!"},item:{name:"Use Item",cooldown:0,priority:"low",description:"Use an item or consumable",narrativeTemplate:"{character} uses {item}!"},defend:{name:"Defend",cooldown:0,priority:"high",description:"Take a defensive stance",narrativeTemplate:"{character} takes a defensive stance!"},environmental:{name:"Environmental Action",cooldown:1,priority:"normal",description:"Use the environment to your advantage",narrativeTemplate:"{character} uses the {environment} to their advantage!"},teamUp:{name:"Team Up",cooldown:3,priority:"high",description:"Coordinate with another party member",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}},this.statusEffects={poisoned:{name:"Poisoned",duration:3,effect:"lose 1 HP per turn",narrative:"is suffering from poison"},burned:{name:"Burned",duration:2,effect:"lose 2 HP per turn",narrative:"is burning with magical flames"},frozen:{name:"Frozen",duration:1,effect:"skip next turn",narrative:"is frozen solid"},paralyzed:{name:"Paralyzed",duration:2,effect:"50% chance to skip turn",narrative:"is paralyzed and can barely move"},confused:{name:"Confused",duration:2,effect:"may attack randomly",narrative:"is confused and disoriented"},blessed:{name:"Blessed",duration:3,effect:"+2 to attack rolls",narrative:"is blessed with divine favor"},hasted:{name:"Hasted",duration:2,effect:"extra action per turn",narrative:"is moving with supernatural speed"}},this.classAbilities={fighter:{name:"Second Wind",description:"Recover some HP",effect:"heal 1d6+2 HP",cooldown:3},wizard:{name:"Arcane Surge",description:"Enhance next spell",effect:"+2 to spell damage",cooldown:2},rogue:{name:"Sneak Attack",description:"Deal extra damage from stealth",effect:"+1d6 damage if target is unaware",cooldown:1},cleric:{name:"Divine Favor",description:"Bless an ally",effect:"target gets +1 to all rolls",cooldown:2}}}initializeCombat(e,n,r){return{combatants:[...e,...n].map(a=>({...a,initiative:this.calculateInitiative(a),statusEffects:[],cooldowns:{},lastAction:null,turnCount:0})).sort((a,l)=>l.initiative-a.initiative),currentTurn:0,round:1,phase:"preparation",storyContext:r,environmentalFeatures:this.extractEnvironmentalFeatures(r),teamUpOpportunities:this.identifyTeamUpOpportunities(e),narrativeElements:this.extractNarrativeElements(r)}}calculateInitiative(e){var s,i,a;let n=Math.floor(Math.random()*20)+1;return n+={rogue:3,monk:2,ranger:1,fighter:0,cleric:0,wizard:-1,paladin:-1}[(s=e.class)==null?void 0:s.toLowerCase()]||0,(i=e.statusEffects)!=null&&i.includes("hasted")&&(n+=5),(a=e.statusEffects)!=null&&a.includes("paralyzed")&&(n-=3),n}extractEnvironmentalFeatures(e){const n=[],r={forest:["trees","cover","difficult terrain"],cave:["darkness","echoes","tight spaces"],tavern:["furniture","crowds","flammable materials"],castle:["stone walls","narrow corridors","defensive positions"],dungeon:["traps","darkness","confined spaces"],outdoors:["weather","open space","natural cover"]},s=e.toLowerCase();return Object.entries(r).forEach(([i,a])=>{s.includes(i)&&n.push(...a)}),n}identifyTeamUpOpportunities(e){const n=[];return[{classes:["fighter","rogue"],description:"Fighter distracts while Rogue sneaks in for a backstab"},{classes:["wizard","cleric"],description:"Wizard casts area spell while Cleric protects the party"},{classes:["fighter","cleric"],description:"Fighter tanks while Cleric provides healing support"},{classes:["rogue","wizard"],description:"Rogue scouts while Wizard provides magical backup"}].forEach(s=>{s.classes.every(a=>e.some(l=>{var u;return((u=l.class)==null?void 0:u.toLowerCase())===a}))&&n.push(s)}),n}extractNarrativeElements(e){return{mood:this.determineCombatMood(e),stakes:this.determineStakes(e),environmentalHazards:this.identifyHazards(e),npcInvolvement:this.extractNPCs(e)}}determineCombatMood(e){const n=e.toLowerCase();return n.includes("desperate")||n.includes("last stand")?"desperate":n.includes("training")||n.includes("practice")?"casual":n.includes("revenge")||n.includes("vengeance")?"vengeful":n.includes("defense")||n.includes("protect")?"defensive":"standard"}determineStakes(e){const n=e.toLowerCase();return n.includes("life")||n.includes("death")||n.includes("kill")?"life_or_death":n.includes("escape")||n.includes("flee")?"escape":n.includes("capture")||n.includes("arrest")?"capture":n.includes("treasure")||n.includes("loot")?"treasure":"standard"}identifyHazards(e){const n=[],r=e.toLowerCase();return(r.includes("fire")||r.includes("flame"))&&n.push("fire"),(r.includes("water")||r.includes("river")||r.includes("lake"))&&n.push("water"),(r.includes("height")||r.includes("cliff")||r.includes("fall"))&&n.push("height"),(r.includes("trap")||r.includes("pit"))&&n.push("traps"),n}extractNPCs(e){const n=[];return[/(\w+)\s+(?:the\s+)?(?:guard|merchant|wizard|knight|rogue|priest)/gi,/(?:named|called)\s+(\w+)/gi].forEach(s=>{[...e.matchAll(s)].forEach(a=>{n.push(a[1])})}),n}async executeAction(e,n,r,s,i={}){const a=e.combatants.find(m=>m.id===n),l=e.combatants.find(m=>m.id===s);if(!a||!l)throw new Error("Invalid combatant or target");if(a.cooldowns&&a.cooldowns[r]>0)return{success:!1,message:`${a.name} cannot use ${r} yet (cooldown: ${a.cooldowns[r]} turns)`};const u=this.generateActionNarrative(a,r,l,i),d=this.calculateActionResults(a,r,l,i);this.applyActionEffects(e,a,l,d),this.updateCooldowns(e,a,r);const f=this.checkStatusEffectApplication(a,r,l,d);return{success:!0,narrative:u,results:d,statusEffects:f,environmentalImpact:this.calculateEnvironmentalImpact(e,r,d),targetId:s,combatSession:e}}generateActionNarrative(e,n,r,s){let a=this.actionTypes[n].narrativeTemplate;a=a.replace("{character}",e.name),a=a.replace("{action}",this.getActionVerb(n,e.class)),a=a.replace("{weapon}",s.weapon||"their weapon"),a=a.replace("{spell}",s.spell||"a spell"),a=a.replace("{ability}",s.ability||"special ability"),a=a.replace("{item}",s.item||"an item"),a=a.replace("{environment}",s.environment||"surroundings"),a=a.replace("{ally}",s.ally||"ally"),s.specialAttack&&s.specialAttack!=="Standard Action"&&(a=`${e.name} uses ${s.specialAttack}! `+a),s.damageType&&s.damageType!=="physical"&&(a+=` The attack deals ${s.damageType} damage.`);const l=this.getClassFlavor(e.class,n);return l&&(a+=` ${l}`),a}getActionVerb(e,n){var s;return((s={fighter:{attack:"charges forward with a mighty swing",defend:"raises their shield defensively",special:"unleashes their combat expertise"},wizard:{attack:"casts a magical bolt",spell:"weaves arcane energy",special:"channels pure magical power"},rogue:{attack:"strikes from the shadows",defend:"dodges and weaves",special:"executes a perfect sneak attack"},cleric:{attack:"calls upon divine power",spell:"prays for divine intervention",special:"channels holy energy"}}[n==null?void 0:n.toLowerCase()])==null?void 0:s[e])||"performs an action"}getClassFlavor(e,n){var s;return((s={priest:{attack:"Divine energy crackles around their weapon.",spell:"Holy light emanates from their hands.",heal:"A warm, healing glow surrounds them."},wizard:{attack:"Arcane energy flows through their weapon.",spell:"Mystical runes appear in the air.",special:"Ancient magic surges through them."},warrior:{attack:"Their combat training shows in every move.",special:"Years of battle experience guide their strike.",defend:"They adopt a defensive stance with practiced ease."},rogue:{attack:"They move with deadly precision.",special:"Shadow and stealth enhance their attack.",defend:"They dodge and weave with acrobatic grace."},boss:{attack:"Their overwhelming presence fills the battlefield.",special:"Ancient power courses through their veins.",spell:"Reality itself seems to bend to their will."},undead:{attack:"Necrotic energy pulses from their form.",spell:"Death magic swirls around them.",special:"The very air grows cold with their presence."}}[e==null?void 0:e.toLowerCase()])==null?void 0:s[n])||""}calculateActionResults(e,n,r,s){const i={damage:0,healing:0,statusEffects:[],environmentalEffects:[],narrative:"",specialAttack:s.specialAttack||"Standard Action",damageType:s.damageType||"physical",attribute:s.attribute||"strength"};switch(n){case"attack":i.damage=this.calculateAttackDamage(e,r,s);break;case"spell":i.damage=this.calculateSpellDamage(e,r,s);break;case"special":i.damage=this.calculateSpecialDamage(e,r,s);break;case"item":i.healing=this.calculateItemEffect(e,r,s);break;case"defend":i.statusEffects.push({type:"defensive",duration:1});break;case"environmental":i.environmentalEffects=this.calculateEnvironmentalEffects(e,r,s);break;case"teamUp":i.damage=this.calculateTeamUpDamage(e,r,s);break}return i}calculateAttackDamage(e,n,r){const s=Math.floor(Math.random()*8)+1,i=Math.floor((e.strength-10)/2),a=r.weaponBonus||0;let l=1,u=0;if(e.id.startsWith("enemy_")){l=1+(e.level-1)*.3;const d=r.attribute||"strength";u=Math.floor((e[d]-10)/2);const f=this.calculateEnemyItemBonus(e);let m=0;r.specialAttack&&r.specialAttack!=="Standard Attack"&&(m=Math.floor(Math.random()*4)+2),r.isBossAttack&&(m+=5);let g=(s+i+a+u+f+m)*l;return Math.floor(Math.random()*20)+1===20&&(g*=2),console.log(`Enhanced enemy damage calculation for ${e.name}:`,{baseDamage:s,strengthMod:i,weaponBonus:a,attributeMod:u,itemBonus:f,specialBonus:m,levelScaling:l,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,totalDamage:Math.max(1,Math.floor(g))}),Math.max(1,Math.floor(g))}else{const d=Math.floor((e.dexterity-10)/2),f=Math.floor((e.level-1)*.5);let m=s+i+d+a+f;return Math.floor(Math.random()*20)+1===20&&(m*=2),Math.max(1,Math.floor(m))}}getEnemyPrimaryAttribute(e){return{Warrior:"strength",Archer:"dexterity",Mage:"intelligence",Cleric:"wisdom",Rogue:"dexterity",Paladin:"strength",Ranger:"dexterity",Wizard:"intelligence",Fighter:"strength"}[e]||"strength"}calculateEnemyItemBonus(e){let n=0;return e.equipment&&(e.equipment.weapon&&(n+=e.equipment.weapon.damageBonus||0),e.equipment.armor&&(n+=e.equipment.armor.defenseBonus||0),e.equipment.accessory&&(n+=e.equipment.accessory.bonus||0)),e.level>3&&(n+=Math.floor((e.level-3)/2)),n}calculateSpellDamage(e,n,r){const s=Math.floor(Math.random()*6)+1,i=Math.floor((e.intelligence-10)/2),a=r.spellLevel||1;if(e.id.startsWith("enemy_")){const l=1+(e.level-1)*.4,u=Math.floor((e.wisdom-10)/2),d=this.calculateEnemyItemBonus(e);let f=(s+i+u+a+d)*l;return Math.floor(Math.random()*20)+1>=19&&(f*=1.5),Math.max(1,Math.floor(f))}else return Math.max(1,s+i+a)}calculateSpecialDamage(e,n,r){var l;if(!this.classAbilities[(l=e.class)==null?void 0:l.toLowerCase()])return 0;const i=Math.floor(Math.random()*10)+2,a=Math.floor((e.level||1)/2);return Math.max(1,i+a)}calculateItemEffect(e,n,r){switch(r.itemType||"potion"){case"healing":return Math.floor(Math.random()*8)+2;case"antidote":return 0;case"blessing":return 0;default:return Math.floor(Math.random()*4)+1}}calculateTeamUpDamage(e,n,r){const s=Math.floor(Math.random()*12)+3;return Math.max(1,s+2)}applyActionEffects(e,n,r,s){s.damage>0&&(r.hp=Math.max(0,r.hp-s.damage)),s.healing>0&&(r.hp=Math.min(r.maxHp,r.hp+s.healing)),r.statusEffects||(r.statusEffects=[]),s.statusEffects.forEach(i=>{r.statusEffects.some(a=>a.type===i.type)||r.statusEffects.push({type:i.type,duration:i.duration,appliedBy:n.id})})}updateCooldowns(e,n,r){const s=this.actionTypes[r];n.cooldowns||(n.cooldowns={}),n.cooldowns[r]=s.cooldown,Object.keys(n.cooldowns).forEach(i=>{i!==r&&n.cooldowns[i]>0&&n.cooldowns[i]--})}checkStatusEffectApplication(e,n,r,s){const i=[];if(r.statusEffects||(r.statusEffects=[]),s.damage>10){const a=["stunned","bleeding"],l=a[Math.floor(Math.random()*a.length)];r.statusEffects.some(u=>u.type===l)||i.push({type:l,duration:1,appliedBy:e.id})}return i}calculateEnvironmentalImpact(e,n,r){const s=[];return n==="spell"&&r.damage>8&&s.push("The magical energy disturbs the environment"),n==="environmental"&&s.push("The environment responds to the action"),s}processStatusEffects(e,n){const r=[];return n.statusEffects&&n.statusEffects.forEach((s,i)=>{switch(s.duration--,s.type){case"poisoned":n.hp=Math.max(0,n.hp-1),r.push(`${n.name} takes 1 poison damage`);break;case"burned":n.hp=Math.max(0,n.hp-2),r.push(`${n.name} takes 2 burn damage`);break;case"frozen":r.push(`${n.name} is frozen and cannot act`);break;case"paralyzed":Math.random()<.5&&r.push(`${n.name} is paralyzed and cannot act`);break;case"blessed":r.push(`${n.name} is blessed with divine favor`);break;case"hasted":r.push(`${n.name} moves with supernatural speed`);break}s.duration<=0&&(n.statusEffects.splice(i,1),r.push(`${n.name} is no longer ${s.type}`))}),r}checkCombatEnd(e){const n=e.combatants.filter(a=>!a.id.startsWith("enemy_")),r=e.combatants.filter(a=>a.id.startsWith("enemy_")),s=n.some(a=>a.hp>0),i=r.some(a=>a.hp>0);return s?i?{ended:!1}:{ended:!0,result:"victory",narrative:"The enemies have been defeated!"}:{ended:!0,result:"defeat",narrative:"The party has been defeated..."}}generateCombatSummary(e,n){return{result:n,duration:e.round,participants:e.combatants.map(s=>({name:s.name,finalHp:s.hp,actions:s.turnCount,statusEffects:s.statusEffects.length})),narrative:this.generateCombatNarrative(e,n)}}generateCombatNarrative(e,n){const r=e.combatants.filter(s=>!s.id.startsWith("enemy_"));return e.combatants.filter(s=>s.id.startsWith("enemy_")),n==="victory"?`The party emerges victorious from the battle. ${r.map(s=>s.name).join(", ")} stand triumphant over their fallen foes.`:n==="defeat"?"The battle ends in defeat. The party has been overwhelmed by their enemies.":"The battle ends in a draw, with both sides withdrawing to regroup."}chooseEnemyAction(e,n){const r=this.getAvailableActions(e),s=this.getValidTargets(e,"attack",n);return console.log(`Enemy ${e.name} available actions:`,r),console.log(`Enemy ${e.name} valid targets:`,s.map(i=>i.name)),s.length===0?(console.log(`No valid targets for ${e.name}, defaulting to defend`),{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}):this.makeEnemyDecision(e,r,s,n)}getAvailableActions(e){var s;const n=[],r=e.cooldowns||{};return console.log("Getting enemy available actions for:",e.name,{cooldowns:r,class:e.class,hasClassAbility:!!this.classAbilities[(s=e.class)==null?void 0:s.toLowerCase()]}),Object.entries(this.actionTypes).forEach(([i,a])=>{(r[i]===0||r[i]===void 0)&&n.push(i)}),e.class&&this.classAbilities[e.class.toLowerCase()]&&(r.special===0||r.special===void 0)&&n.push("special"),console.log("Available actions for enemy:",e.name,n),n}getValidTargets(e,n,r){const s=[],i=r.combatants.filter(a=>a.hp>0);if(i.length===0)return console.log("No alive combatants found"),[];switch(n){case"attack":case"spell":case"special":e.id.startsWith("enemy_")?s.push(...i.filter(a=>!a.id.startsWith("enemy_"))):s.push(...i.filter(a=>a.id.startsWith("enemy_")));break;case"heal":case"item":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_"))):s.push(...i.filter(a=>!a.id.startsWith("enemy_")));break;case"defend":case"environmental":s.push(e);break;case"teamUp":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_")&&a.id!==e.id)):s.push(...i.filter(a=>!a.id.startsWith("enemy_")&&a.id!==e.id));break;default:s.push(...i)}return console.log(`Valid targets for ${e.name} (${n}):`,s.map(a=>a.name)),s}makeEnemyDecision(e,n,r,s){var f;const i=r[Math.floor(Math.random()*r.length)],a=e.hp/e.maxHp,l=(f=e.class)==null?void 0:f.toLowerCase();if(e.level,l==="priest"||l==="cleric"){if(a<.4&&n.includes("spell"))return{action:"spell",target:e.id,spellType:"healing",specialAttack:"Divine Healing",damageType:"healing",attribute:"wisdom"};if(n.includes("spell"))return{action:"spell",target:i.id,spellType:"divine",specialAttack:"Divine Smite",damageType:"radiant",attribute:"wisdom"}}if((l==="wizard"||l==="mage"||l==="sorcerer")&&n.includes("spell")){const m=["fireball","lightning","ice","arcane"],g=m[Math.floor(Math.random()*m.length)];return{action:"spell",target:i.id,spellType:g,specialAttack:`${g.charAt(0).toUpperCase()+g.slice(1)} Spell`,damageType:g==="fireball"?"fire":g==="lightning"?"lightning":g==="ice"?"cold":"arcane",attribute:"intelligence"}}if((l==="boss"||l==="dragon")&&n.includes("special"))return{action:"special",target:i.id,specialAttack:"Devastating Strike",damageType:"physical",attribute:"strength",isBossAttack:!0};if((l==="undead"||l==="skeleton"||l==="zombie")&&n.includes("spell"))return{action:"spell",target:i.id,spellType:"necrotic",specialAttack:"Death Touch",damageType:"necrotic",attribute:"constitution"};if(a<.3){if(n.includes("item"))return{action:"item",target:e.id,itemType:"healing",specialAttack:"Use Healing Potion",damageType:"healing",attribute:"constitution"};if(n.includes("defend"))return{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}}return s.combatants.filter(m=>m.id.startsWith("enemy_")&&m.hp/m.maxHp<.5).length>1&&n.includes("spell")?{action:"spell",target:i.id,spellType:"area",specialAttack:"Area Attack",damageType:"mixed",attribute:"intelligence"}:n.includes("attack")?{action:"attack",target:i.id,specialAttack:"Standard Attack",damageType:"physical",attribute:"strength"}:{action:n[Math.floor(Math.random()*n.length)],target:i.id,specialAttack:"Basic Action",damageType:"physical",attribute:"strength"}}async executeEnemyTurn(e,n){const r=this.chooseEnemyAction(n,e);return console.log("Enemy decision details:",{enemy:n.name,decision:r,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute}),r.target?await this.executeAction(e,n.id,r.action,r.target,{itemType:r.itemType,spellType:r.spellType,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,isBossAttack:r.isBossAttack}):await this.executeAction(e,n.id,"defend",n.id,{specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute})}}const Gn=new tj;function nj(){var Mr;const{partyId:t}=cu(),e=Wn(),r=ni().pathname,[s,i]=A.useState(null),[a,l]=A.useState(null),[u,d]=A.useState(null),[f,m]=A.useState([]),[g,b]=A.useState([]),[k,C]=A.useState({}),[N,_]=A.useState(!0),[x,I]=A.useState(""),[D,F]=A.useState(""),[q,v]=A.useState(!1),[y,S]=A.useState(!1),[P,R]=A.useState(!1),E=A.useRef(!1),T=A.useRef(!1),[me,ye]=A.useState([]),[Se,de]=A.useState("Investigation"),[K,re]=A.useState([]),[ce,Y]=A.useState(!1),[W,J]=A.useState(null),[le,ve]=A.useState(!1),[ke,ae]=A.useState(!1),[pe,Ce]=A.useState(null),[Te,Me]=A.useState(null),[ge]=A.useState(()=>new Jm),[dt]=A.useState(()=>new Au);A.useEffect(()=>{const O=oi(H=>{if(!H){e("/login");return}i(H)});return()=>O()},[e]),A.useEffect(()=>{s&&t&&dn()},[s,t]),A.useEffect(()=>{if(t)try{const O=ob(t,H=>{H&&H.status==="active"&&(r.includes("/combat/")||e(`/combat/${t}`))});return()=>O()}catch(O){console.error("Error subscribing to combat session:",O)}},[t,e,r]),A.useEffect(()=>{if(t)try{const O=Km(tn(_t(Ie,"characters"),Lt("partyId","==",t)),H=>{const ee=H.docs.map(he=>({id:he.id,...he.data()}));console.log("Characters updated in real-time:",ee),m(ee)},H=>{console.error("Error subscribing to character updates:",H)});return()=>O()}catch(O){console.error("Error setting up character subscription:",O)}},[t]),A.useEffect(()=>()=>{R(!1)},[]),A.useEffect(()=>{(a==null?void 0:a.status)==="ready_up"&&(T.current=!1,E.current=!1)},[a==null?void 0:a.status]),A.useEffect(()=>{var O;if(s&&f.length>0&&a){const H=f.find(he=>he.userId===s.uid),ee=(O=a.readyPlayers)==null?void 0:O.includes(s.uid);H&&!ee&&a.status==="ready_up"&&we()}},[f,a,s]);const dn=async()=>{var O,H;try{_(!0),console.log("Loading story and characters for partyId:",t);const[ee,he,j]=await Promise.all([yR(t),Ym(t),ab(t)]);if(console.log("Loaded characters:",he),console.log("Loaded story:",ee),console.log("Loaded party:",j),m(he),d(j),he.length===0&&s)try{const B=(await Xm(s.uid)).find(U=>U.id===t);if(B){b(B.members||[]),console.log("Loaded party members:",B.members);const U={};for(const Ne of B.members)try{const Q=await Yo(Ne);U[Ne]=Q}catch(Q){console.error("Error loading profile for member:",Ne,Q),U[Ne]=null}C(U)}}catch(V){console.error("Error loading party members:",V)}if(ee){if(ee.votingSession&&ee.status==="voting"&&(await zr(ee.id,{votingSession:null}),ee.votingSession=null),ee.storyMessages){const V=ee.storyMessages.filter(B=>{var U,Ne;return!((U=B.content)!=null&&U.includes("tie"))&&!((Ne=B.content)!=null&&Ne.includes("vote again"))&&B.type!=="tie_break"});V.length!==ee.storyMessages.length&&(await zr(ee.id,{storyMessages:V}),ee.storyMessages=V)}if(l(ee),v(((O=ee.readyPlayers)==null?void 0:O.includes(s==null?void 0:s.uid))||!1),ee.status==="storytelling"&&j){const V=_v(j.description||"");ye(V);const B=((H=ee.storyMessages)==null?void 0:H.length)||0;B<5?de("Investigation"):B<15?de("Conflict"):de("Resolution")}}else{const V=await gR(t);l(V)}}catch(ee){console.error("Error in loadStoryAndCharacters:",ee),I("Failed to load campaign story")}finally{_(!1)}};A.useEffect(()=>{if(a!=null&&a.id&&s){const O=wR(a.id,H=>{var ee,he,j;if(H&&(l(H),v(((ee=H.readyPlayers)==null?void 0:ee.includes(s.uid))||!1),H.status==="voting"&&(S(!1),T.current=!1),H.status==="storytelling"&&u)){if(me.length===0){const U=_v(u.description||"");ye(U)}const V=((he=H.storyMessages)==null?void 0:he.length)||0;V<5&&Se!=="Investigation"?de("Investigation"):V>=5&&V<15&&Se!=="Conflict"?de("Conflict"):V>=15&&Se!=="Resolution"&&de("Resolution");const B=(j=H.storyMessages)==null?void 0:j[H.storyMessages.length-1];if(B&&B.role==="assistant"){const U=KR(me,B.content);re(U)}}});return()=>O()}},[a==null?void 0:a.id,s==null?void 0:s.uid,u,me,Se]);const we=async()=>{if(!s)return;if(!f.find(H=>H.userId===s.uid)){e(`/character-creation/${t}`);return}try{await vR(a.id,s.uid),v(!0)}catch{I("Failed to ready up")}},bt=async()=>{var H;if(E.current||T.current||(a==null?void 0:a.status)==="voting"||(a==null?void 0:a.status)==="storytelling"){console.log("Plot generation already in progress or completed");return}const O=(H=a==null?void 0:a.storyMessages)==null?void 0:H.filter(ee=>ee.type==="plot_selection");if(O&&O.length>0){console.log("Plots already exist, skipping generation"),(a==null?void 0:a.status)==="ready_up"&&await zr(a.id,{status:"voting",votingSession:null});return}if(N){console.log("Already loading, skipping request");return}try{if(E.current=!0,T.current=!0,S(!0),_(!0),(a==null?void 0:a.status)!=="ready_up"){console.log("Story is no longer in ready_up status");return}const he=`Generate 3 distinct campaign plot options for this party. For each plot, provide a compelling title and a brief summary (2-3 sentences). Format as:

Plot 1: [Title]
[Summary]

Plot 2: [Title]  
[Summary]

Plot 3: [Title]
[Summary]

Party: ${f.map(V=>`${V.name} - Level ${V.level} ${V.race} ${V.class}. ${V.personality||""}. ${V.backstory||""}`).join(`
`)}`,j=await Yn.generatePlotOptions(f,u);await Id(a.id,{role:"assistant",content:j,type:"plot_selection"}),await zr(a.id,{status:"voting",votingSession:null})}catch(ee){I("Failed to start story generation"),console.error(ee)}finally{E.current=!1,S(!1),_(!1)}},Dr=async O=>{if(!(!s||!u)){if(u.dmId!==s.uid){I("Only the campaign creator can select the plot");return}if((a==null?void 0:a.status)==="storytelling"){console.log("Plot already selected, story in progress");return}try{_(!0);const H=a.storyMessages.find(j=>j.type==="plot_selection"),ee=await Yn.generateCampaignGoal(f,(H==null?void 0:H.content)||"",u);await zr(a.id,{status:"storytelling",currentPlot:O,votingSession:null,campaignMetadata:{...a.campaignMetadata,mainGoal:ee,campaignPhase:yt.INTRODUCTION,plotDetails:(H==null?void 0:H.content)||""}}),await Id(a.id,{role:"assistant",content:`The Dungeon Master has chosen Plot ${O}! Let the story begin...`,type:"plot_selected"});const he=await Yn.generateStoryIntroduction(f,(H==null?void 0:H.content)||"",O,u);await Id(a.id,{role:"assistant",content:he,type:"story_introduction"}),await Pd(a.id,u.dmId)}catch(H){I("Failed to select plot"),console.error(H)}finally{_(!1)}}},ir=async()=>{var O,H;if(!(!D.trim()||!s||!a))try{_(!0);const ee=W||await ER(a.id),he=f.find(B=>B.userId===s.uid);if(!he){I("You need a character to participate in the story");return}const j={context:"campaign_story",storyState:ee,customContext:{description:((O=ee==null?void 0:ee.currentLocation)==null?void 0:O.description)||"A mysterious location",environmentalFeatures:((H=ee==null?void 0:ee.currentLocation)==null?void 0:H.features)||[],npcs:(ee==null?void 0:ee.npcs)||[],circumstances:qe(ee)}},V=ge.validatePlayerAction(D,he,j);if(V.valid&&V.diceResult){Ce(V),ve(!0),V.diceResult.actions&&(Me(V.diceResult),ae(!0));return}await Vt(D,he,ee,V)}catch(ee){I("Failed to send response"),console.error(ee)}finally{_(!1)}},Vt=async(O,H,ee,he)=>{var Q;await addStoryMessageWithMetadata(a.id,{role:"user",content:O,userId:s.uid,characterName:H.name},ee);const j=qR(O,me);j.length>0&&ye(ne=>{const Oe=[...ne];return j.forEach(Ge=>{const Ke=Oe.findIndex(Ft=>Ft.id===Ge.id);Ke!==-1&&(Oe[Ke]=Ge)}),Oe});let V;a.campaignMetadata&&a.campaignMetadata.mainGoal?V=await Yn.generateCampaignContinuation(f,a.campaignMetadata,a.storyMessages,O,u):V=await Yn.generateStoryContinuation(f,a.storyMessages,O,ee,"individual",u);let B=null;he&&he.entities?B=he.entities:B=ge.extractEntities(V,{storyState:ee,partyCharacters:f});const U=ej.updateStoryState(ee,V,O,H.id);if(B&&(U.extractedEntities=B,U.knownEntities||(U.knownEntities={enemies:[],items:[],locations:[],statusEffects:[],questHooks:[],npcs:[]}),Object.keys(B).forEach(ne=>{B[ne]&&B[ne].length>0&&B[ne].forEach(Oe=>{const Ge=U.knownEntities[ne].findIndex(Ke=>Ke.name.toLowerCase()===Oe.name.toLowerCase());Ge===-1?U.knownEntities[ne].push(Oe):U.knownEntities[ne][Ge]={...U.knownEntities[ne][Ge],...Oe}})})),await TR(a.id,U),J(U),await addStoryMessageWithMetadata(a.id,{role:"assistant",content:V,type:"story_continuation",entities:B},U),a.campaignMetadata){const ne=YR(a.campaignMetadata,a.storyMessages),Oe=XR(a.campaignMetadata,a.storyMessages,me),Ge=JR(a.campaignMetadata,a.storyMessages,me),Ke={"campaignMetadata.storyContext":{...a.campaignMetadata.storyContext,...ne},"campaignMetadata.campaignProgress":Oe};Ge&&(Ke["campaignMetadata.campaignPhase"]=Ge),await zr(a.id,Ke)}else console.warn("No campaign metadata found, skipping campaign updates");F("");const Ne=L(V,U,O,he);if(Ne.shouldInitiate){R(!0);const ne={storyContext:V,partyMembers:f,enemies:Et(V,f.length,Ne.enemyType),environmentalFeatures:((Q=U.currentLocation)==null?void 0:Q.features)||[],teamUpOpportunities:Gn.identifyTeamUpOpportunities(f),narrativeElements:Gn.extractNarrativeElements(V),extractedEntities:B},Oe=await createEnhancedCombatSession(t,ne);await zr(a.id,{status:"paused",currentCombat:Oe.id}),setTimeout(()=>{e(`/combat/${t}`)},2e3)}},qe=O=>{var ee,he,j,V;const H=[];if(!O)return H;if(O.currentLocation){const B=O.currentLocation;(ee=B.atmosphere)!=null&&ee.includes("dangerous")&&H.push("in danger"),(he=B.atmosphere)!=null&&he.includes("hostile")&&H.push("in hostile environment"),(j=B.atmosphere)!=null&&j.includes("peaceful")&&H.push("in peaceful environment"),B.lighting==="dark"&&H.push("in darkness"),B.weather==="stormy"&&H.push("in storm")}return((V=O.npcs)==null?void 0:V.length)>0&&O.npcs.filter(U=>U.disposition==="hostile").length>0&&H.push("with hostile NPCs"),H},L=(O,H,ee,he)=>{var Ft,ca,Tt,ua,Lr,Or,Xo,Jo,ar;const j=["combat","battle","fight","attack","enemy","monster"],V=["tension","threat","danger","hostile","aggressive"],B=j.some(An=>O.toLowerCase().includes(An)),U=V.some(An=>O.toLowerCase().includes(An)),Ne=((ca=(Ft=H==null?void 0:H.currentLocation)==null?void 0:Ft.atmosphere)==null?void 0:ca.includes("dangerous"))||((ua=(Tt=H==null?void 0:H.currentLocation)==null?void 0:Tt.atmosphere)==null?void 0:ua.includes("hostile"))||((Or=(Lr=H==null?void 0:H.currentLocation)==null?void 0:Lr.atmosphere)==null?void 0:Or.includes("threatening")),Q=j.some(An=>ee.toLowerCase().includes(An)),ne=(Jo=(Xo=he==null?void 0:he.diceResult)==null?void 0:Xo.actions)==null?void 0:Jo.some(An=>["attack","spell","dodge","parry"].includes(An.action)),Oe=((ar=H==null?void 0:H.npcs)==null?void 0:ar.some(An=>An.disposition==="hostile"))||O.toLowerCase().includes("enemy")||O.toLowerCase().includes("monster")||O.toLowerCase().includes("creature");let Ge="bandit";const Ke=O.toLowerCase();return Ke.includes("goblin")?Ge="goblin":Ke.includes("orc")?Ge="orc":Ke.includes("troll")?Ge="troll":Ke.includes("dragon")?Ge="dragon":Ke.includes("undead")||Ke.includes("skeleton")?Ge="skeleton":Ke.includes("zombie")&&(Ge="zombie"),{shouldInitiate:B||U&&Ne||Q||ne&&Oe,reason:B?"explicit_combat":U&&Ne?"escalating_tension":Q?"player_intent":ne&&Oe?"action_triggered_combat":"none",enemyType:Ge}},te=()=>{ve(!1),Ce(null)},_e=()=>{ae(!1),Me(null)},Re=async()=>{if(!pe)return;const O=f.find(ee=>ee.userId===s.uid);if(!O)return;const H=dt.validateAction(D,O,{context:"campaign_story",validation:pe});Me(H),ae(!0),ve(!1)},st=()=>{ve(!1),Ce(null)},Et=(O,H,ee="bandit")=>{const he={goblin:{name:"Goblin",hp:12,ac:14,level:1,charisma:8},orc:{name:"Orc",hp:30,ac:16,level:3,charisma:12},troll:{name:"Troll",hp:84,ac:15,level:5,charisma:7},dragon:{name:"Dragon",hp:200,ac:19,level:10,charisma:19},bandit:{name:"Bandit",hp:16,ac:12,level:1,charisma:10},skeleton:{name:"Skeleton",hp:13,ac:13,level:1,charisma:5},zombie:{name:"Zombie",hp:22,ac:8,level:1,charisma:3}},j=he[ee]||he.bandit,V=Math.min(H+1,6),B=[];for(let U=0;U<V;U++)B.push({id:`enemy_${U}`,name:`${j.name} ${U+1}`,type:j.name,hp:j.hp+Math.floor(Math.random()*10),maxHp:j.hp+Math.floor(Math.random()*10),ac:j.ac+Math.floor(Math.random()*3),initiative:Math.floor(Math.random()*20)+1,charisma:j.charisma,portrait:"/placeholder-enemy.png"});return B},ze=O=>{if(!O)return O;const H=["enemy","enemies","monster","monsters","bandit","bandits","goblin","goblins","orc","orcs","dragon","dragons","troll","trolls","zombie","zombies","skeleton","skeletons","assassin","assassins","guard","guards","soldier","soldiers","thief","thieves","brigand","brigands","raider","raiders","cultist","cultists","demon","demons","devil","devils","ghost","ghosts","specter","specters","wraith","wraiths","hobgoblin","hobgoblins","bugbear","bugbears","kobold","kobolds","ogre","ogres","giant","giants","beholder","beholders","lich","liches","vampire","vampires","werewolf","werewolves","hag","hags","witch","witches","necromancer","necromancers"],ee=["search","investigate","examine","look around","check","explore","clue","clues","evidence","footprint","footprints","track","tracks","marking","markings","sign","signs","trace","traces","remains","ruin","ruins","artifact","artifacts","scroll","scrolls","book","books","map","maps","diary","journal","note","notes","door","doors","passage","passages","tunnel","tunnels","chamber","chambers","room","rooms","area","areas","mystery","mysterious","hidden","secret","secrets","concealed","strange","unusual","curious","suspicious","odd","peculiar","trap","traps","pressure plate","pressure plates","lever","levers","button","buttons","switch","switches","key","keys","lock","locks"],he=["tavern","inn","shop","market","temple","castle","fortress","tower","dungeon","cave","forest","mountain","river","bridge","gate","wall","street","alley","square","plaza","district","village","town","city","settlement","outpost","camp","crypt","tomb","grave","cemetery","shrine","altar","library","archive","guild","hall","mansion","palace","basement","cellar","attic","rooftop","balcony","courtyard","garden","park","field","meadow","swamp","desert","island"],j=["attack","fight","battle","combat","defend","strike","sword","swords","axe","axes","bow","bows","arrow","arrows","spell","spells","magic","magical","cast","casting","initiative","turn","round","action","movement","charge","retreat","advance","position","formation","shield","armor","helmet","dagger","daggers","mace","maces","fireball","lightning","heal","healing","cure","bless","curse"];let V=O;return[...H,...ee,...he,...j].forEach(U=>{const Ne=new RegExp(`\\b${U}\\b`,"gi");V=V.replace(Ne,`<strong>${U}</strong>`)}),V},it=()=>{var O;return((O=a==null?void 0:a.readyPlayers)==null?void 0:O.length)||0},Pn=()=>u&&u.members&&Array.isArray(u.members)?u.members.length:f.length>0?f.length:g.length>0?g.length:1,Ss=it()===Pn(),ks=()=>{const O=a.storyMessages.filter(H=>H.type==="plot_selection");if(O.length>0){const ee=O[O.length-1].content.split(`
`),he=[];let j=null;const V=new Set;return ee.forEach(B=>{var Ne;const U=B.trim();if(U.startsWith("Plot 1:")||U.startsWith("Plot 2:")||U.startsWith("Plot 3:")){j&&!V.has(j.title)&&(he.push(j),V.add(j.title));const Q=(Ne=U.match(/Plot (\d+):/))==null?void 0:Ne[1],ne=U.replace(/Plot \d+:\s*/,"").trim();V.has(ne)?j=null:j={number:parseInt(Q),title:ne,summary:""}}else j&&U&&!U.startsWith("Party:")&&!U.startsWith("CRITICAL")&&!U.startsWith("Make each")&&(j.summary+=(j.summary?" ":"")+U)}),j&&!V.has(j.title)&&he.push(j),he.slice(0,3)}return[{number:1,title:"Plot 1",summary:"No plot data available"},{number:2,title:"Plot 2",summary:"No plot data available"},{number:3,title:"Plot 3",summary:"No plot data available"}]},Ns=()=>!f.length||!s?f:[...f].sort((O,H)=>O.userId===s.uid?-1:H.userId===s.uid?1:0),bn=()=>{if(!(a!=null&&a.campaignMetadata))return null;const O=a.campaignMetadata;return o.jsxs("div",{className:"bg-purple-900/20 border border-purple-600 rounded-lg p-4 mb-6",children:[o.jsx("h3",{className:"font-bold text-purple-200 mb-2",children:"📖 Campaign Progress"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Session:"})," ",O.sessionNumber]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Phase:"})," ",O.campaignPhase.replace("_"," ")]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Progress:"})," ",O.campaignProgress,"%"]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Goal:"})," ",O.mainGoal?"Set":"Pending"]})]}),O.mainGoal&&o.jsxs("div",{className:"mt-2 text-purple-200",children:[o.jsx("span",{className:"font-semibold",children:"Main Goal:"})," ",O.mainGoal]})]})};return s?N?o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("div",{className:"text-gray-400",children:"Loading campaign story..."})})})}):o.jsxs("div",{className:"fantasy-container py-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:"Campaign Story"}),o.jsx("button",{onClick:()=>e("/dashboard"),className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Back to Dashboard"})]}),x&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded-lg mb-6",children:x}),P&&o.jsx("div",{className:"bg-orange-900/20 border border-orange-600 text-orange-200 px-4 py-3 rounded-lg mb-6",children:o.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[o.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-orange-500"}),o.jsx("span",{className:"font-semibold",children:"⚔️ Combat is being initiated! Redirecting to battle arena..."})]})}),(a==null?void 0:a.status)==="paused"&&(a==null?void 0:a.currentCombat)&&o.jsx("div",{className:"bg-blue-900/20 border border-blue-600 text-blue-200 px-4 py-3 rounded-lg mb-6",children:o.jsx("div",{className:"flex items-center justify-center space-x-2",children:o.jsx("span",{className:"font-semibold",children:"⚔️ Story is paused for combat. Please wait for the battle to conclude."})})}),(a==null?void 0:a.status)==="ready_up"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-4",children:"Ready Up"}),o.jsx("p",{className:"text-gray-300 mb-4",children:"All players must ready up before the story begins"}),o.jsxs("div",{className:"mb-6",children:[o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-2",children:[o.jsxs("div",{className:"text-lg font-semibold text-amber-400",children:[it(),"/",Pn()," Players Ready"]}),o.jsxs("div",{className:"text-sm text-gray-400",children:["(",Math.round(it()/Pn()*100),"%)"]})]}),o.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 max-w-md mx-auto",children:o.jsx("div",{className:"bg-amber-500 h-2 rounded-full transition-all duration-300",style:{width:`${it()/Pn()*100}%`}})})]}),f.length===0&&o.jsx("div",{className:"bg-blue-900/20 border border-blue-600 rounded-lg p-4 mb-4",children:o.jsxs("p",{className:"text-blue-200",children:[o.jsx("strong",{children:"No characters created yet!"})," Players should create their characters first. You can still ready up and start the story, but characters will need to be created before the adventure begins."]})})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.length>0?Ns().map(O=>{var he;const H=(he=a.readyPlayers)==null?void 0:he.includes(O.userId),ee=O.userId===(s==null?void 0:s.uid);return o.jsx("div",{className:`fantasy-card transition-all duration-200 ${H?"bg-green-900/20 border-green-600":"bg-amber-900/20 border-amber-600"}`,children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 bg-gray-600 rounded-full mx-auto mb-2 flex items-center justify-center",children:o.jsx("span",{className:"text-xs text-gray-300",children:"IMG"})}),o.jsx("h3",{className:"font-bold text-gray-100",children:O.name}),o.jsxs("p",{className:"text-sm text-gray-300",children:["Level ",O.level," ",O.race," ",O.class]}),ee&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"text-blue-400 text-xs font-medium",children:"(You)"}),o.jsx("div",{className:"mt-2",children:o.jsx("button",{className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 text-xs px-3 py-1 mt-2",onClick:()=>e(`/character-creation/${t}`),children:"Edit Character"})})]}),o.jsx("div",{className:"mt-2",children:H?o.jsxs("div",{className:"flex items-center justify-center space-x-1 text-green-400 font-semibold",children:[o.jsx("span",{children:"✓"}),o.jsx("span",{children:"Ready"})]}):o.jsxs("div",{className:"flex items-center justify-center space-x-1 text-gray-400",children:[o.jsx("div",{className:"w-3 h-3 border-2 border-gray-500 border-t-gray-300 rounded-full animate-spin"}),o.jsx("span",{children:"Waiting..."})]})})]})},O.id)}):g.map((O,H)=>{var B;const ee=k[O],he=(ee==null?void 0:ee.username)||`Player ${H+1}`,j=(B=a.readyPlayers)==null?void 0:B.includes(O),V=O===(s==null?void 0:s.uid);return o.jsx("div",{className:`fantasy-card transition-all duration-200 ${j?"bg-green-900/20 border-green-600":"bg-amber-900/20 border-amber-600"}`,children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 bg-gray-600 rounded-full mx-auto mb-2 flex items-center justify-center",children:o.jsx("span",{className:"text-xs text-gray-300",children:"IMG"})}),o.jsx("h3",{className:"font-bold text-gray-100",children:he}),o.jsx("p",{className:"text-sm text-gray-300",children:"No character created yet"}),V&&o.jsx("span",{className:"text-blue-400 text-xs font-medium",children:"(You)"}),o.jsx("div",{className:"mt-2",children:j?o.jsxs("div",{className:"flex items-center justify-center space-x-1 text-green-400 font-semibold",children:[o.jsx("span",{children:"✓"}),o.jsx("span",{children:"Ready"})]}):o.jsxs("div",{className:"flex items-center justify-center space-x-1 text-gray-400",children:[o.jsx("div",{className:"w-3 h-3 border-2 border-gray-500 border-t-gray-300 rounded-full animate-spin"}),o.jsx("span",{children:"Waiting..."})]})})]})},O)})}),o.jsxs("div",{className:"text-center",children:[q?o.jsx("div",{className:"text-green-400 font-semibold",children:"You are ready!"}):o.jsx("button",{onClick:we,className:"fantasy-button",children:f.find(O=>O.userId===(s==null?void 0:s.uid))?"Ready Up":"Create Character & Ready Up"}),Ss&&o.jsx("button",{onClick:bt,disabled:N||y||(a==null?void 0:a.status)==="voting",className:"fantasy-button bg-amber-600 hover:bg-amber-700 ml-4",children:N||y?"Generating Story...":"Start Story Generation"})]})]}),(a==null?void 0:a.status)==="voting"&&o.jsxs("div",{className:"space-y-6",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-100",children:"Choose Your Adventure"}),u&&u.dmId===(s==null?void 0:s.uid)?o.jsx("div",{className:"space-y-4",children:o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:ks().map(O=>o.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-2 text-lg",children:O.title}),o.jsx("p",{className:"text-gray-300 text-sm mb-4",children:O.summary}),o.jsx("button",{onClick:()=>Dr(O.number),disabled:N,className:"fantasy-button w-full bg-amber-600 hover:bg-amber-700",children:N?"Selecting...":`Choose Plot ${O.number}`})]},O.number))})}):o.jsxs("div",{className:"bg-blue-900/20 border border-blue-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-blue-200 mb-2",children:"⏳ Waiting for Dungeon Master"}),o.jsx("p",{className:"text-blue-200",children:"The campaign creator is choosing which plot to pursue. Please wait while they make their decision."}),o.jsx("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:ks().map(O=>o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-3",children:[o.jsx("h4",{className:"font-bold text-gray-100 mb-2",children:O.title}),o.jsx("p",{className:"text-gray-300 text-sm",children:O.summary})]},O.number))})]})]}),((a==null?void 0:a.status)==="storytelling"||(a==null?void 0:a.status)==="paused")&&o.jsxs("div",{className:"space-y-6",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-100",children:"Your Adventure"}),(u==null?void 0:u.dmId)===(s==null?void 0:s.uid)&&o.jsxs("div",{className:"bg-purple-900/20 border border-purple-600 rounded-lg p-4",children:[o.jsxs("h3",{className:"font-bold text-purple-200 mb-2",children:["📖 Story Phase: ",Se]}),o.jsxs("p",{className:"text-purple-200 text-sm",children:[Se==="Investigation"&&"Explore, discover clues, and gather information about the situation.",Se==="Conflict"&&"Face challenges, threats, and make difficult choices.",Se==="Resolution"&&"Conclude the story arc and see the consequences of your actions."]})]}),(u==null?void 0:u.dmId)===(s==null?void 0:s.uid)&&me.length>0&&o.jsxs("div",{className:"bg-emerald-900/20 border border-emerald-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-emerald-200 mb-3",children:"🎯 Discovered Objectives"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:GR(me).map(O=>o.jsxs("div",{className:"bg-gray-700 border border-emerald-500 rounded-lg p-3",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-emerald-200 text-sm",children:O.title}),o.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${O.state===Kt.COMPLETED?"bg-green-900 text-green-200":O.state===Kt.IN_PROGRESS?"bg-blue-900 text-blue-200":"bg-yellow-900 text-yellow-200"}`,children:O.state===Kt.COMPLETED?"✓ Complete":O.state===Kt.IN_PROGRESS?"⟳ In Progress":"🔍 Discovered"})]}),o.jsx("p",{className:"text-emerald-200 text-xs",children:O.description})]},O.id))}),K.length>0&&o.jsxs("div",{className:"mt-4 pt-4 border-t border-emerald-500",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-emerald-200 text-sm",children:"💡 Subtle Hints"}),o.jsxs("button",{onClick:()=>Y(!ce),className:"text-emerald-300 hover:text-emerald-100 text-xs",children:[ce?"Hide":"Show"," Hints"]})]}),ce&&o.jsx("div",{className:"space-y-2",children:K.map((O,H)=>o.jsx("div",{className:"text-emerald-200 text-xs italic",children:O},H))})]})]}),o.jsxs("div",{className:"bg-blue-900/20 border border-blue-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-blue-200 mb-2",children:"🎭 Storytelling Guidelines"}),o.jsxs("p",{className:"text-blue-200 text-sm",children:[o.jsx("strong",{children:"Turn-taking:"})," Respond to the story or let someone else speak. Only one person can respond at a time."]})]}),o.jsx("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4 max-h-96 overflow-y-auto",children:a.storyMessages.filter(O=>O.type!=="plot_selection").map(O=>o.jsx("div",{className:"mb-4",children:O.role==="assistant"?o.jsxs("div",{className:"bg-blue-900/20 border border-blue-600 rounded-lg p-3",children:[o.jsx("div",{className:"font-semibold text-blue-200 mb-1",children:"Game Master"}),o.jsx("div",{className:"text-blue-100 whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:ze(O.content)}})]}):o.jsxs("div",{className:"bg-green-900/20 border border-green-600 rounded-lg p-3",children:[o.jsx("div",{className:"font-semibold text-green-200 mb-1",children:O.playerName}),o.jsx("div",{className:"text-green-100",dangerouslySetInnerHTML:{__html:ze(O.content)}})]})},O.id))}),(a==null?void 0:a.status)==="storytelling"&&(a!=null&&a.currentSpeaker)?o.jsxs("div",{className:"space-y-4",children:[a.currentSpeaker.userId===(s==null?void 0:s.uid)?o.jsxs("div",{className:"bg-amber-900/20 border border-amber-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-amber-200 mb-3",children:"How will you respond?"}),o.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[o.jsx("div",{className:"w-10 h-10 bg-amber-600 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-amber-100 font-bold",children:a.currentSpeaker.name.charAt(0)})}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium text-amber-200",children:a.currentSpeaker.name}),o.jsxs("div",{className:"text-sm text-amber-300",children:[a.currentSpeaker.race," ",a.currentSpeaker.class]})]})]}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("input",{type:"text",value:D,onChange:O=>F(O.target.value),placeholder:`What does ${a.currentSpeaker.name} do?`,className:"fantasy-input flex-1",onKeyPress:O=>O.key==="Enter"&&ir()}),o.jsx("button",{onClick:ir,disabled:!D.trim(),className:"fantasy-button",children:"Send"})]})]}):o.jsxs("div",{className:"bg-blue-900/20 border border-blue-600 rounded-lg p-4",children:[o.jsxs("h3",{className:"font-bold text-blue-200 mb-3",children:["Waiting for ",a.currentSpeaker.name," to respond"]}),o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-blue-100 font-bold",children:a.currentSpeaker.name.charAt(0)})}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium text-blue-200",children:a.currentSpeaker.name}),o.jsxs("div",{className:"text-sm text-blue-300",children:[a.currentSpeaker.race," ",a.currentSpeaker.class]})]})]}),o.jsxs("p",{className:"text-blue-200 mt-2",children:[a.currentSpeaker.name," is currently speaking. Please wait for their response."]})]}),(((Mr=a==null?void 0:a.currentSpeaker)==null?void 0:Mr.userId)===(s==null?void 0:s.uid)||(a==null?void 0:a.currentController)===(s==null?void 0:s.uid))&&o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsx("h4",{className:"font-bold text-gray-100 mb-3 text-center",children:"Let someone else speak"}),o.jsx("div",{className:"flex justify-center",children:o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-4xl",children:Ns().map(O=>{var ee,he;const H=O.userId===(s==null?void 0:s.uid);return o.jsxs("button",{onClick:async()=>{await wv(a.id,O),await Pd(a.id,O.userId)},disabled:O.id===((ee=a==null?void 0:a.currentSpeaker)==null?void 0:ee.id),className:`p-4 rounded-lg border-2 transition-colors text-center ${O.id===((he=a==null?void 0:a.currentSpeaker)==null?void 0:he.id)?"border-gray-500 bg-gray-600 text-gray-400 cursor-not-allowed":"border-gray-600 bg-gray-700 hover:border-gray-500 text-gray-200"}`,children:[o.jsxs("div",{className:"font-medium mb-1",children:[o.jsx("span",{children:O.name}),H&&o.jsx("span",{className:"text-blue-400 text-xs font-medium ml-1",children:"(you)"})]}),o.jsxs("div",{className:"text-sm opacity-75",children:[O.race," ",O.class]})]},O.id)})})})]})]}):(u==null?void 0:u.dmId)===(s==null?void 0:s.uid)||(a==null?void 0:a.currentController)===(s==null?void 0:s.uid)?o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3 text-center",children:"Choose who speaks"}),o.jsx("div",{className:"flex justify-center",children:o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-4xl",children:Ns().map(O=>{const H=O.userId===(s==null?void 0:s.uid);return o.jsxs("button",{onClick:async()=>{await wv(a.id,O),await Pd(a.id,O.userId)},className:"p-4 rounded-lg border-2 border-gray-600 bg-gray-700 hover:border-gray-500 text-gray-200 transition-colors text-center",children:[o.jsxs("div",{className:"font-medium mb-1",children:[o.jsx("span",{children:O.name}),H&&o.jsx("span",{className:"text-blue-400 text-xs font-medium ml-1",children:"(you)"})]}),o.jsxs("div",{className:"text-sm opacity-75",children:[O.race," ",O.class]})]},O.id)})})})]}):o.jsxs("div",{className:"bg-blue-900/20 border border-blue-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-blue-200 mb-3",children:a.storyMessages.length>0?"Waiting for next speaker":"Waiting for the story to begin"}),o.jsx("p",{className:"text-blue-200",children:a.storyMessages.length>0?"The Dungeon Master is choosing who will speak next. Please wait.":"The Dungeon Master is choosing who will speak first. Please wait."})]}),(a==null?void 0:a.status)==="storytelling"&&bn()]})]}),le&&pe&&o.jsx(lb,{validation:pe,onClose:te,onProceed:Re,onRevise:st,context:"campaign"}),ke&&Te&&o.jsx(cb,{diceResult:Te,onClose:_e,onProceed:async()=>{if(_e(),pe){const O=f.find(H=>H.userId===s.uid);O&&await Vt(D,O,W,pe)}},context:"campaign"})]}):o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("div",{className:"text-gray-400",children:"Loading..."})})})})}function rj(){var Mr,O,H,ee,he;const{partyId:t}=cu(),e=Wn(),n=ni(),[r,s]=A.useState(null),[i,a]=A.useState(null),[l,u]=A.useState(!0),[d,f]=A.useState([]),[m,g]=A.useState(null),[b,k]=A.useState(null),[C,N]=A.useState(""),[_,x]=A.useState(""),[I,D]=A.useState([]),[F,q]=A.useState([]),[v,y]=A.useState([]),[S,P]=A.useState(!1),[R,E]=A.useState(""),[T,me]=A.useState(""),[ye,Se]=A.useState(!1),[de,K]=A.useState(!1),[re,ce]=A.useState(null),[Y,W]=A.useState(-1),[J,le]=A.useState(null),[ve,ke]=A.useState(!1),[ae,pe]=A.useState(!1),[Ce,Te]=A.useState(new Set),[Me,ge]=A.useState([]),[dt,dn]=A.useState(!1),we=(Mr=n.state)==null?void 0:Mr.isTestCombat,bt=n.state;A.useEffect(()=>{const j=oi(V=>{if(!V){e("/login");return}s(V)});return()=>j()},[e]),A.useEffect(()=>{we&&bt?Dr():t&&ir()},[we,bt,t]),A.useEffect(()=>{if(t&&!we){const j=ob(t,V=>{var B;if(a(V),u(!1),V){Vt(V),q(V.environmentalFeatures||[]),y(V.teamUpOpportunities||[]),Pn();const U=(B=V.combatants)==null?void 0:B[V.currentTurn];U&&U.id.startsWith("enemy_")&&V.combatState==="active"&&V.currentTurn!==Y&&!ye&&!S&&(console.log("Auto-processing enemy turn for:",U.name,"turn:",V.currentTurn),W(V.currentTurn),setTimeout(()=>{Re()},1e3))}});return()=>j()}},[t,Y,ye,S,we]),A.useEffect(()=>{var j,V;if(i&&we&&i.combatState==="active"){const B=(j=i.combatants)==null?void 0:j[i.currentTurn];console.log("Test combat useEffect check:",{currentTurn:i.currentTurn,currentCombatant:B==null?void 0:B.name,isEnemy:B==null?void 0:B.id.startsWith("enemy_"),lastProcessedTurn:Y,processingTurn:ye,isEnemyTurn:S,totalCombatants:(V=i.combatants)==null?void 0:V.length,combatState:i.combatState}),B&&B.id.startsWith("enemy_")&&i.currentTurn!==Y&&!ye&&!S&&(console.log("Auto-processing test enemy turn for:",B.name,"turn:",i.currentTurn),W(i.currentTurn),setTimeout(()=>{Re()},1e3))}},[i==null?void 0:i.currentTurn,we,Y,ye,S]),A.useEffect(()=>{i&&i.combatState==="active"&&Vt(i)},[i==null?void 0:i.currentTurn,i==null?void 0:i.combatState]),A.useEffect(()=>{ae&&Ns()&&(console.log("All party members ready, advancing to next turn"),pe(!1),Te(new Set),st())},[ae,Ce]);const Dr=async()=>{try{u(!0),console.log("Initializing test combat with data:",bt);const j={id:"test_combat_session",partyMembers:bt.partyMembers||[],enemies:bt.enemies||[],storyContext:bt.storyContext||"Test combat environment",combatState:"initialized",currentTurn:0,combatants:[],round:1};if(console.log("Test session created:",{partyMembers:j.partyMembers.length,enemies:j.enemies.length,enemyList:j.enemies}),!j.enemies||j.enemies.length===0){console.error("No enemies provided for test combat!"),a({...j,status:"no_enemies",combatState:"ended"}),u(!1);return}const V=Gn.initializeCombat(j.partyMembers,j.enemies,j.storyContext);console.log("Combat initialized:",{combatants:V.combatants.length,enemies:V.combatants.filter(U=>U.id.startsWith("enemy_")).length,players:V.combatants.filter(U=>!U.id.startsWith("enemy_")).length,turnOrder:V.combatants.map(U=>`${U.name} (${U.initiative})`)});const B={...j,...V,currentTurn:0,combatState:"active"};console.log("Final test session:",{combatants:B.combatants.length,enemies:B.combatants.filter(U=>U.id.startsWith("enemy_")).map(U=>U.name),players:B.combatants.filter(U=>!U.id.startsWith("enemy_")).map(U=>U.name),enemyIds:B.combatants.filter(U=>U.id.startsWith("enemy_")).map(U=>U.id),playerIds:B.combatants.filter(U=>!U.id.startsWith("enemy_")).map(U=>U.id),turnOrder:B.combatants.map((U,Ne)=>`${Ne}: ${U.name} (${U.initiative})`)}),a(B),u(!1),Vt(B),q(B.environmentalFeatures||[]),y(B.teamUpOpportunities||[])}catch(j){console.error("Error initializing test combat:",j),u(!1)}},ir=async()=>{var j,V;if(!t){console.log("No partyId provided, skipping loadCombatData");return}try{u(!0);const B=await xv(t);if(!B){console.log("No combat session found, navigating to story with partyId:",t);try{e(`/campaign-story/${t}`)}catch(Ne){console.error("Navigation error in loadCombatData:",Ne),e("/dashboard")}return}const U=await Ym(t);if(f(U),B.enemies&&B.enemies.length===0&&!we){console.log("No enemies found in regular combat session"),a({...B,status:"no_enemies"});return}console.log("Setting combat session:",{enemies:(j=B.enemies)==null?void 0:j.length,combatants:(V=B.combatants)==null?void 0:V.length,isTestCombat:we}),a(B),Vt(B),q(B.environmentalFeatures||[]),y(B.teamUpOpportunities||[])}catch(B){console.error("Error loading combat data:",B)}finally{u(!1)}},Vt=j=>{var Q;const V=ze(j);if(!V){console.log("No current combatant found for updateAvailableActions");return}console.log("Updating available actions for:",V.name,{class:V.class,cooldowns:V.cooldowns,isEnemy:V.id.startsWith("enemy_")});const B=[],U=V.cooldowns||{};Object.entries(Gn.actionTypes).forEach(([ne,Oe])=>{(U[ne]===0||U[ne]===void 0)&&B.push({type:ne,name:Oe.name,description:Oe.description,priority:Oe.priority,narrativeTemplate:Oe.narrativeTemplate})});const Ne=Gn.classAbilities[(Q=V.class)==null?void 0:Q.toLowerCase()];Ne&&(U.special===0||U.special===void 0)&&B.push({type:"special",name:Ne.name,description:Ne.description,priority:"high",narrativeTemplate:"{character} uses their {ability}!"}),F.length>0&&B.push({type:"environmental",name:"Use Environment",description:"Use the environment to your advantage",priority:"normal",narrativeTemplate:"{character} uses the {environment} to their advantage!"}),v.length>0&&B.push({type:"teamUp",name:"Team Up",description:"Coordinate with another party member",priority:"high",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}),console.log("Generated actions for:",V.name,B),D(B)},qe=j=>{const V=new Date().toLocaleTimeString(),B={id:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:V,round:(i==null?void 0:i.round)||1,turn:(i==null?void 0:i.currentTurn)||0,...j};ge(U=>[...U,B])},L=async()=>{if(i)try{Se(!0),ge([]);const j={...i,combatState:"ready",currentTurn:0,round:1};we?(a(j),Vt(j)):await Ml(t,j),qe({type:"combat_start",description:"Combat is ready to begin!"})}catch(j){console.error("Error starting combat:",j)}finally{Se(!1)}},te=async()=>{if(i)try{Se(!0);const j={...i,combatState:"active"};we?(a(j),Vt(j)):await Ml(t,j),qe({type:"combat_begin",description:"Fight!"}),dn(!0)}catch(j){console.error("Error beginning combat:",j)}finally{Se(!1)}},_e=async(j,V,B={})=>{var Ne;if(!i||i.combatState!=="active"){console.error("Combat not active");return}const U=ze();if(!U){console.error("No current combatant");return}console.log("Executing action:",{actionType:j,targetId:V,currentCombatant:U.name,additionalData:B});try{Se(!0);const Q=i.combatants.find(Oe=>Oe.id===V);qe({type:"action",actor:U.name,action:j,target:(Q==null?void 0:Q.name)||"Unknown",description:`${U.name} uses ${j}${Q?` on ${Q.name}`:""}`});const ne=await Gn.executeAction(i,U.id,j,V,B);if(ne.success){console.log("Action executed successfully:",ne);const Oe={...i,...ne.updatedSession||{},currentTurn:((Ne=ne.updatedSession)==null?void 0:Ne.currentTurn)!==void 0?ne.updatedSession.currentTurn:i.currentTurn};if(ne.damage&&qe({type:"damage",actor:U.name,target:(Q==null?void 0:Q.name)||"Unknown",damage:ne.damage,description:`${U.name} deals ${ne.damage} damage to ${(Q==null?void 0:Q.name)||"Unknown"}`}),ne.healing&&qe({type:"healing",actor:U.name,target:(Q==null?void 0:Q.name)||"Unknown",healing:ne.healing,description:`${U.name} heals ${(Q==null?void 0:Q.name)||"Unknown"} for ${ne.healing} HP`}),ne.statusEffects&&ne.statusEffects.length>0&&ne.statusEffects.forEach(Ke=>{qe({type:"status_effect",actor:U.name,target:(Q==null?void 0:Q.name)||"Unknown",effect:Ke.type,description:`${(Q==null?void 0:Q.name)||"Unknown"} is affected by ${Ke.type}`})}),ne.targetDied&&qe({type:"death",actor:U.name,target:(Q==null?void 0:Q.name)||"Unknown",description:`${(Q==null?void 0:Q.name)||"Unknown"} has been defeated!`}),a(Oe),ne.damage&&Q&&(le({targetId:Q.id,damage:ne.damage,type:"damage"}),ke(!0),setTimeout(()=>ke(!1),2e3)),ne.combatEnded){console.log("Combat ended"),we?e("/test-environment",{state:{...bt,combatResult:ne.combatResult}}):await Et();return}if(Oe.combatants.filter(Ke=>Ke.id.startsWith("enemy_")&&Ke.hp>0).length===0){console.log("No more enemies, ending combat"),we?e("/test-environment",{state:{...bt,combatResult:"victory"}}):await Et();return}setTimeout(()=>{st()},1e3)}else console.error("Action execution failed:",ne.error),N(ne.error||"Action failed")}catch(Q){console.error("Error executing action:",Q),N("Error executing action")}finally{Se(!1)}},Re=async()=>{var V;if(!i||i.combatState!=="active"){console.error("Combat not active");return}const j=ze();if(!j||!j.id.startsWith("enemy_")){console.error("Not an enemy turn");return}console.log("Processing enemy turn for:",j.name);try{Se(!0),P(!0),qe({type:"turn_start",actor:j.name,description:`${j.name}'s turn begins`});const B=Gn.chooseEnemyAction(j,i);if(console.log("Selected enemy action:",B),!B){console.log("No action selected for enemy"),qe({type:"no_action",actor:j.name,description:`${j.name} cannot decide on an action`}),setTimeout(()=>{st()},1e3);return}const U=B.action,Ne=B.target;if(!U){console.log("No action type in selected action"),qe({type:"no_action",actor:j.name,description:`${j.name} has no valid action type`}),setTimeout(()=>{st()},1e3);return}const Q=i.combatants.find(Oe=>Oe.id===Ne);if(!Q&&U!=="defend"){console.log("No target found for enemy action"),qe({type:"no_target",actor:j.name,action:U,description:`${j.name} cannot find a target for ${U}`}),setTimeout(()=>{st()},1e3);return}qe({type:"action",actor:j.name,action:U,target:(Q==null?void 0:Q.name)||"self",description:`${j.name} uses ${U}${Q?` on ${Q.name}`:""}`});const ne=await Gn.executeAction(i,j.id,U,Ne,B);if(ne.success){console.log("Enemy action executed successfully:",ne);const Oe={...i,...ne.updatedSession||{},currentTurn:((V=ne.updatedSession)==null?void 0:V.currentTurn)!==void 0?ne.updatedSession.currentTurn:i.currentTurn};ne.damage&&qe({type:"damage",actor:j.name,target:(Q==null?void 0:Q.name)||"self",damage:ne.damage,description:`${j.name} deals ${ne.damage} damage to ${(Q==null?void 0:Q.name)||"self"}`}),ne.healing&&qe({type:"healing",actor:j.name,target:(Q==null?void 0:Q.name)||"self",healing:ne.healing,description:`${j.name} heals ${(Q==null?void 0:Q.name)||"self"} for ${ne.healing} HP`}),ne.statusEffects&&ne.statusEffects.length>0&&ne.statusEffects.forEach(Ft=>{qe({type:"status_effect",actor:j.name,target:(Q==null?void 0:Q.name)||"self",effect:Ft.type,description:`${(Q==null?void 0:Q.name)||"self"} is affected by ${Ft.type}`})}),ne.targetDied&&qe({type:"death",actor:j.name,target:(Q==null?void 0:Q.name)||"self",description:`${(Q==null?void 0:Q.name)||"self"} has been defeated!`}),a(Oe),ne.damage&&Q&&(le({targetId:Q.id,damage:ne.damage,type:"damage"}),ke(!0),setTimeout(()=>ke(!1),2e3));const Ge=Gn.generateActionNarrative(j,U,Q,B);if(E(`${j.name} uses ${U}!`),me(Ge),ne.combatEnded){console.log("Combat ended"),we?e("/test-environment",{state:{...bt,combatResult:ne.combatResult}}):await Et();return}if(Oe.combatants.filter(Ft=>!Ft.id.startsWith("enemy_")&&Ft.hp>0).length===0){console.log("All players dead, ending combat"),we?e("/test-environment",{state:{...bt,combatResult:"defeat"}}):await Et();return}setTimeout(()=>{st()},1e3)}else console.error("Enemy action execution failed:",ne.error),qe({type:"action_failed",actor:j.name,action:U,description:`${j.name}'s ${U} failed`}),setTimeout(()=>{st()},1e3)}catch(B){console.error("Error processing enemy turn:",B),qe({type:"error",actor:j.name,description:`Error during ${j.name}'s turn`}),setTimeout(()=>{st()},1e3)}finally{Se(!1),P(!1)}},st=async()=>{var Ne;if(!i||i.combatState!=="active"){console.error("Combat not active");return}console.log("Advancing turn from:",i.currentTurn);let j=(i.currentTurn+1)%i.combatants.length,V=0;const B=i.combatants.length;for(;V<B;){const Q=i.combatants[j];if(Q&&Q.hp>0)break;j=(j+1)%i.combatants.length,V++}if(V>=B){console.log("No alive combatants found, ending combat"),we?e("/test-environment",{state:{...bt,combatResult:"draw"}}):await Et();return}if(j===0){const Q={...i,currentTurn:j,round:i.round+1};we?a(Q):await Ml(t,Q)}else{const Q={...i,currentTurn:j};we?a(Q):await Ml(t,Q)}console.log("Turn advanced to:",j,"combatant:",(Ne=i.combatants[j])==null?void 0:Ne.name);const U=we?i:await xv(t);U&&Vt(U)},Et=async()=>{if(!i)return;const j=Gn.generateCombatSummary(i,"victory");if(we)a(V=>({...V,status:"ended",combatState:"ended",summary:j})),e("/test-environment");else{await CR(i.id,{status:"ended",combatState:"ended",summary:j}),await zr(t,{status:"storytelling",currentCombat:null});try{console.log("Ending combat, navigating to story with partyId:",t),e(`/campaign-story/${t}`)}catch(V){console.error("Navigation error in endCombat:",V),e("/dashboard")}}},ze=(j=i)=>{if(!(j!=null&&j.combatants)||j.currentTurn===void 0)return console.log("getCurrentCombatant: No session or combatants"),null;const V=j.combatants[j.currentTurn];return console.log("getCurrentCombatant:",{currentTurn:j.currentTurn,totalCombatants:j.combatants.length,combatant:V==null?void 0:V.name,isEnemy:V==null?void 0:V.id.startsWith("enemy_"),hp:V==null?void 0:V.hp}),V},it=()=>{const j=ze();return j?we?!j.id.startsWith("enemy_"):j.userId===(r==null?void 0:r.uid):!1},Pn=()=>{if(i){if(we){const j=i.combatants.find(V=>!V.id.startsWith("enemy_"));j&&j.hp<=0&&(K(!0),ce(j))}else if(r){const j=i.partyMembers.find(V=>V.userId===r.uid)||i.combatants.find(V=>V.userId===r.uid&&!V.id.startsWith("enemy_"));j&&j.hp<=0&&(K(!0),ce(j))}}},Ss=()=>{e(we?"/dashboard":`/character-creation/${t}`)},ks=()=>{if(we)pe(!1),Te(new Set),st();else{const j=r==null?void 0:r.uid;j&&Te(V=>new Set([...V,j]))}},Ns=()=>{if(we)return!0;if(!(i!=null&&i.partyMembers))return!1;const j=i.partyMembers.filter(B=>B.hp>0);return Ce.size>=j.length};if(!r)return null;if(l)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:"⚔️"}),o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Loading Combat..."}),o.jsx("p",{className:"text-gray-300 mb-6",children:"Preparing the battlefield and gathering combatants..."}),o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto"})]})})});if(!i)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("div",{className:"text-gray-400",children:"No active combat session found."})})})});if((i.status==="no_enemies"||i.enemies&&i.enemies.length===0)&&!we)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:"🕊️"}),o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"No Enemies to Fight"}),o.jsx("p",{className:"text-gray-300 mb-6",children:"There are no enemies present in this area. Combat cannot begin."}),o.jsx("p",{className:"text-gray-400 text-sm",children:"The combat session will end automatically."})]})})});const bn=ze();return de&&re?o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card bg-red-50 border-red-200",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:"💀"}),o.jsx("h1",{className:"text-3xl font-bold text-red-800 mb-4",children:"Character Death"}),o.jsxs("div",{className:"text-xl text-red-700 mb-6",children:[re.name," has fallen in battle..."]}),o.jsxs("div",{className:"bg-white p-6 rounded-lg border border-red-300 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-stone-800 mb-2",children:"Fallen Hero"}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Name:"})," ",re.name]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Class:"})," ",re.class]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Level:"})," ",re.level]}),o.jsxs("p",{className:"text-stone-600",children:[o.jsx("strong",{children:"Final HP:"})," ",re.hp,"/",re.maxHp]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-stone-600",children:"Your character has been defeated. You must create a new character to continue."}),o.jsx("button",{onClick:Ss,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})}):o.jsx("div",{className:"min-h-screen bg-gray-900 text-gray-100 p-4",children:o.jsxs("div",{className:"fantasy-container py-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:"⚔️ Combat Arena"}),o.jsxs("div",{className:"flex space-x-2",children:[i.combatState==="preparation"&&o.jsx("button",{onClick:L,className:"bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"Start Combat"}),i.combatState==="active"&&o.jsx("button",{onClick:Et,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"End Combat"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6",children:[o.jsxs("div",{className:"xl:col-span-1 space-y-6",children:[i.storyContext&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-2",children:"Story Context"}),o.jsx("p",{className:"text-gray-300 italic text-sm",children:i.storyContext})]}),F.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-blue-300 mb-2",children:"🌍 Environmental Features"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:F.map((j,V)=>o.jsx("span",{className:"px-3 py-1 bg-blue-900 text-blue-200 rounded-full text-sm",children:j},V))})]}),v.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-purple-300 mb-2",children:"🤝 Team Up Opportunities"}),o.jsx("div",{className:"space-y-2",children:v.map((j,V)=>o.jsxs("div",{className:"text-purple-200 text-sm",children:[o.jsxs("strong",{children:[j.classes.join(" + "),":"]})," ",j.description]},V))})]}),o.jsxs("div",{className:"fantasy-card h-96",children:[o.jsx("h3",{className:"text-lg font-semibold mb-4 text-yellow-400",children:"Battle Log"}),o.jsx("div",{className:"space-y-2 h-80 overflow-y-auto",children:Me.length===0?o.jsx("p",{className:"text-gray-400 text-sm",children:"No actions recorded yet..."}):Me.map(j=>o.jsxs("div",{className:"text-sm border-l-2 border-gray-600 pl-3 py-1",children:[o.jsxs("div",{className:"flex justify-between items-start mb-1",children:[o.jsx("span",{className:"text-gray-400 text-xs",children:j.timestamp}),o.jsxs("span",{className:"text-blue-400 text-xs",children:["R",j.round," T",j.turn]})]}),o.jsx("div",{className:`${j.type==="damage"?"text-red-400":j.type==="healing"?"text-green-400":j.type==="death"?"text-red-500 font-semibold":j.type==="status_effect"?"text-purple-400":j.type==="action_failed"?"text-orange-400":j.type==="error"?"text-red-500":"text-gray-200"}`,children:j.description})]},j.id))})]})]}),o.jsxs("div",{className:"xl:col-span-2 space-y-6",children:[i.combatState==="active"&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3",children:"🎯 Turn Order"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:i.combatants.map(j=>{var V,B;return o.jsx("div",{className:`p-3 rounded-lg border-2 transition-colors ${j.id===((V=i.combatants[i.currentTurn])==null?void 0:V.id)?"border-amber-500 bg-amber-900/20":"border-gray-600 bg-gray-700"}`,children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"font-medium text-gray-100",children:[j.name,j.id===((B=i.combatants[i.currentTurn])==null?void 0:B.id)&&o.jsx("span",{className:"ml-2 text-amber-400",children:"← Current Turn"})]}),o.jsxs("div",{className:"text-sm text-gray-300",children:["HP: ",j.hp,"/",j.maxHp," | AC: ",j.ac]}),j.statusEffects&&j.statusEffects.length>0&&o.jsx("div",{className:"text-xs text-red-400 mt-1",children:j.statusEffects.map(U=>U.type).join(", ")})]}),o.jsxs("div",{className:"text-sm text-gray-400",children:["Initiative: ",j.initiative]})]})},j.id)})})]}),i.combatState==="active"&&bn&&o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("h3",{className:"font-bold text-gray-100 mb-3",children:["🎲 ",bn.name,"'s Turn"]}),it()?o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-200 mb-2",children:"Available Actions:"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:I.map((j,V)=>o.jsxs("button",{onClick:()=>g(j),className:`p-3 rounded-lg border-2 transition-colors text-left ${(m==null?void 0:m.type)===j.type?"border-amber-500 bg-amber-900/20":"border-gray-600 bg-gray-700 hover:border-gray-500"}`,children:[o.jsx("div",{className:"font-medium text-gray-100",children:j.name}),o.jsx("div",{className:"text-sm text-gray-300",children:j.description}),o.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Priority: ",j.priority]})]},V))})]}),m&&o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-200 mb-2",children:"Select Target:"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:i.enemies.map(j=>o.jsxs("button",{onClick:()=>k(j),className:`p-3 rounded-lg border-2 transition-colors ${(b==null?void 0:b.id)===j.id?"border-red-500 bg-red-900/20":"border-gray-600 bg-gray-700 hover:border-gray-500"}`,children:[o.jsx("div",{className:"font-medium text-gray-100",children:j.name}),o.jsxs("div",{className:"text-sm text-gray-300",children:["HP: ",j.hp,"/",j.maxHp," | AC: ",j.ac]})]},j.id))})]}),m&&b&&o.jsx("div",{className:"text-center",children:o.jsx("button",{onClick:()=>_e(m.type,b.id),disabled:ye,className:"fantasy-button bg-amber-600 hover:bg-amber-700",children:ye?"Executing...":`Execute ${m.name}`})})]}):o.jsxs("div",{className:"bg-blue-900/20 border border-blue-700 rounded-lg p-4",children:[o.jsxs("h4",{className:"font-bold text-blue-300 mb-2",children:["Waiting for ",bn.name," to act"]}),o.jsx("p",{className:"text-blue-200",children:bn.userId===(r==null?void 0:r.uid)?"It's your turn! Please select an action.":"Please wait for the current player to make their move."})]})]}),C&&o.jsxs("div",{className:"fantasy-card bg-green-900/20 border-green-700",children:[o.jsx("h4",{className:"font-bold text-green-300 mb-2",children:"Action Result"}),o.jsx("p",{className:"text-green-200",children:C}),_&&o.jsx("div",{className:"mt-2 p-3 bg-gray-700 border border-green-600 rounded",children:o.jsx("p",{className:"text-gray-200 italic",children:_})})]}),S&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700 animate-pulse",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-red-300 mb-3 text-xl",children:"🦹 Enemy Turn"}),R&&o.jsx("div",{className:"text-red-200 font-bold text-lg mb-3 bg-gray-700 p-3 rounded border border-red-600",children:R}),T&&o.jsx("div",{className:"mt-3 p-4 bg-gray-700 border border-red-600 rounded",children:o.jsx("p",{className:"text-gray-200 italic",children:T})}),o.jsxs("div",{className:"mt-4 flex items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"}),o.jsx("span",{className:"ml-3 text-red-300 font-medium",children:"Enemy is acting..."})]})]})}),ae&&o.jsx("div",{className:"fantasy-card bg-blue-900/20 border-blue-700",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-blue-300 mb-3 text-xl",children:"✅ Enemy Turn Complete"}),o.jsx("p",{className:"text-blue-200 mb-4",children:we?"The enemy has finished their turn. Click 'Confirm' to proceed to the next turn.":"The enemy has finished their turn. All party members must click 'Confirm' to proceed."}),!we&&o.jsxs("div",{className:"mb-4 p-3 bg-gray-700 border border-blue-600 rounded",children:[o.jsxs("p",{className:"text-sm text-blue-200",children:[o.jsx("strong",{children:"Ready to continue:"})," ",Ce.size," / ",((O=i==null?void 0:i.partyMembers)==null?void 0:O.filter(j=>j.hp>0).length)||0," party members"]}),Ce.size>0&&o.jsxs("div",{className:"mt-2 text-xs text-blue-300",children:["Waiting for: ",((he=(ee=(H=i==null?void 0:i.partyMembers)==null?void 0:H.filter(j=>j.hp>0&&!Ce.has(j.userId)))==null?void 0:ee.map(j=>j.name))==null?void 0:he.join(", "))||"None"]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center items-center",children:[o.jsx("button",{onClick:ks,disabled:!we&&Ce.has(r==null?void 0:r.uid),className:`fantasy-button px-8 py-3 text-lg font-semibold ${!we&&Ce.has(r==null?void 0:r.uid)?"bg-green-700 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 shadow-lg"}`,children:!we&&Ce.has(r==null?void 0:r.uid)?"✓ Ready":"Confirm"}),we&&o.jsx("button",{onClick:()=>{pe(!1),Te(new Set),st()},className:"fantasy-button px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white",children:"Skip Confirmation"})]}),o.jsx("div",{className:"mt-4 p-3 bg-yellow-900/20 border border-yellow-600 rounded",children:o.jsxs("p",{className:"text-sm text-yellow-200",children:[o.jsx("strong",{children:"Note:"})," Review the battle log and enemy actions before continuing to the next turn."]})})]})}),ye&&!S&&o.jsx("div",{className:"fantasy-card bg-amber-900/20 border-amber-700",children:o.jsxs("div",{className:"flex items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-amber-500"}),o.jsx("span",{className:"ml-2 text-amber-300 font-medium",children:"Processing turn..."})]})}),(i==null?void 0:i.combatState)==="ready"&&!dt&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-red-300 mb-4 text-2xl",children:"⚔️ Combat Ready!"}),o.jsx("p",{className:"text-red-200 mb-6 text-lg",children:"All combatants are in position. Click 'Fight!' to begin the battle."}),o.jsx("button",{onClick:te,disabled:ye,className:"fantasy-button px-12 py-4 text-xl font-bold bg-red-600 hover:bg-red-700 shadow-lg",children:ye?"Preparing...":"Fight!"})]})})]}),o.jsxs("div",{className:"xl:col-span-1 space-y-6",children:[ve&&J&&o.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 pointer-events-none",children:o.jsxs("div",{className:`animate-bounce text-6xl font-bold px-6 py-4 rounded-lg shadow-lg ${J.type==="healing"?"text-green-400 bg-green-900/80":"text-red-400 bg-red-900/80"}`,children:[J.type==="healing"?"+":"-",J.damage]})}),de&&re&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:"💀"}),o.jsx("h1",{className:"text-3xl font-bold text-red-300 mb-4",children:"Character Death"}),o.jsxs("div",{className:"text-xl text-red-200 mb-6",children:[re.name," has fallen in battle..."]}),o.jsxs("div",{className:"bg-gray-700 p-6 rounded-lg border border-red-600 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Fallen Hero"}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Name:"})," ",re.name]}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Class:"})," ",re.class]}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Level:"})," ",re.level]}),o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"Final HP:"})," ",re.hp,"/",re.maxHp]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-gray-300",children:"Your character has been defeated. You must create a new character to continue."}),o.jsx("button",{onClick:Ss,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})]})]})]})})}function sj(){const t=Wn(),[e,n]=A.useState(null),[r,s]=A.useState([]),[i,a]=A.useState([]),[l,u]=A.useState({}),[d,f]=A.useState({}),[m,g]=A.useState(!1),[b,k]=A.useState(!1),[C,N]=A.useState(""),[_,x]=A.useState({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""});A.useEffect(()=>{const E=oi(T=>{if(!T){t("/login");return}n(T),I(T.uid),D()});return()=>E()},[t]);const I=async E=>{try{const T=await Xm(E);s(T),await F(T)}catch(T){console.error("Error loading parties:",T.message)}},D=async()=>{try{const T=(await mR()).filter(me=>{var ye;return!((ye=me.members)!=null&&ye.includes(e==null?void 0:e.uid))});a(T),await q(T)}catch(E){console.error("Error loading public parties:",E.message)}},F=async E=>{try{const T=new Set;if(E.forEach(de=>{de.members&&Array.isArray(de.members)&&de.members.forEach(K=>T.add(K))}),T.size===0)return;const me=await yv(Array.from(T)),ye={};me.forEach(de=>{ye[de.userId]=de});const Se={};E.forEach(de=>{de.members&&Array.isArray(de.members)&&(Se[de.id]=de.members.map(K=>({userId:K,profile:ye[K]||null})))}),u(Se)}catch(T){console.error("Error loading party member profiles:",T)}},q=async E=>{try{const T=new Set;if(E.forEach(de=>{de.members&&Array.isArray(de.members)&&de.members.forEach(K=>T.add(K))}),T.size===0)return;const me=await yv(Array.from(T)),ye={};me.forEach(de=>{ye[de.userId]=de});const Se={};E.forEach(de=>{de.members&&Array.isArray(de.members)&&(Se[de.id]=de.members.map(K=>({userId:K,profile:ye[K]||null})))}),f(Se)}catch(T){console.error("Error loading public party member profiles:",T)}},v=async E=>{if(E.preventDefault(),!e){console.error("You must be logged in to create a party");return}g(!0);try{const T={..._,inviteCode:Math.random().toString(36).substr(2,8).toUpperCase()},me=await fR(e.uid,T);k(!1),x({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""}),await I(e.uid),await D(),console.log("Party created successfully!")}catch(T){console.error("Error creating party:",T.message)}finally{g(!1)}},y=async()=>{if(!C.trim()){console.error("Please enter an invite code");return}if(!e){console.error("You must be logged in to join a party");return}g(!0);try{const E=await pR(C.toUpperCase());if(!E){console.error("Invalid invite code");return}await vv(E.id,e.uid),N(""),await I(e.uid),await D(),console.log("Successfully joined party!")}catch(E){console.error(E.message||"Error joining party. Please try again.")}finally{g(!1)}},S=async E=>{if(!e){console.error("You must be logged in to join a party");return}g(!0);try{await vv(E,e.uid),await I(e.uid),await D(),console.log("Successfully joined public party!")}catch(T){console.error(T.message||"Error joining party. Please try again.")}finally{g(!1)}},P=E=>{navigator.clipboard.writeText(E),console.log("Invite code copied to clipboard!")},R=async(E,T)=>{if(confirm(`Are you sure you want to disband "${T}"? This action cannot be undone and will remove all party members and characters.`)){g(!0);try{await ib(E,e.uid),await I(e.uid),await D(),console.log("Party disbanded successfully")}catch(me){console.error("Error disbanding party:",me.message)}finally{g(!1)}}};return e?o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:"Party Management"}),o.jsx("button",{onClick:()=>k(!0),className:"fantasy-button",disabled:m,children:"Create New Party"})]}),b&&o.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600 mb-6",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-4",children:"Create New Party"}),o.jsxs("form",{onSubmit:v,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Party Name"}),o.jsx("input",{type:"text",value:_.name,onChange:E=>x(T=>({...T,name:E.target.value})),className:"fantasy-input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Theme"}),o.jsx("textarea",{value:_.description,onChange:E=>x(T=>({...T,description:E.target.value})),className:"fantasy-input",rows:"3",placeholder:"Enter the theme or atmosphere for your campaign..."})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Max Players"}),o.jsx("input",{type:"number",min:"2",max:"10",value:_.maxPlayers,onChange:E=>x(T=>({...T,maxPlayers:parseInt(E.target.value)})),className:"fantasy-input"})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"isPublic",checked:_.isPublic,onChange:E=>x(T=>({...T,isPublic:E.target.checked})),className:"mr-2"}),o.jsx("label",{htmlFor:"isPublic",className:"text-sm font-medium text-gray-200",children:"Public Party (visible to all users)"})]})]}),o.jsxs("div",{className:"flex space-x-4",children:[o.jsx("button",{type:"submit",className:"fantasy-button",disabled:m,children:m?"Creating...":"Create Party"}),o.jsx("button",{type:"button",onClick:()=>k(!1),className:"fantasy-button bg-gray-600 hover:bg-gray-700",disabled:m,children:"Cancel"})]})]})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"My Parties"}),r.length===0?o.jsxs("div",{className:"text-center py-8 text-gray-300",children:[o.jsx("p",{children:"You haven't joined any parties yet."}),o.jsx("p",{children:'Click "Create New Party" to get started!'})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:r.map(E=>{var me,ye;const T=l[E.id]||[];return o.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100",children:E.name}),o.jsxs("span",{className:"text-sm text-gray-300",children:[((me=E.members)==null?void 0:me.length)||1,"/",E.maxPlayers," players"]})]}),E.description&&o.jsxs("div",{className:"mb-4",children:[o.jsx("span",{className:"text-sm font-semibold text-gray-200",children:"Theme: "}),o.jsx("span",{className:"text-gray-300",children:E.description})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-200 mb-2",children:"Party Members:"}),o.jsx("div",{className:"space-y-1",children:T.map((Se,de)=>{var ce;const K=((ce=Se.profile)==null?void 0:ce.username)||`User ${de+1}`,re=Se.userId===E.dmId;return o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-gray-300",children:K}),re&&o.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),Se.userId===(e==null?void 0:e.uid)&&o.jsx("span",{className:"text-blue-400 text-xs font-medium",children:"(You)"})]},Se.userId)})})]}),E.dmId===e.uid&&o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Invite Code"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{type:"text",value:E.inviteCode,readOnly:!0,className:"fantasy-input bg-gray-700"}),o.jsx("button",{onClick:()=>P(E.inviteCode),className:"fantasy-button text-sm",children:"Copy"})]})]}),o.jsx("div",{className:"flex space-x-2",children:(ye=E.members)!=null&&ye.includes(e==null?void 0:e.uid)?o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>t(`/campaign-story/${E.id}`),className:"fantasy-button",children:"Campaign"}),E.dmId===e.uid&&o.jsx("button",{onClick:()=>R(E.id,E.name),className:"fantasy-button bg-red-600 hover:bg-red-700",disabled:m,children:"Disband"})]}):o.jsx("button",{onClick:()=>S(E.id),className:"fantasy-button bg-green-600 hover:bg-green-700",disabled:m,children:"Join Party"})})]},E.id)})})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Public Parties"}),i.length===0?o.jsx("div",{className:"text-center py-8 text-gray-300",children:o.jsx("p",{children:"No public parties available."})}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:i.map(E=>{var me;const T=d[E.id]||[];return o.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100",children:E.name}),o.jsxs("span",{className:"text-sm text-gray-300",children:[((me=E.members)==null?void 0:me.length)||1,"/",E.maxPlayers," players"]})]}),E.description&&o.jsxs("div",{className:"mb-4",children:[o.jsx("span",{className:"text-sm font-semibold text-gray-200",children:"Theme: "}),o.jsx("span",{className:"text-gray-300",children:E.description})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-200 mb-2",children:"Party Members:"}),o.jsx("div",{className:"space-y-1",children:T.map((ye,Se)=>{var re;const de=((re=ye.profile)==null?void 0:re.username)||`User ${Se+1}`,K=ye.userId===E.dmId;return o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-gray-300",children:de}),K&&o.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),ye.userId===(e==null?void 0:e.uid)&&o.jsx("span",{className:"text-blue-400 text-xs font-medium",children:"(You)"})]},ye.userId)})})]}),E.dmId===e.uid&&o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Invite Code"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{type:"text",value:E.inviteCode,readOnly:!0,className:"fantasy-input bg-gray-700"}),o.jsx("button",{onClick:()=>P(E.inviteCode),className:"fantasy-button text-sm",children:"Copy"})]})]}),o.jsx("div",{className:"flex space-x-2",children:o.jsx("button",{onClick:()=>S(E.id),className:"fantasy-button bg-green-600 hover:bg-green-700",disabled:m,children:"Join Party"})})]},E.id)})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Join a Party"}),o.jsx("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("input",{type:"text",placeholder:"Enter invite code",value:C,onChange:E=>N(E.target.value),className:"fantasy-input flex-1",disabled:m}),o.jsx("button",{onClick:y,className:"fantasy-button",disabled:m,children:m?"Joining...":"Join Party"})]})})]})]})}):null}function ij(){return o.jsx(tC,{basename:"/DND-V1",children:o.jsxs("div",{className:"min-h-screen flex flex-col",children:[o.jsx(PR,{}),o.jsx("main",{className:"flex-grow",children:o.jsxs(K1,{children:[o.jsx(Dn,{path:"/",element:o.jsx(jR,{})}),o.jsx(Dn,{path:"/login",element:o.jsx(DR,{})}),o.jsx(Dn,{path:"/register",element:o.jsx(MR,{})}),o.jsx(Dn,{path:"/dashboard",element:o.jsx(OR,{})}),o.jsx(Dn,{path:"/test-environment",element:o.jsx(FR,{})}),o.jsx(Dn,{path:"/campaign-management",element:o.jsx(zR,{})}),o.jsx(Dn,{path:"/character-creation",element:o.jsx(WR,{})}),o.jsx(Dn,{path:"/campaign/:partyId",element:o.jsx(nj,{})}),o.jsx(Dn,{path:"/combat",element:o.jsx(rj,{})}),o.jsx(Dn,{path:"/party-management",element:o.jsx(sj,{})})]})}),o.jsx(AR,{})]})})}Rd.createRoot(document.getElementById("root")).render(o.jsx(Rv.StrictMode,{children:o.jsx(ij,{})}));
