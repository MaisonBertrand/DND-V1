function TE(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function CE(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var dv={exports:{}},Vc={},hv={exports:{}},ye={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ea=Symbol.for("react.element"),SE=Symbol.for("react.portal"),IE=Symbol.for("react.fragment"),NE=Symbol.for("react.strict_mode"),PE=Symbol.for("react.profiler"),kE=Symbol.for("react.provider"),AE=Symbol.for("react.context"),RE=Symbol.for("react.forward_ref"),jE=Symbol.for("react.suspense"),DE=Symbol.for("react.memo"),ME=Symbol.for("react.lazy"),kp=Symbol.iterator;function OE(t){return t===null||typeof t!="object"?null:(t=kp&&t[kp]||t["@@iterator"],typeof t=="function"?t:null)}var fv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},mv=Object.assign,pv={};function Hi(t,e,n){this.props=t,this.context=e,this.refs=pv,this.updater=n||fv}Hi.prototype.isReactComponent={};Hi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Hi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function gv(){}gv.prototype=Hi.prototype;function Gh(t,e,n){this.props=t,this.context=e,this.refs=pv,this.updater=n||fv}var Kh=Gh.prototype=new gv;Kh.constructor=Gh;mv(Kh,Hi.prototype);Kh.isPureReactComponent=!0;var Ap=Array.isArray,yv=Object.prototype.hasOwnProperty,Qh={current:null},vv={key:!0,ref:!0,__self:!0,__source:!0};function wv(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)yv.call(e,r)&&!vv.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var u=Array(l),d=0;d<l;d++)u[d]=arguments[d+2];s.children=u}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Ea,type:t,key:i,ref:o,props:s,_owner:Qh.current}}function LE(t,e){return{$$typeof:Ea,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Yh(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ea}function VE(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Rp=/\/+/g;function Vu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?VE(""+t.key):e.toString(36)}function Nl(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Ea:case SE:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Vu(o,0):r,Ap(s)?(n="",t!=null&&(n=t.replace(Rp,"$&/")+"/"),Nl(s,e,n,"",function(d){return d})):s!=null&&(Yh(s)&&(s=LE(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Rp,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Ap(t))for(var l=0;l<t.length;l++){i=t[l];var u=r+Vu(i,l);o+=Nl(i,e,n,u,s)}else if(u=OE(t),typeof u=="function")for(t=u.call(t),l=0;!(i=t.next()).done;)i=i.value,u=r+Vu(i,l++),o+=Nl(i,e,n,u,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ol(t,e,n){if(t==null)return t;var r=[],s=0;return Nl(t,r,"","",function(i){return e.call(n,i,s++)}),r}function FE(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Gt={current:null},Pl={transition:null},UE={ReactCurrentDispatcher:Gt,ReactCurrentBatchConfig:Pl,ReactCurrentOwner:Qh};function _v(){throw Error("act(...) is not supported in production builds of React.")}ye.Children={map:ol,forEach:function(t,e,n){ol(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ol(t,function(){e++}),e},toArray:function(t){return ol(t,function(e){return e})||[]},only:function(t){if(!Yh(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ye.Component=Hi;ye.Fragment=IE;ye.Profiler=PE;ye.PureComponent=Gh;ye.StrictMode=NE;ye.Suspense=jE;ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=UE;ye.act=_v;ye.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=mv({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Qh.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(u in e)yv.call(e,u)&&!vv.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&l!==void 0?l[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){l=Array(u);for(var d=0;d<u;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Ea,type:t.type,key:s,ref:i,props:r,_owner:o}};ye.createContext=function(t){return t={$$typeof:AE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:kE,_context:t},t.Consumer=t};ye.createElement=wv;ye.createFactory=function(t){var e=wv.bind(null,t);return e.type=t,e};ye.createRef=function(){return{current:null}};ye.forwardRef=function(t){return{$$typeof:RE,render:t}};ye.isValidElement=Yh;ye.lazy=function(t){return{$$typeof:ME,_payload:{_status:-1,_result:t},_init:FE}};ye.memo=function(t,e){return{$$typeof:DE,type:t,compare:e===void 0?null:e}};ye.startTransition=function(t){var e=Pl.transition;Pl.transition={};try{t()}finally{Pl.transition=e}};ye.unstable_act=_v;ye.useCallback=function(t,e){return Gt.current.useCallback(t,e)};ye.useContext=function(t){return Gt.current.useContext(t)};ye.useDebugValue=function(){};ye.useDeferredValue=function(t){return Gt.current.useDeferredValue(t)};ye.useEffect=function(t,e){return Gt.current.useEffect(t,e)};ye.useId=function(){return Gt.current.useId()};ye.useImperativeHandle=function(t,e,n){return Gt.current.useImperativeHandle(t,e,n)};ye.useInsertionEffect=function(t,e){return Gt.current.useInsertionEffect(t,e)};ye.useLayoutEffect=function(t,e){return Gt.current.useLayoutEffect(t,e)};ye.useMemo=function(t,e){return Gt.current.useMemo(t,e)};ye.useReducer=function(t,e,n){return Gt.current.useReducer(t,e,n)};ye.useRef=function(t){return Gt.current.useRef(t)};ye.useState=function(t){return Gt.current.useState(t)};ye.useSyncExternalStore=function(t,e,n){return Gt.current.useSyncExternalStore(t,e,n)};ye.useTransition=function(){return Gt.current.useTransition()};ye.version="18.3.1";hv.exports=ye;var j=hv.exports;const xv=CE(j),$E=TE({__proto__:null,default:xv},[j]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BE=j,zE=Symbol.for("react.element"),WE=Symbol.for("react.fragment"),HE=Object.prototype.hasOwnProperty,qE=BE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,GE={key:!0,ref:!0,__self:!0,__source:!0};function Ev(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)HE.call(e,r)&&!GE.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:zE,type:t,key:i,ref:o,props:s,_owner:qE.current}}Vc.Fragment=WE;Vc.jsx=Ev;Vc.jsxs=Ev;dv.exports=Vc;var c=dv.exports,Cd={},bv={exports:{}},fn={},Tv={exports:{}},Cv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(q,ne){var re=q.length;q.push(ne);e:for(;0<re;){var Ee=re-1>>>1,pe=q[Ee];if(0<s(pe,ne))q[Ee]=ne,q[re]=pe,re=Ee;else break e}}function n(q){return q.length===0?null:q[0]}function r(q){if(q.length===0)return null;var ne=q[0],re=q.pop();if(re!==ne){q[0]=re;e:for(var Ee=0,pe=q.length,Se=pe>>>1;Ee<Se;){var ht=2*(Ee+1)-1,Pe=q[ht],ft=ht+1,Ze=q[ft];if(0>s(Pe,re))ft<pe&&0>s(Ze,Pe)?(q[Ee]=Ze,q[ft]=re,Ee=ft):(q[Ee]=Pe,q[ht]=re,Ee=ht);else if(ft<pe&&0>s(Ze,re))q[Ee]=Ze,q[ft]=re,Ee=ft;else break e}}return ne}function s(q,ne){var re=q.sortIndex-ne.sortIndex;return re!==0?re:q.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var u=[],d=[],f=1,p=null,y=3,T=!1,S=!1,A=!1,k=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function I(q){for(var ne=n(d);ne!==null;){if(ne.callback===null)r(d);else if(ne.startTime<=q)r(d),ne.sortIndex=ne.expirationTime,e(u,ne);else break;ne=n(d)}}function O(q){if(A=!1,I(q),!S)if(n(u)!==null)S=!0,nt(D);else{var ne=n(d);ne!==null&&Ue(O,ne.startTime-q)}}function D(q,ne){S=!1,A&&(A=!1,E(g),g=-1),T=!0;var re=y;try{for(I(ne),p=n(u);p!==null&&(!(p.expirationTime>ne)||q&&!P());){var Ee=p.callback;if(typeof Ee=="function"){p.callback=null,y=p.priorityLevel;var pe=Ee(p.expirationTime<=ne);ne=t.unstable_now(),typeof pe=="function"?p.callback=pe:p===n(u)&&r(u),I(ne)}else r(u);p=n(u)}if(p!==null)var Se=!0;else{var ht=n(d);ht!==null&&Ue(O,ht.startTime-ne),Se=!1}return Se}finally{p=null,y=re,T=!1}}var L=!1,w=null,g=-1,x=5,b=-1;function P(){return!(t.unstable_now()-b<x)}function N(){if(w!==null){var q=t.unstable_now();b=q;var ne=!0;try{ne=w(!0,q)}finally{ne?C():(L=!1,w=null)}}else L=!1}var C;if(typeof _=="function")C=function(){_(N)};else if(typeof MessageChannel<"u"){var fe=new MessageChannel,He=fe.port2;fe.port1.onmessage=N,C=function(){He.postMessage(null)}}else C=function(){k(N,0)};function nt(q){w=q,L||(L=!0,C())}function Ue(q,ne){g=k(function(){q(t.unstable_now())},ne)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(q){q.callback=null},t.unstable_continueExecution=function(){S||T||(S=!0,nt(D))},t.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<q?Math.floor(1e3/q):5},t.unstable_getCurrentPriorityLevel=function(){return y},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(q){switch(y){case 1:case 2:case 3:var ne=3;break;default:ne=y}var re=y;y=ne;try{return q()}finally{y=re}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(q,ne){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var re=y;y=q;try{return ne()}finally{y=re}},t.unstable_scheduleCallback=function(q,ne,re){var Ee=t.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?Ee+re:Ee):re=Ee,q){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=re+pe,q={id:f++,callback:ne,priorityLevel:q,startTime:re,expirationTime:pe,sortIndex:-1},re>Ee?(q.sortIndex=re,e(d,q),n(u)===null&&q===n(d)&&(A?(E(g),g=-1):A=!0,Ue(O,re-Ee))):(q.sortIndex=pe,e(u,q),S||T||(S=!0,nt(D))),q},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(q){var ne=y;return function(){var re=y;y=ne;try{return q.apply(this,arguments)}finally{y=re}}}})(Cv);Tv.exports=Cv;var KE=Tv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QE=j,dn=KE;function W(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Sv=new Set,Go={};function Ws(t,e){ki(t,e),ki(t+"Capture",e)}function ki(t,e){for(Go[t]=e,t=0;t<e.length;t++)Sv.add(e[t])}var pr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Sd=Object.prototype.hasOwnProperty,YE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,jp={},Dp={};function XE(t){return Sd.call(Dp,t)?!0:Sd.call(jp,t)?!1:YE.test(t)?Dp[t]=!0:(jp[t]=!0,!1)}function JE(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function ZE(t,e,n,r){if(e===null||typeof e>"u"||JE(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Kt(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var St={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){St[t]=new Kt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];St[e]=new Kt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){St[t]=new Kt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){St[t]=new Kt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){St[t]=new Kt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){St[t]=new Kt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){St[t]=new Kt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){St[t]=new Kt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){St[t]=new Kt(t,5,!1,t.toLowerCase(),null,!1,!1)});var Xh=/[\-:]([a-z])/g;function Jh(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Xh,Jh);St[e]=new Kt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Xh,Jh);St[e]=new Kt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Xh,Jh);St[e]=new Kt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){St[t]=new Kt(t,1,!1,t.toLowerCase(),null,!1,!1)});St.xlinkHref=new Kt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){St[t]=new Kt(t,1,!1,t.toLowerCase(),null,!0,!0)});function Zh(t,e,n,r){var s=St.hasOwnProperty(e)?St[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ZE(e,n,s,r)&&(n=null),r||s===null?XE(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var br=QE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,al=Symbol.for("react.element"),ai=Symbol.for("react.portal"),li=Symbol.for("react.fragment"),ef=Symbol.for("react.strict_mode"),Id=Symbol.for("react.profiler"),Iv=Symbol.for("react.provider"),Nv=Symbol.for("react.context"),tf=Symbol.for("react.forward_ref"),Nd=Symbol.for("react.suspense"),Pd=Symbol.for("react.suspense_list"),nf=Symbol.for("react.memo"),Dr=Symbol.for("react.lazy"),Pv=Symbol.for("react.offscreen"),Mp=Symbol.iterator;function mo(t){return t===null||typeof t!="object"?null:(t=Mp&&t[Mp]||t["@@iterator"],typeof t=="function"?t:null)}var Ke=Object.assign,Fu;function bo(t){if(Fu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Fu=e&&e[1]||""}return`
`+Fu+t}var Uu=!1;function $u(t,e){if(!t||Uu)return"";Uu=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var u=`
`+s[o].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=o&&0<=l);break}}}finally{Uu=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?bo(t):""}function eb(t){switch(t.tag){case 5:return bo(t.type);case 16:return bo("Lazy");case 13:return bo("Suspense");case 19:return bo("SuspenseList");case 0:case 2:case 15:return t=$u(t.type,!1),t;case 11:return t=$u(t.type.render,!1),t;case 1:return t=$u(t.type,!0),t;default:return""}}function kd(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case li:return"Fragment";case ai:return"Portal";case Id:return"Profiler";case ef:return"StrictMode";case Nd:return"Suspense";case Pd:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Nv:return(t.displayName||"Context")+".Consumer";case Iv:return(t._context.displayName||"Context")+".Provider";case tf:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case nf:return e=t.displayName||null,e!==null?e:kd(t.type)||"Memo";case Dr:e=t._payload,t=t._init;try{return kd(t(e))}catch{}}return null}function tb(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return kd(e);case 8:return e===ef?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function is(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function kv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function nb(t){var e=kv(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function ll(t){t._valueTracker||(t._valueTracker=nb(t))}function Av(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=kv(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Ql(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ad(t,e){var n=e.checked;return Ke({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Op(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=is(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Rv(t,e){e=e.checked,e!=null&&Zh(t,"checked",e,!1)}function Rd(t,e){Rv(t,e);var n=is(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?jd(t,e.type,n):e.hasOwnProperty("defaultValue")&&jd(t,e.type,is(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Lp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function jd(t,e,n){(e!=="number"||Ql(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var To=Array.isArray;function _i(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+is(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Dd(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(W(91));return Ke({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Vp(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(W(92));if(To(n)){if(1<n.length)throw Error(W(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:is(n)}}function jv(t,e){var n=is(e.value),r=is(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Fp(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Dv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Md(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Dv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var cl,Mv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(cl=cl||document.createElement("div"),cl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=cl.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ko(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var jo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rb=["Webkit","ms","Moz","O"];Object.keys(jo).forEach(function(t){rb.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),jo[e]=jo[t]})});function Ov(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||jo.hasOwnProperty(t)&&jo[t]?(""+e).trim():e+"px"}function Lv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Ov(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var sb=Ke({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Od(t,e){if(e){if(sb[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(W(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(W(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(W(61))}if(e.style!=null&&typeof e.style!="object")throw Error(W(62))}}function Ld(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Vd=null;function rf(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Fd=null,xi=null,Ei=null;function Up(t){if(t=Ca(t)){if(typeof Fd!="function")throw Error(W(280));var e=t.stateNode;e&&(e=zc(e),Fd(t.stateNode,t.type,e))}}function Vv(t){xi?Ei?Ei.push(t):Ei=[t]:xi=t}function Fv(){if(xi){var t=xi,e=Ei;if(Ei=xi=null,Up(t),e)for(t=0;t<e.length;t++)Up(e[t])}}function Uv(t,e){return t(e)}function $v(){}var Bu=!1;function Bv(t,e,n){if(Bu)return t(e,n);Bu=!0;try{return Uv(t,e,n)}finally{Bu=!1,(xi!==null||Ei!==null)&&($v(),Fv())}}function Qo(t,e){var n=t.stateNode;if(n===null)return null;var r=zc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(W(231,e,typeof n));return n}var Ud=!1;if(pr)try{var po={};Object.defineProperty(po,"passive",{get:function(){Ud=!0}}),window.addEventListener("test",po,po),window.removeEventListener("test",po,po)}catch{Ud=!1}function ib(t,e,n,r,s,i,o,l,u){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(f){this.onError(f)}}var Do=!1,Yl=null,Xl=!1,$d=null,ob={onError:function(t){Do=!0,Yl=t}};function ab(t,e,n,r,s,i,o,l,u){Do=!1,Yl=null,ib.apply(ob,arguments)}function lb(t,e,n,r,s,i,o,l,u){if(ab.apply(this,arguments),Do){if(Do){var d=Yl;Do=!1,Yl=null}else throw Error(W(198));Xl||(Xl=!0,$d=d)}}function Hs(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function zv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function $p(t){if(Hs(t)!==t)throw Error(W(188))}function cb(t){var e=t.alternate;if(!e){if(e=Hs(t),e===null)throw Error(W(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return $p(s),t;if(i===r)return $p(s),e;i=i.sibling}throw Error(W(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(W(189))}}if(n.alternate!==r)throw Error(W(190))}if(n.tag!==3)throw Error(W(188));return n.stateNode.current===n?t:e}function Wv(t){return t=cb(t),t!==null?Hv(t):null}function Hv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Hv(t);if(e!==null)return e;t=t.sibling}return null}var qv=dn.unstable_scheduleCallback,Bp=dn.unstable_cancelCallback,ub=dn.unstable_shouldYield,db=dn.unstable_requestPaint,tt=dn.unstable_now,hb=dn.unstable_getCurrentPriorityLevel,sf=dn.unstable_ImmediatePriority,Gv=dn.unstable_UserBlockingPriority,Jl=dn.unstable_NormalPriority,fb=dn.unstable_LowPriority,Kv=dn.unstable_IdlePriority,Fc=null,Hn=null;function mb(t){if(Hn&&typeof Hn.onCommitFiberRoot=="function")try{Hn.onCommitFiberRoot(Fc,t,void 0,(t.current.flags&128)===128)}catch{}}var Pn=Math.clz32?Math.clz32:yb,pb=Math.log,gb=Math.LN2;function yb(t){return t>>>=0,t===0?32:31-(pb(t)/gb|0)|0}var ul=64,dl=4194304;function Co(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Zl(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=Co(l):(i&=o,i!==0&&(r=Co(i)))}else o=n&~s,o!==0?r=Co(o):i!==0&&(r=Co(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Pn(e),s=1<<n,r|=t[n],e&=~s;return r}function vb(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wb(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Pn(i),l=1<<o,u=s[o];u===-1?(!(l&n)||l&r)&&(s[o]=vb(l,e)):u<=e&&(t.expiredLanes|=l),i&=~l}}function Bd(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Qv(){var t=ul;return ul<<=1,!(ul&4194240)&&(ul=64),t}function zu(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ba(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Pn(e),t[e]=n}function _b(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Pn(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function of(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Pn(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Ie=0;function Yv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Xv,af,Jv,Zv,e0,zd=!1,hl=[],qr=null,Gr=null,Kr=null,Yo=new Map,Xo=new Map,Or=[],xb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zp(t,e){switch(t){case"focusin":case"focusout":qr=null;break;case"dragenter":case"dragleave":Gr=null;break;case"mouseover":case"mouseout":Kr=null;break;case"pointerover":case"pointerout":Yo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xo.delete(e.pointerId)}}function go(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Ca(e),e!==null&&af(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function Eb(t,e,n,r,s){switch(e){case"focusin":return qr=go(qr,t,e,n,r,s),!0;case"dragenter":return Gr=go(Gr,t,e,n,r,s),!0;case"mouseover":return Kr=go(Kr,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Yo.set(i,go(Yo.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Xo.set(i,go(Xo.get(i)||null,t,e,n,r,s)),!0}return!1}function t0(t){var e=Ts(t.target);if(e!==null){var n=Hs(e);if(n!==null){if(e=n.tag,e===13){if(e=zv(n),e!==null){t.blockedOn=e,e0(t.priority,function(){Jv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function kl(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Wd(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Vd=r,n.target.dispatchEvent(r),Vd=null}else return e=Ca(n),e!==null&&af(e),t.blockedOn=n,!1;e.shift()}return!0}function Wp(t,e,n){kl(t)&&n.delete(e)}function bb(){zd=!1,qr!==null&&kl(qr)&&(qr=null),Gr!==null&&kl(Gr)&&(Gr=null),Kr!==null&&kl(Kr)&&(Kr=null),Yo.forEach(Wp),Xo.forEach(Wp)}function yo(t,e){t.blockedOn===e&&(t.blockedOn=null,zd||(zd=!0,dn.unstable_scheduleCallback(dn.unstable_NormalPriority,bb)))}function Jo(t){function e(s){return yo(s,t)}if(0<hl.length){yo(hl[0],t);for(var n=1;n<hl.length;n++){var r=hl[n];r.blockedOn===t&&(r.blockedOn=null)}}for(qr!==null&&yo(qr,t),Gr!==null&&yo(Gr,t),Kr!==null&&yo(Kr,t),Yo.forEach(e),Xo.forEach(e),n=0;n<Or.length;n++)r=Or[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Or.length&&(n=Or[0],n.blockedOn===null);)t0(n),n.blockedOn===null&&Or.shift()}var bi=br.ReactCurrentBatchConfig,ec=!0;function Tb(t,e,n,r){var s=Ie,i=bi.transition;bi.transition=null;try{Ie=1,lf(t,e,n,r)}finally{Ie=s,bi.transition=i}}function Cb(t,e,n,r){var s=Ie,i=bi.transition;bi.transition=null;try{Ie=4,lf(t,e,n,r)}finally{Ie=s,bi.transition=i}}function lf(t,e,n,r){if(ec){var s=Wd(t,e,n,r);if(s===null)Zu(t,e,r,tc,n),zp(t,r);else if(Eb(s,t,e,n,r))r.stopPropagation();else if(zp(t,r),e&4&&-1<xb.indexOf(t)){for(;s!==null;){var i=Ca(s);if(i!==null&&Xv(i),i=Wd(t,e,n,r),i===null&&Zu(t,e,r,tc,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else Zu(t,e,r,null,n)}}var tc=null;function Wd(t,e,n,r){if(tc=null,t=rf(r),t=Ts(t),t!==null)if(e=Hs(t),e===null)t=null;else if(n=e.tag,n===13){if(t=zv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return tc=t,null}function n0(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hb()){case sf:return 1;case Gv:return 4;case Jl:case fb:return 16;case Kv:return 536870912;default:return 16}default:return 16}}var Br=null,cf=null,Al=null;function r0(){if(Al)return Al;var t,e=cf,n=e.length,r,s="value"in Br?Br.value:Br.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return Al=s.slice(t,1<r?1-r:void 0)}function Rl(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function fl(){return!0}function Hp(){return!1}function mn(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?fl:Hp,this.isPropagationStopped=Hp,this}return Ke(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=fl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=fl)},persist:function(){},isPersistent:fl}),e}var qi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uf=mn(qi),Ta=Ke({},qi,{view:0,detail:0}),Sb=mn(Ta),Wu,Hu,vo,Uc=Ke({},Ta,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:df,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==vo&&(vo&&t.type==="mousemove"?(Wu=t.screenX-vo.screenX,Hu=t.screenY-vo.screenY):Hu=Wu=0,vo=t),Wu)},movementY:function(t){return"movementY"in t?t.movementY:Hu}}),qp=mn(Uc),Ib=Ke({},Uc,{dataTransfer:0}),Nb=mn(Ib),Pb=Ke({},Ta,{relatedTarget:0}),qu=mn(Pb),kb=Ke({},qi,{animationName:0,elapsedTime:0,pseudoElement:0}),Ab=mn(kb),Rb=Ke({},qi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),jb=mn(Rb),Db=Ke({},qi,{data:0}),Gp=mn(Db),Mb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ob={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Lb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vb(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Lb[t])?!!e[t]:!1}function df(){return Vb}var Fb=Ke({},Ta,{key:function(t){if(t.key){var e=Mb[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Rl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Ob[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:df,charCode:function(t){return t.type==="keypress"?Rl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Rl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Ub=mn(Fb),$b=Ke({},Uc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Kp=mn($b),Bb=Ke({},Ta,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:df}),zb=mn(Bb),Wb=Ke({},qi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hb=mn(Wb),qb=Ke({},Uc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Gb=mn(qb),Kb=[9,13,27,32],hf=pr&&"CompositionEvent"in window,Mo=null;pr&&"documentMode"in document&&(Mo=document.documentMode);var Qb=pr&&"TextEvent"in window&&!Mo,s0=pr&&(!hf||Mo&&8<Mo&&11>=Mo),Qp=String.fromCharCode(32),Yp=!1;function i0(t,e){switch(t){case"keyup":return Kb.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function o0(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ci=!1;function Yb(t,e){switch(t){case"compositionend":return o0(e);case"keypress":return e.which!==32?null:(Yp=!0,Qp);case"textInput":return t=e.data,t===Qp&&Yp?null:t;default:return null}}function Xb(t,e){if(ci)return t==="compositionend"||!hf&&i0(t,e)?(t=r0(),Al=cf=Br=null,ci=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return s0&&e.locale!=="ko"?null:e.data;default:return null}}var Jb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Jb[t.type]:e==="textarea"}function a0(t,e,n,r){Vv(r),e=nc(e,"onChange"),0<e.length&&(n=new uf("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Oo=null,Zo=null;function Zb(t){v0(t,0)}function $c(t){var e=hi(t);if(Av(e))return t}function eT(t,e){if(t==="change")return e}var l0=!1;if(pr){var Gu;if(pr){var Ku="oninput"in document;if(!Ku){var Jp=document.createElement("div");Jp.setAttribute("oninput","return;"),Ku=typeof Jp.oninput=="function"}Gu=Ku}else Gu=!1;l0=Gu&&(!document.documentMode||9<document.documentMode)}function Zp(){Oo&&(Oo.detachEvent("onpropertychange",c0),Zo=Oo=null)}function c0(t){if(t.propertyName==="value"&&$c(Zo)){var e=[];a0(e,Zo,t,rf(t)),Bv(Zb,e)}}function tT(t,e,n){t==="focusin"?(Zp(),Oo=e,Zo=n,Oo.attachEvent("onpropertychange",c0)):t==="focusout"&&Zp()}function nT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return $c(Zo)}function rT(t,e){if(t==="click")return $c(e)}function sT(t,e){if(t==="input"||t==="change")return $c(e)}function iT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Rn=typeof Object.is=="function"?Object.is:iT;function ea(t,e){if(Rn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Sd.call(e,s)||!Rn(t[s],e[s]))return!1}return!0}function eg(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function tg(t,e){var n=eg(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=eg(n)}}function u0(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?u0(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function d0(){for(var t=window,e=Ql();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ql(t.document)}return e}function ff(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function oT(t){var e=d0(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&u0(n.ownerDocument.documentElement,n)){if(r!==null&&ff(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=tg(n,i);var o=tg(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var aT=pr&&"documentMode"in document&&11>=document.documentMode,ui=null,Hd=null,Lo=null,qd=!1;function ng(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;qd||ui==null||ui!==Ql(r)||(r=ui,"selectionStart"in r&&ff(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Lo&&ea(Lo,r)||(Lo=r,r=nc(Hd,"onSelect"),0<r.length&&(e=new uf("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=ui)))}function ml(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var di={animationend:ml("Animation","AnimationEnd"),animationiteration:ml("Animation","AnimationIteration"),animationstart:ml("Animation","AnimationStart"),transitionend:ml("Transition","TransitionEnd")},Qu={},h0={};pr&&(h0=document.createElement("div").style,"AnimationEvent"in window||(delete di.animationend.animation,delete di.animationiteration.animation,delete di.animationstart.animation),"TransitionEvent"in window||delete di.transitionend.transition);function Bc(t){if(Qu[t])return Qu[t];if(!di[t])return t;var e=di[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in h0)return Qu[t]=e[n];return t}var f0=Bc("animationend"),m0=Bc("animationiteration"),p0=Bc("animationstart"),g0=Bc("transitionend"),y0=new Map,rg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ds(t,e){y0.set(t,e),Ws(e,[t])}for(var Yu=0;Yu<rg.length;Yu++){var Xu=rg[Yu],lT=Xu.toLowerCase(),cT=Xu[0].toUpperCase()+Xu.slice(1);ds(lT,"on"+cT)}ds(f0,"onAnimationEnd");ds(m0,"onAnimationIteration");ds(p0,"onAnimationStart");ds("dblclick","onDoubleClick");ds("focusin","onFocus");ds("focusout","onBlur");ds(g0,"onTransitionEnd");ki("onMouseEnter",["mouseout","mouseover"]);ki("onMouseLeave",["mouseout","mouseover"]);ki("onPointerEnter",["pointerout","pointerover"]);ki("onPointerLeave",["pointerout","pointerover"]);Ws("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ws("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ws("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ws("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ws("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ws("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var So="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),uT=new Set("cancel close invalid load scroll toggle".split(" ").concat(So));function sg(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,lb(r,e,void 0,t),t.currentTarget=null}function v0(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],u=l.instance,d=l.currentTarget;if(l=l.listener,u!==i&&s.isPropagationStopped())break e;sg(s,l,d),i=u}else for(o=0;o<r.length;o++){if(l=r[o],u=l.instance,d=l.currentTarget,l=l.listener,u!==i&&s.isPropagationStopped())break e;sg(s,l,d),i=u}}}if(Xl)throw t=$d,Xl=!1,$d=null,t}function Le(t,e){var n=e[Xd];n===void 0&&(n=e[Xd]=new Set);var r=t+"__bubble";n.has(r)||(w0(e,t,2,!1),n.add(r))}function Ju(t,e,n){var r=0;e&&(r|=4),w0(n,t,r,e)}var pl="_reactListening"+Math.random().toString(36).slice(2);function ta(t){if(!t[pl]){t[pl]=!0,Sv.forEach(function(n){n!=="selectionchange"&&(uT.has(n)||Ju(n,!1,t),Ju(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[pl]||(e[pl]=!0,Ju("selectionchange",!1,e))}}function w0(t,e,n,r){switch(n0(e)){case 1:var s=Tb;break;case 4:s=Cb;break;default:s=lf}n=s.bind(null,e,n,t),s=void 0,!Ud||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Zu(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var u=o.tag;if((u===3||u===4)&&(u=o.stateNode.containerInfo,u===s||u.nodeType===8&&u.parentNode===s))return;o=o.return}for(;l!==null;){if(o=Ts(l),o===null)return;if(u=o.tag,u===5||u===6){r=i=o;continue e}l=l.parentNode}}r=r.return}Bv(function(){var d=i,f=rf(n),p=[];e:{var y=y0.get(t);if(y!==void 0){var T=uf,S=t;switch(t){case"keypress":if(Rl(n)===0)break e;case"keydown":case"keyup":T=Ub;break;case"focusin":S="focus",T=qu;break;case"focusout":S="blur",T=qu;break;case"beforeblur":case"afterblur":T=qu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":T=qp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":T=Nb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":T=zb;break;case f0:case m0:case p0:T=Ab;break;case g0:T=Hb;break;case"scroll":T=Sb;break;case"wheel":T=Gb;break;case"copy":case"cut":case"paste":T=jb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":T=Kp}var A=(e&4)!==0,k=!A&&t==="scroll",E=A?y!==null?y+"Capture":null:y;A=[];for(var _=d,I;_!==null;){I=_;var O=I.stateNode;if(I.tag===5&&O!==null&&(I=O,E!==null&&(O=Qo(_,E),O!=null&&A.push(na(_,O,I)))),k)break;_=_.return}0<A.length&&(y=new T(y,S,null,n,f),p.push({event:y,listeners:A}))}}if(!(e&7)){e:{if(y=t==="mouseover"||t==="pointerover",T=t==="mouseout"||t==="pointerout",y&&n!==Vd&&(S=n.relatedTarget||n.fromElement)&&(Ts(S)||S[gr]))break e;if((T||y)&&(y=f.window===f?f:(y=f.ownerDocument)?y.defaultView||y.parentWindow:window,T?(S=n.relatedTarget||n.toElement,T=d,S=S?Ts(S):null,S!==null&&(k=Hs(S),S!==k||S.tag!==5&&S.tag!==6)&&(S=null)):(T=null,S=d),T!==S)){if(A=qp,O="onMouseLeave",E="onMouseEnter",_="mouse",(t==="pointerout"||t==="pointerover")&&(A=Kp,O="onPointerLeave",E="onPointerEnter",_="pointer"),k=T==null?y:hi(T),I=S==null?y:hi(S),y=new A(O,_+"leave",T,n,f),y.target=k,y.relatedTarget=I,O=null,Ts(f)===d&&(A=new A(E,_+"enter",S,n,f),A.target=I,A.relatedTarget=k,O=A),k=O,T&&S)t:{for(A=T,E=S,_=0,I=A;I;I=ni(I))_++;for(I=0,O=E;O;O=ni(O))I++;for(;0<_-I;)A=ni(A),_--;for(;0<I-_;)E=ni(E),I--;for(;_--;){if(A===E||E!==null&&A===E.alternate)break t;A=ni(A),E=ni(E)}A=null}else A=null;T!==null&&ig(p,y,T,A,!1),S!==null&&k!==null&&ig(p,k,S,A,!0)}}e:{if(y=d?hi(d):window,T=y.nodeName&&y.nodeName.toLowerCase(),T==="select"||T==="input"&&y.type==="file")var D=eT;else if(Xp(y))if(l0)D=sT;else{D=nT;var L=tT}else(T=y.nodeName)&&T.toLowerCase()==="input"&&(y.type==="checkbox"||y.type==="radio")&&(D=rT);if(D&&(D=D(t,d))){a0(p,D,n,f);break e}L&&L(t,y,d),t==="focusout"&&(L=y._wrapperState)&&L.controlled&&y.type==="number"&&jd(y,"number",y.value)}switch(L=d?hi(d):window,t){case"focusin":(Xp(L)||L.contentEditable==="true")&&(ui=L,Hd=d,Lo=null);break;case"focusout":Lo=Hd=ui=null;break;case"mousedown":qd=!0;break;case"contextmenu":case"mouseup":case"dragend":qd=!1,ng(p,n,f);break;case"selectionchange":if(aT)break;case"keydown":case"keyup":ng(p,n,f)}var w;if(hf)e:{switch(t){case"compositionstart":var g="onCompositionStart";break e;case"compositionend":g="onCompositionEnd";break e;case"compositionupdate":g="onCompositionUpdate";break e}g=void 0}else ci?i0(t,n)&&(g="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(g="onCompositionStart");g&&(s0&&n.locale!=="ko"&&(ci||g!=="onCompositionStart"?g==="onCompositionEnd"&&ci&&(w=r0()):(Br=f,cf="value"in Br?Br.value:Br.textContent,ci=!0)),L=nc(d,g),0<L.length&&(g=new Gp(g,t,null,n,f),p.push({event:g,listeners:L}),w?g.data=w:(w=o0(n),w!==null&&(g.data=w)))),(w=Qb?Yb(t,n):Xb(t,n))&&(d=nc(d,"onBeforeInput"),0<d.length&&(f=new Gp("onBeforeInput","beforeinput",null,n,f),p.push({event:f,listeners:d}),f.data=w))}v0(p,e)})}function na(t,e,n){return{instance:t,listener:e,currentTarget:n}}function nc(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Qo(t,n),i!=null&&r.unshift(na(t,i,s)),i=Qo(t,e),i!=null&&r.push(na(t,i,s))),t=t.return}return r}function ni(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function ig(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var l=n,u=l.alternate,d=l.stateNode;if(u!==null&&u===r)break;l.tag===5&&d!==null&&(l=d,s?(u=Qo(n,i),u!=null&&o.unshift(na(n,u,l))):s||(u=Qo(n,i),u!=null&&o.push(na(n,u,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var dT=/\r\n?/g,hT=/\u0000|\uFFFD/g;function og(t){return(typeof t=="string"?t:""+t).replace(dT,`
`).replace(hT,"")}function gl(t,e,n){if(e=og(e),og(t)!==e&&n)throw Error(W(425))}function rc(){}var Gd=null,Kd=null;function Qd(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Yd=typeof setTimeout=="function"?setTimeout:void 0,fT=typeof clearTimeout=="function"?clearTimeout:void 0,ag=typeof Promise=="function"?Promise:void 0,mT=typeof queueMicrotask=="function"?queueMicrotask:typeof ag<"u"?function(t){return ag.resolve(null).then(t).catch(pT)}:Yd;function pT(t){setTimeout(function(){throw t})}function ed(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Jo(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Jo(e)}function Qr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function lg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Gi=Math.random().toString(36).slice(2),Bn="__reactFiber$"+Gi,ra="__reactProps$"+Gi,gr="__reactContainer$"+Gi,Xd="__reactEvents$"+Gi,gT="__reactListeners$"+Gi,yT="__reactHandles$"+Gi;function Ts(t){var e=t[Bn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[gr]||n[Bn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=lg(t);t!==null;){if(n=t[Bn])return n;t=lg(t)}return e}t=n,n=t.parentNode}return null}function Ca(t){return t=t[Bn]||t[gr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function hi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(W(33))}function zc(t){return t[ra]||null}var Jd=[],fi=-1;function hs(t){return{current:t}}function Fe(t){0>fi||(t.current=Jd[fi],Jd[fi]=null,fi--)}function De(t,e){fi++,Jd[fi]=t.current,t.current=e}var os={},Ft=hs(os),en=hs(!1),Rs=os;function Ai(t,e){var n=t.type.contextTypes;if(!n)return os;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function tn(t){return t=t.childContextTypes,t!=null}function sc(){Fe(en),Fe(Ft)}function cg(t,e,n){if(Ft.current!==os)throw Error(W(168));De(Ft,e),De(en,n)}function _0(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(W(108,tb(t)||"Unknown",s));return Ke({},n,r)}function ic(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||os,Rs=Ft.current,De(Ft,t),De(en,en.current),!0}function ug(t,e,n){var r=t.stateNode;if(!r)throw Error(W(169));n?(t=_0(t,e,Rs),r.__reactInternalMemoizedMergedChildContext=t,Fe(en),Fe(Ft),De(Ft,t)):Fe(en),De(en,n)}var ir=null,Wc=!1,td=!1;function x0(t){ir===null?ir=[t]:ir.push(t)}function vT(t){Wc=!0,x0(t)}function fs(){if(!td&&ir!==null){td=!0;var t=0,e=Ie;try{var n=ir;for(Ie=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}ir=null,Wc=!1}catch(s){throw ir!==null&&(ir=ir.slice(t+1)),qv(sf,fs),s}finally{Ie=e,td=!1}}return null}var mi=[],pi=0,oc=null,ac=0,pn=[],gn=0,js=null,ar=1,lr="";function xs(t,e){mi[pi++]=ac,mi[pi++]=oc,oc=t,ac=e}function E0(t,e,n){pn[gn++]=ar,pn[gn++]=lr,pn[gn++]=js,js=t;var r=ar;t=lr;var s=32-Pn(r)-1;r&=~(1<<s),n+=1;var i=32-Pn(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,ar=1<<32-Pn(e)+s|n<<s|r,lr=i+t}else ar=1<<i|n<<s|r,lr=t}function mf(t){t.return!==null&&(xs(t,1),E0(t,1,0))}function pf(t){for(;t===oc;)oc=mi[--pi],mi[pi]=null,ac=mi[--pi],mi[pi]=null;for(;t===js;)js=pn[--gn],pn[gn]=null,lr=pn[--gn],pn[gn]=null,ar=pn[--gn],pn[gn]=null}var un=null,ln=null,We=!1,Nn=null;function b0(t,e){var n=yn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function dg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,un=t,ln=Qr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,un=t,ln=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=js!==null?{id:ar,overflow:lr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=yn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,un=t,ln=null,!0):!1;default:return!1}}function Zd(t){return(t.mode&1)!==0&&(t.flags&128)===0}function eh(t){if(We){var e=ln;if(e){var n=e;if(!dg(t,e)){if(Zd(t))throw Error(W(418));e=Qr(n.nextSibling);var r=un;e&&dg(t,e)?b0(r,n):(t.flags=t.flags&-4097|2,We=!1,un=t)}}else{if(Zd(t))throw Error(W(418));t.flags=t.flags&-4097|2,We=!1,un=t}}}function hg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;un=t}function yl(t){if(t!==un)return!1;if(!We)return hg(t),We=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Qd(t.type,t.memoizedProps)),e&&(e=ln)){if(Zd(t))throw T0(),Error(W(418));for(;e;)b0(t,e),e=Qr(e.nextSibling)}if(hg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(W(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ln=Qr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ln=null}}else ln=un?Qr(t.stateNode.nextSibling):null;return!0}function T0(){for(var t=ln;t;)t=Qr(t.nextSibling)}function Ri(){ln=un=null,We=!1}function gf(t){Nn===null?Nn=[t]:Nn.push(t)}var wT=br.ReactCurrentBatchConfig;function wo(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(W(309));var r=n.stateNode}if(!r)throw Error(W(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(W(284));if(!n._owner)throw Error(W(290,t))}return t}function vl(t,e){throw t=Object.prototype.toString.call(e),Error(W(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function fg(t){var e=t._init;return e(t._payload)}function C0(t){function e(E,_){if(t){var I=E.deletions;I===null?(E.deletions=[_],E.flags|=16):I.push(_)}}function n(E,_){if(!t)return null;for(;_!==null;)e(E,_),_=_.sibling;return null}function r(E,_){for(E=new Map;_!==null;)_.key!==null?E.set(_.key,_):E.set(_.index,_),_=_.sibling;return E}function s(E,_){return E=Zr(E,_),E.index=0,E.sibling=null,E}function i(E,_,I){return E.index=I,t?(I=E.alternate,I!==null?(I=I.index,I<_?(E.flags|=2,_):I):(E.flags|=2,_)):(E.flags|=1048576,_)}function o(E){return t&&E.alternate===null&&(E.flags|=2),E}function l(E,_,I,O){return _===null||_.tag!==6?(_=ld(I,E.mode,O),_.return=E,_):(_=s(_,I),_.return=E,_)}function u(E,_,I,O){var D=I.type;return D===li?f(E,_,I.props.children,O,I.key):_!==null&&(_.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===Dr&&fg(D)===_.type)?(O=s(_,I.props),O.ref=wo(E,_,I),O.return=E,O):(O=Fl(I.type,I.key,I.props,null,E.mode,O),O.ref=wo(E,_,I),O.return=E,O)}function d(E,_,I,O){return _===null||_.tag!==4||_.stateNode.containerInfo!==I.containerInfo||_.stateNode.implementation!==I.implementation?(_=cd(I,E.mode,O),_.return=E,_):(_=s(_,I.children||[]),_.return=E,_)}function f(E,_,I,O,D){return _===null||_.tag!==7?(_=ks(I,E.mode,O,D),_.return=E,_):(_=s(_,I),_.return=E,_)}function p(E,_,I){if(typeof _=="string"&&_!==""||typeof _=="number")return _=ld(""+_,E.mode,I),_.return=E,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case al:return I=Fl(_.type,_.key,_.props,null,E.mode,I),I.ref=wo(E,null,_),I.return=E,I;case ai:return _=cd(_,E.mode,I),_.return=E,_;case Dr:var O=_._init;return p(E,O(_._payload),I)}if(To(_)||mo(_))return _=ks(_,E.mode,I,null),_.return=E,_;vl(E,_)}return null}function y(E,_,I,O){var D=_!==null?_.key:null;if(typeof I=="string"&&I!==""||typeof I=="number")return D!==null?null:l(E,_,""+I,O);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case al:return I.key===D?u(E,_,I,O):null;case ai:return I.key===D?d(E,_,I,O):null;case Dr:return D=I._init,y(E,_,D(I._payload),O)}if(To(I)||mo(I))return D!==null?null:f(E,_,I,O,null);vl(E,I)}return null}function T(E,_,I,O,D){if(typeof O=="string"&&O!==""||typeof O=="number")return E=E.get(I)||null,l(_,E,""+O,D);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case al:return E=E.get(O.key===null?I:O.key)||null,u(_,E,O,D);case ai:return E=E.get(O.key===null?I:O.key)||null,d(_,E,O,D);case Dr:var L=O._init;return T(E,_,I,L(O._payload),D)}if(To(O)||mo(O))return E=E.get(I)||null,f(_,E,O,D,null);vl(_,O)}return null}function S(E,_,I,O){for(var D=null,L=null,w=_,g=_=0,x=null;w!==null&&g<I.length;g++){w.index>g?(x=w,w=null):x=w.sibling;var b=y(E,w,I[g],O);if(b===null){w===null&&(w=x);break}t&&w&&b.alternate===null&&e(E,w),_=i(b,_,g),L===null?D=b:L.sibling=b,L=b,w=x}if(g===I.length)return n(E,w),We&&xs(E,g),D;if(w===null){for(;g<I.length;g++)w=p(E,I[g],O),w!==null&&(_=i(w,_,g),L===null?D=w:L.sibling=w,L=w);return We&&xs(E,g),D}for(w=r(E,w);g<I.length;g++)x=T(w,E,g,I[g],O),x!==null&&(t&&x.alternate!==null&&w.delete(x.key===null?g:x.key),_=i(x,_,g),L===null?D=x:L.sibling=x,L=x);return t&&w.forEach(function(P){return e(E,P)}),We&&xs(E,g),D}function A(E,_,I,O){var D=mo(I);if(typeof D!="function")throw Error(W(150));if(I=D.call(I),I==null)throw Error(W(151));for(var L=D=null,w=_,g=_=0,x=null,b=I.next();w!==null&&!b.done;g++,b=I.next()){w.index>g?(x=w,w=null):x=w.sibling;var P=y(E,w,b.value,O);if(P===null){w===null&&(w=x);break}t&&w&&P.alternate===null&&e(E,w),_=i(P,_,g),L===null?D=P:L.sibling=P,L=P,w=x}if(b.done)return n(E,w),We&&xs(E,g),D;if(w===null){for(;!b.done;g++,b=I.next())b=p(E,b.value,O),b!==null&&(_=i(b,_,g),L===null?D=b:L.sibling=b,L=b);return We&&xs(E,g),D}for(w=r(E,w);!b.done;g++,b=I.next())b=T(w,E,g,b.value,O),b!==null&&(t&&b.alternate!==null&&w.delete(b.key===null?g:b.key),_=i(b,_,g),L===null?D=b:L.sibling=b,L=b);return t&&w.forEach(function(N){return e(E,N)}),We&&xs(E,g),D}function k(E,_,I,O){if(typeof I=="object"&&I!==null&&I.type===li&&I.key===null&&(I=I.props.children),typeof I=="object"&&I!==null){switch(I.$$typeof){case al:e:{for(var D=I.key,L=_;L!==null;){if(L.key===D){if(D=I.type,D===li){if(L.tag===7){n(E,L.sibling),_=s(L,I.props.children),_.return=E,E=_;break e}}else if(L.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===Dr&&fg(D)===L.type){n(E,L.sibling),_=s(L,I.props),_.ref=wo(E,L,I),_.return=E,E=_;break e}n(E,L);break}else e(E,L);L=L.sibling}I.type===li?(_=ks(I.props.children,E.mode,O,I.key),_.return=E,E=_):(O=Fl(I.type,I.key,I.props,null,E.mode,O),O.ref=wo(E,_,I),O.return=E,E=O)}return o(E);case ai:e:{for(L=I.key;_!==null;){if(_.key===L)if(_.tag===4&&_.stateNode.containerInfo===I.containerInfo&&_.stateNode.implementation===I.implementation){n(E,_.sibling),_=s(_,I.children||[]),_.return=E,E=_;break e}else{n(E,_);break}else e(E,_);_=_.sibling}_=cd(I,E.mode,O),_.return=E,E=_}return o(E);case Dr:return L=I._init,k(E,_,L(I._payload),O)}if(To(I))return S(E,_,I,O);if(mo(I))return A(E,_,I,O);vl(E,I)}return typeof I=="string"&&I!==""||typeof I=="number"?(I=""+I,_!==null&&_.tag===6?(n(E,_.sibling),_=s(_,I),_.return=E,E=_):(n(E,_),_=ld(I,E.mode,O),_.return=E,E=_),o(E)):n(E,_)}return k}var ji=C0(!0),S0=C0(!1),lc=hs(null),cc=null,gi=null,yf=null;function vf(){yf=gi=cc=null}function wf(t){var e=lc.current;Fe(lc),t._currentValue=e}function th(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Ti(t,e){cc=t,yf=gi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Zt=!0),t.firstContext=null)}function _n(t){var e=t._currentValue;if(yf!==t)if(t={context:t,memoizedValue:e,next:null},gi===null){if(cc===null)throw Error(W(308));gi=t,cc.dependencies={lanes:0,firstContext:t}}else gi=gi.next=t;return e}var Cs=null;function _f(t){Cs===null?Cs=[t]:Cs.push(t)}function I0(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,_f(e)):(n.next=s.next,s.next=n),e.interleaved=n,yr(t,r)}function yr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Mr=!1;function xf(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function N0(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function hr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Yr(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,be&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,yr(t,n)}return s=r.interleaved,s===null?(e.next=e,_f(r)):(e.next=s.next,s.next=e),r.interleaved=e,yr(t,n)}function jl(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,of(t,n)}}function mg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function uc(t,e,n,r){var s=t.updateQueue;Mr=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var u=l,d=u.next;u.next=null,o===null?i=d:o.next=d,o=u;var f=t.alternate;f!==null&&(f=f.updateQueue,l=f.lastBaseUpdate,l!==o&&(l===null?f.firstBaseUpdate=d:l.next=d,f.lastBaseUpdate=u))}if(i!==null){var p=s.baseState;o=0,f=d=u=null,l=i;do{var y=l.lane,T=l.eventTime;if((r&y)===y){f!==null&&(f=f.next={eventTime:T,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var S=t,A=l;switch(y=e,T=n,A.tag){case 1:if(S=A.payload,typeof S=="function"){p=S.call(T,p,y);break e}p=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=A.payload,y=typeof S=="function"?S.call(T,p,y):S,y==null)break e;p=Ke({},p,y);break e;case 2:Mr=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,y=s.effects,y===null?s.effects=[l]:y.push(l))}else T={eventTime:T,lane:y,tag:l.tag,payload:l.payload,callback:l.callback,next:null},f===null?(d=f=T,u=p):f=f.next=T,o|=y;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;y=l,l=y.next,y.next=null,s.lastBaseUpdate=y,s.shared.pending=null}}while(1);if(f===null&&(u=p),s.baseState=u,s.firstBaseUpdate=d,s.lastBaseUpdate=f,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Ms|=o,t.lanes=o,t.memoizedState=p}}function pg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(W(191,s));s.call(r)}}}var Sa={},qn=hs(Sa),sa=hs(Sa),ia=hs(Sa);function Ss(t){if(t===Sa)throw Error(W(174));return t}function Ef(t,e){switch(De(ia,e),De(sa,t),De(qn,Sa),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Md(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Md(e,t)}Fe(qn),De(qn,e)}function Di(){Fe(qn),Fe(sa),Fe(ia)}function P0(t){Ss(ia.current);var e=Ss(qn.current),n=Md(e,t.type);e!==n&&(De(sa,t),De(qn,n))}function bf(t){sa.current===t&&(Fe(qn),Fe(sa))}var qe=hs(0);function dc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var nd=[];function Tf(){for(var t=0;t<nd.length;t++)nd[t]._workInProgressVersionPrimary=null;nd.length=0}var Dl=br.ReactCurrentDispatcher,rd=br.ReactCurrentBatchConfig,Ds=0,Ge=null,ct=null,pt=null,hc=!1,Vo=!1,oa=0,_T=0;function Rt(){throw Error(W(321))}function Cf(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Rn(t[n],e[n]))return!1;return!0}function Sf(t,e,n,r,s,i){if(Ds=i,Ge=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Dl.current=t===null||t.memoizedState===null?TT:CT,t=n(r,s),Vo){i=0;do{if(Vo=!1,oa=0,25<=i)throw Error(W(301));i+=1,pt=ct=null,e.updateQueue=null,Dl.current=ST,t=n(r,s)}while(Vo)}if(Dl.current=fc,e=ct!==null&&ct.next!==null,Ds=0,pt=ct=Ge=null,hc=!1,e)throw Error(W(300));return t}function If(){var t=oa!==0;return oa=0,t}function $n(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pt===null?Ge.memoizedState=pt=t:pt=pt.next=t,pt}function xn(){if(ct===null){var t=Ge.alternate;t=t!==null?t.memoizedState:null}else t=ct.next;var e=pt===null?Ge.memoizedState:pt.next;if(e!==null)pt=e,ct=t;else{if(t===null)throw Error(W(310));ct=t,t={memoizedState:ct.memoizedState,baseState:ct.baseState,baseQueue:ct.baseQueue,queue:ct.queue,next:null},pt===null?Ge.memoizedState=pt=t:pt=pt.next=t}return pt}function aa(t,e){return typeof e=="function"?e(t):e}function sd(t){var e=xn(),n=e.queue;if(n===null)throw Error(W(311));n.lastRenderedReducer=t;var r=ct,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,u=null,d=i;do{var f=d.lane;if((Ds&f)===f)u!==null&&(u=u.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var p={lane:f,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};u===null?(l=u=p,o=r):u=u.next=p,Ge.lanes|=f,Ms|=f}d=d.next}while(d!==null&&d!==i);u===null?o=r:u.next=l,Rn(r,e.memoizedState)||(Zt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Ge.lanes|=i,Ms|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function id(t){var e=xn(),n=e.queue;if(n===null)throw Error(W(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);Rn(i,e.memoizedState)||(Zt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function k0(){}function A0(t,e){var n=Ge,r=xn(),s=e(),i=!Rn(r.memoizedState,s);if(i&&(r.memoizedState=s,Zt=!0),r=r.queue,Nf(D0.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||pt!==null&&pt.memoizedState.tag&1){if(n.flags|=2048,la(9,j0.bind(null,n,r,s,e),void 0,null),gt===null)throw Error(W(349));Ds&30||R0(n,e,s)}return s}function R0(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Ge.updateQueue,e===null?(e={lastEffect:null,stores:null},Ge.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function j0(t,e,n,r){e.value=n,e.getSnapshot=r,M0(e)&&O0(t)}function D0(t,e,n){return n(function(){M0(e)&&O0(t)})}function M0(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Rn(t,n)}catch{return!0}}function O0(t){var e=yr(t,1);e!==null&&kn(e,t,1,-1)}function gg(t){var e=$n();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:aa,lastRenderedState:t},e.queue=t,t=t.dispatch=bT.bind(null,Ge,t),[e.memoizedState,t]}function la(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Ge.updateQueue,e===null?(e={lastEffect:null,stores:null},Ge.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function L0(){return xn().memoizedState}function Ml(t,e,n,r){var s=$n();Ge.flags|=t,s.memoizedState=la(1|e,n,void 0,r===void 0?null:r)}function Hc(t,e,n,r){var s=xn();r=r===void 0?null:r;var i=void 0;if(ct!==null){var o=ct.memoizedState;if(i=o.destroy,r!==null&&Cf(r,o.deps)){s.memoizedState=la(e,n,i,r);return}}Ge.flags|=t,s.memoizedState=la(1|e,n,i,r)}function yg(t,e){return Ml(8390656,8,t,e)}function Nf(t,e){return Hc(2048,8,t,e)}function V0(t,e){return Hc(4,2,t,e)}function F0(t,e){return Hc(4,4,t,e)}function U0(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function $0(t,e,n){return n=n!=null?n.concat([t]):null,Hc(4,4,U0.bind(null,e,t),n)}function Pf(){}function B0(t,e){var n=xn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Cf(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function z0(t,e){var n=xn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Cf(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function W0(t,e,n){return Ds&21?(Rn(n,e)||(n=Qv(),Ge.lanes|=n,Ms|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Zt=!0),t.memoizedState=n)}function xT(t,e){var n=Ie;Ie=n!==0&&4>n?n:4,t(!0);var r=rd.transition;rd.transition={};try{t(!1),e()}finally{Ie=n,rd.transition=r}}function H0(){return xn().memoizedState}function ET(t,e,n){var r=Jr(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},q0(t))G0(e,n);else if(n=I0(t,e,n,r),n!==null){var s=Ht();kn(n,t,r,s),K0(n,e,r)}}function bT(t,e,n){var r=Jr(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(q0(t))G0(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,n);if(s.hasEagerState=!0,s.eagerState=l,Rn(l,o)){var u=e.interleaved;u===null?(s.next=s,_f(e)):(s.next=u.next,u.next=s),e.interleaved=s;return}}catch{}finally{}n=I0(t,e,s,r),n!==null&&(s=Ht(),kn(n,t,r,s),K0(n,e,r))}}function q0(t){var e=t.alternate;return t===Ge||e!==null&&e===Ge}function G0(t,e){Vo=hc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function K0(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,of(t,n)}}var fc={readContext:_n,useCallback:Rt,useContext:Rt,useEffect:Rt,useImperativeHandle:Rt,useInsertionEffect:Rt,useLayoutEffect:Rt,useMemo:Rt,useReducer:Rt,useRef:Rt,useState:Rt,useDebugValue:Rt,useDeferredValue:Rt,useTransition:Rt,useMutableSource:Rt,useSyncExternalStore:Rt,useId:Rt,unstable_isNewReconciler:!1},TT={readContext:_n,useCallback:function(t,e){return $n().memoizedState=[t,e===void 0?null:e],t},useContext:_n,useEffect:yg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Ml(4194308,4,U0.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Ml(4194308,4,t,e)},useInsertionEffect:function(t,e){return Ml(4,2,t,e)},useMemo:function(t,e){var n=$n();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=$n();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=ET.bind(null,Ge,t),[r.memoizedState,t]},useRef:function(t){var e=$n();return t={current:t},e.memoizedState=t},useState:gg,useDebugValue:Pf,useDeferredValue:function(t){return $n().memoizedState=t},useTransition:function(){var t=gg(!1),e=t[0];return t=xT.bind(null,t[1]),$n().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Ge,s=$n();if(We){if(n===void 0)throw Error(W(407));n=n()}else{if(n=e(),gt===null)throw Error(W(349));Ds&30||R0(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,yg(D0.bind(null,r,i,t),[t]),r.flags|=2048,la(9,j0.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=$n(),e=gt.identifierPrefix;if(We){var n=lr,r=ar;n=(r&~(1<<32-Pn(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=oa++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=_T++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},CT={readContext:_n,useCallback:B0,useContext:_n,useEffect:Nf,useImperativeHandle:$0,useInsertionEffect:V0,useLayoutEffect:F0,useMemo:z0,useReducer:sd,useRef:L0,useState:function(){return sd(aa)},useDebugValue:Pf,useDeferredValue:function(t){var e=xn();return W0(e,ct.memoizedState,t)},useTransition:function(){var t=sd(aa)[0],e=xn().memoizedState;return[t,e]},useMutableSource:k0,useSyncExternalStore:A0,useId:H0,unstable_isNewReconciler:!1},ST={readContext:_n,useCallback:B0,useContext:_n,useEffect:Nf,useImperativeHandle:$0,useInsertionEffect:V0,useLayoutEffect:F0,useMemo:z0,useReducer:id,useRef:L0,useState:function(){return id(aa)},useDebugValue:Pf,useDeferredValue:function(t){var e=xn();return ct===null?e.memoizedState=t:W0(e,ct.memoizedState,t)},useTransition:function(){var t=id(aa)[0],e=xn().memoizedState;return[t,e]},useMutableSource:k0,useSyncExternalStore:A0,useId:H0,unstable_isNewReconciler:!1};function Cn(t,e){if(t&&t.defaultProps){e=Ke({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function nh(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ke({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var qc={isMounted:function(t){return(t=t._reactInternals)?Hs(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Ht(),s=Jr(t),i=hr(r,s);i.payload=e,n!=null&&(i.callback=n),e=Yr(t,i,s),e!==null&&(kn(e,t,s,r),jl(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Ht(),s=Jr(t),i=hr(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Yr(t,i,s),e!==null&&(kn(e,t,s,r),jl(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ht(),r=Jr(t),s=hr(n,r);s.tag=2,e!=null&&(s.callback=e),e=Yr(t,s,r),e!==null&&(kn(e,t,r,n),jl(e,t,r))}};function vg(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!ea(n,r)||!ea(s,i):!0}function Q0(t,e,n){var r=!1,s=os,i=e.contextType;return typeof i=="object"&&i!==null?i=_n(i):(s=tn(e)?Rs:Ft.current,r=e.contextTypes,i=(r=r!=null)?Ai(t,s):os),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=qc,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function wg(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&qc.enqueueReplaceState(e,e.state,null)}function rh(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},xf(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=_n(i):(i=tn(e)?Rs:Ft.current,s.context=Ai(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(nh(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&qc.enqueueReplaceState(s,s.state,null),uc(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Mi(t,e){try{var n="",r=e;do n+=eb(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function od(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function sh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var IT=typeof WeakMap=="function"?WeakMap:Map;function Y0(t,e,n){n=hr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){pc||(pc=!0,mh=r),sh(t,e)},n}function X0(t,e,n){n=hr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){sh(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){sh(t,e),typeof r!="function"&&(Xr===null?Xr=new Set([this]):Xr.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function _g(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new IT;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=$T.bind(null,t,e,n),e.then(t,t))}function xg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Eg(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=hr(-1,1),e.tag=2,Yr(n,e,1))),n.lanes|=1),t)}var NT=br.ReactCurrentOwner,Zt=!1;function Wt(t,e,n,r){e.child=t===null?S0(e,null,n,r):ji(e,t.child,n,r)}function bg(t,e,n,r,s){n=n.render;var i=e.ref;return Ti(e,s),r=Sf(t,e,n,r,i,s),n=If(),t!==null&&!Zt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,vr(t,e,s)):(We&&n&&mf(e),e.flags|=1,Wt(t,e,r,s),e.child)}function Tg(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!Lf(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,J0(t,e,i,r,s)):(t=Fl(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:ea,n(o,r)&&t.ref===e.ref)return vr(t,e,s)}return e.flags|=1,t=Zr(i,r),t.ref=e.ref,t.return=e,e.child=t}function J0(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(ea(i,r)&&t.ref===e.ref)if(Zt=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Zt=!0);else return e.lanes=t.lanes,vr(t,e,s)}return ih(t,e,n,r,s)}function Z0(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},De(vi,an),an|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,De(vi,an),an|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,De(vi,an),an|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,De(vi,an),an|=r;return Wt(t,e,s,n),e.child}function ew(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function ih(t,e,n,r,s){var i=tn(n)?Rs:Ft.current;return i=Ai(e,i),Ti(e,s),n=Sf(t,e,n,r,i,s),r=If(),t!==null&&!Zt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,vr(t,e,s)):(We&&r&&mf(e),e.flags|=1,Wt(t,e,n,s),e.child)}function Cg(t,e,n,r,s){if(tn(n)){var i=!0;ic(e)}else i=!1;if(Ti(e,s),e.stateNode===null)Ol(t,e),Q0(e,n,r),rh(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var u=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=_n(d):(d=tn(n)?Rs:Ft.current,d=Ai(e,d));var f=n.getDerivedStateFromProps,p=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function";p||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||u!==d)&&wg(e,o,r,d),Mr=!1;var y=e.memoizedState;o.state=y,uc(e,r,o,s),u=e.memoizedState,l!==r||y!==u||en.current||Mr?(typeof f=="function"&&(nh(e,n,f,r),u=e.memoizedState),(l=Mr||vg(e,n,l,r,y,u,d))?(p||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),o.props=r,o.state=u,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,N0(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:Cn(e.type,l),o.props=d,p=e.pendingProps,y=o.context,u=n.contextType,typeof u=="object"&&u!==null?u=_n(u):(u=tn(n)?Rs:Ft.current,u=Ai(e,u));var T=n.getDerivedStateFromProps;(f=typeof T=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==p||y!==u)&&wg(e,o,r,u),Mr=!1,y=e.memoizedState,o.state=y,uc(e,r,o,s);var S=e.memoizedState;l!==p||y!==S||en.current||Mr?(typeof T=="function"&&(nh(e,n,T,r),S=e.memoizedState),(d=Mr||vg(e,n,d,r,y,S,u)||!1)?(f||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,S,u),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,S,u)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&y===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&y===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=S),o.props=r,o.state=S,o.context=u,r=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&y===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&y===t.memoizedState||(e.flags|=1024),r=!1)}return oh(t,e,n,r,i,s)}function oh(t,e,n,r,s,i){ew(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&ug(e,n,!1),vr(t,e,i);r=e.stateNode,NT.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=ji(e,t.child,null,i),e.child=ji(e,null,l,i)):Wt(t,e,l,i),e.memoizedState=r.state,s&&ug(e,n,!0),e.child}function tw(t){var e=t.stateNode;e.pendingContext?cg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&cg(t,e.context,!1),Ef(t,e.containerInfo)}function Sg(t,e,n,r,s){return Ri(),gf(s),e.flags|=256,Wt(t,e,n,r),e.child}var ah={dehydrated:null,treeContext:null,retryLane:0};function lh(t){return{baseLanes:t,cachePool:null,transitions:null}}function nw(t,e,n){var r=e.pendingProps,s=qe.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),De(qe,s&1),t===null)return eh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Qc(o,r,0,null),t=ks(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=lh(n),e.memoizedState=ah,t):kf(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return PT(t,e,o,r,l,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,l=s.sibling;var u={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=Zr(s,u),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=Zr(l,i):(i=ks(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?lh(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=ah,r}return i=t.child,t=i.sibling,r=Zr(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function kf(t,e){return e=Qc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function wl(t,e,n,r){return r!==null&&gf(r),ji(e,t.child,null,n),t=kf(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function PT(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=od(Error(W(422))),wl(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Qc({mode:"visible",children:r.children},s,0,null),i=ks(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&ji(e,t.child,null,o),e.child.memoizedState=lh(o),e.memoizedState=ah,i);if(!(e.mode&1))return wl(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(W(419)),r=od(i,r,void 0),wl(t,e,o,r)}if(l=(o&t.childLanes)!==0,Zt||l){if(r=gt,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,yr(t,s),kn(r,t,s,-1))}return Of(),r=od(Error(W(421))),wl(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=BT.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,ln=Qr(s.nextSibling),un=e,We=!0,Nn=null,t!==null&&(pn[gn++]=ar,pn[gn++]=lr,pn[gn++]=js,ar=t.id,lr=t.overflow,js=e),e=kf(e,r.children),e.flags|=4096,e)}function Ig(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),th(t.return,e,n)}function ad(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function rw(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Wt(t,e,r.children,n),r=qe.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Ig(t,n,e);else if(t.tag===19)Ig(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(De(qe,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&dc(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),ad(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&dc(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}ad(e,!0,n,null,i);break;case"together":ad(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ol(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function vr(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ms|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(W(153));if(e.child!==null){for(t=e.child,n=Zr(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Zr(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function kT(t,e,n){switch(e.tag){case 3:tw(e),Ri();break;case 5:P0(e);break;case 1:tn(e.type)&&ic(e);break;case 4:Ef(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;De(lc,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(De(qe,qe.current&1),e.flags|=128,null):n&e.child.childLanes?nw(t,e,n):(De(qe,qe.current&1),t=vr(t,e,n),t!==null?t.sibling:null);De(qe,qe.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return rw(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),De(qe,qe.current),r)break;return null;case 22:case 23:return e.lanes=0,Z0(t,e,n)}return vr(t,e,n)}var sw,ch,iw,ow;sw=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ch=function(){};iw=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Ss(qn.current);var i=null;switch(n){case"input":s=Ad(t,s),r=Ad(t,r),i=[];break;case"select":s=Ke({},s,{value:void 0}),r=Ke({},r,{value:void 0}),i=[];break;case"textarea":s=Dd(t,s),r=Dd(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=rc)}Od(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Go.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var u=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&u!==l&&(u!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in u)u.hasOwnProperty(o)&&l[o]!==u[o]&&(n||(n={}),n[o]=u[o])}else n||(i||(i=[]),i.push(d,n)),n=u;else d==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,l=l?l.__html:void 0,u!=null&&l!==u&&(i=i||[]).push(d,u)):d==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(d,""+u):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Go.hasOwnProperty(d)?(u!=null&&d==="onScroll"&&Le("scroll",t),i||l===u||(i=[])):(i=i||[]).push(d,u))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};ow=function(t,e,n,r){n!==r&&(e.flags|=4)};function _o(t,e){if(!We)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function jt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function AT(t,e,n){var r=e.pendingProps;switch(pf(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return jt(e),null;case 1:return tn(e.type)&&sc(),jt(e),null;case 3:return r=e.stateNode,Di(),Fe(en),Fe(Ft),Tf(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(yl(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Nn!==null&&(yh(Nn),Nn=null))),ch(t,e),jt(e),null;case 5:bf(e);var s=Ss(ia.current);if(n=e.type,t!==null&&e.stateNode!=null)iw(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(W(166));return jt(e),null}if(t=Ss(qn.current),yl(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Bn]=e,r[ra]=i,t=(e.mode&1)!==0,n){case"dialog":Le("cancel",r),Le("close",r);break;case"iframe":case"object":case"embed":Le("load",r);break;case"video":case"audio":for(s=0;s<So.length;s++)Le(So[s],r);break;case"source":Le("error",r);break;case"img":case"image":case"link":Le("error",r),Le("load",r);break;case"details":Le("toggle",r);break;case"input":Op(r,i),Le("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Le("invalid",r);break;case"textarea":Vp(r,i),Le("invalid",r)}Od(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&gl(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&gl(r.textContent,l,t),s=["children",""+l]):Go.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&Le("scroll",r)}switch(n){case"input":ll(r),Lp(r,i,!0);break;case"textarea":ll(r),Fp(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=rc)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Dv(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Bn]=e,t[ra]=r,sw(t,e,!1,!1),e.stateNode=t;e:{switch(o=Ld(n,r),n){case"dialog":Le("cancel",t),Le("close",t),s=r;break;case"iframe":case"object":case"embed":Le("load",t),s=r;break;case"video":case"audio":for(s=0;s<So.length;s++)Le(So[s],t);s=r;break;case"source":Le("error",t),s=r;break;case"img":case"image":case"link":Le("error",t),Le("load",t),s=r;break;case"details":Le("toggle",t),s=r;break;case"input":Op(t,r),s=Ad(t,r),Le("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Ke({},r,{value:void 0}),Le("invalid",t);break;case"textarea":Vp(t,r),s=Dd(t,r),Le("invalid",t);break;default:s=r}Od(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var u=l[i];i==="style"?Lv(t,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&Mv(t,u)):i==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&Ko(t,u):typeof u=="number"&&Ko(t,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Go.hasOwnProperty(i)?u!=null&&i==="onScroll"&&Le("scroll",t):u!=null&&Zh(t,i,u,o))}switch(n){case"input":ll(t),Lp(t,r,!1);break;case"textarea":ll(t),Fp(t);break;case"option":r.value!=null&&t.setAttribute("value",""+is(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?_i(t,!!r.multiple,i,!1):r.defaultValue!=null&&_i(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=rc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return jt(e),null;case 6:if(t&&e.stateNode!=null)ow(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(W(166));if(n=Ss(ia.current),Ss(qn.current),yl(e)){if(r=e.stateNode,n=e.memoizedProps,r[Bn]=e,(i=r.nodeValue!==n)&&(t=un,t!==null))switch(t.tag){case 3:gl(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&gl(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Bn]=e,e.stateNode=r}return jt(e),null;case 13:if(Fe(qe),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(We&&ln!==null&&e.mode&1&&!(e.flags&128))T0(),Ri(),e.flags|=98560,i=!1;else if(i=yl(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(W(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(W(317));i[Bn]=e}else Ri(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;jt(e),i=!1}else Nn!==null&&(yh(Nn),Nn=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||qe.current&1?ut===0&&(ut=3):Of())),e.updateQueue!==null&&(e.flags|=4),jt(e),null);case 4:return Di(),ch(t,e),t===null&&ta(e.stateNode.containerInfo),jt(e),null;case 10:return wf(e.type._context),jt(e),null;case 17:return tn(e.type)&&sc(),jt(e),null;case 19:if(Fe(qe),i=e.memoizedState,i===null)return jt(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)_o(i,!1);else{if(ut!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=dc(t),o!==null){for(e.flags|=128,_o(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return De(qe,qe.current&1|2),e.child}t=t.sibling}i.tail!==null&&tt()>Oi&&(e.flags|=128,r=!0,_o(i,!1),e.lanes=4194304)}else{if(!r)if(t=dc(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),_o(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!We)return jt(e),null}else 2*tt()-i.renderingStartTime>Oi&&n!==1073741824&&(e.flags|=128,r=!0,_o(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=tt(),e.sibling=null,n=qe.current,De(qe,r?n&1|2:n&1),e):(jt(e),null);case 22:case 23:return Mf(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?an&1073741824&&(jt(e),e.subtreeFlags&6&&(e.flags|=8192)):jt(e),null;case 24:return null;case 25:return null}throw Error(W(156,e.tag))}function RT(t,e){switch(pf(e),e.tag){case 1:return tn(e.type)&&sc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Di(),Fe(en),Fe(Ft),Tf(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return bf(e),null;case 13:if(Fe(qe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(W(340));Ri()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Fe(qe),null;case 4:return Di(),null;case 10:return wf(e.type._context),null;case 22:case 23:return Mf(),null;case 24:return null;default:return null}}var _l=!1,Ot=!1,jT=typeof WeakSet=="function"?WeakSet:Set,J=null;function yi(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Je(t,e,r)}else n.current=null}function uh(t,e,n){try{n()}catch(r){Je(t,e,r)}}var Ng=!1;function DT(t,e){if(Gd=ec,t=d0(),ff(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,u=-1,d=0,f=0,p=t,y=null;t:for(;;){for(var T;p!==n||s!==0&&p.nodeType!==3||(l=o+s),p!==i||r!==0&&p.nodeType!==3||(u=o+r),p.nodeType===3&&(o+=p.nodeValue.length),(T=p.firstChild)!==null;)y=p,p=T;for(;;){if(p===t)break t;if(y===n&&++d===s&&(l=o),y===i&&++f===r&&(u=o),(T=p.nextSibling)!==null)break;p=y,y=p.parentNode}p=T}n=l===-1||u===-1?null:{start:l,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(Kd={focusedElem:t,selectionRange:n},ec=!1,J=e;J!==null;)if(e=J,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,J=t;else for(;J!==null;){e=J;try{var S=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var A=S.memoizedProps,k=S.memoizedState,E=e.stateNode,_=E.getSnapshotBeforeUpdate(e.elementType===e.type?A:Cn(e.type,A),k);E.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var I=e.stateNode.containerInfo;I.nodeType===1?I.textContent="":I.nodeType===9&&I.documentElement&&I.removeChild(I.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(W(163))}}catch(O){Je(e,e.return,O)}if(t=e.sibling,t!==null){t.return=e.return,J=t;break}J=e.return}return S=Ng,Ng=!1,S}function Fo(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&uh(e,n,i)}s=s.next}while(s!==r)}}function Gc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function dh(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function aw(t){var e=t.alternate;e!==null&&(t.alternate=null,aw(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Bn],delete e[ra],delete e[Xd],delete e[gT],delete e[yT])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function lw(t){return t.tag===5||t.tag===3||t.tag===4}function Pg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||lw(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function hh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=rc));else if(r!==4&&(t=t.child,t!==null))for(hh(t,e,n),t=t.sibling;t!==null;)hh(t,e,n),t=t.sibling}function fh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(fh(t,e,n),t=t.sibling;t!==null;)fh(t,e,n),t=t.sibling}var xt=null,Sn=!1;function Rr(t,e,n){for(n=n.child;n!==null;)cw(t,e,n),n=n.sibling}function cw(t,e,n){if(Hn&&typeof Hn.onCommitFiberUnmount=="function")try{Hn.onCommitFiberUnmount(Fc,n)}catch{}switch(n.tag){case 5:Ot||yi(n,e);case 6:var r=xt,s=Sn;xt=null,Rr(t,e,n),xt=r,Sn=s,xt!==null&&(Sn?(t=xt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):xt.removeChild(n.stateNode));break;case 18:xt!==null&&(Sn?(t=xt,n=n.stateNode,t.nodeType===8?ed(t.parentNode,n):t.nodeType===1&&ed(t,n),Jo(t)):ed(xt,n.stateNode));break;case 4:r=xt,s=Sn,xt=n.stateNode.containerInfo,Sn=!0,Rr(t,e,n),xt=r,Sn=s;break;case 0:case 11:case 14:case 15:if(!Ot&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&uh(n,e,o),s=s.next}while(s!==r)}Rr(t,e,n);break;case 1:if(!Ot&&(yi(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){Je(n,e,l)}Rr(t,e,n);break;case 21:Rr(t,e,n);break;case 22:n.mode&1?(Ot=(r=Ot)||n.memoizedState!==null,Rr(t,e,n),Ot=r):Rr(t,e,n);break;default:Rr(t,e,n)}}function kg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new jT),e.forEach(function(r){var s=zT.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Tn(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:xt=l.stateNode,Sn=!1;break e;case 3:xt=l.stateNode.containerInfo,Sn=!0;break e;case 4:xt=l.stateNode.containerInfo,Sn=!0;break e}l=l.return}if(xt===null)throw Error(W(160));cw(i,o,s),xt=null,Sn=!1;var u=s.alternate;u!==null&&(u.return=null),s.return=null}catch(d){Je(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)uw(e,t),e=e.sibling}function uw(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Tn(e,t),Fn(t),r&4){try{Fo(3,t,t.return),Gc(3,t)}catch(A){Je(t,t.return,A)}try{Fo(5,t,t.return)}catch(A){Je(t,t.return,A)}}break;case 1:Tn(e,t),Fn(t),r&512&&n!==null&&yi(n,n.return);break;case 5:if(Tn(e,t),Fn(t),r&512&&n!==null&&yi(n,n.return),t.flags&32){var s=t.stateNode;try{Ko(s,"")}catch(A){Je(t,t.return,A)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,l=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Rv(s,i),Ld(l,o);var d=Ld(l,i);for(o=0;o<u.length;o+=2){var f=u[o],p=u[o+1];f==="style"?Lv(s,p):f==="dangerouslySetInnerHTML"?Mv(s,p):f==="children"?Ko(s,p):Zh(s,f,p,d)}switch(l){case"input":Rd(s,i);break;case"textarea":jv(s,i);break;case"select":var y=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var T=i.value;T!=null?_i(s,!!i.multiple,T,!1):y!==!!i.multiple&&(i.defaultValue!=null?_i(s,!!i.multiple,i.defaultValue,!0):_i(s,!!i.multiple,i.multiple?[]:"",!1))}s[ra]=i}catch(A){Je(t,t.return,A)}}break;case 6:if(Tn(e,t),Fn(t),r&4){if(t.stateNode===null)throw Error(W(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(A){Je(t,t.return,A)}}break;case 3:if(Tn(e,t),Fn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Jo(e.containerInfo)}catch(A){Je(t,t.return,A)}break;case 4:Tn(e,t),Fn(t);break;case 13:Tn(e,t),Fn(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(jf=tt())),r&4&&kg(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(Ot=(d=Ot)||f,Tn(e,t),Ot=d):Tn(e,t),Fn(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!f&&t.mode&1)for(J=t,f=t.child;f!==null;){for(p=J=f;J!==null;){switch(y=J,T=y.child,y.tag){case 0:case 11:case 14:case 15:Fo(4,y,y.return);break;case 1:yi(y,y.return);var S=y.stateNode;if(typeof S.componentWillUnmount=="function"){r=y,n=y.return;try{e=r,S.props=e.memoizedProps,S.state=e.memoizedState,S.componentWillUnmount()}catch(A){Je(r,n,A)}}break;case 5:yi(y,y.return);break;case 22:if(y.memoizedState!==null){Rg(p);continue}}T!==null?(T.return=y,J=T):Rg(p)}f=f.sibling}e:for(f=null,p=t;;){if(p.tag===5){if(f===null){f=p;try{s=p.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=p.stateNode,u=p.memoizedProps.style,o=u!=null&&u.hasOwnProperty("display")?u.display:null,l.style.display=Ov("display",o))}catch(A){Je(t,t.return,A)}}}else if(p.tag===6){if(f===null)try{p.stateNode.nodeValue=d?"":p.memoizedProps}catch(A){Je(t,t.return,A)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===t)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;f===p&&(f=null),p=p.return}f===p&&(f=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:Tn(e,t),Fn(t),r&4&&kg(t);break;case 21:break;default:Tn(e,t),Fn(t)}}function Fn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(lw(n)){var r=n;break e}n=n.return}throw Error(W(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Ko(s,""),r.flags&=-33);var i=Pg(t);fh(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Pg(t);hh(t,l,o);break;default:throw Error(W(161))}}catch(u){Je(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function MT(t,e,n){J=t,dw(t)}function dw(t,e,n){for(var r=(t.mode&1)!==0;J!==null;){var s=J,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||_l;if(!o){var l=s.alternate,u=l!==null&&l.memoizedState!==null||Ot;l=_l;var d=Ot;if(_l=o,(Ot=u)&&!d)for(J=s;J!==null;)o=J,u=o.child,o.tag===22&&o.memoizedState!==null?jg(s):u!==null?(u.return=o,J=u):jg(s);for(;i!==null;)J=i,dw(i),i=i.sibling;J=s,_l=l,Ot=d}Ag(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,J=i):Ag(t)}}function Ag(t){for(;J!==null;){var e=J;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ot||Gc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ot)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Cn(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&pg(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}pg(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var f=d.memoizedState;if(f!==null){var p=f.dehydrated;p!==null&&Jo(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(W(163))}Ot||e.flags&512&&dh(e)}catch(y){Je(e,e.return,y)}}if(e===t){J=null;break}if(n=e.sibling,n!==null){n.return=e.return,J=n;break}J=e.return}}function Rg(t){for(;J!==null;){var e=J;if(e===t){J=null;break}var n=e.sibling;if(n!==null){n.return=e.return,J=n;break}J=e.return}}function jg(t){for(;J!==null;){var e=J;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Gc(4,e)}catch(u){Je(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(u){Je(e,s,u)}}var i=e.return;try{dh(e)}catch(u){Je(e,i,u)}break;case 5:var o=e.return;try{dh(e)}catch(u){Je(e,o,u)}}}catch(u){Je(e,e.return,u)}if(e===t){J=null;break}var l=e.sibling;if(l!==null){l.return=e.return,J=l;break}J=e.return}}var OT=Math.ceil,mc=br.ReactCurrentDispatcher,Af=br.ReactCurrentOwner,vn=br.ReactCurrentBatchConfig,be=0,gt=null,st=null,Tt=0,an=0,vi=hs(0),ut=0,ca=null,Ms=0,Kc=0,Rf=0,Uo=null,Xt=null,jf=0,Oi=1/0,rr=null,pc=!1,mh=null,Xr=null,xl=!1,zr=null,gc=0,$o=0,ph=null,Ll=-1,Vl=0;function Ht(){return be&6?tt():Ll!==-1?Ll:Ll=tt()}function Jr(t){return t.mode&1?be&2&&Tt!==0?Tt&-Tt:wT.transition!==null?(Vl===0&&(Vl=Qv()),Vl):(t=Ie,t!==0||(t=window.event,t=t===void 0?16:n0(t.type)),t):1}function kn(t,e,n,r){if(50<$o)throw $o=0,ph=null,Error(W(185));ba(t,n,r),(!(be&2)||t!==gt)&&(t===gt&&(!(be&2)&&(Kc|=n),ut===4&&Lr(t,Tt)),nn(t,r),n===1&&be===0&&!(e.mode&1)&&(Oi=tt()+500,Wc&&fs()))}function nn(t,e){var n=t.callbackNode;wb(t,e);var r=Zl(t,t===gt?Tt:0);if(r===0)n!==null&&Bp(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Bp(n),e===1)t.tag===0?vT(Dg.bind(null,t)):x0(Dg.bind(null,t)),mT(function(){!(be&6)&&fs()}),n=null;else{switch(Yv(r)){case 1:n=sf;break;case 4:n=Gv;break;case 16:n=Jl;break;case 536870912:n=Kv;break;default:n=Jl}n=ww(n,hw.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function hw(t,e){if(Ll=-1,Vl=0,be&6)throw Error(W(327));var n=t.callbackNode;if(Ci()&&t.callbackNode!==n)return null;var r=Zl(t,t===gt?Tt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=yc(t,r);else{e=r;var s=be;be|=2;var i=mw();(gt!==t||Tt!==e)&&(rr=null,Oi=tt()+500,Ps(t,e));do try{FT();break}catch(l){fw(t,l)}while(1);vf(),mc.current=i,be=s,st!==null?e=0:(gt=null,Tt=0,e=ut)}if(e!==0){if(e===2&&(s=Bd(t),s!==0&&(r=s,e=gh(t,s))),e===1)throw n=ca,Ps(t,0),Lr(t,r),nn(t,tt()),n;if(e===6)Lr(t,r);else{if(s=t.current.alternate,!(r&30)&&!LT(s)&&(e=yc(t,r),e===2&&(i=Bd(t),i!==0&&(r=i,e=gh(t,i))),e===1))throw n=ca,Ps(t,0),Lr(t,r),nn(t,tt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(W(345));case 2:Es(t,Xt,rr);break;case 3:if(Lr(t,r),(r&130023424)===r&&(e=jf+500-tt(),10<e)){if(Zl(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Ht(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Yd(Es.bind(null,t,Xt,rr),e);break}Es(t,Xt,rr);break;case 4:if(Lr(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-Pn(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=tt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*OT(r/1960))-r,10<r){t.timeoutHandle=Yd(Es.bind(null,t,Xt,rr),r);break}Es(t,Xt,rr);break;case 5:Es(t,Xt,rr);break;default:throw Error(W(329))}}}return nn(t,tt()),t.callbackNode===n?hw.bind(null,t):null}function gh(t,e){var n=Uo;return t.current.memoizedState.isDehydrated&&(Ps(t,e).flags|=256),t=yc(t,e),t!==2&&(e=Xt,Xt=n,e!==null&&yh(e)),t}function yh(t){Xt===null?Xt=t:Xt.push.apply(Xt,t)}function LT(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Rn(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Lr(t,e){for(e&=~Rf,e&=~Kc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Pn(e),r=1<<n;t[n]=-1,e&=~r}}function Dg(t){if(be&6)throw Error(W(327));Ci();var e=Zl(t,0);if(!(e&1))return nn(t,tt()),null;var n=yc(t,e);if(t.tag!==0&&n===2){var r=Bd(t);r!==0&&(e=r,n=gh(t,r))}if(n===1)throw n=ca,Ps(t,0),Lr(t,e),nn(t,tt()),n;if(n===6)throw Error(W(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Es(t,Xt,rr),nn(t,tt()),null}function Df(t,e){var n=be;be|=1;try{return t(e)}finally{be=n,be===0&&(Oi=tt()+500,Wc&&fs())}}function Os(t){zr!==null&&zr.tag===0&&!(be&6)&&Ci();var e=be;be|=1;var n=vn.transition,r=Ie;try{if(vn.transition=null,Ie=1,t)return t()}finally{Ie=r,vn.transition=n,be=e,!(be&6)&&fs()}}function Mf(){an=vi.current,Fe(vi)}function Ps(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,fT(n)),st!==null)for(n=st.return;n!==null;){var r=n;switch(pf(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&sc();break;case 3:Di(),Fe(en),Fe(Ft),Tf();break;case 5:bf(r);break;case 4:Di();break;case 13:Fe(qe);break;case 19:Fe(qe);break;case 10:wf(r.type._context);break;case 22:case 23:Mf()}n=n.return}if(gt=t,st=t=Zr(t.current,null),Tt=an=e,ut=0,ca=null,Rf=Kc=Ms=0,Xt=Uo=null,Cs!==null){for(e=0;e<Cs.length;e++)if(n=Cs[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}Cs=null}return t}function fw(t,e){do{var n=st;try{if(vf(),Dl.current=fc,hc){for(var r=Ge.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}hc=!1}if(Ds=0,pt=ct=Ge=null,Vo=!1,oa=0,Af.current=null,n===null||n.return===null){ut=1,ca=e,st=null;break}e:{var i=t,o=n.return,l=n,u=e;if(e=Tt,l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var d=u,f=l,p=f.tag;if(!(f.mode&1)&&(p===0||p===11||p===15)){var y=f.alternate;y?(f.updateQueue=y.updateQueue,f.memoizedState=y.memoizedState,f.lanes=y.lanes):(f.updateQueue=null,f.memoizedState=null)}var T=xg(o);if(T!==null){T.flags&=-257,Eg(T,o,l,i,e),T.mode&1&&_g(i,d,e),e=T,u=d;var S=e.updateQueue;if(S===null){var A=new Set;A.add(u),e.updateQueue=A}else S.add(u);break e}else{if(!(e&1)){_g(i,d,e),Of();break e}u=Error(W(426))}}else if(We&&l.mode&1){var k=xg(o);if(k!==null){!(k.flags&65536)&&(k.flags|=256),Eg(k,o,l,i,e),gf(Mi(u,l));break e}}i=u=Mi(u,l),ut!==4&&(ut=2),Uo===null?Uo=[i]:Uo.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var E=Y0(i,u,e);mg(i,E);break e;case 1:l=u;var _=i.type,I=i.stateNode;if(!(i.flags&128)&&(typeof _.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(Xr===null||!Xr.has(I)))){i.flags|=65536,e&=-e,i.lanes|=e;var O=X0(i,l,e);mg(i,O);break e}}i=i.return}while(i!==null)}gw(n)}catch(D){e=D,st===n&&n!==null&&(st=n=n.return);continue}break}while(1)}function mw(){var t=mc.current;return mc.current=fc,t===null?fc:t}function Of(){(ut===0||ut===3||ut===2)&&(ut=4),gt===null||!(Ms&268435455)&&!(Kc&268435455)||Lr(gt,Tt)}function yc(t,e){var n=be;be|=2;var r=mw();(gt!==t||Tt!==e)&&(rr=null,Ps(t,e));do try{VT();break}catch(s){fw(t,s)}while(1);if(vf(),be=n,mc.current=r,st!==null)throw Error(W(261));return gt=null,Tt=0,ut}function VT(){for(;st!==null;)pw(st)}function FT(){for(;st!==null&&!ub();)pw(st)}function pw(t){var e=vw(t.alternate,t,an);t.memoizedProps=t.pendingProps,e===null?gw(t):st=e,Af.current=null}function gw(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=RT(n,e),n!==null){n.flags&=32767,st=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ut=6,st=null;return}}else if(n=AT(n,e,an),n!==null){st=n;return}if(e=e.sibling,e!==null){st=e;return}st=e=t}while(e!==null);ut===0&&(ut=5)}function Es(t,e,n){var r=Ie,s=vn.transition;try{vn.transition=null,Ie=1,UT(t,e,n,r)}finally{vn.transition=s,Ie=r}return null}function UT(t,e,n,r){do Ci();while(zr!==null);if(be&6)throw Error(W(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(W(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(_b(t,i),t===gt&&(st=gt=null,Tt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||xl||(xl=!0,ww(Jl,function(){return Ci(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=vn.transition,vn.transition=null;var o=Ie;Ie=1;var l=be;be|=4,Af.current=null,DT(t,n),uw(n,t),oT(Kd),ec=!!Gd,Kd=Gd=null,t.current=n,MT(n),db(),be=l,Ie=o,vn.transition=i}else t.current=n;if(xl&&(xl=!1,zr=t,gc=s),i=t.pendingLanes,i===0&&(Xr=null),mb(n.stateNode),nn(t,tt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(pc)throw pc=!1,t=mh,mh=null,t;return gc&1&&t.tag!==0&&Ci(),i=t.pendingLanes,i&1?t===ph?$o++:($o=0,ph=t):$o=0,fs(),null}function Ci(){if(zr!==null){var t=Yv(gc),e=vn.transition,n=Ie;try{if(vn.transition=null,Ie=16>t?16:t,zr===null)var r=!1;else{if(t=zr,zr=null,gc=0,be&6)throw Error(W(331));var s=be;for(be|=4,J=t.current;J!==null;){var i=J,o=i.child;if(J.flags&16){var l=i.deletions;if(l!==null){for(var u=0;u<l.length;u++){var d=l[u];for(J=d;J!==null;){var f=J;switch(f.tag){case 0:case 11:case 15:Fo(8,f,i)}var p=f.child;if(p!==null)p.return=f,J=p;else for(;J!==null;){f=J;var y=f.sibling,T=f.return;if(aw(f),f===d){J=null;break}if(y!==null){y.return=T,J=y;break}J=T}}}var S=i.alternate;if(S!==null){var A=S.child;if(A!==null){S.child=null;do{var k=A.sibling;A.sibling=null,A=k}while(A!==null)}}J=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,J=o;else e:for(;J!==null;){if(i=J,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Fo(9,i,i.return)}var E=i.sibling;if(E!==null){E.return=i.return,J=E;break e}J=i.return}}var _=t.current;for(J=_;J!==null;){o=J;var I=o.child;if(o.subtreeFlags&2064&&I!==null)I.return=o,J=I;else e:for(o=_;J!==null;){if(l=J,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Gc(9,l)}}catch(D){Je(l,l.return,D)}if(l===o){J=null;break e}var O=l.sibling;if(O!==null){O.return=l.return,J=O;break e}J=l.return}}if(be=s,fs(),Hn&&typeof Hn.onPostCommitFiberRoot=="function")try{Hn.onPostCommitFiberRoot(Fc,t)}catch{}r=!0}return r}finally{Ie=n,vn.transition=e}}return!1}function Mg(t,e,n){e=Mi(n,e),e=Y0(t,e,1),t=Yr(t,e,1),e=Ht(),t!==null&&(ba(t,1,e),nn(t,e))}function Je(t,e,n){if(t.tag===3)Mg(t,t,n);else for(;e!==null;){if(e.tag===3){Mg(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Xr===null||!Xr.has(r))){t=Mi(n,t),t=X0(e,t,1),e=Yr(e,t,1),t=Ht(),e!==null&&(ba(e,1,t),nn(e,t));break}}e=e.return}}function $T(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Ht(),t.pingedLanes|=t.suspendedLanes&n,gt===t&&(Tt&n)===n&&(ut===4||ut===3&&(Tt&130023424)===Tt&&500>tt()-jf?Ps(t,0):Rf|=n),nn(t,e)}function yw(t,e){e===0&&(t.mode&1?(e=dl,dl<<=1,!(dl&130023424)&&(dl=4194304)):e=1);var n=Ht();t=yr(t,e),t!==null&&(ba(t,e,n),nn(t,n))}function BT(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),yw(t,n)}function zT(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(W(314))}r!==null&&r.delete(e),yw(t,n)}var vw;vw=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||en.current)Zt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Zt=!1,kT(t,e,n);Zt=!!(t.flags&131072)}else Zt=!1,We&&e.flags&1048576&&E0(e,ac,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Ol(t,e),t=e.pendingProps;var s=Ai(e,Ft.current);Ti(e,n),s=Sf(null,e,r,t,s,n);var i=If();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,tn(r)?(i=!0,ic(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,xf(e),s.updater=qc,e.stateNode=s,s._reactInternals=e,rh(e,r,t,n),e=oh(null,e,r,!0,i,n)):(e.tag=0,We&&i&&mf(e),Wt(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Ol(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=HT(r),t=Cn(r,t),s){case 0:e=ih(null,e,r,t,n);break e;case 1:e=Cg(null,e,r,t,n);break e;case 11:e=bg(null,e,r,t,n);break e;case 14:e=Tg(null,e,r,Cn(r.type,t),n);break e}throw Error(W(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Cn(r,s),ih(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Cn(r,s),Cg(t,e,r,s,n);case 3:e:{if(tw(e),t===null)throw Error(W(387));r=e.pendingProps,i=e.memoizedState,s=i.element,N0(t,e),uc(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Mi(Error(W(423)),e),e=Sg(t,e,r,n,s);break e}else if(r!==s){s=Mi(Error(W(424)),e),e=Sg(t,e,r,n,s);break e}else for(ln=Qr(e.stateNode.containerInfo.firstChild),un=e,We=!0,Nn=null,n=S0(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ri(),r===s){e=vr(t,e,n);break e}Wt(t,e,r,n)}e=e.child}return e;case 5:return P0(e),t===null&&eh(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,Qd(r,s)?o=null:i!==null&&Qd(r,i)&&(e.flags|=32),ew(t,e),Wt(t,e,o,n),e.child;case 6:return t===null&&eh(e),null;case 13:return nw(t,e,n);case 4:return Ef(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=ji(e,null,r,n):Wt(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Cn(r,s),bg(t,e,r,s,n);case 7:return Wt(t,e,e.pendingProps,n),e.child;case 8:return Wt(t,e,e.pendingProps.children,n),e.child;case 12:return Wt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,De(lc,r._currentValue),r._currentValue=o,i!==null)if(Rn(i.value,o)){if(i.children===s.children&&!en.current){e=vr(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var u=l.firstContext;u!==null;){if(u.context===r){if(i.tag===1){u=hr(-1,n&-n),u.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var f=d.pending;f===null?u.next=u:(u.next=f.next,f.next=u),d.pending=u}}i.lanes|=n,u=i.alternate,u!==null&&(u.lanes|=n),th(i.return,n,e),l.lanes|=n;break}u=u.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(W(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),th(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Wt(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Ti(e,n),s=_n(s),r=r(s),e.flags|=1,Wt(t,e,r,n),e.child;case 14:return r=e.type,s=Cn(r,e.pendingProps),s=Cn(r.type,s),Tg(t,e,r,s,n);case 15:return J0(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Cn(r,s),Ol(t,e),e.tag=1,tn(r)?(t=!0,ic(e)):t=!1,Ti(e,n),Q0(e,r,s),rh(e,r,s,n),oh(null,e,r,!0,t,n);case 19:return rw(t,e,n);case 22:return Z0(t,e,n)}throw Error(W(156,e.tag))};function ww(t,e){return qv(t,e)}function WT(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yn(t,e,n,r){return new WT(t,e,n,r)}function Lf(t){return t=t.prototype,!(!t||!t.isReactComponent)}function HT(t){if(typeof t=="function")return Lf(t)?1:0;if(t!=null){if(t=t.$$typeof,t===tf)return 11;if(t===nf)return 14}return 2}function Zr(t,e){var n=t.alternate;return n===null?(n=yn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Fl(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")Lf(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case li:return ks(n.children,s,i,e);case ef:o=8,s|=8;break;case Id:return t=yn(12,n,e,s|2),t.elementType=Id,t.lanes=i,t;case Nd:return t=yn(13,n,e,s),t.elementType=Nd,t.lanes=i,t;case Pd:return t=yn(19,n,e,s),t.elementType=Pd,t.lanes=i,t;case Pv:return Qc(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Iv:o=10;break e;case Nv:o=9;break e;case tf:o=11;break e;case nf:o=14;break e;case Dr:o=16,r=null;break e}throw Error(W(130,t==null?t:typeof t,""))}return e=yn(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function ks(t,e,n,r){return t=yn(7,t,r,e),t.lanes=n,t}function Qc(t,e,n,r){return t=yn(22,t,r,e),t.elementType=Pv,t.lanes=n,t.stateNode={isHidden:!1},t}function ld(t,e,n){return t=yn(6,t,null,e),t.lanes=n,t}function cd(t,e,n){return e=yn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function qT(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zu(0),this.expirationTimes=zu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zu(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Vf(t,e,n,r,s,i,o,l,u){return t=new qT(t,e,n,l,u),e===1?(e=1,i===!0&&(e|=8)):e=0,i=yn(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},xf(i),t}function GT(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ai,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function _w(t){if(!t)return os;t=t._reactInternals;e:{if(Hs(t)!==t||t.tag!==1)throw Error(W(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(tn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(W(171))}if(t.tag===1){var n=t.type;if(tn(n))return _0(t,n,e)}return e}function xw(t,e,n,r,s,i,o,l,u){return t=Vf(n,r,!0,t,s,i,o,l,u),t.context=_w(null),n=t.current,r=Ht(),s=Jr(n),i=hr(r,s),i.callback=e??null,Yr(n,i,s),t.current.lanes=s,ba(t,s,r),nn(t,r),t}function Yc(t,e,n,r){var s=e.current,i=Ht(),o=Jr(s);return n=_w(n),e.context===null?e.context=n:e.pendingContext=n,e=hr(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Yr(s,e,o),t!==null&&(kn(t,s,o,i),jl(t,s,o)),o}function vc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Og(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Ff(t,e){Og(t,e),(t=t.alternate)&&Og(t,e)}function KT(){return null}var Ew=typeof reportError=="function"?reportError:function(t){console.error(t)};function Uf(t){this._internalRoot=t}Xc.prototype.render=Uf.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(W(409));Yc(t,e,null,null)};Xc.prototype.unmount=Uf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Os(function(){Yc(null,t,null,null)}),e[gr]=null}};function Xc(t){this._internalRoot=t}Xc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Zv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Or.length&&e!==0&&e<Or[n].priority;n++);Or.splice(n,0,t),n===0&&t0(t)}};function $f(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Jc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Lg(){}function QT(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=vc(o);i.call(d)}}var o=xw(e,r,t,0,null,!1,!1,"",Lg);return t._reactRootContainer=o,t[gr]=o.current,ta(t.nodeType===8?t.parentNode:t),Os(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=vc(u);l.call(d)}}var u=Vf(t,0,!1,null,null,!1,!1,"",Lg);return t._reactRootContainer=u,t[gr]=u.current,ta(t.nodeType===8?t.parentNode:t),Os(function(){Yc(e,u,n,r)}),u}function Zc(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var u=vc(o);l.call(u)}}Yc(e,o,t,s)}else o=QT(n,e,t,s,r);return vc(o)}Xv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Co(e.pendingLanes);n!==0&&(of(e,n|1),nn(e,tt()),!(be&6)&&(Oi=tt()+500,fs()))}break;case 13:Os(function(){var r=yr(t,1);if(r!==null){var s=Ht();kn(r,t,1,s)}}),Ff(t,1)}};af=function(t){if(t.tag===13){var e=yr(t,134217728);if(e!==null){var n=Ht();kn(e,t,134217728,n)}Ff(t,134217728)}};Jv=function(t){if(t.tag===13){var e=Jr(t),n=yr(t,e);if(n!==null){var r=Ht();kn(n,t,e,r)}Ff(t,e)}};Zv=function(){return Ie};e0=function(t,e){var n=Ie;try{return Ie=t,e()}finally{Ie=n}};Fd=function(t,e,n){switch(e){case"input":if(Rd(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=zc(r);if(!s)throw Error(W(90));Av(r),Rd(r,s)}}}break;case"textarea":jv(t,n);break;case"select":e=n.value,e!=null&&_i(t,!!n.multiple,e,!1)}};Uv=Df;$v=Os;var YT={usingClientEntryPoint:!1,Events:[Ca,hi,zc,Vv,Fv,Df]},xo={findFiberByHostInstance:Ts,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},XT={bundleType:xo.bundleType,version:xo.version,rendererPackageName:xo.rendererPackageName,rendererConfig:xo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:br.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Wv(t),t===null?null:t.stateNode},findFiberByHostInstance:xo.findFiberByHostInstance||KT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var El=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!El.isDisabled&&El.supportsFiber)try{Fc=El.inject(XT),Hn=El}catch{}}fn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=YT;fn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!$f(e))throw Error(W(200));return GT(t,e,null,n)};fn.createRoot=function(t,e){if(!$f(t))throw Error(W(299));var n=!1,r="",s=Ew;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Vf(t,1,!1,null,null,n,!1,r,s),t[gr]=e.current,ta(t.nodeType===8?t.parentNode:t),new Uf(e)};fn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(W(188)):(t=Object.keys(t).join(","),Error(W(268,t)));return t=Wv(e),t=t===null?null:t.stateNode,t};fn.flushSync=function(t){return Os(t)};fn.hydrate=function(t,e,n){if(!Jc(e))throw Error(W(200));return Zc(null,t,e,!0,n)};fn.hydrateRoot=function(t,e,n){if(!$f(t))throw Error(W(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=Ew;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=xw(e,null,t,1,n??null,s,!1,i,o),t[gr]=e.current,ta(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Xc(e)};fn.render=function(t,e,n){if(!Jc(e))throw Error(W(200));return Zc(null,t,e,!1,n)};fn.unmountComponentAtNode=function(t){if(!Jc(t))throw Error(W(40));return t._reactRootContainer?(Os(function(){Zc(null,null,t,!1,function(){t._reactRootContainer=null,t[gr]=null})}),!0):!1};fn.unstable_batchedUpdates=Df;fn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Jc(n))throw Error(W(200));if(t==null||t._reactInternals===void 0)throw Error(W(38));return Zc(t,e,n,!1,r)};fn.version="18.3.1-next-f1338f8080-20240426";function bw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(bw)}catch(t){console.error(t)}}bw(),bv.exports=fn;var JT=bv.exports,Vg=JT;Cd.createRoot=Vg.createRoot,Cd.hydrateRoot=Vg.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ua(){return ua=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ua.apply(this,arguments)}var Wr;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Wr||(Wr={}));const Fg="popstate";function ZT(t){t===void 0&&(t={});function e(r,s){let{pathname:i,search:o,hash:l}=r.location;return vh("",{pathname:i,search:o,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:wc(s)}return tC(e,n,null,t)}function ot(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Tw(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function eC(){return Math.random().toString(36).substr(2,8)}function Ug(t,e){return{usr:t.state,key:t.key,idx:e}}function vh(t,e,n,r){return n===void 0&&(n=null),ua({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Ki(e):e,{state:n,key:e&&e.key||r||eC()})}function wc(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Ki(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function tC(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,l=Wr.Pop,u=null,d=f();d==null&&(d=0,o.replaceState(ua({},o.state,{idx:d}),""));function f(){return(o.state||{idx:null}).idx}function p(){l=Wr.Pop;let k=f(),E=k==null?null:k-d;d=k,u&&u({action:l,location:A.location,delta:E})}function y(k,E){l=Wr.Push;let _=vh(A.location,k,E);n&&n(_,k),d=f()+1;let I=Ug(_,d),O=A.createHref(_);try{o.pushState(I,"",O)}catch(D){if(D instanceof DOMException&&D.name==="DataCloneError")throw D;s.location.assign(O)}i&&u&&u({action:l,location:A.location,delta:1})}function T(k,E){l=Wr.Replace;let _=vh(A.location,k,E);n&&n(_,k),d=f();let I=Ug(_,d),O=A.createHref(_);o.replaceState(I,"",O),i&&u&&u({action:l,location:A.location,delta:0})}function S(k){let E=s.location.origin!=="null"?s.location.origin:s.location.href,_=typeof k=="string"?k:wc(k);return _=_.replace(/ $/,"%20"),ot(E,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,E)}let A={get action(){return l},get location(){return t(s,o)},listen(k){if(u)throw new Error("A history only accepts one active listener");return s.addEventListener(Fg,p),u=k,()=>{s.removeEventListener(Fg,p),u=null}},createHref(k){return e(s,k)},createURL:S,encodeLocation(k){let E=S(k);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:y,replace:T,go(k){return o.go(k)}};return A}var $g;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})($g||($g={}));function nC(t,e,n){return n===void 0&&(n="/"),rC(t,e,n,!1)}function rC(t,e,n,r){let s=typeof e=="string"?Ki(e):e,i=Bf(s.pathname||"/",n);if(i==null)return null;let o=Cw(t);sC(o);let l=null;for(let u=0;l==null&&u<o.length;++u){let d=pC(i);l=fC(o[u],d,r)}return l}function Cw(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(i,o,l)=>{let u={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};u.relativePath.startsWith("/")&&(ot(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=es([r,u.relativePath]),f=n.concat(u);i.children&&i.children.length>0&&(ot(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),Cw(i.children,e,f,d)),!(i.path==null&&!i.index)&&e.push({path:d,score:dC(d,i.index),routesMeta:f})};return t.forEach((i,o)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))s(i,o);else for(let u of Sw(i.path))s(i,o,u)}),e}function Sw(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=Sw(r.join("/")),l=[];return l.push(...o.map(u=>u===""?i:[i,u].join("/"))),s&&l.push(...o),l.map(u=>t.startsWith("/")&&u===""?"/":u)}function sC(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:hC(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const iC=/^:[\w-]+$/,oC=3,aC=2,lC=1,cC=10,uC=-2,Bg=t=>t==="*";function dC(t,e){let n=t.split("/"),r=n.length;return n.some(Bg)&&(r+=uC),e&&(r+=aC),n.filter(s=>!Bg(s)).reduce((s,i)=>s+(iC.test(i)?oC:i===""?lC:cC),r)}function hC(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function fC(t,e,n){n===void 0&&(n=!1);let{routesMeta:r}=t,s={},i="/",o=[];for(let l=0;l<r.length;++l){let u=r[l],d=l===r.length-1,f=i==="/"?e:e.slice(i.length)||"/",p=zg({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},f),y=u.route;if(!p&&d&&n&&!r[r.length-1].route.index&&(p=zg({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},f)),!p)return null;Object.assign(s,p.params),o.push({params:s,pathname:es([i,p.pathname]),pathnameBase:wC(es([i,p.pathnameBase])),route:y}),p.pathnameBase!=="/"&&(i=es([i,p.pathnameBase]))}return o}function zg(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=mC(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,f,p)=>{let{paramName:y,isOptional:T}=f;if(y==="*"){let A=l[p]||"";o=i.slice(0,i.length-A.length).replace(/(.)\/+$/,"$1")}const S=l[p];return T&&!S?d[y]=void 0:d[y]=(S||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:o,pattern:t}}function mC(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Tw(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,u)=>(r.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function pC(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Tw(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Bf(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function gC(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Ki(t):t;return{pathname:n?n.startsWith("/")?n:yC(n,e):e,search:_C(r),hash:xC(s)}}function yC(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function ud(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function vC(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Iw(t,e){let n=vC(t);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function Nw(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=Ki(t):(s=ua({},t),ot(!s.pathname||!s.pathname.includes("?"),ud("?","pathname","search",s)),ot(!s.pathname||!s.pathname.includes("#"),ud("#","pathname","hash",s)),ot(!s.search||!s.search.includes("#"),ud("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,l;if(o==null)l=n;else{let p=e.length-1;if(!r&&o.startsWith("..")){let y=o.split("/");for(;y[0]==="..";)y.shift(),p-=1;s.pathname=y.join("/")}l=p>=0?e[p]:"/"}let u=gC(s,l),d=o&&o!=="/"&&o.endsWith("/"),f=(i||o===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(d||f)&&(u.pathname+="/"),u}const es=t=>t.join("/").replace(/\/\/+/g,"/"),wC=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),_C=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,xC=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function EC(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Pw=["post","put","patch","delete"];new Set(Pw);const bC=["get",...Pw];new Set(bC);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function da(){return da=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},da.apply(this,arguments)}const zf=j.createContext(null),TC=j.createContext(null),qs=j.createContext(null),eu=j.createContext(null),ms=j.createContext({outlet:null,matches:[],isDataRoute:!1}),kw=j.createContext(null);function CC(t,e){let{relative:n}=e===void 0?{}:e;Ia()||ot(!1);let{basename:r,navigator:s}=j.useContext(qs),{hash:i,pathname:o,search:l}=Rw(t,{relative:n}),u=o;return r!=="/"&&(u=o==="/"?r:es([r,o])),s.createHref({pathname:u,search:l,hash:i})}function Ia(){return j.useContext(eu)!=null}function Qi(){return Ia()||ot(!1),j.useContext(eu).location}function Aw(t){j.useContext(qs).static||j.useLayoutEffect(t)}function Jn(){let{isDataRoute:t}=j.useContext(ms);return t?VC():SC()}function SC(){Ia()||ot(!1);let t=j.useContext(zf),{basename:e,future:n,navigator:r}=j.useContext(qs),{matches:s}=j.useContext(ms),{pathname:i}=Qi(),o=JSON.stringify(Iw(s,n.v7_relativeSplatPath)),l=j.useRef(!1);return Aw(()=>{l.current=!0}),j.useCallback(function(d,f){if(f===void 0&&(f={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let p=Nw(d,JSON.parse(o),i,f.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:es([e,p.pathname])),(f.replace?r.replace:r.push)(p,f.state,f)},[e,r,o,i,t])}function tu(){let{matches:t}=j.useContext(ms),e=t[t.length-1];return e?e.params:{}}function Rw(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=j.useContext(qs),{matches:s}=j.useContext(ms),{pathname:i}=Qi(),o=JSON.stringify(Iw(s,r.v7_relativeSplatPath));return j.useMemo(()=>Nw(t,JSON.parse(o),i,n==="path"),[t,o,i,n])}function IC(t,e){return NC(t,e)}function NC(t,e,n,r){Ia()||ot(!1);let{navigator:s}=j.useContext(qs),{matches:i}=j.useContext(ms),o=i[i.length-1],l=o?o.params:{};o&&o.pathname;let u=o?o.pathnameBase:"/";o&&o.route;let d=Qi(),f;if(e){var p;let k=typeof e=="string"?Ki(e):e;u==="/"||(p=k.pathname)!=null&&p.startsWith(u)||ot(!1),f=k}else f=d;let y=f.pathname||"/",T=y;if(u!=="/"){let k=u.replace(/^\//,"").split("/");T="/"+y.replace(/^\//,"").split("/").slice(k.length).join("/")}let S=nC(t,{pathname:T}),A=jC(S&&S.map(k=>Object.assign({},k,{params:Object.assign({},l,k.params),pathname:es([u,s.encodeLocation?s.encodeLocation(k.pathname).pathname:k.pathname]),pathnameBase:k.pathnameBase==="/"?u:es([u,s.encodeLocation?s.encodeLocation(k.pathnameBase).pathname:k.pathnameBase])})),i,n,r);return e&&A?j.createElement(eu.Provider,{value:{location:da({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:Wr.Pop}},A):A}function PC(){let t=LC(),e=EC(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return j.createElement(j.Fragment,null,j.createElement("h2",null,"Unexpected Application Error!"),j.createElement("h3",{style:{fontStyle:"italic"}},e),n?j.createElement("pre",{style:s},n):null,i)}const kC=j.createElement(PC,null);class AC extends j.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?j.createElement(ms.Provider,{value:this.props.routeContext},j.createElement(kw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function RC(t){let{routeContext:e,match:n,children:r}=t,s=j.useContext(zf);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),j.createElement(ms.Provider,{value:e},r)}function jC(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var i;if(!n)return null;if(n.errors)t=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=(s=n)==null?void 0:s.errors;if(l!=null){let f=o.findIndex(p=>p.route.id&&(l==null?void 0:l[p.route.id])!==void 0);f>=0||ot(!1),o=o.slice(0,Math.min(o.length,f+1))}let u=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let f=0;f<o.length;f++){let p=o[f];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(d=f),p.route.id){let{loaderData:y,errors:T}=n,S=p.route.loader&&y[p.route.id]===void 0&&(!T||T[p.route.id]===void 0);if(p.route.lazy||S){u=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((f,p,y)=>{let T,S=!1,A=null,k=null;n&&(T=l&&p.route.id?l[p.route.id]:void 0,A=p.route.errorElement||kC,u&&(d<0&&y===0?(FC("route-fallback",!1),S=!0,k=null):d===y&&(S=!0,k=p.route.hydrateFallbackElement||null)));let E=e.concat(o.slice(0,y+1)),_=()=>{let I;return T?I=A:S?I=k:p.route.Component?I=j.createElement(p.route.Component,null):p.route.element?I=p.route.element:I=f,j.createElement(RC,{match:p,routeContext:{outlet:f,matches:E,isDataRoute:n!=null},children:I})};return n&&(p.route.ErrorBoundary||p.route.errorElement||y===0)?j.createElement(AC,{location:n.location,revalidation:n.revalidation,component:A,error:T,children:_(),routeContext:{outlet:null,matches:E,isDataRoute:!0}}):_()},null)}var jw=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(jw||{}),_c=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(_c||{});function DC(t){let e=j.useContext(zf);return e||ot(!1),e}function MC(t){let e=j.useContext(TC);return e||ot(!1),e}function OC(t){let e=j.useContext(ms);return e||ot(!1),e}function Dw(t){let e=OC(),n=e.matches[e.matches.length-1];return n.route.id||ot(!1),n.route.id}function LC(){var t;let e=j.useContext(kw),n=MC(_c.UseRouteError),r=Dw(_c.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function VC(){let{router:t}=DC(jw.UseNavigateStable),e=Dw(_c.UseNavigateStable),n=j.useRef(!1);return Aw(()=>{n.current=!0}),j.useCallback(function(s,i){i===void 0&&(i={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,da({fromRouteId:e},i)))},[t,e])}const Wg={};function FC(t,e,n){!e&&!Wg[t]&&(Wg[t]=!0)}function UC(t,e){t==null||t.v7_startTransition,(t==null?void 0:t.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function Un(t){ot(!1)}function $C(t){let{basename:e="/",children:n=null,location:r,navigationType:s=Wr.Pop,navigator:i,static:o=!1,future:l}=t;Ia()&&ot(!1);let u=e.replace(/^\/*/,"/"),d=j.useMemo(()=>({basename:u,navigator:i,static:o,future:da({v7_relativeSplatPath:!1},l)}),[u,l,i,o]);typeof r=="string"&&(r=Ki(r));let{pathname:f="/",search:p="",hash:y="",state:T=null,key:S="default"}=r,A=j.useMemo(()=>{let k=Bf(f,u);return k==null?null:{location:{pathname:k,search:p,hash:y,state:T,key:S},navigationType:s}},[u,f,p,y,T,S,s]);return A==null?null:j.createElement(qs.Provider,{value:d},j.createElement(eu.Provider,{children:n,value:A}))}function BC(t){let{children:e,location:n}=t;return IC(wh(e),n)}new Promise(()=>{});function wh(t,e){e===void 0&&(e=[]);let n=[];return j.Children.forEach(t,(r,s)=>{if(!j.isValidElement(r))return;let i=[...e,s];if(r.type===j.Fragment){n.push.apply(n,wh(r.props.children,i));return}r.type!==Un&&ot(!1),!r.props.index||!r.props.children||ot(!1);let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=wh(r.props.children,i)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _h(){return _h=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},_h.apply(this,arguments)}function zC(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function WC(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function HC(t,e){return t.button===0&&(!e||e==="_self")&&!WC(t)}const qC=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],GC="6";try{window.__reactRouterVersion=GC}catch{}const KC="startTransition",Hg=$E[KC];function QC(t){let{basename:e,children:n,future:r,window:s}=t,i=j.useRef();i.current==null&&(i.current=ZT({window:s,v5Compat:!0}));let o=i.current,[l,u]=j.useState({action:o.action,location:o.location}),{v7_startTransition:d}=r||{},f=j.useCallback(p=>{d&&Hg?Hg(()=>u(p)):u(p)},[u,d]);return j.useLayoutEffect(()=>o.listen(f),[o,f]),j.useEffect(()=>UC(r),[r]),j.createElement($C,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:o,future:r})}const YC=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",XC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Is=j.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:i,replace:o,state:l,target:u,to:d,preventScrollReset:f,viewTransition:p}=e,y=zC(e,qC),{basename:T}=j.useContext(qs),S,A=!1;if(typeof d=="string"&&XC.test(d)&&(S=d,YC))try{let I=new URL(window.location.href),O=d.startsWith("//")?new URL(I.protocol+d):new URL(d),D=Bf(O.pathname,T);O.origin===I.origin&&D!=null?d=D+O.search+O.hash:A=!0}catch{}let k=CC(d,{relative:s}),E=JC(d,{replace:o,state:l,target:u,preventScrollReset:f,relative:s,viewTransition:p});function _(I){r&&r(I),I.defaultPrevented||E(I)}return j.createElement("a",_h({},y,{href:S||k,onClick:A||i?r:_,ref:n,target:u}))});var qg;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(qg||(qg={}));var Gg;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Gg||(Gg={}));function JC(t,e){let{target:n,replace:r,state:s,preventScrollReset:i,relative:o,viewTransition:l}=e===void 0?{}:e,u=Jn(),d=Qi(),f=Rw(t,{relative:o});return j.useCallback(p=>{if(HC(p,n)){p.preventDefault();let y=r!==void 0?r:wc(d)===wc(f);u(t,{replace:y,state:s,preventScrollReset:i,relative:o,viewTransition:l})}},[d,u,f,r,s,n,t,i,o,l])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mw=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},ZC=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],l=t[n++],u=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Ow={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,l=o?t[s+1]:0,u=s+2<t.length,d=u?t[s+2]:0,f=i>>2,p=(i&3)<<4|l>>4;let y=(l&15)<<2|d>>6,T=d&63;u||(T=64,o||(y=64)),r.push(n[f],n[p],n[y],n[T])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Mw(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):ZC(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const p=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||p==null)throw new eS;const y=i<<2|l>>4;if(r.push(y),d!==64){const T=l<<4&240|d>>2;if(r.push(T),p!==64){const S=d<<6&192|p;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class eS extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const tS=function(t){const e=Mw(t);return Ow.encodeByteArray(e,!0)},xc=function(t){return tS(t).replace(/\./g,"")},Lw=function(t){try{return Ow.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nS(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rS=()=>nS().__FIREBASE_DEFAULTS__,sS=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},iS=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Lw(t[1]);return e&&JSON.parse(e)},nu=()=>{try{return rS()||sS()||iS()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Vw=t=>{var e,n;return(n=(e=nu())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},oS=t=>{const e=Vw(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Fw=()=>{var t;return(t=nu())===null||t===void 0?void 0:t.config},Uw=t=>{var e;return(e=nu())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aS{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lS(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t),l="";return[xc(JSON.stringify(n)),xc(JSON.stringify(o)),l].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ut(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function cS(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ut())}function uS(){var t;const e=(t=nu())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function dS(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function hS(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function fS(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function mS(){const t=Ut();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function pS(){return!uS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function gS(){try{return typeof indexedDB=="object"}catch{return!1}}function yS(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vS="FirebaseError";class Tr extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=vS,Object.setPrototypeOf(this,Tr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Na.prototype.create)}}class Na{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?wS(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new Tr(s,l,r)}}function wS(t,e){return t.replace(_S,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const _S=/\{\$([^}]+)}/g;function xS(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ec(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(Kg(i)&&Kg(o)){if(!Ec(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function Kg(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pa(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Io(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function No(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function ES(t,e){const n=new bS(t,e);return n.subscribe.bind(n)}class bS{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");TS(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=dd),s.error===void 0&&(s.error=dd),s.complete===void 0&&(s.complete=dd);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function TS(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function dd(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function at(t){return t&&t._delegate?t._delegate:t}class Ls{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bs="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CS{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new aS;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(IS(e))try{this.getOrInitializeService({instanceIdentifier:bs})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=bs){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=bs){return this.instances.has(e)}getOptions(e=bs){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,n){var r;const s=this.normalizeInstanceIdentifier(n),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:SS(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=bs){return this.component?this.component.multipleInstances?e:bs:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function SS(t){return t===bs?void 0:t}function IS(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NS{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new CS(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var we;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(we||(we={}));const PS={debug:we.DEBUG,verbose:we.VERBOSE,info:we.INFO,warn:we.WARN,error:we.ERROR,silent:we.SILENT},kS=we.INFO,AS={[we.DEBUG]:"log",[we.VERBOSE]:"log",[we.INFO]:"info",[we.WARN]:"warn",[we.ERROR]:"error"},RS=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=AS[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Wf{constructor(e){this.name=e,this._logLevel=kS,this._logHandler=RS,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in we))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?PS[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,we.DEBUG,...e),this._logHandler(this,we.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,we.VERBOSE,...e),this._logHandler(this,we.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,we.INFO,...e),this._logHandler(this,we.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,we.WARN,...e),this._logHandler(this,we.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,we.ERROR,...e),this._logHandler(this,we.ERROR,...e)}}const jS=(t,e)=>e.some(n=>t instanceof n);let Qg,Yg;function DS(){return Qg||(Qg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function MS(){return Yg||(Yg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const $w=new WeakMap,xh=new WeakMap,Bw=new WeakMap,hd=new WeakMap,Hf=new WeakMap;function OS(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(ts(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&$w.set(n,t)}).catch(()=>{}),Hf.set(e,t),e}function LS(t){if(xh.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});xh.set(t,e)}let Eh={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return xh.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Bw.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ts(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function VS(t){Eh=t(Eh)}function FS(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(fd(this),e,...n);return Bw.set(r,e.sort?e.sort():[e]),ts(r)}:MS().includes(t)?function(...e){return t.apply(fd(this),e),ts($w.get(this))}:function(...e){return ts(t.apply(fd(this),e))}}function US(t){return typeof t=="function"?FS(t):(t instanceof IDBTransaction&&LS(t),jS(t,DS())?new Proxy(t,Eh):t)}function ts(t){if(t instanceof IDBRequest)return OS(t);if(hd.has(t))return hd.get(t);const e=US(t);return e!==t&&(hd.set(t,e),Hf.set(e,t)),e}const fd=t=>Hf.get(t);function $S(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),l=ts(o);return r&&o.addEventListener("upgradeneeded",u=>{r(ts(o.result),u.oldVersion,u.newVersion,ts(o.transaction),u)}),n&&o.addEventListener("blocked",u=>n(u.oldVersion,u.newVersion,u)),l.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const BS=["get","getKey","getAll","getAllKeys","count"],zS=["put","add","delete","clear"],md=new Map;function Xg(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(md.get(e))return md.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=zS.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||BS.includes(n)))return;const i=async function(o,...l){const u=this.transaction(o,s?"readwrite":"readonly");let d=u.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&u.done]))[0]};return md.set(e,i),i}VS(t=>({...t,get:(e,n,r)=>Xg(e,n)||t.get(e,n,r),has:(e,n)=>!!Xg(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WS{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(HS(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function HS(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const bh="@firebase/app",Jg="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wr=new Wf("@firebase/app"),qS="@firebase/app-compat",GS="@firebase/analytics-compat",KS="@firebase/analytics",QS="@firebase/app-check-compat",YS="@firebase/app-check",XS="@firebase/auth",JS="@firebase/auth-compat",ZS="@firebase/database",eI="@firebase/data-connect",tI="@firebase/database-compat",nI="@firebase/functions",rI="@firebase/functions-compat",sI="@firebase/installations",iI="@firebase/installations-compat",oI="@firebase/messaging",aI="@firebase/messaging-compat",lI="@firebase/performance",cI="@firebase/performance-compat",uI="@firebase/remote-config",dI="@firebase/remote-config-compat",hI="@firebase/storage",fI="@firebase/storage-compat",mI="@firebase/firestore",pI="@firebase/vertexai-preview",gI="@firebase/firestore-compat",yI="firebase",vI="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Th="[DEFAULT]",wI={[bh]:"fire-core",[qS]:"fire-core-compat",[KS]:"fire-analytics",[GS]:"fire-analytics-compat",[YS]:"fire-app-check",[QS]:"fire-app-check-compat",[XS]:"fire-auth",[JS]:"fire-auth-compat",[ZS]:"fire-rtdb",[eI]:"fire-data-connect",[tI]:"fire-rtdb-compat",[nI]:"fire-fn",[rI]:"fire-fn-compat",[sI]:"fire-iid",[iI]:"fire-iid-compat",[oI]:"fire-fcm",[aI]:"fire-fcm-compat",[lI]:"fire-perf",[cI]:"fire-perf-compat",[uI]:"fire-rc",[dI]:"fire-rc-compat",[hI]:"fire-gcs",[fI]:"fire-gcs-compat",[mI]:"fire-fst",[gI]:"fire-fst-compat",[pI]:"fire-vertex","fire-js":"fire-js",[yI]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bc=new Map,_I=new Map,Ch=new Map;function Zg(t,e){try{t.container.addComponent(e)}catch(n){wr.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Li(t){const e=t.name;if(Ch.has(e))return wr.debug(`There were multiple attempts to register component ${e}.`),!1;Ch.set(e,t);for(const n of bc.values())Zg(n,t);for(const n of _I.values())Zg(n,t);return!0}function qf(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Wn(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ns=new Na("app","Firebase",xI);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EI{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ls("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ns.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yi=vI;function zw(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Th,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw ns.create("bad-app-name",{appName:String(s)});if(n||(n=Fw()),!n)throw ns.create("no-options");const i=bc.get(s);if(i){if(Ec(n,i.options)&&Ec(r,i.config))return i;throw ns.create("duplicate-app",{appName:s})}const o=new NS(s);for(const u of Ch.values())o.addComponent(u);const l=new EI(n,r,o);return bc.set(s,l),l}function Ww(t=Th){const e=bc.get(t);if(!e&&t===Th&&Fw())return zw();if(!e)throw ns.create("no-app",{appName:t});return e}function rs(t,e,n){var r;let s=(r=wI[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${s}" with version "${e}":`];i&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),wr.warn(l.join(" "));return}Li(new Ls(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bI="firebase-heartbeat-database",TI=1,ha="firebase-heartbeat-store";let pd=null;function Hw(){return pd||(pd=$S(bI,TI,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(ha)}catch(n){console.warn(n)}}}}).catch(t=>{throw ns.create("idb-open",{originalErrorMessage:t.message})})),pd}async function CI(t){try{const n=(await Hw()).transaction(ha),r=await n.objectStore(ha).get(qw(t));return await n.done,r}catch(e){if(e instanceof Tr)wr.warn(e.message);else{const n=ns.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});wr.warn(n.message)}}}async function ey(t,e){try{const r=(await Hw()).transaction(ha,"readwrite");await r.objectStore(ha).put(e,qw(t)),await r.done}catch(n){if(n instanceof Tr)wr.warn(n.message);else{const r=ns.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});wr.warn(r.message)}}}function qw(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SI=1024,II=30*24*60*60*1e3;class NI{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new kI(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=ty();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const l=new Date(o.date).valueOf();return Date.now()-l<=II}),this._storage.overwrite(this._heartbeatsCache))}catch(r){wr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=ty(),{heartbeatsToSend:r,unsentEntries:s}=PI(this._heartbeatsCache.heartbeats),i=xc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return wr.warn(n),""}}}function ty(){return new Date().toISOString().substring(0,10)}function PI(t,e=SI){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),ny(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),ny(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class kI{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return gS()?yS().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await CI(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return ey(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return ey(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function ny(t){return xc(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AI(t){Li(new Ls("platform-logger",e=>new WS(e),"PRIVATE")),Li(new Ls("heartbeat",e=>new NI(e),"PRIVATE")),rs(bh,Jg,t),rs(bh,Jg,"esm2017"),rs("fire-js","")}AI("");function Gf(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function Gw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const RI=Gw,Kw=new Na("auth","Firebase",Gw());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tc=new Wf("@firebase/auth");function jI(t,...e){Tc.logLevel<=we.WARN&&Tc.warn(`Auth (${Yi}): ${t}`,...e)}function Ul(t,...e){Tc.logLevel<=we.ERROR&&Tc.error(`Auth (${Yi}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jn(t,...e){throw Kf(t,...e)}function Gn(t,...e){return Kf(t,...e)}function Qw(t,e,n){const r=Object.assign(Object.assign({},RI()),{[e]:n});return new Na("auth","Firebase",r).create(e,{appName:t.name})}function fr(t){return Qw(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Kf(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return Kw.create(t,...e)}function ie(t,e,...n){if(!t)throw Kf(e,...n)}function cr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Ul(e),new Error(e)}function _r(t,e){t||cr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sh(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function DI(){return ry()==="http:"||ry()==="https:"}function ry(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(DI()||hS()||"connection"in navigator)?navigator.onLine:!0}function OI(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ka{constructor(e,n){this.shortDelay=e,this.longDelay=n,_r(n>e,"Short delay should be less than long delay!"),this.isMobile=cS()||fS()}get(){return MI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qf(t,e){_r(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yw{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;cr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;cr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;cr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VI=new ka(3e4,6e4);function Cr(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Sr(t,e,n,r,s={}){return Xw(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=Pa(Object.assign({key:t.config.apiKey},o)).slice(1),u=await t._getAdditionalHeaders();u["Content-Type"]="application/json",t.languageCode&&(u["X-Firebase-Locale"]=t.languageCode);const d=Object.assign({method:e,headers:u},i);return dS()||(d.referrerPolicy="no-referrer"),Yw.fetch()(Jw(t,t.config.apiHost,n,l),d)})}async function Xw(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},LI),e);try{const s=new UI(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw bl(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[u,d]=l.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw bl(t,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw bl(t,"email-already-in-use",o);if(u==="USER_DISABLED")throw bl(t,"user-disabled",o);const f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Qw(t,f,d);jn(t,f)}}catch(s){if(s instanceof Tr)throw s;jn(t,"network-request-failed",{message:String(s)})}}async function Aa(t,e,n,r,s={}){const i=await Sr(t,e,n,r,s);return"mfaPendingCredential"in i&&jn(t,"multi-factor-auth-required",{_serverResponse:i}),i}function Jw(t,e,n,r){const s=`${e}${n}?${r}`;return t.config.emulator?Qf(t.config,s):`${t.config.apiScheme}://${s}`}function FI(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class UI{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Gn(this.auth,"network-request-failed")),VI.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function bl(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Gn(t,e,r);return s.customData._tokenResponse=n,s}function sy(t){return t!==void 0&&t.enterprise!==void 0}class $I{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return FI(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function BI(t,e){return Sr(t,"GET","/v2/recaptchaConfig",Cr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zI(t,e){return Sr(t,"POST","/v1/accounts:delete",e)}async function Zw(t,e){return Sr(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bo(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function WI(t,e=!1){const n=at(t),r=await n.getIdToken(e),s=Yf(r);ie(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Bo(gd(s.auth_time)),issuedAtTime:Bo(gd(s.iat)),expirationTime:Bo(gd(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function gd(t){return Number(t)*1e3}function Yf(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Ul("JWT malformed, contained fewer than 3 sections"),null;try{const s=Lw(n);return s?JSON.parse(s):(Ul("Failed to decode base64 JWT payload"),null)}catch(s){return Ul("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function iy(t){const e=Yf(t);return ie(e,"internal-error"),ie(typeof e.exp<"u","internal-error"),ie(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fa(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Tr&&HI(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function HI({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ih{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Bo(this.lastLoginAt),this.creationTime=Bo(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cc(t){var e;const n=t.auth,r=await t.getIdToken(),s=await fa(t,Zw(n,{idToken:r}));ie(s==null?void 0:s.users.length,n,"internal-error");const i=s.users[0];t._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?e_(i.providerUserInfo):[],l=KI(t.providerData,o),u=t.isAnonymous,d=!(t.email&&i.passwordHash)&&!(l!=null&&l.length),f=u?d:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new Ih(i.createdAt,i.lastLoginAt),isAnonymous:f};Object.assign(t,p)}async function GI(t){const e=at(t);await Cc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function KI(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function e_(t){return t.map(e=>{var{providerId:n}=e,r=Gf(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QI(t,e){const n=await Xw(t,{},async()=>{const r=Pa({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=Jw(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",Yw.fetch()(o,{method:"POST",headers:l,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function YI(t,e){return Sr(t,"POST","/v2/accounts:revokeToken",Cr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ie(e.idToken,"internal-error"),ie(typeof e.idToken<"u","internal-error"),ie(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):iy(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){ie(e.length!==0,"internal-error");const n=iy(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(ie(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await QI(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new Si;return r&&(ie(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ie(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ie(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Si,this.toJSON())}_performRefresh(){return cr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jr(t,e){ie(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class ur{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,i=Gf(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new qI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Ih(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await fa(this,this.stsTokenManager.getToken(this.auth,e));return ie(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return WI(this,e)}reload(){return GI(this)}_assign(e){this!==e&&(ie(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new ur(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Cc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Wn(this.auth.app))return Promise.reject(fr(this.auth));const e=await this.getIdToken();return await fa(this,zI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,i,o,l,u,d,f;const p=(r=n.displayName)!==null&&r!==void 0?r:void 0,y=(s=n.email)!==null&&s!==void 0?s:void 0,T=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,S=(o=n.photoURL)!==null&&o!==void 0?o:void 0,A=(l=n.tenantId)!==null&&l!==void 0?l:void 0,k=(u=n._redirectEventId)!==null&&u!==void 0?u:void 0,E=(d=n.createdAt)!==null&&d!==void 0?d:void 0,_=(f=n.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:I,emailVerified:O,isAnonymous:D,providerData:L,stsTokenManager:w}=n;ie(I&&w,e,"internal-error");const g=Si.fromJSON(this.name,w);ie(typeof I=="string",e,"internal-error"),jr(p,e.name),jr(y,e.name),ie(typeof O=="boolean",e,"internal-error"),ie(typeof D=="boolean",e,"internal-error"),jr(T,e.name),jr(S,e.name),jr(A,e.name),jr(k,e.name),jr(E,e.name),jr(_,e.name);const x=new ur({uid:I,auth:e,email:y,emailVerified:O,displayName:p,isAnonymous:D,photoURL:S,phoneNumber:T,tenantId:A,stsTokenManager:g,createdAt:E,lastLoginAt:_});return L&&Array.isArray(L)&&(x.providerData=L.map(b=>Object.assign({},b))),k&&(x._redirectEventId=k),x}static async _fromIdTokenResponse(e,n,r=!1){const s=new Si;s.updateFromServerResponse(n);const i=new ur({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Cc(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];ie(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?e_(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new Si;l.updateFromIdToken(r);const u=new ur({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Ih(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(u,d),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oy=new Map;function dr(t){_r(t instanceof Function,"Expected a class definition");let e=oy.get(t);return e?(_r(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,oy.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t_{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}t_.type="NONE";const ay=t_;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $l(t,e,n){return`firebase:${t}:${e}:${n}`}class Ii{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=$l(this.userKey,s.apiKey,i),this.fullPersistenceKey=$l("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ur._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Ii(dr(ay),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||dr(ay);const o=$l(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const f=await d._get(o);if(f){const p=ur._fromJSON(e,f);d!==i&&(l=p),i=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new Ii(i,e,r):(i=u[0],l&&await i._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new Ii(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ly(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(i_(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(n_(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(a_(e))return"Blackberry";if(l_(e))return"Webos";if(r_(e))return"Safari";if((e.includes("chrome/")||s_(e))&&!e.includes("edge/"))return"Chrome";if(o_(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function n_(t=Ut()){return/firefox\//i.test(t)}function r_(t=Ut()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function s_(t=Ut()){return/crios\//i.test(t)}function i_(t=Ut()){return/iemobile/i.test(t)}function o_(t=Ut()){return/android/i.test(t)}function a_(t=Ut()){return/blackberry/i.test(t)}function l_(t=Ut()){return/webos/i.test(t)}function Xf(t=Ut()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function XI(t=Ut()){var e;return Xf(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function JI(){return mS()&&document.documentMode===10}function c_(t=Ut()){return Xf(t)||o_(t)||l_(t)||a_(t)||/windows phone/i.test(t)||i_(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u_(t,e=[]){let n;switch(t){case"Browser":n=ly(Ut());break;case"Worker":n=`${ly(Ut())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Yi}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZI{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,l)=>{try{const u=e(i);o(u)}catch(u){l(u)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e1(t,e={}){return Sr(t,"GET","/v2/passwordPolicy",Cr(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t1=6;class n1{constructor(e){var n,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:t1,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,s,i,o,l;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(n=u.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(s=u.containsLowercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(i=u.containsUppercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(l=u.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),u}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r1{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new cy(this),this.idTokenSubscription=new cy(this),this.beforeStateQueue=new ZI(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Kw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=dr(n)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Ii.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Zw(this,{idToken:e}),r=await ur._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(Wn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,l=s==null?void 0:s._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===l)&&(u!=null&&u.user)&&(s=u.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Cc(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=OI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Wn(this.app))return Promise.reject(fr(this));const n=e?at(e):null;return n&&ie(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&ie(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Wn(this.app)?Promise.reject(fr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Wn(this.app)?Promise.reject(fr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(dr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await e1(this),n=new n1(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Na("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await YI(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&dr(e)||this._popupRedirectResolver;ie(n,this,"argument-error"),this.redirectPersistenceManager=await Ii.create(this,[dr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(ie(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const u=e.addObserver(n,r,s);return()=>{o=!0,u()}}else{const u=e.addObserver(n);return()=>{o=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=u_(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&jI(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Gs(t){return at(t)}class cy{constructor(e){this.auth=e,this.observer=null,this.addObserver=ES(n=>this.observer=n)}get next(){return ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ru={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function s1(t){ru=t}function d_(t){return ru.loadJS(t)}function i1(){return ru.recaptchaEnterpriseScript}function o1(){return ru.gapiScript}function a1(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const l1="recaptcha-enterprise",c1="NO_RECAPTCHA";class u1{constructor(e){this.type=l1,this.auth=Gs(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,l)=>{BI(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new $I(u);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(u=>{l(u)})})}function s(i,o,l){const u=window.grecaptcha;sy(u)?u.enterprise.ready(()=>{u.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o(c1)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(l=>{if(!n&&sy(window.grecaptcha))s(l,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=i1();u.length!==0&&(u+=l),d_(u).then(()=>{s(l,i,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function uy(t,e,n,r=!1){const s=new u1(t);let i;try{i=await s.verify(n)}catch{i=await s.verify(n,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Nh(t,e,n,r){var s;if(!((s=t._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await uy(t,e,n,n==="getOobCode");return r(t,i)}else return r(t,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await uy(t,e,n,n==="getOobCode");return r(t,o)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d1(t,e){const n=qf(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Ec(i,e??{}))return s;jn(s,"already-initialized")}return n.initialize({options:e})}function h1(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(dr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function f1(t,e,n){const r=Gs(t);ie(r._canInitEmulator,r,"emulator-config-failed"),ie(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(n!=null&&n.disableWarnings),i=h_(e),{host:o,port:l}=m1(e),u=l===null?"":`:${l}`;r.config.emulator={url:`${i}//${o}${u}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||p1()}function h_(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function m1(t){const e=h_(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:dy(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:dy(o)}}}function dy(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function p1(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return cr("not implemented")}_getIdTokenResponse(e){return cr("not implemented")}_linkToIdToken(e,n){return cr("not implemented")}_getReauthenticationResolver(e){return cr("not implemented")}}async function g1(t,e){return Sr(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y1(t,e){return Aa(t,"POST","/v1/accounts:signInWithPassword",Cr(t,e))}async function v1(t,e){return Sr(t,"POST","/v1/accounts:sendOobCode",Cr(t,e))}async function w1(t,e){return v1(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _1(t,e){return Aa(t,"POST","/v1/accounts:signInWithEmailLink",Cr(t,e))}async function x1(t,e){return Aa(t,"POST","/v1/accounts:signInWithEmailLink",Cr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma extends Jf{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new ma(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new ma(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Nh(e,n,"signInWithPassword",y1);case"emailLink":return _1(e,{email:this._email,oobCode:this._password});default:jn(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Nh(e,r,"signUpPassword",g1);case"emailLink":return x1(e,{idToken:n,email:this._email,oobCode:this._password});default:jn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ni(t,e){return Aa(t,"POST","/v1/accounts:signInWithIdp",Cr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E1="http://localhost";class Vs extends Jf{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Vs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):jn("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,i=Gf(n,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Vs(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Ni(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Ni(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Ni(e,n)}buildRequest(){const e={requestUri:E1,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Pa(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b1(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function T1(t){const e=Io(No(t)).link,n=e?Io(No(e)).deep_link_id:null,r=Io(No(t)).deep_link_id;return(r?Io(No(r)).link:null)||r||n||e||t}class Zf{constructor(e){var n,r,s,i,o,l;const u=Io(No(e)),d=(n=u.apiKey)!==null&&n!==void 0?n:null,f=(r=u.oobCode)!==null&&r!==void 0?r:null,p=b1((s=u.mode)!==null&&s!==void 0?s:null);ie(d&&f&&p,"argument-error"),this.apiKey=d,this.operation=p,this.code=f,this.continueUrl=(i=u.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=u.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(l=u.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const n=T1(e);try{return new Zf(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi{constructor(){this.providerId=Xi.PROVIDER_ID}static credential(e,n){return ma._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Zf.parseLink(n);return ie(r,"argument-error"),ma._fromEmailAndCode(e,r.code,r.tenantId)}}Xi.PROVIDER_ID="password";Xi.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Xi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f_{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra extends f_{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr extends Ra{constructor(){super("facebook.com")}static credential(e){return Vs._fromParams({providerId:Vr.PROVIDER_ID,signInMethod:Vr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vr.credentialFromTaggedObject(e)}static credentialFromError(e){return Vr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Vr.credential(e.oauthAccessToken)}catch{return null}}}Vr.FACEBOOK_SIGN_IN_METHOD="facebook.com";Vr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fr extends Ra{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Vs._fromParams({providerId:Fr.PROVIDER_ID,signInMethod:Fr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Fr.credentialFromTaggedObject(e)}static credentialFromError(e){return Fr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Fr.credential(n,r)}catch{return null}}}Fr.GOOGLE_SIGN_IN_METHOD="google.com";Fr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur extends Ra{constructor(){super("github.com")}static credential(e){return Vs._fromParams({providerId:Ur.PROVIDER_ID,signInMethod:Ur.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ur.credentialFromTaggedObject(e)}static credentialFromError(e){return Ur.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ur.credential(e.oauthAccessToken)}catch{return null}}}Ur.GITHUB_SIGN_IN_METHOD="github.com";Ur.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $r extends Ra{constructor(){super("twitter.com")}static credential(e,n){return Vs._fromParams({providerId:$r.PROVIDER_ID,signInMethod:$r.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return $r.credentialFromTaggedObject(e)}static credentialFromError(e){return $r.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return $r.credential(n,r)}catch{return null}}}$r.TWITTER_SIGN_IN_METHOD="twitter.com";$r.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C1(t,e){return Aa(t,"POST","/v1/accounts:signUp",Cr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await ur._fromIdTokenResponse(e,r,s),o=hy(r);return new Fs({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=hy(r);return new Fs({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function hy(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc extends Tr{constructor(e,n,r,s){var i;super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Sc.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new Sc(e,n,r,s)}}function m_(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Sc._fromErrorAndOperation(t,i,e,r):i})}async function S1(t,e,n=!1){const r=await fa(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Fs._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I1(t,e,n=!1){const{auth:r}=t;if(Wn(r.app))return Promise.reject(fr(r));const s="reauthenticate";try{const i=await fa(t,m_(r,s,e,t),n);ie(i.idToken,r,"internal-error");const o=Yf(i.idToken);ie(o,r,"internal-error");const{sub:l}=o;return ie(t.uid===l,r,"user-mismatch"),Fs._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&jn(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p_(t,e,n=!1){if(Wn(t.app))return Promise.reject(fr(t));const r="signIn",s=await m_(t,r,e),i=await Fs._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function N1(t,e){return p_(Gs(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P1(t,e,n){var r;ie(((r=n.url)===null||r===void 0?void 0:r.length)>0,t,"invalid-continue-uri"),ie(typeof n.dynamicLinkDomain>"u"||n.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=n.url,e.dynamicLinkDomain=n.dynamicLinkDomain,e.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(ie(n.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=n.iOS.bundleId),n.android&&(ie(n.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=n.android.installApp,e.androidMinimumVersionCode=n.android.minimumVersion,e.androidPackageName=n.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g_(t){const e=Gs(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function k1(t,e,n){if(Wn(t.app))return Promise.reject(fr(t));const r=Gs(t),o=await Nh(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",C1).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&g_(t),u}),l=await Fs._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(l.user),l}function A1(t,e,n){return Wn(t.app)?Promise.reject(fr(t)):N1(at(t),Xi.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&g_(t),r})}async function R1(t,e){const n=at(t),s={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()};e&&P1(n.auth,s,e);const{email:i}=await w1(n.auth,s);i!==t.email&&await t.reload()}function j1(t,e,n,r){return at(t).onIdTokenChanged(e,n,r)}function D1(t,e,n){return at(t).beforeAuthStateChanged(e,n)}function M1(t,e,n,r){return at(t).onAuthStateChanged(e,n,r)}function y_(t){return at(t).signOut()}const Ic="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v_{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Ic,"1"),this.storage.removeItem(Ic),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O1=1e3,L1=10;class w_ extends v_{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=c_(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,u)=>{this.notifyListeners(o,u)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);JI()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,L1):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},O1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}w_.type="LOCAL";const V1=w_;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __ extends v_{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}__.type="SESSION";const x_=__;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F1(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class su{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new su(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async d=>d(n.origin,i)),u=await F1(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}su.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function em(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U1{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((l,u)=>{const d=em("",20);s.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(p){const y=p;if(y.data.eventId===d)switch(y.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(y.data.response);break;default:clearTimeout(f),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kn(){return window}function $1(t){Kn().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E_(){return typeof Kn().WorkerGlobalScope<"u"&&typeof Kn().importScripts=="function"}async function B1(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function z1(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function W1(){return E_()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b_="firebaseLocalStorageDb",H1=1,Nc="firebaseLocalStorage",T_="fbase_key";class ja{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function iu(t,e){return t.transaction([Nc],e?"readwrite":"readonly").objectStore(Nc)}function q1(){const t=indexedDB.deleteDatabase(b_);return new ja(t).toPromise()}function Ph(){const t=indexedDB.open(b_,H1);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Nc,{keyPath:T_})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Nc)?e(r):(r.close(),await q1(),e(await Ph()))})})}async function fy(t,e,n){const r=iu(t,!0).put({[T_]:e,value:n});return new ja(r).toPromise()}async function G1(t,e){const n=iu(t,!1).get(e),r=await new ja(n).toPromise();return r===void 0?null:r.value}function my(t,e){const n=iu(t,!0).delete(e);return new ja(n).toPromise()}const K1=800,Q1=3;class C_{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Ph(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>Q1)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return E_()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=su._getInstance(W1()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await B1(),!this.activeServiceWorker)return;this.sender=new U1(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||z1()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ph();return await fy(e,Ic,"1"),await my(e,Ic),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>fy(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>G1(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>my(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=iu(s,!1).getAll();return new ja(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),K1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}C_.type="LOCAL";const Y1=C_;new ka(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X1(t,e){return e?dr(e):(ie(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tm extends Jf{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ni(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Ni(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Ni(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function J1(t){return p_(t.auth,new tm(t),t.bypassAuthState)}function Z1(t){const{auth:e,user:n}=t;return ie(n,e,"internal-error"),I1(n,new tm(t),t.bypassAuthState)}async function eN(t){const{auth:e,user:n}=t;return ie(n,e,"internal-error"),S1(n,new tm(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S_{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return J1;case"linkViaPopup":case"linkViaRedirect":return eN;case"reauthViaPopup":case"reauthViaRedirect":return Z1;default:jn(this.auth,"internal-error")}}resolve(e){_r(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){_r(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tN=new ka(2e3,1e4);class wi extends S_{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,wi.currentPopupAction&&wi.currentPopupAction.cancel(),wi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ie(e,this.auth,"internal-error"),e}async onExecution(){_r(this.filter.length===1,"Popup operations only handle one event");const e=em();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Gn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Gn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,wi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Gn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,tN.get())};e()}}wi.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nN="pendingRedirect",Bl=new Map;class rN extends S_{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Bl.get(this.auth._key());if(!e){try{const r=await sN(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Bl.set(this.auth._key(),e)}return this.bypassAuthState||Bl.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function sN(t,e){const n=aN(e),r=oN(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function iN(t,e){Bl.set(t._key(),e)}function oN(t){return dr(t._redirectPersistence)}function aN(t){return $l(nN,t.config.apiKey,t.name)}async function lN(t,e,n=!1){if(Wn(t.app))return Promise.reject(fr(t));const r=Gs(t),s=X1(r,e),o=await new rN(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cN=10*60*1e3;class uN{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!dN(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!I_(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(Gn(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=cN&&this.cachedEventUids.clear(),this.cachedEventUids.has(py(e))}saveEventToCache(e){this.cachedEventUids.add(py(e)),this.lastProcessedEventTime=Date.now()}}function py(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function I_({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function dN(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return I_(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hN(t,e={}){return Sr(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fN=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,mN=/^https?/;async function pN(t){if(t.config.emulator)return;const{authorizedDomains:e}=await hN(t);for(const n of e)try{if(gN(n))return}catch{}jn(t,"unauthorized-domain")}function gN(t){const e=Sh(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!mN.test(n))return!1;if(fN.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yN=new ka(3e4,6e4);function gy(){const t=Kn().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function vN(t){return new Promise((e,n)=>{var r,s,i;function o(){gy(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{gy(),n(Gn(t,"network-request-failed"))},timeout:yN.get()})}if(!((s=(r=Kn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Kn().gapi)===null||i===void 0)&&i.load)o();else{const l=a1("iframefcb");return Kn()[l]=()=>{gapi.load?o():n(Gn(t,"network-request-failed"))},d_(`${o1()}?onload=${l}`).catch(u=>n(u))}}).catch(e=>{throw zl=null,e})}let zl=null;function wN(t){return zl=zl||vN(t),zl}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _N=new ka(5e3,15e3),xN="__/auth/iframe",EN="emulator/auth/iframe",bN={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},TN=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function CN(t){const e=t.config;ie(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Qf(e,EN):`https://${t.config.authDomain}/${xN}`,r={apiKey:e.apiKey,appName:t.name,v:Yi},s=TN.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Pa(r).slice(1)}`}async function SN(t){const e=await wN(t),n=Kn().gapi;return ie(n,t,"internal-error"),e.open({where:document.body,url:CN(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:bN,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Gn(t,"network-request-failed"),l=Kn().setTimeout(()=>{i(o)},_N.get());function u(){Kn().clearTimeout(l),s(r)}r.ping(u).then(u,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IN={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},NN=500,PN=600,kN="_blank",AN="http://localhost";class yy{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function RN(t,e,n,r=NN,s=PN){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const u=Object.assign(Object.assign({},IN),{width:r.toString(),height:s.toString(),top:i,left:o}),d=Ut().toLowerCase();n&&(l=s_(d)?kN:n),n_(d)&&(e=e||AN,u.scrollbars="yes");const f=Object.entries(u).reduce((y,[T,S])=>`${y}${T}=${S},`,"");if(XI(d)&&l!=="_self")return jN(e||"",l),new yy(null);const p=window.open(e||"",l,f);ie(p,t,"popup-blocked");try{p.focus()}catch{}return new yy(p)}function jN(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DN="__/auth/handler",MN="emulator/auth/handler",ON=encodeURIComponent("fac");async function vy(t,e,n,r,s,i){ie(t.config.authDomain,t,"auth-domain-config-required"),ie(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Yi,eventId:s};if(e instanceof f_){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",xS(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,p]of Object.entries(i||{}))o[f]=p}if(e instanceof Ra){const f=e.getScopes().filter(p=>p!=="");f.length>0&&(o.scopes=f.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const u=await t._getAppCheckToken(),d=u?`#${ON}=${encodeURIComponent(u)}`:"";return`${LN(t)}?${Pa(l).slice(1)}${d}`}function LN({config:t}){return t.emulator?Qf(t,MN):`https://${t.authDomain}/${DN}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yd="webStorageSupport";class VN{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=x_,this._completeRedirectFn=lN,this._overrideRedirectResult=iN}async _openPopup(e,n,r,s){var i;_r((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await vy(e,n,r,Sh(),s);return RN(e,o,em())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await vy(e,n,r,Sh(),s);return $1(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(_r(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await SN(e),r=new uN(e);return n.register("authEvent",s=>(ie(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(yd,{type:yd},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[yd];o!==void 0&&n(!!o),jn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=pN(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return c_()||r_()||Xf()}}const FN=VN;var wy="@firebase/auth",_y="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UN{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $N(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function BN(t){Li(new Ls("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;ie(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:u_(t)},d=new r1(r,s,i,u);return h1(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Li(new Ls("auth-internal",e=>{const n=Gs(e.getProvider("auth").getImmediate());return(r=>new UN(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),rs(wy,_y,$N(t)),rs(wy,_y,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zN=5*60,WN=Uw("authIdTokenMaxAge")||zN;let xy=null;const HN=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>WN)return;const s=n==null?void 0:n.token;xy!==s&&(xy=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function qN(t=Ww()){const e=qf(t,"auth");if(e.isInitialized())return e.getImmediate();const n=d1(t,{popupRedirectResolver:FN,persistence:[Y1,V1,x_]}),r=Uw("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=HN(i.toString());D1(n,o,()=>o(n.currentUser)),j1(n,l=>o(l))}}const s=Vw("auth");return s&&f1(n,`http://${s}`),n}function GN(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}s1({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Gn("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",GN().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});BN("Browser");var KN="firebase",QN="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rs(KN,QN,"app");var Ey=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var As,N_;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(w,g){function x(){}x.prototype=g.prototype,w.D=g.prototype,w.prototype=new x,w.prototype.constructor=w,w.C=function(b,P,N){for(var C=Array(arguments.length-2),fe=2;fe<arguments.length;fe++)C[fe-2]=arguments[fe];return g.prototype[P].apply(b,C)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(w,g,x){x||(x=0);var b=Array(16);if(typeof g=="string")for(var P=0;16>P;++P)b[P]=g.charCodeAt(x++)|g.charCodeAt(x++)<<8|g.charCodeAt(x++)<<16|g.charCodeAt(x++)<<24;else for(P=0;16>P;++P)b[P]=g[x++]|g[x++]<<8|g[x++]<<16|g[x++]<<24;g=w.g[0],x=w.g[1],P=w.g[2];var N=w.g[3],C=g+(N^x&(P^N))+b[0]+3614090360&4294967295;g=x+(C<<7&4294967295|C>>>25),C=N+(P^g&(x^P))+b[1]+3905402710&4294967295,N=g+(C<<12&4294967295|C>>>20),C=P+(x^N&(g^x))+b[2]+606105819&4294967295,P=N+(C<<17&4294967295|C>>>15),C=x+(g^P&(N^g))+b[3]+3250441966&4294967295,x=P+(C<<22&4294967295|C>>>10),C=g+(N^x&(P^N))+b[4]+4118548399&4294967295,g=x+(C<<7&4294967295|C>>>25),C=N+(P^g&(x^P))+b[5]+1200080426&4294967295,N=g+(C<<12&4294967295|C>>>20),C=P+(x^N&(g^x))+b[6]+2821735955&4294967295,P=N+(C<<17&4294967295|C>>>15),C=x+(g^P&(N^g))+b[7]+4249261313&4294967295,x=P+(C<<22&4294967295|C>>>10),C=g+(N^x&(P^N))+b[8]+1770035416&4294967295,g=x+(C<<7&4294967295|C>>>25),C=N+(P^g&(x^P))+b[9]+2336552879&4294967295,N=g+(C<<12&4294967295|C>>>20),C=P+(x^N&(g^x))+b[10]+4294925233&4294967295,P=N+(C<<17&4294967295|C>>>15),C=x+(g^P&(N^g))+b[11]+2304563134&4294967295,x=P+(C<<22&4294967295|C>>>10),C=g+(N^x&(P^N))+b[12]+1804603682&4294967295,g=x+(C<<7&4294967295|C>>>25),C=N+(P^g&(x^P))+b[13]+4254626195&4294967295,N=g+(C<<12&4294967295|C>>>20),C=P+(x^N&(g^x))+b[14]+2792965006&4294967295,P=N+(C<<17&4294967295|C>>>15),C=x+(g^P&(N^g))+b[15]+1236535329&4294967295,x=P+(C<<22&4294967295|C>>>10),C=g+(P^N&(x^P))+b[1]+4129170786&4294967295,g=x+(C<<5&4294967295|C>>>27),C=N+(x^P&(g^x))+b[6]+3225465664&4294967295,N=g+(C<<9&4294967295|C>>>23),C=P+(g^x&(N^g))+b[11]+643717713&4294967295,P=N+(C<<14&4294967295|C>>>18),C=x+(N^g&(P^N))+b[0]+3921069994&4294967295,x=P+(C<<20&4294967295|C>>>12),C=g+(P^N&(x^P))+b[5]+3593408605&4294967295,g=x+(C<<5&4294967295|C>>>27),C=N+(x^P&(g^x))+b[10]+38016083&4294967295,N=g+(C<<9&4294967295|C>>>23),C=P+(g^x&(N^g))+b[15]+3634488961&4294967295,P=N+(C<<14&4294967295|C>>>18),C=x+(N^g&(P^N))+b[4]+3889429448&4294967295,x=P+(C<<20&4294967295|C>>>12),C=g+(P^N&(x^P))+b[9]+568446438&4294967295,g=x+(C<<5&4294967295|C>>>27),C=N+(x^P&(g^x))+b[14]+3275163606&4294967295,N=g+(C<<9&4294967295|C>>>23),C=P+(g^x&(N^g))+b[3]+4107603335&4294967295,P=N+(C<<14&4294967295|C>>>18),C=x+(N^g&(P^N))+b[8]+1163531501&4294967295,x=P+(C<<20&4294967295|C>>>12),C=g+(P^N&(x^P))+b[13]+2850285829&4294967295,g=x+(C<<5&4294967295|C>>>27),C=N+(x^P&(g^x))+b[2]+4243563512&4294967295,N=g+(C<<9&4294967295|C>>>23),C=P+(g^x&(N^g))+b[7]+1735328473&4294967295,P=N+(C<<14&4294967295|C>>>18),C=x+(N^g&(P^N))+b[12]+2368359562&4294967295,x=P+(C<<20&4294967295|C>>>12),C=g+(x^P^N)+b[5]+4294588738&4294967295,g=x+(C<<4&4294967295|C>>>28),C=N+(g^x^P)+b[8]+2272392833&4294967295,N=g+(C<<11&4294967295|C>>>21),C=P+(N^g^x)+b[11]+1839030562&4294967295,P=N+(C<<16&4294967295|C>>>16),C=x+(P^N^g)+b[14]+4259657740&4294967295,x=P+(C<<23&4294967295|C>>>9),C=g+(x^P^N)+b[1]+2763975236&4294967295,g=x+(C<<4&4294967295|C>>>28),C=N+(g^x^P)+b[4]+1272893353&4294967295,N=g+(C<<11&4294967295|C>>>21),C=P+(N^g^x)+b[7]+4139469664&4294967295,P=N+(C<<16&4294967295|C>>>16),C=x+(P^N^g)+b[10]+3200236656&4294967295,x=P+(C<<23&4294967295|C>>>9),C=g+(x^P^N)+b[13]+681279174&4294967295,g=x+(C<<4&4294967295|C>>>28),C=N+(g^x^P)+b[0]+3936430074&4294967295,N=g+(C<<11&4294967295|C>>>21),C=P+(N^g^x)+b[3]+3572445317&4294967295,P=N+(C<<16&4294967295|C>>>16),C=x+(P^N^g)+b[6]+76029189&4294967295,x=P+(C<<23&4294967295|C>>>9),C=g+(x^P^N)+b[9]+3654602809&4294967295,g=x+(C<<4&4294967295|C>>>28),C=N+(g^x^P)+b[12]+3873151461&4294967295,N=g+(C<<11&4294967295|C>>>21),C=P+(N^g^x)+b[15]+530742520&4294967295,P=N+(C<<16&4294967295|C>>>16),C=x+(P^N^g)+b[2]+3299628645&4294967295,x=P+(C<<23&4294967295|C>>>9),C=g+(P^(x|~N))+b[0]+4096336452&4294967295,g=x+(C<<6&4294967295|C>>>26),C=N+(x^(g|~P))+b[7]+1126891415&4294967295,N=g+(C<<10&4294967295|C>>>22),C=P+(g^(N|~x))+b[14]+2878612391&4294967295,P=N+(C<<15&4294967295|C>>>17),C=x+(N^(P|~g))+b[5]+4237533241&4294967295,x=P+(C<<21&4294967295|C>>>11),C=g+(P^(x|~N))+b[12]+1700485571&4294967295,g=x+(C<<6&4294967295|C>>>26),C=N+(x^(g|~P))+b[3]+2399980690&4294967295,N=g+(C<<10&4294967295|C>>>22),C=P+(g^(N|~x))+b[10]+4293915773&4294967295,P=N+(C<<15&4294967295|C>>>17),C=x+(N^(P|~g))+b[1]+2240044497&4294967295,x=P+(C<<21&4294967295|C>>>11),C=g+(P^(x|~N))+b[8]+1873313359&4294967295,g=x+(C<<6&4294967295|C>>>26),C=N+(x^(g|~P))+b[15]+4264355552&4294967295,N=g+(C<<10&4294967295|C>>>22),C=P+(g^(N|~x))+b[6]+2734768916&4294967295,P=N+(C<<15&4294967295|C>>>17),C=x+(N^(P|~g))+b[13]+1309151649&4294967295,x=P+(C<<21&4294967295|C>>>11),C=g+(P^(x|~N))+b[4]+4149444226&4294967295,g=x+(C<<6&4294967295|C>>>26),C=N+(x^(g|~P))+b[11]+3174756917&4294967295,N=g+(C<<10&4294967295|C>>>22),C=P+(g^(N|~x))+b[2]+718787259&4294967295,P=N+(C<<15&4294967295|C>>>17),C=x+(N^(P|~g))+b[9]+3951481745&4294967295,w.g[0]=w.g[0]+g&4294967295,w.g[1]=w.g[1]+(P+(C<<21&4294967295|C>>>11))&4294967295,w.g[2]=w.g[2]+P&4294967295,w.g[3]=w.g[3]+N&4294967295}r.prototype.u=function(w,g){g===void 0&&(g=w.length);for(var x=g-this.blockSize,b=this.B,P=this.h,N=0;N<g;){if(P==0)for(;N<=x;)s(this,w,N),N+=this.blockSize;if(typeof w=="string"){for(;N<g;)if(b[P++]=w.charCodeAt(N++),P==this.blockSize){s(this,b),P=0;break}}else for(;N<g;)if(b[P++]=w[N++],P==this.blockSize){s(this,b),P=0;break}}this.h=P,this.o+=g},r.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var g=1;g<w.length-8;++g)w[g]=0;var x=8*this.o;for(g=w.length-8;g<w.length;++g)w[g]=x&255,x/=256;for(this.u(w),w=Array(16),g=x=0;4>g;++g)for(var b=0;32>b;b+=8)w[x++]=this.g[g]>>>b&255;return w};function i(w,g){var x=l;return Object.prototype.hasOwnProperty.call(x,w)?x[w]:x[w]=g(w)}function o(w,g){this.h=g;for(var x=[],b=!0,P=w.length-1;0<=P;P--){var N=w[P]|0;b&&N==g||(x[P]=N,b=!1)}this.g=x}var l={};function u(w){return-128<=w&&128>w?i(w,function(g){return new o([g|0],0>g?-1:0)}):new o([w|0],0>w?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return p;if(0>w)return k(d(-w));for(var g=[],x=1,b=0;w>=x;b++)g[b]=w/x|0,x*=4294967296;return new o(g,0)}function f(w,g){if(w.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(w.charAt(0)=="-")return k(f(w.substring(1),g));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var x=d(Math.pow(g,8)),b=p,P=0;P<w.length;P+=8){var N=Math.min(8,w.length-P),C=parseInt(w.substring(P,P+N),g);8>N?(N=d(Math.pow(g,N)),b=b.j(N).add(d(C))):(b=b.j(x),b=b.add(d(C)))}return b}var p=u(0),y=u(1),T=u(16777216);t=o.prototype,t.m=function(){if(A(this))return-k(this).m();for(var w=0,g=1,x=0;x<this.g.length;x++){var b=this.i(x);w+=(0<=b?b:4294967296+b)*g,g*=4294967296}return w},t.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(S(this))return"0";if(A(this))return"-"+k(this).toString(w);for(var g=d(Math.pow(w,6)),x=this,b="";;){var P=O(x,g).g;x=E(x,P.j(g));var N=((0<x.g.length?x.g[0]:x.h)>>>0).toString(w);if(x=P,S(x))return N+b;for(;6>N.length;)N="0"+N;b=N+b}},t.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function S(w){if(w.h!=0)return!1;for(var g=0;g<w.g.length;g++)if(w.g[g]!=0)return!1;return!0}function A(w){return w.h==-1}t.l=function(w){return w=E(this,w),A(w)?-1:S(w)?0:1};function k(w){for(var g=w.g.length,x=[],b=0;b<g;b++)x[b]=~w.g[b];return new o(x,~w.h).add(y)}t.abs=function(){return A(this)?k(this):this},t.add=function(w){for(var g=Math.max(this.g.length,w.g.length),x=[],b=0,P=0;P<=g;P++){var N=b+(this.i(P)&65535)+(w.i(P)&65535),C=(N>>>16)+(this.i(P)>>>16)+(w.i(P)>>>16);b=C>>>16,N&=65535,C&=65535,x[P]=C<<16|N}return new o(x,x[x.length-1]&-2147483648?-1:0)};function E(w,g){return w.add(k(g))}t.j=function(w){if(S(this)||S(w))return p;if(A(this))return A(w)?k(this).j(k(w)):k(k(this).j(w));if(A(w))return k(this.j(k(w)));if(0>this.l(T)&&0>w.l(T))return d(this.m()*w.m());for(var g=this.g.length+w.g.length,x=[],b=0;b<2*g;b++)x[b]=0;for(b=0;b<this.g.length;b++)for(var P=0;P<w.g.length;P++){var N=this.i(b)>>>16,C=this.i(b)&65535,fe=w.i(P)>>>16,He=w.i(P)&65535;x[2*b+2*P]+=C*He,_(x,2*b+2*P),x[2*b+2*P+1]+=N*He,_(x,2*b+2*P+1),x[2*b+2*P+1]+=C*fe,_(x,2*b+2*P+1),x[2*b+2*P+2]+=N*fe,_(x,2*b+2*P+2)}for(b=0;b<g;b++)x[b]=x[2*b+1]<<16|x[2*b];for(b=g;b<2*g;b++)x[b]=0;return new o(x,0)};function _(w,g){for(;(w[g]&65535)!=w[g];)w[g+1]+=w[g]>>>16,w[g]&=65535,g++}function I(w,g){this.g=w,this.h=g}function O(w,g){if(S(g))throw Error("division by zero");if(S(w))return new I(p,p);if(A(w))return g=O(k(w),g),new I(k(g.g),k(g.h));if(A(g))return g=O(w,k(g)),new I(k(g.g),g.h);if(30<w.g.length){if(A(w)||A(g))throw Error("slowDivide_ only works with positive integers.");for(var x=y,b=g;0>=b.l(w);)x=D(x),b=D(b);var P=L(x,1),N=L(b,1);for(b=L(b,2),x=L(x,2);!S(b);){var C=N.add(b);0>=C.l(w)&&(P=P.add(x),N=C),b=L(b,1),x=L(x,1)}return g=E(w,P.j(g)),new I(P,g)}for(P=p;0<=w.l(g);){for(x=Math.max(1,Math.floor(w.m()/g.m())),b=Math.ceil(Math.log(x)/Math.LN2),b=48>=b?1:Math.pow(2,b-48),N=d(x),C=N.j(g);A(C)||0<C.l(w);)x-=b,N=d(x),C=N.j(g);S(N)&&(N=y),P=P.add(N),w=E(w,C)}return new I(P,w)}t.A=function(w){return O(this,w).h},t.and=function(w){for(var g=Math.max(this.g.length,w.g.length),x=[],b=0;b<g;b++)x[b]=this.i(b)&w.i(b);return new o(x,this.h&w.h)},t.or=function(w){for(var g=Math.max(this.g.length,w.g.length),x=[],b=0;b<g;b++)x[b]=this.i(b)|w.i(b);return new o(x,this.h|w.h)},t.xor=function(w){for(var g=Math.max(this.g.length,w.g.length),x=[],b=0;b<g;b++)x[b]=this.i(b)^w.i(b);return new o(x,this.h^w.h)};function D(w){for(var g=w.g.length+1,x=[],b=0;b<g;b++)x[b]=w.i(b)<<1|w.i(b-1)>>>31;return new o(x,w.h)}function L(w,g){var x=g>>5;g%=32;for(var b=w.g.length-x,P=[],N=0;N<b;N++)P[N]=0<g?w.i(N+x)>>>g|w.i(N+x+1)<<32-g:w.i(N+x);return new o(P,w.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,N_=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=f,As=o}).apply(typeof Ey<"u"?Ey:typeof self<"u"?self:typeof window<"u"?window:{});var Tl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var P_,Po,k_,Wl,kh,A_,R_,j_;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,h,m){return a==Array.prototype||a==Object.prototype||(a[h]=m.value),a};function n(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof Tl=="object"&&Tl];for(var h=0;h<a.length;++h){var m=a[h];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var r=n(this);function s(a,h){if(h)e:{var m=r;a=a.split(".");for(var v=0;v<a.length-1;v++){var M=a[v];if(!(M in m))break e;m=m[M]}a=a[a.length-1],v=m[a],h=h(v),h!=v&&h!=null&&e(m,a,{configurable:!0,writable:!0,value:h})}}function i(a,h){a instanceof String&&(a+="");var m=0,v=!1,M={next:function(){if(!v&&m<a.length){var V=m++;return{value:h(V,a[V]),done:!1}}return v=!0,{done:!0,value:void 0}}};return M[Symbol.iterator]=function(){return M},M}s("Array.prototype.values",function(a){return a||function(){return i(this,function(h,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function u(a){var h=typeof a;return h=h!="object"?h:a?Array.isArray(a)?"array":h:"null",h=="array"||h=="object"&&typeof a.length=="number"}function d(a){var h=typeof a;return h=="object"&&a!=null||h=="function"}function f(a,h,m){return a.call.apply(a.bind,arguments)}function p(a,h,m){if(!a)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var M=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(M,v),a.apply(h,M)}}return function(){return a.apply(h,arguments)}}function y(a,h,m){return y=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:p,y.apply(null,arguments)}function T(a,h){var m=Array.prototype.slice.call(arguments,1);return function(){var v=m.slice();return v.push.apply(v,arguments),a.apply(this,v)}}function S(a,h){function m(){}m.prototype=h.prototype,a.aa=h.prototype,a.prototype=new m,a.prototype.constructor=a,a.Qb=function(v,M,V){for(var X=Array(arguments.length-2),Re=2;Re<arguments.length;Re++)X[Re-2]=arguments[Re];return h.prototype[M].apply(v,X)}}function A(a){const h=a.length;if(0<h){const m=Array(h);for(let v=0;v<h;v++)m[v]=a[v];return m}return[]}function k(a,h){for(let m=1;m<arguments.length;m++){const v=arguments[m];if(u(v)){const M=a.length||0,V=v.length||0;a.length=M+V;for(let X=0;X<V;X++)a[M+X]=v[X]}else a.push(v)}}class E{constructor(h,m){this.i=h,this.j=m,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function _(a){return/^[\s\xa0]*$/.test(a)}function I(){var a=l.navigator;return a&&(a=a.userAgent)?a:""}function O(a){return O[" "](a),a}O[" "]=function(){};var D=I().indexOf("Gecko")!=-1&&!(I().toLowerCase().indexOf("webkit")!=-1&&I().indexOf("Edge")==-1)&&!(I().indexOf("Trident")!=-1||I().indexOf("MSIE")!=-1)&&I().indexOf("Edge")==-1;function L(a,h,m){for(const v in a)h.call(m,a[v],v,a)}function w(a,h){for(const m in a)h.call(void 0,a[m],m,a)}function g(a){const h={};for(const m in a)h[m]=a[m];return h}const x="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(a,h){let m,v;for(let M=1;M<arguments.length;M++){v=arguments[M];for(m in v)a[m]=v[m];for(let V=0;V<x.length;V++)m=x[V],Object.prototype.hasOwnProperty.call(v,m)&&(a[m]=v[m])}}function P(a){var h=1;a=a.split(":");const m=[];for(;0<h&&a.length;)m.push(a.shift()),h--;return a.length&&m.push(a.join(":")),m}function N(a){l.setTimeout(()=>{throw a},0)}function C(){var a=ne;let h=null;return a.g&&(h=a.g,a.g=a.g.next,a.g||(a.h=null),h.next=null),h}class fe{constructor(){this.h=this.g=null}add(h,m){const v=He.get();v.set(h,m),this.h?this.h.next=v:this.g=v,this.h=v}}var He=new E(()=>new nt,a=>a.reset());class nt{constructor(){this.next=this.g=this.h=null}set(h,m){this.h=h,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let Ue,q=!1,ne=new fe,re=()=>{const a=l.Promise.resolve(void 0);Ue=()=>{a.then(Ee)}};var Ee=()=>{for(var a;a=C();){try{a.h.call(a.g)}catch(m){N(m)}var h=He;h.j(a),100>h.h&&(h.h++,a.next=h.g,h.g=a)}q=!1};function pe(){this.s=this.s,this.C=this.C}pe.prototype.s=!1,pe.prototype.ma=function(){this.s||(this.s=!0,this.N())},pe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Se(a,h){this.type=a,this.g=this.target=h,this.defaultPrevented=!1}Se.prototype.h=function(){this.defaultPrevented=!0};var ht=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,h=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const m=()=>{};l.addEventListener("test",m,h),l.removeEventListener("test",m,h)}catch{}return a}();function Pe(a,h){if(Se.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var m=this.type=a.type,v=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=h,h=a.relatedTarget){if(D){e:{try{O(h.nodeName);var M=!0;break e}catch{}M=!1}M||(h=null)}}else m=="mouseover"?h=a.fromElement:m=="mouseout"&&(h=a.toElement);this.relatedTarget=h,v?(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:ft[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Pe.aa.h.call(this)}}S(Pe,Se);var ft={2:"touch",3:"pen",4:"mouse"};Pe.prototype.h=function(){Pe.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Ze="closure_listenable_"+(1e6*Math.random()|0),On=0;function Bt(a,h,m,v,M){this.listener=a,this.proxy=null,this.src=h,this.type=m,this.capture=!!v,this.ha=M,this.key=++On,this.da=this.fa=!1}function G(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function ae(a){this.src=a,this.g={},this.h=0}ae.prototype.add=function(a,h,m,v,M){var V=a.toString();a=this.g[V],a||(a=this.g[V]=[],this.h++);var X=je(a,h,v,M);return-1<X?(h=a[X],m||(h.fa=!1)):(h=new Bt(h,this.src,V,!!v,M),h.fa=m,a.push(h)),h};function le(a,h){var m=h.type;if(m in a.g){var v=a.g[m],M=Array.prototype.indexOf.call(v,h,void 0),V;(V=0<=M)&&Array.prototype.splice.call(v,M,1),V&&(G(h),a.g[m].length==0&&(delete a.g[m],a.h--))}}function je(a,h,m,v){for(var M=0;M<a.length;++M){var V=a[M];if(!V.da&&V.listener==h&&V.capture==!!m&&V.ha==v)return M}return-1}var vt="closure_lm_"+(1e6*Math.random()|0),Me={};function wt(a,h,m,v,M){if(v&&v.once)return F(a,h,m,v,M);if(Array.isArray(h)){for(var V=0;V<h.length;V++)wt(a,h[V],m,v,M);return null}return m=se(m),a&&a[Ze]?a.K(h,m,d(v)?!!v.capture:!!v,M):Qt(a,h,m,!1,v,M)}function Qt(a,h,m,v,M,V){if(!h)throw Error("Invalid event type");var X=d(M)?!!M.capture:!!M,Re=Y(a);if(Re||(a[vt]=Re=new ae(a)),m=Re.add(h,m,v,X,V),m.proxy)return m;if(v=Zn(),m.proxy=v,v.src=a,v.listener=m,a.addEventListener)ht||(M=X),M===void 0&&(M=!1),a.addEventListener(h.toString(),v,M);else if(a.attachEvent)a.attachEvent($(h.toString()),v);else if(a.addListener&&a.removeListener)a.addListener(v);else throw Error("addEventListener and attachEvent are unavailable.");return m}function Zn(){function a(m){return h.call(a.src,a.listener,m)}const h=K;return a}function F(a,h,m,v,M){if(Array.isArray(h)){for(var V=0;V<h.length;V++)F(a,h[V],m,v,M);return null}return m=se(m),a&&a[Ze]?a.L(h,m,d(v)?!!v.capture:!!v,M):Qt(a,h,m,!0,v,M)}function Q(a,h,m,v,M){if(Array.isArray(h))for(var V=0;V<h.length;V++)Q(a,h[V],m,v,M);else v=d(v)?!!v.capture:!!v,m=se(m),a&&a[Ze]?(a=a.i,h=String(h).toString(),h in a.g&&(V=a.g[h],m=je(V,m,v,M),-1<m&&(G(V[m]),Array.prototype.splice.call(V,m,1),V.length==0&&(delete a.g[h],a.h--)))):a&&(a=Y(a))&&(h=a.g[h.toString()],a=-1,h&&(a=je(h,m,v,M)),(m=-1<a?h[a]:null)&&R(m))}function R(a){if(typeof a!="number"&&a&&!a.da){var h=a.src;if(h&&h[Ze])le(h.i,a);else{var m=a.type,v=a.proxy;h.removeEventListener?h.removeEventListener(m,v,a.capture):h.detachEvent?h.detachEvent($(m),v):h.addListener&&h.removeListener&&h.removeListener(v),(m=Y(h))?(le(m,a),m.h==0&&(m.src=null,h[vt]=null)):G(a)}}}function $(a){return a in Me?Me[a]:Me[a]="on"+a}function K(a,h){if(a.da)a=!0;else{h=new Pe(h,this);var m=a.listener,v=a.ha||a.src;a.fa&&R(a),a=m.call(v,h)}return a}function Y(a){return a=a[vt],a instanceof ae?a:null}var oe="__closure_events_fn_"+(1e9*Math.random()>>>0);function se(a){return typeof a=="function"?a:(a[oe]||(a[oe]=function(h){return a.handleEvent(h)}),a[oe])}function me(){pe.call(this),this.i=new ae(this),this.M=this,this.F=null}S(me,pe),me.prototype[Ze]=!0,me.prototype.removeEventListener=function(a,h,m,v){Q(this,a,h,m,v)};function ge(a,h){var m,v=a.F;if(v)for(m=[];v;v=v.F)m.push(v);if(a=a.M,v=h.type||h,typeof h=="string")h=new Se(h,a);else if(h instanceof Se)h.target=h.target||a;else{var M=h;h=new Se(v,a),b(h,M)}if(M=!0,m)for(var V=m.length-1;0<=V;V--){var X=h.g=m[V];M=$e(X,v,!0,h)&&M}if(X=h.g=a,M=$e(X,v,!0,h)&&M,M=$e(X,v,!1,h)&&M,m)for(V=0;V<m.length;V++)X=h.g=m[V],M=$e(X,v,!1,h)&&M}me.prototype.N=function(){if(me.aa.N.call(this),this.i){var a=this.i,h;for(h in a.g){for(var m=a.g[h],v=0;v<m.length;v++)G(m[v]);delete a.g[h],a.h--}}this.F=null},me.prototype.K=function(a,h,m,v){return this.i.add(String(a),h,!1,m,v)},me.prototype.L=function(a,h,m,v){return this.i.add(String(a),h,!0,m,v)};function $e(a,h,m,v){if(h=a.i.g[String(h)],!h)return!0;h=h.concat();for(var M=!0,V=0;V<h.length;++V){var X=h[V];if(X&&!X.da&&X.capture==m){var Re=X.listener,_t=X.ha||X.src;X.fa&&le(a.i,X),M=Re.call(_t,v)!==!1&&M}}return M&&!v.defaultPrevented}function rn(a,h,m){if(typeof a=="function")m&&(a=y(a,m));else if(a&&typeof a.handleEvent=="function")a=y(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:l.setTimeout(a,h||0)}function sn(a){a.g=rn(()=>{a.g=null,a.i&&(a.i=!1,sn(a))},a.l);const h=a.h;a.h=null,a.m.apply(null,h)}class Ir extends pe{constructor(h,m){super(),this.m=h,this.l=m,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:sn(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ln(a){pe.call(this),this.h=a,this.g={}}S(Ln,pe);var Vn=[];function za(a){L(a.g,function(h,m){this.g.hasOwnProperty(m)&&R(h)},a),a.g={}}Ln.prototype.N=function(){Ln.aa.N.call(this),za(this)},Ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var no=l.JSON.stringify,Tu=l.JSON.parse,Cu=class{stringify(a){return l.JSON.stringify(a,void 0)}parse(a){return l.JSON.parse(a,void 0)}};function ro(){}ro.prototype.h=null;function Wa(a){return a.h||(a.h=a.i())}function Ha(){}var ys={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Nr(){Se.call(this,"d")}S(Nr,Se);function U(){Se.call(this,"c")}S(U,Se);var H={},ue=null;function ke(){return ue=ue||new me}H.La="serverreachability";function Be(a){Se.call(this,H.La,a)}S(Be,Se);function Ae(a){const h=ke();ge(h,new Be(h))}H.STAT_EVENT="statevent";function Yt(a,h){Se.call(this,H.STAT_EVENT,a),this.stat=h}S(Yt,Se);function ze(a){const h=ke();ge(h,new Yt(h,a))}H.Ma="timingevent";function Pt(a,h){Se.call(this,H.Ma,a),this.size=h}S(Pt,Se);function er(a,h){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){a()},h)}function so(){this.g=!0}so.prototype.xa=function(){this.g=!1};function tE(a,h,m,v,M,V){a.info(function(){if(a.g)if(V)for(var X="",Re=V.split("&"),_t=0;_t<Re.length;_t++){var Te=Re[_t].split("=");if(1<Te.length){var kt=Te[0];Te=Te[1];var At=kt.split("_");X=2<=At.length&&At[1]=="type"?X+(kt+"="+Te+"&"):X+(kt+"=redacted&")}}else X=null;else X=V;return"XMLHTTP REQ ("+v+") [attempt "+M+"]: "+h+`
`+m+`
`+X})}function nE(a,h,m,v,M,V,X){a.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+M+"]: "+h+`
`+m+`
`+V+" "+X})}function Js(a,h,m,v){a.info(function(){return"XMLHTTP TEXT ("+h+"): "+sE(a,m)+(v?" "+v:"")})}function rE(a,h){a.info(function(){return"TIMEOUT: "+h})}so.prototype.info=function(){};function sE(a,h){if(!a.g)return h;if(!h)return null;try{var m=JSON.parse(h);if(m){for(a=0;a<m.length;a++)if(Array.isArray(m[a])){var v=m[a];if(!(2>v.length)){var M=v[1];if(Array.isArray(M)&&!(1>M.length)){var V=M[0];if(V!="noop"&&V!="stop"&&V!="close")for(var X=1;X<M.length;X++)M[X]=""}}}}return no(m)}catch{return h}}var qa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Hm={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Su;function Ga(){}S(Ga,ro),Ga.prototype.g=function(){return new XMLHttpRequest},Ga.prototype.i=function(){return{}},Su=new Ga;function Pr(a,h,m,v){this.j=a,this.i=h,this.l=m,this.R=v||1,this.U=new Ln(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new qm}function qm(){this.i=null,this.g="",this.h=!1}var Gm={},Iu={};function Nu(a,h,m){a.L=1,a.v=Xa(tr(h)),a.m=m,a.P=!0,Km(a,null)}function Km(a,h){a.F=Date.now(),Ka(a),a.A=tr(a.v);var m=a.A,v=a.R;Array.isArray(v)||(v=[String(v)]),lp(m.i,"t",v),a.C=0,m=a.j.J,a.h=new qm,a.g=Sp(a.j,m?h:null,!a.m),0<a.O&&(a.M=new Ir(y(a.Y,a,a.g),a.O)),h=a.U,m=a.g,v=a.ca;var M="readystatechange";Array.isArray(M)||(M&&(Vn[0]=M.toString()),M=Vn);for(var V=0;V<M.length;V++){var X=wt(m,M[V],v||h.handleEvent,!1,h.h||h);if(!X)break;h.g[X.key]=X}h=a.H?g(a.H):{},a.m?(a.u||(a.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,h)):(a.u="GET",a.g.ea(a.A,a.u,null,h)),Ae(),tE(a.i,a.u,a.A,a.l,a.R,a.m)}Pr.prototype.ca=function(a){a=a.target;const h=this.M;h&&nr(a)==3?h.j():this.Y(a)},Pr.prototype.Y=function(a){try{if(a==this.g)e:{const At=nr(this.g);var h=this.g.Ba();const ti=this.g.Z();if(!(3>At)&&(At!=3||this.g&&(this.h.h||this.g.oa()||pp(this.g)))){this.J||At!=4||h==7||(h==8||0>=ti?Ae(3):Ae(2)),Pu(this);var m=this.g.Z();this.X=m;t:if(Qm(this)){var v=pp(this.g);a="";var M=v.length,V=nr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){vs(this),io(this);var X="";break t}this.h.i=new l.TextDecoder}for(h=0;h<M;h++)this.h.h=!0,a+=this.h.i.decode(v[h],{stream:!(V&&h==M-1)});v.length=0,this.h.g+=a,this.C=0,X=this.h.g}else X=this.g.oa();if(this.o=m==200,nE(this.i,this.u,this.A,this.l,this.R,At,m),this.o){if(this.T&&!this.K){t:{if(this.g){var Re,_t=this.g;if((Re=_t.g?_t.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(Re)){var Te=Re;break t}}Te=null}if(m=Te)Js(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ku(this,m);else{this.o=!1,this.s=3,ze(12),vs(this),io(this);break e}}if(this.P){m=!0;let bn;for(;!this.J&&this.C<X.length;)if(bn=iE(this,X),bn==Iu){At==4&&(this.s=4,ze(14),m=!1),Js(this.i,this.l,null,"[Incomplete Response]");break}else if(bn==Gm){this.s=4,ze(15),Js(this.i,this.l,X,"[Invalid Chunk]"),m=!1;break}else Js(this.i,this.l,bn,null),ku(this,bn);if(Qm(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),At!=4||X.length!=0||this.h.h||(this.s=1,ze(16),m=!1),this.o=this.o&&m,!m)Js(this.i,this.l,X,"[Invalid Chunked Response]"),vs(this),io(this);else if(0<X.length&&!this.W){this.W=!0;var kt=this.j;kt.g==this&&kt.ba&&!kt.M&&(kt.j.info("Great, no buffering proxy detected. Bytes received: "+X.length),Ou(kt),kt.M=!0,ze(11))}}else Js(this.i,this.l,X,null),ku(this,X);At==4&&vs(this),this.o&&!this.J&&(At==4?Ep(this.j,this):(this.o=!1,Ka(this)))}else EE(this.g),m==400&&0<X.indexOf("Unknown SID")?(this.s=3,ze(12)):(this.s=0,ze(13)),vs(this),io(this)}}}catch{}finally{}};function Qm(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function iE(a,h){var m=a.C,v=h.indexOf(`
`,m);return v==-1?Iu:(m=Number(h.substring(m,v)),isNaN(m)?Gm:(v+=1,v+m>h.length?Iu:(h=h.slice(v,v+m),a.C=v+m,h)))}Pr.prototype.cancel=function(){this.J=!0,vs(this)};function Ka(a){a.S=Date.now()+a.I,Ym(a,a.I)}function Ym(a,h){if(a.B!=null)throw Error("WatchDog timer not null");a.B=er(y(a.ba,a),h)}function Pu(a){a.B&&(l.clearTimeout(a.B),a.B=null)}Pr.prototype.ba=function(){this.B=null;const a=Date.now();0<=a-this.S?(rE(this.i,this.A),this.L!=2&&(Ae(),ze(17)),vs(this),this.s=2,io(this)):Ym(this,this.S-a)};function io(a){a.j.G==0||a.J||Ep(a.j,a)}function vs(a){Pu(a);var h=a.M;h&&typeof h.ma=="function"&&h.ma(),a.M=null,za(a.U),a.g&&(h=a.g,a.g=null,h.abort(),h.ma())}function ku(a,h){try{var m=a.j;if(m.G!=0&&(m.g==a||Au(m.h,a))){if(!a.K&&Au(m.h,a)&&m.G==3){try{var v=m.Da.g.parse(h)}catch{v=null}if(Array.isArray(v)&&v.length==3){var M=v;if(M[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<a.F)rl(m),tl(m);else break e;Mu(m),ze(18)}}else m.za=M[1],0<m.za-m.T&&37500>M[2]&&m.F&&m.v==0&&!m.C&&(m.C=er(y(m.Za,m),6e3));if(1>=Zm(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else _s(m,11)}else if((a.K||m.g==a)&&rl(m),!_(h))for(M=m.Da.g.parse(h),h=0;h<M.length;h++){let Te=M[h];if(m.T=Te[0],Te=Te[1],m.G==2)if(Te[0]=="c"){m.K=Te[1],m.ia=Te[2];const kt=Te[3];kt!=null&&(m.la=kt,m.j.info("VER="+m.la));const At=Te[4];At!=null&&(m.Aa=At,m.j.info("SVER="+m.Aa));const ti=Te[5];ti!=null&&typeof ti=="number"&&0<ti&&(v=1.5*ti,m.L=v,m.j.info("backChannelRequestTimeoutMs_="+v)),v=m;const bn=a.g;if(bn){const il=bn.g?bn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(il){var V=v.h;V.g||il.indexOf("spdy")==-1&&il.indexOf("quic")==-1&&il.indexOf("h2")==-1||(V.j=V.l,V.g=new Set,V.h&&(Ru(V,V.h),V.h=null))}if(v.D){const Lu=bn.g?bn.g.getResponseHeader("X-HTTP-Session-Id"):null;Lu&&(v.ya=Lu,Oe(v.I,v.D,Lu))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-a.F,m.j.info("Handshake RTT: "+m.R+"ms")),v=m;var X=a;if(v.qa=Cp(v,v.J?v.ia:null,v.W),X.K){ep(v.h,X);var Re=X,_t=v.L;_t&&(Re.I=_t),Re.B&&(Pu(Re),Ka(Re)),v.g=X}else _p(v);0<m.i.length&&nl(m)}else Te[0]!="stop"&&Te[0]!="close"||_s(m,7);else m.G==3&&(Te[0]=="stop"||Te[0]=="close"?Te[0]=="stop"?_s(m,7):Du(m):Te[0]!="noop"&&m.l&&m.l.ta(Te),m.v=0)}}Ae(4)}catch{}}var oE=class{constructor(a,h){this.g=a,this.map=h}};function Xm(a){this.l=a||10,l.PerformanceNavigationTiming?(a=l.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Jm(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Zm(a){return a.h?1:a.g?a.g.size:0}function Au(a,h){return a.h?a.h==h:a.g?a.g.has(h):!1}function Ru(a,h){a.g?a.g.add(h):a.h=h}function ep(a,h){a.h&&a.h==h?a.h=null:a.g&&a.g.has(h)&&a.g.delete(h)}Xm.prototype.cancel=function(){if(this.i=tp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const a of this.g.values())a.cancel();this.g.clear()}};function tp(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let h=a.i;for(const m of a.g.values())h=h.concat(m.D);return h}return A(a.i)}function aE(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(u(a)){for(var h=[],m=a.length,v=0;v<m;v++)h.push(a[v]);return h}h=[],m=0;for(v in a)h[m++]=a[v];return h}function lE(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(u(a)||typeof a=="string"){var h=[];a=a.length;for(var m=0;m<a;m++)h.push(m);return h}h=[],m=0;for(const v in a)h[m++]=v;return h}}}function np(a,h){if(a.forEach&&typeof a.forEach=="function")a.forEach(h,void 0);else if(u(a)||typeof a=="string")Array.prototype.forEach.call(a,h,void 0);else for(var m=lE(a),v=aE(a),M=v.length,V=0;V<M;V++)h.call(void 0,v[V],m&&m[V],a)}var rp=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function cE(a,h){if(a){a=a.split("&");for(var m=0;m<a.length;m++){var v=a[m].indexOf("="),M=null;if(0<=v){var V=a[m].substring(0,v);M=a[m].substring(v+1)}else V=a[m];h(V,M?decodeURIComponent(M.replace(/\+/g," ")):"")}}}function ws(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof ws){this.h=a.h,Qa(this,a.j),this.o=a.o,this.g=a.g,Ya(this,a.s),this.l=a.l;var h=a.i,m=new lo;m.i=h.i,h.g&&(m.g=new Map(h.g),m.h=h.h),sp(this,m),this.m=a.m}else a&&(h=String(a).match(rp))?(this.h=!1,Qa(this,h[1]||"",!0),this.o=oo(h[2]||""),this.g=oo(h[3]||"",!0),Ya(this,h[4]),this.l=oo(h[5]||"",!0),sp(this,h[6]||"",!0),this.m=oo(h[7]||"")):(this.h=!1,this.i=new lo(null,this.h))}ws.prototype.toString=function(){var a=[],h=this.j;h&&a.push(ao(h,ip,!0),":");var m=this.g;return(m||h=="file")&&(a.push("//"),(h=this.o)&&a.push(ao(h,ip,!0),"@"),a.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&a.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&a.push("/"),a.push(ao(m,m.charAt(0)=="/"?hE:dE,!0))),(m=this.i.toString())&&a.push("?",m),(m=this.m)&&a.push("#",ao(m,mE)),a.join("")};function tr(a){return new ws(a)}function Qa(a,h,m){a.j=m?oo(h,!0):h,a.j&&(a.j=a.j.replace(/:$/,""))}function Ya(a,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);a.s=h}else a.s=null}function sp(a,h,m){h instanceof lo?(a.i=h,pE(a.i,a.h)):(m||(h=ao(h,fE)),a.i=new lo(h,a.h))}function Oe(a,h,m){a.i.set(h,m)}function Xa(a){return Oe(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function oo(a,h){return a?h?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function ao(a,h,m){return typeof a=="string"?(a=encodeURI(a).replace(h,uE),m&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function uE(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var ip=/[#\/\?@]/g,dE=/[#\?:]/g,hE=/[#\?]/g,fE=/[#\?@]/g,mE=/#/g;function lo(a,h){this.h=this.g=null,this.i=a||null,this.j=!!h}function kr(a){a.g||(a.g=new Map,a.h=0,a.i&&cE(a.i,function(h,m){a.add(decodeURIComponent(h.replace(/\+/g," ")),m)}))}t=lo.prototype,t.add=function(a,h){kr(this),this.i=null,a=Zs(this,a);var m=this.g.get(a);return m||this.g.set(a,m=[]),m.push(h),this.h+=1,this};function op(a,h){kr(a),h=Zs(a,h),a.g.has(h)&&(a.i=null,a.h-=a.g.get(h).length,a.g.delete(h))}function ap(a,h){return kr(a),h=Zs(a,h),a.g.has(h)}t.forEach=function(a,h){kr(this),this.g.forEach(function(m,v){m.forEach(function(M){a.call(h,M,v,this)},this)},this)},t.na=function(){kr(this);const a=Array.from(this.g.values()),h=Array.from(this.g.keys()),m=[];for(let v=0;v<h.length;v++){const M=a[v];for(let V=0;V<M.length;V++)m.push(h[v])}return m},t.V=function(a){kr(this);let h=[];if(typeof a=="string")ap(this,a)&&(h=h.concat(this.g.get(Zs(this,a))));else{a=Array.from(this.g.values());for(let m=0;m<a.length;m++)h=h.concat(a[m])}return h},t.set=function(a,h){return kr(this),this.i=null,a=Zs(this,a),ap(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[h]),this.h+=1,this},t.get=function(a,h){return a?(a=this.V(a),0<a.length?String(a[0]):h):h};function lp(a,h,m){op(a,h),0<m.length&&(a.i=null,a.g.set(Zs(a,h),A(m)),a.h+=m.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],h=Array.from(this.g.keys());for(var m=0;m<h.length;m++){var v=h[m];const V=encodeURIComponent(String(v)),X=this.V(v);for(v=0;v<X.length;v++){var M=V;X[v]!==""&&(M+="="+encodeURIComponent(String(X[v]))),a.push(M)}}return this.i=a.join("&")};function Zs(a,h){return h=String(h),a.j&&(h=h.toLowerCase()),h}function pE(a,h){h&&!a.j&&(kr(a),a.i=null,a.g.forEach(function(m,v){var M=v.toLowerCase();v!=M&&(op(this,v),lp(this,M,m))},a)),a.j=h}function gE(a,h){const m=new so;if(l.Image){const v=new Image;v.onload=T(Ar,m,"TestLoadImage: loaded",!0,h,v),v.onerror=T(Ar,m,"TestLoadImage: error",!1,h,v),v.onabort=T(Ar,m,"TestLoadImage: abort",!1,h,v),v.ontimeout=T(Ar,m,"TestLoadImage: timeout",!1,h,v),l.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=a}else h(!1)}function yE(a,h){const m=new so,v=new AbortController,M=setTimeout(()=>{v.abort(),Ar(m,"TestPingServer: timeout",!1,h)},1e4);fetch(a,{signal:v.signal}).then(V=>{clearTimeout(M),V.ok?Ar(m,"TestPingServer: ok",!0,h):Ar(m,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(M),Ar(m,"TestPingServer: error",!1,h)})}function Ar(a,h,m,v,M){try{M&&(M.onload=null,M.onerror=null,M.onabort=null,M.ontimeout=null),v(m)}catch{}}function vE(){this.g=new Cu}function wE(a,h,m){const v=m||"";try{np(a,function(M,V){let X=M;d(M)&&(X=no(M)),h.push(v+V+"="+encodeURIComponent(X))})}catch(M){throw h.push(v+"type="+encodeURIComponent("_badmap")),M}}function Ja(a){this.l=a.Ub||null,this.j=a.eb||!1}S(Ja,ro),Ja.prototype.g=function(){return new Za(this.l,this.j)},Ja.prototype.i=function(a){return function(){return a}}({});function Za(a,h){me.call(this),this.D=a,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}S(Za,me),t=Za.prototype,t.open=function(a,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=h,this.readyState=1,uo(this)},t.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(h.body=a),(this.D||l).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,co(this)),this.readyState=0},t.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,uo(this)),this.g&&(this.readyState=3,uo(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;cp(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function cp(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}t.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var h=a.value?a.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!a.done}))&&(this.response=this.responseText+=h)}a.done?co(this):uo(this),this.readyState==3&&cp(this)}},t.Ra=function(a){this.g&&(this.response=this.responseText=a,co(this))},t.Qa=function(a){this.g&&(this.response=a,co(this))},t.ga=function(){this.g&&co(this)};function co(a){a.readyState=4,a.l=null,a.j=null,a.v=null,uo(a)}t.setRequestHeader=function(a,h){this.u.append(a,h)},t.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],h=this.h.entries();for(var m=h.next();!m.done;)m=m.value,a.push(m[0]+": "+m[1]),m=h.next();return a.join(`\r
`)};function uo(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Za.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function up(a){let h="";return L(a,function(m,v){h+=v,h+=":",h+=m,h+=`\r
`}),h}function ju(a,h,m){e:{for(v in m){var v=!1;break e}v=!0}v||(m=up(m),typeof a=="string"?m!=null&&encodeURIComponent(String(m)):Oe(a,h,m))}function Xe(a){me.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}S(Xe,me);var _E=/^https?$/i,xE=["POST","PUT"];t=Xe.prototype,t.Ha=function(a){this.J=a},t.ea=function(a,h,m,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);h=h?h.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Su.g(),this.v=this.o?Wa(this.o):Wa(Su),this.g.onreadystatechange=y(this.Ea,this);try{this.B=!0,this.g.open(h,String(a),!0),this.B=!1}catch(V){dp(this,V);return}if(a=m||"",m=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var M in v)m.set(M,v[M]);else if(typeof v.keys=="function"&&typeof v.get=="function")for(const V of v.keys())m.set(V,v.get(V));else throw Error("Unknown input type for opt_headers: "+String(v));v=Array.from(m.keys()).find(V=>V.toLowerCase()=="content-type"),M=l.FormData&&a instanceof l.FormData,!(0<=Array.prototype.indexOf.call(xE,h,void 0))||v||M||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[V,X]of m)this.g.setRequestHeader(V,X);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{mp(this),this.u=!0,this.g.send(a),this.u=!1}catch(V){dp(this,V)}};function dp(a,h){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=h,a.m=5,hp(a),el(a)}function hp(a){a.A||(a.A=!0,ge(a,"complete"),ge(a,"error"))}t.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,ge(this,"complete"),ge(this,"abort"),el(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),el(this,!0)),Xe.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?fp(this):this.bb())},t.bb=function(){fp(this)};function fp(a){if(a.h&&typeof o<"u"&&(!a.v[1]||nr(a)!=4||a.Z()!=2)){if(a.u&&nr(a)==4)rn(a.Ea,0,a);else if(ge(a,"readystatechange"),nr(a)==4){a.h=!1;try{const X=a.Z();e:switch(X){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var m;if(!(m=h)){var v;if(v=X===0){var M=String(a.D).match(rp)[1]||null;!M&&l.self&&l.self.location&&(M=l.self.location.protocol.slice(0,-1)),v=!_E.test(M?M.toLowerCase():"")}m=v}if(m)ge(a,"complete"),ge(a,"success");else{a.m=6;try{var V=2<nr(a)?a.g.statusText:""}catch{V=""}a.l=V+" ["+a.Z()+"]",hp(a)}}finally{el(a)}}}}function el(a,h){if(a.g){mp(a);const m=a.g,v=a.v[0]?()=>{}:null;a.g=null,a.v=null,h||ge(a,"ready");try{m.onreadystatechange=v}catch{}}}function mp(a){a.I&&(l.clearTimeout(a.I),a.I=null)}t.isActive=function(){return!!this.g};function nr(a){return a.g?a.g.readyState:0}t.Z=function(){try{return 2<nr(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(a){if(this.g){var h=this.g.responseText;return a&&h.indexOf(a)==0&&(h=h.substring(a.length)),Tu(h)}};function pp(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function EE(a){const h={};a=(a.g&&2<=nr(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let v=0;v<a.length;v++){if(_(a[v]))continue;var m=P(a[v]);const M=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const V=h[M]||[];h[M]=V,V.push(m)}w(h,function(v){return v.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ho(a,h,m){return m&&m.internalChannelParams&&m.internalChannelParams[a]||h}function gp(a){this.Aa=0,this.i=[],this.j=new so,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ho("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ho("baseRetryDelayMs",5e3,a),this.cb=ho("retryDelaySeedMs",1e4,a),this.Wa=ho("forwardChannelMaxRetries",2,a),this.wa=ho("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new Xm(a&&a.concurrentRequestLimit),this.Da=new vE,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=gp.prototype,t.la=8,t.G=1,t.connect=function(a,h,m,v){ze(0),this.W=a,this.H=h||{},m&&v!==void 0&&(this.H.OSID=m,this.H.OAID=v),this.F=this.X,this.I=Cp(this,null,this.W),nl(this)};function Du(a){if(yp(a),a.G==3){var h=a.U++,m=tr(a.I);if(Oe(m,"SID",a.K),Oe(m,"RID",h),Oe(m,"TYPE","terminate"),fo(a,m),h=new Pr(a,a.j,h),h.L=2,h.v=Xa(tr(m)),m=!1,l.navigator&&l.navigator.sendBeacon)try{m=l.navigator.sendBeacon(h.v.toString(),"")}catch{}!m&&l.Image&&(new Image().src=h.v,m=!0),m||(h.g=Sp(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Ka(h)}Tp(a)}function tl(a){a.g&&(Ou(a),a.g.cancel(),a.g=null)}function yp(a){tl(a),a.u&&(l.clearTimeout(a.u),a.u=null),rl(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&l.clearTimeout(a.s),a.s=null)}function nl(a){if(!Jm(a.h)&&!a.s){a.s=!0;var h=a.Ga;Ue||re(),q||(Ue(),q=!0),ne.add(h,a),a.B=0}}function bE(a,h){return Zm(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=h.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=er(y(a.Ga,a,h),bp(a,a.B)),a.B++,!0)}t.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;const M=new Pr(this,this.j,a);let V=this.o;if(this.S&&(V?(V=g(V),b(V,this.S)):V=this.S),this.m!==null||this.O||(M.H=V,V=null),this.P)e:{for(var h=0,m=0;m<this.i.length;m++){t:{var v=this.i[m];if("__data__"in v.map&&(v=v.map.__data__,typeof v=="string")){v=v.length;break t}v=void 0}if(v===void 0)break;if(h+=v,4096<h){h=m;break e}if(h===4096||m===this.i.length-1){h=m+1;break e}}h=1e3}else h=1e3;h=wp(this,M,h),m=tr(this.I),Oe(m,"RID",a),Oe(m,"CVER",22),this.D&&Oe(m,"X-HTTP-Session-Id",this.D),fo(this,m),V&&(this.O?h="headers="+encodeURIComponent(String(up(V)))+"&"+h:this.m&&ju(m,this.m,V)),Ru(this.h,M),this.Ua&&Oe(m,"TYPE","init"),this.P?(Oe(m,"$req",h),Oe(m,"SID","null"),M.T=!0,Nu(M,m,null)):Nu(M,m,h),this.G=2}}else this.G==3&&(a?vp(this,a):this.i.length==0||Jm(this.h)||vp(this))};function vp(a,h){var m;h?m=h.l:m=a.U++;const v=tr(a.I);Oe(v,"SID",a.K),Oe(v,"RID",m),Oe(v,"AID",a.T),fo(a,v),a.m&&a.o&&ju(v,a.m,a.o),m=new Pr(a,a.j,m,a.B+1),a.m===null&&(m.H=a.o),h&&(a.i=h.D.concat(a.i)),h=wp(a,m,1e3),m.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),Ru(a.h,m),Nu(m,v,h)}function fo(a,h){a.H&&L(a.H,function(m,v){Oe(h,v,m)}),a.l&&np({},function(m,v){Oe(h,v,m)})}function wp(a,h,m){m=Math.min(a.i.length,m);var v=a.l?y(a.l.Na,a.l,a):null;e:{var M=a.i;let V=-1;for(;;){const X=["count="+m];V==-1?0<m?(V=M[0].g,X.push("ofs="+V)):V=0:X.push("ofs="+V);let Re=!0;for(let _t=0;_t<m;_t++){let Te=M[_t].g;const kt=M[_t].map;if(Te-=V,0>Te)V=Math.max(0,M[_t].g-100),Re=!1;else try{wE(kt,X,"req"+Te+"_")}catch{v&&v(kt)}}if(Re){v=X.join("&");break e}}}return a=a.i.splice(0,m),h.D=a,v}function _p(a){if(!a.g&&!a.u){a.Y=1;var h=a.Fa;Ue||re(),q||(Ue(),q=!0),ne.add(h,a),a.v=0}}function Mu(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=er(y(a.Fa,a),bp(a,a.v)),a.v++,!0)}t.Fa=function(){if(this.u=null,xp(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=er(y(this.ab,this),a)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ze(10),tl(this),xp(this))};function Ou(a){a.A!=null&&(l.clearTimeout(a.A),a.A=null)}function xp(a){a.g=new Pr(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var h=tr(a.qa);Oe(h,"RID","rpc"),Oe(h,"SID",a.K),Oe(h,"AID",a.T),Oe(h,"CI",a.F?"0":"1"),!a.F&&a.ja&&Oe(h,"TO",a.ja),Oe(h,"TYPE","xmlhttp"),fo(a,h),a.m&&a.o&&ju(h,a.m,a.o),a.L&&(a.g.I=a.L);var m=a.g;a=a.ia,m.L=1,m.v=Xa(tr(h)),m.m=null,m.P=!0,Km(m,a)}t.Za=function(){this.C!=null&&(this.C=null,tl(this),Mu(this),ze(19))};function rl(a){a.C!=null&&(l.clearTimeout(a.C),a.C=null)}function Ep(a,h){var m=null;if(a.g==h){rl(a),Ou(a),a.g=null;var v=2}else if(Au(a.h,h))m=h.D,ep(a.h,h),v=1;else return;if(a.G!=0){if(h.o)if(v==1){m=h.m?h.m.length:0,h=Date.now()-h.F;var M=a.B;v=ke(),ge(v,new Pt(v,m)),nl(a)}else _p(a);else if(M=h.s,M==3||M==0&&0<h.X||!(v==1&&bE(a,h)||v==2&&Mu(a)))switch(m&&0<m.length&&(h=a.h,h.i=h.i.concat(m)),M){case 1:_s(a,5);break;case 4:_s(a,10);break;case 3:_s(a,6);break;default:_s(a,2)}}}function bp(a,h){let m=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(m*=2),m*h}function _s(a,h){if(a.j.info("Error code "+h),h==2){var m=y(a.fb,a),v=a.Xa;const M=!v;v=new ws(v||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Qa(v,"https"),Xa(v),M?gE(v.toString(),m):yE(v.toString(),m)}else ze(2);a.G=0,a.l&&a.l.sa(h),Tp(a),yp(a)}t.fb=function(a){a?(this.j.info("Successfully pinged google.com"),ze(2)):(this.j.info("Failed to ping google.com"),ze(1))};function Tp(a){if(a.G=0,a.ka=[],a.l){const h=tp(a.h);(h.length!=0||a.i.length!=0)&&(k(a.ka,h),k(a.ka,a.i),a.h.i.length=0,A(a.i),a.i.length=0),a.l.ra()}}function Cp(a,h,m){var v=m instanceof ws?tr(m):new ws(m);if(v.g!="")h&&(v.g=h+"."+v.g),Ya(v,v.s);else{var M=l.location;v=M.protocol,h=h?h+"."+M.hostname:M.hostname,M=+M.port;var V=new ws(null);v&&Qa(V,v),h&&(V.g=h),M&&Ya(V,M),m&&(V.l=m),v=V}return m=a.D,h=a.ya,m&&h&&Oe(v,m,h),Oe(v,"VER",a.la),fo(a,v),v}function Sp(a,h,m){if(h&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=a.Ca&&!a.pa?new Xe(new Ja({eb:m})):new Xe(a.pa),h.Ha(a.J),h}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ip(){}t=Ip.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function sl(){}sl.prototype.g=function(a,h){return new on(a,h)};function on(a,h){me.call(this),this.g=new gp(h),this.l=a,this.h=h&&h.messageUrlParams||null,a=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(a?a["X-WebChannel-Content-Type"]=h.messageContentType:a={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(a?a["X-WebChannel-Client-Profile"]=h.va:a={"X-WebChannel-Client-Profile":h.va}),this.g.S=a,(a=h&&h.Sb)&&!_(a)&&(this.g.m=a),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!_(h)&&(this.g.D=h,a=this.h,a!==null&&h in a&&(a=this.h,h in a&&delete a[h])),this.j=new ei(this)}S(on,me),on.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},on.prototype.close=function(){Du(this.g)},on.prototype.o=function(a){var h=this.g;if(typeof a=="string"){var m={};m.__data__=a,a=m}else this.u&&(m={},m.__data__=no(a),a=m);h.i.push(new oE(h.Ya++,a)),h.G==3&&nl(h)},on.prototype.N=function(){this.g.l=null,delete this.j,Du(this.g),delete this.g,on.aa.N.call(this)};function Np(a){Nr.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var h=a.__sm__;if(h){e:{for(const m in h){a=m;break e}a=void 0}(this.i=a)&&(a=this.i,h=h!==null&&a in h?h[a]:void 0),this.data=h}else this.data=a}S(Np,Nr);function Pp(){U.call(this),this.status=1}S(Pp,U);function ei(a){this.g=a}S(ei,Ip),ei.prototype.ua=function(){ge(this.g,"a")},ei.prototype.ta=function(a){ge(this.g,new Np(a))},ei.prototype.sa=function(a){ge(this.g,new Pp)},ei.prototype.ra=function(){ge(this.g,"b")},sl.prototype.createWebChannel=sl.prototype.g,on.prototype.send=on.prototype.o,on.prototype.open=on.prototype.m,on.prototype.close=on.prototype.close,j_=function(){return new sl},R_=function(){return ke()},A_=H,kh={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},qa.NO_ERROR=0,qa.TIMEOUT=8,qa.HTTP_ERROR=6,Wl=qa,Hm.COMPLETE="complete",k_=Hm,Ha.EventType=ys,ys.OPEN="a",ys.CLOSE="b",ys.ERROR="c",ys.MESSAGE="d",me.prototype.listen=me.prototype.K,Po=Ha,Xe.prototype.listenOnce=Xe.prototype.L,Xe.prototype.getLastError=Xe.prototype.Ka,Xe.prototype.getLastErrorCode=Xe.prototype.Ba,Xe.prototype.getStatus=Xe.prototype.Z,Xe.prototype.getResponseJson=Xe.prototype.Oa,Xe.prototype.getResponseText=Xe.prototype.oa,Xe.prototype.send=Xe.prototype.ea,Xe.prototype.setWithCredentials=Xe.prototype.Ha,P_=Xe}).apply(typeof Tl<"u"?Tl:typeof self<"u"?self:typeof window<"u"?window:{});const by="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Mt.UNAUTHENTICATED=new Mt(null),Mt.GOOGLE_CREDENTIALS=new Mt("google-credentials-uid"),Mt.FIRST_PARTY=new Mt("first-party-uid"),Mt.MOCK_USER=new Mt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ji="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Us=new Wf("@firebase/firestore");function Eo(){return Us.logLevel}function ee(t,...e){if(Us.logLevel<=we.DEBUG){const n=e.map(nm);Us.debug(`Firestore (${Ji}): ${t}`,...n)}}function xr(t,...e){if(Us.logLevel<=we.ERROR){const n=e.map(nm);Us.error(`Firestore (${Ji}): ${t}`,...n)}}function Vi(t,...e){if(Us.logLevel<=we.WARN){const n=e.map(nm);Us.warn(`Firestore (${Ji}): ${t}`,...n)}}function nm(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ce(t="Unexpected state"){const e=`FIRESTORE (${Ji}) INTERNAL ASSERTION FAILED: `+t;throw xr(e),new Error(e)}function Ne(t,e){t||ce()}function he(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Z extends Tr{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D_{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class YN{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Mt.UNAUTHENTICATED))}shutdown(){}}class XN{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class JN{constructor(e){this.t=e,this.currentUser=Mt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Ne(this.o===void 0);let r=this.i;const s=u=>this.i!==r?(r=this.i,n(u)):Promise.resolve();let i=new mr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new mr,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const u=i;e.enqueueRetryable(async()=>{await u.promise,await s(this.currentUser)})},l=u=>{ee("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>l(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(ee("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new mr)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(ee("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ne(typeof r.accessToken=="string"),new D_(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ne(e===null||typeof e=="string"),new Mt(e)}}class ZN{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=Mt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class eP{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new ZN(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(Mt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class tP{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class nP{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){Ne(this.o===void 0);const r=i=>{i.error!=null&&ee("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,ee("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{ee("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):ee("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Ne(typeof n.token=="string"),this.R=n.token,new tP(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rP(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M_{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=rP(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%e.length))}return r}}function Ce(t,e){return t<e?-1:t>e?1:0}function Fi(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dt{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Z(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Z(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new Z(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Z(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return dt.fromMillis(Date.now())}static fromDate(e){return dt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new dt(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ce(this.nanoseconds,e.nanoseconds):Ce(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class de{constructor(e){this.timestamp=e}static fromTimestamp(e){return new de(e)}static min(){return new de(new dt(0,0))}static max(){return new de(new dt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa{constructor(e,n,r){n===void 0?n=0:n>e.length&&ce(),r===void 0?r=e.length-n:r>e.length-n&&ce(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return pa.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof pa?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=e.get(s),o=n.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class Ve extends pa{construct(e,n,r){return new Ve(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Z(B.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new Ve(n)}static emptyPath(){return new Ve([])}}const sP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class bt extends pa{construct(e,n,r){return new bt(e,n,r)}static isValidIdentifier(e){return sP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),bt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new bt(["__name__"])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Z(B.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new Z(B.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new Z(B.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else l==="`"?(o=!o,s++):l!=="."||o?(r+=l,s++):(i(),s++)}if(i(),o)throw new Z(B.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new bt(n)}static emptyPath(){return new bt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e){this.path=e}static fromPath(e){return new te(Ve.fromString(e))}static fromName(e){return new te(Ve.fromString(e).popFirst(5))}static empty(){return new te(Ve.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ve.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ve.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new te(new Ve(e.slice()))}}function iP(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=de.fromTimestamp(r===1e9?new dt(n+1,0):new dt(n,r));return new as(s,te.empty(),e)}function oP(t){return new as(t.readTime,t.key,-1)}class as{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new as(de.min(),te.empty(),-1)}static max(){return new as(de.max(),te.empty(),-1)}}function aP(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=te.comparator(t.documentKey,e.documentKey),n!==0?n:Ce(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lP="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class cP{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Da(t){if(t.code!==B.FAILED_PRECONDITION||t.message!==lP)throw t;ee("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ce(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new z((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof z?n:z.resolve(n)}catch(n){return z.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):z.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):z.reject(n)}static resolve(e){return new z((n,r)=>{n(e)})}static reject(e){return new z((n,r)=>{r(e)})}static waitFor(e){return new z((n,r)=>{let s=0,i=0,o=!1;e.forEach(l=>{++s,l.next(()=>{++i,o&&i===s&&n()},u=>r(u))}),o=!0,i===s&&n()})}static or(e){let n=z.resolve(!1);for(const r of e)n=n.next(s=>s?z.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new z((r,s)=>{const i=e.length,o=new Array(i);let l=0;for(let u=0;u<i;u++){const d=u;n(e[d]).next(f=>{o[d]=f,++l,l===i&&r(o)},f=>s(f))}})}static doWhile(e,n){return new z((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}function uP(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Ma(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}rm.oe=-1;function ou(t){return t==null}function Pc(t){return t===0&&1/t==-1/0}function dP(t){return typeof t=="number"&&Number.isInteger(t)&&!Pc(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ty(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ks(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function O_(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qe{constructor(e,n){this.comparator=e,this.root=n||Et.EMPTY}insert(e,n){return new Qe(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Et.BLACK,null,null))}remove(e){return new Qe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Et.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Cl(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Cl(this.root,e,this.comparator,!1)}getReverseIterator(){return new Cl(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Cl(this.root,e,this.comparator,!0)}}class Cl{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Et{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??Et.RED,this.left=s??Et.EMPTY,this.right=i??Et.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new Et(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Et.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return Et.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Et.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Et.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ce();const e=this.left.check();if(e!==this.right.check())throw ce();return e+(this.isRed()?0:1)}}Et.EMPTY=null,Et.RED=!0,Et.BLACK=!1;Et.EMPTY=new class{constructor(){this.size=0}get key(){throw ce()}get value(){throw ce()}get color(){throw ce()}get left(){throw ce()}get right(){throw ce()}copy(e,n,r,s,i){return this}insert(e,n,r){return new Et(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e){this.comparator=e,this.data=new Qe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Cy(this.data.getIterator())}getIteratorFrom(e){return new Cy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof Ct)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Ct(this.comparator);return n.data=e,n}}class Cy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn{constructor(e){this.fields=e,e.sort(bt.comparator)}static empty(){return new cn([])}unionWith(e){let n=new Ct(bt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new cn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Fi(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L_ extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new L_("Invalid base64 string: "+i):i}}(e);return new It(n)}static fromUint8Array(e){const n=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new It(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ce(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}It.EMPTY_BYTE_STRING=new It("");const hP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ls(t){if(Ne(!!t),typeof t=="string"){let e=0;const n=hP.exec(t);if(Ne(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:et(t.seconds),nanos:et(t.nanos)}}function et(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function $s(t){return typeof t=="string"?It.fromBase64String(t):It.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sm(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function im(t){const e=t.mapValue.fields.__previous_value__;return sm(e)?im(e):e}function ga(t){const e=ls(t.mapValue.fields.__local_write_time__.timestampValue);return new dt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fP{constructor(e,n,r,s,i,o,l,u,d){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=d}}class ya{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new ya("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ya&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sl={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Bs(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?sm(t)?4:pP(t)?9007199254740991:mP(t)?10:11:ce()}function Xn(t,e){if(t===e)return!0;const n=Bs(t);if(n!==Bs(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ga(t).isEqual(ga(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=ls(s.timestampValue),l=ls(i.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return $s(s.bytesValue).isEqual($s(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return et(s.geoPointValue.latitude)===et(i.geoPointValue.latitude)&&et(s.geoPointValue.longitude)===et(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return et(s.integerValue)===et(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=et(s.doubleValue),l=et(i.doubleValue);return o===l?Pc(o)===Pc(l):isNaN(o)&&isNaN(l)}return!1}(t,e);case 9:return Fi(t.arrayValue.values||[],e.arrayValue.values||[],Xn);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},l=i.mapValue.fields||{};if(Ty(o)!==Ty(l))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(l[u]===void 0||!Xn(o[u],l[u])))return!1;return!0}(t,e);default:return ce()}}function va(t,e){return(t.values||[]).find(n=>Xn(n,e))!==void 0}function Ui(t,e){if(t===e)return 0;const n=Bs(t),r=Bs(e);if(n!==r)return Ce(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ce(t.booleanValue,e.booleanValue);case 2:return function(i,o){const l=et(i.integerValue||i.doubleValue),u=et(o.integerValue||o.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1}(t,e);case 3:return Sy(t.timestampValue,e.timestampValue);case 4:return Sy(ga(t),ga(e));case 5:return Ce(t.stringValue,e.stringValue);case 6:return function(i,o){const l=$s(i),u=$s(o);return l.compareTo(u)}(t.bytesValue,e.bytesValue);case 7:return function(i,o){const l=i.split("/"),u=o.split("/");for(let d=0;d<l.length&&d<u.length;d++){const f=Ce(l[d],u[d]);if(f!==0)return f}return Ce(l.length,u.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,o){const l=Ce(et(i.latitude),et(o.latitude));return l!==0?l:Ce(et(i.longitude),et(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Iy(t.arrayValue,e.arrayValue);case 10:return function(i,o){var l,u,d,f;const p=i.fields||{},y=o.fields||{},T=(l=p.value)===null||l===void 0?void 0:l.arrayValue,S=(u=y.value)===null||u===void 0?void 0:u.arrayValue,A=Ce(((d=T==null?void 0:T.values)===null||d===void 0?void 0:d.length)||0,((f=S==null?void 0:S.values)===null||f===void 0?void 0:f.length)||0);return A!==0?A:Iy(T,S)}(t.mapValue,e.mapValue);case 11:return function(i,o){if(i===Sl.mapValue&&o===Sl.mapValue)return 0;if(i===Sl.mapValue)return 1;if(o===Sl.mapValue)return-1;const l=i.fields||{},u=Object.keys(l),d=o.fields||{},f=Object.keys(d);u.sort(),f.sort();for(let p=0;p<u.length&&p<f.length;++p){const y=Ce(u[p],f[p]);if(y!==0)return y;const T=Ui(l[u[p]],d[f[p]]);if(T!==0)return T}return Ce(u.length,f.length)}(t.mapValue,e.mapValue);default:throw ce()}}function Sy(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Ce(t,e);const n=ls(t),r=ls(e),s=Ce(n.seconds,r.seconds);return s!==0?s:Ce(n.nanos,r.nanos)}function Iy(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=Ui(n[s],r[s]);if(i)return i}return Ce(n.length,r.length)}function $i(t){return Ah(t)}function Ah(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=ls(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return $s(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return te.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=Ah(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Ah(n.fields[o])}`;return s+"}"}(t.mapValue):ce()}function Ny(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Rh(t){return!!t&&"integerValue"in t}function om(t){return!!t&&"arrayValue"in t}function Py(t){return!!t&&"nullValue"in t}function ky(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Hl(t){return!!t&&"mapValue"in t}function mP(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function zo(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ks(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=zo(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=zo(t.arrayValue.values[n]);return e}return Object.assign({},t)}function pP(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jt{constructor(e){this.value=e}static empty(){return new Jt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Hl(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=zo(n)}setAll(e){let n=bt.emptyPath(),r={},s=[];e.forEach((o,l)=>{if(!n.isImmediateParentOf(l)){const u=this.getFieldsMap(n);this.applyChanges(u,r,s),r={},s=[],n=l.popLast()}o?r[l.lastSegment()]=zo(o):s.push(l.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());Hl(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Xn(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Hl(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Ks(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Jt(zo(this.value))}}function V_(t){const e=[];return Ks(t.fields,(n,r)=>{const s=new bt([n]);if(Hl(r)){const i=V_(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new cn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(e,n,r,s,i,o,l){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=l}static newInvalidDocument(e){return new Lt(e,0,de.min(),de.min(),de.min(),Jt.empty(),0)}static newFoundDocument(e,n,r,s){return new Lt(e,1,n,de.min(),r,s,0)}static newNoDocument(e,n){return new Lt(e,2,n,de.min(),de.min(),Jt.empty(),0)}static newUnknownDocument(e,n){return new Lt(e,3,n,de.min(),de.min(),Jt.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(de.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Jt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Jt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=de.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Lt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Lt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kc{constructor(e,n){this.position=e,this.inclusive=n}}function Ay(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(i.field.isKeyField()?r=te.comparator(te.fromName(o.referenceValue),n.key):r=Ui(o,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ry(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Xn(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac{constructor(e,n="asc"){this.field=e,this.dir=n}}function gP(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F_{}class it extends F_{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new vP(e,n,r):n==="array-contains"?new xP(e,r):n==="in"?new EP(e,r):n==="not-in"?new bP(e,r):n==="array-contains-any"?new TP(e,r):new it(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new wP(e,r):new _P(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(Ui(n,this.value)):n!==null&&Bs(this.value)===Bs(n)&&this.matchesComparison(Ui(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ce()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Dn extends F_{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new Dn(e,n)}matches(e){return U_(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function U_(t){return t.op==="and"}function $_(t){return yP(t)&&U_(t)}function yP(t){for(const e of t.filters)if(e instanceof Dn)return!1;return!0}function jh(t){if(t instanceof it)return t.field.canonicalString()+t.op.toString()+$i(t.value);if($_(t))return t.filters.map(e=>jh(e)).join(",");{const e=t.filters.map(n=>jh(n)).join(",");return`${t.op}(${e})`}}function B_(t,e){return t instanceof it?function(r,s){return s instanceof it&&r.op===s.op&&r.field.isEqual(s.field)&&Xn(r.value,s.value)}(t,e):t instanceof Dn?function(r,s){return s instanceof Dn&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,l)=>i&&B_(o,s.filters[l]),!0):!1}(t,e):void ce()}function z_(t){return t instanceof it?function(n){return`${n.field.canonicalString()} ${n.op} ${$i(n.value)}`}(t):t instanceof Dn?function(n){return n.op.toString()+" {"+n.getFilters().map(z_).join(" ,")+"}"}(t):"Filter"}class vP extends it{constructor(e,n,r){super(e,n,r),this.key=te.fromName(r.referenceValue)}matches(e){const n=te.comparator(e.key,this.key);return this.matchesComparison(n)}}class wP extends it{constructor(e,n){super(e,"in",n),this.keys=W_("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class _P extends it{constructor(e,n){super(e,"not-in",n),this.keys=W_("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function W_(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>te.fromName(r.referenceValue))}class xP extends it{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return om(n)&&va(n.arrayValue,this.value)}}class EP extends it{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&va(this.value.arrayValue,n)}}class bP extends it{constructor(e,n){super(e,"not-in",n)}matches(e){if(va(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!va(this.value.arrayValue,n)}}class TP extends it{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!om(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>va(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{constructor(e,n=null,r=[],s=[],i=null,o=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=l,this.ue=null}}function jy(t,e=null,n=[],r=[],s=null,i=null,o=null){return new CP(t,e,n,r,s,i,o)}function am(t){const e=he(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>jh(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),ou(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>$i(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>$i(r)).join(",")),e.ue=n}return e.ue}function lm(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!gP(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!B_(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ry(t.startAt,e.startAt)&&Ry(t.endAt,e.endAt)}function Dh(t){return te.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(e,n=null,r=[],s=[],i=null,o="F",l=null,u=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=l,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function SP(t,e,n,r,s,i,o,l){return new Oa(t,e,n,r,s,i,o,l)}function au(t){return new Oa(t)}function Dy(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function H_(t){return t.collectionGroup!==null}function Wo(t){const e=he(t);if(e.ce===null){e.ce=[];const n=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new Ct(bt.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.ce.push(new Ac(i,r))}),n.has(bt.keyField().canonicalString())||e.ce.push(new Ac(bt.keyField(),r))}return e.ce}function Qn(t){const e=he(t);return e.le||(e.le=IP(e,Wo(t))),e.le}function IP(t,e){if(t.limitType==="F")return jy(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Ac(s.field,i)});const n=t.endAt?new kc(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new kc(t.startAt.position,t.startAt.inclusive):null;return jy(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Mh(t,e){const n=t.filters.concat([e]);return new Oa(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Oh(t,e,n){return new Oa(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function lu(t,e){return lm(Qn(t),Qn(e))&&t.limitType===e.limitType}function q_(t){return`${am(Qn(t))}|lt:${t.limitType}`}function si(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>z_(s)).join(", ")}]`),ou(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>$i(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>$i(s)).join(",")),`Target(${r})`}(Qn(t))}; limitType=${t.limitType})`}function cu(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):te.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of Wo(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(o,l,u){const d=Ay(o,l,u);return o.inclusive?d<=0:d<0}(r.startAt,Wo(r),s)||r.endAt&&!function(o,l,u){const d=Ay(o,l,u);return o.inclusive?d>=0:d>0}(r.endAt,Wo(r),s))}(t,e)}function NP(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function G_(t){return(e,n)=>{let r=!1;for(const s of Wo(t)){const i=PP(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function PP(t,e,n){const r=t.field.isKeyField()?te.comparator(e.key,n.key):function(i,o,l){const u=o.data.field(i),d=l.data.field(i);return u!==null&&d!==null?Ui(u,d):ce()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ce()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ks(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return O_(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kP=new Qe(te.comparator);function Er(){return kP}const K_=new Qe(te.comparator);function ko(...t){let e=K_;for(const n of t)e=e.insert(n.key,n);return e}function Q_(t){let e=K_;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Ns(){return Ho()}function Y_(){return Ho()}function Ho(){return new Zi(t=>t.toString(),(t,e)=>t.isEqual(e))}const AP=new Qe(te.comparator),RP=new Ct(te.comparator);function ve(...t){let e=RP;for(const n of t)e=e.add(n);return e}const jP=new Ct(Ce);function DP(){return jP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cm(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pc(e)?"-0":e}}function X_(t){return{integerValue:""+t}}function MP(t,e){return dP(e)?X_(e):cm(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uu{constructor(){this._=void 0}}function OP(t,e,n){return t instanceof wa?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&sm(i)&&(i=im(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(n,e):t instanceof _a?Z_(t,e):t instanceof xa?ex(t,e):function(s,i){const o=J_(s,i),l=My(o)+My(s.Pe);return Rh(o)&&Rh(s.Pe)?X_(l):cm(s.serializer,l)}(t,e)}function LP(t,e,n){return t instanceof _a?Z_(t,e):t instanceof xa?ex(t,e):n}function J_(t,e){return t instanceof Rc?function(r){return Rh(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class wa extends uu{}class _a extends uu{constructor(e){super(),this.elements=e}}function Z_(t,e){const n=tx(e);for(const r of t.elements)n.some(s=>Xn(s,r))||n.push(r);return{arrayValue:{values:n}}}class xa extends uu{constructor(e){super(),this.elements=e}}function ex(t,e){let n=tx(e);for(const r of t.elements)n=n.filter(s=>!Xn(s,r));return{arrayValue:{values:n}}}class Rc extends uu{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function My(t){return et(t.integerValue||t.doubleValue)}function tx(t){return om(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{constructor(e,n){this.field=e,this.transform=n}}function FP(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof _a&&s instanceof _a||r instanceof xa&&s instanceof xa?Fi(r.elements,s.elements,Xn):r instanceof Rc&&s instanceof Rc?Xn(r.Pe,s.Pe):r instanceof wa&&s instanceof wa}(t.transform,e.transform)}class UP{constructor(e,n){this.version=e,this.transformResults=n}}class An{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new An}static exists(e){return new An(void 0,e)}static updateTime(e){return new An(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ql(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class du{}function nx(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new um(t.key,An.none()):new La(t.key,t.data,An.none());{const n=t.data,r=Jt.empty();let s=new Ct(bt.comparator);for(let i of e.fields)if(!s.has(i)){let o=n.field(i);o===null&&i.length>1&&(i=i.popLast(),o=n.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new ps(t.key,r,new cn(s.toArray()),An.none())}}function $P(t,e,n){t instanceof La?function(s,i,o){const l=s.value.clone(),u=Ly(s.fieldTransforms,i,o.transformResults);l.setAll(u),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):t instanceof ps?function(s,i,o){if(!ql(s.precondition,i))return void i.convertToUnknownDocument(o.version);const l=Ly(s.fieldTransforms,i,o.transformResults),u=i.data;u.setAll(rx(s)),u.setAll(l),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(t,e,n):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function qo(t,e,n,r){return t instanceof La?function(i,o,l,u){if(!ql(i.precondition,o))return l;const d=i.value.clone(),f=Vy(i.fieldTransforms,u,o);return d.setAll(f),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof ps?function(i,o,l,u){if(!ql(i.precondition,o))return l;const d=Vy(i.fieldTransforms,u,o),f=o.data;return f.setAll(rx(i)),f.setAll(d),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(p=>p.field))}(t,e,n,r):function(i,o,l){return ql(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(t,e,n)}function BP(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=J_(r.transform,s||null);i!=null&&(n===null&&(n=Jt.empty()),n.set(r.field,i))}return n||null}function Oy(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Fi(r,s,(i,o)=>FP(i,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class La extends du{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ps extends du{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function rx(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function Ly(t,e,n){const r=new Map;Ne(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,l=e.data.field(i.field);r.set(i.field,LP(o,l,n[s]))}return r}function Vy(t,e,n){const r=new Map;for(const s of t){const i=s.transform,o=n.data.field(s.field);r.set(s.field,OP(i,o,e))}return r}class um extends du{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class zP extends du{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WP{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&$P(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=qo(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=qo(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=Y_();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let l=this.applyToLocalView(o,i.mutatedFields);l=n.has(s.key)?null:l;const u=nx(o,l);u!==null&&r.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(de.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),ve())}isEqual(e){return this.batchId===e.batchId&&Fi(this.mutations,e.mutations,(n,r)=>Oy(n,r))&&Fi(this.baseMutations,e.baseMutations,(n,r)=>Oy(n,r))}}class dm{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Ne(e.mutations.length===r.length);let s=function(){return AP}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new dm(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HP{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qP{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rt,_e;function GP(t){switch(t){default:return ce();case B.CANCELLED:case B.UNKNOWN:case B.DEADLINE_EXCEEDED:case B.RESOURCE_EXHAUSTED:case B.INTERNAL:case B.UNAVAILABLE:case B.UNAUTHENTICATED:return!1;case B.INVALID_ARGUMENT:case B.NOT_FOUND:case B.ALREADY_EXISTS:case B.PERMISSION_DENIED:case B.FAILED_PRECONDITION:case B.ABORTED:case B.OUT_OF_RANGE:case B.UNIMPLEMENTED:case B.DATA_LOSS:return!0}}function sx(t){if(t===void 0)return xr("GRPC error has no .code"),B.UNKNOWN;switch(t){case rt.OK:return B.OK;case rt.CANCELLED:return B.CANCELLED;case rt.UNKNOWN:return B.UNKNOWN;case rt.DEADLINE_EXCEEDED:return B.DEADLINE_EXCEEDED;case rt.RESOURCE_EXHAUSTED:return B.RESOURCE_EXHAUSTED;case rt.INTERNAL:return B.INTERNAL;case rt.UNAVAILABLE:return B.UNAVAILABLE;case rt.UNAUTHENTICATED:return B.UNAUTHENTICATED;case rt.INVALID_ARGUMENT:return B.INVALID_ARGUMENT;case rt.NOT_FOUND:return B.NOT_FOUND;case rt.ALREADY_EXISTS:return B.ALREADY_EXISTS;case rt.PERMISSION_DENIED:return B.PERMISSION_DENIED;case rt.FAILED_PRECONDITION:return B.FAILED_PRECONDITION;case rt.ABORTED:return B.ABORTED;case rt.OUT_OF_RANGE:return B.OUT_OF_RANGE;case rt.UNIMPLEMENTED:return B.UNIMPLEMENTED;case rt.DATA_LOSS:return B.DATA_LOSS;default:return ce()}}(_e=rt||(rt={}))[_e.OK=0]="OK",_e[_e.CANCELLED=1]="CANCELLED",_e[_e.UNKNOWN=2]="UNKNOWN",_e[_e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_e[_e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_e[_e.NOT_FOUND=5]="NOT_FOUND",_e[_e.ALREADY_EXISTS=6]="ALREADY_EXISTS",_e[_e.PERMISSION_DENIED=7]="PERMISSION_DENIED",_e[_e.UNAUTHENTICATED=16]="UNAUTHENTICATED",_e[_e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_e[_e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_e[_e.ABORTED=10]="ABORTED",_e[_e.OUT_OF_RANGE=11]="OUT_OF_RANGE",_e[_e.UNIMPLEMENTED=12]="UNIMPLEMENTED",_e[_e.INTERNAL=13]="INTERNAL",_e[_e.UNAVAILABLE=14]="UNAVAILABLE",_e[_e.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KP(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QP=new As([4294967295,4294967295],0);function Fy(t){const e=KP().encode(t),n=new N_;return n.update(e),new Uint8Array(n.digest())}function Uy(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new As([n,r],0),new As([s,i],0)]}class hm{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Ao(`Invalid padding: ${n}`);if(r<0)throw new Ao(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ao(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Ao(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=As.fromNumber(this.Ie)}Ee(e,n,r){let s=e.add(n.multiply(As.fromNumber(r)));return s.compare(QP)===1&&(s=new As([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const n=Fy(e),[r,s]=Uy(n);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new hm(i,s,n);return r.forEach(l=>o.insert(l)),o}insert(e){if(this.Ie===0)return;const n=Fy(e),[r,s]=Uy(n);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Ao extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,Va.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new hu(de.min(),s,new Qe(Ce),Er(),ve())}}class Va{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Va(r,n,ve(),ve(),ve())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gl{constructor(e,n,r,s){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=s}}class ix{constructor(e,n){this.targetId=e,this.me=n}}class ox{constructor(e,n,r=It.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class $y{constructor(){this.fe=0,this.ge=zy(),this.pe=It.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ve(),n=ve(),r=ve();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:ce()}}),new Va(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=zy()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ne(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class YP{constructor(e){this.Le=e,this.Be=new Map,this.ke=Er(),this.qe=By(),this.Qe=new Qe(Ce)}Ke(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{const r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:ce()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,s)=>{this.ze(s)&&n(s)})}He(e){const n=e.targetId,r=e.me.count,s=this.Je(n);if(s){const i=s.target;if(Dh(i))if(r===0){const o=new te(i.path);this.Ue(n,o,Lt.newNoDocument(o,de.min()))}else Ne(r===1);else{const o=this.Ye(n);if(o!==r){const l=this.Ze(e),u=l?this.Xe(l,e,o):1;if(u!==0){this.je(n);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,d)}}}}}Ze(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let o,l;try{o=$s(r).toUint8Array()}catch(u){if(u instanceof L_)return Vi("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new hm(o,s,i)}catch(u){return Vi(u instanceof Ao?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.Ie===0?null:l}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const o=this.Le.tt(),l=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.Ue(n,i,null),s++)}),s}rt(e){const n=new Map;this.Be.forEach((i,o)=>{const l=this.Je(o);if(l){if(i.current&&Dh(l.target)){const u=new te(l.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,Lt.newNoDocument(u,e))}i.be&&(n.set(o,i.ve()),i.Ce())}});let r=ve();this.qe.forEach((i,o)=>{let l=!0;o.forEachWhile(u=>{const d=this.Je(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new hu(e,n,this.Qe,this.ke,r);return this.ke=Er(),this.qe=By(),this.Qe=new Qe(Ce),s}$e(e,n){if(!this.ze(e))return;const r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,n)?s.Fe(n,1):s.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const n=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new $y,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new Ct(Ce),this.qe=this.qe.insert(e,n)),n}ze(e){const n=this.Je(e)!==null;return n||ee("WatchChangeAggregator","Detected inactive target",e),n}Je(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new $y),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function By(){return new Qe(te.comparator)}function zy(){return new Qe(te.comparator)}const XP=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),JP=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),ZP=(()=>({and:"AND",or:"OR"}))();class ek{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Lh(t,e){return t.useProto3Json||ou(e)?e:{value:e}}function jc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ax(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function tk(t,e){return jc(t,e.toTimestamp())}function Yn(t){return Ne(!!t),de.fromTimestamp(function(n){const r=ls(n);return new dt(r.seconds,r.nanos)}(t))}function fm(t,e){return Vh(t,e).canonicalString()}function Vh(t,e){const n=function(s){return new Ve(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function lx(t){const e=Ve.fromString(t);return Ne(fx(e)),e}function Fh(t,e){return fm(t.databaseId,e.path)}function vd(t,e){const n=lx(e);if(n.get(1)!==t.databaseId.projectId)throw new Z(B.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Z(B.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new te(ux(n))}function cx(t,e){return fm(t.databaseId,e)}function nk(t){const e=lx(t);return e.length===4?Ve.emptyPath():ux(e)}function Uh(t){return new Ve(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ux(t){return Ne(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Wy(t,e,n){return{name:Fh(t,e),fields:n.value.mapValue.fields}}function rk(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:ce()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,f){return d.useProto3Json?(Ne(f===void 0||typeof f=="string"),It.fromBase64String(f||"")):(Ne(f===void 0||f instanceof Buffer||f instanceof Uint8Array),It.fromUint8Array(f||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(d){const f=d.code===void 0?B.UNKNOWN:sx(d.code);return new Z(f,d.message||"")}(o);n=new ox(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=vd(t,r.document.name),i=Yn(r.document.updateTime),o=r.document.createTime?Yn(r.document.createTime):de.min(),l=new Jt({mapValue:{fields:r.document.fields}}),u=Lt.newFoundDocument(s,i,o,l),d=r.targetIds||[],f=r.removedTargetIds||[];n=new Gl(d,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=vd(t,r.document),i=r.readTime?Yn(r.readTime):de.min(),o=Lt.newNoDocument(s,i),l=r.removedTargetIds||[];n=new Gl([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=vd(t,r.document),i=r.removedTargetIds||[];n=new Gl([],i,s,null)}else{if(!("filter"in e))return ce();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new qP(s,i),l=r.targetId;n=new ix(l,o)}}return n}function sk(t,e){let n;if(e instanceof La)n={update:Wy(t,e.key,e.value)};else if(e instanceof um)n={delete:Fh(t,e.key)};else if(e instanceof ps)n={update:Wy(t,e.key,e.data),updateMask:fk(e.fieldMask)};else{if(!(e instanceof zP))return ce();n={verify:Fh(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const l=o.transform;if(l instanceof wa)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof _a)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof xa)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Rc)return{fieldPath:o.field.canonicalString(),increment:l.Pe};throw ce()}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:tk(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ce()}(t,e.precondition)),n}function ik(t,e){return t&&t.length>0?(Ne(e!==void 0),t.map(n=>function(s,i){let o=s.updateTime?Yn(s.updateTime):Yn(i);return o.isEqual(de.min())&&(o=Yn(i)),new UP(o,s.transformResults||[])}(n,e))):[]}function ok(t,e){return{documents:[cx(t,e.path)]}}function ak(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=cx(t,s);const i=function(d){if(d.length!==0)return hx(Dn.create(d,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(d){if(d.length!==0)return d.map(f=>function(y){return{field:ii(y.field),direction:uk(y.dir)}}(f))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const l=Lh(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:n,parent:s}}function lk(t){let e=nk(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Ne(r===1);const f=n.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];n.where&&(i=function(p){const y=dx(p);return y instanceof Dn&&$_(y)?y.getFilters():[y]}(n.where));let o=[];n.orderBy&&(o=function(p){return p.map(y=>function(S){return new Ac(oi(S.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(S.direction))}(y))}(n.orderBy));let l=null;n.limit&&(l=function(p){let y;return y=typeof p=="object"?p.value:p,ou(y)?null:y}(n.limit));let u=null;n.startAt&&(u=function(p){const y=!!p.before,T=p.values||[];return new kc(T,y)}(n.startAt));let d=null;return n.endAt&&(d=function(p){const y=!p.before,T=p.values||[];return new kc(T,y)}(n.endAt)),SP(e,s,o,i,l,"F",u,d)}function ck(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ce()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function dx(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=oi(n.unaryFilter.field);return it.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=oi(n.unaryFilter.field);return it.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=oi(n.unaryFilter.field);return it.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=oi(n.unaryFilter.field);return it.create(o,"!=",{nullValue:"NULL_VALUE"});default:return ce()}}(t):t.fieldFilter!==void 0?function(n){return it.create(oi(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ce()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Dn.create(n.compositeFilter.filters.map(r=>dx(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ce()}}(n.compositeFilter.op))}(t):ce()}function uk(t){return XP[t]}function dk(t){return JP[t]}function hk(t){return ZP[t]}function ii(t){return{fieldPath:t.canonicalString()}}function oi(t){return bt.fromServerFormat(t.fieldPath)}function hx(t){return t instanceof it?function(n){if(n.op==="=="){if(ky(n.value))return{unaryFilter:{field:ii(n.field),op:"IS_NAN"}};if(Py(n.value))return{unaryFilter:{field:ii(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(ky(n.value))return{unaryFilter:{field:ii(n.field),op:"IS_NOT_NAN"}};if(Py(n.value))return{unaryFilter:{field:ii(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ii(n.field),op:dk(n.op),value:n.value}}}(t):t instanceof Dn?function(n){const r=n.getFilters().map(s=>hx(s));return r.length===1?r[0]:{compositeFilter:{op:hk(n.op),filters:r}}}(t):ce()}function fk(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function fx(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hr{constructor(e,n,r,s,i=de.min(),o=de.min(),l=It.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new Hr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Hr(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Hr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Hr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{constructor(e){this.ct=e}}function pk(t){const e=lk({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Oh(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(){this.un=new yk}addToCollectionParentIndex(e,n){return this.un.add(n),z.resolve()}getCollectionParents(e,n){return z.resolve(this.un.getEntries(n))}addFieldIndex(e,n){return z.resolve()}deleteFieldIndex(e,n){return z.resolve()}deleteAllFieldIndexes(e){return z.resolve()}createTargetIndexes(e,n){return z.resolve()}getDocumentsMatchingTarget(e,n){return z.resolve(null)}getIndexType(e,n){return z.resolve(0)}getFieldIndexes(e,n){return z.resolve([])}getNextCollectionGroupToUpdate(e){return z.resolve(null)}getMinOffset(e,n){return z.resolve(as.min())}getMinOffsetFromCollectionGroup(e,n){return z.resolve(as.min())}updateCollectionGroup(e,n,r){return z.resolve()}updateIndexEntries(e,n){return z.resolve()}}class yk{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new Ct(Ve.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Ct(Ve.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Bi(0)}static kn(){return new Bi(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{constructor(){this.changes=new Zi(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Lt.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?z.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&qo(r.mutation,s,cn.empty(),dt.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,ve()).next(()=>r))}getLocalViewOfDocuments(e,n,r=ve()){const s=Ns();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let o=ko();return i.forEach((l,u)=>{o=o.insert(l,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=Ns();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,ve()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,l)=>{n.set(o,l)})})}computeViews(e,n,r,s){let i=Er();const o=Ho(),l=function(){return Ho()}();return n.forEach((u,d)=>{const f=r.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof ps)?i=i.insert(d.key,d):f!==void 0?(o.set(d.key,f.mutation.getFieldMask()),qo(f.mutation,d,f.mutation.getFieldMask(),dt.now())):o.set(d.key,cn.empty())}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((d,f)=>o.set(d,f)),n.forEach((d,f)=>{var p;return l.set(d,new wk(f,(p=o.get(d))!==null&&p!==void 0?p:null))}),l))}recalculateAndSaveOverlays(e,n){const r=Ho();let s=new Qe((o,l)=>o-l),i=ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const l of o)l.keys().forEach(u=>{const d=n.get(u);if(d===null)return;let f=r.get(u)||cn.empty();f=l.applyToLocalView(d,f),r.set(u,f);const p=(s.get(l.batchId)||ve()).add(u);s=s.insert(l.batchId,p)})}).next(()=>{const o=[],l=s.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),d=u.key,f=u.value,p=Y_();f.forEach(y=>{if(!i.has(y)){const T=nx(n.get(y),r.get(y));T!==null&&p.set(y,T),i=i.add(y)}}),o.push(this.documentOverlayCache.saveOverlays(e,d,p))}return z.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(o){return te.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):H_(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):z.resolve(Ns());let l=-1,u=i;return o.next(d=>z.forEach(d,(f,p)=>(l<p.largestBatchId&&(l=p.largestBatchId),i.get(f)?z.resolve():this.remoteDocumentCache.getEntry(e,f).next(y=>{u=u.insert(f,y)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,u,d,ve())).next(f=>({batchId:l,changes:Q_(f)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new te(n)).next(r=>{let s=ko();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let o=ko();return this.indexManager.getCollectionParents(e,i).next(l=>z.forEach(l,u=>{const d=function(p,y){return new Oa(y,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(n,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(f=>{f.forEach((p,y)=>{o=o.insert(p,y)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(o=>{i.forEach((u,d)=>{const f=d.getKey();o.get(f)===null&&(o=o.insert(f,Lt.newInvalidDocument(f)))});let l=ko();return o.forEach((u,d)=>{const f=i.get(u);f!==void 0&&qo(f.mutation,d,cn.empty(),dt.now()),cu(n,d)&&(l=l.insert(u,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,n){return z.resolve(this.hr.get(n))}saveBundleMetadata(e,n){return this.hr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:Yn(s.createTime)}}(n)),z.resolve()}getNamedQuery(e,n){return z.resolve(this.Pr.get(n))}saveNamedQuery(e,n){return this.Pr.set(n.name,function(s){return{name:s.name,query:pk(s.bundledQuery),readTime:Yn(s.readTime)}}(n)),z.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(){this.overlays=new Qe(te.comparator),this.Ir=new Map}getOverlay(e,n){return z.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Ns();return z.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.ht(e,n,i)}),z.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),z.resolve()}getOverlaysForCollection(e,n,r){const s=Ns(),i=n.length+1,o=new te(n.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const u=l.getNext().value,d=u.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return z.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new Qe((d,f)=>d-f);const o=this.overlays.getIterator();for(;o.hasNext();){const d=o.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let f=i.get(d.largestBatchId);f===null&&(f=Ns(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const l=Ns(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((d,f)=>l.set(d,f)),!(l.size()>=s)););return z.resolve(l)}ht(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new HP(n,r));let i=this.Ir.get(n);i===void 0&&(i=ve(),this.Ir.set(n,i)),this.Ir.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bk{constructor(){this.sessionToken=It.EMPTY_BYTE_STRING}getSessionToken(e){return z.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,z.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mm{constructor(){this.Tr=new Ct(mt.Er),this.dr=new Ct(mt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,n){const r=new mt(e,n);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Vr(new mt(e,n))}mr(e,n){e.forEach(r=>this.removeReference(r,n))}gr(e){const n=new te(new Ve([])),r=new mt(n,e),s=new mt(n,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const n=new te(new Ve([])),r=new mt(n,e),s=new mt(n,e+1);let i=ve();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const n=new mt(e,0),r=this.Tr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class mt{constructor(e,n){this.key=e,this.wr=n}static Er(e,n){return te.comparator(e.key,n.key)||Ce(e.wr,n.wr)}static Ar(e,n){return Ce(e.wr,n.wr)||te.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tk{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new Ct(mt.Er)}checkEmpty(e){return z.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new WP(i,n,r,s);this.mutationQueue.push(o);for(const l of s)this.br=this.br.add(new mt(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return z.resolve(o)}lookupMutationBatch(e,n){return z.resolve(this.Dr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.vr(r),i=s<0?0:s;return z.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return z.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return z.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new mt(n,0),s=new mt(n,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const l=this.Dr(o.wr);i.push(l)}),z.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Ct(Ce);return n.forEach(s=>{const i=new mt(s,0),o=new mt(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],l=>{r=r.add(l.wr)})}),z.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;te.isDocumentKey(i)||(i=i.child(""));const o=new mt(new te(i),0);let l=new Ct(Ce);return this.br.forEachWhile(u=>{const d=u.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(u.wr)),!0)},o),z.resolve(this.Cr(l))}Cr(e){const n=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){Ne(this.Fr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return z.forEach(n.mutations,s=>{const i=new mt(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,n){const r=new mt(n,0),s=this.br.firstAfterOrEqual(r);return z.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,z.resolve()}Fr(e,n){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const n=this.vr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck{constructor(e){this.Mr=e,this.docs=function(){return new Qe(te.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return z.resolve(r?r.document.mutableCopy():Lt.newInvalidDocument(n))}getEntries(e,n){let r=Er();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Lt.newInvalidDocument(s))}),z.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=Er();const o=n.path,l=new te(o.child("")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||aP(oP(f),r)<=0||(s.has(f.key)||cu(n,f))&&(i=i.insert(f.key,f.mutableCopy()))}return z.resolve(i)}getAllFromCollectionGroup(e,n,r,s){ce()}Or(e,n){return z.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new Sk(this)}getSize(e){return z.resolve(this.size)}}class Sk extends vk{constructor(e){super(),this.cr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),z.waitFor(n)}getFromCache(e,n){return this.cr.getEntry(e,n)}getAllFromCache(e,n){return this.cr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(e){this.persistence=e,this.Nr=new Zi(n=>am(n),lm),this.lastRemoteSnapshotVersion=de.min(),this.highestTargetId=0,this.Lr=0,this.Br=new mm,this.targetCount=0,this.kr=Bi.Bn()}forEachTarget(e,n){return this.Nr.forEach((r,s)=>n(s)),z.resolve()}getLastRemoteSnapshotVersion(e){return z.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return z.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),z.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Lr&&(this.Lr=n),z.resolve()}Kn(e){this.Nr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.kr=new Bi(n),this.highestTargetId=n),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,n){return this.Kn(n),this.targetCount+=1,z.resolve()}updateTargetData(e,n){return this.Kn(n),z.resolve()}removeTargetData(e,n){return this.Nr.delete(n.target),this.Br.gr(n.targetId),this.targetCount-=1,z.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.Nr.forEach((o,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),z.waitFor(i).next(()=>s)}getTargetCount(e){return z.resolve(this.targetCount)}getTargetData(e,n){const r=this.Nr.get(n)||null;return z.resolve(r)}addMatchingKeys(e,n,r){return this.Br.Rr(n,r),z.resolve()}removeMatchingKeys(e,n,r){this.Br.mr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),z.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.Br.gr(n),z.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Br.yr(n);return z.resolve(r)}containsKey(e,n){return z.resolve(this.Br.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nk{constructor(e,n){this.qr={},this.overlays={},this.Qr=new rm(0),this.Kr=!1,this.Kr=!0,this.$r=new bk,this.referenceDelegate=e(this),this.Ur=new Ik(this),this.indexManager=new gk,this.remoteDocumentCache=function(s){return new Ck(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new mk(n),this.Gr=new xk(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new Ek,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.qr[e.toKey()];return r||(r=new Tk(n,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,n,r){ee("MemoryPersistence","Starting transaction:",e);const s=new Pk(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,n){return z.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,n)))}}class Pk extends cP{constructor(e){super(),this.currentSequenceNumber=e}}class pm{constructor(e){this.persistence=e,this.Jr=new mm,this.Yr=null}static Zr(e){return new pm(e)}get Xr(){if(this.Yr)return this.Yr;throw ce()}addReference(e,n,r){return this.Jr.addReference(r,n),this.Xr.delete(r.toString()),z.resolve()}removeReference(e,n,r){return this.Jr.removeReference(r,n),this.Xr.add(r.toString()),z.resolve()}markPotentiallyOrphaned(e,n){return this.Xr.add(n.toString()),z.resolve()}removeTarget(e,n){this.Jr.gr(n.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}zr(){this.Yr=new Set}jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return z.forEach(this.Xr,r=>{const s=te.fromPath(r);return this.ei(e,s).next(i=>{i||n.removeEntry(s,de.min())})}).next(()=>(this.Yr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ei(e,n).next(r=>{r?this.Xr.delete(n.toString()):this.Xr.add(n.toString())})}Wr(e){return 0}ei(e,n){return z.or([()=>z.resolve(this.Jr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Hr(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.$i=r,this.Ui=s}static Wi(e,n){let r=ve(),s=ve();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new gm(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kk{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ak{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return pS()?8:uP(Ut())>0?6:4}()}initialize(e,n){this.Ji=e,this.indexManager=n,this.Gi=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.Yi(e,n).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,n,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new kk;return this.Xi(e,n,o).next(l=>{if(i.result=l,this.zi)return this.es(e,n,o,l.size)})}).next(()=>i.result)}es(e,n,r,s){return r.documentReadCount<this.ji?(Eo()<=we.DEBUG&&ee("QueryEngine","SDK will not create cache indexes for query:",si(n),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),z.resolve()):(Eo()<=we.DEBUG&&ee("QueryEngine","Query:",si(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Eo()<=we.DEBUG&&ee("QueryEngine","The SDK decides to create cache indexes for query:",si(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Qn(n))):z.resolve())}Yi(e,n){if(Dy(n))return z.resolve(null);let r=Qn(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=Oh(n,null,"F"),r=Qn(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=ve(...i);return this.Ji.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,r).next(u=>{const d=this.ts(n,l);return this.ns(n,d,o,u.readTime)?this.Yi(e,Oh(n,null,"F")):this.rs(e,d,n,u)}))})))}Zi(e,n,r,s){return Dy(n)||s.isEqual(de.min())?z.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(n,i);return this.ns(n,o,r,s)?z.resolve(null):(Eo()<=we.DEBUG&&ee("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),si(n)),this.rs(e,o,n,iP(s,-1)).next(l=>l))})}ts(e,n){let r=new Ct(G_(e));return n.forEach((s,i)=>{cu(e,i)&&(r=r.add(i))}),r}ns(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,n,r){return Eo()<=we.DEBUG&&ee("QueryEngine","Using full collection scan to execute query:",si(n)),this.Ji.getDocumentsMatchingQuery(e,n,as.min(),r)}rs(e,n,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk{constructor(e,n,r,s){this.persistence=e,this.ss=n,this.serializer=s,this.os=new Qe(Ce),this._s=new Zi(i=>am(i),lm),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new _k(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.os))}}function jk(t,e,n,r){return new Rk(t,e,n,r)}async function mx(t,e){const n=he(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.ls(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],l=[];let u=ve();for(const d of s){o.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}for(const d of i){l.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}return n.localDocuments.getDocuments(r,u).next(d=>({hs:d,removedBatchIds:o,addedBatchIds:l}))})})}function Dk(t,e){const n=he(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(l,u,d,f){const p=d.batch,y=p.keys();let T=z.resolve();return y.forEach(S=>{T=T.next(()=>f.getEntry(u,S)).next(A=>{const k=d.docVersions.get(S);Ne(k!==null),A.version.compareTo(k)<0&&(p.applyToRemoteDocument(A,d),A.isValidDocument()&&(A.setReadTime(d.commitVersion),f.addEntry(A)))})}),T.next(()=>l.mutationQueue.removeMutationBatch(u,p))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let u=ve();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(u=u.add(l.batch.mutations[d].key));return u}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function px(t){const e=he(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ur.getLastRemoteSnapshotVersion(n))}function Mk(t,e){const n=he(t),r=e.snapshotVersion;let s=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=n.cs.newChangeBuffer({trackRemovals:!0});s=n.os;const l=[];e.targetChanges.forEach((f,p)=>{const y=s.get(p);if(!y)return;l.push(n.Ur.removeMatchingKeys(i,f.removedDocuments,p).next(()=>n.Ur.addMatchingKeys(i,f.addedDocuments,p)));let T=y.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(p)!==null?T=T.withResumeToken(It.EMPTY_BYTE_STRING,de.min()).withLastLimboFreeSnapshotVersion(de.min()):f.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(f.resumeToken,r)),s=s.insert(p,T),function(A,k,E){return A.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=3e8?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0}(y,T,f)&&l.push(n.Ur.updateTargetData(i,T))});let u=Er(),d=ve();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(i,f))}),l.push(Ok(i,o,e.documentUpdates).next(f=>{u=f.Ps,d=f.Is})),!r.isEqual(de.min())){const f=n.Ur.getLastRemoteSnapshotVersion(i).next(p=>n.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(f)}return z.waitFor(l).next(()=>o.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,u,d)).next(()=>u)}).then(i=>(n.os=s,i))}function Ok(t,e,n){let r=ve(),s=ve();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let o=Er();return n.forEach((l,u)=>{const d=i.get(l);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),u.isNoDocument()&&u.version.isEqual(de.min())?(e.removeEntry(l,u.readTime),o=o.insert(l,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),o=o.insert(l,u)):ee("LocalStore","Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",u.version)}),{Ps:o,Is:s}})}function Lk(t,e){const n=he(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Vk(t,e){const n=he(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Ur.getTargetData(r,e).next(i=>i?(s=i,z.resolve(s)):n.Ur.allocateTargetId(r).next(o=>(s=new Hr(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.os=n.os.insert(r.targetId,r),n._s.set(e,r.targetId)),r})}async function $h(t,e,n){const r=he(t),s=r.os.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Ma(o))throw o;ee("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Hy(t,e,n){const r=he(t);let s=de.min(),i=ve();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,d,f){const p=he(u),y=p._s.get(f);return y!==void 0?z.resolve(p.os.get(y)):p.Ur.getTargetData(d,f)}(r,o,Qn(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,l.targetId).next(u=>{i=u})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,n?s:de.min(),n?i:ve())).next(l=>(Fk(r,NP(e),l),{documents:l,Ts:i})))}function Fk(t,e,n){let r=t.us.get(e)||de.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.us.set(e,r)}class qy{constructor(){this.activeTargetIds=DP()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Uk{constructor(){this.so=new qy,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,n,r){this.oo[e]=n}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new qy,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gy{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ee("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ee("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Il=null;function wd(){return Il===null?Il=function(){return 268435456+Math.round(2147483648*Math.random())}():Il++,"0x"+Il.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bk={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zk{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dt="WebChannelConnection";class Wk extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+n.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(n,r,s,i,o){const l=wd(),u=this.xo(n,r.toUriEncodedString());ee("RestConnection",`Sending RPC '${n}' ${l}:`,u,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,i,o),this.No(n,u,d,s).then(f=>(ee("RestConnection",`Received RPC '${n}' ${l}: `,f),f),f=>{throw Vi("RestConnection",`RPC '${n}' ${l} failed with error: `,f,"url: ",u,"request:",s),f})}Lo(n,r,s,i,o,l){return this.Mo(n,r,s,i,o)}Oo(n,r,s){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ji}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>n[o]=i),s&&s.headers.forEach((i,o)=>n[o]=i)}xo(n,r){const s=Bk[n];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,n,r,s){const i=wd();return new Promise((o,l)=>{const u=new P_;u.setWithCredentials(!0),u.listenOnce(k_.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Wl.NO_ERROR:const f=u.getResponseJson();ee(Dt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(f)),o(f);break;case Wl.TIMEOUT:ee(Dt,`RPC '${e}' ${i} timed out`),l(new Z(B.DEADLINE_EXCEEDED,"Request time out"));break;case Wl.HTTP_ERROR:const p=u.getStatus();if(ee(Dt,`RPC '${e}' ${i} failed with status:`,p,"response text:",u.getResponseText()),p>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const T=y==null?void 0:y.error;if(T&&T.status&&T.message){const S=function(k){const E=k.toLowerCase().replace(/_/g,"-");return Object.values(B).indexOf(E)>=0?E:B.UNKNOWN}(T.status);l(new Z(S,T.message))}else l(new Z(B.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new Z(B.UNAVAILABLE,"Connection failed."));break;default:ce()}}finally{ee(Dt,`RPC '${e}' ${i} completed.`)}});const d=JSON.stringify(s);ee(Dt,`RPC '${e}' ${i} sending request:`,s),u.send(n,"POST",d,r,15)})}Bo(e,n,r){const s=wd(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=j_(),l=R_(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,n,r),u.encodeInitMessageHeaders=!0;const f=i.join("");ee(Dt,`Creating RPC '${e}' stream ${s}: ${f}`,u);const p=o.createWebChannel(f,u);let y=!1,T=!1;const S=new zk({Io:k=>{T?ee(Dt,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(y||(ee(Dt,`Opening RPC '${e}' stream ${s} transport.`),p.open(),y=!0),ee(Dt,`RPC '${e}' stream ${s} sending:`,k),p.send(k))},To:()=>p.close()}),A=(k,E,_)=>{k.listen(E,I=>{try{_(I)}catch(O){setTimeout(()=>{throw O},0)}})};return A(p,Po.EventType.OPEN,()=>{T||(ee(Dt,`RPC '${e}' stream ${s} transport opened.`),S.yo())}),A(p,Po.EventType.CLOSE,()=>{T||(T=!0,ee(Dt,`RPC '${e}' stream ${s} transport closed`),S.So())}),A(p,Po.EventType.ERROR,k=>{T||(T=!0,Vi(Dt,`RPC '${e}' stream ${s} transport errored:`,k),S.So(new Z(B.UNAVAILABLE,"The operation could not be completed")))}),A(p,Po.EventType.MESSAGE,k=>{var E;if(!T){const _=k.data[0];Ne(!!_);const I=_,O=I.error||((E=I[0])===null||E===void 0?void 0:E.error);if(O){ee(Dt,`RPC '${e}' stream ${s} received error:`,O);const D=O.status;let L=function(x){const b=rt[x];if(b!==void 0)return sx(b)}(D),w=O.message;L===void 0&&(L=B.INTERNAL,w="Unknown error status: "+D+" with message "+O.message),T=!0,S.So(new Z(L,w)),p.close()}else ee(Dt,`RPC '${e}' stream ${s} received:`,_),S.bo(_)}}),A(l,A_.STAT_EVENT,k=>{k.stat===kh.PROXY?ee(Dt,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===kh.NOPROXY&&ee(Dt,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{S.wo()},0),S}}function _d(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fu(t){return new ek(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(e,n,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=n,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,n-r);s>0&&ee("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yx{constructor(e,n,r,s,i,o,l,u){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new gx(e,n)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,n){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():n&&n.code===B.RESOURCE_EXHAUSTED?(xr(n.toString()),xr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===B.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(n)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===n&&this.P_(r,s)},r=>{e(()=>{const s=new Z(B.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,n){const r=this.h_(this.Yo);this.stream=this.T_(e,n),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return ee("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return n=>{this.ui.enqueueAndForget(()=>this.Yo===e?n():(ee("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Hk extends yx{constructor(e,n,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}T_(e,n){return this.connection.Bo("Listen",e,n)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const n=rk(this.serializer,e),r=function(i){if(!("targetChange"in i))return de.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?de.min():o.readTime?Yn(o.readTime):de.min()}(e);return this.listener.d_(n,r)}A_(e){const n={};n.database=Uh(this.serializer),n.addTarget=function(i,o){let l;const u=o.target;if(l=Dh(u)?{documents:ok(i,u)}:{query:ak(i,u)._t},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=ax(i,o.resumeToken);const d=Lh(i,o.expectedCount);d!==null&&(l.expectedCount=d)}else if(o.snapshotVersion.compareTo(de.min())>0){l.readTime=jc(i,o.snapshotVersion.toTimestamp());const d=Lh(i,o.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=ck(this.serializer,e);r&&(n.labels=r),this.a_(n)}R_(e){const n={};n.database=Uh(this.serializer),n.removeTarget=e,this.a_(n)}}class qk extends yx{constructor(e,n,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,n){return this.connection.Bo("Write",e,n)}E_(e){return Ne(!!e.streamToken),this.lastStreamToken=e.streamToken,Ne(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Ne(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const n=ik(e.writeResults,e.commitTime),r=Yn(e.commitTime);return this.listener.g_(r,n)}p_(){const e={};e.database=Uh(this.serializer),this.a_(e)}m_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>sk(this.serializer,r))};this.a_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk extends class{}{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new Z(B.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,n,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Vh(n,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Z(B.UNKNOWN,i.toString())})}Lo(e,n,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Lo(e,Vh(n,r),s,o,l,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Z(B.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Kk{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(xr(n),this.D_=!1):ee("OnlineStateTracker",n)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qk{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Qs(this)&&(ee("RemoteStore","Restarting streams for network reachability change."),await async function(u){const d=he(u);d.L_.add(4),await Fa(d),d.q_.set("Unknown"),d.L_.delete(4),await mu(d)}(this))})}),this.q_=new Kk(r,s)}}async function mu(t){if(Qs(t))for(const e of t.B_)await e(!0)}async function Fa(t){for(const e of t.B_)await e(!1)}function vx(t,e){const n=he(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),_m(n)?wm(n):eo(n).r_()&&vm(n,e))}function ym(t,e){const n=he(t),r=eo(n);n.N_.delete(e),r.r_()&&wx(n,e),n.N_.size===0&&(r.r_()?r.o_():Qs(n)&&n.q_.set("Unknown"))}function vm(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(de.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}eo(t).A_(e)}function wx(t,e){t.Q_.xe(e),eo(t).R_(e)}function wm(t){t.Q_=new YP({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),eo(t).start(),t.q_.v_()}function _m(t){return Qs(t)&&!eo(t).n_()&&t.N_.size>0}function Qs(t){return he(t).L_.size===0}function _x(t){t.Q_=void 0}async function Yk(t){t.q_.set("Online")}async function Xk(t){t.N_.forEach((e,n)=>{vm(t,e)})}async function Jk(t,e){_x(t),_m(t)?(t.q_.M_(e),wm(t)):t.q_.set("Unknown")}async function Zk(t,e,n){if(t.q_.set("Online"),e instanceof ox&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const l of i.targetIds)s.N_.has(l)&&(await s.remoteSyncer.rejectListen(l,o),s.N_.delete(l),s.Q_.removeTarget(l))}(t,e)}catch(r){ee("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Dc(t,r)}else if(e instanceof Gl?t.Q_.Ke(e):e instanceof ix?t.Q_.He(e):t.Q_.We(e),!n.isEqual(de.min()))try{const r=await px(t.localStore);n.compareTo(r)>=0&&await function(i,o){const l=i.Q_.rt(o);return l.targetChanges.forEach((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const f=i.N_.get(d);f&&i.N_.set(d,f.withResumeToken(u.resumeToken,o))}}),l.targetMismatches.forEach((u,d)=>{const f=i.N_.get(u);if(!f)return;i.N_.set(u,f.withResumeToken(It.EMPTY_BYTE_STRING,f.snapshotVersion)),wx(i,u);const p=new Hr(f.target,u,d,f.sequenceNumber);vm(i,p)}),i.remoteSyncer.applyRemoteEvent(l)}(t,n)}catch(r){ee("RemoteStore","Failed to raise snapshot:",r),await Dc(t,r)}}async function Dc(t,e,n){if(!Ma(e))throw e;t.L_.add(1),await Fa(t),t.q_.set("Offline"),n||(n=()=>px(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{ee("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await mu(t)})}function xx(t,e){return e().catch(n=>Dc(t,n,e))}async function pu(t){const e=he(t),n=cs(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;eA(e);)try{const s=await Lk(e.localStore,r);if(s===null){e.O_.length===0&&n.o_();break}r=s.batchId,tA(e,s)}catch(s){await Dc(e,s)}Ex(e)&&bx(e)}function eA(t){return Qs(t)&&t.O_.length<10}function tA(t,e){t.O_.push(e);const n=cs(t);n.r_()&&n.V_&&n.m_(e.mutations)}function Ex(t){return Qs(t)&&!cs(t).n_()&&t.O_.length>0}function bx(t){cs(t).start()}async function nA(t){cs(t).p_()}async function rA(t){const e=cs(t);for(const n of t.O_)e.m_(n.mutations)}async function sA(t,e,n){const r=t.O_.shift(),s=dm.from(r,e,n);await xx(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await pu(t)}async function iA(t,e){e&&cs(t).V_&&await async function(r,s){if(function(o){return GP(o)&&o!==B.ABORTED}(s.code)){const i=r.O_.shift();cs(r).s_(),await xx(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await pu(r)}}(t,e),Ex(t)&&bx(t)}async function Ky(t,e){const n=he(t);n.asyncQueue.verifyOperationInProgress(),ee("RemoteStore","RemoteStore received new credentials");const r=Qs(n);n.L_.add(3),await Fa(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await mu(n)}async function oA(t,e){const n=he(t);e?(n.L_.delete(2),await mu(n)):e||(n.L_.add(2),await Fa(n),n.q_.set("Unknown"))}function eo(t){return t.K_||(t.K_=function(n,r,s){const i=he(n);return i.w_(),new Hk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:Yk.bind(null,t),Ro:Xk.bind(null,t),mo:Jk.bind(null,t),d_:Zk.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),_m(t)?wm(t):t.q_.set("Unknown")):(await t.K_.stop(),_x(t))})),t.K_}function cs(t){return t.U_||(t.U_=function(n,r,s){const i=he(n);return i.w_(),new qk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:nA.bind(null,t),mo:iA.bind(null,t),f_:rA.bind(null,t),g_:sA.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await pu(t)):(await t.U_.stop(),t.O_.length>0&&(ee("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xm{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new mr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const o=Date.now()+r,l=new xm(e,n,o,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Z(B.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Em(t,e){if(xr("AsyncQueue",`${e}: ${t}`),Ma(t))return new Z(B.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi{constructor(e){this.comparator=e?(n,r)=>e(n,r)||te.comparator(n.key,r.key):(n,r)=>te.comparator(n.key,r.key),this.keyedMap=ko(),this.sortedSet=new Qe(this.comparator)}static emptySet(e){return new Pi(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Pi)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Pi;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qy{constructor(){this.W_=new Qe(te.comparator)}track(e){const n=e.doc.key,r=this.W_.get(n);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(n,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(n):e.type===1&&r.type===2?this.W_=this.W_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):ce():this.W_=this.W_.insert(n,e)}G_(){const e=[];return this.W_.inorderTraversal((n,r)=>{e.push(r)}),e}}class zi{constructor(e,n,r,s,i,o,l,u,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,i){const o=[];return n.forEach(l=>{o.push({type:0,doc:l})}),new zi(e,n,Pi.emptySet(n),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&lu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aA{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class lA{constructor(){this.queries=Yy(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(n,r){const s=he(n),i=s.queries;s.queries=Yy(),i.forEach((o,l)=>{for(const u of l.j_)u.onError(r)})})(this,new Z(B.ABORTED,"Firestore shutting down"))}}function Yy(){return new Zi(t=>q_(t),lu)}async function bm(t,e){const n=he(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new aA,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await n.onListen(s,!0);break;case 1:i.z_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(o){const l=Em(o,`Initialization of query '${si(e.query)}' failed`);return void e.onError(l)}n.queries.set(s,i),i.j_.push(e),e.Z_(n.onlineState),i.z_&&e.X_(i.z_)&&Cm(n)}async function Tm(t,e){const n=he(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function cA(t,e){const n=he(t);let r=!1;for(const s of e){const i=s.query,o=n.queries.get(i);if(o){for(const l of o.j_)l.X_(s)&&(r=!0);o.z_=s}}r&&Cm(n)}function uA(t,e,n){const r=he(t),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(n);r.queries.delete(e)}function Cm(t){t.Y_.forEach(e=>{e.next()})}var Bh,Xy;(Xy=Bh||(Bh={})).ea="default",Xy.Cache="cache";class Sm{constructor(e,n,r){this.query=e,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new zi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.na?this.ia(e)&&(this.ta.next(e),n=!0):this.sa(e,this.onlineState)&&(this.oa(e),n=!0),this.ra=e,n}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let n=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),n=!0),n}sa(e,n){if(!e.fromCache||!this.J_())return!0;const r=n!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const n=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}oa(e){e=zi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Bh.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tx{constructor(e){this.key=e}}class Cx{constructor(e){this.key=e}}class dA{constructor(e,n){this.query=e,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ve(),this.mutatedKeys=ve(),this.Aa=G_(e),this.Ra=new Pi(this.Aa)}get Va(){return this.Ta}ma(e,n){const r=n?n.fa:new Qy,s=n?n.Ra:this.Ra;let i=n?n.mutatedKeys:this.mutatedKeys,o=s,l=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((f,p)=>{const y=s.get(f),T=cu(this.query,p)?p:null,S=!!y&&this.mutatedKeys.has(y.key),A=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations);let k=!1;y&&T?y.data.isEqual(T.data)?S!==A&&(r.track({type:3,doc:T}),k=!0):this.ga(y,T)||(r.track({type:2,doc:T}),k=!0,(u&&this.Aa(T,u)>0||d&&this.Aa(T,d)<0)&&(l=!0)):!y&&T?(r.track({type:0,doc:T}),k=!0):y&&!T&&(r.track({type:1,doc:y}),k=!0,(u||d)&&(l=!0)),k&&(T?(o=o.add(T),i=A?i.add(f):i.delete(f)):(o=o.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{Ra:o,fa:r,ns:l,mutatedKeys:i}}ga(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((f,p)=>function(T,S){const A=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ce()}};return A(T)-A(S)}(f.type,p.type)||this.Aa(f.doc,p.doc)),this.pa(r),s=s!=null&&s;const l=n&&!s?this.ya():[],u=this.da.size===0&&this.current&&!s?1:0,d=u!==this.Ea;return this.Ea=u,o.length!==0||d?{snapshot:new zi(this.query,e.Ra,i,o,e.mutatedKeys,u===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Qy,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(n=>this.Ta=this.Ta.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ta=this.Ta.delete(n)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ve(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const n=[];return e.forEach(r=>{this.da.has(r)||n.push(new Cx(r))}),this.da.forEach(r=>{e.has(r)||n.push(new Tx(r))}),n}ba(e){this.Ta=e.Ts,this.da=ve();const n=this.ma(e.documents);return this.applyChanges(n,!0)}Da(){return zi.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class hA{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class fA{constructor(e){this.key=e,this.va=!1}}class mA{constructor(e,n,r,s,i,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Zi(l=>q_(l),lu),this.Ma=new Map,this.xa=new Set,this.Oa=new Qe(te.comparator),this.Na=new Map,this.La=new mm,this.Ba={},this.ka=new Map,this.qa=Bi.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function pA(t,e,n=!0){const r=Ax(t);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await Sx(r,e,n,!0),s}async function gA(t,e){const n=Ax(t);await Sx(n,e,!0,!1)}async function Sx(t,e,n,r){const s=await Vk(t.localStore,Qn(e)),i=s.targetId,o=t.sharedClientState.addLocalQueryTarget(i,n);let l;return r&&(l=await yA(t,e,i,o==="current",s.resumeToken)),t.isPrimaryClient&&n&&vx(t.remoteStore,s),l}async function yA(t,e,n,r,s){t.Ka=(p,y,T)=>async function(A,k,E,_){let I=k.view.ma(E);I.ns&&(I=await Hy(A.localStore,k.query,!1).then(({documents:w})=>k.view.ma(w,I)));const O=_&&_.targetChanges.get(k.targetId),D=_&&_.targetMismatches.get(k.targetId)!=null,L=k.view.applyChanges(I,A.isPrimaryClient,O,D);return Zy(A,k.targetId,L.wa),L.snapshot}(t,p,y,T);const i=await Hy(t.localStore,e,!0),o=new dA(e,i.Ts),l=o.ma(i.documents),u=Va.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=o.applyChanges(l,t.isPrimaryClient,u);Zy(t,n,d.wa);const f=new hA(e,n,o);return t.Fa.set(e,f),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),d.snapshot}async function vA(t,e,n){const r=he(t),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!lu(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await $h(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&ym(r.remoteStore,s.targetId),zh(r,s.targetId)}).catch(Da)):(zh(r,s.targetId),await $h(r.localStore,s.targetId,!0))}async function wA(t,e){const n=he(t),r=n.Fa.get(e),s=n.Ma.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),ym(n.remoteStore,r.targetId))}async function _A(t,e,n){const r=IA(t);try{const s=await function(o,l){const u=he(o),d=dt.now(),f=l.reduce((T,S)=>T.add(S.key),ve());let p,y;return u.persistence.runTransaction("Locally write mutations","readwrite",T=>{let S=Er(),A=ve();return u.cs.getEntries(T,f).next(k=>{S=k,S.forEach((E,_)=>{_.isValidDocument()||(A=A.add(E))})}).next(()=>u.localDocuments.getOverlayedDocuments(T,S)).next(k=>{p=k;const E=[];for(const _ of l){const I=BP(_,p.get(_.key).overlayedDocument);I!=null&&E.push(new ps(_.key,I,V_(I.value.mapValue),An.exists(!0)))}return u.mutationQueue.addMutationBatch(T,d,E,l)}).next(k=>{y=k;const E=k.applyToLocalDocumentSet(p,A);return u.documentOverlayCache.saveOverlays(T,k.batchId,E)})}).then(()=>({batchId:y.batchId,changes:Q_(p)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,l,u){let d=o.Ba[o.currentUser.toKey()];d||(d=new Qe(Ce)),d=d.insert(l,u),o.Ba[o.currentUser.toKey()]=d}(r,s.batchId,n),await Ua(r,s.changes),await pu(r.remoteStore)}catch(s){const i=Em(s,"Failed to persist write");n.reject(i)}}async function Ix(t,e){const n=he(t);try{const r=await Mk(n.localStore,e);e.targetChanges.forEach((s,i)=>{const o=n.Na.get(i);o&&(Ne(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Ne(o.va):s.removedDocuments.size>0&&(Ne(o.va),o.va=!1))}),await Ua(n,r,e)}catch(r){await Da(r)}}function Jy(t,e,n){const r=he(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Fa.forEach((i,o)=>{const l=o.view.Z_(e);l.snapshot&&s.push(l.snapshot)}),function(o,l){const u=he(o);u.onlineState=l;let d=!1;u.queries.forEach((f,p)=>{for(const y of p.j_)y.Z_(l)&&(d=!0)}),d&&Cm(u)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function xA(t,e,n){const r=he(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Qe(te.comparator);o=o.insert(i,Lt.newNoDocument(i,de.min()));const l=ve().add(i),u=new hu(de.min(),new Map,new Qe(Ce),o,l);await Ix(r,u),r.Oa=r.Oa.remove(i),r.Na.delete(e),Im(r)}else await $h(r.localStore,e,!1).then(()=>zh(r,e,n)).catch(Da)}async function EA(t,e){const n=he(t),r=e.batch.batchId;try{const s=await Dk(n.localStore,e);Px(n,r,null),Nx(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Ua(n,s)}catch(s){await Da(s)}}async function bA(t,e,n){const r=he(t);try{const s=await function(o,l){const u=he(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return u.mutationQueue.lookupMutationBatch(d,l).next(p=>(Ne(p!==null),f=p.keys(),u.mutationQueue.removeMutationBatch(d,p))).next(()=>u.mutationQueue.performConsistencyCheck(d)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(d,f,l)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>u.localDocuments.getDocuments(d,f))})}(r.localStore,e);Px(r,e,n),Nx(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Ua(r,s)}catch(s){await Da(s)}}function Nx(t,e){(t.ka.get(e)||[]).forEach(n=>{n.resolve()}),t.ka.delete(e)}function Px(t,e,n){const r=he(t);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function zh(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||kx(t,r)})}function kx(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);n!==null&&(ym(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),Im(t))}function Zy(t,e,n){for(const r of n)r instanceof Tx?(t.La.addReference(r.key,e),TA(t,r)):r instanceof Cx?(ee("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||kx(t,r.key)):ce()}function TA(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(ee("SyncEngine","New document in limbo: "+n),t.xa.add(r),Im(t))}function Im(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new te(Ve.fromString(e)),r=t.qa.next();t.Na.set(r,new fA(n)),t.Oa=t.Oa.insert(n,r),vx(t.remoteStore,new Hr(Qn(au(n.path)),r,"TargetPurposeLimboResolution",rm.oe))}}async function Ua(t,e,n){const r=he(t),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((l,u)=>{o.push(r.Ka(u,e,n).then(d=>{var f;if((d||n)&&r.isPrimaryClient){const p=d?!d.fromCache:(f=n==null?void 0:n.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(u.targetId,p?"current":"not-current")}if(d){s.push(d);const p=gm.Wi(u.targetId,d);i.push(p)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(u,d){const f=he(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>z.forEach(d,y=>z.forEach(y.$i,T=>f.persistence.referenceDelegate.addReference(p,y.targetId,T)).next(()=>z.forEach(y.Ui,T=>f.persistence.referenceDelegate.removeReference(p,y.targetId,T)))))}catch(p){if(!Ma(p))throw p;ee("LocalStore","Failed to update sequence numbers: "+p)}for(const p of d){const y=p.targetId;if(!p.fromCache){const T=f.os.get(y),S=T.snapshotVersion,A=T.withLastLimboFreeSnapshotVersion(S);f.os=f.os.insert(y,A)}}}(r.localStore,i))}async function CA(t,e){const n=he(t);if(!n.currentUser.isEqual(e)){ee("SyncEngine","User change. New user:",e.toKey());const r=await mx(n.localStore,e);n.currentUser=e,function(i,o){i.ka.forEach(l=>{l.forEach(u=>{u.reject(new Z(B.CANCELLED,o))})}),i.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ua(n,r.hs)}}function SA(t,e){const n=he(t),r=n.Na.get(e);if(r&&r.va)return ve().add(r.key);{let s=ve();const i=n.Ma.get(e);if(!i)return s;for(const o of i){const l=n.Fa.get(o);s=s.unionWith(l.view.Va)}return s}}function Ax(t){const e=he(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ix.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=SA.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xA.bind(null,e),e.Ca.d_=cA.bind(null,e.eventManager),e.Ca.$a=uA.bind(null,e.eventManager),e}function IA(t){const e=he(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=EA.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=bA.bind(null,e),e}class Mc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=fu(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,n){return null}Ha(e,n){return null}za(e){return jk(this.persistence,new Ak,e.initialUser,this.serializer)}Ga(e){return new Nk(pm.Zr,this.serializer)}Wa(e){return new Uk}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Mc.provider={build:()=>new Mc};class Wh{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Jy(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=CA.bind(null,this.syncEngine),await oA(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new lA}()}createDatastore(e){const n=fu(e.databaseInfo.databaseId),r=function(i){return new Wk(i)}(e.databaseInfo);return function(i,o,l,u){return new Gk(i,o,l,u)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,o,l){return new Qk(r,s,i,o,l)}(this.localStore,this.datastore,e.asyncQueue,n=>Jy(this.syncEngine,n,0),function(){return Gy.D()?new Gy:new $k}())}createSyncEngine(e,n){return function(s,i,o,l,u,d,f){const p=new mA(s,i,o,l,u,d);return f&&(p.Qa=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=he(s);ee("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Fa(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}Wh.provider={build:()=>new Wh};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nm{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):xr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NA{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=Mt.UNAUTHENTICATED,this.clientId=M_.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{ee("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(ee("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new mr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Em(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function xd(t,e){t.asyncQueue.verifyOperationInProgress(),ee("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await mx(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function ev(t,e){t.asyncQueue.verifyOperationInProgress();const n=await PA(t);ee("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>Ky(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>Ky(e.remoteStore,s)),t._onlineComponents=e}async function PA(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ee("FirestoreClient","Using user provided OfflineComponentProvider");try{await xd(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===B.FAILED_PRECONDITION||s.code===B.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;Vi("Error using user provided cache. Falling back to memory cache: "+n),await xd(t,new Mc)}}else ee("FirestoreClient","Using default OfflineComponentProvider"),await xd(t,new Mc);return t._offlineComponents}async function Rx(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ee("FirestoreClient","Using user provided OnlineComponentProvider"),await ev(t,t._uninitializedComponentsProvider._online)):(ee("FirestoreClient","Using default OnlineComponentProvider"),await ev(t,new Wh))),t._onlineComponents}function kA(t){return Rx(t).then(e=>e.syncEngine)}async function Oc(t){const e=await Rx(t),n=e.eventManager;return n.onListen=pA.bind(null,e.syncEngine),n.onUnlisten=vA.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=gA.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=wA.bind(null,e.syncEngine),n}function AA(t,e,n={}){const r=new mr;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,l,u,d){const f=new Nm({next:y=>{f.Za(),o.enqueueAndForget(()=>Tm(i,p));const T=y.docs.has(l);!T&&y.fromCache?d.reject(new Z(B.UNAVAILABLE,"Failed to get document because the client is offline.")):T&&y.fromCache&&u&&u.source==="server"?d.reject(new Z(B.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(y)},error:y=>d.reject(y)}),p=new Sm(au(l.path),f,{includeMetadataChanges:!0,_a:!0});return bm(i,p)}(await Oc(t),t.asyncQueue,e,n,r)),r.promise}function RA(t,e,n={}){const r=new mr;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,l,u,d){const f=new Nm({next:y=>{f.Za(),o.enqueueAndForget(()=>Tm(i,p)),y.fromCache&&u.source==="server"?d.reject(new Z(B.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(y)},error:y=>d.reject(y)}),p=new Sm(l,f,{includeMetadataChanges:!0,_a:!0});return bm(i,p)}(await Oc(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jx(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tv=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dx(t,e,n){if(!n)throw new Z(B.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function jA(t,e,n,r){if(e===!0&&r===!0)throw new Z(B.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function nv(t){if(!te.isDocumentKey(t))throw new Z(B.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function rv(t){if(te.isDocumentKey(t))throw new Z(B.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function gu(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ce()}function wn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Z(B.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=gu(t);throw new Z(B.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sv{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Z(B.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Z(B.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}jA("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=jx((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Z(B.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Z(B.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Z(B.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class yu{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new sv({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Z(B.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Z(B.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new sv(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new YN;switch(r.type){case"firstParty":return new eP(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Z(B.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=tv.get(n);r&&(ee("ComponentProvider","Removing Datastore"),tv.delete(n),r.terminate())}(this),Promise.resolve()}}function DA(t,e,n,r={}){var s;const i=(t=wn(t,yu))._getSettings(),o=`${e}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Vi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let l,u;if(typeof r.mockUserToken=="string")l=r.mockUserToken,u=Mt.MOCK_USER;else{l=lS(r.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new Z(B.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Mt(d)}t._authCredentials=new XN(new D_(l,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ys(this.firestore,e,this._query)}}class qt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ss(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new qt(this.firestore,e,this._key)}}class ss extends Ys{constructor(e,n,r){super(e,n,au(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new qt(this.firestore,null,new te(e))}withConverter(e){return new ss(this.firestore,e,this._path)}}function yt(t,e,...n){if(t=at(t),Dx("collection","path",e),t instanceof yu){const r=Ve.fromString(e,...n);return rv(r),new ss(t,null,r)}{if(!(t instanceof qt||t instanceof ss))throw new Z(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ve.fromString(e,...n));return rv(r),new ss(t.firestore,null,r)}}function Nt(t,e,...n){if(t=at(t),arguments.length===1&&(e=M_.newId()),Dx("doc","path",e),t instanceof yu){const r=Ve.fromString(e,...n);return nv(r),new qt(t,null,new te(r))}{if(!(t instanceof qt||t instanceof ss))throw new Z(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ve.fromString(e,...n));return nv(r),new qt(t.firestore,t instanceof ss?t.converter:null,new te(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iv{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new gx(this,"async_queue_retry"),this.Vu=()=>{const r=_d();r&&ee("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const n=_d();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const n=_d();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const n=new mr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Ma(e))throw e;ee("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const n=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let l=o.message||"";return o.stack&&(l=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),l}(r);throw xr("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=n,n}enqueueAfterDelay(e,n,r){this.fu(),this.Ru.indexOf(e)>-1&&(n=0);const s=xm.createAndSchedule(this,e,n,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&ce()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const n of this.Tu)if(n.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Tu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const n=this.Tu.indexOf(e);this.Tu.splice(n,1)}}function ov(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class us extends yu{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new iv,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new iv(e),this._firestoreClient=void 0,await e}}}function MA(t,e){const n=typeof t=="object"?t:Ww(),r=typeof t=="string"?t:e||"(default)",s=qf(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=oS("firestore");i&&DA(s,...i)}return s}function vu(t){if(t._terminated)throw new Z(B.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||OA(t),t._firestoreClient}function OA(t){var e,n,r;const s=t._freezeSettings(),i=function(l,u,d,f){return new fP(l,u,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,jx(f.experimentalLongPollingOptions),f.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new NA(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(l){const u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wi(It.fromBase64String(e))}catch(n){throw new Z(B.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Wi(It.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Z(B.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new bt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _u{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pm{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Z(B.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Z(B.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ce(this._lat,e._lat)||Ce(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LA=/^__.*__$/;class VA{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new ps(e,this.data,this.fieldMask,n,this.fieldTransforms):new La(e,this.data,n,this.fieldTransforms)}}class Mx{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new ps(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function Ox(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ce()}}class Am{constructor(e,n,r,s,i,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Am(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Lc(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Ox(this.Cu)&&LA.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class FA{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||fu(e)}Qu(e,n,r,s=!1){return new Am({Cu:e,methodName:n,qu:r,path:bt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Rm(t){const e=t._freezeSettings(),n=fu(t._databaseId);return new FA(t._databaseId,!!e.ignoreUndefinedProperties,n)}function UA(t,e,n,r,s,i={}){const o=t.Qu(i.merge||i.mergeFields?2:0,e,n,s);Dm("Data must be an object, but it was:",o,r);const l=Lx(r,o);let u,d;if(i.merge)u=new cn(o.fieldMask),d=o.fieldTransforms;else if(i.mergeFields){const f=[];for(const p of i.mergeFields){const y=Hh(e,p,n);if(!o.contains(y))throw new Z(B.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);Fx(f,y)||f.push(y)}u=new cn(f),d=o.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,d=o.fieldTransforms;return new VA(new Jt(l),u,d)}class xu extends _u{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof xu}}class jm extends _u{_toFieldTransform(e){return new VP(e.path,new wa)}isEqual(e){return e instanceof jm}}function $A(t,e,n,r){const s=t.Qu(1,e,n);Dm("Data must be an object, but it was:",s,r);const i=[],o=Jt.empty();Ks(r,(u,d)=>{const f=Mm(e,u,n);d=at(d);const p=s.Nu(f);if(d instanceof xu)i.push(f);else{const y=$a(d,p);y!=null&&(i.push(f),o.set(f,y))}});const l=new cn(i);return new Mx(o,l,s.fieldTransforms)}function BA(t,e,n,r,s,i){const o=t.Qu(1,e,n),l=[Hh(e,r,n)],u=[s];if(i.length%2!=0)throw new Z(B.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<i.length;y+=2)l.push(Hh(e,i[y])),u.push(i[y+1]);const d=[],f=Jt.empty();for(let y=l.length-1;y>=0;--y)if(!Fx(d,l[y])){const T=l[y];let S=u[y];S=at(S);const A=o.Nu(T);if(S instanceof xu)d.push(T);else{const k=$a(S,A);k!=null&&(d.push(T),f.set(T,k))}}const p=new cn(d);return new Mx(f,p,o.fieldTransforms)}function zA(t,e,n,r=!1){return $a(n,t.Qu(r?4:3,e))}function $a(t,e){if(Vx(t=at(t)))return Dm("Unsupported field value:",e,t),Lx(t,e);if(t instanceof _u)return function(r,s){if(!Ox(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const l of r){let u=$a(l,s.Lu(o));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),o++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=at(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return MP(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=dt.fromDate(r);return{timestampValue:jc(s.serializer,i)}}if(r instanceof dt){const i=new dt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:jc(s.serializer,i)}}if(r instanceof Pm)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Wi)return{bytesValue:ax(s.serializer,r._byteString)};if(r instanceof qt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:fm(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof km)return function(o,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw l.Bu("VectorValues must only contain numeric values.");return cm(l.serializer,u)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${gu(r)}`)}(t,e)}function Lx(t,e){const n={};return O_(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ks(t,(r,s)=>{const i=$a(s,e.Mu(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function Vx(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof dt||t instanceof Pm||t instanceof Wi||t instanceof qt||t instanceof _u||t instanceof km)}function Dm(t,e,n){if(!Vx(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const r=gu(n);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function Hh(t,e,n){if((e=at(e))instanceof wu)return e._internalPath;if(typeof e=="string")return Mm(t,e);throw Lc("Field path arguments must be of type string or ",t,!1,void 0,n)}const WA=new RegExp("[~\\*/\\[\\]]");function Mm(t,e,n){if(e.search(WA)>=0)throw Lc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new wu(...e.split("."))._internalPath}catch{throw Lc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Lc(t,e,n,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new Z(B.INVALID_ARGUMENT,l+t+u)}function Fx(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ux{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new qt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new HA(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Om("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class HA extends Ux{data(){return super.data()}}function Om(t,e){return typeof e=="string"?Mm(t,e):e instanceof wu?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $x(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Z(B.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Lm{}class qA extends Lm{}function hn(t,e,...n){let r=[];e instanceof Lm&&r.push(e),r=r.concat(n),function(i){const o=i.filter(u=>u instanceof Vm).length,l=i.filter(u=>u instanceof Eu).length;if(o>1||o>0&&l>0)throw new Z(B.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Eu extends qA{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Eu(e,n,r)}_apply(e){const n=this._parse(e);return Bx(e._query,n),new Ys(e.firestore,e.converter,Mh(e._query,n))}_parse(e){const n=Rm(e.firestore);return function(i,o,l,u,d,f,p){let y;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new Z(B.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){lv(p,f);const T=[];for(const S of p)T.push(av(u,i,S));y={arrayValue:{values:T}}}else y=av(u,i,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||lv(p,f),y=zA(l,o,p,f==="in"||f==="not-in");return it.create(d,f,y)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function $t(t,e,n){const r=e,s=Om("where",t);return Eu._create(s,r,n)}class Vm extends Lm{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Vm(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Dn.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let o=s;const l=i.getFlattenedFilters();for(const u of l)Bx(o,u),o=Mh(o,u)}(e._query,n),new Ys(e.firestore,e.converter,Mh(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function av(t,e,n){if(typeof(n=at(n))=="string"){if(n==="")throw new Z(B.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!H_(e)&&n.indexOf("/")!==-1)throw new Z(B.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ve.fromString(n));if(!te.isDocumentKey(r))throw new Z(B.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ny(t,new te(r))}if(n instanceof qt)return Ny(t,n._key);throw new Z(B.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${gu(n)}.`)}function lv(t,e){if(!Array.isArray(t)||t.length===0)throw new Z(B.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Bx(t,e){const n=function(s,i){for(const o of s)for(const l of o.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new Z(B.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Z(B.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class GA{convertValue(e,n="none"){switch(Bs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return et(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes($s(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw ce()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Ks(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var n,r,s;const i=(s=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>et(o.doubleValue));return new km(i)}convertGeoPoint(e){return new Pm(et(e.latitude),et(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=im(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(ga(e));default:return null}}convertTimestamp(e){const n=ls(e);return new dt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ve.fromString(e);Ne(fx(r));const s=new ya(r.get(1),r.get(3)),i=new te(r.popFirst(5));return s.isEqual(n)||xr(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KA(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ro{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class zx extends Ux{constructor(e,n,r,s,i,o){super(e,n,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Kl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Om("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class Kl extends zx{data(e={}){return super.data(e)}}class Wx{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Ro(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Kl(this._firestore,this._userDataWriter,r.key,r,new Ro(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Z(B.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(l=>{const u=new Kl(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Ro(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const u=new Kl(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Ro(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return l.type!==0&&(d=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),f=o.indexOf(l.doc.key)),{type:QA(l.type),doc:u,oldIndex:d,newIndex:f}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function QA(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ce()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xs(t){t=wn(t,qt);const e=wn(t.firestore,us);return AA(vu(e),t._key).then(n=>Hx(e,t,n))}class Fm extends GA{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wi(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new qt(this.firestore,null,n)}}function Mn(t){t=wn(t,Ys);const e=wn(t.firestore,us),n=vu(e),r=new Fm(e);return $x(t._query),RA(n,t._query).then(s=>new Wx(e,r,t,s))}function En(t,e,n,...r){t=wn(t,qt);const s=wn(t.firestore,us),i=Rm(s);let o;return o=typeof(e=at(e))=="string"||e instanceof wu?BA(i,"updateDoc",t._key,e,n,r):$A(i,"updateDoc",t._key,e),$m(s,[o.toMutation(t._key,An.exists(!0))])}function Ed(t){return $m(wn(t.firestore,us),[new um(t._key,An.none())])}function Ba(t,e){const n=wn(t.firestore,us),r=Nt(t),s=KA(t.converter,e);return $m(n,[UA(Rm(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,An.exists(!1))]).then(()=>r)}function Um(t,...e){var n,r,s;t=at(t);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||ov(e[o])||(i=e[o],o++);const l={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(ov(e[o])){const p=e[o];e[o]=(n=p.next)===null||n===void 0?void 0:n.bind(p),e[o+1]=(r=p.error)===null||r===void 0?void 0:r.bind(p),e[o+2]=(s=p.complete)===null||s===void 0?void 0:s.bind(p)}let u,d,f;if(t instanceof qt)d=wn(t.firestore,us),f=au(t._key.path),u={next:p=>{e[o]&&e[o](Hx(d,t,p))},error:e[o+1],complete:e[o+2]};else{const p=wn(t,Ys);d=wn(p.firestore,us),f=p._query;const y=new Fm(d);u={next:T=>{e[o]&&e[o](new Wx(d,y,p,T))},error:e[o+1],complete:e[o+2]},$x(t._query)}return function(y,T,S,A){const k=new Nm(A),E=new Sm(T,k,S);return y.asyncQueue.enqueueAndForget(async()=>bm(await Oc(y),E)),()=>{k.Za(),y.asyncQueue.enqueueAndForget(async()=>Tm(await Oc(y),E))}}(vu(d),f,l,u)}function $m(t,e){return function(r,s){const i=new mr;return r.asyncQueue.enqueueAndForget(async()=>_A(await kA(r),s,i)),i.promise}(vu(t),e)}function Hx(t,e,n){const r=n.docs.get(e._key),s=new Fm(t);return new zx(t,s,e._key,r,new Ro(n.hasPendingWrites,n.fromCache),e.converter)}function Ye(){return new jm("serverTimestamp")}(function(e,n=!0){(function(s){Ji=s})(Yi),Li(new Ls("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),l=new us(new JN(r.getProvider("auth-internal")),new nP(r.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new Z(B.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ya(d.options.projectId,f)}(o,s),o);return i=Object.assign({useFetchStreams:n},i),l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),rs(by,"4.7.3",e),rs(by,"4.7.3","esm2017")})();const YA={apiKey:"AIzaSyB_1Dn63ZHRnA-jXytu95WEBWNFQ64Jo_E",authDomain:"dnd-v1-17acc.firebaseapp.com",projectId:"dnd-v1-17acc",storageBucket:"dnd-v1-17acc.firebasestorage.app",messagingSenderId:"976056329393",appId:"1:976056329393:web:7c8170e906162fe4ef2e90"},qx=zw(YA),zs=qN(qx),xe=MA(qx),XA=async(t,e)=>{try{const n={...e,userId:t,createdAt:Ye(),updatedAt:Ye()};return{id:(await Ba(yt(xe,"userProfiles"),n)).id,...n}}catch(n){throw console.error("Error creating user profile:",n),n}},to=async t=>{try{const e=hn(yt(xe,"userProfiles"),$t("userId","==",t)),n=await Mn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting user profile:",e),e}},Gx=async t=>{try{if(!t||t.length===0)return[];const e=[];for(let s=0;s<t.length;s+=10){const i=t.slice(s,s+10),o=hn(yt(xe,"userProfiles"),$t("userId","in",i));e.push(Mn(o))}const n=await Promise.all(e),r=[];return n.forEach(s=>{s.docs.forEach(i=>{r.push({id:i.id,...i.data()})})}),r}catch(e){throw console.error("Error getting user profiles:",e),e}},JA=async t=>{try{const e=hn(yt(xe,"userProfiles"),$t("username","==",t));return(await Mn(e)).empty}catch(e){throw console.error("Error checking username availability:",e),e}},ZA=async(t,e,n)=>{try{const r={...n,userId:t,partyId:e,createdAt:Ye(),updatedAt:Ye()};return{id:(await Ba(yt(xe,"characters"),r)).id,...r}}catch(r){throw console.error("Error saving character:",r),r}},Kx=async(t,e)=>{try{const n=hn(yt(xe,"characters"),$t("userId","==",t),$t("partyId","==",e)),r=await Mn(n);if(r.empty)return null;const s=r.docs[0];return{id:s.id,...s.data()}}catch(n){throw console.error("Error getting character by user and party:",n),n}},Bm=async t=>{try{const e=hn(yt(xe,"characters"),$t("partyId","==",t));return(await Mn(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){throw console.error("Error getting party characters:",e),e}},eR=async(t,e)=>{try{const n=Nt(xe,"characters",t);await En(n,{...e,updatedAt:Ye()})}catch(n){throw console.error("Error updating character:",n),n}},tR=async(t,e)=>{try{const n={...e,dmId:t,members:[t],createdAt:Ye(),updatedAt:Ye()};return{id:(await Ba(yt(xe,"parties"),n)).id,...n}}catch(n){throw console.error("Error creating party:",n),n}},zm=async t=>{try{const e=hn(yt(xe,"parties"),$t("members","array-contains",t));return(await Mn(e)).docs.map(s=>{const i=s.data();return{id:s.id,...i}})}catch(e){throw e}},nR=async(t,e)=>{try{const n=Nt(xe,"parties",t),r=await Xs(n);if(!r.exists())throw new Error("Party not found");const s=r.data();if(s.members.includes(e))throw new Error("User already in party");await En(n,{members:[...s.members,e],updatedAt:Ye()})}catch(n){throw console.error("Error joining party:",n),n}},rR=async(t,e)=>{try{const n=Nt(xe,"parties",t),r=await Xs(n);if(!r.exists())throw new Error("Party not found");if(r.data().dmId!==e)throw new Error("Only the party leader can disband the party");await Ed(n);const i=hn(yt(xe,"characters"),$t("partyId","==",t)),l=(await Mn(i)).docs.map(p=>Ed(p.ref));await Promise.all(l);const u=hn(yt(xe,"campaignStories"),$t("partyId","==",t)),f=(await Mn(u)).docs.map(p=>Ed(p.ref));await Promise.all(f)}catch(n){throw console.error("Error disbanding party:",n),n}},sR=async t=>{try{const e=hn(yt(xe,"parties"),$t("inviteCode","==",t)),n=await Mn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting party by invite code:",e),e}},Qx=async t=>{try{const e=Nt(xe,"parties",t),n=await Xs(e);return n.exists()?{id:n.id,...n.data()}:null}catch(e){throw console.error("Error getting party by ID:",e),e}},iR=async t=>{try{const e={partyId:t,status:"ready_up",currentPlot:null,storyMessages:[],votingSession:null,readyPlayers:[],lastUpdated:Ye(),createdAt:Ye()};return{id:(await Ba(yt(xe,"campaignStories"),e)).id,...e}}catch(e){throw console.error("Error creating campaign story:",e),e}},oR=async t=>{try{const e=hn(yt(xe,"campaignStories"),$t("partyId","==",t)),n=await Mn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting campaign story:",e),e}},In=async(t,e)=>{try{const n=Nt(xe,"campaignStories",t);await En(n,{...e,lastUpdated:Ye()})}catch(n){throw console.error("Error updating campaign story:",n),n}},bd=async(t,e)=>{try{const n=Nt(xe,"campaignStories",t),s=(await Xs(n)).data(),i={id:`msg_${Date.now()}`,...e,timestamp:new Date};return await En(n,{storyMessages:[...s.storyMessages,i],lastUpdated:Ye()}),i}catch(n){throw console.error("Error adding story message:",n),n}},aR=async(t,e)=>{try{const n=Nt(xe,"campaignStories",t),i=(await Xs(n)).data().readyPlayers||[];i.includes(e)||await En(n,{readyPlayers:[...i,e],lastUpdated:Ye()})}catch(n){throw console.error("Error setting player ready:",n),n}},lR=(t,e)=>{try{const n=Nt(xe,"campaignStories",t);return Um(n,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})}catch(n){throw console.error("Error subscribing to campaign story:",n),n}},cv=async(t,e)=>{try{const n=Nt(xe,"campaignStories",t);await En(n,{currentSpeaker:e,lastUpdated:Ye()})}catch(n){throw console.error("Error setting current speaker:",n),n}},Td=async(t,e)=>{try{const n=Nt(xe,"campaignStories",t);await En(n,{currentController:e,lastUpdated:Ye()})}catch(n){throw console.error("Error setting current controller:",n),n}},cR=async(t,e)=>{try{const n={partyId:t,status:"active",storyContext:e.storyContext,partyMembers:e.partyMembers,enemies:e.enemies,initiative:e.initiative,currentTurn:0,combatState:"preparation",createdAt:Ye(),updatedAt:Ye()};return{id:(await Ba(yt(xe,"combatSessions"),n)).id,...n}}catch(n){throw console.error("Error creating combat session:",n),n}},Yx=async t=>{try{const e=hn(yt(xe,"combatSessions"),$t("partyId","==",t),$t("status","==","active")),n=await Mn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting combat session:",e),e}},uR=async(t,e)=>{try{const n=Nt(xe,"combatSessions",t);await En(n,{...e,updatedAt:Ye()})}catch(n){throw console.error("Error updating combat session:",n),n}},Xx=(t,e)=>{try{const n=hn(yt(xe,"combatSessions"),$t("partyId","==",t),$t("status","==","active"));return Um(n,r=>{if(r.empty)e(null);else{const s=r.docs[0];e({id:s.id,...s.data()})}})}catch(n){throw console.error("Error subscribing to combat session:",n),n}},dR=async(t,e)=>{try{console.log("saveCharacterPreset called with:",{userId:t,presetData:e});const n=await to(t);if(console.log("User profile retrieved:",n),!n)throw console.error("User profile not found for userId:",t),new Error("User profile not found");const r={id:Date.now().toString(),name:e.name,data:e.data,createdAt:new Date};console.log("Created preset object:",r);const s=n.characterPresets||[];console.log("Existing presets:",s);const i=[...s,r];console.log("Updated presets array:",i);const o=Nt(xe,"userProfiles",n.id);return console.log("Updating profile with ID:",n.id),await En(o,{characterPresets:i,updatedAt:Ye()}),console.log("Profile updated successfully"),r}catch(n){throw console.error("Error saving character preset:",n),console.error("Error details:",{message:n.message,code:n.code,stack:n.stack}),n}},qh=async t=>{try{const e=await to(t);return e?e.characterPresets||[]:[]}catch(e){throw console.error("Error getting user character presets:",e),e}},Jx=async(t,e)=>{try{const n=await to(t);if(!n)throw new Error("User profile not found");const s=(n.characterPresets||[]).filter(o=>o.id!==e),i=Nt(xe,"userProfiles",n.id);await En(i,{characterPresets:s,updatedAt:Ye()})}catch(n){throw console.error("Error deleting character preset:",n),n}},hR=async t=>{try{const e=Nt(xe,"campaignStories",t);return(await Xs(e)).data().storyState||null}catch(e){throw console.error("Error getting story state:",e),e}},fR=async(t,e)=>{try{const n=Nt(xe,"campaignStories",t),o={...(await Xs(n)).data().storyState||{},...e,lastUpdated:Ye()};return await En(n,{storyState:o,lastUpdated:Ye()}),o}catch(n){throw console.error("Error updating story state:",n),n}},ri=async(t,e)=>{try{const n=Nt(xe,"combatSessions",t);await En(n,{...e,updatedAt:Ye()})}catch(n){throw console.error("Error updating combat session with narrative:",n),n}},mR=async(t,e,n)=>{try{if(console.log("Starting registration for:",t,n),!await JA(n))return console.log("Username not available:",n),{user:null,error:"Username is already taken. Please choose a different username."};console.log("Username available:",n);const s=await k1(zs,t,e);console.log("User created successfully:",s.user.uid);try{await XA(s.user.uid,{username:n,email:t,displayName:n}),console.log("User profile created successfully")}catch(o){console.error("Error creating user profile:",o)}let i=!1;try{await R1(s.user),console.log("Email verification sent successfully"),i=!0}catch(o){console.error("Error sending email verification:",o)}return await y_(zs),console.log("User signed out after registration"),{user:null,error:null,success:!0}}catch(r){return console.error("Registration error:",r),{user:null,error:r.message}}},pR=async(t,e)=>{try{return{user:(await A1(zs,t,e)).user,error:null}}catch(n){return{user:null,error:n.message}}},gR=async()=>{try{return await y_(zs),{error:null}}catch(t){return{error:t.message}}},gs=t=>M1(zs,async e=>{t(e)}),yR=async()=>{try{return console.log("Testing Firebase connection..."),console.log("Auth domain:",zs.config.authDomain),console.log("Project ID:",zs.config.projectId),{success:!0,message:"Firebase connection successful"}}catch(t){return console.error("Firebase connection test failed:",t),{success:!1,error:t.message}}};function vR(){const[t,e]=j.useState(null),[n,r]=j.useState(null),[s,i]=j.useState(!1),o=Jn();j.useEffect(()=>{const d=gs(async f=>{if(e(f),f)try{const p=await to(f.uid);r(p)}catch(p){console.error("Error loading user profile:",p)}else r(null)});return()=>d()},[]);const l=async()=>{const{error:d}=await gR();d||o("/")},u=(n==null?void 0:n.username)||(t==null?void 0:t.email);return c.jsx("nav",{className:"bg-stone-800 text-white shadow-lg",children:c.jsx("div",{className:"fantasy-container",children:c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx(Is,{to:"/",className:"text-2xl font-bold font-['Cinzel']",children:"DND-V1"}),c.jsx("div",{className:"flex items-center space-x-4",children:t?c.jsxs(c.Fragment,{children:[c.jsx(Is,{to:"/dashboard",className:"fantasy-button",children:"Dashboard"}),c.jsx(Is,{to:"/party-management",className:"fantasy-button",children:"Parties"}),c.jsxs("div",{className:"relative",children:[c.jsx("button",{onClick:()=>i(!s),className:"fantasy-button bg-stone-700 hover:bg-stone-600",children:u}),s&&c.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-stone-200 z-50",children:c.jsxs("div",{className:"py-2",children:[c.jsxs("div",{className:"px-4 py-2 text-sm text-stone-700 border-b border-stone-200",children:[c.jsx("div",{className:"font-medium",children:u}),c.jsx("div",{className:"text-xs text-stone-500",children:t.email})]}),c.jsx("button",{onClick:l,className:"w-full text-left px-4 py-2 text-sm text-stone-700 hover:bg-stone-100",children:"Logout"})]})})]})]}):c.jsx(Is,{to:"/login",className:"fantasy-button",children:"Login"})})]})})})}function wR(){return c.jsxs("div",{className:"relative overflow-hidden",children:[c.jsx("div",{className:"fantasy-container",children:c.jsxs("div",{className:"relative z-10 py-8 sm:py-16 lg:py-24 text-center",children:[c.jsx("h1",{className:"fantasy-title text-5xl sm:text-6xl lg:text-7xl",children:"Manage your D&D world like a real adventurer's tome"}),c.jsx("p",{className:"fantasy-subtitle max-w-2xl mx-auto",children:"Create parties, invite friends, and share story objectives in a beautifully crafted digital environment that feels like a magical grimoire."}),c.jsxs("div",{className:"mt-8 flex justify-center space-x-6",children:[c.jsx(Is,{to:"/register",className:"fantasy-button text-lg px-8 py-3",children:"Start Your Journey"}),c.jsx(Is,{to:"/login",className:"fantasy-button text-lg px-8 py-3 bg-stone-600 hover:bg-stone-700",children:"Return to Campaign"})]})]})}),c.jsx("div",{className:"absolute inset-0 bg-stone-200/10 pattern-grid-lg"})]})}function _R(){return c.jsxs("div",{children:[c.jsx(wR,{}),c.jsx("div",{className:"fantasy-container py-16",children:c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[c.jsxs("div",{className:"fantasy-card",children:[c.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Create Parties"}),c.jsx("p",{className:"text-stone-600",children:"Form adventuring parties with your friends and manage your campaign together in a shared space."})]}),c.jsxs("div",{className:"fantasy-card",children:[c.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Track Objectives"}),c.jsx("p",{className:"text-stone-600",children:"Keep track of your party's quests, storylines, and achievements in an organized magical tome."})]}),c.jsxs("div",{className:"fantasy-card",children:[c.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Share Stories"}),c.jsx("p",{className:"text-stone-600",children:"Document your adventures and share them with your fellow party members in an immersive fantasy setting."})]})]})})]})}function xR(){const[t,e]=j.useState(""),[n,r]=j.useState(""),[s,i]=j.useState(!1),[o,l]=j.useState(""),[u,d]=j.useState(""),f=Jn(),p=Qi();j.useEffect(()=>{var S;(S=p.state)!=null&&S.message&&(d(p.state.message),f(p.pathname,{replace:!0}));const T=gs(A=>{A&&f("/dashboard")});return()=>T()},[f,p]);const y=async T=>{T.preventDefault(),i(!0),l("");const S=await pR(t,n);S.error&&(S.error.includes("auth/invalid-credential")?l("Invalid email or password. Please check your credentials or register a new account."):S.error.includes("auth/user-not-found")?l("No account found with this email. Please register first."):S.error.includes("auth/wrong-password")?l("Incorrect password. Please try again."):S.error.includes("auth/user-disabled")?l("This account has been disabled. Please contact support."):S.error.includes("auth/too-many-requests")?l("Too many failed login attempts. Please try again later."):l(S.error)),i(!1)};return c.jsx("div",{className:"fantasy-container py-8",children:c.jsxs("div",{className:"fantasy-card max-w-md mx-auto",children:[c.jsx("h1",{className:"fantasy-title text-center",children:"Login"}),u&&c.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-4",children:u}),c.jsxs("form",{onSubmit:y,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Email"}),c.jsx("input",{type:"email",value:t,onChange:T=>e(T.target.value),className:"fantasy-input",required:!0})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Password"}),c.jsx("input",{type:"password",value:n,onChange:T=>r(T.target.value),className:"fantasy-input",required:!0})]}),o&&c.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg",children:o}),c.jsx("button",{type:"submit",disabled:s,className:"fantasy-button w-full",children:s?"Logging in...":"Login"})]}),c.jsx("div",{className:"mt-6 text-center",children:c.jsxs("p",{className:"text-stone-600",children:["Don't have an account?"," ",c.jsx("button",{onClick:()=>f("/register"),className:"text-amber-700 hover:text-amber-800 font-medium",children:"Register here"})]})})]})})}function ER(){const[t,e]=j.useState(""),[n,r]=j.useState(""),[s,i]=j.useState(""),[o,l]=j.useState(""),[u,d]=j.useState(""),[f,p]=j.useState(""),y=Jn();j.useEffect(()=>{yR().then(S=>{console.log("Firebase test result:",S)})},[]);const T=async S=>{if(S.preventDefault(),d(""),p(""),s!==o){d("Passwords do not match");return}if(!n.trim()){d("Username is required");return}if(n.length<3){d("Username must be at least 3 characters long");return}if(!/^[a-zA-Z0-9_]+$/.test(n)){d("Username can only contain letters, numbers, and underscores");return}console.log("Submitting registration for:",t,n);const{user:A,error:k,success:E}=await mR(t,s,n);if(console.log("Registration result:",{user:A,error:k,success:E}),k){console.log("Setting error:",k),d(k);return}E?(console.log("Registration successful, redirecting to login"),y("/login",{state:{message:"Registration successful! Please check your email to verify your account before logging in."}})):console.log("No success received from registration")};return c.jsx("div",{className:"fantasy-container min-h-screen flex items-center justify-center",children:c.jsxs("div",{className:"fantasy-card w-full max-w-md",children:[c.jsx("h2",{className:"fantasy-title text-center",children:"Begin Your Adventure"}),u&&c.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:u}),f&&c.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:f}),c.jsxs("form",{onSubmit:T,className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-stone-700",children:"Username"}),c.jsx("input",{id:"username",type:"text",required:!0,value:n,onChange:S=>r(S.target.value),className:"fantasy-input mt-1",placeholder:"Choose a unique username"}),c.jsx("p",{className:"text-xs text-stone-500 mt-1",children:"Letters, numbers, and underscores only. 3+ characters."})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-stone-700",children:"Email"}),c.jsx("input",{id:"email",type:"email",required:!0,value:t,onChange:S=>e(S.target.value),className:"fantasy-input mt-1"})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-stone-700",children:"Password"}),c.jsx("input",{id:"password",type:"password",required:!0,value:s,onChange:S=>i(S.target.value),className:"fantasy-input mt-1"})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-stone-700",children:"Confirm Password"}),c.jsx("input",{id:"confirmPassword",type:"password",required:!0,value:o,onChange:S=>l(S.target.value),className:"fantasy-input mt-1"})]}),c.jsx("button",{type:"submit",className:"fantasy-button w-full",children:"Register"})]}),c.jsxs("p",{className:"mt-4 text-center text-sm text-stone-600",children:["Already have an account?"," ",c.jsx(Is,{to:"/login",className:"text-amber-700 hover:text-amber-800",children:"Return to your campaign"})]})]})})}class bR{constructor(){this.actionTypes={attack:{name:"Attack",cooldown:0,priority:"normal",description:"A basic physical attack",narrativeTemplate:"{character} {action} with {weapon}!"},spell:{name:"Cast Spell",cooldown:1,priority:"normal",description:"Cast a magical spell",narrativeTemplate:"{character} channels arcane energy into {spell}!"},special:{name:"Special Ability",cooldown:2,priority:"high",description:"Use a special class ability",narrativeTemplate:"{character} unleashes their {ability}!"},item:{name:"Use Item",cooldown:0,priority:"low",description:"Use an item or consumable",narrativeTemplate:"{character} uses {item}!"},defend:{name:"Defend",cooldown:0,priority:"high",description:"Take a defensive stance",narrativeTemplate:"{character} takes a defensive stance!"},environmental:{name:"Environmental Action",cooldown:1,priority:"normal",description:"Use the environment to your advantage",narrativeTemplate:"{character} uses the {environment} to their advantage!"},teamUp:{name:"Team Up",cooldown:3,priority:"high",description:"Coordinate with another party member",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}},this.statusEffects={poisoned:{name:"Poisoned",duration:3,effect:"lose 1 HP per turn",narrative:"is suffering from poison"},burned:{name:"Burned",duration:2,effect:"lose 2 HP per turn",narrative:"is burning with magical flames"},frozen:{name:"Frozen",duration:1,effect:"skip next turn",narrative:"is frozen solid"},paralyzed:{name:"Paralyzed",duration:2,effect:"50% chance to skip turn",narrative:"is paralyzed and can barely move"},confused:{name:"Confused",duration:2,effect:"may attack randomly",narrative:"is confused and disoriented"},blessed:{name:"Blessed",duration:3,effect:"+2 to attack rolls",narrative:"is blessed with divine favor"},hasted:{name:"Hasted",duration:2,effect:"extra action per turn",narrative:"is moving with supernatural speed"}},this.classAbilities={fighter:{name:"Second Wind",description:"Recover some HP",effect:"heal 1d6+2 HP",cooldown:3},wizard:{name:"Arcane Surge",description:"Enhance next spell",effect:"+2 to spell damage",cooldown:2},rogue:{name:"Sneak Attack",description:"Deal extra damage from stealth",effect:"+1d6 damage if target is unaware",cooldown:1},cleric:{name:"Divine Favor",description:"Bless an ally",effect:"target gets +1 to all rolls",cooldown:2}}}initializeCombat(e,n,r){return{combatants:[...e,...n].map(o=>({...o,initiative:this.calculateInitiative(o),statusEffects:[],cooldowns:{},lastAction:null,turnCount:0})).sort((o,l)=>l.initiative-o.initiative),currentTurn:0,round:1,phase:"preparation",storyContext:r,environmentalFeatures:this.extractEnvironmentalFeatures(r),teamUpOpportunities:this.identifyTeamUpOpportunities(e),narrativeElements:this.extractNarrativeElements(r)}}calculateInitiative(e){var s,i,o;let n=Math.floor(Math.random()*20)+1;return n+={rogue:3,monk:2,ranger:1,fighter:0,cleric:0,wizard:-1,paladin:-1}[(s=e.class)==null?void 0:s.toLowerCase()]||0,(i=e.statusEffects)!=null&&i.includes("hasted")&&(n+=5),(o=e.statusEffects)!=null&&o.includes("paralyzed")&&(n-=3),n}extractEnvironmentalFeatures(e){const n=[],r={forest:["trees","cover","difficult terrain"],cave:["darkness","echoes","tight spaces"],tavern:["furniture","crowds","flammable materials"],castle:["stone walls","narrow corridors","defensive positions"],dungeon:["traps","darkness","confined spaces"],outdoors:["weather","open space","natural cover"]},s=e.toLowerCase();return Object.entries(r).forEach(([i,o])=>{s.includes(i)&&n.push(...o)}),n}identifyTeamUpOpportunities(e){const n=[];return[{classes:["fighter","rogue"],description:"Fighter distracts while Rogue sneaks in for a backstab"},{classes:["wizard","cleric"],description:"Wizard casts area spell while Cleric protects the party"},{classes:["fighter","cleric"],description:"Fighter tanks while Cleric provides healing support"},{classes:["rogue","wizard"],description:"Rogue scouts while Wizard provides magical backup"}].forEach(s=>{s.classes.every(o=>e.some(l=>{var u;return((u=l.class)==null?void 0:u.toLowerCase())===o}))&&n.push(s)}),n}extractNarrativeElements(e){return{mood:this.determineCombatMood(e),stakes:this.determineStakes(e),environmentalHazards:this.identifyHazards(e),npcInvolvement:this.extractNPCs(e)}}determineCombatMood(e){const n=e.toLowerCase();return n.includes("desperate")||n.includes("last stand")?"desperate":n.includes("training")||n.includes("practice")?"casual":n.includes("revenge")||n.includes("vengeance")?"vengeful":n.includes("defense")||n.includes("protect")?"defensive":"standard"}determineStakes(e){const n=e.toLowerCase();return n.includes("life")||n.includes("death")||n.includes("kill")?"life_or_death":n.includes("escape")||n.includes("flee")?"escape":n.includes("capture")||n.includes("arrest")?"capture":n.includes("treasure")||n.includes("loot")?"treasure":"standard"}identifyHazards(e){const n=[],r=e.toLowerCase();return(r.includes("fire")||r.includes("flame"))&&n.push("fire"),(r.includes("water")||r.includes("river")||r.includes("lake"))&&n.push("water"),(r.includes("height")||r.includes("cliff")||r.includes("fall"))&&n.push("height"),(r.includes("trap")||r.includes("pit"))&&n.push("traps"),n}extractNPCs(e){const n=[];return[/(\w+)\s+(?:the\s+)?(?:guard|merchant|wizard|knight|rogue|priest)/gi,/(?:named|called)\s+(\w+)/gi].forEach(s=>{[...e.matchAll(s)].forEach(o=>{n.push(o[1])})}),n}async executeAction(e,n,r,s,i={}){const o=e.combatants.find(p=>p.id===n),l=e.combatants.find(p=>p.id===s);if(!o||!l)throw new Error("Invalid combatant or target");if(o.cooldowns[r]>0)return{success:!1,message:`${o.name} cannot use ${r} yet (cooldown: ${o.cooldowns[r]} turns)`};const u=this.generateActionNarrative(o,r,l,i),d=this.calculateActionResults(o,r,l,i);this.applyActionEffects(e,o,l,d),this.updateCooldowns(e,o,r);const f=this.checkStatusEffectApplication(o,r,l,d);return{success:!0,narrative:u,results:d,statusEffects:f,environmentalImpact:this.calculateEnvironmentalImpact(e,r,d)}}generateActionNarrative(e,n,r,s){let o=this.actionTypes[n].narrativeTemplate;o=o.replace("{character}",e.name),o=o.replace("{action}",this.getActionVerb(n,e.class)),o=o.replace("{weapon}",s.weapon||"their weapon"),o=o.replace("{spell}",s.spell||"a spell"),o=o.replace("{ability}",s.ability||"special ability"),o=o.replace("{item}",s.item||"an item"),o=o.replace("{environment}",s.environment||"surroundings"),o=o.replace("{ally}",s.ally||"ally");const l=this.getClassFlavor(e.class,n);return l&&(o+=` ${l}`),o}getActionVerb(e,n){var s;return((s={fighter:{attack:"charges forward with a mighty swing",defend:"raises their shield defensively",special:"unleashes their combat expertise"},wizard:{attack:"casts a magical bolt",spell:"weaves arcane energy",special:"channels pure magical power"},rogue:{attack:"strikes from the shadows",defend:"dodges and weaves",special:"executes a perfect sneak attack"},cleric:{attack:"calls upon divine power",spell:"prays for divine intervention",special:"channels holy energy"}}[n==null?void 0:n.toLowerCase()])==null?void 0:s[e])||"performs an action"}getClassFlavor(e,n){var s;return((s={fighter:{attack:"The force of the blow echoes through the battlefield.",defend:"Their stance is unbreakable.",special:"Years of training show in their precision."},wizard:{attack:"Arcane energy crackles in the air.",spell:"The very fabric of reality seems to bend.",special:"Ancient knowledge flows through their mind."},rogue:{attack:"The strike is almost too fast to see.",defend:"They seem to flow around the attack.",special:"Perfect timing and deadly precision."},cleric:{attack:"Divine light illuminates the area.",spell:"The gods themselves seem to answer.",special:"Holy power radiates from their form."}}[e==null?void 0:e.toLowerCase()])==null?void 0:s[n])||""}calculateActionResults(e,n,r,s){const i={damage:0,healing:0,statusEffects:[],environmentalEffects:[],narrative:""};switch(n){case"attack":i.damage=this.calculateAttackDamage(e,r,s);break;case"spell":i.damage=this.calculateSpellDamage(e,r,s);break;case"special":i.damage=this.calculateSpecialDamage(e,r,s);break;case"item":i.healing=this.calculateItemEffect(e,r,s);break;case"defend":i.statusEffects.push({type:"defensive",duration:1});break;case"environmental":i.environmentalEffects=this.calculateEnvironmentalEffects(e,r,s);break;case"teamUp":i.damage=this.calculateTeamUpDamage(e,r,s);break}return i}calculateAttackDamage(e,n,r){const s=Math.floor(Math.random()*8)+1,i=Math.floor((e.strength-10)/2),o=r.weaponBonus||0;let l=1;if(e.id.startsWith("enemy_")){l=1+(e.level-1)*.3;const u=this.getEnemyPrimaryAttribute(e.class),d=Math.floor((e[u]-10)/2),f=this.calculateEnemyItemBonus(e);let p=(s+i+o+d+f)*l;return Math.floor(Math.random()*20)+1===20&&(p*=2),console.log(`Enemy damage calculation for ${e.name}:`,{baseDamage:s,strengthMod:i,weaponBonus:o,attributeMod:d,itemBonus:f,levelScaling:l,totalDamage:Math.max(1,Math.floor(p))}),Math.max(1,Math.floor(p))}else{const u=Math.floor((e.dexterity-10)/2),d=Math.floor((e.level-1)*.5);let f=s+i+u+o+d;return Math.floor(Math.random()*20)+1===20&&(f*=2),console.log(`Player damage calculation for ${e.name}:`,{baseDamage:s,strengthMod:i,dexterityMod:u,weaponBonus:o,levelBonus:d,totalDamage:Math.max(1,f)}),Math.max(1,f)}}getEnemyPrimaryAttribute(e){return{Warrior:"strength",Archer:"dexterity",Mage:"intelligence",Cleric:"wisdom",Rogue:"dexterity",Paladin:"strength",Ranger:"dexterity",Wizard:"intelligence",Fighter:"strength"}[e]||"strength"}calculateEnemyItemBonus(e){let n=0;return e.equipment&&(e.equipment.weapon&&(n+=e.equipment.weapon.damageBonus||0),e.equipment.armor&&(n+=e.equipment.armor.defenseBonus||0),e.equipment.accessory&&(n+=e.equipment.accessory.bonus||0)),e.level>3&&(n+=Math.floor((e.level-3)/2)),n}calculateSpellDamage(e,n,r){const s=Math.floor(Math.random()*6)+1,i=Math.floor((e.intelligence-10)/2),o=r.spellLevel||1;if(e.id.startsWith("enemy_")){const l=1+(e.level-1)*.4,u=Math.floor((e.wisdom-10)/2),d=this.calculateEnemyItemBonus(e);let f=(s+i+u+o+d)*l;return Math.floor(Math.random()*20)+1>=19&&(f*=1.5),Math.max(1,Math.floor(f))}else return Math.max(1,s+i+o)}calculateSpecialDamage(e,n,r){var l;if(!this.classAbilities[(l=e.class)==null?void 0:l.toLowerCase()])return 0;const i=Math.floor(Math.random()*10)+2,o=Math.floor((e.level||1)/2);return Math.max(1,i+o)}calculateItemEffect(e,n,r){switch(r.itemType||"potion"){case"healing":return Math.floor(Math.random()*8)+2;case"antidote":return 0;case"blessing":return 0;default:return Math.floor(Math.random()*4)+1}}calculateTeamUpDamage(e,n,r){const s=Math.floor(Math.random()*12)+3;return Math.max(1,s+2)}applyActionEffects(e,n,r,s){s.damage>0&&(r.hp=Math.max(0,r.hp-s.damage)),s.healing>0&&(r.hp=Math.min(r.maxHp,r.hp+s.healing)),r.statusEffects||(r.statusEffects=[]),s.statusEffects.forEach(i=>{r.statusEffects.some(o=>o.type===i.type)||r.statusEffects.push({type:i.type,duration:i.duration,appliedBy:n.id})})}updateCooldowns(e,n,r){const s=this.actionTypes[r];n.cooldowns||(n.cooldowns={}),n.cooldowns[r]=s.cooldown,Object.keys(n.cooldowns).forEach(i=>{i!==r&&n.cooldowns[i]>0&&n.cooldowns[i]--})}checkStatusEffectApplication(e,n,r,s){const i=[];if(r.statusEffects||(r.statusEffects=[]),s.damage>10){const o=["stunned","bleeding"],l=o[Math.floor(Math.random()*o.length)];r.statusEffects.some(u=>u.type===l)||i.push({type:l,duration:1,appliedBy:e.id})}return i}calculateEnvironmentalImpact(e,n,r){const s=[];return n==="spell"&&r.damage>8&&s.push("The magical energy disturbs the environment"),n==="environmental"&&s.push("The environment responds to the action"),s}processStatusEffects(e,n){const r=[];return n.statusEffects&&n.statusEffects.forEach((s,i)=>{switch(s.duration--,s.type){case"poisoned":n.hp=Math.max(0,n.hp-1),r.push(`${n.name} takes 1 poison damage`);break;case"burned":n.hp=Math.max(0,n.hp-2),r.push(`${n.name} takes 2 burn damage`);break;case"frozen":r.push(`${n.name} is frozen and cannot act`);break;case"paralyzed":Math.random()<.5&&r.push(`${n.name} is paralyzed and cannot act`);break;case"blessed":r.push(`${n.name} is blessed with divine favor`);break;case"hasted":r.push(`${n.name} moves with supernatural speed`);break}s.duration<=0&&(n.statusEffects.splice(i,1),r.push(`${n.name} is no longer ${s.type}`))}),r}checkCombatEnd(e){const n=e.combatants.filter(o=>!o.id.startsWith("enemy_")),r=e.combatants.filter(o=>o.id.startsWith("enemy_")),s=n.some(o=>o.hp>0),i=r.some(o=>o.hp>0);return s?i?{ended:!1}:{ended:!0,result:"victory",narrative:"The enemies have been defeated!"}:{ended:!0,result:"defeat",narrative:"The party has been defeated..."}}generateCombatSummary(e,n){return{result:n,duration:e.round,participants:e.combatants.map(s=>({name:s.name,finalHp:s.hp,actions:s.turnCount,statusEffects:s.statusEffects.length})),narrative:this.generateCombatNarrative(e,n)}}generateCombatNarrative(e,n){const r=e.combatants.filter(s=>!s.id.startsWith("enemy_"));return e.combatants.filter(s=>s.id.startsWith("enemy_")),n==="victory"?`The party emerges victorious from the battle. ${r.map(s=>s.name).join(", ")} stand triumphant over their fallen foes.`:n==="defeat"?"The battle ends in defeat. The party has been overwhelmed by their enemies.":"The battle ends in a draw, with both sides withdrawing to regroup."}chooseEnemyAction(e,n){const r=this.getEnemyAvailableActions(e,n),s=this.getEnemyValidTargets(e,n);return r.length===0||s.length===0?{action:"defend",target:null}:this.makeEnemyDecision(e,r,s,n)}getEnemyAvailableActions(e,n){const r=[],s=e.cooldowns||{};return Object.entries(this.actionTypes).forEach(([i,o])=>{(s[i]===0||s[i]===void 0)&&r.push(i)}),e.class&&this.classAbilities[e.class.toLowerCase()]&&(s.special===0||s.special===void 0)&&r.push("special"),r}getEnemyValidTargets(e,n){return n.combatants.filter(r=>!r.id.startsWith("enemy_")&&r.hp>0)}makeEnemyDecision(e,n,r,s){const i=r[Math.floor(Math.random()*r.length)];if(e.hp/e.maxHp<.3){if(n.includes("item"))return{action:"item",target:e.id,itemType:"healing"};if(n.includes("defend"))return{action:"defend",target:null}}return s.combatants.filter(d=>d.id.startsWith("enemy_")&&d.hp/d.maxHp<.5).length>1&&n.includes("spell")?{action:"spell",target:i.id,spellType:"area"}:n.includes("attack")?{action:"attack",target:i.id}:{action:n[Math.floor(Math.random()*n.length)],target:i.id}}async executeEnemyTurn(e,n){const r=this.chooseEnemyAction(n,e);return r.target?await this.executeAction(e,n.id,r.action,r.target,{itemType:r.itemType,spellType:r.spellType}):await this.executeAction(e,n.id,"defend",n.id)}}const sr=new bR;class bu{constructor(){this.diceTypes={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20,d100:100},this.difficultyClasses={veryEasy:5,easy:10,medium:15,hard:20,veryHard:25,nearlyImpossible:30},this.actionTypes={attack:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:10,description:"Physical attack roll"},spell:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:12,description:"Spell casting check"},dodge:{primaryAbility:"dexterity",secondaryAbility:"wisdom",baseDC:15,description:"Dodge incoming attacks"},parry:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:18,description:"Parry with weapon"},backflip:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:20,description:"Perform a backflip"},somersault:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:18,description:"Perform a somersault"},cartwheel:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:16,description:"Perform a cartwheel"},wallRun:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:22,description:"Run up a wall"},jump:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:12,description:"Jump over obstacles"},climb:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:15,description:"Climb surfaces"},swim:{primaryAbility:"strength",secondaryAbility:"constitution",baseDC:14,description:"Swim through water"},fly:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:30,description:"Fly through the air"},persuade:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:15,description:"Persuade someone"},intimidate:{primaryAbility:"charisma",secondaryAbility:"strength",baseDC:16,description:"Intimidate someone"},deceive:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:18,description:"Deceive someone"},spot:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:12,description:"Spot hidden objects or creatures"},listen:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:10,description:"Listen for sounds"},search:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:14,description:"Search for hidden items"},pickLock:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:20,description:"Pick a lock"},disarmTrap:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:22,description:"Disarm a trap"},heal:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:16,description:"Provide medical aid"},craft:{primaryAbility:"intelligence",secondaryAbility:"dexterity",baseDC:18,description:"Craft an item"}},this.impossibleActionPatterns=[/\b(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,/\b(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,/\b(?:jump|leap)\s+(?:to|over|across)\s+(?:the\s+)?(?:moon|sky|clouds?)\b/gi,/\b(?:teleport|blink|phase)\s+(?:to|through)\b/gi,/\b(?:time\s+travel|rewind|fast\s+forward)\b/gi,/\b(?:summon|create)\s+(?:a\s+)?(?:dragon|god|demon)\b/gi,/\b(?:become|turn\s+into)\s+(?:invisible|invincible|immortal)\b/gi,/\b(?:kill|destroy|eliminate)\s+(?:the\s+)?(?:dm|dungeon\s+master|narrator)\b/gi,/\b(?:break|destroy)\s+(?:the\s+)?(?:fourth\s+wall|game|story)\b/gi,/\b(?:skip|ignore)\s+(?:the\s+)?(?:quest|mission|story)\b/gi,/\b(?:teleport|go)\s+(?:to\s+)?(?:the\s+)?(?:end|final\s+boss|treasure)\b/gi,/\b(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,/\b(?:open|unlock)\s+(?:the\s+)?(?:door|chest)\s+(?:without\s+)?(?:key|lockpick)\b/gi,/\b(?:find|locate)\s+(?:the\s+)?(?:hidden\s+)?(?:passage|door)\s+(?:without\s+)?(?:searching)\b/gi],this.circumstanceModifiers={"in darkness":-2,"in bright light":1,"in difficult terrain":-2,"on slippery surface":-3,"in water":-2,"in tight space":-1,"with cover":2,"with high ground":1,"with low ground":-1,"with proper tools":2,"with improvised tools":-1,"without tools":-3,"with magical item":1,"with masterwork item":2,"while injured":-2,"while exhausted":-3,"while hasted":2,"while blessed":1,"while cursed":-2,"while poisoned":-1,"under time pressure":-2,"with preparation":1,"with careful planning":2,"in a hurry":-2,"with authority":1,"with evidence":2,"with witnesses":-1,"in private":1,"in public":-1}}rollDie(e){return Math.floor(Math.random()*e)+1}rollDice(e,n){const r=[];for(let s=0;s<e;s++)r.push(this.rollDie(n));return r}rollWithAdvantage(){const e=this.rollDie(20),n=this.rollDie(20);return{result:Math.max(e,n),rolls:[e,n],advantage:!0}}rollWithDisadvantage(){const e=this.rollDie(20),n=this.rollDie(20);return{result:Math.min(e,n),rolls:[e,n],disadvantage:!0}}getAbilityModifier(e){return Math.floor((e-10)/2)}getProficiencyBonus(e){return Math.floor((e-1)/4)+2}performSkillCheck(e,n,r=[],s=null){const i=this.actionTypes[n];if(!i)throw new Error(`Unknown action type: ${n}`);let o=s||i.baseDC,l=0;r.forEach(_=>{this.circumstanceModifiers[_]&&(l+=this.circumstanceModifiers[_])});const u=this.getAbilityModifier(e[i.primaryAbility]||10),d=this.getAbilityModifier(e[i.secondaryAbility]||10),f=this.getProficiencyBonus(e.level||1),y=this.checkProficiency(e,n)?f:0,T=this.rollDie(20),S=T+u+y+l,A=S>=o,k=S-o;let E="failure";return A?k>=10?E="critical success":k>=5?E="great success":E="success":k<=-10?E="critical failure":k<=-5?E="great failure":E="failure",{actionType:n,roll:T,totalRoll:S,dc:o,primaryMod:u,secondaryMod:d,proficiencyMod:y,circumstanceBonus:l,isSuccess:A,degree:E,margin:k,circumstances:r,character:{name:e.name,level:e.level,[i.primaryAbility]:e[i.primaryAbility],[i.secondaryAbility]:e[i.secondaryAbility]}}}checkProficiency(e,n){const r=e.proficiencies||[],i={Fighter:["attack","dodge","parry"],Rogue:["dodge","pickLock","disarmTrap","spot","listen"],Wizard:["spell","search","craft"],Cleric:["heal","persuade","spot"],Ranger:["spot","listen","climb","swim"],Paladin:["attack","parry","persuade"],Monk:["attack","dodge","backflip","somersault","cartwheel"],Bard:["persuade","deceive","intimidate"],Druid:["heal","spot","listen"],Sorcerer:["spell","persuade"],Warlock:["spell","intimidate"],Barbarian:["attack","intimidate","jump","climb"]}[e.class]||[];return r.includes(n)||i.includes(n)}validateAction(e,n,r={}){const s=e.toLowerCase();for(const d of this.impossibleActionPatterns)if(d.test(s))return{possible:!1,reason:"This action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};const i=this.extractActionsFromDescription(s);if(i.length===0)return{possible:!0,reason:"Action appears to be narrative in nature.",suggestion:"This will be handled through story progression."};const o=i.map(d=>{const f=this.performSkillCheck(n,d.type,d.circumstances);return{action:d.type,description:d.description,check:f,difficulty:this.getDifficultyDescription(f.dc)}}),l=o.every(d=>d.check.isSuccess),u=o.filter(d=>d.check.degree==="critical failure");return{possible:!0,actions:o,overallSuccess:l,hasCriticalFailures:u.length>0,criticalFailures:u,suggestion:this.generateActionSuggestion(o,n)}}extractActionsFromDescription(e){const n=[];return Object.entries(this.actionTypes).forEach(([r,s])=>{this.getActionKeywords(r).forEach(o=>{if(e.includes(o)){const l=this.extractCircumstances(e);n.push({type:r,description:s.description,circumstances:l,keyword:o})}})}),n}getActionKeywords(e){return{attack:["attack","strike","hit","swing","slash","thrust","punch","kick"],spell:["cast","spell","magic","enchant","charm"],dodge:["dodge","evade","avoid","sidestep"],parry:["parry","block","deflect"],backflip:["backflip","back flip"],somersault:["somersault","forward roll"],cartwheel:["cartwheel"],wallRun:["wall run","run up wall"],jump:["jump","leap","hop"],climb:["climb","scale"],swim:["swim"],fly:["fly","levitate","float"],persuade:["persuade","convince","talk into"],intimidate:["intimidate","threaten","scare"],deceive:["deceive","lie","trick"],spot:["spot","see","notice","observe"],listen:["listen","hear"],search:["search","look for","find"],pickLock:["pick lock","lockpick"],disarmTrap:["disarm","trap"],heal:["heal","cure","treat"],craft:["craft","make","create","build"]}[e]||[]}extractCircumstances(e){const n=[];return Object.keys(this.circumstanceModifiers).forEach(r=>{e.includes(r)&&n.push(r)}),n}getDifficultyDescription(e){return e<=5?"Very Easy":e<=10?"Easy":e<=15?"Medium":e<=20?"Hard":e<=25?"Very Hard":"Nearly Impossible"}generateActionSuggestion(e,n){const r=e.filter(i=>!i.check.isSuccess);return r.length===0?"All actions are within your capabilities. Proceed with confidence!":r.map(i=>{const o=i.action;return i.check.degree==="critical failure"?`The ${o} is extremely difficult for you. Consider an alternative approach or ask for help.`:`The ${o} is challenging. You might want to take your time or use better equipment.`}).join(" ")}performActionSequence(e,n,r={}){const s=[];let i=0;for(let u=0;u<n.length;u++){const d=n[u],f=[...d.circumstances];i>0?f.push("with momentum"):i<0&&f.push("while fatigued");const p=this.performSkillCheck(e,d.type,f);s.push({action:d.type,check:p,sequencePosition:u+1}),p.isSuccess?i+=1:i-=2}const o=s.every(u=>u.check.isSuccess),l=s.filter(u=>u.check.degree==="critical failure");return{actions:s,overallSuccess:o,hasCriticalFailures:l.length>0,criticalFailures:l,sequenceLength:n.length,finalModifier:i}}generateActionNarrative(e,n){const{actionType:r,check:s,degree:i}=e;this.actionTypes[r];const o={attack:{"critical success":`${n.name} executes a perfect ${r}, striking with incredible precision!`,"great success":`${n.name} performs an excellent ${r}, hitting the target solidly.`,success:`${n.name} successfully ${r}s the target.`,failure:`${n.name} attempts to ${r} but misses the mark.`,"great failure":`${n.name} completely fails to ${r}, leaving themselves open.`,"critical failure":`${n.name} botches the ${r} spectacularly, potentially harming themselves!`},backflip:{"critical success":`${n.name} performs a flawless backflip, landing gracefully with perfect form!`,"great success":`${n.name} executes a smooth backflip, impressing onlookers.`,success:`${n.name} manages to complete the backflip successfully.`,failure:`${n.name} attempts a backflip but loses balance and stumbles.`,"great failure":`${n.name} fails the backflip badly, landing awkwardly.`,"critical failure":`${n.name} completely fails the backflip, potentially injuring themselves!`},fly:{"critical success":`${n.name} somehow defies gravity and soars through the air with supernatural grace!`,"great success":`${n.name} manages to achieve brief flight through incredible effort!`,success:`${n.name} makes a valiant attempt at flight, achieving a brief hover.`,failure:`${n.name} tries to fly but only manages an awkward hop.`,"great failure":`${n.name} attempts flight but falls flat on their face.`,"critical failure":`${n.name} tries to fly and crashes spectacularly, looking quite foolish!`}},l=o[r]||o.attack;return l[i]||l.failure}}class Wm{constructor(){this.diceService=new bu,this.storyRules={redirectPatterns:[{pattern:/\b(?:i\s+)?(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,response:"While impressive acrobatics are possible, let's focus on actions that advance the story. What's your main goal here?",suggestion:"Try describing a more focused action that helps with the current situation."},{pattern:/\b(?:i\s+)?(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,response:"Flight isn't currently possible in this situation. What are you trying to achieve?",suggestion:"Consider climbing, jumping, or finding another way to reach your destination."},{pattern:/\b(?:i\s+)?(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,response:"The quest item isn't just lying around. You'll need to find it through exploration and investigation.",suggestion:"Try searching the area, asking NPCs, or following clues to locate the item."},{pattern:/\b(?:i\s+)?(?:attack|kill|destroy)\s+(?:everyone|all|each)\s+(?:enemy|person|creature)\b/gi,response:"While combat is possible, attacking everyone at once isn't practical. Let's focus on the immediate threat.",suggestion:"Choose a specific target or describe a more strategic approach."}],expandPatterns:[{pattern:/\b(?:i\s+)?(?:search|look|examine)\b/gi,response:"What specifically are you searching for or looking at?",suggestion:"Be more specific about what you're searching for or examining."},{pattern:/\b(?:i\s+)?(?:talk|speak|ask)\b/gi,response:"Who would you like to talk to, and what would you like to discuss?",suggestion:"Specify the person and topic of conversation."},{pattern:/\b(?:i\s+)?(?:go|move|walk)\b/gi,response:"Where would you like to go?",suggestion:"Specify your destination or direction."}],encouragePatterns:[{pattern:/\b(?:i\s+)?(?:investigate|explore|examine)\b/gi,response:"Great! Investigation and exploration are key to advancing the story.",suggestion:"What specific aspect would you like to investigate?"},{pattern:/\b(?:i\s+)?(?:help|assist|aid)\b/gi,response:"Helping others is always a noble choice. Who would you like to help?",suggestion:"Specify who needs help and how you can assist them."},{pattern:/\b(?:i\s+)?(?:negotiate|diplomacy|peace)\b/gi,response:"Diplomacy can often achieve more than violence. Good thinking!",suggestion:"How would you like to approach the negotiation?"}]},this.contextResponses={combat:{impossible:"That action isn't possible in combat. Focus on your available combat options.",difficult:"That's a challenging action in combat. Are you sure you want to attempt it?",strategic:"That's a good strategic choice. How do you want to execute it?"},exploration:{impossible:"That action doesn't make sense in this environment. What are you trying to achieve?",difficult:"That will be challenging given the current circumstances.",strategic:"That's a good approach to exploration. Let's see how it goes."},social:{impossible:"That action isn't appropriate in this social situation.",difficult:"That's a bold social move. Are you prepared for the consequences?",strategic:"That's a good approach to the situation. How do you want to proceed?"}}}validatePlayerAction(e,n,r={}){const s=e.toLowerCase(),i=this.checkImpossibleActions(s);if(!i.possible)return{valid:!1,type:"impossible",response:i.response,suggestion:i.suggestion,diceResult:null};const o=this.checkRedirectPatterns(s);if(o.needsRedirect)return{valid:!1,type:"redirect",response:o.response,suggestion:o.suggestion,diceResult:null};const l=this.checkExpandPatterns(s);if(l.needsExpansion)return{valid:!1,type:"expand",response:l.response,suggestion:l.suggestion,diceResult:null};const u=this.diceService.validateAction(e,n,r);return{valid:!0,type:"valid",response:this.generateValidationResponse(u,n,r),suggestion:u.suggestion,diceResult:u}}checkImpossibleActions(e){for(const n of this.diceService.impossibleActionPatterns)if(n.test(e))return{possible:!1,response:"That action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};return{possible:!0}}checkRedirectPatterns(e){for(const n of this.storyRules.redirectPatterns)if(n.pattern.test(e))return{needsRedirect:!0,response:n.response,suggestion:n.suggestion};return{needsRedirect:!1}}checkExpandPatterns(e){for(const n of this.storyRules.expandPatterns)if(n.pattern.test(e))return{needsExpansion:!0,response:n.response,suggestion:n.suggestion};return{needsExpansion:!1}}generateValidationResponse(e,n,r){return e.overallSuccess?"Your planned actions are within your capabilities. Proceed with confidence!":e.actions.filter(o=>!o.check.isSuccess).filter(o=>o.check.degree==="critical failure").length>0?`The actions you described are beyond your current capabilities. ${e.suggestion}`:`Some of those actions are challenging for you. ${e.suggestion}`}generateStoryResponse(e,n,r={}){const s=this.validatePlayerAction(e,n,r);if(!s.valid)return{response:s.response,suggestion:s.suggestion,shouldProceed:!1,diceResult:null};const i=[];return s.diceResult.actions&&s.diceResult.actions.forEach(o=>{const l=this.diceService.generateActionNarrative(o.check,n);i.push(l)}),{response:i.join(" "),suggestion:s.suggestion,shouldProceed:!0,diceResult:s.diceResult}}handleComplexAction(e,n,r={}){const s=this.diceService.extractActionsFromDescription(e.toLowerCase());if(s.length===0)return{response:"I understand your intent. Let's see how this plays out in the story.",shouldProceed:!0,type:"narrative"};if(s.length===1)return this.generateStoryResponse(e,n,r);const i=this.diceService.performActionSequence(n,s,r);return i.overallSuccess?{response:i.actions.map(l=>this.diceService.generateActionNarrative(l.check,n)).join(" "),shouldProceed:!0,type:"sequence",diceResult:i}:i.actions.filter(u=>!u.check.isSuccess).filter(u=>u.check.degree==="critical failure").length>0?{response:"The sequence of actions you described is too complex for your current abilities. Try breaking it down into simpler steps.",shouldProceed:!1,type:"sequence_failure",diceResult:i}:{response:"Some parts of your action sequence are challenging. You might want to simplify your approach.",shouldProceed:!1,type:"sequence_partial",diceResult:i}}provideAlternatives(e,n,r={}){const s=e.toLowerCase(),i=[];return(s.includes("backflip")||s.includes("somersault"))&&i.push({action:"dodge",description:"Try dodging or evading instead of acrobatics",difficulty:"easier"}),(s.includes("fly")||s.includes("levitate"))&&i.push({action:"climb",description:"Try climbing or finding another way up",difficulty:"realistic"}),s.includes("attack everyone")&&i.push({action:"focus",description:"Focus on one target at a time for better effectiveness",difficulty:"strategic"}),s.includes("grab quest item")&&i.push({action:"search",description:"Search the area thoroughly to find the item",difficulty:"appropriate"}),i}maintainStoryCoherence(e,n,r){const s={storyPhase:this.checkStoryPhase(e,n),establishedFacts:this.checkEstablishedFacts(e,n),plotAdvancement:this.checkPlotAdvancement(e,n),characterDevelopment:this.checkCharacterDevelopment(e,r)},i=Object.entries(s).filter(([o,l])=>!l.valid).map(([o,l])=>l.issue);return{coherent:i.length===0,issues:i,suggestions:this.generateCoherenceSuggestions(i,n)}}checkStoryPhase(e,n){const r=n.phase||"exploration",s=e.toLowerCase(),l=({introduction:["attack","kill","destroy"],exploration:["end quest","skip to boss"],combat:["negotiate peace","run away"],resolution:["start new quest","begin adventure"]}[r]||[]).some(u=>s.includes(u));return{valid:!l,issue:l?`This action doesn't fit the current story phase (${r})`:null}}checkEstablishedFacts(e,n){const r=n.establishedFacts||[],s=e.toLowerCase();for(const i of r)if(i.contradicts&&i.contradicts.some(o=>s.includes(o.toLowerCase())))return{valid:!1,issue:`This action contradicts established story facts: ${i.description}`};return{valid:!0}}checkPlotAdvancement(e,n){const r=n.plotPoints||[],s=e.toLowerCase(),i=r.find(o=>o.active);return i&&i.keywords&&!i.keywords.some(l=>s.includes(l.toLowerCase()))?{valid:!1,issue:"This action doesn't address the current plot point"}:{valid:!0}}checkCharacterDevelopment(e,n){const r=n.alignment||"Neutral",s=e.toLowerCase(),l=({"Lawful Good":["steal","deceive","harm innocent"],"Chaotic Evil":["help others","follow rules","show mercy"],"Neutral Good":["harm innocent","betray allies"],"Lawful Evil":["break laws","show mercy","help weak"],"Chaotic Good":["follow strict rules","harm innocent"],"True Neutral":["take extreme actions","show strong emotions"],"Lawful Neutral":["break laws","show mercy","act chaotically"],"Neutral Evil":["help others","follow laws","show mercy"],"Chaotic Neutral":["follow strict rules","show strong loyalty"]}[r]||[]).some(u=>s.includes(u));return{valid:!l,issue:l?`This action doesn't align with your character's alignment (${r})`:null}}generateCoherenceSuggestions(e,n){const r=[];return e.forEach(s=>{s.includes("story phase")?r.push("Consider actions that fit the current phase of the story."):s.includes("established facts")?r.push("Remember what has already been established in the story."):s.includes("plot point")?r.push("Focus on actions that advance the current plot."):s.includes("alignment")&&r.push("Consider actions that align with your character's moral compass.")}),r}}function Zx({diceResult:t,onClose:e}){if(!t)return null;const n=s=>{switch(s){case"critical success":return"text-green-600 bg-green-100";case"great success":return"text-green-700 bg-green-50";case"success":return"text-blue-600 bg-blue-100";case"failure":return"text-yellow-600 bg-yellow-100";case"great failure":return"text-orange-600 bg-orange-100";case"critical failure":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},r=s=>{switch(s){case"critical success":return"";case"great success":return"";case"success":return"";case"failure":return"";case"great failure":return"";case"critical failure":return"";default:return""}};return c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Dice Roll Results"}),c.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:""})]}),t.actions?c.jsxs("div",{className:"space-y-4",children:[t.actions.map((s,i)=>c.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:s.action}),c.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${n(s.check.degree)}`,children:[r(s.check.degree)," ",s.check.degree]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-stone-600",children:"Roll:"}),c.jsx("span",{className:"font-mono ml-1",children:s.check.roll})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-stone-600",children:"Total:"}),c.jsx("span",{className:"font-mono ml-1",children:s.check.totalRoll})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-stone-600",children:"DC:"}),c.jsx("span",{className:"font-mono ml-1",children:s.check.dc})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-stone-600",children:"Margin:"}),c.jsxs("span",{className:`font-mono ml-1 ${s.check.margin>=0?"text-green-600":"text-red-600"}`,children:[s.check.margin>=0?"+":"",s.check.margin]})]})]}),s.check.circumstanceBonus!==0&&c.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:["Circumstance bonus: ",s.check.circumstanceBonus>=0?"+":"",s.check.circumstanceBonus]})]},i)),c.jsxs("div",{className:"mt-4 p-3 bg-stone-50 rounded-lg",children:[c.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"Overall Result"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${t.overallSuccess?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:t.overallSuccess?" Success":" Partial Failure"}),t.hasCriticalFailures&&c.jsx("span",{className:"text-red-600 text-sm",children:" Critical failures occurred"})]})]})]}):c.jsx("div",{className:"space-y-4",children:c.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:t.actionType}),c.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${n(t.degree)}`,children:[r(t.degree)," ",t.degree]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-stone-600",children:"Roll:"}),c.jsx("span",{className:"font-mono ml-1",children:t.roll})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-stone-600",children:"Total:"}),c.jsx("span",{className:"font-mono ml-1",children:t.totalRoll})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-stone-600",children:"DC:"}),c.jsx("span",{className:"font-mono ml-1",children:t.dc})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-stone-600",children:"Margin:"}),c.jsxs("span",{className:`font-mono ml-1 ${t.margin>=0?"text-green-600":"text-red-600"}`,children:[t.margin>=0?"+":"",t.margin]})]})]}),c.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:[c.jsxs("div",{children:["Primary Mod: ",t.primaryMod>=0?"+":"",t.primaryMod]}),c.jsxs("div",{children:["Proficiency: ",t.proficiencyMod>=0?"+":"",t.proficiencyMod]}),t.circumstanceBonus!==0&&c.jsxs("div",{children:["Circumstance: ",t.circumstanceBonus>=0?"+":"",t.circumstanceBonus]})]})]})}),c.jsx("div",{className:"mt-4 flex justify-end",children:c.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Close"})})]})})}function eE({validation:t,onClose:e,onProceed:n,onRevise:r}){if(!t)return null;const s=o=>{switch(o){case"valid":return"";case"redirect":return"";case"expand":return"";case"impossible":return"";default:return""}},i=o=>{switch(o){case"valid":return"text-green-600 bg-green-100";case"redirect":return"text-yellow-600 bg-yellow-100";case"expand":return"text-blue-600 bg-blue-100";case"impossible":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}};return c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full mx-4 max-h-[80vh] overflow-y-auto",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Action Validation"}),c.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:""})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:`p-3 rounded-lg ${i(t.type)}`,children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-xl",children:s(t.type)}),c.jsx("span",{className:"font-semibold capitalize",children:t.type==="valid"?"Action Validated":t.type==="redirect"?"Action Needs Redirection":t.type==="expand"?"Action Needs Clarification":"Action Not Possible"})]})}),c.jsxs("div",{className:"p-4 bg-stone-50 rounded-lg",children:[c.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"Response"}),c.jsx("p",{className:"text-stone-600",children:t.response})]}),t.suggestion&&c.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[c.jsx("h4",{className:"font-semibold text-blue-700 mb-2",children:"Suggestion"}),c.jsx("p",{className:"text-blue-600",children:t.suggestion})]}),t.diceResult&&c.jsxs("div",{className:"p-4 bg-amber-50 rounded-lg",children:[c.jsx("h4",{className:"font-semibold text-amber-700 mb-2",children:"Dice Analysis"}),t.diceResult.actions?c.jsx("div",{className:"space-y-2",children:t.diceResult.actions.map((o,l)=>c.jsxs("div",{className:"flex justify-between items-center text-sm",children:[c.jsx("span",{className:"capitalize",children:o.action}),c.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${o.check.isSuccess?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:o.check.isSuccess?"Success":"Failure"})]},l))}):c.jsxs("div",{className:"text-sm",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{children:"Roll:"}),c.jsx("span",{className:"font-mono",children:t.diceResult.roll})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{children:"Total:"}),c.jsx("span",{className:"font-mono",children:t.diceResult.totalRoll})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{children:"DC:"}),c.jsx("span",{className:"font-mono",children:t.diceResult.dc})]})]})]}),t.type!=="valid"&&c.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[c.jsx("h4",{className:"font-semibold text-purple-700 mb-2",children:"Alternative Approaches"}),c.jsxs("ul",{className:"text-purple-600 text-sm space-y-1",children:[c.jsx("li",{children:" Try a more focused, single action"}),c.jsx("li",{children:" Consider your character's abilities and limitations"}),c.jsx("li",{children:" Think about what would be realistic in this situation"}),c.jsx("li",{children:" Ask for clarification about what you're trying to achieve"})]})]})]}),c.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[t.type==="valid"?c.jsx("button",{onClick:n,className:"fantasy-button bg-green-600 hover:bg-green-700",children:"Proceed with Action"}):c.jsx("button",{onClick:r,className:"fantasy-button bg-blue-600 hover:bg-blue-700",children:"Revise Action"}),c.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Cancel"})]})]})})}function TR(){const[t,e]=j.useState(null),[n,r]=j.useState(null),[s,i]=j.useState([]),[o,l]=j.useState({}),[u,d]=j.useState([]),[f,p]=j.useState(!0),[y,T]=j.useState(!1),S=Jn(),[A]=j.useState(()=>new bu),[k]=j.useState(()=>new Wm),[E,_]=j.useState(!1),[I,O]=j.useState(!1),[D,L]=j.useState(null),[w,g]=j.useState(null),[x,b]=j.useState(""),[P,N]=j.useState(!1);j.useEffect(()=>{const G=gs(ae=>{if(!ae){S("/login");return}e(ae),C(ae.uid)});return()=>G()},[S]);const C=async G=>{try{const[ae,le,je]=await Promise.all([zm(G),to(G),qh(G)]);i(ae),r(le),d(je),await fe(ae)}catch(ae){console.error("Error loading user data:",ae)}finally{p(!1)}},fe=async G=>{try{const ae=new Set;if(G.forEach(Me=>{Me.members&&Array.isArray(Me.members)&&Me.members.forEach(wt=>ae.add(wt))}),ae.size===0)return;const le=await Gx(Array.from(ae)),je={};le.forEach(Me=>{je[Me.userId]=Me});const vt={};G.forEach(Me=>{Me.members&&Array.isArray(Me.members)&&(vt[Me.id]=Me.members.map(wt=>({userId:wt,profile:je[wt]||null})))}),l(vt)}catch(ae){console.error("Error loading party member profiles:",ae)}},He=async G=>{if(confirm("Are you sure you want to delete this character preset? This action cannot be undone."))try{await Jx(t.uid,G);const ae=await qh(t.uid);d(ae),alert("Character preset deleted successfully!")}catch(ae){console.error("Error deleting preset:",ae),alert("Failed to delete preset. Please try again.")}},nt=async()=>{try{const G=await Yx("test-combat-party");G&&await uR(G.id,{status:"ended",combatState:"ended"})}catch{console.log("No existing test combat session to clean up")}},Ue=async()=>{if(t){T(!0);try{await nt();const G=[{id:"test-warrior-"+Date.now(),name:"Test Warrior",class:"Fighter",race:"Human",level:3,hp:28,maxHp:28,armorClass:16,strength:16,dexterity:14,constitution:15,intelligence:10,wisdom:12,charisma:8,userId:t.uid,statusEffects:[],cooldowns:{},turnCount:0,lastAction:null},{id:"test-wizard-"+Date.now(),name:"Test Wizard",class:"Wizard",race:"Elf",level:3,hp:18,maxHp:18,armorClass:12,strength:8,dexterity:14,constitution:12,intelligence:16,wisdom:14,charisma:10,userId:t.uid,statusEffects:[],cooldowns:{},turnCount:0,lastAction:null}],le=await cR("test-combat-party",{partyMembers:G,enemies:[{id:"enemy_goblin1",name:"Goblin Warrior",class:"Warrior",level:3,hp:18,maxHp:18,armorClass:15,strength:14,dexterity:12,constitution:13,intelligence:8,wisdom:10,charisma:6,statusEffects:[],cooldowns:{},turnCount:0,lastAction:null,equipment:{weapon:{name:"Rusty Sword",damageBonus:2},armor:{name:"Leather Armor",defenseBonus:1},accessory:{name:"Lucky Charm",bonus:1}}},{id:"enemy_goblin2",name:"Goblin Archer",class:"Archer",level:2,hp:12,maxHp:12,armorClass:13,strength:10,dexterity:16,constitution:9,intelligence:8,wisdom:12,charisma:6,statusEffects:[],cooldowns:{},turnCount:0,lastAction:null,equipment:{weapon:{name:"Short Bow",damageBonus:1},armor:{name:"Hide Armor",defenseBonus:0},accessory:{name:"Sharp Arrow",bonus:1}}}],storyContext:"A group of goblins has ambushed you in a dark forest clearing. The air is thick with the smell of damp earth and the rustling of leaves overhead. You must defend yourselves!",combatState:"preparation",environmentalFeatures:["dense foliage","fallen logs","muddy ground"],teamUpOpportunities:[{classes:["Fighter","Wizard"],description:"The Fighter can protect the Wizard while they cast spells"}]});console.log("Test combat session created:",le),S("/combat/test-combat-party")}catch(G){console.error("Error creating test combat:",G),alert("Failed to start test combat. Please try again.")}finally{T(!1)}}},q=async G=>{if(!G.trim())return;const ae={name:"Test Character",class:"Fighter",level:3,strength:16,dexterity:14,constitution:15,intelligence:10,wisdom:12,charisma:8,proficiencies:["attack","dodge","climb"]},le=k.validatePlayerAction(G,ae,{context:"testing"});g(le),O(!0)},ne=async()=>{const G={name:"Test Character",class:"Fighter",level:3,strength:16,dexterity:14,constitution:15,intelligence:10,wisdom:12,charisma:8,proficiencies:["attack","dodge","climb"]},ae=A.validateAction("test action",G,{context:"testing"});L(ae),_(!0),O(!1)},re=()=>{O(!1),N(!0)},Ee=()=>{_(!1),L(null)},pe=()=>{O(!1),g(null)},Se=()=>{x.trim()&&(q(x),b(""),N(!1))},ht=(G,ae=[])=>{const le={name:"Test Character",class:"Fighter",level:3,strength:16,dexterity:14,constitution:15,intelligence:10,wisdom:12,charisma:8,proficiencies:["attack","dodge","climb"]};return A.performSkillCheck(le,G,ae)},Pe=()=>A.rollWithAdvantage(),ft=()=>A.rollWithDisadvantage(),Ze=G=>A.rollDie(G),On=(G,ae)=>A.rollDice(G,ae);if(!t)return null;if(f)return c.jsx("div",{className:"fantasy-container py-8",children:c.jsx("div",{className:"fantasy-card",children:c.jsx("div",{className:"text-center py-8",children:c.jsx("div",{className:"text-stone-600",children:"Loading your parties..."})})})});const Bt=(n==null?void 0:n.username)||t.email;return c.jsxs("div",{className:"fantasy-container py-8",children:[c.jsxs("div",{className:"fantasy-card",children:[c.jsx("div",{className:"flex justify-between items-center mb-6",children:c.jsxs("h1",{className:"fantasy-title mb-0",children:["Welcome, ",Bt]})}),c.jsxs("div",{className:"mb-8 p-6 bg-red-50 border border-red-200 rounded-lg",children:[c.jsx("h2",{className:"text-xl font-bold text-stone-800 mb-4",children:" Combat Testing"}),c.jsx("p",{className:"text-stone-600 mb-4",children:"Test the new combat system with pre-made characters and goblin enemies."}),c.jsx("button",{onClick:Ue,disabled:y,className:"fantasy-button bg-red-600 hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:y?"Starting Combat...":"Start Test Combat"})]}),c.jsxs("div",{className:"mb-8 p-6 bg-indigo-50 border border-indigo-200 rounded-lg",children:[c.jsx("h2",{className:"text-xl font-bold text-stone-800 mb-4",children:" Dice Rolling & Action Validation Testing"}),c.jsx("p",{className:"text-stone-600 mb-4",children:"Test the new dice rolling system and action validation features."}),c.jsxs("div",{className:"mb-4",children:[c.jsx("h3",{className:"font-semibold text-stone-700 mb-2",children:"Dice Tools:"}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[c.jsx("button",{onClick:()=>{const G=Pe();L(G),_(!0)},className:"p-2 bg-green-100 hover:bg-green-200 border border-green-300 rounded text-sm font-medium",children:"Roll with Advantage"}),c.jsx("button",{onClick:()=>{const G=ft();L(G),_(!0)},className:"p-2 bg-red-100 hover:bg-red-200 border border-red-300 rounded text-sm font-medium",children:"Roll with Disadvantage"}),c.jsx("button",{onClick:()=>{const G=Ze(20);L({roll:G,totalRoll:G,actionType:"d20"}),_(!0)},className:"p-2 bg-blue-100 hover:bg-blue-200 border border-blue-300 rounded text-sm font-medium",children:"Roll d20"}),c.jsx("button",{onClick:()=>{const G=On(2,6),ae=G.reduce((le,je)=>le+je,0);L({rolls:G,totalRoll:ae,actionType:"2d6"}),_(!0)},className:"p-2 bg-purple-100 hover:bg-purple-200 border border-purple-300 rounded text-sm font-medium",children:"Roll 2d6"})]})]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("h3",{className:"font-semibold text-stone-700 mb-2",children:"Quick Skill Checks:"}),c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:["attack","dodge","climb","jump","persuade","intimidate"].map(G=>c.jsx("button",{onClick:()=>{const ae=ht(G);ae&&(L(ae),_(!0))},className:"p-2 bg-amber-100 hover:bg-amber-200 border border-amber-300 rounded text-xs font-medium capitalize",children:G},G))})]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("h3",{className:"font-semibold text-stone-700 mb-2",children:"Action Validation Testing:"}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("button",{onClick:()=>q("I do 6 backflips, and spin attack each enemy, then fly to the top and grab the quest item"),className:"p-2 bg-red-100 hover:bg-red-200 border border-red-300 rounded text-sm font-medium w-full text-left",children:"Test Impossible Action"}),c.jsx("button",{onClick:()=>q("I attempt to climb the wall and jump over the obstacle"),className:"p-2 bg-yellow-100 hover:bg-yellow-200 border border-yellow-300 rounded text-sm font-medium w-full text-left",children:"Test Difficult Action"}),c.jsx("button",{onClick:()=>q("I attack the nearest enemy with my sword"),className:"p-2 bg-green-100 hover:bg-green-200 border border-green-300 rounded text-sm font-medium w-full text-left",children:"Test Valid Action"})]})]}),P&&c.jsxs("div",{className:"mt-4 p-4 bg-white border border-indigo-300 rounded-lg",children:[c.jsx("h4",{className:"font-semibold text-indigo-700 mb-2",children:"Custom Action:"}),c.jsx("textarea",{value:x,onChange:G=>b(G.target.value),placeholder:"Describe the action you want to test...",className:"w-full p-3 border border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent mb-3",rows:"3"}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx("button",{onClick:Se,className:"fantasy-button bg-indigo-600 hover:bg-indigo-700",children:"Test Action"}),c.jsx("button",{onClick:()=>N(!1),className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Cancel"})]})]}),c.jsx("button",{onClick:()=>N(!0),className:"fantasy-button bg-indigo-600 hover:bg-indigo-700",children:" Test Custom Action"})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-6",children:"Your Parties"}),s.length===0?c.jsxs("div",{className:"text-center py-8 text-stone-600",children:[c.jsx("p",{children:"You haven't joined any parties yet."}),c.jsx("p",{className:"text-sm mt-2",children:"Go to the Parties tab to create or join a party!"}),c.jsx("button",{onClick:()=>S("/party-management"),className:"fantasy-button mt-4",children:"Go to Parties"})]}):c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s.map(G=>{var le;const ae=o[G.id]||[];return c.jsxs("div",{className:"fantasy-card bg-amber-50",children:[c.jsx("div",{className:"flex justify-between items-start mb-4",children:c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"text-xl font-bold text-stone-800",children:G.name}),c.jsx("p",{className:"text-stone-600 mt-1",children:G.description}),c.jsxs("p",{className:"text-sm text-stone-500 mt-2",children:[((le=G.members)==null?void 0:le.length)||1,"/",G.maxPlayers," members"]})]})}),c.jsxs("div",{className:"mb-4",children:[c.jsx("h4",{className:"text-sm font-semibold text-stone-700 mb-2",children:"Party Members:"}),c.jsx("div",{className:"space-y-1",children:ae.map((je,vt)=>{var Qt;const Me=((Qt=je.profile)==null?void 0:Qt.username)||`User ${vt+1}`,wt=je.userId===G.dmId;return c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-stone-600",children:Me}),wt&&c.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),je.userId===(t==null?void 0:t.uid)&&c.jsx("span",{className:"text-blue-600 text-xs font-medium",children:"(You)"})]},je.userId)})})]}),c.jsx("div",{className:"flex space-x-2",children:c.jsx("button",{onClick:()=>S(`/campaign-story/${G.id}`),className:"fantasy-button flex-1",children:"View Campaign"})})]},G.id)})})]}),c.jsxs("div",{className:"mt-12",children:[c.jsxs("h2",{className:"text-2xl font-bold text-stone-800 mb-6",children:["Your Characters (",u.length,")"]}),u.length===0?c.jsxs("div",{className:"text-center py-8 text-stone-600",children:[c.jsx("p",{children:"You haven't created any character presets yet."}),c.jsx("p",{className:"text-sm mt-2",children:"Create a character in any party to save it as a preset!"}),c.jsx("button",{onClick:()=>S("/party-management"),className:"fantasy-button mt-4",children:"Go to Parties"})]}):c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(G=>c.jsxs("div",{className:"fantasy-card bg-emerald-50 border border-emerald-200",children:[c.jsxs("div",{className:"flex justify-between items-start mb-4",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"text-xl font-bold text-stone-800",children:G.name}),c.jsxs("p",{className:"text-stone-600 mt-1",children:[G.data.race," ",G.data.class]}),c.jsxs("p",{className:"text-sm text-stone-500 mt-1",children:["Level ",G.data.level,"  ",G.data.background||"No background"]}),G.data.alignment&&c.jsx("p",{className:"text-sm text-stone-500",children:G.data.alignment}),G.createdAt&&c.jsxs("p",{className:"text-xs text-stone-400 mt-2",children:["Created: ",new Date(G.createdAt.toDate()).toLocaleDateString()]})]}),c.jsx("button",{onClick:()=>He(G.id),className:"text-red-600 hover:text-red-800 text-sm ml-2",title:"Delete preset",children:""})]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("h4",{className:"text-sm font-semibold text-stone-700 mb-2",children:"Ability Scores:"}),c.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"font-semibold",children:"STR"}),c.jsx("div",{className:"text-stone-600",children:G.data.strength})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"font-semibold",children:"DEX"}),c.jsx("div",{className:"text-stone-600",children:G.data.dexterity})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"font-semibold",children:"CON"}),c.jsx("div",{className:"text-stone-600",children:G.data.constitution})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"font-semibold",children:"INT"}),c.jsx("div",{className:"text-stone-600",children:G.data.intelligence})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"font-semibold",children:"WIS"}),c.jsx("div",{className:"text-stone-600",children:G.data.wisdom})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"font-semibold",children:"CHA"}),c.jsx("div",{className:"text-stone-600",children:G.data.charisma})]})]})]}),G.data.personality&&c.jsxs("div",{className:"mb-4",children:[c.jsx("h4",{className:"text-sm font-semibold text-stone-700 mb-1",children:"Personality:"}),c.jsx("p",{className:"text-sm text-stone-600 line-clamp-2",children:G.data.personality})]}),c.jsx("div",{className:"flex space-x-2",children:c.jsx("button",{onClick:()=>{alert(`To use "${G.name}" in a party:

1. Go to the Parties tab
2. Join or create a party
3. When creating your character, click " Load Preset"
4. Select "${G.name}" from the list
5. Modify the character name and submit!`),S("/party-management")},className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 flex-1",children:"Use in Party"})})]},G.id))})]})]}),E&&c.jsx(Zx,{diceResult:D,onClose:Ee}),I&&c.jsx(eE,{validation:w,onClose:pe,onProceed:ne,onRevise:re})]})}function CR(){var Zn,F,Q;const t=Jn(),{partyId:e}=tu(),[n,r]=j.useState(null),[s,i]=j.useState(!1),[o,l]=j.useState(null),[u,d]=j.useState([]),[f,p]=j.useState(!1),[y,T]=j.useState(""),[S,A]=j.useState(!1),[k,E]=j.useState({name:"",race:"",class:"",level:1,background:"",alignment:"",strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10,age:"",height:"",weight:"",eyes:"",skin:"",hair:"",personality:"",ideals:"",bonds:"",flaws:"",backstory:"",equipment:[],spells:[],proficiencies:[],portrait:"/placeholder-character.png"}),[_,I]=j.useState("standard"),[O,D]=j.useState([]),[L,w]=j.useState([]),[g,x]=j.useState({}),[b,P]=j.useState(!1),[N,C]=j.useState({}),[fe,He]=j.useState([]);j.useEffect(()=>{const R=gs($=>{if(!$){t("/login");return}r($),e&&nt($.uid,e),Ue($.uid)});return()=>R()},[t,e]),j.useEffect(()=>{o&&(E({...o}),o.weaponChoices&&C(o.weaponChoices),o.spellChoices&&He(o.spellChoices),o.abilityScoreMethod&&I(o.abilityScoreMethod),o.rolledScores&&D(o.rolledScores),o.assignedScores&&x(o.assignedScores),o.rolledScores&&P(o.rolledScores.length>0))},[o]);const nt=async(R,$)=>{try{const K=await Kx(R,$);l(K)}catch{}},Ue=async R=>{try{const $=await qh(R);d($)}catch($){console.error("Error loading character presets:",$)}},q=["Human","Elf","Dwarf","Halfling","Dragonborn","Tiefling","Half-Elf","Half-Orc","Gnome","Aarakocra","Genasi","Goliath"],ne=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"],re=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],Ee=["Acolyte","Criminal","Folk Hero","Noble","Sage","Soldier"],pe=[15,14,13,12,10,8],Se={Fighter:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Paladin:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Barbarian:{"Martial Melee Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"]},Bard:{Weapon:["Rapier","Longsword"]},Druid:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Monk:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Sorcerer:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Warlock:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]}},ht={Wizard:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Sorcerer:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Warlock:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Eldritch Blast",description:"A beam of crackling energy that deals force damage and can hit multiple targets."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Cleric:[{name:"Guidance",description:"Touch a creature to give them +1d4 to their next ability check."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Resistance",description:"Touch a creature to give them +1d4 to their next saving throw."},{name:"Sacred Flame",description:"Flame-like radiance descends on a creature within 60 feet, dealing radiant damage."},{name:"Spare the Dying",description:"Touch a dying creature to stabilize them at 0 hit points."},{name:"Thaumaturgy",description:"Perform minor magical tricks - make your voice boom, cause tremors, or change eye color."}],Druid:[{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Druidcraft",description:"Predict weather, make a flower bloom, or create a harmless sensory effect."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Primal Savagery",description:"Transform your hand into a claw that deals acid damage to a creature you touch."},{name:"Produce Flame",description:"Create a flickering flame in your hand that you can throw for fire damage."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shillelagh",description:"Transform a club or quarterstaff into a magical weapon that uses your spellcasting ability."},{name:"Thorn Whip",description:"Create a vine-like whip that pulls a creature toward you and deals piercing damage."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."}],Bard:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."},{name:"Vicious Mockery",description:"Insult a creature within 60 feet, dealing psychic damage and possibly giving disadvantage."}]},Pe={Wizard:{cantrips:3,spells:6},Sorcerer:{cantrips:4,spells:2},Warlock:{cantrips:2,spells:2},Cleric:{cantrips:3,spells:2},Druid:{cantrips:2,spells:2},Bard:{cantrips:2,spells:4}},ft=R=>{const K=[...{Fighter:["Chain mail armor","Light crossbow and 20 bolts","Dungeoneer's pack","5 gp"],Wizard:["Arcane focus","Scholar's pack","Component pouch","5 gp"],Cleric:["Chain mail armor","Light crossbow and 20 bolts","Priest's pack","Shield","Holy symbol","5 gp"],Rogue:["Leather armor","Shortbow and 20 arrows","Burglar's pack","Thieves' tools","5 gp"],Ranger:["Scale mail armor","Longbow and 20 arrows","Explorer's pack","5 gp"],Paladin:["Chain mail armor","Javelins (5)","Priest's pack","Holy symbol","5 gp"],Barbarian:["Javelins (4)","Explorer's pack","5 gp"],Bard:["Leather armor","Diplomat's pack OR entertainer's pack","Lute OR any other musical instrument","5 gp"],Druid:["Leather armor","Druidic focus","Explorer's pack","Shield","5 gp"],Monk:["Dungeoneer's pack OR explorer's pack","5 gp"],Sorcerer:["Component pouch OR arcane focus","Dungeoneer's pack","5 gp"],Warlock:["Component pouch OR arcane focus","Scholar's pack","5 gp"]}[R]||["Adventurer's pack","Simple weapon","5 gp"]];return N.weapon&&K.push(N.weapon),N.shield&&K.push(N.shield),fe.length>0&&K.push(`Spells: ${fe.join(", ")}`),K},Ze=()=>{const R=[];for(let $=0;$<4;$++)R.push(Math.floor(Math.random()*6)+1);return R.sort(($,K)=>K-$),R.slice(0,3).reduce(($,K)=>$+K,0)},On=()=>{const R=[];for(let $=0;$<6;$++)R.push(Ze());return R.sort(($,K)=>K-$),D(R),w([...R]),x({}),P(!0),R},Bt=(R,$)=>{const K=L.filter(Y=>Y!==R);w(K),x(Y=>({...Y,[$]:R})),le($,R)},G=R=>{const $=g[R];if($){w(Y=>[...Y,$].sort((oe,se)=>se-oe));const K={...g};delete K[R],x(K),le(R,10)}},ae=()=>{const R=["strength","dexterity","constitution","intelligence","wisdom","charisma"],$={...k};pe.forEach((K,Y)=>{$[R[Y]]=K}),E($),x({}),w([]),P(!1)},le=(R,$)=>{E(K=>({...K,[R]:$}))},je=async R=>{if(R.preventDefault(),!n){console.error("You must be logged in to create a character");return}if(!e){console.error("Party ID is missing. Please try again or contact support.");return}const K=["name","race","class"].filter(Y=>!k[Y]);if(K.length>0){console.error(`Please fill in all required fields: ${K.join(", ")}`);return}i(!0);try{const Y={...k,userId:n.uid,partyId:e,equipment:ft(k.class),weapons:N,spells:fe,createdAt:o?o.createdAt:new Date,updatedAt:new Date};o?(await eR(o.id,Y),console.log("Character updated successfully!")):(await ZA(n.uid,e,Y),console.log("Character created successfully!")),t(`/campaign-story/${e}`)}catch(Y){console.error("Character creation/update error:",Y),console.error("Error creating/updating character:",Y.message)}finally{i(!1)}},vt=async()=>{if(!y.trim()){alert("Please enter a name for your preset");return}if(!k.name||!k.race||!k.class){alert("Please fill in at least the basic character information (name, race, class) before saving as preset");return}try{console.log("Saving preset with data:",{userId:n.uid,presetName:y,characterData:k,weaponChoices:N,spellChoices:fe});const R={name:y,data:{...k,weaponChoices:N,spellChoices:fe,abilityScoreMethod:_,rolledScores:O,assignedScores:g}};console.log("Calling saveCharacterPreset with:",R);const $=await dR(n.uid,R);console.log("Preset saved successfully:",$),T(""),p(!1),await Ue(n.uid),alert("Character preset saved successfully!")}catch(R){console.error("Error saving preset:",R),console.error("Error details:",{message:R.message,code:R.code,stack:R.stack}),R.message.includes("User profile not found")?alert("User profile not found. Please try logging out and back in."):R.message.includes("permission")?alert("Permission denied. Please check your account status."):alert(`Failed to save preset: ${R.message}`)}},Me=R=>{R.key==="Enter"&&y.trim()&&vt()},wt=R=>{const $=R.data;E({...$,name:$.name+" (Copy)",equipment:[],spells:$.spells||[],proficiencies:$.proficiencies||[]}),$.weaponChoices&&C($.weaponChoices),$.spellChoices&&He($.spellChoices),$.abilityScoreMethod&&I($.abilityScoreMethod),$.rolledScores&&(D($.rolledScores),x($.assignedScores||{}),P($.rolledScores.length>0)),A(!1)},Qt=async R=>{if(confirm("Are you sure you want to delete this preset? This action cannot be undone."))try{await Jx(n.uid,R),await Ue(n.uid),alert("Preset deleted successfully!")}catch($){console.error("Error deleting preset:",$),alert("Failed to delete preset. Please try again.")}};return n?c.jsxs("div",{className:"fantasy-container py-8",children:[c.jsxs("div",{className:"fantasy-card",children:[c.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),c.jsx("p",{className:"text-center text-stone-600 mb-6",children:"Create your character to join the campaign. Once created, you'll be automatically ready to start the adventure!"}),c.jsxs("div",{className:"mb-8 p-4 bg-stone-50 rounded-lg border border-stone-200",children:[c.jsx("h3",{className:"text-lg font-semibold text-stone-800 mb-4",children:"Character Presets"}),c.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[c.jsxs("button",{type:"button",onClick:()=>A(!0),className:"fantasy-button bg-amber-600 hover:bg-amber-700",disabled:u.length===0,children:[" Load Preset (",u.length,")"]}),c.jsx("button",{type:"button",onClick:()=>p(!0),className:"fantasy-button bg-emerald-600 hover:bg-emerald-700",children:" Save as Preset"})]}),u.length>0&&c.jsx("p",{className:"text-sm text-stone-600",children:"Save your current character configuration as a preset to easily recreate it for other parties."})]}),c.jsxs("form",{onSubmit:je,className:"space-y-8",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Character Name"}),c.jsx("input",{type:"text",value:k.name,onChange:R=>le("name",R.target.value),className:"fantasy-input",required:!0})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Race"}),c.jsxs("select",{value:k.race,onChange:R=>le("race",R.target.value),className:"fantasy-input",required:!0,children:[c.jsx("option",{value:"",children:"Select Race"}),q.map(R=>c.jsx("option",{value:R,children:R},R))]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Class"}),c.jsxs("select",{value:k.class,onChange:R=>le("class",R.target.value),className:"fantasy-input",required:!0,children:[c.jsx("option",{value:"",children:"Select Class"}),ne.map(R=>c.jsx("option",{value:R,children:R},R))]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Background"}),c.jsxs("select",{value:k.background,onChange:R=>le("background",R.target.value),className:"fantasy-input",required:!0,children:[c.jsx("option",{value:"",children:"Select Background"}),Ee.map(R=>c.jsx("option",{value:R,children:R},R))]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Alignment"}),c.jsxs("select",{value:k.alignment,onChange:R=>le("alignment",R.target.value),className:"fantasy-input",required:!0,children:[c.jsx("option",{value:"",children:"Select Alignment"}),re.map(R=>c.jsx("option",{value:R,children:R},R))]})]})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Ability Scores"}),c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Ability Score Generation Method"}),c.jsxs("div",{className:"flex space-x-4 mb-4",children:[c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"abilityMethod",value:"standard",checked:_==="standard",onChange:R=>I(R.target.value),className:"mr-2"}),"Standard Array (15, 14, 13, 12, 10, 8)"]}),c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"abilityMethod",value:"roll",checked:_==="roll",onChange:R=>I(R.target.value),className:"mr-2"}),"Roll 4d6, Drop Lowest"]})]}),_==="standard"&&c.jsx("button",{type:"button",onClick:ae,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Apply Standard Array"}),_==="roll"&&c.jsxs("div",{className:"space-y-2",children:[c.jsx("button",{type:"button",onClick:On,disabled:b,className:`fantasy-button ${b?"bg-stone-400 cursor-not-allowed":"bg-stone-600 hover:bg-stone-700"}`,children:b?"Scores Already Rolled":"Roll Ability Scores"}),b&&c.jsx("p",{className:"text-sm text-stone-600",children:"You can only roll once, but you can reassign scores as many times as you like."}),O.length>0&&c.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:[c.jsx("h3",{className:"font-semibold text-stone-800 mb-2",children:"Rolled Scores"}),c.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:L.map((R,$)=>c.jsx("span",{className:"bg-amber-100 border border-amber-300 text-amber-800 px-3 py-1 rounded-full text-sm font-medium",children:R},`${R}-${$}`))}),c.jsx("p",{className:"text-sm text-stone-600",children:"Click on an ability score below to assign your rolled scores. You can reassign them as many times as you want."})]})]})]}),c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:["strength","dexterity","constitution","intelligence","wisdom","charisma"].map(R=>{const $=g[R],K=k[R];return c.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2 capitalize",children:R}),$?c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"text-lg font-bold text-amber-700",children:$}),c.jsx("button",{type:"button",onClick:()=>G(R),className:"text-xs text-red-600 hover:text-red-800",children:"Unassign"})]}):c.jsxs("div",{className:"space-y-2",children:[c.jsx("input",{type:"number",min:"1",max:"20",value:K,onChange:Y=>le(R,parseInt(Y.target.value)),className:"fantasy-input",required:!0}),L.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1",children:L.map((Y,oe)=>c.jsx("button",{type:"button",onClick:()=>Bt(Y,R),className:"bg-amber-100 hover:bg-amber-200 border border-amber-300 text-amber-800 px-2 py-1 rounded text-xs font-medium",children:Y},`${Y}-${oe}`))})]}),c.jsxs("div",{className:"text-xs text-stone-500 mt-1",children:["Modifier: ",Math.floor((K-10)/2)]})]},R)})})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Physical Description"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsx("input",{type:"text",placeholder:"Age",value:k.age,onChange:R=>le("age",R.target.value),className:"fantasy-input"}),c.jsx("input",{type:"text",placeholder:"Height",value:k.height,onChange:R=>le("height",R.target.value),className:"fantasy-input"}),c.jsx("input",{type:"text",placeholder:"Weight",value:k.weight,onChange:R=>le("weight",R.target.value),className:"fantasy-input"}),c.jsx("input",{type:"text",placeholder:"Eye Color",value:k.eyes,onChange:R=>le("eyes",R.target.value),className:"fantasy-input"}),c.jsx("input",{type:"text",placeholder:"Skin Color",value:k.skin,onChange:R=>le("skin",R.target.value),className:"fantasy-input"}),c.jsx("input",{type:"text",placeholder:"Hair Color",value:k.hair,onChange:R=>le("hair",R.target.value),className:"fantasy-input"})]})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Personality"}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Personality Traits"}),c.jsx("textarea",{value:k.personality,onChange:R=>le("personality",R.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your character's personality..."})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Ideals"}),c.jsx("textarea",{value:k.ideals,onChange:R=>le("ideals",R.target.value),className:"fantasy-input",rows:"3",placeholder:"What does your character believe in?"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Bonds"}),c.jsx("textarea",{value:k.bonds,onChange:R=>le("bonds",R.target.value),className:"fantasy-input",rows:"3",placeholder:"What connections does your character have?"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Flaws"}),c.jsx("textarea",{value:k.flaws,onChange:R=>le("flaws",R.target.value),className:"fantasy-input",rows:"3",placeholder:"What are your character's weaknesses?"})]})]})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Backstory"}),c.jsx("textarea",{value:k.backstory,onChange:R=>le("backstory",R.target.value),className:"fantasy-input",rows:"6",placeholder:"Tell the story of your character's life before the adventure..."})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Starting Equipment"}),k.class&&Se[k.class]&&c.jsxs("div",{className:"mb-6",children:[c.jsx("h3",{className:"text-lg font-semibold text-stone-800 mb-3",children:"Choose Your Weapons"}),c.jsx("div",{className:"space-y-4",children:Object.entries(Se[k.class]).map(([R,$])=>c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:R}),c.jsxs("select",{value:N[R.toLowerCase().replace(/\s+/g,"")]||"",onChange:K=>C(Y=>({...Y,[R.toLowerCase().replace(/\s+/g,"")]:K.target.value})),className:"fantasy-input",children:[c.jsxs("option",{value:"",children:["Select ",R]}),$.map(K=>c.jsx("option",{value:K,children:K},K))]})]},R))})]}),k.class&&ht[k.class]&&c.jsxs("div",{className:"mb-6",children:[c.jsx("h3",{className:"text-lg font-semibold text-stone-800 mb-3",children:"Choose Your Cantrips"}),c.jsxs("p",{className:"text-sm text-stone-600 mb-3",children:["Select your starting cantrips (0-level spells). You can choose up to ",((Zn=Pe[k.class])==null?void 0:Zn.cantrips)||0," cantrips."]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto border border-stone-200 rounded-lg p-4",children:ht[k.class].map(R=>{var Y;const $=fe.includes(R.name),K=!$&&fe.length>=(((Y=Pe[k.class])==null?void 0:Y.cantrips)||0);return c.jsx("div",{className:`border rounded-lg p-3 ${$?"border-amber-500 bg-amber-50":"border-stone-200"} ${K?"opacity-50":"hover:border-stone-300"}`,children:c.jsxs("label",{className:`flex items-start space-x-3 cursor-pointer ${K?"cursor-not-allowed":""}`,children:[c.jsx("input",{type:"checkbox",checked:$,disabled:K,onChange:oe=>{oe.target.checked?He(se=>[...se,R.name]):He(se=>se.filter(me=>me!==R.name))},className:"rounded mt-1"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"font-medium text-stone-800",children:R.name}),c.jsx("div",{className:"text-sm text-stone-600 mt-1",children:R.description})]})]})},R.name)})}),c.jsxs("div",{className:"flex justify-between items-center mt-3",children:[c.jsxs("p",{className:"text-sm text-stone-500",children:["Selected: ",fe.length," / ",((F=Pe[k.class])==null?void 0:F.cantrips)||0," cantrips"]}),fe.length>=(((Q=Pe[k.class])==null?void 0:Q.cantrips)||0)&&c.jsx("p",{className:"text-sm text-green-600 font-medium",children:" Cantrip selection complete"})]})]}),k.class?c.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:[c.jsxs("h3",{className:"font-semibold text-stone-800 mb-3",children:[k.class," Starting Equipment"]}),c.jsx("ul",{className:"space-y-1",children:ft(k.class).map((R,$)=>c.jsxs("li",{className:"text-stone-700 flex items-start",children:[c.jsx("span",{className:"text-stone-500 mr-2",children:""}),R]},$))}),c.jsx("p",{className:"text-sm text-stone-600 mt-3",children:"This equipment will be automatically assigned to your character."})]}):c.jsx("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:c.jsx("p",{className:"text-stone-600",children:"Select a class to see your starting equipment."})})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Character Portrait"}),c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("div",{className:"w-32 h-32 bg-stone-200 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-stone-500",children:"Portrait Placeholder"})}),c.jsx("button",{type:"button",className:"fantasy-button",onClick:()=>{},children:"Upload Image"})]})]}),c.jsxs("div",{className:"flex justify-center space-x-4",children:[c.jsx("button",{type:"button",onClick:()=>t(`/campaign-story/${e}`),className:"fantasy-button bg-stone-600 hover:bg-stone-700",disabled:s,children:"Back to Campaign"}),c.jsx("button",{type:"submit",className:"fantasy-button",disabled:s,children:s?"Creating Character...":"Create Character"})]})]})]}),f&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"fantasy-card max-w-md w-full mx-4",children:[c.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Save Character Preset"}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Preset Name"}),c.jsx("input",{type:"text",value:y,onChange:R=>T(R.target.value),onKeyPress:Me,className:"fantasy-input",placeholder:"Enter a name for your preset",autoFocus:!0})]}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx("button",{type:"button",onClick:()=>{p(!1),T("")},className:"fantasy-button bg-stone-600 hover:bg-stone-700 flex-1",children:"Cancel"}),c.jsx("button",{type:"button",onClick:vt,className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 flex-1",children:"Save Preset"})]})]})]})}),S&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"fantasy-card max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[c.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Load Character Preset"}),u.length===0?c.jsxs("div",{className:"text-center py-8",children:[c.jsx("p",{className:"text-stone-600 mb-4",children:"No character presets found."}),c.jsx("p",{className:"text-sm text-stone-500",children:"Create a character and save it as a preset to see it here."}),c.jsx("button",{type:"button",onClick:()=>A(!1),className:"fantasy-button mt-4",children:"Close"})]}):c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"grid gap-4",children:u.map(R=>c.jsxs("div",{className:"border border-stone-200 rounded-lg p-4 hover:border-stone-300",children:[c.jsxs("div",{className:"flex justify-between items-start mb-3",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"font-semibold text-stone-800",children:R.name}),c.jsxs("p",{className:"text-sm text-stone-600",children:[R.data.race," ",R.data.class,"  Level ",R.data.level]}),R.data.background&&c.jsx("p",{className:"text-sm text-stone-500",children:R.data.background}),R.createdAt&&c.jsxs("p",{className:"text-xs text-stone-400 mt-1",children:["Created: ",new Date(R.createdAt.toDate()).toLocaleDateString()]})]}),c.jsx("button",{type:"button",onClick:()=>Qt(R.id),className:"text-red-600 hover:text-red-800 text-sm",title:"Delete preset",children:""})]}),c.jsx("div",{className:"flex space-x-2",children:c.jsx("button",{type:"button",onClick:()=>wt(R),className:"fantasy-button bg-amber-600 hover:bg-amber-700 flex-1",children:"Load Preset"})})]},R.id))}),c.jsx("div",{className:"flex justify-center",children:c.jsx("button",{type:"button",onClick:()=>A(!1),className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Cancel"})})]})]})})]}):null}function SR(){const t=Jn(),[e,n]=j.useState(null),[r,s]=j.useState([]),[i,o]=j.useState({}),[l,u]=j.useState(!1),[d,f]=j.useState(!1),[p,y]=j.useState(""),[T,S]=j.useState({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""});j.useEffect(()=>{const D=gs(L=>{if(!L){t("/login");return}n(L),A(L.uid)});return()=>D()},[t]);const A=async D=>{try{const L=await zm(D);s(L),await k(L)}catch(L){console.error("Error loading parties:",L.message)}},k=async D=>{try{const L=new Set;if(D.forEach(b=>{b.members&&Array.isArray(b.members)&&b.members.forEach(P=>L.add(P))}),L.size===0)return;const w=await Gx(Array.from(L)),g={};w.forEach(b=>{g[b.userId]=b});const x={};D.forEach(b=>{b.members&&Array.isArray(b.members)&&(x[b.id]=b.members.map(P=>({userId:P,profile:g[P]||null})))}),o(x)}catch(L){console.error("Error loading party member profiles:",L)}},E=async D=>{if(D.preventDefault(),!e){console.error("You must be logged in to create a party");return}u(!0);try{const L={...T,inviteCode:Math.random().toString(36).substr(2,8).toUpperCase()},w=await tR(e.uid,L);f(!1),S({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""}),await A(e.uid),console.log("Party created successfully!")}catch(L){console.error("Error creating party:",L.message)}finally{u(!1)}},_=async()=>{if(!p.trim()){console.error("Please enter an invite code");return}if(!e){console.error("You must be logged in to join a party");return}u(!0);try{const D=await sR(p.toUpperCase());if(!D){console.error("Invalid invite code");return}await nR(D.id,e.uid),y(""),await A(e.uid),console.log("Successfully joined party!")}catch(D){console.error(D.message||"Error joining party. Please try again.")}finally{u(!1)}},I=D=>{navigator.clipboard.writeText(D),console.log("Invite code copied to clipboard!")},O=async(D,L)=>{if(confirm(`Are you sure you want to disband "${L}"? This action cannot be undone and will remove all party members and characters.`)){u(!0);try{await rR(D,e.uid),await A(e.uid),console.log("Party disbanded successfully")}catch(w){console.error("Error disbanding party:",w.message)}finally{u(!1)}}};return e?c.jsx("div",{className:"fantasy-container py-8",children:c.jsxs("div",{className:"fantasy-card",children:[c.jsxs("div",{className:"flex justify-between items-center mb-6",children:[c.jsx("h1",{className:"fantasy-title mb-0",children:"Party Management"}),c.jsx("button",{onClick:()=>f(!0),className:"fantasy-button",disabled:l,children:"Create New Party"})]}),d&&c.jsxs("div",{className:"fantasy-card bg-amber-50 mb-6",children:[c.jsx("h2",{className:"text-xl font-bold text-stone-800 mb-4",children:"Create New Party"}),c.jsxs("form",{onSubmit:E,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Party Name"}),c.jsx("input",{type:"text",value:T.name,onChange:D=>S(L=>({...L,name:D.target.value})),className:"fantasy-input",required:!0})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Theme"}),c.jsx("textarea",{value:T.description,onChange:D=>S(L=>({...L,description:D.target.value})),className:"fantasy-input",rows:"3",placeholder:"Enter the theme or atmosphere for your campaign..."})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Max Players"}),c.jsx("input",{type:"number",min:"2",max:"10",value:T.maxPlayers,onChange:D=>S(L=>({...L,maxPlayers:parseInt(D.target.value)})),className:"fantasy-input"})]}),c.jsxs("div",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",id:"isPublic",checked:T.isPublic,onChange:D=>S(L=>({...L,isPublic:D.target.checked})),className:"mr-2"}),c.jsx("label",{htmlFor:"isPublic",className:"text-sm font-medium text-stone-700",children:"Public Party (visible to all users)"})]})]}),c.jsxs("div",{className:"flex space-x-4",children:[c.jsx("button",{type:"submit",className:"fantasy-button",disabled:l,children:l?"Creating...":"Create Party"}),c.jsx("button",{type:"button",onClick:()=>f(!1),className:"fantasy-button bg-stone-600 hover:bg-stone-700",disabled:l,children:"Cancel"})]})]})]}),c.jsxs("div",{className:"mb-8",children:[c.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"My Parties"}),r.length===0?c.jsxs("div",{className:"text-center py-8 text-stone-600",children:[c.jsx("p",{children:"You haven't joined any parties yet."}),c.jsx("p",{children:'Click "Create New Party" to get started!'})]}):c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:r.map(D=>{var w;const L=i[D.id]||[];return c.jsxs("div",{className:"fantasy-card bg-amber-50",children:[c.jsxs("div",{className:"flex justify-between items-start mb-4",children:[c.jsx("h3",{className:"text-xl font-bold text-stone-800",children:D.name}),c.jsxs("span",{className:"text-sm text-stone-600",children:[((w=D.members)==null?void 0:w.length)||1,"/",D.maxPlayers," players"]})]}),D.description&&c.jsxs("div",{className:"mb-4",children:[c.jsx("span",{className:"text-sm font-semibold text-stone-700",children:"Theme: "}),c.jsx("span",{className:"text-stone-600",children:D.description})]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("h4",{className:"text-sm font-semibold text-stone-700 mb-2",children:"Party Members:"}),c.jsx("div",{className:"space-y-1",children:L.map((g,x)=>{var N;const b=((N=g.profile)==null?void 0:N.username)||`User ${x+1}`,P=g.userId===D.dmId;return c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-stone-600",children:b}),P&&c.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),g.userId===(e==null?void 0:e.uid)&&c.jsx("span",{className:"text-blue-600 text-xs font-medium",children:"(You)"})]},g.userId)})})]}),D.dmId===e.uid&&c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Invite Code"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"text",value:D.inviteCode,readOnly:!0,className:"fantasy-input bg-stone-100"}),c.jsx("button",{onClick:()=>I(D.inviteCode),className:"fantasy-button text-sm",children:"Copy"})]})]}),c.jsxs("div",{className:"flex space-x-2",children:[c.jsx("button",{onClick:()=>t(`/campaign-story/${D.id}`),className:"fantasy-button",children:"Campaign"}),D.dmId===e.uid&&c.jsx("button",{onClick:()=>O(D.id,D.name),className:"fantasy-button bg-red-600 hover:bg-red-700",disabled:l,children:"Disband"})]})]},D.id)})})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Join a Party"}),c.jsx("div",{className:"fantasy-card bg-amber-50",children:c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("input",{type:"text",placeholder:"Enter invite code",value:p,onChange:D=>y(D.target.value),className:"fantasy-input flex-1",disabled:l}),c.jsx("button",{onClick:_,className:"fantasy-button",disabled:l,children:l?"Joining...":"Join Party"})]})})]})]})}):null}const IR="https://dnd-v1-backend.onrender.com",zt=async(t,e="gpt-4",n=1e3,r=.8)=>{try{const s=await fetch(`${IR}/api/openai`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t,model:e,max_tokens:n,temperature:r})});if(!s.ok){const o=await s.json();throw new Error(o.error||"Backend API request failed")}return await s.json()}catch(s){throw console.error("Backend API Error:",s),new Error(`Failed to communicate with backend: ${s.message}`)}};class NR{constructor(){this.systemPrompt=`You are an experienced Dungeon Master for Dungeons & Dragons 5th Edition. You excel at:
- Creating engaging storylines and plot hooks
- Developing detailed character descriptions and backstories
- Generating multiple story options and summarizing them
- Providing atmospheric descriptions and immersive storytelling
- Balancing combat encounters and managing game mechanics
- Creating memorable NPCs and villains
- Adapting to player choices and creating dynamic narratives
- Maintaining story consistency and character development
- Building upon established relationships and plot threads

Always respond in character as a Dungeon Master, providing rich, descriptive content that enhances the gaming experience. Maintain consistency with previous story elements, character relationships, and established plot threads.`,this.diceService=new bu,this.actionValidationService=new Wm}async generateStoryPlots(e,n="",r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class} (${u.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const o=`As a Dungeon Master, I need you to generate 3 different story plot options for a D&D campaign.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

For each plot option, provide:
1. A compelling title
2. A brief summary (2-3 sentences)
3. The main conflict or challenge
4. Potential story hooks for the party
5. Estimated campaign length (short, medium, or long)

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options.`;return(await zt([{role:"system",content:this.systemPrompt},{role:"user",content:o}],"gpt-4",1e3,.8)).choices[0].message.content}catch(s){throw new Error(`Failed to generate story plots: ${s.message}`)}}async generateCharacterDetails(e){try{const n=`As a Dungeon Master, I need you to expand on this character's details and create a rich, detailed description.

Character: ${e.name} - Level ${e.level} ${e.race} ${e.class}
Background: ${e.background}
Alignment: ${e.alignment}
Personality: ${e.personality||"Not specified"}
Ideals: ${e.ideals||"Not specified"}
Bonds: ${e.bonds||"Not specified"}
Flaws: ${e.flaws||"Not specified"}
Backstory: ${e.backstory||"Not specified"}

Please provide:
1. A detailed physical description (appearance, mannerisms, distinctive features)
2. An expanded personality profile with quirks and habits
3. A deeper backstory with key events and relationships
4. Character motivations and goals
5. Potential story hooks and plot threads related to this character
6. How this character might interact with the party and world

Make the character feel alive and three-dimensional, with details that could drive story development.`;return(await zt([{role:"system",content:this.systemPrompt},{role:"user",content:n}],"gpt-4",800,.7)).choices[0].message.content}catch(n){throw console.error("Error generating character details:",n),new Error(`Failed to generate character details: ${n.message}`)}}async generateStorySummary(e,n){try{const r=n.map(o=>`${o.name} (${o.race} ${o.class})`).join(", "),s=`As a Dungeon Master, I need you to create a detailed story summary and outline for this campaign plot.

Plot: ${e}
Party: ${r}

Please provide:
1. A detailed campaign overview (3-4 paragraphs)
2. Key story beats and major events
3. Important NPCs and their roles
4. Potential challenges and obstacles
5. Story themes and motifs
6. How each party member might be personally invested
7. Potential branching paths and player choices
8. Climactic moments and resolution possibilities

Make this feel like a professional campaign module with rich storytelling potential.`;return(await zt([{role:"system",content:this.systemPrompt},{role:"user",content:s}],"gpt-4",1200,.7)).choices[0].message.content}catch(r){throw console.error("Error generating story summary:",r),new Error(`Failed to generate story summary: ${r.message}`)}}async generateMultipleStoryPlots(e,n="",r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class} (${u.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const o=`As a Dungeon Master, I need you to generate 5 different story plot options for a D&D campaign, each with a detailed summary.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

For each of the 5 plot options, provide:
1. A compelling title
2. A detailed summary (3-4 paragraphs)
3. The main conflict or challenge
4. Key story beats and major events
5. Important NPCs and their roles
6. Potential story hooks for the party
7. Estimated campaign length (short, medium, or long)
8. Themes and motifs
9. How each party member might be personally invested

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options. Number each plot clearly (Plot 1, Plot 2, etc.).`;return(await zt([{role:"system",content:this.systemPrompt},{role:"user",content:o}],"gpt-4",1500,.8)).choices[0].message.content}catch(s){throw console.error("Error generating multiple story plots:",s),new Error(`Failed to generate multiple story plots: ${s.message}`)}}async generateNPC(e,n=""){try{const r=`As a Dungeon Master, I need you to create a detailed NPC for this role and context.

NPC Role: ${e}
Context: ${n||"General campaign context"}

Please provide:
1. A detailed physical description
2. Personality traits and mannerisms
3. Background and motivations
4. Current situation and goals
5. How they might interact with the party
6. Potential story hooks or plot threads they could introduce
7. Their relationship to the world and other NPCs
8. Any secrets or hidden aspects of their character

Make this NPC feel like a real person with depth and complexity.`;return(await zt([{role:"system",content:this.systemPrompt},{role:"user",content:r}],"gpt-4",800,.7)).choices[0].message.content}catch(r){throw console.error("Error generating NPC:",r),new Error(`Failed to generate NPC: ${r.message}`)}}async generateCombatEncounter(e,n,r="medium",s=""){try{const i=`As a Dungeon Master, I need you to create a detailed combat encounter.

Party Level: ${e}
Party Size: ${n}
Difficulty: ${r}
Theme: ${s||"General fantasy"}

Please provide:
1. A detailed description of the encounter location
2. Enemy types and their motivations
3. Tactical considerations and terrain features
4. Potential story elements or plot hooks
5. Non-combat resolution options
6. Consequences of victory or defeat
7. Environmental hazards or advantages
8. How this encounter fits into the larger story

Make this encounter feel meaningful and story-driven, not just a random fight.`;return(await zt([{role:"system",content:this.systemPrompt},{role:"user",content:i}],"gpt-4",800,.7)).choices[0].message.content}catch(i){throw console.error("Error generating combat encounter:",i),new Error(`Failed to generate combat encounter: ${i.message}`)}}async generateStoryContinuation(e,n,r,s=null,i="individual",o=null){var l,u,d,f,p;try{const y=e.map(D=>`${D.name} - Level ${D.level} ${D.race} ${D.class}`).join(", ");let T=null,S=null,A="";if(i==="individual"){const D=e[e.length-1];if(D)if(T=this.actionValidationService.validatePlayerAction(r,D,{context:"story",storyState:s}),T.valid&&T.diceResult){if(S=T.diceResult,S.overallSuccess){if(A=`

ACTION VALIDATION: The action is within your character's capabilities.`,S.actions){const L=S.actions.map(w=>`${w.action}: ${w.check.isSuccess?"Success":"Failure"} (Roll: ${w.check.roll}, DC: ${w.check.dc})`).join(", ");A+=`
Dice Results: ${L}`}}else if(A=`

ACTION VALIDATION: Some aspects of this action are challenging for your character.`,S.actions){const w=S.actions.filter(g=>!g.check.isSuccess).map(g=>`${g.action}: Failure (Roll: ${g.check.roll}, DC: ${g.check.dc})`).join(", ");A+=`
Failed Actions: ${w}`}}else T.valid||(A=`

ACTION VALIDATION: ${T.response}`,T.suggestion&&(A+=`
Suggestion: ${T.suggestion}`))}const k=n.map(D=>({role:D.role,content:D.content}));let E="";o&&(E=`
Party Theme: ${o.description||"No theme provided"}`);let _="";s&&(_=`
STORY STATE CONTEXT:
Current Location: ${((l=s.currentLocation)==null?void 0:l.name)||"Unknown"} - ${((u=s.currentLocation)==null?void 0:u.description)||""}
Active NPCs: ${Object.keys(s.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((d=s.activePlotThreads)==null?void 0:d.map(D=>`${D.title} (${Math.round(D.progress*100)}%)`).join(", "))||"None"}
Recent Events: ${((p=(f=s.worldState)==null?void 0:f.recentEvents)==null?void 0:p.slice(-3).map(D=>D.event).join(", "))||"None"}

CHARACTER RELATIONSHIPS:
${e.map(D=>{var g;const L=((g=s.characterArcs)==null?void 0:g[D.id])||{},w=Object.entries(L.relationships||{}).map(([x,b])=>`${x} (${b})`).join(", ");return`${D.name}: ${w||"No established relationships"}`}).join(`
`)}

NPC CONTEXT:
${Object.entries(s.activeNPCs||{}).map(([D,L])=>{var w;return`${D}: ${L.disposition} disposition, knowledge: ${((w=L.knowledge)==null?void 0:w.join(", "))||"none"}, goal: ${L.currentGoal||"unknown"}`}).join(`
`)}`);const I=`As a Dungeon Master, continue the story based on the player's response.

Party: ${y}${E}
Player Response: "${r}" (Type: ${i})
Response Type Context:
- individual: One character's personal action
- team: Group action or decision
- investigate: Looking for clues or information
- combat: Combat-related action
- social: Social interaction or diplomacy${_}

Previous Story Context:
${k.map(D=>`${D.role==="assistant"?"DM":"Player"}: ${D.content}`).join(`
`)}

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

ACTION VALIDATION GUIDELINES:
- If the action validation shows the action is impossible, gently redirect the player while maintaining story flow
- If the action validation shows the action is challenging, incorporate the difficulty into the narrative
- If the action validation shows the action is successful, proceed with the action as described
- Always maintain story coherence and character consistency
- Use the validation results to inform how the action plays out in the story

Please provide a compelling continuation that:
1. Acknowledges the player's action in context of the current situation and location
2. References relevant NPCs and their established relationships with the party
3. Continues or advances active plot threads appropriately
4. Updates character relationships based on the action
5. Maintains location and atmosphere consistency
6. Ends with a clear situation that invites the next player to respond
7. Encourages character interaction and roleplay
8. Provides multiple possible directions for the party to explore
9. Builds upon the established story state and character development
10. Incorporates action validation results naturally into the narrative

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.${A}`;return{content:(await zt([{role:"system",content:this.systemPrompt},...k,{role:"user",content:I}],"gpt-4",800,.8)).choices[0].message.content,actionValidation:T,diceResult:S}}catch(y){throw console.error("Error generating story continuation:",y),new Error(`Failed to generate story continuation: ${y.message}`)}}async generatePlotOptions(e,n=null){try{const r=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class}. ${u.personality||""}. ${u.backstory||""}`).join(`
`);let s="";n&&(s=`
Party Theme: ${n.description||"No theme provided"}`);const i="You are a Dungeon Master for D&D 5e. You MUST generate exactly 3 plot options, no more, no less. Follow the exact format provided. Do not use party names in the plots. Keep summaries brief (1-2 sentences maximum). DO NOT repeat plots or generate duplicates.",o=`Generate exactly 3 distinct campaign plot options for this party. 

REQUIRED FORMAT - Follow this exact structure:

Plot 1: [Title]
[Brief summary - 1-2 sentences maximum]

Plot 2: [Title]  
[Brief summary - 1-2 sentences maximum]

Plot 3: [Title]
[Brief summary - 1-2 sentences maximum]

Party: ${r}${s}

CRITICAL REQUIREMENTS:
- Generate EXACTLY 3 plots, no more, no less
- Use the party theme to influence the plot lines and atmosphere
- Do NOT use the party name in the plots - focus on the characters and theme
- Each summary must be 1-2 sentences maximum
- Follow the exact format above with "Plot 1:", "Plot 2:", "Plot 3:" labels
- Do not add any additional text, explanations, or formatting
- Do not repeat or duplicate any plots
- Stop after Plot 3 - do not generate more plots

Make each plot distinct and appealing to different play styles.`;return(await zt([{role:"system",content:i},{role:"user",content:o}],"gpt-4",600,.8)).choices[0].message.content}catch(r){throw console.error("Error generating plot options:",r),new Error(`Failed to generate plot options: ${r.message}`)}}async generateStoryIntroduction(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}. ${d.personality||""}. ${d.backstory||""}`).join(`
`);let o="";s&&(o=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create an engaging story introduction for the beginning of this campaign.

Party: ${i}${o}
Selected Plot: Plot ${r}
Plot Details: ${n}

Create an introduction that includes:
1. A vivid description of the starting town/settlement where the party begins
2. How each character arrives or is already present in this location
3. The initial situation or hook that draws the party together
4. A sense of atmosphere and setting that matches the chosen plot
5. An opening scene that gives the party their first decision or action to take

Important Guidelines:
- Use the party theme to influence the atmosphere and context
- Incorporate themes and elements from the party theme to create atmosphere and context
- Consider how the party's background and composition might influence the starting situation
- Focus on the characters and their individual stories
- The story should feel cohesive with the established theme

Make this feel like the opening of an epic adventure. Set the tone, establish the setting, and give the party a clear starting point. End with a situation that requires the party to make a choice or take action.

Keep the introduction engaging but concise (3-4 paragraphs maximum).`;return(await zt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",800,.8)).choices[0].message.content}catch(i){throw console.error("Error generating story introduction:",i),new Error(`Failed to generate story introduction: ${i.message}`)}}async generateStructuredStoryResponse(e,n,r,s,i,o=null,l=null){var u,d,f;try{const p=e.map(_=>`${_.name} - Level ${_.level} ${_.race} ${_.class}`).join(", "),y=n.map(_=>({role:_.role,content:_.content}));let T="";l&&(T=`
Party Theme: ${l.description||"No theme provided"}`);const S=i.length>0?`
Discovered Objectives: ${i.map(_=>_.title).join(", ")}`:"";let A="";o&&(A=`
STORY STATE CONTEXT:
Current Location: ${((u=o.currentLocation)==null?void 0:u.name)||"Unknown"} - ${((d=o.currentLocation)==null?void 0:d.description)||""}
Active NPCs: ${Object.keys(o.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((f=o.activePlotThreads)==null?void 0:f.map(_=>`${_.title} (${Math.round(_.progress*100)}%)`).join(", "))||"None"}
Character Relationships: ${Object.entries(o.characterArcs||{}).map(([_,I])=>{const O=e.find(D=>D.id===_);return`${O==null?void 0:O.name}: ${Object.entries(I.relationships||{}).map(([D,L])=>`${D} (${L})`).join(", ")||"No relationships"}`}).join("; ")}`);const k=`As a Dungeon Master, continue the story based on the player's response, considering the current story phase and discovered objectives.

Party: ${p}${T}
Current Phase: ${s}
Player Response: "${r}"${S}${A}

Story Phases:
- Investigation: Focus on discovery, clues, and gathering information
- Conflict: Focus on tension, threats, and potential combat
- Resolution: Focus on choices, consequences, and story conclusion

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

Please provide a compelling continuation that:
1. Acknowledges the player's action in context of the current situation and location
2. References relevant NPCs and their established relationships with the party
3. Continues or advances active plot threads appropriately
4. Updates character relationships based on the action
5. Maintains location and atmosphere consistency
6. Ends with a clear situation that invites the next player to respond
7. Encourages character interaction and roleplay
8. Provides multiple possible directions for the party to explore
9. Builds upon the established story state and character development

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.`;return(await zt([{role:"system",content:this.systemPrompt},...y,{role:"user",content:k}],"gpt-4",800,.8)).choices[0].message.content}catch(p){throw console.error("Error generating structured story response:",p),new Error(`Failed to generate structured story response: ${p.message}`)}}async generatePhaseTransition(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let o="";s&&(o=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create a phase transition message for the story.

Party: ${i}${o}
Current Phase: ${n}
Story Progress: ${r}

Create a transition that:
1. Acknowledges the progress made so far
2. Signals the shift to the new phase
3. Sets up the new challenges and opportunities
4. Maintains the established tone and atmosphere
5. Gives the party clear direction for the next phase

Make this feel like a natural progression in the story.`;return(await zt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating phase transition:",i),new Error(`Failed to generate phase transition: ${i.message}`)}}async generateObjectiveCompletion(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let o="";s&&(o=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create a completion message for an objective.

Party: ${i}${o}
Completed Objective: ${n.title}
Story Context: ${r}

Create a completion message that:
1. Celebrates the achievement
2. Provides closure for this objective
3. Sets up the next challenge or objective
4. Maintains story momentum
5. Acknowledges the party's efforts

Make this feel rewarding and meaningful.`;return(await zt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating objective completion:",i),new Error(`Failed to generate objective completion: ${i.message}`)}}async generateCampaignContinuation(e,n,r,s,i=null){try{const o=e.map(p=>`${p.name} - Level ${p.level} ${p.race} ${p.class}`).join(", "),l=r.map(p=>({role:p.role,content:p.content}));let u="";i&&(u=`
Party Theme: ${i.description||"No theme provided"}`);const d=`As a Dungeon Master, continue the ongoing campaign story.

Party: ${o}${u}
Campaign Goal: ${n.mainGoal||"No specific goal"}
Campaign Progress: ${n.campaignProgress||"Beginning"}
Player Response: "${s}"

Previous Story Context:
${l.map(p=>`${p.role==="assistant"?"DM":"Player"}: ${p.content}`).join(`
`)}

Continue the story while:
1. Building toward the main campaign goal
2. Maintaining consistency with previous events
3. Developing character relationships and arcs
4. Creating meaningful choices and consequences
5. Advancing the overall plot

Keep your response engaging but concise (2-3 paragraphs maximum).`;return(await zt([{role:"system",content:this.systemPrompt},...l,{role:"user",content:d}],"gpt-4",800,.8)).choices[0].message.content}catch(o){throw console.error("Error generating campaign continuation:",o),new Error(`Failed to generate campaign continuation: ${o.message}`)}}async generateCampaignGoal(e,n,r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class}`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const o=`As a Dungeon Master, create a clear campaign goal based on the selected plot.

Party: ${s}${i}
Plot Content: ${n}

Create a campaign goal that:
1. Is clear and achievable
2. Provides direction for the entire campaign
3. Involves all party members
4. Has multiple possible paths to completion
5. Creates meaningful stakes and consequences

Make this goal compelling and motivating for the party.`;return(await zt([{role:"system",content:this.systemPrompt},{role:"user",content:o}],"gpt-4",600,.7)).choices[0].message.content}catch(s){throw console.error("Error generating campaign goal:",s),new Error(`Failed to generate campaign goal: ${s.message}`)}}async generateSessionSummary(e,n,r,s,i=null){try{const o=s.map(f=>`${f.name} - Level ${f.level} ${f.race} ${f.class}`).join(", ");let l="";i&&(l=`
Party Theme: ${i.description||"No theme provided"}`);const u=`As a Dungeon Master, create a session summary for this campaign session.

Party: ${o}${l}
Campaign Goal: ${e.mainGoal||"No specific goal"}
Objectives: ${r.map(f=>f.title).join(", ")}
Story Messages: ${n.length} total messages

Create a summary that:
1. Recaps the major events of the session
2. Highlights character development and relationships
3. Notes progress toward objectives
4. Sets up expectations for the next session
5. Maintains the established tone and atmosphere

Make this summary engaging and informative.`;return(await zt([{role:"system",content:this.systemPrompt},{role:"user",content:u}],"gpt-4",800,.7)).choices[0].message.content}catch(o){throw console.error("Error generating session summary:",o),new Error(`Failed to generate session summary: ${o.message}`)}}}const zn=new NR;function PR({partyCharacters:t,onStoryGenerated:e,onCharacterDetailsGenerated:n,partyInfo:r=null}){const[s,i]=j.useState("plots"),[o,l]=j.useState(!1),[u,d]=j.useState(""),[f,p]=j.useState(""),[y,T]=j.useState(""),[S,A]=j.useState(""),[k,E]=j.useState(""),[_,I]=j.useState(""),[O,D]=j.useState({partyLevel:1,partySize:t.length,difficulty:"medium",theme:""}),L=async()=>{if(t.length===0){d("No party characters available. Please create characters first.");return}l(!0),d("");try{const N=await zn.generateStoryPlots(t,y,r);p(N),e&&e(N)}catch{d("Failed to generate story plots. Please check your API key and try again.")}finally{l(!1)}},w=async()=>{if(t.length===0){d("No party characters available. Please create characters first.");return}l(!0),d("");try{const N=await zn.generateMultipleStoryPlots(t,y,r);p(N),e&&e(N)}catch{d("Failed to generate story plots. Please check your API key and try again.")}finally{l(!1)}},g=async()=>{if(!S){d("Please select a character first.");return}const N=t.find(C=>C.id===S);if(!N){d("Selected character not found.");return}l(!0),d("");try{const C=await zn.generateCharacterDetails(N);p(C),n&&n(N.id,C)}catch{d("Failed to generate character details. Please check your API key and try again.")}finally{l(!1)}},x=async()=>{if(!k.trim()){d("Please enter an NPC role.");return}l(!0),d("");try{const N=await zn.generateNPC(k,_);p(N)}catch{d("Failed to generate NPC. Please check your API key and try again.")}finally{l(!1)}},b=async()=>{l(!0),d("");try{const N=await zn.generateCombatEncounter(O.partyLevel,O.partySize,O.difficulty,O.theme);p(N)}catch{d("Failed to generate encounter. Please check your API key and try again.")}finally{l(!1)}},P=[{id:"plots",label:"Story Plots",icon:""},{id:"characters",label:"Character Details",icon:""},{id:"npcs",label:"NPCs",icon:""},{id:"encounters",label:"Combat Encounters",icon:""}];return c.jsxs("div",{className:"fantasy-card",children:[c.jsxs("div",{className:"flex justify-between items-center mb-6",children:[c.jsx("h2",{className:"fantasy-title mb-0",children:" AI Dungeon Master"}),c.jsx("div",{className:"text-sm text-stone-600",children:"Powered by ChatGPT"})]}),c.jsx("div",{className:"flex space-x-1 mb-6 bg-stone-100 p-1 rounded-lg",children:P.map(N=>c.jsxs("button",{onClick:()=>i(N.id),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center space-x-2 ${s===N.id?"bg-amber-600 text-white":"text-stone-600 hover:text-stone-800"}`,children:[c.jsx("span",{children:N.icon}),c.jsx("span",{children:N.label})]},N.id))}),u&&c.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:u}),s==="plots"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Setting (Optional)"}),c.jsx("textarea",{value:y,onChange:N=>T(N.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your campaign setting, world, or any specific themes..."})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsx("button",{onClick:L,disabled:o||t.length===0,className:"fantasy-button",children:o?"Generating...":"Generate Basic Plots"}),c.jsx("button",{onClick:w,disabled:o||t.length===0,className:"fantasy-button bg-amber-700 hover:bg-amber-800",children:o?"Generating...":"Generate Detailed Plots"})]}),c.jsxs("div",{className:"text-sm text-stone-600 text-center",children:[c.jsxs("p",{children:[c.jsx("strong",{children:"Basic Plots:"})," 3 plot options with brief summaries"]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Detailed Plots:"})," 5 plot options with full story summaries and character integration"]})]}),t.length===0&&c.jsx("p",{className:"text-sm text-stone-600 text-center",children:"Create party characters first to generate story plots."})]}),s==="characters"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Select Character"}),c.jsxs("select",{value:S,onChange:N=>A(N.target.value),className:"fantasy-input",children:[c.jsx("option",{value:"",children:"Choose a character..."}),t.map(N=>c.jsxs("option",{value:N.id,children:[N.name," - ",N.race," ",N.class]},N.id))]})]}),c.jsx("button",{onClick:g,disabled:o||!S,className:"fantasy-button w-full",children:o?"Generating Details...":"Generate Character Details"})]}),s==="npcs"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"NPC Role"}),c.jsx("input",{type:"text",value:k,onChange:N=>E(N.target.value),className:"fantasy-input",placeholder:"e.g., Town Mayor, Mysterious Wizard, Bandit Leader..."})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Context (Optional)"}),c.jsx("textarea",{value:_,onChange:N=>I(N.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe the context, location, or situation..."})]}),c.jsx("button",{onClick:x,disabled:o||!k.trim(),className:"fantasy-button w-full",children:o?"Generating NPC...":"Generate NPC"})]}),s==="encounters"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Party Level"}),c.jsx("input",{type:"number",min:"1",max:"20",value:O.partyLevel,onChange:N=>D(C=>({...C,partyLevel:parseInt(N.target.value)})),className:"fantasy-input"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Party Size"}),c.jsx("input",{type:"number",min:"1",max:"10",value:O.partySize,onChange:N=>D(C=>({...C,partySize:parseInt(N.target.value)})),className:"fantasy-input"})]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Difficulty"}),c.jsxs("select",{value:O.difficulty,onChange:N=>D(C=>({...C,difficulty:N.target.value})),className:"fantasy-input",children:[c.jsx("option",{value:"easy",children:"Easy"}),c.jsx("option",{value:"medium",children:"Medium"}),c.jsx("option",{value:"hard",children:"Hard"}),c.jsx("option",{value:"deadly",children:"Deadly"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Theme (Optional)"}),c.jsx("input",{type:"text",value:O.theme,onChange:N=>D(C=>({...C,theme:N.target.value})),className:"fantasy-input",placeholder:"e.g., Forest ambush, Dungeon crawl..."})]})]}),c.jsx("button",{onClick:b,disabled:o,className:"fantasy-button w-full",children:o?"Generating Encounter...":"Generate Combat Encounter"})]}),f&&c.jsxs("div",{className:"mt-8",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Generated Content"}),c.jsx("button",{onClick:()=>p(""),className:"text-sm text-stone-600 hover:text-stone-800",children:"Clear"})]}),c.jsx("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:c.jsx("div",{className:"prose prose-sm max-w-none",children:c.jsx("pre",{className:"whitespace-pre-wrap text-stone-800 font-sans text-sm leading-relaxed",children:f})})})]})]})}function kR(){const{partyId:t}=tu(),e=Jn(),[n,r]=j.useState(null),[s,i]=j.useState(null),[o,l]=j.useState([]),[u,d]=j.useState(null),[f,p]=j.useState(!0),[y,T]=j.useState("story"),[S,A]=j.useState({title:"",description:"",chapters:[]}),[k,E]=j.useState({image:"/placeholder-map.png",description:""});j.useEffect(()=>{const w=gs(g=>{if(!g){e("/login");return}r(g),t&&_(g.uid,t)});return()=>w()},[e,t]);const _=async(w,g)=>{try{p(!0);const[x,b,P]=await Promise.all([Kx(w,g),Bm(g),Qx(g)]);i(x),l(b),d(P)}catch{}finally{p(!1)}},I=[{id:"story",label:"Story Planning"},{id:"ai-dm",label:" AI Dungeon Master"},{id:"map",label:"Campaign Map"},{id:"characters",label:"Party Characters"},{id:"enemies",label:"Enemies & NPCs"}],O=()=>{const w={id:Date.now(),title:"",description:"",objectives:[],completed:!1};A(g=>({...g,chapters:[...g.chapters,w]}))},D=(w,g,x)=>{A(b=>({...b,chapters:b.chapters.map(P=>P.id===w?{...P,[g]:x}:P)}))},L=w=>{const g={id:Date.now(),description:"",completed:!1};D(w,"objectives",[...S.chapters.find(x=>x.id===w).objectives,g])};return!n||f?c.jsx("div",{className:"fantasy-container py-8",children:c.jsx("div",{className:"fantasy-card",children:c.jsx("div",{className:"text-center py-8",children:c.jsx("p",{className:"text-stone-600",children:"Loading..."})})})}):s?c.jsx("div",{className:"fantasy-container py-8",children:c.jsxs("div",{className:"fantasy-card",children:[c.jsxs("div",{className:"flex justify-between items-center mb-6",children:[c.jsx("h1",{className:"fantasy-title mb-0",children:"Campaign Management"}),c.jsxs("div",{className:"text-sm text-stone-600",children:["Playing as: ",c.jsx("span",{className:"font-medium",children:s.name})]})]}),c.jsx("div",{className:"flex space-x-1 mb-6 bg-stone-100 p-1 rounded-lg",children:I.map(w=>c.jsx("button",{onClick:()=>T(w.id),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${y===w.id?"bg-amber-600 text-white":"text-stone-600 hover:text-stone-800"}`,children:w.label},w.id))}),y==="story"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Title"}),c.jsx("input",{type:"text",value:S.title,onChange:w=>A(g=>({...g,title:w.target.value})),className:"fantasy-input",placeholder:"Enter campaign title..."})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Description"}),c.jsx("textarea",{value:S.description,onChange:w=>A(g=>({...g,description:w.target.value})),className:"fantasy-input",rows:"4",placeholder:"Describe your campaign's main plot..."})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h3",{className:"text-xl font-bold text-stone-800",children:"Chapters"}),c.jsx("button",{onClick:O,className:"fantasy-button",children:"Add Chapter"})]}),c.jsx("div",{className:"space-y-4",children:S.chapters.map(w=>c.jsxs("div",{className:"fantasy-card bg-amber-50",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[c.jsx("input",{type:"text",value:w.title,onChange:g=>D(w.id,"title",g.target.value),className:"fantasy-input",placeholder:"Chapter title..."}),c.jsxs("div",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:w.completed,onChange:g=>D(w.id,"completed",g.target.checked),className:"mr-2"}),c.jsx("label",{className:"text-sm font-medium text-stone-700",children:"Completed"})]})]}),c.jsx("textarea",{value:w.description,onChange:g=>D(w.id,"description",g.target.value),className:"fantasy-input mb-4",rows:"3",placeholder:"Chapter description..."}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex justify-between items-center mb-2",children:[c.jsx("h4",{className:"font-medium text-stone-800",children:"Objectives"}),c.jsx("button",{onClick:()=>L(w.id),className:"fantasy-button text-sm",children:"Add Objective"})]}),c.jsx("div",{className:"space-y-2",children:w.objectives.map(g=>c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",checked:g.completed,onChange:x=>{const b=w.objectives.map(P=>P.id===g.id?{...P,completed:x.target.checked}:P);D(w.id,"objectives",b)}}),c.jsx("input",{type:"text",value:g.description,onChange:x=>{const b=w.objectives.map(P=>P.id===g.id?{...P,description:x.target.value}:P);D(w.id,"objectives",b)},className:"fantasy-input flex-1",placeholder:"Objective description..."})]},g.id))})]})]},w.id))})]})]}),y==="ai-dm"&&c.jsx(PR,{partyCharacters:o,partyInfo:u,onStoryGenerated:w=>{},onCharacterDetailsGenerated:(w,g)=>{}}),y==="map"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Campaign Map"}),c.jsxs("div",{className:"bg-stone-200 rounded-lg p-8 text-center",children:[c.jsx("div",{className:"w-full h-64 bg-stone-300 rounded-lg flex items-center justify-center mb-4",children:c.jsx("span",{className:"text-stone-500",children:"Map Placeholder"})}),c.jsx("button",{className:"fantasy-button",children:"Upload Map Image"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Map Description"}),c.jsx("textarea",{value:k.description,onChange:w=>E(g=>({...g,description:w.target.value})),className:"fantasy-input",rows:"4",placeholder:"Describe the locations and points of interest on your map..."})]})]}),y==="characters"&&c.jsxs("div",{children:[c.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Party Characters"}),o.length===0?c.jsx("div",{className:"text-center py-8 text-stone-600",children:c.jsx("p",{children:"No characters have been created yet."})}):c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:o.map(w=>c.jsx("div",{className:"fantasy-card bg-amber-50",children:c.jsxs("div",{className:"flex items-start space-x-4",children:[c.jsx("div",{className:"w-16 h-16 bg-stone-300 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-xs text-stone-600",children:"IMG"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h4",{className:"font-bold text-stone-800",children:w.name}),c.jsxs("p",{className:"text-sm text-stone-600",children:["Level ",w.level," ",w.race," ",w.class]}),c.jsxs("p",{className:"text-sm text-stone-600 mt-1",children:[w.background,"  ",w.alignment]})]})]})},w.id))})]}),y==="enemies"&&c.jsxs("div",{children:[c.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Enemies & NPCs"}),c.jsx("div",{className:"text-center py-8 text-stone-600",children:c.jsx("p",{children:"Enemy and NPC management will be available here."})})]})]})}):c.jsx("div",{className:"fantasy-container py-8",children:c.jsxs("div",{className:"fantasy-card",children:[c.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),c.jsxs("div",{className:"text-center py-8",children:[c.jsx("p",{className:"text-stone-600 mb-6",children:"You need to create a character before you can access the campaign."}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("button",{onClick:()=>e(`/character-creation/${t}`),className:"fantasy-button text-lg px-8 py-3",children:"Create Character"}),c.jsx("button",{onClick:()=>e("/party-management"),className:"fantasy-button text-lg px-8 py-3 bg-stone-600 hover:bg-stone-700",children:"Back to Parties"})]})]})]})})}function AR(){const{partyId:t}=tu(),e=Jn(),[n,r]=j.useState(null),[s,i]=j.useState(null),[o,l]=j.useState(!0),[u,d]=j.useState([]),[f,p]=j.useState(null),[y,T]=j.useState(null),[S,A]=j.useState(""),[k,E]=j.useState(""),[_,I]=j.useState([]),[O,D]=j.useState([]),[L,w]=j.useState([]),[g,x]=j.useState(!1),[b,P]=j.useState(""),[N,C]=j.useState(""),[fe,He]=j.useState(!1),[nt,Ue]=j.useState(!1),[q,ne]=j.useState(null),[re,Ee]=j.useState(-1),[pe]=j.useState(()=>new bu),[Se]=j.useState(()=>new Wm),[ht,Pe]=j.useState(!1),[ft,Ze]=j.useState(!1),[On,Bt]=j.useState(null),[G,ae]=j.useState(null),[le,je]=j.useState(null),[vt,Me]=j.useState(""),[wt,Qt]=j.useState(!1);j.useEffect(()=>{const U=gs(H=>{if(!H){e("/login");return}r(H)});return()=>U()},[e]),j.useEffect(()=>{n&&t&&Zn()},[n,t]),j.useEffect(()=>{if(t){const U=Xx(t,H=>{var ue;if(i(H),l(!1),H){F(H),D(H.environmentalFeatures||[]),w(H.teamUpOpportunities||[]),rn();const ke=(ue=H.combatants)==null?void 0:ue[H.currentTurn];ke&&ke.id.startsWith("enemy_")&&H.combatState==="active"&&H.currentTurn!==re&&!fe&&!g&&(console.log("Auto-processing enemy turn for:",ke.name,"turn:",H.currentTurn),Ee(H.currentTurn),setTimeout(()=>{ge()},1e3))}});return()=>U()}},[t,re,fe,g]);const Zn=async()=>{try{l(!0);const U=await Yx(t),H=t==="test-combat-party";if(!U){if(H)console.log("No test combat session found, redirecting to dashboard"),e("/dashboard");else{console.log("No combat session found, navigating to story with partyId:",t);try{e(`/campaign-story/${t}`)}catch(ue){console.error("Navigation error in loadCombatData:",ue),e("/dashboard")}}return}if(H)d(U.partyMembers||[]);else{const ue=await Bm(t);d(ue)}if(U.enemies&&U.enemies.length===0){i({...U,status:"no_enemies"});return}i(U),F(U),D(U.environmentalFeatures||[]),w(U.teamUpOpportunities||[])}catch(U){console.error("Error loading combat data:",U)}finally{l(!1)}},F=U=>{var Ae;const H=Y(U);if(!H)return;const ue=[],ke=H.cooldowns||{};Object.entries(sr.actionTypes).forEach(([Yt,ze])=>{(ke[Yt]===0||ke[Yt]===void 0)&&ue.push({type:Yt,name:ze.name,description:ze.description,priority:ze.priority,narrativeTemplate:ze.narrativeTemplate})});const Be=sr.classAbilities[(Ae=H.class)==null?void 0:Ae.toLowerCase()];Be&&(ke.special===0||ke.special===void 0)&&ue.push({type:"special",name:Be.name,description:Be.description,priority:"high",narrativeTemplate:"{character} uses their {ability}!"}),O.length>0&&ue.push({type:"environmental",name:"Use Environment",description:"Use the environment to your advantage",priority:"normal",narrativeTemplate:"{character} uses the {environment} to their advantage!"}),L.length>0&&ue.push({type:"teamUp",name:"Team Up",description:"Coordinate with another party member",priority:"high",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}),I(ue)},Q=async()=>{if(!s)return;const U=sr.initializeCombat(s.partyMembers,s.enemies,s.storyContext),H=U.combatants.filter(ke=>!ke.id.startsWith("enemy_")),ue=U.combatants.filter(ke=>ke.id.startsWith("enemy_"));await ri(s.id,{...U,partyMembers:H,enemies:ue,combatState:"active"})},R=async()=>{await $e()},$=async()=>{if(!s)return;const U=(s.currentTurn-1+s.combatants.length)%s.combatants.length;await ri(s.id,{currentTurn:U}),p(null),T(null),A(""),E("")},K=async()=>{if(!s)return;const U=t==="test-combat-party",H=sr.generateCombatSummary(s,"victory");if(await ri(s.id,{status:"ended",combatState:"ended",summary:H}),U)console.log("Ending test combat, navigating to dashboard"),e("/dashboard");else{await In(t,{status:"storytelling",currentCombat:null});try{console.log("Ending combat, navigating to story with partyId:",t),e(`/campaign-story/${t}`)}catch(ue){console.error("Navigation error in endCombat:",ue),e("/dashboard")}}},Y=(U=s)=>!(U!=null&&U.combatants)||U.currentTurn===void 0?null:U.combatants[U.currentTurn],oe=()=>{const U=Y();return U&&U.userId===(n==null?void 0:n.uid)},se=()=>u.find(U=>U.userId===(n==null?void 0:n.uid)),me=async(U,H,ue={})=>{if(!s||!U||!H||fe)return;const ke=se();if(ke)try{He(!0);const Be=await sr.executeAction(s,ke.id,U,H,ue);if(Be.success){const Ae=s.combatants.filter(Pt=>!Pt.id.startsWith("enemy_")),Yt=s.combatants.filter(Pt=>Pt.id.startsWith("enemy_"));if(await ri(s.id,{combatants:s.combatants,partyMembers:Ae,enemies:Yt}),i(Pt=>({...Pt,combatants:[...s.combatants],partyMembers:Ae,enemies:Yt})),A(Be.results.damage>0?`Dealt ${Be.results.damage} damage!`:Be.results.healing>0?`Healed ${Be.results.healing} HP!`:"Action completed!"),E(Be.narrative),Be.statusEffects.length>0){const Pt=Be.statusEffects.map(er=>`${er.type} applied to target!`).join(", ");A(er=>er+" "+Pt)}Be.environmentalImpact.length>0&&A(Pt=>Pt+" "+Be.environmentalImpact.join(", "));const ze=Yt.find(Pt=>Pt.id===H);ze&&ze.hp<=0&&A(Pt=>Pt+` ${ze.name} has been defeated!`),setTimeout(()=>{$e()},3e3)}else A(Be.message)}catch(Be){console.error("Error executing action:",Be),A("Failed to execute action")}finally{He(!1)}},ge=async()=>{if(!s||g||fe){console.log("Enemy turn blocked - already processing or enemy turn active");return}const U=Y();if(!U||!U.id.startsWith("enemy_")){console.log("Enemy turn blocked - not an enemy turn");return}if(re===s.currentTurn){console.log("Enemy turn blocked - already processed turn:",s.currentTurn);return}console.log("Starting enemy turn for:",U.name),x(!0),He(!0),Ee(s.currentTurn);try{P(`${U.name} is thinking...`),C(""),await new Promise(ue=>setTimeout(ue,1500));const H=await sr.executeEnemyTurn(s,U);if(H.success){const ue=s.combatants.filter(Ae=>!Ae.id.startsWith("enemy_")),ke=s.combatants.filter(Ae=>Ae.id.startsWith("enemy_"));if(await ri(s.id,{combatants:s.combatants,partyMembers:ue,enemies:ke}),i(Ae=>({...Ae,combatants:[...s.combatants],partyMembers:ue,enemies:ke})),P(H.results.damage>0?`${U.name} deals ${H.results.damage} damage!`:H.results.healing>0?`${U.name} heals ${H.results.healing} HP!`:`${U.name} takes action!`),C(H.narrative),H.statusEffects.length>0){const Ae=H.statusEffects.map(Yt=>`${Yt.type} applied!`).join(", ");P(Yt=>Yt+" "+Ae)}H.environmentalImpact.length>0&&P(Ae=>Ae+" "+H.environmentalImpact.join(", "));const Be=ue.find(Ae=>Ae.id===H.targetId);Be&&Be.hp<=0&&P(Ae=>Ae+` ${Be.name} has fallen!`),await new Promise(Ae=>setTimeout(Ae,2500)),await $e()}else P(H.message),await new Promise(ue=>setTimeout(ue,2e3)),await $e()}catch(H){console.error("Error processing enemy turn:",H),P("Enemy turn failed"),await new Promise(ue=>setTimeout(ue,2e3)),await $e()}finally{x(!1),He(!1),P(""),C("")}},$e=async()=>{if(!s||fe)return;const U=(s.currentTurn+1)%s.combatants.length,H=s.combatants[U];console.log("Advancing turn:",{currentTurn:s.currentTurn,newTurn:U,nextCombatant:H==null?void 0:H.name,isEnemy:H==null?void 0:H.id.startsWith("enemy_"),totalCombatants:s.combatants.length}),await ri(s.id,{currentTurn:U}),i(ke=>({...ke,currentTurn:U})),Ee(-1),p(null),T(null),A(""),E("");const ue=sr.checkCombatEnd(s);if(ue.ended){console.log("Combat ended:",ue),A(ue.narrative),setTimeout(()=>{K()},3e3);return}H&&H.id.startsWith("enemy_")?(console.log("Next turn is enemy turn, scheduling processEnemyTurn"),setTimeout(()=>{ge()},1e3)):console.log("Next turn is player turn")},rn=()=>{if(!s||!n)return;const U=s.partyMembers.find(H=>H.userId===n.uid)||s.combatants.find(H=>H.userId===n.uid&&!H.id.startsWith("enemy_"));U&&U.hp<=0&&(Ue(!0),ne(U))},sn=()=>{e(t==="test-combat-party"?"/dashboard":`/character-creation/${t}`)},Ir=async U=>{if(!U.trim())return;const H=se();if(!H)return;const ue=Se.validatePlayerAction(U,H,{context:"combat",combatSession:s});ae(ue),Ze(!0),je(U)},Ln=async()=>{if(!le)return;const U=se();if(!U)return;const H=pe.validateAction(le,U,{context:"combat"});Bt(H),Pe(!0),Ze(!1)},Vn=()=>{Ze(!1),Qt(!0)},za=()=>{Pe(!1),Bt(null),je(null)},no=()=>{Ze(!1),ae(null),je(null)},Tu=()=>{vt.trim()&&(Ir(vt),Me(""),Qt(!1))},Cu=(U,H=[])=>{const ue=se();return ue?pe.performSkillCheck(ue,U,H):null},ro=()=>pe.rollWithAdvantage(),Wa=()=>pe.rollWithDisadvantage(),Ha=U=>pe.rollDie(U),ys=(U,H)=>pe.rollDice(U,H);if(!n)return null;if(o)return c.jsx("div",{className:"fantasy-container py-8",children:c.jsx("div",{className:"fantasy-card",children:c.jsxs("div",{className:"text-center py-8",children:[c.jsx("div",{className:"text-stone-600 mb-4",children:" Setting up battle arena..."}),c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-stone-600 mx-auto"})]})})});if(!s)return c.jsx("div",{className:"fantasy-container py-8",children:c.jsx("div",{className:"fantasy-card",children:c.jsxs("div",{className:"text-center py-8",children:[c.jsx("div",{className:"text-stone-600",children:"No active combat session found."}),c.jsx("button",{onClick:async()=>{await In(t,{status:"storytelling",currentCombat:null});try{console.log("Returning to story from no combat session, partyId:",t),e(`/campaign-story/${t}`)}catch(U){console.error("Navigation error in return to story:",U),e("/dashboard")}},className:"fantasy-button mt-4",children:"Return to Story"})]})})});if(s.status==="no_enemies"||s.enemies&&s.enemies.length===0)return c.jsx("div",{className:"fantasy-container py-8",children:c.jsx("div",{className:"fantasy-card",children:c.jsxs("div",{className:"text-center py-8",children:[c.jsx("div",{className:"text-4xl mb-4",children:""}),c.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"No Enemies to Fight"}),c.jsx("p",{className:"text-stone-600 mb-6",children:"There are no enemies present in this area. Combat cannot begin."}),c.jsx("button",{onClick:async()=>{await In(t,{status:"storytelling",currentCombat:null});try{console.log("Returning to story from no enemies, partyId:",t),e(`/campaign-story/${t}`)}catch(U){console.error("Navigation error in return to story:",U),e("/dashboard")}},className:"fantasy-button",children:"Return to Story"})]})})});const Nr=Y();return nt&&q?c.jsx("div",{className:"fantasy-container py-8",children:c.jsx("div",{className:"fantasy-card bg-red-50 border-red-200",children:c.jsxs("div",{className:"text-center py-8",children:[c.jsx("div",{className:"text-6xl mb-4",children:""}),c.jsx("h1",{className:"text-3xl font-bold text-red-800 mb-4",children:"Character Death"}),c.jsxs("div",{className:"text-xl text-red-700 mb-6",children:[q.name," has fallen in battle..."]}),c.jsxs("div",{className:"bg-white p-6 rounded-lg border border-red-300 mb-6",children:[c.jsx("h2",{className:"text-lg font-semibold text-stone-800 mb-2",children:"Fallen Hero"}),c.jsxs("p",{className:"text-stone-600 mb-2",children:[c.jsx("strong",{children:"Name:"})," ",q.name]}),c.jsxs("p",{className:"text-stone-600 mb-2",children:[c.jsx("strong",{children:"Class:"})," ",q.class]}),c.jsxs("p",{className:"text-stone-600 mb-2",children:[c.jsx("strong",{children:"Level:"})," ",q.level]}),c.jsxs("p",{className:"text-stone-600",children:[c.jsx("strong",{children:"Final HP:"})," ",q.hp,"/",q.maxHp]})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsx("p",{className:"text-stone-600",children:"Your character has been defeated. You must create a new character to continue."}),c.jsx("button",{onClick:sn,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})}):c.jsxs("div",{className:"fantasy-container py-8",children:[c.jsxs("div",{className:"fantasy-card",children:[c.jsxs("div",{className:"flex justify-between items-center mb-6",children:[c.jsx("h1",{className:"fantasy-title mb-0",children:" Combat Arena"}),c.jsxs("div",{className:"flex space-x-2",children:[s.combatState==="preparation"&&c.jsx("button",{onClick:Q,className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"Start Combat"}),s.combatState==="active"&&c.jsxs("div",{className:"flex space-x-2",children:[c.jsx("button",{onClick:$,className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:" Previous"}),c.jsx("button",{onClick:R,className:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"Next "}),c.jsx("button",{onClick:K,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"End Combat"})]})]})]}),s.storyContext&&c.jsxs("div",{className:"mb-6 p-4 bg-stone-50 border border-stone-200 rounded-lg",children:[c.jsx("h3",{className:"font-bold text-stone-800 mb-2",children:"Story Context"}),c.jsx("p",{className:"text-stone-700 italic",children:s.storyContext}),c.jsx("button",{onClick:async()=>{await In(t,{status:"storytelling",currentCombat:null});try{console.log("Returning to story from combat header, partyId:",t),e(`/campaign-story/${t}`)}catch(U){console.error("Navigation error in return to story:",U),e("/dashboard")}},className:"text-sm text-stone-600 hover:text-stone-800 mt-2",children:" Return to Story"})]}),O.length>0&&c.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[c.jsx("h3",{className:"font-bold text-blue-800 mb-2",children:" Environmental Features"}),c.jsx("div",{className:"flex flex-wrap gap-2",children:O.map((U,H)=>c.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:U},H))})]}),s.combatState==="active"&&c.jsxs("div",{className:"mb-6",children:[c.jsx("h3",{className:"font-bold text-stone-800 mb-3",children:" Turn Order"}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:s.combatants.map((U,H)=>c.jsx("div",{className:`p-3 rounded-lg border-2 transition-colors ${H===s.currentTurn?"border-amber-500 bg-amber-50":"border-stone-200 bg-white"}`,children:c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"font-medium text-stone-800",children:[U.name,H===s.currentTurn&&c.jsx("span",{className:"ml-2 text-amber-600",children:" Current Turn"})]}),c.jsxs("div",{className:"text-sm text-stone-600",children:["HP: ",U.hp,"/",U.maxHp," | AC: ",U.ac]}),U.statusEffects&&U.statusEffects.length>0&&c.jsx("div",{className:"text-xs text-red-600 mt-1",children:U.statusEffects.map(ue=>ue.type).join(", ")})]}),c.jsxs("div",{className:"text-sm text-stone-500",children:["Initiative: ",U.initiative]})]})},U.id))})]}),s.combatState==="active"&&Nr&&c.jsxs("div",{className:"mb-6",children:[c.jsxs("h3",{className:"font-bold text-stone-800 mb-3",children:[" ",Nr.name,"'s Turn"]}),oe()?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"Available Actions:"}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:_.map((U,H)=>c.jsxs("button",{onClick:()=>p(U),className:`p-3 rounded-lg border-2 transition-colors text-left ${(f==null?void 0:f.type)===U.type?"border-amber-500 bg-amber-50":"border-stone-200 bg-white hover:border-stone-300"}`,children:[c.jsx("div",{className:"font-medium text-stone-800",children:U.name}),c.jsx("div",{className:"text-sm text-stone-600",children:U.description}),c.jsxs("div",{className:"text-xs text-stone-500 mt-1",children:["Priority: ",U.priority]})]},H))})]}),f&&c.jsxs("div",{children:[c.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"Select Target:"}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.enemies.map(U=>c.jsxs("button",{onClick:()=>T(U),className:`p-3 rounded-lg border-2 transition-colors ${(y==null?void 0:y.id)===U.id?"border-red-500 bg-red-50":"border-stone-200 bg-white hover:border-stone-300"}`,children:[c.jsx("div",{className:"font-medium text-stone-800",children:U.name}),c.jsxs("div",{className:"text-sm text-stone-600",children:["HP: ",U.hp,"/",U.maxHp," | AC: ",U.ac]})]},U.id))})]}),f&&y&&c.jsx("div",{className:"text-center",children:c.jsx("button",{onClick:()=>me(f.type,y.id),disabled:fe,className:"fantasy-button bg-amber-600 hover:bg-amber-700",children:fe?"Executing...":`Execute ${f.name}`})})]}):c.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[c.jsxs("h4",{className:"font-bold text-blue-800 mb-2",children:["Waiting for ",Nr.name," to act"]}),c.jsx("p",{className:"text-blue-700",children:Nr.userId===(n==null?void 0:n.uid)?"It's your turn! Please select an action.":"Please wait for the current player to make their move."})]})]}),S&&c.jsxs("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:[c.jsx("h4",{className:"font-bold text-green-800 mb-2",children:"Action Result"}),c.jsx("p",{className:"text-green-700",children:S}),k&&c.jsx("div",{className:"mt-2 p-3 bg-white border border-green-300 rounded",children:c.jsx("p",{className:"text-stone-700 italic",children:k})})]}),g&&c.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg animate-pulse",children:[c.jsx("h4",{className:"font-bold text-red-800 mb-2",children:" Enemy Turn"}),b&&c.jsx("div",{className:"text-red-700 font-medium mb-2",children:b}),N&&c.jsx("div",{className:"mt-2 p-3 bg-white border border-red-300 rounded",children:c.jsx("p",{className:"text-stone-700 italic",children:N})}),c.jsxs("div",{className:"mt-3 flex items-center justify-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-red-600"}),c.jsx("span",{className:"ml-2 text-red-600 text-sm",children:"Enemy is acting..."})]})]}),fe&&!g&&c.jsx("div",{className:"mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:c.jsxs("div",{className:"flex items-center justify-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-amber-600"}),c.jsx("span",{className:"ml-2 text-amber-600 font-medium",children:"Processing turn..."})]})}),L.length>0&&c.jsxs("div",{className:"mb-6 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[c.jsx("h3",{className:"font-bold text-purple-800 mb-2",children:" Team Up Opportunities"}),c.jsx("div",{className:"space-y-2",children:L.map((U,H)=>c.jsxs("div",{className:"text-purple-700",children:[c.jsxs("strong",{children:[U.classes.join(" + "),":"]})," ",U.description]},H))})]}),wt&&c.jsxs("div",{className:"mb-6 p-4 bg-indigo-50 border border-indigo-200 rounded-lg",children:[c.jsx("h3",{className:"font-bold text-indigo-800 mb-2",children:" Custom Action"}),c.jsx("p",{className:"text-indigo-700 mb-3",children:"Describe the action you want to perform. The system will validate it and determine if it's possible."}),c.jsxs("div",{className:"space-y-3",children:[c.jsx("textarea",{value:vt,onChange:U=>Me(U.target.value),placeholder:"e.g., I attempt to backflip over the enemy and strike from behind...",className:"w-full p-3 border border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",rows:"3"}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx("button",{onClick:Tu,className:"fantasy-button bg-indigo-600 hover:bg-indigo-700",children:"Validate Action"}),c.jsx("button",{onClick:()=>Qt(!1),className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Cancel"})]})]})]}),oe()&&c.jsxs("div",{className:"mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[c.jsx("h3",{className:"font-bold text-amber-800 mb-2",children:" Dice Tools"}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[c.jsx("button",{onClick:()=>{const U=ro();Bt(U),Pe(!0)},className:"p-2 bg-green-100 hover:bg-green-200 border border-green-300 rounded text-sm font-medium",children:"Roll with Advantage"}),c.jsx("button",{onClick:()=>{const U=Wa();Bt(U),Pe(!0)},className:"p-2 bg-red-100 hover:bg-red-200 border border-red-300 rounded text-sm font-medium",children:"Roll with Disadvantage"}),c.jsx("button",{onClick:()=>{const U=Ha(20);Bt({roll:U,totalRoll:U,actionType:"d20"}),Pe(!0)},className:"p-2 bg-blue-100 hover:bg-blue-200 border border-blue-300 rounded text-sm font-medium",children:"Roll d20"}),c.jsx("button",{onClick:()=>{const U=ys(2,6),H=U.reduce((ue,ke)=>ue+ke,0);Bt({rolls:U,totalRoll:H,actionType:"2d6"}),Pe(!0)},className:"p-2 bg-purple-100 hover:bg-purple-200 border border-purple-300 rounded text-sm font-medium",children:"Roll 2d6"})]}),c.jsxs("div",{className:"mt-3",children:[c.jsx("h4",{className:"font-semibold text-amber-700 mb-2",children:"Quick Skill Checks:"}),c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:["attack","dodge","climb","jump","persuade","intimidate"].map(U=>c.jsx("button",{onClick:()=>{const H=Cu(U);H&&(Bt(H),Pe(!0))},className:"p-2 bg-amber-100 hover:bg-amber-200 border border-amber-300 rounded text-xs font-medium capitalize",children:U},U))})]})]}),oe()&&c.jsx("div",{className:"mb-6 text-center",children:c.jsx("button",{onClick:()=>Qt(!0),className:"fantasy-button bg-indigo-600 hover:bg-indigo-700",children:" Describe Custom Action"})})]}),ht&&c.jsx(Zx,{diceResult:On,onClose:za}),ft&&c.jsx(eE,{validation:G,onClose:no,onProceed:Ln,onRevise:Vn})]})}const or={INVESTIGATION:"investigation",COMBAT:"combat",PERSUASION:"persuasion",EXPLORATION:"exploration",SOCIAL:"social"},Vt={HIDDEN:"hidden",DISCOVERED:"discovered",IN_PROGRESS:"in_progress",COMPLETED:"completed",FAILED:"failed"},uv=t=>{const e=[{id:"investigate_area",type:or.INVESTIGATION,title:"Investigate the Area",description:"Search for clues and gather information about the situation",keywords:["search","investigate","examine","look around","check","explore"],state:Vt.HIDDEN,discoveredAt:null,completedAt:null},{id:"resolve_conflict",type:or.COMBAT,title:"Resolve the Conflict",description:"Engage in combat to overcome the threat",keywords:["fight","attack","defend","combat","battle"],state:Vt.HIDDEN,discoveredAt:null,completedAt:null},{id:"negotiate_peace",type:or.PERSUASION,title:"Negotiate Peace",description:"Use diplomacy and persuasion to resolve the situation peacefully",keywords:["talk","negotiate","persuade","convince","diplomacy","peace"],state:Vt.HIDDEN,discoveredAt:null,completedAt:null}],n=[];return(t.toLowerCase().includes("thief")||t.toLowerCase().includes("stealth"))&&n.push({id:"stealth_approach",type:or.EXPLORATION,title:"Stealth Approach",description:"Use stealth to avoid detection and gather information",keywords:["sneak","stealth","hide","silent","unnoticed"],state:Vt.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("merchant")||t.toLowerCase().includes("trade"))&&n.push({id:"establish_trade",type:or.SOCIAL,title:"Establish Trade Relations",description:"Build economic relationships with the locals",keywords:["trade","bargain","deal","commerce","business"],state:Vt.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("scholar")||t.toLowerCase().includes("knowledge"))&&n.push({id:"gather_knowledge",type:or.INVESTIGATION,title:"Gather Ancient Knowledge",description:"Discover and preserve valuable information",keywords:["research","study","learn","knowledge","ancient","lore"],state:Vt.HIDDEN,discoveredAt:null,completedAt:null}),[...e,...n]},RR=(t,e)=>{const n=[];return e.forEach(r=>{if(r.state===Vt.HIDDEN){const s=t.toLowerCase();r.keywords.some(o=>s.includes(o.toLowerCase()))&&n.push({...r,state:Vt.DISCOVERED,discoveredAt:new Date})}}),n},jR=(t,e)=>t.filter(n=>n.state===e),DR=t=>t.filter(e=>e.state===Vt.DISCOVERED||e.state===Vt.IN_PROGRESS||e.state===Vt.COMPLETED),MR=(t,e)=>{const n=jR(t,Vt.HIDDEN),r=[];return n.forEach(s=>{const i=e.toLowerCase();s.type===or.INVESTIGATION&&(i.includes("mystery")||i.includes("unknown"))&&r.push("There might be more to discover here..."),s.type===or.PERSUASION&&(i.includes("tension")||i.includes("conflict"))&&r.push("Perhaps words could resolve this..."),s.type===or.COMBAT&&(i.includes("threat")||i.includes("danger"))&&r.push("The situation seems dangerous...")}),r},lt={SETUP:"setup",INTRODUCTION:"introduction",RISING_ACTION:"rising_action",CLIMAX:"climax",RESOLUTION:"resolution",COMPLETED:"completed"},OR=(t,e)=>{const n={importantNPCs:[],keyLocations:[],majorEvents:[],partyDecisions:[],currentSituation:null,activeThreats:[],availableResources:[]};if(t.slice(-10).forEach(s=>{if(s.role==="assistant"){const i=s.content.toLowerCase(),o=i.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:the\s+)?([a-z\s]+)/g);o&&o.forEach(d=>{n.importantNPCs.find(f=>f.name===d)||n.importantNPCs.push({name:d,firstMentioned:s.timestamp,role:"unknown"})}),["town","city","village","castle","temple","dungeon","forest","mountain"].forEach(d=>{if(i.includes(d)){const f=i.match(new RegExp(`([A-Z][a-z]+(?:s+[A-Z][a-z]+)*\\s+${d})`,"i"));f&&!n.keyLocations.find(p=>p.name===f[1])&&n.keyLocations.push({name:f[1],type:d,firstMentioned:s.timestamp})}}),["danger","threat","enemy","monster","evil","dark","cursed"].forEach(d=>{i.includes(d)&&n.activeThreats.push({type:d,mentioned:s.timestamp,description:i.substring(Math.max(0,i.indexOf(d)-50),i.indexOf(d)+50)})})}}),t.length>0){const s=t[t.length-1];s.role==="assistant"&&(n.currentSituation=s.content)}return n},LR=(t,e,n)=>{var i,o;t||(console.warn("Campaign metadata is undefined, using fallback values"),t={campaignPhase:lt.SETUP,mainGoal:null,activeObjectives:[],completedObjectives:[],importantNPCs:[],keyLocations:[],partyDecisions:[],storyContext:{currentSituation:null,worldState:{}},sessionNumber:1,campaignProgress:0}),t.storyContext||(t.storyContext={currentSituation:null,worldState:{}});const r={campaignPhase:t.campaignPhase||lt.SETUP,mainGoal:t.mainGoal||null,activeObjectives:t.activeObjectives||[],completedObjectives:t.completedObjectives||[],importantNPCs:t.importantNPCs||[],keyLocations:t.keyLocations||[],currentSituation:((i=t.storyContext)==null?void 0:i.currentSituation)||null,partyDecisions:t.partyDecisions||[],worldState:((o=t.storyContext)==null?void 0:o.worldState)||{},sessionNumber:t.sessionNumber||1,campaignProgress:t.campaignProgress||0},s=OR(e);return{...r,recentNPCs:s.importantNPCs,recentLocations:s.keyLocations,recentThreats:s.activeThreats,currentSituation:s.currentSituation||r.currentSituation}},VR=(t,e,n)=>{let r=0;const s={[lt.SETUP]:0,[lt.INTRODUCTION]:10,[lt.RISING_ACTION]:30,[lt.CLIMAX]:70,[lt.RESOLUTION]:90,[lt.COMPLETED]:100};r+=s[t.campaignPhase]||0;const o=n.filter(d=>d.state==="completed").length/Math.max(n.length,1)*30;r+=o;const l=e.length,u=Math.min(l/50*20,20);return r+=u,Math.min(Math.round(r),100)},FR=(t,e,n)=>{const r=e.length,s=n.filter(o=>o.state==="completed");let i=t.campaignPhase;return t.campaignPhase===lt.SETUP&&r>0?i=lt.INTRODUCTION:t.campaignPhase===lt.INTRODUCTION&&r>=5?i=lt.RISING_ACTION:t.campaignPhase===lt.RISING_ACTION&&(r>=15||s.length>=2)?i=lt.CLIMAX:t.campaignPhase===lt.CLIMAX&&(r>=25||s.length>=3)?i=lt.RESOLUTION:t.campaignPhase===lt.RESOLUTION&&(r>=30||s.length>=4)&&(i=lt.COMPLETED),i!==t.campaignPhase?i:null};class UR{constructor(){this.defaultState={currentLocation:{name:"",description:"",npcs:[],features:[],atmosphere:"",exits:[]},activeNPCs:{},activePlotThreads:[],characterArcs:{},worldState:{timeOfDay:"day",weather:"clear",recentEvents:[],factionRelations:{},discoveredLocations:[],completedObjectives:[]},storyMetadata:{sessionStartTime:null,totalMessages:0,currentPhase:"introduction",campaignMood:"neutral",tensionLevel:0}}}initializeStoryState(e,n,r=null){const s={...this.defaultState};return e.forEach(i=>{s.characterArcs[i.id]={relationships:{},discoveries:[],motivations:[i.ideals||"adventure"],characterGrowth:[],currentGoals:[],personalityTraits:i.personality?i.personality.split(",").map(o=>o.trim()):[],backstoryElements:i.backstory?this.extractBackstoryElements(i.backstory):[]}}),s.currentLocation=this.extractInitialLocation(n),r&&r.description&&(s.storyMetadata.campaignMood=this.determineMoodFromTheme(r.description)),s}extractStoryElements(e){const n={npcInteractions:[],plotAdvancement:null,locationChanges:null,newDiscoveries:[],characterDevelopment:{},worldStateUpdates:{}};return[/(\w+)\s+(?:becomes?|grows?|seems?)\s+(friendly|hostile|neutral|suspicious|trusting)/gi,/(\w+)\s+(?:reacts?|responds?)\s+(?:with|in)\s+(joy|anger|fear|surprise|curiosity)/gi,/(\w+)\s+(?:shows?|displays?)\s+(gratitude|distrust|interest|concern)/gi].forEach(o=>{[...e.matchAll(o)].forEach(u=>{n.npcInteractions.push({npc:u[1],newDisposition:u[2],context:u[0]})})}),[/(?:discovers?|finds?|learns?)\s+(?:that\s+)?(.+?)(?:\.|!)/gi,/(?:new\s+)?(?:clue|evidence|information)\s+(?:about|regarding)\s+(.+?)(?:\.|!)/gi,/(?:progress|advance)\s+(?:in|on)\s+(.+?)(?:\.|!)/gi].forEach(o=>{const l=[...e.matchAll(o)];l.length>0&&(n.plotAdvancement={discovery:l[0][1],progress:.1})}),[/(?:moves?|goes?|travels?)\s+(?:to|towards?)\s+(.+?)(?:\.|!)/gi,/(?:enters?|approaches?)\s+(.+?)(?:\.|!)/gi,/(?:arrives?|reaches?)\s+(?:at|in)\s+(.+?)(?:\.|!)/gi].forEach(o=>{const l=[...e.matchAll(o)];l.length>0&&(n.locationChanges={newLocation:l[0][1],transition:l[0][0]})}),n}updateStoryState(e,n,r,s){const i={...e},o=this.extractStoryElements(n);if(o.npcInteractions.length>0&&o.npcInteractions.forEach(l=>{i.activeNPCs[l.npc]||(i.activeNPCs[l.npc]={disposition:"neutral",knowledge:[],relationships:{},currentGoal:"",firstAppearance:new Date().toISOString()}),i.activeNPCs[l.npc].disposition=l.newDisposition,i.activeNPCs[l.npc].lastInteraction=new Date().toISOString()}),o.plotAdvancement){const l=i.activePlotThreads.find(u=>u.id===this.generateThreadId(o.plotAdvancement.discovery));l?(l.progress=Math.min(1,l.progress+o.plotAdvancement.progress),l.lastUpdated=new Date().toISOString()):i.activePlotThreads.push({id:this.generateThreadId(o.plotAdvancement.discovery),title:o.plotAdvancement.discovery,status:"active",progress:o.plotAdvancement.progress,discoveredAt:new Date().toISOString(),lastUpdated:new Date().toISOString(),involvedNPCs:[],clues:[]})}if(s&&i.characterArcs[s]){const l=i.characterArcs[s],u=this.extractCharacterDevelopment(r,n);u.relationships&&(l.relationships={...l.relationships,...u.relationships}),u.discoveries&&(l.discoveries=[...new Set([...l.discoveries,...u.discoveries])]),u.motivations&&(l.motivations=[...new Set([...l.motivations,...u.motivations])]),u.growth&&(l.characterGrowth=[...new Set([...l.characterGrowth,...u.growth])])}return o.locationChanges&&(i.currentLocation={...i.currentLocation,name:o.locationChanges.newLocation,description:this.generateLocationDescription(o.locationChanges.newLocation),lastUpdated:new Date().toISOString()}),i.worldState.recentEvents=[...i.worldState.recentEvents.slice(-4),{event:r.substring(0,100)+"...",timestamp:new Date().toISOString(),characterId:s}],i.storyMetadata.totalMessages+=1,i.storyMetadata.lastUpdated=new Date().toISOString(),i}extractCharacterDevelopment(e,n){const r={relationships:{},discoveries:[],motivations:[],growth:[]};return[/(?:trusts?|likes?|respects?)\s+(\w+)/gi,/(?:distrusts?|dislikes?|fears?)\s+(\w+)/gi,/(?:befriends?|allies?\s+with)\s+(\w+)/gi].forEach(l=>{[...e.matchAll(l)].forEach(d=>{const f=d[1],p=d[0].toLowerCase();p.includes("trust")||p.includes("like")||p.includes("respect")?r.relationships[f]="positive":p.includes("distrust")||p.includes("dislike")||p.includes("fear")?r.relationships[f]="negative":(p.includes("friend")||p.includes("ally"))&&(r.relationships[f]="allied")})}),[/(?:discovers?|finds?|learns?)\s+(.+?)(?:\.|!)/gi,/(?:realizes?|understands?)\s+(.+?)(?:\.|!)/gi].forEach(l=>{[...e.matchAll(l)].forEach(d=>{r.discoveries.push(d[1].trim())})}),[/(?:wants?|desires?|seeks?)\s+(?:to\s+)?(.+?)(?:\.|!)/gi,/(?:motivated\s+by|driven\s+by)\s+(.+?)(?:\.|!)/gi].forEach(l=>{[...e.matchAll(l)].forEach(d=>{r.motivations.push(d[1].trim())})}),r}generateContextPrompt(e,n,r,s){const i={currentLocation:e.currentLocation,activeNPCs:e.activeNPCs,activePlotThreads:e.activePlotThreads,characterArcs:e.characterArcs,worldState:e.worldState,storyMetadata:e.storyMetadata};return`
STORY STATE SUMMARY:
Current Location: ${i.currentLocation.name} - ${i.currentLocation.description}
Atmosphere: ${i.currentLocation.atmosphere}
Active NPCs: ${Object.keys(i.activeNPCs).join(", ")||"None"}
Active Plot Threads: ${i.activePlotThreads.map(l=>`${l.title} (${Math.round(l.progress*100)}%)`).join(", ")||"None"}
Recent Events: ${i.worldState.recentEvents.slice(-3).map(l=>l.event).join(", ")||"None"}

CHARACTER CONTEXT:
${n.map(l=>{const u=i.characterArcs[l.id]||{},d=Object.entries(u.relationships||{}).map(([p,y])=>`${p} (${y})`).join(", "),f=u.discoveries?u.discoveries.slice(-3).join(", "):"";return`${l.name}: Relationships: ${d||"None"}. Recent discoveries: ${f||"None"}`}).join(`
`)}

NPC RELATIONSHIPS:
${Object.entries(i.activeNPCs).map(([l,u])=>`${l}: ${u.disposition} disposition, ${u.knowledge.length} pieces of knowledge, goal: ${u.currentGoal||"unknown"}`).join(`
`)}

STORY HISTORY (Last 5 messages):
${r.slice(-5).map(l=>`${l.role}: ${l.content}`).join(`
`)}

PLAYER RESPONSE: "${s}"

CRITICAL CONSISTENCY RULES:
1. Maintain all established NPC relationships and dispositions
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

RESPONSE REQUIREMENTS:
- Acknowledge the player's action in context of the current situation and location
- Reference relevant NPCs and their established relationships with the party
- Continue or advance active plot threads appropriately
- Update character relationships based on the action
- Maintain location and atmosphere consistency
- End with a clear situation that invites the next player response
- Keep the story flowing naturally without jarring transitions
`}extractInitialLocation(e){const n=[/(?:in|at|near)\s+(.+?)(?:\.|,|!)/gi,/(?:town|city|village|castle|tower|dungeon|forest|mountain)\s+(?:of|in|near)\s+(.+?)(?:\.|,|!)/gi];for(const r of n){const s=[...e.matchAll(r)];if(s.length>0)return{name:s[0][1].trim(),description:"A location mentioned in the plot",npcs:[],features:[],atmosphere:"mysterious",exits:[]}}return{name:"Starting Location",description:"Where the adventure begins",npcs:[],features:[],atmosphere:"neutral",exits:[]}}extractBackstoryElements(e){const n=[];return[/(?:family|parents?|siblings?)\s+(.+?)(?:\.|,)/gi,/(?:trained|learned|studied)\s+(.+?)(?:\.|,)/gi,/(?:worked|served|lived)\s+(?:as|in)\s+(.+?)(?:\.|,)/gi].forEach(s=>{[...e.matchAll(s)].forEach(o=>{n.push(o[1].trim())})}),n}determineMoodFromTheme(e){const n=e.toLowerCase();return n.includes("dark")||n.includes("gothic")||n.includes("horror")?"dark":n.includes("light")||n.includes("happy")||n.includes("cheerful")?"light":n.includes("mysterious")||n.includes("enigmatic")?"mysterious":n.includes("epic")||n.includes("grand")?"epic":"neutral"}generateThreadId(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"_").substring(0,20)}generateLocationDescription(e){const n=["A place of mystery and adventure","An area with its own unique character","A location that holds many secrets","A place where stories unfold","An area rich with history and possibility"];return n[Math.floor(Math.random()*n.length)]}}const $R=new UR;function BR(){var Zn;const{partyId:t}=tu(),e=Jn(),r=Qi().pathname,[s,i]=j.useState(null),[o,l]=j.useState(null),[u,d]=j.useState(null),[f,p]=j.useState([]),[y,T]=j.useState([]),[S,A]=j.useState({}),[k,E]=j.useState(!0),[_,I]=j.useState(""),[O,D]=j.useState(""),[L,w]=j.useState(!1),[g,x]=j.useState(!1),[b,P]=j.useState(!1),N=j.useRef(!1),C=j.useRef(!1),[fe,He]=j.useState([]),[nt,Ue]=j.useState("Investigation"),[q,ne]=j.useState([]),[re,Ee]=j.useState(!1),[pe,Se]=j.useState(null);j.useEffect(()=>{const F=gs(Q=>{if(!Q){e("/login");return}i(Q)});return()=>F()},[e]),j.useEffect(()=>{s&&t&&ht()},[s,t]),j.useEffect(()=>{if(t)try{const F=Xx(t,Q=>{Q&&Q.status==="active"&&(r.includes("/combat/")||e(`/combat/${t}`))});return()=>F()}catch(F){console.error("Error subscribing to combat session:",F)}},[t,e,r]),j.useEffect(()=>{if(t)try{const F=Um(hn(yt(xe,"characters"),$t("partyId","==",t)),Q=>{const R=Q.docs.map($=>({id:$.id,...$.data()}));console.log("Characters updated in real-time:",R),p(R)},Q=>{console.error("Error subscribing to character updates:",Q)});return()=>F()}catch(F){console.error("Error setting up character subscription:",F)}},[t]),j.useEffect(()=>()=>{P(!1)},[]),j.useEffect(()=>{(o==null?void 0:o.status)==="ready_up"&&(C.current=!1,N.current=!1)},[o==null?void 0:o.status]),j.useEffect(()=>{var F;if(s&&f.length>0&&o){const Q=f.find($=>$.userId===s.uid),R=(F=o.readyPlayers)==null?void 0:F.includes(s.uid);Q&&!R&&o.status==="ready_up"&&Pe()}},[f,o,s]);const ht=async()=>{var F,Q;try{E(!0),console.log("Loading story and characters for partyId:",t);const[R,$,K]=await Promise.all([oR(t),Bm(t),Qx(t)]);if(console.log("Loaded characters:",$),console.log("Loaded story:",R),console.log("Loaded party:",K),p($),d(K),$.length===0&&s)try{const oe=(await zm(s.uid)).find(se=>se.id===t);if(oe){T(oe.members||[]),console.log("Loaded party members:",oe.members);const se={};for(const me of oe.members)try{const ge=await to(me);se[me]=ge}catch(ge){console.error("Error loading profile for member:",me,ge),se[me]=null}A(se)}}catch(Y){console.error("Error loading party members:",Y)}if(R){if(R.votingSession&&R.status==="voting"&&(await In(R.id,{votingSession:null}),R.votingSession=null),R.storyMessages){const Y=R.storyMessages.filter(oe=>{var se,me;return!((se=oe.content)!=null&&se.includes("tie"))&&!((me=oe.content)!=null&&me.includes("vote again"))&&oe.type!=="tie_break"});Y.length!==R.storyMessages.length&&(await In(R.id,{storyMessages:Y}),R.storyMessages=Y)}if(l(R),w(((F=R.readyPlayers)==null?void 0:F.includes(s==null?void 0:s.uid))||!1),R.status==="storytelling"&&K){const Y=uv(K.description||"");He(Y);const oe=((Q=R.storyMessages)==null?void 0:Q.length)||0;oe<5?Ue("Investigation"):oe<15?Ue("Conflict"):Ue("Resolution")}}else{const Y=await iR(t);l(Y)}}catch(R){console.error("Error in loadStoryAndCharacters:",R),I("Failed to load campaign story")}finally{E(!1)}};j.useEffect(()=>{if(o!=null&&o.id&&s){const F=lR(o.id,Q=>{var R,$,K;if(Q&&(l(Q),w(((R=Q.readyPlayers)==null?void 0:R.includes(s.uid))||!1),Q.status==="voting"&&(x(!1),C.current=!1),Q.status==="storytelling"&&u)){if(fe.length===0){const se=uv(u.description||"");He(se)}const Y=(($=Q.storyMessages)==null?void 0:$.length)||0;Y<5&&nt!=="Investigation"?Ue("Investigation"):Y>=5&&Y<15&&nt!=="Conflict"?Ue("Conflict"):Y>=15&&nt!=="Resolution"&&Ue("Resolution");const oe=(K=Q.storyMessages)==null?void 0:K[Q.storyMessages.length-1];if(oe&&oe.role==="assistant"){const se=MR(fe,oe.content);ne(se)}}});return()=>F()}},[o==null?void 0:o.id,s==null?void 0:s.uid,u,fe,nt]);const Pe=async()=>{if(!s)return;if(!f.find(Q=>Q.userId===s.uid)){e(`/character-creation/${t}`);return}try{await aR(o.id,s.uid),w(!0)}catch{I("Failed to ready up")}},ft=async()=>{var Q;if(N.current||C.current||(o==null?void 0:o.status)==="voting"||(o==null?void 0:o.status)==="storytelling"){console.log("Plot generation already in progress or completed");return}const F=(Q=o==null?void 0:o.storyMessages)==null?void 0:Q.filter(R=>R.type==="plot_selection");if(F&&F.length>0){console.log("Plots already exist, skipping generation"),(o==null?void 0:o.status)==="ready_up"&&await In(o.id,{status:"voting",votingSession:null});return}if(k){console.log("Already loading, skipping request");return}try{if(N.current=!0,C.current=!0,x(!0),E(!0),(o==null?void 0:o.status)!=="ready_up"){console.log("Story is no longer in ready_up status");return}const $=`Generate 3 distinct campaign plot options for this party. For each plot, provide a compelling title and a brief summary (2-3 sentences). Format as:

Plot 1: [Title]
[Summary]

Plot 2: [Title]  
[Summary]

Plot 3: [Title]
[Summary]

Party: ${f.map(Y=>`${Y.name} - Level ${Y.level} ${Y.race} ${Y.class}. ${Y.personality||""}. ${Y.backstory||""}`).join(`
`)}`,K=await zn.generatePlotOptions(f,u);await bd(o.id,{role:"assistant",content:K,type:"plot_selection"}),await In(o.id,{status:"voting",votingSession:null})}catch(R){I("Failed to start story generation"),console.error(R)}finally{N.current=!1,x(!1),E(!1)}},Ze=async F=>{if(!(!s||!u)){if(u.dmId!==s.uid){I("Only the campaign creator can select the plot");return}if((o==null?void 0:o.status)==="storytelling"){console.log("Plot already selected, story in progress");return}try{E(!0);const Q=o.storyMessages.find(K=>K.type==="plot_selection"),R=await zn.generateCampaignGoal(f,(Q==null?void 0:Q.content)||"",u);await In(o.id,{status:"storytelling",currentPlot:F,votingSession:null,campaignMetadata:{...o.campaignMetadata,mainGoal:R,campaignPhase:lt.INTRODUCTION,plotDetails:(Q==null?void 0:Q.content)||""}}),await bd(o.id,{role:"assistant",content:`The Dungeon Master has chosen Plot ${F}! Let the story begin...`,type:"plot_selected"});const $=await zn.generateStoryIntroduction(f,(Q==null?void 0:Q.content)||"",F,u);await bd(o.id,{role:"assistant",content:$,type:"story_introduction"}),await Td(o.id,u.dmId)}catch(Q){I("Failed to select plot"),console.error(Q)}finally{E(!1)}}},On=async()=>{var F,Q,R;if(!(!O.trim()||!s||!o))try{E(!0);const $=pe||await hR(o.id),K=await addStoryMessageWithMetadata(o.id,{role:"user",content:O,userId:s.uid,characterName:((F=f.find(ge=>ge.userId===s.uid))==null?void 0:F.name)||"Unknown"},$),Y=RR(O,fe);Y.length>0&&He(ge=>{const $e=[...ge];return Y.forEach(rn=>{const sn=$e.findIndex(Ir=>Ir.id===rn.id);sn!==-1&&($e[sn]=rn)}),$e});let oe;o.campaignMetadata&&o.campaignMetadata.mainGoal?oe=await zn.generateCampaignContinuation(f,o.campaignMetadata,o.storyMessages,O,u):oe=await zn.generateStoryContinuation(f,o.storyMessages,O,$,"individual",u);const se=$R.updateStoryState($,oe,O,(Q=f.find(ge=>ge.userId===s.uid))==null?void 0:Q.id);if(await fR(o.id,se),Se(se),await addStoryMessageWithMetadata(o.id,{role:"assistant",content:oe,type:"story_continuation"},se),o.campaignMetadata){const ge=LR(o.campaignMetadata,o.storyMessages,f),$e=VR(o.campaignMetadata,o.storyMessages,fe),rn=FR(o.campaignMetadata,o.storyMessages,fe),sn={"campaignMetadata.storyContext":{...o.campaignMetadata.storyContext,...ge},"campaignMetadata.campaignProgress":$e};rn&&(sn["campaignMetadata.campaignPhase"]=rn),await In(o.id,sn)}else console.warn("No campaign metadata found, skipping campaign updates");if(D(""),Bt(oe,se,O).shouldInitiate){P(!0);const ge={storyContext:oe,partyMembers:f,enemies:G(oe,f.length),environmentalFeatures:((R=se.currentLocation)==null?void 0:R.features)||[],teamUpOpportunities:sr.identifyTeamUpOpportunities(f),narrativeElements:sr.extractNarrativeElements(oe)},$e=await createEnhancedCombatSession(t,ge);await In(o.id,{status:"paused",currentCombat:$e.id}),setTimeout(()=>{e(`/combat/${t}`)},2e3)}}catch($){I("Failed to send response"),console.error($)}finally{E(!1)}},Bt=(F,Q,R)=>{var ge,$e,rn,sn,Ir,Ln;const $=["combat","battle","fight","attack","enemy","monster"],K=["tension","threat","danger","hostile","aggressive"],Y=$.some(Vn=>F.toLowerCase().includes(Vn)),oe=K.some(Vn=>F.toLowerCase().includes(Vn)),se=(($e=(ge=Q==null?void 0:Q.currentLocation)==null?void 0:ge.atmosphere)==null?void 0:$e.includes("dangerous"))||((sn=(rn=Q==null?void 0:Q.currentLocation)==null?void 0:rn.atmosphere)==null?void 0:sn.includes("hostile"))||((Ln=(Ir=Q==null?void 0:Q.currentLocation)==null?void 0:Ir.atmosphere)==null?void 0:Ln.includes("threatening")),me=$.some(Vn=>R.toLowerCase().includes(Vn));return{shouldInitiate:Y||oe&&se||me,reason:Y?"explicit_combat":oe&&se?"escalating_tension":me?"player_intent":"none"}},G=(F,Q)=>{const R={goblin:{name:"Goblin",hp:12,ac:14,level:1,charisma:8},orc:{name:"Orc",hp:30,ac:16,level:3,charisma:12},troll:{name:"Troll",hp:84,ac:15,level:5,charisma:7},dragon:{name:"Dragon",hp:200,ac:19,level:10,charisma:19},bandit:{name:"Bandit",hp:16,ac:12,level:1,charisma:10},skeleton:{name:"Skeleton",hp:13,ac:13,level:1,charisma:5},zombie:{name:"Zombie",hp:22,ac:8,level:1,charisma:3}},$=F.toLowerCase();let K="bandit";$.includes("goblin")?K="goblin":$.includes("orc")?K="orcs":$.includes("troll")?K="troll":$.includes("dragon")?K="dragon":$.includes("undead")||$.includes("skeleton")?K="skeleton":$.includes("zombie")&&(K="zombie");const Y=R[K],oe=Math.min(Q+1,6),se=[];for(let me=0;me<oe;me++)se.push({id:`enemy_${me}`,name:`${Y.name} ${me+1}`,type:Y.name,hp:Y.hp+Math.floor(Math.random()*10),maxHp:Y.hp+Math.floor(Math.random()*10),ac:Y.ac+Math.floor(Math.random()*3),initiative:Math.floor(Math.random()*20)+1,charisma:Y.charisma,portrait:"/placeholder-enemy.png"});return se},ae=F=>{if(!F)return F;const Q=["enemy","enemies","monster","monsters","bandit","bandits","goblin","goblins","orc","orcs","dragon","dragons","troll","trolls","zombie","zombies","skeleton","skeletons","assassin","assassins","guard","guards","soldier","soldiers","thief","thieves","brigand","brigands","raider","raiders","cultist","cultists","demon","demons","devil","devils","ghost","ghosts","specter","specters","wraith","wraiths","hobgoblin","hobgoblins","bugbear","bugbears","kobold","kobolds","ogre","ogres","giant","giants","beholder","beholders","lich","liches","vampire","vampires","werewolf","werewolves","hag","hags","witch","witches","necromancer","necromancers"],R=["search","investigate","examine","look around","check","explore","clue","clues","evidence","footprint","footprints","track","tracks","marking","markings","sign","signs","trace","traces","remains","ruin","ruins","artifact","artifacts","scroll","scrolls","book","books","map","maps","diary","journal","note","notes","door","doors","passage","passages","tunnel","tunnels","chamber","chambers","room","rooms","area","areas","mystery","mysterious","hidden","secret","secrets","concealed","strange","unusual","curious","suspicious","odd","peculiar","trap","traps","pressure plate","pressure plates","lever","levers","button","buttons","switch","switches","key","keys","lock","locks"],$=["tavern","inn","shop","market","temple","castle","fortress","tower","dungeon","cave","forest","mountain","river","bridge","gate","wall","street","alley","square","plaza","district","village","town","city","settlement","outpost","camp","crypt","tomb","grave","cemetery","shrine","altar","library","archive","guild","hall","mansion","palace","basement","cellar","attic","rooftop","balcony","courtyard","garden","park","field","meadow","swamp","desert","island"],K=["attack","fight","battle","combat","defend","strike","sword","swords","axe","axes","bow","bows","arrow","arrows","spell","spells","magic","magical","cast","casting","initiative","turn","round","action","movement","charge","retreat","advance","position","formation","shield","armor","helmet","dagger","daggers","mace","maces","fireball","lightning","heal","healing","cure","bless","curse"];let Y=F;return[...Q,...R,...$,...K].forEach(se=>{const me=new RegExp(`\\b${se}\\b`,"gi");Y=Y.replace(me,`<strong>${se}</strong>`)}),Y},le=()=>{var F;return((F=o==null?void 0:o.readyPlayers)==null?void 0:F.length)||0},je=()=>u&&u.members&&Array.isArray(u.members)?u.members.length:f.length>0?f.length:y.length>0?y.length:1,vt=le()===je(),Me=()=>{const F=o.storyMessages.filter(Q=>Q.type==="plot_selection");if(F.length>0){const R=F[F.length-1].content.split(`
`),$=[];let K=null;const Y=new Set;return R.forEach(oe=>{var me;const se=oe.trim();if(se.startsWith("Plot 1:")||se.startsWith("Plot 2:")||se.startsWith("Plot 3:")){K&&!Y.has(K.title)&&($.push(K),Y.add(K.title));const ge=(me=se.match(/Plot (\d+):/))==null?void 0:me[1],$e=se.replace(/Plot \d+:\s*/,"").trim();Y.has($e)?K=null:K={number:parseInt(ge),title:$e,summary:""}}else K&&se&&!se.startsWith("Party:")&&!se.startsWith("CRITICAL")&&!se.startsWith("Make each")&&(K.summary+=(K.summary?" ":"")+se)}),K&&!Y.has(K.title)&&$.push(K),$.slice(0,3)}return[{number:1,title:"Plot 1",summary:"No plot data available"},{number:2,title:"Plot 2",summary:"No plot data available"},{number:3,title:"Plot 3",summary:"No plot data available"}]},wt=()=>!f.length||!s?f:[...f].sort((F,Q)=>F.userId===s.uid?-1:Q.userId===s.uid?1:0),Qt=()=>{if(!(o!=null&&o.campaignMetadata))return null;const F=o.campaignMetadata;return c.jsxs("div",{className:"bg-purple-100 border border-purple-200 rounded-lg p-4 mb-6",children:[c.jsx("h3",{className:"font-bold text-purple-800 mb-2",children:" Campaign Progress"}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"font-semibold",children:"Session:"})," ",F.sessionNumber]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-semibold",children:"Phase:"})," ",F.campaignPhase.replace("_"," ")]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-semibold",children:"Progress:"})," ",F.campaignProgress,"%"]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-semibold",children:"Goal:"})," ",F.mainGoal?"Set":"Pending"]})]}),F.mainGoal&&c.jsxs("div",{className:"mt-2 text-purple-700",children:[c.jsx("span",{className:"font-semibold",children:"Main Goal:"})," ",F.mainGoal]})]})};return s?k?c.jsx("div",{className:"fantasy-container py-8",children:c.jsx("div",{className:"fantasy-card",children:c.jsx("div",{className:"text-center py-8",children:c.jsx("div",{className:"text-stone-600",children:"Loading campaign story..."})})})}):c.jsx("div",{className:"fantasy-container py-8",children:c.jsxs("div",{className:"fantasy-card",children:[c.jsxs("div",{className:"flex justify-between items-center mb-6",children:[c.jsx("h1",{className:"fantasy-title mb-0",children:"Campaign Story"}),c.jsx("button",{onClick:()=>e("/dashboard"),className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Back to Dashboard"})]}),_&&c.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:_}),b&&c.jsx("div",{className:"bg-orange-100 border border-orange-400 text-orange-700 px-4 py-3 rounded-lg mb-6",children:c.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-orange-600"}),c.jsx("span",{className:"font-semibold",children:" Combat is being initiated! Redirecting to battle arena..."})]})}),(o==null?void 0:o.status)==="paused"&&(o==null?void 0:o.currentCombat)&&c.jsx("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded-lg mb-6",children:c.jsx("div",{className:"flex items-center justify-center space-x-2",children:c.jsx("span",{className:"font-semibold",children:" Story is paused for combat. Please wait for the battle to conclude."})})}),(o==null?void 0:o.status)==="ready_up"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"text-center",children:[c.jsx("h2",{className:"text-xl font-bold text-stone-800 mb-4",children:"Ready Up"}),c.jsx("p",{className:"text-stone-600 mb-4",children:"All players must ready up before the story begins"}),c.jsxs("div",{className:"mb-6",children:[c.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-2",children:[c.jsxs("div",{className:"text-lg font-semibold text-amber-700",children:[le(),"/",je()," Players Ready"]}),c.jsxs("div",{className:"text-sm text-stone-500",children:["(",Math.round(le()/je()*100),"%)"]})]}),c.jsx("div",{className:"w-full bg-stone-200 rounded-full h-2 max-w-md mx-auto",children:c.jsx("div",{className:"bg-amber-600 h-2 rounded-full transition-all duration-300",style:{width:`${le()/je()*100}%`}})})]}),f.length===0&&c.jsx("div",{className:"bg-blue-100 border border-blue-200 rounded-lg p-4 mb-4",children:c.jsxs("p",{className:"text-blue-800",children:[c.jsx("strong",{children:"No characters created yet!"})," Players should create their characters first. You can still ready up and start the story, but characters will need to be created before the adventure begins."]})})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.length>0?wt().map(F=>{var $;const Q=($=o.readyPlayers)==null?void 0:$.includes(F.userId),R=F.userId===(s==null?void 0:s.uid);return c.jsx("div",{className:`fantasy-card transition-all duration-200 ${Q?"bg-green-50 border-green-200":"bg-amber-50"}`,children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-16 h-16 bg-stone-300 rounded-full mx-auto mb-2 flex items-center justify-center",children:c.jsx("span",{className:"text-xs text-stone-600",children:"IMG"})}),c.jsx("h3",{className:"font-bold text-stone-800",children:F.name}),c.jsxs("p",{className:"text-sm text-stone-600",children:["Level ",F.level," ",F.race," ",F.class]}),R&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-blue-600 text-xs font-medium",children:"(You)"}),c.jsx("div",{className:"mt-2",children:c.jsx("button",{className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 text-xs px-3 py-1 mt-2",onClick:()=>e(`/character-creation/${t}`),children:"Edit Character"})})]}),c.jsx("div",{className:"mt-2",children:Q?c.jsxs("div",{className:"flex items-center justify-center space-x-1 text-green-600 font-semibold",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Ready"})]}):c.jsxs("div",{className:"flex items-center justify-center space-x-1 text-stone-500",children:[c.jsx("div",{className:"w-3 h-3 border-2 border-stone-300 border-t-stone-600 rounded-full animate-spin"}),c.jsx("span",{children:"Waiting..."})]})})]})},F.id)}):y.map((F,Q)=>{var oe;const R=S[F],$=(R==null?void 0:R.username)||`Player ${Q+1}`,K=(oe=o.readyPlayers)==null?void 0:oe.includes(F),Y=F===(s==null?void 0:s.uid);return c.jsx("div",{className:`fantasy-card transition-all duration-200 ${K?"bg-green-50 border-green-200":"bg-amber-50"}`,children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-16 h-16 bg-stone-300 rounded-full mx-auto mb-2 flex items-center justify-center",children:c.jsx("span",{className:"text-xs text-stone-600",children:"IMG"})}),c.jsx("h3",{className:"font-bold text-stone-800",children:$}),c.jsx("p",{className:"text-sm text-stone-600",children:"No character created yet"}),Y&&c.jsx("span",{className:"text-blue-600 text-xs font-medium",children:"(You)"}),c.jsx("div",{className:"mt-2",children:K?c.jsxs("div",{className:"flex items-center justify-center space-x-1 text-green-600 font-semibold",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Ready"})]}):c.jsxs("div",{className:"flex items-center justify-center space-x-1 text-stone-500",children:[c.jsx("div",{className:"w-3 h-3 border-2 border-stone-300 border-t-stone-600 rounded-full animate-spin"}),c.jsx("span",{children:"Waiting..."})]})})]})},F)})}),c.jsxs("div",{className:"text-center",children:[L?c.jsx("div",{className:"text-green-600 font-semibold",children:"You are ready!"}):c.jsx("button",{onClick:Pe,className:"fantasy-button",children:f.find(F=>F.userId===(s==null?void 0:s.uid))?"Ready Up":"Create Character & Ready Up"}),vt&&c.jsx("button",{onClick:ft,disabled:k||g||(o==null?void 0:o.status)==="voting",className:"fantasy-button bg-amber-700 hover:bg-amber-800 ml-4",children:k||g?"Generating Story...":"Start Story Generation"})]})]}),(o==null?void 0:o.status)==="voting"&&c.jsxs("div",{className:"space-y-6",children:[c.jsx("h2",{className:"text-xl font-bold text-stone-800",children:"Choose Your Adventure"}),u&&u.dmId===(s==null?void 0:s.uid)?c.jsx("div",{className:"space-y-4",children:c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Me().map(F=>c.jsxs("div",{className:"fantasy-card bg-amber-50",children:[c.jsx("h3",{className:"font-bold text-stone-800 mb-2 text-lg",children:F.title}),c.jsx("p",{className:"text-stone-600 text-sm mb-4",children:F.summary}),c.jsx("button",{onClick:()=>Ze(F.number),disabled:k,className:"fantasy-button w-full bg-amber-600 hover:bg-amber-700",children:k?"Selecting...":`Choose Plot ${F.number}`})]},F.number))})}):c.jsxs("div",{className:"bg-blue-100 border border-blue-200 rounded-lg p-4",children:[c.jsx("h3",{className:"font-bold text-blue-800 mb-2",children:" Waiting for Dungeon Master"}),c.jsx("p",{className:"text-blue-700",children:"The campaign creator is choosing which plot to pursue. Please wait while they make their decision."}),c.jsx("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:Me().map(F=>c.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-3",children:[c.jsx("h4",{className:"font-bold text-stone-800 mb-2",children:F.title}),c.jsx("p",{className:"text-stone-600 text-sm",children:F.summary})]},F.number))})]})]}),((o==null?void 0:o.status)==="storytelling"||(o==null?void 0:o.status)==="paused")&&c.jsxs("div",{className:"space-y-6",children:[c.jsx("h2",{className:"text-xl font-bold text-stone-800",children:"Your Adventure"}),(u==null?void 0:u.dmId)===(s==null?void 0:s.uid)&&c.jsxs("div",{className:"bg-purple-100 border border-purple-200 rounded-lg p-4",children:[c.jsxs("h3",{className:"font-bold text-purple-800 mb-2",children:[" Story Phase: ",nt]}),c.jsxs("p",{className:"text-purple-700 text-sm",children:[nt==="Investigation"&&"Explore, discover clues, and gather information about the situation.",nt==="Conflict"&&"Face challenges, threats, and make difficult choices.",nt==="Resolution"&&"Conclude the story arc and see the consequences of your actions."]})]}),(u==null?void 0:u.dmId)===(s==null?void 0:s.uid)&&fe.length>0&&c.jsxs("div",{className:"bg-emerald-100 border border-emerald-200 rounded-lg p-4",children:[c.jsx("h3",{className:"font-bold text-emerald-800 mb-3",children:" Discovered Objectives"}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:DR(fe).map(F=>c.jsxs("div",{className:"bg-white border border-emerald-300 rounded-lg p-3",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("h4",{className:"font-semibold text-emerald-800 text-sm",children:F.title}),c.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${F.state===Vt.COMPLETED?"bg-green-100 text-green-800":F.state===Vt.IN_PROGRESS?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:F.state===Vt.COMPLETED?" Complete":F.state===Vt.IN_PROGRESS?" In Progress":" Discovered"})]}),c.jsx("p",{className:"text-emerald-700 text-xs",children:F.description})]},F.id))}),q.length>0&&c.jsxs("div",{className:"mt-4 pt-4 border-t border-emerald-300",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("h4",{className:"font-semibold text-emerald-800 text-sm",children:" Subtle Hints"}),c.jsxs("button",{onClick:()=>Ee(!re),className:"text-emerald-600 hover:text-emerald-800 text-xs",children:[re?"Hide":"Show"," Hints"]})]}),re&&c.jsx("div",{className:"space-y-2",children:q.map((F,Q)=>c.jsx("div",{className:"text-emerald-700 text-xs italic",children:F},Q))})]})]}),c.jsxs("div",{className:"bg-blue-100 border border-blue-200 rounded-lg p-4",children:[c.jsx("h3",{className:"font-bold text-blue-800 mb-2",children:" Storytelling Guidelines"}),c.jsxs("p",{className:"text-blue-700 text-sm",children:[c.jsx("strong",{children:"Turn-taking:"})," Respond to the story or let someone else speak. Only one person can respond at a time."]})]}),c.jsx("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4 max-h-96 overflow-y-auto",children:o.storyMessages.filter(F=>F.type!=="plot_selection").map(F=>c.jsx("div",{className:"mb-4",children:F.role==="assistant"?c.jsxs("div",{className:"bg-blue-100 border border-blue-200 rounded-lg p-3",children:[c.jsx("div",{className:"font-semibold text-blue-800 mb-1",children:"Game Master"}),c.jsx("div",{className:"text-blue-900 whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:ae(F.content)}})]}):c.jsxs("div",{className:"bg-green-100 border border-green-200 rounded-lg p-3",children:[c.jsx("div",{className:"font-semibold text-green-800 mb-1",children:F.playerName}),c.jsx("div",{className:"text-green-900",dangerouslySetInnerHTML:{__html:ae(F.content)}})]})},F.id))}),(o==null?void 0:o.status)==="storytelling"&&(o!=null&&o.currentSpeaker)?c.jsxs("div",{className:"space-y-4",children:[o.currentSpeaker.userId===(s==null?void 0:s.uid)?c.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[c.jsx("h3",{className:"font-bold text-amber-800 mb-3",children:"How will you respond?"}),c.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[c.jsx("div",{className:"w-10 h-10 bg-amber-200 rounded-full flex items-center justify-center",children:c.jsx("span",{className:"text-amber-800 font-bold",children:o.currentSpeaker.name.charAt(0)})}),c.jsxs("div",{children:[c.jsx("div",{className:"font-medium text-amber-800",children:o.currentSpeaker.name}),c.jsxs("div",{className:"text-sm text-amber-700",children:[o.currentSpeaker.race," ",o.currentSpeaker.class]})]})]}),c.jsxs("div",{className:"flex space-x-2",children:[c.jsx("input",{type:"text",value:O,onChange:F=>D(F.target.value),placeholder:`What does ${o.currentSpeaker.name} do?`,className:"fantasy-input flex-1",onKeyPress:F=>F.key==="Enter"&&On()}),c.jsx("button",{onClick:On,disabled:!O.trim(),className:"fantasy-button",children:"Send"})]})]}):c.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[c.jsxs("h3",{className:"font-bold text-blue-800 mb-3",children:["Waiting for ",o.currentSpeaker.name," to respond"]}),c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("div",{className:"w-10 h-10 bg-blue-200 rounded-full flex items-center justify-center",children:c.jsx("span",{className:"text-blue-800 font-bold",children:o.currentSpeaker.name.charAt(0)})}),c.jsxs("div",{children:[c.jsx("div",{className:"font-medium text-blue-800",children:o.currentSpeaker.name}),c.jsxs("div",{className:"text-sm text-blue-700",children:[o.currentSpeaker.race," ",o.currentSpeaker.class]})]})]}),c.jsxs("p",{className:"text-blue-700 mt-2",children:[o.currentSpeaker.name," is currently speaking. Please wait for their response."]})]}),(((Zn=o==null?void 0:o.currentSpeaker)==null?void 0:Zn.userId)===(s==null?void 0:s.uid)||(o==null?void 0:o.currentController)===(s==null?void 0:s.uid))&&c.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:[c.jsx("h4",{className:"font-bold text-stone-800 mb-3 text-center",children:"Let someone else speak"}),c.jsx("div",{className:"flex justify-center",children:c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-4xl",children:wt().map(F=>{var R,$;const Q=F.userId===(s==null?void 0:s.uid);return c.jsxs("button",{onClick:async()=>{await cv(o.id,F),await Td(o.id,F.userId)},disabled:F.id===((R=o==null?void 0:o.currentSpeaker)==null?void 0:R.id),className:`p-4 rounded-lg border-2 transition-colors text-center ${F.id===(($=o==null?void 0:o.currentSpeaker)==null?void 0:$.id)?"border-stone-300 bg-stone-100 text-stone-500 cursor-not-allowed":"border-stone-200 bg-white hover:border-stone-300 text-stone-700"}`,children:[c.jsxs("div",{className:"font-medium mb-1",children:[c.jsx("span",{children:F.name}),Q&&c.jsx("span",{className:"text-blue-600 text-xs font-medium ml-1",children:"(you)"})]}),c.jsxs("div",{className:"text-sm opacity-75",children:[F.race," ",F.class]})]},F.id)})})})]})]}):(u==null?void 0:u.dmId)===(s==null?void 0:s.uid)||(o==null?void 0:o.currentController)===(s==null?void 0:s.uid)?c.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:[c.jsx("h3",{className:"font-bold text-stone-800 mb-3 text-center",children:"Choose who speaks"}),c.jsx("div",{className:"flex justify-center",children:c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-4xl",children:wt().map(F=>{const Q=F.userId===(s==null?void 0:s.uid);return c.jsxs("button",{onClick:async()=>{await cv(o.id,F),await Td(o.id,F.userId)},className:"p-4 rounded-lg border-2 border-stone-200 bg-white hover:border-stone-300 text-stone-700 transition-colors text-center",children:[c.jsxs("div",{className:"font-medium mb-1",children:[c.jsx("span",{children:F.name}),Q&&c.jsx("span",{className:"text-blue-600 text-xs font-medium ml-1",children:"(you)"})]}),c.jsxs("div",{className:"text-sm opacity-75",children:[F.race," ",F.class]})]},F.id)})})})]}):c.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[c.jsx("h3",{className:"font-bold text-blue-800 mb-3",children:o.storyMessages.length>0?"Waiting for next speaker":"Waiting for the story to begin"}),c.jsx("p",{className:"text-blue-700",children:o.storyMessages.length>0?"The Dungeon Master is choosing who will speak next. Please wait.":"The Dungeon Master is choosing who will speak first. Please wait."})]}),(o==null?void 0:o.status)==="storytelling"&&Qt()]})]})}):c.jsx("div",{className:"fantasy-container py-8",children:c.jsx("div",{className:"fantasy-card",children:c.jsx("div",{className:"text-center py-8",children:c.jsx("div",{className:"text-stone-600",children:"Loading..."})})})})}function zR(){return c.jsx(QC,{basename:"/DND-V1",children:c.jsxs("div",{className:"min-h-screen flex flex-col",children:[c.jsx(vR,{}),c.jsx("main",{className:"flex-grow",children:c.jsxs(BC,{children:[c.jsx(Un,{path:"/",element:c.jsx(_R,{})}),c.jsx(Un,{path:"/login",element:c.jsx(xR,{})}),c.jsx(Un,{path:"/register",element:c.jsx(ER,{})}),c.jsx(Un,{path:"/dashboard",element:c.jsx(TR,{})}),c.jsx(Un,{path:"/character-creation/:partyId",element:c.jsx(CR,{})}),c.jsx(Un,{path:"/party-management",element:c.jsx(SR,{})}),c.jsx(Un,{path:"/campaign/:partyId",element:c.jsx(kR,{})}),c.jsx(Un,{path:"/campaign-story/:partyId",element:c.jsx(BR,{})}),c.jsx(Un,{path:"/combat/:partyId",element:c.jsx(AR,{})})]})})]})})}Cd.createRoot(document.getElementById("root")).render(c.jsx(xv.StrictMode,{children:c.jsx(zR,{})}));
