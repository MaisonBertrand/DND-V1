function US(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function BS(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var m_={exports:{}},nh={},f_={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ic=Symbol.for("react.element"),zS=Symbol.for("react.portal"),qS=Symbol.for("react.fragment"),WS=Symbol.for("react.strict_mode"),HS=Symbol.for("react.profiler"),GS=Symbol.for("react.provider"),KS=Symbol.for("react.context"),QS=Symbol.for("react.forward_ref"),YS=Symbol.for("react.suspense"),JS=Symbol.for("react.memo"),XS=Symbol.for("react.lazy"),av=Symbol.iterator;function ZS(n){return n===null||typeof n!="object"?null:(n=av&&n[av]||n["@@iterator"],typeof n=="function"?n:null)}var p_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g_=Object.assign,y_={};function Ro(n,e,t){this.props=n,this.context=e,this.refs=y_,this.updater=t||p_}Ro.prototype.isReactComponent={};Ro.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Ro.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function v_(){}v_.prototype=Ro.prototype;function fp(n,e,t){this.props=n,this.context=e,this.refs=y_,this.updater=t||p_}var pp=fp.prototype=new v_;pp.constructor=fp;g_(pp,Ro.prototype);pp.isPureReactComponent=!0;var ov=Array.isArray,x_=Object.prototype.hasOwnProperty,gp={current:null},__={key:!0,ref:!0,__self:!0,__source:!0};function w_(n,e,t){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)x_.call(e,r)&&!__.hasOwnProperty(r)&&(s[r]=e[r]);var o=arguments.length-2;if(o===1)s.children=t;else if(1<o){for(var c=Array(o),d=0;d<o;d++)c[d]=arguments[d+2];s.children=c}if(n&&n.defaultProps)for(r in o=n.defaultProps,o)s[r]===void 0&&(s[r]=o[r]);return{$$typeof:Ic,type:n,key:i,ref:a,props:s,_owner:gp.current}}function eC(n,e){return{$$typeof:Ic,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function yp(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ic}function tC(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var lv=/\/+/g;function Xh(n,e){return typeof n=="object"&&n!==null&&n.key!=null?tC(""+n.key):e.toString(36)}function Vu(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case Ic:case zS:a=!0}}if(a)return a=n,s=s(a),n=r===""?"."+Xh(a,0):r,ov(s)?(t="",n!=null&&(t=n.replace(lv,"$&/")+"/"),Vu(s,e,t,"",function(d){return d})):s!=null&&(yp(s)&&(s=eC(s,t+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(lv,"$&/")+"/")+n)),e.push(s)),1;if(a=0,r=r===""?".":r+":",ov(n))for(var o=0;o<n.length;o++){i=n[o];var c=r+Xh(i,o);a+=Vu(i,e,t,c,s)}else if(c=ZS(n),typeof c=="function")for(n=c.call(n),o=0;!(i=n.next()).done;)i=i.value,c=r+Xh(i,o++),a+=Vu(i,e,t,c,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function uu(n,e,t){if(n==null)return n;var r=[],s=0;return Vu(n,r,"","",function(i){return e.call(t,i,s++)}),r}function nC(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Fn={current:null},Lu={transition:null},rC={ReactCurrentDispatcher:Fn,ReactCurrentBatchConfig:Lu,ReactCurrentOwner:gp};function b_(){throw Error("act(...) is not supported in production builds of React.")}He.Children={map:uu,forEach:function(n,e,t){uu(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return uu(n,function(){e++}),e},toArray:function(n){return uu(n,function(e){return e})||[]},only:function(n){if(!yp(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};He.Component=Ro;He.Fragment=qS;He.Profiler=HS;He.PureComponent=fp;He.StrictMode=WS;He.Suspense=YS;He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rC;He.act=b_;He.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=g_({},n.props),s=n.key,i=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=gp.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(c in e)x_.call(e,c)&&!__.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&o!==void 0?o[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=t;else if(1<c){o=Array(c);for(var d=0;d<c;d++)o[d]=arguments[d+2];r.children=o}return{$$typeof:Ic,type:n.type,key:s,ref:i,props:r,_owner:a}};He.createContext=function(n){return n={$$typeof:KS,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:GS,_context:n},n.Consumer=n};He.createElement=w_;He.createFactory=function(n){var e=w_.bind(null,n);return e.type=n,e};He.createRef=function(){return{current:null}};He.forwardRef=function(n){return{$$typeof:QS,render:n}};He.isValidElement=yp;He.lazy=function(n){return{$$typeof:XS,_payload:{_status:-1,_result:n},_init:nC}};He.memo=function(n,e){return{$$typeof:JS,type:n,compare:e===void 0?null:e}};He.startTransition=function(n){var e=Lu.transition;Lu.transition={};try{n()}finally{Lu.transition=e}};He.unstable_act=b_;He.useCallback=function(n,e){return Fn.current.useCallback(n,e)};He.useContext=function(n){return Fn.current.useContext(n)};He.useDebugValue=function(){};He.useDeferredValue=function(n){return Fn.current.useDeferredValue(n)};He.useEffect=function(n,e){return Fn.current.useEffect(n,e)};He.useId=function(){return Fn.current.useId()};He.useImperativeHandle=function(n,e,t){return Fn.current.useImperativeHandle(n,e,t)};He.useInsertionEffect=function(n,e){return Fn.current.useInsertionEffect(n,e)};He.useLayoutEffect=function(n,e){return Fn.current.useLayoutEffect(n,e)};He.useMemo=function(n,e){return Fn.current.useMemo(n,e)};He.useReducer=function(n,e,t){return Fn.current.useReducer(n,e,t)};He.useRef=function(n){return Fn.current.useRef(n)};He.useState=function(n){return Fn.current.useState(n)};He.useSyncExternalStore=function(n,e,t){return Fn.current.useSyncExternalStore(n,e,t)};He.useTransition=function(){return Fn.current.useTransition()};He.version="18.3.1";f_.exports=He;var k=f_.exports;const E_=BS(k),sC=US({__proto__:null,default:E_},[k]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iC=k,aC=Symbol.for("react.element"),oC=Symbol.for("react.fragment"),lC=Object.prototype.hasOwnProperty,cC=iC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,uC={key:!0,ref:!0,__self:!0,__source:!0};function T_(n,e,t){var r,s={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)lC.call(e,r)&&!uC.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:aC,type:n,key:i,ref:a,props:s,_owner:cC.current}}nh.Fragment=oC;nh.jsx=T_;nh.jsxs=T_;m_.exports=nh;var l=m_.exports,$m={},I_={exports:{}},ir={},S_={exports:{}},C_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(Y,ae){var Se=Y.length;Y.push(ae);e:for(;0<Se;){var ee=Se-1>>>1,H=Y[ee];if(0<s(H,ae))Y[ee]=ae,Y[Se]=H,Se=ee;else break e}}function t(Y){return Y.length===0?null:Y[0]}function r(Y){if(Y.length===0)return null;var ae=Y[0],Se=Y.pop();if(Se!==ae){Y[0]=Se;e:for(var ee=0,H=Y.length,ne=H>>>1;ee<ne;){var pe=2*(ee+1)-1,Ue=Y[pe],oe=pe+1,ge=Y[oe];if(0>s(Ue,Se))oe<H&&0>s(ge,Ue)?(Y[ee]=ge,Y[oe]=Se,ee=oe):(Y[ee]=Ue,Y[pe]=Se,ee=pe);else if(oe<H&&0>s(ge,Se))Y[ee]=ge,Y[oe]=Se,ee=oe;else break e}}return ae}function s(Y,ae){var Se=Y.sortIndex-ae.sortIndex;return Se!==0?Se:Y.id-ae.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var c=[],d=[],h=1,m=null,p=3,y=!1,E=!1,v=!1,I=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(Y){for(var ae=t(d);ae!==null;){if(ae.callback===null)r(d);else if(ae.startTime<=Y)r(d),ae.sortIndex=ae.expirationTime,e(c,ae);else break;ae=t(d)}}function R(Y){if(v=!1,C(Y),!E)if(t(c)!==null)E=!0,$e(F);else{var ae=t(d);ae!==null&&Pe(R,ae.startTime-Y)}}function F(Y,ae){E=!1,v&&(v=!1,_(b),b=-1),y=!0;var Se=p;try{for(C(ae),m=t(c);m!==null&&(!(m.expirationTime>ae)||Y&&!D());){var ee=m.callback;if(typeof ee=="function"){m.callback=null,p=m.priorityLevel;var H=ee(m.expirationTime<=ae);ae=n.unstable_now(),typeof H=="function"?m.callback=H:m===t(c)&&r(c),C(ae)}else r(c);m=t(c)}if(m!==null)var ne=!0;else{var pe=t(d);pe!==null&&Pe(R,pe.startTime-ae),ne=!1}return ne}finally{m=null,p=Se,y=!1}}var q=!1,T=null,b=-1,A=5,P=-1;function D(){return!(n.unstable_now()-P<A)}function N(){if(T!==null){var Y=n.unstable_now();P=Y;var ae=!0;try{ae=T(!0,Y)}finally{ae?S():(q=!1,T=null)}}else q=!1}var S;if(typeof x=="function")S=function(){x(N)};else if(typeof MessageChannel<"u"){var Be=new MessageChannel,Fe=Be.port2;Be.port1.onmessage=N,S=function(){Fe.postMessage(null)}}else S=function(){I(N,0)};function $e(Y){T=Y,q||(q=!0,S())}function Pe(Y,ae){b=I(function(){Y(n.unstable_now())},ae)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Y){Y.callback=null},n.unstable_continueExecution=function(){E||y||(E=!0,$e(F))},n.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<Y?Math.floor(1e3/Y):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(Y){switch(p){case 1:case 2:case 3:var ae=3;break;default:ae=p}var Se=p;p=ae;try{return Y()}finally{p=Se}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Y,ae){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var Se=p;p=Y;try{return ae()}finally{p=Se}},n.unstable_scheduleCallback=function(Y,ae,Se){var ee=n.unstable_now();switch(typeof Se=="object"&&Se!==null?(Se=Se.delay,Se=typeof Se=="number"&&0<Se?ee+Se:ee):Se=ee,Y){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=Se+H,Y={id:h++,callback:ae,priorityLevel:Y,startTime:Se,expirationTime:H,sortIndex:-1},Se>ee?(Y.sortIndex=Se,e(d,Y),t(c)===null&&Y===t(d)&&(v?(_(b),b=-1):v=!0,Pe(R,Se-ee))):(Y.sortIndex=H,e(c,Y),E||y||(E=!0,$e(F))),Y},n.unstable_shouldYield=D,n.unstable_wrapCallback=function(Y){var ae=p;return function(){var Se=p;p=ae;try{return Y.apply(this,arguments)}finally{p=Se}}}})(C_);S_.exports=C_;var dC=S_.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hC=k,rr=dC;function Z(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var A_=new Set,Hl={};function ha(n,e){ao(n,e),ao(n+"Capture",e)}function ao(n,e){for(Hl[n]=e,n=0;n<e.length;n++)A_.add(e[n])}var ls=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Um=Object.prototype.hasOwnProperty,mC=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,cv={},uv={};function fC(n){return Um.call(uv,n)?!0:Um.call(cv,n)?!1:mC.test(n)?uv[n]=!0:(cv[n]=!0,!1)}function pC(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function gC(n,e,t,r){if(e===null||typeof e>"u"||pC(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function $n(n,e,t,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var pn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){pn[n]=new $n(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];pn[e]=new $n(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){pn[n]=new $n(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){pn[n]=new $n(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){pn[n]=new $n(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){pn[n]=new $n(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){pn[n]=new $n(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){pn[n]=new $n(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){pn[n]=new $n(n,5,!1,n.toLowerCase(),null,!1,!1)});var vp=/[\-:]([a-z])/g;function xp(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(vp,xp);pn[e]=new $n(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(vp,xp);pn[e]=new $n(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(vp,xp);pn[e]=new $n(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){pn[n]=new $n(n,1,!1,n.toLowerCase(),null,!1,!1)});pn.xlinkHref=new $n("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){pn[n]=new $n(n,1,!1,n.toLowerCase(),null,!0,!0)});function _p(n,e,t,r){var s=pn.hasOwnProperty(e)?pn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(gC(e,t,s,r)&&(t=null),r||s===null?fC(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var gs=hC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,du=Symbol.for("react.element"),Va=Symbol.for("react.portal"),La=Symbol.for("react.fragment"),wp=Symbol.for("react.strict_mode"),Bm=Symbol.for("react.profiler"),N_=Symbol.for("react.provider"),P_=Symbol.for("react.context"),bp=Symbol.for("react.forward_ref"),zm=Symbol.for("react.suspense"),qm=Symbol.for("react.suspense_list"),Ep=Symbol.for("react.memo"),js=Symbol.for("react.lazy"),k_=Symbol.for("react.offscreen"),dv=Symbol.iterator;function ol(n){return n===null||typeof n!="object"?null:(n=dv&&n[dv]||n["@@iterator"],typeof n=="function"?n:null)}var kt=Object.assign,Zh;function _l(n){if(Zh===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Zh=e&&e[1]||""}return`
`+Zh+n}var em=!1;function tm(n,e){if(!n||em)return"";em=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(n,[],e)}else{try{e.call()}catch(d){r=d}n.call(e.prototype)}else{try{throw Error()}catch(d){r=d}n()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,o=i.length-1;1<=a&&0<=o&&s[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||s[a]!==i[o]){var c=`
`+s[a].replace(" at new "," at ");return n.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",n.displayName)),c}while(1<=a&&0<=o);break}}}finally{em=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?_l(n):""}function yC(n){switch(n.tag){case 5:return _l(n.type);case 16:return _l("Lazy");case 13:return _l("Suspense");case 19:return _l("SuspenseList");case 0:case 2:case 15:return n=tm(n.type,!1),n;case 11:return n=tm(n.type.render,!1),n;case 1:return n=tm(n.type,!0),n;default:return""}}function Wm(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case La:return"Fragment";case Va:return"Portal";case Bm:return"Profiler";case wp:return"StrictMode";case zm:return"Suspense";case qm:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case P_:return(n.displayName||"Context")+".Consumer";case N_:return(n._context.displayName||"Context")+".Provider";case bp:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Ep:return e=n.displayName||null,e!==null?e:Wm(n.type)||"Memo";case js:e=n._payload,n=n._init;try{return Wm(n(e))}catch{}}return null}function vC(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Wm(e);case 8:return e===wp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ai(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function R_(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function xC(n){var e=R_(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function hu(n){n._valueTracker||(n._valueTracker=xC(n))}function j_(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=R_(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function ld(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Hm(n,e){var t=e.checked;return kt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function hv(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=ai(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function D_(n,e){e=e.checked,e!=null&&_p(n,"checked",e,!1)}function Gm(n,e){D_(n,e);var t=ai(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Km(n,e.type,t):e.hasOwnProperty("defaultValue")&&Km(n,e.type,ai(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function mv(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Km(n,e,t){(e!=="number"||ld(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var wl=Array.isArray;function Qa(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+ai(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function Qm(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Z(91));return kt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function fv(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Z(92));if(wl(t)){if(1<t.length)throw Error(Z(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:ai(t)}}function M_(n,e){var t=ai(e.value),r=ai(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function pv(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function V_(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ym(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?V_(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var mu,L_=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(mu=mu||document.createElement("div"),mu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=mu.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Gl(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Pl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_C=["Webkit","ms","Moz","O"];Object.keys(Pl).forEach(function(n){_C.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Pl[e]=Pl[n]})});function O_(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Pl.hasOwnProperty(n)&&Pl[n]?(""+e).trim():e+"px"}function F_(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=O_(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var wC=kt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Jm(n,e){if(e){if(wC[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Z(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Z(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Z(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Z(62))}}function Xm(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zm=null;function Tp(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var ef=null,Ya=null,Ja=null;function gv(n){if(n=Ac(n)){if(typeof ef!="function")throw Error(Z(280));var e=n.stateNode;e&&(e=oh(e),ef(n.stateNode,n.type,e))}}function $_(n){Ya?Ja?Ja.push(n):Ja=[n]:Ya=n}function U_(){if(Ya){var n=Ya,e=Ja;if(Ja=Ya=null,gv(n),e)for(n=0;n<e.length;n++)gv(e[n])}}function B_(n,e){return n(e)}function z_(){}var nm=!1;function q_(n,e,t){if(nm)return n(e,t);nm=!0;try{return B_(n,e,t)}finally{nm=!1,(Ya!==null||Ja!==null)&&(z_(),U_())}}function Kl(n,e){var t=n.stateNode;if(t===null)return null;var r=oh(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Z(231,e,typeof t));return t}var tf=!1;if(ls)try{var ll={};Object.defineProperty(ll,"passive",{get:function(){tf=!0}}),window.addEventListener("test",ll,ll),window.removeEventListener("test",ll,ll)}catch{tf=!1}function bC(n,e,t,r,s,i,a,o,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(t,d)}catch(h){this.onError(h)}}var kl=!1,cd=null,ud=!1,nf=null,EC={onError:function(n){kl=!0,cd=n}};function TC(n,e,t,r,s,i,a,o,c){kl=!1,cd=null,bC.apply(EC,arguments)}function IC(n,e,t,r,s,i,a,o,c){if(TC.apply(this,arguments),kl){if(kl){var d=cd;kl=!1,cd=null}else throw Error(Z(198));ud||(ud=!0,nf=d)}}function ma(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function W_(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function yv(n){if(ma(n)!==n)throw Error(Z(188))}function SC(n){var e=n.alternate;if(!e){if(e=ma(n),e===null)throw Error(Z(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return yv(s),n;if(i===r)return yv(s),e;i=i.sibling}throw Error(Z(188))}if(t.return!==r.return)t=s,r=i;else{for(var a=!1,o=s.child;o;){if(o===t){a=!0,t=s,r=i;break}if(o===r){a=!0,r=s,t=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===t){a=!0,t=i,r=s;break}if(o===r){a=!0,r=i,t=s;break}o=o.sibling}if(!a)throw Error(Z(189))}}if(t.alternate!==r)throw Error(Z(190))}if(t.tag!==3)throw Error(Z(188));return t.stateNode.current===t?n:e}function H_(n){return n=SC(n),n!==null?G_(n):null}function G_(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=G_(n);if(e!==null)return e;n=n.sibling}return null}var K_=rr.unstable_scheduleCallback,vv=rr.unstable_cancelCallback,CC=rr.unstable_shouldYield,AC=rr.unstable_requestPaint,$t=rr.unstable_now,NC=rr.unstable_getCurrentPriorityLevel,Ip=rr.unstable_ImmediatePriority,Q_=rr.unstable_UserBlockingPriority,dd=rr.unstable_NormalPriority,PC=rr.unstable_LowPriority,Y_=rr.unstable_IdlePriority,rh=null,Lr=null;function kC(n){if(Lr&&typeof Lr.onCommitFiberRoot=="function")try{Lr.onCommitFiberRoot(rh,n,void 0,(n.current.flags&128)===128)}catch{}}var Ir=Math.clz32?Math.clz32:DC,RC=Math.log,jC=Math.LN2;function DC(n){return n>>>=0,n===0?32:31-(RC(n)/jC|0)|0}var fu=64,pu=4194304;function bl(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function hd(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~s;o!==0?r=bl(o):(i&=a,i!==0&&(r=bl(i)))}else a=t&~s,a!==0?r=bl(a):i!==0&&(r=bl(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Ir(e),s=1<<t,r|=n[t],e&=~s;return r}function MC(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function VC(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var a=31-Ir(i),o=1<<a,c=s[a];c===-1?(!(o&t)||o&r)&&(s[a]=MC(o,e)):c<=e&&(n.expiredLanes|=o),i&=~o}}function rf(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function J_(){var n=fu;return fu<<=1,!(fu&4194240)&&(fu=64),n}function rm(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Sc(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Ir(e),n[e]=t}function LC(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-Ir(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function Sp(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Ir(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var st=0;function X_(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Z_,Cp,ew,tw,nw,sf=!1,gu=[],Ks=null,Qs=null,Ys=null,Ql=new Map,Yl=new Map,Ms=[],OC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function xv(n,e){switch(n){case"focusin":case"focusout":Ks=null;break;case"dragenter":case"dragleave":Qs=null;break;case"mouseover":case"mouseout":Ys=null;break;case"pointerover":case"pointerout":Ql.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Yl.delete(e.pointerId)}}function cl(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Ac(e),e!==null&&Cp(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function FC(n,e,t,r,s){switch(e){case"focusin":return Ks=cl(Ks,n,e,t,r,s),!0;case"dragenter":return Qs=cl(Qs,n,e,t,r,s),!0;case"mouseover":return Ys=cl(Ys,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return Ql.set(i,cl(Ql.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Yl.set(i,cl(Yl.get(i)||null,n,e,t,r,s)),!0}return!1}function rw(n){var e=Ui(n.target);if(e!==null){var t=ma(e);if(t!==null){if(e=t.tag,e===13){if(e=W_(t),e!==null){n.blockedOn=e,nw(n.priority,function(){ew(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ou(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=af(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Zm=r,t.target.dispatchEvent(r),Zm=null}else return e=Ac(t),e!==null&&Cp(e),n.blockedOn=t,!1;e.shift()}return!0}function _v(n,e,t){Ou(n)&&t.delete(e)}function $C(){sf=!1,Ks!==null&&Ou(Ks)&&(Ks=null),Qs!==null&&Ou(Qs)&&(Qs=null),Ys!==null&&Ou(Ys)&&(Ys=null),Ql.forEach(_v),Yl.forEach(_v)}function ul(n,e){n.blockedOn===e&&(n.blockedOn=null,sf||(sf=!0,rr.unstable_scheduleCallback(rr.unstable_NormalPriority,$C)))}function Jl(n){function e(s){return ul(s,n)}if(0<gu.length){ul(gu[0],n);for(var t=1;t<gu.length;t++){var r=gu[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Ks!==null&&ul(Ks,n),Qs!==null&&ul(Qs,n),Ys!==null&&ul(Ys,n),Ql.forEach(e),Yl.forEach(e),t=0;t<Ms.length;t++)r=Ms[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Ms.length&&(t=Ms[0],t.blockedOn===null);)rw(t),t.blockedOn===null&&Ms.shift()}var Xa=gs.ReactCurrentBatchConfig,md=!0;function UC(n,e,t,r){var s=st,i=Xa.transition;Xa.transition=null;try{st=1,Ap(n,e,t,r)}finally{st=s,Xa.transition=i}}function BC(n,e,t,r){var s=st,i=Xa.transition;Xa.transition=null;try{st=4,Ap(n,e,t,r)}finally{st=s,Xa.transition=i}}function Ap(n,e,t,r){if(md){var s=af(n,e,t,r);if(s===null)mm(n,e,r,fd,t),xv(n,r);else if(FC(s,n,e,t,r))r.stopPropagation();else if(xv(n,r),e&4&&-1<OC.indexOf(n)){for(;s!==null;){var i=Ac(s);if(i!==null&&Z_(i),i=af(n,e,t,r),i===null&&mm(n,e,r,fd,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else mm(n,e,r,null,t)}}var fd=null;function af(n,e,t,r){if(fd=null,n=Tp(r),n=Ui(n),n!==null)if(e=ma(n),e===null)n=null;else if(t=e.tag,t===13){if(n=W_(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return fd=n,null}function sw(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(NC()){case Ip:return 1;case Q_:return 4;case dd:case PC:return 16;case Y_:return 536870912;default:return 16}default:return 16}}var qs=null,Np=null,Fu=null;function iw(){if(Fu)return Fu;var n,e=Np,t=e.length,r,s="value"in qs?qs.value:qs.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var a=t-n;for(r=1;r<=a&&e[t-r]===s[i-r];r++);return Fu=s.slice(n,1<r?1-r:void 0)}function $u(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function yu(){return!0}function wv(){return!1}function ar(n){function e(t,r,s,i,a){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?yu:wv,this.isPropagationStopped=wv,this}return kt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=yu)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=yu)},persist:function(){},isPersistent:yu}),e}var jo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Pp=ar(jo),Cc=kt({},jo,{view:0,detail:0}),zC=ar(Cc),sm,im,dl,sh=kt({},Cc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kp,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==dl&&(dl&&n.type==="mousemove"?(sm=n.screenX-dl.screenX,im=n.screenY-dl.screenY):im=sm=0,dl=n),sm)},movementY:function(n){return"movementY"in n?n.movementY:im}}),bv=ar(sh),qC=kt({},sh,{dataTransfer:0}),WC=ar(qC),HC=kt({},Cc,{relatedTarget:0}),am=ar(HC),GC=kt({},jo,{animationName:0,elapsedTime:0,pseudoElement:0}),KC=ar(GC),QC=kt({},jo,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),YC=ar(QC),JC=kt({},jo,{data:0}),Ev=ar(JC),XC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ZC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},eA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tA(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=eA[n])?!!e[n]:!1}function kp(){return tA}var nA=kt({},Cc,{key:function(n){if(n.key){var e=XC[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=$u(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?ZC[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kp,charCode:function(n){return n.type==="keypress"?$u(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?$u(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),rA=ar(nA),sA=kt({},sh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tv=ar(sA),iA=kt({},Cc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kp}),aA=ar(iA),oA=kt({},jo,{propertyName:0,elapsedTime:0,pseudoElement:0}),lA=ar(oA),cA=kt({},sh,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),uA=ar(cA),dA=[9,13,27,32],Rp=ls&&"CompositionEvent"in window,Rl=null;ls&&"documentMode"in document&&(Rl=document.documentMode);var hA=ls&&"TextEvent"in window&&!Rl,aw=ls&&(!Rp||Rl&&8<Rl&&11>=Rl),Iv=String.fromCharCode(32),Sv=!1;function ow(n,e){switch(n){case"keyup":return dA.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function lw(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Oa=!1;function mA(n,e){switch(n){case"compositionend":return lw(e);case"keypress":return e.which!==32?null:(Sv=!0,Iv);case"textInput":return n=e.data,n===Iv&&Sv?null:n;default:return null}}function fA(n,e){if(Oa)return n==="compositionend"||!Rp&&ow(n,e)?(n=iw(),Fu=Np=qs=null,Oa=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return aw&&e.locale!=="ko"?null:e.data;default:return null}}var pA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Cv(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!pA[n.type]:e==="textarea"}function cw(n,e,t,r){$_(r),e=pd(e,"onChange"),0<e.length&&(t=new Pp("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var jl=null,Xl=null;function gA(n){_w(n,0)}function ih(n){var e=Ua(n);if(j_(e))return n}function yA(n,e){if(n==="change")return e}var uw=!1;if(ls){var om;if(ls){var lm="oninput"in document;if(!lm){var Av=document.createElement("div");Av.setAttribute("oninput","return;"),lm=typeof Av.oninput=="function"}om=lm}else om=!1;uw=om&&(!document.documentMode||9<document.documentMode)}function Nv(){jl&&(jl.detachEvent("onpropertychange",dw),Xl=jl=null)}function dw(n){if(n.propertyName==="value"&&ih(Xl)){var e=[];cw(e,Xl,n,Tp(n)),q_(gA,e)}}function vA(n,e,t){n==="focusin"?(Nv(),jl=e,Xl=t,jl.attachEvent("onpropertychange",dw)):n==="focusout"&&Nv()}function xA(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return ih(Xl)}function _A(n,e){if(n==="click")return ih(e)}function wA(n,e){if(n==="input"||n==="change")return ih(e)}function bA(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Cr=typeof Object.is=="function"?Object.is:bA;function Zl(n,e){if(Cr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!Um.call(e,s)||!Cr(n[s],e[s]))return!1}return!0}function Pv(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function kv(n,e){var t=Pv(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Pv(t)}}function hw(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?hw(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function mw(){for(var n=window,e=ld();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ld(n.document)}return e}function jp(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function EA(n){var e=mw(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&hw(t.ownerDocument.documentElement,t)){if(r!==null&&jp(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=kv(t,i);var a=kv(t,r);s&&a&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var TA=ls&&"documentMode"in document&&11>=document.documentMode,Fa=null,of=null,Dl=null,lf=!1;function Rv(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;lf||Fa==null||Fa!==ld(r)||(r=Fa,"selectionStart"in r&&jp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Dl&&Zl(Dl,r)||(Dl=r,r=pd(of,"onSelect"),0<r.length&&(e=new Pp("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Fa)))}function vu(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var $a={animationend:vu("Animation","AnimationEnd"),animationiteration:vu("Animation","AnimationIteration"),animationstart:vu("Animation","AnimationStart"),transitionend:vu("Transition","TransitionEnd")},cm={},fw={};ls&&(fw=document.createElement("div").style,"AnimationEvent"in window||(delete $a.animationend.animation,delete $a.animationiteration.animation,delete $a.animationstart.animation),"TransitionEvent"in window||delete $a.transitionend.transition);function ah(n){if(cm[n])return cm[n];if(!$a[n])return n;var e=$a[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in fw)return cm[n]=e[t];return n}var pw=ah("animationend"),gw=ah("animationiteration"),yw=ah("animationstart"),vw=ah("transitionend"),xw=new Map,jv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function gi(n,e){xw.set(n,e),ha(e,[n])}for(var um=0;um<jv.length;um++){var dm=jv[um],IA=dm.toLowerCase(),SA=dm[0].toUpperCase()+dm.slice(1);gi(IA,"on"+SA)}gi(pw,"onAnimationEnd");gi(gw,"onAnimationIteration");gi(yw,"onAnimationStart");gi("dblclick","onDoubleClick");gi("focusin","onFocus");gi("focusout","onBlur");gi(vw,"onTransitionEnd");ao("onMouseEnter",["mouseout","mouseover"]);ao("onMouseLeave",["mouseout","mouseover"]);ao("onPointerEnter",["pointerout","pointerover"]);ao("onPointerLeave",["pointerout","pointerover"]);ha("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ha("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ha("onBeforeInput",["compositionend","keypress","textInput","paste"]);ha("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ha("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ha("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var El="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),CA=new Set("cancel close invalid load scroll toggle".split(" ").concat(El));function Dv(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,IC(r,e,void 0,n),n.currentTarget=null}function _w(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],c=o.instance,d=o.currentTarget;if(o=o.listener,c!==i&&s.isPropagationStopped())break e;Dv(s,o,d),i=c}else for(a=0;a<r.length;a++){if(o=r[a],c=o.instance,d=o.currentTarget,o=o.listener,c!==i&&s.isPropagationStopped())break e;Dv(s,o,d),i=c}}}if(ud)throw n=nf,ud=!1,nf=null,n}function gt(n,e){var t=e[mf];t===void 0&&(t=e[mf]=new Set);var r=n+"__bubble";t.has(r)||(ww(e,n,2,!1),t.add(r))}function hm(n,e,t){var r=0;e&&(r|=4),ww(t,n,r,e)}var xu="_reactListening"+Math.random().toString(36).slice(2);function ec(n){if(!n[xu]){n[xu]=!0,A_.forEach(function(t){t!=="selectionchange"&&(CA.has(t)||hm(t,!1,n),hm(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[xu]||(e[xu]=!0,hm("selectionchange",!1,e))}}function ww(n,e,t,r){switch(sw(e)){case 1:var s=UC;break;case 4:s=BC;break;default:s=Ap}t=s.bind(null,e,t,n),s=void 0,!tf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function mm(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;a=a.return}for(;o!==null;){if(a=Ui(o),a===null)return;if(c=a.tag,c===5||c===6){r=i=a;continue e}o=o.parentNode}}r=r.return}q_(function(){var d=i,h=Tp(t),m=[];e:{var p=xw.get(n);if(p!==void 0){var y=Pp,E=n;switch(n){case"keypress":if($u(t)===0)break e;case"keydown":case"keyup":y=rA;break;case"focusin":E="focus",y=am;break;case"focusout":E="blur",y=am;break;case"beforeblur":case"afterblur":y=am;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=bv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=WC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=aA;break;case pw:case gw:case yw:y=KC;break;case vw:y=lA;break;case"scroll":y=zC;break;case"wheel":y=uA;break;case"copy":case"cut":case"paste":y=YC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=Tv}var v=(e&4)!==0,I=!v&&n==="scroll",_=v?p!==null?p+"Capture":null:p;v=[];for(var x=d,C;x!==null;){C=x;var R=C.stateNode;if(C.tag===5&&R!==null&&(C=R,_!==null&&(R=Kl(x,_),R!=null&&v.push(tc(x,R,C)))),I)break;x=x.return}0<v.length&&(p=new y(p,E,null,t,h),m.push({event:p,listeners:v}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",p&&t!==Zm&&(E=t.relatedTarget||t.fromElement)&&(Ui(E)||E[cs]))break e;if((y||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,y?(E=t.relatedTarget||t.toElement,y=d,E=E?Ui(E):null,E!==null&&(I=ma(E),E!==I||E.tag!==5&&E.tag!==6)&&(E=null)):(y=null,E=d),y!==E)){if(v=bv,R="onMouseLeave",_="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(v=Tv,R="onPointerLeave",_="onPointerEnter",x="pointer"),I=y==null?p:Ua(y),C=E==null?p:Ua(E),p=new v(R,x+"leave",y,t,h),p.target=I,p.relatedTarget=C,R=null,Ui(h)===d&&(v=new v(_,x+"enter",E,t,h),v.target=C,v.relatedTarget=I,R=v),I=R,y&&E)t:{for(v=y,_=E,x=0,C=v;C;C=Sa(C))x++;for(C=0,R=_;R;R=Sa(R))C++;for(;0<x-C;)v=Sa(v),x--;for(;0<C-x;)_=Sa(_),C--;for(;x--;){if(v===_||_!==null&&v===_.alternate)break t;v=Sa(v),_=Sa(_)}v=null}else v=null;y!==null&&Mv(m,p,y,v,!1),E!==null&&I!==null&&Mv(m,I,E,v,!0)}}e:{if(p=d?Ua(d):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var F=yA;else if(Cv(p))if(uw)F=wA;else{F=xA;var q=vA}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(F=_A);if(F&&(F=F(n,d))){cw(m,F,t,h);break e}q&&q(n,p,d),n==="focusout"&&(q=p._wrapperState)&&q.controlled&&p.type==="number"&&Km(p,"number",p.value)}switch(q=d?Ua(d):window,n){case"focusin":(Cv(q)||q.contentEditable==="true")&&(Fa=q,of=d,Dl=null);break;case"focusout":Dl=of=Fa=null;break;case"mousedown":lf=!0;break;case"contextmenu":case"mouseup":case"dragend":lf=!1,Rv(m,t,h);break;case"selectionchange":if(TA)break;case"keydown":case"keyup":Rv(m,t,h)}var T;if(Rp)e:{switch(n){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Oa?ow(n,t)&&(b="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(b="onCompositionStart");b&&(aw&&t.locale!=="ko"&&(Oa||b!=="onCompositionStart"?b==="onCompositionEnd"&&Oa&&(T=iw()):(qs=h,Np="value"in qs?qs.value:qs.textContent,Oa=!0)),q=pd(d,b),0<q.length&&(b=new Ev(b,n,null,t,h),m.push({event:b,listeners:q}),T?b.data=T:(T=lw(t),T!==null&&(b.data=T)))),(T=hA?mA(n,t):fA(n,t))&&(d=pd(d,"onBeforeInput"),0<d.length&&(h=new Ev("onBeforeInput","beforeinput",null,t,h),m.push({event:h,listeners:d}),h.data=T))}_w(m,e)})}function tc(n,e,t){return{instance:n,listener:e,currentTarget:t}}function pd(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Kl(n,t),i!=null&&r.unshift(tc(n,i,s)),i=Kl(n,e),i!=null&&r.push(tc(n,i,s))),n=n.return}return r}function Sa(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Mv(n,e,t,r,s){for(var i=e._reactName,a=[];t!==null&&t!==r;){var o=t,c=o.alternate,d=o.stateNode;if(c!==null&&c===r)break;o.tag===5&&d!==null&&(o=d,s?(c=Kl(t,i),c!=null&&a.unshift(tc(t,c,o))):s||(c=Kl(t,i),c!=null&&a.push(tc(t,c,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var AA=/\r\n?/g,NA=/\u0000|\uFFFD/g;function Vv(n){return(typeof n=="string"?n:""+n).replace(AA,`
`).replace(NA,"")}function _u(n,e,t){if(e=Vv(e),Vv(n)!==e&&t)throw Error(Z(425))}function gd(){}var cf=null,uf=null;function df(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var hf=typeof setTimeout=="function"?setTimeout:void 0,PA=typeof clearTimeout=="function"?clearTimeout:void 0,Lv=typeof Promise=="function"?Promise:void 0,kA=typeof queueMicrotask=="function"?queueMicrotask:typeof Lv<"u"?function(n){return Lv.resolve(null).then(n).catch(RA)}:hf;function RA(n){setTimeout(function(){throw n})}function fm(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Jl(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Jl(e)}function Js(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function Ov(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Do=Math.random().toString(36).slice(2),jr="__reactFiber$"+Do,nc="__reactProps$"+Do,cs="__reactContainer$"+Do,mf="__reactEvents$"+Do,jA="__reactListeners$"+Do,DA="__reactHandles$"+Do;function Ui(n){var e=n[jr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[cs]||t[jr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=Ov(n);n!==null;){if(t=n[jr])return t;n=Ov(n)}return e}n=t,t=n.parentNode}return null}function Ac(n){return n=n[jr]||n[cs],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ua(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Z(33))}function oh(n){return n[nc]||null}var ff=[],Ba=-1;function yi(n){return{current:n}}function vt(n){0>Ba||(n.current=ff[Ba],ff[Ba]=null,Ba--)}function ht(n,e){Ba++,ff[Ba]=n.current,n.current=e}var oi={},Nn=yi(oi),Kn=yi(!1),Qi=oi;function oo(n,e){var t=n.type.contextTypes;if(!t)return oi;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function Qn(n){return n=n.childContextTypes,n!=null}function yd(){vt(Kn),vt(Nn)}function Fv(n,e,t){if(Nn.current!==oi)throw Error(Z(168));ht(Nn,e),ht(Kn,t)}function bw(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Z(108,vC(n)||"Unknown",s));return kt({},t,r)}function vd(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||oi,Qi=Nn.current,ht(Nn,n),ht(Kn,Kn.current),!0}function $v(n,e,t){var r=n.stateNode;if(!r)throw Error(Z(169));t?(n=bw(n,e,Qi),r.__reactInternalMemoizedMergedChildContext=n,vt(Kn),vt(Nn),ht(Nn,n)):vt(Kn),ht(Kn,t)}var Jr=null,lh=!1,pm=!1;function Ew(n){Jr===null?Jr=[n]:Jr.push(n)}function MA(n){lh=!0,Ew(n)}function vi(){if(!pm&&Jr!==null){pm=!0;var n=0,e=st;try{var t=Jr;for(st=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Jr=null,lh=!1}catch(s){throw Jr!==null&&(Jr=Jr.slice(n+1)),K_(Ip,vi),s}finally{st=e,pm=!1}}return null}var za=[],qa=0,xd=null,_d=0,or=[],lr=0,Yi=null,es=1,ts="";function ji(n,e){za[qa++]=_d,za[qa++]=xd,xd=n,_d=e}function Tw(n,e,t){or[lr++]=es,or[lr++]=ts,or[lr++]=Yi,Yi=n;var r=es;n=ts;var s=32-Ir(r)-1;r&=~(1<<s),t+=1;var i=32-Ir(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,es=1<<32-Ir(e)+s|t<<s|r,ts=i+n}else es=1<<i|t<<s|r,ts=n}function Dp(n){n.return!==null&&(ji(n,1),Tw(n,1,0))}function Mp(n){for(;n===xd;)xd=za[--qa],za[qa]=null,_d=za[--qa],za[qa]=null;for(;n===Yi;)Yi=or[--lr],or[lr]=null,ts=or[--lr],or[lr]=null,es=or[--lr],or[lr]=null}var nr=null,tr=null,bt=!1,Tr=null;function Iw(n,e){var t=cr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Uv(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,nr=n,tr=Js(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,nr=n,tr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Yi!==null?{id:es,overflow:ts}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=cr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,nr=n,tr=null,!0):!1;default:return!1}}function pf(n){return(n.mode&1)!==0&&(n.flags&128)===0}function gf(n){if(bt){var e=tr;if(e){var t=e;if(!Uv(n,e)){if(pf(n))throw Error(Z(418));e=Js(t.nextSibling);var r=nr;e&&Uv(n,e)?Iw(r,t):(n.flags=n.flags&-4097|2,bt=!1,nr=n)}}else{if(pf(n))throw Error(Z(418));n.flags=n.flags&-4097|2,bt=!1,nr=n}}}function Bv(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;nr=n}function wu(n){if(n!==nr)return!1;if(!bt)return Bv(n),bt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!df(n.type,n.memoizedProps)),e&&(e=tr)){if(pf(n))throw Sw(),Error(Z(418));for(;e;)Iw(n,e),e=Js(e.nextSibling)}if(Bv(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Z(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){tr=Js(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}tr=null}}else tr=nr?Js(n.stateNode.nextSibling):null;return!0}function Sw(){for(var n=tr;n;)n=Js(n.nextSibling)}function lo(){tr=nr=null,bt=!1}function Vp(n){Tr===null?Tr=[n]:Tr.push(n)}var VA=gs.ReactCurrentBatchConfig;function hl(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Z(309));var r=t.stateNode}if(!r)throw Error(Z(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var o=s.refs;a===null?delete o[i]:o[i]=a},e._stringRef=i,e)}if(typeof n!="string")throw Error(Z(284));if(!t._owner)throw Error(Z(290,n))}return n}function bu(n,e){throw n=Object.prototype.toString.call(e),Error(Z(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function zv(n){var e=n._init;return e(n._payload)}function Cw(n){function e(_,x){if(n){var C=_.deletions;C===null?(_.deletions=[x],_.flags|=16):C.push(x)}}function t(_,x){if(!n)return null;for(;x!==null;)e(_,x),x=x.sibling;return null}function r(_,x){for(_=new Map;x!==null;)x.key!==null?_.set(x.key,x):_.set(x.index,x),x=x.sibling;return _}function s(_,x){return _=ti(_,x),_.index=0,_.sibling=null,_}function i(_,x,C){return _.index=C,n?(C=_.alternate,C!==null?(C=C.index,C<x?(_.flags|=2,x):C):(_.flags|=2,x)):(_.flags|=1048576,x)}function a(_){return n&&_.alternate===null&&(_.flags|=2),_}function o(_,x,C,R){return x===null||x.tag!==6?(x=bm(C,_.mode,R),x.return=_,x):(x=s(x,C),x.return=_,x)}function c(_,x,C,R){var F=C.type;return F===La?h(_,x,C.props.children,R,C.key):x!==null&&(x.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===js&&zv(F)===x.type)?(R=s(x,C.props),R.ref=hl(_,x,C),R.return=_,R):(R=Gu(C.type,C.key,C.props,null,_.mode,R),R.ref=hl(_,x,C),R.return=_,R)}function d(_,x,C,R){return x===null||x.tag!==4||x.stateNode.containerInfo!==C.containerInfo||x.stateNode.implementation!==C.implementation?(x=Em(C,_.mode,R),x.return=_,x):(x=s(x,C.children||[]),x.return=_,x)}function h(_,x,C,R,F){return x===null||x.tag!==7?(x=Hi(C,_.mode,R,F),x.return=_,x):(x=s(x,C),x.return=_,x)}function m(_,x,C){if(typeof x=="string"&&x!==""||typeof x=="number")return x=bm(""+x,_.mode,C),x.return=_,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case du:return C=Gu(x.type,x.key,x.props,null,_.mode,C),C.ref=hl(_,null,x),C.return=_,C;case Va:return x=Em(x,_.mode,C),x.return=_,x;case js:var R=x._init;return m(_,R(x._payload),C)}if(wl(x)||ol(x))return x=Hi(x,_.mode,C,null),x.return=_,x;bu(_,x)}return null}function p(_,x,C,R){var F=x!==null?x.key:null;if(typeof C=="string"&&C!==""||typeof C=="number")return F!==null?null:o(_,x,""+C,R);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case du:return C.key===F?c(_,x,C,R):null;case Va:return C.key===F?d(_,x,C,R):null;case js:return F=C._init,p(_,x,F(C._payload),R)}if(wl(C)||ol(C))return F!==null?null:h(_,x,C,R,null);bu(_,C)}return null}function y(_,x,C,R,F){if(typeof R=="string"&&R!==""||typeof R=="number")return _=_.get(C)||null,o(x,_,""+R,F);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case du:return _=_.get(R.key===null?C:R.key)||null,c(x,_,R,F);case Va:return _=_.get(R.key===null?C:R.key)||null,d(x,_,R,F);case js:var q=R._init;return y(_,x,C,q(R._payload),F)}if(wl(R)||ol(R))return _=_.get(C)||null,h(x,_,R,F,null);bu(x,R)}return null}function E(_,x,C,R){for(var F=null,q=null,T=x,b=x=0,A=null;T!==null&&b<C.length;b++){T.index>b?(A=T,T=null):A=T.sibling;var P=p(_,T,C[b],R);if(P===null){T===null&&(T=A);break}n&&T&&P.alternate===null&&e(_,T),x=i(P,x,b),q===null?F=P:q.sibling=P,q=P,T=A}if(b===C.length)return t(_,T),bt&&ji(_,b),F;if(T===null){for(;b<C.length;b++)T=m(_,C[b],R),T!==null&&(x=i(T,x,b),q===null?F=T:q.sibling=T,q=T);return bt&&ji(_,b),F}for(T=r(_,T);b<C.length;b++)A=y(T,_,b,C[b],R),A!==null&&(n&&A.alternate!==null&&T.delete(A.key===null?b:A.key),x=i(A,x,b),q===null?F=A:q.sibling=A,q=A);return n&&T.forEach(function(D){return e(_,D)}),bt&&ji(_,b),F}function v(_,x,C,R){var F=ol(C);if(typeof F!="function")throw Error(Z(150));if(C=F.call(C),C==null)throw Error(Z(151));for(var q=F=null,T=x,b=x=0,A=null,P=C.next();T!==null&&!P.done;b++,P=C.next()){T.index>b?(A=T,T=null):A=T.sibling;var D=p(_,T,P.value,R);if(D===null){T===null&&(T=A);break}n&&T&&D.alternate===null&&e(_,T),x=i(D,x,b),q===null?F=D:q.sibling=D,q=D,T=A}if(P.done)return t(_,T),bt&&ji(_,b),F;if(T===null){for(;!P.done;b++,P=C.next())P=m(_,P.value,R),P!==null&&(x=i(P,x,b),q===null?F=P:q.sibling=P,q=P);return bt&&ji(_,b),F}for(T=r(_,T);!P.done;b++,P=C.next())P=y(T,_,b,P.value,R),P!==null&&(n&&P.alternate!==null&&T.delete(P.key===null?b:P.key),x=i(P,x,b),q===null?F=P:q.sibling=P,q=P);return n&&T.forEach(function(N){return e(_,N)}),bt&&ji(_,b),F}function I(_,x,C,R){if(typeof C=="object"&&C!==null&&C.type===La&&C.key===null&&(C=C.props.children),typeof C=="object"&&C!==null){switch(C.$$typeof){case du:e:{for(var F=C.key,q=x;q!==null;){if(q.key===F){if(F=C.type,F===La){if(q.tag===7){t(_,q.sibling),x=s(q,C.props.children),x.return=_,_=x;break e}}else if(q.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===js&&zv(F)===q.type){t(_,q.sibling),x=s(q,C.props),x.ref=hl(_,q,C),x.return=_,_=x;break e}t(_,q);break}else e(_,q);q=q.sibling}C.type===La?(x=Hi(C.props.children,_.mode,R,C.key),x.return=_,_=x):(R=Gu(C.type,C.key,C.props,null,_.mode,R),R.ref=hl(_,x,C),R.return=_,_=R)}return a(_);case Va:e:{for(q=C.key;x!==null;){if(x.key===q)if(x.tag===4&&x.stateNode.containerInfo===C.containerInfo&&x.stateNode.implementation===C.implementation){t(_,x.sibling),x=s(x,C.children||[]),x.return=_,_=x;break e}else{t(_,x);break}else e(_,x);x=x.sibling}x=Em(C,_.mode,R),x.return=_,_=x}return a(_);case js:return q=C._init,I(_,x,q(C._payload),R)}if(wl(C))return E(_,x,C,R);if(ol(C))return v(_,x,C,R);bu(_,C)}return typeof C=="string"&&C!==""||typeof C=="number"?(C=""+C,x!==null&&x.tag===6?(t(_,x.sibling),x=s(x,C),x.return=_,_=x):(t(_,x),x=bm(C,_.mode,R),x.return=_,_=x),a(_)):t(_,x)}return I}var co=Cw(!0),Aw=Cw(!1),wd=yi(null),bd=null,Wa=null,Lp=null;function Op(){Lp=Wa=bd=null}function Fp(n){var e=wd.current;vt(wd),n._currentValue=e}function yf(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Za(n,e){bd=n,Lp=Wa=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(qn=!0),n.firstContext=null)}function dr(n){var e=n._currentValue;if(Lp!==n)if(n={context:n,memoizedValue:e,next:null},Wa===null){if(bd===null)throw Error(Z(308));Wa=n,bd.dependencies={lanes:0,firstContext:n}}else Wa=Wa.next=n;return e}var Bi=null;function $p(n){Bi===null?Bi=[n]:Bi.push(n)}function Nw(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,$p(e)):(t.next=s.next,s.next=t),e.interleaved=t,us(n,r)}function us(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Ds=!1;function Up(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Pw(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function as(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Xs(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Xe&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,us(n,t)}return s=r.interleaved,s===null?(e.next=e,$p(r)):(e.next=s.next,s.next=e),r.interleaved=e,us(n,t)}function Uu(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Sp(n,t)}}function qv(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=a:i=i.next=a,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Ed(n,e,t,r){var s=n.updateQueue;Ds=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var c=o,d=c.next;c.next=null,a===null?i=d:a.next=d,a=c;var h=n.alternate;h!==null&&(h=h.updateQueue,o=h.lastBaseUpdate,o!==a&&(o===null?h.firstBaseUpdate=d:o.next=d,h.lastBaseUpdate=c))}if(i!==null){var m=s.baseState;a=0,h=d=c=null,o=i;do{var p=o.lane,y=o.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:y,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var E=n,v=o;switch(p=e,y=t,v.tag){case 1:if(E=v.payload,typeof E=="function"){m=E.call(y,m,p);break e}m=E;break e;case 3:E.flags=E.flags&-65537|128;case 0:if(E=v.payload,p=typeof E=="function"?E.call(y,m,p):E,p==null)break e;m=kt({},m,p);break e;case 2:Ds=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,p=s.effects,p===null?s.effects=[o]:p.push(o))}else y={eventTime:y,lane:p,tag:o.tag,payload:o.payload,callback:o.callback,next:null},h===null?(d=h=y,c=m):h=h.next=y,a|=p;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;p=o,o=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(1);if(h===null&&(c=m),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Xi|=a,n.lanes=a,n.memoizedState=m}}function Wv(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(Z(191,s));s.call(r)}}}var Nc={},Or=yi(Nc),rc=yi(Nc),sc=yi(Nc);function zi(n){if(n===Nc)throw Error(Z(174));return n}function Bp(n,e){switch(ht(sc,e),ht(rc,n),ht(Or,Nc),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ym(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Ym(e,n)}vt(Or),ht(Or,e)}function uo(){vt(Or),vt(rc),vt(sc)}function kw(n){zi(sc.current);var e=zi(Or.current),t=Ym(e,n.type);e!==t&&(ht(rc,n),ht(Or,t))}function zp(n){rc.current===n&&(vt(Or),vt(rc))}var At=yi(0);function Td(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var gm=[];function qp(){for(var n=0;n<gm.length;n++)gm[n]._workInProgressVersionPrimary=null;gm.length=0}var Bu=gs.ReactCurrentDispatcher,ym=gs.ReactCurrentBatchConfig,Ji=0,Nt=null,Kt=null,nn=null,Id=!1,Ml=!1,ic=0,LA=0;function wn(){throw Error(Z(321))}function Wp(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Cr(n[t],e[t]))return!1;return!0}function Hp(n,e,t,r,s,i){if(Ji=i,Nt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Bu.current=n===null||n.memoizedState===null?UA:BA,n=t(r,s),Ml){i=0;do{if(Ml=!1,ic=0,25<=i)throw Error(Z(301));i+=1,nn=Kt=null,e.updateQueue=null,Bu.current=zA,n=t(r,s)}while(Ml)}if(Bu.current=Sd,e=Kt!==null&&Kt.next!==null,Ji=0,nn=Kt=Nt=null,Id=!1,e)throw Error(Z(300));return n}function Gp(){var n=ic!==0;return ic=0,n}function kr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return nn===null?Nt.memoizedState=nn=n:nn=nn.next=n,nn}function hr(){if(Kt===null){var n=Nt.alternate;n=n!==null?n.memoizedState:null}else n=Kt.next;var e=nn===null?Nt.memoizedState:nn.next;if(e!==null)nn=e,Kt=n;else{if(n===null)throw Error(Z(310));Kt=n,n={memoizedState:Kt.memoizedState,baseState:Kt.baseState,baseQueue:Kt.baseQueue,queue:Kt.queue,next:null},nn===null?Nt.memoizedState=nn=n:nn=nn.next=n}return nn}function ac(n,e){return typeof e=="function"?e(n):e}function vm(n){var e=hr(),t=e.queue;if(t===null)throw Error(Z(311));t.lastRenderedReducer=n;var r=Kt,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var o=a=null,c=null,d=i;do{var h=d.lane;if((Ji&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:n(r,d.action);else{var m={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(o=c=m,a=r):c=c.next=m,Nt.lanes|=h,Xi|=h}d=d.next}while(d!==null&&d!==i);c===null?a=r:c.next=o,Cr(r,e.memoizedState)||(qn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=c,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,Nt.lanes|=i,Xi|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function xm(n){var e=hr(),t=e.queue;if(t===null)throw Error(Z(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var a=s=s.next;do i=n(i,a.action),a=a.next;while(a!==s);Cr(i,e.memoizedState)||(qn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function Rw(){}function jw(n,e){var t=Nt,r=hr(),s=e(),i=!Cr(r.memoizedState,s);if(i&&(r.memoizedState=s,qn=!0),r=r.queue,Kp(Vw.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||nn!==null&&nn.memoizedState.tag&1){if(t.flags|=2048,oc(9,Mw.bind(null,t,r,s,e),void 0,null),sn===null)throw Error(Z(349));Ji&30||Dw(t,e,s)}return s}function Dw(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Nt.updateQueue,e===null?(e={lastEffect:null,stores:null},Nt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Mw(n,e,t,r){e.value=t,e.getSnapshot=r,Lw(e)&&Ow(n)}function Vw(n,e,t){return t(function(){Lw(e)&&Ow(n)})}function Lw(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Cr(n,t)}catch{return!0}}function Ow(n){var e=us(n,1);e!==null&&Sr(e,n,1,-1)}function Hv(n){var e=kr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ac,lastRenderedState:n},e.queue=n,n=n.dispatch=$A.bind(null,Nt,n),[e.memoizedState,n]}function oc(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Nt.updateQueue,e===null?(e={lastEffect:null,stores:null},Nt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Fw(){return hr().memoizedState}function zu(n,e,t,r){var s=kr();Nt.flags|=n,s.memoizedState=oc(1|e,t,void 0,r===void 0?null:r)}function ch(n,e,t,r){var s=hr();r=r===void 0?null:r;var i=void 0;if(Kt!==null){var a=Kt.memoizedState;if(i=a.destroy,r!==null&&Wp(r,a.deps)){s.memoizedState=oc(e,t,i,r);return}}Nt.flags|=n,s.memoizedState=oc(1|e,t,i,r)}function Gv(n,e){return zu(8390656,8,n,e)}function Kp(n,e){return ch(2048,8,n,e)}function $w(n,e){return ch(4,2,n,e)}function Uw(n,e){return ch(4,4,n,e)}function Bw(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function zw(n,e,t){return t=t!=null?t.concat([n]):null,ch(4,4,Bw.bind(null,e,n),t)}function Qp(){}function qw(n,e){var t=hr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Wp(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Ww(n,e){var t=hr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Wp(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Hw(n,e,t){return Ji&21?(Cr(t,e)||(t=J_(),Nt.lanes|=t,Xi|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,qn=!0),n.memoizedState=t)}function OA(n,e){var t=st;st=t!==0&&4>t?t:4,n(!0);var r=ym.transition;ym.transition={};try{n(!1),e()}finally{st=t,ym.transition=r}}function Gw(){return hr().memoizedState}function FA(n,e,t){var r=ei(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Kw(n))Qw(e,t);else if(t=Nw(n,e,t,r),t!==null){var s=On();Sr(t,n,r,s),Yw(t,e,r)}}function $A(n,e,t){var r=ei(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Kw(n))Qw(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,o=i(a,t);if(s.hasEagerState=!0,s.eagerState=o,Cr(o,a)){var c=e.interleaved;c===null?(s.next=s,$p(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}t=Nw(n,e,s,r),t!==null&&(s=On(),Sr(t,n,r,s),Yw(t,e,r))}}function Kw(n){var e=n.alternate;return n===Nt||e!==null&&e===Nt}function Qw(n,e){Ml=Id=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Yw(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Sp(n,t)}}var Sd={readContext:dr,useCallback:wn,useContext:wn,useEffect:wn,useImperativeHandle:wn,useInsertionEffect:wn,useLayoutEffect:wn,useMemo:wn,useReducer:wn,useRef:wn,useState:wn,useDebugValue:wn,useDeferredValue:wn,useTransition:wn,useMutableSource:wn,useSyncExternalStore:wn,useId:wn,unstable_isNewReconciler:!1},UA={readContext:dr,useCallback:function(n,e){return kr().memoizedState=[n,e===void 0?null:e],n},useContext:dr,useEffect:Gv,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,zu(4194308,4,Bw.bind(null,e,n),t)},useLayoutEffect:function(n,e){return zu(4194308,4,n,e)},useInsertionEffect:function(n,e){return zu(4,2,n,e)},useMemo:function(n,e){var t=kr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=kr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=FA.bind(null,Nt,n),[r.memoizedState,n]},useRef:function(n){var e=kr();return n={current:n},e.memoizedState=n},useState:Hv,useDebugValue:Qp,useDeferredValue:function(n){return kr().memoizedState=n},useTransition:function(){var n=Hv(!1),e=n[0];return n=OA.bind(null,n[1]),kr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Nt,s=kr();if(bt){if(t===void 0)throw Error(Z(407));t=t()}else{if(t=e(),sn===null)throw Error(Z(349));Ji&30||Dw(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,Gv(Vw.bind(null,r,i,n),[n]),r.flags|=2048,oc(9,Mw.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=kr(),e=sn.identifierPrefix;if(bt){var t=ts,r=es;t=(r&~(1<<32-Ir(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=ic++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=LA++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},BA={readContext:dr,useCallback:qw,useContext:dr,useEffect:Kp,useImperativeHandle:zw,useInsertionEffect:$w,useLayoutEffect:Uw,useMemo:Ww,useReducer:vm,useRef:Fw,useState:function(){return vm(ac)},useDebugValue:Qp,useDeferredValue:function(n){var e=hr();return Hw(e,Kt.memoizedState,n)},useTransition:function(){var n=vm(ac)[0],e=hr().memoizedState;return[n,e]},useMutableSource:Rw,useSyncExternalStore:jw,useId:Gw,unstable_isNewReconciler:!1},zA={readContext:dr,useCallback:qw,useContext:dr,useEffect:Kp,useImperativeHandle:zw,useInsertionEffect:$w,useLayoutEffect:Uw,useMemo:Ww,useReducer:xm,useRef:Fw,useState:function(){return xm(ac)},useDebugValue:Qp,useDeferredValue:function(n){var e=hr();return Kt===null?e.memoizedState=n:Hw(e,Kt.memoizedState,n)},useTransition:function(){var n=xm(ac)[0],e=hr().memoizedState;return[n,e]},useMutableSource:Rw,useSyncExternalStore:jw,useId:Gw,unstable_isNewReconciler:!1};function br(n,e){if(n&&n.defaultProps){e=kt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function vf(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:kt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var uh={isMounted:function(n){return(n=n._reactInternals)?ma(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=On(),s=ei(n),i=as(r,s);i.payload=e,t!=null&&(i.callback=t),e=Xs(n,i,s),e!==null&&(Sr(e,n,s,r),Uu(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=On(),s=ei(n),i=as(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Xs(n,i,s),e!==null&&(Sr(e,n,s,r),Uu(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=On(),r=ei(n),s=as(t,r);s.tag=2,e!=null&&(s.callback=e),e=Xs(n,s,r),e!==null&&(Sr(e,n,r,t),Uu(e,n,r))}};function Kv(n,e,t,r,s,i,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!Zl(t,r)||!Zl(s,i):!0}function Jw(n,e,t){var r=!1,s=oi,i=e.contextType;return typeof i=="object"&&i!==null?i=dr(i):(s=Qn(e)?Qi:Nn.current,r=e.contextTypes,i=(r=r!=null)?oo(n,s):oi),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=uh,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function Qv(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&uh.enqueueReplaceState(e,e.state,null)}function xf(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},Up(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=dr(i):(i=Qn(e)?Qi:Nn.current,s.context=oo(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(vf(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&uh.enqueueReplaceState(s,s.state,null),Ed(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function ho(n,e){try{var t="",r=e;do t+=yC(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function _m(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function _f(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var qA=typeof WeakMap=="function"?WeakMap:Map;function Xw(n,e,t){t=as(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Ad||(Ad=!0,Pf=r),_f(n,e)},t}function Zw(n,e,t){t=as(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){_f(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){_f(n,e),typeof r!="function"&&(Zs===null?Zs=new Set([this]):Zs.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function Yv(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new qA;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=s1.bind(null,n,e,t),e.then(n,n))}function Jv(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Xv(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=as(-1,1),e.tag=2,Xs(t,e,1))),t.lanes|=1),n)}var WA=gs.ReactCurrentOwner,qn=!1;function Ln(n,e,t,r){e.child=n===null?Aw(e,null,t,r):co(e,n.child,t,r)}function Zv(n,e,t,r,s){t=t.render;var i=e.ref;return Za(e,s),r=Hp(n,e,t,r,i,s),t=Gp(),n!==null&&!qn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ds(n,e,s)):(bt&&t&&Dp(e),e.flags|=1,Ln(n,e,r,s),e.child)}function e0(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!rg(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,eb(n,e,i,r,s)):(n=Gu(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var a=i.memoizedProps;if(t=t.compare,t=t!==null?t:Zl,t(a,r)&&n.ref===e.ref)return ds(n,e,s)}return e.flags|=1,n=ti(i,r),n.ref=e.ref,n.return=e,e.child=n}function eb(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(Zl(i,r)&&n.ref===e.ref)if(qn=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(qn=!0);else return e.lanes=n.lanes,ds(n,e,s)}return wf(n,e,t,r,s)}function tb(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ht(Ga,er),er|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,ht(Ga,er),er|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,ht(Ga,er),er|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,ht(Ga,er),er|=r;return Ln(n,e,s,t),e.child}function nb(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function wf(n,e,t,r,s){var i=Qn(t)?Qi:Nn.current;return i=oo(e,i),Za(e,s),t=Hp(n,e,t,r,i,s),r=Gp(),n!==null&&!qn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ds(n,e,s)):(bt&&r&&Dp(e),e.flags|=1,Ln(n,e,t,s),e.child)}function t0(n,e,t,r,s){if(Qn(t)){var i=!0;vd(e)}else i=!1;if(Za(e,s),e.stateNode===null)qu(n,e),Jw(e,t,r),xf(e,t,r,s),r=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var c=a.context,d=t.contextType;typeof d=="object"&&d!==null?d=dr(d):(d=Qn(t)?Qi:Nn.current,d=oo(e,d));var h=t.getDerivedStateFromProps,m=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";m||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||c!==d)&&Qv(e,a,r,d),Ds=!1;var p=e.memoizedState;a.state=p,Ed(e,r,a,s),c=e.memoizedState,o!==r||p!==c||Kn.current||Ds?(typeof h=="function"&&(vf(e,t,h,r),c=e.memoizedState),(o=Ds||Kv(e,t,o,r,p,c,d))?(m||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),a.props=r,a.state=c,a.context=d,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,Pw(n,e),o=e.memoizedProps,d=e.type===e.elementType?o:br(e.type,o),a.props=d,m=e.pendingProps,p=a.context,c=t.contextType,typeof c=="object"&&c!==null?c=dr(c):(c=Qn(t)?Qi:Nn.current,c=oo(e,c));var y=t.getDerivedStateFromProps;(h=typeof y=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==m||p!==c)&&Qv(e,a,r,c),Ds=!1,p=e.memoizedState,a.state=p,Ed(e,r,a,s);var E=e.memoizedState;o!==m||p!==E||Kn.current||Ds?(typeof y=="function"&&(vf(e,t,y,r),E=e.memoizedState),(d=Ds||Kv(e,t,d,r,p,E,c)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,E,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,E,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=E),a.props=r,a.state=E,a.context=c,r=d):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),r=!1)}return bf(n,e,t,r,i,s)}function bf(n,e,t,r,s,i){nb(n,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&$v(e,t,!1),ds(n,e,i);r=e.stateNode,WA.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&a?(e.child=co(e,n.child,null,i),e.child=co(e,null,o,i)):Ln(n,e,o,i),e.memoizedState=r.state,s&&$v(e,t,!0),e.child}function rb(n){var e=n.stateNode;e.pendingContext?Fv(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Fv(n,e.context,!1),Bp(n,e.containerInfo)}function n0(n,e,t,r,s){return lo(),Vp(s),e.flags|=256,Ln(n,e,t,r),e.child}var Ef={dehydrated:null,treeContext:null,retryLane:0};function Tf(n){return{baseLanes:n,cachePool:null,transitions:null}}function sb(n,e,t){var r=e.pendingProps,s=At.current,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(s&2)!==0),o?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),ht(At,s&1),n===null)return gf(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,n=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=mh(a,r,0,null),n=Hi(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=Tf(t),e.memoizedState=Ef,n):Yp(e,a));if(s=n.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return HA(n,e,a,r,o,s,t);if(i){i=r.fallback,a=e.mode,s=n.child,o=s.sibling;var c={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=ti(s,c),r.subtreeFlags=s.subtreeFlags&14680064),o!==null?i=ti(o,i):(i=Hi(i,a,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=n.child.memoizedState,a=a===null?Tf(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=n.childLanes&~t,e.memoizedState=Ef,r}return i=n.child,n=i.sibling,r=ti(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Yp(n,e){return e=mh({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Eu(n,e,t,r){return r!==null&&Vp(r),co(e,n.child,null,t),n=Yp(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function HA(n,e,t,r,s,i,a){if(t)return e.flags&256?(e.flags&=-257,r=_m(Error(Z(422))),Eu(n,e,a,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=mh({mode:"visible",children:r.children},s,0,null),i=Hi(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&co(e,n.child,null,a),e.child.memoizedState=Tf(a),e.memoizedState=Ef,i);if(!(e.mode&1))return Eu(n,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var o=r.dgst;return r=o,i=Error(Z(419)),r=_m(i,r,void 0),Eu(n,e,a,r)}if(o=(a&n.childLanes)!==0,qn||o){if(r=sn,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,us(n,s),Sr(r,n,s,-1))}return ng(),r=_m(Error(Z(421))),Eu(n,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=i1.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,tr=Js(s.nextSibling),nr=e,bt=!0,Tr=null,n!==null&&(or[lr++]=es,or[lr++]=ts,or[lr++]=Yi,es=n.id,ts=n.overflow,Yi=e),e=Yp(e,r.children),e.flags|=4096,e)}function r0(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),yf(n.return,e,t)}function wm(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function ib(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Ln(n,e,r.children,t),r=At.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&r0(n,t,e);else if(n.tag===19)r0(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(ht(At,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Td(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),wm(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Td(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}wm(e,!0,t,null,i);break;case"together":wm(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function qu(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ds(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Xi|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Z(153));if(e.child!==null){for(n=e.child,t=ti(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=ti(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function GA(n,e,t){switch(e.tag){case 3:rb(e),lo();break;case 5:kw(e);break;case 1:Qn(e.type)&&vd(e);break;case 4:Bp(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;ht(wd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ht(At,At.current&1),e.flags|=128,null):t&e.child.childLanes?sb(n,e,t):(ht(At,At.current&1),n=ds(n,e,t),n!==null?n.sibling:null);ht(At,At.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return ib(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),ht(At,At.current),r)break;return null;case 22:case 23:return e.lanes=0,tb(n,e,t)}return ds(n,e,t)}var ab,If,ob,lb;ab=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};If=function(){};ob=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,zi(Or.current);var i=null;switch(t){case"input":s=Hm(n,s),r=Hm(n,r),i=[];break;case"select":s=kt({},s,{value:void 0}),r=kt({},r,{value:void 0}),i=[];break;case"textarea":s=Qm(n,s),r=Qm(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=gd)}Jm(t,r);var a;t=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var o=s[d];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Hl.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(o=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==o&&(c!=null||o!=null))if(d==="style")if(o){for(a in o)!o.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in c)c.hasOwnProperty(a)&&o[a]!==c[a]&&(t||(t={}),t[a]=c[a])}else t||(i||(i=[]),i.push(d,t)),t=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,o=o?o.__html:void 0,c!=null&&o!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Hl.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&gt("scroll",n),i||o===c||(i=[])):(i=i||[]).push(d,c))}t&&(i=i||[]).push("style",t);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};lb=function(n,e,t,r){t!==r&&(e.flags|=4)};function ml(n,e){if(!bt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function bn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function KA(n,e,t){var r=e.pendingProps;switch(Mp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bn(e),null;case 1:return Qn(e.type)&&yd(),bn(e),null;case 3:return r=e.stateNode,uo(),vt(Kn),vt(Nn),qp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(wu(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Tr!==null&&(jf(Tr),Tr=null))),If(n,e),bn(e),null;case 5:zp(e);var s=zi(sc.current);if(t=e.type,n!==null&&e.stateNode!=null)ob(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Z(166));return bn(e),null}if(n=zi(Or.current),wu(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[jr]=e,r[nc]=i,n=(e.mode&1)!==0,t){case"dialog":gt("cancel",r),gt("close",r);break;case"iframe":case"object":case"embed":gt("load",r);break;case"video":case"audio":for(s=0;s<El.length;s++)gt(El[s],r);break;case"source":gt("error",r);break;case"img":case"image":case"link":gt("error",r),gt("load",r);break;case"details":gt("toggle",r);break;case"input":hv(r,i),gt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},gt("invalid",r);break;case"textarea":fv(r,i),gt("invalid",r)}Jm(t,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?r.textContent!==o&&(i.suppressHydrationWarning!==!0&&_u(r.textContent,o,n),s=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&_u(r.textContent,o,n),s=["children",""+o]):Hl.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&gt("scroll",r)}switch(t){case"input":hu(r),mv(r,i,!0);break;case"textarea":hu(r),pv(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=gd)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=V_(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=a.createElement(t,{is:r.is}):(n=a.createElement(t),t==="select"&&(a=n,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):n=a.createElementNS(n,t),n[jr]=e,n[nc]=r,ab(n,e,!1,!1),e.stateNode=n;e:{switch(a=Xm(t,r),t){case"dialog":gt("cancel",n),gt("close",n),s=r;break;case"iframe":case"object":case"embed":gt("load",n),s=r;break;case"video":case"audio":for(s=0;s<El.length;s++)gt(El[s],n);s=r;break;case"source":gt("error",n),s=r;break;case"img":case"image":case"link":gt("error",n),gt("load",n),s=r;break;case"details":gt("toggle",n),s=r;break;case"input":hv(n,r),s=Hm(n,r),gt("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=kt({},r,{value:void 0}),gt("invalid",n);break;case"textarea":fv(n,r),s=Qm(n,r),gt("invalid",n);break;default:s=r}Jm(t,s),o=s;for(i in o)if(o.hasOwnProperty(i)){var c=o[i];i==="style"?F_(n,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&L_(n,c)):i==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&Gl(n,c):typeof c=="number"&&Gl(n,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Hl.hasOwnProperty(i)?c!=null&&i==="onScroll"&&gt("scroll",n):c!=null&&_p(n,i,c,a))}switch(t){case"input":hu(n),mv(n,r,!1);break;case"textarea":hu(n),pv(n);break;case"option":r.value!=null&&n.setAttribute("value",""+ai(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Qa(n,!!r.multiple,i,!1):r.defaultValue!=null&&Qa(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=gd)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return bn(e),null;case 6:if(n&&e.stateNode!=null)lb(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Z(166));if(t=zi(sc.current),zi(Or.current),wu(e)){if(r=e.stateNode,t=e.memoizedProps,r[jr]=e,(i=r.nodeValue!==t)&&(n=nr,n!==null))switch(n.tag){case 3:_u(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&_u(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[jr]=e,e.stateNode=r}return bn(e),null;case 13:if(vt(At),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(bt&&tr!==null&&e.mode&1&&!(e.flags&128))Sw(),lo(),e.flags|=98560,i=!1;else if(i=wu(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(Z(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Z(317));i[jr]=e}else lo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;bn(e),i=!1}else Tr!==null&&(jf(Tr),Tr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||At.current&1?Qt===0&&(Qt=3):ng())),e.updateQueue!==null&&(e.flags|=4),bn(e),null);case 4:return uo(),If(n,e),n===null&&ec(e.stateNode.containerInfo),bn(e),null;case 10:return Fp(e.type._context),bn(e),null;case 17:return Qn(e.type)&&yd(),bn(e),null;case 19:if(vt(At),i=e.memoizedState,i===null)return bn(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)ml(i,!1);else{if(Qt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=Td(n),a!==null){for(e.flags|=128,ml(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,n=a.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return ht(At,At.current&1|2),e.child}n=n.sibling}i.tail!==null&&$t()>mo&&(e.flags|=128,r=!0,ml(i,!1),e.lanes=4194304)}else{if(!r)if(n=Td(a),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),ml(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!bt)return bn(e),null}else 2*$t()-i.renderingStartTime>mo&&t!==1073741824&&(e.flags|=128,r=!0,ml(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(t=i.last,t!==null?t.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=$t(),e.sibling=null,t=At.current,ht(At,r?t&1|2:t&1),e):(bn(e),null);case 22:case 23:return tg(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?er&1073741824&&(bn(e),e.subtreeFlags&6&&(e.flags|=8192)):bn(e),null;case 24:return null;case 25:return null}throw Error(Z(156,e.tag))}function QA(n,e){switch(Mp(e),e.tag){case 1:return Qn(e.type)&&yd(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return uo(),vt(Kn),vt(Nn),qp(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return zp(e),null;case 13:if(vt(At),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Z(340));lo()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return vt(At),null;case 4:return uo(),null;case 10:return Fp(e.type._context),null;case 22:case 23:return tg(),null;case 24:return null;default:return null}}var Tu=!1,Sn=!1,YA=typeof WeakSet=="function"?WeakSet:Set,he=null;function Ha(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Vt(n,e,r)}else t.current=null}function Sf(n,e,t){try{t()}catch(r){Vt(n,e,r)}}var s0=!1;function JA(n,e){if(cf=md,n=mw(),jp(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var a=0,o=-1,c=-1,d=0,h=0,m=n,p=null;t:for(;;){for(var y;m!==t||s!==0&&m.nodeType!==3||(o=a+s),m!==i||r!==0&&m.nodeType!==3||(c=a+r),m.nodeType===3&&(a+=m.nodeValue.length),(y=m.firstChild)!==null;)p=m,m=y;for(;;){if(m===n)break t;if(p===t&&++d===s&&(o=a),p===i&&++h===r&&(c=a),(y=m.nextSibling)!==null)break;m=p,p=m.parentNode}m=y}t=o===-1||c===-1?null:{start:o,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(uf={focusedElem:n,selectionRange:t},md=!1,he=e;he!==null;)if(e=he,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,he=n;else for(;he!==null;){e=he;try{var E=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(E!==null){var v=E.memoizedProps,I=E.memoizedState,_=e.stateNode,x=_.getSnapshotBeforeUpdate(e.elementType===e.type?v:br(e.type,v),I);_.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var C=e.stateNode.containerInfo;C.nodeType===1?C.textContent="":C.nodeType===9&&C.documentElement&&C.removeChild(C.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Z(163))}}catch(R){Vt(e,e.return,R)}if(n=e.sibling,n!==null){n.return=e.return,he=n;break}he=e.return}return E=s0,s0=!1,E}function Vl(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&Sf(e,t,i)}s=s.next}while(s!==r)}}function dh(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Cf(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function cb(n){var e=n.alternate;e!==null&&(n.alternate=null,cb(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[jr],delete e[nc],delete e[mf],delete e[jA],delete e[DA])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function ub(n){return n.tag===5||n.tag===3||n.tag===4}function i0(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||ub(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Af(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=gd));else if(r!==4&&(n=n.child,n!==null))for(Af(n,e,t),n=n.sibling;n!==null;)Af(n,e,t),n=n.sibling}function Nf(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Nf(n,e,t),n=n.sibling;n!==null;)Nf(n,e,t),n=n.sibling}var dn=null,Er=!1;function Ns(n,e,t){for(t=t.child;t!==null;)db(n,e,t),t=t.sibling}function db(n,e,t){if(Lr&&typeof Lr.onCommitFiberUnmount=="function")try{Lr.onCommitFiberUnmount(rh,t)}catch{}switch(t.tag){case 5:Sn||Ha(t,e);case 6:var r=dn,s=Er;dn=null,Ns(n,e,t),dn=r,Er=s,dn!==null&&(Er?(n=dn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):dn.removeChild(t.stateNode));break;case 18:dn!==null&&(Er?(n=dn,t=t.stateNode,n.nodeType===8?fm(n.parentNode,t):n.nodeType===1&&fm(n,t),Jl(n)):fm(dn,t.stateNode));break;case 4:r=dn,s=Er,dn=t.stateNode.containerInfo,Er=!0,Ns(n,e,t),dn=r,Er=s;break;case 0:case 11:case 14:case 15:if(!Sn&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&Sf(t,e,a),s=s.next}while(s!==r)}Ns(n,e,t);break;case 1:if(!Sn&&(Ha(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(o){Vt(t,e,o)}Ns(n,e,t);break;case 21:Ns(n,e,t);break;case 22:t.mode&1?(Sn=(r=Sn)||t.memoizedState!==null,Ns(n,e,t),Sn=r):Ns(n,e,t);break;default:Ns(n,e,t)}}function a0(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new YA),e.forEach(function(r){var s=a1.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function wr(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:dn=o.stateNode,Er=!1;break e;case 3:dn=o.stateNode.containerInfo,Er=!0;break e;case 4:dn=o.stateNode.containerInfo,Er=!0;break e}o=o.return}if(dn===null)throw Error(Z(160));db(i,a,s),dn=null,Er=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){Vt(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)hb(e,n),e=e.sibling}function hb(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(wr(e,n),Pr(n),r&4){try{Vl(3,n,n.return),dh(3,n)}catch(v){Vt(n,n.return,v)}try{Vl(5,n,n.return)}catch(v){Vt(n,n.return,v)}}break;case 1:wr(e,n),Pr(n),r&512&&t!==null&&Ha(t,t.return);break;case 5:if(wr(e,n),Pr(n),r&512&&t!==null&&Ha(t,t.return),n.flags&32){var s=n.stateNode;try{Gl(s,"")}catch(v){Vt(n,n.return,v)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,a=t!==null?t.memoizedProps:i,o=n.type,c=n.updateQueue;if(n.updateQueue=null,c!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&D_(s,i),Xm(o,a);var d=Xm(o,i);for(a=0;a<c.length;a+=2){var h=c[a],m=c[a+1];h==="style"?F_(s,m):h==="dangerouslySetInnerHTML"?L_(s,m):h==="children"?Gl(s,m):_p(s,h,m,d)}switch(o){case"input":Gm(s,i);break;case"textarea":M_(s,i);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?Qa(s,!!i.multiple,y,!1):p!==!!i.multiple&&(i.defaultValue!=null?Qa(s,!!i.multiple,i.defaultValue,!0):Qa(s,!!i.multiple,i.multiple?[]:"",!1))}s[nc]=i}catch(v){Vt(n,n.return,v)}}break;case 6:if(wr(e,n),Pr(n),r&4){if(n.stateNode===null)throw Error(Z(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(v){Vt(n,n.return,v)}}break;case 3:if(wr(e,n),Pr(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Jl(e.containerInfo)}catch(v){Vt(n,n.return,v)}break;case 4:wr(e,n),Pr(n);break;case 13:wr(e,n),Pr(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Zp=$t())),r&4&&a0(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(Sn=(d=Sn)||h,wr(e,n),Sn=d):wr(e,n),Pr(n),r&8192){if(d=n.memoizedState!==null,(n.stateNode.isHidden=d)&&!h&&n.mode&1)for(he=n,h=n.child;h!==null;){for(m=he=h;he!==null;){switch(p=he,y=p.child,p.tag){case 0:case 11:case 14:case 15:Vl(4,p,p.return);break;case 1:Ha(p,p.return);var E=p.stateNode;if(typeof E.componentWillUnmount=="function"){r=p,t=p.return;try{e=r,E.props=e.memoizedProps,E.state=e.memoizedState,E.componentWillUnmount()}catch(v){Vt(r,t,v)}}break;case 5:Ha(p,p.return);break;case 22:if(p.memoizedState!==null){l0(m);continue}}y!==null?(y.return=p,he=y):l0(m)}h=h.sibling}e:for(h=null,m=n;;){if(m.tag===5){if(h===null){h=m;try{s=m.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=m.stateNode,c=m.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,o.style.display=O_("display",a))}catch(v){Vt(n,n.return,v)}}}else if(m.tag===6){if(h===null)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(v){Vt(n,n.return,v)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===n)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===n)break e;for(;m.sibling===null;){if(m.return===null||m.return===n)break e;h===m&&(h=null),m=m.return}h===m&&(h=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:wr(e,n),Pr(n),r&4&&a0(n);break;case 21:break;default:wr(e,n),Pr(n)}}function Pr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(ub(t)){var r=t;break e}t=t.return}throw Error(Z(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Gl(s,""),r.flags&=-33);var i=i0(n);Nf(n,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,o=i0(n);Af(n,o,a);break;default:throw Error(Z(161))}}catch(c){Vt(n,n.return,c)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function XA(n,e,t){he=n,mb(n)}function mb(n,e,t){for(var r=(n.mode&1)!==0;he!==null;){var s=he,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||Tu;if(!a){var o=s.alternate,c=o!==null&&o.memoizedState!==null||Sn;o=Tu;var d=Sn;if(Tu=a,(Sn=c)&&!d)for(he=s;he!==null;)a=he,c=a.child,a.tag===22&&a.memoizedState!==null?c0(s):c!==null?(c.return=a,he=c):c0(s);for(;i!==null;)he=i,mb(i),i=i.sibling;he=s,Tu=o,Sn=d}o0(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,he=i):o0(n)}}function o0(n){for(;he!==null;){var e=he;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Sn||dh(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Sn)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:br(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Wv(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Wv(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var m=h.dehydrated;m!==null&&Jl(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Z(163))}Sn||e.flags&512&&Cf(e)}catch(p){Vt(e,e.return,p)}}if(e===n){he=null;break}if(t=e.sibling,t!==null){t.return=e.return,he=t;break}he=e.return}}function l0(n){for(;he!==null;){var e=he;if(e===n){he=null;break}var t=e.sibling;if(t!==null){t.return=e.return,he=t;break}he=e.return}}function c0(n){for(;he!==null;){var e=he;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{dh(4,e)}catch(c){Vt(e,t,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Vt(e,s,c)}}var i=e.return;try{Cf(e)}catch(c){Vt(e,i,c)}break;case 5:var a=e.return;try{Cf(e)}catch(c){Vt(e,a,c)}}}catch(c){Vt(e,e.return,c)}if(e===n){he=null;break}var o=e.sibling;if(o!==null){o.return=e.return,he=o;break}he=e.return}}var ZA=Math.ceil,Cd=gs.ReactCurrentDispatcher,Jp=gs.ReactCurrentOwner,ur=gs.ReactCurrentBatchConfig,Xe=0,sn=null,Ht=null,fn=0,er=0,Ga=yi(0),Qt=0,lc=null,Xi=0,hh=0,Xp=0,Ll=null,zn=null,Zp=0,mo=1/0,Yr=null,Ad=!1,Pf=null,Zs=null,Iu=!1,Ws=null,Nd=0,Ol=0,kf=null,Wu=-1,Hu=0;function On(){return Xe&6?$t():Wu!==-1?Wu:Wu=$t()}function ei(n){return n.mode&1?Xe&2&&fn!==0?fn&-fn:VA.transition!==null?(Hu===0&&(Hu=J_()),Hu):(n=st,n!==0||(n=window.event,n=n===void 0?16:sw(n.type)),n):1}function Sr(n,e,t,r){if(50<Ol)throw Ol=0,kf=null,Error(Z(185));Sc(n,t,r),(!(Xe&2)||n!==sn)&&(n===sn&&(!(Xe&2)&&(hh|=t),Qt===4&&Vs(n,fn)),Yn(n,r),t===1&&Xe===0&&!(e.mode&1)&&(mo=$t()+500,lh&&vi()))}function Yn(n,e){var t=n.callbackNode;VC(n,e);var r=hd(n,n===sn?fn:0);if(r===0)t!==null&&vv(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&vv(t),e===1)n.tag===0?MA(u0.bind(null,n)):Ew(u0.bind(null,n)),kA(function(){!(Xe&6)&&vi()}),t=null;else{switch(X_(r)){case 1:t=Ip;break;case 4:t=Q_;break;case 16:t=dd;break;case 536870912:t=Y_;break;default:t=dd}t=wb(t,fb.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function fb(n,e){if(Wu=-1,Hu=0,Xe&6)throw Error(Z(327));var t=n.callbackNode;if(eo()&&n.callbackNode!==t)return null;var r=hd(n,n===sn?fn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Pd(n,r);else{e=r;var s=Xe;Xe|=2;var i=gb();(sn!==n||fn!==e)&&(Yr=null,mo=$t()+500,Wi(n,e));do try{n1();break}catch(o){pb(n,o)}while(1);Op(),Cd.current=i,Xe=s,Ht!==null?e=0:(sn=null,fn=0,e=Qt)}if(e!==0){if(e===2&&(s=rf(n),s!==0&&(r=s,e=Rf(n,s))),e===1)throw t=lc,Wi(n,0),Vs(n,r),Yn(n,$t()),t;if(e===6)Vs(n,r);else{if(s=n.current.alternate,!(r&30)&&!e1(s)&&(e=Pd(n,r),e===2&&(i=rf(n),i!==0&&(r=i,e=Rf(n,i))),e===1))throw t=lc,Wi(n,0),Vs(n,r),Yn(n,$t()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(Z(345));case 2:Di(n,zn,Yr);break;case 3:if(Vs(n,r),(r&130023424)===r&&(e=Zp+500-$t(),10<e)){if(hd(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){On(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=hf(Di.bind(null,n,zn,Yr),e);break}Di(n,zn,Yr);break;case 4:if(Vs(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var a=31-Ir(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=$t()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*ZA(r/1960))-r,10<r){n.timeoutHandle=hf(Di.bind(null,n,zn,Yr),r);break}Di(n,zn,Yr);break;case 5:Di(n,zn,Yr);break;default:throw Error(Z(329))}}}return Yn(n,$t()),n.callbackNode===t?fb.bind(null,n):null}function Rf(n,e){var t=Ll;return n.current.memoizedState.isDehydrated&&(Wi(n,e).flags|=256),n=Pd(n,e),n!==2&&(e=zn,zn=t,e!==null&&jf(e)),n}function jf(n){zn===null?zn=n:zn.push.apply(zn,n)}function e1(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!Cr(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Vs(n,e){for(e&=~Xp,e&=~hh,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Ir(e),r=1<<t;n[t]=-1,e&=~r}}function u0(n){if(Xe&6)throw Error(Z(327));eo();var e=hd(n,0);if(!(e&1))return Yn(n,$t()),null;var t=Pd(n,e);if(n.tag!==0&&t===2){var r=rf(n);r!==0&&(e=r,t=Rf(n,r))}if(t===1)throw t=lc,Wi(n,0),Vs(n,e),Yn(n,$t()),t;if(t===6)throw Error(Z(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Di(n,zn,Yr),Yn(n,$t()),null}function eg(n,e){var t=Xe;Xe|=1;try{return n(e)}finally{Xe=t,Xe===0&&(mo=$t()+500,lh&&vi())}}function Zi(n){Ws!==null&&Ws.tag===0&&!(Xe&6)&&eo();var e=Xe;Xe|=1;var t=ur.transition,r=st;try{if(ur.transition=null,st=1,n)return n()}finally{st=r,ur.transition=t,Xe=e,!(Xe&6)&&vi()}}function tg(){er=Ga.current,vt(Ga)}function Wi(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,PA(t)),Ht!==null)for(t=Ht.return;t!==null;){var r=t;switch(Mp(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&yd();break;case 3:uo(),vt(Kn),vt(Nn),qp();break;case 5:zp(r);break;case 4:uo();break;case 13:vt(At);break;case 19:vt(At);break;case 10:Fp(r.type._context);break;case 22:case 23:tg()}t=t.return}if(sn=n,Ht=n=ti(n.current,null),fn=er=e,Qt=0,lc=null,Xp=hh=Xi=0,zn=Ll=null,Bi!==null){for(e=0;e<Bi.length;e++)if(t=Bi[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}t.pending=r}Bi=null}return n}function pb(n,e){do{var t=Ht;try{if(Op(),Bu.current=Sd,Id){for(var r=Nt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Id=!1}if(Ji=0,nn=Kt=Nt=null,Ml=!1,ic=0,Jp.current=null,t===null||t.return===null){Qt=1,lc=e,Ht=null;break}e:{var i=n,a=t.return,o=t,c=e;if(e=fn,o.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=o,m=h.tag;if(!(h.mode&1)&&(m===0||m===11||m===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=Jv(a);if(y!==null){y.flags&=-257,Xv(y,a,o,i,e),y.mode&1&&Yv(i,d,e),e=y,c=d;var E=e.updateQueue;if(E===null){var v=new Set;v.add(c),e.updateQueue=v}else E.add(c);break e}else{if(!(e&1)){Yv(i,d,e),ng();break e}c=Error(Z(426))}}else if(bt&&o.mode&1){var I=Jv(a);if(I!==null){!(I.flags&65536)&&(I.flags|=256),Xv(I,a,o,i,e),Vp(ho(c,o));break e}}i=c=ho(c,o),Qt!==4&&(Qt=2),Ll===null?Ll=[i]:Ll.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var _=Xw(i,c,e);qv(i,_);break e;case 1:o=c;var x=i.type,C=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(Zs===null||!Zs.has(C)))){i.flags|=65536,e&=-e,i.lanes|=e;var R=Zw(i,o,e);qv(i,R);break e}}i=i.return}while(i!==null)}vb(t)}catch(F){e=F,Ht===t&&t!==null&&(Ht=t=t.return);continue}break}while(1)}function gb(){var n=Cd.current;return Cd.current=Sd,n===null?Sd:n}function ng(){(Qt===0||Qt===3||Qt===2)&&(Qt=4),sn===null||!(Xi&268435455)&&!(hh&268435455)||Vs(sn,fn)}function Pd(n,e){var t=Xe;Xe|=2;var r=gb();(sn!==n||fn!==e)&&(Yr=null,Wi(n,e));do try{t1();break}catch(s){pb(n,s)}while(1);if(Op(),Xe=t,Cd.current=r,Ht!==null)throw Error(Z(261));return sn=null,fn=0,Qt}function t1(){for(;Ht!==null;)yb(Ht)}function n1(){for(;Ht!==null&&!CC();)yb(Ht)}function yb(n){var e=_b(n.alternate,n,er);n.memoizedProps=n.pendingProps,e===null?vb(n):Ht=e,Jp.current=null}function vb(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=QA(t,e),t!==null){t.flags&=32767,Ht=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Qt=6,Ht=null;return}}else if(t=KA(t,e,er),t!==null){Ht=t;return}if(e=e.sibling,e!==null){Ht=e;return}Ht=e=n}while(e!==null);Qt===0&&(Qt=5)}function Di(n,e,t){var r=st,s=ur.transition;try{ur.transition=null,st=1,r1(n,e,t,r)}finally{ur.transition=s,st=r}return null}function r1(n,e,t,r){do eo();while(Ws!==null);if(Xe&6)throw Error(Z(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Z(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(LC(n,i),n===sn&&(Ht=sn=null,fn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Iu||(Iu=!0,wb(dd,function(){return eo(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=ur.transition,ur.transition=null;var a=st;st=1;var o=Xe;Xe|=4,Jp.current=null,JA(n,t),hb(t,n),EA(uf),md=!!cf,uf=cf=null,n.current=t,XA(t),AC(),Xe=o,st=a,ur.transition=i}else n.current=t;if(Iu&&(Iu=!1,Ws=n,Nd=s),i=n.pendingLanes,i===0&&(Zs=null),kC(t.stateNode),Yn(n,$t()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Ad)throw Ad=!1,n=Pf,Pf=null,n;return Nd&1&&n.tag!==0&&eo(),i=n.pendingLanes,i&1?n===kf?Ol++:(Ol=0,kf=n):Ol=0,vi(),null}function eo(){if(Ws!==null){var n=X_(Nd),e=ur.transition,t=st;try{if(ur.transition=null,st=16>n?16:n,Ws===null)var r=!1;else{if(n=Ws,Ws=null,Nd=0,Xe&6)throw Error(Z(331));var s=Xe;for(Xe|=4,he=n.current;he!==null;){var i=he,a=i.child;if(he.flags&16){var o=i.deletions;if(o!==null){for(var c=0;c<o.length;c++){var d=o[c];for(he=d;he!==null;){var h=he;switch(h.tag){case 0:case 11:case 15:Vl(8,h,i)}var m=h.child;if(m!==null)m.return=h,he=m;else for(;he!==null;){h=he;var p=h.sibling,y=h.return;if(cb(h),h===d){he=null;break}if(p!==null){p.return=y,he=p;break}he=y}}}var E=i.alternate;if(E!==null){var v=E.child;if(v!==null){E.child=null;do{var I=v.sibling;v.sibling=null,v=I}while(v!==null)}}he=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,he=a;else e:for(;he!==null;){if(i=he,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Vl(9,i,i.return)}var _=i.sibling;if(_!==null){_.return=i.return,he=_;break e}he=i.return}}var x=n.current;for(he=x;he!==null;){a=he;var C=a.child;if(a.subtreeFlags&2064&&C!==null)C.return=a,he=C;else e:for(a=x;he!==null;){if(o=he,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:dh(9,o)}}catch(F){Vt(o,o.return,F)}if(o===a){he=null;break e}var R=o.sibling;if(R!==null){R.return=o.return,he=R;break e}he=o.return}}if(Xe=s,vi(),Lr&&typeof Lr.onPostCommitFiberRoot=="function")try{Lr.onPostCommitFiberRoot(rh,n)}catch{}r=!0}return r}finally{st=t,ur.transition=e}}return!1}function d0(n,e,t){e=ho(t,e),e=Xw(n,e,1),n=Xs(n,e,1),e=On(),n!==null&&(Sc(n,1,e),Yn(n,e))}function Vt(n,e,t){if(n.tag===3)d0(n,n,t);else for(;e!==null;){if(e.tag===3){d0(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Zs===null||!Zs.has(r))){n=ho(t,n),n=Zw(e,n,1),e=Xs(e,n,1),n=On(),e!==null&&(Sc(e,1,n),Yn(e,n));break}}e=e.return}}function s1(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=On(),n.pingedLanes|=n.suspendedLanes&t,sn===n&&(fn&t)===t&&(Qt===4||Qt===3&&(fn&130023424)===fn&&500>$t()-Zp?Wi(n,0):Xp|=t),Yn(n,e)}function xb(n,e){e===0&&(n.mode&1?(e=pu,pu<<=1,!(pu&130023424)&&(pu=4194304)):e=1);var t=On();n=us(n,e),n!==null&&(Sc(n,e,t),Yn(n,t))}function i1(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),xb(n,t)}function a1(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Z(314))}r!==null&&r.delete(e),xb(n,t)}var _b;_b=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Kn.current)qn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return qn=!1,GA(n,e,t);qn=!!(n.flags&131072)}else qn=!1,bt&&e.flags&1048576&&Tw(e,_d,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;qu(n,e),n=e.pendingProps;var s=oo(e,Nn.current);Za(e,t),s=Hp(null,e,r,n,s,t);var i=Gp();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qn(r)?(i=!0,vd(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Up(e),s.updater=uh,e.stateNode=s,s._reactInternals=e,xf(e,r,n,t),e=bf(null,e,r,!0,i,t)):(e.tag=0,bt&&i&&Dp(e),Ln(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(qu(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=l1(r),n=br(r,n),s){case 0:e=wf(null,e,r,n,t);break e;case 1:e=t0(null,e,r,n,t);break e;case 11:e=Zv(null,e,r,n,t);break e;case 14:e=e0(null,e,r,br(r.type,n),t);break e}throw Error(Z(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:br(r,s),wf(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:br(r,s),t0(n,e,r,s,t);case 3:e:{if(rb(e),n===null)throw Error(Z(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Pw(n,e),Ed(e,r,null,t);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=ho(Error(Z(423)),e),e=n0(n,e,r,t,s);break e}else if(r!==s){s=ho(Error(Z(424)),e),e=n0(n,e,r,t,s);break e}else for(tr=Js(e.stateNode.containerInfo.firstChild),nr=e,bt=!0,Tr=null,t=Aw(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(lo(),r===s){e=ds(n,e,t);break e}Ln(n,e,r,t)}e=e.child}return e;case 5:return kw(e),n===null&&gf(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,a=s.children,df(r,s)?a=null:i!==null&&df(r,i)&&(e.flags|=32),nb(n,e),Ln(n,e,a,t),e.child;case 6:return n===null&&gf(e),null;case 13:return sb(n,e,t);case 4:return Bp(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=co(e,null,r,t):Ln(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:br(r,s),Zv(n,e,r,s,t);case 7:return Ln(n,e,e.pendingProps,t),e.child;case 8:return Ln(n,e,e.pendingProps.children,t),e.child;case 12:return Ln(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,ht(wd,r._currentValue),r._currentValue=a,i!==null)if(Cr(i.value,a)){if(i.children===s.children&&!Kn.current){e=ds(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var c=o.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=as(-1,t&-t),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}i.lanes|=t,c=i.alternate,c!==null&&(c.lanes|=t),yf(i.return,t,e),o.lanes|=t;break}c=c.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(Z(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),yf(a,t,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Ln(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Za(e,t),s=dr(s),r=r(s),e.flags|=1,Ln(n,e,r,t),e.child;case 14:return r=e.type,s=br(r,e.pendingProps),s=br(r.type,s),e0(n,e,r,s,t);case 15:return eb(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:br(r,s),qu(n,e),e.tag=1,Qn(r)?(n=!0,vd(e)):n=!1,Za(e,t),Jw(e,r,s),xf(e,r,s,t),bf(null,e,r,!0,n,t);case 19:return ib(n,e,t);case 22:return tb(n,e,t)}throw Error(Z(156,e.tag))};function wb(n,e){return K_(n,e)}function o1(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cr(n,e,t,r){return new o1(n,e,t,r)}function rg(n){return n=n.prototype,!(!n||!n.isReactComponent)}function l1(n){if(typeof n=="function")return rg(n)?1:0;if(n!=null){if(n=n.$$typeof,n===bp)return 11;if(n===Ep)return 14}return 2}function ti(n,e){var t=n.alternate;return t===null?(t=cr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Gu(n,e,t,r,s,i){var a=2;if(r=n,typeof n=="function")rg(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case La:return Hi(t.children,s,i,e);case wp:a=8,s|=8;break;case Bm:return n=cr(12,t,e,s|2),n.elementType=Bm,n.lanes=i,n;case zm:return n=cr(13,t,e,s),n.elementType=zm,n.lanes=i,n;case qm:return n=cr(19,t,e,s),n.elementType=qm,n.lanes=i,n;case k_:return mh(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case N_:a=10;break e;case P_:a=9;break e;case bp:a=11;break e;case Ep:a=14;break e;case js:a=16,r=null;break e}throw Error(Z(130,n==null?n:typeof n,""))}return e=cr(a,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function Hi(n,e,t,r){return n=cr(7,n,r,e),n.lanes=t,n}function mh(n,e,t,r){return n=cr(22,n,r,e),n.elementType=k_,n.lanes=t,n.stateNode={isHidden:!1},n}function bm(n,e,t){return n=cr(6,n,null,e),n.lanes=t,n}function Em(n,e,t){return e=cr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function c1(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rm(0),this.expirationTimes=rm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rm(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function sg(n,e,t,r,s,i,a,o,c){return n=new c1(n,e,t,o,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=cr(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Up(i),n}function u1(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Va,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function bb(n){if(!n)return oi;n=n._reactInternals;e:{if(ma(n)!==n||n.tag!==1)throw Error(Z(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Z(171))}if(n.tag===1){var t=n.type;if(Qn(t))return bw(n,t,e)}return e}function Eb(n,e,t,r,s,i,a,o,c){return n=sg(t,r,!0,n,s,i,a,o,c),n.context=bb(null),t=n.current,r=On(),s=ei(t),i=as(r,s),i.callback=e??null,Xs(t,i,s),n.current.lanes=s,Sc(n,s,r),Yn(n,r),n}function fh(n,e,t,r){var s=e.current,i=On(),a=ei(s);return t=bb(t),e.context===null?e.context=t:e.pendingContext=t,e=as(i,a),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Xs(s,e,a),n!==null&&(Sr(n,s,a,i),Uu(n,s,a)),a}function kd(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function h0(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function ig(n,e){h0(n,e),(n=n.alternate)&&h0(n,e)}function d1(){return null}var Tb=typeof reportError=="function"?reportError:function(n){console.error(n)};function ag(n){this._internalRoot=n}ph.prototype.render=ag.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Z(409));fh(n,e,null,null)};ph.prototype.unmount=ag.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Zi(function(){fh(null,n,null,null)}),e[cs]=null}};function ph(n){this._internalRoot=n}ph.prototype.unstable_scheduleHydration=function(n){if(n){var e=tw();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Ms.length&&e!==0&&e<Ms[t].priority;t++);Ms.splice(t,0,n),t===0&&rw(n)}};function og(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function gh(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function m0(){}function h1(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=kd(a);i.call(d)}}var a=Eb(e,r,n,0,null,!1,!1,"",m0);return n._reactRootContainer=a,n[cs]=a.current,ec(n.nodeType===8?n.parentNode:n),Zi(),a}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var o=r;r=function(){var d=kd(c);o.call(d)}}var c=sg(n,0,!1,null,null,!1,!1,"",m0);return n._reactRootContainer=c,n[cs]=c.current,ec(n.nodeType===8?n.parentNode:n),Zi(function(){fh(e,c,t,r)}),c}function yh(n,e,t,r,s){var i=t._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var o=s;s=function(){var c=kd(a);o.call(c)}}fh(e,a,n,s)}else a=h1(t,e,n,s,r);return kd(a)}Z_=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=bl(e.pendingLanes);t!==0&&(Sp(e,t|1),Yn(e,$t()),!(Xe&6)&&(mo=$t()+500,vi()))}break;case 13:Zi(function(){var r=us(n,1);if(r!==null){var s=On();Sr(r,n,1,s)}}),ig(n,1)}};Cp=function(n){if(n.tag===13){var e=us(n,134217728);if(e!==null){var t=On();Sr(e,n,134217728,t)}ig(n,134217728)}};ew=function(n){if(n.tag===13){var e=ei(n),t=us(n,e);if(t!==null){var r=On();Sr(t,n,e,r)}ig(n,e)}};tw=function(){return st};nw=function(n,e){var t=st;try{return st=n,e()}finally{st=t}};ef=function(n,e,t){switch(e){case"input":if(Gm(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=oh(r);if(!s)throw Error(Z(90));j_(r),Gm(r,s)}}}break;case"textarea":M_(n,t);break;case"select":e=t.value,e!=null&&Qa(n,!!t.multiple,e,!1)}};B_=eg;z_=Zi;var m1={usingClientEntryPoint:!1,Events:[Ac,Ua,oh,$_,U_,eg]},fl={findFiberByHostInstance:Ui,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},f1={bundleType:fl.bundleType,version:fl.version,rendererPackageName:fl.rendererPackageName,rendererConfig:fl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:gs.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=H_(n),n===null?null:n.stateNode},findFiberByHostInstance:fl.findFiberByHostInstance||d1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Su=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Su.isDisabled&&Su.supportsFiber)try{rh=Su.inject(f1),Lr=Su}catch{}}ir.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=m1;ir.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!og(e))throw Error(Z(200));return u1(n,e,null,t)};ir.createRoot=function(n,e){if(!og(n))throw Error(Z(299));var t=!1,r="",s=Tb;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=sg(n,1,!1,null,null,t,!1,r,s),n[cs]=e.current,ec(n.nodeType===8?n.parentNode:n),new ag(e)};ir.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Z(188)):(n=Object.keys(n).join(","),Error(Z(268,n)));return n=H_(e),n=n===null?null:n.stateNode,n};ir.flushSync=function(n){return Zi(n)};ir.hydrate=function(n,e,t){if(!gh(e))throw Error(Z(200));return yh(null,n,e,!0,t)};ir.hydrateRoot=function(n,e,t){if(!og(n))throw Error(Z(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",a=Tb;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=Eb(e,null,n,1,t??null,s,!1,i,a),n[cs]=e.current,ec(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new ph(e)};ir.render=function(n,e,t){if(!gh(e))throw Error(Z(200));return yh(null,n,e,!1,t)};ir.unmountComponentAtNode=function(n){if(!gh(n))throw Error(Z(40));return n._reactRootContainer?(Zi(function(){yh(null,null,n,!1,function(){n._reactRootContainer=null,n[cs]=null})}),!0):!1};ir.unstable_batchedUpdates=eg;ir.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!gh(t))throw Error(Z(200));if(n==null||n._reactInternals===void 0)throw Error(Z(38));return yh(n,e,t,!1,r)};ir.version="18.3.1-next-f1338f8080-20240426";function Ib(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Ib)}catch(n){console.error(n)}}Ib(),I_.exports=ir;var p1=I_.exports,f0=p1;$m.createRoot=f0.createRoot,$m.hydrateRoot=f0.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function cc(){return cc=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},cc.apply(this,arguments)}var Hs;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Hs||(Hs={}));const p0="popstate";function g1(n){n===void 0&&(n={});function e(r,s){let{pathname:i,search:a,hash:o}=r.location;return Df("",{pathname:i,search:a,hash:o},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:Rd(s)}return v1(e,t,null,n)}function Bt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Sb(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function y1(){return Math.random().toString(36).substr(2,8)}function g0(n,e){return{usr:n.state,key:n.key,idx:e}}function Df(n,e,t,r){return t===void 0&&(t=null),cc({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Mo(e):e,{state:t,key:e&&e.key||r||y1()})}function Rd(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Mo(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function v1(n,e,t,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,o=Hs.Pop,c=null,d=h();d==null&&(d=0,a.replaceState(cc({},a.state,{idx:d}),""));function h(){return(a.state||{idx:null}).idx}function m(){o=Hs.Pop;let I=h(),_=I==null?null:I-d;d=I,c&&c({action:o,location:v.location,delta:_})}function p(I,_){o=Hs.Push;let x=Df(v.location,I,_);t&&t(x,I),d=h()+1;let C=g0(x,d),R=v.createHref(x);try{a.pushState(C,"",R)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;s.location.assign(R)}i&&c&&c({action:o,location:v.location,delta:1})}function y(I,_){o=Hs.Replace;let x=Df(v.location,I,_);t&&t(x,I),d=h();let C=g0(x,d),R=v.createHref(x);a.replaceState(C,"",R),i&&c&&c({action:o,location:v.location,delta:0})}function E(I){let _=s.location.origin!=="null"?s.location.origin:s.location.href,x=typeof I=="string"?I:Rd(I);return x=x.replace(/ $/,"%20"),Bt(_,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,_)}let v={get action(){return o},get location(){return n(s,a)},listen(I){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(p0,m),c=I,()=>{s.removeEventListener(p0,m),c=null}},createHref(I){return e(s,I)},createURL:E,encodeLocation(I){let _=E(I);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:p,replace:y,go(I){return a.go(I)}};return v}var y0;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(y0||(y0={}));function x1(n,e,t){return t===void 0&&(t="/"),_1(n,e,t,!1)}function _1(n,e,t,r){let s=typeof e=="string"?Mo(e):e,i=lg(s.pathname||"/",t);if(i==null)return null;let a=Cb(n);w1(a);let o=null;for(let c=0;o==null&&c<a.length;++c){let d=R1(i);o=P1(a[c],d,r)}return o}function Cb(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let s=(i,a,o)=>{let c={relativePath:o===void 0?i.path||"":o,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};c.relativePath.startsWith("/")&&(Bt(c.relativePath.startsWith(r),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(r.length));let d=ni([r,c.relativePath]),h=t.concat(c);i.children&&i.children.length>0&&(Bt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),Cb(i.children,e,h,d)),!(i.path==null&&!i.index)&&e.push({path:d,score:A1(d,i.index),routesMeta:h})};return n.forEach((i,a)=>{var o;if(i.path===""||!((o=i.path)!=null&&o.includes("?")))s(i,a);else for(let c of Ab(i.path))s(i,a,c)}),e}function Ab(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let a=Ab(r.join("/")),o=[];return o.push(...a.map(c=>c===""?i:[i,c].join("/"))),s&&o.push(...a),o.map(c=>n.startsWith("/")&&c===""?"/":c)}function w1(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:N1(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const b1=/^:[\w-]+$/,E1=3,T1=2,I1=1,S1=10,C1=-2,v0=n=>n==="*";function A1(n,e){let t=n.split("/"),r=t.length;return t.some(v0)&&(r+=C1),e&&(r+=T1),t.filter(s=>!v0(s)).reduce((s,i)=>s+(b1.test(i)?E1:i===""?I1:S1),r)}function N1(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function P1(n,e,t){t===void 0&&(t=!1);let{routesMeta:r}=n,s={},i="/",a=[];for(let o=0;o<r.length;++o){let c=r[o],d=o===r.length-1,h=i==="/"?e:e.slice(i.length)||"/",m=x0({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},h),p=c.route;if(!m&&d&&t&&!r[r.length-1].route.index&&(m=x0({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},h)),!m)return null;Object.assign(s,m.params),a.push({params:s,pathname:ni([i,m.pathname]),pathnameBase:V1(ni([i,m.pathnameBase])),route:p}),m.pathnameBase!=="/"&&(i=ni([i,m.pathnameBase]))}return a}function x0(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=k1(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),o=s.slice(1);return{params:r.reduce((d,h,m)=>{let{paramName:p,isOptional:y}=h;if(p==="*"){let v=o[m]||"";a=i.slice(0,i.length-v.length).replace(/(.)\/+$/,"$1")}const E=o[m];return y&&!E?d[p]=void 0:d[p]=(E||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:a,pattern:n}}function k1(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),Sb(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,c)=>(r.push({paramName:o,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function R1(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Sb(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function lg(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function j1(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?Mo(n):n;return{pathname:t?t.startsWith("/")?t:D1(t,e):e,search:L1(r),hash:O1(s)}}function D1(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function Tm(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function M1(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function cg(n,e){let t=M1(n);return e?t.map((r,s)=>s===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function ug(n,e,t,r){r===void 0&&(r=!1);let s;typeof n=="string"?s=Mo(n):(s=cc({},n),Bt(!s.pathname||!s.pathname.includes("?"),Tm("?","pathname","search",s)),Bt(!s.pathname||!s.pathname.includes("#"),Tm("#","pathname","hash",s)),Bt(!s.search||!s.search.includes("#"),Tm("#","search","hash",s)));let i=n===""||s.pathname==="",a=i?"/":s.pathname,o;if(a==null)o=t;else{let m=e.length-1;if(!r&&a.startsWith("..")){let p=a.split("/");for(;p[0]==="..";)p.shift(),m-=1;s.pathname=p.join("/")}o=m>=0?e[m]:"/"}let c=j1(s,o),d=a&&a!=="/"&&a.endsWith("/"),h=(i||a===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(d||h)&&(c.pathname+="/"),c}const ni=n=>n.join("/").replace(/\/\/+/g,"/"),V1=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),L1=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,O1=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function F1(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const Nb=["post","put","patch","delete"];new Set(Nb);const $1=["get",...Nb];new Set($1);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function uc(){return uc=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},uc.apply(this,arguments)}const dg=k.createContext(null),U1=k.createContext(null),xi=k.createContext(null),vh=k.createContext(null),ys=k.createContext({outlet:null,matches:[],isDataRoute:!1}),Pb=k.createContext(null);function B1(n,e){let{relative:t}=e===void 0?{}:e;Vo()||Bt(!1);let{basename:r,navigator:s}=k.useContext(xi),{hash:i,pathname:a,search:o}=Rb(n,{relative:t}),c=a;return r!=="/"&&(c=a==="/"?r:ni([r,a])),s.createHref({pathname:c,search:o,hash:i})}function Vo(){return k.useContext(vh)!=null}function _i(){return Vo()||Bt(!1),k.useContext(vh).location}function kb(n){k.useContext(xi).static||k.useLayoutEffect(n)}function fr(){let{isDataRoute:n}=k.useContext(ys);return n?tN():z1()}function z1(){Vo()||Bt(!1);let n=k.useContext(dg),{basename:e,future:t,navigator:r}=k.useContext(xi),{matches:s}=k.useContext(ys),{pathname:i}=_i(),a=JSON.stringify(cg(s,t.v7_relativeSplatPath)),o=k.useRef(!1);return kb(()=>{o.current=!0}),k.useCallback(function(d,h){if(h===void 0&&(h={}),!o.current)return;if(typeof d=="number"){r.go(d);return}let m=ug(d,JSON.parse(a),i,h.relative==="path");n==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:ni([e,m.pathname])),(h.replace?r.replace:r.push)(m,h.state,h)},[e,r,a,i,n])}function hg(){let{matches:n}=k.useContext(ys),e=n[n.length-1];return e?e.params:{}}function Rb(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=k.useContext(xi),{matches:s}=k.useContext(ys),{pathname:i}=_i(),a=JSON.stringify(cg(s,r.v7_relativeSplatPath));return k.useMemo(()=>ug(n,JSON.parse(a),i,t==="path"),[n,a,i,t])}function q1(n,e){return W1(n,e)}function W1(n,e,t,r){Vo()||Bt(!1);let{navigator:s}=k.useContext(xi),{matches:i}=k.useContext(ys),a=i[i.length-1],o=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let d=_i(),h;if(e){var m;let I=typeof e=="string"?Mo(e):e;c==="/"||(m=I.pathname)!=null&&m.startsWith(c)||Bt(!1),h=I}else h=d;let p=h.pathname||"/",y=p;if(c!=="/"){let I=c.replace(/^\//,"").split("/");y="/"+p.replace(/^\//,"").split("/").slice(I.length).join("/")}let E=x1(n,{pathname:y}),v=Y1(E&&E.map(I=>Object.assign({},I,{params:Object.assign({},o,I.params),pathname:ni([c,s.encodeLocation?s.encodeLocation(I.pathname).pathname:I.pathname]),pathnameBase:I.pathnameBase==="/"?c:ni([c,s.encodeLocation?s.encodeLocation(I.pathnameBase).pathname:I.pathnameBase])})),i,t,r);return e&&v?k.createElement(vh.Provider,{value:{location:uc({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Hs.Pop}},v):v}function H1(){let n=eN(),e=F1(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return k.createElement(k.Fragment,null,k.createElement("h2",null,"Unexpected Application Error!"),k.createElement("h3",{style:{fontStyle:"italic"}},e),t?k.createElement("pre",{style:s},t):null,i)}const G1=k.createElement(H1,null);class K1 extends k.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?k.createElement(ys.Provider,{value:this.props.routeContext},k.createElement(Pb.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Q1(n){let{routeContext:e,match:t,children:r}=n,s=k.useContext(dg);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),k.createElement(ys.Provider,{value:e},r)}function Y1(n,e,t,r){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var i;if(!t)return null;if(t.errors)n=t.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let a=n,o=(s=t)==null?void 0:s.errors;if(o!=null){let h=a.findIndex(m=>m.route.id&&(o==null?void 0:o[m.route.id])!==void 0);h>=0||Bt(!1),a=a.slice(0,Math.min(a.length,h+1))}let c=!1,d=-1;if(t&&r&&r.v7_partialHydration)for(let h=0;h<a.length;h++){let m=a[h];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(d=h),m.route.id){let{loaderData:p,errors:y}=t,E=m.route.loader&&p[m.route.id]===void 0&&(!y||y[m.route.id]===void 0);if(m.route.lazy||E){c=!0,d>=0?a=a.slice(0,d+1):a=[a[0]];break}}}return a.reduceRight((h,m,p)=>{let y,E=!1,v=null,I=null;t&&(y=o&&m.route.id?o[m.route.id]:void 0,v=m.route.errorElement||G1,c&&(d<0&&p===0?(nN("route-fallback",!1),E=!0,I=null):d===p&&(E=!0,I=m.route.hydrateFallbackElement||null)));let _=e.concat(a.slice(0,p+1)),x=()=>{let C;return y?C=v:E?C=I:m.route.Component?C=k.createElement(m.route.Component,null):m.route.element?C=m.route.element:C=h,k.createElement(Q1,{match:m,routeContext:{outlet:h,matches:_,isDataRoute:t!=null},children:C})};return t&&(m.route.ErrorBoundary||m.route.errorElement||p===0)?k.createElement(K1,{location:t.location,revalidation:t.revalidation,component:v,error:y,children:x(),routeContext:{outlet:null,matches:_,isDataRoute:!0}}):x()},null)}var jb=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(jb||{}),jd=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(jd||{});function J1(n){let e=k.useContext(dg);return e||Bt(!1),e}function X1(n){let e=k.useContext(U1);return e||Bt(!1),e}function Z1(n){let e=k.useContext(ys);return e||Bt(!1),e}function Db(n){let e=Z1(),t=e.matches[e.matches.length-1];return t.route.id||Bt(!1),t.route.id}function eN(){var n;let e=k.useContext(Pb),t=X1(jd.UseRouteError),r=Db(jd.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function tN(){let{router:n}=J1(jb.UseNavigateStable),e=Db(jd.UseNavigateStable),t=k.useRef(!1);return kb(()=>{t.current=!0}),k.useCallback(function(s,i){i===void 0&&(i={}),t.current&&(typeof s=="number"?n.navigate(s):n.navigate(s,uc({fromRouteId:e},i)))},[n,e])}const _0={};function nN(n,e,t){!e&&!_0[n]&&(_0[n]=!0)}function rN(n,e){n==null||n.v7_startTransition,(n==null?void 0:n.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function Mb(n){let{to:e,replace:t,state:r,relative:s}=n;Vo()||Bt(!1);let{future:i,static:a}=k.useContext(xi),{matches:o}=k.useContext(ys),{pathname:c}=_i(),d=fr(),h=ug(e,cg(o,i.v7_relativeSplatPath),c,s==="path"),m=JSON.stringify(h);return k.useEffect(()=>d(JSON.parse(m),{replace:t,state:r,relative:s}),[d,m,s,t,r]),null}function Zn(n){Bt(!1)}function sN(n){let{basename:e="/",children:t=null,location:r,navigationType:s=Hs.Pop,navigator:i,static:a=!1,future:o}=n;Vo()&&Bt(!1);let c=e.replace(/^\/*/,"/"),d=k.useMemo(()=>({basename:c,navigator:i,static:a,future:uc({v7_relativeSplatPath:!1},o)}),[c,o,i,a]);typeof r=="string"&&(r=Mo(r));let{pathname:h="/",search:m="",hash:p="",state:y=null,key:E="default"}=r,v=k.useMemo(()=>{let I=lg(h,c);return I==null?null:{location:{pathname:I,search:m,hash:p,state:y,key:E},navigationType:s}},[c,h,m,p,y,E,s]);return v==null?null:k.createElement(xi.Provider,{value:d},k.createElement(vh.Provider,{children:t,value:v}))}function iN(n){let{children:e,location:t}=n;return q1(Mf(e),t)}new Promise(()=>{});function Mf(n,e){e===void 0&&(e=[]);let t=[];return k.Children.forEach(n,(r,s)=>{if(!k.isValidElement(r))return;let i=[...e,s];if(r.type===k.Fragment){t.push.apply(t,Mf(r.props.children,i));return}r.type!==Zn&&Bt(!1),!r.props.index||!r.props.children||Bt(!1);let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Mf(r.props.children,i)),t.push(a)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Vf(){return Vf=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Vf.apply(this,arguments)}function aN(n,e){if(n==null)return{};var t={},r=Object.keys(n),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function oN(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function lN(n,e){return n.button===0&&(!e||e==="_self")&&!oN(n)}const cN=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],uN="6";try{window.__reactRouterVersion=uN}catch{}const dN="startTransition",w0=sC[dN];function hN(n){let{basename:e,children:t,future:r,window:s}=n,i=k.useRef();i.current==null&&(i.current=g1({window:s,v5Compat:!0}));let a=i.current,[o,c]=k.useState({action:a.action,location:a.location}),{v7_startTransition:d}=r||{},h=k.useCallback(m=>{d&&w0?w0(()=>c(m)):c(m)},[c,d]);return k.useLayoutEffect(()=>a.listen(h),[a,h]),k.useEffect(()=>rN(r),[r]),k.createElement(sN,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:a,future:r})}const mN=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",fN=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Rr=k.forwardRef(function(e,t){let{onClick:r,relative:s,reloadDocument:i,replace:a,state:o,target:c,to:d,preventScrollReset:h,viewTransition:m}=e,p=aN(e,cN),{basename:y}=k.useContext(xi),E,v=!1;if(typeof d=="string"&&fN.test(d)&&(E=d,mN))try{let C=new URL(window.location.href),R=d.startsWith("//")?new URL(C.protocol+d):new URL(d),F=lg(R.pathname,y);R.origin===C.origin&&F!=null?d=F+R.search+R.hash:v=!0}catch{}let I=B1(d,{relative:s}),_=pN(d,{replace:a,state:o,target:c,preventScrollReset:h,relative:s,viewTransition:m});function x(C){r&&r(C),C.defaultPrevented||_(C)}return k.createElement("a",Vf({},p,{href:E||I,onClick:v||i?r:x,ref:t,target:c}))});var b0;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(b0||(b0={}));var E0;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(E0||(E0={}));function pN(n,e){let{target:t,replace:r,state:s,preventScrollReset:i,relative:a,viewTransition:o}=e===void 0?{}:e,c=fr(),d=_i(),h=Rb(n,{relative:a});return k.useCallback(m=>{if(lN(m,t)){m.preventDefault();let p=r!==void 0?r:Rd(d)===Rd(h);c(n,{replace:p,state:s,preventScrollReset:i,relative:a,viewTransition:o})}},[d,c,h,r,s,t,n,i,a,o])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vb=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},gN=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],o=n[t++],c=((s&7)<<18|(i&63)<<12|(a&63)<<6|o&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},Lb={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,o=a?n[s+1]:0,c=s+2<n.length,d=c?n[s+2]:0,h=i>>2,m=(i&3)<<4|o>>4;let p=(o&15)<<2|d>>6,y=d&63;c||(y=64,a||(p=64)),r.push(t[h],t[m],t[p],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Vb(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):gN(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],o=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const m=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||o==null||d==null||m==null)throw new yN;const p=i<<2|o>>4;if(r.push(p),d!==64){const y=o<<4&240|d>>2;if(r.push(y),m!==64){const E=d<<6&192|m;r.push(E)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class yN extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const vN=function(n){const e=Vb(n);return Lb.encodeByteArray(e,!0)},Dd=function(n){return vN(n).replace(/\./g,"")},Ob=function(n){try{return Lb.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xN(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _N=()=>xN().__FIREBASE_DEFAULTS__,wN=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},bN=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Ob(n[1]);return e&&JSON.parse(e)},xh=()=>{try{return _N()||wN()||bN()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Fb=n=>{var e,t;return(t=(e=xh())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},EN=n=>{const e=Fb(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},$b=()=>{var n;return(n=xh())===null||n===void 0?void 0:n.config},Ub=n=>{var e;return(e=xh())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TN{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IN(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),o="";return[Dd(JSON.stringify(t)),Dd(JSON.stringify(a)),o].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function SN(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Yt())}function CN(){var n;const e=(n=xh())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function AN(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function NN(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function PN(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function kN(){const n=Yt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Bb(){return!CN()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function zb(){try{return typeof indexedDB=="object"}catch{return!1}}function RN(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jN="FirebaseError";class vs extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=jN,Object.setPrototypeOf(this,vs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Pc.prototype.create)}}class Pc{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?DN(i,r):"Error",o=`${this.serviceName}: ${a} (${s}).`;return new vs(s,o,r)}}function DN(n,e){return n.replace(MN,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const MN=/\{\$([^}]+)}/g;function VN(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function li(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(T0(i)&&T0(a)){if(!li(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function T0(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kc(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Tl(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Il(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function LN(n,e){const t=new ON(n,e);return t.subscribe.bind(t)}class ON{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");FN(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Im),s.error===void 0&&(s.error=Im),s.complete===void 0&&(s.complete=Im);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function FN(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Im(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lt(n){return n&&n._delegate?n._delegate:n}class ea{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $N{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new TN;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(BN(e))try{this.getOrInitializeService({instanceIdentifier:Mi})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Mi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Mi){return this.instances.has(e)}getOptions(e=Mi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(i);r===o&&a.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const a=this.instances.get(s);return a&&e(a,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:UN(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Mi){return this.component?this.component.multipleInstances?e:Mi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function UN(n){return n===Mi?void 0:n}function BN(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zN{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new $N(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ge;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ge||(Ge={}));const qN={debug:Ge.DEBUG,verbose:Ge.VERBOSE,info:Ge.INFO,warn:Ge.WARN,error:Ge.ERROR,silent:Ge.SILENT},WN=Ge.INFO,HN={[Ge.DEBUG]:"log",[Ge.VERBOSE]:"log",[Ge.INFO]:"info",[Ge.WARN]:"warn",[Ge.ERROR]:"error"},GN=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=HN[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class mg{constructor(e){this.name=e,this._logLevel=WN,this._logHandler=GN,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ge))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?qN[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ge.DEBUG,...e),this._logHandler(this,Ge.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ge.VERBOSE,...e),this._logHandler(this,Ge.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ge.INFO,...e),this._logHandler(this,Ge.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ge.WARN,...e),this._logHandler(this,Ge.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ge.ERROR,...e),this._logHandler(this,Ge.ERROR,...e)}}const KN=(n,e)=>e.some(t=>n instanceof t);let I0,S0;function QN(){return I0||(I0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function YN(){return S0||(S0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const qb=new WeakMap,Lf=new WeakMap,Wb=new WeakMap,Sm=new WeakMap,fg=new WeakMap;function JN(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(ri(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&qb.set(t,n)}).catch(()=>{}),fg.set(e,n),e}function XN(n){if(Lf.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});Lf.set(n,e)}let Of={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Lf.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Wb.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ri(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function ZN(n){Of=n(Of)}function eP(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Cm(this),e,...t);return Wb.set(r,e.sort?e.sort():[e]),ri(r)}:YN().includes(n)?function(...e){return n.apply(Cm(this),e),ri(qb.get(this))}:function(...e){return ri(n.apply(Cm(this),e))}}function tP(n){return typeof n=="function"?eP(n):(n instanceof IDBTransaction&&XN(n),KN(n,QN())?new Proxy(n,Of):n)}function ri(n){if(n instanceof IDBRequest)return JN(n);if(Sm.has(n))return Sm.get(n);const e=tP(n);return e!==n&&(Sm.set(n,e),fg.set(e,n)),e}const Cm=n=>fg.get(n);function nP(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),o=ri(a);return r&&a.addEventListener("upgradeneeded",c=>{r(ri(a.result),c.oldVersion,c.newVersion,ri(a.transaction),c)}),t&&a.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),o.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),o}const rP=["get","getKey","getAll","getAllKeys","count"],sP=["put","add","delete","clear"],Am=new Map;function C0(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Am.get(e))return Am.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=sP.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||rP.includes(t)))return;const i=async function(a,...o){const c=this.transaction(a,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(o.shift())),(await Promise.all([d[t](...o),s&&c.done]))[0]};return Am.set(e,i),i}ZN(n=>({...n,get:(e,t,r)=>C0(e,t)||n.get(e,t,r),has:(e,t)=>!!C0(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iP{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(aP(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function aP(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Ff="@firebase/app",A0="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hs=new mg("@firebase/app"),oP="@firebase/app-compat",lP="@firebase/analytics-compat",cP="@firebase/analytics",uP="@firebase/app-check-compat",dP="@firebase/app-check",hP="@firebase/auth",mP="@firebase/auth-compat",fP="@firebase/database",pP="@firebase/data-connect",gP="@firebase/database-compat",yP="@firebase/functions",vP="@firebase/functions-compat",xP="@firebase/installations",_P="@firebase/installations-compat",wP="@firebase/messaging",bP="@firebase/messaging-compat",EP="@firebase/performance",TP="@firebase/performance-compat",IP="@firebase/remote-config",SP="@firebase/remote-config-compat",CP="@firebase/storage",AP="@firebase/storage-compat",NP="@firebase/firestore",PP="@firebase/vertexai-preview",kP="@firebase/firestore-compat",RP="firebase",jP="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Md="[DEFAULT]",DP={[Ff]:"fire-core",[oP]:"fire-core-compat",[cP]:"fire-analytics",[lP]:"fire-analytics-compat",[dP]:"fire-app-check",[uP]:"fire-app-check-compat",[hP]:"fire-auth",[mP]:"fire-auth-compat",[fP]:"fire-rtdb",[pP]:"fire-data-connect",[gP]:"fire-rtdb-compat",[yP]:"fire-fn",[vP]:"fire-fn-compat",[xP]:"fire-iid",[_P]:"fire-iid-compat",[wP]:"fire-fcm",[bP]:"fire-fcm-compat",[EP]:"fire-perf",[TP]:"fire-perf-compat",[IP]:"fire-rc",[SP]:"fire-rc-compat",[CP]:"fire-gcs",[AP]:"fire-gcs-compat",[NP]:"fire-fst",[kP]:"fire-fst-compat",[PP]:"fire-vertex","fire-js":"fire-js",[RP]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vd=new Map,MP=new Map,$f=new Map;function N0(n,e){try{n.container.addComponent(e)}catch(t){hs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function fo(n){const e=n.name;if($f.has(e))return hs.debug(`There were multiple attempts to register component ${e}.`),!1;$f.set(e,n);for(const t of Vd.values())N0(t,n);for(const t of MP.values())N0(t,n);return!0}function Rc(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function VP(n,e,t=Md){Rc(n,e).clearInstance(t)}function Dr(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LP={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},si=new Pc("app","Firebase",LP);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OP{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ea("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw si.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lo=jP;function Hb(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Md,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw si.create("bad-app-name",{appName:String(s)});if(t||(t=$b()),!t)throw si.create("no-options");const i=Vd.get(s);if(i){if(li(t,i.options)&&li(r,i.config))return i;throw si.create("duplicate-app",{appName:s})}const a=new zN(s);for(const c of $f.values())a.addComponent(c);const o=new OP(t,r,a);return Vd.set(s,o),o}function Gb(n=Md){const e=Vd.get(n);if(!e&&n===Md&&$b())return Hb();if(!e)throw si.create("no-app",{appName:n});return e}function ii(n,e,t){var r;let s=(r=DP[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const o=[`Unable to register library "${s}" with version "${e}":`];i&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&a&&o.push("and"),a&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),hs.warn(o.join(" "));return}fo(new ea(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FP="firebase-heartbeat-database",$P=1,dc="firebase-heartbeat-store";let Nm=null;function Kb(){return Nm||(Nm=nP(FP,$P,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(dc)}catch(t){console.warn(t)}}}}).catch(n=>{throw si.create("idb-open",{originalErrorMessage:n.message})})),Nm}async function UP(n){try{const t=(await Kb()).transaction(dc),r=await t.objectStore(dc).get(Qb(n));return await t.done,r}catch(e){if(e instanceof vs)hs.warn(e.message);else{const t=si.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});hs.warn(t.message)}}}async function P0(n,e){try{const r=(await Kb()).transaction(dc,"readwrite");await r.objectStore(dc).put(e,Qb(n)),await r.done}catch(t){if(t instanceof vs)hs.warn(t.message);else{const r=si.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});hs.warn(r.message)}}}function Qb(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BP=1024,zP=30*24*60*60*1e3;class qP{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new HP(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=k0();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const o=new Date(a.date).valueOf();return Date.now()-o<=zP}),this._storage.overwrite(this._heartbeatsCache))}catch(r){hs.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=k0(),{heartbeatsToSend:r,unsentEntries:s}=WP(this._heartbeatsCache.heartbeats),i=Dd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return hs.warn(t),""}}}function k0(){return new Date().toISOString().substring(0,10)}function WP(n,e=BP){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),R0(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),R0(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class HP{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return zb()?RN().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await UP(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return P0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return P0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function R0(n){return Dd(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GP(n){fo(new ea("platform-logger",e=>new iP(e),"PRIVATE")),fo(new ea("heartbeat",e=>new qP(e),"PRIVATE")),ii(Ff,A0,n),ii(Ff,A0,"esm2017"),ii("fire-js","")}GP("");function pg(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function Yb(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const KP=Yb,Jb=new Pc("auth","Firebase",Yb());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ld=new mg("@firebase/auth");function QP(n,...e){Ld.logLevel<=Ge.WARN&&Ld.warn(`Auth (${Lo}): ${n}`,...e)}function Ku(n,...e){Ld.logLevel<=Ge.ERROR&&Ld.error(`Auth (${Lo}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ar(n,...e){throw gg(n,...e)}function Fr(n,...e){return gg(n,...e)}function Xb(n,e,t){const r=Object.assign(Object.assign({},KP()),{[e]:t});return new Pc("auth","Firebase",r).create(e,{appName:n.name})}function os(n){return Xb(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function gg(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Jb.create(n,...e)}function Ne(n,e,...t){if(!n)throw gg(e,...t)}function ns(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ku(e),new Error(e)}function ms(n,e){n||ns(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uf(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function YP(){return j0()==="http:"||j0()==="https:"}function j0(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JP(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(YP()||NN()||"connection"in navigator)?navigator.onLine:!0}function XP(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jc{constructor(e,t){this.shortDelay=e,this.longDelay=t,ms(t>e,"Short delay should be less than long delay!"),this.isMobile=SN()||PN()}get(){return JP()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yg(n,e){ms(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zb{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ns("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ns("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ns("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ek=new jc(3e4,6e4);function xs(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function _s(n,e,t,r,s={}){return eE(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const o=kc(Object.assign({key:n.config.apiKey},a)).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const d=Object.assign({method:e,headers:c},i);return AN()||(d.referrerPolicy="no-referrer"),Zb.fetch()(tE(n,n.config.apiHost,t,o),d)})}async function eE(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},ZP),e);try{const s=new nk(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Cu(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const o=i.ok?a.errorMessage:a.error.message,[c,d]=o.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Cu(n,"credential-already-in-use",a);if(c==="EMAIL_EXISTS")throw Cu(n,"email-already-in-use",a);if(c==="USER_DISABLED")throw Cu(n,"user-disabled",a);const h=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Xb(n,h,d);Ar(n,h)}}catch(s){if(s instanceof vs)throw s;Ar(n,"network-request-failed",{message:String(s)})}}async function Dc(n,e,t,r,s={}){const i=await _s(n,e,t,r,s);return"mfaPendingCredential"in i&&Ar(n,"multi-factor-auth-required",{_serverResponse:i}),i}function tE(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?yg(n.config,s):`${n.config.apiScheme}://${s}`}function tk(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class nk{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Fr(this.auth,"network-request-failed")),ek.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Cu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Fr(n,e,r);return s.customData._tokenResponse=t,s}function D0(n){return n!==void 0&&n.enterprise!==void 0}class rk{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return tk(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function sk(n,e){return _s(n,"GET","/v2/recaptchaConfig",xs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ik(n,e){return _s(n,"POST","/v1/accounts:delete",e)}async function nE(n,e){return _s(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fl(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ak(n,e=!1){const t=lt(n),r=await t.getIdToken(e),s=vg(r);Ne(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Fl(Pm(s.auth_time)),issuedAtTime:Fl(Pm(s.iat)),expirationTime:Fl(Pm(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Pm(n){return Number(n)*1e3}function vg(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ku("JWT malformed, contained fewer than 3 sections"),null;try{const s=Ob(t);return s?JSON.parse(s):(Ku("Failed to decode base64 JWT payload"),null)}catch(s){return Ku("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function M0(n){const e=vg(n);return Ne(e,"internal-error"),Ne(typeof e.exp<"u","internal-error"),Ne(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hc(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof vs&&ok(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function ok({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Fl(this.lastLoginAt),this.creationTime=Fl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Od(n){var e;const t=n.auth,r=await n.getIdToken(),s=await hc(n,nE(t,{idToken:r}));Ne(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const a=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?rE(i.providerUserInfo):[],o=uk(n.providerData,a),c=n.isAnonymous,d=!(n.email&&i.passwordHash)&&!(o!=null&&o.length),h=c?d:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Bf(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,m)}async function ck(n){const e=lt(n);await Od(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function uk(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function rE(n){return n.map(e=>{var{providerId:t}=e,r=pg(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dk(n,e){const t=await eE(n,{},async()=>{const r=kc({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=tE(n,s,"/v1/token",`key=${i}`),o=await n._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Zb.fetch()(a,{method:"POST",headers:o,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function hk(n,e){return _s(n,"POST","/v2/accounts:revokeToken",xs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ne(e.idToken,"internal-error"),Ne(typeof e.idToken<"u","internal-error"),Ne(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):M0(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ne(e.length!==0,"internal-error");const t=M0(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ne(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await dk(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new to;return r&&(Ne(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(Ne(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(Ne(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new to,this.toJSON())}_performRefresh(){return ns("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ps(n,e){Ne(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class rs{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=pg(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new lk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Bf(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await hc(this,this.stsTokenManager.getToken(this.auth,e));return Ne(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return ak(this,e)}reload(){return ck(this)}_assign(e){this!==e&&(Ne(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new rs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ne(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Od(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Dr(this.auth.app))return Promise.reject(os(this.auth));const e=await this.getIdToken();return await hc(this,ik(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,a,o,c,d,h;const m=(r=t.displayName)!==null&&r!==void 0?r:void 0,p=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,E=(a=t.photoURL)!==null&&a!==void 0?a:void 0,v=(o=t.tenantId)!==null&&o!==void 0?o:void 0,I=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,_=(d=t.createdAt)!==null&&d!==void 0?d:void 0,x=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:C,emailVerified:R,isAnonymous:F,providerData:q,stsTokenManager:T}=t;Ne(C&&T,e,"internal-error");const b=to.fromJSON(this.name,T);Ne(typeof C=="string",e,"internal-error"),Ps(m,e.name),Ps(p,e.name),Ne(typeof R=="boolean",e,"internal-error"),Ne(typeof F=="boolean",e,"internal-error"),Ps(y,e.name),Ps(E,e.name),Ps(v,e.name),Ps(I,e.name),Ps(_,e.name),Ps(x,e.name);const A=new rs({uid:C,auth:e,email:p,emailVerified:R,displayName:m,isAnonymous:F,photoURL:E,phoneNumber:y,tenantId:v,stsTokenManager:b,createdAt:_,lastLoginAt:x});return q&&Array.isArray(q)&&(A.providerData=q.map(P=>Object.assign({},P))),I&&(A._redirectEventId=I),A}static async _fromIdTokenResponse(e,t,r=!1){const s=new to;s.updateFromServerResponse(t);const i=new rs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Od(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];Ne(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?rE(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),o=new to;o.updateFromIdToken(r);const c=new rs({uid:s.localId,auth:e,stsTokenManager:o,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Bf(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V0=new Map;function ss(n){ms(n instanceof Function,"Expected a class definition");let e=V0.get(n);return e?(ms(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,V0.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}sE.type="NONE";const L0=sE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qu(n,e,t){return`firebase:${n}:${e}:${t}`}class no{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Qu(this.userKey,s.apiKey,i),this.fullPersistenceKey=Qu("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?rs._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new no(ss(L0),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||ss(L0);const a=Qu(r,e.config.apiKey,e.name);let o=null;for(const d of t)try{const h=await d._get(a);if(h){const m=rs._fromJSON(e,h);d!==i&&(o=m),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new no(i,e,r):(i=c[0],o&&await i._set(a,o.toJSON()),await Promise.all(t.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new no(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O0(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(lE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(iE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(uE(e))return"Blackberry";if(dE(e))return"Webos";if(aE(e))return"Safari";if((e.includes("chrome/")||oE(e))&&!e.includes("edge/"))return"Chrome";if(cE(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function iE(n=Yt()){return/firefox\//i.test(n)}function aE(n=Yt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function oE(n=Yt()){return/crios\//i.test(n)}function lE(n=Yt()){return/iemobile/i.test(n)}function cE(n=Yt()){return/android/i.test(n)}function uE(n=Yt()){return/blackberry/i.test(n)}function dE(n=Yt()){return/webos/i.test(n)}function xg(n=Yt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function mk(n=Yt()){var e;return xg(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function fk(){return kN()&&document.documentMode===10}function hE(n=Yt()){return xg(n)||cE(n)||dE(n)||uE(n)||/windows phone/i.test(n)||lE(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mE(n,e=[]){let t;switch(n){case"Browser":t=O0(Yt());break;case"Worker":t=`${O0(Yt())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Lo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,o)=>{try{const c=e(i);a(c)}catch(c){o(c)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gk(n,e={}){return _s(n,"GET","/v2/passwordPolicy",xs(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yk=6;class vk{constructor(e){var t,r,s,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:yk,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,a,o;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(s=c.containsLowercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(i=c.containsUppercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(a=c.containsNumericCharacter)!==null&&a!==void 0?a:!0),c.isValid&&(c.isValid=(o=c.containsNonAlphanumericCharacter)!==null&&o!==void 0?o:!0),c}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new F0(this),this.idTokenSubscription=new F0(this),this.beforeStateQueue=new pk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Jb,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ss(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await no.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await nE(this,{idToken:e}),r=await rs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Dr(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,o=s==null?void 0:s._redirectEventId,c=await this.tryRedirectSignIn(e);(!a||a===o)&&(c!=null&&c.user)&&(s=c.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ne(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Od(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=XP()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Dr(this.app))return Promise.reject(os(this));const t=e?lt(e):null;return t&&Ne(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ne(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Dr(this.app)?Promise.reject(os(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Dr(this.app)?Promise.reject(os(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ss(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await gk(this),t=new vk(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Pc("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await hk(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ss(e)||this._popupRedirectResolver;Ne(t,this,"argument-error"),this.redirectPersistenceManager=await no.create(this,[ss(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ne(o,this,"internal-error"),o.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,r,s);return()=>{a=!0,c()}}else{const c=e.addObserver(t);return()=>{a=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ne(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=mE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&QP(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function fa(n){return lt(n)}class F0{constructor(e){this.auth=e,this.observer=null,this.addObserver=LN(t=>this.observer=t)}get next(){return Ne(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _h={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _k(n){_h=n}function fE(n){return _h.loadJS(n)}function wk(){return _h.recaptchaEnterpriseScript}function bk(){return _h.gapiScript}function Ek(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const Tk="recaptcha-enterprise",Ik="NO_RECAPTCHA";class Sk{constructor(e){this.type=Tk,this.auth=fa(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,o)=>{sk(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const d=new rk(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(c=>{o(c)})})}function s(i,a,o){const c=window.grecaptcha;D0(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(Ik)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,a)=>{r(this.auth).then(o=>{if(!t&&D0(window.grecaptcha))s(o,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let c=wk();c.length!==0&&(c+=o),fE(c).then(()=>{s(o,i,a)}).catch(d=>{a(d)})}}).catch(o=>{a(o)})})}}async function $0(n,e,t,r=!1){const s=new Sk(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const a=Object.assign({},e);return r?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function zf(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await $0(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await $0(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ck(n,e){const t=Rc(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(li(i,e??{}))return s;Ar(s,"already-initialized")}return t.initialize({options:e})}function Ak(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(ss);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function Nk(n,e,t){const r=fa(n);Ne(r._canInitEmulator,r,"emulator-config-failed"),Ne(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=pE(e),{host:a,port:o}=Pk(e),c=o===null?"":`:${o}`;r.config.emulator={url:`${i}//${a}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||kk()}function pE(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Pk(n){const e=pE(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:U0(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:U0(a)}}}function U0(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function kk(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ns("not implemented")}_getIdTokenResponse(e){return ns("not implemented")}_linkToIdToken(e,t){return ns("not implemented")}_getReauthenticationResolver(e){return ns("not implemented")}}async function Rk(n,e){return _s(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jk(n,e){return Dc(n,"POST","/v1/accounts:signInWithPassword",xs(n,e))}async function Dk(n,e){return _s(n,"POST","/v1/accounts:sendOobCode",xs(n,e))}async function Mk(n,e){return Dk(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vk(n,e){return Dc(n,"POST","/v1/accounts:signInWithEmailLink",xs(n,e))}async function Lk(n,e){return Dc(n,"POST","/v1/accounts:signInWithEmailLink",xs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc extends _g{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new mc(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new mc(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return zf(e,t,"signInWithPassword",jk);case"emailLink":return Vk(e,{email:this._email,oobCode:this._password});default:Ar(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return zf(e,r,"signUpPassword",Rk);case"emailLink":return Lk(e,{idToken:t,email:this._email,oobCode:this._password});default:Ar(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ro(n,e){return Dc(n,"POST","/v1/accounts:signInWithIdp",xs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ok="http://localhost";class ta extends _g{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ta(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ar("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=pg(t,["providerId","signInMethod"]);if(!r||!s)return null;const a=new ta(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return ro(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ro(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ro(e,t)}buildRequest(){const e={requestUri:Ok,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=kc(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fk(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function $k(n){const e=Tl(Il(n)).link,t=e?Tl(Il(e)).deep_link_id:null,r=Tl(Il(n)).deep_link_id;return(r?Tl(Il(r)).link:null)||r||t||e||n}class wg{constructor(e){var t,r,s,i,a,o;const c=Tl(Il(e)),d=(t=c.apiKey)!==null&&t!==void 0?t:null,h=(r=c.oobCode)!==null&&r!==void 0?r:null,m=Fk((s=c.mode)!==null&&s!==void 0?s:null);Ne(d&&h&&m,"argument-error"),this.apiKey=d,this.operation=m,this.code=h,this.continueUrl=(i=c.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(a=c.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(o=c.tenantId)!==null&&o!==void 0?o:null}static parseLink(e){const t=$k(e);try{return new wg(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oo{constructor(){this.providerId=Oo.PROVIDER_ID}static credential(e,t){return mc._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=wg.parseLink(t);return Ne(r,"argument-error"),mc._fromEmailAndCode(e,r.code,r.tenantId)}}Oo.PROVIDER_ID="password";Oo.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Oo.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc extends gE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls extends Mc{constructor(){super("facebook.com")}static credential(e){return ta._fromParams({providerId:Ls.PROVIDER_ID,signInMethod:Ls.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ls.credentialFromTaggedObject(e)}static credentialFromError(e){return Ls.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ls.credential(e.oauthAccessToken)}catch{return null}}}Ls.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ls.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os extends Mc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ta._fromParams({providerId:Os.PROVIDER_ID,signInMethod:Os.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Os.credentialFromTaggedObject(e)}static credentialFromError(e){return Os.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Os.credential(t,r)}catch{return null}}}Os.GOOGLE_SIGN_IN_METHOD="google.com";Os.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs extends Mc{constructor(){super("github.com")}static credential(e){return ta._fromParams({providerId:Fs.PROVIDER_ID,signInMethod:Fs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Fs.credentialFromTaggedObject(e)}static credentialFromError(e){return Fs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Fs.credential(e.oauthAccessToken)}catch{return null}}}Fs.GITHUB_SIGN_IN_METHOD="github.com";Fs.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s extends Mc{constructor(){super("twitter.com")}static credential(e,t){return ta._fromParams({providerId:$s.PROVIDER_ID,signInMethod:$s.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return $s.credentialFromTaggedObject(e)}static credentialFromError(e){return $s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return $s.credential(t,r)}catch{return null}}}$s.TWITTER_SIGN_IN_METHOD="twitter.com";$s.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uk(n,e){return Dc(n,"POST","/v1/accounts:signUp",xs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await rs._fromIdTokenResponse(e,r,s),a=B0(r);return new na({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=B0(r);return new na({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function B0(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fd extends vs{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Fd.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Fd(e,t,r,s)}}function yE(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Fd._fromErrorAndOperation(n,i,e,r):i})}async function Bk(n,e,t=!1){const r=await hc(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return na._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zk(n,e,t=!1){const{auth:r}=n;if(Dr(r.app))return Promise.reject(os(r));const s="reauthenticate";try{const i=await hc(n,yE(r,s,e,n),t);Ne(i.idToken,r,"internal-error");const a=vg(i.idToken);Ne(a,r,"internal-error");const{sub:o}=a;return Ne(n.uid===o,r,"user-mismatch"),na._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Ar(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vE(n,e,t=!1){if(Dr(n.app))return Promise.reject(os(n));const r="signIn",s=await yE(n,r,e),i=await na._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function qk(n,e){return vE(fa(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wk(n,e,t){var r;Ne(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),Ne(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(Ne(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(Ne(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xE(n){const e=fa(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Hk(n,e,t){if(Dr(n.app))return Promise.reject(os(n));const r=fa(n),a=await zf(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Uk).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&xE(n),c}),o=await na._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(o.user),o}function Gk(n,e,t){return Dr(n.app)?Promise.reject(os(n)):qk(lt(n),Oo.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&xE(n),r})}async function Kk(n,e){const t=lt(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Wk(t.auth,s,e);const{email:i}=await Mk(t.auth,s);i!==n.email&&await n.reload()}function Qk(n,e,t,r){return lt(n).onIdTokenChanged(e,t,r)}function Yk(n,e,t){return lt(n).beforeAuthStateChanged(e,t)}function _E(n,e,t,r){return lt(n).onAuthStateChanged(e,t,r)}function wE(n){return lt(n).signOut()}const $d="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem($d,"1"),this.storage.removeItem($d),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jk=1e3,Xk=10;class EE extends bE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=hE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,o,c)=>{this.notifyListeners(a,c)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);fk()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Xk):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Jk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}EE.type="LOCAL";const Zk=EE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TE extends bE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}TE.type="SESSION";const IE=TE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eR(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new wh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const o=Array.from(a).map(async d=>d(t.origin,i)),c=await eR(o);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}wh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bg(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tR{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((o,c)=>{const d=bg("",20);s.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(m){const p=m;if(p.data.eventId===d)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(p.data.response);break;default:clearTimeout(h),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $r(){return window}function nR(n){$r().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SE(){return typeof $r().WorkerGlobalScope<"u"&&typeof $r().importScripts=="function"}async function rR(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function sR(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function iR(){return SE()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CE="firebaseLocalStorageDb",aR=1,Ud="firebaseLocalStorage",AE="fbase_key";class Vc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function bh(n,e){return n.transaction([Ud],e?"readwrite":"readonly").objectStore(Ud)}function oR(){const n=indexedDB.deleteDatabase(CE);return new Vc(n).toPromise()}function qf(){const n=indexedDB.open(CE,aR);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Ud,{keyPath:AE})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Ud)?e(r):(r.close(),await oR(),e(await qf()))})})}async function z0(n,e,t){const r=bh(n,!0).put({[AE]:e,value:t});return new Vc(r).toPromise()}async function lR(n,e){const t=bh(n,!1).get(e),r=await new Vc(t).toPromise();return r===void 0?null:r.value}function q0(n,e){const t=bh(n,!0).delete(e);return new Vc(t).toPromise()}const cR=800,uR=3;class NE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await qf(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>uR)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return SE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=wh._getInstance(iR()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await rR(),!this.activeServiceWorker)return;this.sender=new tR(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||sR()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await qf();return await z0(e,$d,"1"),await q0(e,$d),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>z0(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>lR(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>q0(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=bh(s,!1).getAll();return new Vc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),cR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}NE.type="LOCAL";const dR=NE;new jc(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hR(n,e){return e?ss(e):(Ne(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg extends _g{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ro(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ro(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ro(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function mR(n){return vE(n.auth,new Eg(n),n.bypassAuthState)}function fR(n){const{auth:e,user:t}=n;return Ne(t,e,"internal-error"),zk(t,new Eg(n),n.bypassAuthState)}async function pR(n){const{auth:e,user:t}=n;return Ne(t,e,"internal-error"),Bk(t,new Eg(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PE{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:o}=e;if(a){this.reject(a);return}const c={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return mR;case"linkViaPopup":case"linkViaRedirect":return pR;case"reauthViaPopup":case"reauthViaRedirect":return fR;default:Ar(this.auth,"internal-error")}}resolve(e){ms(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ms(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gR=new jc(2e3,1e4);class Ka extends PE{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Ka.currentPopupAction&&Ka.currentPopupAction.cancel(),Ka.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ne(e,this.auth,"internal-error"),e}async onExecution(){ms(this.filter.length===1,"Popup operations only handle one event");const e=bg();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Fr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Fr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ka.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Fr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,gR.get())};e()}}Ka.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yR="pendingRedirect",Yu=new Map;class vR extends PE{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Yu.get(this.auth._key());if(!e){try{const r=await xR(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Yu.set(this.auth._key(),e)}return this.bypassAuthState||Yu.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function xR(n,e){const t=bR(e),r=wR(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function _R(n,e){Yu.set(n._key(),e)}function wR(n){return ss(n._redirectPersistence)}function bR(n){return Qu(yR,n.config.apiKey,n.name)}async function ER(n,e,t=!1){if(Dr(n.app))return Promise.reject(os(n));const r=fa(n),s=hR(r,e),a=await new vR(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TR=10*60*1e3;class IR{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!SR(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!kE(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Fr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=TR&&this.cachedEventUids.clear(),this.cachedEventUids.has(W0(e))}saveEventToCache(e){this.cachedEventUids.add(W0(e)),this.lastProcessedEventTime=Date.now()}}function W0(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function kE({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function SR(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return kE(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CR(n,e={}){return _s(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AR=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,NR=/^https?/;async function PR(n){if(n.config.emulator)return;const{authorizedDomains:e}=await CR(n);for(const t of e)try{if(kR(t))return}catch{}Ar(n,"unauthorized-domain")}function kR(n){const e=Uf(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!NR.test(t))return!1;if(AR.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RR=new jc(3e4,6e4);function H0(){const n=$r().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function jR(n){return new Promise((e,t)=>{var r,s,i;function a(){H0(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{H0(),t(Fr(n,"network-request-failed"))},timeout:RR.get()})}if(!((s=(r=$r().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=$r().gapi)===null||i===void 0)&&i.load)a();else{const o=Ek("iframefcb");return $r()[o]=()=>{gapi.load?a():t(Fr(n,"network-request-failed"))},fE(`${bk()}?onload=${o}`).catch(c=>t(c))}}).catch(e=>{throw Ju=null,e})}let Ju=null;function DR(n){return Ju=Ju||jR(n),Ju}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MR=new jc(5e3,15e3),VR="__/auth/iframe",LR="emulator/auth/iframe",OR={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},FR=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function $R(n){const e=n.config;Ne(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?yg(e,LR):`https://${n.config.authDomain}/${VR}`,r={apiKey:e.apiKey,appName:n.name,v:Lo},s=FR.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${kc(r).slice(1)}`}async function UR(n){const e=await DR(n),t=$r().gapi;return Ne(t,n,"internal-error"),e.open({where:document.body,url:$R(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:OR,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=Fr(n,"network-request-failed"),o=$r().setTimeout(()=>{i(a)},MR.get());function c(){$r().clearTimeout(o),s(r)}r.ping(c).then(c,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BR={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},zR=500,qR=600,WR="_blank",HR="http://localhost";class G0{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function GR(n,e,t,r=zR,s=qR){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const c=Object.assign(Object.assign({},BR),{width:r.toString(),height:s.toString(),top:i,left:a}),d=Yt().toLowerCase();t&&(o=oE(d)?WR:t),iE(d)&&(e=e||HR,c.scrollbars="yes");const h=Object.entries(c).reduce((p,[y,E])=>`${p}${y}=${E},`,"");if(mk(d)&&o!=="_self")return KR(e||"",o),new G0(null);const m=window.open(e||"",o,h);Ne(m,n,"popup-blocked");try{m.focus()}catch{}return new G0(m)}function KR(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QR="__/auth/handler",YR="emulator/auth/handler",JR=encodeURIComponent("fac");async function K0(n,e,t,r,s,i){Ne(n.config.authDomain,n,"auth-domain-config-required"),Ne(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Lo,eventId:s};if(e instanceof gE){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",VN(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,m]of Object.entries(i||{}))a[h]=m}if(e instanceof Mc){const h=e.getScopes().filter(m=>m!=="");h.length>0&&(a.scopes=h.join(","))}n.tenantId&&(a.tid=n.tenantId);const o=a;for(const h of Object.keys(o))o[h]===void 0&&delete o[h];const c=await n._getAppCheckToken(),d=c?`#${JR}=${encodeURIComponent(c)}`:"";return`${XR(n)}?${kc(o).slice(1)}${d}`}function XR({config:n}){return n.emulator?yg(n,YR):`https://${n.authDomain}/${QR}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const km="webStorageSupport";class ZR{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=IE,this._completeRedirectFn=ER,this._overrideRedirectResult=_R}async _openPopup(e,t,r,s){var i;ms((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await K0(e,t,r,Uf(),s);return GR(e,a,bg())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await K0(e,t,r,Uf(),s);return nR(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(ms(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await UR(e),r=new IR(e);return t.register("authEvent",s=>(Ne(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(km,{type:km},s=>{var i;const a=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[km];a!==void 0&&t(!!a),Ar(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=PR(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return hE()||aE()||xg()}}const ej=ZR;var Q0="@firebase/auth",Y0="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ne(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nj(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function rj(n){fo(new ea("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;Ne(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:a,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:mE(n)},d=new xk(r,s,i,c);return Ak(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),fo(new ea("auth-internal",e=>{const t=fa(e.getProvider("auth").getImmediate());return(r=>new tj(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ii(Q0,Y0,nj(n)),ii(Q0,Y0,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sj=5*60,ij=Ub("authIdTokenMaxAge")||sj;let J0=null;const aj=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>ij)return;const s=t==null?void 0:t.token;J0!==s&&(J0=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function oj(n=Gb()){const e=Rc(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Ck(n,{popupRedirectResolver:ej,persistence:[dR,Zk,IE]}),r=Ub("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=aj(i.toString());Yk(t,a,()=>a(t.currentUser)),Qk(t,o=>a(o))}}const s=Fb("auth");return s&&Nk(t,`http://${s}`),t}function lj(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}_k({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Fr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",lj().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});rj("Browser");var cj="firebase",uj="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ii(cj,uj,"app");var X0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Gi,RE;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,b){function A(){}A.prototype=b.prototype,T.D=b.prototype,T.prototype=new A,T.prototype.constructor=T,T.C=function(P,D,N){for(var S=Array(arguments.length-2),Be=2;Be<arguments.length;Be++)S[Be-2]=arguments[Be];return b.prototype[D].apply(P,S)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,b,A){A||(A=0);var P=Array(16);if(typeof b=="string")for(var D=0;16>D;++D)P[D]=b.charCodeAt(A++)|b.charCodeAt(A++)<<8|b.charCodeAt(A++)<<16|b.charCodeAt(A++)<<24;else for(D=0;16>D;++D)P[D]=b[A++]|b[A++]<<8|b[A++]<<16|b[A++]<<24;b=T.g[0],A=T.g[1],D=T.g[2];var N=T.g[3],S=b+(N^A&(D^N))+P[0]+3614090360&4294967295;b=A+(S<<7&4294967295|S>>>25),S=N+(D^b&(A^D))+P[1]+3905402710&4294967295,N=b+(S<<12&4294967295|S>>>20),S=D+(A^N&(b^A))+P[2]+606105819&4294967295,D=N+(S<<17&4294967295|S>>>15),S=A+(b^D&(N^b))+P[3]+3250441966&4294967295,A=D+(S<<22&4294967295|S>>>10),S=b+(N^A&(D^N))+P[4]+4118548399&4294967295,b=A+(S<<7&4294967295|S>>>25),S=N+(D^b&(A^D))+P[5]+1200080426&4294967295,N=b+(S<<12&4294967295|S>>>20),S=D+(A^N&(b^A))+P[6]+2821735955&4294967295,D=N+(S<<17&4294967295|S>>>15),S=A+(b^D&(N^b))+P[7]+4249261313&4294967295,A=D+(S<<22&4294967295|S>>>10),S=b+(N^A&(D^N))+P[8]+1770035416&4294967295,b=A+(S<<7&4294967295|S>>>25),S=N+(D^b&(A^D))+P[9]+2336552879&4294967295,N=b+(S<<12&4294967295|S>>>20),S=D+(A^N&(b^A))+P[10]+4294925233&4294967295,D=N+(S<<17&4294967295|S>>>15),S=A+(b^D&(N^b))+P[11]+2304563134&4294967295,A=D+(S<<22&4294967295|S>>>10),S=b+(N^A&(D^N))+P[12]+1804603682&4294967295,b=A+(S<<7&4294967295|S>>>25),S=N+(D^b&(A^D))+P[13]+4254626195&4294967295,N=b+(S<<12&4294967295|S>>>20),S=D+(A^N&(b^A))+P[14]+2792965006&4294967295,D=N+(S<<17&4294967295|S>>>15),S=A+(b^D&(N^b))+P[15]+1236535329&4294967295,A=D+(S<<22&4294967295|S>>>10),S=b+(D^N&(A^D))+P[1]+4129170786&4294967295,b=A+(S<<5&4294967295|S>>>27),S=N+(A^D&(b^A))+P[6]+3225465664&4294967295,N=b+(S<<9&4294967295|S>>>23),S=D+(b^A&(N^b))+P[11]+643717713&4294967295,D=N+(S<<14&4294967295|S>>>18),S=A+(N^b&(D^N))+P[0]+3921069994&4294967295,A=D+(S<<20&4294967295|S>>>12),S=b+(D^N&(A^D))+P[5]+3593408605&4294967295,b=A+(S<<5&4294967295|S>>>27),S=N+(A^D&(b^A))+P[10]+38016083&4294967295,N=b+(S<<9&4294967295|S>>>23),S=D+(b^A&(N^b))+P[15]+3634488961&4294967295,D=N+(S<<14&4294967295|S>>>18),S=A+(N^b&(D^N))+P[4]+3889429448&4294967295,A=D+(S<<20&4294967295|S>>>12),S=b+(D^N&(A^D))+P[9]+568446438&4294967295,b=A+(S<<5&4294967295|S>>>27),S=N+(A^D&(b^A))+P[14]+3275163606&4294967295,N=b+(S<<9&4294967295|S>>>23),S=D+(b^A&(N^b))+P[3]+4107603335&4294967295,D=N+(S<<14&4294967295|S>>>18),S=A+(N^b&(D^N))+P[8]+1163531501&4294967295,A=D+(S<<20&4294967295|S>>>12),S=b+(D^N&(A^D))+P[13]+2850285829&4294967295,b=A+(S<<5&4294967295|S>>>27),S=N+(A^D&(b^A))+P[2]+4243563512&4294967295,N=b+(S<<9&4294967295|S>>>23),S=D+(b^A&(N^b))+P[7]+1735328473&4294967295,D=N+(S<<14&4294967295|S>>>18),S=A+(N^b&(D^N))+P[12]+2368359562&4294967295,A=D+(S<<20&4294967295|S>>>12),S=b+(A^D^N)+P[5]+4294588738&4294967295,b=A+(S<<4&4294967295|S>>>28),S=N+(b^A^D)+P[8]+2272392833&4294967295,N=b+(S<<11&4294967295|S>>>21),S=D+(N^b^A)+P[11]+1839030562&4294967295,D=N+(S<<16&4294967295|S>>>16),S=A+(D^N^b)+P[14]+4259657740&4294967295,A=D+(S<<23&4294967295|S>>>9),S=b+(A^D^N)+P[1]+2763975236&4294967295,b=A+(S<<4&4294967295|S>>>28),S=N+(b^A^D)+P[4]+1272893353&4294967295,N=b+(S<<11&4294967295|S>>>21),S=D+(N^b^A)+P[7]+4139469664&4294967295,D=N+(S<<16&4294967295|S>>>16),S=A+(D^N^b)+P[10]+3200236656&4294967295,A=D+(S<<23&4294967295|S>>>9),S=b+(A^D^N)+P[13]+681279174&4294967295,b=A+(S<<4&4294967295|S>>>28),S=N+(b^A^D)+P[0]+3936430074&4294967295,N=b+(S<<11&4294967295|S>>>21),S=D+(N^b^A)+P[3]+3572445317&4294967295,D=N+(S<<16&4294967295|S>>>16),S=A+(D^N^b)+P[6]+76029189&4294967295,A=D+(S<<23&4294967295|S>>>9),S=b+(A^D^N)+P[9]+3654602809&4294967295,b=A+(S<<4&4294967295|S>>>28),S=N+(b^A^D)+P[12]+3873151461&4294967295,N=b+(S<<11&4294967295|S>>>21),S=D+(N^b^A)+P[15]+530742520&4294967295,D=N+(S<<16&4294967295|S>>>16),S=A+(D^N^b)+P[2]+3299628645&4294967295,A=D+(S<<23&4294967295|S>>>9),S=b+(D^(A|~N))+P[0]+4096336452&4294967295,b=A+(S<<6&4294967295|S>>>26),S=N+(A^(b|~D))+P[7]+1126891415&4294967295,N=b+(S<<10&4294967295|S>>>22),S=D+(b^(N|~A))+P[14]+2878612391&4294967295,D=N+(S<<15&4294967295|S>>>17),S=A+(N^(D|~b))+P[5]+4237533241&4294967295,A=D+(S<<21&4294967295|S>>>11),S=b+(D^(A|~N))+P[12]+1700485571&4294967295,b=A+(S<<6&4294967295|S>>>26),S=N+(A^(b|~D))+P[3]+2399980690&4294967295,N=b+(S<<10&4294967295|S>>>22),S=D+(b^(N|~A))+P[10]+4293915773&4294967295,D=N+(S<<15&4294967295|S>>>17),S=A+(N^(D|~b))+P[1]+2240044497&4294967295,A=D+(S<<21&4294967295|S>>>11),S=b+(D^(A|~N))+P[8]+1873313359&4294967295,b=A+(S<<6&4294967295|S>>>26),S=N+(A^(b|~D))+P[15]+4264355552&4294967295,N=b+(S<<10&4294967295|S>>>22),S=D+(b^(N|~A))+P[6]+2734768916&4294967295,D=N+(S<<15&4294967295|S>>>17),S=A+(N^(D|~b))+P[13]+1309151649&4294967295,A=D+(S<<21&4294967295|S>>>11),S=b+(D^(A|~N))+P[4]+4149444226&4294967295,b=A+(S<<6&4294967295|S>>>26),S=N+(A^(b|~D))+P[11]+3174756917&4294967295,N=b+(S<<10&4294967295|S>>>22),S=D+(b^(N|~A))+P[2]+718787259&4294967295,D=N+(S<<15&4294967295|S>>>17),S=A+(N^(D|~b))+P[9]+3951481745&4294967295,T.g[0]=T.g[0]+b&4294967295,T.g[1]=T.g[1]+(D+(S<<21&4294967295|S>>>11))&4294967295,T.g[2]=T.g[2]+D&4294967295,T.g[3]=T.g[3]+N&4294967295}r.prototype.u=function(T,b){b===void 0&&(b=T.length);for(var A=b-this.blockSize,P=this.B,D=this.h,N=0;N<b;){if(D==0)for(;N<=A;)s(this,T,N),N+=this.blockSize;if(typeof T=="string"){for(;N<b;)if(P[D++]=T.charCodeAt(N++),D==this.blockSize){s(this,P),D=0;break}}else for(;N<b;)if(P[D++]=T[N++],D==this.blockSize){s(this,P),D=0;break}}this.h=D,this.o+=b},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var b=1;b<T.length-8;++b)T[b]=0;var A=8*this.o;for(b=T.length-8;b<T.length;++b)T[b]=A&255,A/=256;for(this.u(T),T=Array(16),b=A=0;4>b;++b)for(var P=0;32>P;P+=8)T[A++]=this.g[b]>>>P&255;return T};function i(T,b){var A=o;return Object.prototype.hasOwnProperty.call(A,T)?A[T]:A[T]=b(T)}function a(T,b){this.h=b;for(var A=[],P=!0,D=T.length-1;0<=D;D--){var N=T[D]|0;P&&N==b||(A[D]=N,P=!1)}this.g=A}var o={};function c(T){return-128<=T&&128>T?i(T,function(b){return new a([b|0],0>b?-1:0)}):new a([T|0],0>T?-1:0)}function d(T){if(isNaN(T)||!isFinite(T))return m;if(0>T)return I(d(-T));for(var b=[],A=1,P=0;T>=A;P++)b[P]=T/A|0,A*=4294967296;return new a(b,0)}function h(T,b){if(T.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(T.charAt(0)=="-")return I(h(T.substring(1),b));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var A=d(Math.pow(b,8)),P=m,D=0;D<T.length;D+=8){var N=Math.min(8,T.length-D),S=parseInt(T.substring(D,D+N),b);8>N?(N=d(Math.pow(b,N)),P=P.j(N).add(d(S))):(P=P.j(A),P=P.add(d(S)))}return P}var m=c(0),p=c(1),y=c(16777216);n=a.prototype,n.m=function(){if(v(this))return-I(this).m();for(var T=0,b=1,A=0;A<this.g.length;A++){var P=this.i(A);T+=(0<=P?P:4294967296+P)*b,b*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(E(this))return"0";if(v(this))return"-"+I(this).toString(T);for(var b=d(Math.pow(T,6)),A=this,P="";;){var D=R(A,b).g;A=_(A,D.j(b));var N=((0<A.g.length?A.g[0]:A.h)>>>0).toString(T);if(A=D,E(A))return N+P;for(;6>N.length;)N="0"+N;P=N+P}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function E(T){if(T.h!=0)return!1;for(var b=0;b<T.g.length;b++)if(T.g[b]!=0)return!1;return!0}function v(T){return T.h==-1}n.l=function(T){return T=_(this,T),v(T)?-1:E(T)?0:1};function I(T){for(var b=T.g.length,A=[],P=0;P<b;P++)A[P]=~T.g[P];return new a(A,~T.h).add(p)}n.abs=function(){return v(this)?I(this):this},n.add=function(T){for(var b=Math.max(this.g.length,T.g.length),A=[],P=0,D=0;D<=b;D++){var N=P+(this.i(D)&65535)+(T.i(D)&65535),S=(N>>>16)+(this.i(D)>>>16)+(T.i(D)>>>16);P=S>>>16,N&=65535,S&=65535,A[D]=S<<16|N}return new a(A,A[A.length-1]&-2147483648?-1:0)};function _(T,b){return T.add(I(b))}n.j=function(T){if(E(this)||E(T))return m;if(v(this))return v(T)?I(this).j(I(T)):I(I(this).j(T));if(v(T))return I(this.j(I(T)));if(0>this.l(y)&&0>T.l(y))return d(this.m()*T.m());for(var b=this.g.length+T.g.length,A=[],P=0;P<2*b;P++)A[P]=0;for(P=0;P<this.g.length;P++)for(var D=0;D<T.g.length;D++){var N=this.i(P)>>>16,S=this.i(P)&65535,Be=T.i(D)>>>16,Fe=T.i(D)&65535;A[2*P+2*D]+=S*Fe,x(A,2*P+2*D),A[2*P+2*D+1]+=N*Fe,x(A,2*P+2*D+1),A[2*P+2*D+1]+=S*Be,x(A,2*P+2*D+1),A[2*P+2*D+2]+=N*Be,x(A,2*P+2*D+2)}for(P=0;P<b;P++)A[P]=A[2*P+1]<<16|A[2*P];for(P=b;P<2*b;P++)A[P]=0;return new a(A,0)};function x(T,b){for(;(T[b]&65535)!=T[b];)T[b+1]+=T[b]>>>16,T[b]&=65535,b++}function C(T,b){this.g=T,this.h=b}function R(T,b){if(E(b))throw Error("division by zero");if(E(T))return new C(m,m);if(v(T))return b=R(I(T),b),new C(I(b.g),I(b.h));if(v(b))return b=R(T,I(b)),new C(I(b.g),b.h);if(30<T.g.length){if(v(T)||v(b))throw Error("slowDivide_ only works with positive integers.");for(var A=p,P=b;0>=P.l(T);)A=F(A),P=F(P);var D=q(A,1),N=q(P,1);for(P=q(P,2),A=q(A,2);!E(P);){var S=N.add(P);0>=S.l(T)&&(D=D.add(A),N=S),P=q(P,1),A=q(A,1)}return b=_(T,D.j(b)),new C(D,b)}for(D=m;0<=T.l(b);){for(A=Math.max(1,Math.floor(T.m()/b.m())),P=Math.ceil(Math.log(A)/Math.LN2),P=48>=P?1:Math.pow(2,P-48),N=d(A),S=N.j(b);v(S)||0<S.l(T);)A-=P,N=d(A),S=N.j(b);E(N)&&(N=p),D=D.add(N),T=_(T,S)}return new C(D,T)}n.A=function(T){return R(this,T).h},n.and=function(T){for(var b=Math.max(this.g.length,T.g.length),A=[],P=0;P<b;P++)A[P]=this.i(P)&T.i(P);return new a(A,this.h&T.h)},n.or=function(T){for(var b=Math.max(this.g.length,T.g.length),A=[],P=0;P<b;P++)A[P]=this.i(P)|T.i(P);return new a(A,this.h|T.h)},n.xor=function(T){for(var b=Math.max(this.g.length,T.g.length),A=[],P=0;P<b;P++)A[P]=this.i(P)^T.i(P);return new a(A,this.h^T.h)};function F(T){for(var b=T.g.length+1,A=[],P=0;P<b;P++)A[P]=T.i(P)<<1|T.i(P-1)>>>31;return new a(A,T.h)}function q(T,b){var A=b>>5;b%=32;for(var P=T.g.length-A,D=[],N=0;N<P;N++)D[N]=0<b?T.i(N+A)>>>b|T.i(N+A+1)<<32-b:T.i(N+A);return new a(D,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,RE=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=h,Gi=a}).apply(typeof X0<"u"?X0:typeof self<"u"?self:typeof window<"u"?window:{});var Au=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var jE,Sl,DE,Xu,Wf,ME,VE,LE;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,f,g){return u==Array.prototype||u==Object.prototype||(u[f]=g.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Au=="object"&&Au];for(var f=0;f<u.length;++f){var g=u[f];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=t(this);function s(u,f){if(f)e:{var g=r;u=u.split(".");for(var w=0;w<u.length-1;w++){var L=u[w];if(!(L in g))break e;g=g[L]}u=u[u.length-1],w=g[u],f=f(w),f!=w&&f!=null&&e(g,u,{configurable:!0,writable:!0,value:f})}}function i(u,f){u instanceof String&&(u+="");var g=0,w=!1,L={next:function(){if(!w&&g<u.length){var B=g++;return{value:f(B,u[B]),done:!1}}return w=!0,{done:!0,value:void 0}}};return L[Symbol.iterator]=function(){return L},L}s("Array.prototype.values",function(u){return u||function(){return i(this,function(f,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},o=this||self;function c(u){var f=typeof u;return f=f!="object"?f:u?Array.isArray(u)?"array":f:"null",f=="array"||f=="object"&&typeof u.length=="number"}function d(u){var f=typeof u;return f=="object"&&u!=null||f=="function"}function h(u,f,g){return u.call.apply(u.bind,arguments)}function m(u,f,g){if(!u)throw Error();if(2<arguments.length){var w=Array.prototype.slice.call(arguments,2);return function(){var L=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(L,w),u.apply(f,L)}}return function(){return u.apply(f,arguments)}}function p(u,f,g){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:m,p.apply(null,arguments)}function y(u,f){var g=Array.prototype.slice.call(arguments,1);return function(){var w=g.slice();return w.push.apply(w,arguments),u.apply(this,w)}}function E(u,f){function g(){}g.prototype=f.prototype,u.aa=f.prototype,u.prototype=new g,u.prototype.constructor=u,u.Qb=function(w,L,B){for(var se=Array(arguments.length-2),ct=2;ct<arguments.length;ct++)se[ct-2]=arguments[ct];return f.prototype[L].apply(w,se)}}function v(u){const f=u.length;if(0<f){const g=Array(f);for(let w=0;w<f;w++)g[w]=u[w];return g}return[]}function I(u,f){for(let g=1;g<arguments.length;g++){const w=arguments[g];if(c(w)){const L=u.length||0,B=w.length||0;u.length=L+B;for(let se=0;se<B;se++)u[L+se]=w[se]}else u.push(w)}}class _{constructor(f,g){this.i=f,this.j=g,this.h=0,this.g=null}get(){let f;return 0<this.h?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function x(u){return/^[\s\xa0]*$/.test(u)}function C(){var u=o.navigator;return u&&(u=u.userAgent)?u:""}function R(u){return R[" "](u),u}R[" "]=function(){};var F=C().indexOf("Gecko")!=-1&&!(C().toLowerCase().indexOf("webkit")!=-1&&C().indexOf("Edge")==-1)&&!(C().indexOf("Trident")!=-1||C().indexOf("MSIE")!=-1)&&C().indexOf("Edge")==-1;function q(u,f,g){for(const w in u)f.call(g,u[w],w,u)}function T(u,f){for(const g in u)f.call(void 0,u[g],g,u)}function b(u){const f={};for(const g in u)f[g]=u[g];return f}const A="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function P(u,f){let g,w;for(let L=1;L<arguments.length;L++){w=arguments[L];for(g in w)u[g]=w[g];for(let B=0;B<A.length;B++)g=A[B],Object.prototype.hasOwnProperty.call(w,g)&&(u[g]=w[g])}}function D(u){var f=1;u=u.split(":");const g=[];for(;0<f&&u.length;)g.push(u.shift()),f--;return u.length&&g.push(u.join(":")),g}function N(u){o.setTimeout(()=>{throw u},0)}function S(){var u=ae;let f=null;return u.g&&(f=u.g,u.g=u.g.next,u.g||(u.h=null),f.next=null),f}class Be{constructor(){this.h=this.g=null}add(f,g){const w=Fe.get();w.set(f,g),this.h?this.h.next=w:this.g=w,this.h=w}}var Fe=new _(()=>new $e,u=>u.reset());class $e{constructor(){this.next=this.g=this.h=null}set(f,g){this.h=f,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let Pe,Y=!1,ae=new Be,Se=()=>{const u=o.Promise.resolve(void 0);Pe=()=>{u.then(ee)}};var ee=()=>{for(var u;u=S();){try{u.h.call(u.g)}catch(g){N(g)}var f=Fe;f.j(u),100>f.h&&(f.h++,u.next=f.g,f.g=u)}Y=!1};function H(){this.s=this.s,this.C=this.C}H.prototype.s=!1,H.prototype.ma=function(){this.s||(this.s=!0,this.N())},H.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ne(u,f){this.type=u,this.g=this.target=f,this.defaultPrevented=!1}ne.prototype.h=function(){this.defaultPrevented=!0};var pe=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var u=!1,f=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const g=()=>{};o.addEventListener("test",g,f),o.removeEventListener("test",g,f)}catch{}return u}();function Ue(u,f){if(ne.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var g=this.type=u.type,w=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=f,f=u.relatedTarget){if(F){e:{try{R(f.nodeName);var L=!0;break e}catch{}L=!1}L||(f=null)}}else g=="mouseover"?f=u.fromElement:g=="mouseout"&&(f=u.toElement);this.relatedTarget=f,w?(this.clientX=w.clientX!==void 0?w.clientX:w.pageX,this.clientY=w.clientY!==void 0?w.clientY:w.pageY,this.screenX=w.screenX||0,this.screenY=w.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:oe[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&Ue.aa.h.call(this)}}E(Ue,ne);var oe={2:"touch",3:"pen",4:"mouse"};Ue.prototype.h=function(){Ue.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var ge="closure_listenable_"+(1e6*Math.random()|0),X=0;function Me(u,f,g,w,L){this.listener=u,this.proxy=null,this.src=f,this.type=g,this.capture=!!w,this.ha=L,this.key=++X,this.da=this.fa=!1}function _e(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Ye(u){this.src=u,this.g={},this.h=0}Ye.prototype.add=function(u,f,g,w,L){var B=u.toString();u=this.g[B],u||(u=this.g[B]=[],this.h++);var se=It(u,f,w,L);return-1<se?(f=u[se],g||(f.fa=!1)):(f=new Me(f,this.src,B,!!w,L),f.fa=g,u.push(f)),f};function z(u,f){var g=f.type;if(g in u.g){var w=u.g[g],L=Array.prototype.indexOf.call(w,f,void 0),B;(B=0<=L)&&Array.prototype.splice.call(w,L,1),B&&(_e(f),u.g[g].length==0&&(delete u.g[g],u.h--))}}function It(u,f,g,w){for(var L=0;L<u.length;++L){var B=u[L];if(!B.da&&B.listener==f&&B.capture==!!g&&B.ha==w)return L}return-1}var xt="closure_lm_"+(1e6*Math.random()|0),it={};function Ve(u,f,g,w,L){if(w&&w.once)return Rn(u,f,g,w,L);if(Array.isArray(f)){for(var B=0;B<f.length;B++)Ve(u,f[B],g,w,L);return null}return g=Xt(g),u&&u[ge]?u.K(f,g,d(w)?!!w.capture:!!w,L):Dt(u,f,g,!1,w,L)}function Dt(u,f,g,w,L,B){if(!f)throw Error("Invalid event type");var se=d(L)?!!L.capture:!!L,ct=jn(u);if(ct||(u[xt]=ct=new Ye(u)),g=ct.add(f,g,w,se,B),g.proxy)return g;if(w=at(),g.proxy=w,w.src=u,w.listener=g,u.addEventListener)pe||(L=se),L===void 0&&(L=!1),u.addEventListener(f.toString(),w,L);else if(u.attachEvent)u.attachEvent(Is(f.toString()),w);else if(u.addListener&&u.removeListener)u.addListener(w);else throw Error("addEventListener and attachEvent are unavailable.");return g}function at(){function u(g){return f.call(u.src,u.listener,g)}const f=St;return u}function Rn(u,f,g,w,L){if(Array.isArray(f)){for(var B=0;B<f.length;B++)Rn(u,f[B],g,w,L);return null}return g=Xt(g),u&&u[ge]?u.L(f,g,d(w)?!!w.capture:!!w,L):Dt(u,f,g,!0,w,L)}function Ot(u,f,g,w,L){if(Array.isArray(f))for(var B=0;B<f.length;B++)Ot(u,f[B],g,w,L);else w=d(w)?!!w.capture:!!w,g=Xt(g),u&&u[ge]?(u=u.i,f=String(f).toString(),f in u.g&&(B=u.g[f],g=It(B,g,w,L),-1<g&&(_e(B[g]),Array.prototype.splice.call(B,g,1),B.length==0&&(delete u.g[f],u.h--)))):u&&(u=jn(u))&&(f=u.g[f.toString()],u=-1,f&&(u=It(f,g,w,L)),(g=-1<u?f[u]:null)&&tt(g))}function tt(u){if(typeof u!="number"&&u&&!u.da){var f=u.src;if(f&&f[ge])z(f.i,u);else{var g=u.type,w=u.proxy;f.removeEventListener?f.removeEventListener(g,w,u.capture):f.detachEvent?f.detachEvent(Is(g),w):f.addListener&&f.removeListener&&f.removeListener(w),(g=jn(f))?(z(g,u),g.h==0&&(g.src=null,f[xt]=null)):_e(u)}}}function Is(u){return u in it?it[u]:it[u]="on"+u}function St(u,f){if(u.da)u=!0;else{f=new Ue(f,this);var g=u.listener,w=u.ha||u.src;u.fa&&tt(u),u=g.call(w,f)}return u}function jn(u){return u=u[xt],u instanceof Ye?u:null}var Dn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Xt(u){return typeof u=="function"?u:(u[Dn]||(u[Dn]=function(f){return u.handleEvent(f)}),u[Dn])}function V(){H.call(this),this.i=new Ye(this),this.M=this,this.F=null}E(V,H),V.prototype[ge]=!0,V.prototype.removeEventListener=function(u,f,g,w){Ot(this,u,f,g,w)};function W(u,f){var g,w=u.F;if(w)for(g=[];w;w=w.F)g.push(w);if(u=u.M,w=f.type||f,typeof f=="string")f=new ne(f,u);else if(f instanceof ne)f.target=f.target||u;else{var L=f;f=new ne(w,u),P(f,L)}if(L=!0,g)for(var B=g.length-1;0<=B;B--){var se=f.g=g[B];L=we(se,w,!0,f)&&L}if(se=f.g=u,L=we(se,w,!0,f)&&L,L=we(se,w,!1,f)&&L,g)for(B=0;B<g.length;B++)se=f.g=g[B],L=we(se,w,!1,f)&&L}V.prototype.N=function(){if(V.aa.N.call(this),this.i){var u=this.i,f;for(f in u.g){for(var g=u.g[f],w=0;w<g.length;w++)_e(g[w]);delete u.g[f],u.h--}}this.F=null},V.prototype.K=function(u,f,g,w){return this.i.add(String(u),f,!1,g,w)},V.prototype.L=function(u,f,g,w){return this.i.add(String(u),f,!0,g,w)};function we(u,f,g,w){if(f=u.i.g[String(f)],!f)return!0;f=f.concat();for(var L=!0,B=0;B<f.length;++B){var se=f[B];if(se&&!se.da&&se.capture==g){var ct=se.listener,un=se.ha||se.src;se.fa&&z(u.i,se),L=ct.call(un,w)!==!1&&L}}return L&&!w.defaultPrevented}function Le(u,f,g){if(typeof u=="function")g&&(u=p(u,g));else if(u&&typeof u.handleEvent=="function")u=p(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(f)?-1:o.setTimeout(u,f||0)}function Zt(u){u.g=Le(()=>{u.g=null,u.i&&(u.i=!1,Zt(u))},u.l);const f=u.h;u.h=null,u.m.apply(null,f)}class ln extends H{constructor(f,g){super(),this.m=f,this.l=g,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:Zt(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Un(u){H.call(this),this.h=u,this.g={}}E(Un,H);var en=[];function Ss(u){q(u.g,function(f,g){this.g.hasOwnProperty(g)&&tt(f)},u),u.g={}}Un.prototype.N=function(){Un.aa.N.call(this),Ss(this)},Un.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Bn=o.JSON.stringify,dt=o.JSON.parse,pr=class{stringify(u){return o.JSON.stringify(u,void 0)}parse(u){return o.JSON.parse(u,void 0)}};function gr(){}gr.prototype.h=null;function yn(u){return u.h||(u.h=u.i())}function Nr(){}var yr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Hr(){ne.call(this,"d")}E(Hr,ne);function j(){ne.call(this,"c")}E(j,ne);var J={},be=null;function ke(){return be=be||new V}J.La="serverreachability";function G(u){ne.call(this,J.La,u)}E(G,ne);function Ce(u){const f=ke();W(f,new G(f))}J.STAT_EVENT="statevent";function Ee(u,f){ne.call(this,J.STAT_EVENT,u),this.stat=f}E(Ee,ne);function qe(u){const f=ke();W(f,new Ee(f,u))}J.Ma="timingevent";function Mn(u,f){ne.call(this,J.Ma,u),this.size=f}E(Mn,ne);function _t(u,f){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){u()},f)}function Ct(){this.g=!0}Ct.prototype.xa=function(){this.g=!1};function xa(u,f,g,w,L,B){u.info(function(){if(u.g)if(B)for(var se="",ct=B.split("&"),un=0;un<ct.length;un++){var et=ct[un].split("=");if(1<et.length){var xn=et[0];et=et[1];var _n=xn.split("_");se=2<=_n.length&&_n[1]=="type"?se+(xn+"="+et+"&"):se+(xn+"=redacted&")}}else se=null;else se=B;return"XMLHTTP REQ ("+w+") [attempt "+L+"]: "+f+`
`+g+`
`+se})}function Ci(u,f,g,w,L,B,se){u.info(function(){return"XMLHTTP RESP ("+w+") [ attempt "+L+"]: "+f+`
`+g+`
`+B+" "+se})}function vr(u,f,g,w){u.info(function(){return"XMLHTTP TEXT ("+f+"): "+M(u,g)+(w?" "+w:"")})}function _a(u,f){u.info(function(){return"TIMEOUT: "+f})}Ct.prototype.info=function(){};function M(u,f){if(!u.g)return f;if(!f)return null;try{var g=JSON.parse(f);if(g){for(u=0;u<g.length;u++)if(Array.isArray(g[u])){var w=g[u];if(!(2>w.length)){var L=w[1];if(Array.isArray(L)&&!(1>L.length)){var B=L[0];if(B!="noop"&&B!="stop"&&B!="close")for(var se=1;se<L.length;se++)L[se]=""}}}}return Bn(g)}catch{return f}}var U={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ve={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},le;function ce(){}E(ce,gr),ce.prototype.g=function(){return new XMLHttpRequest},ce.prototype.i=function(){return{}},le=new ce;function ye(u,f,g,w){this.j=u,this.i=f,this.l=g,this.R=w||1,this.U=new Un(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new me}function me(){this.i=null,this.g="",this.h=!1}var xe={},je={};function ue(u,f,g){u.L=1,u.v=tu(Gr(f)),u.m=g,u.P=!0,te(u,null)}function te(u,f){u.F=Date.now(),nt(u),u.A=Gr(u.v);var g=u.A,w=u.R;Array.isArray(w)||(w=[String(w)]),Oy(g.i,"t",w),u.C=0,g=u.j.J,u.h=new me,u.g=nv(u.j,g?f:null,!u.m),0<u.O&&(u.M=new ln(p(u.Y,u,u.g),u.O)),f=u.U,g=u.g,w=u.ca;var L="readystatechange";Array.isArray(L)||(L&&(en[0]=L.toString()),L=en);for(var B=0;B<L.length;B++){var se=Ve(g,L[B],w||f.handleEvent,!1,f.h||f);if(!se)break;f.g[se.key]=se}f=u.H?b(u.H):{},u.m?(u.u||(u.u="POST"),f["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,f)):(u.u="GET",u.g.ea(u.A,u.u,null,f)),Ce(),xa(u.i,u.u,u.A,u.l,u.R,u.m)}ye.prototype.ca=function(u){u=u.target;const f=this.M;f&&Kr(u)==3?f.j():this.Y(u)},ye.prototype.Y=function(u){try{if(u==this.g)e:{const _n=Kr(this.g);var f=this.g.Ba();const Ia=this.g.Z();if(!(3>_n)&&(_n!=3||this.g&&(this.h.h||this.g.oa()||Wy(this.g)))){this.J||_n!=4||f==7||(f==8||0>=Ia?Ce(3):Ce(2)),vn(this);var g=this.g.Z();this.X=g;t:if(Ae(this)){var w=Wy(this.g);u="";var L=w.length,B=Kr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){cn(this),xr(this);var se="";break t}this.h.i=new o.TextDecoder}for(f=0;f<L;f++)this.h.h=!0,u+=this.h.i.decode(w[f],{stream:!(B&&f==L-1)});w.length=0,this.h.g+=u,this.C=0,se=this.h.g}else se=this.g.oa();if(this.o=g==200,Ci(this.i,this.u,this.A,this.l,this.R,_n,g),this.o){if(this.T&&!this.K){t:{if(this.g){var ct,un=this.g;if((ct=un.g?un.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(ct)){var et=ct;break t}}et=null}if(g=et)vr(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ai(this,g);else{this.o=!1,this.s=3,qe(12),cn(this),xr(this);break e}}if(this.P){g=!0;let _r;for(;!this.J&&this.C<se.length;)if(_r=Ft(this,se),_r==je){_n==4&&(this.s=4,qe(14),g=!1),vr(this.i,this.l,null,"[Incomplete Response]");break}else if(_r==xe){this.s=4,qe(15),vr(this.i,this.l,se,"[Invalid Chunk]"),g=!1;break}else vr(this.i,this.l,_r,null),Ai(this,_r);if(Ae(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),_n!=4||se.length!=0||this.h.h||(this.s=1,qe(16),g=!1),this.o=this.o&&g,!g)vr(this.i,this.l,se,"[Invalid Chunked Response]"),cn(this),xr(this);else if(0<se.length&&!this.W){this.W=!0;var xn=this.j;xn.g==this&&xn.ba&&!xn.M&&(xn.j.info("Great, no buffering proxy detected. Bytes received: "+se.length),Yh(xn),xn.M=!0,qe(11))}}else vr(this.i,this.l,se,null),Ai(this,se);_n==4&&cn(this),this.o&&!this.J&&(_n==4?Xy(this.j,this):(this.o=!1,nt(this)))}else FS(this.g),g==400&&0<se.indexOf("Unknown SID")?(this.s=3,qe(12)):(this.s=0,qe(13)),cn(this),xr(this)}}}catch{}finally{}};function Ae(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Ft(u,f){var g=u.C,w=f.indexOf(`
`,g);return w==-1?je:(g=Number(f.substring(g,w)),isNaN(g)?xe:(w+=1,w+g>f.length?je:(f=f.slice(w,w+g),u.C=w+g,f)))}ye.prototype.cancel=function(){this.J=!0,cn(this)};function nt(u){u.S=Date.now()+u.I,wa(u,u.I)}function wa(u,f){if(u.B!=null)throw Error("WatchDog timer not null");u.B=_t(p(u.ba,u),f)}function vn(u){u.B&&(o.clearTimeout(u.B),u.B=null)}ye.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(_a(this.i,this.A),this.L!=2&&(Ce(),qe(17)),cn(this),this.s=2,xr(this)):wa(this,this.S-u)};function xr(u){u.j.G==0||u.J||Xy(u.j,u)}function cn(u){vn(u);var f=u.M;f&&typeof f.ma=="function"&&f.ma(),u.M=null,Ss(u.U),u.g&&(f=u.g,u.g=null,f.abort(),f.ma())}function Ai(u,f){try{var g=u.j;if(g.G!=0&&(g.g==u||ba(g.h,u))){if(!u.K&&ba(g.h,u)&&g.G==3){try{var w=g.Da.g.parse(f)}catch{w=null}if(Array.isArray(w)&&w.length==3){var L=w;if(L[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<u.F)ou(g),iu(g);else break e;Qh(g),qe(18)}}else g.za=L[1],0<g.za-g.T&&37500>L[2]&&g.F&&g.v==0&&!g.C&&(g.C=_t(p(g.Za,g),6e3));if(1>=Xo(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else ki(g,11)}else if((u.K||g.g==u)&&ou(g),!x(f))for(L=g.Da.g.parse(f),f=0;f<L.length;f++){let et=L[f];if(g.T=et[0],et=et[1],g.G==2)if(et[0]=="c"){g.K=et[1],g.ia=et[2];const xn=et[3];xn!=null&&(g.la=xn,g.j.info("VER="+g.la));const _n=et[4];_n!=null&&(g.Aa=_n,g.j.info("SVER="+g.Aa));const Ia=et[5];Ia!=null&&typeof Ia=="number"&&0<Ia&&(w=1.5*Ia,g.L=w,g.j.info("backChannelRequestTimeoutMs_="+w)),w=g;const _r=u.g;if(_r){const cu=_r.g?_r.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(cu){var B=w.h;B.g||cu.indexOf("spdy")==-1&&cu.indexOf("quic")==-1&&cu.indexOf("h2")==-1||(B.j=B.l,B.g=new Set,B.h&&(Xc(B,B.h),B.h=null))}if(w.D){const Jh=_r.g?_r.g.getResponseHeader("X-HTTP-Session-Id"):null;Jh&&(w.ya=Jh,pt(w.I,w.D,Jh))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-u.F,g.j.info("Handshake RTT: "+g.R+"ms")),w=g;var se=u;if(w.qa=tv(w,w.J?w.ia:null,w.W),se.K){Zo(w.h,se);var ct=se,un=w.L;un&&(ct.I=un),ct.B&&(vn(ct),nt(ct)),w.g=se}else Yy(w);0<g.i.length&&au(g)}else et[0]!="stop"&&et[0]!="close"||ki(g,7);else g.G==3&&(et[0]=="stop"||et[0]=="close"?et[0]=="stop"?ki(g,7):Kh(g):et[0]!="noop"&&g.l&&g.l.ta(et),g.v=0)}}Ce(4)}catch{}}var Ni=class{constructor(u,f){this.g=u,this.map=f}};function Jn(u){this.l=u||10,o.PerformanceNavigationTiming?(u=o.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Jo(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Xo(u){return u.h?1:u.g?u.g.size:0}function ba(u,f){return u.h?u.h==f:u.g?u.g.has(f):!1}function Xc(u,f){u.g?u.g.add(f):u.h=f}function Zo(u,f){u.h&&u.h==f?u.h=null:u.g&&u.g.has(f)&&u.g.delete(f)}Jn.prototype.cancel=function(){if(this.i=ky(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function ky(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let f=u.i;for(const g of u.g.values())f=f.concat(g.D);return f}return v(u.i)}function TS(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(c(u)){for(var f=[],g=u.length,w=0;w<g;w++)f.push(u[w]);return f}f=[],g=0;for(w in u)f[g++]=u[w];return f}function IS(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(c(u)||typeof u=="string"){var f=[];u=u.length;for(var g=0;g<u;g++)f.push(g);return f}f=[],g=0;for(const w in u)f[g++]=w;return f}}}function Ry(u,f){if(u.forEach&&typeof u.forEach=="function")u.forEach(f,void 0);else if(c(u)||typeof u=="string")Array.prototype.forEach.call(u,f,void 0);else for(var g=IS(u),w=TS(u),L=w.length,B=0;B<L;B++)f.call(void 0,w[B],g&&g[B],u)}var jy=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function SS(u,f){if(u){u=u.split("&");for(var g=0;g<u.length;g++){var w=u[g].indexOf("="),L=null;if(0<=w){var B=u[g].substring(0,w);L=u[g].substring(w+1)}else B=u[g];f(B,L?decodeURIComponent(L.replace(/\+/g," ")):"")}}}function Pi(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Pi){this.h=u.h,Zc(this,u.j),this.o=u.o,this.g=u.g,eu(this,u.s),this.l=u.l;var f=u.i,g=new nl;g.i=f.i,f.g&&(g.g=new Map(f.g),g.h=f.h),Dy(this,g),this.m=u.m}else u&&(f=String(u).match(jy))?(this.h=!1,Zc(this,f[1]||"",!0),this.o=el(f[2]||""),this.g=el(f[3]||"",!0),eu(this,f[4]),this.l=el(f[5]||"",!0),Dy(this,f[6]||"",!0),this.m=el(f[7]||"")):(this.h=!1,this.i=new nl(null,this.h))}Pi.prototype.toString=function(){var u=[],f=this.j;f&&u.push(tl(f,My,!0),":");var g=this.g;return(g||f=="file")&&(u.push("//"),(f=this.o)&&u.push(tl(f,My,!0),"@"),u.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&u.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&u.push("/"),u.push(tl(g,g.charAt(0)=="/"?NS:AS,!0))),(g=this.i.toString())&&u.push("?",g),(g=this.m)&&u.push("#",tl(g,kS)),u.join("")};function Gr(u){return new Pi(u)}function Zc(u,f,g){u.j=g?el(f,!0):f,u.j&&(u.j=u.j.replace(/:$/,""))}function eu(u,f){if(f){if(f=Number(f),isNaN(f)||0>f)throw Error("Bad port number "+f);u.s=f}else u.s=null}function Dy(u,f,g){f instanceof nl?(u.i=f,RS(u.i,u.h)):(g||(f=tl(f,PS)),u.i=new nl(f,u.h))}function pt(u,f,g){u.i.set(f,g)}function tu(u){return pt(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function el(u,f){return u?f?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function tl(u,f,g){return typeof u=="string"?(u=encodeURI(u).replace(f,CS),g&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function CS(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var My=/[#\/\?@]/g,AS=/[#\?:]/g,NS=/[#\?]/g,PS=/[#\?@]/g,kS=/#/g;function nl(u,f){this.h=this.g=null,this.i=u||null,this.j=!!f}function Cs(u){u.g||(u.g=new Map,u.h=0,u.i&&SS(u.i,function(f,g){u.add(decodeURIComponent(f.replace(/\+/g," ")),g)}))}n=nl.prototype,n.add=function(u,f){Cs(this),this.i=null,u=Ea(this,u);var g=this.g.get(u);return g||this.g.set(u,g=[]),g.push(f),this.h+=1,this};function Vy(u,f){Cs(u),f=Ea(u,f),u.g.has(f)&&(u.i=null,u.h-=u.g.get(f).length,u.g.delete(f))}function Ly(u,f){return Cs(u),f=Ea(u,f),u.g.has(f)}n.forEach=function(u,f){Cs(this),this.g.forEach(function(g,w){g.forEach(function(L){u.call(f,L,w,this)},this)},this)},n.na=function(){Cs(this);const u=Array.from(this.g.values()),f=Array.from(this.g.keys()),g=[];for(let w=0;w<f.length;w++){const L=u[w];for(let B=0;B<L.length;B++)g.push(f[w])}return g},n.V=function(u){Cs(this);let f=[];if(typeof u=="string")Ly(this,u)&&(f=f.concat(this.g.get(Ea(this,u))));else{u=Array.from(this.g.values());for(let g=0;g<u.length;g++)f=f.concat(u[g])}return f},n.set=function(u,f){return Cs(this),this.i=null,u=Ea(this,u),Ly(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[f]),this.h+=1,this},n.get=function(u,f){return u?(u=this.V(u),0<u.length?String(u[0]):f):f};function Oy(u,f,g){Vy(u,f),0<g.length&&(u.i=null,u.g.set(Ea(u,f),v(g)),u.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],f=Array.from(this.g.keys());for(var g=0;g<f.length;g++){var w=f[g];const B=encodeURIComponent(String(w)),se=this.V(w);for(w=0;w<se.length;w++){var L=B;se[w]!==""&&(L+="="+encodeURIComponent(String(se[w]))),u.push(L)}}return this.i=u.join("&")};function Ea(u,f){return f=String(f),u.j&&(f=f.toLowerCase()),f}function RS(u,f){f&&!u.j&&(Cs(u),u.i=null,u.g.forEach(function(g,w){var L=w.toLowerCase();w!=L&&(Vy(this,w),Oy(this,L,g))},u)),u.j=f}function jS(u,f){const g=new Ct;if(o.Image){const w=new Image;w.onload=y(As,g,"TestLoadImage: loaded",!0,f,w),w.onerror=y(As,g,"TestLoadImage: error",!1,f,w),w.onabort=y(As,g,"TestLoadImage: abort",!1,f,w),w.ontimeout=y(As,g,"TestLoadImage: timeout",!1,f,w),o.setTimeout(function(){w.ontimeout&&w.ontimeout()},1e4),w.src=u}else f(!1)}function DS(u,f){const g=new Ct,w=new AbortController,L=setTimeout(()=>{w.abort(),As(g,"TestPingServer: timeout",!1,f)},1e4);fetch(u,{signal:w.signal}).then(B=>{clearTimeout(L),B.ok?As(g,"TestPingServer: ok",!0,f):As(g,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(L),As(g,"TestPingServer: error",!1,f)})}function As(u,f,g,w,L){try{L&&(L.onload=null,L.onerror=null,L.onabort=null,L.ontimeout=null),w(g)}catch{}}function MS(){this.g=new pr}function VS(u,f,g){const w=g||"";try{Ry(u,function(L,B){let se=L;d(L)&&(se=Bn(L)),f.push(w+B+"="+encodeURIComponent(se))})}catch(L){throw f.push(w+"type="+encodeURIComponent("_badmap")),L}}function nu(u){this.l=u.Ub||null,this.j=u.eb||!1}E(nu,gr),nu.prototype.g=function(){return new ru(this.l,this.j)},nu.prototype.i=function(u){return function(){return u}}({});function ru(u,f){V.call(this),this.D=u,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}E(ru,V),n=ru.prototype,n.open=function(u,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=f,this.readyState=1,sl(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const f={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(f.body=u),(this.D||o).fetch(new Request(this.A,f)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,rl(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,sl(this)),this.g&&(this.readyState=3,sl(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Fy(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function Fy(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var f=u.value?u.value:new Uint8Array(0);(f=this.v.decode(f,{stream:!u.done}))&&(this.response=this.responseText+=f)}u.done?rl(this):sl(this),this.readyState==3&&Fy(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,rl(this))},n.Qa=function(u){this.g&&(this.response=u,rl(this))},n.ga=function(){this.g&&rl(this)};function rl(u){u.readyState=4,u.l=null,u.j=null,u.v=null,sl(u)}n.setRequestHeader=function(u,f){this.u.append(u,f)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],f=this.h.entries();for(var g=f.next();!g.done;)g=g.value,u.push(g[0]+": "+g[1]),g=f.next();return u.join(`\r
`)};function sl(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(ru.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function $y(u){let f="";return q(u,function(g,w){f+=w,f+=":",f+=g,f+=`\r
`}),f}function Gh(u,f,g){e:{for(w in g){var w=!1;break e}w=!0}w||(g=$y(g),typeof u=="string"?g!=null&&encodeURIComponent(String(g)):pt(u,f,g))}function Mt(u){V.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}E(Mt,V);var LS=/^https?$/i,OS=["POST","PUT"];n=Mt.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,f,g,w){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);f=f?f.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():le.g(),this.v=this.o?yn(this.o):yn(le),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(f,String(u),!0),this.B=!1}catch(B){Uy(this,B);return}if(u=g||"",g=new Map(this.headers),w)if(Object.getPrototypeOf(w)===Object.prototype)for(var L in w)g.set(L,w[L]);else if(typeof w.keys=="function"&&typeof w.get=="function")for(const B of w.keys())g.set(B,w.get(B));else throw Error("Unknown input type for opt_headers: "+String(w));w=Array.from(g.keys()).find(B=>B.toLowerCase()=="content-type"),L=o.FormData&&u instanceof o.FormData,!(0<=Array.prototype.indexOf.call(OS,f,void 0))||w||L||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[B,se]of g)this.g.setRequestHeader(B,se);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{qy(this),this.u=!0,this.g.send(u),this.u=!1}catch(B){Uy(this,B)}};function Uy(u,f){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=f,u.m=5,By(u),su(u)}function By(u){u.A||(u.A=!0,W(u,"complete"),W(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,W(this,"complete"),W(this,"abort"),su(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),su(this,!0)),Mt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?zy(this):this.bb())},n.bb=function(){zy(this)};function zy(u){if(u.h&&typeof a<"u"&&(!u.v[1]||Kr(u)!=4||u.Z()!=2)){if(u.u&&Kr(u)==4)Le(u.Ea,0,u);else if(W(u,"readystatechange"),Kr(u)==4){u.h=!1;try{const se=u.Z();e:switch(se){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break e;default:f=!1}var g;if(!(g=f)){var w;if(w=se===0){var L=String(u.D).match(jy)[1]||null;!L&&o.self&&o.self.location&&(L=o.self.location.protocol.slice(0,-1)),w=!LS.test(L?L.toLowerCase():"")}g=w}if(g)W(u,"complete"),W(u,"success");else{u.m=6;try{var B=2<Kr(u)?u.g.statusText:""}catch{B=""}u.l=B+" ["+u.Z()+"]",By(u)}}finally{su(u)}}}}function su(u,f){if(u.g){qy(u);const g=u.g,w=u.v[0]?()=>{}:null;u.g=null,u.v=null,f||W(u,"ready");try{g.onreadystatechange=w}catch{}}}function qy(u){u.I&&(o.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function Kr(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<Kr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var f=this.g.responseText;return u&&f.indexOf(u)==0&&(f=f.substring(u.length)),dt(f)}};function Wy(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function FS(u){const f={};u=(u.g&&2<=Kr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let w=0;w<u.length;w++){if(x(u[w]))continue;var g=D(u[w]);const L=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const B=f[L]||[];f[L]=B,B.push(g)}T(f,function(w){return w.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function il(u,f,g){return g&&g.internalChannelParams&&g.internalChannelParams[u]||f}function Hy(u){this.Aa=0,this.i=[],this.j=new Ct,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=il("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=il("baseRetryDelayMs",5e3,u),this.cb=il("retryDelaySeedMs",1e4,u),this.Wa=il("forwardChannelMaxRetries",2,u),this.wa=il("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Jn(u&&u.concurrentRequestLimit),this.Da=new MS,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Hy.prototype,n.la=8,n.G=1,n.connect=function(u,f,g,w){qe(0),this.W=u,this.H=f||{},g&&w!==void 0&&(this.H.OSID=g,this.H.OAID=w),this.F=this.X,this.I=tv(this,null,this.W),au(this)};function Kh(u){if(Gy(u),u.G==3){var f=u.U++,g=Gr(u.I);if(pt(g,"SID",u.K),pt(g,"RID",f),pt(g,"TYPE","terminate"),al(u,g),f=new ye(u,u.j,f),f.L=2,f.v=tu(Gr(g)),g=!1,o.navigator&&o.navigator.sendBeacon)try{g=o.navigator.sendBeacon(f.v.toString(),"")}catch{}!g&&o.Image&&(new Image().src=f.v,g=!0),g||(f.g=nv(f.j,null),f.g.ea(f.v)),f.F=Date.now(),nt(f)}ev(u)}function iu(u){u.g&&(Yh(u),u.g.cancel(),u.g=null)}function Gy(u){iu(u),u.u&&(o.clearTimeout(u.u),u.u=null),ou(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&o.clearTimeout(u.s),u.s=null)}function au(u){if(!Jo(u.h)&&!u.s){u.s=!0;var f=u.Ga;Pe||Se(),Y||(Pe(),Y=!0),ae.add(f,u),u.B=0}}function $S(u,f){return Xo(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=f.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=_t(p(u.Ga,u,f),Zy(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const L=new ye(this,this.j,u);let B=this.o;if(this.S&&(B?(B=b(B),P(B,this.S)):B=this.S),this.m!==null||this.O||(L.H=B,B=null),this.P)e:{for(var f=0,g=0;g<this.i.length;g++){t:{var w=this.i[g];if("__data__"in w.map&&(w=w.map.__data__,typeof w=="string")){w=w.length;break t}w=void 0}if(w===void 0)break;if(f+=w,4096<f){f=g;break e}if(f===4096||g===this.i.length-1){f=g+1;break e}}f=1e3}else f=1e3;f=Qy(this,L,f),g=Gr(this.I),pt(g,"RID",u),pt(g,"CVER",22),this.D&&pt(g,"X-HTTP-Session-Id",this.D),al(this,g),B&&(this.O?f="headers="+encodeURIComponent(String($y(B)))+"&"+f:this.m&&Gh(g,this.m,B)),Xc(this.h,L),this.Ua&&pt(g,"TYPE","init"),this.P?(pt(g,"$req",f),pt(g,"SID","null"),L.T=!0,ue(L,g,null)):ue(L,g,f),this.G=2}}else this.G==3&&(u?Ky(this,u):this.i.length==0||Jo(this.h)||Ky(this))};function Ky(u,f){var g;f?g=f.l:g=u.U++;const w=Gr(u.I);pt(w,"SID",u.K),pt(w,"RID",g),pt(w,"AID",u.T),al(u,w),u.m&&u.o&&Gh(w,u.m,u.o),g=new ye(u,u.j,g,u.B+1),u.m===null&&(g.H=u.o),f&&(u.i=f.D.concat(u.i)),f=Qy(u,g,1e3),g.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Xc(u.h,g),ue(g,w,f)}function al(u,f){u.H&&q(u.H,function(g,w){pt(f,w,g)}),u.l&&Ry({},function(g,w){pt(f,w,g)})}function Qy(u,f,g){g=Math.min(u.i.length,g);var w=u.l?p(u.l.Na,u.l,u):null;e:{var L=u.i;let B=-1;for(;;){const se=["count="+g];B==-1?0<g?(B=L[0].g,se.push("ofs="+B)):B=0:se.push("ofs="+B);let ct=!0;for(let un=0;un<g;un++){let et=L[un].g;const xn=L[un].map;if(et-=B,0>et)B=Math.max(0,L[un].g-100),ct=!1;else try{VS(xn,se,"req"+et+"_")}catch{w&&w(xn)}}if(ct){w=se.join("&");break e}}}return u=u.i.splice(0,g),f.D=u,w}function Yy(u){if(!u.g&&!u.u){u.Y=1;var f=u.Fa;Pe||Se(),Y||(Pe(),Y=!0),ae.add(f,u),u.v=0}}function Qh(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=_t(p(u.Fa,u),Zy(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,Jy(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=_t(p(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,qe(10),iu(this),Jy(this))};function Yh(u){u.A!=null&&(o.clearTimeout(u.A),u.A=null)}function Jy(u){u.g=new ye(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var f=Gr(u.qa);pt(f,"RID","rpc"),pt(f,"SID",u.K),pt(f,"AID",u.T),pt(f,"CI",u.F?"0":"1"),!u.F&&u.ja&&pt(f,"TO",u.ja),pt(f,"TYPE","xmlhttp"),al(u,f),u.m&&u.o&&Gh(f,u.m,u.o),u.L&&(u.g.I=u.L);var g=u.g;u=u.ia,g.L=1,g.v=tu(Gr(f)),g.m=null,g.P=!0,te(g,u)}n.Za=function(){this.C!=null&&(this.C=null,iu(this),Qh(this),qe(19))};function ou(u){u.C!=null&&(o.clearTimeout(u.C),u.C=null)}function Xy(u,f){var g=null;if(u.g==f){ou(u),Yh(u),u.g=null;var w=2}else if(ba(u.h,f))g=f.D,Zo(u.h,f),w=1;else return;if(u.G!=0){if(f.o)if(w==1){g=f.m?f.m.length:0,f=Date.now()-f.F;var L=u.B;w=ke(),W(w,new Mn(w,g)),au(u)}else Yy(u);else if(L=f.s,L==3||L==0&&0<f.X||!(w==1&&$S(u,f)||w==2&&Qh(u)))switch(g&&0<g.length&&(f=u.h,f.i=f.i.concat(g)),L){case 1:ki(u,5);break;case 4:ki(u,10);break;case 3:ki(u,6);break;default:ki(u,2)}}}function Zy(u,f){let g=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(g*=2),g*f}function ki(u,f){if(u.j.info("Error code "+f),f==2){var g=p(u.fb,u),w=u.Xa;const L=!w;w=new Pi(w||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Zc(w,"https"),tu(w),L?jS(w.toString(),g):DS(w.toString(),g)}else qe(2);u.G=0,u.l&&u.l.sa(f),ev(u),Gy(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),qe(2)):(this.j.info("Failed to ping google.com"),qe(1))};function ev(u){if(u.G=0,u.ka=[],u.l){const f=ky(u.h);(f.length!=0||u.i.length!=0)&&(I(u.ka,f),I(u.ka,u.i),u.h.i.length=0,v(u.i),u.i.length=0),u.l.ra()}}function tv(u,f,g){var w=g instanceof Pi?Gr(g):new Pi(g);if(w.g!="")f&&(w.g=f+"."+w.g),eu(w,w.s);else{var L=o.location;w=L.protocol,f=f?f+"."+L.hostname:L.hostname,L=+L.port;var B=new Pi(null);w&&Zc(B,w),f&&(B.g=f),L&&eu(B,L),g&&(B.l=g),w=B}return g=u.D,f=u.ya,g&&f&&pt(w,g,f),pt(w,"VER",u.la),al(u,w),w}function nv(u,f,g){if(f&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return f=u.Ca&&!u.pa?new Mt(new nu({eb:g})):new Mt(u.pa),f.Ha(u.J),f}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function rv(){}n=rv.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function lu(){}lu.prototype.g=function(u,f){return new Xn(u,f)};function Xn(u,f){V.call(this),this.g=new Hy(f),this.l=u,this.h=f&&f.messageUrlParams||null,u=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(u?u["X-WebChannel-Content-Type"]=f.messageContentType:u={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.va&&(u?u["X-WebChannel-Client-Profile"]=f.va:u={"X-WebChannel-Client-Profile":f.va}),this.g.S=u,(u=f&&f.Sb)&&!x(u)&&(this.g.m=u),this.v=f&&f.supportsCrossDomainXhr||!1,this.u=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!x(f)&&(this.g.D=f,u=this.h,u!==null&&f in u&&(u=this.h,f in u&&delete u[f])),this.j=new Ta(this)}E(Xn,V),Xn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Xn.prototype.close=function(){Kh(this.g)},Xn.prototype.o=function(u){var f=this.g;if(typeof u=="string"){var g={};g.__data__=u,u=g}else this.u&&(g={},g.__data__=Bn(u),u=g);f.i.push(new Ni(f.Ya++,u)),f.G==3&&au(f)},Xn.prototype.N=function(){this.g.l=null,delete this.j,Kh(this.g),delete this.g,Xn.aa.N.call(this)};function sv(u){Hr.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var f=u.__sm__;if(f){e:{for(const g in f){u=g;break e}u=void 0}(this.i=u)&&(u=this.i,f=f!==null&&u in f?f[u]:void 0),this.data=f}else this.data=u}E(sv,Hr);function iv(){j.call(this),this.status=1}E(iv,j);function Ta(u){this.g=u}E(Ta,rv),Ta.prototype.ua=function(){W(this.g,"a")},Ta.prototype.ta=function(u){W(this.g,new sv(u))},Ta.prototype.sa=function(u){W(this.g,new iv)},Ta.prototype.ra=function(){W(this.g,"b")},lu.prototype.createWebChannel=lu.prototype.g,Xn.prototype.send=Xn.prototype.o,Xn.prototype.open=Xn.prototype.m,Xn.prototype.close=Xn.prototype.close,LE=function(){return new lu},VE=function(){return ke()},ME=J,Wf={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},U.NO_ERROR=0,U.TIMEOUT=8,U.HTTP_ERROR=6,Xu=U,ve.COMPLETE="complete",DE=ve,Nr.EventType=yr,yr.OPEN="a",yr.CLOSE="b",yr.ERROR="c",yr.MESSAGE="d",V.prototype.listen=V.prototype.K,Sl=Nr,Mt.prototype.listenOnce=Mt.prototype.L,Mt.prototype.getLastError=Mt.prototype.Ka,Mt.prototype.getLastErrorCode=Mt.prototype.Ba,Mt.prototype.getStatus=Mt.prototype.Z,Mt.prototype.getResponseJson=Mt.prototype.Oa,Mt.prototype.getResponseText=Mt.prototype.oa,Mt.prototype.send=Mt.prototype.ea,Mt.prototype.setWithCredentials=Mt.prototype.Ha,jE=Mt}).apply(typeof Au<"u"?Au:typeof self<"u"?self:typeof window<"u"?window:{});const Z0="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}rn.UNAUTHENTICATED=new rn(null),rn.GOOGLE_CREDENTIALS=new rn("google-credentials-uid"),rn.FIRST_PARTY=new rn("first-party-uid"),rn.MOCK_USER=new rn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fo="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ci=new mg("@firebase/firestore");function Ra(){return ci.logLevel}function HV(n){ci.setLogLevel(n)}function K(n,...e){if(ci.logLevel<=Ge.DEBUG){const t=e.map(Tg);ci.debug(`Firestore (${Fo}): ${n}`,...t)}}function Ut(n,...e){if(ci.logLevel<=Ge.ERROR){const t=e.map(Tg);ci.error(`Firestore (${Fo}): ${n}`,...t)}}function mr(n,...e){if(ci.logLevel<=Ge.WARN){const t=e.map(Tg);ci.warn(`Firestore (${Fo}): ${n}`,...t)}}function Tg(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function de(n="Unexpected state"){const e=`FIRESTORE (${Fo}) INTERNAL ASSERTION FAILED: `+n;throw Ut(e),new Error(e)}function fe(n,e){n||de()}function GV(n,e){n||de()}function re(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Q extends vs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OE{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class dj{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(rn.UNAUTHENTICATED))}shutdown(){}}class hj{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class mj{constructor(e){this.t=e,this.currentUser=rn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){fe(this.o===void 0);let r=this.i;const s=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let i=new an;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new an,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},o=c=>{K("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>o(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?o(c):(K("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new an)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(K("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(fe(typeof r.accessToken=="string"),new OE(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return fe(e===null||typeof e=="string"),new rn(e)}}class fj{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=rn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class pj{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new fj(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(rn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class FE{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class gj{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){fe(this.o===void 0);const r=i=>{i.error!=null&&K("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.R;return this.R=i.token,K("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{K("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):K("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(fe(typeof t.token=="string"),this.R=t.token,new FE(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class KV{getToken(){return Promise.resolve(new FE(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yj(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $E{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=yj(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Re(n,e){return n<e?-1:n>e?1:0}function po(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function UE(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Q($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Q($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Q($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Q($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Pt.fromMillis(Date.now())}static fromDate(e){return Pt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Pt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Re(this.nanoseconds,e.nanoseconds):Re(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Te{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Te(e)}static min(){return new Te(new Pt(0,0))}static max(){return new Te(new Pt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fc{constructor(e,t,r){t===void 0?t=0:t>e.length&&de(),r===void 0?r=e.length-t:r>e.length-t&&de(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return fc.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof fc?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),a=t.get(s);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ke extends fc{construct(e,t,r){return new Ke(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Q($.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Ke(t)}static emptyPath(){return new Ke([])}}const vj=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Et extends fc{construct(e,t,r){return new Et(e,t,r)}static isValidIdentifier(e){return vj.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Et.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Et(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Q($.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const o=e[s];if(o==="\\"){if(s+1===e.length)throw new Q($.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new Q($.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else o==="`"?(a=!a,s++):o!=="."||a?(r+=o,s++):(i(),s++)}if(i(),a)throw new Q($.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Et(t)}static emptyPath(){return new Et([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ie{constructor(e){this.path=e}static fromPath(e){return new ie(Ke.fromString(e))}static fromName(e){return new ie(Ke.fromString(e).popFirst(5))}static empty(){return new ie(Ke.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ke.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ke.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ie(new Ke(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class go{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Hf(n){return n.fields.find(e=>e.kind===2)}function Vi(n){return n.fields.filter(e=>e.kind!==2)}function xj(n,e){let t=Re(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=_j(n.fields[r],e.fields[r]),t!==0)return t;return Re(n.fields.length,e.fields.length)}go.UNKNOWN_ID=-1;class Ki{constructor(e,t){this.fieldPath=e,this.kind=t}}function _j(n,e){const t=Et.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Re(n.kind,e.kind)}class yo{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new yo(0,sr.min())}}function BE(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Te.fromTimestamp(r===1e9?new Pt(t+1,0):new Pt(t,r));return new sr(s,ie.empty(),e)}function zE(n){return new sr(n.readTime,n.key,-1)}class sr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new sr(Te.min(),ie.empty(),-1)}static max(){return new sr(Te.max(),ie.empty(),-1)}}function Ig(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ie.comparator(n.documentKey,e.documentKey),t!==0?t:Re(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class WE{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wi(n){if(n.code!==$.FAILED_PRECONDITION||n.message!==qE)throw n;K("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&de(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new O((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof O?t:O.resolve(t)}catch(t){return O.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):O.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):O.reject(t)}static resolve(e){return new O((t,r)=>{t(e)})}static reject(e){return new O((t,r)=>{r(e)})}static waitFor(e){return new O((t,r)=>{let s=0,i=0,a=!1;e.forEach(o=>{++s,o.next(()=>{++i,a&&i===s&&t()},c=>r(c))}),a=!0,i===s&&t()})}static or(e){let t=O.resolve(!1);for(const r of e)t=t.next(s=>s?O.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new O((r,s)=>{const i=e.length,a=new Array(i);let o=0;for(let c=0;c<i;c++){const d=c;t(e[d]).next(h=>{a[d]=h,++o,o===i&&r(a)},h=>s(h))}})}static doWhile(e,t){return new O((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new an,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new $l(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Sg(r.target.error);this.V.reject(new $l(e,s))}}static open(e,t,r,s){try{return new Eh(t,e.transaction(s,r))}catch(i){throw new $l(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(K("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new bj(t)}}class Ur{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Ur.S(Yt())===12.2&&Ut("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return K("SimpleDb","Removing database:",e),Li(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!zb())return!1;if(Ur.v())return!0;const e=Yt(),t=Ur.S(e),r=0<t&&t<10,s=HE(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(K("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;t(a)},s.onblocked=()=>{r(new $l(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?r(new Q($.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new Q($.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new $l(e,a))},s.onupgradeneeded=i=>{K("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;this.p.O(a,s.transaction,i.oldVersion,this.version).next(()=>{K("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let a=0;for(;;){++a;try{this.db=await this.M(e);const o=Eh.open(this.db,e,i?"readonly":"readwrite",r),c=s(o).next(d=>(o.g(),d)).catch(d=>(o.abort(d),O.reject(d))).toPromise();return c.catch(()=>{}),await o.m,c}catch(o){const c=o,d=c.name!=="FirebaseError"&&a<3;if(K("SimpleDb","Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function HE(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class wj{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Li(this.B.delete())}}class $l extends Q{constructor(e,t){super($.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function bi(n){return n.name==="IndexedDbTransactionError"}class bj{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(K("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(K("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Li(r)}add(e){return K("SimpleDb","ADD",this.store.name,e,e),Li(this.store.add(e))}get(e){return Li(this.store.get(e)).next(t=>(t===void 0&&(t=null),K("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return K("SimpleDb","DELETE",this.store.name,e),Li(this.store.delete(e))}count(){return K("SimpleDb","COUNT",this.store.name),Li(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new O((a,o)=>{i.onerror=c=>{o(c.target.error)},i.onsuccess=c=>{a(c.target.result)}})}{const i=this.cursor(r),a=[];return this.W(i,(o,c)=>{a.push(c)}).next(()=>a)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new O((s,i)=>{r.onerror=a=>{i(a.target.error)},r.onsuccess=a=>{s(a.target.result)}})}j(e,t){K("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,a,o)=>o.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new O((r,s)=>{t.onerror=i=>{const a=Sg(i.target.error);s(a)},t.onsuccess=i=>{const a=i.target.result;a?e(a.primaryKey,a.value).next(o=>{o?a.continue():r()}):r()}})}W(e,t){const r=[];return new O((s,i)=>{e.onerror=a=>{i(a.target.error)},e.onsuccess=a=>{const o=a.target.result;if(!o)return void s();const c=new wj(o),d=t(o.primaryKey,o.value,c);if(d instanceof O){const h=d.catch(m=>(c.done(),O.reject(m)));r.push(h)}c.isDone?s():c.K===null?o.continue():o.continue(c.K)}}).next(()=>O.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Li(n){return new O((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Sg(r.target.error);t(s)}})}let ex=!1;function Sg(n){const e=Ur.S(Yt());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new Q("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ex||(ex=!0,setTimeout(()=>{throw r},0)),r}}return n}class Ej{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){K("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{K("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){bi(t)?K("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await wi(t)}await this.X(6e4)})}}class Tj{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return O.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!r.has(a))return K("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,s).next(o=>{s-=o,r.add(a)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(s,i)).next(o=>(K("IndexBackfiller",`Updating offset: ${o}`),this.localStore.indexManager.updateCollectionGroup(e,t,o))).next(()=>a.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const a=zE(i);Ig(a,r)>0&&(r=a)}),new sr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Wn.oe=-1;function Lc(n){return n==null}function pc(n){return n===0&&1/n==-1/0}function GE(n){return typeof n=="number"&&Number.isInteger(n)&&!pc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=tx(e)),e=Ij(n.get(t),e);return tx(e)}function Ij(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function tx(n){return n+""}function Mr(n){const e=n.length;if(fe(e>=2),e===2)return fe(n.charAt(0)===""&&n.charAt(1)===""),Ke.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const a=n.indexOf("",i);switch((a<0||a>t)&&de(),n.charAt(a+1)){case"":const o=n.substring(i,a);let c;s.length===0?c=o:(s+=o,c=s,s=""),r.push(c);break;case"":s+=n.substring(i,a),s+="\0";break;case"":s+=n.substring(i,a+1);break;default:de()}i=a+2}return new Ke(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nx=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zu(n,e){return[n,Cn(e)]}function KE(n,e,t){return[n,Cn(e),t]}const Sj={},Cj=["prefixPath","collectionGroup","readTime","documentId"],Aj=["prefixPath","collectionGroup","documentId"],Nj=["collectionGroup","readTime","prefixPath","documentId"],Pj=["canonicalId","targetId"],kj=["targetId","path"],Rj=["path","targetId"],jj=["collectionId","parent"],Dj=["indexId","uid"],Mj=["uid","sequenceNumber"],Vj=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Lj=["indexId","uid","orderedDocumentKey"],Oj=["userId","collectionPath","documentId"],Fj=["userId","collectionPath","largestBatchId"],$j=["userId","collectionGroup","largestBatchId"],QE=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Uj=[...QE,"documentOverlays"],YE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],JE=YE,Cg=[...JE,"indexConfiguration","indexState","indexEntries"],Bj=Cg,zj=[...Cg,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf extends WE{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Jt(n,e){const t=re(n);return Ur.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rx(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ei(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function XE(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function ZE(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e,t){this.comparator=e,this.root=t||hn.EMPTY}insert(e,t){return new mt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,hn.BLACK,null,null))}remove(e){return new mt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,hn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Nu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Nu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Nu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Nu(this.root,e,this.comparator,!0)}}class Nu{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class hn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??hn.RED,this.left=s??hn.EMPTY,this.right=i??hn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new hn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return hn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return hn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,hn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,hn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw de();const e=this.left.check();if(e!==this.right.check())throw de();return e+(this.isRed()?0:1)}}hn.EMPTY=null,hn.RED=!0,hn.BLACK=!1;hn.EMPTY=new class{constructor(){this.size=0}get key(){throw de()}get value(){throw de()}get color(){throw de()}get left(){throw de()}get right(){throw de()}copy(e,t,r,s,i){return this}insert(e,t,r){return new hn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ot{constructor(e){this.comparator=e,this.data=new mt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new sx(this.data.getIterator())}getIteratorFrom(e){return new sx(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ot)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ot(this.comparator);return t.data=e,t}}class sx{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ca(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hn{constructor(e){this.fields=e,e.sort(Et.comparator)}static empty(){return new Hn([])}unionWith(e){let t=new ot(Et.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Hn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return po(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eT extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YV(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new eT("Invalid base64 string: "+i):i}}(e);return new Lt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new Lt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Re(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Lt.EMPTY_BYTE_STRING=new Lt("");const qj=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fs(n){if(fe(!!n),typeof n=="string"){let e=0;const t=qj.exec(n);if(fe(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:wt(n.seconds),nanos:wt(n.nanos)}}function wt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ps(n){return typeof n=="string"?Lt.fromBase64String(n):Lt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Th(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Ih(n){const e=n.mapValue.fields.__previous_value__;return Th(e)?Ih(e):e}function gc(n){const e=fs(n.mapValue.fields.__local_write_time__.timestampValue);return new Pt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wj{constructor(e,t,r,s,i,a,o,c,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=c,this.useFetchStreams=d}}class ra{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ra("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ra&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gs={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ed={nullValue:"NULL_VALUE"};function ui(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Th(n)?4:tT(n)?9007199254740991:Sh(n)?10:11:de()}function qr(n,e){if(n===e)return!0;const t=ui(n);if(t!==ui(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return gc(n).isEqual(gc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=fs(s.timestampValue),o=fs(i.timestampValue);return a.seconds===o.seconds&&a.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return ps(s.bytesValue).isEqual(ps(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return wt(s.geoPointValue.latitude)===wt(i.geoPointValue.latitude)&&wt(s.geoPointValue.longitude)===wt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return wt(s.integerValue)===wt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=wt(s.doubleValue),o=wt(i.doubleValue);return a===o?pc(a)===pc(o):isNaN(a)&&isNaN(o)}return!1}(n,e);case 9:return po(n.arrayValue.values||[],e.arrayValue.values||[],qr);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},o=i.mapValue.fields||{};if(rx(a)!==rx(o))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(o[c]===void 0||!qr(a[c],o[c])))return!1;return!0}(n,e);default:return de()}}function yc(n,e){return(n.values||[]).find(t=>qr(t,e))!==void 0}function di(n,e){if(n===e)return 0;const t=ui(n),r=ui(e);if(t!==r)return Re(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Re(n.booleanValue,e.booleanValue);case 2:return function(i,a){const o=wt(i.integerValue||i.doubleValue),c=wt(a.integerValue||a.doubleValue);return o<c?-1:o>c?1:o===c?0:isNaN(o)?isNaN(c)?0:-1:1}(n,e);case 3:return ix(n.timestampValue,e.timestampValue);case 4:return ix(gc(n),gc(e));case 5:return Re(n.stringValue,e.stringValue);case 6:return function(i,a){const o=ps(i),c=ps(a);return o.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(i,a){const o=i.split("/"),c=a.split("/");for(let d=0;d<o.length&&d<c.length;d++){const h=Re(o[d],c[d]);if(h!==0)return h}return Re(o.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,a){const o=Re(wt(i.latitude),wt(a.latitude));return o!==0?o:Re(wt(i.longitude),wt(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return ax(n.arrayValue,e.arrayValue);case 10:return function(i,a){var o,c,d,h;const m=i.fields||{},p=a.fields||{},y=(o=m.value)===null||o===void 0?void 0:o.arrayValue,E=(c=p.value)===null||c===void 0?void 0:c.arrayValue,v=Re(((d=y==null?void 0:y.values)===null||d===void 0?void 0:d.length)||0,((h=E==null?void 0:E.values)===null||h===void 0?void 0:h.length)||0);return v!==0?v:ax(y,E)}(n.mapValue,e.mapValue);case 11:return function(i,a){if(i===Gs.mapValue&&a===Gs.mapValue)return 0;if(i===Gs.mapValue)return 1;if(a===Gs.mapValue)return-1;const o=i.fields||{},c=Object.keys(o),d=a.fields||{},h=Object.keys(d);c.sort(),h.sort();for(let m=0;m<c.length&&m<h.length;++m){const p=Re(c[m],h[m]);if(p!==0)return p;const y=di(o[c[m]],d[h[m]]);if(y!==0)return y}return Re(c.length,h.length)}(n.mapValue,e.mapValue);default:throw de()}}function ix(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Re(n,e);const t=fs(n),r=fs(e),s=Re(t.seconds,r.seconds);return s!==0?s:Re(t.nanos,r.nanos)}function ax(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=di(t[s],r[s]);if(i)return i}return Re(t.length,r.length)}function vo(n){return Kf(n)}function Kf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=fs(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ps(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return ie.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Kf(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${Kf(t.fields[a])}`;return s+"}"}(n.mapValue):de()}function td(n){switch(ui(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ih(n);return e?16+td(e):16;case 5:return 2*n.stringValue.length;case 6:return ps(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+td(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Ei(r.fields,(i,a)=>{s+=i.length+td(a)}),s}(n.mapValue);default:throw de()}}function sa(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Qf(n){return!!n&&"integerValue"in n}function vc(n){return!!n&&"arrayValue"in n}function ox(n){return!!n&&"nullValue"in n}function lx(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function nd(n){return!!n&&"mapValue"in n}function Sh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Ul(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Ei(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ul(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ul(n.arrayValue.values[t]);return e}return Object.assign({},n)}function tT(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const nT={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Hj(n){return"nullValue"in n?ed:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?sa(ra.empty(),ie.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Sh(n)?nT:{mapValue:{}}:de()}function Gj(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?sa(ra.empty(),ie.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?nT:"mapValue"in n?Sh(n)?{mapValue:{}}:Gs:de()}function cx(n,e){const t=di(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function ux(n,e){const t=di(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(e){this.value=e}static empty(){return new mn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!nd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ul(t)}setAll(e){let t=Et.emptyPath(),r={},s=[];e.forEach((a,o)=>{if(!t.isImmediateParentOf(o)){const c=this.getFieldsMap(t);this.applyChanges(c,r,s),r={},s=[],t=o.popLast()}a?r[o.lastSegment()]=Ul(a):s.push(o.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());nd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];nd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Ei(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new mn(Ul(this.value))}}function rT(n){const e=[];return Ei(n.fields,(t,r)=>{const s=new Et([t]);if(nd(r)){const i=rT(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new Hn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(e,t,r,s,i,a,o){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=o}static newInvalidDocument(e){return new yt(e,0,Te.min(),Te.min(),Te.min(),mn.empty(),0)}static newFoundDocument(e,t,r,s){return new yt(e,1,t,Te.min(),r,s,0)}static newNoDocument(e,t){return new yt(e,2,t,Te.min(),Te.min(),mn.empty(),0)}static newUnknownDocument(e,t){return new yt(e,3,t,Te.min(),Te.min(),mn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Te.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=mn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=mn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Te.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof yt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new yt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi{constructor(e,t){this.position=e,this.inclusive=t}}function dx(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=ie.comparator(ie.fromName(a.referenceValue),t.key):r=di(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function hx(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!qr(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{constructor(e,t="asc"){this.field=e,this.dir=t}}function Kj(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sT{}class Qe extends sT{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Qj(e,t,r):t==="array-contains"?new Xj(e,r):t==="in"?new uT(e,r):t==="not-in"?new Zj(e,r):t==="array-contains-any"?new eD(e,r):new Qe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Yj(e,r):new Jj(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(di(t,this.value)):t!==null&&ui(this.value)===ui(t)&&this.matchesComparison(di(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return de()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rt extends sT{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new rt(e,t)}matches(e){return xo(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function xo(n){return n.op==="and"}function Yf(n){return n.op==="or"}function Ag(n){return iT(n)&&xo(n)}function iT(n){for(const e of n.filters)if(e instanceof rt)return!1;return!0}function Jf(n){if(n instanceof Qe)return n.field.canonicalString()+n.op.toString()+vo(n.value);if(Ag(n))return n.filters.map(e=>Jf(e)).join(",");{const e=n.filters.map(t=>Jf(t)).join(",");return`${n.op}(${e})`}}function aT(n,e){return n instanceof Qe?function(r,s){return s instanceof Qe&&r.op===s.op&&r.field.isEqual(s.field)&&qr(r.value,s.value)}(n,e):n instanceof rt?function(r,s){return s instanceof rt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,o)=>i&&aT(a,s.filters[o]),!0):!1}(n,e):void de()}function oT(n,e){const t=n.filters.concat(e);return rt.create(t,n.op)}function lT(n){return n instanceof Qe?function(t){return`${t.field.canonicalString()} ${t.op} ${vo(t.value)}`}(n):n instanceof rt?function(t){return t.op.toString()+" {"+t.getFilters().map(lT).join(" ,")+"}"}(n):"Filter"}class Qj extends Qe{constructor(e,t,r){super(e,t,r),this.key=ie.fromName(r.referenceValue)}matches(e){const t=ie.comparator(e.key,this.key);return this.matchesComparison(t)}}class Yj extends Qe{constructor(e,t){super(e,"in",t),this.keys=cT("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Jj extends Qe{constructor(e,t){super(e,"not-in",t),this.keys=cT("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function cT(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>ie.fromName(r.referenceValue))}class Xj extends Qe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return vc(t)&&yc(t.arrayValue,this.value)}}class uT extends Qe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&yc(this.value.arrayValue,t)}}class Zj extends Qe{constructor(e,t){super(e,"not-in",t)}matches(e){if(yc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!yc(this.value.arrayValue,t)}}class eD extends Qe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!vc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>yc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tD{constructor(e,t=null,r=[],s=[],i=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=o,this.ue=null}}function Xf(n,e=null,t=[],r=[],s=null,i=null,a=null){return new tD(n,e,t,r,s,i,a)}function ia(n){const e=re(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Jf(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Lc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>vo(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>vo(r)).join(",")),e.ue=t}return e.ue}function Oc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Kj(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!aT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!hx(n.startAt,e.startAt)&&hx(n.endAt,e.endAt)}function Bd(n){return ie.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function zd(n,e){return n.filters.filter(t=>t instanceof Qe&&t.field.isEqual(e))}function mx(n,e,t){let r=ed,s=!0;for(const i of zd(n,e)){let a=ed,o=!0;switch(i.op){case"<":case"<=":a=Hj(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,o=!1;break;case"!=":case"not-in":a=ed}cx({value:r,inclusive:s},{value:a,inclusive:o})<0&&(r=a,s=o)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const a=t.position[i];cx({value:r,inclusive:s},{value:a,inclusive:t.inclusive})<0&&(r=a,s=t.inclusive);break}}return{value:r,inclusive:s}}function fx(n,e,t){let r=Gs,s=!0;for(const i of zd(n,e)){let a=Gs,o=!0;switch(i.op){case">=":case">":a=Gj(i.value),o=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,o=!1;break;case"!=":case"not-in":a=Gs}ux({value:r,inclusive:s},{value:a,inclusive:o})>0&&(r=a,s=o)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const a=t.position[i];ux({value:r,inclusive:s},{value:a,inclusive:t.inclusive})>0&&(r=a,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e,t=null,r=[],s=[],i=null,a="F",o=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=o,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function dT(n,e,t,r,s,i,a,o){return new ws(n,e,t,r,s,i,a,o)}function $o(n){return new ws(n)}function px(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Ng(n){return n.collectionGroup!==null}function so(n){const e=re(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let o=new ot(Et.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(o=o.add(d.field))})}),o})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new xc(i,r))}),t.has(Et.keyField().canonicalString())||e.ce.push(new xc(Et.keyField(),r))}return e.ce}function An(n){const e=re(n);return e.le||(e.le=mT(e,so(n))),e.le}function hT(n){const e=re(n);return e.he||(e.he=mT(e,n.explicitOrderBy)),e.he}function mT(n,e){if(n.limitType==="F")return Xf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new xc(s.field,i)});const t=n.endAt?new hi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new hi(n.startAt.position,n.startAt.inclusive):null;return Xf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Zf(n,e){const t=n.filters.concat([e]);return new ws(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function qd(n,e,t){return new ws(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Fc(n,e){return Oc(An(n),An(e))&&n.limitType===e.limitType}function fT(n){return`${ia(An(n))}|lt:${n.limitType}`}function ja(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>lT(s)).join(", ")}]`),Lc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>vo(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>vo(s)).join(",")),`Target(${r})`}(An(n))}; limitType=${n.limitType})`}function $c(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ie.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of so(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(a,o,c){const d=dx(a,o,c);return a.inclusive?d<=0:d<0}(r.startAt,so(r),s)||r.endAt&&!function(a,o,c){const d=dx(a,o,c);return a.inclusive?d>=0:d>0}(r.endAt,so(r),s))}(n,e)}function pT(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function gT(n){return(e,t)=>{let r=!1;for(const s of so(n)){const i=nD(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function nD(n,e,t){const r=n.field.isKeyField()?ie.comparator(e.key,t.key):function(i,a,o){const c=a.data.field(i),d=o.data.field(i);return c!==null&&d!==null?di(c,d):de()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return de()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ei(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return ZE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rD=new mt(ie.comparator);function Gn(){return rD}const yT=new mt(ie.comparator);function Cl(...n){let e=yT;for(const t of n)e=e.insert(t.key,t);return e}function vT(n){let e=yT;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Vr(){return Bl()}function xT(){return Bl()}function Bl(){return new bs(n=>n.toString(),(n,e)=>n.isEqual(e))}const sD=new mt(ie.comparator),iD=new ot(ie.comparator);function Oe(...n){let e=iD;for(const t of n)e=e.add(t);return e}const aD=new ot(Re);function Pg(){return aD}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kg(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pc(e)?"-0":e}}function _T(n){return{integerValue:""+n}}function wT(n,e){return GE(e)?_T(e):kg(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ch{constructor(){this._=void 0}}function oD(n,e,t){return n instanceof _o?function(s,i){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Th(i)&&(i=Ih(i)),i&&(a.fields.__previous_value__=i),{mapValue:a}}(t,e):n instanceof aa?ET(n,e):n instanceof oa?TT(n,e):function(s,i){const a=bT(s,i),o=gx(a)+gx(s.Pe);return Qf(a)&&Qf(s.Pe)?_T(o):kg(s.serializer,o)}(n,e)}function lD(n,e,t){return n instanceof aa?ET(n,e):n instanceof oa?TT(n,e):t}function bT(n,e){return n instanceof wo?function(r){return Qf(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class _o extends Ch{}class aa extends Ch{constructor(e){super(),this.elements=e}}function ET(n,e){const t=IT(e);for(const r of n.elements)t.some(s=>qr(s,r))||t.push(r);return{arrayValue:{values:t}}}class oa extends Ch{constructor(e){super(),this.elements=e}}function TT(n,e){let t=IT(e);for(const r of n.elements)t=t.filter(s=>!qr(s,r));return{arrayValue:{values:t}}}class wo extends Ch{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function gx(n){return wt(n.integerValue||n.doubleValue)}function IT(n){return vc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{constructor(e,t){this.field=e,this.transform=t}}function cD(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof aa&&s instanceof aa||r instanceof oa&&s instanceof oa?po(r.elements,s.elements,qr):r instanceof wo&&s instanceof wo?qr(r.Pe,s.Pe):r instanceof _o&&s instanceof _o}(n.transform,e.transform)}class uD{constructor(e,t){this.version=e,this.transformResults=t}}class Tt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Tt}static exists(e){return new Tt(void 0,e)}static updateTime(e){return new Tt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ah{}function ST(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Bo(n.key,Tt.none()):new Uo(n.key,n.data,Tt.none());{const t=n.data,r=mn.empty();let s=new ot(Et.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Es(n.key,r,new Hn(s.toArray()),Tt.none())}}function dD(n,e,t){n instanceof Uo?function(s,i,a){const o=s.value.clone(),c=vx(s.fieldTransforms,i,a.transformResults);o.setAll(c),i.convertToFoundDocument(a.version,o).setHasCommittedMutations()}(n,e,t):n instanceof Es?function(s,i,a){if(!rd(s.precondition,i))return void i.convertToUnknownDocument(a.version);const o=vx(s.fieldTransforms,i,a.transformResults),c=i.data;c.setAll(CT(s)),c.setAll(o),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(n,e,t):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function zl(n,e,t,r){return n instanceof Uo?function(i,a,o,c){if(!rd(i.precondition,a))return o;const d=i.value.clone(),h=xx(i.fieldTransforms,c,a);return d.setAll(h),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof Es?function(i,a,o,c){if(!rd(i.precondition,a))return o;const d=xx(i.fieldTransforms,c,a),h=a.data;return h.setAll(CT(i)),h.setAll(d),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),o===null?null:o.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(m=>m.field))}(n,e,t,r):function(i,a,o){return rd(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):o}(n,e,t)}function hD(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=bT(r.transform,s||null);i!=null&&(t===null&&(t=mn.empty()),t.set(r.field,i))}return t||null}function yx(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&po(r,s,(i,a)=>cD(i,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Uo extends Ah{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Es extends Ah{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function CT(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function vx(n,e,t){const r=new Map;fe(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,o=e.data.field(i.field);r.set(i.field,lD(a,o,t[s]))}return r}function xx(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,oD(i,a,e))}return r}class Bo extends Ah{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Rg extends Ah{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&dD(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=zl(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=zl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=xT();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let o=this.applyToLocalView(a,i.mutatedFields);o=t.has(s.key)?null:o;const c=ST(a,o);c!==null&&r.set(s.key,c),a.isValidDocument()||a.convertToNoDocument(Te.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Oe())}isEqual(e){return this.batchId===e.batchId&&po(this.mutations,e.mutations,(t,r)=>yx(t,r))&&po(this.baseMutations,e.baseMutations,(t,r)=>yx(t,r))}}class Dg{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){fe(e.mutations.length===r.length);let s=function(){return sD}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new Dg(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AT{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mD{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wt,Je;function NT(n){switch(n){default:return de();case $.CANCELLED:case $.UNKNOWN:case $.DEADLINE_EXCEEDED:case $.RESOURCE_EXHAUSTED:case $.INTERNAL:case $.UNAVAILABLE:case $.UNAUTHENTICATED:return!1;case $.INVALID_ARGUMENT:case $.NOT_FOUND:case $.ALREADY_EXISTS:case $.PERMISSION_DENIED:case $.FAILED_PRECONDITION:case $.ABORTED:case $.OUT_OF_RANGE:case $.UNIMPLEMENTED:case $.DATA_LOSS:return!0}}function PT(n){if(n===void 0)return Ut("GRPC error has no .code"),$.UNKNOWN;switch(n){case Wt.OK:return $.OK;case Wt.CANCELLED:return $.CANCELLED;case Wt.UNKNOWN:return $.UNKNOWN;case Wt.DEADLINE_EXCEEDED:return $.DEADLINE_EXCEEDED;case Wt.RESOURCE_EXHAUSTED:return $.RESOURCE_EXHAUSTED;case Wt.INTERNAL:return $.INTERNAL;case Wt.UNAVAILABLE:return $.UNAVAILABLE;case Wt.UNAUTHENTICATED:return $.UNAUTHENTICATED;case Wt.INVALID_ARGUMENT:return $.INVALID_ARGUMENT;case Wt.NOT_FOUND:return $.NOT_FOUND;case Wt.ALREADY_EXISTS:return $.ALREADY_EXISTS;case Wt.PERMISSION_DENIED:return $.PERMISSION_DENIED;case Wt.FAILED_PRECONDITION:return $.FAILED_PRECONDITION;case Wt.ABORTED:return $.ABORTED;case Wt.OUT_OF_RANGE:return $.OUT_OF_RANGE;case Wt.UNIMPLEMENTED:return $.UNIMPLEMENTED;case Wt.DATA_LOSS:return $.DATA_LOSS;default:return de()}}(Je=Wt||(Wt={}))[Je.OK=0]="OK",Je[Je.CANCELLED=1]="CANCELLED",Je[Je.UNKNOWN=2]="UNKNOWN",Je[Je.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Je[Je.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Je[Je.NOT_FOUND=5]="NOT_FOUND",Je[Je.ALREADY_EXISTS=6]="ALREADY_EXISTS",Je[Je.PERMISSION_DENIED=7]="PERMISSION_DENIED",Je[Je.UNAUTHENTICATED=16]="UNAUTHENTICATED",Je[Je.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Je[Je.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Je[Je.ABORTED=10]="ABORTED",Je[Je.OUT_OF_RANGE=11]="OUT_OF_RANGE",Je[Je.UNIMPLEMENTED=12]="UNIMPLEMENTED",Je[Je.INTERNAL=13]="INTERNAL",Je[Je.UNAVAILABLE=14]="UNAVAILABLE",Je[Je.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kT(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fD=new Gi([4294967295,4294967295],0);function _x(n){const e=kT().encode(n),t=new RE;return t.update(e),new Uint8Array(t.digest())}function wx(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Gi([t,r],0),new Gi([s,i],0)]}class Vg{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Al(`Invalid padding: ${t}`);if(r<0)throw new Al(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Al(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Al(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Gi.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Gi.fromNumber(r)));return s.compare(fD)===1&&(s=new Gi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=_x(e),[r,s]=wx(t);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);if(!this.de(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Vg(i,s,t);return r.forEach(o=>a.insert(o)),a}insert(e){if(this.Ie===0)return;const t=_x(e),[r,s]=wx(t);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);this.Ae(a)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Al extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,zc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Bc(Te.min(),s,new mt(Re),Gn(),Oe())}}class zc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new zc(r,t,Oe(),Oe(),Oe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class RT{constructor(e,t){this.targetId=e,this.me=t}}class jT{constructor(e,t,r=Lt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class bx{constructor(){this.fe=0,this.ge=Tx(),this.pe=Lt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Oe(),t=Oe(),r=Oe();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:de()}}),new zc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Tx()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,fe(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class pD{constructor(e){this.Le=e,this.Be=new Map,this.ke=Gn(),this.qe=Ex(),this.Qe=new mt(Re)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:de()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(Bd(i))if(r===0){const a=new ie(i.path);this.Ue(t,a,yt.newNoDocument(a,Te.min()))}else fe(r===1);else{const a=this.Ye(t);if(a!==r){const o=this.Ze(e),c=o?this.Xe(o,e,a):1;if(c!==0){this.je(t);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,d)}Wd==null||Wd.et(function(h,m,p,y,E){var v,I,_,x,C,R;const F={localCacheCount:h,existenceFilterCount:m.count,databaseId:p.database,projectId:p.projectId},q=m.unchangedNames;return q&&(F.bloomFilter={applied:E===0,hashCount:(v=q==null?void 0:q.hashCount)!==null&&v!==void 0?v:0,bitmapLength:(x=(_=(I=q==null?void 0:q.bits)===null||I===void 0?void 0:I.bitmap)===null||_===void 0?void 0:_.length)!==null&&x!==void 0?x:0,padding:(R=(C=q==null?void 0:q.bits)===null||C===void 0?void 0:C.padding)!==null&&R!==void 0?R:0,mightContain:T=>{var b;return(b=y==null?void 0:y.mightContain(T))!==null&&b!==void 0&&b}}),F}(a,e.me,this.Le.tt(),o,c))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,o;try{a=ps(r).toUint8Array()}catch(c){if(c instanceof eT)return mr("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{o=new Vg(a,s,i)}catch(c){return mr(c instanceof Al?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return o.Ie===0?null:o}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const a=this.Le.tt(),o=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(o)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,a)=>{const o=this.Je(a);if(o){if(i.current&&Bd(o.target)){const c=new ie(o.target.path);this.ke.get(c)!==null||this.it(a,c)||this.Ue(a,c,yt.newNoDocument(c,e))}i.be&&(t.set(a,i.ve()),i.Ce())}});let r=Oe();this.qe.forEach((i,a)=>{let o=!0;a.forEachWhile(c=>{const d=this.Je(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)}),o&&(r=r.add(i))}),this.ke.forEach((i,a)=>a.setReadTime(e));const s=new Bc(e,t,this.Qe,this.ke,r);return this.ke=Gn(),this.qe=Ex(),this.Qe=new mt(Re),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new bx,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ot(Re),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||K("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new bx),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Ex(){return new mt(ie.comparator)}function Tx(){return new mt(ie.comparator)}const gD=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),yD=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),vD=(()=>({and:"AND",or:"OR"}))();class xD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ep(n,e){return n.useProto3Json||Lc(e)?e:{value:e}}function bo(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function DT(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function _D(n,e){return bo(n,e.toTimestamp())}function zt(n){return fe(!!n),Te.fromTimestamp(function(t){const r=fs(t);return new Pt(r.seconds,r.nanos)}(n))}function Lg(n,e){return tp(n,e).canonicalString()}function tp(n,e){const t=function(s){return new Ke(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function MT(n){const e=Ke.fromString(n);return fe(WT(e)),e}function _c(n,e){return Lg(n.databaseId,e.path)}function Br(n,e){const t=MT(e);if(t.get(1)!==n.databaseId.projectId)throw new Q($.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Q($.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ie(OT(t))}function VT(n,e){return Lg(n.databaseId,e)}function LT(n){const e=MT(n);return e.length===4?Ke.emptyPath():OT(e)}function np(n){return new Ke(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function OT(n){return fe(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Ix(n,e,t){return{name:_c(n,e),fields:t.value.mapValue.fields}}function FT(n,e,t){const r=Br(n,e.name),s=zt(e.updateTime),i=e.createTime?zt(e.createTime):Te.min(),a=new mn({mapValue:{fields:e.fields}}),o=yt.newFoundDocument(r,s,i,a);return t&&o.setHasCommittedMutations(),t?o.setHasCommittedMutations():o}function wD(n,e){return"found"in e?function(r,s){fe(!!s.found),s.found.name,s.found.updateTime;const i=Br(r,s.found.name),a=zt(s.found.updateTime),o=s.found.createTime?zt(s.found.createTime):Te.min(),c=new mn({mapValue:{fields:s.found.fields}});return yt.newFoundDocument(i,a,o,c)}(n,e):"missing"in e?function(r,s){fe(!!s.missing),fe(!!s.readTime);const i=Br(r,s.missing),a=zt(s.readTime);return yt.newNoDocument(i,a)}(n,e):de()}function bD(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:de()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,h){return d.useProto3Json?(fe(h===void 0||typeof h=="string"),Lt.fromBase64String(h||"")):(fe(h===void 0||h instanceof Buffer||h instanceof Uint8Array),Lt.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&function(d){const h=d.code===void 0?$.UNKNOWN:PT(d.code);return new Q(h,d.message||"")}(a);t=new jT(r,s,i,o||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Br(n,r.document.name),i=zt(r.document.updateTime),a=r.document.createTime?zt(r.document.createTime):Te.min(),o=new mn({mapValue:{fields:r.document.fields}}),c=yt.newFoundDocument(s,i,a,o),d=r.targetIds||[],h=r.removedTargetIds||[];t=new sd(d,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Br(n,r.document),i=r.readTime?zt(r.readTime):Te.min(),a=yt.newNoDocument(s,i),o=r.removedTargetIds||[];t=new sd([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Br(n,r.document),i=r.removedTargetIds||[];t=new sd([],i,s,null)}else{if(!("filter"in e))return de();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new mD(s,i),o=r.targetId;t=new RT(o,a)}}return t}function wc(n,e){let t;if(e instanceof Uo)t={update:Ix(n,e.key,e.value)};else if(e instanceof Bo)t={delete:_c(n,e.key)};else if(e instanceof Es)t={update:Ix(n,e.key,e.data),updateMask:AD(e.fieldMask)};else{if(!(e instanceof Rg))return de();t={verify:_c(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,a){const o=a.transform;if(o instanceof _o)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof aa)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof oa)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof wo)return{fieldPath:a.field.canonicalString(),increment:o.Pe};throw de()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:_D(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:de()}(n,e.precondition)),t}function rp(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Tt.updateTime(zt(i.updateTime)):i.exists!==void 0?Tt.exists(i.exists):Tt.none()}(e.currentDocument):Tt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(a,o){let c=null;if("setToServerValue"in o)fe(o.setToServerValue==="REQUEST_TIME"),c=new _o;else if("appendMissingElements"in o){const h=o.appendMissingElements.values||[];c=new aa(h)}else if("removeAllFromArray"in o){const h=o.removeAllFromArray.values||[];c=new oa(h)}else"increment"in o?c=new wo(a,o.increment):de();const d=Et.fromServerFormat(o.fieldPath);return new Uc(d,c)}(n,s)):[];if(e.update){e.update.name;const s=Br(n,e.update.name),i=new mn({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=function(c){const d=c.fieldPaths||[];return new Hn(d.map(h=>Et.fromServerFormat(h)))}(e.updateMask);return new Es(s,i,a,t,r)}return new Uo(s,i,t,r)}if(e.delete){const s=Br(n,e.delete);return new Bo(s,t)}if(e.verify){const s=Br(n,e.verify);return new Rg(s,t)}return de()}function ED(n,e){return n&&n.length>0?(fe(e!==void 0),n.map(t=>function(s,i){let a=s.updateTime?zt(s.updateTime):zt(i);return a.isEqual(Te.min())&&(a=zt(i)),new uD(a,s.transformResults||[])}(t,e))):[]}function $T(n,e){return{documents:[VT(n,e.path)]}}function Nh(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=VT(n,s);const i=function(d){if(d.length!==0)return qT(rt.create(d,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const a=function(d){if(d.length!==0)return d.map(h=>function(p){return{field:Us(p.field),direction:ID(p.dir)}}(h))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const o=ep(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:t,parent:s}}function UT(n,e,t,r){const{_t:s,parent:i}=Nh(n,e),a={},o=[];let c=0;return t.forEach(d=>{const h=r?d.alias:"aggregate_"+c++;a[h]=d.alias,d.aggregateType==="count"?o.push({alias:h,count:{}}):d.aggregateType==="avg"?o.push({alias:h,avg:{field:Us(d.fieldPath)}}):d.aggregateType==="sum"&&o.push({alias:h,sum:{field:Us(d.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:s.structuredQuery},parent:s.parent},ut:a,parent:i}}function BT(n){let e=LT(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){fe(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(m){const p=zT(m);return p instanceof rt&&Ag(p)?p.getFilters():[p]}(t.where));let a=[];t.orderBy&&(a=function(m){return m.map(p=>function(E){return new xc(Da(E.field),function(I){switch(I){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction))}(p))}(t.orderBy));let o=null;t.limit&&(o=function(m){let p;return p=typeof m=="object"?m.value:m,Lc(p)?null:p}(t.limit));let c=null;t.startAt&&(c=function(m){const p=!!m.before,y=m.values||[];return new hi(y,p)}(t.startAt));let d=null;return t.endAt&&(d=function(m){const p=!m.before,y=m.values||[];return new hi(y,p)}(t.endAt)),dT(e,s,a,i,o,"F",c,d)}function TD(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return de()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function zT(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Da(t.unaryFilter.field);return Qe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Da(t.unaryFilter.field);return Qe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Da(t.unaryFilter.field);return Qe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Da(t.unaryFilter.field);return Qe.create(a,"!=",{nullValue:"NULL_VALUE"});default:return de()}}(n):n.fieldFilter!==void 0?function(t){return Qe.create(Da(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return de()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return rt.create(t.compositeFilter.filters.map(r=>zT(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return de()}}(t.compositeFilter.op))}(n):de()}function ID(n){return gD[n]}function SD(n){return yD[n]}function CD(n){return vD[n]}function Us(n){return{fieldPath:n.canonicalString()}}function Da(n){return Et.fromServerFormat(n.fieldPath)}function qT(n){return n instanceof Qe?function(t){if(t.op==="=="){if(lx(t.value))return{unaryFilter:{field:Us(t.field),op:"IS_NAN"}};if(ox(t.value))return{unaryFilter:{field:Us(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(lx(t.value))return{unaryFilter:{field:Us(t.field),op:"IS_NOT_NAN"}};if(ox(t.value))return{unaryFilter:{field:Us(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Us(t.field),op:SD(t.op),value:t.value}}}(n):n instanceof rt?function(t){const r=t.getFilters().map(s=>qT(s));return r.length===1?r[0]:{compositeFilter:{op:CD(t.op),filters:r}}}(n):de()}function AD(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function WT(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(e,t,r,s,i=Te.min(),a=Te.min(),o=Lt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=c}withSequenceNumber(e){return new is(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new is(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new is(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new is(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HT{constructor(e){this.ct=e}}function ND(n,e){let t;if(e.document)t=FT(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=ie.fromSegments(e.noDocument.path),s=ca(e.noDocument.readTime);t=yt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return de();{const r=ie.fromSegments(e.unknownDocument.path),s=ca(e.unknownDocument.version);t=yt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Pt(s[0],s[1]);return Te.fromTimestamp(i)}(e.readTime)),t}function Sx(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Hd(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,a){return{name:_c(i,a.key),fields:a.data.value.mapValue.fields,updateTime:bo(i,a.version.toTimestamp()),createTime:bo(i,a.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:la(e.version)};else{if(!e.isUnknownDocument())return de();r.unknownDocument={path:t.path.toArray(),version:la(e.version)}}return r}function Hd(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function la(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ca(n){const e=new Pt(n.seconds,n.nanoseconds);return Te.fromTimestamp(e)}function Oi(n,e){const t=(e.baseMutations||[]).map(i=>rp(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const a=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const o=e.mutations[i+1];a.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>rp(n.ct,i)),s=Pt.fromMillis(e.localWriteTimeMs);return new jg(e.batchId,s,t,r)}function Nl(n){const e=ca(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ca(n.lastLimboFreeSnapshotVersion):Te.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return fe(i.documents.length===1),An($o(LT(i.documents[0])))}(n.query):function(i){return An(BT(i))}(n.query),new is(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Lt.fromBase64String(n.resumeToken))}function GT(n,e){const t=la(e.snapshotVersion),r=la(e.lastLimboFreeSnapshotVersion);let s;s=Bd(e.target)?$T(n.ct,e.target):Nh(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ia(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Og(n){const e=BT({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?qd(e,e.limit,"L"):e}function Rm(n,e){return new Mg(e.largestBatchId,rp(n.ct,e.overlayMutation))}function Cx(n,e){const t=e.path.lastSegment();return[n,Cn(e.path.popLast()),t]}function Ax(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:la(r.readTime),documentKey:Cn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PD{getBundleMetadata(e,t){return Nx(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:ca(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Nx(e).put(function(s){return{bundleId:s.id,createTime:la(zt(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return Px(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Og(i.bundledQuery),readTime:ca(i.readTime)}}(r)})}saveNamedQuery(e,t){return Px(e).put(function(s){return{name:s.name,readTime:la(zt(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Nx(n){return Jt(n,"bundles")}function Px(n){return Jt(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ph{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Ph(e,r)}getOverlay(e,t){return pl(e).get(Cx(this.userId,t)).next(r=>r?Rm(this.serializer,r):null)}getOverlays(e,t){const r=Vr();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,a)=>{const o=new Mg(t,a);s.push(this.ht(e,o))}),O.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(a=>s.add(Cn(a.getCollectionPath())));const i=[];return s.forEach(a=>{const o=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);i.push(pl(e).j("collectionPathOverlayIndex",o))}),O.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Vr(),i=Cn(t),a=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return pl(e).U("collectionPathOverlayIndex",a).next(o=>{for(const c of o){const d=Rm(this.serializer,c);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Vr();let a;const o=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return pl(e).J({index:"collectionGroupOverlayIndex",range:o},(c,d,h)=>{const m=Rm(this.serializer,d);i.size()<s||m.largestBatchId===a?(i.set(m.getKey(),m),a=m.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return pl(e).put(function(s,i,a){const[o,c,d]=Cx(i,a.mutation.key);return{userId:i,collectionPath:c,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:wc(s.ct,a.mutation)}}(this.serializer,this.userId,t))}}function pl(n){return Jt(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kD{Pt(e){return Jt(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Lt.fromUint8Array(r):Lt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(wt(e.integerValue));else if("doubleValue"in e){const r=wt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),pc(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=fs(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ps(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?tT(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Sh(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):de()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const a="value",o=((s=(r=i[a].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(wt(o)),this.Vt(a,t),this.Tt(i[a],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),ie.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Fi.vt=new Fi;function RD(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function kx(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const a=RD(255&r[i]);if(s+=a,a!==8)break}return s}(n);return Math.ceil(e/8)}class jD{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=kx(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=kx(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class DD{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class MD{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class gl{constructor(){this.jt=new jD,this.Ht=new DD(this.jt),this.Jt=new MD(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new $i(this.indexId,this.documentKey,this.arrayValue,r)}}function ks(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Rx(n.arrayValue,e.arrayValue),t!==0?t:(t=Rx(n.directionalValue,e.directionalValue),t!==0?t:ie.comparator(n.documentKey,e.documentKey)))}function Rx(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jx{constructor(e){this.Xt=new ot((t,r)=>Et.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(fe(e.collectionGroup===this.collectionId),this.nn)return!1;const t=Hf(e);if(t!==void 0&&!this.sn(t))return!1;const r=Vi(e);let s=new Set,i=0,a=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const o=this.Xt.getIterator().getNext();if(!s.has(o.field.canonicalString())){const c=r[i];if(!this.on(o,c)||!this._n(this.en[a++],c))return!1}++i}for(;i<r.length;++i){const o=r[i];if(a>=this.en.length||!this._n(this.en[a++],o))return!1}return!0}an(){if(this.nn)return null;let e=new ot(Et.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Ki(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ki(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ki(r.field,r.dir==="asc"?0:1)));return new go(go.UNKNOWN_ID,this.collectionId,t,yo.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KT(n){var e,t;if(fe(n instanceof Qe||n instanceof rt),n instanceof Qe){if(n instanceof uT){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>Qe.create(n.field,"==",i)))||[];return rt.create(s,"or")}return n}const r=n.filters.map(s=>KT(s));return rt.create(r,n.op)}function VD(n){if(n.getFilters().length===0)return[];const e=ap(KT(n));return fe(QT(e)),sp(e)||ip(e)?[e]:e.getFilters()}function sp(n){return n instanceof Qe}function ip(n){return n instanceof rt&&Ag(n)}function QT(n){return sp(n)||ip(n)||function(t){if(t instanceof rt&&Yf(t)){for(const r of t.getFilters())if(!sp(r)&&!ip(r))return!1;return!0}return!1}(n)}function ap(n){if(fe(n instanceof Qe||n instanceof rt),n instanceof Qe)return n;if(n.filters.length===1)return ap(n.filters[0]);const e=n.filters.map(r=>ap(r));let t=rt.create(e,n.op);return t=Gd(t),QT(t)?t:(fe(t instanceof rt),fe(xo(t)),fe(t.filters.length>1),t.filters.reduce((r,s)=>Fg(r,s)))}function Fg(n,e){let t;return fe(n instanceof Qe||n instanceof rt),fe(e instanceof Qe||e instanceof rt),t=n instanceof Qe?e instanceof Qe?function(s,i){return rt.create([s,i],"and")}(n,e):Dx(n,e):e instanceof Qe?Dx(e,n):function(s,i){if(fe(s.filters.length>0&&i.filters.length>0),xo(s)&&xo(i))return oT(s,i.getFilters());const a=Yf(s)?s:i,o=Yf(s)?i:s,c=a.filters.map(d=>Fg(d,o));return rt.create(c,"or")}(n,e),Gd(t)}function Dx(n,e){if(xo(e))return oT(e,n.getFilters());{const t=e.filters.map(r=>Fg(n,r));return rt.create(t,"or")}}function Gd(n){if(fe(n instanceof Qe||n instanceof rt),n instanceof Qe)return n;const e=n.getFilters();if(e.length===1)return Gd(e[0]);if(iT(n))return n;const t=e.map(s=>Gd(s)),r=[];return t.forEach(s=>{s instanceof Qe?r.push(s):s instanceof rt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:rt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LD{constructor(){this.un=new $g}addToCollectionParentIndex(e,t){return this.un.add(t),O.resolve()}getCollectionParents(e,t){return O.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return O.resolve()}deleteFieldIndex(e,t){return O.resolve()}deleteAllFieldIndexes(e){return O.resolve()}createTargetIndexes(e,t){return O.resolve()}getDocumentsMatchingTarget(e,t){return O.resolve(null)}getIndexType(e,t){return O.resolve(0)}getFieldIndexes(e,t){return O.resolve([])}getNextCollectionGroupToUpdate(e){return O.resolve(null)}getMinOffset(e,t){return O.resolve(sr.min())}getMinOffsetFromCollectionGroup(e,t){return O.resolve(sr.min())}updateCollectionGroup(e,t,r){return O.resolve()}updateIndexEntries(e,t){return O.resolve()}}class $g{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new ot(Ke.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ot(Ke.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pu=new Uint8Array(0);class OD{constructor(e,t){this.databaseId=t,this.cn=new $g,this.ln=new bs(r=>ia(r),(r,s)=>Oc(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Cn(s)};return Mx(e).put(i)}return O.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[UE(t),""],!1,!0);return Mx(e).U(s).next(i=>{for(const a of i){if(a.collectionId!==t)break;r.push(Mr(a.parent))}return r})}addFieldIndex(e,t){const r=yl(e),s=function(o){return{indexId:o.indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const a=Na(e);return i.next(o=>{a.put(Ax(o,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=yl(e),s=Na(e),i=Aa(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=yl(e),r=Aa(e),s=Na(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return O.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new jx(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Aa(e);let s=!0;const i=new Map;return O.forEach(this.hn(t),a=>this.Pn(e,a).next(o=>{s&&(s=!!o),i.set(a,o)})).next(()=>{if(s){let a=Oe();const o=[];return O.forEach(i,(c,d)=>{K("IndexedDbIndexManager",`Using index ${function(C){return`id=${C.indexId}|cg=${C.collectionGroup}|f=${C.fields.map(R=>`${R.fieldPath}:${R.kind}`).join(",")}`}(c)} to execute ${ia(t)}`);const h=function(C,R){const F=Hf(R);if(F===void 0)return null;for(const q of zd(C,F.fieldPath))switch(q.op){case"array-contains-any":return q.value.arrayValue.values||[];case"array-contains":return[q.value]}return null}(d,c),m=function(C,R){const F=new Map;for(const q of Vi(R))for(const T of zd(C,q.fieldPath))switch(T.op){case"==":case"in":F.set(q.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return F.set(q.fieldPath.canonicalString(),T.value),Array.from(F.values())}return null}(d,c),p=function(C,R){const F=[];let q=!0;for(const T of Vi(R)){const b=T.kind===0?mx(C,T.fieldPath,C.startAt):fx(C,T.fieldPath,C.startAt);F.push(b.value),q&&(q=b.inclusive)}return new hi(F,q)}(d,c),y=function(C,R){const F=[];let q=!0;for(const T of Vi(R)){const b=T.kind===0?fx(C,T.fieldPath,C.endAt):mx(C,T.fieldPath,C.endAt);F.push(b.value),q&&(q=b.inclusive)}return new hi(F,q)}(d,c),E=this.In(c,d,p),v=this.In(c,d,y),I=this.Tn(c,d,m),_=this.En(c.indexId,h,E,p.inclusive,v,y.inclusive,I);return O.forEach(_,x=>r.G(x,t.limit).next(C=>{C.forEach(R=>{const F=ie.fromSegments(R.documentKey);a.has(F)||(a=a.add(F),o.push(F))})}))}).next(()=>o)}return O.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=VD(rt.create(e.filters,"and")).map(r=>Xf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,a,o){const c=(t!=null?t.length:1)*Math.max(r.length,i.length),d=c/(t!=null?t.length:1),h=[];for(let m=0;m<c;++m){const p=t?this.dn(t[m/d]):Pu,y=this.An(e,p,r[m%d],s),E=this.Rn(e,p,i[m%d],a),v=o.map(I=>this.An(e,p,I,!0));h.push(...this.createRange(y,E,v))}return h}An(e,t,r,s){const i=new $i(e,ie.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new $i(e,ie.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new jx(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let a=null;for(const o of i)r.rn(o)&&(!a||o.fields.length>a.fields.length)&&(a=o);return a})}getIndexType(e,t){let r=2;const s=this.hn(t);return O.forEach(s,i=>this.Pn(e,i).next(a=>{a?r!==0&&a.fields.length<function(c){let d=new ot(Et.comparator),h=!1;for(const m of c.filters)for(const p of m.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?h=!0:d=d.add(p.field));for(const m of c.orderBy)m.field.isKeyField()||(d=d.add(m.field));return d.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(a){return a.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new gl;for(const s of Vi(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const a=r.Yt(s.kind);Fi.vt.It(i,a)}return r.zt()}dn(e){const t=new gl;return Fi.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new gl;return Fi.vt.It(sa(this.databaseId,t),r.Yt(function(i){const a=Vi(i);return a.length===0?0:a[a.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new gl);let i=0;for(const a of Vi(e)){const o=r[i++];for(const c of s)if(this.fn(t,a.fieldPath)&&vc(o))s=this.gn(s,a,o);else{const d=c.Yt(a.kind);Fi.vt.It(o,d)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const a of r.arrayValue.values||[])for(const o of s){const c=new gl;c.seed(o.zt()),Fi.vt.It(a,c.Yt(t.kind)),i.push(c)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof Qe&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=yl(e),s=Na(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const a=[];return O.forEach(i,o=>s.get([o.indexId,this.uid]).next(c=>{a.push(function(h,m){const p=m?new yo(m.sequenceNumber,new sr(ca(m.readTime),new ie(Mr(m.documentKey)),m.largestBatchId)):yo.empty(),y=h.fields.map(([E,v])=>new Ki(Et.fromServerFormat(E),v));return new go(h.indexId,h.collectionGroup,y,p)}(o,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Re(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=yl(e),i=Na(e);return this.yn(e).next(a=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(o=>O.forEach(o,c=>i.put(Ax(c.indexId,this.uid,a,r)))))}updateIndexEntries(e,t){const r=new Map;return O.forEach(t,(s,i)=>{const a=r.get(s.collectionGroup);return(a?O.resolve(a):this.getFieldIndexes(e,s.collectionGroup)).next(o=>(r.set(s.collectionGroup,o),O.forEach(o,c=>this.wn(e,s,c).next(d=>{const h=this.Sn(i,c);return d.isEqual(h)?O.resolve():this.bn(e,i,c,d,h)}))))})}Dn(e,t,r,s){return Aa(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Aa(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Aa(e);let i=new ot(ks);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(a,o)=>{i=i.add(new $i(r.indexId,t,o.arrayValue,o.directionalValue))}).next(()=>i)}Sn(e,t){let r=new ot(ks);const s=this.Vn(t,e);if(s==null)return r;const i=Hf(t);if(i!=null){const a=e.data.field(i.fieldPath);if(vc(a))for(const o of a.arrayValue.values||[])r=r.add(new $i(t.indexId,e.key,this.dn(o),s))}else r=r.add(new $i(t.indexId,e.key,Pu,s));return r}bn(e,t,r,s,i){K("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(c,d,h,m,p){const y=c.getIterator(),E=d.getIterator();let v=Ca(y),I=Ca(E);for(;v||I;){let _=!1,x=!1;if(v&&I){const C=h(v,I);C<0?x=!0:C>0&&(_=!0)}else v!=null?x=!0:_=!0;_?(m(I),I=Ca(E)):x?(p(v),v=Ca(y)):(v=Ca(y),I=Ca(E))}}(s,i,ks,o=>{a.push(this.Dn(e,t,r,o))},o=>{a.push(this.vn(e,t,r,o))}),O.waitFor(a)}yn(e){let t=1;return Na(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((a,o)=>ks(a,o)).filter((a,o,c)=>!o||ks(a,c[o-1])!==0);const s=[];s.push(e);for(const a of r){const o=ks(a,e),c=ks(a,t);if(o===0)s[0]=e.Zt();else if(o>0&&c<0)s.push(a),s.push(a.Zt());else if(c>0)break}s.push(t);const i=[];for(let a=0;a<s.length;a+=2){if(this.Cn(s[a],s[a+1]))return[];const o=[s[a].indexId,this.uid,s[a].arrayValue,s[a].directionalValue,Pu,[]],c=[s[a+1].indexId,this.uid,s[a+1].arrayValue,s[a+1].directionalValue,Pu,[]];i.push(IDBKeyRange.bound(o,c))}return i}Cn(e,t){return ks(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Vx)}getMinOffset(e,t){return O.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||de())).next(Vx)}}function Mx(n){return Jt(n,"collectionParents")}function Aa(n){return Jt(n,"indexEntries")}function yl(n){return Jt(n,"indexConfiguration")}function Na(n){return Jt(n,"indexState")}function Vx(n){fe(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Ig(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new sr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lx={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class In{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new In(e,In.DEFAULT_COLLECTION_PERCENTILE,In.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YT(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],a=IDBKeyRange.only(t.batchId);let o=0;const c=r.J({range:a},(h,m,p)=>(o++,p.delete()));i.push(c.next(()=>{fe(o===1)}));const d=[];for(const h of t.mutations){const m=KE(e,h.key.path,t.batchId);i.push(s.delete(m)),d.push(h.key)}return O.waitFor(i).next(()=>d)}function Kd(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw de();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */In.DEFAULT_COLLECTION_PERCENTILE=10,In.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,In.DEFAULT=new In(41943040,In.DEFAULT_COLLECTION_PERCENTILE,In.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),In.DISABLED=new In(-1,0,0);class kh{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){fe(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new kh(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Rs(e).J({index:"userMutationsIndex",range:r},(s,i,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Ma(e),a=Rs(e);return a.add({}).next(o=>{fe(typeof o=="number");const c=new jg(o,t,r,s),d=function(y,E,v){const I=v.baseMutations.map(x=>wc(y.ct,x)),_=v.mutations.map(x=>wc(y.ct,x));return{userId:E,batchId:v.batchId,localWriteTimeMs:v.localWriteTime.toMillis(),baseMutations:I,mutations:_}}(this.serializer,this.userId,c),h=[];let m=new ot((p,y)=>Re(p.canonicalString(),y.canonicalString()));for(const p of s){const y=KE(this.userId,p.key.path,o);m=m.add(p.key.path.popLast()),h.push(a.put(d)),h.push(i.put(y,Sj))}return m.forEach(p=>{h.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Fn[o]=c.keys()}),O.waitFor(h).next(()=>c)})}lookupMutationBatch(e,t){return Rs(e).get(t).next(r=>r?(fe(r.userId===this.userId),Oi(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?O.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Rs(e).J({index:"userMutationsIndex",range:s},(a,o,c)=>{o.userId===this.userId&&(fe(o.batchId>=r),i=Oi(this.serializer,o)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Rs(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,a)=>{r=i.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Rs(e).U("userMutationsIndex",t).next(r=>r.map(s=>Oi(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Zu(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Ma(e).J({range:s},(a,o,c)=>{const[d,h,m]=a,p=Mr(h);if(d===this.userId&&t.path.isEqual(p))return Rs(e).get(m).next(y=>{if(!y)throw de();fe(y.userId===this.userId),i.push(Oi(this.serializer,y))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ot(Re);const s=[];return t.forEach(i=>{const a=Zu(this.userId,i.path),o=IDBKeyRange.lowerBound(a),c=Ma(e).J({range:o},(d,h,m)=>{const[p,y,E]=d,v=Mr(y);p===this.userId&&i.path.isEqual(v)?r=r.add(E):m.done()});s.push(c)}),O.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Zu(this.userId,r),a=IDBKeyRange.lowerBound(i);let o=new ot(Re);return Ma(e).J({range:a},(c,d,h)=>{const[m,p,y]=c,E=Mr(p);m===this.userId&&r.isPrefixOf(E)?E.length===s&&(o=o.add(y)):h.done()}).next(()=>this.xn(e,o))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Rs(e).get(i).next(a=>{if(a===null)throw de();fe(a.userId===this.userId),r.push(Oi(this.serializer,a))}))}),O.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return YT(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),O.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return O.resolve();const r=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return Ma(e).J({range:r},(i,a,o)=>{if(i[0]===this.userId){const c=Mr(i[1]);s.push(c)}else o.done()}).next(()=>{fe(s.length===0)})})}containsKey(e,t){return JT(e,this.userId,t)}Nn(e){return XT(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function JT(n,e,t){const r=Zu(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let a=!1;return Ma(n).J({range:i,H:!0},(o,c,d)=>{const[h,m,p]=o;h===e&&m===s&&(a=!0),d.done()}).next(()=>a)}function Rs(n){return Jt(n,"mutations")}function Ma(n){return Jt(n,"documentMutations")}function XT(n){return Jt(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ua(0)}static kn(){return new ua(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FD{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new ua(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Te.fromTimestamp(new Pt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Pa(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(fe(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Pa(e).J((a,o)=>{const c=Nl(o);c.sequenceNumber<=t&&r.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>O.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Pa(e).J((r,s)=>{const i=Nl(s);t(i)})}qn(e){return Ox(e).get("targetGlobalKey").next(t=>(fe(t!==null),t))}Qn(e,t){return Ox(e).put("targetGlobalKey",t)}Kn(e,t){return Pa(e).put(GT(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=ia(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Pa(e).J({range:s,index:"queryTargetsIndex"},(a,o,c)=>{const d=Nl(o);Oc(t,d.target)&&(i=d,c.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Bs(e);return t.forEach(a=>{const o=Cn(a.path);s.push(i.put({targetId:r,path:o})),s.push(this.referenceDelegate.addReference(e,r,a))}),O.waitFor(s)}removeMatchingKeys(e,t,r){const s=Bs(e);return O.forEach(t,i=>{const a=Cn(i.path);return O.waitFor([s.delete([r,a]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Bs(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Bs(e);let i=Oe();return s.J({range:r,H:!0},(a,o,c)=>{const d=Mr(a[1]),h=new ie(d);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=Cn(t.path),s=IDBKeyRange.bound([r],[UE(r)],!1,!0);let i=0;return Bs(e).J({index:"documentTargetsIndex",H:!0,range:s},([a,o],c,d)=>{a!==0&&(i++,d.done())}).next(()=>i>0)}ot(e,t){return Pa(e).get(t).next(r=>r?Nl(r):null)}}function Pa(n){return Jt(n,"targets")}function Ox(n){return Jt(n,"targetGlobal")}function Bs(n){return Jt(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fx([n,e],[t,r]){const s=Re(n,t);return s===0?Re(e,r):s}class $D{constructor(e){this.Un=e,this.buffer=new ot(Fx),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Fx(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ZT{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){K("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){bi(t)?K("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await wi(t)}await this.Hn(3e5)})}}class UD{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return O.resolve(Wn.oe);const r=new $D(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(K("LruGarbageCollector","Garbage collection skipped; disabled"),O.resolve(Lx)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(K("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Lx):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,a,o,c,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(K("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,a=Date.now(),this.nthSequenceNumber(e,s))).next(m=>(r=m,o=Date.now(),this.removeTargets(e,r,t))).next(m=>(i=m,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>(d=Date.now(),Ra()<=Ge.DEBUG&&K("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${s} in `+(o-a)+`ms
	Removed ${i} targets in `+(c-o)+`ms
	Removed ${m} documents in `+(d-c)+`ms
Total Duration: ${d-h}ms`),O.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:m})))}}function eI(n,e){return new UD(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BD{constructor(e,t){this.db=e,this.garbageCollector=eI(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return ku(e,r)}removeReference(e,t,r){return ku(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ku(e,t)}nr(e,t){return function(s,i){let a=!1;return XT(s).Y(o=>JT(s,o,i).next(c=>(c&&(a=!0),O.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(a,o)=>{if(o<=t){const c=this.nr(e,a).next(d=>{if(!d)return i++,r.getEntry(e,a).next(()=>(r.removeEntry(a,Te.min()),Bs(e).delete(function(m){return[0,Cn(m.path)]}(a))))});s.push(c)}}).next(()=>O.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ku(e,t)}tr(e,t){const r=Bs(e);let s,i=Wn.oe;return r.J({index:"documentTargetsIndex"},([a,o],{path:c,sequenceNumber:d})=>{a===0?(i!==Wn.oe&&t(new ie(Mr(s)),i),i=d,s=c):i=Wn.oe}).next(()=>{i!==Wn.oe&&t(new ie(Mr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ku(n,e){return Bs(n).put(function(r,s){return{targetId:0,path:Cn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tI{constructor(){this.changes=new bs(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,yt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?O.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zD{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ri(e).put(r)}removeEntry(e,t,r){return Ri(e).delete(function(i,a){const o=i.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],Hd(a),o[o.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=yt.newInvalidDocument(t);return Ri(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(vl(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:yt.newInvalidDocument(t)};return Ri(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(vl(t))},(s,i)=>{r={document:this.ir(t,i),size:Kd(i)}}).next(()=>r)}getEntries(e,t){let r=Gn();return this._r(e,t,(s,i)=>{const a=this.ir(s,i);r=r.insert(s,a)}).next(()=>r)}ar(e,t){let r=Gn(),s=new mt(ie.comparator);return this._r(e,t,(i,a)=>{const o=this.ir(i,a);r=r.insert(i,o),s=s.insert(i,Kd(a))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return O.resolve();let s=new ot(Bx);t.forEach(c=>s=s.add(c));const i=IDBKeyRange.bound(vl(s.first()),vl(s.last())),a=s.getIterator();let o=a.getNext();return Ri(e).J({index:"documentKeyIndex",range:i},(c,d,h)=>{const m=ie.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;o&&Bx(o,m)<0;)r(o,null),o=a.getNext();o&&o.isEqual(m)&&(r(o,d),o=a.hasNext()?a.getNext():null),o?h.$(vl(o)):h.done()}).next(()=>{for(;o;)r(o,null),o=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const a=t.path,o=[a.popLast().toArray(),a.lastSegment(),Hd(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ri(e).U(IDBKeyRange.bound(o,c,!0)).next(d=>{i==null||i.incrementDocumentReadCount(d.length);let h=Gn();for(const m of d){const p=this.ir(ie.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);p.isFoundDocument()&&($c(t,p)||s.has(p.key))&&(h=h.insert(p.key,p))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=Gn();const a=Ux(t,r),o=Ux(t,sr.max());return Ri(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,o,!0)},(c,d,h)=>{const m=this.ir(ie.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(m.key,m),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new qD(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return $x(e).get("remoteDocumentGlobalKey").next(t=>(fe(!!t),t))}rr(e,t){return $x(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=ND(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Te.min())))return r}return yt.newInvalidDocument(e)}}function nI(n){return new zD(n)}class qD extends tI{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new bs(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new ot((i,a)=>Re(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{const o=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,o.readTime)),a.isValidDocument()){const c=Sx(this.cr.serializer,a);s=s.add(i.path.popLast());const d=Kd(c);r+=d-o.size,t.push(this.cr.addEntry(e,i,c))}else if(r-=o.size,this.trackRemovals){const c=Sx(this.cr.serializer,a.convertToNoDocument(Te.min()));t.push(this.cr.addEntry(e,i,c))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),O.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,a)=>{this.lr.set(i,{size:a,readTime:r.get(i).readTime})}),r))}}function $x(n){return Jt(n,"remoteDocumentGlobal")}function Ri(n){return Jt(n,"remoteDocumentsV14")}function vl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Ux(n,e){const t=e.documentKey.path.toArray();return[n,Hd(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Bx(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Re(t[i],r[i]),s)return s;return s=Re(t.length,r.length),s||(s=Re(t[t.length-2],r[r.length-2]),s||Re(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WD{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rI{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&zl(r.mutation,s,Hn.empty(),Pt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Oe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Oe()){const s=Vr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let a=Cl();return i.forEach((o,c)=>{a=a.insert(o,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=Vr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Oe()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,o)=>{t.set(a,o)})})}computeViews(e,t,r,s){let i=Gn();const a=Bl(),o=function(){return Bl()}();return t.forEach((c,d)=>{const h=r.get(d.key);s.has(d.key)&&(h===void 0||h.mutation instanceof Es)?i=i.insert(d.key,d):h!==void 0?(a.set(d.key,h.mutation.getFieldMask()),zl(h.mutation,d,h.mutation.getFieldMask(),Pt.now())):a.set(d.key,Hn.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((d,h)=>a.set(d,h)),t.forEach((d,h)=>{var m;return o.set(d,new WD(h,(m=a.get(d))!==null&&m!==void 0?m:null))}),o))}recalculateAndSaveOverlays(e,t){const r=Bl();let s=new mt((a,o)=>a-o),i=Oe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const o of a)o.keys().forEach(c=>{const d=t.get(c);if(d===null)return;let h=r.get(c)||Hn.empty();h=o.applyToLocalView(d,h),r.set(c,h);const m=(s.get(o.batchId)||Oe()).add(c);s=s.insert(o.batchId,m)})}).next(()=>{const a=[],o=s.getReverseIterator();for(;o.hasNext();){const c=o.getNext(),d=c.key,h=c.value,m=xT();h.forEach(p=>{if(!i.has(p)){const y=ST(t.get(p),r.get(p));y!==null&&m.set(p,y),i=i.add(p)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,m))}return O.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(a){return ie.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ng(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):O.resolve(Vr());let o=-1,c=i;return a.next(d=>O.forEach(d,(h,m)=>(o<m.largestBatchId&&(o=m.largestBatchId),i.get(h)?O.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{c=c.insert(h,p)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,c,d,Oe())).next(h=>({batchId:o,changes:vT(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ie(t)).next(r=>{let s=Cl();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=Cl();return this.indexManager.getCollectionParents(e,i).next(o=>O.forEach(o,c=>{const d=function(m,p){return new ws(p,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(h=>{h.forEach((m,p)=>{a=a.insert(m,p)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(a=>{i.forEach((c,d)=>{const h=d.getKey();a.get(h)===null&&(a=a.insert(h,yt.newInvalidDocument(h)))});let o=Cl();return a.forEach((c,d)=>{const h=i.get(c);h!==void 0&&zl(h.mutation,d,Hn.empty(),Pt.now()),$c(t,d)&&(o=o.insert(c,d))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HD{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return O.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:zt(s.createTime)}}(t)),O.resolve()}getNamedQuery(e,t){return O.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Og(s.bundledQuery),readTime:zt(s.readTime)}}(t)),O.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GD{constructor(){this.overlays=new mt(ie.comparator),this.Ir=new Map}getOverlay(e,t){return O.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Vr();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),O.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),O.resolve()}getOverlaysForCollection(e,t,r){const s=Vr(),i=t.length+1,a=new ie(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const c=o.getNext().value,d=c.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return O.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new mt((d,h)=>d-h);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let h=i.get(d.largestBatchId);h===null&&(h=Vr(),i=i.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const o=Vr(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,h)=>o.set(d,h)),!(o.size()>=s)););return O.resolve(o)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Mg(t,r));let i=this.Ir.get(t);i===void 0&&(i=Oe(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KD{constructor(){this.sessionToken=Lt.EMPTY_BYTE_STRING}getSessionToken(e){return O.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,O.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(){this.Tr=new ot(tn.Er),this.dr=new ot(tn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new tn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new tn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new ie(new Ke([])),r=new tn(t,e),s=new tn(t,e+1),i=[];return this.dr.forEachInRange([r,s],a=>{this.Vr(a),i.push(a.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new ie(new Ke([])),r=new tn(t,e),s=new tn(t,e+1);let i=Oe();return this.dr.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){const t=new tn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class tn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return ie.comparator(e.key,t.key)||Re(e.wr,t.wr)}static Ar(e,t){return Re(e.wr,t.wr)||ie.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QD{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new ot(tn.Er)}checkEmpty(e){return O.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new jg(i,t,r,s);this.mutationQueue.push(a);for(const o of s)this.br=this.br.add(new tn(o.key,i)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return O.resolve(a)}lookupMutationBatch(e,t){return O.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return O.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return O.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return O.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new tn(t,0),s=new tn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],a=>{const o=this.Dr(a.wr);i.push(o)}),O.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ot(Re);return t.forEach(s=>{const i=new tn(s,0),a=new tn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,a],o=>{r=r.add(o.wr)})}),O.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;ie.isDocumentKey(i)||(i=i.child(""));const a=new tn(new ie(i),0);let o=new ot(Re);return this.br.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(o=o.add(c.wr)),!0)},a),O.resolve(this.Cr(o))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){fe(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return O.forEach(t.mutations,s=>{const i=new tn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new tn(t,0),s=this.br.firstAfterOrEqual(r);return O.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,O.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YD{constructor(e){this.Mr=e,this.docs=function(){return new mt(ie.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return O.resolve(r?r.document.mutableCopy():yt.newInvalidDocument(t))}getEntries(e,t){let r=Gn();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():yt.newInvalidDocument(s))}),O.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Gn();const a=t.path,o=new ie(a.child("")),c=this.docs.getIteratorFrom(o);for(;c.hasNext();){const{key:d,value:{document:h}}=c.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Ig(zE(h),r)<=0||(s.has(h.key)||$c(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return O.resolve(i)}getAllFromCollectionGroup(e,t,r,s){de()}Or(e,t){return O.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new JD(this)}getSize(e){return O.resolve(this.size)}}class JD extends tI{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),O.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XD{constructor(e){this.persistence=e,this.Nr=new bs(t=>ia(t),Oc),this.lastRemoteSnapshotVersion=Te.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Ug,this.targetCount=0,this.kr=ua.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),O.resolve()}getLastRemoteSnapshotVersion(e){return O.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return O.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),O.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),O.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new ua(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,O.resolve()}updateTargetData(e,t){return this.Kn(t),O.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,O.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((a,o)=>{o.sequenceNumber<=t&&r.get(o.targetId)===null&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),s++)}),O.waitFor(i).next(()=>s)}getTargetCount(e){return O.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return O.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),O.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),O.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),O.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return O.resolve(r)}containsKey(e,t){return O.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Wn(0),this.Kr=!1,this.Kr=!0,this.$r=new KD,this.referenceDelegate=e(this),this.Ur=new XD(this),this.indexManager=new LD,this.remoteDocumentCache=function(s){return new YD(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new HT(t),this.Gr=new HD(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new GD,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new QD(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){K("MemoryPersistence","Starting transaction:",e);const s=new ZD(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return O.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class ZD extends WE{constructor(e){super(),this.currentSequenceNumber=e}}class Rh{constructor(e){this.persistence=e,this.Jr=new Ug,this.Yr=null}static Zr(e){return new Rh(e)}get Xr(){if(this.Yr)return this.Yr;throw de()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),O.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),O.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),O.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.Xr,r=>{const s=ie.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Te.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return O.or([()=>O.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Qd{constructor(e,t){this.persistence=e,this.ti=new bs(r=>Cn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=eI(this,t)}static Zr(e,t){return new Qd(e,t)}zr(){}jr(e){return O.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return O.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?O.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,a=>this.nr(e,a,t).next(o=>{o||(r++,i.removeEntry(a,Te.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),O.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),O.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),O.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),O.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=td(e.data.value)),t}nr(e,t,r){return O.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return O.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e2{constructor(e){this.serializer=e}O(e,t,r,s){const i=new Eh("createOrUpgrade",t);r<1&&s>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",nx,{unique:!0}),c.createObjectStore("documentMutations")}(e),zx(e),function(c){c.createObjectStore("remoteDocuments")}(e));let a=O.resolve();return r<3&&s>=3&&(r!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),zx(e)),a=a.next(()=>function(c){const d=c.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Te.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",h)}(i))),r<4&&s>=4&&(r!==0&&(a=a.next(()=>function(c,d){return d.store("mutations").U().next(h=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",nx,{unique:!0});const m=d.store("mutations"),p=h.map(y=>m.put(y));return O.waitFor(p)})}(e,i))),a=a.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(a=a.next(()=>this.ni(i))),r<6&&s>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(a=a.next(()=>this.ii(i))),r<8&&s>=8&&(a=a.next(()=>this.si(e,i))),r<9&&s>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(a=a.next(()=>this.oi(i))),r<11&&s>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(a=a.next(()=>{(function(c){const d=c.createObjectStore("documentOverlays",{keyPath:Oj});d.createIndex("collectionPathOverlayIndex",Fj,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",$j,{unique:!1})})(e)})),r<13&&s>=13&&(a=a.next(()=>function(c){const d=c.createObjectStore("remoteDocumentsV14",{keyPath:Cj});d.createIndex("documentKeyIndex",Aj),d.createIndex("collectionGroupIndex",Nj)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(a=a.next(()=>this.ai(e,i))),r<15&&s>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:Dj}).createIndex("sequenceNumberIndex",Mj,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:Vj}).createIndex("documentKeyIndex",Lj,{unique:!1})}(e))),r<16&&s>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(a=a.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),a}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Kd(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>O.forEach(s,i=>{const a=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",a).next(o=>O.forEach(o,c=>{fe(c.userId===i.userId);const d=Oi(this.serializer,c);return YT(e,i.userId,d).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((a,o)=>{const c=new Ke(a),d=function(m){return[0,Cn(m)]}(c);i.push(t.get(d).next(h=>h?O.resolve():(m=>t.put({targetId:0,path:Cn(m),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>O.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:jj});const r=t.store("collectionParents"),s=new $g,i=a=>{if(s.add(a)){const o=a.lastSegment(),c=a.popLast();return r.put({collectionId:o,parent:Cn(c)})}};return t.store("remoteDocuments").J({H:!0},(a,o)=>{const c=new Ke(a);return i(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,o,c],d)=>{const h=Mr(o);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=Nl(s),a=GT(this.serializer,i);return t.put(a)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,a)=>{const o=t.store("remoteDocumentsV14"),c=function(m){return m.document?new ie(Ke.fromString(m.document.name).popFirst(5)):m.noDocument?ie.fromSegments(m.noDocument.path):m.unknownDocument?ie.fromSegments(m.unknownDocument.path):de()}(a).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(o.put(d))}).next(()=>O.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=nI(this.serializer),i=new Bg(Rh.Zr,this.serializer.ct);return r.U().next(a=>{const o=new Map;return a.forEach(c=>{var d;let h=(d=o.get(c.userId))!==null&&d!==void 0?d:Oe();Oi(this.serializer,c).keys().forEach(m=>h=h.add(m)),o.set(c.userId,h)}),O.forEach(o,(c,d)=>{const h=new rn(d),m=Ph.lt(this.serializer,h),p=i.getIndexManager(h),y=kh.lt(h,this.serializer,p,i.referenceDelegate);return new rI(s,y,m,p).recalculateAndSaveOverlaysForDocumentKeys(new Gf(t,Wn.oe),c).next()})})}}function zx(n){n.createObjectStore("targetDocuments",{keyPath:kj}).createIndex("documentTargetsIndex",Rj,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Pj,{unique:!0}),n.createObjectStore("targetGlobal")}const jm="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class zg{constructor(e,t,r,s,i,a,o,c,d,h,m=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=a,this.document=o,this.ci=d,this.li=h,this.hi=m,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=p=>Promise.resolve(),!zg.D())throw new Q($.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new BD(this,s),this.Ai=t+"main",this.serializer=new HT(c),this.Ri=new Ur(this.Ai,this.hi,new e2(this.serializer)),this.$r=new kD,this.Ur=new FD(this.referenceDelegate,this.serializer),this.remoteDocumentCache=nI(this.serializer),this.Gr=new PD,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&Ut("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Q($.FAILED_PRECONDITION,jm);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Wn(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ru(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(bi(e))return K("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return K("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return xl(e).get("owner").next(t=>O.resolve(this.vi(t)))}Ci(e){return Ru(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Jt(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),a=s.filter(o=>i.indexOf(o)===-1);return O.forEach(a,o=>r.delete(o.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?O.resolve(!0):xl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new Q($.FAILED_PRECONDITION,jm);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ru(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,o=this.networkEnabled===s.networkEnabled;if(i||a&&o)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&K("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Gf(e,Wn.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Ru(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return kh.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new OD(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Ph.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){K("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(c){return c===17?zj:c===16?Bj:c===15?Cg:c===14?JE:c===13?YE:c===12?Uj:c===11?QE:void de()}(this.hi);let a;return this.Ri.runTransaction(e,s,i,o=>(a=new Gf(o,this.Qr?this.Qr.next():Wn.oe),t==="readwrite-primary"?this.wi(a).next(c=>!!c||this.Si(a)).next(c=>{if(!c)throw Ut(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new Q($.FAILED_PRECONDITION,qE);return r(a)}).next(c=>this.Di(a).next(()=>c)):this.Ki(a).next(()=>r(a)))).then(o=>(a.raiseOnCommittedEvent(),o))}Ki(e){return xl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Q($.FAILED_PRECONDITION,jm)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return xl(e).put("owner",t)}static D(){return Ur.D()}bi(e){const t=xl(e);return t.get("owner").next(r=>this.vi(r)?(K("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):O.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Ut(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;Bb()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return K("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ut("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Ut("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function xl(n){return Jt(n,"owner")}function Ru(n){return Jt(n,"clientMetadata")}function qg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wg{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Oe(),s=Oe();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Wg(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t2{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sI{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Bb()?8:HE(Yt())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new t2;return this.Xi(e,t,a).next(o=>{if(i.result=o,this.zi)return this.es(e,t,a,o.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Ra()<=Ge.DEBUG&&K("QueryEngine","SDK will not create cache indexes for query:",ja(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),O.resolve()):(Ra()<=Ge.DEBUG&&K("QueryEngine","Query:",ja(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Ra()<=Ge.DEBUG&&K("QueryEngine","The SDK decides to create cache indexes for query:",ja(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,An(t))):O.resolve())}Yi(e,t){if(px(t))return O.resolve(null);let r=An(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=qd(t,null,"F"),r=An(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const a=Oe(...i);return this.Ji.getDocuments(e,a).next(o=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.ts(t,o);return this.ns(t,d,a,c.readTime)?this.Yi(e,qd(t,null,"F")):this.rs(e,d,t,c)}))})))}Zi(e,t,r,s){return px(t)||s.isEqual(Te.min())?O.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const a=this.ts(t,i);return this.ns(t,a,r,s)?O.resolve(null):(Ra()<=Ge.DEBUG&&K("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ja(t)),this.rs(e,a,t,BE(s,-1)).next(o=>o))})}ts(e,t){let r=new ot(gT(e));return t.forEach((s,i)=>{$c(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Ra()<=Ge.DEBUG&&K("QueryEngine","Using full collection scan to execute query:",ja(t)),this.Ji.getDocumentsMatchingQuery(e,t,sr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n2{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new mt(Re),this._s=new bs(i=>ia(i),Oc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new rI(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function iI(n,e,t,r){return new n2(n,e,t,r)}async function aI(n,e){const t=re(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const a=[],o=[];let c=Oe();for(const d of s){a.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}for(const d of i){o.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(r,c).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:o}))})})}function r2(n,e){const t=re(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(o,c,d,h){const m=d.batch,p=m.keys();let y=O.resolve();return p.forEach(E=>{y=y.next(()=>h.getEntry(c,E)).next(v=>{const I=d.docVersions.get(E);fe(I!==null),v.version.compareTo(I)<0&&(m.applyToRemoteDocument(v,d),v.isValidDocument()&&(v.setReadTime(d.commitVersion),h.addEntry(v)))})}),y.next(()=>o.mutationQueue.removeMutationBatch(c,m))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let c=Oe();for(let d=0;d<o.mutationResults.length;++d)o.mutationResults[d].transformResults.length>0&&(c=c.add(o.batch.mutations[d].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function oI(n){const e=re(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function s2(n,e){const t=re(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const o=[];e.targetChanges.forEach((h,m)=>{const p=s.get(m);if(!p)return;o.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,m).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,m)));let y=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?y=y.withResumeToken(Lt.EMPTY_BYTE_STRING,Te.min()).withLastLimboFreeSnapshotVersion(Te.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(m,y),function(v,I,_){return v.resumeToken.approximateByteSize()===0||I.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8?!0:_.addedDocuments.size+_.modifiedDocuments.size+_.removedDocuments.size>0}(p,y,h)&&o.push(t.Ur.updateTargetData(i,y))});let c=Gn(),d=Oe();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&o.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),o.push(lI(i,a,e.documentUpdates).next(h=>{c=h.Ps,d=h.Is})),!r.isEqual(Te.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(m=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));o.push(h)}return O.waitFor(o).next(()=>a.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,c,d)).next(()=>c)}).then(i=>(t.os=s,i))}function lI(n,e,t){let r=Oe(),s=Oe();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let a=Gn();return t.forEach((o,c)=>{const d=i.get(o);c.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(o)),c.isNoDocument()&&c.version.isEqual(Te.min())?(e.removeEntry(o,c.readTime),a=a.insert(o,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),a=a.insert(o,c)):K("LocalStore","Ignoring outdated watch update for ",o,". Current version:",d.version," Watch version:",c.version)}),{Ps:a,Is:s}})}function i2(n,e){const t=re(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Eo(n,e){const t=re(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,O.resolve(s)):t.Ur.allocateTargetId(r).next(a=>(s=new is(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function To(n,e,t){const r=re(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!bi(a))throw a;K("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Yd(n,e,t){const r=re(n);let s=Te.min(),i=Oe();return r.persistence.runTransaction("Execute query","readwrite",a=>function(c,d,h){const m=re(c),p=m._s.get(h);return p!==void 0?O.resolve(m.os.get(p)):m.Ur.getTargetData(d,h)}(r,a,An(e)).next(o=>{if(o)return s=o.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,o.targetId).next(c=>{i=c})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,t?s:Te.min(),t?i:Oe())).next(o=>(dI(r,pT(e),o),{documents:o,Ts:i})))}function cI(n,e){const t=re(n),r=re(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(a=>a?a.target:null))}function uI(n,e){const t=re(n),r=t.us.get(e)||Te.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,BE(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(dI(t,e,s),s))}function dI(n,e,t){let r=n.us.get(e)||Te.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function a2(n,e,t,r){const s=re(n);let i=Oe(),a=Gn();for(const d of t){const h=e.Es(d.metadata.name);d.document&&(i=i.add(h));const m=e.ds(d);m.setReadTime(e.As(d.metadata.readTime)),a=a.insert(h,m)}const o=s.cs.newChangeBuffer({trackRemovals:!0}),c=await Eo(s,function(h){return An($o(Ke.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",d=>lI(d,o,a).next(h=>(o.apply(d),h)).next(h=>s.Ur.removeMatchingKeysForTargetId(d,c.targetId).next(()=>s.Ur.addMatchingKeys(d,i,c.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,h.Ps,h.Is)).next(()=>h.Ps)))}async function o2(n,e,t=Oe()){const r=await Eo(n,An(Og(e.bundledQuery))),s=re(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const a=zt(e.readTime);if(r.snapshotVersion.compareTo(a)>=0)return s.Gr.saveNamedQuery(i,e);const o=r.withResumeToken(Lt.EMPTY_BYTE_STRING,a);return s.os=s.os.insert(o.targetId,o),s.Ur.updateTargetData(i,o).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function qx(n,e){return`firestore_clients_${n}_${e}`}function Wx(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Dm(n,e){return`firestore_targets_${n}_${e}`}class Jd{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,a=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return a&&s.error&&(a=typeof s.error.message=="string"&&typeof s.error.code=="string",a&&(i=new Q(s.error.code,s.error.message))),a?new Jd(e,t,s.state,i):(Ut("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ql{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new Q(r.error.code,r.error.message))),i?new ql(e,r.state,s):(Ut("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Xd{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Pg();for(let a=0;s&&a<r.activeTargetIds.length;++a)s=GE(r.activeTargetIds[a]),i=i.add(r.activeTargetIds[a]);return s?new Xd(e,i):(Ut("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Hg{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Hg(t.clientId,t.onlineState):(Ut("SharedClientState",`Failed to parse online state: ${e}`),null)}}class op{constructor(){this.activeTargetIds=Pg()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Mm{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new mt(Re),this.started=!1,this.bs=[];const a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=qx(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new op),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(qx(this.persistenceKey,r));if(s){const i=Xd.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Dm(this.persistenceKey,e));if(s){const i=ql.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Dm(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return K("SharedClientState","READ",e,t),t}setItem(e,t){K("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){K("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(K("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Ut("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let a=Wn.oe;if(i!=null)try{const o=JSON.parse(i);fe(typeof o=="number"),a=o}catch(o){Ut("SharedClientState","Failed to read sequence number from WebStorage",o)}return a}(t.newValue);r!==Wn.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Jd(this.currentUser,e,t,r),i=Wx(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=Wx(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Dm(this.persistenceKey,e),i=new ql(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Xd.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Jd.Rs(new rn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return ql.Rs(s,t)}Ls(e){return Hg.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);K("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),a=[],o=[];return i.forEach(c=>{s.has(c)||a.push(c)}),s.forEach(c=>{i.has(c)||o.push(c)}),this.syncEngine.io(a,o).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Pg();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class hI{constructor(){this.so=new op,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new op,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l2{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hx{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){K("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){K("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ju=null;function Vm(){return ju===null?ju=function(){return 268435456+Math.round(2147483648*Math.random())}():ju++,"0x"+ju.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c2={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u2{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const En="WebChannelConnection";class d2 extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,a){const o=Vm(),c=this.xo(t,r.toUriEncodedString());K("RestConnection",`Sending RPC '${t}' ${o}:`,c,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,i,a),this.No(t,c,d,s).then(h=>(K("RestConnection",`Received RPC '${t}' ${o}: `,h),h),h=>{throw mr("RestConnection",`RPC '${t}' ${o} failed with error: `,h,"url: ",c,"request:",s),h})}Lo(t,r,s,i,a,o){return this.Mo(t,r,s,i,a)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Fo}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,a)=>t[a]=i),s&&s.headers.forEach((i,a)=>t[a]=i)}xo(t,r){const s=c2[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Vm();return new Promise((a,o)=>{const c=new jE;c.setWithCredentials(!0),c.listenOnce(DE.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Xu.NO_ERROR:const h=c.getResponseJson();K(En,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),a(h);break;case Xu.TIMEOUT:K(En,`RPC '${e}' ${i} timed out`),o(new Q($.DEADLINE_EXCEEDED,"Request time out"));break;case Xu.HTTP_ERROR:const m=c.getStatus();if(K(En,`RPC '${e}' ${i} failed with status:`,m,"response text:",c.getResponseText()),m>0){let p=c.getResponseJson();Array.isArray(p)&&(p=p[0]);const y=p==null?void 0:p.error;if(y&&y.status&&y.message){const E=function(I){const _=I.toLowerCase().replace(/_/g,"-");return Object.values($).indexOf(_)>=0?_:$.UNKNOWN}(y.status);o(new Q(E,y.message))}else o(new Q($.UNKNOWN,"Server responded with status "+c.getStatus()))}else o(new Q($.UNAVAILABLE,"Connection failed."));break;default:de()}}finally{K(En,`RPC '${e}' ${i} completed.`)}});const d=JSON.stringify(s);K(En,`RPC '${e}' ${i} sending request:`,s),c.send(t,"POST",d,r,15)})}Bo(e,t,r){const s=Vm(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=LE(),o=VE(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const h=i.join("");K(En,`Creating RPC '${e}' stream ${s}: ${h}`,c);const m=a.createWebChannel(h,c);let p=!1,y=!1;const E=new u2({Io:I=>{y?K(En,`Not sending because RPC '${e}' stream ${s} is closed:`,I):(p||(K(En,`Opening RPC '${e}' stream ${s} transport.`),m.open(),p=!0),K(En,`RPC '${e}' stream ${s} sending:`,I),m.send(I))},To:()=>m.close()}),v=(I,_,x)=>{I.listen(_,C=>{try{x(C)}catch(R){setTimeout(()=>{throw R},0)}})};return v(m,Sl.EventType.OPEN,()=>{y||(K(En,`RPC '${e}' stream ${s} transport opened.`),E.yo())}),v(m,Sl.EventType.CLOSE,()=>{y||(y=!0,K(En,`RPC '${e}' stream ${s} transport closed`),E.So())}),v(m,Sl.EventType.ERROR,I=>{y||(y=!0,mr(En,`RPC '${e}' stream ${s} transport errored:`,I),E.So(new Q($.UNAVAILABLE,"The operation could not be completed")))}),v(m,Sl.EventType.MESSAGE,I=>{var _;if(!y){const x=I.data[0];fe(!!x);const C=x,R=C.error||((_=C[0])===null||_===void 0?void 0:_.error);if(R){K(En,`RPC '${e}' stream ${s} received error:`,R);const F=R.status;let q=function(A){const P=Wt[A];if(P!==void 0)return PT(P)}(F),T=R.message;q===void 0&&(q=$.INTERNAL,T="Unknown error status: "+F+" with message "+R.message),y=!0,E.So(new Q(q,T)),m.close()}else K(En,`RPC '${e}' stream ${s} received:`,x),E.bo(x)}}),v(o,ME.STAT_EVENT,I=>{I.stat===Wf.PROXY?K(En,`RPC '${e}' stream ${s} detected buffering proxy`):I.stat===Wf.NOPROXY&&K(En,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{E.wo()},0),E}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mI(){return typeof window<"u"?window:null}function id(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qc(n){return new xD(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&K("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fI{constructor(e,t,r,s,i,a,o,c){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Gg(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===$.RESOURCE_EXHAUSTED?(Ut(t.toString()),Ut("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===$.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new Q($.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return K("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(K("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class h2 extends fI{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=bD(this.serializer,e),r=function(i){if(!("targetChange"in i))return Te.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?Te.min():a.readTime?zt(a.readTime):Te.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=np(this.serializer),t.addTarget=function(i,a){let o;const c=a.target;if(o=Bd(c)?{documents:$T(i,c)}:{query:Nh(i,c)._t},o.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){o.resumeToken=DT(i,a.resumeToken);const d=ep(i,a.expectedCount);d!==null&&(o.expectedCount=d)}else if(a.snapshotVersion.compareTo(Te.min())>0){o.readTime=bo(i,a.snapshotVersion.toTimestamp());const d=ep(i,a.expectedCount);d!==null&&(o.expectedCount=d)}return o}(this.serializer,e);const r=TD(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=np(this.serializer),t.removeTarget=e,this.a_(t)}}class m2 extends fI{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return fe(!!e.streamToken),this.lastStreamToken=e.streamToken,fe(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){fe(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=ED(e.writeResults,e.commitTime),r=zt(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=np(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>wc(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f2 extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new Q($.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Mo(e,tp(t,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Q($.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Lo(e,tp(t,r),s,a,o,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Q($.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class p2{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Ut(t),this.D_=!1):K("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g2{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(a=>{r.enqueueAndForget(async()=>{Ti(this)&&(K("RemoteStore","Restarting streams for network reachability change."),await async function(c){const d=re(c);d.L_.add(4),await zo(d),d.q_.set("Unknown"),d.L_.delete(4),await Wc(d)}(this))})}),this.q_=new p2(r,s)}}async function Wc(n){if(Ti(n))for(const e of n.B_)await e(!0)}async function zo(n){for(const e of n.B_)await e(!1)}function jh(n,e){const t=re(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Yg(t)?Qg(t):Wo(t).r_()&&Kg(t,e))}function Io(n,e){const t=re(n),r=Wo(t);t.N_.delete(e),r.r_()&&pI(t,e),t.N_.size===0&&(r.r_()?r.o_():Ti(t)&&t.q_.set("Unknown"))}function Kg(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Te.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Wo(n).A_(e)}function pI(n,e){n.Q_.xe(e),Wo(n).R_(e)}function Qg(n){n.Q_=new pD({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Wo(n).start(),n.q_.v_()}function Yg(n){return Ti(n)&&!Wo(n).n_()&&n.N_.size>0}function Ti(n){return re(n).L_.size===0}function gI(n){n.Q_=void 0}async function y2(n){n.q_.set("Online")}async function v2(n){n.N_.forEach((e,t)=>{Kg(n,e)})}async function x2(n,e){gI(n),Yg(n)?(n.q_.M_(e),Qg(n)):n.q_.set("Unknown")}async function _2(n,e,t){if(n.q_.set("Online"),e instanceof jT&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const o of i.targetIds)s.N_.has(o)&&(await s.remoteSyncer.rejectListen(o,a),s.N_.delete(o),s.Q_.removeTarget(o))}(n,e)}catch(r){K("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Zd(n,r)}else if(e instanceof sd?n.Q_.Ke(e):e instanceof RT?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Te.min()))try{const r=await oI(n.localStore);t.compareTo(r)>=0&&await function(i,a){const o=i.Q_.rt(a);return o.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const h=i.N_.get(d);h&&i.N_.set(d,h.withResumeToken(c.resumeToken,a))}}),o.targetMismatches.forEach((c,d)=>{const h=i.N_.get(c);if(!h)return;i.N_.set(c,h.withResumeToken(Lt.EMPTY_BYTE_STRING,h.snapshotVersion)),pI(i,c);const m=new is(h.target,c,d,h.sequenceNumber);Kg(i,m)}),i.remoteSyncer.applyRemoteEvent(o)}(n,t)}catch(r){K("RemoteStore","Failed to raise snapshot:",r),await Zd(n,r)}}async function Zd(n,e,t){if(!bi(e))throw e;n.L_.add(1),await zo(n),n.q_.set("Offline"),t||(t=()=>oI(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{K("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Wc(n)})}function yI(n,e){return e().catch(t=>Zd(n,t,e))}async function qo(n){const e=re(n),t=mi(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;w2(e);)try{const s=await i2(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,b2(e,s)}catch(s){await Zd(e,s)}vI(e)&&xI(e)}function w2(n){return Ti(n)&&n.O_.length<10}function b2(n,e){n.O_.push(e);const t=mi(n);t.r_()&&t.V_&&t.m_(e.mutations)}function vI(n){return Ti(n)&&!mi(n).n_()&&n.O_.length>0}function xI(n){mi(n).start()}async function E2(n){mi(n).p_()}async function T2(n){const e=mi(n);for(const t of n.O_)e.m_(t.mutations)}async function I2(n,e,t){const r=n.O_.shift(),s=Dg.from(r,e,t);await yI(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await qo(n)}async function S2(n,e){e&&mi(n).V_&&await async function(r,s){if(function(a){return NT(a)&&a!==$.ABORTED}(s.code)){const i=r.O_.shift();mi(r).s_(),await yI(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await qo(r)}}(n,e),vI(n)&&xI(n)}async function Gx(n,e){const t=re(n);t.asyncQueue.verifyOperationInProgress(),K("RemoteStore","RemoteStore received new credentials");const r=Ti(t);t.L_.add(3),await zo(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Wc(t)}async function lp(n,e){const t=re(n);e?(t.L_.delete(2),await Wc(t)):e||(t.L_.add(2),await zo(t),t.q_.set("Unknown"))}function Wo(n){return n.K_||(n.K_=function(t,r,s){const i=re(t);return i.w_(),new h2(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:y2.bind(null,n),Ro:v2.bind(null,n),mo:x2.bind(null,n),d_:_2.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Yg(n)?Qg(n):n.q_.set("Unknown")):(await n.K_.stop(),gI(n))})),n.K_}function mi(n){return n.U_||(n.U_=function(t,r,s){const i=re(t);return i.w_(),new m2(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:E2.bind(null,n),mo:S2.bind(null,n),f_:T2.bind(null,n),g_:I2.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await qo(n)):(await n.U_.stop(),n.O_.length>0&&(K("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jg{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new an,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,o=new Jg(e,t,a,s,i);return o.start(r),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Q($.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ho(n,e){if(Ut("AsyncQueue",`${e}: ${n}`),bi(n))return new Q($.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class io{constructor(e){this.comparator=e?(t,r)=>e(t,r)||ie.comparator(t.key,r.key):(t,r)=>ie.comparator(t.key,r.key),this.keyedMap=Cl(),this.sortedSet=new mt(this.comparator)}static emptySet(e){return new io(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof io)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new io;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kx{constructor(){this.W_=new mt(ie.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):de():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class So{constructor(e,t,r,s,i,a,o,c,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach(o=>{a.push({type:0,doc:o})}),new So(e,t,io.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Fc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C2{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class A2{constructor(){this.queries=Qx(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=re(t),i=s.queries;s.queries=Qx(),i.forEach((a,o)=>{for(const c of o.j_)c.onError(r)})})(this,new Q($.ABORTED,"Firestore shutting down"))}}function Qx(){return new bs(n=>fT(n),Fc)}async function Xg(n,e){const t=re(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new C2,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const o=Ho(a,`Initialization of query '${ja(e.query)}' failed`);return void e.onError(o)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&ey(t)}async function Zg(n,e){const t=re(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.j_.indexOf(e);a>=0&&(i.j_.splice(a,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function N2(n,e){const t=re(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const o of a.j_)o.X_(s)&&(r=!0);a.z_=s}}r&&ey(t)}function P2(n,e,t){const r=re(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function ey(n){n.Y_.forEach(e=>{e.next()})}var cp,Yx;(Yx=cp||(cp={})).ea="default",Yx.Cache="cache";class ty{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new So(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=So.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==cp.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k2{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jx{constructor(e){this.serializer=e}Es(e){return Br(this.serializer,e)}ds(e){return e.metadata.exists?FT(this.serializer,e.document,!1):yt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return zt(e)}}class R2{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=_I(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=Ke.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new Jx(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const a of s.metadata.queries){const o=(t.get(a)||Oe()).add(i);t.set(a,o)}}return t}async complete(){const e=await a2(this.localStore,new Jx(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await o2(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function _I(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wI{constructor(e){this.key=e}}class bI{constructor(e){this.key=e}}class EI{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Oe(),this.mutatedKeys=Oe(),this.Aa=gT(e),this.Ra=new io(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new Kx,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,o=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,m)=>{const p=s.get(h),y=$c(this.query,m)?m:null,E=!!p&&this.mutatedKeys.has(p.key),v=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let I=!1;p&&y?p.data.isEqual(y.data)?E!==v&&(r.track({type:3,doc:y}),I=!0):this.ga(p,y)||(r.track({type:2,doc:y}),I=!0,(c&&this.Aa(y,c)>0||d&&this.Aa(y,d)<0)&&(o=!0)):!p&&y?(r.track({type:0,doc:y}),I=!0):p&&!y&&(r.track({type:1,doc:p}),I=!0,(c||d)&&(o=!0)),I&&(y?(a=a.add(y),i=v?i.add(h):i.delete(h)):(a=a.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:a,fa:r,ns:o,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((h,m)=>function(y,E){const v=I=>{switch(I){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return de()}};return v(y)-v(E)}(h.type,m.type)||this.Aa(h.doc,m.doc)),this.pa(r),s=s!=null&&s;const o=t&&!s?this.ya():[],c=this.da.size===0&&this.current&&!s?1:0,d=c!==this.Ea;return this.Ea=c,a.length!==0||d?{snapshot:new So(this.query,e.Ra,i,a,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:o}:{wa:o}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Kx,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Oe(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new bI(r))}),this.da.forEach(r=>{e.has(r)||t.push(new wI(r))}),t}ba(e){this.Ta=e.Ts,this.da=Oe();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return So.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class j2{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class D2{constructor(e){this.key=e,this.va=!1}}class M2{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new bs(o=>fT(o),Fc),this.Ma=new Map,this.xa=new Set,this.Oa=new mt(ie.comparator),this.Na=new Map,this.La=new Ug,this.Ba={},this.ka=new Map,this.qa=ua.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function V2(n,e,t=!0){const r=Dh(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await TI(r,e,t,!0),s}async function L2(n,e){const t=Dh(n);await TI(t,e,!0,!1)}async function TI(n,e,t,r){const s=await Eo(n.localStore,An(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let o;return r&&(o=await ny(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&jh(n.remoteStore,s),o}async function ny(n,e,t,r,s){n.Ka=(m,p,y)=>async function(v,I,_,x){let C=I.view.ma(_);C.ns&&(C=await Yd(v.localStore,I.query,!1).then(({documents:T})=>I.view.ma(T,C)));const R=x&&x.targetChanges.get(I.targetId),F=x&&x.targetMismatches.get(I.targetId)!=null,q=I.view.applyChanges(C,v.isPrimaryClient,R,F);return up(v,I.targetId,q.wa),q.snapshot}(n,m,p,y);const i=await Yd(n.localStore,e,!0),a=new EI(e,i.Ts),o=a.ma(i.documents),c=zc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(o,n.isPrimaryClient,c);up(n,t,d.wa);const h=new j2(e,t,a);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),d.snapshot}async function O2(n,e,t){const r=re(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(a=>!Fc(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await To(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Io(r.remoteStore,s.targetId),Co(r,s.targetId)}).catch(wi)):(Co(r,s.targetId),await To(r.localStore,s.targetId,!0))}async function F2(n,e){const t=re(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Io(t.remoteStore,r.targetId))}async function $2(n,e,t){const r=ay(n);try{const s=await function(a,o){const c=re(a),d=Pt.now(),h=o.reduce((y,E)=>y.add(E.key),Oe());let m,p;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let E=Gn(),v=Oe();return c.cs.getEntries(y,h).next(I=>{E=I,E.forEach((_,x)=>{x.isValidDocument()||(v=v.add(_))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,E)).next(I=>{m=I;const _=[];for(const x of o){const C=hD(x,m.get(x.key).overlayedDocument);C!=null&&_.push(new Es(x.key,C,rT(C.value.mapValue),Tt.exists(!0)))}return c.mutationQueue.addMutationBatch(y,d,_,o)}).next(I=>{p=I;const _=I.applyToLocalDocumentSet(m,v);return c.documentOverlayCache.saveOverlays(y,I.batchId,_)})}).then(()=>({batchId:p.batchId,changes:vT(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,o,c){let d=a.Ba[a.currentUser.toKey()];d||(d=new mt(Re)),d=d.insert(o,c),a.Ba[a.currentUser.toKey()]=d}(r,s.batchId,t),await Ts(r,s.changes),await qo(r.remoteStore)}catch(s){const i=Ho(s,"Failed to persist write");t.reject(i)}}async function II(n,e){const t=re(n);try{const r=await s2(t.localStore,e);e.targetChanges.forEach((s,i)=>{const a=t.Na.get(i);a&&(fe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.va=!0:s.modifiedDocuments.size>0?fe(a.va):s.removedDocuments.size>0&&(fe(a.va),a.va=!1))}),await Ts(t,r,e)}catch(r){await wi(r)}}function Xx(n,e,t){const r=re(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,a)=>{const o=a.view.Z_(e);o.snapshot&&s.push(o.snapshot)}),function(a,o){const c=re(a);c.onlineState=o;let d=!1;c.queries.forEach((h,m)=>{for(const p of m.j_)p.Z_(o)&&(d=!0)}),d&&ey(c)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function U2(n,e,t){const r=re(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let a=new mt(ie.comparator);a=a.insert(i,yt.newNoDocument(i,Te.min()));const o=Oe().add(i),c=new Bc(Te.min(),new Map,new mt(Re),a,o);await II(r,c),r.Oa=r.Oa.remove(i),r.Na.delete(e),iy(r)}else await To(r.localStore,e,!1).then(()=>Co(r,e,t)).catch(wi)}async function B2(n,e){const t=re(n),r=e.batch.batchId;try{const s=await r2(t.localStore,e);sy(t,r,null),ry(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Ts(t,s)}catch(s){await wi(s)}}async function z2(n,e,t){const r=re(n);try{const s=await function(a,o){const c=re(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let h;return c.mutationQueue.lookupMutationBatch(d,o).next(m=>(fe(m!==null),h=m.keys(),c.mutationQueue.removeMutationBatch(d,m))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,h,o)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h)).next(()=>c.localDocuments.getDocuments(d,h))})}(r.localStore,e);sy(r,e,t),ry(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Ts(r,s)}catch(s){await wi(s)}}async function q2(n,e){const t=re(n);Ti(t.remoteStore)||K("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(a){const o=re(a);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>o.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Ho(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function ry(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function sy(n,e,t){const r=re(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Co(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||SI(n,r)})}function SI(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Io(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),iy(n))}function up(n,e,t){for(const r of t)r instanceof wI?(n.La.addReference(r.key,e),W2(n,r)):r instanceof bI?(K("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||SI(n,r.key)):de()}function W2(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(K("SyncEngine","New document in limbo: "+t),n.xa.add(r),iy(n))}function iy(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new ie(Ke.fromString(e)),r=n.qa.next();n.Na.set(r,new D2(t)),n.Oa=n.Oa.insert(t,r),jh(n.remoteStore,new is(An($o(t.path)),r,"TargetPurposeLimboResolution",Wn.oe))}}async function Ts(n,e,t){const r=re(n),s=[],i=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((o,c)=>{a.push(r.Ka(c,e,t).then(d=>{var h;if((d||t)&&r.isPrimaryClient){const m=d?!d.fromCache:(h=t==null?void 0:t.targetChanges.get(c.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(d){s.push(d);const m=Wg.Wi(c.targetId,d);i.push(m)}}))}),await Promise.all(a),r.Ca.d_(s),await async function(c,d){const h=re(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>O.forEach(d,p=>O.forEach(p.$i,y=>h.persistence.referenceDelegate.addReference(m,p.targetId,y)).next(()=>O.forEach(p.Ui,y=>h.persistence.referenceDelegate.removeReference(m,p.targetId,y)))))}catch(m){if(!bi(m))throw m;K("LocalStore","Failed to update sequence numbers: "+m)}for(const m of d){const p=m.targetId;if(!m.fromCache){const y=h.os.get(p),E=y.snapshotVersion,v=y.withLastLimboFreeSnapshotVersion(E);h.os=h.os.insert(p,v)}}}(r.localStore,i))}async function H2(n,e){const t=re(n);if(!t.currentUser.isEqual(e)){K("SyncEngine","User change. New user:",e.toKey());const r=await aI(t.localStore,e);t.currentUser=e,function(i,a){i.ka.forEach(o=>{o.forEach(c=>{c.reject(new Q($.CANCELLED,a))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ts(t,r.hs)}}function G2(n,e){const t=re(n),r=t.Na.get(e);if(r&&r.va)return Oe().add(r.key);{let s=Oe();const i=t.Ma.get(e);if(!i)return s;for(const a of i){const o=t.Fa.get(a);s=s.unionWith(o.view.Va)}return s}}async function K2(n,e){const t=re(n),r=await Yd(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&up(t,e.targetId,s.wa),s}async function Q2(n,e){const t=re(n);return uI(t.localStore,e).then(r=>Ts(t,r))}async function Y2(n,e,t,r){const s=re(n),i=await function(o,c){const d=re(o),h=re(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",m=>h.Mn(m,c).next(p=>p?d.localDocuments.getDocuments(m,p):O.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await qo(s.remoteStore):t==="acknowledged"||t==="rejected"?(sy(s,e,r||null),ry(s,e),function(o,c){re(re(o).mutationQueue).On(c)}(s.localStore,e)):de(),await Ts(s,i)):K("SyncEngine","Cannot apply mutation batch with id: "+e)}async function J2(n,e){const t=re(n);if(Dh(t),ay(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await Zx(t,r.toArray());t.Qa=!0,await lp(t.remoteStore,!0);for(const i of s)jh(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,a)=>{t.sharedClientState.isLocalQueryTarget(a)?r.push(a):s=s.then(()=>(Co(t,a),To(t.localStore,a,!0))),Io(t.remoteStore,a)}),await s,await Zx(t,r),function(a){const o=re(a);o.Na.forEach((c,d)=>{Io(o.remoteStore,d)}),o.La.pr(),o.Na=new Map,o.Oa=new mt(ie.comparator)}(t),t.Qa=!1,await lp(t.remoteStore,!1)}}async function Zx(n,e,t){const r=re(n),s=[],i=[];for(const a of e){let o;const c=r.Ma.get(a);if(c&&c.length!==0){o=await Eo(r.localStore,An(c[0]));for(const d of c){const h=r.Fa.get(d),m=await K2(r,h);m.snapshot&&i.push(m.snapshot)}}else{const d=await cI(r.localStore,a);o=await Eo(r.localStore,d),await ny(r,CI(d),a,!1,o.resumeToken)}s.push(o)}return r.Ca.d_(i),s}function CI(n){return dT(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function X2(n){return function(t){return re(re(t).persistence).Qi()}(re(n).localStore)}async function Z2(n,e,t,r){const s=re(n);if(s.Qa)return void K("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const a=await uI(s.localStore,pT(i[0])),o=Bc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Lt.EMPTY_BYTE_STRING);await Ts(s,a,o);break}case"rejected":await To(s.localStore,e,!0),Co(s,e,r);break;default:de()}}async function eM(n,e,t){const r=Dh(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){K("SyncEngine","Adding an already active target "+s);continue}const i=await cI(r.localStore,s),a=await Eo(r.localStore,i);await ny(r,CI(i),a.targetId,!1,a.resumeToken),jh(r.remoteStore,a)}for(const s of t)r.Ma.has(s)&&await To(r.localStore,s,!1).then(()=>{Io(r.remoteStore,s),Co(r,s)}).catch(wi)}}function Dh(n){const e=re(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=II.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=G2.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=U2.bind(null,e),e.Ca.d_=N2.bind(null,e.eventManager),e.Ca.$a=P2.bind(null,e.eventManager),e}function ay(n){const e=re(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=B2.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=z2.bind(null,e),e}function tM(n,e,t){const r=re(n);(async function(i,a,o){try{const c=await a.getMetadata();if(await function(y,E){const v=re(y),I=zt(E.createTime);return v.persistence.runTransaction("hasNewerBundle","readonly",_=>v.Gr.getBundleMetadata(_,E.id)).then(_=>!!_&&_.createTime.compareTo(I)>=0)}(i.localStore,c))return await a.close(),o._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(c)),Promise.resolve(new Set);o._updateProgress(_I(c));const d=new R2(c,i.localStore,a.serializer);let h=await a.Ua();for(;h;){const p=await d.la(h);p&&o._updateProgress(p),h=await a.Ua()}const m=await d.complete();return await Ts(i,m.Ia,void 0),await function(y,E){const v=re(y);return v.persistence.runTransaction("Save bundle","readwrite",I=>v.Gr.saveBundleMetadata(I,E))}(i.localStore,c),o._completeWith(m.progress),Promise.resolve(m.Pa)}catch(c){return mr("SyncEngine",`Loading bundle failed with ${c}`),o._failWith(c),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class fi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=qc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return iI(this.persistence,new sI,e.initialUser,this.serializer)}Ga(e){return new Bg(Rh.Zr,this.serializer)}Wa(e){return new hI}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fi.provider={build:()=>new fi};class nM extends fi{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){fe(this.persistence.referenceDelegate instanceof Qd);const r=this.persistence.referenceDelegate.garbageCollector;return new ZT(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?In.withCacheSize(this.cacheSizeBytes):In.DEFAULT;return new Bg(r=>Qd.Zr(r,t),this.serializer)}}class oy extends fi{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await ay(this.Ja.syncEngine),await qo(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return iI(this.persistence,new sI,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new ZT(r,e.asyncQueue,t)}Ha(e,t){const r=new Tj(t,this.persistence);return new Ej(e.asyncQueue,r)}Ga(e){const t=qg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?In.withCacheSize(this.cacheSizeBytes):In.DEFAULT;return new zg(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,mI(),id(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new hI}}class AI extends oy{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Mm&&(this.sharedClientState.syncEngine={no:Y2.bind(null,t),ro:Z2.bind(null,t),io:eM.bind(null,t),Qi:X2.bind(null,t),eo:Q2.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await J2(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=mI();if(!Mm.D(t))throw new Q($.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=qg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Mm(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class pi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Xx(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=H2.bind(null,this.syncEngine),await lp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new A2}()}createDatastore(e){const t=qc(e.databaseInfo.databaseId),r=function(i){return new d2(i)}(e.databaseInfo);return function(i,a,o,c){return new f2(i,a,o,c)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,a,o){return new g2(r,s,i,a,o)}(this.localStore,this.datastore,e.asyncQueue,t=>Xx(this.syncEngine,t,0),function(){return Hx.D()?new Hx:new l2}())}createSyncEngine(e,t){return function(s,i,a,o,c,d,h){const m=new M2(s,i,a,o,c,d);return h&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=re(s);K("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await zo(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}pi.provider={build:()=>new pi};function e_(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Ut("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rM{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new an,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new k2(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sM{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Q($.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const a=re(s),o={documents:i.map(m=>_c(a.serializer,m))},c=await a.Lo("BatchGetDocuments",a.serializer.databaseId,Ke.emptyPath(),o,i.length),d=new Map;c.forEach(m=>{const p=wD(a.serializer,m);d.set(p.key.toString(),p)});const h=[];return i.forEach(m=>{const p=d.get(m.toString());fe(!!p),h.push(p)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Bo(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=ie.fromPath(r);this.mutations.push(new Rg(s,this.precondition(s)))}),await async function(r,s){const i=re(r),a={writes:s.map(o=>wc(i.serializer,o))};await i.Mo("Commit",i.serializer.databaseId,Ke.emptyPath(),a)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw de();t=Te.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new Q($.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Te.min())?Tt.exists(!1):Tt.updateTime(t):Tt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Te.min()))throw new Q($.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Tt.updateTime(t)}return Tt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iM{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Gg(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new sM(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Lc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!NT(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aM{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=rn.UNAUTHENTICATED,this.clientId=$E.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{K("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(K("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new an;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Ho(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Lm(n,e){n.asyncQueue.verifyOperationInProgress(),K("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await aI(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function t_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await ly(n);K("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Gx(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Gx(e.remoteStore,s)),n._onlineComponents=e}async function ly(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){K("FirestoreClient","Using user provided OfflineComponentProvider");try{await Lm(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===$.FAILED_PRECONDITION||s.code===$.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;mr("Error using user provided cache. Falling back to memory cache: "+t),await Lm(n,new fi)}}else K("FirestoreClient","Using default OfflineComponentProvider"),await Lm(n,new fi);return n._offlineComponents}async function Vh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(K("FirestoreClient","Using user provided OnlineComponentProvider"),await t_(n,n._uninitializedComponentsProvider._online)):(K("FirestoreClient","Using default OnlineComponentProvider"),await t_(n,new pi))),n._onlineComponents}function NI(n){return ly(n).then(e=>e.persistence)}function Go(n){return ly(n).then(e=>e.localStore)}function PI(n){return Vh(n).then(e=>e.remoteStore)}function cy(n){return Vh(n).then(e=>e.syncEngine)}function kI(n){return Vh(n).then(e=>e.datastore)}async function Ao(n){const e=await Vh(n),t=e.eventManager;return t.onListen=V2.bind(null,e.syncEngine),t.onUnlisten=O2.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=L2.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=F2.bind(null,e.syncEngine),t}function oM(n){return n.asyncQueue.enqueue(async()=>{const e=await NI(n),t=await PI(n);return e.setNetworkEnabled(!0),function(s){const i=re(s);return i.L_.delete(0),Wc(i)}(t)})}function lM(n){return n.asyncQueue.enqueue(async()=>{const e=await NI(n),t=await PI(n);return e.setNetworkEnabled(!1),async function(s){const i=re(s);i.L_.add(0),await zo(i),i.q_.set("Offline")}(t)})}function cM(n,e){const t=new an;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,a){try{const o=await function(d,h){const m=re(d);return m.persistence.runTransaction("read document","readonly",p=>m.localDocuments.getDocument(p,h))}(s,i);o.isFoundDocument()?a.resolve(o):o.isNoDocument()?a.resolve(null):a.reject(new Q($.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(o){const c=Ho(o,`Failed to get document '${i} from cache`);a.reject(c)}}(await Go(n),e,t)),t.promise}function RI(n,e,t={}){const r=new an;return n.asyncQueue.enqueueAndForget(async()=>function(i,a,o,c,d){const h=new Mh({next:p=>{h.Za(),a.enqueueAndForget(()=>Zg(i,m));const y=p.docs.has(o);!y&&p.fromCache?d.reject(new Q($.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&p.fromCache&&c&&c.source==="server"?d.reject(new Q($.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(p)},error:p=>d.reject(p)}),m=new ty($o(o.path),h,{includeMetadataChanges:!0,_a:!0});return Xg(i,m)}(await Ao(n),n.asyncQueue,e,t,r)),r.promise}function uM(n,e){const t=new an;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,a){try{const o=await Yd(s,i,!0),c=new EI(i,o.Ts),d=c.ma(o.documents),h=c.applyChanges(d,!1);a.resolve(h.snapshot)}catch(o){const c=Ho(o,`Failed to execute query '${i} against cache`);a.reject(c)}}(await Go(n),e,t)),t.promise}function jI(n,e,t={}){const r=new an;return n.asyncQueue.enqueueAndForget(async()=>function(i,a,o,c,d){const h=new Mh({next:p=>{h.Za(),a.enqueueAndForget(()=>Zg(i,m)),p.fromCache&&c.source==="server"?d.reject(new Q($.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(p)},error:p=>d.reject(p)}),m=new ty(o,h,{includeMetadataChanges:!0,_a:!0});return Xg(i,m)}(await Ao(n),n.asyncQueue,e,t,r)),r.promise}function dM(n,e,t){const r=new an;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await kI(n);r.resolve(async function(a,o,c){var d;const h=re(a),{request:m,ut:p,parent:y}=UT(h.serializer,hT(o),c);h.connection.Fo||delete m.parent;const E=(await h.Lo("RunAggregationQuery",h.serializer.databaseId,y,m,1)).filter(I=>!!I.result);fe(E.length===1);const v=(d=E[0].result)===null||d===void 0?void 0:d.aggregateFields;return Object.keys(v).reduce((I,_)=>(I[p[_]]=v[_],I),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function hM(n,e){const t=new Mh(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){re(s).Y_.add(i),i.next()}(await Ao(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){re(s).Y_.delete(i)}(await Ao(n),t))}}function mM(n,e,t,r){const s=function(a,o){let c;return c=typeof a=="string"?kT().encode(a):a,function(h,m){return new rM(h,m)}(function(h,m){if(h instanceof Uint8Array)return e_(h,m);if(h instanceof ArrayBuffer)return e_(new Uint8Array(h),m);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),o)}(t,qc(e));n.asyncQueue.enqueueAndForget(async()=>{tM(await cy(n),s,r)})}function fM(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=re(r);return i.persistence.runTransaction("Get named query","readonly",a=>i.Gr.getNamedQuery(a,s))}(await Go(n),e))}function pM(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=re(r),a=i.indexManager,o=[];return i.persistence.runTransaction("Configure indexes","readwrite",c=>a.getFieldIndexes(c).next(d=>function(m,p,y,E,v){m=[...m],p=[...p],m.sort(y),p.sort(y);const I=m.length,_=p.length;let x=0,C=0;for(;x<_&&C<I;){const R=y(m[C],p[x]);R<0?v(m[C++]):R>0?E(p[x++]):(x++,C++)}for(;x<_;)E(p[x++]);for(;C<I;)v(m[C++])}(d,s,xj,h=>{o.push(a.addFieldIndex(c,h))},h=>{o.push(a.deleteFieldIndex(c,h))})).next(()=>O.waitFor(o)))}(await Go(n),e))}function gM(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){re(r).ss.zi=s}(await Go(n),e))}function yM(n){return n.asyncQueue.enqueue(async()=>function(t){const r=re(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Go(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DI(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uy(n,e,t){if(!t)throw new Q($.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function vM(n,e,t,r){if(e===!0&&r===!0)throw new Q($.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function r_(n){if(!ie.isDocumentKey(n))throw new Q($.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function s_(n){if(ie.isDocumentKey(n))throw new Q($.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Lh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":de()}function We(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Q($.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Lh(n);throw new Q($.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function MI(n,e){if(e<=0)throw new Q($.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i_{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Q($.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Q($.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}vM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=DI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Q($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Q($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Q($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Hc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new i_({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Q($.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Q($.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new i_(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new dj;switch(r.type){case"firstParty":return new pj(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Q($.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=n_.get(t);r&&(K("ComponentProvider","Removing Datastore"),n_.delete(t),r.terminate())}(this),Promise.resolve()}}function xM(n,e,t,r={}){var s;const i=(n=We(n,Hc))._getSettings(),a=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==a&&mr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:a,ssl:!1})),r.mockUserToken){let o,c;if(typeof r.mockUserToken=="string")o=r.mockUserToken,c=rn.MOCK_USER;else{o=IN(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new Q($.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new rn(d)}n._authCredentials=new hj(new OE(o,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new gn(this.firestore,e,this._query)}}class qt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new zr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new qt(this.firestore,e,this._key)}}class zr extends gn{constructor(e,t,r){super(e,t,$o(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new qt(this.firestore,null,new ie(e))}withConverter(e){return new zr(this.firestore,e,this._path)}}function ft(n,e,...t){if(n=lt(n),uy("collection","path",e),n instanceof Hc){const r=Ke.fromString(e,...t);return s_(r),new zr(n,null,r)}{if(!(n instanceof qt||n instanceof zr))throw new Q($.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ke.fromString(e,...t));return s_(r),new zr(n.firestore,null,r)}}function ZV(n,e){if(n=We(n,Hc),uy("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Q($.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new gn(n,null,function(r){return new ws(Ke.emptyPath(),r)}(e))}function Ze(n,e,...t){if(n=lt(n),arguments.length===1&&(e=$E.newId()),uy("doc","path",e),n instanceof Hc){const r=Ke.fromString(e,...t);return r_(r),new qt(n,null,new ie(r))}{if(!(n instanceof qt||n instanceof zr))throw new Q($.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ke.fromString(e,...t));return r_(r),new qt(n.firestore,n instanceof zr?n.converter:null,new ie(r))}}function eL(n,e){return n=lt(n),e=lt(e),(n instanceof qt||n instanceof zr)&&(e instanceof qt||e instanceof zr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function VI(n,e){return n=lt(n),e=lt(e),n instanceof gn&&e instanceof gn&&n.firestore===e.firestore&&Fc(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a_{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Gg(this,"async_queue_retry"),this.Vu=()=>{const r=id();r&&K("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=id();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=id();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new an;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!bi(e))throw e;K("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(a){let o=a.message||"";return a.stack&&(o=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),o}(r);throw Ut("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Jg.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&de()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function dp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class _M{constructor(){this._progressObserver={},this._taskCompletionResolver=new an,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tL=-1;class ut extends Hc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new a_,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new a_(e),this._firestoreClient=void 0,await e}}}function nL(n,e,t){t||(t="(default)");const r=Rc(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(li(i,e))return s;throw new Q($.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new Q($.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Q($.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function wM(n,e){const t=typeof n=="object"?n:Gb(),r=typeof n=="string"?n:e||"(default)",s=Rc(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=EN("firestore");i&&xM(s,...i)}return s}function Rt(n){if(n._terminated)throw new Q($.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||LI(n),n._firestoreClient}function LI(n){var e,t,r;const s=n._freezeSettings(),i=function(o,c,d,h){return new Wj(o,c,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,DI(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new aM(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(o){const c=o==null?void 0:o._online.build();return{_offline:o==null?void 0:o._offline.build(c),_online:c}}(n._componentsProvider))}function rL(n,e){mr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return OI(n,pi.provider,{build:r=>new oy(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function sL(n){mr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();OI(n,pi.provider,{build:t=>new AI(t,e.cacheSizeBytes)})}function OI(n,e,t){if((n=We(n,ut))._firestoreClient||n._terminated)throw new Q($.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new Q($.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},LI(n)}function iL(n){if(n._initialized&&!n._terminated)throw new Q($.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new an;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Ur.D())return Promise.resolve();const s=r+"main";await Ur.delete(s)}(qg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function aL(n){return function(t){const r=new an;return t.asyncQueue.enqueueAndForget(async()=>q2(await cy(t),r)),r.promise}(Rt(n=We(n,ut)))}function oL(n){return oM(Rt(n=We(n,ut)))}function lL(n){return lM(Rt(n=We(n,ut)))}function cL(n){return VP(n.app,"firestore",n._databaseId.database),n._delete()}function uL(n,e){const t=Rt(n=We(n,ut)),r=new _M;return mM(t,n._databaseId,e,r),r}function dL(n,e){return fM(Rt(n=We(n,ut)),e).then(t=>t?new gn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bc{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class bM{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e){this._byteString=e}static fromBase64String(e){try{return new da(Lt.fromBase64String(e))}catch(t){throw new Q($.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new da(Lt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Q($.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Et(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function hL(){return new pa("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Q($.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Q($.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Re(this._lat,e._lat)||Re(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EM=/^__.*__$/;class TM{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Es(e,this.data,this.fieldMask,t,this.fieldTransforms):new Uo(e,this.data,t,this.fieldTransforms)}}class FI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Es(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function $I(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw de()}}class Fh{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Fh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return eh(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if($I(this.Cu)&&EM.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class IM{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||qc(e)}Qu(e,t,r,s=!1){return new Fh({Cu:e,methodName:t,qu:r,path:Et.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ya(n){const e=n._freezeSettings(),t=qc(n._databaseId);return new IM(n._databaseId,!!e.ignoreUndefinedProperties,t)}function $h(n,e,t,r,s,i={}){const a=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);vy("Data must be an object, but it was:",a,r);const o=zI(r,a);let c,d;if(i.merge)c=new Hn(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const h=[];for(const m of i.mergeFields){const p=Ec(e,m,t);if(!a.contains(p))throw new Q($.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);WI(h,p)||h.push(p)}c=new Hn(h),d=a.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,d=a.fieldTransforms;return new TM(new mn(o),c,d)}class Gc extends ga{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Gc}}function UI(n,e,t){return new Fh({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class hy extends ga{_toFieldTransform(e){return new Uc(e.path,new _o)}isEqual(e){return e instanceof hy}}class my extends ga{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=UI(this,e,!0),r=this.Ku.map(i=>va(i,t)),s=new aa(r);return new Uc(e.path,s)}isEqual(e){return e instanceof my&&li(this.Ku,e.Ku)}}class fy extends ga{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=UI(this,e,!0),r=this.Ku.map(i=>va(i,t)),s=new oa(r);return new Uc(e.path,s)}isEqual(e){return e instanceof fy&&li(this.Ku,e.Ku)}}class py extends ga{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new wo(e.serializer,wT(e.serializer,this.$u));return new Uc(e.path,t)}isEqual(e){return e instanceof py&&this.$u===e.$u}}function gy(n,e,t,r){const s=n.Qu(1,e,t);vy("Data must be an object, but it was:",s,r);const i=[],a=mn.empty();Ei(r,(c,d)=>{const h=Uh(e,c,t);d=lt(d);const m=s.Nu(h);if(d instanceof Gc)i.push(h);else{const p=va(d,m);p!=null&&(i.push(h),a.set(h,p))}});const o=new Hn(i);return new FI(a,o,s.fieldTransforms)}function yy(n,e,t,r,s,i){const a=n.Qu(1,e,t),o=[Ec(e,r,t)],c=[s];if(i.length%2!=0)throw new Q($.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)o.push(Ec(e,i[p])),c.push(i[p+1]);const d=[],h=mn.empty();for(let p=o.length-1;p>=0;--p)if(!WI(d,o[p])){const y=o[p];let E=c[p];E=lt(E);const v=a.Nu(y);if(E instanceof Gc)d.push(y);else{const I=va(E,v);I!=null&&(d.push(y),h.set(y,I))}}const m=new Hn(d);return new FI(h,m,a.fieldTransforms)}function BI(n,e,t,r=!1){return va(t,n.Qu(r?4:3,e))}function va(n,e){if(qI(n=lt(n)))return vy("Unsupported field value:",e,n),zI(n,e);if(n instanceof ga)return function(r,s){if(!$I(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let a=0;for(const o of r){let c=va(o,s.Lu(a));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),a++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=lt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return wT(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Pt.fromDate(r);return{timestampValue:bo(s.serializer,i)}}if(r instanceof Pt){const i=new Pt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:bo(s.serializer,i)}}if(r instanceof dy)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof da)return{bytesValue:DT(s.serializer,r._byteString)};if(r instanceof qt){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Lg(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Oh)return function(a,o){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(c=>{if(typeof c!="number")throw o.Bu("VectorValues must only contain numeric values.");return kg(o.serializer,c)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Lh(r)}`)}(n,e)}function zI(n,e){const t={};return ZE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ei(n,(r,s)=>{const i=va(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function qI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Pt||n instanceof dy||n instanceof da||n instanceof qt||n instanceof ga||n instanceof Oh)}function vy(n,e,t){if(!qI(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Lh(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Ec(n,e,t){if((e=lt(e))instanceof pa)return e._internalPath;if(typeof e=="string")return Uh(n,e);throw eh("Field path arguments must be of type string or ",n,!1,void 0,t)}const SM=new RegExp("[~\\*/\\[\\]]");function Uh(n,e,t){if(e.search(SM)>=0)throw eh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new pa(...e.split("."))._internalPath}catch{throw eh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function eh(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let o=`Function ${e}() called with invalid data`;t&&(o+=" (via `toFirestore()`)"),o+=". ";let c="";return(i||a)&&(c+=" (found",i&&(c+=` in field ${r}`),a&&(c+=` in document ${s}`),c+=")"),new Q($.INVALID_ARGUMENT,o+n+c)}function WI(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tc{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new qt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new CM(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Bh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class CM extends Tc{data(){return super.data()}}function Bh(n,e){return typeof e=="string"?Uh(n,e):e instanceof pa?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Q($.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class xy{}class Kc extends xy{}function on(n,e,...t){let r=[];e instanceof xy&&r.push(e),r=r.concat(t),function(i){const a=i.filter(c=>c instanceof Ko).length,o=i.filter(c=>c instanceof Qc).length;if(a>1||a>0&&o>0)throw new Q($.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Qc extends Kc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Qc(e,t,r)}_apply(e){const t=this._parse(e);return KI(e._query,t),new gn(e.firestore,e.converter,Zf(e._query,t))}_parse(e){const t=ya(e.firestore);return function(i,a,o,c,d,h,m){let p;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new Q($.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){l_(m,h);const y=[];for(const E of m)y.push(o_(c,i,E));p={arrayValue:{values:y}}}else p=o_(c,i,m)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||l_(m,h),p=BI(o,a,m,h==="in"||h==="not-in");return Qe.create(d,h,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Gt(n,e,t){const r=e,s=Bh("where",n);return Qc._create(s,r,t)}class Ko extends xy{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ko(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:rt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let a=s;const o=i.getFlattenedFilters();for(const c of o)KI(a,c),a=Zf(a,c)}(e._query,t),new gn(e.firestore,e.converter,Zf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function mL(...n){return n.forEach(e=>QI("or",e)),Ko._create("or",n)}function fL(...n){return n.forEach(e=>QI("and",e)),Ko._create("and",n)}class _y extends Kc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new _y(e,t)}_apply(e){const t=function(s,i,a){if(s.startAt!==null)throw new Q($.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Q($.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new xc(i,a)}(e._query,this._field,this._direction);return new gn(e.firestore,e.converter,function(s,i){const a=s.explicitOrderBy.concat([i]);return new ws(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function pL(n,e="asc"){const t=e,r=Bh("orderBy",n);return _y._create(r,t)}class zh extends Kc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new zh(e,t,r)}_apply(e){return new gn(e.firestore,e.converter,qd(e._query,this._limit,this._limitType))}}function AM(n){return MI("limit",n),zh._create("limit",n,"F")}function gL(n){return MI("limitToLast",n),zh._create("limitToLast",n,"L")}class qh extends Kc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new qh(e,t,r)}_apply(e){const t=GI(e,this.type,this._docOrFields,this._inclusive);return new gn(e.firestore,e.converter,function(s,i){return new ws(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function yL(...n){return qh._create("startAt",n,!0)}function vL(...n){return qh._create("startAfter",n,!1)}class Wh extends Kc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Wh(e,t,r)}_apply(e){const t=GI(e,this.type,this._docOrFields,this._inclusive);return new gn(e.firestore,e.converter,function(s,i){return new ws(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function xL(...n){return Wh._create("endBefore",n,!1)}function _L(...n){return Wh._create("endAt",n,!0)}function GI(n,e,t,r){if(t[0]=lt(t[0]),t[0]instanceof Tc)return function(i,a,o,c,d){if(!c)throw new Q($.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const h=[];for(const m of so(i))if(m.field.isKeyField())h.push(sa(a,c.key));else{const p=c.data.field(m.field);if(Th(p))throw new Q($.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){const y=m.field.canonicalString();throw new Q($.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(p)}return new hi(h,d)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=ya(n.firestore);return function(a,o,c,d,h,m){const p=a.explicitOrderBy;if(h.length>p.length)throw new Q($.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let E=0;E<h.length;E++){const v=h[E];if(p[E].field.isKeyField()){if(typeof v!="string")throw new Q($.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof v}`);if(!Ng(a)&&v.indexOf("/")!==-1)throw new Q($.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${v}' contains a slash.`);const I=a.path.child(Ke.fromString(v));if(!ie.isDocumentKey(I))throw new Q($.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${I}' is not because it contains an odd number of segments.`);const _=new ie(I);y.push(sa(o,_))}else{const I=BI(c,d,v);y.push(I)}}return new hi(y,m)}(n._query,n.firestore._databaseId,s,e,t,r)}}function o_(n,e,t){if(typeof(t=lt(t))=="string"){if(t==="")throw new Q($.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ng(e)&&t.indexOf("/")!==-1)throw new Q($.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Ke.fromString(t));if(!ie.isDocumentKey(r))throw new Q($.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return sa(n,new ie(r))}if(t instanceof qt)return sa(n,t._key);throw new Q($.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Lh(t)}.`)}function l_(n,e){if(!Array.isArray(n)||n.length===0)throw new Q($.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function KI(n,e){const t=function(s,i){for(const a of s)for(const o of a.getFlattenedFilters())if(i.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Q($.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Q($.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function QI(n,e){if(!(e instanceof Qc||e instanceof Ko))throw new Q($.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class YI{convertValue(e,t="none"){switch(ui(e)){case 0:return null;case 1:return e.booleanValue;case 2:return wt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ps(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw de()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Ei(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(a=>wt(a.doubleValue));return new Oh(i)}convertGeoPoint(e){return new dy(wt(e.latitude),wt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ih(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(gc(e));default:return null}}convertTimestamp(e){const t=fs(e);return new Pt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ke.fromString(e);fe(WT(r));const s=new ra(r.get(1),r.get(3)),i=new ie(r.popFirst(5));return s.isEqual(t)||Ut(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class NM extends YI{constructor(e){super(),this.firestore=e}convertBytes(e){return new da(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new qt(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wL(n){return new bc("sum",Ec("sum",n))}function bL(n){return new bc("avg",Ec("average",n))}function PM(){return new bc("count")}function EL(n,e){var t,r;return n instanceof bc&&e instanceof bc&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function TL(n,e){return VI(n.query,e.query)&&li(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class No extends Tc{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ad(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Bh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class ad extends No{data(e={}){return super.data(e)}}class Po{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new qi(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ad(this._firestore,this._userDataWriter,r.key,r,new qi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Q($.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(o=>{const c=new ad(s._firestore,s._userDataWriter,o.doc.key,o.doc,new qi(s._snapshot.mutatedKeys.has(o.doc.key),s._snapshot.fromCache),s.query.converter);return o.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(o=>i||o.type!==3).map(o=>{const c=new ad(s._firestore,s._userDataWriter,o.doc.key,o.doc,new qi(s._snapshot.mutatedKeys.has(o.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,h=-1;return o.type!==0&&(d=a.indexOf(o.doc.key),a=a.delete(o.doc.key)),o.type!==1&&(a=a.add(o.doc),h=a.indexOf(o.doc.key)),{type:kM(o.type),doc:c,oldIndex:d,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function kM(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return de()}}function IL(n,e){return n instanceof No&&e instanceof No?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Po&&e instanceof Po&&n._firestore===e._firestore&&VI(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kn(n){n=We(n,qt);const e=We(n.firestore,ut);return RI(Rt(e),n._key).then(t=>wy(e,n,t))}class Ii extends YI{constructor(e){super(),this.firestore=e}convertBytes(e){return new da(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new qt(this.firestore,null,t)}}function SL(n){n=We(n,qt);const e=We(n.firestore,ut),t=Rt(e),r=new Ii(e);return cM(t,n._key).then(s=>new No(e,r,n._key,s,new qi(s!==null&&s.hasLocalMutations,!0),n.converter))}function CL(n){n=We(n,qt);const e=We(n.firestore,ut);return RI(Rt(e),n._key,{source:"server"}).then(t=>wy(e,n,t))}function Pn(n){n=We(n,gn);const e=We(n.firestore,ut),t=Rt(e),r=new Ii(e);return HI(n._query),jI(t,n._query).then(s=>new Po(e,r,n,s))}function AL(n){n=We(n,gn);const e=We(n.firestore,ut),t=Rt(e),r=new Ii(e);return uM(t,n._query).then(s=>new Po(e,r,n,s))}function NL(n){n=We(n,gn);const e=We(n.firestore,ut),t=Rt(e),r=new Ii(e);return jI(t,n._query,{source:"server"}).then(s=>new Po(e,r,n,s))}function PL(n,e,t){n=We(n,qt);const r=We(n.firestore,ut),s=Hh(n.converter,e,t);return Jc(r,[$h(ya(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Tt.none())])}function jt(n,e,t,...r){n=We(n,qt);const s=We(n.firestore,ut),i=ya(s);let a;return a=typeof(e=lt(e))=="string"||e instanceof pa?yy(i,"updateDoc",n._key,e,t,r):gy(i,"updateDoc",n._key,e),Jc(s,[a.toMutation(n._key,Tt.exists(!0))])}function od(n){return Jc(We(n.firestore,ut),[new Bo(n._key,Tt.none())])}function Si(n,e){const t=We(n.firestore,ut),r=Ze(n),s=Hh(n.converter,e);return Jc(t,[$h(ya(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Tt.exists(!1))]).then(()=>r)}function Yc(n,...e){var t,r,s;n=lt(n);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||dp(e[a])||(i=e[a],a++);const o={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(dp(e[a])){const m=e[a];e[a]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[a+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[a+2]=(s=m.complete)===null||s===void 0?void 0:s.bind(m)}let c,d,h;if(n instanceof qt)d=We(n.firestore,ut),h=$o(n._key.path),c={next:m=>{e[a]&&e[a](wy(d,n,m))},error:e[a+1],complete:e[a+2]};else{const m=We(n,gn);d=We(m.firestore,ut),h=m._query;const p=new Ii(d);c={next:y=>{e[a]&&e[a](new Po(d,p,m,y))},error:e[a+1],complete:e[a+2]},HI(n._query)}return function(p,y,E,v){const I=new Mh(v),_=new ty(y,I,E);return p.asyncQueue.enqueueAndForget(async()=>Xg(await Ao(p),_)),()=>{I.Za(),p.asyncQueue.enqueueAndForget(async()=>Zg(await Ao(p),_))}}(Rt(d),h,o,c)}function kL(n,e){return hM(Rt(n=We(n,ut)),dp(e)?e:{next:e})}function Jc(n,e){return function(r,s){const i=new an;return r.asyncQueue.enqueueAndForget(async()=>$2(await cy(r),s,i)),i.promise}(Rt(n),e)}function wy(n,e,t){const r=t.docs.get(e._key),s=new Ii(n);return new No(n,s,e._key,r,new qi(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RL(n){return RM(n,{count:PM()})}function RM(n,e){const t=We(n.firestore,ut),r=Rt(t),s=XE(e,(i,a)=>new AT(a,i.aggregateType,i._internalFieldPath));return dM(r,n._query,s).then(i=>function(o,c,d){const h=new Ii(o);return new bM(c,h,d)}(t,n,i))}class jM{constructor(e){this.kind="memory",this._onlineComponentProvider=pi.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=fi.provider}toJSON(){return{kind:this.kind}}}class DM{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=FM(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class MM{constructor(){this.kind="memoryEager",this._offlineComponentProvider=fi.provider}toJSON(){return{kind:this.kind}}}class VM{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new nM(e)}}toJSON(){return{kind:this.kind}}}function jL(){return new MM}function DL(n){return new VM(n==null?void 0:n.cacheSizeBytes)}function ML(n){return new jM(n)}function VL(n){return new DM(n)}class LM{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=pi.provider,this._offlineComponentProvider={build:t=>new oy(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class OM{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=pi.provider,this._offlineComponentProvider={build:t=>new AI(t,e==null?void 0:e.cacheSizeBytes)}}}function FM(n){return new LM(n==null?void 0:n.forceOwnership)}function LL(){return new OM}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $M={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UM{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ya(e)}set(e,t,r){this._verifyNotCommitted();const s=zs(e,this._firestore),i=Hh(s.converter,t,r),a=$h(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(a.toMutation(s._key,Tt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=zs(e,this._firestore);let a;return a=typeof(t=lt(t))=="string"||t instanceof pa?yy(this._dataReader,"WriteBatch.update",i._key,t,r,s):gy(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(a.toMutation(i._key,Tt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=zs(e,this._firestore);return this._mutations=this._mutations.concat(new Bo(t._key,Tt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Q($.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function zs(n,e){if((n=lt(n)).firestore!==e)throw new Q($.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BM extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=ya(t)}get(t){const r=zs(t,this._firestore),s=new NM(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return de();const a=i[0];if(a.isFoundDocument())return new Tc(this._firestore,s,a.key,a,r.converter);if(a.isNoDocument())return new Tc(this._firestore,s,r._key,null,r.converter);throw de()})}set(t,r,s){const i=zs(t,this._firestore),a=Hh(i.converter,r,s),o=$h(this._dataReader,"Transaction.set",i._key,a,i.converter!==null,s);return this._transaction.set(i._key,o),this}update(t,r,s,...i){const a=zs(t,this._firestore);let o;return o=typeof(r=lt(r))=="string"||r instanceof pa?yy(this._dataReader,"Transaction.update",a._key,r,s,i):gy(this._dataReader,"Transaction.update",a._key,r),this._transaction.update(a._key,o),this}delete(t){const r=zs(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=zs(e,this._firestore),r=new Ii(this._firestore);return super.get(e).then(s=>new No(this._firestore,r,t._key,s._document,new qi(!1,!1),t.converter))}}function FL(n,e,t){n=We(n,ut);const r=Object.assign(Object.assign({},$M),t);return function(i){if(i.maxAttempts<1)throw new Q($.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,a,o){const c=new an;return i.asyncQueue.enqueueAndForget(async()=>{const d=await kI(i);new iM(i.asyncQueue,d,o,a,c).au()}),c.promise}(Rt(n),s=>e(new BM(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $L(){return new Gc("deleteField")}function ze(){return new hy("serverTimestamp")}function UL(...n){return new my("arrayUnion",n)}function BL(...n){return new fy("arrayRemove",n)}function zL(n){return new py("increment",n)}function qL(n){return new Oh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WL(n){return Rt(n=We(n,ut)),new UM(n,e=>Jc(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HL(n,e){const t=Rt(n=We(n,ut));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return mr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const a=typeof i=="string"?function(d){try{return JSON.parse(d)}catch(h){throw new Q($.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,o=[];if(Array.isArray(a.indexes))for(const c of a.indexes){const d=c_(c,"collectionGroup"),h=[];if(Array.isArray(c.fields))for(const m of c.fields){const p=Uh("setIndexConfiguration",c_(m,"fieldPath"));m.arrayConfig==="CONTAINS"?h.push(new Ki(p,2)):m.order==="ASCENDING"?h.push(new Ki(p,0)):m.order==="DESCENDING"&&h.push(new Ki(p,1))}o.push(new go(go.UNKNOWN_ID,d,h,yo.empty()))}return o}(e);return pM(t,r)}function c_(n,e){if(typeof n[e]!="string")throw new Q($.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zM{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function GL(n){var e;n=We(n,ut);const t=u_.get(n);if(t)return t;if(((e=Rt(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new zM(n);return u_.set(n,r),r}function KL(n){JI(n,!0)}function QL(n){JI(n,!1)}function YL(n){yM(Rt(n._firestore)).then(e=>K("deleting all persistent cache indexes succeeded")).catch(e=>mr("deleting all persistent cache indexes failed",e))}function JI(n,e){gM(Rt(n._firestore),e).then(t=>K(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>mr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const u_=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JL(n){var e;const t=(e=Rt(We(n.firestore,ut))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Nh(t,An(n._query))._t}function XL(n,e){var t;const r=XE(e,(i,a)=>new AT(a,i.aggregateType,i._internalFieldPath)),s=(t=Rt(We(n.firestore,ut))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:UT(s,hT(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZL{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return by.instance.onExistenceFilterMismatch(e)}}class by{constructor(){this.Uu=new Map}static get instance(){return Du||(Du=new by,function(t){if(Wd)throw new Error("a TestingHooksSpi instance is already set");Wd=t}(Du)),Du}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Du=null;(function(e,t=!0){(function(s){Fo=s})(Lo),fo(new ea("firestore",(r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),o=new ut(new mj(r.getProvider("auth-internal")),new gj(r.getProvider("app-check-internal")),function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new Q($.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ra(d.options.projectId,h)}(a,s),a);return i=Object.assign({useFetchStreams:t},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),ii(Z0,"4.7.3",e),ii(Z0,"4.7.3","esm2017")})();const qM={apiKey:"AIzaSyB_1Dn63ZHRnA-jXytu95WEBWNFQ64Jo_E",authDomain:"dnd-v1-17acc.firebaseapp.com",projectId:"dnd-v1-17acc",storageBucket:"dnd-v1-17acc.firebasestorage.app",messagingSenderId:"976056329393",appId:"1:976056329393:web:7c8170e906162fe4ef2e90"},XI=Hb(qM),Wr=oj(XI),Ie=wM(XI),WM=n=>{console.warn("Firestore connection issue:",n)},HM=Object.freeze(Object.defineProperty({__proto__:null,auth:Wr,db:Ie,handleFirestoreError:WM},Symbol.toStringTag,{value:"Module"})),GM=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),De=(n,e)=>{throw console.error(`Error in ${e}:`,n),n.code==="unavailable"||n.code==="deadline-exceeded"?new Error("Network connection issue. Please check your internet connection and try again."):n.code==="permission-denied"?new Error("Access denied. Please check your permissions."):n.code==="not-found"?new Error("The requested data was not found."):new Error(`Database error: ${n.message}`)},ZI=async(n,e)=>{try{const t={...e,userId:n,createdAt:ze(),updatedAt:ze()};return{id:(await Si(ft(Ie,"userProfiles"),t)).id,...t}}catch(t){De(t,"createUserProfile")}},Qo=async n=>{try{const e=on(ft(Ie,"userProfiles"),Gt("userId","==",n)),t=await Pn(e);if(t.empty)return null;const r=t.docs[0];return{id:r.id,...r.data()}}catch(e){De(e,"getUserProfile")}},hp=async n=>{try{if(!n||n.length===0)return[];const e=[];for(let s=0;s<n.length;s+=10){const i=n.slice(s,s+10),a=on(ft(Ie,"userProfiles"),Gt("userId","in",i));e.push(Pn(a))}const t=await Promise.all(e),r=[];return t.forEach(s=>{s.docs.forEach(i=>{r.push({id:i.id,...i.data()})})}),r}catch(e){De(e,"getUserProfiles")}},KM=async(n,e)=>{try{const t=await Qo(n);if(!t)throw new Error("User profile not found");const r=Ze(Ie,"userProfiles",t.id);await jt(r,{...e,updatedAt:ze()})}catch(t){De(t,"updateUserProfile")}},eS=async n=>{try{const e=on(ft(Ie,"userProfiles"),Gt("username","==",n));return(await Pn(e)).empty}catch(e){De(e,"checkUsernameAvailability")}},Ey=n=>{const{class:e,level:t,constitution:r,dexterity:s,strength:i}=n,o={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[e]||8,c=Math.floor((r-10)/2),d=Math.max(1,(o+c)*t),h=10,m=Math.floor((s-10)/2),y={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[e]||0,E=h+m+y;return{hp:Math.max(1,d),maxHp:Math.max(1,d),ac:Math.max(10,E)}},tS=async(n,e,t)=>{try{const r=ft(Ie,"characters"),s=Ey(t),i={...t,...s,userId:n,partyId:e,createdAt:new Date,updatedAt:new Date};return{id:(await Si(r,i)).id,...i}}catch(r){throw new Error(`Failed to save character: ${r.message}`)}},Wl=async n=>{try{const e=ft(Ie,"characters"),t=on(e,Gt("userId","==",n));return(await Pn(t)).docs.map(i=>({id:i.id,...i.data()}))}catch(e){throw new Error(`Failed to get user characters: ${e.message}`)}},nS=async(n,e)=>{try{const t=ft(Ie,"characters"),r=on(t,Gt("userId","==",n),Gt("partyId","==",e)),s=await Pn(r);if(s.empty)return null;const i=s.docs[0];return{id:i.id,...i.data()}}catch(t){throw new Error(`Failed to get character: ${t.message}`)}},ko=async n=>{try{const e=on(ft(Ie,"characters"),Gt("partyId","==",n));return(await Pn(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){De(e,"getPartyCharacters")}},QM=async(n,e)=>{try{const t=Ze(Ie,"characters",n),r=await kn(t);if(!r.exists())throw new Error(`Character document with ID ${n} does not exist`);const s=r.data(),i={...e,updatedAt:new Date};if(e.class||e.level||e.constitution||e.dexterity||e.strength||e.wisdom){const o={...s,...e},c=Ey(o);Object.assign(i,c)}return await jt(t,i),{id:n,...s,...i}}catch(t){throw t}},th=async n=>{try{const e=Ze(Ie,"characters",n);return await od(e),!0}catch(e){throw new Error(`Failed to delete character: ${e.message}`)}},rS=async n=>{try{console.log("Debugging characters for user:",n);const e=on(ft(Ie,"characters"),Gt("userId","==",n)),r=(await Pn(e)).docs.map(a=>({id:a.id,...a.data()}));console.log("All characters for user:",r);const s=r.filter(a=>!a.partyId);s.length>0&&console.warn("Found characters without partyId:",s);const i={};return r.forEach(a=>{a.partyId&&(i[a.partyId]||(i[a.partyId]=[]),i[a.partyId].push(a))}),Object.entries(i).forEach(([a,o])=>{o.length>1&&console.warn(`Multiple characters found for party ${a}:`,o)}),{totalCharacters:r.length,orphanedCharacters:s.length,partyGroups:i}}catch(e){throw console.error("Error debugging characters:",e),e}},sS=async n=>{try{const t=(await Wl(n)).filter(s=>!s.partyId);if(t.length===0)return{deleted:0};const r=t.map(s=>th(s.id));return await Promise.all(r),{deleted:t.length}}catch(e){throw new Error(`Failed to cleanup orphaned characters: ${e.message}`)}},Ty=async(n,e)=>{try{const t={...e,dmId:n,members:[n],createdAt:ze(),updatedAt:ze()};return{id:(await Si(ft(Ie,"parties"),t)).id,...t}}catch(t){De(t,"createParty")}},Iy=async n=>{try{const e=on(ft(Ie,"parties"),Gt("members","array-contains",n));return(await Pn(e)).docs.map(s=>{const i=s.data();return{id:s.id,...i}})}catch(e){De(e,"getUserParties")}},iS=async()=>{try{const n=on(ft(Ie,"parties"),Gt("isPublic","==",!0));return(await Pn(n)).docs.map(r=>{const s=r.data();return{id:r.id,...s}}).sort((r,s)=>{var o,c,d,h;const i=((c=(o=r.createdAt)==null?void 0:o.toDate)==null?void 0:c.call(o))||r.createdAt||new Date(0);return(((h=(d=s.createdAt)==null?void 0:d.toDate)==null?void 0:h.call(d))||s.createdAt||new Date(0))-i})}catch(n){De(n,"getPublicParties")}},mp=async(n,e)=>{try{const t=Ze(Ie,"parties",n),r=await kn(t);if(!r.exists())throw new Error("Party not found");const s=r.data();if(s.members.includes(e))throw new Error("User already in party");await jt(t,{members:[...s.members,e],updatedAt:ze()})}catch(t){De(t,"joinParty")}},Sy=async(n,e)=>{try{const t=Ze(Ie,"parties",n),r=await kn(t);if(!r.exists())throw new Error("Party not found");if(r.data().dmId!==e)throw new Error("Only the party leader can disband the party");await od(t);const i=on(ft(Ie,"characters"),Gt("partyId","==",n)),o=(await Pn(i)).docs.map(m=>od(m.ref));await Promise.all(o);const c=on(ft(Ie,"campaignStories"),Gt("partyId","==",n)),h=(await Pn(c)).docs.map(m=>od(m.ref));await Promise.all(h)}catch(t){De(t,"disbandParty")}},aS=async n=>{try{const e=on(ft(Ie,"parties"),Gt("inviteCode","==",n)),t=await Pn(e);if(t.empty)return null;const r=t.docs[0];return{id:r.id,...r.data()}}catch(e){De(e,"getPartyByInviteCode")}},oS=async n=>{try{const e=Ze(Ie,"parties",n),t=await kn(e);return t.exists()?{id:t.id,...t.data()}:null}catch(e){De(e,"getPartyById")}},YM=async(n,e)=>{try{const t={...e,partyId:n,createdAt:ze(),updatedAt:ze()};return{id:(await Si(ft(Ie,"campaigns"),t)).id,...t}}catch(t){De(t,"saveCampaign")}},JM=async n=>{try{const e=on(ft(Ie,"campaigns"),Gt("partyId","==",n)),t=await Pn(e);if(t.empty)return null;const r=t.docs[0];return{id:r.id,...r.data()}}catch(e){De(e,"getCampaignByParty")}},XM=async(n,e)=>{try{const t=Ze(Ie,"campaigns",n);await jt(t,{...e,updatedAt:ze()})}catch(t){De(t,"updateCampaign")}},ZM=async(n,e)=>{try{const t={...e,partyId:n,status:"active",createdAt:ze(),updatedAt:ze()};return{id:(await Si(ft(Ie,"combats"),t)).id,...t}}catch(t){De(t,"saveCombat")}},eV=async n=>{try{const e=on(ft(Ie,"combats"),Gt("partyId","==",n),Gt("status","==","active")),t=await Pn(e);return t.empty?null:t.docs.map(i=>({id:i.id,...i.data()})).sort((i,a)=>{var d,h,m,p;const o=((h=(d=i.createdAt)==null?void 0:d.toDate)==null?void 0:h.call(d))||i.createdAt||new Date(0);return(((p=(m=a.createdAt)==null?void 0:m.toDate)==null?void 0:p.call(m))||a.createdAt||new Date(0))-o})[0]}catch(e){De(e,"getActiveCombat")}},tV=async(n,e)=>{try{const t=Ze(Ie,"combats",n);await jt(t,{...e,updatedAt:ze()})}catch(t){De(t,"updateCombat")}},lS=(n,e)=>{const t=Ze(Ie,"parties",n);return Yc(t,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})},nV=(n,e)=>{const t=on(ft(Ie,"campaigns"),Gt("partyId","==",n));return Yc(t,r=>{if(r.empty)e(null);else{const s=r.docs[0];e({id:s.id,...s.data()})}})},rV=(n,e)=>{const t=on(ft(Ie,"combats"),Gt("partyId","==",n),Gt("status","==","active"));return Yc(t,r=>{if(r.empty)e(null);else{const s=r.docs[0];e({id:s.id,...s.data()})}})},cS=async n=>{try{const e={partyId:n,status:"ready_up",currentPlot:null,storyMessages:[],votingSession:null,readyPlayers:[],lastUpdated:ze(),createdAt:ze()};return{id:(await Si(ft(Ie,"campaignStories"),e)).id,...e}}catch(e){De(e,"createCampaignStory")}},uS=async n=>{try{const e=on(ft(Ie,"campaignStories"),Gt("partyId","==",n)),t=await Pn(e);if(t.empty)return null;const r=t.docs[0];return{id:r.id,...r.data()}}catch(e){De(e,"getCampaignStory")}},Tn=async(n,e)=>{try{const t=Ze(Ie,"campaignStories",n);await jt(t,{...e,lastUpdated:ze()})}catch(t){De(t,"updateCampaignStory")}},sV=async(n,e)=>{try{const t=Ze(Ie,"campaignStories",n),s=(await kn(t)).data(),i={id:`msg_${Date.now()}`,...e,timestamp:new Date};return await jt(t,{storyMessages:[...s.storyMessages,i],lastUpdated:ze()}),i}catch(t){De(t,"addStoryMessage")}},dS=async(n,e)=>{try{const t=Ze(Ie,"campaignStories",n),i=(await kn(t)).data().readyPlayers||[];i.includes(e)||await jt(t,{readyPlayers:[...i,e],lastUpdated:ze()})}catch(t){De(t,"setPlayerReady")}},hS=(n,e)=>{try{const t=Ze(Ie,"campaignStories",n);return Yc(t,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})}catch(t){De(t,"subscribeToCampaignStory")}},mS=async(n,e)=>{try{const t=Ze(Ie,"campaignStories",n);await jt(t,{currentSpeaker:e,lastUpdated:ze()})}catch(t){De(t,"setCurrentSpeaker")}},iV=async(n,e)=>{try{const t=Ze(Ie,"campaignStories",n);await jt(t,{currentController:e,lastUpdated:ze()})}catch(t){De(t,"setCurrentController")}},aV=async(n,e)=>{try{const t={partyId:n,status:"active",storyContext:e.storyContext,partyMembers:e.partyMembers,enemies:e.enemies,combatants:e.combatants,initiative:e.initiative,currentTurn:e.currentTurn||0,round:e.round||1,combatState:e.combatState||"active",environmentalFeatures:e.environmentalFeatures,teamUpOpportunities:e.teamUpOpportunities,narrativeElements:e.narrativeElements,battleLog:e.battleLog||[],createdAt:ze(),updatedAt:ze()};return{id:(await Si(ft(Ie,"combatSessions"),t)).id,...t}}catch(t){De(t,"createCombatSession")}},fS=async n=>{try{const e=Ze(Ie,"combatSessions",n),t=await kn(e);return t.exists()?{id:t.id,...t.data()}:null}catch(e){De(e,"getCombatSession")}},Xr=async(n,e)=>{try{console.log(" updateCombatSession called with:",{combatId:n,updates:e});const t=Ze(Ie,"combatSessions",n);await jt(t,{...e,lastUpdated:ze()}),console.log(" updateCombatSession completed successfully")}catch(t){console.error(" Error in updateCombatSession:",t),De(t,"updateCombatSession")}},Cy=(n,e)=>{try{console.log(" Setting up combat session subscription for:",n);const t=Ze(Ie,"combatSessions",n);return Yc(t,s=>{if(console.log(" Combat session subscription update received:",s.exists()?"Document exists":"Document does not exist"),s.exists()){const i={id:s.id,...s.data()};console.log(" Combat session data from subscription:",i),e(i)}else console.log(" Combat session document does not exist"),e(null)})}catch(t){console.error(" Error in subscribeToCombatSession:",t),De(t,"subscribeToCombatSession")}},pS=async(n,e)=>{try{const t=await Qo(n);if(!t)throw new Error("User profile not found");const r={id:GM(),...e,createdAt:new Date},i=[...t.characterPresets||[],r];return await jt(Ze(Ie,"userProfiles",t.id),{characterPresets:i}),r}catch(t){throw new Error(`Failed to save character preset: ${t.message}`)}},gS=async n=>{try{const e=await Qo(n);return e?e.characterPresets||[]:[]}catch(e){De(e,"getUserCharacterPresets")}},yS=async(n,e)=>{try{const t=await Qo(n);if(!t)throw new Error("User profile not found");const s=(t.characterPresets||[]).filter(a=>a.id!==e),i=Ze(Ie,"userProfiles",t.id);await jt(i,{characterPresets:s,updatedAt:ze()})}catch(t){De(t,"deleteCharacterPreset")}},oV=async(n,e)=>{try{const t=Ze(Ie,"campaignStories",n),a={...(await kn(t)).data().campaignMetadata||{},...e,lastUpdated:ze()};return await jt(t,{campaignMetadata:a,lastUpdated:ze()}),a}catch(t){De(t,"updateCampaignMetadata")}},lV=async(n,e)=>{try{const t=Ze(Ie,"campaignStories",n),i=(await kn(t)).data().campaignSessions||[],a={id:`session_${Date.now()}`,...e,timestamp:ze()};return await jt(t,{campaignSessions:[...i,a],lastUpdated:ze()}),a}catch(t){De(t,"saveCampaignSession")}},cV=async(n,e)=>{try{const t=Ze(Ie,"campaignStories",n),i=(await kn(t)).data().campaignNotes||[],a={id:`note_${Date.now()}`,content:e.content,type:e.type||"general",timestamp:ze(),createdBy:e.createdBy};return await jt(t,{campaignNotes:[...i,a],lastUpdated:ze()}),a}catch(t){De(t,"addCampaignNote")}},uV=async(n,e)=>{try{const t=Ze(Ie,"campaignStories",n);await jt(t,{"campaignMetadata.mainGoal":e,lastUpdated:ze()})}catch(t){De(t,"updateCampaignGoal")}},dV=async(n,e)=>{try{const t=Ze(Ie,"campaignStories",n);return await jt(t,{storyState:{...e,lastUpdated:ze()},lastUpdated:ze()}),e}catch(t){De(t,"saveStoryState")}},hV=async n=>{try{const e=Ze(Ie,"campaignStories",n);return(await kn(e)).data().storyState||null}catch(e){De(e,"getStoryState")}},mV=async(n,e)=>{try{const t=Ze(Ie,"campaignStories",n),a={...(await kn(t)).data().storyState||{},...e,lastUpdated:ze()};return await jt(t,{storyState:a,lastUpdated:ze()}),a}catch(t){De(t,"updateStoryState")}},fV=async(n,e)=>{try{const t=(e.partyMembers||[]).map(o=>({...o,id:o.id,isEnemy:!1,userId:o.userId,cooldowns:{},statusEffects:[]})),r=(e.enemies||[]).map(o=>({...o,id:o.id,isEnemy:!0,userId:null,cooldowns:{},statusEffects:[]})),s=[...t,...r],i={partyId:n,status:"active",storyContext:e.storyContext,partyMembers:e.partyMembers,enemies:e.enemies,combatants:s,initiative:e.initiative||[],currentTurn:0,round:1,combatState:"preparation",environmentalFeatures:e.environmentalFeatures||[],teamUpOpportunities:e.teamUpOpportunities||[],narrativeElements:e.narrativeElements||{},statusEffects:{},cooldowns:{},createdAt:ze(),updatedAt:ze()};return{id:(await Si(ft(Ie,"combatSessions"),i)).id,...i}}catch(t){De(t,"createEnhancedCombatSession")}},vS=async(n,e)=>{try{const t=Ze(Ie,"combatSessions",n);await jt(t,{...e,updatedAt:ze()})}catch(t){De(t,"updateCombatSessionWithNarrative")}},xS=async(n,e)=>{try{console.log(" Adding to combat battle log:",{combatId:n,logEntry:e});const t=Ze(Ie,"combatSessions",n),r=await kn(t);if(r.exists()){const a=[...r.data().battleLog||[],e];await jt(t,{battleLog:a,lastUpdated:ze()}),console.log(" Battle log updated successfully")}}catch(t){console.error(" Error in addToCombatBattleLog:",t),De(t,"addToCombatBattleLog")}},pV=async(n,e,t=null)=>{var r,s;try{const i=Ze(Ie,"campaignStories",n),o=(await kn(i)).data(),c={id:`msg_${Date.now()}`,...e,timestamp:new Date,metadata:{storyStateSnapshot:t?{currentLocation:(r=t.currentLocation)==null?void 0:r.name,activeNPCs:Object.keys(t.activeNPCs||{}),activePlotThreads:((s=t.activePlotThreads)==null?void 0:s.map(d=>d.title))||[],characterRelationships:t.characterArcs?Object.entries(t.characterArcs).map(([d,h])=>({characterId:d,relationships:Object.keys(h.relationships||{})})):[]}:null}};return await jt(i,{storyMessages:[...o.storyMessages,c],lastUpdated:ze()}),c}catch(i){De(i,"addStoryMessageWithMetadata")}},gV=async n=>{var e,t,r,s;try{const i=Ze(Ie,"campaignStories",n),o=(await kn(i)).data();return{storyState:o.storyState||null,campaignMetadata:o.campaignMetadata||null,recentMessages:((e=o.storyMessages)==null?void 0:e.slice(-10))||[],activeNPCs:((t=o.storyState)==null?void 0:t.activeNPCs)||{},characterArcs:((r=o.storyState)==null?void 0:r.characterArcs)||{},plotThreads:((s=o.storyState)==null?void 0:s.activePlotThreads)||[]}}catch(i){De(i,"getStoryConsistencyData")}},_S=async n=>{try{const e=Ze(Ie,"characters",n),t=await kn(e);if(!t.exists())throw new Error(`Character document with ID ${n} does not exist`);const r=t.data(),s=Ey(r);return await jt(e,{...s,updatedAt:new Date}),{id:n,...r,...s}}catch(e){throw new Error(`Failed to recalculate character stats: ${e.message}`)}},wS=async n=>{try{const t=(await ko(n)).filter(s=>!s.hp||!s.maxHp||!s.ac).map(s=>_S(s.id));return await Promise.all(t)}catch(e){throw new Error(`Failed to update party character stats: ${e.message}`)}},yV=Object.freeze(Object.defineProperty({__proto__:null,addCampaignNote:cV,addStoryMessage:sV,addStoryMessageWithMetadata:pV,addToCombatBattleLog:xS,checkUsernameAvailability:eS,cleanupOrphanedCharacters:sS,createCampaignStory:cS,createCombatSession:aV,createEnhancedCombatSession:fV,createParty:Ty,createUserProfile:ZI,debugUserCharacters:rS,deleteCharacter:th,deleteCharacterPreset:yS,disbandParty:Sy,getActiveCombat:eV,getCampaignByParty:JM,getCampaignStory:uS,getCharacterByUserAndParty:nS,getCombatSession:fS,getPartyById:oS,getPartyByInviteCode:aS,getPartyCharacters:ko,getPublicParties:iS,getStoryConsistencyData:gV,getStoryState:hV,getUserCharacterPresets:gS,getUserCharacters:Wl,getUserParties:Iy,getUserProfile:Qo,getUserProfiles:hp,joinParty:mp,recalculateCharacterStats:_S,saveCampaign:YM,saveCampaignSession:lV,saveCharacter:tS,saveCharacterPreset:pS,saveCombat:ZM,saveStoryState:dV,setCurrentController:iV,setCurrentSpeaker:mS,setPlayerReady:dS,subscribeToCampaign:nV,subscribeToCampaignStory:hS,subscribeToCombat:rV,subscribeToCombatSession:Cy,subscribeToParty:lS,updateCampaign:XM,updateCampaignGoal:uV,updateCampaignMetadata:oV,updateCampaignStory:Tn,updateCharacter:QM,updateCombat:tV,updateCombatSession:Xr,updateCombatSessionWithNarrative:vS,updatePartyCharacterStats:wS,updateStoryState:mV,updateUserProfile:KM},Symbol.toStringTag,{value:"Module"})),vV=()=>{const[n,e]=k.useState(null),[t,r]=k.useState(!0);return k.useEffect(()=>_E(Wr,i=>{e(i),r(!1)}),[]),{user:n,loading:t}},xV=async(n,e,t)=>{try{if(console.log("Starting registration for:",n,t),!await eS(t))return console.log("Username not available:",t),{user:null,error:"Username is already taken. Please choose a different username."};console.log("Username available:",t);const s=await Hk(Wr,n,e);console.log("User created successfully:",s.user.uid);try{await ZI(s.user.uid,{username:t,email:n,displayName:t}),console.log("User profile created successfully")}catch(a){console.error("Error creating user profile:",a)}let i=!1;try{await Kk(s.user),console.log("Email verification sent successfully"),i=!0}catch(a){console.error("Error sending email verification:",a)}return await wE(Wr),console.log("User signed out after registration"),{user:null,error:null,success:!0}}catch(r){return console.error("Registration error:",r),{user:null,error:r.message}}},_V=async(n,e)=>{try{return{user:(await Gk(Wr,n,e)).user,error:null}}catch(t){return{user:null,error:t.message}}},wV=async()=>{try{return await wE(Wr),{error:null}}catch(n){return{error:n.message}}},Yo=n=>_E(Wr,async e=>{n(e)}),bV=async()=>{try{return console.log("Testing Firebase connection..."),console.log("Auth domain:",Wr.config.authDomain),console.log("Project ID:",Wr.config.projectId),{success:!0,message:"Firebase connection successful"}}catch(n){return console.error("Firebase connection test failed:",n),{success:!1,error:n.message}}};function EV(){const[n,e]=k.useState(null),[t,r]=k.useState(null),[s,i]=k.useState(!1),[a,o]=k.useState(!1),[c,d]=k.useState("connected"),h=fr();k.useEffect(()=>{const y=Yo(async E=>{if(e(E),E)try{const v=await Qo(E.uid);r(v)}catch(v){console.error("Error loading user profile:",v)}else r(null)});return()=>y()},[h]),k.useEffect(()=>{const y=async()=>{try{const v=on(ft(Ie,"_test"),AM(1));await Pn(v),d("connected")}catch(v){console.warn("Firestore connection issue detected:",v),d("disconnected"),setTimeout(()=>{d("reconnecting"),y()},5e3)}};y();const E=setInterval(y,3e4);return()=>clearInterval(E)},[]);const m=async()=>{const{error:y}=await wV();y||(h("/"),o(!1),i(!1))},p=(t==null?void 0:t.username)||(n==null?void 0:n.email);return l.jsx("nav",{className:"bg-gray-900 text-gray-100 shadow-lg border-b border-gray-700",children:l.jsxs("div",{className:"fantasy-container",children:[l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx(Rr,{to:"/",className:"text-xl sm:text-2xl font-bold font-['Cinzel'] text-amber-400",children:"DND-V1"}),l.jsx("div",{className:"hidden md:flex items-center space-x-4",children:n?l.jsxs(l.Fragment,{children:[l.jsx(Rr,{to:"/dashboard",className:"fantasy-button",children:"Dashboard"}),l.jsx(Rr,{to:"/party-management",className:"fantasy-button",children:"Parties"}),l.jsxs("div",{className:"relative",children:[l.jsx("button",{onClick:()=>i(!s),className:"fantasy-button bg-gray-700 hover:bg-gray-600",children:p}),s&&l.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-600 z-50",children:l.jsxs("div",{className:"py-2",children:[l.jsxs("div",{className:"px-4 py-2 text-sm text-gray-200 border-b border-gray-600",children:[l.jsx("div",{className:"font-medium",children:p}),l.jsx("div",{className:"text-xs text-gray-400",children:n.email})]}),l.jsx("button",{onClick:m,className:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-700",children:"Logout"})]})})]})]}):l.jsx(Rr,{to:"/login",className:"fantasy-button",children:"Login"})}),l.jsx("div",{className:"md:hidden",children:l.jsx("button",{onClick:()=>o(!a),className:"fantasy-button bg-gray-700 hover:bg-gray-600 p-2",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a?l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})})]}),a&&l.jsx("div",{className:"md:hidden mt-4 pb-4 border-t border-gray-700",children:n?l.jsxs("div",{className:"pt-4 space-y-3",children:[l.jsx(Rr,{to:"/dashboard",className:"fantasy-button block w-full text-center",onClick:()=>o(!1),children:"Dashboard"}),l.jsx(Rr,{to:"/party-management",className:"fantasy-button block w-full text-center",onClick:()=>o(!1),children:"Parties"}),l.jsxs("div",{className:"pt-3 border-t border-gray-700",children:[l.jsxs("div",{className:"px-4 py-2 text-sm text-gray-200",children:[l.jsx("div",{className:"font-medium",children:p}),l.jsx("div",{className:"text-xs text-gray-400",children:n.email})]}),l.jsx("button",{onClick:m,className:"w-full text-left px-4 py-3 text-sm text-gray-200 hover:bg-gray-700 rounded-lg mt-2",children:"Logout"})]})]}):l.jsx("div",{className:"pt-4",children:l.jsx(Rr,{to:"/login",className:"fantasy-button block w-full text-center",onClick:()=>o(!1),children:"Login"})})})]})})}const TV="3.1.3";function IV(){return l.jsxs("div",{className:"text-xs text-gray-400 text-center mt-2",children:["Version ",TV]})}function SV(){return l.jsxs("div",{className:"relative overflow-hidden",children:[l.jsx("div",{className:"fantasy-container",children:l.jsxs("div",{className:"relative z-10 py-8 sm:py-16 lg:py-24 text-center",children:[l.jsx("h1",{className:"fantasy-title text-5xl sm:text-6xl lg:text-7xl",children:"Manage your D&D world like a real adventurer's tome"}),l.jsx("p",{className:"fantasy-subtitle max-w-2xl mx-auto",children:"Create parties, invite friends, and share story objectives in a beautifully crafted digital environment that feels like a magical grimoire."}),l.jsxs("div",{className:"mt-8 flex justify-center space-x-6",children:[l.jsx(Rr,{to:"/register",className:"fantasy-button text-lg px-8 py-3",children:"Start Your Journey"}),l.jsx(Rr,{to:"/login",className:"fantasy-button text-lg px-8 py-3 bg-gray-600 hover:bg-gray-700",children:"Return to Campaign"})]})]})}),l.jsx("div",{className:"absolute inset-0 bg-gray-700/10 pattern-grid-lg"})]})}function CV(){return l.jsxs("div",{children:[l.jsx(SV,{}),l.jsx("div",{className:"fantasy-container py-16",children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Create Parties"}),l.jsx("p",{className:"text-gray-300",children:"Form adventuring parties with your friends and manage your campaign together in a shared space."})]}),l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Track Objectives"}),l.jsx("p",{className:"text-gray-300",children:"Keep track of your party's quests, storylines, and achievements in an organized magical tome."})]}),l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Share Stories"}),l.jsx("p",{className:"text-gray-300",children:"Document your adventures and share them with your fellow party members in an immersive fantasy setting."})]})]})})]})}function AV(){const[n,e]=k.useState(""),[t,r]=k.useState(""),[s,i]=k.useState(!1),[a,o]=k.useState(""),[c,d]=k.useState(""),h=fr(),m=_i();k.useEffect(()=>{var E;(E=m.state)!=null&&E.message&&(d(m.state.message),h(m.pathname,{replace:!0}));const y=Yo(v=>{v&&h("/dashboard")});return()=>y()},[h,m]);const p=async y=>{y.preventDefault(),i(!0),o("");const E=await _V(n,t);E.error&&(E.error.includes("auth/invalid-credential")?o("Invalid email or password. Please check your credentials or register a new account."):E.error.includes("auth/user-not-found")?o("No account found with this email. Please register first."):E.error.includes("auth/wrong-password")?o("Incorrect password. Please try again."):E.error.includes("auth/user-disabled")?o("This account has been disabled. Please contact support."):E.error.includes("auth/too-many-requests")?o("Too many failed login attempts. Please try again later."):o(E.error)),i(!1)};return l.jsx("div",{className:"fantasy-container py-8",children:l.jsxs("div",{className:"fantasy-card max-w-md mx-auto",children:[l.jsx("h1",{className:"fantasy-title text-center",children:"Login"}),c&&l.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded-lg mb-4",children:c}),l.jsxs("form",{onSubmit:p,className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-200 mb-2",children:"Email"}),l.jsx("input",{id:"email",type:"email",value:n,onChange:y=>e(y.target.value),className:"fantasy-input",autoComplete:"email",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-200 mb-2",children:"Password"}),l.jsx("input",{id:"password",type:"password",value:t,onChange:y=>r(y.target.value),className:"fantasy-input",autoComplete:"current-password",required:!0})]}),a&&l.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded-lg",children:a}),l.jsx("button",{type:"submit",disabled:s,className:"fantasy-button w-full",children:s?"Logging in...":"Login"})]}),l.jsx("div",{className:"mt-6 text-center",children:l.jsxs("p",{className:"text-gray-300",children:["Don't have an account?"," ",l.jsx("button",{onClick:()=>h("/register"),className:"text-amber-400 hover:text-amber-300 font-medium",children:"Register here"})]})})]})})}function NV(){const[n,e]=k.useState(""),[t,r]=k.useState(""),[s,i]=k.useState(""),[a,o]=k.useState(""),[c,d]=k.useState(""),[h,m]=k.useState(""),p=fr();k.useEffect(()=>{bV().then(E=>{console.log("Firebase test result:",E)})},[]);const y=async E=>{if(E.preventDefault(),d(""),m(""),s!==a){d("Passwords do not match");return}if(!t.trim()){d("Username is required");return}if(t.length<3){d("Username must be at least 3 characters long");return}if(!/^[a-zA-Z0-9_]+$/.test(t)){d("Username can only contain letters, numbers, and underscores");return}console.log("Submitting registration for:",n,t);const{user:v,error:I,success:_}=await xV(n,s,t);if(console.log("Registration result:",{user:v,error:I,success:_}),I){console.log("Setting error:",I),d(I);return}_?(console.log("Registration successful, redirecting to login"),p("/login",{state:{message:"Registration successful! Please check your email to verify your account before logging in."}})):console.log("No success received from registration")};return l.jsx("div",{className:"fantasy-container min-h-screen flex items-center justify-center",children:l.jsxs("div",{className:"fantasy-card w-full max-w-md",children:[l.jsx("h2",{className:"fantasy-title text-center",children:"Begin Your Adventure"}),c&&l.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded mb-4",children:c}),h&&l.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded mb-4",children:h}),l.jsxs("form",{onSubmit:y,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-200",children:"Username"}),l.jsx("input",{id:"username",type:"text",required:!0,value:t,onChange:E=>r(E.target.value),className:"fantasy-input mt-1",placeholder:"Choose a unique username"}),l.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Letters, numbers, and underscores only. 3+ characters."})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-200",children:"Email"}),l.jsx("input",{id:"email",type:"email",required:!0,value:n,onChange:E=>e(E.target.value),className:"fantasy-input mt-1"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-200",children:"Password"}),l.jsx("input",{id:"password",type:"password",required:!0,value:s,onChange:E=>i(E.target.value),className:"fantasy-input mt-1"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-200",children:"Confirm Password"}),l.jsx("input",{id:"confirmPassword",type:"password",required:!0,value:a,onChange:E=>o(E.target.value),className:"fantasy-input mt-1"})]}),l.jsx("button",{type:"submit",className:"fantasy-button w-full",children:"Register"})]}),l.jsxs("p",{className:"mt-4 text-center text-sm text-gray-300",children:["Already have an account?"," ",l.jsx(Rr,{to:"/login",className:"text-amber-400 hover:text-amber-300",children:"Return to your campaign"})]})]})})}function bS({validation:n,onClose:e,onProceed:t,onRevise:r}){const[s,i]=k.useState(!1),[a,o]=k.useState(!1),[c,d]=k.useState(null);if(k.useEffect(()=>{if(n!=null&&n.diceResult){i(!0),o(!0);const p=setTimeout(()=>{o(!1),d(n.diceResult)},2e3);return()=>clearTimeout(p)}},[n]),!n)return null;const h=(p,y)=>y==="critical success"?"text-green-800 bg-green-200 border-green-400":y==="great success"?"text-green-700 bg-green-100 border-green-300":y==="success"?"text-green-600 bg-green-50 border-green-200":y==="failure"?"text-red-600 bg-red-50 border-red-200":y==="great failure"?"text-red-700 bg-red-100 border-red-300":y==="critical failure"?"text-red-800 bg-red-200 border-red-400":p?"text-green-600 bg-green-100 border-green-300":"text-red-600 bg-red-100 border-red-300",m=()=>n.diceResult?l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:l.jsxs("div",{className:"bg-gradient-to-br from-amber-900 to-amber-800 rounded-2xl p-8 max-w-2xl w-full mx-4 border-4 border-amber-600 shadow-2xl",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("div",{className:"text-amber-200 text-lg font-bold mb-2",children:" THE DICE HAVE BEEN CAST "}),l.jsx("div",{className:"text-amber-300 text-sm",children:"The fate of your party hangs in the balance..."})]}),l.jsxs("div",{className:"bg-amber-950/50 rounded-lg p-4 mb-6 border border-amber-500",children:[l.jsx("div",{className:"text-amber-200 font-bold text-lg mb-2",children:"Your Action"}),l.jsx("div",{className:"text-amber-100 text-sm",children:n.diceResult.actions?n.diceResult.actions.map((p,y)=>l.jsxs("div",{className:"mb-2",children:[l.jsx("span",{className:"font-semibold capitalize",children:p.action}),l.jsxs("span",{className:"text-amber-300",children:[": ",p.description]})]},y)).join(""):"Rolling the dice..."})]}),a?l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("div",{className:"text-6xl mb-4 animate-bounce",children:""}),l.jsx("div",{className:"text-amber-200 text-xl font-bold mb-2",children:"Rolling..."}),l.jsx("div",{className:"text-amber-300 text-sm",children:"The dice tumble across the table"})]}):l.jsxs("div",{className:"space-y-4",children:[n.diceResult.actions?n.diceResult.actions.map((p,y)=>l.jsxs("div",{className:`rounded-lg p-4 border-2 ${h(p.check.isSuccess,p.check.degree)}`,children:[l.jsxs("div",{className:"flex justify-between items-center mb-2",children:[l.jsx("div",{className:"text-lg font-bold capitalize",children:p.action}),l.jsx("div",{className:"text-2xl font-bold",children:p.check.degree?p.check.degree.replace("_"," ").toUpperCase():p.check.isSuccess?"SUCCESS":"FAILURE"})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center mb-3",children:[l.jsxs("div",{className:"bg-black/30 rounded p-2",children:[l.jsx("div",{className:"text-xs text-amber-300",children:"ROLL"}),l.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:p.check.roll})]}),l.jsxs("div",{className:"bg-black/30 rounded p-2",children:[l.jsx("div",{className:"text-xs text-amber-300",children:"TOTAL"}),l.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:p.check.totalRoll})]}),l.jsxs("div",{className:"bg-black/30 rounded p-2",children:[l.jsx("div",{className:"text-xs text-amber-300",children:"DC"}),l.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:p.check.dc})]})]}),l.jsx("div",{className:"text-sm text-amber-200",children:p.description})]},y)):l.jsxs("div",{className:`rounded-lg p-6 border-2 text-center ${h(n.diceResult.isSuccess)}`,children:[l.jsx("div",{className:"text-2xl font-bold mb-4",children:n.diceResult.isSuccess?"SUCCESS!":"FAILURE!"}),l.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[l.jsxs("div",{className:"bg-black/30 rounded p-2",children:[l.jsx("div",{className:"text-xs text-amber-300",children:"ROLL"}),l.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:n.diceResult.roll})]}),l.jsxs("div",{className:"bg-black/30 rounded p-2",children:[l.jsx("div",{className:"text-xs text-amber-300",children:"TOTAL"}),l.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:n.diceResult.totalRoll})]}),l.jsxs("div",{className:"bg-black/30 rounded p-2",children:[l.jsx("div",{className:"text-xs text-amber-300",children:"DC"}),l.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:n.diceResult.dc})]})]})]}),n.diceResult.overallSuccess!==void 0&&l.jsxs("div",{className:`rounded-lg p-4 border-2 text-center ${n.diceResult.overallSuccess?"border-green-400 bg-green-900/50":"border-red-400 bg-red-900/50"}`,children:[l.jsx("div",{className:"text-xl font-bold mb-2",children:n.diceResult.overallSuccess?" MISSION ACCOMPLISHED! ":" THE DICE HAVE SPOKEN... "}),l.jsx("div",{className:"text-sm",children:n.diceResult.overallSuccess?"Your party's combined efforts have succeeded!":"The challenge has proven too great this time..."})]})]}),!a&&l.jsxs("div",{className:"bg-amber-950/50 rounded-lg p-4 mt-6 border border-amber-500",children:[l.jsx("div",{className:"text-amber-200 font-bold mb-2",children:" Dungeon Master's Commentary"}),l.jsx("div",{className:"text-amber-100 text-sm italic",children:typeof n.response=="string"?n.response:n.response.story})]}),!a&&l.jsxs("div",{className:"mt-6 flex justify-center space-x-4",children:[n.type==="valid"?l.jsx("button",{onClick:t,className:"fantasy-button bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:" PROCEED WITH FATE"}):l.jsx("button",{onClick:r,className:"fantasy-button bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:" TRY AGAIN"}),l.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:" CANCEL"})]})]})}):null;return s?m():l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:l.jsxs("div",{className:"bg-gradient-to-br from-stone-800 to-stone-900 rounded-lg p-6 max-w-2xl w-full mx-4 border-2 border-stone-600 shadow-xl",children:[l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsx("h3",{className:"text-xl font-bold text-stone-200",children:" Action Validation"}),l.jsx("button",{onClick:e,className:"text-stone-400 hover:text-stone-200 text-xl",children:""})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"p-4 bg-stone-700 rounded-lg border border-stone-600",children:[l.jsx("h4",{className:"font-semibold text-stone-200 mb-2",children:" Dungeon Master's Response"}),l.jsx("div",{className:"text-stone-300 italic leading-relaxed",children:typeof n.response=="string"?n.response:n.response.story})]}),n.suggestion&&l.jsxs("div",{className:"p-4 bg-blue-900/50 rounded-lg border border-blue-600",children:[l.jsx("h4",{className:"font-semibold text-blue-200 mb-2",children:" Suggestion"}),l.jsx("p",{className:"text-blue-100",children:n.suggestion})]}),n.type!=="valid"&&l.jsxs("div",{className:"p-4 bg-purple-900/50 rounded-lg border border-purple-600",children:[l.jsx("h4",{className:"font-semibold text-purple-200 mb-2",children:" Alternative Approaches"}),l.jsxs("ul",{className:"text-purple-100 text-sm space-y-1",children:[l.jsx("li",{children:" Try a more focused, single action"}),l.jsx("li",{children:" Consider your character's abilities and limitations"}),l.jsx("li",{children:" Think about what would be realistic in this situation"}),l.jsx("li",{children:" Ask for clarification about what you're trying to achieve"})]})]})]}),l.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[n.type==="valid"?l.jsx("button",{onClick:t,className:"fantasy-button bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold",children:"Proceed with Action"}):l.jsx("button",{onClick:r,className:"fantasy-button bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-bold",children:"Revise Action"}),l.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700 text-white px-4 py-2 rounded font-bold",children:"Cancel"})]})]})})}function ES({diceResult:n,onClose:e}){if(!n)return null;const t=s=>{switch(s){case"critical success":return"text-green-600 bg-green-100";case"great success":return"text-green-700 bg-green-50";case"success":return"text-blue-600 bg-blue-100";case"failure":return"text-yellow-600 bg-yellow-100";case"great failure":return"text-orange-600 bg-orange-100";case"critical failure":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},r=s=>{switch(s){case"critical success":return"";case"great success":return"";case"success":return"";case"failure":return"";case"great failure":return"";case"critical failure":return"";default:return""}};return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:l.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto",children:[l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Dice Roll Results"}),l.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:""})]}),n.actions?l.jsxs("div",{className:"space-y-4",children:[n.actions.map((s,i)=>l.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:s.action}),l.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${t(s.check.degree)}`,children:[r(s.check.degree)," ",s.check.degree]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-stone-600",children:"Roll:"}),l.jsx("span",{className:"font-mono ml-1",children:s.check.roll})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-stone-600",children:"Total:"}),l.jsx("span",{className:"font-mono ml-1",children:s.check.totalRoll})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-stone-600",children:"DC:"}),l.jsx("span",{className:"font-mono ml-1",children:s.check.dc})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-stone-600",children:"Margin:"}),l.jsxs("span",{className:`font-mono ml-1 ${s.check.margin>=0?"text-green-600":"text-red-600"}`,children:[s.check.margin>=0?"+":"",s.check.margin]})]})]}),s.check.circumstanceBonus!==0&&l.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:["Circumstance bonus: ",s.check.circumstanceBonus>=0?"+":"",s.check.circumstanceBonus]})]},i)),l.jsxs("div",{className:"mt-4 p-3 bg-stone-50 rounded-lg",children:[l.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"Overall Result"}),l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${n.overallSuccess?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:n.overallSuccess?" Success":" Partial Failure"}),n.hasCriticalFailures&&l.jsx("span",{className:"text-red-600 text-sm",children:" Critical failures occurred"})]})]})]}):l.jsx("div",{className:"space-y-4",children:l.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:n.actionType}),l.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${t(n.degree)}`,children:[r(n.degree)," ",n.degree]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-stone-600",children:"Roll:"}),l.jsx("span",{className:"font-mono ml-1",children:n.roll})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-stone-600",children:"Total:"}),l.jsx("span",{className:"font-mono ml-1",children:n.totalRoll})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-stone-600",children:"DC:"}),l.jsx("span",{className:"font-mono ml-1",children:n.dc})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-stone-600",children:"Margin:"}),l.jsxs("span",{className:`font-mono ml-1 ${n.margin>=0?"text-green-600":"text-red-600"}`,children:[n.margin>=0?"+":"",n.margin]})]})]}),l.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:[l.jsxs("div",{children:["Primary Mod: ",n.primaryMod>=0?"+":"",n.primaryMod]}),l.jsxs("div",{children:["Proficiency: ",n.proficiencyMod>=0?"+":"",n.proficiencyMod]}),n.circumstanceBonus!==0&&l.jsxs("div",{children:["Circumstance: ",n.circumstanceBonus>=0?"+":"",n.circumstanceBonus]})]})]})}),l.jsx("div",{className:"mt-4 flex justify-end",children:l.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Close"})})]})})}function PV({multipleResults:n,onClose:e}){const[t,r]=k.useState(!1),[s,i]=k.useState(null);if(!n)return null;const{actionType:a,numberOfAttempts:o,results:c,statistics:d}=n,h=v=>v.adjustedSuccess&&v.adjustedMargin>=10?"bg-green-500":v.adjustedSuccess?"bg-green-400":!v.adjustedSuccess&&v.adjustedMargin<=-10?"bg-red-500":"bg-red-400",m=v=>v.adjustedSuccess&&v.adjustedMargin>=10?"":v.adjustedSuccess?"":!v.adjustedSuccess&&v.adjustedMargin<=-10?"":"",p=v=>{const I=`Attempt ${v.attemptNumber}: ${v.roll} + ${v.primaryMod} + ${v.proficiencyMod}`,_=v.fatiguePenalty>0?` - ${v.fatiguePenalty} (fatigue)`:"",x=` = ${v.adjustedTotalRoll} vs DC ${v.dc}`,C=v.adjustedSuccess?" (Success)":" (Failure)";return I+_+x+C},E=((v,I=50)=>{const _=[];for(let x=0;x<v.length;x+=I)_.push(v.slice(x,x+I));return _})(c);return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:l.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsxs("h3",{className:"text-lg font-bold text-stone-800",children:["Multiple Attempts: ",a," (",o," attempts)"]}),l.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:""})]}),l.jsxs("div",{className:"mb-6 p-4 bg-stone-50 rounded-lg",children:[l.jsx("h4",{className:"font-semibold text-stone-700 mb-3",children:"Overall Statistics"}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.successfulAttempts}),l.jsx("div",{className:"text-sm text-stone-600",children:"Successful"})]}),l.jsxs("div",{className:"text-center",children:[l.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[d.successRate.toFixed(1),"%"]}),l.jsx("div",{className:"text-sm text-stone-600",children:"Success Rate"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-2xl font-bold text-amber-600",children:d.criticalSuccesses}),l.jsx("div",{className:"text-sm text-stone-600",children:"Critical Successes"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-2xl font-bold text-red-600",children:d.criticalFailures}),l.jsx("div",{className:"text-sm text-stone-600",children:"Critical Failures"})]})]}),l.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[l.jsxs("div",{children:[l.jsx("span",{className:"font-semibold",children:"Average Roll:"})," ",d.averageRoll.toFixed(1)]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-semibold",children:"Best Roll:"})," ",d.bestRoll]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-semibold",children:"Worst Roll:"})," ",d.worstRoll]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-semibold",children:"Average Total:"})," ",d.averageTotalRoll.toFixed(1)]})]})]}),l.jsxs("div",{className:"mb-4",children:[l.jsxs("div",{className:"flex justify-between items-center mb-2",children:[l.jsx("h4",{className:"font-semibold text-stone-700",children:"Individual Attempts"}),l.jsx("button",{onClick:()=>r(!t),className:"text-sm text-blue-600 hover:text-blue-800",children:t?"Hide Details":"Show Details"})]}),l.jsx("div",{className:"space-y-2",children:E.map((v,I)=>l.jsxs("div",{className:"flex flex-wrap gap-1",children:[v.map(_=>l.jsx("div",{className:`w-6 h-6 rounded text-xs flex items-center justify-center cursor-pointer transition-colors ${h(_)} text-white font-bold`,title:p(_),onClick:()=>i(_),children:m(_)},_.attemptNumber)),I<E.length-1&&l.jsx("div",{className:"w-full h-px bg-stone-300 my-2"})]},I))})]}),l.jsxs("div",{className:"mb-4 p-3 bg-stone-50 rounded-lg",children:[l.jsx("h5",{className:"font-semibold text-stone-700 mb-2",children:"Legend"}),l.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{className:"w-4 h-4 bg-green-500 rounded text-white text-xs flex items-center justify-center",children:""}),l.jsx("span",{children:"Critical Success"})]}),l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{className:"w-4 h-4 bg-green-400 rounded text-white text-xs flex items-center justify-center",children:""}),l.jsx("span",{children:"Success"})]}),l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{className:"w-4 h-4 bg-red-400 rounded text-white text-xs flex items-center justify-center",children:""}),l.jsx("span",{children:"Failure"})]}),l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{className:"w-4 h-4 bg-red-500 rounded text-white text-xs flex items-center justify-center",children:""}),l.jsx("span",{children:"Critical Failure"})]})]})]}),s&&l.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[l.jsxs("h5",{className:"font-semibold text-blue-700 mb-2",children:["Attempt ",s.attemptNumber," Details"]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[l.jsxs("div",{children:[l.jsx("span",{className:"font-semibold",children:"Roll:"})," ",s.roll]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-semibold",children:"Primary Mod:"})," ",s.primaryMod>=0?"+":"",s.primaryMod]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-semibold",children:"Proficiency:"})," ",s.proficiencyMod>=0?"+":"",s.proficiencyMod]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-semibold",children:"Fatigue Penalty:"})," -",s.fatiguePenalty]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-semibold",children:"Total:"})," ",s.adjustedTotalRoll]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-semibold",children:"DC:"})," ",s.dc]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-semibold",children:"Margin:"})," ",s.adjustedMargin>=0?"+":"",s.adjustedMargin]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-semibold",children:"Result:"}),l.jsx("span",{className:`ml-1 px-2 py-1 rounded text-xs font-medium ${s.adjustedSuccess?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.adjustedSuccess?"Success":"Failure"})]})]}),l.jsx("button",{onClick:()=>i(null),className:"mt-2 text-sm text-blue-600 hover:text-blue-800",children:"Close Details"})]}),t&&l.jsxs("div",{className:"mb-4",children:[l.jsx("h5",{className:"font-semibold text-stone-700 mb-2",children:"Detailed Results"}),l.jsx("div",{className:"max-h-64 overflow-y-auto",children:l.jsxs("table",{className:"w-full text-sm",children:[l.jsx("thead",{className:"bg-stone-100",children:l.jsxs("tr",{children:[l.jsx("th",{className:"px-2 py-1 text-left",children:"#"}),l.jsx("th",{className:"px-2 py-1 text-left",children:"Roll"}),l.jsx("th",{className:"px-2 py-1 text-left",children:"Total"}),l.jsx("th",{className:"px-2 py-1 text-left",children:"DC"}),l.jsx("th",{className:"px-2 py-1 text-left",children:"Fatigue"}),l.jsx("th",{className:"px-2 py-1 text-left",children:"Result"})]})}),l.jsx("tbody",{children:c.map(v=>l.jsxs("tr",{className:"border-b border-stone-200",children:[l.jsx("td",{className:"px-2 py-1",children:v.attemptNumber}),l.jsx("td",{className:"px-2 py-1",children:v.roll}),l.jsx("td",{className:"px-2 py-1",children:v.adjustedTotalRoll}),l.jsx("td",{className:"px-2 py-1",children:v.dc}),l.jsxs("td",{className:"px-2 py-1",children:["-",v.fatiguePenalty]}),l.jsx("td",{className:"px-2 py-1",children:l.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${v.adjustedSuccess?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:v.adjustedSuccess?"Success":"Failure"})})]},v.attemptNumber))})]})})]}),l.jsx("div",{className:"flex justify-end",children:l.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Close"})})]})})}function kV(){const n=fr(),[e,t]=k.useState(null),[r,s]=k.useState([]),[i,a]=k.useState(!0);k.useState(""),k.useState(""),k.useState(null),k.useState(!1),k.useState(!1),k.useState(!1),k.useState(null),k.useState(null),k.useState(null),k.useEffect(()=>{const v=Wr.onAuthStateChanged(async I=>{I?(t(I),await o(I.uid)):n("/login")});return()=>v()},[n]);const o=async v=>{try{const I=await Iy(v);await c(I),s(I)}catch(I){console.error("Error loading user data:",I)}finally{a(!1)}},c=async v=>{for(const I of v)if(I.members)for(const _ of I.members)_.profileId},d=async v=>{try{await Sy(v,e.uid),s(I=>I.filter(_=>_.id!==v))}catch(I){console.error("Error deleting party:",I)}},h=async v=>{try{if(console.log("=== CONTINUE CAMPAIGN DEBUG ==="),console.log("handleContinueCampaign called with partyId:",v),console.log("Current user:",e==null?void 0:e.uid),console.log("User object:",e),!(e!=null&&e.uid)){console.error("No user ID found!"),alert("User not authenticated. Please log in again.");return}if(!v){console.error("No party ID provided!"),alert("Invalid party information.");return}console.log("Calling getCharacterByUserAndParty...");const I=await nS(e.uid,v);console.log("Character check result:",I),I?(console.log("User has character, navigating to campaign:",I.name),console.log("Navigation URL will be:",`/campaign/${v}`),n(`/campaign/${v}`)):(console.log("No character found, navigating to character creation"),console.log("Navigation URL will be:",`/character-creation/${v}`),n(`/character-creation/${v}`))}catch(I){console.error("Error in handleContinueCampaign:",I),console.error("Error details:",{message:I.message,stack:I.stack}),console.log("Error occurred, defaulting to character creation"),n(`/character-creation/${v}`)}},m=()=>{n("/test-environment")},p=async()=>{if(e)try{console.log("=== DEBUGGING CHARACTERS ===");const v=await rS(e.uid);console.log("Debug info:",v),alert(`Debug complete! Check console for details.
Total characters: ${v.totalCharacters}
Orphaned: ${v.orphanedCharacters}`)}catch(v){console.error("Debug error:",v),alert("Debug failed: "+v.message)}},y=()=>{if(r.length>0){const v=r[0];console.log("Testing direct navigation to character creation for party:",v.id),n(`/character-creation/${v.id}`)}else alert("No parties available for testing")},E=async()=>{if(e)try{console.log("=== CLEANING UP ORPHANED CHARACTERS ===");const v=await sS(e.uid);console.log("Cleanup result:",v),alert(`Cleanup complete! Deleted ${v.deleted} orphaned characters.`),window.location.reload()}catch(v){console.error("Cleanup error:",v),alert("Cleanup failed: "+v.message)}};return i?l.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto"}),l.jsx("p",{className:"mt-4 text-gray-300",children:"Loading..."})]})}):l.jsx("div",{className:"min-h-screen bg-gray-900",children:l.jsxs("div",{className:"fantasy-container",children:[l.jsxs("div",{className:"mb-6 sm:mb-8",children:[l.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-100",children:"Dashboard"}),l.jsxs("p",{className:"text-gray-300 mt-2 text-sm sm:text-base",children:["Welcome back, ",(e==null?void 0:e.displayName)||(e==null?void 0:e.email),"! Manage your campaigns and test the system."]})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Test Environment"}),l.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Test action validation, dice rolling, and combat detection in a controlled environment."}),l.jsx("button",{onClick:m,className:"w-full fantasy-button bg-green-600 hover:bg-green-700",children:"Open Test Environment"})]}),l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Create New Campaign"}),l.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Start a new campaign with your party."}),l.jsx("button",{onClick:()=>n("/campaign-management"),className:"w-full fantasy-button bg-blue-600 hover:bg-blue-700",children:"Create Campaign"})]}),l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Party Management"}),l.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Join existing parties or manage your party memberships."}),l.jsx("button",{onClick:()=>n("/party-management"),className:"w-full fantasy-button bg-purple-600 hover:bg-purple-700",children:"Manage Parties"})]}),l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Debug Characters"}),l.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Debug character issues and check for orphaned characters."}),l.jsx("button",{onClick:p,className:"w-full fantasy-button bg-red-600 hover:bg-red-700",children:"Debug Characters"})]}),l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Test Character Creation"}),l.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Test direct navigation to character creation (bypasses character check)."}),l.jsx("button",{onClick:y,className:"w-full fantasy-button bg-orange-600 hover:bg-orange-700",children:"Test Character Creation"})]}),l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Cleanup Characters"}),l.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Remove orphaned characters that don't have a party ID."}),l.jsx("button",{onClick:E,className:"w-full fantasy-button bg-yellow-600 hover:bg-yellow-700",children:"Cleanup Characters"})]})]}),l.jsxs("div",{className:"fantasy-card",children:[l.jsx("div",{className:"border-b border-gray-700 pb-4 mb-4",children:l.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:"Your Campaigns"})}),r.length===0?l.jsxs("div",{className:"text-center py-8",children:[l.jsx("p",{className:"text-gray-300 mb-4",children:"You haven't created any campaigns yet."}),l.jsx("button",{onClick:()=>n("/campaign-management"),className:"fantasy-button bg-blue-600 hover:bg-blue-700",children:"Create Your First Campaign"})]}):l.jsx("div",{className:"space-y-4",children:r.map(v=>{var I;return l.jsx("div",{className:"border border-gray-600 rounded-lg p-4",children:l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-100",children:v.name}),l.jsx("p",{className:"text-gray-300 mt-1 text-sm",children:v.description}),l.jsxs("div",{className:"flex flex-wrap items-center mt-2 gap-2 text-xs sm:text-sm text-gray-400",children:[l.jsxs("span",{children:[((I=v.members)==null?void 0:I.length)||0," members"]}),l.jsx("span",{children:""}),l.jsxs("span",{children:["Theme: ",v.theme]}),l.jsx("span",{children:""}),l.jsxs("span",{children:["Created: ",new Date(v.createdAt).toLocaleDateString()]})]})]}),l.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[l.jsx("button",{onClick:()=>h(v.id),className:"fantasy-button bg-blue-600 hover:bg-blue-700 flex-1",children:"Continue"}),l.jsx("button",{onClick:()=>d(v.id),className:"fantasy-button bg-red-600 hover:bg-red-700 flex-1",children:"Delete"})]})]})},v.id)})})]})]})})}class Ay{constructor(){this.diceTypes={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20,d100:100},this.difficultyClasses={veryEasy:5,easy:10,medium:15,hard:20,veryHard:25,nearlyImpossible:30},this.actionTypes={attack:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:10,description:"Physical attack roll"},spell:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:12,description:"Spell casting check"},dodge:{primaryAbility:"dexterity",secondaryAbility:"wisdom",baseDC:15,description:"Dodge incoming attacks"},parry:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:18,description:"Parry with weapon"},backflip:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:20,description:"Perform a backflip"},somersault:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:18,description:"Perform a somersault"},cartwheel:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:16,description:"Perform a cartwheel"},wallRun:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:22,description:"Run up a wall"},jump:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:12,description:"Jump over obstacles"},climb:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:15,description:"Climb surfaces"},swim:{primaryAbility:"strength",secondaryAbility:"constitution",baseDC:14,description:"Swim through water"},fly:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:30,description:"Fly through the air"},persuade:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:15,description:"Persuade someone"},intimidate:{primaryAbility:"charisma",secondaryAbility:"strength",baseDC:16,description:"Intimidate someone"},deceive:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:18,description:"Deceive someone"},spot:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:12,description:"Spot hidden objects or creatures"},listen:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:10,description:"Listen for sounds"},search:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:14,description:"Search for hidden items"},pickLock:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:20,description:"Pick a lock"},disarmTrap:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:22,description:"Disarm a trap"},heal:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:16,description:"Provide medical aid"},craft:{primaryAbility:"intelligence",secondaryAbility:"dexterity",baseDC:18,description:"Craft an item"}},this.impossibleActionPatterns=[/\b(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,/\b(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,/\b(?:jump|leap)\s+(?:to|over|across)\s+(?:the\s+)?(?:moon|sky|clouds?)\b/gi,/\b(?:teleport|blink|phase)\s+(?:to|through)\b/gi,/\b(?:time\s+travel|rewind|fast\s+forward)\b/gi,/\b(?:summon|create)\s+(?:a\s+)?(?:dragon|god|demon)\b/gi,/\b(?:become|turn\s+into)\s+(?:invisible|invincible|immortal)\b/gi,/\b(?:kill|destroy|eliminate)\s+(?:the\s+)?(?:dm|dungeon\s+master|narrator)\b/gi,/\b(?:break|destroy)\s+(?:the\s+)?(?:fourth\s+wall|game|story)\b/gi,/\b(?:skip|ignore)\s+(?:the\s+)?(?:quest|mission|story)\b/gi,/\b(?:teleport|go)\s+(?:to\s+)?(?:the\s+)?(?:end|final\s+boss|treasure)\b/gi,/\b(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,/\b(?:open|unlock)\s+(?:the\s+)?(?:door|chest)\s+(?:without\s+)?(?:key|lockpick)\b/gi,/\b(?:find|locate)\s+(?:the\s+)?(?:hidden\s+)?(?:passage|door)\s+(?:without\s+)?(?:searching)\b/gi],this.circumstanceModifiers={"in darkness":-2,"in bright light":1,"in difficult terrain":-2,"on slippery surface":-3,"in water":-2,"in tight space":-1,"with cover":2,"with high ground":1,"with low ground":-1,"with proper tools":2,"with improvised tools":-1,"without tools":-3,"with magical item":1,"with masterwork item":2,"while injured":-2,"while exhausted":-3,"while hasted":2,"while blessed":1,"while cursed":-2,"while poisoned":-1,"under time pressure":-2,"with preparation":1,"with careful planning":2,"in a hurry":-2,"with authority":1,"with evidence":2,"with witnesses":-1,"in private":1,"in public":-1}}rollDie(e){return Math.floor(Math.random()*e)+1}rollDice(e,t){const r=[];for(let s=0;s<e;s++)r.push(this.rollDie(t));return r}rollWithAdvantage(){const e=this.rollDie(20),t=this.rollDie(20);return{result:Math.max(e,t),rolls:[e,t],advantage:!0}}rollWithDisadvantage(){const e=this.rollDie(20),t=this.rollDie(20);return{result:Math.min(e,t),rolls:[e,t],disadvantage:!0}}getAbilityModifier(e){return Math.floor((e-10)/2)}getProficiencyBonus(e){return Math.floor((e-1)/4)+2}performSkillCheck(e,t,r=[],s=null){const i=this.actionTypes[t];if(!i)throw new Error(`Unknown action type: ${t}`);let a=s||i.baseDC,o=0;r.forEach(x=>{this.circumstanceModifiers[x]&&(o+=this.circumstanceModifiers[x])});const c=this.getAbilityModifier(e[i.primaryAbility]||10),d=this.getAbilityModifier(e[i.secondaryAbility]||10),h=this.getProficiencyBonus(e.level||1),p=this.checkProficiency(e,t)?h:0,y=this.rollDie(20),E=y+c+p+o,v=E>=a,I=E-a;let _="failure";return v?I>=10?_="critical success":I>=5?_="great success":_="success":I<=-10?_="critical failure":I<=-5?_="great failure":_="failure",{actionType:t,roll:y,totalRoll:E,dc:a,primaryMod:c,secondaryMod:d,proficiencyMod:p,circumstanceBonus:o,isSuccess:v,degree:_,margin:I,circumstances:r,character:{name:e.name,level:e.level,[i.primaryAbility]:e[i.primaryAbility],[i.secondaryAbility]:e[i.secondaryAbility]}}}checkProficiency(e,t){const r=e.proficiencies||[],i={Fighter:["attack","dodge","parry"],Rogue:["dodge","pickLock","disarmTrap","spot","listen"],Wizard:["spell","search","craft"],Cleric:["heal","persuade","spot"],Ranger:["spot","listen","climb","swim"],Paladin:["attack","parry","persuade"],Monk:["attack","dodge","backflip","somersault","cartwheel"],Bard:["persuade","deceive","intimidate"],Druid:["heal","spot","listen"],Sorcerer:["spell","persuade"],Warlock:["spell","intimidate"],Barbarian:["attack","intimidate","jump","climb"]}[e.class]||[];return r.includes(t)||i.includes(t)}validateAction(e,t,r={}){const s=e.toLowerCase();for(const v of this.impossibleActionPatterns)if(v.test(s))return{possible:!1,reason:"This action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};let i=this.extractActionsFromDescription(s);if(i=i.filter(v=>v.type!==void 0),i.length===0)return{possible:!0,reason:"No valid action detected. Action appears to be narrative or unsupported.",suggestion:"Try a different action or rephrase your input.",actions:[],overallSuccess:!0,hasCriticalFailures:!1,criticalFailures:[]};const a=r.customContext;let o=[],c=[],d=[];a&&(a.environmentalFeatures&&(c=a.environmentalFeatures,o.push(`Environmental features: ${c.join(", ")}`)),a.npcs&&(d=a.npcs,o.push(`NPCs present: ${d.map(v=>v.name).join(", ")}`)),a.circumstances&&o.push(`Circumstances: ${a.circumstances.join(", ")}`));const h=i.map((v,I)=>{const _=Math.max(0,I*2),x=Array.isArray(v.circumstances)?[...v.circumstances]:[];_>0&&x.push(`while fatigued (action ${I+1} of ${i.length})`),c.forEach(R=>{x.includes(R)||x.push(R)}),a&&a.circumstances&&a.circumstances.forEach(R=>{x.includes(R)||x.push(R)});const C=this.performSkillCheck(t,v.type,x);return{action:v.type,description:v.description,check:C,difficulty:this.getDifficultyDescription(C.dc),position:v.position||I+1,totalInSequence:v.totalInSequence||i.length,quantity:v.quantity||1,keyword:v.keyword,isSequence:v.isSequence||!1,fatiguePenalty:_,contextModifiers:o.length>0?o:null}}),m=h.every(v=>v.check.isSuccess),p=h.filter(v=>v.check.degree==="critical failure"),y=h.filter(v=>!v.check.isSuccess);let E="";if(i.length===1)E=`Single action detected: ${h[0].description}`;else{const v=[...new Set(h.map(_=>_.action))];E=`Multiple actions detected: ${h.reduce((_,x)=>_+x.quantity,0)} total actions across ${v.length} different types`}return a&&(E+=` | Context: ${a.description.substring(0,50)}${a.description.length>50?"...":""}`),{possible:!0,actions:h,overallSuccess:m,hasCriticalFailures:p.length>0,criticalFailures:p,failures:y,totalActions:i.length,summary:E,contextInfo:a?{description:a.description,environmentalFeatures:c,npcs:d,circumstances:a.circumstances||[]}:null,suggestion:this.generateActionSuggestion(h,t)}}extractActionsFromDescription(e){var c,d;const t=[],r=e.toLowerCase(),s=[/\b(\d+)\s+(backflips?|somersaults?|cartwheels?|jumps?|leaps?|hops?)\b/gi,/\b(\d+)\s+(punches?|kicks?|strikes?|attacks?|swings?|slashes?)\b/gi,/\b(\d+)\s+(spells?|casts?|magic\s+spells?)\b/gi,/\b(\d+)\s+(dodges?|evades?|parries?|blocks?)\b/gi,/\b(\d+)\s+(climbs?|scales?|swims?)\b/gi,/\b(\d+)\s+(searches?|looks?|examines?)\b/gi,/\b(\d+)\s+(persuades?|intimidates?|deceives?)\b/gi];s.forEach(h=>{var p;let m;for(;(m=h.exec(r))!==null;){const y=parseInt(m[1]),E=m[2],v=this.mapKeywordToActionType(E);if(v)for(let I=0;I<y;I++){const _=this.extractCircumstances(e);t.push({type:v,description:((p=this.actionTypes[v])==null?void 0:p.description)||`${v} action`,circumstances:_,keyword:E,quantity:y,position:I+1,totalInSequence:y})}}}),Object.entries(this.actionTypes).forEach(([h,m])=>{this.getActionKeywords(h).forEach(y=>{if(!t.some(v=>v.type===h)&&r.includes(y)&&!s.some(I=>new RegExp(I.source.replace(/\\d\+/,"\\d+"),"gi").test(r))){const I=this.extractCircumstances(e);t.push({type:h,description:m.description,circumstances:I,keyword:y,quantity:1,position:1,totalInSequence:1})}})}),[/\b(backflip|somersault|cartwheel|jump|leap|hop)\s+(?:and\s+then\s+)?(punch|kick|strike|attack|swing|slash)\b/gi,/\b(punch|kick|strike|attack|swing|slash)\s+(?:and\s+then\s+)?(backflip|somersault|cartwheel|jump|leap|hop)\b/gi,/\b(dodge|evade|parry|block)\s+(?:and\s+then\s+)?(attack|strike|punch|kick)\b/gi,/\b(attack|strike|punch|kick)\s+(?:and\s+then\s+)?(dodge|evade|parry|block)\b/gi].forEach(h=>{var p,y;let m;for(;(m=h.exec(r))!==null;){const E=this.mapKeywordToActionType(m[1]),v=this.mapKeywordToActionType(m[2]);if(E&&v){const I=this.extractCircumstances(e);t.some(_=>_.type===E&&_.keyword===m[1])||t.push({type:E,description:((p=this.actionTypes[E])==null?void 0:p.description)||`${E} action`,circumstances:I,keyword:m[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),t.some(_=>_.type===v&&_.keyword===m[2])||t.push({type:v,description:((y=this.actionTypes[v])==null?void 0:y.description)||`${v} action`,circumstances:I,keyword:m[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}});const a=/\b(\w+)\s+and\s+(\w+)\b/gi;let o;for(;(o=a.exec(r))!==null;){const h=this.mapKeywordToActionType(o[1]),m=this.mapKeywordToActionType(o[2]);if(h&&m){const p=this.extractCircumstances(e);t.some(y=>y.type===h&&y.keyword===o[1])||t.push({type:h,description:((c=this.actionTypes[h])==null?void 0:c.description)||`${h} action`,circumstances:p,keyword:o[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),t.some(y=>y.type===m&&y.keyword===o[2])||t.push({type:m,description:((d=this.actionTypes[m])==null?void 0:d.description)||`${m} action`,circumstances:p,keyword:o[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}return t}mapKeywordToActionType(e){return{punch:"attack",punches:"attack",kick:"attack",kicks:"attack",strike:"attack",strikes:"attack",attack:"attack",attacks:"attack",swing:"attack",swings:"attack",slash:"attack",slashes:"attack",thrust:"attack",thrusts:"attack",backflip:"backflip",backflips:"backflip",somersault:"somersault",somersaults:"somersault",cartwheel:"cartwheel",cartwheels:"cartwheel",jump:"jump",jumps:"jump",leap:"jump",leaps:"jump",hop:"jump",hops:"jump",climb:"climb",climbs:"climb",scale:"climb",scales:"climb",swim:"swim",swims:"swim",dodge:"dodge",dodges:"dodge",evade:"dodge",evades:"dodge",parry:"parry",parries:"parry",block:"parry",blocks:"parry",spell:"spell",spells:"spell",cast:"spell",casts:"spell","magic spell":"spell","magic spells":"spell",persuade:"persuade",persuades:"persuade",intimidate:"intimidate",intimidates:"intimidate",deceive:"deceive",deceives:"deceive",search:"search",searches:"search",look:"search",looks:"search",examine:"search",examines:"search"}[e.toLowerCase()]}getActionKeywords(e){return{attack:["attack","strike","hit","swing","slash","thrust","punch","kick"],spell:["cast","spell","magic","enchant","charm"],dodge:["dodge","evade","avoid","sidestep"],parry:["parry","block","deflect"],backflip:["backflip","back flip"],somersault:["somersault","forward roll"],cartwheel:["cartwheel"],wallRun:["wall run","run up wall"],jump:["jump","leap","hop"],climb:["climb","scale"],swim:["swim"],fly:["fly","levitate","float"],persuade:["persuade","convince","talk into"],intimidate:["intimidate","threaten","scare"],deceive:["deceive","lie","trick"],spot:["spot","see","notice","observe"],listen:["listen","hear"],search:["search","look for","find"],pickLock:["pick lock","lockpick"],disarmTrap:["disarm","trap"],heal:["heal","cure","treat"],craft:["craft","make","create","build"]}[e]||[]}extractCircumstances(e){const t=[];return Object.keys(this.circumstanceModifiers).forEach(r=>{e.includes(r)&&t.push(r)}),t}getDifficultyDescription(e){return e<=5?"Very Easy":e<=10?"Easy":e<=15?"Medium":e<=20?"Hard":e<=25?"Very Hard":"Nearly Impossible"}generateActionSuggestion(e,t){const r=e.filter(i=>!i.check.isSuccess);return r.length===0?"All actions are within your capabilities. Proceed with confidence!":r.map(i=>{const a=i.action;return i.check.degree==="critical failure"?`The ${a} is extremely difficult for you. Consider an alternative approach or ask for help.`:`The ${a} is challenging. You might want to take your time or use better equipment.`}).join(" ")}performActionSequence(e,t,r={}){const s=[];let i=0;for(let c=0;c<t.length;c++){const d=t[c],h=Array.isArray(d.circumstances)?[...d.circumstances]:[];i>0?h.push("with momentum"):i<0&&h.push("while fatigued");const m=this.performSkillCheck(e,d.type,h);s.push({action:d.type,check:m,sequencePosition:c+1}),m.isSuccess?i+=1:i-=2}const a=s.every(c=>c.check.isSuccess),o=s.filter(c=>c.check.degree==="critical failure");return{actions:s,overallSuccess:a,hasCriticalFailures:o.length>0,criticalFailures:o,sequenceLength:t.length,finalModifier:i}}generateActionNarrative(e,t){const{actionType:r,check:s,degree:i}=e;this.actionTypes[r];const a={attack:{"critical success":`${t.name} executes a perfect ${r}, striking with incredible precision!`,"great success":`${t.name} performs an excellent ${r}, hitting the target solidly.`,success:`${t.name} successfully ${r}s the target.`,failure:`${t.name} attempts to ${r} but misses the mark.`,"great failure":`${t.name} completely fails to ${r}, leaving themselves open.`,"critical failure":`${t.name} botches the ${r} spectacularly, potentially harming themselves!`},backflip:{"critical success":`${t.name} performs a flawless backflip, landing gracefully with perfect form!`,"great success":`${t.name} executes a smooth backflip, impressing onlookers.`,success:`${t.name} manages to complete the backflip successfully.`,failure:`${t.name} attempts a backflip but loses balance and stumbles.`,"great failure":`${t.name} fails the backflip badly, landing awkwardly.`,"critical failure":`${t.name} completely fails the backflip, potentially injuring themselves!`},fly:{"critical success":`${t.name} somehow defies gravity and soars through the air with supernatural grace!`,"great success":`${t.name} manages to achieve brief flight through incredible effort!`,success:`${t.name} makes a valiant attempt at flight, achieving a brief hover.`,failure:`${t.name} tries to fly but only manages an awkward hop.`,"great failure":`${t.name} attempts flight but falls flat on their face.`,"critical failure":`${t.name} tries to fly and crashes spectacularly, looking quite foolish!`}},o=a[r]||a.attack;return o[i]||o.failure}performMultipleSkillChecks(e,t,r,s=[],i=null){var y,E,v,I;const a=[];let o=0;const c=1;for(let _=1;_<=r;_++){const x=o*c,C=[...s];o>0&&C.push(`while fatigued (attempt ${_})`);const R=this.performSkillCheck(e,t,C,i),F={...R,attemptNumber:_,fatigueLevel:o,fatiguePenalty:x,adjustedTotalRoll:R.totalRoll-x,adjustedMargin:R.totalRoll-x-R.dc,adjustedSuccess:R.totalRoll-x>=R.dc};a.push(F),o++}const d=a.filter(_=>_.adjustedSuccess).length,h=a.filter(_=>_.adjustedSuccess&&_.adjustedMargin>=10).length,m=a.filter(_=>!_.adjustedSuccess&&_.adjustedMargin<=-10).length,p=d/r*100;return{actionType:t,numberOfAttempts:r,results:a,statistics:{successfulAttempts:d,criticalSuccesses:h,criticalFailures:m,successRate:p,averageRoll:a.reduce((_,x)=>_+x.roll,0)/r,averageTotalRoll:a.reduce((_,x)=>_+x.adjustedTotalRoll,0)/r,bestRoll:Math.max(...a.map(_=>_.adjustedTotalRoll)),worstRoll:Math.min(...a.map(_=>_.adjustedTotalRoll))},character:{name:e.name,level:e.level,[(y=this.actionTypes[t])==null?void 0:y.primaryAbility]:e[(E=this.actionTypes[t])==null?void 0:E.primaryAbility],[(v=this.actionTypes[t])==null?void 0:v.secondaryAbility]:e[(I=this.actionTypes[t])==null?void 0:I.secondaryAbility]}}}performMultipleDiceRolls(e,t,r="standard"){const s=[];for(let d=1;d<=e;d++){let h;switch(r){case"advantage":h=this.rollWithAdvantage();break;case"disadvantage":h=this.rollWithDisadvantage();break;default:h={result:this.rollDie(t),rolls:[this.rollDie(t)],advantage:!1,disadvantage:!1}}s.push({...h,rollNumber:d,sides:t})}const i=s.map(d=>d.result),a=i.reduce((d,h)=>d+h,0)/e,o=Math.max(...i),c=Math.min(...i);return{numberOfRolls:e,sides:t,rollType:r,results:s,statistics:{average:a,max:o,min:c,total:i.reduce((d,h)=>d+h,0),natural20s:i.filter(d=>d===20).length,natural1s:i.filter(d=>d===1).length}}}generateMultipleAttemptsNarrative(e,t){const{actionType:r,numberOfAttempts:s,statistics:i}=e,a=this.actionTypes[r];if(!a)return`${t.name} attempts ${r} ${s} times.`;const o=i.successRate,c=i.criticalSuccesses,d=i.criticalFailures;let h=`${t.name} attempts to ${a.description} ${s} times. `;return o>=80?h+=`They perform exceptionally well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:o>=60?h+=`They perform well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:o>=40?h+=`They have mixed results, succeeding ${i.successfulAttempts} out of ${s} attempts.`:o>=20?h+=`They struggle, only succeeding ${i.successfulAttempts} out of ${s} attempts.`:h+=`They perform poorly, only succeeding ${i.successfulAttempts} out of ${s} attempts.`,c>0&&(h+=` They achieve ${c} spectacular successes!`),d>0&&(h+=` They suffer ${d} embarrassing failures.`),s>10&&(h+=" The repeated attempts take their toll, and fatigue begins to set in."),h}}class Ny{constructor(){this.diceService=new Ay,this.storyRules={redirectPatterns:[{pattern:/\b(?:i\s+)?(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,response:"While impressive acrobatics are possible, let's focus on actions that advance the story. What's your main goal here?",suggestion:"Try describing a more focused action that helps with the current situation."},{pattern:/\b(?:i\s+)?(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,response:"Flight isn't currently possible in this situation. What are you trying to achieve?",suggestion:"Consider climbing, jumping, or finding another way to reach your destination."},{pattern:/\b(?:i\s+)?(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,response:"The quest item isn't just lying around. You'll need to find it through exploration and investigation.",suggestion:"Try searching the area, asking NPCs, or following clues to locate the item."},{pattern:/\b(?:i\s+)?(?:attack|kill|destroy)\s+(?:everyone|all|each)\s+(?:enemy|person|creature)\b/gi,response:"While combat is possible, attacking everyone at once isn't practical. Let's focus on the immediate threat.",suggestion:"Choose a specific target or describe a more strategic approach."}],expandPatterns:[{pattern:/\b(?:i\s+)?(?:search|look|examine)\b/gi,response:"What specifically are you searching for or looking at?",suggestion:"Be more specific about what you're searching for or examining."},{pattern:/\b(?:i\s+)?(?:talk|speak|ask)\b/gi,response:"Who would you like to talk to, and what would you like to discuss?",suggestion:"Specify the person and topic of conversation."},{pattern:/\b(?:i\s+)?(?:go|move|walk)\b/gi,response:"Where would you like to go?",suggestion:"Specify your destination or direction."}],encouragePatterns:[{pattern:/\b(?:i\s+)?(?:investigate|explore|examine)\b/gi,response:"Great! Investigation and exploration are key to advancing the story.",suggestion:"What specific aspect would you like to investigate?"},{pattern:/\b(?:i\s+)?(?:help|assist|aid)\b/gi,response:"Helping others is always a noble choice. Who would you like to help?",suggestion:"Specify who needs help and how you can assist them."},{pattern:/\b(?:i\s+)?(?:negotiate|diplomacy|peace)\b/gi,response:"Diplomacy can often achieve more than violence. Good thinking!",suggestion:"How would you like to approach the negotiation?"}]},this.contextResponses={combat:{impossible:"That action isn't possible in combat. Focus on your available combat options.",difficult:"That's a challenging action in combat. Are you sure you want to attempt it?",strategic:"That's a good strategic choice. How do you want to execute it?"},exploration:{impossible:"That action doesn't make sense in this environment. What are you trying to achieve?",difficult:"That will be challenging given the current circumstances.",strategic:"That's a good approach to exploration. Let's see how it goes."},social:{impossible:"That action isn't appropriate in this social situation.",difficult:"That's a bold social move. Are you prepared for the consequences?",strategic:"That's a good approach to the situation. How do you want to proceed?"}}}validatePlayerAction(e,t,r={}){const s=e.toLowerCase(),i=this.checkImpossibleActions(s);if(!i.possible)return{valid:!1,type:"impossible",response:i.response,suggestion:i.suggestion,diceResult:null};const a=this.checkRedirectPatterns(s);if(a.needsRedirect)return{valid:!1,type:"redirect",response:a.response,suggestion:a.suggestion,diceResult:null};const o=this.checkExpandPatterns(s);if(o.needsExpansion)return{valid:!1,type:"expand",response:o.response,suggestion:o.suggestion,diceResult:null};const c=this.diceService.validateAction(e,t,r);return{valid:!0,type:"valid",response:this.generateValidationResponse(c,t,r),suggestion:c.suggestion,diceResult:c}}checkImpossibleActions(e){for(const t of this.diceService.impossibleActionPatterns)if(t.test(e))return{possible:!1,response:"That action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};return{possible:!0}}checkRedirectPatterns(e){for(const t of this.storyRules.redirectPatterns)if(t.pattern.test(e))return{needsRedirect:!0,response:t.response,suggestion:t.suggestion};return{needsRedirect:!1}}checkExpandPatterns(e){for(const t of this.storyRules.expandPatterns)if(t.pattern.test(e))return{needsExpansion:!0,response:t.response,suggestion:t.suggestion};return{needsExpansion:!1}}generateValidationResponse(e,t,r){if(!e.overallSuccess)return e.actions.filter(c=>!c.check.isSuccess).filter(c=>c.check.degree==="critical failure").length>0?`The actions you described are beyond your current capabilities. ${e.suggestion}`:`The actions you described are challenging but possible. ${e.suggestion}`;const s=this.generateAtmosphericResponse(e,t,r),i=this.extractEntities(s,r);return{story:s,entities:i}}generateAtmosphericResponse(e,t,r){const{actions:s,overallSuccess:i,hasCriticalFailures:a}=e,o=r==null?void 0:r.customContext;let c=this.getAtmosphericElements(o),d=this.calculateTensionLevel(s,a),h="";return s.length===1?h=this.generateSingleActionResponse(s[0],t,c,d):h=this.generateMultiActionResponse(s,t,c,d),o&&o.environmentalFeatures&&(h+=this.addEnvironmentalDetails(o.environmentalFeatures,d)),o&&o.npcs&&(h+=this.addNPCReactions(o.npcs,s,i)),h+=this.addStoryProgressionHook(s,d,o),h}getAtmosphericElements(e){const t={lighting:"dim",weather:"calm",mood:"neutral",tension:"low"};if(!e)return t;const r=e.description.toLowerCase();return(r.includes("dark")||r.includes("shadow"))&&(t.lighting="dark"),(r.includes("bright")||r.includes("sunlight"))&&(t.lighting="bright"),(r.includes("dim")||r.includes("flickering"))&&(t.lighting="dim"),(r.includes("storm")||r.includes("rain"))&&(t.weather="stormy"),(r.includes("fog")||r.includes("mist"))&&(t.weather="foggy"),r.includes("wind")&&(t.weather="windy"),(r.includes("tension")||r.includes("danger"))&&(t.mood="tense"),(r.includes("peaceful")||r.includes("calm"))&&(t.mood="peaceful"),(r.includes("eerie")||r.includes("creepy"))&&(t.mood="eerie"),t}calculateTensionLevel(e,t){let r="low";const s=e.filter(i=>["attack","spell","dodge","parry"].includes(i.action));return s.length>0&&(r="medium"),s.length>2&&(r="high"),t&&(r="critical"),r}generateSingleActionResponse(e,t,r,s){const{action:i,check:a,keyword:o}=e,c=a.isSuccess;a.degree;const d={attack:{success:{low:`${t.name} strikes true, the blow landing with satisfying impact.`,medium:`${t.name}'s weapon finds its mark, the strike ringing out in the ${r.lighting} light.`,high:`${t.name} delivers a devastating blow, the force of the attack echoing through the ${r.weather} air.`,critical:`${t.name} executes a perfect strike, the precision of the attack leaving no room for error.`},failure:{low:`${t.name} swings wide, the attack missing its intended target.`,medium:`${t.name}'s strike goes awry, the weapon clattering against stone or wood.`,high:`${t.name} completely misses, the failed attack leaving them momentarily vulnerable.`,critical:`${t.name} stumbles in their attack, the botched strike nearly causing them to fall.`}},backflip:{success:{low:`${t.name} executes a graceful backflip, landing softly on their feet.`,medium:`${t.name} performs an impressive backflip, the acrobatic feat drawing attention.`,high:`${t.name} completes a spectacular backflip, the display of agility leaving onlookers amazed.`,critical:`${t.name} achieves a flawless backflip, the perfect form and landing drawing gasps of admiration.`},failure:{low:`${t.name} attempts a backflip but loses balance, stumbling slightly.`,medium:`${t.name} fails the backflip, landing awkwardly and looking embarrassed.`,high:`${t.name} completely botches the backflip, falling hard to the ground.`,critical:`${t.name} crashes spectacularly during the backflip, potentially injuring themselves.`}},search:{success:{low:`${t.name} searches carefully, their trained eyes picking up subtle details.`,medium:`${t.name} conducts a thorough search, methodically examining every corner.`,high:`${t.name} performs an exhaustive search, their attention to detail revealing hidden secrets.`,critical:`${t.name} discovers something extraordinary, their keen observation uncovering a crucial clue.`},failure:{low:`${t.name} looks around but finds nothing of interest.`,medium:`${t.name} searches but misses several obvious details.`,high:`${t.name} fails to notice important clues, their search proving fruitless.`,critical:`${t.name} overlooks critical information, their poor search skills costing them dearly.`}},persuade:{success:{low:`${t.name} makes a reasonable argument, their words carrying some weight.`,medium:`${t.name} presents a compelling case, their charisma swaying the listener.`,high:`${t.name} delivers a masterful persuasion, their words impossible to ignore.`,critical:`${t.name} achieves the impossible, their silver tongue turning enemies into allies.`},failure:{low:`${t.name} tries to persuade but fails to make a convincing argument.`,medium:`${t.name}'s attempt at persuasion falls flat, their words lacking impact.`,high:`${t.name} completely fails to persuade, their poor communication skills evident.`,critical:`${t.name} not only fails to persuade but manages to offend the listener.`}}},h=d[i]||d.attack,m=c?"success":"failure",p=s==="critical"?"high":s;return h[m][p]}generateMultiActionResponse(e,t,r,s){const i=e.length,a=e.filter(c=>c.check.isSuccess).length,o=i-a;return a===i?`${t.name} executes a flawless sequence of actions, each movement flowing seamlessly into the next. The display of skill and coordination is impressive to behold.`:a>o?`${t.name} performs admirably, with most actions succeeding despite the challenging circumstances. A few missteps don't diminish the overall effectiveness.`:o>a?`${t.name} struggles with the complex sequence, many actions failing to achieve their intended results. The difficulty of the task proves overwhelming.`:`${t.name} has mixed results, with some actions succeeding while others fail. The outcome remains uncertain.`}addEnvironmentalDetails(e,t){if(e.length===0)return"";const r={dark:{low:" The darkness seems to swallow sound, making every movement feel more significant.",medium:" Shadows dance in the darkness, creating an atmosphere of uncertainty.",high:" The oppressive darkness makes every action feel more dangerous and urgent.",critical:" The pitch-black environment amplifies every sound, every movement potentially deadly."},stormy:{low:" Rain patters against surfaces, adding a rhythmic backdrop to the scene.",medium:" The storm intensifies, wind and rain making movement more challenging.",high:" The raging storm creates a chaotic environment where every action is a gamble.",critical:" The violent storm threatens to overwhelm all but the most determined efforts."},foggy:{low:" Mist swirls gently, obscuring distant details.",medium:" The fog thickens, reducing visibility and creating an eerie atmosphere.",high:" Dense fog makes navigation difficult and every shadow a potential threat.",critical:" The impenetrable fog isolates you completely, each step into the unknown."}};let s="";return e.forEach(i=>{r[i]&&(s+=r[i][t]||"")}),s}addNPCReactions(e,t,r){if(e.length===0)return"";const s=e.map(i=>i.name).join(" and ");return r?` ${s} watch with growing interest, clearly impressed by your actions.`:` ${s} exchange concerned glances, their confidence in your abilities wavering.`}addStoryProgressionHook(e,t,r){const s=e.some(o=>["attack","spell","dodge","parry"].includes(o.action)),i=e.some(o=>["search","climb","jump"].includes(o.action)),a=e.some(o=>["persuade","intimidate","deceive"].includes(o.action));return s&&t==="high"?" The tension in the air is palpable. Something is about to happen...":i?" Your investigation reveals new possibilities. What will you discover next?":a?" The social dynamics shift with your words. How will others respond?":" The situation continues to unfold. What will you do next?"}generateStoryResponse(e,t,r={}){const s=this.validatePlayerAction(e,t,r);if(!s.valid)return{response:s.response,suggestion:s.suggestion,shouldProceed:!1,diceResult:null};const i=[];return s.diceResult.actions&&s.diceResult.actions.forEach(a=>{const o=this.diceService.generateActionNarrative(a.check,t);i.push(o)}),{response:i.join(" "),suggestion:s.suggestion,shouldProceed:!0,diceResult:s.diceResult}}handleComplexAction(e,t,r={}){const s=this.diceService.extractActionsFromDescription(e.toLowerCase());if(s.length===0)return{response:"I understand your intent. Let's see how this plays out in the story.",shouldProceed:!0,type:"narrative"};if(s.length===1)return this.generateStoryResponse(e,t,r);const i=this.diceService.performActionSequence(t,s,r);return i.overallSuccess?{response:i.actions.map(o=>this.diceService.generateActionNarrative(o.check,t)).join(" "),shouldProceed:!0,type:"sequence",diceResult:i}:i.actions.filter(c=>!c.check.isSuccess).filter(c=>c.check.degree==="critical failure").length>0?{response:"The sequence of actions you described is too complex for your current abilities. Try breaking it down into simpler steps.",shouldProceed:!1,type:"sequence_failure",diceResult:i}:{response:"Some parts of your action sequence are challenging. You might want to simplify your approach.",shouldProceed:!1,type:"sequence_partial",diceResult:i}}provideAlternatives(e,t,r={}){const s=e.toLowerCase(),i=[];return(s.includes("backflip")||s.includes("somersault"))&&i.push({action:"dodge",description:"Try dodging or evading instead of acrobatics",difficulty:"easier"}),(s.includes("fly")||s.includes("levitate"))&&i.push({action:"climb",description:"Try climbing or finding another way up",difficulty:"realistic"}),s.includes("attack everyone")&&i.push({action:"focus",description:"Focus on one target at a time for better effectiveness",difficulty:"strategic"}),s.includes("grab quest item")&&i.push({action:"search",description:"Search the area thoroughly to find the item",difficulty:"appropriate"}),i}maintainStoryCoherence(e,t,r){const s={storyPhase:this.checkStoryPhase(e,t),establishedFacts:this.checkEstablishedFacts(e,t),plotAdvancement:this.checkPlotAdvancement(e,t),characterDevelopment:this.checkCharacterDevelopment(e,r)},i=Object.entries(s).filter(([a,o])=>!o.valid).map(([a,o])=>o.issue);return{coherent:i.length===0,issues:i,suggestions:this.generateCoherenceSuggestions(i,t)}}checkStoryPhase(e,t){const r=t.phase||"exploration",s=e.toLowerCase(),o=({introduction:["attack","kill","destroy"],exploration:["end quest","skip to boss"],combat:["negotiate peace","run away"],resolution:["start new quest","begin adventure"]}[r]||[]).some(c=>s.includes(c));return{valid:!o,issue:o?`This action doesn't fit the current story phase (${r})`:null}}checkEstablishedFacts(e,t){const r=t.establishedFacts||[],s=e.toLowerCase();for(const i of r)if(i.contradicts&&i.contradicts.some(a=>s.includes(a.toLowerCase())))return{valid:!1,issue:`This action contradicts established story facts: ${i.description}`};return{valid:!0}}checkPlotAdvancement(e,t){const r=t.plotPoints||[],s=e.toLowerCase(),i=r.find(a=>a.active);return i&&i.keywords&&!i.keywords.some(o=>s.includes(o.toLowerCase()))?{valid:!1,issue:"This action doesn't address the current plot point"}:{valid:!0}}checkCharacterDevelopment(e,t){const r=t.alignment||"Neutral",s=e.toLowerCase(),o=({"Lawful Good":["steal","deceive","harm innocent"],"Chaotic Evil":["help others","follow rules","show mercy"],"Neutral Good":["harm innocent","betray allies"],"Lawful Evil":["break laws","show mercy","help weak"],"Chaotic Good":["follow strict rules","harm innocent"],"True Neutral":["take extreme actions","show strong emotions"],"Lawful Neutral":["break laws","show mercy","act chaotically"],"Neutral Evil":["help others","follow laws","show mercy"],"Chaotic Neutral":["follow strict rules","show strong loyalty"]}[r]||[]).some(c=>s.includes(c));return{valid:!o,issue:o?`This action doesn't align with your character's alignment (${r})`:null}}generateCoherenceSuggestions(e,t){const r=[];return e.forEach(s=>{s.includes("story phase")?r.push("Consider actions that fit the current phase of the story."):s.includes("established facts")?r.push("Remember what has already been established in the story."):s.includes("plot point")?r.push("Focus on actions that advance the current plot."):s.includes("alignment")&&r.push("Consider actions that align with your character's moral compass.")}),r}extractEntities(e,t={}){const r={enemies:[],items:[],locations:[],statusEffects:[],questHooks:[],npcs:[]};return e.toLowerCase(),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:the\s+)?(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster|boss|mini-boss)/gi,/\b(goblin|orc|troll|dragon|bandit|skeleton|zombie|ghost|spirit|demon|devil|fiend|beast|creature|monster)\b/gi,/(?:mini-boss|boss)\s*[-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/\[Combat\s+Trigger[^]]*[-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\]/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.enemies.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.enemies.push({name:p,type:"enemy",subtype:this.determineEnemySubtype(p,e),status:this.determineEnemyStatus(p,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:of\s+[A-Z][a-z]+)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:sword|dagger|staff|wand|scroll|potion|ring|amulet|crown|robe|armor|shield)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cursed|forbidden|ancient|legendary)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.items.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.items.push({name:p,type:"item",subtype:this.determineItemSubtype(p,e),status:this.determineItemStatus(p,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:shrine|temple|castle|tower|dungeon|cave|tunnel|chamber|room|hall|garden|forest|mountain|river|lake|ocean|tavern|inn)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cliffs|beach|island|valley|peak|summit|depths|heights)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.locations.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.locations.push({name:p,type:"location",subtype:this.determineLocationSubtype(p,e),tags:this.determineLocationTags(p,e)})}}),[/(?:cursed|blessed|enchanted|poisoned|paralyzed|charmed|frightened|invisible|ethereal|ethereal|flying|levitating)/gi,/(?:in\s+darkness|in\s+bright\s+light|under\s+pressure|in\s+a\s+hurry|carefully|stealthily|aggressively|defensively)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[0];p&&!r.statusEffects.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.statusEffects.push({name:p,type:"status_effect",effect:this.determineStatusEffect(p,e)})}}),[/(?:break|destroy|find|retrieve|defeat|save|protect|escort|investigate|explore)\s+(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/(?:quest|mission|objective|goal|task|duty|responsibility)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.questHooks.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.questHooks.push({name:p,type:"quest_hook",objective:this.determineQuestObjective(p,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:merchant|trader|noble|lord|lady|king|queen|prince|princess|mayor|priest|shaman|hunter|fisherman|farmer)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:quest\s+giver|guide|mentor|teacher|master)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.npcs.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.npcs.push({name:p,type:"npc",role:this.determineNPCRole(p,e),disposition:"friendly"})}}),r}determineEnemySubtype(e,t){t.toLowerCase();const r=e.toLowerCase();return r.includes("boss")||r.includes("mini-boss")?"boss":r.includes("priest")||r.includes("cleric")?"priest":r.includes("wizard")||r.includes("mage")?"wizard":r.includes("dragon")?"dragon":r.includes("undead")||r.includes("skeleton")||r.includes("zombie")?"undead":r.includes("goblin")||r.includes("orc")||r.includes("troll")?"monster":"enemy"}determineEnemyStatus(e,t){const r=t.toLowerCase();return r.includes("snarls")||r.includes("aggressive")?"hostile":r.includes("defensive")||r.includes("cautious")?"defensive":r.includes("chanting")||r.includes("casting")?"casting":"active"}determineItemSubtype(e,t){const r=e.toLowerCase();return r.includes("sword")||r.includes("dagger")||r.includes("staff")?"weapon":r.includes("potion")||r.includes("scroll")?"consumable":r.includes("ring")||r.includes("amulet")||r.includes("crown")?"accessory":r.includes("armor")||r.includes("robe")||r.includes("shield")?"armor":"item"}determineItemStatus(e,t){const r=t.toLowerCase(),s=e.toLowerCase();return s.includes("cursed")||r.includes("cursed")?"cursed":s.includes("forbidden")||r.includes("forbidden")?"forbidden":s.includes("ancient")||r.includes("ancient")?"ancient":s.includes("legendary")||r.includes("legendary")?"legendary":r.includes("magical")||r.includes("enchanted")?"magical":"normal"}determineLocationSubtype(e,t){const r=e.toLowerCase();return r.includes("shrine")||r.includes("temple")?"religious":r.includes("castle")||r.includes("tower")?"fortification":r.includes("cave")||r.includes("tunnel")?"underground":r.includes("forest")||r.includes("garden")?"natural":r.includes("tavern")||r.includes("inn")?"settlement":"location"}determineLocationTags(e,t){const r=[],s=t.toLowerCase();return(s.includes("ancient")||s.includes("old"))&&r.push("ancient"),(s.includes("dangerous")||s.includes("hostile"))&&r.push("dangerous"),(s.includes("sacred")||s.includes("holy"))&&r.push("sacred"),(s.includes("cursed")||s.includes("evil"))&&r.push("cursed"),(s.includes("coastal")||s.includes("ocean"))&&r.push("coastal"),(s.includes("mountain")||s.includes("high"))&&r.push("mountainous"),r}determineStatusEffect(e,t){const r=e.toLowerCase();return r.includes("cursed")?"disables healing":r.includes("poisoned")?"damage over time":r.includes("paralyzed")?"prevents movement":r.includes("charmed")?"mind control":r.includes("invisible")?"stealth bonus":r.includes("flying")?"flight ability":"unknown effect"}determineQuestObjective(e,t){const r=e.toLowerCase();return r.includes("break")||r.includes("destroy")?"destruction":r.includes("find")||r.includes("retrieve")?"retrieval":r.includes("defeat")||r.includes("kill")?"combat":r.includes("save")||r.includes("protect")?"protection":r.includes("escort")?"escort":r.includes("investigate")||r.includes("explore")?"exploration":"objective"}determineNPCRole(e,t){const r=e.toLowerCase();return r.includes("merchant")||r.includes("trader")?"merchant":r.includes("noble")||r.includes("lord")||r.includes("lady")?"noble":r.includes("king")||r.includes("queen")?"royalty":r.includes("priest")||r.includes("shaman")?"religious":r.includes("quest giver")||r.includes("guide")?"quest_giver":"npc"}}const RV=new Ny,Om=new Ay;function jV(){const n=fr(),[e,t]=k.useState(""),[r,s]=k.useState(""),[i,a]=k.useState(null),[o,c]=k.useState(!1),[d,h]=k.useState(!1),[m,p]=k.useState(!1),[y,E]=k.useState(null),[v,I]=k.useState(null),[_,x]=k.useState(null),[C,R]=k.useState("Fighter"),F=[{name:"Drowned Priest Boss Fight",storyContext:"In a dark, misty swamp, a Drowned Priest emerges from the murky water, chanting dark spells. The air is thick with malevolence as undead minions rise from the depths. The water bubbles with dark energy, and the priest's glowing eyes pierce through the fog.",suggestedAction:"I charge forward and attack the Drowned Priest with my sword"},{name:"Forest Ambush",storyContext:"The party is traveling through a dense forest when suddenly, goblin archers emerge from the trees above. The forest floor is covered in fallen leaves that crunch underfoot, and the canopy blocks most of the sunlight. The goblins are well-hidden in the branches, their green skin blending with the foliage.",suggestedAction:"I take cover behind a large tree and cast a fireball at the goblin archers"},{name:"Tavern Brawl",storyContext:"A rowdy group of bandits has taken over the local tavern, threatening the patrons. The tavern is filled with overturned tables, broken chairs, and spilled ale. The bandit leader, a scarred warrior with a wicked grin, stands on the bar counter brandishing his sword.",suggestedAction:"I leap over a table and tackle the bandit leader to the ground"}],T={Fighter:{id:"test_fighter_1",name:"Test Fighter",level:5,class:"Fighter",strength:18,dexterity:14,constitution:16,intelligence:10,wisdom:10,charisma:12,hp:45,maxHp:45,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Longsword",damageBonus:2},armor:{name:"Chain Mail",defenseBonus:4},shield:{name:"Shield",defenseBonus:2}}},Wizard:{id:"test_wizard_1",name:"Test Wizard",level:5,class:"Wizard",strength:8,dexterity:14,constitution:12,intelligence:18,wisdom:12,charisma:10,hp:32,maxHp:32,ac:14,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["spell","attack","defend"],equipment:{weapon:{name:"Staff",damageBonus:0},armor:{name:"Robe",defenseBonus:2},focus:{name:"Arcane Focus",spellBonus:1}}},Rogue:{id:"test_rogue_1",name:"Test Rogue",level:5,class:"Rogue",strength:12,dexterity:18,constitution:14,intelligence:12,wisdom:10,charisma:14,hp:38,maxHp:38,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Daggers",damageBonus:1},armor:{name:"Leather Armor",defenseBonus:2},tools:{name:"Thieves Tools",utilityBonus:2}}},Cleric:{id:"test_cleric_1",name:"Test Cleric",level:5,class:"Cleric",strength:14,dexterity:10,constitution:16,intelligence:12,wisdom:18,charisma:12,hp:42,maxHp:42,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["spell","attack","defend"],equipment:{weapon:{name:"Mace",damageBonus:1},armor:{name:"Scale Mail",defenseBonus:3},holySymbol:{name:"Holy Symbol",spellBonus:1}}},Ranger:{id:"test_ranger_1",name:"Test Ranger",level:5,class:"Ranger",strength:14,dexterity:16,constitution:14,intelligence:12,wisdom:16,charisma:10,hp:40,maxHp:40,ac:15,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Longbow",damageBonus:1},armor:{name:"Studded Leather",defenseBonus:2},companion:{name:"Wolf Companion",utilityBonus:1}}},Paladin:{id:"test_paladin_1",name:"Test Paladin",level:5,class:"Paladin",strength:16,dexterity:10,constitution:16,intelligence:10,wisdom:12,charisma:16,hp:44,maxHp:44,ac:17,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","defend"],equipment:{weapon:{name:"Greatsword",damageBonus:2},armor:{name:"Plate Mail",defenseBonus:5},holySymbol:{name:"Holy Symbol",spellBonus:1}}}}[C],b=ee=>{s(ee.storyContext),t(ee.suggestedAction)},A=async()=>{if(e.trim())try{const ee={environmentalFeatures:S(r),npcs:Be(r),circumstances:Fe(r)},H=RV.validatePlayerAction(e,T,ee);E(H);const ne=P(e,r,H);if(ne.shouldInitiate){const pe=D(ne.enemyType,ne.specificEnemyName);if(console.log("Combat detected, generated enemies:",pe),a({type:"combat",message:` Combat Detected! ${ne.reason==="action_triggered_combat"?"Your action has triggered combat with the enemies in the area.":"The situation has escalated to combat."}`,context:ee,enemyType:ne.enemyType,enemies:pe,storyContext:r}),H.valid&&H.diceResult){const Ue=(H.diceResult.actions||[]).filter(oe=>oe.type!==void 0);if(Ue.length>0){const oe=Om.performActionSequence(T,Ue,ee);I(oe),h(!0)}}}else if(H.valid){if(H.diceResult){const Ue=(H.diceResult.actions||[]).filter(oe=>oe.type!==void 0);if(Ue.length>0){const oe=Om.performActionSequence(T,Ue,ee);I(oe),h(!0)}else a({type:"invalid",message:"No valid actions detected. Try a different action or rephrase your input.",context:ee})}else a({type:"simple",message:`The ${T.name} performs the action successfully.`,context:ee});const pe=N(H,T,ee);a(Ue=>({...Ue,message:pe}))}else{const pe=N(H,T,ee);a({type:"invalid",message:pe,context:ee})}c(!0)}catch(ee){console.error("Error processing test message:",ee),a({type:"error",message:"An error occurred while processing your action."})}},P=(ee,H,ne)=>{var It,xt;const pe=["attack","fight","battle","combat","strike","slash","stab","shoot","cast spell","fire spell","magic"],Ue=["enemy","monster","goblin","orc","troll","dragon","bandit","skeleton","zombie","priest","boss","creature","beast","fiend","demon","devil","ghost","spirit","undead","abomination","horror","terror","nightmare","phantom","specter","wraith","lich","vampire","werewolf","shapeshifter","elemental","construct"],oe=pe.some(it=>ee.toLowerCase().includes(it)),ge=H.toLowerCase(),X=Ue.some(it=>ge.includes(it))||ge.includes("hostile")||ge.includes("aggressive")||ge.includes("snarls")||ge.includes("chanting")||ge.includes("combat trigger")||ge.includes("mini-boss")||ge.includes("boss")||/\b(?:the\s+)?(\w+)\s+(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster)\b/i.test(H)||ge.includes("raises")&&ge.includes("staff")||ge.includes("emerges")&&ge.includes("mist")||ge.includes("glowing")&&ge.includes("eyes"),Me=(xt=(It=ne==null?void 0:ne.diceResult)==null?void 0:It.actions)==null?void 0:xt.some(it=>["attack","spell","dodge","parry","cast"].includes(it.action));let _e="bandit",Ye=null;const z=H.match(/\b(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster|boss)\b/i);return z&&(Ye=z[1]),ge.includes("drowned priest")&&(Ye="Drowned Priest",_e="priest"),ge.includes("goblin")?_e="goblin":ge.includes("orc")?_e="orc":ge.includes("troll")?_e="troll":ge.includes("dragon")?_e="dragon":ge.includes("undead")||ge.includes("skeleton")||ge.includes("zombie")?_e="skeleton":ge.includes("priest")||ge.includes("cleric")||ge.includes("paladin")?_e="priest":ge.includes("wizard")||ge.includes("mage")||ge.includes("sorcerer")?_e="wizard":ge.includes("dragon")||ge.includes("wyrm")||ge.includes("wyvern")?_e="dragon":(ge.includes("boss")||ge.includes("mini-boss"))&&(_e="boss"),Ye&&_e==="bandit"&&(_e="boss"),{shouldInitiate:oe&&X||Me&&X,reason:oe?"action_triggered_combat":"context_triggered_combat",enemyType:_e,specificEnemyName:Ye}},D=(ee="bandit",H=null)=>{const ne={goblin:{name:"Goblin",hp:12,ac:14,level:1,strength:8,dexterity:14,constitution:10,intelligence:10,wisdom:8,charisma:8},orc:{name:"Orc",hp:30,ac:16,level:3,strength:16,dexterity:12,constitution:16,intelligence:7,wisdom:11,charisma:10},troll:{name:"Troll",hp:84,ac:15,level:5,strength:18,dexterity:13,constitution:20,intelligence:7,wisdom:9,charisma:7},dragon:{name:"Dragon",hp:200,ac:19,level:10,strength:27,dexterity:14,constitution:25,intelligence:16,wisdom:13,charisma:15},bandit:{name:"Bandit",hp:16,ac:12,level:1,strength:12,dexterity:12,constitution:12,intelligence:10,wisdom:10,charisma:10},skeleton:{name:"Skeleton",hp:13,ac:13,level:1,strength:10,dexterity:14,constitution:15,intelligence:6,wisdom:8,charisma:5},zombie:{name:"Zombie",hp:22,ac:8,level:1,strength:13,dexterity:6,constitution:16,intelligence:3,wisdom:6,charisma:5},priest:{name:"Priest",hp:45,ac:16,level:5,strength:12,dexterity:10,constitution:14,intelligence:12,wisdom:16,charisma:14},wizard:{name:"Wizard",hp:40,ac:15,level:5,strength:9,dexterity:14,constitution:12,intelligence:16,wisdom:12,charisma:10},boss:{name:"Boss",hp:120,ac:18,level:8,strength:18,dexterity:16,constitution:18,intelligence:14,wisdom:16,charisma:16},undead:{name:"Undead",hp:15,ac:12,level:1,strength:12,dexterity:10,constitution:14,intelligence:6,wisdom:8,charisma:5}},pe=ne[ee]||ne.bandit;let Ue=1,oe=!1;H||ee==="boss"?(oe=!0,Ue=1):Ue=Math.min(3,4);const ge=[];for(let X=0;X<Ue;X++){let Me,_e=pe.hp,Ye=pe.ac,z=pe.level,It=ee;H?(Me=H,_e=Math.max(pe.hp*2,80),Ye=pe.ac+2,z=Math.max(pe.level+2,7),It="boss"):oe?(Me="Drowned Priest",_e=Math.max(pe.hp*2,80),Ye=pe.ac+2,z=Math.max(pe.level+2,7),It="boss"):(Me=`${pe.name} ${X+1}`,_e=pe.hp+Math.floor(Math.random()*10),Ye=pe.ac+Math.floor(Math.random()*3)),ge.push({id:`enemy_${X}`,name:Me,type:pe.name,class:It,hp:_e,maxHp:_e,ac:Ye,level:z,strength:pe.strength,dexterity:pe.dexterity,constitution:pe.constitution,intelligence:pe.intelligence,wisdom:pe.wisdom,charisma:pe.charisma,initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","special","defend"]})}if(H==="Drowned Priest"||oe&&ee==="priest")for(let Me=0;Me<2;Me++){const _e=15+Math.floor(Math.random()*8);ge.push({id:`enemy_minion_${Me}`,name:`Undead Minion ${Me+1}`,type:"Skeleton",class:"undead",hp:_e,maxHp:_e,ac:12+Math.floor(Math.random()*3),level:1,strength:12,dexterity:10,constitution:14,intelligence:6,wisdom:8,charisma:5,initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","defend"]})}return ge},N=(ee,H,ne)=>{const{environmentalFeatures:pe,npcs:Ue,circumstances:oe}=ne,ge=Ue.some(Me=>Me.role==="enemy")||pe.some(Me=>["dangerous","hostile","threatening","eerie","creepy"].includes(Me));let X="";if(ee.valid)if(ee.diceResult){const Me=ee.diceResult.actions||[],_e=Me.length;if(ge){if(X=`The ${H.name} ${Me.map(z=>z.action).join(" and ")} with determination. `,pe.length>0){const z=pe.filter(It=>["dark","fog","mist","eerie","creepy","dangerous"].includes(It));z.length>0&&(X+=`The ${z.join(" and ")} ${z.length===1?"adds":"add"} to the tension. `)}const Ye=Ue.filter(z=>z.role==="enemy");if(Ye.length>0){const z=Ye.map(It=>It.name).join(", ");X+=`${z} ${Ye.length===1?"reacts":"react"} with ${["hostility","anger","defiance","malice"].sort(()=>.5-Math.random())[0]}. `}_e>1&&(X+="Multiple actions detected - this complex maneuver will require precise timing and coordination. "),X+=`

The outcome hangs in the balance. Roll the dice to determine your fate.`}else{if(X=`The ${H.name} prepares to ${Me.map(Ye=>Ye.action).join(" and ")}. `,_e>1&&(X+="Multiple actions detected - this will require careful coordination and may incur fatigue penalties. "),pe.length>0&&(X+=`The ${pe.join(" and ")} ${pe.length===1?"affects":"affect"} the situation. `),Ue.length>0){const Ye=Ue.map(z=>z.name).join(", ");X+=`${Ye} ${Ue.length===1?"watches":"watch"} with interest. `}oe.length>0&&(X+=`The circumstances (${oe.join(", ")}) ${oe.length===1?"adds":"add"} complexity to the action. `),X+=`

Roll the dice to determine the outcome of this challenging action.`}}else if(ge){X=`${H.name}'s action is straightforward but the situation remains tense. `;const Me=Ue.filter(_e=>_e.role==="enemy");if(Me.length>0){const _e=Me.map(Ye=>Ye.name).join(", ");X+=`${_e} ${Me.length===1?"maintains":"maintain"} a defensive stance. `}X+=`

The action proceeds, but danger still lurks nearby.`}else{if(X=`${H.name}'s action is straightforward and doesn't require a skill check. `,pe.length>0&&(X+=`The ${pe.join(" and ")} ${pe.length===1?"provides":"provide"} a suitable backdrop. `),Ue.length>0){const Me=Ue.map(_e=>_e.name).join(", ");X+=`${Me} ${Ue.length===1?"responds":"respond"} appropriately to the action. `}X+=`

The action proceeds smoothly.`}else ge?(X="The proposed action doesn't seem feasible in this dangerous situation. ",ee.reason&&(X+=`${ee.reason} `),X+=`

In combat, every action must be precise and deliberate. Consider a different approach.`):(X="The proposed action doesn't seem feasible. ",ee.reason&&(X+=`${ee.reason} `),X+=`

Try a different approach or rephrase your action.`);return X},S=ee=>{if(!ee)return[];const H=ee.toLowerCase(),ne=[];return(H.includes("dark")||H.includes("shadow"))&&ne.push("darkness"),(H.includes("fog")||H.includes("mist"))&&ne.push("fog"),(H.includes("forest")||H.includes("tree"))&&ne.push("forest"),(H.includes("cave")||H.includes("cavern"))&&ne.push("cave"),(H.includes("tavern")||H.includes("inn"))&&ne.push("tavern"),(H.includes("castle")||H.includes("fortress"))&&ne.push("castle"),(H.includes("dungeon")||H.includes("underground"))&&ne.push("dungeon"),(H.includes("water")||H.includes("swamp"))&&ne.push("water"),(H.includes("fire")||H.includes("flame"))&&ne.push("fire"),(H.includes("ice")||H.includes("cold"))&&ne.push("ice"),(H.includes("wind")||H.includes("storm"))&&ne.push("wind"),(H.includes("eerie")||H.includes("creepy"))&&ne.push("eerie"),(H.includes("dangerous")||H.includes("hostile"))&&ne.push("dangerous"),ne},Be=ee=>{if(!ee)return[];const H=[],ne=ee.toLowerCase();return ne.includes("drowned priest")&&H.push({name:"Drowned Priest",role:"enemy",type:"boss"}),ne.includes("goblin")&&H.push({name:"Goblin Archers",role:"enemy",type:"goblin"}),ne.includes("bandit")&&H.push({name:"Bandit Leader",role:"enemy",type:"bandit"}),(ne.includes("undead")||ne.includes("skeleton")||ne.includes("zombie"))&&H.push({name:"Undead Minions",role:"enemy",type:"undead"}),(ne.includes("patron")||ne.includes("customer"))&&H.push({name:"Tavern Patrons",role:"friendly",type:"civilian"}),(ne.includes("party")||ne.includes("companion"))&&H.push({name:"Party Members",role:"ally",type:"adventurer"}),H},Fe=ee=>{if(!ee)return[];const H=[],ne=ee.toLowerCase();return(ne.includes("dark")||ne.includes("night"))&&H.push("low visibility"),(ne.includes("wet")||ne.includes("slippery"))&&H.push("difficult footing"),(ne.includes("crowded")||ne.includes("tight"))&&H.push("confined space"),(ne.includes("noisy")||ne.includes("loud"))&&H.push("distracting environment"),(ne.includes("hurry")||ne.includes("rush"))&&H.push("time pressure"),(ne.includes("stealth")||ne.includes("sneak"))&&H.push("stealth required"),H},$e=()=>{c(!1)},Pe=()=>{h(!1)},Y=async()=>{var ee,H;if((i==null?void 0:i.type)==="combat")console.log("Combat detected, preparing to navigate with data:",{partyMembers:[T],enemies:i.enemies,storyContext:i.storyContext,enemyCount:(ee=i.enemies)==null?void 0:ee.length}),n("/combat",{state:{isTestCombat:!0,partyMembers:[T],enemies:i.enemies,storyContext:i.storyContext}});else if(v&&v.actions&&v.actions.length>1){const ne=Om.performMultipleSkillChecks(T,"attack",3,((H=i==null?void 0:i.context)==null?void 0:H.circumstances)||[]);x(ne),p(!0)}h(!1)},ae=()=>{c(!1),h(!1),a(null)},Se=()=>{n("/dashboard")};return l.jsx("div",{className:"min-h-screen bg-gray-900",children:l.jsxs("div",{className:"fantasy-container",children:[l.jsxs("div",{className:"mb-6 sm:mb-8",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[l.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-100",children:"Test Environment"}),l.jsx("button",{onClick:Se,className:"fantasy-button bg-blue-600 hover:bg-blue-700",children:"Back to Dashboard"})]}),l.jsx("p",{className:"text-gray-300 mt-2 text-sm sm:text-base",children:"Test action validation, dice rolling, and combat detection in a controlled environment."})]}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8",children:[l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-class",className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Class"}),l.jsxs("select",{id:"character-class",value:C,onChange:ee=>R(ee.target.value),className:"fantasy-input",children:[l.jsx("option",{value:"Fighter",children:" Fighter"}),l.jsx("option",{value:"Wizard",children:" Wizard"}),l.jsx("option",{value:"Rogue",children:" Rogue"}),l.jsx("option",{value:"Cleric",children:" Cleric"}),l.jsx("option",{value:"Ranger",children:" Ranger"}),l.jsx("option",{value:"Paladin",children:" Paladin"})]}),l.jsxs("div",{className:"mt-3 p-3 bg-gray-700 border border-gray-600 rounded-lg",children:[l.jsx("h4",{className:"font-semibold text-gray-100 mb-2",children:T.name}),l.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[l.jsxs("div",{children:[l.jsx("strong",{className:"text-gray-200",children:"HP:"})," ",l.jsxs("span",{className:"text-gray-300",children:[T.hp,"/",T.maxHp]})]}),l.jsxs("div",{children:[l.jsx("strong",{className:"text-gray-200",children:"AC:"})," ",l.jsx("span",{className:"text-gray-300",children:T.ac})]}),l.jsxs("div",{children:[l.jsx("strong",{className:"text-gray-200",children:"STR:"})," ",l.jsx("span",{className:"text-gray-300",children:T.strength})]}),l.jsxs("div",{children:[l.jsx("strong",{className:"text-gray-200",children:"DEX:"})," ",l.jsx("span",{className:"text-gray-300",children:T.dexterity})]}),l.jsxs("div",{children:[l.jsx("strong",{className:"text-gray-200",children:"CON:"})," ",l.jsx("span",{className:"text-gray-300",children:T.constitution})]}),l.jsxs("div",{children:[l.jsx("strong",{className:"text-gray-200",children:"INT:"})," ",l.jsx("span",{className:"text-gray-300",children:T.intelligence})]}),l.jsxs("div",{children:[l.jsx("strong",{className:"text-gray-200",children:"WIS:"})," ",l.jsx("span",{className:"text-gray-300",children:T.wisdom})]}),l.jsxs("div",{children:[l.jsx("strong",{className:"text-gray-200",children:"CHA:"})," ",l.jsx("span",{className:"text-gray-300",children:T.charisma})]})]}),l.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:[l.jsx("strong",{children:"Equipment:"})," ",T.equipment.weapon.name,", ",T.equipment.armor.name]})]})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"test-scenarios",className:"block text-sm font-medium text-gray-200 mb-2",children:"Quick Test Scenarios"}),l.jsx("div",{id:"test-scenarios",className:"space-y-2",children:F.map((ee,H)=>l.jsxs("button",{onClick:()=>b(ee),className:"w-full p-3 text-left bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 transition-colors",children:[l.jsx("div",{className:"font-medium text-gray-100",children:ee.name}),l.jsxs("div",{className:"text-sm text-gray-300 mt-1",children:[ee.storyContext.substring(0,80),"..."]})]},H))})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"story-context",className:"block text-sm font-medium text-gray-200 mb-2",children:"Story Context"}),l.jsx("textarea",{id:"story-context",value:r,onChange:ee=>s(ee.target.value),placeholder:"Describe the environment, NPCs, and circumstances. For example: 'In a dark, misty swamp, a Drowned Priest emerges from the water, chanting dark spells. The air is thick with malevolence.'",className:"fantasy-input h-32 resize-none"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-action",className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Action"}),l.jsx("textarea",{id:"character-action",value:e,onChange:ee=>t(ee.target.value),placeholder:"Describe any action your character would take. The system will analyze it for skill checks, combat actions, or story interactions.",className:"fantasy-input h-24 resize-none"})]}),l.jsx("button",{onClick:A,disabled:!e.trim(),className:"w-full fantasy-button bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed",children:"Test Action"})]}),l.jsx("div",{className:"space-y-6",children:i&&l.jsxs("div",{className:"fantasy-card",children:[l.jsxs("div",{className:"flex items-center mb-4",children:[i.type==="combat"&&l.jsx("span",{className:"text-2xl mr-2",children:""}),l.jsx("h3",{className:"text-lg font-semibold text-gray-100",children:i.type==="combat"?"Combat Detected":i.type==="story"?"Story Response":i.type==="invalid"?"Invalid Action":"Test Result"})]}),l.jsxs("div",{className:"prose max-w-none",children:[l.jsx("p",{className:"text-gray-300 mb-4",children:i.message}),i.type==="combat"&&l.jsxs("div",{className:"bg-red-900/20 border border-red-600 rounded-lg p-4",children:[l.jsx("h4",{className:"text-lg font-bold text-red-400",children:"Combat Initiated!"}),l.jsxs("p",{className:"text-red-300 mb-2",children:["Enemy Type: ",i.enemyType]}),l.jsx("div",{className:"space-y-2",children:i.enemies.map((ee,H)=>l.jsxs("div",{className:"flex justify-between items-center bg-gray-700 p-2 rounded",children:[l.jsx("span",{className:"font-medium text-gray-100",children:ee.name}),l.jsxs("span",{className:"text-sm text-gray-300",children:["HP: ",ee.hp," | AC: ",ee.ac," | Level: ",ee.level]})]},H))}),l.jsx("button",{onClick:()=>n("/combat",{state:{isTestCombat:!0,partyMembers:[T],enemies:i.enemies,storyContext:i.storyContext}}),className:"mt-3 fantasy-button bg-red-600 hover:bg-red-700",children:"Enter Combat"})]}),i.context&&l.jsxs("div",{className:"mt-4 space-y-2",children:[l.jsx("h5",{className:"font-semibold text-gray-100",children:"Context Analysis:"}),i.context.environmentalFeatures.length>0&&l.jsxs("p",{className:"text-gray-300",children:[l.jsx("strong",{children:"Environment:"})," ",i.context.environmentalFeatures.join(", ")]}),i.context.npcs.length>0&&l.jsxs("p",{className:"text-gray-300",children:[l.jsx("strong",{children:"NPCs:"})," ",i.context.npcs.map(ee=>`${ee.name} (${ee.role})`).join(", ")]})]})]})]})})]}),o&&y&&l.jsx(bS,{result:y,onClose:$e,onProceed:Y,onRevise:ae}),d&&v&&l.jsx(ES,{result:v,onClose:Pe,onProceed:Y,onRevise:ae}),m&&_&&l.jsx(PV,{result:_,onClose:()=>p(!1)})]})})}const DV="modulepreload",MV=function(n){return"/DND-V1/"+n},d_={},Fm=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=MV(i),i in d_)return;d_[i]=!0;const a=i.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const m=s[h];if(m.href===i&&(!a||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${o}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":DV,a||(d.as="script",d.crossOrigin=""),d.href=i,document.head.appendChild(d),a)return new Promise((h,m)=>{d.addEventListener("load",h),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i})};class Py{constructor(){this.actionTypes={attack:{name:"Attack",cooldown:0,priority:"normal",description:"A basic physical attack",narrativeTemplate:"{character} {action} with {weapon}!"},spell:{name:"Cast Spell",cooldown:1,priority:"normal",description:"Cast a magical spell",narrativeTemplate:"{character} channels arcane energy into {spell}!"},special:{name:"Special Ability",cooldown:2,priority:"high",description:"Use a special class ability",narrativeTemplate:"{character} unleashes their {ability}!"},item:{name:"Use Item",cooldown:0,priority:"low",description:"Use an item or consumable",narrativeTemplate:"{character} uses {item}!"},defend:{name:"Defend",cooldown:0,priority:"high",description:"Take a defensive stance",narrativeTemplate:"{character} takes a defensive stance!"},environmental:{name:"Environmental Action",cooldown:1,priority:"normal",description:"Use the environment to your advantage",narrativeTemplate:"{character} uses the {environment} to their advantage!"},teamUp:{name:"Team Up",cooldown:3,priority:"high",description:"Coordinate with another party member",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}},this.statusEffects={poisoned:{name:"Poisoned",duration:3,effect:"lose 1 HP per turn",narrative:"is suffering from poison"},burned:{name:"Burned",duration:2,effect:"lose 2 HP per turn",narrative:"is burning with magical flames"},frozen:{name:"Frozen",duration:1,effect:"skip next turn",narrative:"is frozen solid"},paralyzed:{name:"Paralyzed",duration:2,effect:"50% chance to skip turn",narrative:"is paralyzed and can barely move"},confused:{name:"Confused",duration:2,effect:"may attack randomly",narrative:"is confused and disoriented"},blessed:{name:"Blessed",duration:3,effect:"+2 to attack rolls",narrative:"is blessed with divine favor"},hasted:{name:"Hasted",duration:2,effect:"extra action per turn",narrative:"is moving with supernatural speed"}},this.classAbilities={fighter:{name:"Second Wind",description:"Recover some HP",effect:"heal 1d6+2 HP",cooldown:3},wizard:{name:"Arcane Surge",description:"Enhance next spell",effect:"+2 to spell damage",cooldown:2},rogue:{name:"Sneak Attack",description:"Deal extra damage from stealth",effect:"+1d6 damage if target is unaware",cooldown:1},cleric:{name:"Divine Favor",description:"Bless an ally",effect:"target gets +1 to all rolls",cooldown:2}}}initializeCombat(e,t,r){return{combatants:[...e,...t].map(a=>({...a,initiative:this.calculateInitiative(a),statusEffects:[],cooldowns:{},lastAction:null,turnCount:0})).sort((a,o)=>o.initiative-a.initiative),currentTurn:0,round:1,combatState:"active",storyContext:r,environmentalFeatures:this.extractEnvironmentalFeatures(r),teamUpOpportunities:this.identifyTeamUpOpportunities(e),narrativeElements:this.extractNarrativeElements(r)}}async createCombatSession(e,t,r,s){try{const{createCombatSession:i}=await Fm(()=>Promise.resolve().then(()=>yV),void 0),a=await this.getExistingCombatSession(e);if(a)return console.log(" Found existing combat session:",a.id),a;const o=this.preparePartyMembers(t),c=this.prepareEnemies(r),d=this.initializeCombat(o,c,s),h=await i(e,{storyContext:d.storyContext,partyMembers:d.combatants.filter(m=>!m.id.startsWith("enemy_")),enemies:d.combatants.filter(m=>m.id.startsWith("enemy_")),combatants:d.combatants,initiative:d.combatants.map(m=>({id:m.id,name:m.name,initiative:m.initiative})),currentTurn:d.currentTurn,round:d.round,combatState:d.combatState,environmentalFeatures:d.environmentalFeatures,teamUpOpportunities:d.teamUpOpportunities,narrativeElements:d.narrativeElements});return console.log(" Created new combat session:",h.id),h}catch(i){throw console.error(" Error creating combat session:",i),i}}async getExistingCombatSession(e){try{const{collection:t,query:r,where:s,getDocs:i}=await Fm(()=>import("./index.esm-c3eb44da.js"),[]),{db:a}=await Fm(()=>Promise.resolve().then(()=>HM),void 0),o=t(a,"combatSessions"),c=r(o,s("partyId","==",e),s("status","==","active")),d=await i(c);if(!d.empty){const h=d.docs[0];return console.log(" Found existing combat session:",h.id),{id:h.id,...h.data()}}return null}catch(t){return console.error("Error checking for existing combat session:",t),null}}preparePartyMembers(e){return e.map(t=>{var a,o,c,d,h,m,p,y;let r=t.hp,s=t.maxHp;if(!r||!s){const v={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[t.class]||8,I=((a=t.assignedScores)==null?void 0:a.constitution)||10,_=Math.floor((I-10)/2),x=Math.max(1,(v+_)*(t.level||1));r=x,s=x}let i=t.ac;if(!i){const v=((o=t.assignedScores)==null?void 0:o.dexterity)||10,I=Math.floor((v-10)/2),x={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[t.class]||0;i=Math.max(10,10+I+x)}return{...t,hp:r,maxHp:s,ac:i,initiative:Math.floor(Math.random()*20)+1,strength:((c=t.assignedScores)==null?void 0:c.strength)||10,dexterity:((d=t.assignedScores)==null?void 0:d.dexterity)||10,constitution:((h=t.assignedScores)==null?void 0:h.constitution)||10,intelligence:((m=t.assignedScores)==null?void 0:m.intelligence)||10,wisdom:((p=t.assignedScores)==null?void 0:p.wisdom)||10,charisma:((y=t.assignedScores)==null?void 0:y.charisma)||10,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0}})}prepareEnemies(e){return!e||e.length===0?[{id:"enemy_0",name:"Gnoll Pack",hp:20,maxHp:20,ac:12,level:1,class:"enemy",race:"unknown",initiative:Math.floor(Math.random()*20)+1,strength:12,dexterity:10,constitution:12,intelligence:8,wisdom:8,charisma:6},{id:"enemy_1",name:"Gnoll Pack-Leader",hp:25,maxHp:25,ac:14,level:2,class:"enemy",race:"unknown",initiative:Math.floor(Math.random()*20)+1,strength:14,dexterity:12,constitution:14,intelligence:10,wisdom:10,charisma:8}]:e.map((t,r)=>({id:t.id||`enemy_${r}`,name:t.name||`Enemy ${r+1}`,hp:t.hp||20,maxHp:t.maxHp||t.hp||20,ac:t.ac||12,level:t.level||1,class:t.class||"enemy",race:t.race||"unknown",initiative:t.initiative||Math.floor(Math.random()*20)+1,strength:t.strength||12,dexterity:t.dexterity||10,constitution:t.constitution||12,intelligence:t.intelligence||8,wisdom:t.wisdom||8,charisma:t.charisma||6,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0}))}calculateInitiative(e){var s,i,a;let t=Math.floor(Math.random()*20)+1;return t+={rogue:3,monk:2,ranger:1,fighter:0,cleric:0,wizard:-1,paladin:-1}[(s=e.class)==null?void 0:s.toLowerCase()]||0,(i=e.statusEffects)!=null&&i.includes("hasted")&&(t+=5),(a=e.statusEffects)!=null&&a.includes("paralyzed")&&(t-=3),t}extractEnvironmentalFeatures(e){const t=[],r={forest:["trees","cover","difficult terrain"],cave:["darkness","echoes","tight spaces"],tavern:["furniture","crowds","flammable materials"],castle:["stone walls","narrow corridors","defensive positions"],dungeon:["traps","darkness","confined spaces"],outdoors:["weather","open space","natural cover"]},s=e.toLowerCase();return Object.entries(r).forEach(([i,a])=>{s.includes(i)&&t.push(...a)}),t}identifyTeamUpOpportunities(e){const t=[];return[{classes:["fighter","rogue"],description:"Fighter distracts while Rogue sneaks in for a backstab"},{classes:["wizard","cleric"],description:"Wizard casts area spell while Cleric protects the party"},{classes:["fighter","cleric"],description:"Fighter tanks while Cleric provides healing support"},{classes:["rogue","wizard"],description:"Rogue scouts while Wizard provides magical backup"}].forEach(s=>{s.classes.every(a=>e.some(o=>{var c;return((c=o.class)==null?void 0:c.toLowerCase())===a}))&&t.push(s)}),t}extractNarrativeElements(e){return{mood:this.determineCombatMood(e),stakes:this.determineStakes(e),environmentalHazards:this.identifyHazards(e),npcInvolvement:this.extractNPCs(e)}}determineCombatMood(e){const t=e.toLowerCase();return t.includes("desperate")||t.includes("last stand")?"desperate":t.includes("training")||t.includes("practice")?"casual":t.includes("revenge")||t.includes("vengeance")?"vengeful":t.includes("defense")||t.includes("protect")?"defensive":"standard"}determineStakes(e){const t=e.toLowerCase();return t.includes("life")||t.includes("death")||t.includes("kill")?"life_or_death":t.includes("escape")||t.includes("flee")?"escape":t.includes("capture")||t.includes("arrest")?"capture":t.includes("treasure")||t.includes("loot")?"treasure":"standard"}identifyHazards(e){const t=[],r=e.toLowerCase();return(r.includes("fire")||r.includes("flame"))&&t.push("fire"),(r.includes("water")||r.includes("river")||r.includes("lake"))&&t.push("water"),(r.includes("height")||r.includes("cliff")||r.includes("fall"))&&t.push("height"),(r.includes("trap")||r.includes("pit"))&&t.push("traps"),t}extractNPCs(e){const t=[];return[/(\w+)\s+(?:the\s+)?(?:guard|merchant|wizard|knight|rogue|priest)/gi,/(?:named|called)\s+(\w+)/gi].forEach(s=>{[...e.matchAll(s)].forEach(a=>{t.push(a[1])})}),t}async executeAction(e,t,r,s,i={}){var v,I;console.log(" executeAction called with:",{combatantId:t,actionType:r,targetId:s,additionalData:i});const a=e.combatants.find(_=>_.id===t),o=e.combatants.find(_=>_.id===s);if(console.log(" Found combatant and target:",{combatant:a?{name:a.name,hp:a.hp,maxHp:a.maxHp}:null,target:o?{name:o.name,hp:o.hp,maxHp:o.maxHp}:null}),!a||!o)throw new Error("Invalid combatant or target");if(a.cooldowns&&a.cooldowns[r]>0)return{success:!1,message:`${a.name} cannot use ${r} yet (cooldown: ${a.cooldowns[r]} turns)`};const c=this.generateActionNarrative(a,r,o,i),d=this.calculateActionResults(a,r,o,i);console.log(" Action results calculated:",d),this.applyActionEffects(e,a,o,d),this.updateCooldowns(e,a,r);const h=this.checkStatusEffectApplication(a,r,o,d);let m=(e.currentTurn+1)%e.combatants.length,p=0;const y=e.combatants.length;for(;p<y;){const _=e.combatants[m];if(_&&_.hp>0)break;m=(m+1)%e.combatants.length,p++}p>=y&&(console.log(" No alive combatants found, keeping current turn"),m=e.currentTurn);const E={...e,currentTurn:m};return m===0&&(E.round=E.round+1),console.log(" Turn progression in executeAction:",{currentTurn:e.currentTurn,nextTurnIndex:m,totalCombatants:e.combatants.length,nextCombatant:(v=e.combatants[m])==null?void 0:v.name,nextCombatantHp:(I=e.combatants[m])==null?void 0:I.hp,round:E.round,attempts:p}),console.log(" executeAction returning result with damage:",d.damage),console.log(" Target HP after executeAction:",o.hp),console.log(" Updated session currentTurn:",E.currentTurn),{success:!0,narrative:c,results:d,statusEffects:h,environmentalImpact:this.calculateEnvironmentalImpact(e,r,d),targetId:s,updatedSession:E,damage:d.damage,healing:d.healing}}generateActionNarrative(e,t,r,s){let a=this.actionTypes[t].narrativeTemplate;a=a.replace("{character}",e.name),a=a.replace("{action}",this.getActionVerb(t,e.class)),a=a.replace("{weapon}",s.weapon||"their weapon"),a=a.replace("{spell}",s.spell||"a spell"),a=a.replace("{ability}",s.ability||"special ability"),a=a.replace("{item}",s.item||"an item"),a=a.replace("{environment}",s.environment||"surroundings"),a=a.replace("{ally}",s.ally||"ally"),s.specialAttack&&s.specialAttack!=="Standard Action"&&(a=`${e.name} uses ${s.specialAttack}! `+a),s.damageType&&s.damageType!=="physical"&&(a+=` The attack deals ${s.damageType} damage.`);const o=this.getClassFlavor(e.class,t);return o&&(a+=` ${o}`),a}getActionVerb(e,t){var s;return((s={fighter:{attack:"charges forward with a mighty swing",defend:"raises their shield defensively",special:"unleashes their combat expertise"},wizard:{attack:"casts a magical bolt",spell:"weaves arcane energy",special:"channels pure magical power"},rogue:{attack:"strikes from the shadows",defend:"dodges and weaves",special:"executes a perfect sneak attack"},cleric:{attack:"calls upon divine power",spell:"prays for divine intervention",special:"channels holy energy"}}[t==null?void 0:t.toLowerCase()])==null?void 0:s[e])||"performs an action"}getClassFlavor(e,t){var s;return((s={priest:{attack:"Divine energy crackles around their weapon.",spell:"Holy light emanates from their hands.",heal:"A warm, healing glow surrounds them."},wizard:{attack:"Arcane energy flows through their weapon.",spell:"Mystical runes appear in the air.",special:"Ancient magic surges through them."},warrior:{attack:"Their combat training shows in every move.",special:"Years of battle experience guide their strike.",defend:"They adopt a defensive stance with practiced ease."},rogue:{attack:"They move with deadly precision.",special:"Shadow and stealth enhance their attack.",defend:"They dodge and weave with acrobatic grace."},boss:{attack:"Their overwhelming presence fills the battlefield.",special:"Ancient power courses through their veins.",spell:"Reality itself seems to bend to their will."},undead:{attack:"Necrotic energy pulses from their form.",spell:"Death magic swirls around them.",special:"The very air grows cold with their presence."}}[e==null?void 0:e.toLowerCase()])==null?void 0:s[t])||""}calculateActionResults(e,t,r,s){const i={damage:0,healing:0,statusEffects:[],environmentalEffects:[],narrative:"",specialAttack:s.specialAttack||"Standard Action",damageType:s.damageType||"physical",attribute:s.attribute||"strength"};switch(t){case"attack":i.damage=this.calculateAttackDamage(e,r,s);break;case"spell":i.damage=this.calculateSpellDamage(e,r,s);break;case"special":i.damage=this.calculateSpecialDamage(e,r,s);break;case"item":i.healing=this.calculateItemEffect(e,r,s);break;case"defend":i.statusEffects.push({type:"defensive",duration:1});break;case"environmental":i.environmentalEffects=this.calculateEnvironmentalEffects(e,r,s);break;case"teamUp":i.damage=this.calculateTeamUpDamage(e,r,s);break}return i}calculateAttackDamage(e,t,r){console.log(" calculateAttackDamage called for:",{combatant:e.name,target:t.name,combatantClass:e.class,additionalData:r});const s=Math.floor(Math.random()*8)+1,i=Math.floor(((e.strength||10)-10)/2),a=r.weaponBonus||0;console.log(" Base damage calculation:",{baseDamage:s,strengthMod:i,weaponBonus:a,combatantStrength:e.strength||10});let o=1,c=0;if(e.id.startsWith("enemy_")){o=1+(e.level-1)*.3;const d=r.attribute||"strength";c=Math.floor(((e[d]||10)-10)/2);const h=this.calculateEnemyItemBonus(e);let m=0;r.specialAttack&&r.specialAttack!=="Standard Attack"&&(m=Math.floor(Math.random()*4)+2),r.isBossAttack&&(m+=5);let p=(s+i+a+c+h+m)*o;Math.floor(Math.random()*20)+1===20&&(p*=2),console.log(`Enhanced enemy damage calculation for ${e.name}:`,{baseDamage:s,strengthMod:i,weaponBonus:a,attributeMod:c,itemBonus:h,specialBonus:m,levelScaling:o,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,totalDamage:Math.max(1,Math.floor(p))});const y=Math.max(1,Math.floor(p));return console.log(` Enemy ${e.name} final damage: ${y}`),y}else{const d=Math.floor(((e.dexterity||10)-10)/2),h=Math.floor((e.level-1)*.5);let m=s+i+d+a+h;Math.floor(Math.random()*20)+1===20&&(m*=2);const p=Math.max(1,Math.floor(m));return console.log(` Player ${e.name} damage calculation:`,{baseDamage:s,strengthMod:i,dexterityMod:d,weaponBonus:a,levelBonus:h,totalDamage:p}),p}}getEnemyPrimaryAttribute(e){return{Warrior:"strength",Archer:"dexterity",Mage:"intelligence",Cleric:"wisdom",Rogue:"dexterity",Paladin:"strength",Ranger:"dexterity",Wizard:"intelligence",Fighter:"strength"}[e]||"strength"}calculateEnemyItemBonus(e){let t=0;return e.equipment&&(e.equipment.weapon&&(t+=e.equipment.weapon.damageBonus||0),e.equipment.armor&&(t+=e.equipment.armor.defenseBonus||0),e.equipment.accessory&&(t+=e.equipment.accessory.bonus||0)),e.level>3&&(t+=Math.floor((e.level-3)/2)),t}calculateSpellDamage(e,t,r){const s=Math.floor(Math.random()*6)+1,i=Math.floor((e.intelligence-10)/2),a=r.spellLevel||1;if(e.id.startsWith("enemy_")){const o=1+(e.level-1)*.4,c=Math.floor((e.wisdom-10)/2),d=this.calculateEnemyItemBonus(e);let h=(s+i+c+a+d)*o;return Math.floor(Math.random()*20)+1>=19&&(h*=1.5),Math.max(1,Math.floor(h))}else return Math.max(1,s+i+a)}calculateSpecialDamage(e,t,r){var o;if(!this.classAbilities[(o=e.class)==null?void 0:o.toLowerCase()])return 0;const i=Math.floor(Math.random()*10)+2,a=Math.floor((e.level||1)/2);return Math.max(1,i+a)}calculateItemEffect(e,t,r){switch(r.itemType||"potion"){case"healing":return Math.floor(Math.random()*8)+2;case"antidote":return 0;case"blessing":return 0;default:return Math.floor(Math.random()*4)+1}}calculateTeamUpDamage(e,t,r){const s=Math.floor(Math.random()*12)+3;return Math.max(1,s+2)}applyActionEffects(e,t,r,s){if(console.log(" applyActionEffects called with:",{combatant:t.name,target:r.name,results:s,targetHpBefore:r.hp}),s.damage>0){const i=r.hp;r.hp=Math.max(0,r.hp-s.damage),console.log(` Damage applied in applyActionEffects: ${t.name} deals ${s.damage} damage to ${r.name}. HP: ${i}  ${r.hp}`)}if(s.healing>0){const i=r.hp;r.hp=Math.min(r.maxHp,r.hp+s.healing),console.log(` Healing applied in applyActionEffects: ${t.name} heals ${r.name} for ${s.healing} HP. HP: ${i}  ${r.hp}`)}r.statusEffects||(r.statusEffects=[]),s.statusEffects.forEach(i=>{r.statusEffects.some(a=>a.type===i.type)||(r.statusEffects.push({type:i.type,duration:i.duration,appliedBy:t.id}),console.log(` Status effect applied: ${i.type} to ${r.name}`))}),console.log(` Final target HP after applyActionEffects: ${r.name} = ${r.hp}`)}updateCooldowns(e,t,r){const s=this.actionTypes[r];t.cooldowns||(t.cooldowns={}),t.cooldowns[r]=s.cooldown,Object.keys(t.cooldowns).forEach(i=>{i!==r&&t.cooldowns[i]>0&&t.cooldowns[i]--})}checkStatusEffectApplication(e,t,r,s){const i=[];if(r.statusEffects||(r.statusEffects=[]),s.damage>10){const a=["stunned","bleeding"],o=a[Math.floor(Math.random()*a.length)];r.statusEffects.some(c=>c.type===o)||i.push({type:o,duration:1,appliedBy:e.id})}return i}calculateEnvironmentalImpact(e,t,r){const s=[];return t==="spell"&&r.damage>8&&s.push("The magical energy disturbs the environment"),t==="environmental"&&s.push("The environment responds to the action"),s}processStatusEffects(e,t){const r=[];return t.statusEffects&&t.statusEffects.forEach((s,i)=>{switch(s.duration--,s.type){case"poisoned":t.hp=Math.max(0,t.hp-1),r.push(`${t.name} takes 1 poison damage`);break;case"burned":t.hp=Math.max(0,t.hp-2),r.push(`${t.name} takes 2 burn damage`);break;case"frozen":r.push(`${t.name} is frozen and cannot act`);break;case"paralyzed":Math.random()<.5&&r.push(`${t.name} is paralyzed and cannot act`);break;case"blessed":r.push(`${t.name} is blessed with divine favor`);break;case"hasted":r.push(`${t.name} moves with supernatural speed`);break}s.duration<=0&&(t.statusEffects.splice(i,1),r.push(`${t.name} is no longer ${s.type}`))}),r}checkCombatEnd(e){const t=e.combatants.filter(a=>!a.id.startsWith("enemy_")),r=e.combatants.filter(a=>a.id.startsWith("enemy_")),s=t.some(a=>a.hp>0),i=r.some(a=>a.hp>0);return s?i?{ended:!1}:{ended:!0,result:"victory",narrative:"The enemies have been defeated!"}:{ended:!0,result:"defeat",narrative:"The party has been defeated..."}}generateCombatSummary(e,t){return{result:t,duration:e.round,participants:e.combatants.map(s=>({name:s.name,finalHp:s.hp,actions:s.turnCount,statusEffects:s.statusEffects.length})),narrative:this.generateCombatNarrative(e,t)}}generateCombatNarrative(e,t){const r=e.combatants.filter(s=>!s.id.startsWith("enemy_"));return e.combatants.filter(s=>s.id.startsWith("enemy_")),t==="victory"?`The party emerges victorious from the battle. ${r.map(s=>s.name).join(", ")} stand triumphant over their fallen foes.`:t==="defeat"?"The battle ends in defeat. The party has been overwhelmed by their enemies.":"The battle ends in a draw, with both sides withdrawing to regroup."}chooseEnemyAction(e,t){const r=this.getAvailableActions(e);return console.log(`Enemy ${e.name} available actions:`,r),r.length===0?(console.log(`No available actions for ${e.name}, defaulting to defend`),{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}):this.makeEnemyDecision(e,r,t)}getAvailableActions(e){var s;const t=[],r=e.cooldowns||{};return console.log("Getting enemy available actions for:",e.name,{cooldowns:r,class:e.class,hasClassAbility:!!this.classAbilities[(s=e.class)==null?void 0:s.toLowerCase()]}),Object.entries(this.actionTypes).forEach(([i,a])=>{(!r.hasOwnProperty(i)||r[i]<=0)&&t.push(i)}),e.class&&this.classAbilities[e.class.toLowerCase()]&&(!r.hasOwnProperty("special")||r.special<=0)&&t.push("special"),console.log("Available actions for enemy:",e.name,t),t}getValidTargets(e,t,r){const s=[],i=r.combatants.filter(a=>a.hp>0);if(i.length===0)return console.log("No alive combatants found"),[];switch(t){case"attack":case"spell":case"special":e.id.startsWith("enemy_")?s.push(...i.filter(a=>!a.id.startsWith("enemy_"))):s.push(...i.filter(a=>a.id.startsWith("enemy_")));break;case"heal":case"item":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_"))):s.push(...i.filter(a=>!a.id.startsWith("enemy_")));break;case"defend":case"environmental":s.push(e);break;case"teamUp":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_")&&a.id!==e.id)):s.push(...i.filter(a=>!a.id.startsWith("enemy_")&&a.id!==e.id));break;default:s.push(...i)}return console.log(`Valid targets for ${e.name} (${t}):`,s.map(a=>a.name)),s}makeEnemyDecision(e,t,r){var m;if(t.length===0)return console.log("No available actions for enemy, defaulting to defend"),{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"};const s=t[Math.floor(Math.random()*t.length)],i=this.getValidTargets(e,s,r);if(console.log(`Valid targets for ${e.name} (${s}):`,i.map(p=>p.name)),i.length===0)return console.log(`No valid targets for ${e.name} with action ${s}, defaulting to defend`),{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"};const a=i[Math.floor(Math.random()*i.length)],o=e.hp/e.maxHp,c=(m=e.class)==null?void 0:m.toLowerCase();if(e.level,c==="priest"||c==="cleric"){if(o<.4&&t.includes("spell"))return{action:"spell",target:e.id,spellType:"healing",specialAttack:"Divine Healing",damageType:"healing",attribute:"wisdom"};if(t.includes("spell"))return{action:"spell",target:a.id,spellType:"divine",specialAttack:"Divine Smite",damageType:"radiant",attribute:"wisdom"}}if((c==="wizard"||c==="mage"||c==="sorcerer")&&t.includes("spell")){const p=["fireball","lightning","ice","arcane"],y=p[Math.floor(Math.random()*p.length)];return{action:"spell",target:a.id,spellType:y,specialAttack:`${y.charAt(0).toUpperCase()+y.slice(1)} Spell`,damageType:y==="fireball"?"fire":y==="lightning"?"lightning":y==="ice"?"cold":"arcane",attribute:"intelligence"}}if((c==="boss"||c==="dragon")&&t.includes("special"))return{action:"special",target:a.id,specialAttack:"Devastating Strike",damageType:"physical",attribute:"strength",isBossAttack:!0};if((c==="undead"||c==="skeleton"||c==="zombie")&&t.includes("spell"))return{action:"spell",target:a.id,spellType:"necrotic",specialAttack:"Death Touch",damageType:"necrotic",attribute:"constitution"};if(o<.3){if(t.includes("item"))return{action:"item",target:e.id,itemType:"healing",specialAttack:"Use Healing Potion",damageType:"healing",attribute:"constitution"};if(t.includes("defend"))return{action:"defend",target:e.id,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}}return r.combatants.filter(p=>p.id.startsWith("enemy_")&&p.hp/p.maxHp<.5).length>1&&t.includes("spell")?{action:"spell",target:a.id,spellType:"area",specialAttack:"Area Attack",damageType:"mixed",attribute:"intelligence"}:t.includes("attack")?{action:"attack",target:a.id,specialAttack:"Standard Attack",damageType:"physical",attribute:"strength"}:{action:t[Math.floor(Math.random()*t.length)],target:a.id,specialAttack:"Basic Action",damageType:"physical",attribute:"strength"}}async executeEnemyTurn(e,t){const r=this.chooseEnemyAction(t,e);return console.log("Enemy decision details:",{enemy:t.name,decision:r,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute}),r.target?await this.executeAction(e,t.id,r.action,r.target,{itemType:r.itemType,spellType:r.spellType,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,isBossAttack:r.isBossAttack}):await this.executeAction(e,t.id,"defend",t.id,{specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute})}}const Qr=new Py,VV="https://dnd-v1-backend.onrender.com",Vn=async(n,e="gpt-4",t=1e3,r=.8)=>{try{const s=n.filter(o=>!o||typeof o!="object"?(console.warn("Invalid message object:",o),!1):!o.role||!o.content?(console.warn("Message missing role or content:",o),!1):!0);if(s.length===0)throw new Error("No valid messages to send to API");const i=await fetch(`${VV}/api/openai`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:s,model:e,max_tokens:t,temperature:r})});if(!i.ok){let o="Backend API request failed";try{o=(await i.json()).error||o}catch{o=`${i.status}: ${i.statusText}`}throw i.status===500?o=`AI service error: ${o}. This might be due to missing API key, rate limiting, or network issues.`:i.status===404?o="AI service endpoint not found. Please check the backend configuration.":i.status===503&&(o="AI service temporarily unavailable. Please try again later."),new Error(o)}return await i.json()}catch(s){throw console.error("Backend API Error:",s),new Error(`Failed to communicate with backend: ${s.message}`)}};class LV{constructor(){this.systemPrompt=`You are an experienced Dungeon Master for Dungeons & Dragons 5th Edition. You excel at:
- Creating engaging storylines and plot hooks
- Developing detailed character descriptions and backstories
- Generating multiple story options when specifically requested
- Providing atmospheric descriptions and immersive storytelling
- Balancing combat encounters and managing game mechanics
- Creating memorable NPCs and villains
- Adapting to player choices and creating dynamic narratives
- Maintaining story consistency and character development
- Building upon established relationships and plot threads

IMPORTANT: Only generate multiple options when explicitly requested. When asked to generate a single story introduction, campaign goal, or other content, provide ONLY ONE response.

Always respond in character as a Dungeon Master, providing rich, descriptive content that enhances the gaming experience. Maintain consistency with previous story elements, character relationships, and established plot threads.`,this.diceService=new Ay,this.actionValidationService=new Ny,this.combatService=new Py}async generateStoryPlots(e,t="",r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class} (${c.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 3 different story plot options for a D&D campaign.

Party Composition: ${s}${i}
Campaign Setting: ${t||"Generic fantasy world"}

IMPORTANT: You MUST format your response EXACTLY as follows for each plot option:

**Plot Option 1:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

**Plot Option 2:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

**Plot Option 3:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

Guidelines for the plots:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

CRITICAL: Do not deviate from this exact format. Each plot must start with "**Plot Option X:**" and use the numbered format exactly as shown above.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1e3,.8)).choices[0].message.content}catch(s){throw new Error(`Failed to generate story plots: ${s.message}`)}}async generateCharacterDetails(e){try{const t=`As a Dungeon Master, I need you to expand on this character's details and create a rich, detailed description.

Character: ${e.name} - Level ${e.level} ${e.race} ${e.class}
Background: ${e.background}
Alignment: ${e.alignment}
Personality: ${e.personality||"Not specified"}
Ideals: ${e.ideals||"Not specified"}
Bonds: ${e.bonds||"Not specified"}
Flaws: ${e.flaws||"Not specified"}
Backstory: ${e.backstory||"Not specified"}

Please provide:
1. A detailed physical description (appearance, mannerisms, distinctive features)
2. An expanded personality profile with quirks and habits
3. A deeper backstory with key events and relationships
4. Character motivations and goals
5. Potential story hooks and plot threads related to this character
6. How this character might interact with the party and world

Make the character feel alive and three-dimensional, with details that could drive story development.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:t}],"gpt-4",800,.7)).choices[0].message.content}catch(t){throw console.error("Error generating character details:",t),new Error(`Failed to generate character details: ${t.message}`)}}async generateStorySummary(e,t){try{const r=t.map(a=>`${a.name} (${a.race} ${a.class})`).join(", "),s=`As a Dungeon Master, I need you to create a detailed story summary and outline for this campaign plot.

Plot: ${e}
Party: ${r}

Please provide:
1. A detailed campaign overview (3-4 paragraphs)
2. Key story beats and major events
3. Important NPCs and their roles
4. Potential challenges and obstacles
5. Story themes and motifs
6. How each party member might be personally invested
7. Potential branching paths and player choices
8. Climactic moments and resolution possibilities

Make this feel like a professional campaign module with rich storytelling potential.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:s}],"gpt-4",1200,.7)).choices[0].message.content}catch(r){throw console.error("Error generating story summary:",r),new Error(`Failed to generate story summary: ${r.message}`)}}async generateMultipleStoryPlots(e,t="",r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class} (${c.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 5 different story plot options for a D&D campaign, each with a detailed summary.

Party Composition: ${s}${i}
Campaign Setting: ${t||"Generic fantasy world"}

For each of the 5 plot options, provide:
1. A compelling title
2. A detailed summary (3-4 paragraphs)
3. The main conflict or challenge
4. Key story beats and major events
5. Important NPCs and their roles
6. Potential story hooks for the party
7. Estimated campaign length (short, medium, or long)
8. Themes and motifs
9. How each party member might be personally invested

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options. Number each plot clearly (Plot 1, Plot 2, etc.).`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1500,.8)).choices[0].message.content}catch(s){throw console.error("Error generating multiple story plots:",s),new Error(`Failed to generate multiple story plots: ${s.message}`)}}async generateNPC(e,t=""){try{const r=`As a Dungeon Master, I need you to create a detailed NPC for this role and context.

NPC Role: ${e}
Context: ${t||"General campaign context"}

Please provide:
1. A detailed physical description
2. Personality traits and mannerisms
3. Background and motivations
4. Current situation and goals
5. How they might interact with the party
6. Potential story hooks or plot threads they could introduce
7. Their relationship to the world and other NPCs
8. Any secrets or hidden aspects of their character

Make this NPC feel like a real person with depth and complexity.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:r}],"gpt-4",800,.7)).choices[0].message.content}catch(r){throw console.error("Error generating NPC:",r),new Error(`Failed to generate NPC: ${r.message}`)}}async generateCombatEncounter(e,t,r="medium",s=""){try{const i=`As a Dungeon Master, I need you to create a detailed combat encounter.

Party Level: ${e}
Party Size: ${t}
Difficulty: ${r}
Theme: ${s||"General fantasy"}

Please provide:
1. A detailed description of the encounter location
2. Enemy types and their motivations
3. Tactical considerations and terrain features
4. Potential story elements or plot hooks
5. Non-combat resolution options
6. Consequences of victory or defeat
7. Environmental hazards or advantages
8. How this encounter fits into the larger story

Make this encounter feel meaningful and story-driven, not just a random fight.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:i}],"gpt-4",800,.7)).choices[0].message.content}catch(i){throw console.error("Error generating combat encounter:",i),new Error(`Failed to generate combat encounter: ${i.message}`)}}async generateStoryContinuation(e,t,r,s=null,i="individual",a=null){var o,c,d,h,m;try{const p=e.map(F=>`${F.name} - Level ${F.level} ${F.race} ${F.class}`).join(", ");let y=null,E=null,v="";if(i==="individual"){const F=e[e.length-1];if(F)if(y=this.actionValidationService.validatePlayerAction(r,F,{context:"story",storyState:s}),y.valid&&y.diceResult){if(E=y.diceResult,E.overallSuccess){if(v=`

ACTION VALIDATION: The action is within your character's capabilities.`,E.actions){const q=E.actions.map(T=>`${T.action}: ${T.check.isSuccess?"Success":"Failure"} (Roll: ${T.check.roll}, DC: ${T.check.dc})`).join(", ");v+=`
Dice Results: ${q}`}}else if(v=`

ACTION VALIDATION: Some aspects of this action are challenging for your character.`,E.actions){const T=E.actions.filter(b=>!b.check.isSuccess).map(b=>`${b.action}: Failure (Roll: ${b.check.roll}, DC: ${b.check.dc})`).join(", ");v+=`
Failed Actions: ${T}`}}else y.valid||(v=`

ACTION VALIDATION: ${y.response}`,y.suggestion&&(v+=`
Suggestion: ${y.suggestion}`))}const I=t.map(F=>({role:F.role,content:F.content}));let _="";a&&(_=`
Party Theme: ${a.description||"No theme provided"}`);let x="";s&&(x=`
STORY STATE CONTEXT:
Current Location: ${((o=s.currentLocation)==null?void 0:o.name)||"Unknown"} - ${((c=s.currentLocation)==null?void 0:c.description)||""}
Active NPCs: ${Object.keys(s.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((d=s.activePlotThreads)==null?void 0:d.map(F=>`${F.title} (${Math.round(F.progress*100)}%)`).join(", "))||"None"}
Recent Events: ${((m=(h=s.worldState)==null?void 0:h.recentEvents)==null?void 0:m.slice(-3).map(F=>F.event).join(", "))||"None"}

CHARACTER RELATIONSHIPS:
${e.map(F=>{var b;const q=((b=s.characterArcs)==null?void 0:b[F.id])||{},T=Object.entries(q.relationships||{}).map(([A,P])=>`${A} (${P})`).join(", ");return`${F.name}: ${T||"No established relationships"}`}).join(`
`)}

NPC CONTEXT:
${Object.entries(s.activeNPCs||{}).map(([F,q])=>{var T;return`${F}: ${q.disposition} disposition, knowledge: ${((T=q.knowledge)==null?void 0:T.join(", "))||"none"}, goal: ${q.currentGoal||"unknown"}`}).join(`
`)}`);const C=`As a Dungeon Master, continue the story based on the player's response.

Party: ${p}${_}
Player Response: "${r}" (Type: ${i})
Response Type Context:
- individual: One character's personal action
- team: Group action or decision
- investigate: Looking for clues or information
- combat: Combat-related action
- social: Social interaction or diplomacy${x}

Previous Story Context:
${I.map(F=>`${F.role==="assistant"?"DM":"Player"}: ${F.content}`).join(`
`)}

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

ACTION VALIDATION GUIDELINES:
- If the action validation shows the action is impossible, gently redirect the player while maintaining story flow
- If the action validation shows the action is challenging, incorporate the difficulty into the narrative
- If the action validation shows the action is successful, proceed with the action as described
- Always maintain story coherence and character consistency
- Use the validation results to inform how the action plays out in the story

Please provide a compelling continuation that:
1. Acknowledges the player's action in context of the current situation and location
2. References relevant NPCs and their established relationships with the party
3. Continues or advances active plot threads appropriately
4. Updates character relationships based on the action
5. Maintains location and atmosphere consistency
6. Ends with a clear situation that invites the next player to respond
7. Encourages character interaction and roleplay
8. Provides multiple possible directions for the party to explore
9. Builds upon the established story state and character development
10. Incorporates action validation results naturally into the narrative

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.${v}`;return{content:(await Vn([{role:"system",content:this.systemPrompt},...I,{role:"user",content:C}],"gpt-4",800,.8)).choices[0].message.content,actionValidation:y,diceResult:E}}catch(p){throw console.error("Error generating story continuation:",p),new Error(`Failed to generate story continuation: ${p.message}`)}}async generatePlotOptions(e,t=null){try{const r=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class}. ${c.personality||""}. ${c.backstory||""}`).join(`
`);let s="";t&&(s=`
Party Theme: ${t.description||"No theme provided"}`);const i="You are a Dungeon Master for D&D 5e. You MUST generate exactly 3 plot options, no more, no less. Follow the exact format provided. Do not use party names in the plots. Keep summaries brief (1-2 sentences maximum). DO NOT repeat plots or generate duplicates.",a=`Generate exactly 3 distinct campaign plot options for this party. 

REQUIRED FORMAT - Follow this exact structure:

Plot 1: [Title]
[Brief summary - 1-2 sentences maximum]

Plot 2: [Title]  
[Brief summary - 1-2 sentences maximum]

Plot 3: [Title]
[Brief summary - 1-2 sentences maximum]

Party: ${r}${s}

CRITICAL REQUIREMENTS:
- Generate EXACTLY 3 plots, no more, no less
- Use the party theme to influence the plot lines and atmosphere
- Do NOT use the party name in the plots - focus on the characters and theme
- Each summary must be 1-2 sentences maximum
- Follow the exact format above with "Plot 1:", "Plot 2:", "Plot 3:" labels
- Do not add any additional text, explanations, or formatting
- Do not repeat or duplicate any plots
- Stop after Plot 3 - do not generate more plots

Make each plot distinct and appealing to different play styles.`;return(await Vn([{role:"system",content:i},{role:"user",content:a}],"gpt-4",600,.8)).choices[0].message.content}catch(r){throw console.error("Error generating plot options:",r),new Error(`Failed to generate plot options: ${r.message}`)}}async generateStoryIntroduction(e,t,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}. ${d.personality||""}. ${d.backstory||""}`).join(`
`);let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const o=`As a Dungeon Master, create an engaging story introduction for the beginning of this campaign.

Party: ${i}${a}
Selected Plot: ${t}
Plot Number: ${r}

IMPORTANT: Generate ONLY ONE story introduction for the selected plot above. Do NOT generate introductions for multiple plots or options.

Create an introduction that includes:
1. A vivid description of the starting town/settlement where the party begins
2. How each character arrives or is already present in this location
3. The initial situation or hook that draws the party together
4. A sense of atmosphere and setting that matches the chosen plot
5. An opening scene that gives the party their first decision or action to take

Important Guidelines:
- Use the party theme to influence the atmosphere and context
- Incorporate themes and elements from the party theme to create atmosphere and context
- Consider how the party's background and composition might influence the starting situation
- Focus on the characters and their individual stories
- The story should feel cohesive with the established theme
- Generate ONLY ONE introduction for the selected plot

Make this feel like the opening of an epic adventure. Set the tone, establish the setting, and give the party a clear starting point. End with a situation that requires the party to make a choice or take action.

Keep the introduction engaging but concise (3-4 paragraphs maximum).`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:o}],"gpt-4",800,.8)).choices[0].message.content}catch(i){throw console.error("Error generating story introduction:",i),new Error(`Failed to generate story introduction: ${i.message}`)}}async generateStructuredStoryResponse(e,t,r,s,i,a=null,o=null){var c,d,h;try{const m=e.map(x=>`${x.name} - Level ${x.level} ${x.race} ${x.class}`).join(", "),p=t.filter(x=>x&&typeof x=="object"&&x.role&&x.content).map(x=>({role:x.role,content:x.content}));let y="";o&&(y=`
Party Theme: ${o.description||"No theme provided"}`);const E=i.length>0?`
Discovered Objectives: ${i.map(x=>x.title).join(", ")}`:"";let v="";a&&(v=`
STORY STATE CONTEXT:
Current Location: ${((c=a.currentLocation)==null?void 0:c.name)||"Unknown"} - ${((d=a.currentLocation)==null?void 0:d.description)||""}
Active NPCs: ${Object.keys(a.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((h=a.activePlotThreads)==null?void 0:h.map(x=>`${x.title} (${Math.round(x.progress*100)}%)`).join(", "))||"None"}
Character Relationships: ${Object.entries(a.characterArcs||{}).map(([x,C])=>{const R=e.find(F=>F.id===x);return`${R==null?void 0:R.name}: ${Object.entries(C.relationships||{}).map(([F,q])=>`${F} (${q})`).join(", ")||"No relationships"}`}).join("; ")}`);const I=`As a Dungeon Master, continue the story based on the player's response, considering the current story phase and discovered objectives.

Party: ${m}${y}
Current Phase: ${s}
Player Response: "${r}"${E}${v}

Story Phases:
- Investigation: Focus on discovery, clues, and gathering information
- Conflict: Focus on tension, threats, and potential combat
- Resolution: Focus on choices, consequences, and story conclusion

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

ENEMY INFORMATION REQUIREMENTS (when in Conflict phase):
If the story involves combat or enemies, provide detailed enemy information in the following format:

**ENEMY_DETAILS:**
[For each enemy present, provide:]
Name: [Enemy name if humanoid, or descriptive name like "Alpha Wolf"]
Type: [Enemy type: humanoid, beast, undead, etc.]
Level: [Enemy level relative to party]
HP: [Hit points]
AC: [Armor class]
Basic Attack: [Description of basic attack and damage]
Special Ability: [Description of special ability or attack]
Stats: [Brief description of key stats like "Strong and aggressive" or "Quick and stealthy"]

IMPORTANT: You MUST format your response EXACTLY as follows:

**STORY_CONTENT:**
[Your main story continuation here - 2-3 paragraphs that acknowledge the player's action, continue the plot, and set up the next situation]

**CURRENT_LOCATION:**
[Updated location description or "No change" if location remains the same]

**ACTIVE_NPCS:**
[List of NPCs currently present or relevant to the scene, separated by commas]

**PLOT_DEVELOPMENTS:**
[Key plot developments or revelations from this response]

**CHARACTER_REACTIONS:**
[How NPCs react to the player's action, if applicable]

**NEXT_ACTIONS:**
[2-3 clear options or directions the party can take next]

**STORY_TONE:**
[The current mood/atmosphere: tense, mysterious, hopeful, dangerous, etc.]

**PHASE_STATUS:**
[Current story phase: investigation, conflict, or resolution]

**ENEMY_DETAILS:** (only include if enemies are present)
[Detailed enemy information as specified above]

Keep your response engaging but concise. Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.`;return(await Vn([{role:"system",content:this.systemPrompt},...p,{role:"user",content:I}],"gpt-4",1e3,.8)).choices[0].message.content}catch(m){throw console.error("Error generating structured story response:",m),new Error(`Failed to generate structured story response: ${m.message}`)}}async generatePhaseTransition(e,t,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const o=`As a Dungeon Master, create a phase transition message for the story.

Party: ${i}${a}
Current Phase: ${t}
Story Progress: ${r}

Create a transition that:
1. Acknowledges the progress made so far
2. Signals the shift to the new phase
3. Sets up the new challenges and opportunities
4. Maintains the established tone and atmosphere
5. Gives the party clear direction for the next phase

Make this feel like a natural progression in the story.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:o}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating phase transition:",i),new Error(`Failed to generate phase transition: ${i.message}`)}}async generateObjectiveCompletion(e,t,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const o=`As a Dungeon Master, create a completion message for an objective.

Party: ${i}${a}
Completed Objective: ${t.title}
Story Context: ${r}

Create a completion message that:
1. Celebrates the achievement
2. Provides closure for this objective
3. Sets up the next challenge or objective
4. Maintains story momentum
5. Acknowledges the party's efforts

Make this feel rewarding and meaningful.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:o}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating objective completion:",i),new Error(`Failed to generate objective completion: ${i.message}`)}}async generateCampaignContinuation(e,t,r,s,i=null){try{const a=e.map(m=>`${m.name} - Level ${m.level} ${m.race} ${m.class}`).join(", "),o=r.filter(m=>m&&typeof m=="object"&&m.role&&m.content).map(m=>({role:m.role,content:m.content}));let c="";i&&(c=`
Party Theme: ${i.description||"No theme provided"}`);const d=`As a Dungeon Master, continue the ongoing campaign story.

Party: ${a}${c}
Campaign Goal: ${t.mainGoal||"No specific goal"}
Campaign Progress: ${t.campaignProgress||"Beginning"}
Player Response: "${s}"

Previous Story Context:
${o.map(m=>`${m.role==="assistant"?"DM":"Player"}: ${m.content}`).join(`
`)}

Continue the story while:
1. Building toward the main campaign goal
2. Maintaining consistency with previous events
3. Developing character relationships and arcs
4. Creating meaningful choices and consequences
5. Advancing the overall plot

Keep your response engaging but concise (2-3 paragraphs maximum).`;return(await Vn([{role:"system",content:this.systemPrompt},...o,{role:"user",content:d}],"gpt-4",800,.8)).choices[0].message.content}catch(a){throw console.error("Error generating campaign continuation:",a),new Error(`Failed to generate campaign continuation: ${a.message}`)}}async generateCampaignGoal(e,t,r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class}`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, create a clear campaign goal based on the selected plot.

Party: ${s}${i}
Selected Plot: ${t}

IMPORTANT: Generate ONLY ONE campaign goal for the selected plot above. Do NOT generate multiple goals or options.

Create a campaign goal that:
1. Is clear and achievable
2. Provides direction for the entire campaign
3. Involves all party members
4. Has multiple possible paths to completion
5. Creates meaningful stakes and consequences
6. Is specific to the selected plot only

Make this goal compelling and motivating for the party. Generate ONLY ONE goal.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",600,.7)).choices[0].message.content}catch(s){throw console.error("Error generating campaign goal:",s),new Error(`Failed to generate campaign goal: ${s.message}`)}}async generateSessionSummary(e,t,r,s,i=null){try{const a=s.map(h=>`${h.name} - Level ${h.level} ${h.race} ${h.class}`).join(", ");let o="";i&&(o=`
Party Theme: ${i.description||"No theme provided"}`);const c=`As a Dungeon Master, create a session summary for this campaign session.

Party: ${a}${o}
Campaign Goal: ${e.mainGoal||"No specific goal"}
Objectives: ${r.map(h=>h.title).join(", ")}
Story Messages: ${t.length} total messages

Create a summary that:
1. Recaps the major events of the session
2. Highlights character development and relationships
3. Notes progress toward objectives
4. Sets up expectations for the next session
5. Maintains the established tone and atmosphere

Make this summary engaging and informative.`;return(await Vn([{role:"system",content:this.systemPrompt},{role:"user",content:c}],"gpt-4",800,.7)).choices[0].message.content}catch(a){throw console.error("Error generating session summary:",a),new Error(`Failed to generate session summary: ${a.message}`)}}}const Mu=new LV;function OV(){const n=fr(),[e,t]=k.useState(null),[r,s]=k.useState(!1),[i,a]=k.useState({name:"",description:"",theme:"Fantasy",maxPlayers:6,isPublic:!0});k.useEffect(()=>{const d=Yo(h=>{if(!h){n("/login");return}t(h)});return()=>d()},[n]);const o=(d,h)=>{a(m=>({...m,[d]:h}))},c=async()=>{try{s(!0),await Ty(e.uid,i),n("/party-management")}catch{}finally{s(!1)}};return!e||r?l.jsx("div",{className:"fantasy-container py-8",children:l.jsx("div",{className:"fantasy-card",children:l.jsx("div",{className:"text-center py-8",children:l.jsx("p",{className:"text-stone-600",children:"Loading..."})})})}):l.jsx("div",{className:"fantasy-container py-8",children:l.jsxs("div",{className:"fantasy-card",children:[l.jsxs("div",{className:"flex justify-between items-center mb-6",children:[l.jsx("h1",{className:"fantasy-title mb-0",children:"Campaign Management"}),l.jsxs("div",{className:"text-sm text-stone-600",children:["Playing as: ",l.jsx("span",{className:"font-medium",children:e.displayName})]})]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"campaign-name",className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Name"}),l.jsx("input",{id:"campaign-name",type:"text",value:i.name,onChange:d=>o("name",d.target.value),className:"fantasy-input",placeholder:"Enter campaign name..."})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"campaign-description",className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Description"}),l.jsx("textarea",{id:"campaign-description",value:i.description,onChange:d=>o("description",d.target.value),className:"fantasy-input",rows:"4",placeholder:"Describe your campaign..."})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"campaign-theme",className:"block text-sm font-medium text-stone-700 mb-2",children:"Theme"}),l.jsx("input",{id:"campaign-theme",type:"text",value:i.theme,onChange:d=>o("theme",d.target.value),className:"fantasy-input",placeholder:"Enter campaign theme..."})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"max-players",className:"block text-sm font-medium text-stone-700 mb-2",children:"Maximum Players"}),l.jsx("input",{id:"max-players",type:"number",value:i.maxPlayers,onChange:d=>o("maxPlayers",Number(d.target.value)),className:"fantasy-input",placeholder:"Enter maximum number of players..."})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"public-campaign",className:"block text-sm font-medium text-stone-700 mb-2",children:"Public Campaign"}),l.jsx("input",{id:"public-campaign",type:"checkbox",checked:i.isPublic,onChange:d=>o("isPublic",d.target.checked),className:"mr-2"})]}),l.jsx("div",{className:"text-center py-8",children:l.jsx("button",{onClick:c,className:"fantasy-button text-lg px-8 py-3",disabled:r,children:r?"Creating...":"Create Campaign"})})]})]})})}function FV(){var jn,Dn,Xt;const n=fr(),{partyId:e}=hg(),[t,r]=k.useState(null),[s,i]=k.useState(!1),[a,o]=k.useState(""),[c,d]=k.useState("");k.useState(!1);const[h,m]=k.useState(null),[p,y]=k.useState([]),[E,v]=k.useState(!1),[I,_]=k.useState(""),[x,C]=k.useState(!1),[R,F]=k.useState({name:"",race:"",class:"",level:1,background:"",alignment:"",strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10,age:"",height:"",weight:"",eyes:"",skin:"",hair:"",personality:"",ideals:"",bonds:"",flaws:"",backstory:"",equipment:[],spells:[],proficiencies:[],portrait:"/placeholder-character.png"}),[q,T]=k.useState("standard"),[b,A]=k.useState([]),[P,D]=k.useState([]),[N,S]=k.useState({}),[Be,Fe]=k.useState(!1),[$e,Pe]=k.useState({}),[Y,ae]=k.useState([]);k.useEffect(()=>{const V=Yo(W=>{if(!W){n("/login");return}r(W),e&&Se(W.uid,e).catch(we=>{}),ne(W.uid).catch(we=>{})});return()=>V()},[n,e]),k.useEffect(()=>{h&&(F({name:h.name||"",race:h.race||"",class:h.class||"",level:h.level||1,background:h.background||"",alignment:h.alignment||"",strength:h.strength||10,dexterity:h.dexterity||10,constitution:h.constitution||10,intelligence:h.intelligence||10,wisdom:h.wisdom||10,charisma:h.charisma||10,age:h.age||"",height:h.height||"",weight:h.weight||"",eyes:h.eyes||"",skin:h.skin||"",hair:h.hair||"",personality:h.personality||"",ideals:h.ideals||"",bonds:h.bonds||"",flaws:h.flaws||"",backstory:h.backstory||"",equipment:h.equipment||[],spells:h.spells||[],proficiencies:h.proficiencies||[],portrait:h.portrait||"/placeholder-character.png"}),h.weaponChoices&&Pe(h.weaponChoices),h.spellChoices&&ae(h.spellChoices),h.abilityScoreMethod&&T(h.abilityScoreMethod),h.rolledScores&&(A(h.rolledScores),S(h.assignedScores||{}),Fe(h.rolledScores.length>0)))},[h]),k.useEffect(()=>{t&&e&&(async()=>{try{(await Wl(t.uid)).filter(Le=>Le.partyId===e).length>1&&(await H(),await Se(t.uid,e))}catch{}})()},[t,e]);const Se=async(V,W)=>{try{const Le=(await Wl(V)).filter(ln=>ln.partyId===W);if(Le.length===0){m(null);return}if(Le.length===1){m(Le[0]);return}const Zt=Le.sort((ln,Un)=>{var Bn,dt,pr,gr;const en=((dt=(Bn=ln.updatedAt)==null?void 0:Bn.toDate)==null?void 0:dt.call(Bn))||ln.updatedAt||new Date(0);return(((gr=(pr=Un.updatedAt)==null?void 0:pr.toDate)==null?void 0:gr.call(pr))||Un.updatedAt||new Date(0))-en})[0];m(Zt),await ee(Le,Zt.id)}catch{}},ee=async(V,W)=>{try{const we=V.filter(Le=>Le.id!==W).map(Le=>th(Le.id));await Promise.all(we)}catch{}},H=async()=>{try{const W=(await Wl(t.uid)).filter(we=>we.partyId===e);if(W.length>0){const we=W.map(async Le=>{try{return await th(Le.id),{success:!0,id:Le.id}}catch(Zt){return{success:!1,id:Le.id,error:Zt}}});await Promise.all(we),await new Promise(Le=>setTimeout(Le,1e3))}}catch{}},ne=async V=>{try{const W=await gS(V);y(W)}catch{}},pe=["Human","Elf","Dwarf","Halfling","Dragonborn","Tiefling","Half-Elf","Half-Orc","Gnome","Aarakocra","Genasi","Goliath"],Ue=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"],oe=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],ge=["Acolyte","Criminal","Folk Hero","Noble","Sage","Soldier"],X=[15,14,13,12,10,8],Me={Fighter:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Paladin:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Barbarian:{"Martial Melee Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"]},Bard:{Weapon:["Rapier","Longsword"]},Druid:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Monk:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Sorcerer:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Warlock:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]}},_e={Wizard:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Sorcerer:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Warlock:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Eldritch Blast",description:"A beam of crackling energy that deals force damage and can hit multiple targets."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Cleric:[{name:"Guidance",description:"Touch a creature to give them +1d4 to their next ability check."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Resistance",description:"Touch a creature to give them +1d4 to their next saving throw."},{name:"Sacred Flame",description:"Flame-like radiance descends on a creature within 60 feet, dealing radiant damage."},{name:"Spare the Dying",description:"Touch a dying creature to stabilize them at 0 hit points."},{name:"Thaumaturgy",description:"Perform minor magical tricks - make your voice boom, cause tremors, or change eye color."}],Druid:[{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Druidcraft",description:"Predict weather, make a flower bloom, or create a harmless sensory effect."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Primal Savagery",description:"Transform your hand into a claw that deals acid damage to a creature you touch."},{name:"Produce Flame",description:"Create a flickering flame in your hand that you can throw for fire damage."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shillelagh",description:"Transform a club or quarterstaff into a magical weapon that uses your spellcasting ability."},{name:"Thorn Whip",description:"Create a vine-like whip that pulls a creature toward you and deals piercing damage."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."}],Bard:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."},{name:"Vicious Mockery",description:"Insult a creature within 60 feet, dealing psychic damage and possibly giving disadvantage."}]},Ye={Wizard:{cantrips:3,spells:6},Sorcerer:{cantrips:4,spells:2},Warlock:{cantrips:2,spells:2},Cleric:{cantrips:3,spells:2},Druid:{cantrips:2,spells:2},Bard:{cantrips:2,spells:4}},z=V=>{const we=[...{Fighter:["Chain mail armor","Light crossbow and 20 bolts","Dungeoneer's pack","5 gp"],Wizard:["Arcane focus","Scholar's pack","Component pouch","5 gp"],Cleric:["Chain mail armor","Light crossbow and 20 bolts","Priest's pack","Shield","Holy symbol","5 gp"],Rogue:["Leather armor","Shortbow and 20 arrows","Burglar's pack","Thieves' tools","5 gp"],Ranger:["Scale mail armor","Longbow and 20 arrows","Explorer's pack","5 gp"],Paladin:["Chain mail armor","Javelins (5)","Priest's pack","Holy symbol","5 gp"],Barbarian:["Javelins (4)","Explorer's pack","5 gp"],Bard:["Leather armor","Diplomat's pack OR entertainer's pack","Lute OR any other musical instrument","5 gp"],Druid:["Leather armor","Druidic focus","Explorer's pack","Shield","5 gp"],Monk:["Dungeoneer's pack OR explorer's pack","5 gp"],Sorcerer:["Component pouch OR arcane focus","Dungeoneer's pack","5 gp"],Warlock:["Component pouch OR arcane focus","Scholar's pack","5 gp"]}[V]||["Adventurer's pack","Simple weapon","5 gp"]];return $e.weapon&&we.push($e.weapon),$e.shield&&we.push($e.shield),Y.length>0&&we.push(`Spells: ${Y.join(", ")}`),we},It=()=>{const V=[];for(let W=0;W<4;W++)V.push(Math.floor(Math.random()*6)+1);return V.sort((W,we)=>we-W),V.slice(0,3).reduce((W,we)=>W+we,0)},xt=()=>{const V=[];for(let W=0;W<6;W++)V.push(It());return V.sort((W,we)=>we-W),A(V),D([...V]),S({}),Fe(!0),V},it=(V,W)=>{const we=P.filter(Le=>Le!==V);D(we),S(Le=>({...Le,[W]:V})),at(W,V)},Ve=V=>{const W=N[V];if(W){D(Le=>[...Le,W].sort((Zt,ln)=>ln-Zt));const we={...N};delete we[V],S(we),at(V,10)}},Dt=()=>{const V=["strength","dexterity","constitution","intelligence","wisdom","charisma"],W={...R};X.forEach((we,Le)=>{W[V[Le]]=we}),F(W),S({}),D([]),Fe(!1)},at=(V,W)=>{F(we=>({...we,[V]:W||""}))},Rn=async V=>{V.preventDefault(),i(!0),o("");try{const W={name:R.name,race:R.race,class:R.class,level:R.level,userId:t.uid,partyId:e,weaponChoices:$e,spellChoices:Y,abilityScoreMethod:q,rolledScores:b,assignedScores:N,createdAt:new Date,updatedAt:new Date};await H();const we=await tS(t.uid,e,W);F(we),d("Character saved successfully!"),setTimeout(()=>{n(`/campaign/${e}`)},1e3)}catch{o("Failed to save character")}finally{i(!1)}},Ot=async()=>{if(!I.trim()){alert("Please enter a name for your preset");return}if(!R.name||!R.race||!R.class){alert("Please fill in at least the basic character information (name, race, class) before saving as preset");return}try{const V={name:I,data:{...R,weaponChoices:$e,spellChoices:Y,abilityScoreMethod:q,rolledScores:b,assignedScores:N}},W=await pS(t.uid,V);_(""),v(!1),await ne(t.uid),alert("Character preset saved successfully!")}catch(V){V.message.includes("User profile not found")?alert("User profile not found. Please try logging out and back in."):V.message.includes("permission")?alert("Permission denied. Please check your account status."):alert(`Failed to save preset: ${V.message}`)}},tt=V=>{V.key==="Enter"&&I.trim()&&Ot()},Is=V=>{const W=V.data;F({name:(W.name||"")+" (Copy)",race:W.race||"",class:W.class||"",level:W.level||1,background:W.background||"",alignment:W.alignment||"",strength:W.strength||10,dexterity:W.dexterity||10,constitution:W.constitution||10,intelligence:W.intelligence||10,wisdom:W.wisdom||10,charisma:W.charisma||10,age:W.age||"",height:W.height||"",weight:W.weight||"",eyes:W.eyes||"",skin:W.skin||"",hair:W.hair||"",personality:W.personality||"",ideals:W.ideals||"",bonds:W.bonds||"",flaws:W.flaws||"",backstory:W.backstory||"",equipment:[],spells:W.spells||[],proficiencies:W.proficiencies||[],portrait:W.portrait||"/placeholder-character.png"}),W.weaponChoices&&Pe(W.weaponChoices),W.spellChoices&&ae(W.spellChoices),W.abilityScoreMethod&&T(W.abilityScoreMethod),W.rolledScores&&(A(W.rolledScores),S(W.assignedScores||{}),Fe(W.rolledScores.length>0)),C(!1)},St=async V=>{if(confirm("Are you sure you want to delete this preset? This action cannot be undone."))try{await yS(t.uid,V),await ne(t.uid),alert("Preset deleted successfully!")}catch{alert("Failed to delete preset. Please try again.")}};if(!t)return null;if(!e)return l.jsx("div",{className:"fantasy-container py-8",children:l.jsx("div",{className:"fantasy-card",children:l.jsxs("div",{className:"text-center py-8",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-300",children:"Loading character creation..."}),l.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"No party ID found"})]})})});try{return l.jsx("div",{className:"fantasy-container py-8",children:l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),l.jsx("p",{className:"text-center text-gray-300 mb-6",children:h?"Edit your character below. When you're ready, click 'Ready Up & Join Campaign' at the bottom!":"Create your character to join the campaign. Once created, you'll be able to ready up and join the adventure!"}),h&&l.jsx("div",{className:"mb-6 flex justify-center",children:l.jsx("button",{type:"button",className:"fantasy-button bg-blue-600 hover:bg-blue-700",onClick:()=>n(`/campaign/${e}`),children:" Back to Campaign"})}),l.jsxs("div",{className:"mb-8 p-4 bg-gray-700 rounded-lg border border-gray-600",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-4",children:"Character Presets"}),l.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[l.jsxs("button",{type:"button",onClick:()=>C(!0),className:"fantasy-button bg-amber-600 hover:bg-amber-700",disabled:p.length===0,children:[" Load Preset (",p.length,")"]}),l.jsx("button",{type:"button",onClick:()=>v(!0),className:"fantasy-button bg-emerald-600 hover:bg-emerald-700",children:" Save as Preset"})]}),p.length>0&&l.jsx("p",{className:"text-sm text-gray-300",children:"Save your current character configuration as a preset to easily recreate it for other parties."})]}),l.jsxs("form",{onSubmit:V=>{Rn(V)},className:"space-y-8",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-name",className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Name"}),l.jsx("input",{id:"character-name",name:"character-name",type:"text",value:R.name,onChange:V=>at("name",V.target.value),className:"fantasy-input",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-race",className:"block text-sm font-medium text-gray-200 mb-2",children:"Race"}),l.jsxs("select",{id:"character-race",name:"character-race",value:R.race,onChange:V=>at("race",V.target.value),className:"fantasy-input",required:!0,children:[l.jsx("option",{value:"",children:"Select Race"}),pe.map(V=>l.jsx("option",{value:V,children:V},V))]})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-class",className:"block text-sm font-medium text-gray-200 mb-2",children:"Class"}),l.jsxs("select",{id:"character-class",name:"character-class",value:R.class,onChange:V=>at("class",V.target.value),className:"fantasy-input",required:!0,children:[l.jsx("option",{value:"",children:"Select Class"}),Ue.map(V=>l.jsx("option",{value:V,children:V},V))]})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-background",className:"block text-sm font-medium text-gray-200 mb-2",children:"Background"}),l.jsxs("select",{id:"character-background",name:"character-background",value:R.background,onChange:V=>at("background",V.target.value),className:"fantasy-input",required:!0,children:[l.jsx("option",{value:"",children:"Select Background"}),ge.map(V=>l.jsx("option",{value:V,children:V},V))]})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-alignment",className:"block text-sm font-medium text-gray-200 mb-2",children:"Alignment"}),l.jsxs("select",{id:"character-alignment",name:"character-alignment",value:R.alignment,onChange:V=>at("alignment",V.target.value),className:"fantasy-input",required:!0,children:[l.jsx("option",{value:"",children:"Select Alignment"}),oe.map(V=>l.jsx("option",{value:V,children:V},V))]})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Ability Scores"}),l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{htmlFor:"ability-method-standard",className:"block text-sm font-medium text-gray-200 mb-2",children:"Ability Score Generation Method"}),l.jsxs("div",{className:"flex space-x-4 mb-4",children:[l.jsxs("label",{className:"flex items-center",children:[l.jsx("input",{id:"ability-method-standard",type:"radio",name:"abilityMethod",value:"standard",checked:q==="standard",onChange:V=>T(V.target.value),className:"mr-2"}),l.jsx("span",{className:"text-gray-200",children:"Standard Array (15, 14, 13, 12, 10, 8)"})]}),l.jsxs("label",{className:"flex items-center",children:[l.jsx("input",{id:"ability-method-roll",type:"radio",name:"abilityMethod",value:"roll",checked:q==="roll",onChange:V=>T(V.target.value),className:"mr-2"}),l.jsx("span",{className:"text-gray-200",children:"Roll 4d6, Drop Lowest"})]})]}),q==="standard"&&l.jsx("button",{type:"button",onClick:Dt,className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Apply Standard Array"}),q==="roll"&&l.jsxs("div",{className:"space-y-2",children:[l.jsx("button",{type:"button",onClick:xt,disabled:Be,className:`fantasy-button ${Be?"bg-gray-500 cursor-not-allowed":"bg-gray-600 hover:bg-gray-700"}`,children:Be?"Scores Already Rolled":"Roll Ability Scores"}),Be&&l.jsx("p",{className:"text-sm text-gray-300",children:"You can only roll once, but you can reassign scores as many times as you like."}),b.length>0&&l.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[l.jsx("h3",{className:"font-semibold text-gray-100 mb-2",children:"Rolled Scores"}),l.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:P.map((V,W)=>l.jsx("span",{className:"bg-amber-900 text-amber-200 border border-amber-600 px-3 py-1 rounded-full text-sm font-medium",children:V},`${V}-${W}`))}),l.jsx("p",{className:"text-sm text-gray-300",children:"Click on an ability score below to assign your rolled scores. You can reassign them as many times as you want."})]})]})]}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:["strength","dexterity","constitution","intelligence","wisdom","charisma"].map(V=>{const W=N[V],we=R[V]||10;return l.jsxs("div",{className:"border border-gray-600 rounded-lg p-4",children:[l.jsx("label",{htmlFor:`ability-${V}`,className:"block text-sm font-medium text-gray-200 mb-2 capitalize",children:V}),W?l.jsxs("div",{className:"space-y-2",children:[l.jsx("div",{className:"text-lg font-bold text-amber-400",children:W}),l.jsx("button",{type:"button",onClick:()=>Ve(V),className:"text-xs text-red-400 hover:text-red-300",children:"Unassign"})]}):l.jsxs("div",{className:"space-y-2",children:[l.jsx("input",{id:`ability-${V}`,name:`ability-${V}`,type:"number",min:"1",max:"20",value:we,onChange:Le=>at(V,parseInt(Le.target.value)),className:"fantasy-input",required:!0}),P.length>0&&l.jsx("div",{className:"flex flex-wrap gap-1",children:P.map((Le,Zt)=>l.jsx("button",{type:"button",onClick:()=>it(Le,V),className:"bg-amber-900 hover:bg-amber-800 border border-amber-600 text-amber-200 px-2 py-1 rounded text-xs font-medium",children:Le},`${Le}-${Zt}`))})]}),l.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Modifier: ",Math.floor((we-10)/2)]})]},V)})})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Physical Description"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-age",className:"block text-sm font-medium text-gray-200 mb-2",children:"Age"}),l.jsx("input",{id:"character-age",name:"character-age",type:"text",placeholder:"Age",value:R.age,onChange:V=>at("age",V.target.value),className:"fantasy-input"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-height",className:"block text-sm font-medium text-gray-200 mb-2",children:"Height"}),l.jsx("input",{id:"character-height",name:"character-height",type:"text",placeholder:"Height",value:R.height,onChange:V=>at("height",V.target.value),className:"fantasy-input"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-weight",className:"block text-sm font-medium text-gray-200 mb-2",children:"Weight"}),l.jsx("input",{id:"character-weight",name:"character-weight",type:"text",placeholder:"Weight",value:R.weight,onChange:V=>at("weight",V.target.value),className:"fantasy-input"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-eyes",className:"block text-sm font-medium text-gray-200 mb-2",children:"Eye Color"}),l.jsx("input",{id:"character-eyes",name:"character-eyes",type:"text",placeholder:"Eye Color",value:R.eyes,onChange:V=>at("eyes",V.target.value),className:"fantasy-input"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-skin",className:"block text-sm font-medium text-gray-200 mb-2",children:"Skin Color"}),l.jsx("input",{id:"character-skin",name:"character-skin",type:"text",placeholder:"Skin Color",value:R.skin,onChange:V=>at("skin",V.target.value),className:"fantasy-input"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-hair",className:"block text-sm font-medium text-gray-200 mb-2",children:"Hair Color"}),l.jsx("input",{id:"character-hair",name:"character-hair",type:"text",placeholder:"Hair Color",value:R.hair,onChange:V=>at("hair",V.target.value),className:"fantasy-input"})]})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Personality"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-personality",className:"block text-sm font-medium text-gray-200 mb-2",children:"Personality Traits"}),l.jsx("textarea",{id:"character-personality",name:"character-personality",value:R.personality,onChange:V=>at("personality",V.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your character's personality..."})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-ideals",className:"block text-sm font-medium text-gray-200 mb-2",children:"Ideals"}),l.jsx("textarea",{id:"character-ideals",name:"character-ideals",value:R.ideals,onChange:V=>at("ideals",V.target.value),className:"fantasy-input",rows:"3",placeholder:"What does your character believe in?"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-bonds",className:"block text-sm font-medium text-gray-200 mb-2",children:"Bonds"}),l.jsx("textarea",{id:"character-bonds",name:"character-bonds",value:R.bonds,onChange:V=>at("bonds",V.target.value),className:"fantasy-input",rows:"3",placeholder:"What connections does your character have?"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"character-flaws",className:"block text-sm font-medium text-gray-200 mb-2",children:"Flaws"}),l.jsx("textarea",{id:"character-flaws",name:"character-flaws",value:R.flaws,onChange:V=>at("flaws",V.target.value),className:"fantasy-input",rows:"3",placeholder:"What are your character's weaknesses?"})]})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Backstory"}),l.jsx("textarea",{id:"character-backstory",name:"character-backstory",value:R.backstory,onChange:V=>at("backstory",V.target.value),className:"fantasy-input",rows:"6",placeholder:"Tell the story of your character's life before the adventure..."})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Starting Equipment"}),R.class&&Me[R.class]&&l.jsxs("div",{className:"mb-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Weapons"}),l.jsx("div",{className:"space-y-4",children:Object.entries(Me[R.class]).map(([V,W])=>l.jsxs("div",{children:[l.jsx("label",{htmlFor:`weapon-${V.toLowerCase().replace(/\s+/g,"")}`,className:"block text-sm font-medium text-gray-200 mb-2",children:V}),l.jsxs("select",{id:`weapon-${V.toLowerCase().replace(/\s+/g,"")}`,name:`weapon-${V.toLowerCase().replace(/\s+/g,"")}`,value:$e[V.toLowerCase().replace(/\s+/g,"")]||"",onChange:we=>Pe(Le=>({...Le,[V.toLowerCase().replace(/\s+/g,"")]:we.target.value})),className:"fantasy-input",children:[l.jsxs("option",{value:"",children:["Select ",V]}),W.map(we=>l.jsx("option",{value:we,children:we},we))]})]},V))})]}),R.class&&_e[R.class]&&l.jsxs("div",{className:"mb-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Cantrips"}),l.jsxs("p",{className:"text-sm text-gray-300 mb-3",children:["Select your starting cantrips (0-level spells). You can choose up to ",((jn=Ye[R.class])==null?void 0:jn.cantrips)||0," cantrips."]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto border border-gray-600 rounded-lg p-4",children:_e[R.class].map(V=>{var Le;const W=Y.includes(V.name),we=!W&&Y.length>=(((Le=Ye[R.class])==null?void 0:Le.cantrips)||0);return l.jsx("div",{className:`border rounded-lg p-3 ${W?"border-amber-500 bg-amber-900/20":"border-gray-600"} ${we?"opacity-50":"hover:border-gray-500"}`,children:l.jsxs("label",{className:`flex items-start space-x-3 cursor-pointer ${we?"cursor-not-allowed":""}`,children:[l.jsx("input",{id:`spell-${V.name.toLowerCase().replace(/\s+/g,"-")}`,name:`spell-${V.name.toLowerCase().replace(/\s+/g,"-")}`,type:"checkbox",checked:W,disabled:we,onChange:Zt=>{Zt.target.checked?ae(ln=>[...ln,V.name]):ae(ln=>ln.filter(Un=>Un!==V.name))},className:"rounded mt-1"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("div",{className:"font-medium text-gray-100",children:V.name}),l.jsx("div",{className:"text-sm text-gray-300 mt-1",children:V.description})]})]})},V.name)})}),l.jsxs("div",{className:"flex justify-between items-center mt-3",children:[l.jsxs("p",{className:"text-sm text-gray-400",children:["Selected: ",Y.length," / ",((Dn=Ye[R.class])==null?void 0:Dn.cantrips)||0," cantrips"]}),Y.length>=(((Xt=Ye[R.class])==null?void 0:Xt.cantrips)||0)&&l.jsx("p",{className:"text-sm text-green-400 font-medium",children:" Cantrip selection complete"})]})]}),R.class?l.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[l.jsxs("h3",{className:"font-semibold text-gray-100 mb-3",children:[R.class," Starting Equipment"]}),l.jsx("ul",{className:"space-y-1",children:z(R.class).map((V,W)=>l.jsxs("li",{className:"text-gray-200 flex items-start",children:[l.jsx("span",{className:"text-gray-400 mr-2",children:""}),V]},W))}),l.jsx("p",{className:"text-sm text-gray-300 mt-3",children:"This equipment will be automatically assigned to your character."})]}):l.jsx("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:l.jsx("p",{className:"text-gray-300",children:"Select a class to see your starting equipment."})})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Character Portrait"}),l.jsxs("div",{className:"flex items-center space-x-4",children:[l.jsx("div",{className:"w-32 h-32 bg-gray-600 rounded-lg flex items-center justify-center",children:l.jsx("span",{className:"text-gray-400",children:"Portrait Placeholder"})}),l.jsx("button",{type:"button",className:"fantasy-button",onClick:()=>{},children:"Upload Image"})]})]}),l.jsx("div",{className:"flex justify-center",children:h?l.jsx("button",{type:"submit",className:"fantasy-button bg-blue-600 hover:bg-blue-700",disabled:s,children:s?"Updating Character...":"Update Character"}):l.jsx("button",{type:"submit",className:"fantasy-button",disabled:s,children:s?"Saving Character...":"Save Character"})})]}),E&&l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:l.jsxs("div",{className:"fantasy-card max-w-md w-full mx-4",children:[l.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Save Character Preset"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"preset-name",className:"block text-sm font-medium text-gray-200 mb-2",children:"Preset Name"}),l.jsx("input",{id:"preset-name",name:"preset-name",type:"text",value:I,onChange:V=>_(V.target.value),onKeyPress:tt,className:"fantasy-input",placeholder:"Enter a name for your preset",autoFocus:!0})]}),l.jsxs("div",{className:"flex space-x-3",children:[l.jsx("button",{type:"button",onClick:()=>{v(!1),_("")},className:"fantasy-button bg-gray-600 hover:bg-gray-700 flex-1",children:"Cancel"}),l.jsx("button",{type:"button",onClick:Ot,className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 flex-1",children:"Save Preset"})]})]})]})}),x&&l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:l.jsxs("div",{className:"fantasy-card max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[l.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Load Character Preset"}),p.length===0?l.jsxs("div",{className:"text-center py-8",children:[l.jsx("p",{className:"text-gray-300 mb-4",children:"No character presets found."}),l.jsx("p",{className:"text-sm text-gray-400",children:"Create a character and save it as a preset to see it here."}),l.jsx("button",{type:"button",onClick:()=>C(!1),className:"fantasy-button mt-4",children:"Close"})]}):l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"grid gap-4",children:p.map(V=>l.jsxs("div",{className:"border border-gray-600 rounded-lg p-4 hover:border-gray-500",children:[l.jsxs("div",{className:"flex justify-between items-start mb-3",children:[l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold text-gray-100",children:V.name}),l.jsxs("p",{className:"text-sm text-gray-300",children:[V.data.race," ",V.data.class,"  Level ",V.data.level]}),V.data.background&&l.jsx("p",{className:"text-sm text-gray-400",children:V.data.background}),V.createdAt&&l.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Created: ",new Date(V.createdAt.toDate()).toLocaleDateString()]})]}),l.jsx("button",{type:"button",onClick:()=>St(V.id),className:"text-red-400 hover:text-red-300 text-sm",title:"Delete preset",children:""})]}),l.jsx("div",{className:"flex space-x-2",children:l.jsx("button",{type:"button",onClick:()=>Is(V),className:"fantasy-button bg-amber-600 hover:bg-amber-700 flex-1",children:"Load Preset"})})]},V.id))}),l.jsx("div",{className:"flex justify-center",children:l.jsx("button",{type:"button",onClick:()=>C(!1),className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Cancel"})})]})]})})]})})}catch(V){return console.error("Error rendering CharacterCreation:",V),l.jsx("div",{className:"fantasy-container py-8",children:l.jsx("div",{className:"fantasy-card",children:l.jsxs("div",{className:"text-center py-8",children:[l.jsx("p",{className:"text-red-400 text-sm",children:"An error occurred while rendering the component."}),l.jsx("p",{className:"text-gray-300",children:"Please try again later."})]})})})}}const ka={INVESTIGATION:"investigation",COMBAT:"combat",PERSUASION:"persuasion",EXPLORATION:"exploration",SOCIAL:"social"},Zr={HIDDEN:"hidden",DISCOVERED:"discovered",IN_PROGRESS:"in_progress",COMPLETED:"completed",FAILED:"failed"},$V=n=>{const e=[{id:"investigate_area",type:ka.INVESTIGATION,title:"Investigate the Area",description:"Search for clues and gather information about the situation",keywords:["search","investigate","examine","look around","check","explore"],state:Zr.HIDDEN,discoveredAt:null,completedAt:null},{id:"resolve_conflict",type:ka.COMBAT,title:"Resolve the Conflict",description:"Engage in combat to overcome the threat",keywords:["fight","attack","defend","combat","battle"],state:Zr.HIDDEN,discoveredAt:null,completedAt:null},{id:"negotiate_peace",type:ka.PERSUASION,title:"Negotiate Peace",description:"Use diplomacy and persuasion to resolve the situation peacefully",keywords:["talk","negotiate","persuade","convince","diplomacy","peace"],state:Zr.HIDDEN,discoveredAt:null,completedAt:null}],t=[];return(n.toLowerCase().includes("thief")||n.toLowerCase().includes("stealth"))&&t.push({id:"stealth_approach",type:ka.EXPLORATION,title:"Stealth Approach",description:"Use stealth to avoid detection and gather information",keywords:["sneak","stealth","hide","silent","unnoticed"],state:Zr.HIDDEN,discoveredAt:null,completedAt:null}),(n.toLowerCase().includes("merchant")||n.toLowerCase().includes("trade"))&&t.push({id:"establish_trade",type:ka.SOCIAL,title:"Establish Trade Relations",description:"Build economic relationships with the locals",keywords:["trade","bargain","deal","commerce","business"],state:Zr.HIDDEN,discoveredAt:null,completedAt:null}),(n.toLowerCase().includes("scholar")||n.toLowerCase().includes("knowledge"))&&t.push({id:"gather_knowledge",type:ka.INVESTIGATION,title:"Gather Ancient Knowledge",description:"Discover and preserve valuable information",keywords:["research","study","learn","knowledge","ancient","lore"],state:Zr.HIDDEN,discoveredAt:null,completedAt:null}),[...e,...t]},h_=n=>n.filter(e=>e.state===Zr.DISCOVERED||e.state===Zr.IN_PROGRESS||e.state===Zr.COMPLETED);function UV(){var yr,Hr,j,J,be,ke,G,Ce,Ee,qe,Mn,_t,Ct,xa,Ci,vr,_a;const{user:n,loading:e}=vV(),{partyId:t}=hg(),r=fr(),[s,i]=k.useState(null),[a,o]=k.useState(null),[c,d]=k.useState([]),[h,m]=k.useState([]),[p,y]=k.useState(!0),[E,v]=k.useState(""),[I,_]=k.useState(""),[x,C]=k.useState("storytelling"),[R,F]=k.useState([]),[q,T]=k.useState(null),[b,A]=k.useState(!1),[P,D]=k.useState(null),[N,S]=k.useState(!1),[Be,Fe]=k.useState(null),[$e,Pe]=k.useState(null),[Y,ae]=k.useState(!1),[Se,ee]=k.useState(!1),[H,ne]=k.useState(!1),[pe,Ue]=k.useState(!1),[oe,ge]=k.useState("inactive"),[X,Me]=k.useState(null),[_e,Ye]=k.useState(null),[z,It]=k.useState(null),[xt,it]=k.useState(!1),[Ve,Dt]=k.useState([]),[at,Rn]=k.useState(!1),[Ot,tt]=k.useState(!1),Is=new Ny,St=new Py,jn=()=>{var M;return((M=s==null?void 0:s.readyPlayers)==null?void 0:M.length)||0},Dn=()=>c.length,Xt=()=>h.sort((M,U)=>M.name.localeCompare(U.name)),V=M=>M?M.replace(/\*\*(.*?)\*\*/g,'<strong class="text-yellow-400 font-bold">$1</strong>').replace(/\*(.*?)\*/g,'<em class="text-blue-400 italic">$1</em>').replace(/`(.*?)`/g,'<code class="bg-slate-700 px-2 py-1 rounded text-slate-200 font-mono text-sm">$1</code>').replace(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*):/g,'<span class="text-green-400 font-semibold">$1:</span>').replace(/\b(weapon|sword|shield|armor|magic|spell|dragon|monster|treasure|gold|silver|quest|adventure|hero|villain)\b/gi,'<span class="text-orange-400 font-medium">$1</span>').replace(/\b([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\b/g,U=>U.includes("<")||["The","A","An","And","Or","But","In","On","At","To","For","Of","With","By"].includes(U)?U:`<span class="text-purple-400 font-medium">${U}</span>`).replace(/\n/g,"<br>"):"";k.useEffect(()=>{!n&&!e&&r("/login")},[n,e,r]),k.useEffect(()=>{t&&n&&!e&&W()},[t,n,e]),k.useEffect(()=>{if(s!=null&&s.id){console.log(" Setting up real-time subscription for story:",s.id);const M=hS(s.id,async U=>{var ve,le,ce,ye,me,xe,je,ue,te;if(U){console.log(" Story update received:",U),i(U);const Ae=U.currentContent||"",Ft=U.storyMetadata||{},nt=Ft.phaseStatus||(Ae.toLowerCase().includes("phase_status:")?(le=(ve=Ae.toLowerCase().split("phase_status:")[1])==null?void 0:ve.split(`
`)[0])==null?void 0:le.trim():null)||(Ae.toLowerCase().includes("conflict")?"conflict":null),vn=["attack","battle","combat","fight","enemy","enemies","monster","creature","ghoul","bandit","goblin","troll"].some(cn=>Ae.toLowerCase().includes(cn));if(console.log(" Phase detection debug:",{storyMetadataPhase:Ft.phaseStatus,contentPhase:Ae.toLowerCase().includes("phase_status:")?(ye=(ce=Ae.toLowerCase().split("phase_status:")[1])==null?void 0:ce.split(`
`)[0])==null?void 0:ye.trim():"not found",conflictKeywords:Ae.toLowerCase().includes("conflict"),combatKeywords:vn,finalPhaseStatus:nt}),U.storyMetadata&&String(U.storyMetadata.phaseStatus).toLowerCase()==="conflict"&&!at&&!Ot){tt(!0);const cn=(a==null?void 0:a.members)||[];if(((me=U.readyPlayers)==null?void 0:me.length)===cn.length&&cn.length>0){const Ni=h.length===cn.length;if(console.log("Combat session creation check:",{readyPlayers:(xe=U.readyPlayers)==null?void 0:xe.length,totalMembers:cn.length,partyCharactersLoaded:h.length,allCharactersLoaded:Ni,partyCharacters:h.map(Jn=>({id:Jn.id,name:Jn.name,userId:Jn.userId}))}),!Ni){console.log("Waiting for character data to load...");return}try{const Jn=await St.createCombatSession(t,h.length>0?h:c,((je=U.storyMetadata)==null?void 0:je.enemies)||[],U.currentContent||"Combat encounter");tt(!1),Rn(!0),r(`/combat/${Jn.id}`)}catch(Jn){console.error("Failed to create combat session:",Jn),tt(!1),Rn(!1)}setTimeout(()=>{Ot&&(tt(!1),Rn(!1))},5e3)}}else U.storyMetadata&&String(U.storyMetadata.phaseStatus).toLowerCase()!=="conflict"&&(Rn(!1),tt(!1));(ue=U.readyPlayers)!=null&&ue.includes(n==null?void 0:n.uid)&&ae(!0);const xr=(a==null?void 0:a.members)||[];((te=U.readyPlayers)==null?void 0:te.length)===xr.length&&xr.length>0?ee(!0):ee(!1)}});return Pe(()=>M),()=>M()}},[s==null?void 0:s.id,n==null?void 0:n.uid,a==null?void 0:a.members,h,oe,r,at]),k.useEffect(()=>{if(_e){console.log(" Setting up real-time subscription for combat session:",_e);const M=Cy(_e,U=>{var ve;if(U){if(console.log(" Combat session update received from database:",U),console.log(" Current local combat session state:",X),console.log(" Combat session state:",U.combatState),console.log(" Combat session ID:",U.id),console.log(" Local combat state:",oe),X){const ye=X.combatants.filter(te=>te.id.startsWith("enemy_")),me=U.enemies||[];console.log(" Comparing local vs database enemy HP:");let xe=!1,je=!1,ue=!1;if(ye.forEach(te=>{const Ae=me.find(Ft=>Ft.id===te.id);Ae&&te.hp!==Ae.hp&&(console.log(` HP mismatch for ${te.name}: Local=${te.hp}, DB=${Ae.hp}`),te.hp<Ae.hp&&(xe=!0,console.log(` Preserving local damage for ${te.name}`)))}),X.currentTurn!==U.currentTurn&&(console.log(` Turn mismatch: Local=${X.currentTurn}, DB=${U.currentTurn}`),je=!0),oe!==U.combatState&&(console.log(` Combat state mismatch: Local=${oe}, DB=${U.combatState}`),ue=!0),xe||je||ue){console.log(" Skipping database update to preserve local changes");return}}const le={combatants:[...U.partyMembers,...U.enemies],currentTurn:U.currentTurn,round:U.round,combatState:U.combatState,storyContext:U.storyContext,environmentalFeatures:U.environmentalFeatures,teamUpOpportunities:U.teamUpOpportunities,narrativeElements:U.narrativeElements};console.log(" Reconstructed session from database:",le),console.log(" Reconstructed session combatants:",le.combatants.map(ye=>`${ye.name}: ${ye.hp}/${ye.maxHp}`)),console.log(" Database currentTurn:",U.currentTurn),console.log(" Next combatant from database:",(ve=le.combatants[U.currentTurn])==null?void 0:ve.name),Me(le);const ce=le.combatants[U.currentTurn];ce&&(!z||z.id!==ce.id)?(console.log(" Updating currentCombatant from database:",ce.name),It(ce)):ce?console.log(" CurrentCombatant unchanged:",ce.name):console.log(" No valid currentCombatant found in database update"),U.combatState!==oe&&(console.log(" Updating combat state from database:",U.combatState),ge(U.combatState))}else console.log(" Combat session ended or not found"),console.log(" Clearing combat state..."),Me(null),Ye(null),ge("inactive"),It(null)});return()=>M()}},[_e,z,oe]),k.useEffect(()=>{z&&X?(console.log(" Turn changed to:",z.name,"at index:",X.currentTurn),console.log(" Full turn order:",X.combatants.map((M,U)=>`${U}: ${M.name} (${M.initiative})`)),console.log(" Current combatant details:",{id:z.id,name:z.name,hp:z.hp,maxHp:z.maxHp,isEnemy:z.id.startsWith("enemy_"),userId:z.userId})):!z&&X&&(console.log(" No currentCombatant set but combatSession exists"),console.log(" Combat session currentTurn:",X.currentTurn),console.log(" Available combatants:",X.combatants.map(M=>M.name)))},[z,X]),k.useEffect(()=>{var M;console.log(" Combat state changed to:",oe),console.log(" Combat session exists:",!!X),console.log(" Combat session ID:",_e),X&&(console.log(" Combat session state:",X.combatState),console.log(" Combat session combatants:",((M=X.combatants)==null?void 0:M.length)||0))},[oe,X,_e]),k.useEffect(()=>{if(oe==="active"&&z&&z.id.startsWith("enemy_")&&!xt){console.log(" Auto-processing enemy turn for:",z.name),console.log(" Current turn order:",X==null?void 0:X.combatants.map((U,ve)=>`${ve}: ${U.name} (${U.initiative})`)),console.log(" Current turn index:",X==null?void 0:X.currentTurn);const M=setTimeout(async()=>{var U;try{it(!0);const ve=St.getAvailableActions(z);console.log(" Available actions for enemy:",ve);const le=St.getValidTargets(z,"attack",X);console.log(" Valid targets for enemy:",le.map(me=>me.name));const ce=St.makeEnemyDecision(z,ve,le,X);console.log(" Enemy decision:",ce);const ye=await St.executeAction(X,z.id,ce.action,ce.targetId);if(ye.success){console.log(" Enemy action result:",ye),console.log(" Action details:",{enemy:z.name,action:ce.action,target:ce.targetId,specialAttack:ce.specialAttack,damageType:ce.damageType});const me=ye.combatSession;if(ye.results&&ye.results.damage>0){const ue=me.combatants.find(te=>te.id===ce.targetId);if(ue){const te=ue.hp;ue.hp=Math.max(0,ue.hp-ye.results.damage),console.log(` Enemy applied ${ye.results.damage} damage to ${ue.name}. HP: ${te}  ${ue.hp}`),yn({type:"damage",attacker:z.name,target:ue.name,damage:ye.results.damage,targetHp:ue.hp,action:ce.action,message:`${z.name} deals ${ye.results.damage} damage to ${ue.name} (${ue.hp} HP remaining)`})}}else if(ye.results&&ye.results.healing>0){const ue=me.combatants.find(te=>te.id===ce.targetId);ue&&yn({type:"healing",healer:z.name,target:ue.name,healing:ye.results.healing,action:ce.action,message:`${z.name} heals ${ue.name} for ${ye.results.healing} HP`})}else yn({type:"action",actor:z.name,action:ce.action,target:((U=me.combatants.find(ue=>ue.id===ce.targetId))==null?void 0:U.name)||"None",message:`${z.name} uses ${ce.action}`});console.log(" Updated combat session:",me),console.log(" Combatants after enemy action:",me.combatants.map(ue=>`${ue.name}: ${ue.hp}/${ue.maxHp}`)),Me(me),console.log(" Combat session state updated in UI:",{combatants:me.combatants.map(ue=>({name:ue.name,hp:ue.hp,maxHp:ue.maxHp,isEnemy:ue.id.startsWith("enemy_")}))}),_e?(console.log(" Updating combat session in database:",{combatSessionId:_e,currentTurn:me.currentTurn,round:me.round,partyMembers:me.combatants.filter(ue=>!ue.id.startsWith("enemy_")).map(ue=>({name:ue.name,hp:ue.hp})),enemies:me.combatants.filter(ue=>ue.id.startsWith("enemy_")).map(ue=>({name:ue.name,hp:ue.hp}))}),setTimeout(async()=>{try{await Xr(_e,{currentTurn:me.currentTurn,round:me.round,combatState:me.combatState,partyMembers:me.combatants.filter(ue=>!ue.id.startsWith("enemy_")),enemies:me.combatants.filter(ue=>ue.id.startsWith("enemy_"))}),console.log(" Combat session updated in database successfully")}catch(ue){console.error(" Error updating combat session in database:",ue)}},100)):console.log(" No combatSessionId available for database update");const xe=me.combatants[me.currentTurn];console.log(" About to update currentCombatant to:",xe==null?void 0:xe.name),console.log(" Current currentCombatant:",z==null?void 0:z.name),console.log(" Will change:",(z==null?void 0:z.id)!==(xe==null?void 0:xe.id)),setTimeout(()=>{It(xe),console.log(" Turn advanced to:",xe==null?void 0:xe.name)},50);const je=St.checkCombatEnd(me);if(je.isComplete){console.log(" Combat ended:",je),ge("complete"),yn({type:"combat_end",result:je.result,message:je.result==="victory"?" Victory! All enemies have been defeated!":je.result==="defeat"?" Defeat! The party has been overwhelmed!":" Combat ends in a draw."}),setTimeout(()=>{Dt([])},5e3);const ue=St.generateCombatSummary(me,je),te=St.generateCombatNarrative(me,je);await Tn(s.id,{currentContent:te,storyMetadata:{...s.storyMetadata,phaseStatus:"Storytelling",combatResult:je}})}else me.combatants.filter(te=>te.id.startsWith("enemy_")&&te.hp<=0&&te.maxHp>0).forEach(te=>{te.maxHp=0,yn({type:"enemy_death",enemy:te.name,message:` ${te.name} has been defeated!`})})}it(!1)}catch(ve){console.error(" Error processing enemy turn:",ve),it(!1)}},2e3);return()=>clearTimeout(M)}},[z,oe,X,s==null?void 0:s.id,s==null?void 0:s.storyMetadata,St,xt,_e]),k.useEffect(()=>{if(t){console.log(" Setting up real-time subscription for characters:",t);const M=lS(t,async U=>{if(U){console.log(" Party update received:",U),o(U),d(U.members||[]);try{const ve=await ko(t);console.log(" Characters reloaded:",ve),console.log(" Character count:",ve.length),console.log(" Character details:",ve.map(le=>({id:le.id,name:le.name,userId:le.userId,partyId:le.partyId}))),m(ve)}catch(ve){console.error(" Error reloading characters:",ve)}}});return()=>M()}},[t]),k.useEffect(()=>()=>{$e&&$e()},[$e]);const W=k.useCallback(async()=>{if(t)try{console.log(" Starting loadStoryAndCharacters..."),y(!0);const M=await oS(t);console.log(" Party data loaded:",M),o(M);const U=(M==null?void 0:M.members)||[];d(U);let ve=await uS(t);console.log(" Story data loaded:",ve),ve||(console.log(" Creating new campaign story..."),ve=await cS(t),console.log(" New story created:",ve)),i(ve);const le=await ko(t);console.log(" Characters loaded:",le),console.log(" Character count:",le.length),console.log(" Character details:",le.map(ye=>({id:ye.id,name:ye.name,userId:ye.userId,partyId:ye.partyId}))),m(le);const ce=$V((M==null?void 0:M.description)||"adventure");F(ce),console.log(" loadStoryAndCharacters completed successfully")}catch(M){console.error(" Error loading story and characters:",M),v("Failed to load campaign data")}finally{y(!1)}},[t]),we=k.useCallback(async()=>{if(!(!n||!s))try{console.log(" User readying up..."),y(!0),await dS(s.id,n.uid),console.log(" Player ready status set")}catch(M){console.error(" Error readying up:",M),v("Failed to ready up")}finally{y(!1)}},[n,s]),Le=k.useCallback(async()=>{if(!(!n||!s))try{console.log(" Starting story generation..."),y(!0),ne(!0),await Tn(s.id,{status:"generating"}),console.log(" Status set to generating");try{const M=await Mu.generateStoryPlots(h,(a==null?void 0:a.description)||"An epic adventure awaits!",R);console.log(" Generated plots response:",M);const U=pr(M);console.log(" Parsed plots array:",U),await Tn(s.id,{status:"voting",availablePlots:U}),console.log(" Moved to voting phase")}catch(M){console.warn("AI service unavailable, using fallback plots:",M);const U=[{title:"The Lost Artifact",description:"A powerful artifact has been stolen and the party must track it down through dangerous territory.",summary:"An ancient artifact of great power has been stolen from the local temple. The party must follow the trail of the thieves through dangerous wilderness and hostile territory.",campaignLength:"medium"},{title:"The Dark Forest",description:"A mysterious forest has appeared overnight, and strange creatures are emerging from its depths.",summary:"A dark forest has mysteriously appeared on the outskirts of town. Strange creatures and magical phenomena are emerging, and the party must investigate the source.",campaignLength:"short"},{title:"The Dragon's Lair",description:"A dragon has been terrorizing the countryside, and the party must find a way to stop it.",summary:"A fearsome dragon has been attacking villages and stealing livestock. The party must find the dragon's lair and either defeat it or negotiate a peaceful solution.",campaignLength:"long"}];await Tn(s.id,{status:"voting",availablePlots:U}),console.log(" Moved to voting phase with fallback plots"),v("AI service temporarily unavailable. Using predefined plot options.")}}catch(M){console.error(" Error starting story:",M),v("Failed to start story generation"),await Tn(s.id,{status:"ready_up"})}finally{y(!1),ne(!1)}},[n,s,h,a==null?void 0:a.description,R]),Zt=k.useCallback(async M=>{var U;try{console.log(" Selecting plot:",M),y(!0);const ve=((U=s==null?void 0:s.availablePlots)==null?void 0:U.filter(ce=>ce.title&&!ce.title.startsWith("Plot ")))||[],le=ve[M];if(console.log(" Available plots:",s==null?void 0:s.availablePlots),console.log(" Valid plots:",ve),console.log(" Selected plot:",le),!le){console.error(" Selected plot not found"),v("Selected plot not found");return}await Tn(s.id,{status:"generating_story",selectedPlot:M,selectedPlotData:le,currentContent:`Generating story content for: ${le.title}...`}),console.log(" Status set to generating_story");try{const ce=await Mu.generateStoryIntroduction(h,le.description,le.title,a);console.log(" Generated story content:",ce),await Tn(s.id,{status:"storytelling",currentContent:ce||`The adventure begins with ${le.title}!`,currentSpeaker:{userId:a.dmId,name:"Dungeon Master",id:"dm",race:"DM",class:"Dungeon Master"}}),console.log(" Plot selected and story generated successfully")}catch(ce){console.warn("AI service unavailable, using fallback story:",ce);const ye=`The adventure begins with ${le.title}!

${le.summary}

The party finds themselves at the beginning of this epic journey. The path ahead is uncertain, but the promise of adventure and glory awaits those brave enough to take the first step.

What would you like to do?`;await Tn(s.id,{status:"storytelling",currentContent:ye,currentSpeaker:{userId:a.dmId,name:"Dungeon Master",id:"dm",race:"DM",class:"Dungeon Master"}}),console.log(" Plot selected with fallback story content"),v("AI service temporarily unavailable. Using simplified story introduction.")}}catch(ve){console.error(" Error selecting plot:",ve),v("Failed to select plot"),await Tn(s.id,{status:"voting"})}finally{y(!1)}},[s,h,a]),ln=k.useCallback(async()=>{var M,U;if(I.trim())try{y(!0),v("");const ve=h.find(le=>le.userId===(n==null?void 0:n.uid));if(!ve){v("You need a character to participate in the story");return}try{const le=await Is.validatePlayerAction(I,ve,{storyState:s,currentContent:(s==null?void 0:s.currentContent)||"",party:a});T(le),le.diceResult&&(A(!0),D(le))}catch(le){console.warn("Action validation unavailable:",le)}try{const le=await Mu.generateStructuredStoryResponse(h,(s==null?void 0:s.storyMessages)||[],I,x,h_(R),null,a),ce=gr(le),ye={speaker:((M=s==null?void 0:s.currentSpeaker)==null?void 0:M.name)||ve.name,content:I,timestamp:new Date};await Tn(s.id,{currentContent:ce.storyContent||`${(s==null?void 0:s.currentContent)||""}

${ve.name}: "${I}"`,currentSpeaker:null,storyMessages:[...(s==null?void 0:s.storyMessages)||[],ye],storyMetadata:{currentLocation:ce.currentLocation,activeNPCs:ce.activeNPCs,plotDevelopments:ce.plotDevelopments,characterReactions:ce.characterReactions,nextActions:ce.nextActions,storyTone:ce.storyTone,phaseStatus:ce.phaseStatus,enemyDetails:ce.enemyDetails||[]}})}catch(le){console.warn("AI service unavailable, continuing story manually:",le);const ce={speaker:((U=s==null?void 0:s.currentSpeaker)==null?void 0:U.name)||ve.name,content:I,timestamp:new Date};await Tn(s.id,{currentContent:`${(s==null?void 0:s.currentContent)||""}

${ve.name}: "${I}"`,currentSpeaker:null,storyMessages:[...(s==null?void 0:s.storyMessages)||[],ce]}),v("AI service temporarily unavailable. Story continued manually.")}_(""),T(null),await W()}catch(ve){console.error("Error sending response:",ve),v("Failed to send response")}finally{y(!1)}},[I,h,n==null?void 0:n.uid,s,a,x,R,W]),Un=k.useCallback(()=>{A(!1),D(null)},[]),en=k.useCallback(()=>{S(!1),Fe(null)},[]),Ss=k.useCallback(async()=>{A(!1)},[]),Bn=k.useCallback(()=>{A(!1),D(null)},[]),dt=k.useCallback(async M=>{try{console.log(" Setting speaker:",M),console.log(" Character data:",JSON.stringify(M)),console.log(" Story ID:",s==null?void 0:s.id),y(!0),M?await mS(s.id,M):await Tn(s.id,{currentSpeaker:null}),console.log(" Speaker set")}catch(U){console.error(" Error setting speaker:",U),v("Failed to set speaker")}finally{y(!1)}},[s==null?void 0:s.id]);k.useCallback(async()=>{try{console.log(" Continuing story..."),y(!0);const M=await Mu.generateStoryContinuation(h,(s==null?void 0:s.storyMessages)||[],"The story continues...",x,h_(R),null,a);await Tn(s.id,{currentContent:M||"The story continues...",currentSpeaker:null}),console.log(" Story continued")}catch(M){console.error(" Error continuing story:",M),v("Failed to continue story")}finally{y(!1)}},[h,s,x,R,a]);const pr=M=>{try{console.log(" Parsing plots from response...");const U=M.split(/\*\*Plot Option \d+:\*\*/).filter(le=>le.trim());console.log(" Found plot sections:",U.length);const ve=U.map((le,ce)=>{const ye=le.trim().split(`
`).filter(te=>te.trim());let me=`Plot ${ce+1}`,xe="",je="",ue="";for(let te=0;te<ye.length;te++){const Ae=ye[te].trim();if(Ae.startsWith("1. Title:")){const Ft=Ae.match(/1\.\s*Title:\s*"([^"]+)"/);Ft&&(me=Ft[1])}if(Ae.startsWith("2. Summary:")){let Ft=Ae.replace("2. Summary:","").trim(),nt=te+1;for(;nt<ye.length&&!ye[nt].trim().startsWith("3.");)Ft+=" "+ye[nt].trim(),nt++;je=Ft.trim(),te=nt-1}if(Ae.startsWith("3. Main Conflict:")){let Ft=Ae.replace("3. Main Conflict:","").trim(),nt=te+1;for(;nt<ye.length&&!ye[nt].trim().startsWith("4.");)Ft+=" "+ye[nt].trim(),nt++;xe=Ft.trim(),te=nt-1}if(Ae.startsWith("5. Estimated Campaign Length:")){const Ft=Ae.match(/5\.\s*Estimated Campaign Length:\s*(short|medium|long)/i);Ft&&(ue=Ft[1].toLowerCase())}}return!xe&&je&&(xe=je),console.log(` Plot ${ce+1} parsed:`,{title:me,description:xe,summary:je,campaignLength:ue}),{id:ce,title:me,description:xe||je||`Plot ${ce+1} description`,summary:je,campaignLength:ue,index:ce}});return console.log(" Parsed plots:",ve),ve}catch(U){return console.error(" Error parsing plots:",U),[{id:0,title:"Plot 1",description:"Adventure awaits!",index:0},{id:1,title:"Plot 2",description:"Another exciting journey!",index:1},{id:2,title:"Plot 3",description:"A mysterious quest!",index:2}]}},gr=M=>{try{console.log(" Parsing structured response:",M);const U={storyContent:"",currentLocation:"",activeNPCs:[],plotDevelopments:"",characterReactions:"",nextActions:[],storyTone:"",phaseStatus:"",enemyDetails:[]},ve=M.match(/\*\*STORY_CONTENT:\*\*\s*([\s\S]*?)(?=\*\*|$)/);ve&&(U.storyContent=ve[1].trim());const le=M.match(/\*\*CURRENT_LOCATION:\*\*\s*([\s\S]*?)(?=\*\*|$)/);le&&(U.currentLocation=le[1].trim());const ce=M.match(/\*\*ACTIVE_NPCS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);ce&&(U.activeNPCs=ce[1].trim().split(",").map(Ae=>Ae.trim()).filter(Ae=>Ae));const ye=M.match(/\*\*PLOT_DEVELOPMENTS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);ye&&(U.plotDevelopments=ye[1].trim());const me=M.match(/\*\*CHARACTER_REACTIONS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);me&&(U.characterReactions=me[1].trim());const xe=M.match(/\*\*NEXT_ACTIONS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);xe&&(U.nextActions=xe[1].trim().split(",").map(Ae=>Ae.trim()).filter(Ae=>Ae));const je=M.match(/\*\*STORY_TONE:\*\*\s*([\s\S]*?)(?=\*\*|$)/);je&&(U.storyTone=je[1].trim());const ue=M.match(/\*\*PHASE_STATUS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);ue&&(U.phaseStatus=ue[1].trim());const te=M.match(/\*\*ENEMY_DETAILS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);if(te){const Ae=te[1].trim();console.log(" Raw enemy details text:",Ae);const Ft=Ae.split(/(?=Name:)/).filter(nt=>nt.trim());console.log(" Enemy blocks found:",Ft.length),U.enemyDetails=Ft.map((nt,wa)=>{console.log(` Parsing enemy block ${wa}:`,nt);const vn={},xr=nt.match(/Name:\s*([^\n]+)/);xr&&(vn.name=xr[1].trim());const cn=nt.match(/Type:\s*([^\n]+)/);cn&&(vn.type=cn[1].trim());const Ai=nt.match(/Level:\s*([^\n]+)/);Ai&&(vn.level=parseInt(Ai[1].trim())||1);const Ni=nt.match(/HP:\s*([^\n]+)/);if(Ni){const Zo=Ni[1].trim().match(/(\d+)/);vn.hp=Zo?parseInt(Zo[1]):20}const Jn=nt.match(/AC:\s*([^\n]+)/);Jn&&(vn.ac=parseInt(Jn[1].trim())||12);const Jo=nt.match(/Basic Attack:\s*([^\n]+)/);Jo&&(vn.basicAttack=Jo[1].trim());const Xo=nt.match(/Special Ability:\s*([^\n]+)/);Xo&&(vn.specialAbility=Xo[1].trim());const ba=nt.match(/Stats:\s*([^\n]+)/);return ba&&(vn.stats=ba[1].trim()),console.log(` Parsed enemy ${wa}:`,vn),vn})}return console.log(" Parsed structured response:",U),U}catch(U){return console.error(" Error parsing structured response:",U),{storyContent:M,currentLocation:"",activeNPCs:[],plotDevelopments:"",characterReactions:"",nextActions:[],storyTone:"",phaseStatus:"",enemyDetails:[]}}},yn=k.useCallback(M=>{const U=new Date().toLocaleTimeString(),ve={id:Date.now(),timestamp:U,...M};Dt(le=>[...le,ve]),console.log(" Battle Log Entry:",ve)},[]),Nr=k.useCallback(async(M,U)=>{var ve,le,ce,ye;try{if(xt){console.log(" Combat action already processing, skipping...");return}if(console.log(" Executing combat action:",M,"on target:",U),console.log(" Current combatant:",z?{name:z.name,id:z.id}:null),console.log(" Combat session state:",X?{currentTurn:X.currentTurn,combatants:X.combatants.map(te=>({name:te.name,id:te.id,hp:te.hp,maxHp:te.maxHp}))}:null),it(!0),!X||!z){console.error(" No active combat session or current combatant"),it(!1);return}const me=await St.executeAction(X,z.id,M,U);if(!me.success){console.error(" Combat action failed:",me.message),it(!1);return}console.log(" Combat action result:",me),console.log(" Result damage value:",(ve=me.results)==null?void 0:ve.damage),console.log(" Result healing value:",(le=me.results)==null?void 0:le.healing);const xe=me.updatedSession;if(me.results&&me.results.damage>0){const te=xe.combatants.find(Ae=>Ae.id===U);if(te){const Ae=te.hp;te.hp=Math.max(0,te.hp-me.results.damage),console.log(` Applied ${me.results.damage} damage to ${te.name}. HP: ${Ae}  ${te.hp}`),console.log(" Target details after damage:",{name:te.name,id:te.id,hp:te.hp,maxHp:te.maxHp,isEnemy:te.id.startsWith("enemy_")}),yn({type:"damage",attacker:z.name,target:te.name,damage:me.results.damage,targetHp:te.hp,action:M,message:`${z.name} deals ${me.results.damage} damage to ${te.name} (${te.hp} HP remaining)`})}else console.error(" Target not found in updated session:",U),console.log(" Available combatants:",xe.combatants.map(Ae=>({id:Ae.id,name:Ae.name})))}else if(me.results&&me.results.healing>0){const te=xe.combatants.find(Ae=>Ae.id===U);te&&yn({type:"healing",healer:z.name,target:te.name,healing:me.results.healing,action:M,message:`${z.name} heals ${te.name} for ${me.results.healing} HP`})}else yn({type:"action",actor:z.name,action:M,target:((ce=xe.combatants.find(te=>te.id===U))==null?void 0:ce.name)||"None",message:`${z.name} uses ${M}`});console.log(" Updated combat session:",xe),console.log(" Combatants after action:",xe.combatants.map(te=>`${te.name}: ${te.hp}/${te.maxHp}`)),console.log(" Next turn index:",xe.currentTurn),console.log(" Next combatant:",(ye=xe.combatants[xe.currentTurn])==null?void 0:ye.name),Me(xe);const je=xe.combatants[xe.currentTurn];console.log(" About to update currentCombatant to:",je==null?void 0:je.name),console.log(" Current currentCombatant:",z==null?void 0:z.name),console.log(" Will change:",(z==null?void 0:z.id)!==(je==null?void 0:je.id)),setTimeout(()=>{It(je),console.log(" Turn advanced to:",je==null?void 0:je.name)},50),_e?(console.log(" Updating combat session in database:",{combatSessionId:_e,currentTurn:xe.currentTurn,round:xe.round,partyMembers:xe.combatants.filter(te=>!te.id.startsWith("enemy_")).map(te=>({name:te.name,hp:te.hp})),enemies:xe.combatants.filter(te=>te.id.startsWith("enemy_")).map(te=>({name:te.name,hp:te.hp}))}),setTimeout(async()=>{try{await Xr(_e,{currentTurn:xe.currentTurn,round:xe.round,combatState:xe.combatState,partyMembers:xe.combatants.filter(te=>!te.id.startsWith("enemy_")),enemies:xe.combatants.filter(te=>te.id.startsWith("enemy_"))}),console.log(" Combat session updated in database successfully")}catch(te){console.error(" Error updating combat session in database:",te)}},100)):console.log(" No combatSessionId available for database update"),setSelectedAction(null);const ue=St.checkCombatEnd(xe);if(ue.isComplete){console.log(" Combat ended:",ue),ge("complete"),yn({type:"combat_end",result:ue.result,message:ue.result==="victory"?" Victory! All enemies have been defeated!":ue.result==="defeat"?" Defeat! The party has been overwhelmed!":" Combat ends in a draw."}),setTimeout(()=>{Dt([])},5e3);const te=St.generateCombatSummary(xe,ue),Ae=St.generateCombatNarrative(xe,ue);await Tn(s.id,{currentContent:Ae,storyMetadata:{...s.storyMetadata,phaseStatus:"Storytelling",combatResult:ue}})}else xe.combatants.filter(Ae=>Ae.id.startsWith("enemy_")&&Ae.hp<=0&&Ae.maxHp>0).forEach(Ae=>{Ae.maxHp=0,yn({type:"enemy_death",enemy:Ae.name,message:` ${Ae.name} has been defeated!`})});it(!1)}catch(me){console.error(" Error executing combat action:",me),it(!1)}},[X,z,s==null?void 0:s.id,s==null?void 0:s.storyMetadata,St,xt,_e]);return e?l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),l.jsx("p",{className:"text-slate-300",children:"Loading campaign..."})]})}):E?l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-red-400 mb-4",children:E}),l.jsxs("div",{className:"space-x-4",children:[l.jsx("button",{onClick:()=>{v(""),W()},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Retry"}),l.jsx("button",{onClick:()=>r("/dashboard"),className:"bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg transition-colors",children:"Back to Dashboard"})]})]})}):s?l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:l.jsxs("div",{className:"container mx-auto px-4 py-6",children:[l.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-lg p-6 mb-6",children:l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-3xl font-bold text-slate-200 mb-2",children:(a==null?void 0:a.name)||"Campaign Story"}),l.jsx("p",{className:"text-slate-300",children:(a==null?void 0:a.description)||"Adventure awaits!"})]}),l.jsx("div",{className:"text-right",children:l.jsxs("div",{className:"text-slate-300 text-sm",children:["Status: ",l.jsx("span",{className:"font-semibold text-slate-200",children:(s==null?void 0:s.status)||"unknown"})]})})]})}),(s==null?void 0:s.status)==="ready_up"&&l.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-3",children:"Campaign Lobby"}),l.jsx("p",{className:"text-slate-300 text-lg",children:"Waiting for all players to ready up"}),l.jsxs("div",{className:"mt-8 mb-8",children:[l.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-4",children:[l.jsxs("div",{className:"text-2xl font-semibold text-slate-300",children:[jn(),"/",Dn()," Players Ready"]}),l.jsxs("div",{className:"text-lg text-slate-400",children:["(",Math.round(jn()/Dn()*100),"%)"]})]}),l.jsx("div",{className:"w-full bg-slate-700 rounded-full h-4 max-w-lg mx-auto",children:l.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-400 h-4 rounded-full transition-all duration-500",style:{width:`${jn()/Dn()*100}%`}})})]})]}),l.jsxs("div",{className:"text-center",children:[Y?l.jsx("div",{className:"text-green-400 font-semibold text-xl bg-green-900/30 px-6 py-3 rounded-xl",children:"You are ready!"}):l.jsx("div",{className:"space-y-4",children:h.find(M=>M.userId===(n==null?void 0:n.uid))?l.jsx("button",{onClick:we,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Ready Up"}):l.jsxs("div",{className:"space-y-4",children:[l.jsx("p",{className:"text-slate-300",children:"You need to create a character first"}),l.jsx("button",{onClick:()=>r(`/character-creation/${t}`),className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Create Character"})]})}),Se&&(a==null?void 0:a.dmId)===(n==null?void 0:n.uid)&&l.jsx("div",{className:"mt-6",children:l.jsx("button",{onClick:Le,disabled:p||H,className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:p||H?"Generating Story...":"Start Story Generation"})}),Se&&(a==null?void 0:a.dmId)!==(n==null?void 0:n.uid)&&l.jsx("div",{className:"mt-6",children:l.jsx("div",{className:"text-blue-400 font-semibold text-lg bg-blue-900/30 px-6 py-3 rounded-xl",children:"Waiting for Dungeon Master to start the story..."})})]})]}),(s==null?void 0:s.status)==="generating"&&l.jsx("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-4",children:"Generating Your Adventure"}),l.jsx("p",{className:"text-slate-300 text-lg mb-8",children:"The Dungeon Master is crafting your story. This may take a moment..."}),l.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-8",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-400"}),l.jsx("div",{className:"text-slate-300 font-semibold text-lg",children:"Creating Story Plots..."})]})]})}),(s==null?void 0:s.status)==="generating_story"&&l.jsx("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-4",children:"Crafting Your Story"}),l.jsx("p",{className:"text-slate-300 text-lg mb-8",children:"The Dungeon Master is weaving the tale of your adventure..."}),l.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-8",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-400"}),l.jsx("div",{className:"text-slate-300 font-semibold text-lg",children:"Generating Story Content..."})]}),(s==null?void 0:s.selectedPlotData)&&l.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 max-w-2xl mx-auto",children:[l.jsxs("h3",{className:"text-slate-200 font-semibold mb-2",children:["Selected Plot: ",s.selectedPlotData.title]}),l.jsx("p",{className:"text-slate-300 text-sm",children:s.selectedPlotData.description})]})]})}),(s==null?void 0:s.status)==="voting"&&l.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:[l.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-6 text-center",children:"Choose Your Adventure"}),l.jsx("div",{className:"mb-4 flex justify-center",children:l.jsx("button",{onClick:()=>Ue(!pe),className:"bg-slate-700 hover:bg-slate-600 text-slate-300 px-4 py-2 rounded-lg text-sm transition-colors",children:pe?"Hide Debug":"Show Debug"})}),pe&&l.jsxs("div",{className:"mb-4 p-4 bg-slate-700/50 rounded-lg",children:[l.jsxs("p",{className:"text-slate-300 text-sm",children:["Debug: Available plots count: ",((yr=s==null?void 0:s.availablePlots)==null?void 0:yr.length)||0]}),l.jsxs("p",{className:"text-slate-300 text-sm",children:["Debug: Raw plots: ",JSON.stringify((Hr=s==null?void 0:s.availablePlots)==null?void 0:Hr.slice(0,2))]})]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Array.isArray(s==null?void 0:s.availablePlots)&&s.availablePlots.length>0?s.availablePlots.map((M,U)=>l.jsxs("div",{className:"bg-slate-800/70 border-2 border-slate-600 rounded-xl p-6 hover:border-slate-500 transition-all duration-300",children:[l.jsx("h3",{className:"font-bold text-slate-200 text-xl mb-3",children:M.title}),l.jsx("p",{className:"text-slate-300 mb-4",children:M.description||"Adventure description here..."}),M.campaignLength&&l.jsxs("div",{className:"mb-4",children:[l.jsx("span",{className:"text-slate-400 text-sm",children:"Length: "}),l.jsx("span",{className:"text-slate-200 font-semibold capitalize",children:M.campaignLength})]}),(a==null?void 0:a.dmId)===(n==null?void 0:n.uid)?l.jsx("button",{onClick:()=>Zt(U),disabled:p,className:"w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Selecting...":"Choose This Plot"}):l.jsx("div",{className:"text-center py-3",children:l.jsx("span",{className:"text-slate-400 text-sm",children:"Waiting for DM to choose..."})})]},U)):l.jsxs("div",{className:"col-span-3 text-center",children:[l.jsx("p",{className:"text-slate-300",children:"No plots available. Please try generating the story again."}),(a==null?void 0:a.dmId)===(n==null?void 0:n.uid)&&l.jsx("button",{onClick:Le,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors",children:"Regenerate Plots"})]})}),(a==null?void 0:a.dmId)!==(n==null?void 0:n.uid)&&l.jsx("div",{className:"text-center mt-6",children:l.jsx("p",{className:"text-slate-300 text-lg",children:"Waiting for the Dungeon Master to select a plot..."})})]}),(s==null?void 0:s.status)==="storytelling"&&l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[l.jsx("div",{className:"lg:col-span-1",children:l.jsxs("div",{className:"flex flex-col gap-y-6 lg:sticky lg:top-6",children:[l.jsxs("div",{className:"hidden lg:block bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[l.jsxs("div",{className:"flex justify-between items-center mb-3",children:[l.jsx("h3",{className:"font-bold text-slate-200",children:"Party Members"}),l.jsx("button",{onClick:()=>Ue(!pe),className:"text-xs bg-slate-600 hover:bg-slate-500 px-2 py-1 rounded text-slate-200",children:pe?"Hide Debug":"Show Debug"})]}),pe&&l.jsxs("div",{className:"mb-2 p-2 bg-slate-700/50 rounded text-xs",children:[l.jsxs("p",{className:"text-slate-300",children:["Debug: Characters loaded: ",h.length]}),l.jsxs("p",{className:"text-slate-300",children:["Debug: Party members: ",c.length]}),l.jsxs("p",{className:"text-slate-300",children:["Debug: Characters: ",JSON.stringify(h.map(M=>({name:M.name,userId:M.userId})))]}),l.jsxs("p",{className:"text-slate-300",children:["Debug: Current Speaker: ",JSON.stringify(s==null?void 0:s.currentSpeaker)]}),l.jsxs("p",{className:"text-slate-300",children:["Debug: User UID: ",n==null?void 0:n.uid]}),l.jsxs("p",{className:"text-slate-300",children:["Debug: Party DM ID: ",a==null?void 0:a.dmId]}),l.jsxs("p",{className:"text-slate-300",children:["Debug: Is DM speaking: ",((j=s==null?void 0:s.currentSpeaker)==null?void 0:j.id)==="dm"?"Yes":"No"]}),l.jsxs("p",{className:"text-slate-300",children:["Debug: Is user DM: ",(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)?"Yes":"No"]})]}),l.jsx("div",{className:"space-y-2",children:Xt().map(M=>{var ce,ye,me,xe,je;const U=((ce=s==null?void 0:s.currentSpeaker)==null?void 0:ce.userId)===M.userId;n==null||n.uid,M.userId;const ve=oe==="active"&&((me=(ye=X==null?void 0:X.combatants)==null?void 0:ye[X.currentTurn])==null?void 0:me.userId)===M.userId,le=oe!=="active"&&(((xe=s==null?void 0:s.currentSpeaker)==null?void 0:xe.userId)===(n==null?void 0:n.uid)||((je=s==null?void 0:s.currentSpeaker)==null?void 0:je.id)==="dm"&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)||!(s!=null&&s.currentSpeaker)&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId))&&!U;return l.jsxs("div",{className:`p-2 rounded transition-colors ${U?"bg-blue-600/30 border border-blue-500":le?"bg-slate-700/50 hover:bg-slate-600/50 cursor-pointer":"bg-slate-700/30 opacity-60 cursor-not-allowed"}`,onClick:le?()=>dt(M):void 0,children:[l.jsx("div",{className:"font-semibold text-slate-200 text-xs",children:M.name}),l.jsxs("div",{className:"text-slate-400 text-xs",children:[M.race," ",M.class]}),oe==="active"?ve?l.jsx("div",{className:"text-yellow-400 text-xs mt-1",children:" Current Turn"}):l.jsx("div",{className:"text-red-400 text-xs mt-1",children:" Combat Active"}):U&&l.jsx("div",{className:"text-blue-400 text-xs mt-1",children:"Currently Speaking"}),!le&&!U&&oe!=="active"&&l.jsx("div",{className:"text-slate-500 text-xs mt-1",children:"Waiting for turn..."}),le&&!U&&l.jsx("div",{className:"text-green-400 text-xs mt-1",children:"Click to select"})]},M.id)})})]}),(s==null?void 0:s.campaignMetadata)&&oe!=="active"&&l.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[l.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Campaign Progress"}),l.jsxs("div",{className:"space-y-2 text-sm",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-slate-300",children:"Session:"}),l.jsx("span",{className:"text-slate-200 font-semibold",children:s.campaignMetadata.sessionNumber})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-slate-300",children:"Progress:"}),l.jsxs("span",{className:"text-slate-200 font-semibold",children:[s.campaignMetadata.campaignProgress,"%"]})]})]})]}),R.length>0&&oe!=="active"&&l.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[l.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Objectives"}),l.jsx("div",{className:"space-y-2",children:R.map((M,U)=>l.jsxs("div",{className:"text-sm",children:[l.jsx("div",{className:"text-slate-300",children:M.title}),l.jsx("div",{className:"text-slate-400 text-xs",children:M.description})]},U))})]})]})}),l.jsxs("div",{className:"lg:col-span-3",children:[(s==null?void 0:s.currentContent)&&l.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 mb-8 shadow-lg",children:[l.jsx("div",{className:"mb-6",children:l.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2 border-b border-slate-600 pb-3",children:" Current Story"})}),l.jsx("div",{className:"text-slate-200 leading-8 text-lg max-w-none prose prose-invert prose-lg prose-slate",style:{lineHeight:"1.8",fontSize:"1.125rem",letterSpacing:"0.025em"},dangerouslySetInnerHTML:{__html:V(s.currentContent)}}),(s==null?void 0:s.storyMetadata)&&l.jsxs("div",{className:"mt-6 p-4 bg-slate-700/30 rounded-lg border border-slate-600",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.storyMetadata.currentLocation&&l.jsxs("div",{children:[l.jsx("span",{className:"text-blue-400 font-semibold",children:" Location:"}),l.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.currentLocation})]}),s.storyMetadata.storyTone&&l.jsxs("div",{children:[l.jsx("span",{className:"text-purple-400 font-semibold",children:" Tone:"}),l.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.storyTone})]}),s.storyMetadata.activeNPCs&&s.storyMetadata.activeNPCs.length>0&&l.jsxs("div",{children:[l.jsx("span",{className:"text-green-400 font-semibold",children:" Active NPCs:"}),l.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.activeNPCs.join(", ")})]}),s.storyMetadata.phaseStatus&&l.jsxs("div",{children:[l.jsx("span",{className:"text-orange-400 font-semibold",children:" Phase:"}),l.jsx("span",{className:"text-slate-300 ml-2 capitalize",children:s.storyMetadata.phaseStatus})]})]}),s.storyMetadata.nextActions&&s.storyMetadata.nextActions.length>0&&l.jsxs("div",{className:"mt-4",children:[l.jsx("span",{className:"text-yellow-400 font-semibold",children:" Possible Actions:"}),l.jsx("ul",{className:"mt-2 space-y-1",children:s.storyMetadata.nextActions.map((M,U)=>l.jsxs("li",{className:"text-slate-300 text-sm",children:[" ",M]},U))})]})]})]}),Ot&&l.jsx("div",{className:"bg-gradient-to-br from-blue-800/50 to-blue-700/50 border border-blue-600 rounded-lg p-6 mb-6",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-blue-200 text-lg font-semibold mb-2",children:" Combat is Loading..."}),l.jsx("div",{className:"text-blue-300 text-sm",children:"Preparing combat encounter..."}),!Se&&l.jsxs("div",{className:"mt-6",children:[l.jsx("div",{className:"text-blue-200 text-lg font-semibold mb-3",children:"Ready Up for Combat"}),l.jsxs("div",{className:"mb-4 p-3 bg-blue-900/30 rounded-lg text-xs",children:[l.jsx("div",{className:"text-blue-300 mb-2",children:"Debug Info:"}),l.jsxs("div",{className:"text-blue-400 space-y-1",children:[l.jsxs("div",{children:["Party Members: ",c.length]}),l.jsxs("div",{children:["Characters Loaded: ",h.length]}),l.jsxs("div",{children:["Ready Players: ",((J=s==null?void 0:s.readyPlayers)==null?void 0:J.length)||0]}),l.jsxs("div",{children:["Current User Has Character: ",h.find(M=>M.userId===(n==null?void 0:n.uid))?"Yes":"No"]}),l.jsxs("div",{children:["Current User Ready: ",Y?"Yes":"No"]})]})]}),l.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-4",children:[l.jsxs("div",{className:"text-2xl font-semibold text-blue-300",children:[jn(),"/",Dn()," Players Ready"]}),l.jsxs("div",{className:"text-lg text-blue-400",children:["(",Math.round(jn()/Dn()*100),"%)"]})]}),l.jsx("div",{className:"w-full bg-blue-700 rounded-full h-4 max-w-lg mx-auto mb-4",children:l.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-400 h-4 rounded-full transition-all duration-500",style:{width:`${jn()/Dn()*100}%`}})}),l.jsx("div",{className:"text-center",children:h.find(M=>M.userId===(n==null?void 0:n.uid))?Y?l.jsx("div",{className:"text-green-400 font-semibold text-xl bg-green-900/30 px-6 py-3 rounded-xl",children:"You are ready for combat!"}):l.jsx("button",{onClick:we,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-8 py-3 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Ready Up for Combat"}):l.jsxs("div",{className:"space-y-4",children:[l.jsx("p",{className:"text-blue-300",children:"You need to create a character first"}),l.jsx("button",{onClick:()=>r(`/character-creation/${t}`),className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-8 py-3 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Create Character"})]})})]}),l.jsx("div",{className:"mt-3 text-blue-400 text-xs",children:Se?"All players ready! Starting combat...":"Waiting for all players to be ready..."})]})}),oe==="active"&&X&&l.jsxs("div",{className:"bg-gradient-to-br from-red-800/50 to-red-700/50 border border-red-600 rounded-lg p-6 mb-6",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("h3",{className:"text-xl font-bold text-red-100 mb-2 border-b border-red-600 pb-2",children:" Combat Encounter"}),l.jsxs("div",{className:"text-red-200 text-sm",children:["Round: ",X.round," | Turn: ",X.currentTurn+1]}),l.jsxs("div",{className:"mt-3 p-3 bg-slate-800/30 rounded-lg",children:[l.jsx("h5",{className:"text-slate-300 font-medium mb-2",children:"Turn Order (Initiative):"}),l.jsx("div",{className:"flex flex-wrap gap-1",children:X.combatants.map((M,U)=>l.jsxs("div",{className:`px-2 py-1 rounded text-xs font-medium ${U===X.currentTurn?"bg-yellow-600 text-yellow-100 border border-yellow-500":"bg-slate-700 text-slate-300"}`,children:[U+1,". ",M.name," (",M.initiative,")"]},M.id))})]})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[l.jsxs("div",{children:[l.jsx("h4",{className:"text-green-400 font-semibold mb-2",children:"Party Members"}),l.jsx("div",{className:"space-y-2",children:(be=X.combatants)==null?void 0:be.filter(M=>!M.id.startsWith("enemy_")).map(M=>l.jsxs("div",{className:`p-2 rounded ${M.id===(z==null?void 0:z.id)?"bg-green-600/30 border border-green-500":"bg-slate-700/30"}`,children:[l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"text-slate-200 font-medium",children:M.name}),l.jsxs("span",{className:"text-slate-300 text-sm",children:["HP: ",M.hp||0,"/",M.maxHp||0]})]}),M.id===(z==null?void 0:z.id)&&l.jsx("div",{className:"text-green-400 text-xs mt-1",children:"Current Turn"})]},M.id))})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-red-400 font-semibold mb-2",children:"Enemies"}),l.jsx("div",{className:"space-y-2",children:(ke=X.combatants)==null?void 0:ke.filter(M=>M.id.startsWith("enemy_")).map(M=>l.jsxs("div",{className:`p-2 rounded ${M.id===(z==null?void 0:z.id)?"bg-red-600/30 border border-red-500":"bg-slate-700/30"}`,children:[l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"text-slate-200 font-medium",children:M.name}),l.jsxs("span",{className:"text-slate-300 text-sm",children:["HP: ",M.hp||0,"/",M.maxHp||0]})]}),M.id===(z==null?void 0:z.id)&&l.jsx("div",{className:"text-red-400 text-xs mt-1",children:"Current Turn"})]},M.id))})]})]}),z&&!z.id.startsWith("enemy_")&&(z.userId===(n==null?void 0:n.uid)||!z.userId)&&l.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[l.jsxs("h4",{className:"text-blue-400 font-semibold mb-3",children:["Actions for ",z.name]}),xt&&l.jsx("div",{className:"mb-3 p-2 bg-blue-600/30 border border-blue-500 rounded text-blue-200 text-sm",children:" Processing combat action..."}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:Object.entries(St.actionTypes).map(([M,U])=>l.jsx("button",{onClick:()=>setSelectedAction(M),disabled:xt,className:`p-2 rounded text-sm transition-colors ${selectedAction===M?"bg-blue-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-200"} disabled:opacity-50 disabled:cursor-not-allowed`,children:U.name},M))}),selectedAction&&l.jsxs("div",{className:"mt-4",children:[l.jsx("h5",{className:"text-slate-300 font-medium mb-2",children:"Select Target:"}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:(G=X.combatants)==null?void 0:G.filter(M=>M.id!==z.id).map(M=>l.jsx("button",{onClick:()=>Nr(selectedAction,M.id),disabled:xt,className:"p-2 rounded bg-slate-700 hover:bg-slate-600 text-slate-200 text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:xt?"Processing...":M.name},M.id))})]})]}),oe==="active"&&z&&!z.id.startsWith("enemy_")&&z.userId!==(n==null?void 0:n.uid)&&z.userId&&l.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[l.jsxs("h4",{className:"text-orange-400 font-semibold mb-3",children:[" Fallback Actions for ",z.name]}),l.jsx("p",{className:"text-slate-300 text-sm mb-3",children:"User ID mismatch detected. Showing actions anyway."}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:Object.entries(St.actionTypes).map(([M,U])=>l.jsx("button",{onClick:()=>setSelectedAction(M),disabled:xt,className:`p-2 rounded text-sm transition-colors ${selectedAction===M?"bg-orange-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-200"} disabled:opacity-50 disabled:cursor-not-allowed`,children:U.name},M))}),selectedAction&&l.jsxs("div",{className:"mt-4",children:[l.jsx("h5",{className:"text-slate-300 font-medium mb-2",children:"Select Target:"}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:(Ce=X.combatants)==null?void 0:Ce.filter(M=>M.id!==z.id).map(M=>l.jsx("button",{onClick:()=>Nr(selectedAction,M.id),disabled:xt,className:"p-2 rounded bg-slate-700 hover:bg-slate-600 text-slate-200 text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:xt?"Processing...":M.name},M.id))})]})]}),oe==="active"&&l.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 mt-4",children:[l.jsx("h4",{className:"text-yellow-400 font-semibold mb-3",children:" Combat Debug Info"}),l.jsxs("div",{className:"text-xs text-slate-300 space-y-1",children:[l.jsxs("div",{children:["Combat State: ",oe]}),l.jsxs("div",{children:["Current Combatant: ",(z==null?void 0:z.name)||"None"," (ID: ",(z==null?void 0:z.id)||"None",")"]}),l.jsxs("div",{children:["Current User: ",(n==null?void 0:n.uid)||"None"]}),l.jsxs("div",{children:["Combatant User ID: ",(z==null?void 0:z.userId)||"None"]}),l.jsxs("div",{children:["Is Enemy: ",(Ee=z==null?void 0:z.id)!=null&&Ee.startsWith("enemy_")?"Yes":"No"]}),l.jsxs("div",{children:["User Match: ",(z==null?void 0:z.userId)===(n==null?void 0:n.uid)?"Yes":"No"]}),l.jsxs("div",{children:["Should Show Actions: ",z&&!z.id.startsWith("enemy_")&&z.userId===(n==null?void 0:n.uid)?"Yes":"No"]}),l.jsxs("div",{children:["Combat Session: ",X?"Active":"None"]}),l.jsxs("div",{children:["Current Turn: ",(X==null?void 0:X.currentTurn)||"None"]}),l.jsxs("div",{children:["Total Combatants: ",((qe=X==null?void 0:X.combatants)==null?void 0:qe.length)||0]})]}),z&&!z.id.startsWith("enemy_")&&l.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-700",children:[l.jsx("h5",{className:"text-yellow-400 font-medium mb-2",children:"Manual Action Trigger"}),l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsx("button",{onClick:()=>{const M=X.combatants.filter(U=>U.id.startsWith("enemy_"));M.length>0&&Nr("attack",M[0].id)},disabled:xt,className:"p-2 rounded bg-red-700 hover:bg-red-600 text-white text-xs transition-colors disabled:opacity-50",children:"Attack First Enemy"}),l.jsx("button",{onClick:()=>{const M=X.combatants.filter(U=>!U.id.startsWith("enemy_")&&U.id!==z.id);M.length>0&&Nr("defend",M[0].id)},disabled:xt,className:"p-2 rounded bg-blue-700 hover:bg-blue-600 text-white text-xs transition-colors disabled:opacity-50",children:"Defend Ally"})]})]})]}),z&&!z.id.startsWith("enemy_")&&z.userId!==(n==null?void 0:n.uid)&&l.jsxs("div",{className:"bg-blue-800/30 rounded-lg p-4 text-center",children:[l.jsxs("div",{className:"text-blue-300 font-medium",children:["Player Turn: ",z.name]}),l.jsxs("div",{className:"text-blue-400 text-sm mt-1",children:["Waiting for ",z.name," to take their action..."]})]}),z&&z.id.startsWith("enemy_")&&l.jsxs("div",{className:"bg-red-800/30 rounded-lg p-4 text-center",children:[l.jsxs("div",{className:"text-red-300 font-medium",children:["Enemy Turn: ",z.name]}),l.jsx("div",{className:"text-red-400 text-sm mt-1",children:"Processing enemy action..."})]}),Ve.length>0&&l.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 mt-4",children:[l.jsx("h4",{className:"text-yellow-400 font-semibold mb-3",children:" Battle Log"}),l.jsx("div",{className:"max-h-40 overflow-y-auto space-y-2",children:Ve.slice(-10).map(M=>l.jsx("div",{className:`text-sm p-2 rounded ${M.type==="damage"?"bg-red-800/30 border-l-4 border-red-500":M.type==="healing"?"bg-green-800/30 border-l-4 border-green-500":M.type==="combat_start"?"bg-blue-800/30 border-l-4 border-blue-500":M.type==="enemy_death"?"bg-purple-800/30 border-l-4 border-purple-500":M.type==="combat_end"?"bg-yellow-800/30 border-l-4 border-yellow-500":"bg-slate-800/30 border-l-4 border-slate-500"}`,children:l.jsxs("div",{className:"flex justify-between items-start",children:[l.jsx("span",{className:"text-slate-200",children:M.message}),l.jsx("span",{className:"text-slate-400 text-xs ml-2",children:M.timestamp})]})},M.id))})]})]}),s!=null&&s.currentSpeaker&&oe!=="active"?l.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mb-6",children:[l.jsxs("h3",{className:"font-bold text-slate-200 mb-4",children:["Current Speaker: ",s.currentSpeaker.name]}),((Mn=s==null?void 0:s.currentSpeaker)==null?void 0:Mn.userId)===(n==null?void 0:n.uid)||((_t=s==null?void 0:s.currentSpeaker)==null?void 0:_t.id)==="dm"&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)?l.jsxs("div",{className:"space-y-4",children:[l.jsx("textarea",{value:I,onChange:M=>_(M.target.value),placeholder:((Ct=s==null?void 0:s.currentSpeaker)==null?void 0:Ct.id)==="dm"?"Continue the story or describe what happens next...":`What does ${s.currentSpeaker.name} do?`,className:"w-full bg-slate-800/50 border border-slate-600 text-slate-100 px-4 py-3 rounded-lg focus:border-slate-500 focus:outline-none transition-colors min-h-[120px] resize-none",rows:4}),l.jsx("div",{className:"flex space-x-3",children:l.jsx("button",{onClick:ln,disabled:!I.trim()||p,className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Processing...":((xa=s==null?void 0:s.currentSpeaker)==null?void 0:xa.id)==="dm"?"Continue Story":"Send Response"})})]}):l.jsxs("p",{className:"text-slate-300",children:["Waiting for ",s.currentSpeaker.name," to respond..."]})]}):oe!=="active"&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)&&l.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mb-6",children:[l.jsx("h3",{className:"font-bold text-slate-200 mb-4",children:"Dungeon Master Response"}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("textarea",{value:I,onChange:M=>_(M.target.value),placeholder:"Continue the story or describe what happens next...",className:"w-full bg-slate-800/50 border border-slate-600 text-slate-100 px-4 py-3 rounded-lg focus:border-slate-500 focus:outline-none transition-colors min-h-[120px] resize-none",rows:4}),l.jsx("div",{className:"flex space-x-3",children:l.jsx("button",{onClick:ln,disabled:!I.trim()||p,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Processing...":"Continue Story"})})]})]}),l.jsxs("div",{className:"lg:hidden bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4 mb-6",children:[l.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Party Members"}),l.jsx("div",{className:"grid grid-cols-2 gap-2",children:Xt().map(M=>{var ce,ye,me,xe,je;const U=((ce=s==null?void 0:s.currentSpeaker)==null?void 0:ce.userId)===M.userId;n==null||n.uid,M.userId;const ve=oe==="active"&&((me=(ye=X==null?void 0:X.combatants)==null?void 0:ye[X.currentTurn])==null?void 0:me.userId)===M.userId,le=oe!=="active"&&(((xe=s==null?void 0:s.currentSpeaker)==null?void 0:xe.userId)===(n==null?void 0:n.uid)||((je=s==null?void 0:s.currentSpeaker)==null?void 0:je.id)==="dm"&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)||!(s!=null&&s.currentSpeaker)&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId))&&!U;return l.jsxs("div",{className:`p-2 rounded transition-colors ${U?"bg-blue-600/30 border border-blue-500":le?"bg-slate-700/50 hover:bg-slate-600/50 cursor-pointer":"bg-slate-700/30 opacity-60 cursor-not-allowed"}`,onClick:le?()=>dt(M):void 0,children:[l.jsx("div",{className:"font-semibold text-slate-200 text-xs",children:M.name}),l.jsxs("div",{className:"text-slate-400 text-xs",children:[M.race," ",M.class]}),oe==="active"?ve?l.jsx("div",{className:"text-yellow-400 text-xs mt-1",children:" Current Turn"}):l.jsx("div",{className:"text-red-400 text-xs mt-1",children:" Combat Active"}):U&&l.jsx("div",{className:"text-blue-400 text-xs mt-1",children:"Currently Speaking"}),!le&&!U&&oe!=="active"&&l.jsx("div",{className:"text-slate-500 text-xs mt-1",children:"Waiting for turn..."}),le&&!U&&l.jsx("div",{className:"text-green-400 text-xs mt-1",children:"Click to select"})]},M.id)})})]}),(s==null?void 0:s.storyMessages)&&s.storyMessages.length>0&&oe!=="active"&&l.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mt-8 shadow-lg",children:[l.jsx("div",{className:"mb-6",children:l.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-2 border-b border-slate-600 pb-3",children:" Story History"})}),l.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:s.storyMessages.map((M,U)=>l.jsxs("div",{className:"border-l-4 border-slate-500 pl-4 py-2 bg-slate-800/30 rounded-r-lg",children:[l.jsxs("div",{className:"text-slate-300 text-sm font-semibold mb-2 flex items-center",children:[l.jsx("span",{className:"mr-2",children:""}),M.speaker||"Narrator"]}),l.jsx("div",{className:"text-slate-400 text-sm leading-6 pl-6 border-l border-slate-600",dangerouslySetInnerHTML:{__html:V(M.content)}})]},U))})]}),E&&l.jsx("div",{className:"bg-gradient-to-r from-red-900/50 to-red-800/50 border border-red-600 rounded-lg p-4 mb-6",children:l.jsxs("div",{className:"flex items-start space-x-3",children:[l.jsx("div",{className:"text-red-400 text-xl",children:""}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"font-semibold text-red-200 mb-2",children:"Notice"}),l.jsx("p",{className:"text-red-100 text-sm mb-3",children:E}),E.includes("AI service")&&l.jsxs("div",{className:"bg-red-800/30 border border-red-600 rounded p-3",children:[l.jsxs("p",{className:"text-red-200 text-xs mb-2",children:[l.jsx("strong",{children:"What this means:"})," The AI storytelling service is temporarily unavailable."]}),l.jsx("p",{className:"text-red-200 text-xs mb-2",children:l.jsx("strong",{children:"You can still:"})}),l.jsxs("ul",{className:"text-red-200 text-xs list-disc list-inside space-y-1",children:[l.jsx("li",{children:"Continue the story manually by typing your responses"}),l.jsx("li",{children:"Use the predefined plot options if available"}),l.jsx("li",{children:"Wait a few minutes and try again"})]})]})]}),l.jsx("button",{onClick:()=>v(""),className:"text-red-400 hover:text-red-200 transition-colors",children:""})]})}),pe&&l.jsxs("div",{className:"bg-gradient-to-br from-slate-900/50 to-slate-800/50 border border-slate-600 rounded-lg p-6 mb-6",children:[l.jsx("h3",{className:"font-bold text-slate-200 mb-4",children:" Debug Information"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[l.jsxs("div",{children:[l.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:"Story State"}),l.jsxs("div",{className:"space-y-1 text-slate-400",children:[l.jsxs("div",{children:["Story ID: ",(s==null?void 0:s.id)||"None"]}),l.jsxs("div",{children:["Status: ",(s==null?void 0:s.status)||"None"]}),l.jsxs("div",{children:["Phase: ",((Ci=s==null?void 0:s.storyMetadata)==null?void 0:Ci.phaseStatus)||"None"]}),l.jsxs("div",{children:["Ready Players: ",((vr=s==null?void 0:s.readyPlayers)==null?void 0:vr.length)||0,"/",c.length]}),l.jsxs("div",{children:["Current Speaker: ",((_a=s==null?void 0:s.currentSpeaker)==null?void 0:_a.name)||"None"]})]})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:"User State"}),l.jsxs("div",{className:"space-y-1 text-slate-400",children:[l.jsxs("div",{children:["User ID: ",(n==null?void 0:n.uid)||"None"]}),l.jsxs("div",{children:["Is DM: ",(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)?"Yes":"No"]}),l.jsxs("div",{children:["Is Ready: ",Y?"Yes":"No"]}),l.jsxs("div",{children:["All Ready: ",Se?"Yes":"No"]}),l.jsxs("div",{children:["Combat State: ",oe]}),l.jsxs("div",{children:["Combat Loading: ",Ot?"Yes":"No"]}),l.jsxs("div",{children:["Has Navigated: ",at?"Yes":"No"]})]})]})]}),(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)&&l.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-600",children:[l.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:" Manual Combat Controls"}),l.jsxs("div",{className:"flex space-x-2",children:[l.jsx("button",{onClick:async()=>{console.log(" DM manually triggering combat..."),Rn(!0),tt(!0);try{const M=await St.createCombatSession(t,h.length>0?h:c,[],(s==null?void 0:s.currentContent)||"Manual combat encounter");tt(!1),Rn(!0),r(`/combat/${M.id}`)}catch(M){console.error(" Failed to create manual combat session:",M),tt(!1),Rn(!1)}},disabled:Ot||at,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:Ot?"Loading...":"Trigger Combat"}),l.jsx("button",{onClick:()=>{Rn(!1),tt(!1),console.log(" Reset combat navigation state")},className:"bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors",children:"Reset State"})]})]})]})]})]}),b&&l.jsx(bS,{validation:P,onClose:Un,onProceed:Ss,onRevise:Bn}),N&&l.jsx(ES,{diceResult:Be,onClose:en})]})}):l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-slate-300",children:"Story not found"}),l.jsx("button",{onClick:()=>r("/dashboard"),className:"mt-4 bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg transition-colors",children:"Back to Dashboard"})]})})}function BV(){var pr,gr,yn,Nr,yr,Hr;const{sessionId:n}=hg(),e=fr(),t=_i(),[r,s]=k.useState(null),[i,a]=k.useState(null),[o,c]=k.useState(!0),[d,h]=k.useState([]),[m,p]=k.useState(null),[y,E]=k.useState(null),[v,I]=k.useState(""),[_,x]=k.useState(""),[C,R]=k.useState([]),[F,q]=k.useState([]),[T,b]=k.useState([]),[A,P]=k.useState(!1),[D,N]=k.useState(""),[S,Be]=k.useState(""),[Fe,$e]=k.useState(!1),[Pe,Y]=k.useState(!1),[ae,Se]=k.useState(null),[ee,H]=k.useState(-1),[ne,pe]=k.useState(null),[Ue,oe]=k.useState(!1),[ge,X]=k.useState(!1),[Me,_e]=k.useState(new Set),[Ye,z]=k.useState([]),[It,xt]=k.useState(!1),it=k.useRef(null),Ve=(pr=t.state)==null?void 0:pr.isTestCombat,Dt=t.state;k.useEffect(()=>{const j=Yo(J=>{if(!J){e("/login");return}s(J)});return()=>j()},[e]),k.useEffect(()=>{Ve&&Dt?at():n&&Rn()},[Ve,Dt,n]),k.useEffect(()=>{if(n&&!Ve){it.current&&(console.log(" Cleaning up existing subscription"),it.current(),it.current=null),console.log(" Setting up combat session subscription for:",n);const j=Cy(n,J=>{var be;console.log(" Combat session update received:",{currentTurn:J==null?void 0:J.currentTurn,lastProcessedTurn:ee,combatState:J==null?void 0:J.combatState,combatants:(be=J==null?void 0:J.combatants)==null?void 0:be.map(ke=>({name:ke.name,hp:ke.hp,isEnemy:ke.id.startsWith("enemy_")}))}),a(J),c(!1),J&&(J.battleLog&&J.battleLog.length>0&&z(J.battleLog),Ot(J),q(J.environmentalFeatures||[]),b(J.teamUpOpportunities||[]),Le())});return it.current=j,()=>{console.log(" Component unmounting, cleaning up subscription"),it.current&&(it.current(),it.current=null)}}},[n,Ve]),k.useEffect(()=>{if(i&&i.combatState==="active"){const j=W();if(j&&j.id.startsWith("enemy_")&&i.currentTurn!==ee&&!Fe&&!A){const J=setTimeout(()=>{Dn()},Ve?2e3:1e3);return()=>clearTimeout(J)}}},[i==null?void 0:i.currentTurn,ee,Fe,A,Ve]),k.useEffect(()=>{i&&ge&&Un()&&setTimeout(()=>{X(!1),_e(new Set),Xt()},1e3)},[ge,Me.size,(gr=i==null?void 0:i.partyMembers)==null?void 0:gr.length]),k.useEffect(()=>{i&&Ot(i)},[i==null?void 0:i.currentTurn,i==null?void 0:i.combatState]),k.useEffect(()=>{if(i&&i.combatState==="active"&&i.combatants){const j=i.combatants.filter(G=>!G.id.startsWith("enemy_")),J=i.combatants.filter(G=>G.id.startsWith("enemy_")),be=j.some(G=>G.hp>0),ke=J.some(G=>G.hp>0);be?ke||(Ve?e("/test-environment",{state:{...Dt,combatResult:"victory"}}):V("victory")):Ve?e("/test-environment",{state:{...Dt,combatResult:"defeat"}}):V("defeat")}},[i==null?void 0:i.combatants,i==null?void 0:i.combatState]);const at=async()=>{try{c(!0);const J={id:"test_combat_session",partyMembers:Dt.partyMembers.map(G=>{if(!G.hp||!G.maxHp||!G.ac){const{class:Ce,level:Ee,constitution:qe,dexterity:Mn}=G,Ct={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[Ce]||8,xa=Math.floor((qe-10)/2),Ci=Math.max(1,(Ct+xa)*Ee),vr=10,_a=Math.floor((Mn-10)/2),U={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[Ce]||0,ve=Math.max(10,vr+_a+U);return{...G,hp:Ci,maxHp:Ci,ac:ve}}return G})||[],enemies:Dt.enemies||[],storyContext:Dt.storyContext||"Test combat environment",combatState:"initialized",currentTurn:0,combatants:[],round:1};if(!J.enemies||J.enemies.length===0){a({...J,status:"no_enemies",combatState:"ended"}),c(!1);return}const be=Qr.initializeCombat(J.partyMembers,J.enemies,J.storyContext),ke={...J,...be,currentTurn:0,combatState:"active"};a(ke),c(!1),Ot(ke),q(ke.environmentalFeatures||[]),b(ke.teamUpOpportunities||[])}catch(j){console.error("Error initializing test combat:",j),c(!1)}},Rn=async()=>{if(n)try{c(!0);const j=await fS(n);if(!j){console.error("No combat session found with ID:",n),e("/dashboard");return}const J=j.partyId,be=await ko(J);try{await wS(J);const G=await ko(J);h(G)}catch(G){console.warn("Failed to update character stats:",G),h(be)}if(j.enemies&&j.enemies.length===0&&!Ve){a({...j,status:"no_enemies"});return}let ke=j.combatants||[];if(ke.length===0){const G=(j.partyMembers||[]).map(Ee=>({...Ee,isEnemy:!1,userId:Ee.userId,cooldowns:Ee.cooldowns||{},statusEffects:Ee.statusEffects||[],hp:Ee.hp??Ee.maxHp??10,maxHp:Ee.maxHp??Ee.hp??10})),Ce=(j.enemies||[]).map(Ee=>({...Ee,isEnemy:!0,userId:null,cooldowns:Ee.cooldowns||{},statusEffects:Ee.statusEffects||[],hp:Ee.hp??Ee.maxHp??10,maxHp:Ee.maxHp??Ee.hp??10}));ke=[...G,...Ce]}if(j.combatState==="initialized"){const G={...j,combatants:ke,combatState:"active",currentTurn:0,round:1};await Xr(n,G),a(G),Ot(G),q(G.environmentalFeatures||[]),b(G.teamUpOpportunities||[])}else{const G={...j,combatants:ke};a(G),Ot(G),q(G.environmentalFeatures||[]),b(G.teamUpOpportunities||[])}}catch(j){console.error("Error loading combat data:",j)}finally{c(!1)}},Ot=j=>{var Ce;const J=W(j);if(!J)return;const be=[],ke=J.cooldowns||{};Object.entries(Qr.actionTypes).forEach(([Ee,qe])=>{(ke[Ee]===0||ke[Ee]===void 0)&&be.push({type:Ee,name:qe.name,description:qe.description,priority:qe.priority,narrativeTemplate:qe.narrativeTemplate})});const G=Qr.classAbilities[(Ce=J.class)==null?void 0:Ce.toLowerCase()];G&&(ke.special===0||ke.special===void 0)&&be.push({type:"special",name:G.name,description:G.description,priority:"high",narrativeTemplate:"{character} uses their {ability}!"}),F.length>0&&be.push({type:"environmental",name:"Use Environment",description:"Use the environment to your advantage",priority:"normal",narrativeTemplate:"{character} uses the {environment} to their advantage!"}),T.length>0&&be.push({type:"teamUp",name:"Team Up",description:"Coordinate with another party member",priority:"high",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}),R(be)},tt=async j=>{const J=new Date().toLocaleTimeString(),be={id:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:J,round:(i==null?void 0:i.round)||1,turn:(i==null?void 0:i.currentTurn)||0,...j};if(z(ke=>[...ke,be]),!Ve&&n)try{await xS(n,be)}catch(ke){console.error("Failed to save battle log to database:",ke)}},Is=async()=>{if(i)try{$e(!0),z([]);const j={...i,combatState:"ready",currentTurn:0,round:1};Ve?(a(j),Ot(j)):await Xr(n,j),await tt({type:"combat_start",description:"Combat is ready to begin!"})}catch(j){console.error("Error starting combat:",j)}finally{$e(!1)}},St=async()=>{if(i)try{$e(!0);const j={...i,combatState:"active"};Ve?(a(j),Ot(j)):await Xr(n,j),await tt({type:"combat_begin",description:"Fight!"}),xt(!0)}catch(j){console.error("Error beginning combat:",j)}finally{$e(!1)}},jn=async(j,J,be={})=>{var ke;if(console.log(" executeAction called:",{actionType:j,targetId:J,isCurrentUserTurn:we(),currentTurn:i==null?void 0:i.currentTurn,currentCombatant:(ke=W())==null?void 0:ke.name}),!(!i||!we()))try{$e(!0);const G=W(),Ce=i.combatants.find(_t=>_t.id===J),Ee=await Qr.executeAction(i,G.id,j,J,be),qe={...i,currentTurn:Ee.updatedSession.currentTurn,round:Ee.updatedSession.round,combatants:Ee.updatedSession.combatants};if(console.log(" Action executed, updating session:",{oldTurn:i.currentTurn,newTurn:Ee.updatedSession.currentTurn,isTestCombat:Ve,sessionId:n}),Ve)a(qe);else{const _t={currentTurn:Ee.updatedSession.currentTurn,round:Ee.updatedSession.round,combatants:Ee.updatedSession.combatants};console.log(" Sending database update:",_t),await Xr(n,_t),console.log(" Database update completed")}await tt({type:Ee.success?"action":"action_failed",description:Ee.narrative}),Ee.damage>0&&Ce&&await tt({type:"damage",description:`${Ce.name} takes ${Ee.damage} damage!`}),Ee.healing>0&&Ce&&await tt({type:"healing",description:`${Ce.name} is healed for ${Ee.healing} HP!`}),I(Ee.narrative),Ee.description&&x(Ee.description);const Mn=Qr.checkCombatEnd(qe);if(Mn.ended){Ve?e("/test-environment",{state:{...Dt,combatResult:Mn.result}}):await V(Mn.result);return}G.id.startsWith("enemy_")&&(X(!0),N(Ee.narrative),Be(Ee.description)),Ee.damage>0&&Ce&&(pe({targetId:Ce.id,damage:Ee.damage,type:"damage"}),oe(!0),setTimeout(()=>oe(!1),2e3)),Ee.healing>0&&Ce&&(pe({targetId:Ce.id,healing:Ee.healing,type:"healing"}),oe(!0),setTimeout(()=>oe(!1),2e3)),p(null),E(null)}catch(G){console.error("Error executing action:",G),tt({type:"error",description:"An error occurred while executing the action."})}finally{$e(!1)}},Dn=async()=>{if(console.log(" processEnemyTurn called"),!i||i.combatState!=="active"){console.log(" Combat not active, returning");return}const j=W();if(console.log(" Current combatant:",j),!j||!j.id.startsWith("enemy_")){console.log(" Not enemy turn, returning");return}H(i.currentTurn),console.log(" Processing enemy turn for:",j.name);try{$e(!0),P(!0),tt({type:"turn_start",actor:j.name,description:`${j.name}'s turn begins`}),console.log(" Choosing enemy action for:",j.name);const J=Qr.chooseEnemyAction(j,i);if(console.log(" Selected action:",J),!J){console.log(" No action selected, advancing turn"),setTimeout(()=>{Xt()},1e3);return}const be=J.action,ke=J.target;if(!be){setTimeout(()=>{Xt()},1e3);return}const G=i.combatants.find(Ee=>Ee.id===ke);if(!G&&be!=="defend"){setTimeout(()=>{Xt()},1e3);return}tt({type:"action",actor:j.name,action:be,target:(G==null?void 0:G.name)||"self",description:`${j.name} uses ${be}${G?` on ${G.name}`:""}`}),console.log(" Executing enemy action:",{combatant:j.name,action:be,target:ke,additionalData:J});const Ce=await Qr.executeAction(i,j.id,be,ke,J);if(console.log(" Action result:",Ce),Ce.success){const Ee={...i,currentTurn:Ce.updatedSession.currentTurn,round:Ce.updatedSession.round,combatants:Ce.updatedSession.combatants};if(Ve)a(Ee);else{const _t={currentTurn:Ce.updatedSession.currentTurn,round:Ce.updatedSession.round,combatants:Ce.updatedSession.combatants};await Xr(n,_t)}Ce.damage&&tt({type:"damage",actor:j.name,target:(G==null?void 0:G.name)||"self",damage:Ce.damage,description:`${j.name} deals ${Ce.damage} damage to ${(G==null?void 0:G.name)||"self"}`}),Ce.healing&&tt({type:"healing",actor:j.name,target:(G==null?void 0:G.name)||"self",healing:Ce.healing,description:`${j.name} heals ${(G==null?void 0:G.name)||"self"} for ${Ce.healing} HP`}),Ce.statusEffects&&Ce.statusEffects.length>0&&Ce.statusEffects.forEach(_t=>{tt({type:"status_effect",actor:j.name,target:(G==null?void 0:G.name)||"self",effect:_t.type,description:`${(G==null?void 0:G.name)||"self"} is affected by ${_t.type}`})}),Ce.targetDied&&tt({type:"death",actor:j.name,target:(G==null?void 0:G.name)||"self",description:`${(G==null?void 0:G.name)||"self"} has been defeated!`}),Ce.damage&&G&&(pe({targetId:G.id,damage:Ce.damage,type:"damage"}),oe(!0),setTimeout(()=>oe(!1),2e3)),Ce.healing&&G&&(pe({targetId:G.id,damage:Ce.healing,type:"healing"}),oe(!0),setTimeout(()=>oe(!1),2e3));const qe=Qr.generateActionNarrative(j,be,G,J);if(N(`${j.name} uses ${be}!`),Be(qe),Ce.combatEnded){console.log("Combat ended"),Ve?e("/test-environment",{state:{...Dt,combatResult:Ce.combatResult}}):await V(Ce.combatResult);return}if(Ee.combatants.filter(_t=>!_t.id.startsWith("enemy_")&&_t.hp>0).length===0){console.log("All players dead, ending combat"),Ve?e("/test-environment",{state:{...Dt,combatResult:"defeat"}}):await V("defeat");return}}else console.error("Enemy action execution failed:",Ce.error),tt({type:"action_failed",actor:j.name,action:be,description:`${j.name}'s ${be} failed`}),setTimeout(()=>{Xt()},1e3)}catch(J){console.error("Error processing enemy turn:",J),tt({type:"error",actor:j.name,description:`Error during ${j.name}'s turn`}),setTimeout(()=>{Xt()},1e3)}finally{$e(!1),P(!1)}},Xt=async()=>{if(!i||i.combatState!=="active")return;const j=i.combatants.filter(Ct=>!Ct.id.startsWith("enemy_")),J=i.combatants.filter(Ct=>Ct.id.startsWith("enemy_")),be=j.some(Ct=>Ct.hp>0),ke=J.some(Ct=>Ct.hp>0);if(!be){Ve?e("/test-environment",{state:{...Dt,combatResult:"defeat"}}):await V("defeat");return}if(!ke){Ve?e("/test-environment",{state:{...Dt,combatResult:"victory"}}):await V("victory");return}let G=(i.currentTurn+1)%i.combatants.length,Ce=0;const Ee=i.combatants.length;for(;Ce<Ee;){const Ct=i.combatants[G];if(Ct&&Ct.hp>0)break;G=(G+1)%i.combatants.length,Ce++}if(Ce>=Ee){Ve?e("/test-environment",{state:{...Dt,combatResult:"draw"}}):await V("draw");return}const qe={currentTurn:G};G===0&&(qe.round=i.round+1),console.log(" Advancing turn:",{currentTurn:i.currentTurn,nextTurn:G,updates:qe,isTestCombat:Ve,sessionId:n}),Ve?a(Ct=>({...Ct,...qe})):(console.log(" Sending advanceTurn database update:",qe),await Xr(n,qe),console.log(" AdvanceTurn database update completed")),H(G);const Mn=i.combatants[G];Mn&&await tt({type:"turn_advance",description:` ${Mn.name}'s turn begins`});const _t={...i,...qe};Ot(_t)},V=async(j="victory")=>{if(!i)return;const J=Qr.generateCombatSummary(i,j);Ve?(a(be=>({...be,status:"ended",combatState:"ended",summary:J})),e("/test-environment")):(await vS(n,{status:"ended",combatState:"ended",summary:J}),await Tn(n,{status:"storytelling",currentCombat:null}),e(`/campaign/${n}`))},W=(j=i)=>{if(!j)return null;const J=j.combatants||[],be=j.currentTurn||0;return J.length===0||be>=J.length?null:J[be]},we=()=>{const j=W();if(!j)return console.log(" No current combatant found"),!1;if(Ve){const be=!j.isEnemy;return console.log(" Test mode turn check:",{currentCombatant:j.name,isEnemy:j.isEnemy,isCurrentUserTurn:be}),be}const J=j.userId===(r==null?void 0:r.uid);return console.log(" Co-op mode turn check:",{currentCombatant:j.name,currentCombatantUserId:j.userId,currentUserId:r==null?void 0:r.uid,isCurrentUserTurn:J}),J},Le=()=>{if(i){if(Ve){const j=i.combatants.find(J=>!J.isEnemy);j&&j.hp<=0&&(Y(!0),Se(j))}else if(r){const j=i.partyMembers.find(J=>J.userId===r.uid)||i.combatants.find(J=>J.userId===r.uid&&!J.isEnemy);j&&j.hp<=0&&(Y(!0),Se(j))}}},Zt=()=>{if(Ve)e("/dashboard");else{const j=i==null?void 0:i.partyId;e(`/character-creation/${j}`)}},ln=()=>{if(Ve)X(!1),_e(new Set),Xt();else{const j=r==null?void 0:r.uid;j&&_e(J=>new Set([...J,j]))}},Un=()=>{if(Ve)return!0;if(!(i!=null&&i.partyMembers))return!1;const j=i.partyMembers.filter(be=>be.hp>0);return Me.size>=j.length},en=Array.isArray(i==null?void 0:i.combatants)?i.combatants:Array.isArray(i==null?void 0:i.partyMembers)&&Array.isArray(i==null?void 0:i.enemies)?[...i.partyMembers.map(j=>({...j,isEnemy:!1,userId:j.userId,cooldowns:j.cooldowns||{},statusEffects:j.statusEffects||[],hp:j.hp??j.maxHp??1,maxHp:j.maxHp??j.hp??1})),...i.enemies.map(j=>({...j,isEnemy:!0,userId:null,cooldowns:j.cooldowns||{},statusEffects:j.statusEffects||[],hp:j.hp??j.maxHp??1,maxHp:j.maxHp??j.hp??1}))]:[],Ss=j=>{if(!j||!en.length)return[];const J=en.filter(G=>G.hp>0),be=W();if(!be)return[];const ke=!be.id.startsWith("enemy_");switch(j){case"attack":case"spell":case"special":return ke?J.filter(G=>G.id.startsWith("enemy_")):J.filter(G=>!G.id.startsWith("enemy_"));case"heal":case"item":return ke?J.filter(G=>!G.id.startsWith("enemy_")&&G.id!==be.id):J.filter(G=>G.id.startsWith("enemy_")&&G.id!==be.id);case"defend":case"environmental":return[be];case"teamUp":return ke?J.filter(G=>!G.id.startsWith("enemy_")&&G.id!==be.id):J.filter(G=>G.id.startsWith("enemy_")&&G.id!==be.id);default:return J}},Bn=Array.isArray(i==null?void 0:i.enemies)?i.enemies:[];if(!r)return null;if(o)return l.jsx("div",{className:"fantasy-container py-8",children:l.jsx("div",{className:"fantasy-card",children:l.jsxs("div",{className:"text-center py-8",children:[l.jsx("div",{className:"text-4xl mb-4",children:""}),l.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Loading Combat..."}),l.jsx("p",{className:"text-gray-300 mb-6",children:"Preparing the battlefield and gathering combatants..."}),l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto"})]})})});if(!i)return l.jsx("div",{className:"fantasy-container py-8",children:l.jsx("div",{className:"fantasy-card",children:l.jsx("div",{className:"text-center py-8",children:l.jsx("div",{className:"text-gray-400",children:"No active combat session found."})})})});if((i.status==="no_enemies"||Bn.length===0)&&!Ve)return l.jsx("div",{className:"fantasy-container py-8",children:l.jsx("div",{className:"fantasy-card",children:l.jsxs("div",{className:"text-center py-8",children:[l.jsx("div",{className:"text-4xl mb-4",children:""}),l.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"No Enemies to Fight"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"There are no enemies present in this area. Combat cannot begin."}),l.jsx("p",{className:"text-gray-400 text-sm",children:"The combat session will end automatically."})]})})});const dt=W();return Pe&&ae?l.jsx("div",{className:"fantasy-container py-8",children:l.jsx("div",{className:"fantasy-card bg-red-50 border-red-200",children:l.jsxs("div",{className:"text-center py-8",children:[l.jsx("div",{className:"text-6xl mb-4",children:""}),l.jsx("h1",{className:"text-3xl font-bold text-red-800 mb-4",children:"Character Death"}),l.jsxs("div",{className:"text-xl text-red-700 mb-6",children:[ae.name," has fallen in battle..."]}),l.jsxs("div",{className:"bg-white p-6 rounded-lg border border-red-300 mb-6",children:[l.jsx("h2",{className:"text-lg font-semibold text-stone-800 mb-2",children:"Fallen Hero"}),l.jsxs("p",{className:"text-stone-600 mb-2",children:[l.jsx("strong",{children:"Name:"})," ",ae.name]}),l.jsxs("p",{className:"text-stone-600 mb-2",children:[l.jsx("strong",{children:"Class:"})," ",ae.class]}),l.jsxs("p",{className:"text-stone-600 mb-2",children:[l.jsx("strong",{children:"Level:"})," ",ae.level]}),l.jsxs("p",{className:"text-stone-600",children:[l.jsx("strong",{children:"Final HP:"})," ",ae.hp,"/",ae.maxHp]})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("p",{className:"text-stone-600",children:"Your character has been defeated. You must create a new character to continue."}),l.jsx("button",{onClick:Zt,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})}):l.jsx("div",{className:"min-h-screen bg-gray-900 text-gray-100 p-4",children:l.jsxs("div",{className:"fantasy-container py-4",children:[l.jsxs("div",{className:"mb-6",children:[l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsx("h1",{className:"fantasy-title mb-0",children:" Combat Arena"}),dt&&l.jsxs("div",{className:"text-right",children:[l.jsxs("div",{className:"text-2xl font-bold text-amber-400",children:[" ",dt.name,"'s Turn"]}),l.jsxs("div",{className:"text-sm text-gray-400",children:["Round ",(i==null?void 0:i.round)||1,"  Turn ",((i==null?void 0:i.currentTurn)||0)+1]})]})]}),i.storyContext&&l.jsxs("div",{className:"fantasy-card mb-4 bg-gray-800/50 border-gray-600",children:[l.jsx("h3",{className:"font-bold text-gray-100 mb-2",children:" Story Context"}),l.jsx("p",{className:"text-gray-300 italic",children:i.storyContext})]})]}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[l.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[en.length>0&&l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h3",{className:"font-bold text-gray-100 mb-3 text-sm",children:" Turn Order"}),l.jsx("div",{className:"space-y-1",children:en.map((j,J)=>{var be,ke;return l.jsx("div",{className:`p-2 rounded border transition-colors text-xs ${j.id===((be=en[i.currentTurn])==null?void 0:be.id)?"border-amber-500 bg-amber-900/20":j.hp<=0?"border-red-600 bg-red-900/20 opacity-50":"border-gray-600 bg-gray-700"}`,children:l.jsx("div",{className:"flex justify-between items-center",children:l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"font-medium text-gray-100 truncate",children:[j.name,j.id===((ke=en[i.currentTurn])==null?void 0:ke.id)&&l.jsx("span",{className:"ml-1 text-amber-400",children:""})]}),l.jsxs("div",{className:"text-gray-400",children:[j.hp,"/",j.maxHp," HP"]})]})})},j.id)})})]}),l.jsxs("div",{className:"fantasy-card h-64",children:[l.jsx("h3",{className:"text-sm font-semibold mb-3 text-yellow-400",children:" Battle Log"}),l.jsx("div",{className:"space-y-1 h-52 overflow-y-auto text-xs",children:Ye.length===0?l.jsx("p",{className:"text-gray-400",children:"No actions recorded yet..."}):Ye.slice(-10).map(j=>l.jsxs("div",{className:"border-l-2 border-gray-600 pl-2 py-1",children:[l.jsxs("div",{className:"flex justify-between items-start mb-1",children:[l.jsx("span",{className:"text-gray-400",children:j.timestamp}),l.jsxs("span",{className:"text-blue-400",children:["R",j.round]})]}),l.jsx("div",{className:`${j.type==="damage"?"text-red-400":j.type==="healing"?"text-green-400":j.type==="death"?"text-red-500 font-semibold":j.type==="status_effect"?"text-purple-400":j.type==="action_failed"?"text-orange-400":j.type==="error"?"text-red-500":"text-gray-200"}`,children:j.description})]},j.id))})]})]}),l.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[(()=>dt&&en.length>0)()&&l.jsxs("div",{className:"fantasy-card bg-gray-800/50 border-gray-600",children:[l.jsxs("div",{className:"text-center mb-4",children:[l.jsxs("h2",{className:"text-xl font-bold text-amber-400 mb-1",children:[" ",dt.name,"'s Turn"]}),l.jsx("p",{className:"text-gray-300 text-sm",children:we()?"Select your action below":"Waiting for this player to act"})]}),we()?l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-gray-100 mb-3 text-center",children:" Available Actions"}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:C.map((j,J)=>l.jsxs("button",{onClick:()=>p(j),className:`p-3 rounded-lg border-2 transition-all duration-200 text-left hover:scale-105 ${(m==null?void 0:m.type)===j.type?"border-amber-500 bg-amber-900/30 shadow-lg shadow-amber-500/20":"border-gray-600 bg-gray-700 hover:border-gray-500 hover:bg-gray-600"}`,children:[l.jsx("div",{className:"font-bold text-sm text-gray-100 mb-1",children:j.name}),l.jsx("div",{className:"text-xs text-gray-300 mb-1",children:j.description}),l.jsx("div",{className:"text-xs text-gray-400 bg-gray-800 px-1 py-0.5 rounded inline-block",children:j.priority})]},J))})]}),m&&l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-gray-100 mb-3 text-center",children:" Select Target"}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:Ss(m.type).map(j=>l.jsxs("button",{onClick:()=>E(j),className:`p-3 rounded-lg border-2 transition-all duration-200 hover:scale-105 ${(y==null?void 0:y.id)===j.id?"border-red-500 bg-red-900/30 shadow-lg shadow-red-500/20":"border-gray-600 bg-gray-700 hover:border-gray-500 hover:bg-gray-600"}`,children:[l.jsx("div",{className:"font-bold text-sm text-gray-100 mb-1",children:j.name}),l.jsxs("div",{className:"text-xs text-gray-300 mb-1",children:["HP: ",j.hp,"/",j.maxHp," | AC: ",j.ac]}),l.jsx("div",{className:`text-xs px-1 py-0.5 rounded inline-block ${j.id.startsWith("enemy_")?"bg-red-900 text-red-200":"bg-blue-900 text-blue-200"}`,children:j.id.startsWith("enemy_")?" Enemy":" Ally"})]},j.id))}),Ss(m.type).length===0&&l.jsx("div",{className:"text-center p-4 bg-gray-700 border border-gray-600 rounded-lg",children:l.jsx("p",{className:"text-gray-300",children:"No valid targets for this action."})})]}),m&&y&&l.jsx("div",{className:"text-center pt-6",children:l.jsx("button",{onClick:()=>jn(m.type,y.id),disabled:Fe,className:"fantasy-button bg-amber-600 hover:bg-amber-700 text-xl font-bold px-8 py-4 shadow-lg hover:scale-105 transition-all duration-200",children:Fe?" Executing...":` Execute ${m.name}`})})]}):l.jsxs("div",{className:"bg-blue-900/20 border border-blue-700 rounded-lg p-8 text-center",children:[l.jsx("div",{className:"text-6xl mb-4",children:""}),l.jsxs("h3",{className:"text-2xl font-bold text-blue-300 mb-4",children:["Waiting for ",dt.name," to act"]}),l.jsx("p",{className:"text-blue-200 text-lg",children:dt.userId===(r==null?void 0:r.uid)?"It's your turn! Please select an action above.":"Please wait for the current player to make their move."})]})]}),(!en.length||!Bn.length)&&l.jsxs("div",{className:"fantasy-card bg-gray-800 border-gray-600",children:[l.jsx("h3",{className:"font-bold text-gray-100 mb-3",children:"Combat Status"}),l.jsxs("div",{className:"text-gray-300 space-y-2",children:[l.jsxs("p",{children:[l.jsx("strong",{children:"Combat State:"})," ",i.combatState]}),l.jsxs("p",{children:[l.jsx("strong",{children:"Combatants:"})," ",en.length]}),l.jsxs("p",{children:[l.jsx("strong",{children:"Enemies:"})," ",Bn.length]}),l.jsxs("p",{children:[l.jsx("strong",{children:"Current Turn:"})," ",i.currentTurn]}),i.combatState==="preparation"&&l.jsx("button",{onClick:Is,className:"fantasy-button bg-yellow-600 hover:bg-yellow-700 mt-4",children:"Start Combat"})]})]}),v&&l.jsxs("div",{className:"fantasy-card bg-green-900/20 border-green-700",children:[l.jsx("h4",{className:"font-bold text-green-300 mb-2",children:"Action Result"}),l.jsx("p",{className:"text-green-200",children:v}),_&&l.jsx("div",{className:"mt-2 p-3 bg-gray-700 border border-green-600 rounded",children:l.jsx("p",{className:"text-gray-200 italic",children:_})})]}),A&&l.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700 animate-pulse",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h4",{className:"font-bold text-red-300 mb-3 text-xl",children:" Enemy Turn"}),D&&l.jsx("div",{className:"text-red-200 font-bold text-lg mb-3 bg-gray-700 p-3 rounded border border-red-600",children:D}),S&&l.jsx("div",{className:"mt-3 p-4 bg-gray-700 border border-red-600 rounded",children:l.jsx("p",{className:"text-gray-200 italic",children:S})}),l.jsxs("div",{className:"mt-4 flex items-center justify-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"}),l.jsx("span",{className:"ml-3 text-red-300 font-medium",children:"Enemy is acting..."})]})]})}),ge&&l.jsx("div",{className:"fantasy-card bg-blue-900/20 border-blue-700",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h4",{className:"font-bold text-blue-300 mb-3 text-xl",children:" Enemy Turn Complete"}),l.jsx("p",{className:"text-blue-200 mb-4",children:Ve?"The enemy has finished their turn. Click 'Confirm' to proceed to the next turn.":"The enemy has finished their turn. All party members must click 'Confirm' to proceed."}),!Ve&&l.jsxs("div",{className:"mb-4 p-3 bg-gray-700 border border-blue-600 rounded",children:[l.jsxs("p",{className:"text-sm text-blue-200",children:[l.jsx("strong",{children:"Ready to continue:"})," ",Me.size," / ",((yn=i==null?void 0:i.partyMembers)==null?void 0:yn.filter(j=>j.hp>0).length)||0," party members"]}),Me.size>0&&l.jsxs("div",{className:"mt-2 text-xs text-blue-300",children:["Waiting for: ",((Hr=(yr=(Nr=i==null?void 0:i.partyMembers)==null?void 0:Nr.filter(j=>j.hp>0&&!Me.has(j.userId)))==null?void 0:yr.map(j=>j.name))==null?void 0:Hr.join(", "))||"None"]})]}),l.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center items-center",children:[l.jsx("button",{onClick:ln,disabled:!Ve&&Me.has(r==null?void 0:r.uid),className:`fantasy-button px-8 py-3 text-lg font-semibold ${!Ve&&Me.has(r==null?void 0:r.uid)?"bg-green-700 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 shadow-lg"}`,children:!Ve&&Me.has(r==null?void 0:r.uid)?" Ready":"Confirm"}),Ve&&l.jsx("button",{onClick:()=>{X(!1),_e(new Set),Xt()},className:"fantasy-button px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white",children:"Skip Confirmation"})]}),l.jsx("div",{className:"mt-4 p-3 bg-yellow-900/20 border border-yellow-600 rounded",children:l.jsxs("p",{className:"text-sm text-yellow-200",children:[l.jsx("strong",{children:"Note:"})," Review the battle log and enemy actions before continuing to the next turn."]})})]})}),Fe&&!A&&l.jsx("div",{className:"fantasy-card bg-amber-900/20 border-amber-700",children:l.jsxs("div",{className:"flex items-center justify-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-amber-500"}),l.jsx("span",{className:"ml-2 text-amber-300 font-medium",children:"Processing turn..."})]})}),(i==null?void 0:i.combatState)==="ready"&&!It&&l.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h4",{className:"font-bold text-red-300 mb-4 text-2xl",children:" Combat Ready!"}),l.jsx("p",{className:"text-red-200 mb-6 text-lg",children:"All combatants are in position. Click 'Fight!' to begin the battle."}),l.jsx("button",{onClick:St,disabled:Fe,className:"fantasy-button px-12 py-4 text-xl font-bold bg-red-600 hover:bg-red-700 shadow-lg",children:Fe?"Preparing...":"Fight!"})]})})]}),l.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h3",{className:"font-bold text-gray-100 mb-3 text-sm",children:" Combat Status"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold text-blue-300 mb-2 text-xs",children:" Party"}),l.jsx("div",{className:"space-y-1",children:en.filter(j=>!j.id.startsWith("enemy_")).map(j=>l.jsx("div",{className:`p-2 rounded border text-xs ${j.hp<=0?"bg-red-900/20 border-red-600":j.hp<j.maxHp*.5?"bg-yellow-900/20 border-yellow-600":"bg-blue-900/20 border-blue-600"} ${(dt==null?void 0:dt.id)===j.id?"ring-1 ring-amber-400":""}`,children:l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsxs("span",{className:"font-medium text-gray-100 truncate",children:[j.name,(dt==null?void 0:dt.id)===j.id&&l.jsx("span",{className:"ml-1 text-amber-400",children:""})]}),l.jsxs("span",{className:`text-xs ${j.hp<=0?"text-red-400":j.hp<j.maxHp*.5?"text-yellow-400":"text-green-400"}`,children:[j.hp,"/",j.maxHp]})]})},j.id))})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold text-red-300 mb-2 text-xs",children:" Enemies"}),l.jsx("div",{className:"space-y-1",children:en.filter(j=>j.id.startsWith("enemy_")).map(j=>l.jsx("div",{className:`p-2 rounded border text-xs ${j.hp<=0?"bg-red-900/20 border-red-600":j.hp<j.maxHp*.5?"bg-yellow-900/20 border-yellow-600":"bg-red-900/20 border-red-600"} ${(dt==null?void 0:dt.id)===j.id?"ring-1 ring-amber-400":""}`,children:l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsxs("span",{className:"font-medium text-gray-100 truncate",children:[j.name,(dt==null?void 0:dt.id)===j.id&&l.jsx("span",{className:"ml-1 text-amber-400",children:""})]}),l.jsxs("span",{className:`text-xs ${j.hp<=0?"text-red-400":j.hp<j.maxHp*.5?"text-yellow-400":"text-red-400"}`,children:[j.hp,"/",j.maxHp]})]})},j.id))})]})]})]}),F.length>0&&l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h3",{className:"font-bold text-blue-300 mb-2 text-sm",children:" Environment"}),l.jsx("div",{className:"flex flex-wrap gap-1",children:F.map((j,J)=>l.jsx("span",{className:"px-2 py-1 bg-blue-900 text-blue-200 rounded text-xs",children:j},J))})]}),T.length>0&&l.jsxs("div",{className:"fantasy-card",children:[l.jsx("h3",{className:"font-bold text-purple-300 mb-2 text-sm",children:" Team Up"}),l.jsx("div",{className:"space-y-1",children:T.map((j,J)=>l.jsxs("div",{className:"text-purple-200 text-xs",children:[l.jsxs("strong",{children:[j.classes.join("+"),":"]})," ",j.description]},J))})]}),Ue&&ne&&l.jsx("div",{className:"fixed inset-0 pointer-events-none z-50 flex items-center justify-center",children:l.jsxs("div",{className:`text-6xl font-bold animate-bounce px-6 py-4 rounded-lg shadow-lg ${ne.type==="damage"?"text-red-400 bg-red-900/80":"text-green-400 bg-green-900/80"}`,children:[ne.type==="damage"?"-":"+",ne.damage]})}),Pe&&ae&&l.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:l.jsxs("div",{className:"text-center py-8",children:[l.jsx("div",{className:"text-6xl mb-4",children:""}),l.jsx("h1",{className:"text-3xl font-bold text-red-300 mb-4",children:"Character Death"}),l.jsxs("div",{className:"text-xl text-red-200 mb-6",children:[ae.name," has fallen in battle..."]}),l.jsxs("div",{className:"bg-gray-700 p-6 rounded-lg border border-red-600 mb-6",children:[l.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Fallen Hero"}),l.jsxs("p",{className:"text-gray-300 mb-2",children:[l.jsx("strong",{children:"Name:"})," ",ae.name]}),l.jsxs("p",{className:"text-gray-300 mb-2",children:[l.jsx("strong",{children:"Class:"})," ",ae.class]}),l.jsxs("p",{className:"text-gray-300 mb-2",children:[l.jsx("strong",{children:"Level:"})," ",ae.level]}),l.jsxs("p",{className:"text-gray-300",children:[l.jsx("strong",{children:"Final HP:"})," ",ae.hp,"/",ae.maxHp]})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("p",{className:"text-gray-300",children:"Your character has been defeated. You must create a new character to continue."}),l.jsx("button",{onClick:Zt,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})]})]})]})})}function zV(){const n=fr(),[e,t]=k.useState(null),[r,s]=k.useState([]),[i,a]=k.useState([]),[o,c]=k.useState({}),[d,h]=k.useState({}),[m,p]=k.useState(!1),[y,E]=k.useState(!1),[v,I]=k.useState(""),[_,x]=k.useState({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""});k.useEffect(()=>{const N=Yo(S=>{if(!S){n("/login");return}t(S),C(S.uid),R()});return()=>N()},[n]);const C=async N=>{try{const S=await Iy(N);s(S),await F(S)}catch(S){console.error("Error loading parties:",S.message)}},R=async()=>{try{const S=(await iS()).filter(Be=>{var Fe;return!((Fe=Be.members)!=null&&Fe.includes(e==null?void 0:e.uid))});a(S),await q(S)}catch(N){console.error("Error loading public parties:",N.message)}},F=async N=>{try{const S=new Set;if(N.forEach(Pe=>{Pe.members&&Array.isArray(Pe.members)&&Pe.members.forEach(Y=>S.add(Y))}),S.size===0)return;const Be=await hp(Array.from(S)),Fe={};Be.forEach(Pe=>{Fe[Pe.userId]=Pe});const $e={};N.forEach(Pe=>{Pe.members&&Array.isArray(Pe.members)&&($e[Pe.id]=Pe.members.map(Y=>({userId:Y,profile:Fe[Y]||null})))}),c($e)}catch(S){console.error("Error loading party member profiles:",S)}},q=async N=>{try{const S=new Set;if(N.forEach(Pe=>{Pe.members&&Array.isArray(Pe.members)&&Pe.members.forEach(Y=>S.add(Y))}),S.size===0)return;const Be=await hp(Array.from(S)),Fe={};Be.forEach(Pe=>{Fe[Pe.userId]=Pe});const $e={};N.forEach(Pe=>{Pe.members&&Array.isArray(Pe.members)&&($e[Pe.id]=Pe.members.map(Y=>({userId:Y,profile:Fe[Y]||null})))}),h($e)}catch(S){console.error("Error loading public party member profiles:",S)}},T=async N=>{if(N.preventDefault(),!e){console.error("You must be logged in to create a party");return}p(!0);try{const S={..._,inviteCode:Math.random().toString(36).substr(2,8).toUpperCase()},Be=await Ty(e.uid,S);E(!1),x({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""}),await C(e.uid),await R(),console.log("Party created successfully!")}catch(S){console.error("Error creating party:",S.message)}finally{p(!1)}},b=async()=>{if(!v.trim()){console.error("Please enter an invite code");return}if(!e){console.error("You must be logged in to join a party");return}p(!0);try{const N=await aS(v.toUpperCase());if(!N){console.error("Invalid invite code");return}await mp(N.id,e.uid),I(""),await C(e.uid),await R(),console.log("Successfully joined party!")}catch(N){console.error(N.message||"Error joining party. Please try again.")}finally{p(!1)}},A=async N=>{if(!e){console.error("You must be logged in to join a party");return}p(!0);try{await mp(N,e.uid),await C(e.uid),await R(),console.log("Successfully joined public party!")}catch(S){console.error(S.message||"Error joining party. Please try again.")}finally{p(!1)}},P=N=>{navigator.clipboard.writeText(N),console.log("Invite code copied to clipboard!")},D=async(N,S)=>{if(confirm(`Are you sure you want to disband "${S}"? This action cannot be undone and will remove all party members and characters.`)){p(!0);try{await Sy(N,e.uid),await C(e.uid),await R(),console.log("Party disbanded successfully")}catch(Be){console.error("Error disbanding party:",Be.message)}finally{p(!1)}}};return e?l.jsx("div",{className:"fantasy-container py-8",children:l.jsxs("div",{className:"fantasy-card",children:[l.jsxs("div",{className:"flex justify-between items-center mb-6",children:[l.jsx("h1",{className:"fantasy-title mb-0",children:"Party Management"}),l.jsx("button",{onClick:()=>E(!0),className:"fantasy-button",disabled:m,children:"Create New Party"})]}),y&&l.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600 mb-6",children:[l.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-4",children:"Create New Party"}),l.jsxs("form",{onSubmit:T,className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"party-name",className:"block text-sm font-medium text-gray-200 mb-2",children:"Party Name"}),l.jsx("input",{id:"party-name",type:"text",value:_.name,onChange:N=>x(S=>({...S,name:N.target.value})),className:"fantasy-input",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"party-theme",className:"block text-sm font-medium text-gray-200 mb-2",children:"Theme"}),l.jsx("textarea",{id:"party-theme",value:_.description,onChange:N=>x(S=>({...S,description:N.target.value})),className:"fantasy-input",rows:"3",placeholder:"Enter the theme or atmosphere for your campaign..."})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"max-players",className:"block text-sm font-medium text-gray-200 mb-2",children:"Max Players"}),l.jsx("input",{id:"max-players",type:"number",min:"2",max:"10",value:_.maxPlayers,onChange:N=>x(S=>({...S,maxPlayers:parseInt(N.target.value)})),className:"fantasy-input"})]}),l.jsxs("div",{className:"flex items-center",children:[l.jsx("input",{type:"checkbox",id:"isPublic",checked:_.isPublic,onChange:N=>x(S=>({...S,isPublic:N.target.checked})),className:"mr-2"}),l.jsx("label",{htmlFor:"isPublic",className:"text-sm font-medium text-gray-200",children:"Public Party (visible to all users)"})]})]}),l.jsxs("div",{className:"flex space-x-4",children:[l.jsx("button",{type:"submit",className:"fantasy-button",disabled:m,children:m?"Creating...":"Create Party"}),l.jsx("button",{type:"button",onClick:()=>E(!1),className:"fantasy-button bg-gray-600 hover:bg-gray-700",disabled:m,children:"Cancel"})]})]})]}),l.jsxs("div",{className:"mb-8",children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"My Parties"}),r.length===0?l.jsxs("div",{className:"text-center py-8 text-gray-300",children:[l.jsx("p",{children:"You haven't joined any parties yet."}),l.jsx("p",{children:'Click "Create New Party" to get started!'})]}):l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:r.map(N=>{var Be,Fe;const S=o[N.id]||[];return l.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:[l.jsxs("div",{className:"flex justify-between items-start mb-4",children:[l.jsx("h3",{className:"text-xl font-bold text-gray-100",children:N.name}),l.jsxs("span",{className:"text-sm text-gray-300",children:[((Be=N.members)==null?void 0:Be.length)||1,"/",N.maxPlayers," players"]})]}),N.description&&l.jsxs("div",{className:"mb-4",children:[l.jsx("span",{className:"text-sm font-semibold text-gray-200",children:"Theme: "}),l.jsx("span",{className:"text-gray-300",children:N.description})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("h4",{className:"text-sm font-semibold text-gray-200 mb-2",children:"Party Members:"}),l.jsx("div",{className:"space-y-1",children:S.map(($e,Pe)=>{var Se;const Y=((Se=$e.profile)==null?void 0:Se.username)||`User ${Pe+1}`,ae=$e.userId===N.dmId;return l.jsxs("div",{className:"flex items-center justify-between text-sm",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("span",{className:"text-gray-300",children:Y}),ae&&l.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),$e.userId===(e==null?void 0:e.uid)&&l.jsx("span",{className:"text-blue-400 text-xs font-medium",children:"(You)"})]},$e.userId)})})]}),N.dmId===e.uid&&l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{htmlFor:`invite-code-${N.id}`,className:"block text-sm font-medium text-gray-200 mb-2",children:"Invite Code"}),l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("input",{id:`invite-code-${N.id}`,type:"text",value:N.inviteCode,readOnly:!0,className:"fantasy-input bg-gray-700"}),l.jsx("button",{onClick:()=>P(N.inviteCode),className:"fantasy-button text-sm",children:"Copy"})]})]}),l.jsx("div",{className:"flex space-x-2",children:(Fe=N.members)!=null&&Fe.includes(e==null?void 0:e.uid)?l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:()=>n(`/campaign/${N.id}`),className:"fantasy-button",children:"Campaign"}),N.dmId===e.uid&&l.jsx("button",{onClick:()=>D(N.id,N.name),className:"fantasy-button bg-red-600 hover:bg-red-700",disabled:m,children:"Disband"})]}):l.jsx("button",{onClick:()=>A(N.id),className:"fantasy-button bg-green-600 hover:bg-green-700",disabled:m,children:"Join Party"})})]},N.id)})})]}),l.jsxs("div",{className:"mb-8",children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Public Parties"}),i.length===0?l.jsx("div",{className:"text-center py-8 text-gray-300",children:l.jsx("p",{children:"No public parties available."})}):l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:i.map(N=>{var Be;const S=d[N.id]||[];return l.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:[l.jsxs("div",{className:"flex justify-between items-start mb-4",children:[l.jsx("h3",{className:"text-xl font-bold text-gray-100",children:N.name}),l.jsxs("span",{className:"text-sm text-gray-300",children:[((Be=N.members)==null?void 0:Be.length)||1,"/",N.maxPlayers," players"]})]}),N.description&&l.jsxs("div",{className:"mb-4",children:[l.jsx("span",{className:"text-sm font-semibold text-gray-200",children:"Theme: "}),l.jsx("span",{className:"text-gray-300",children:N.description})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("h4",{className:"text-sm font-semibold text-gray-200 mb-2",children:"Party Members:"}),l.jsx("div",{className:"space-y-1",children:S.map((Fe,$e)=>{var ae;const Pe=((ae=Fe.profile)==null?void 0:ae.username)||`User ${$e+1}`,Y=Fe.userId===N.dmId;return l.jsxs("div",{className:"flex items-center justify-between text-sm",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("span",{className:"text-gray-300",children:Pe}),Y&&l.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),Fe.userId===(e==null?void 0:e.uid)&&l.jsx("span",{className:"text-blue-400 text-xs font-medium",children:"(You)"})]},Fe.userId)})})]}),N.dmId===e.uid&&l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{htmlFor:`invite-code-${N.id}`,className:"block text-sm font-medium text-gray-200 mb-2",children:"Invite Code"}),l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("input",{id:`invite-code-${N.id}`,type:"text",value:N.inviteCode,readOnly:!0,className:"fantasy-input bg-gray-700"}),l.jsx("button",{onClick:()=>P(N.inviteCode),className:"fantasy-button text-sm",children:"Copy"})]})]}),l.jsx("div",{className:"flex space-x-2",children:l.jsx("button",{onClick:()=>A(N.id),className:"fantasy-button bg-green-600 hover:bg-green-700",disabled:m,children:"Join Party"})})]},N.id)})})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Join a Party"}),l.jsx("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:l.jsxs("div",{className:"flex items-center space-x-4",children:[l.jsx("input",{id:"join-code",type:"text",placeholder:"Enter invite code",value:v,onChange:N=>I(N.target.value),className:"fantasy-input flex-1",disabled:m}),l.jsx("button",{onClick:b,className:"fantasy-button",disabled:m,children:m?"Joining...":"Join Party"})]})})]})]})}):null}function qV(){const n=_i(),e=n.pathname.split("/campaign-story/")[1];return console.log("Old route detected:",n.pathname),console.log("PartyId extracted:",e),console.log("Redirecting to:",`/campaign/${e}`),l.jsx(Mb,{to:`/campaign/${e}`,replace:!0})}function WV(){return l.jsx(hN,{basename:"/DND-V1",future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:l.jsxs("div",{className:"min-h-screen flex flex-col",children:[l.jsx(EV,{}),l.jsx("main",{className:"flex-grow",children:l.jsxs(iN,{children:[l.jsx(Zn,{path:"/",element:l.jsx(CV,{})}),l.jsx(Zn,{path:"/login",element:l.jsx(AV,{})}),l.jsx(Zn,{path:"/register",element:l.jsx(NV,{})}),l.jsx(Zn,{path:"/dashboard",element:l.jsx(kV,{})}),l.jsx(Zn,{path:"/test-environment",element:l.jsx(jV,{})}),l.jsx(Zn,{path:"/campaign-management",element:l.jsx(OV,{})}),l.jsx(Zn,{path:"/character-creation/:partyId",element:l.jsx(FV,{})}),l.jsx(Zn,{path:"/campaign/:partyId",element:l.jsx(UV,{})}),l.jsx(Zn,{path:"/combat/:sessionId",element:l.jsx(BV,{})}),l.jsx(Zn,{path:"/party-management",element:l.jsx(zV,{})}),l.jsx(Zn,{path:"/campaign-story/:partyId",element:l.jsx(qV,{})}),l.jsx(Zn,{path:"*",element:l.jsx(Mb,{to:"/dashboard",replace:!0})})]})}),l.jsx(IV,{})]})})}$m.createRoot(document.getElementById("root")).render(l.jsx(E_.StrictMode,{children:l.jsx(WV,{})}));export{ft as $,YI as A,da as B,zr as C,qt as D,XL as E,pa as F,dy as G,JL as H,YV as I,mr as J,vM as K,_M as L,Si as M,EL as N,TL as O,zM as P,gn as Q,fL as R,tL as S,Pt as T,BL as U,Oh as V,UM as W,UL as X,bL as Y,iL as Z,$E as _,bc as a,ZV as a0,xM as a1,PM as a2,YL as a3,od as a4,$L as a5,lL as a6,QL as a7,Ze as a8,hL as a9,dL as aA,Yc as aB,kL as aC,mL as aD,pL as aE,VL as aF,LL as aG,FM as aH,on as aI,VI as aJ,eL as aK,FL as aL,ze as aM,PL as aN,HL as aO,HV as aP,IL as aQ,vL as aR,yL as aS,wL as aT,cL as aU,jt as aV,qL as aW,aL as aX,Gt as aY,WL as aZ,rL as aa,sL as ab,oL as ac,KL as ad,_L as ae,xL as af,Rt as ag,Jc as ah,RM as ai,RL as aj,kn as ak,SL as al,CL as am,Pn as an,AL as ao,NL as ap,wM as aq,GL as ar,zL as as,nL as at,AM as au,gL as av,uL as aw,jL as ax,ML as ay,DL as az,bM as b,No as c,ga as d,ut as e,Q as f,Ko as g,Kc as h,ad as i,Wh as j,Qc as k,zh as l,_y as m,Po as n,qh as o,qi as p,BM as q,Lt as r,ra as s,ie as t,KV as u,dj as v,Et as w,ZL as x,We as y,GV as z};
