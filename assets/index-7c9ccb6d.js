function A_(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function P_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var T0={exports:{}},fu={},C0={exports:{}},Oe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zo=Symbol.for("react.element"),R_=Symbol.for("react.portal"),j_=Symbol.for("react.fragment"),D_=Symbol.for("react.strict_mode"),M_=Symbol.for("react.profiler"),L_=Symbol.for("react.provider"),O_=Symbol.for("react.context"),V_=Symbol.for("react.forward_ref"),F_=Symbol.for("react.suspense"),$_=Symbol.for("react.memo"),U_=Symbol.for("react.lazy"),Up=Symbol.iterator;function B_(t){return t===null||typeof t!="object"?null:(t=Up&&t[Up]||t["@@iterator"],typeof t=="function"?t:null)}var S0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N0=Object.assign,k0={};function Ea(t,e,n){this.props=t,this.context=e,this.refs=k0,this.updater=n||S0}Ea.prototype.isReactComponent={};Ea.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ea.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function I0(){}I0.prototype=Ea.prototype;function dm(t,e,n){this.props=t,this.context=e,this.refs=k0,this.updater=n||S0}var hm=dm.prototype=new I0;hm.constructor=dm;N0(hm,Ea.prototype);hm.isPureReactComponent=!0;var Bp=Array.isArray,A0=Object.prototype.hasOwnProperty,mm={current:null},P0={key:!0,ref:!0,__self:!0,__source:!0};function R0(t,e,n){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)A0.call(e,r)&&!P0.hasOwnProperty(r)&&(s[r]=e[r]);var c=arguments.length-2;if(c===1)s.children=n;else if(1<c){for(var u=Array(c),d=0;d<c;d++)u[d]=arguments[d+2];s.children=u}if(t&&t.defaultProps)for(r in c=t.defaultProps,c)s[r]===void 0&&(s[r]=c[r]);return{$$typeof:Zo,type:t,key:i,ref:a,props:s,_owner:mm.current}}function z_(t,e){return{$$typeof:Zo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function fm(t){return typeof t=="object"&&t!==null&&t.$$typeof===Zo}function W_(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var zp=/\/+/g;function sd(t,e){return typeof t=="object"&&t!==null&&t.key!=null?W_(""+t.key):e.toString(36)}function tc(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Zo:case R_:a=!0}}if(a)return a=t,s=s(a),t=r===""?"."+sd(a,0):r,Bp(s)?(n="",t!=null&&(n=t.replace(zp,"$&/")+"/"),tc(s,e,n,"",function(d){return d})):s!=null&&(fm(s)&&(s=z_(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(zp,"$&/")+"/")+t)),e.push(s)),1;if(a=0,r=r===""?".":r+":",Bp(t))for(var c=0;c<t.length;c++){i=t[c];var u=r+sd(i,c);a+=tc(i,e,n,u,s)}else if(u=B_(t),typeof u=="function")for(t=u.call(t),c=0;!(i=t.next()).done;)i=i.value,u=r+sd(i,c++),a+=tc(i,e,n,u,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Rl(t,e,n){if(t==null)return t;var r=[],s=0;return tc(t,r,"","",function(i){return e.call(n,i,s++)}),r}function H_(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var _n={current:null},nc={transition:null},q_={ReactCurrentDispatcher:_n,ReactCurrentBatchConfig:nc,ReactCurrentOwner:mm};function j0(){throw Error("act(...) is not supported in production builds of React.")}Oe.Children={map:Rl,forEach:function(t,e,n){Rl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Rl(t,function(){e++}),e},toArray:function(t){return Rl(t,function(e){return e})||[]},only:function(t){if(!fm(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Oe.Component=Ea;Oe.Fragment=j_;Oe.Profiler=M_;Oe.PureComponent=dm;Oe.StrictMode=D_;Oe.Suspense=F_;Oe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=q_;Oe.act=j0;Oe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=N0({},t.props),s=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=mm.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(u in e)A0.call(e,u)&&!P0.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&c!==void 0?c[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];r.children=c}return{$$typeof:Zo,type:t.type,key:s,ref:i,props:r,_owner:a}};Oe.createContext=function(t){return t={$$typeof:O_,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:L_,_context:t},t.Consumer=t};Oe.createElement=R0;Oe.createFactory=function(t){var e=R0.bind(null,t);return e.type=t,e};Oe.createRef=function(){return{current:null}};Oe.forwardRef=function(t){return{$$typeof:V_,render:t}};Oe.isValidElement=fm;Oe.lazy=function(t){return{$$typeof:U_,_payload:{_status:-1,_result:t},_init:H_}};Oe.memo=function(t,e){return{$$typeof:$_,type:t,compare:e===void 0?null:e}};Oe.startTransition=function(t){var e=nc.transition;nc.transition={};try{t()}finally{nc.transition=e}};Oe.unstable_act=j0;Oe.useCallback=function(t,e){return _n.current.useCallback(t,e)};Oe.useContext=function(t){return _n.current.useContext(t)};Oe.useDebugValue=function(){};Oe.useDeferredValue=function(t){return _n.current.useDeferredValue(t)};Oe.useEffect=function(t,e){return _n.current.useEffect(t,e)};Oe.useId=function(){return _n.current.useId()};Oe.useImperativeHandle=function(t,e,n){return _n.current.useImperativeHandle(t,e,n)};Oe.useInsertionEffect=function(t,e){return _n.current.useInsertionEffect(t,e)};Oe.useLayoutEffect=function(t,e){return _n.current.useLayoutEffect(t,e)};Oe.useMemo=function(t,e){return _n.current.useMemo(t,e)};Oe.useReducer=function(t,e,n){return _n.current.useReducer(t,e,n)};Oe.useRef=function(t){return _n.current.useRef(t)};Oe.useState=function(t){return _n.current.useState(t)};Oe.useSyncExternalStore=function(t,e,n){return _n.current.useSyncExternalStore(t,e,n)};Oe.useTransition=function(){return _n.current.useTransition()};Oe.version="18.3.1";C0.exports=Oe;var P=C0.exports;const D0=P_(P),G_=A_({__proto__:null,default:D0},[P]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K_=P,Q_=Symbol.for("react.element"),Y_=Symbol.for("react.fragment"),J_=Object.prototype.hasOwnProperty,X_=K_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Z_={key:!0,ref:!0,__self:!0,__source:!0};function M0(t,e,n){var r,s={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)J_.call(e,r)&&!Z_.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:Q_,type:t,key:i,ref:a,props:s,_owner:X_.current}}fu.Fragment=Y_;fu.jsx=M0;fu.jsxs=M0;T0.exports=fu;var o=T0.exports,Wd={},L0={exports:{}},Bn={},O0={exports:{}},V0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(G,ie){var pe=G.length;G.push(ie);e:for(;0<pe;){var J=pe-1>>>1,B=G[J];if(0<s(B,ie))G[J]=ie,G[pe]=B,pe=J;else break e}}function n(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var ie=G[0],pe=G.pop();if(pe!==ie){G[0]=pe;e:for(var J=0,B=G.length,X=B>>>1;J<X;){var ce=2*(J+1)-1,je=G[ce],de=ce+1,le=G[de];if(0>s(je,pe))de<B&&0>s(le,je)?(G[J]=le,G[de]=pe,J=de):(G[J]=je,G[ce]=pe,J=ce);else if(de<B&&0>s(le,pe))G[J]=le,G[de]=pe,J=de;else break e}}return ie}function s(G,ie){var pe=G.sortIndex-ie.sortIndex;return pe!==0?pe:G.id-ie.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,c=a.now();t.unstable_now=function(){return a.now()-c}}var u=[],d=[],h=1,f=null,g=3,x=!1,S=!1,y=!1,k=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function I(G){for(var ie=n(d);ie!==null;){if(ie.callback===null)r(d);else if(ie.startTime<=G)r(d),ie.sortIndex=ie.expirationTime,e(u,ie);else break;ie=n(d)}}function j(G){if(y=!1,I(G),!S)if(n(u)!==null)S=!0,Re($);else{var ie=n(d);ie!==null&&Te(j,ie.startTime-G)}}function $(G,ie){S=!1,y&&(y=!1,b(_),_=-1),x=!0;var pe=g;try{for(I(ie),f=n(u);f!==null&&(!(f.expirationTime>ie)||G&&!D());){var J=f.callback;if(typeof J=="function"){f.callback=null,g=f.priorityLevel;var B=J(f.expirationTime<=ie);ie=t.unstable_now(),typeof B=="function"?f.callback=B:f===n(u)&&r(u),I(ie)}else r(u);f=n(u)}if(f!==null)var X=!0;else{var ce=n(d);ce!==null&&Te(j,ce.startTime-ie),X=!1}return X}finally{f=null,g=pe,x=!1}}var H=!1,E=null,_=-1,C=5,A=-1;function D(){return!(t.unstable_now()-A<C)}function N(){if(E!==null){var G=t.unstable_now();A=G;var ie=!0;try{ie=E(!0,G)}finally{ie?T():(H=!1,E=null)}}else H=!1}var T;if(typeof w=="function")T=function(){w(N)};else if(typeof MessageChannel<"u"){var Me=new MessageChannel,Pe=Me.port2;Me.port1.onmessage=N,T=function(){Pe.postMessage(null)}}else T=function(){k(N,0)};function Re(G){E=G,H||(H=!0,T())}function Te(G,ie){_=k(function(){G(t.unstable_now())},ie)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(G){G.callback=null},t.unstable_continueExecution=function(){S||x||(S=!0,Re($))},t.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<G?Math.floor(1e3/G):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(G){switch(g){case 1:case 2:case 3:var ie=3;break;default:ie=g}var pe=g;g=ie;try{return G()}finally{g=pe}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(G,ie){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var pe=g;g=G;try{return ie()}finally{g=pe}},t.unstable_scheduleCallback=function(G,ie,pe){var J=t.unstable_now();switch(typeof pe=="object"&&pe!==null?(pe=pe.delay,pe=typeof pe=="number"&&0<pe?J+pe:J):pe=J,G){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=pe+B,G={id:h++,callback:ie,priorityLevel:G,startTime:pe,expirationTime:B,sortIndex:-1},pe>J?(G.sortIndex=pe,e(d,G),n(u)===null&&G===n(d)&&(y?(b(_),_=-1):y=!0,Te(j,pe-J))):(G.sortIndex=B,e(u,G),S||x||(S=!0,Re($))),G},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(G){var ie=g;return function(){var pe=g;g=ie;try{return G.apply(this,arguments)}finally{g=pe}}}})(V0);O0.exports=V0;var eE=O0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tE=P,Un=eE;function Y(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var F0=new Set,Eo={};function Ci(t,e){la(t,e),la(t+"Capture",e)}function la(t,e){for(Eo[t]=e,t=0;t<e.length;t++)F0.add(e[t])}var Wr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Hd=Object.prototype.hasOwnProperty,nE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Wp={},Hp={};function rE(t){return Hd.call(Hp,t)?!0:Hd.call(Wp,t)?!1:nE.test(t)?Hp[t]=!0:(Wp[t]=!0,!1)}function sE(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function iE(t,e,n,r){if(e===null||typeof e>"u"||sE(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function En(t,e,n,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var Kt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Kt[t]=new En(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Kt[e]=new En(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Kt[t]=new En(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Kt[t]=new En(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Kt[t]=new En(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Kt[t]=new En(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Kt[t]=new En(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Kt[t]=new En(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Kt[t]=new En(t,5,!1,t.toLowerCase(),null,!1,!1)});var pm=/[\-:]([a-z])/g;function gm(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(pm,gm);Kt[e]=new En(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(pm,gm);Kt[e]=new En(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(pm,gm);Kt[e]=new En(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Kt[t]=new En(t,1,!1,t.toLowerCase(),null,!1,!1)});Kt.xlinkHref=new En("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Kt[t]=new En(t,1,!1,t.toLowerCase(),null,!0,!0)});function ym(t,e,n,r){var s=Kt.hasOwnProperty(e)?Kt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(iE(e,n,s,r)&&(n=null),r||s===null?rE(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Zr=tE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,jl=Symbol.for("react.element"),Fi=Symbol.for("react.portal"),$i=Symbol.for("react.fragment"),vm=Symbol.for("react.strict_mode"),qd=Symbol.for("react.profiler"),$0=Symbol.for("react.provider"),U0=Symbol.for("react.context"),xm=Symbol.for("react.forward_ref"),Gd=Symbol.for("react.suspense"),Kd=Symbol.for("react.suspense_list"),wm=Symbol.for("react.memo"),ps=Symbol.for("react.lazy"),B0=Symbol.for("react.offscreen"),qp=Symbol.iterator;function za(t){return t===null||typeof t!="object"?null:(t=qp&&t[qp]||t["@@iterator"],typeof t=="function"?t:null)}var pt=Object.assign,id;function Xa(t){if(id===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);id=e&&e[1]||""}return`
`+id+t}var ad=!1;function od(t,e){if(!t||ad)return"";ad=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,c=i.length-1;1<=a&&0<=c&&s[a]!==i[c];)c--;for(;1<=a&&0<=c;a--,c--)if(s[a]!==i[c]){if(a!==1||c!==1)do if(a--,c--,0>c||s[a]!==i[c]){var u=`
`+s[a].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=a&&0<=c);break}}}finally{ad=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Xa(t):""}function aE(t){switch(t.tag){case 5:return Xa(t.type);case 16:return Xa("Lazy");case 13:return Xa("Suspense");case 19:return Xa("SuspenseList");case 0:case 2:case 15:return t=od(t.type,!1),t;case 11:return t=od(t.type.render,!1),t;case 1:return t=od(t.type,!0),t;default:return""}}function Qd(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case $i:return"Fragment";case Fi:return"Portal";case qd:return"Profiler";case vm:return"StrictMode";case Gd:return"Suspense";case Kd:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case U0:return(t.displayName||"Context")+".Consumer";case $0:return(t._context.displayName||"Context")+".Provider";case xm:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case wm:return e=t.displayName||null,e!==null?e:Qd(t.type)||"Memo";case ps:e=t._payload,t=t._init;try{return Qd(t(e))}catch{}}return null}function oE(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qd(e);case 8:return e===vm?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function $s(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function z0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function lE(t){var e=z0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Dl(t){t._valueTracker||(t._valueTracker=lE(t))}function W0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=z0(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Tc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Yd(t,e){var n=e.checked;return pt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Gp(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=$s(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function H0(t,e){e=e.checked,e!=null&&ym(t,"checked",e,!1)}function Jd(t,e){H0(t,e);var n=$s(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Xd(t,e.type,n):e.hasOwnProperty("defaultValue")&&Xd(t,e.type,$s(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Kp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Xd(t,e,n){(e!=="number"||Tc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Za=Array.isArray;function Xi(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+$s(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Zd(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Y(91));return pt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Qp(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Y(92));if(Za(n)){if(1<n.length)throw Error(Y(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:$s(n)}}function q0(t,e){var n=$s(e.value),r=$s(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Yp(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function G0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function eh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?G0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ml,K0=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ml=Ml||document.createElement("div"),Ml.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ml.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function To(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var lo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},cE=["Webkit","ms","Moz","O"];Object.keys(lo).forEach(function(t){cE.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),lo[e]=lo[t]})});function Q0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||lo.hasOwnProperty(t)&&lo[t]?(""+e).trim():e+"px"}function Y0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Q0(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var uE=pt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function th(t,e){if(e){if(uE[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Y(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Y(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Y(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Y(62))}}function nh(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rh=null;function bm(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var sh=null,Zi=null,ea=null;function Jp(t){if(t=nl(t)){if(typeof sh!="function")throw Error(Y(280));var e=t.stateNode;e&&(e=xu(e),sh(t.stateNode,t.type,e))}}function J0(t){Zi?ea?ea.push(t):ea=[t]:Zi=t}function X0(){if(Zi){var t=Zi,e=ea;if(ea=Zi=null,Jp(t),e)for(t=0;t<e.length;t++)Jp(e[t])}}function Z0(t,e){return t(e)}function ev(){}var ld=!1;function tv(t,e,n){if(ld)return t(e,n);ld=!0;try{return Z0(t,e,n)}finally{ld=!1,(Zi!==null||ea!==null)&&(ev(),X0())}}function Co(t,e){var n=t.stateNode;if(n===null)return null;var r=xu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Y(231,e,typeof n));return n}var ih=!1;if(Wr)try{var Wa={};Object.defineProperty(Wa,"passive",{get:function(){ih=!0}}),window.addEventListener("test",Wa,Wa),window.removeEventListener("test",Wa,Wa)}catch{ih=!1}function dE(t,e,n,r,s,i,a,c,u){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(h){this.onError(h)}}var co=!1,Cc=null,Sc=!1,ah=null,hE={onError:function(t){co=!0,Cc=t}};function mE(t,e,n,r,s,i,a,c,u){co=!1,Cc=null,dE.apply(hE,arguments)}function fE(t,e,n,r,s,i,a,c,u){if(mE.apply(this,arguments),co){if(co){var d=Cc;co=!1,Cc=null}else throw Error(Y(198));Sc||(Sc=!0,ah=d)}}function Si(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function nv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Xp(t){if(Si(t)!==t)throw Error(Y(188))}function pE(t){var e=t.alternate;if(!e){if(e=Si(t),e===null)throw Error(Y(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Xp(s),t;if(i===r)return Xp(s),e;i=i.sibling}throw Error(Y(188))}if(n.return!==r.return)n=s,r=i;else{for(var a=!1,c=s.child;c;){if(c===n){a=!0,n=s,r=i;break}if(c===r){a=!0,r=s,n=i;break}c=c.sibling}if(!a){for(c=i.child;c;){if(c===n){a=!0,n=i,r=s;break}if(c===r){a=!0,r=i,n=s;break}c=c.sibling}if(!a)throw Error(Y(189))}}if(n.alternate!==r)throw Error(Y(190))}if(n.tag!==3)throw Error(Y(188));return n.stateNode.current===n?t:e}function rv(t){return t=pE(t),t!==null?sv(t):null}function sv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=sv(t);if(e!==null)return e;t=t.sibling}return null}var iv=Un.unstable_scheduleCallback,Zp=Un.unstable_cancelCallback,gE=Un.unstable_shouldYield,yE=Un.unstable_requestPaint,Et=Un.unstable_now,vE=Un.unstable_getCurrentPriorityLevel,_m=Un.unstable_ImmediatePriority,av=Un.unstable_UserBlockingPriority,Nc=Un.unstable_NormalPriority,xE=Un.unstable_LowPriority,ov=Un.unstable_IdlePriority,pu=null,_r=null;function wE(t){if(_r&&typeof _r.onCommitFiberRoot=="function")try{_r.onCommitFiberRoot(pu,t,void 0,(t.current.flags&128)===128)}catch{}}var lr=Math.clz32?Math.clz32:EE,bE=Math.log,_E=Math.LN2;function EE(t){return t>>>=0,t===0?32:31-(bE(t)/_E|0)|0}var Ll=64,Ol=4194304;function eo(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function kc(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var c=a&~s;c!==0?r=eo(c):(i&=a,i!==0&&(r=eo(i)))}else a=n&~s,a!==0?r=eo(a):i!==0&&(r=eo(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-lr(e),s=1<<n,r|=t[n],e&=~s;return r}function TE(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function CE(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-lr(i),c=1<<a,u=s[a];u===-1?(!(c&n)||c&r)&&(s[a]=TE(c,e)):u<=e&&(t.expiredLanes|=c),i&=~c}}function oh(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function lv(){var t=Ll;return Ll<<=1,!(Ll&4194240)&&(Ll=64),t}function cd(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function el(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-lr(e),t[e]=n}function SE(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-lr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Em(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-lr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Qe=0;function cv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var uv,Tm,dv,hv,mv,lh=!1,Vl=[],Ns=null,ks=null,Is=null,So=new Map,No=new Map,ys=[],NE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function eg(t,e){switch(t){case"focusin":case"focusout":Ns=null;break;case"dragenter":case"dragleave":ks=null;break;case"mouseover":case"mouseout":Is=null;break;case"pointerover":case"pointerout":So.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":No.delete(e.pointerId)}}function Ha(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=nl(e),e!==null&&Tm(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function kE(t,e,n,r,s){switch(e){case"focusin":return Ns=Ha(Ns,t,e,n,r,s),!0;case"dragenter":return ks=Ha(ks,t,e,n,r,s),!0;case"mouseover":return Is=Ha(Is,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return So.set(i,Ha(So.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,No.set(i,Ha(No.get(i)||null,t,e,n,r,s)),!0}return!1}function fv(t){var e=oi(t.target);if(e!==null){var n=Si(e);if(n!==null){if(e=n.tag,e===13){if(e=nv(n),e!==null){t.blockedOn=e,mv(t.priority,function(){dv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function rc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=ch(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);rh=r,n.target.dispatchEvent(r),rh=null}else return e=nl(n),e!==null&&Tm(e),t.blockedOn=n,!1;e.shift()}return!0}function tg(t,e,n){rc(t)&&n.delete(e)}function IE(){lh=!1,Ns!==null&&rc(Ns)&&(Ns=null),ks!==null&&rc(ks)&&(ks=null),Is!==null&&rc(Is)&&(Is=null),So.forEach(tg),No.forEach(tg)}function qa(t,e){t.blockedOn===e&&(t.blockedOn=null,lh||(lh=!0,Un.unstable_scheduleCallback(Un.unstable_NormalPriority,IE)))}function ko(t){function e(s){return qa(s,t)}if(0<Vl.length){qa(Vl[0],t);for(var n=1;n<Vl.length;n++){var r=Vl[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Ns!==null&&qa(Ns,t),ks!==null&&qa(ks,t),Is!==null&&qa(Is,t),So.forEach(e),No.forEach(e),n=0;n<ys.length;n++)r=ys[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<ys.length&&(n=ys[0],n.blockedOn===null);)fv(n),n.blockedOn===null&&ys.shift()}var ta=Zr.ReactCurrentBatchConfig,Ic=!0;function AE(t,e,n,r){var s=Qe,i=ta.transition;ta.transition=null;try{Qe=1,Cm(t,e,n,r)}finally{Qe=s,ta.transition=i}}function PE(t,e,n,r){var s=Qe,i=ta.transition;ta.transition=null;try{Qe=4,Cm(t,e,n,r)}finally{Qe=s,ta.transition=i}}function Cm(t,e,n,r){if(Ic){var s=ch(t,e,n,r);if(s===null)xd(t,e,r,Ac,n),eg(t,r);else if(kE(s,t,e,n,r))r.stopPropagation();else if(eg(t,r),e&4&&-1<NE.indexOf(t)){for(;s!==null;){var i=nl(s);if(i!==null&&uv(i),i=ch(t,e,n,r),i===null&&xd(t,e,r,Ac,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else xd(t,e,r,null,n)}}var Ac=null;function ch(t,e,n,r){if(Ac=null,t=bm(r),t=oi(t),t!==null)if(e=Si(t),e===null)t=null;else if(n=e.tag,n===13){if(t=nv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ac=t,null}function pv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(vE()){case _m:return 1;case av:return 4;case Nc:case xE:return 16;case ov:return 536870912;default:return 16}default:return 16}}var Es=null,Sm=null,sc=null;function gv(){if(sc)return sc;var t,e=Sm,n=e.length,r,s="value"in Es?Es.value:Es.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===s[i-r];r++);return sc=s.slice(t,1<r?1-r:void 0)}function ic(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Fl(){return!0}function ng(){return!1}function zn(t){function e(n,r,s,i,a){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var c in t)t.hasOwnProperty(c)&&(n=t[c],this[c]=n?n(i):i[c]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Fl:ng,this.isPropagationStopped=ng,this}return pt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Fl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Fl)},persist:function(){},isPersistent:Fl}),e}var Ta={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Nm=zn(Ta),tl=pt({},Ta,{view:0,detail:0}),RE=zn(tl),ud,dd,Ga,gu=pt({},tl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:km,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ga&&(Ga&&t.type==="mousemove"?(ud=t.screenX-Ga.screenX,dd=t.screenY-Ga.screenY):dd=ud=0,Ga=t),ud)},movementY:function(t){return"movementY"in t?t.movementY:dd}}),rg=zn(gu),jE=pt({},gu,{dataTransfer:0}),DE=zn(jE),ME=pt({},tl,{relatedTarget:0}),hd=zn(ME),LE=pt({},Ta,{animationName:0,elapsedTime:0,pseudoElement:0}),OE=zn(LE),VE=pt({},Ta,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),FE=zn(VE),$E=pt({},Ta,{data:0}),sg=zn($E),UE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},BE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function WE(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=zE[t])?!!e[t]:!1}function km(){return WE}var HE=pt({},tl,{key:function(t){if(t.key){var e=UE[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ic(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?BE[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:km,charCode:function(t){return t.type==="keypress"?ic(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ic(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),qE=zn(HE),GE=pt({},gu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ig=zn(GE),KE=pt({},tl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:km}),QE=zn(KE),YE=pt({},Ta,{propertyName:0,elapsedTime:0,pseudoElement:0}),JE=zn(YE),XE=pt({},gu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),ZE=zn(XE),eT=[9,13,27,32],Im=Wr&&"CompositionEvent"in window,uo=null;Wr&&"documentMode"in document&&(uo=document.documentMode);var tT=Wr&&"TextEvent"in window&&!uo,yv=Wr&&(!Im||uo&&8<uo&&11>=uo),ag=String.fromCharCode(32),og=!1;function vv(t,e){switch(t){case"keyup":return eT.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ui=!1;function nT(t,e){switch(t){case"compositionend":return xv(e);case"keypress":return e.which!==32?null:(og=!0,ag);case"textInput":return t=e.data,t===ag&&og?null:t;default:return null}}function rT(t,e){if(Ui)return t==="compositionend"||!Im&&vv(t,e)?(t=gv(),sc=Sm=Es=null,Ui=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return yv&&e.locale!=="ko"?null:e.data;default:return null}}var sT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function lg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!sT[t.type]:e==="textarea"}function wv(t,e,n,r){J0(r),e=Pc(e,"onChange"),0<e.length&&(n=new Nm("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var ho=null,Io=null;function iT(t){Pv(t,0)}function yu(t){var e=Wi(t);if(W0(e))return t}function aT(t,e){if(t==="change")return e}var bv=!1;if(Wr){var md;if(Wr){var fd="oninput"in document;if(!fd){var cg=document.createElement("div");cg.setAttribute("oninput","return;"),fd=typeof cg.oninput=="function"}md=fd}else md=!1;bv=md&&(!document.documentMode||9<document.documentMode)}function ug(){ho&&(ho.detachEvent("onpropertychange",_v),Io=ho=null)}function _v(t){if(t.propertyName==="value"&&yu(Io)){var e=[];wv(e,Io,t,bm(t)),tv(iT,e)}}function oT(t,e,n){t==="focusin"?(ug(),ho=e,Io=n,ho.attachEvent("onpropertychange",_v)):t==="focusout"&&ug()}function lT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return yu(Io)}function cT(t,e){if(t==="click")return yu(e)}function uT(t,e){if(t==="input"||t==="change")return yu(e)}function dT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var dr=typeof Object.is=="function"?Object.is:dT;function Ao(t,e){if(dr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Hd.call(e,s)||!dr(t[s],e[s]))return!1}return!0}function dg(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function hg(t,e){var n=dg(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=dg(n)}}function Ev(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Ev(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Tv(){for(var t=window,e=Tc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Tc(t.document)}return e}function Am(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function hT(t){var e=Tv(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Ev(n.ownerDocument.documentElement,n)){if(r!==null&&Am(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=hg(n,i);var a=hg(n,r);s&&a&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var mT=Wr&&"documentMode"in document&&11>=document.documentMode,Bi=null,uh=null,mo=null,dh=!1;function mg(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;dh||Bi==null||Bi!==Tc(r)||(r=Bi,"selectionStart"in r&&Am(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),mo&&Ao(mo,r)||(mo=r,r=Pc(uh,"onSelect"),0<r.length&&(e=new Nm("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Bi)))}function $l(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var zi={animationend:$l("Animation","AnimationEnd"),animationiteration:$l("Animation","AnimationIteration"),animationstart:$l("Animation","AnimationStart"),transitionend:$l("Transition","TransitionEnd")},pd={},Cv={};Wr&&(Cv=document.createElement("div").style,"AnimationEvent"in window||(delete zi.animationend.animation,delete zi.animationiteration.animation,delete zi.animationstart.animation),"TransitionEvent"in window||delete zi.transitionend.transition);function vu(t){if(pd[t])return pd[t];if(!zi[t])return t;var e=zi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Cv)return pd[t]=e[n];return t}var Sv=vu("animationend"),Nv=vu("animationiteration"),kv=vu("animationstart"),Iv=vu("transitionend"),Av=new Map,fg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function qs(t,e){Av.set(t,e),Ci(e,[t])}for(var gd=0;gd<fg.length;gd++){var yd=fg[gd],fT=yd.toLowerCase(),pT=yd[0].toUpperCase()+yd.slice(1);qs(fT,"on"+pT)}qs(Sv,"onAnimationEnd");qs(Nv,"onAnimationIteration");qs(kv,"onAnimationStart");qs("dblclick","onDoubleClick");qs("focusin","onFocus");qs("focusout","onBlur");qs(Iv,"onTransitionEnd");la("onMouseEnter",["mouseout","mouseover"]);la("onMouseLeave",["mouseout","mouseover"]);la("onPointerEnter",["pointerout","pointerover"]);la("onPointerLeave",["pointerout","pointerover"]);Ci("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ci("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ci("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ci("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ci("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ci("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var to="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),gT=new Set("cancel close invalid load scroll toggle".split(" ").concat(to));function pg(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,fE(r,e,void 0,t),t.currentTarget=null}function Pv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var c=r[a],u=c.instance,d=c.currentTarget;if(c=c.listener,u!==i&&s.isPropagationStopped())break e;pg(s,c,d),i=u}else for(a=0;a<r.length;a++){if(c=r[a],u=c.instance,d=c.currentTarget,c=c.listener,u!==i&&s.isPropagationStopped())break e;pg(s,c,d),i=u}}}if(Sc)throw t=ah,Sc=!1,ah=null,t}function st(t,e){var n=e[gh];n===void 0&&(n=e[gh]=new Set);var r=t+"__bubble";n.has(r)||(Rv(e,t,2,!1),n.add(r))}function vd(t,e,n){var r=0;e&&(r|=4),Rv(n,t,r,e)}var Ul="_reactListening"+Math.random().toString(36).slice(2);function Po(t){if(!t[Ul]){t[Ul]=!0,F0.forEach(function(n){n!=="selectionchange"&&(gT.has(n)||vd(n,!1,t),vd(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Ul]||(e[Ul]=!0,vd("selectionchange",!1,e))}}function Rv(t,e,n,r){switch(pv(e)){case 1:var s=AE;break;case 4:s=PE;break;default:s=Cm}n=s.bind(null,e,n,t),s=void 0,!ih||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function xd(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var c=r.stateNode.containerInfo;if(c===s||c.nodeType===8&&c.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===s||u.nodeType===8&&u.parentNode===s))return;a=a.return}for(;c!==null;){if(a=oi(c),a===null)return;if(u=a.tag,u===5||u===6){r=i=a;continue e}c=c.parentNode}}r=r.return}tv(function(){var d=i,h=bm(n),f=[];e:{var g=Av.get(t);if(g!==void 0){var x=Nm,S=t;switch(t){case"keypress":if(ic(n)===0)break e;case"keydown":case"keyup":x=qE;break;case"focusin":S="focus",x=hd;break;case"focusout":S="blur",x=hd;break;case"beforeblur":case"afterblur":x=hd;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=rg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=DE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=QE;break;case Sv:case Nv:case kv:x=OE;break;case Iv:x=JE;break;case"scroll":x=RE;break;case"wheel":x=ZE;break;case"copy":case"cut":case"paste":x=FE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=ig}var y=(e&4)!==0,k=!y&&t==="scroll",b=y?g!==null?g+"Capture":null:g;y=[];for(var w=d,I;w!==null;){I=w;var j=I.stateNode;if(I.tag===5&&j!==null&&(I=j,b!==null&&(j=Co(w,b),j!=null&&y.push(Ro(w,j,I)))),k)break;w=w.return}0<y.length&&(g=new x(g,S,null,n,h),f.push({event:g,listeners:y}))}}if(!(e&7)){e:{if(g=t==="mouseover"||t==="pointerover",x=t==="mouseout"||t==="pointerout",g&&n!==rh&&(S=n.relatedTarget||n.fromElement)&&(oi(S)||S[Hr]))break e;if((x||g)&&(g=h.window===h?h:(g=h.ownerDocument)?g.defaultView||g.parentWindow:window,x?(S=n.relatedTarget||n.toElement,x=d,S=S?oi(S):null,S!==null&&(k=Si(S),S!==k||S.tag!==5&&S.tag!==6)&&(S=null)):(x=null,S=d),x!==S)){if(y=rg,j="onMouseLeave",b="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(y=ig,j="onPointerLeave",b="onPointerEnter",w="pointer"),k=x==null?g:Wi(x),I=S==null?g:Wi(S),g=new y(j,w+"leave",x,n,h),g.target=k,g.relatedTarget=I,j=null,oi(h)===d&&(y=new y(b,w+"enter",S,n,h),y.target=I,y.relatedTarget=k,j=y),k=j,x&&S)t:{for(y=x,b=S,w=0,I=y;I;I=Di(I))w++;for(I=0,j=b;j;j=Di(j))I++;for(;0<w-I;)y=Di(y),w--;for(;0<I-w;)b=Di(b),I--;for(;w--;){if(y===b||b!==null&&y===b.alternate)break t;y=Di(y),b=Di(b)}y=null}else y=null;x!==null&&gg(f,g,x,y,!1),S!==null&&k!==null&&gg(f,k,S,y,!0)}}e:{if(g=d?Wi(d):window,x=g.nodeName&&g.nodeName.toLowerCase(),x==="select"||x==="input"&&g.type==="file")var $=aT;else if(lg(g))if(bv)$=uT;else{$=lT;var H=oT}else(x=g.nodeName)&&x.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&($=cT);if($&&($=$(t,d))){wv(f,$,n,h);break e}H&&H(t,g,d),t==="focusout"&&(H=g._wrapperState)&&H.controlled&&g.type==="number"&&Xd(g,"number",g.value)}switch(H=d?Wi(d):window,t){case"focusin":(lg(H)||H.contentEditable==="true")&&(Bi=H,uh=d,mo=null);break;case"focusout":mo=uh=Bi=null;break;case"mousedown":dh=!0;break;case"contextmenu":case"mouseup":case"dragend":dh=!1,mg(f,n,h);break;case"selectionchange":if(mT)break;case"keydown":case"keyup":mg(f,n,h)}var E;if(Im)e:{switch(t){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Ui?vv(t,n)&&(_="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(_="onCompositionStart");_&&(yv&&n.locale!=="ko"&&(Ui||_!=="onCompositionStart"?_==="onCompositionEnd"&&Ui&&(E=gv()):(Es=h,Sm="value"in Es?Es.value:Es.textContent,Ui=!0)),H=Pc(d,_),0<H.length&&(_=new sg(_,t,null,n,h),f.push({event:_,listeners:H}),E?_.data=E:(E=xv(n),E!==null&&(_.data=E)))),(E=tT?nT(t,n):rT(t,n))&&(d=Pc(d,"onBeforeInput"),0<d.length&&(h=new sg("onBeforeInput","beforeinput",null,n,h),f.push({event:h,listeners:d}),h.data=E))}Pv(f,e)})}function Ro(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Pc(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Co(t,n),i!=null&&r.unshift(Ro(t,i,s)),i=Co(t,e),i!=null&&r.push(Ro(t,i,s))),t=t.return}return r}function Di(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function gg(t,e,n,r,s){for(var i=e._reactName,a=[];n!==null&&n!==r;){var c=n,u=c.alternate,d=c.stateNode;if(u!==null&&u===r)break;c.tag===5&&d!==null&&(c=d,s?(u=Co(n,i),u!=null&&a.unshift(Ro(n,u,c))):s||(u=Co(n,i),u!=null&&a.push(Ro(n,u,c)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var yT=/\r\n?/g,vT=/\u0000|\uFFFD/g;function yg(t){return(typeof t=="string"?t:""+t).replace(yT,`
`).replace(vT,"")}function Bl(t,e,n){if(e=yg(e),yg(t)!==e&&n)throw Error(Y(425))}function Rc(){}var hh=null,mh=null;function fh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var ph=typeof setTimeout=="function"?setTimeout:void 0,xT=typeof clearTimeout=="function"?clearTimeout:void 0,vg=typeof Promise=="function"?Promise:void 0,wT=typeof queueMicrotask=="function"?queueMicrotask:typeof vg<"u"?function(t){return vg.resolve(null).then(t).catch(bT)}:ph;function bT(t){setTimeout(function(){throw t})}function wd(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),ko(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);ko(e)}function As(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function xg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ca=Math.random().toString(36).slice(2),wr="__reactFiber$"+Ca,jo="__reactProps$"+Ca,Hr="__reactContainer$"+Ca,gh="__reactEvents$"+Ca,_T="__reactListeners$"+Ca,ET="__reactHandles$"+Ca;function oi(t){var e=t[wr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Hr]||n[wr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=xg(t);t!==null;){if(n=t[wr])return n;t=xg(t)}return e}t=n,n=t.parentNode}return null}function nl(t){return t=t[wr]||t[Hr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Wi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Y(33))}function xu(t){return t[jo]||null}var yh=[],Hi=-1;function Gs(t){return{current:t}}function at(t){0>Hi||(t.current=yh[Hi],yh[Hi]=null,Hi--)}function nt(t,e){Hi++,yh[Hi]=t.current,t.current=e}var Us={},un=Gs(Us),In=Gs(!1),fi=Us;function ca(t,e){var n=t.type.contextTypes;if(!n)return Us;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function An(t){return t=t.childContextTypes,t!=null}function jc(){at(In),at(un)}function wg(t,e,n){if(un.current!==Us)throw Error(Y(168));nt(un,e),nt(In,n)}function jv(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Y(108,oE(t)||"Unknown",s));return pt({},n,r)}function Dc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Us,fi=un.current,nt(un,t),nt(In,In.current),!0}function bg(t,e,n){var r=t.stateNode;if(!r)throw Error(Y(169));n?(t=jv(t,e,fi),r.__reactInternalMemoizedMergedChildContext=t,at(In),at(un),nt(un,t)):at(In),nt(In,n)}var Dr=null,wu=!1,bd=!1;function Dv(t){Dr===null?Dr=[t]:Dr.push(t)}function TT(t){wu=!0,Dv(t)}function Ks(){if(!bd&&Dr!==null){bd=!0;var t=0,e=Qe;try{var n=Dr;for(Qe=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Dr=null,wu=!1}catch(s){throw Dr!==null&&(Dr=Dr.slice(t+1)),iv(_m,Ks),s}finally{Qe=e,bd=!1}}return null}var qi=[],Gi=0,Mc=null,Lc=0,qn=[],Gn=0,pi=null,Lr=1,Or="";function ri(t,e){qi[Gi++]=Lc,qi[Gi++]=Mc,Mc=t,Lc=e}function Mv(t,e,n){qn[Gn++]=Lr,qn[Gn++]=Or,qn[Gn++]=pi,pi=t;var r=Lr;t=Or;var s=32-lr(r)-1;r&=~(1<<s),n+=1;var i=32-lr(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,Lr=1<<32-lr(e)+s|n<<s|r,Or=i+t}else Lr=1<<i|n<<s|r,Or=t}function Pm(t){t.return!==null&&(ri(t,1),Mv(t,1,0))}function Rm(t){for(;t===Mc;)Mc=qi[--Gi],qi[Gi]=null,Lc=qi[--Gi],qi[Gi]=null;for(;t===pi;)pi=qn[--Gn],qn[Gn]=null,Or=qn[--Gn],qn[Gn]=null,Lr=qn[--Gn],qn[Gn]=null}var $n=null,Vn=null,dt=!1,or=null;function Lv(t,e){var n=Kn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function _g(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,$n=t,Vn=As(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,$n=t,Vn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=pi!==null?{id:Lr,overflow:Or}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Kn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,$n=t,Vn=null,!0):!1;default:return!1}}function vh(t){return(t.mode&1)!==0&&(t.flags&128)===0}function xh(t){if(dt){var e=Vn;if(e){var n=e;if(!_g(t,e)){if(vh(t))throw Error(Y(418));e=As(n.nextSibling);var r=$n;e&&_g(t,e)?Lv(r,n):(t.flags=t.flags&-4097|2,dt=!1,$n=t)}}else{if(vh(t))throw Error(Y(418));t.flags=t.flags&-4097|2,dt=!1,$n=t}}}function Eg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;$n=t}function zl(t){if(t!==$n)return!1;if(!dt)return Eg(t),dt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!fh(t.type,t.memoizedProps)),e&&(e=Vn)){if(vh(t))throw Ov(),Error(Y(418));for(;e;)Lv(t,e),e=As(e.nextSibling)}if(Eg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Y(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Vn=As(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Vn=null}}else Vn=$n?As(t.stateNode.nextSibling):null;return!0}function Ov(){for(var t=Vn;t;)t=As(t.nextSibling)}function ua(){Vn=$n=null,dt=!1}function jm(t){or===null?or=[t]:or.push(t)}var CT=Zr.ReactCurrentBatchConfig;function Ka(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Y(309));var r=n.stateNode}if(!r)throw Error(Y(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var c=s.refs;a===null?delete c[i]:c[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(Y(284));if(!n._owner)throw Error(Y(290,t))}return t}function Wl(t,e){throw t=Object.prototype.toString.call(e),Error(Y(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Tg(t){var e=t._init;return e(t._payload)}function Vv(t){function e(b,w){if(t){var I=b.deletions;I===null?(b.deletions=[w],b.flags|=16):I.push(w)}}function n(b,w){if(!t)return null;for(;w!==null;)e(b,w),w=w.sibling;return null}function r(b,w){for(b=new Map;w!==null;)w.key!==null?b.set(w.key,w):b.set(w.index,w),w=w.sibling;return b}function s(b,w){return b=Ds(b,w),b.index=0,b.sibling=null,b}function i(b,w,I){return b.index=I,t?(I=b.alternate,I!==null?(I=I.index,I<w?(b.flags|=2,w):I):(b.flags|=2,w)):(b.flags|=1048576,w)}function a(b){return t&&b.alternate===null&&(b.flags|=2),b}function c(b,w,I,j){return w===null||w.tag!==6?(w=kd(I,b.mode,j),w.return=b,w):(w=s(w,I),w.return=b,w)}function u(b,w,I,j){var $=I.type;return $===$i?h(b,w,I.props.children,j,I.key):w!==null&&(w.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===ps&&Tg($)===w.type)?(j=s(w,I.props),j.ref=Ka(b,w,I),j.return=b,j):(j=hc(I.type,I.key,I.props,null,b.mode,j),j.ref=Ka(b,w,I),j.return=b,j)}function d(b,w,I,j){return w===null||w.tag!==4||w.stateNode.containerInfo!==I.containerInfo||w.stateNode.implementation!==I.implementation?(w=Id(I,b.mode,j),w.return=b,w):(w=s(w,I.children||[]),w.return=b,w)}function h(b,w,I,j,$){return w===null||w.tag!==7?(w=hi(I,b.mode,j,$),w.return=b,w):(w=s(w,I),w.return=b,w)}function f(b,w,I){if(typeof w=="string"&&w!==""||typeof w=="number")return w=kd(""+w,b.mode,I),w.return=b,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case jl:return I=hc(w.type,w.key,w.props,null,b.mode,I),I.ref=Ka(b,null,w),I.return=b,I;case Fi:return w=Id(w,b.mode,I),w.return=b,w;case ps:var j=w._init;return f(b,j(w._payload),I)}if(Za(w)||za(w))return w=hi(w,b.mode,I,null),w.return=b,w;Wl(b,w)}return null}function g(b,w,I,j){var $=w!==null?w.key:null;if(typeof I=="string"&&I!==""||typeof I=="number")return $!==null?null:c(b,w,""+I,j);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case jl:return I.key===$?u(b,w,I,j):null;case Fi:return I.key===$?d(b,w,I,j):null;case ps:return $=I._init,g(b,w,$(I._payload),j)}if(Za(I)||za(I))return $!==null?null:h(b,w,I,j,null);Wl(b,I)}return null}function x(b,w,I,j,$){if(typeof j=="string"&&j!==""||typeof j=="number")return b=b.get(I)||null,c(w,b,""+j,$);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case jl:return b=b.get(j.key===null?I:j.key)||null,u(w,b,j,$);case Fi:return b=b.get(j.key===null?I:j.key)||null,d(w,b,j,$);case ps:var H=j._init;return x(b,w,I,H(j._payload),$)}if(Za(j)||za(j))return b=b.get(I)||null,h(w,b,j,$,null);Wl(w,j)}return null}function S(b,w,I,j){for(var $=null,H=null,E=w,_=w=0,C=null;E!==null&&_<I.length;_++){E.index>_?(C=E,E=null):C=E.sibling;var A=g(b,E,I[_],j);if(A===null){E===null&&(E=C);break}t&&E&&A.alternate===null&&e(b,E),w=i(A,w,_),H===null?$=A:H.sibling=A,H=A,E=C}if(_===I.length)return n(b,E),dt&&ri(b,_),$;if(E===null){for(;_<I.length;_++)E=f(b,I[_],j),E!==null&&(w=i(E,w,_),H===null?$=E:H.sibling=E,H=E);return dt&&ri(b,_),$}for(E=r(b,E);_<I.length;_++)C=x(E,b,_,I[_],j),C!==null&&(t&&C.alternate!==null&&E.delete(C.key===null?_:C.key),w=i(C,w,_),H===null?$=C:H.sibling=C,H=C);return t&&E.forEach(function(D){return e(b,D)}),dt&&ri(b,_),$}function y(b,w,I,j){var $=za(I);if(typeof $!="function")throw Error(Y(150));if(I=$.call(I),I==null)throw Error(Y(151));for(var H=$=null,E=w,_=w=0,C=null,A=I.next();E!==null&&!A.done;_++,A=I.next()){E.index>_?(C=E,E=null):C=E.sibling;var D=g(b,E,A.value,j);if(D===null){E===null&&(E=C);break}t&&E&&D.alternate===null&&e(b,E),w=i(D,w,_),H===null?$=D:H.sibling=D,H=D,E=C}if(A.done)return n(b,E),dt&&ri(b,_),$;if(E===null){for(;!A.done;_++,A=I.next())A=f(b,A.value,j),A!==null&&(w=i(A,w,_),H===null?$=A:H.sibling=A,H=A);return dt&&ri(b,_),$}for(E=r(b,E);!A.done;_++,A=I.next())A=x(E,b,_,A.value,j),A!==null&&(t&&A.alternate!==null&&E.delete(A.key===null?_:A.key),w=i(A,w,_),H===null?$=A:H.sibling=A,H=A);return t&&E.forEach(function(N){return e(b,N)}),dt&&ri(b,_),$}function k(b,w,I,j){if(typeof I=="object"&&I!==null&&I.type===$i&&I.key===null&&(I=I.props.children),typeof I=="object"&&I!==null){switch(I.$$typeof){case jl:e:{for(var $=I.key,H=w;H!==null;){if(H.key===$){if($=I.type,$===$i){if(H.tag===7){n(b,H.sibling),w=s(H,I.props.children),w.return=b,b=w;break e}}else if(H.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===ps&&Tg($)===H.type){n(b,H.sibling),w=s(H,I.props),w.ref=Ka(b,H,I),w.return=b,b=w;break e}n(b,H);break}else e(b,H);H=H.sibling}I.type===$i?(w=hi(I.props.children,b.mode,j,I.key),w.return=b,b=w):(j=hc(I.type,I.key,I.props,null,b.mode,j),j.ref=Ka(b,w,I),j.return=b,b=j)}return a(b);case Fi:e:{for(H=I.key;w!==null;){if(w.key===H)if(w.tag===4&&w.stateNode.containerInfo===I.containerInfo&&w.stateNode.implementation===I.implementation){n(b,w.sibling),w=s(w,I.children||[]),w.return=b,b=w;break e}else{n(b,w);break}else e(b,w);w=w.sibling}w=Id(I,b.mode,j),w.return=b,b=w}return a(b);case ps:return H=I._init,k(b,w,H(I._payload),j)}if(Za(I))return S(b,w,I,j);if(za(I))return y(b,w,I,j);Wl(b,I)}return typeof I=="string"&&I!==""||typeof I=="number"?(I=""+I,w!==null&&w.tag===6?(n(b,w.sibling),w=s(w,I),w.return=b,b=w):(n(b,w),w=kd(I,b.mode,j),w.return=b,b=w),a(b)):n(b,w)}return k}var da=Vv(!0),Fv=Vv(!1),Oc=Gs(null),Vc=null,Ki=null,Dm=null;function Mm(){Dm=Ki=Vc=null}function Lm(t){var e=Oc.current;at(Oc),t._currentValue=e}function wh(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function na(t,e){Vc=t,Dm=Ki=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(kn=!0),t.firstContext=null)}function Jn(t){var e=t._currentValue;if(Dm!==t)if(t={context:t,memoizedValue:e,next:null},Ki===null){if(Vc===null)throw Error(Y(308));Ki=t,Vc.dependencies={lanes:0,firstContext:t}}else Ki=Ki.next=t;return e}var li=null;function Om(t){li===null?li=[t]:li.push(t)}function $v(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Om(e)):(n.next=s.next,s.next=n),e.interleaved=n,qr(t,r)}function qr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var gs=!1;function Vm(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Uv(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ur(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ps(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,We&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,qr(t,n)}return s=r.interleaved,s===null?(e.next=e,Om(r)):(e.next=s.next,s.next=e),r.interleaved=e,qr(t,n)}function ac(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Em(t,n)}}function Cg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Fc(t,e,n,r){var s=t.updateQueue;gs=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,c=s.shared.pending;if(c!==null){s.shared.pending=null;var u=c,d=u.next;u.next=null,a===null?i=d:a.next=d,a=u;var h=t.alternate;h!==null&&(h=h.updateQueue,c=h.lastBaseUpdate,c!==a&&(c===null?h.firstBaseUpdate=d:c.next=d,h.lastBaseUpdate=u))}if(i!==null){var f=s.baseState;a=0,h=d=u=null,c=i;do{var g=c.lane,x=c.eventTime;if((r&g)===g){h!==null&&(h=h.next={eventTime:x,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var S=t,y=c;switch(g=e,x=n,y.tag){case 1:if(S=y.payload,typeof S=="function"){f=S.call(x,f,g);break e}f=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=y.payload,g=typeof S=="function"?S.call(x,f,g):S,g==null)break e;f=pt({},f,g);break e;case 2:gs=!0}}c.callback!==null&&c.lane!==0&&(t.flags|=64,g=s.effects,g===null?s.effects=[c]:g.push(c))}else x={eventTime:x,lane:g,tag:c.tag,payload:c.payload,callback:c.callback,next:null},h===null?(d=h=x,u=f):h=h.next=x,a|=g;if(c=c.next,c===null){if(c=s.shared.pending,c===null)break;g=c,c=g.next,g.next=null,s.lastBaseUpdate=g,s.shared.pending=null}}while(1);if(h===null&&(u=f),s.baseState=u,s.firstBaseUpdate=d,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);yi|=a,t.lanes=a,t.memoizedState=f}}function Sg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Y(191,s));s.call(r)}}}var rl={},Er=Gs(rl),Do=Gs(rl),Mo=Gs(rl);function ci(t){if(t===rl)throw Error(Y(174));return t}function Fm(t,e){switch(nt(Mo,e),nt(Do,t),nt(Er,rl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:eh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=eh(e,t)}at(Er),nt(Er,e)}function ha(){at(Er),at(Do),at(Mo)}function Bv(t){ci(Mo.current);var e=ci(Er.current),n=eh(e,t.type);e!==n&&(nt(Do,t),nt(Er,n))}function $m(t){Do.current===t&&(at(Er),at(Do))}var mt=Gs(0);function $c(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var _d=[];function Um(){for(var t=0;t<_d.length;t++)_d[t]._workInProgressVersionPrimary=null;_d.length=0}var oc=Zr.ReactCurrentDispatcher,Ed=Zr.ReactCurrentBatchConfig,gi=0,ft=null,Pt=null,Ot=null,Uc=!1,fo=!1,Lo=0,ST=0;function rn(){throw Error(Y(321))}function Bm(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!dr(t[n],e[n]))return!1;return!0}function zm(t,e,n,r,s,i){if(gi=i,ft=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,oc.current=t===null||t.memoizedState===null?AT:PT,t=n(r,s),fo){i=0;do{if(fo=!1,Lo=0,25<=i)throw Error(Y(301));i+=1,Ot=Pt=null,e.updateQueue=null,oc.current=RT,t=n(r,s)}while(fo)}if(oc.current=Bc,e=Pt!==null&&Pt.next!==null,gi=0,Ot=Pt=ft=null,Uc=!1,e)throw Error(Y(300));return t}function Wm(){var t=Lo!==0;return Lo=0,t}function vr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ot===null?ft.memoizedState=Ot=t:Ot=Ot.next=t,Ot}function Xn(){if(Pt===null){var t=ft.alternate;t=t!==null?t.memoizedState:null}else t=Pt.next;var e=Ot===null?ft.memoizedState:Ot.next;if(e!==null)Ot=e,Pt=t;else{if(t===null)throw Error(Y(310));Pt=t,t={memoizedState:Pt.memoizedState,baseState:Pt.baseState,baseQueue:Pt.baseQueue,queue:Pt.queue,next:null},Ot===null?ft.memoizedState=Ot=t:Ot=Ot.next=t}return Ot}function Oo(t,e){return typeof e=="function"?e(t):e}function Td(t){var e=Xn(),n=e.queue;if(n===null)throw Error(Y(311));n.lastRenderedReducer=t;var r=Pt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var c=a=null,u=null,d=i;do{var h=d.lane;if((gi&h)===h)u!==null&&(u=u.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var f={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};u===null?(c=u=f,a=r):u=u.next=f,ft.lanes|=h,yi|=h}d=d.next}while(d!==null&&d!==i);u===null?a=r:u.next=c,dr(r,e.memoizedState)||(kn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,ft.lanes|=i,yi|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Cd(t){var e=Xn(),n=e.queue;if(n===null)throw Error(Y(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do i=t(i,a.action),a=a.next;while(a!==s);dr(i,e.memoizedState)||(kn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function zv(){}function Wv(t,e){var n=ft,r=Xn(),s=e(),i=!dr(r.memoizedState,s);if(i&&(r.memoizedState=s,kn=!0),r=r.queue,Hm(Gv.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Ot!==null&&Ot.memoizedState.tag&1){if(n.flags|=2048,Vo(9,qv.bind(null,n,r,s,e),void 0,null),Vt===null)throw Error(Y(349));gi&30||Hv(n,e,s)}return s}function Hv(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ft.updateQueue,e===null?(e={lastEffect:null,stores:null},ft.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function qv(t,e,n,r){e.value=n,e.getSnapshot=r,Kv(e)&&Qv(t)}function Gv(t,e,n){return n(function(){Kv(e)&&Qv(t)})}function Kv(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!dr(t,n)}catch{return!0}}function Qv(t){var e=qr(t,1);e!==null&&cr(e,t,1,-1)}function Ng(t){var e=vr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Oo,lastRenderedState:t},e.queue=t,t=t.dispatch=IT.bind(null,ft,t),[e.memoizedState,t]}function Vo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=ft.updateQueue,e===null?(e={lastEffect:null,stores:null},ft.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Yv(){return Xn().memoizedState}function lc(t,e,n,r){var s=vr();ft.flags|=t,s.memoizedState=Vo(1|e,n,void 0,r===void 0?null:r)}function bu(t,e,n,r){var s=Xn();r=r===void 0?null:r;var i=void 0;if(Pt!==null){var a=Pt.memoizedState;if(i=a.destroy,r!==null&&Bm(r,a.deps)){s.memoizedState=Vo(e,n,i,r);return}}ft.flags|=t,s.memoizedState=Vo(1|e,n,i,r)}function kg(t,e){return lc(8390656,8,t,e)}function Hm(t,e){return bu(2048,8,t,e)}function Jv(t,e){return bu(4,2,t,e)}function Xv(t,e){return bu(4,4,t,e)}function Zv(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function ex(t,e,n){return n=n!=null?n.concat([t]):null,bu(4,4,Zv.bind(null,e,t),n)}function qm(){}function tx(t,e){var n=Xn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Bm(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function nx(t,e){var n=Xn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Bm(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function rx(t,e,n){return gi&21?(dr(n,e)||(n=lv(),ft.lanes|=n,yi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,kn=!0),t.memoizedState=n)}function NT(t,e){var n=Qe;Qe=n!==0&&4>n?n:4,t(!0);var r=Ed.transition;Ed.transition={};try{t(!1),e()}finally{Qe=n,Ed.transition=r}}function sx(){return Xn().memoizedState}function kT(t,e,n){var r=js(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ix(t))ax(e,n);else if(n=$v(t,e,n,r),n!==null){var s=vn();cr(n,t,r,s),ox(n,e,r)}}function IT(t,e,n){var r=js(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ix(t))ax(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,c=i(a,n);if(s.hasEagerState=!0,s.eagerState=c,dr(c,a)){var u=e.interleaved;u===null?(s.next=s,Om(e)):(s.next=u.next,u.next=s),e.interleaved=s;return}}catch{}finally{}n=$v(t,e,s,r),n!==null&&(s=vn(),cr(n,t,r,s),ox(n,e,r))}}function ix(t){var e=t.alternate;return t===ft||e!==null&&e===ft}function ax(t,e){fo=Uc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function ox(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Em(t,n)}}var Bc={readContext:Jn,useCallback:rn,useContext:rn,useEffect:rn,useImperativeHandle:rn,useInsertionEffect:rn,useLayoutEffect:rn,useMemo:rn,useReducer:rn,useRef:rn,useState:rn,useDebugValue:rn,useDeferredValue:rn,useTransition:rn,useMutableSource:rn,useSyncExternalStore:rn,useId:rn,unstable_isNewReconciler:!1},AT={readContext:Jn,useCallback:function(t,e){return vr().memoizedState=[t,e===void 0?null:e],t},useContext:Jn,useEffect:kg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,lc(4194308,4,Zv.bind(null,e,t),n)},useLayoutEffect:function(t,e){return lc(4194308,4,t,e)},useInsertionEffect:function(t,e){return lc(4,2,t,e)},useMemo:function(t,e){var n=vr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=vr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=kT.bind(null,ft,t),[r.memoizedState,t]},useRef:function(t){var e=vr();return t={current:t},e.memoizedState=t},useState:Ng,useDebugValue:qm,useDeferredValue:function(t){return vr().memoizedState=t},useTransition:function(){var t=Ng(!1),e=t[0];return t=NT.bind(null,t[1]),vr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=ft,s=vr();if(dt){if(n===void 0)throw Error(Y(407));n=n()}else{if(n=e(),Vt===null)throw Error(Y(349));gi&30||Hv(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,kg(Gv.bind(null,r,i,t),[t]),r.flags|=2048,Vo(9,qv.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=vr(),e=Vt.identifierPrefix;if(dt){var n=Or,r=Lr;n=(r&~(1<<32-lr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Lo++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=ST++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},PT={readContext:Jn,useCallback:tx,useContext:Jn,useEffect:Hm,useImperativeHandle:ex,useInsertionEffect:Jv,useLayoutEffect:Xv,useMemo:nx,useReducer:Td,useRef:Yv,useState:function(){return Td(Oo)},useDebugValue:qm,useDeferredValue:function(t){var e=Xn();return rx(e,Pt.memoizedState,t)},useTransition:function(){var t=Td(Oo)[0],e=Xn().memoizedState;return[t,e]},useMutableSource:zv,useSyncExternalStore:Wv,useId:sx,unstable_isNewReconciler:!1},RT={readContext:Jn,useCallback:tx,useContext:Jn,useEffect:Hm,useImperativeHandle:ex,useInsertionEffect:Jv,useLayoutEffect:Xv,useMemo:nx,useReducer:Cd,useRef:Yv,useState:function(){return Cd(Oo)},useDebugValue:qm,useDeferredValue:function(t){var e=Xn();return Pt===null?e.memoizedState=t:rx(e,Pt.memoizedState,t)},useTransition:function(){var t=Cd(Oo)[0],e=Xn().memoizedState;return[t,e]},useMutableSource:zv,useSyncExternalStore:Wv,useId:sx,unstable_isNewReconciler:!1};function ir(t,e){if(t&&t.defaultProps){e=pt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function bh(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:pt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var _u={isMounted:function(t){return(t=t._reactInternals)?Si(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=vn(),s=js(t),i=Ur(r,s);i.payload=e,n!=null&&(i.callback=n),e=Ps(t,i,s),e!==null&&(cr(e,t,s,r),ac(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=vn(),s=js(t),i=Ur(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Ps(t,i,s),e!==null&&(cr(e,t,s,r),ac(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=vn(),r=js(t),s=Ur(n,r);s.tag=2,e!=null&&(s.callback=e),e=Ps(t,s,r),e!==null&&(cr(e,t,r,n),ac(e,t,r))}};function Ig(t,e,n,r,s,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!Ao(n,r)||!Ao(s,i):!0}function lx(t,e,n){var r=!1,s=Us,i=e.contextType;return typeof i=="object"&&i!==null?i=Jn(i):(s=An(e)?fi:un.current,r=e.contextTypes,i=(r=r!=null)?ca(t,s):Us),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=_u,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Ag(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&_u.enqueueReplaceState(e,e.state,null)}function _h(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Vm(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Jn(i):(i=An(e)?fi:un.current,s.context=ca(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(bh(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&_u.enqueueReplaceState(s,s.state,null),Fc(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function ma(t,e){try{var n="",r=e;do n+=aE(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Sd(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Eh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var jT=typeof WeakMap=="function"?WeakMap:Map;function cx(t,e,n){n=Ur(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Wc||(Wc=!0,jh=r),Eh(t,e)},n}function ux(t,e,n){n=Ur(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Eh(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Eh(t,e),typeof r!="function"&&(Rs===null?Rs=new Set([this]):Rs.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function Pg(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new jT;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=GT.bind(null,t,e,n),e.then(t,t))}function Rg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function jg(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Ur(-1,1),e.tag=2,Ps(n,e,1))),n.lanes|=1),t)}var DT=Zr.ReactCurrentOwner,kn=!1;function yn(t,e,n,r){e.child=t===null?Fv(e,null,n,r):da(e,t.child,n,r)}function Dg(t,e,n,r,s){n=n.render;var i=e.ref;return na(e,s),r=zm(t,e,n,r,i,s),n=Wm(),t!==null&&!kn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Gr(t,e,s)):(dt&&n&&Pm(e),e.flags|=1,yn(t,e,r,s),e.child)}function Mg(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!ef(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,dx(t,e,i,r,s)):(t=hc(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:Ao,n(a,r)&&t.ref===e.ref)return Gr(t,e,s)}return e.flags|=1,t=Ds(i,r),t.ref=e.ref,t.return=e,e.child=t}function dx(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Ao(i,r)&&t.ref===e.ref)if(kn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(kn=!0);else return e.lanes=t.lanes,Gr(t,e,s)}return Th(t,e,n,r,s)}function hx(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},nt(Yi,On),On|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,nt(Yi,On),On|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,nt(Yi,On),On|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,nt(Yi,On),On|=r;return yn(t,e,s,n),e.child}function mx(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Th(t,e,n,r,s){var i=An(n)?fi:un.current;return i=ca(e,i),na(e,s),n=zm(t,e,n,r,i,s),r=Wm(),t!==null&&!kn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Gr(t,e,s)):(dt&&r&&Pm(e),e.flags|=1,yn(t,e,n,s),e.child)}function Lg(t,e,n,r,s){if(An(n)){var i=!0;Dc(e)}else i=!1;if(na(e,s),e.stateNode===null)cc(t,e),lx(e,n,r),_h(e,n,r,s),r=!0;else if(t===null){var a=e.stateNode,c=e.memoizedProps;a.props=c;var u=a.context,d=n.contextType;typeof d=="object"&&d!==null?d=Jn(d):(d=An(n)?fi:un.current,d=ca(e,d));var h=n.getDerivedStateFromProps,f=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";f||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(c!==r||u!==d)&&Ag(e,a,r,d),gs=!1;var g=e.memoizedState;a.state=g,Fc(e,r,a,s),u=e.memoizedState,c!==r||g!==u||In.current||gs?(typeof h=="function"&&(bh(e,n,h,r),u=e.memoizedState),(c=gs||Ig(e,n,c,r,g,u,d))?(f||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),a.props=r,a.state=u,a.context=d,r=c):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,Uv(t,e),c=e.memoizedProps,d=e.type===e.elementType?c:ir(e.type,c),a.props=d,f=e.pendingProps,g=a.context,u=n.contextType,typeof u=="object"&&u!==null?u=Jn(u):(u=An(n)?fi:un.current,u=ca(e,u));var x=n.getDerivedStateFromProps;(h=typeof x=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(c!==f||g!==u)&&Ag(e,a,r,u),gs=!1,g=e.memoizedState,a.state=g,Fc(e,r,a,s);var S=e.memoizedState;c!==f||g!==S||In.current||gs?(typeof x=="function"&&(bh(e,n,x,r),S=e.memoizedState),(d=gs||Ig(e,n,d,r,g,S,u)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,S,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,S,u)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=S),a.props=r,a.state=S,a.context=u,r=d):(typeof a.componentDidUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),r=!1)}return Ch(t,e,n,r,i,s)}function Ch(t,e,n,r,s,i){mx(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&bg(e,n,!1),Gr(t,e,i);r=e.stateNode,DT.current=e;var c=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=da(e,t.child,null,i),e.child=da(e,null,c,i)):yn(t,e,c,i),e.memoizedState=r.state,s&&bg(e,n,!0),e.child}function fx(t){var e=t.stateNode;e.pendingContext?wg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&wg(t,e.context,!1),Fm(t,e.containerInfo)}function Og(t,e,n,r,s){return ua(),jm(s),e.flags|=256,yn(t,e,n,r),e.child}var Sh={dehydrated:null,treeContext:null,retryLane:0};function Nh(t){return{baseLanes:t,cachePool:null,transitions:null}}function px(t,e,n){var r=e.pendingProps,s=mt.current,i=!1,a=(e.flags&128)!==0,c;if((c=a)||(c=t!==null&&t.memoizedState===null?!1:(s&2)!==0),c?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),nt(mt,s&1),t===null)return xh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Cu(a,r,0,null),t=hi(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Nh(n),e.memoizedState=Sh,t):Gm(e,a));if(s=t.memoizedState,s!==null&&(c=s.dehydrated,c!==null))return MT(t,e,a,r,c,s,n);if(i){i=r.fallback,a=e.mode,s=t.child,c=s.sibling;var u={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=Ds(s,u),r.subtreeFlags=s.subtreeFlags&14680064),c!==null?i=Ds(c,i):(i=hi(i,a,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=t.child.memoizedState,a=a===null?Nh(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=Sh,r}return i=t.child,t=i.sibling,r=Ds(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Gm(t,e){return e=Cu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Hl(t,e,n,r){return r!==null&&jm(r),da(e,t.child,null,n),t=Gm(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function MT(t,e,n,r,s,i,a){if(n)return e.flags&256?(e.flags&=-257,r=Sd(Error(Y(422))),Hl(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Cu({mode:"visible",children:r.children},s,0,null),i=hi(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&da(e,t.child,null,a),e.child.memoizedState=Nh(a),e.memoizedState=Sh,i);if(!(e.mode&1))return Hl(t,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var c=r.dgst;return r=c,i=Error(Y(419)),r=Sd(i,r,void 0),Hl(t,e,a,r)}if(c=(a&t.childLanes)!==0,kn||c){if(r=Vt,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,qr(t,s),cr(r,t,s,-1))}return Zm(),r=Sd(Error(Y(421))),Hl(t,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=KT.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Vn=As(s.nextSibling),$n=e,dt=!0,or=null,t!==null&&(qn[Gn++]=Lr,qn[Gn++]=Or,qn[Gn++]=pi,Lr=t.id,Or=t.overflow,pi=e),e=Gm(e,r.children),e.flags|=4096,e)}function Vg(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),wh(t.return,e,n)}function Nd(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function gx(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(yn(t,e,r.children,n),r=mt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Vg(t,n,e);else if(t.tag===19)Vg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(nt(mt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&$c(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Nd(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&$c(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Nd(e,!0,n,null,i);break;case"together":Nd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function cc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Gr(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),yi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Y(153));if(e.child!==null){for(t=e.child,n=Ds(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ds(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function LT(t,e,n){switch(e.tag){case 3:fx(e),ua();break;case 5:Bv(e);break;case 1:An(e.type)&&Dc(e);break;case 4:Fm(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;nt(Oc,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(nt(mt,mt.current&1),e.flags|=128,null):n&e.child.childLanes?px(t,e,n):(nt(mt,mt.current&1),t=Gr(t,e,n),t!==null?t.sibling:null);nt(mt,mt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return gx(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),nt(mt,mt.current),r)break;return null;case 22:case 23:return e.lanes=0,hx(t,e,n)}return Gr(t,e,n)}var yx,kh,vx,xx;yx=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};kh=function(){};vx=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,ci(Er.current);var i=null;switch(n){case"input":s=Yd(t,s),r=Yd(t,r),i=[];break;case"select":s=pt({},s,{value:void 0}),r=pt({},r,{value:void 0}),i=[];break;case"textarea":s=Zd(t,s),r=Zd(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Rc)}th(n,r);var a;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var c=s[d];for(a in c)c.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Eo.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var u=r[d];if(c=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&u!==c&&(u!=null||c!=null))if(d==="style")if(c){for(a in c)!c.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in u)u.hasOwnProperty(a)&&c[a]!==u[a]&&(n||(n={}),n[a]=u[a])}else n||(i||(i=[]),i.push(d,n)),n=u;else d==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,c=c?c.__html:void 0,u!=null&&c!==u&&(i=i||[]).push(d,u)):d==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(d,""+u):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Eo.hasOwnProperty(d)?(u!=null&&d==="onScroll"&&st("scroll",t),i||c===u||(i=[])):(i=i||[]).push(d,u))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};xx=function(t,e,n,r){n!==r&&(e.flags|=4)};function Qa(t,e){if(!dt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function sn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function OT(t,e,n){var r=e.pendingProps;switch(Rm(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return sn(e),null;case 1:return An(e.type)&&jc(),sn(e),null;case 3:return r=e.stateNode,ha(),at(In),at(un),Um(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(zl(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,or!==null&&(Lh(or),or=null))),kh(t,e),sn(e),null;case 5:$m(e);var s=ci(Mo.current);if(n=e.type,t!==null&&e.stateNode!=null)vx(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Y(166));return sn(e),null}if(t=ci(Er.current),zl(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[wr]=e,r[jo]=i,t=(e.mode&1)!==0,n){case"dialog":st("cancel",r),st("close",r);break;case"iframe":case"object":case"embed":st("load",r);break;case"video":case"audio":for(s=0;s<to.length;s++)st(to[s],r);break;case"source":st("error",r);break;case"img":case"image":case"link":st("error",r),st("load",r);break;case"details":st("toggle",r);break;case"input":Gp(r,i),st("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},st("invalid",r);break;case"textarea":Qp(r,i),st("invalid",r)}th(n,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var c=i[a];a==="children"?typeof c=="string"?r.textContent!==c&&(i.suppressHydrationWarning!==!0&&Bl(r.textContent,c,t),s=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(i.suppressHydrationWarning!==!0&&Bl(r.textContent,c,t),s=["children",""+c]):Eo.hasOwnProperty(a)&&c!=null&&a==="onScroll"&&st("scroll",r)}switch(n){case"input":Dl(r),Kp(r,i,!0);break;case"textarea":Dl(r),Yp(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Rc)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=G0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[wr]=e,t[jo]=r,yx(t,e,!1,!1),e.stateNode=t;e:{switch(a=nh(n,r),n){case"dialog":st("cancel",t),st("close",t),s=r;break;case"iframe":case"object":case"embed":st("load",t),s=r;break;case"video":case"audio":for(s=0;s<to.length;s++)st(to[s],t);s=r;break;case"source":st("error",t),s=r;break;case"img":case"image":case"link":st("error",t),st("load",t),s=r;break;case"details":st("toggle",t),s=r;break;case"input":Gp(t,r),s=Yd(t,r),st("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=pt({},r,{value:void 0}),st("invalid",t);break;case"textarea":Qp(t,r),s=Zd(t,r),st("invalid",t);break;default:s=r}th(n,s),c=s;for(i in c)if(c.hasOwnProperty(i)){var u=c[i];i==="style"?Y0(t,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&K0(t,u)):i==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&To(t,u):typeof u=="number"&&To(t,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Eo.hasOwnProperty(i)?u!=null&&i==="onScroll"&&st("scroll",t):u!=null&&ym(t,i,u,a))}switch(n){case"input":Dl(t),Kp(t,r,!1);break;case"textarea":Dl(t),Yp(t);break;case"option":r.value!=null&&t.setAttribute("value",""+$s(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Xi(t,!!r.multiple,i,!1):r.defaultValue!=null&&Xi(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Rc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return sn(e),null;case 6:if(t&&e.stateNode!=null)xx(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Y(166));if(n=ci(Mo.current),ci(Er.current),zl(e)){if(r=e.stateNode,n=e.memoizedProps,r[wr]=e,(i=r.nodeValue!==n)&&(t=$n,t!==null))switch(t.tag){case 3:Bl(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Bl(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[wr]=e,e.stateNode=r}return sn(e),null;case 13:if(at(mt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(dt&&Vn!==null&&e.mode&1&&!(e.flags&128))Ov(),ua(),e.flags|=98560,i=!1;else if(i=zl(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(Y(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Y(317));i[wr]=e}else ua(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;sn(e),i=!1}else or!==null&&(Lh(or),or=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||mt.current&1?Rt===0&&(Rt=3):Zm())),e.updateQueue!==null&&(e.flags|=4),sn(e),null);case 4:return ha(),kh(t,e),t===null&&Po(e.stateNode.containerInfo),sn(e),null;case 10:return Lm(e.type._context),sn(e),null;case 17:return An(e.type)&&jc(),sn(e),null;case 19:if(at(mt),i=e.memoizedState,i===null)return sn(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)Qa(i,!1);else{if(Rt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=$c(t),a!==null){for(e.flags|=128,Qa(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return nt(mt,mt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Et()>fa&&(e.flags|=128,r=!0,Qa(i,!1),e.lanes=4194304)}else{if(!r)if(t=$c(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Qa(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!dt)return sn(e),null}else 2*Et()-i.renderingStartTime>fa&&n!==1073741824&&(e.flags|=128,r=!0,Qa(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Et(),e.sibling=null,n=mt.current,nt(mt,r?n&1|2:n&1),e):(sn(e),null);case 22:case 23:return Xm(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?On&1073741824&&(sn(e),e.subtreeFlags&6&&(e.flags|=8192)):sn(e),null;case 24:return null;case 25:return null}throw Error(Y(156,e.tag))}function VT(t,e){switch(Rm(e),e.tag){case 1:return An(e.type)&&jc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ha(),at(In),at(un),Um(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return $m(e),null;case 13:if(at(mt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Y(340));ua()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return at(mt),null;case 4:return ha(),null;case 10:return Lm(e.type._context),null;case 22:case 23:return Xm(),null;case 24:return null;default:return null}}var ql=!1,ln=!1,FT=typeof WeakSet=="function"?WeakSet:Set,oe=null;function Qi(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){xt(t,e,r)}else n.current=null}function Ih(t,e,n){try{n()}catch(r){xt(t,e,r)}}var Fg=!1;function $T(t,e){if(hh=Ic,t=Tv(),Am(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,c=-1,u=-1,d=0,h=0,f=t,g=null;t:for(;;){for(var x;f!==n||s!==0&&f.nodeType!==3||(c=a+s),f!==i||r!==0&&f.nodeType!==3||(u=a+r),f.nodeType===3&&(a+=f.nodeValue.length),(x=f.firstChild)!==null;)g=f,f=x;for(;;){if(f===t)break t;if(g===n&&++d===s&&(c=a),g===i&&++h===r&&(u=a),(x=f.nextSibling)!==null)break;f=g,g=f.parentNode}f=x}n=c===-1||u===-1?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(mh={focusedElem:t,selectionRange:n},Ic=!1,oe=e;oe!==null;)if(e=oe,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,oe=t;else for(;oe!==null;){e=oe;try{var S=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var y=S.memoizedProps,k=S.memoizedState,b=e.stateNode,w=b.getSnapshotBeforeUpdate(e.elementType===e.type?y:ir(e.type,y),k);b.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var I=e.stateNode.containerInfo;I.nodeType===1?I.textContent="":I.nodeType===9&&I.documentElement&&I.removeChild(I.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Y(163))}}catch(j){xt(e,e.return,j)}if(t=e.sibling,t!==null){t.return=e.return,oe=t;break}oe=e.return}return S=Fg,Fg=!1,S}function po(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Ih(e,n,i)}s=s.next}while(s!==r)}}function Eu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Ah(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function wx(t){var e=t.alternate;e!==null&&(t.alternate=null,wx(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[wr],delete e[jo],delete e[gh],delete e[_T],delete e[ET])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function bx(t){return t.tag===5||t.tag===3||t.tag===4}function $g(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||bx(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Ph(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Rc));else if(r!==4&&(t=t.child,t!==null))for(Ph(t,e,n),t=t.sibling;t!==null;)Ph(t,e,n),t=t.sibling}function Rh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Rh(t,e,n),t=t.sibling;t!==null;)Rh(t,e,n),t=t.sibling}var zt=null,ar=!1;function hs(t,e,n){for(n=n.child;n!==null;)_x(t,e,n),n=n.sibling}function _x(t,e,n){if(_r&&typeof _r.onCommitFiberUnmount=="function")try{_r.onCommitFiberUnmount(pu,n)}catch{}switch(n.tag){case 5:ln||Qi(n,e);case 6:var r=zt,s=ar;zt=null,hs(t,e,n),zt=r,ar=s,zt!==null&&(ar?(t=zt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):zt.removeChild(n.stateNode));break;case 18:zt!==null&&(ar?(t=zt,n=n.stateNode,t.nodeType===8?wd(t.parentNode,n):t.nodeType===1&&wd(t,n),ko(t)):wd(zt,n.stateNode));break;case 4:r=zt,s=ar,zt=n.stateNode.containerInfo,ar=!0,hs(t,e,n),zt=r,ar=s;break;case 0:case 11:case 14:case 15:if(!ln&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&Ih(n,e,a),s=s.next}while(s!==r)}hs(t,e,n);break;case 1:if(!ln&&(Qi(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(c){xt(n,e,c)}hs(t,e,n);break;case 21:hs(t,e,n);break;case 22:n.mode&1?(ln=(r=ln)||n.memoizedState!==null,hs(t,e,n),ln=r):hs(t,e,n);break;default:hs(t,e,n)}}function Ug(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new FT),e.forEach(function(r){var s=QT.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function sr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,a=e,c=a;e:for(;c!==null;){switch(c.tag){case 5:zt=c.stateNode,ar=!1;break e;case 3:zt=c.stateNode.containerInfo,ar=!0;break e;case 4:zt=c.stateNode.containerInfo,ar=!0;break e}c=c.return}if(zt===null)throw Error(Y(160));_x(i,a,s),zt=null,ar=!1;var u=s.alternate;u!==null&&(u.return=null),s.return=null}catch(d){xt(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Ex(e,t),e=e.sibling}function Ex(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(sr(e,t),yr(t),r&4){try{po(3,t,t.return),Eu(3,t)}catch(y){xt(t,t.return,y)}try{po(5,t,t.return)}catch(y){xt(t,t.return,y)}}break;case 1:sr(e,t),yr(t),r&512&&n!==null&&Qi(n,n.return);break;case 5:if(sr(e,t),yr(t),r&512&&n!==null&&Qi(n,n.return),t.flags&32){var s=t.stateNode;try{To(s,"")}catch(y){xt(t,t.return,y)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,c=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{c==="input"&&i.type==="radio"&&i.name!=null&&H0(s,i),nh(c,a);var d=nh(c,i);for(a=0;a<u.length;a+=2){var h=u[a],f=u[a+1];h==="style"?Y0(s,f):h==="dangerouslySetInnerHTML"?K0(s,f):h==="children"?To(s,f):ym(s,h,f,d)}switch(c){case"input":Jd(s,i);break;case"textarea":q0(s,i);break;case"select":var g=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var x=i.value;x!=null?Xi(s,!!i.multiple,x,!1):g!==!!i.multiple&&(i.defaultValue!=null?Xi(s,!!i.multiple,i.defaultValue,!0):Xi(s,!!i.multiple,i.multiple?[]:"",!1))}s[jo]=i}catch(y){xt(t,t.return,y)}}break;case 6:if(sr(e,t),yr(t),r&4){if(t.stateNode===null)throw Error(Y(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(y){xt(t,t.return,y)}}break;case 3:if(sr(e,t),yr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ko(e.containerInfo)}catch(y){xt(t,t.return,y)}break;case 4:sr(e,t),yr(t);break;case 13:sr(e,t),yr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Ym=Et())),r&4&&Ug(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(ln=(d=ln)||h,sr(e,t),ln=d):sr(e,t),yr(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!h&&t.mode&1)for(oe=t,h=t.child;h!==null;){for(f=oe=h;oe!==null;){switch(g=oe,x=g.child,g.tag){case 0:case 11:case 14:case 15:po(4,g,g.return);break;case 1:Qi(g,g.return);var S=g.stateNode;if(typeof S.componentWillUnmount=="function"){r=g,n=g.return;try{e=r,S.props=e.memoizedProps,S.state=e.memoizedState,S.componentWillUnmount()}catch(y){xt(r,n,y)}}break;case 5:Qi(g,g.return);break;case 22:if(g.memoizedState!==null){zg(f);continue}}x!==null?(x.return=g,oe=x):zg(f)}h=h.sibling}e:for(h=null,f=t;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(c=f.stateNode,u=f.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,c.style.display=Q0("display",a))}catch(y){xt(t,t.return,y)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(y){xt(t,t.return,y)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:sr(e,t),yr(t),r&4&&Ug(t);break;case 21:break;default:sr(e,t),yr(t)}}function yr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(bx(n)){var r=n;break e}n=n.return}throw Error(Y(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(To(s,""),r.flags&=-33);var i=$g(t);Rh(t,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,c=$g(t);Ph(t,c,a);break;default:throw Error(Y(161))}}catch(u){xt(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function UT(t,e,n){oe=t,Tx(t)}function Tx(t,e,n){for(var r=(t.mode&1)!==0;oe!==null;){var s=oe,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||ql;if(!a){var c=s.alternate,u=c!==null&&c.memoizedState!==null||ln;c=ql;var d=ln;if(ql=a,(ln=u)&&!d)for(oe=s;oe!==null;)a=oe,u=a.child,a.tag===22&&a.memoizedState!==null?Wg(s):u!==null?(u.return=a,oe=u):Wg(s);for(;i!==null;)oe=i,Tx(i),i=i.sibling;oe=s,ql=c,ln=d}Bg(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,oe=i):Bg(t)}}function Bg(t){for(;oe!==null;){var e=oe;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ln||Eu(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ln)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:ir(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Sg(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Sg(e,a,n)}break;case 5:var c=e.stateNode;if(n===null&&e.flags&4){n=c;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&ko(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Y(163))}ln||e.flags&512&&Ah(e)}catch(g){xt(e,e.return,g)}}if(e===t){oe=null;break}if(n=e.sibling,n!==null){n.return=e.return,oe=n;break}oe=e.return}}function zg(t){for(;oe!==null;){var e=oe;if(e===t){oe=null;break}var n=e.sibling;if(n!==null){n.return=e.return,oe=n;break}oe=e.return}}function Wg(t){for(;oe!==null;){var e=oe;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Eu(4,e)}catch(u){xt(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(u){xt(e,s,u)}}var i=e.return;try{Ah(e)}catch(u){xt(e,i,u)}break;case 5:var a=e.return;try{Ah(e)}catch(u){xt(e,a,u)}}}catch(u){xt(e,e.return,u)}if(e===t){oe=null;break}var c=e.sibling;if(c!==null){c.return=e.return,oe=c;break}oe=e.return}}var BT=Math.ceil,zc=Zr.ReactCurrentDispatcher,Km=Zr.ReactCurrentOwner,Qn=Zr.ReactCurrentBatchConfig,We=0,Vt=null,Nt=null,qt=0,On=0,Yi=Gs(0),Rt=0,Fo=null,yi=0,Tu=0,Qm=0,go=null,Sn=null,Ym=0,fa=1/0,jr=null,Wc=!1,jh=null,Rs=null,Gl=!1,Ts=null,Hc=0,yo=0,Dh=null,uc=-1,dc=0;function vn(){return We&6?Et():uc!==-1?uc:uc=Et()}function js(t){return t.mode&1?We&2&&qt!==0?qt&-qt:CT.transition!==null?(dc===0&&(dc=lv()),dc):(t=Qe,t!==0||(t=window.event,t=t===void 0?16:pv(t.type)),t):1}function cr(t,e,n,r){if(50<yo)throw yo=0,Dh=null,Error(Y(185));el(t,n,r),(!(We&2)||t!==Vt)&&(t===Vt&&(!(We&2)&&(Tu|=n),Rt===4&&vs(t,qt)),Pn(t,r),n===1&&We===0&&!(e.mode&1)&&(fa=Et()+500,wu&&Ks()))}function Pn(t,e){var n=t.callbackNode;CE(t,e);var r=kc(t,t===Vt?qt:0);if(r===0)n!==null&&Zp(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Zp(n),e===1)t.tag===0?TT(Hg.bind(null,t)):Dv(Hg.bind(null,t)),wT(function(){!(We&6)&&Ks()}),n=null;else{switch(cv(r)){case 1:n=_m;break;case 4:n=av;break;case 16:n=Nc;break;case 536870912:n=ov;break;default:n=Nc}n=Rx(n,Cx.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Cx(t,e){if(uc=-1,dc=0,We&6)throw Error(Y(327));var n=t.callbackNode;if(ra()&&t.callbackNode!==n)return null;var r=kc(t,t===Vt?qt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=qc(t,r);else{e=r;var s=We;We|=2;var i=Nx();(Vt!==t||qt!==e)&&(jr=null,fa=Et()+500,di(t,e));do try{HT();break}catch(c){Sx(t,c)}while(1);Mm(),zc.current=i,We=s,Nt!==null?e=0:(Vt=null,qt=0,e=Rt)}if(e!==0){if(e===2&&(s=oh(t),s!==0&&(r=s,e=Mh(t,s))),e===1)throw n=Fo,di(t,0),vs(t,r),Pn(t,Et()),n;if(e===6)vs(t,r);else{if(s=t.current.alternate,!(r&30)&&!zT(s)&&(e=qc(t,r),e===2&&(i=oh(t),i!==0&&(r=i,e=Mh(t,i))),e===1))throw n=Fo,di(t,0),vs(t,r),Pn(t,Et()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(Y(345));case 2:si(t,Sn,jr);break;case 3:if(vs(t,r),(r&130023424)===r&&(e=Ym+500-Et(),10<e)){if(kc(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){vn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=ph(si.bind(null,t,Sn,jr),e);break}si(t,Sn,jr);break;case 4:if(vs(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var a=31-lr(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=Et()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*BT(r/1960))-r,10<r){t.timeoutHandle=ph(si.bind(null,t,Sn,jr),r);break}si(t,Sn,jr);break;case 5:si(t,Sn,jr);break;default:throw Error(Y(329))}}}return Pn(t,Et()),t.callbackNode===n?Cx.bind(null,t):null}function Mh(t,e){var n=go;return t.current.memoizedState.isDehydrated&&(di(t,e).flags|=256),t=qc(t,e),t!==2&&(e=Sn,Sn=n,e!==null&&Lh(e)),t}function Lh(t){Sn===null?Sn=t:Sn.push.apply(Sn,t)}function zT(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!dr(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function vs(t,e){for(e&=~Qm,e&=~Tu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-lr(e),r=1<<n;t[n]=-1,e&=~r}}function Hg(t){if(We&6)throw Error(Y(327));ra();var e=kc(t,0);if(!(e&1))return Pn(t,Et()),null;var n=qc(t,e);if(t.tag!==0&&n===2){var r=oh(t);r!==0&&(e=r,n=Mh(t,r))}if(n===1)throw n=Fo,di(t,0),vs(t,e),Pn(t,Et()),n;if(n===6)throw Error(Y(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,si(t,Sn,jr),Pn(t,Et()),null}function Jm(t,e){var n=We;We|=1;try{return t(e)}finally{We=n,We===0&&(fa=Et()+500,wu&&Ks())}}function vi(t){Ts!==null&&Ts.tag===0&&!(We&6)&&ra();var e=We;We|=1;var n=Qn.transition,r=Qe;try{if(Qn.transition=null,Qe=1,t)return t()}finally{Qe=r,Qn.transition=n,We=e,!(We&6)&&Ks()}}function Xm(){On=Yi.current,at(Yi)}function di(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,xT(n)),Nt!==null)for(n=Nt.return;n!==null;){var r=n;switch(Rm(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&jc();break;case 3:ha(),at(In),at(un),Um();break;case 5:$m(r);break;case 4:ha();break;case 13:at(mt);break;case 19:at(mt);break;case 10:Lm(r.type._context);break;case 22:case 23:Xm()}n=n.return}if(Vt=t,Nt=t=Ds(t.current,null),qt=On=e,Rt=0,Fo=null,Qm=Tu=yi=0,Sn=go=null,li!==null){for(e=0;e<li.length;e++)if(n=li[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}n.pending=r}li=null}return t}function Sx(t,e){do{var n=Nt;try{if(Mm(),oc.current=Bc,Uc){for(var r=ft.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Uc=!1}if(gi=0,Ot=Pt=ft=null,fo=!1,Lo=0,Km.current=null,n===null||n.return===null){Rt=1,Fo=e,Nt=null;break}e:{var i=t,a=n.return,c=n,u=e;if(e=qt,c.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var d=u,h=c,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var g=h.alternate;g?(h.updateQueue=g.updateQueue,h.memoizedState=g.memoizedState,h.lanes=g.lanes):(h.updateQueue=null,h.memoizedState=null)}var x=Rg(a);if(x!==null){x.flags&=-257,jg(x,a,c,i,e),x.mode&1&&Pg(i,d,e),e=x,u=d;var S=e.updateQueue;if(S===null){var y=new Set;y.add(u),e.updateQueue=y}else S.add(u);break e}else{if(!(e&1)){Pg(i,d,e),Zm();break e}u=Error(Y(426))}}else if(dt&&c.mode&1){var k=Rg(a);if(k!==null){!(k.flags&65536)&&(k.flags|=256),jg(k,a,c,i,e),jm(ma(u,c));break e}}i=u=ma(u,c),Rt!==4&&(Rt=2),go===null?go=[i]:go.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var b=cx(i,u,e);Cg(i,b);break e;case 1:c=u;var w=i.type,I=i.stateNode;if(!(i.flags&128)&&(typeof w.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(Rs===null||!Rs.has(I)))){i.flags|=65536,e&=-e,i.lanes|=e;var j=ux(i,c,e);Cg(i,j);break e}}i=i.return}while(i!==null)}Ix(n)}catch($){e=$,Nt===n&&n!==null&&(Nt=n=n.return);continue}break}while(1)}function Nx(){var t=zc.current;return zc.current=Bc,t===null?Bc:t}function Zm(){(Rt===0||Rt===3||Rt===2)&&(Rt=4),Vt===null||!(yi&268435455)&&!(Tu&268435455)||vs(Vt,qt)}function qc(t,e){var n=We;We|=2;var r=Nx();(Vt!==t||qt!==e)&&(jr=null,di(t,e));do try{WT();break}catch(s){Sx(t,s)}while(1);if(Mm(),We=n,zc.current=r,Nt!==null)throw Error(Y(261));return Vt=null,qt=0,Rt}function WT(){for(;Nt!==null;)kx(Nt)}function HT(){for(;Nt!==null&&!gE();)kx(Nt)}function kx(t){var e=Px(t.alternate,t,On);t.memoizedProps=t.pendingProps,e===null?Ix(t):Nt=e,Km.current=null}function Ix(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=VT(n,e),n!==null){n.flags&=32767,Nt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Rt=6,Nt=null;return}}else if(n=OT(n,e,On),n!==null){Nt=n;return}if(e=e.sibling,e!==null){Nt=e;return}Nt=e=t}while(e!==null);Rt===0&&(Rt=5)}function si(t,e,n){var r=Qe,s=Qn.transition;try{Qn.transition=null,Qe=1,qT(t,e,n,r)}finally{Qn.transition=s,Qe=r}return null}function qT(t,e,n,r){do ra();while(Ts!==null);if(We&6)throw Error(Y(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Y(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(SE(t,i),t===Vt&&(Nt=Vt=null,qt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Gl||(Gl=!0,Rx(Nc,function(){return ra(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Qn.transition,Qn.transition=null;var a=Qe;Qe=1;var c=We;We|=4,Km.current=null,$T(t,n),Ex(n,t),hT(mh),Ic=!!hh,mh=hh=null,t.current=n,UT(n),yE(),We=c,Qe=a,Qn.transition=i}else t.current=n;if(Gl&&(Gl=!1,Ts=t,Hc=s),i=t.pendingLanes,i===0&&(Rs=null),wE(n.stateNode),Pn(t,Et()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Wc)throw Wc=!1,t=jh,jh=null,t;return Hc&1&&t.tag!==0&&ra(),i=t.pendingLanes,i&1?t===Dh?yo++:(yo=0,Dh=t):yo=0,Ks(),null}function ra(){if(Ts!==null){var t=cv(Hc),e=Qn.transition,n=Qe;try{if(Qn.transition=null,Qe=16>t?16:t,Ts===null)var r=!1;else{if(t=Ts,Ts=null,Hc=0,We&6)throw Error(Y(331));var s=We;for(We|=4,oe=t.current;oe!==null;){var i=oe,a=i.child;if(oe.flags&16){var c=i.deletions;if(c!==null){for(var u=0;u<c.length;u++){var d=c[u];for(oe=d;oe!==null;){var h=oe;switch(h.tag){case 0:case 11:case 15:po(8,h,i)}var f=h.child;if(f!==null)f.return=h,oe=f;else for(;oe!==null;){h=oe;var g=h.sibling,x=h.return;if(wx(h),h===d){oe=null;break}if(g!==null){g.return=x,oe=g;break}oe=x}}}var S=i.alternate;if(S!==null){var y=S.child;if(y!==null){S.child=null;do{var k=y.sibling;y.sibling=null,y=k}while(y!==null)}}oe=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,oe=a;else e:for(;oe!==null;){if(i=oe,i.flags&2048)switch(i.tag){case 0:case 11:case 15:po(9,i,i.return)}var b=i.sibling;if(b!==null){b.return=i.return,oe=b;break e}oe=i.return}}var w=t.current;for(oe=w;oe!==null;){a=oe;var I=a.child;if(a.subtreeFlags&2064&&I!==null)I.return=a,oe=I;else e:for(a=w;oe!==null;){if(c=oe,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Eu(9,c)}}catch($){xt(c,c.return,$)}if(c===a){oe=null;break e}var j=c.sibling;if(j!==null){j.return=c.return,oe=j;break e}oe=c.return}}if(We=s,Ks(),_r&&typeof _r.onPostCommitFiberRoot=="function")try{_r.onPostCommitFiberRoot(pu,t)}catch{}r=!0}return r}finally{Qe=n,Qn.transition=e}}return!1}function qg(t,e,n){e=ma(n,e),e=cx(t,e,1),t=Ps(t,e,1),e=vn(),t!==null&&(el(t,1,e),Pn(t,e))}function xt(t,e,n){if(t.tag===3)qg(t,t,n);else for(;e!==null;){if(e.tag===3){qg(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Rs===null||!Rs.has(r))){t=ma(n,t),t=ux(e,t,1),e=Ps(e,t,1),t=vn(),e!==null&&(el(e,1,t),Pn(e,t));break}}e=e.return}}function GT(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=vn(),t.pingedLanes|=t.suspendedLanes&n,Vt===t&&(qt&n)===n&&(Rt===4||Rt===3&&(qt&130023424)===qt&&500>Et()-Ym?di(t,0):Qm|=n),Pn(t,e)}function Ax(t,e){e===0&&(t.mode&1?(e=Ol,Ol<<=1,!(Ol&130023424)&&(Ol=4194304)):e=1);var n=vn();t=qr(t,e),t!==null&&(el(t,e,n),Pn(t,n))}function KT(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Ax(t,n)}function QT(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Y(314))}r!==null&&r.delete(e),Ax(t,n)}var Px;Px=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||In.current)kn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return kn=!1,LT(t,e,n);kn=!!(t.flags&131072)}else kn=!1,dt&&e.flags&1048576&&Mv(e,Lc,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;cc(t,e),t=e.pendingProps;var s=ca(e,un.current);na(e,n),s=zm(null,e,r,t,s,n);var i=Wm();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,An(r)?(i=!0,Dc(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Vm(e),s.updater=_u,e.stateNode=s,s._reactInternals=e,_h(e,r,t,n),e=Ch(null,e,r,!0,i,n)):(e.tag=0,dt&&i&&Pm(e),yn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(cc(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=JT(r),t=ir(r,t),s){case 0:e=Th(null,e,r,t,n);break e;case 1:e=Lg(null,e,r,t,n);break e;case 11:e=Dg(null,e,r,t,n);break e;case 14:e=Mg(null,e,r,ir(r.type,t),n);break e}throw Error(Y(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ir(r,s),Th(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ir(r,s),Lg(t,e,r,s,n);case 3:e:{if(fx(e),t===null)throw Error(Y(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Uv(t,e),Fc(e,r,null,n);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=ma(Error(Y(423)),e),e=Og(t,e,r,n,s);break e}else if(r!==s){s=ma(Error(Y(424)),e),e=Og(t,e,r,n,s);break e}else for(Vn=As(e.stateNode.containerInfo.firstChild),$n=e,dt=!0,or=null,n=Fv(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ua(),r===s){e=Gr(t,e,n);break e}yn(t,e,r,n)}e=e.child}return e;case 5:return Bv(e),t===null&&xh(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,a=s.children,fh(r,s)?a=null:i!==null&&fh(r,i)&&(e.flags|=32),mx(t,e),yn(t,e,a,n),e.child;case 6:return t===null&&xh(e),null;case 13:return px(t,e,n);case 4:return Fm(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=da(e,null,r,n):yn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ir(r,s),Dg(t,e,r,s,n);case 7:return yn(t,e,e.pendingProps,n),e.child;case 8:return yn(t,e,e.pendingProps.children,n),e.child;case 12:return yn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,nt(Oc,r._currentValue),r._currentValue=a,i!==null)if(dr(i.value,a)){if(i.children===s.children&&!In.current){e=Gr(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var c=i.dependencies;if(c!==null){a=i.child;for(var u=c.firstContext;u!==null;){if(u.context===r){if(i.tag===1){u=Ur(-1,n&-n),u.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?u.next=u:(u.next=h.next,h.next=u),d.pending=u}}i.lanes|=n,u=i.alternate,u!==null&&(u.lanes|=n),wh(i.return,n,e),c.lanes|=n;break}u=u.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(Y(341));a.lanes|=n,c=a.alternate,c!==null&&(c.lanes|=n),wh(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}yn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,na(e,n),s=Jn(s),r=r(s),e.flags|=1,yn(t,e,r,n),e.child;case 14:return r=e.type,s=ir(r,e.pendingProps),s=ir(r.type,s),Mg(t,e,r,s,n);case 15:return dx(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ir(r,s),cc(t,e),e.tag=1,An(r)?(t=!0,Dc(e)):t=!1,na(e,n),lx(e,r,s),_h(e,r,s,n),Ch(null,e,r,!0,t,n);case 19:return gx(t,e,n);case 22:return hx(t,e,n)}throw Error(Y(156,e.tag))};function Rx(t,e){return iv(t,e)}function YT(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kn(t,e,n,r){return new YT(t,e,n,r)}function ef(t){return t=t.prototype,!(!t||!t.isReactComponent)}function JT(t){if(typeof t=="function")return ef(t)?1:0;if(t!=null){if(t=t.$$typeof,t===xm)return 11;if(t===wm)return 14}return 2}function Ds(t,e){var n=t.alternate;return n===null?(n=Kn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function hc(t,e,n,r,s,i){var a=2;if(r=t,typeof t=="function")ef(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case $i:return hi(n.children,s,i,e);case vm:a=8,s|=8;break;case qd:return t=Kn(12,n,e,s|2),t.elementType=qd,t.lanes=i,t;case Gd:return t=Kn(13,n,e,s),t.elementType=Gd,t.lanes=i,t;case Kd:return t=Kn(19,n,e,s),t.elementType=Kd,t.lanes=i,t;case B0:return Cu(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case $0:a=10;break e;case U0:a=9;break e;case xm:a=11;break e;case wm:a=14;break e;case ps:a=16,r=null;break e}throw Error(Y(130,t==null?t:typeof t,""))}return e=Kn(a,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function hi(t,e,n,r){return t=Kn(7,t,r,e),t.lanes=n,t}function Cu(t,e,n,r){return t=Kn(22,t,r,e),t.elementType=B0,t.lanes=n,t.stateNode={isHidden:!1},t}function kd(t,e,n){return t=Kn(6,t,null,e),t.lanes=n,t}function Id(t,e,n){return e=Kn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function XT(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cd(0),this.expirationTimes=cd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cd(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function tf(t,e,n,r,s,i,a,c,u){return t=new XT(t,e,n,c,u),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Kn(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Vm(i),t}function ZT(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fi,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function jx(t){if(!t)return Us;t=t._reactInternals;e:{if(Si(t)!==t||t.tag!==1)throw Error(Y(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(An(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Y(171))}if(t.tag===1){var n=t.type;if(An(n))return jv(t,n,e)}return e}function Dx(t,e,n,r,s,i,a,c,u){return t=tf(n,r,!0,t,s,i,a,c,u),t.context=jx(null),n=t.current,r=vn(),s=js(n),i=Ur(r,s),i.callback=e??null,Ps(n,i,s),t.current.lanes=s,el(t,s,r),Pn(t,r),t}function Su(t,e,n,r){var s=e.current,i=vn(),a=js(s);return n=jx(n),e.context===null?e.context=n:e.pendingContext=n,e=Ur(i,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Ps(s,e,a),t!==null&&(cr(t,s,a,i),ac(t,s,a)),a}function Gc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Gg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function nf(t,e){Gg(t,e),(t=t.alternate)&&Gg(t,e)}function eC(){return null}var Mx=typeof reportError=="function"?reportError:function(t){console.error(t)};function rf(t){this._internalRoot=t}Nu.prototype.render=rf.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Y(409));Su(t,e,null,null)};Nu.prototype.unmount=rf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;vi(function(){Su(null,t,null,null)}),e[Hr]=null}};function Nu(t){this._internalRoot=t}Nu.prototype.unstable_scheduleHydration=function(t){if(t){var e=hv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ys.length&&e!==0&&e<ys[n].priority;n++);ys.splice(n,0,t),n===0&&fv(t)}};function sf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ku(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Kg(){}function tC(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=Gc(a);i.call(d)}}var a=Dx(e,r,t,0,null,!1,!1,"",Kg);return t._reactRootContainer=a,t[Hr]=a.current,Po(t.nodeType===8?t.parentNode:t),vi(),a}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var c=r;r=function(){var d=Gc(u);c.call(d)}}var u=tf(t,0,!1,null,null,!1,!1,"",Kg);return t._reactRootContainer=u,t[Hr]=u.current,Po(t.nodeType===8?t.parentNode:t),vi(function(){Su(e,u,n,r)}),u}function Iu(t,e,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var c=s;s=function(){var u=Gc(a);c.call(u)}}Su(e,a,t,s)}else a=tC(n,e,t,s,r);return Gc(a)}uv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=eo(e.pendingLanes);n!==0&&(Em(e,n|1),Pn(e,Et()),!(We&6)&&(fa=Et()+500,Ks()))}break;case 13:vi(function(){var r=qr(t,1);if(r!==null){var s=vn();cr(r,t,1,s)}}),nf(t,1)}};Tm=function(t){if(t.tag===13){var e=qr(t,134217728);if(e!==null){var n=vn();cr(e,t,134217728,n)}nf(t,134217728)}};dv=function(t){if(t.tag===13){var e=js(t),n=qr(t,e);if(n!==null){var r=vn();cr(n,t,e,r)}nf(t,e)}};hv=function(){return Qe};mv=function(t,e){var n=Qe;try{return Qe=t,e()}finally{Qe=n}};sh=function(t,e,n){switch(e){case"input":if(Jd(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=xu(r);if(!s)throw Error(Y(90));W0(r),Jd(r,s)}}}break;case"textarea":q0(t,n);break;case"select":e=n.value,e!=null&&Xi(t,!!n.multiple,e,!1)}};Z0=Jm;ev=vi;var nC={usingClientEntryPoint:!1,Events:[nl,Wi,xu,J0,X0,Jm]},Ya={findFiberByHostInstance:oi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},rC={bundleType:Ya.bundleType,version:Ya.version,rendererPackageName:Ya.rendererPackageName,rendererConfig:Ya.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Zr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=rv(t),t===null?null:t.stateNode},findFiberByHostInstance:Ya.findFiberByHostInstance||eC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Kl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Kl.isDisabled&&Kl.supportsFiber)try{pu=Kl.inject(rC),_r=Kl}catch{}}Bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nC;Bn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!sf(e))throw Error(Y(200));return ZT(t,e,null,n)};Bn.createRoot=function(t,e){if(!sf(t))throw Error(Y(299));var n=!1,r="",s=Mx;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=tf(t,1,!1,null,null,n,!1,r,s),t[Hr]=e.current,Po(t.nodeType===8?t.parentNode:t),new rf(e)};Bn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Y(188)):(t=Object.keys(t).join(","),Error(Y(268,t)));return t=rv(e),t=t===null?null:t.stateNode,t};Bn.flushSync=function(t){return vi(t)};Bn.hydrate=function(t,e,n){if(!ku(e))throw Error(Y(200));return Iu(null,t,e,!0,n)};Bn.hydrateRoot=function(t,e,n){if(!sf(t))throw Error(Y(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",a=Mx;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=Dx(e,null,t,1,n??null,s,!1,i,a),t[Hr]=e.current,Po(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Nu(e)};Bn.render=function(t,e,n){if(!ku(e))throw Error(Y(200));return Iu(null,t,e,!1,n)};Bn.unmountComponentAtNode=function(t){if(!ku(t))throw Error(Y(40));return t._reactRootContainer?(vi(function(){Iu(null,null,t,!1,function(){t._reactRootContainer=null,t[Hr]=null})}),!0):!1};Bn.unstable_batchedUpdates=Jm;Bn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!ku(n))throw Error(Y(200));if(t==null||t._reactInternals===void 0)throw Error(Y(38));return Iu(t,e,n,!1,r)};Bn.version="18.3.1-next-f1338f8080-20240426";function Lx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Lx)}catch(t){console.error(t)}}Lx(),L0.exports=Bn;var sC=L0.exports,Qg=sC;Wd.createRoot=Qg.createRoot,Wd.hydrateRoot=Qg.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $o(){return $o=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},$o.apply(this,arguments)}var Cs;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Cs||(Cs={}));const Yg="popstate";function iC(t){t===void 0&&(t={});function e(r,s){let{pathname:i,search:a,hash:c}=r.location;return Oh("",{pathname:i,search:a,hash:c},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:Kc(s)}return oC(e,n,null,t)}function Tt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ox(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function aC(){return Math.random().toString(36).substr(2,8)}function Jg(t,e){return{usr:t.state,key:t.key,idx:e}}function Oh(t,e,n,r){return n===void 0&&(n=null),$o({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Sa(e):e,{state:n,key:e&&e.key||r||aC()})}function Kc(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Sa(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function oC(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,c=Cs.Pop,u=null,d=h();d==null&&(d=0,a.replaceState($o({},a.state,{idx:d}),""));function h(){return(a.state||{idx:null}).idx}function f(){c=Cs.Pop;let k=h(),b=k==null?null:k-d;d=k,u&&u({action:c,location:y.location,delta:b})}function g(k,b){c=Cs.Push;let w=Oh(y.location,k,b);n&&n(w,k),d=h()+1;let I=Jg(w,d),j=y.createHref(w);try{a.pushState(I,"",j)}catch($){if($ instanceof DOMException&&$.name==="DataCloneError")throw $;s.location.assign(j)}i&&u&&u({action:c,location:y.location,delta:1})}function x(k,b){c=Cs.Replace;let w=Oh(y.location,k,b);n&&n(w,k),d=h();let I=Jg(w,d),j=y.createHref(w);a.replaceState(I,"",j),i&&u&&u({action:c,location:y.location,delta:0})}function S(k){let b=s.location.origin!=="null"?s.location.origin:s.location.href,w=typeof k=="string"?k:Kc(k);return w=w.replace(/ $/,"%20"),Tt(b,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,b)}let y={get action(){return c},get location(){return t(s,a)},listen(k){if(u)throw new Error("A history only accepts one active listener");return s.addEventListener(Yg,f),u=k,()=>{s.removeEventListener(Yg,f),u=null}},createHref(k){return e(s,k)},createURL:S,encodeLocation(k){let b=S(k);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:g,replace:x,go(k){return a.go(k)}};return y}var Xg;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Xg||(Xg={}));function lC(t,e,n){return n===void 0&&(n="/"),cC(t,e,n,!1)}function cC(t,e,n,r){let s=typeof e=="string"?Sa(e):e,i=af(s.pathname||"/",n);if(i==null)return null;let a=Vx(t);uC(a);let c=null;for(let u=0;c==null&&u<a.length;++u){let d=bC(i);c=xC(a[u],d,r)}return c}function Vx(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(i,a,c)=>{let u={relativePath:c===void 0?i.path||"":c,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};u.relativePath.startsWith("/")&&(Tt(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=Ms([r,u.relativePath]),h=n.concat(u);i.children&&i.children.length>0&&(Tt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),Vx(i.children,e,h,d)),!(i.path==null&&!i.index)&&e.push({path:d,score:yC(d,i.index),routesMeta:h})};return t.forEach((i,a)=>{var c;if(i.path===""||!((c=i.path)!=null&&c.includes("?")))s(i,a);else for(let u of Fx(i.path))s(i,a,u)}),e}function Fx(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let a=Fx(r.join("/")),c=[];return c.push(...a.map(u=>u===""?i:[i,u].join("/"))),s&&c.push(...a),c.map(u=>t.startsWith("/")&&u===""?"/":u)}function uC(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:vC(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const dC=/^:[\w-]+$/,hC=3,mC=2,fC=1,pC=10,gC=-2,Zg=t=>t==="*";function yC(t,e){let n=t.split("/"),r=n.length;return n.some(Zg)&&(r+=gC),e&&(r+=mC),n.filter(s=>!Zg(s)).reduce((s,i)=>s+(dC.test(i)?hC:i===""?fC:pC),r)}function vC(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function xC(t,e,n){n===void 0&&(n=!1);let{routesMeta:r}=t,s={},i="/",a=[];for(let c=0;c<r.length;++c){let u=r[c],d=c===r.length-1,h=i==="/"?e:e.slice(i.length)||"/",f=ey({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},h),g=u.route;if(!f&&d&&n&&!r[r.length-1].route.index&&(f=ey({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},h)),!f)return null;Object.assign(s,f.params),a.push({params:s,pathname:Ms([i,f.pathname]),pathnameBase:CC(Ms([i,f.pathnameBase])),route:g}),f.pathnameBase!=="/"&&(i=Ms([i,f.pathnameBase]))}return a}function ey(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=wC(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),c=s.slice(1);return{params:r.reduce((d,h,f)=>{let{paramName:g,isOptional:x}=h;if(g==="*"){let y=c[f]||"";a=i.slice(0,i.length-y.length).replace(/(.)\/+$/,"$1")}const S=c[f];return x&&!S?d[g]=void 0:d[g]=(S||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:a,pattern:t}}function wC(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Ox(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,c,u)=>(r.push({paramName:c,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function bC(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ox(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function af(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function _C(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Sa(t):t;return{pathname:n?n.startsWith("/")?n:EC(n,e):e,search:SC(r),hash:NC(s)}}function EC(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function Ad(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function TC(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function of(t,e){let n=TC(t);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function lf(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=Sa(t):(s=$o({},t),Tt(!s.pathname||!s.pathname.includes("?"),Ad("?","pathname","search",s)),Tt(!s.pathname||!s.pathname.includes("#"),Ad("#","pathname","hash",s)),Tt(!s.search||!s.search.includes("#"),Ad("#","search","hash",s)));let i=t===""||s.pathname==="",a=i?"/":s.pathname,c;if(a==null)c=n;else{let f=e.length-1;if(!r&&a.startsWith("..")){let g=a.split("/");for(;g[0]==="..";)g.shift(),f-=1;s.pathname=g.join("/")}c=f>=0?e[f]:"/"}let u=_C(s,c),d=a&&a!=="/"&&a.endsWith("/"),h=(i||a===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(d||h)&&(u.pathname+="/"),u}const Ms=t=>t.join("/").replace(/\/\/+/g,"/"),CC=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),SC=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,NC=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function kC(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const $x=["post","put","patch","delete"];new Set($x);const IC=["get",...$x];new Set(IC);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Uo(){return Uo=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Uo.apply(this,arguments)}const cf=P.createContext(null),AC=P.createContext(null),Qs=P.createContext(null),Au=P.createContext(null),es=P.createContext({outlet:null,matches:[],isDataRoute:!1}),Ux=P.createContext(null);function PC(t,e){let{relative:n}=e===void 0?{}:e;Na()||Tt(!1);let{basename:r,navigator:s}=P.useContext(Qs),{hash:i,pathname:a,search:c}=zx(t,{relative:n}),u=a;return r!=="/"&&(u=a==="/"?r:Ms([r,a])),s.createHref({pathname:u,search:c,hash:i})}function Na(){return P.useContext(Au)!=null}function Ys(){return Na()||Tt(!1),P.useContext(Au).location}function Bx(t){P.useContext(Qs).static||P.useLayoutEffect(t)}function Zn(){let{isDataRoute:t}=P.useContext(es);return t?WC():RC()}function RC(){Na()||Tt(!1);let t=P.useContext(cf),{basename:e,future:n,navigator:r}=P.useContext(Qs),{matches:s}=P.useContext(es),{pathname:i}=Ys(),a=JSON.stringify(of(s,n.v7_relativeSplatPath)),c=P.useRef(!1);return Bx(()=>{c.current=!0}),P.useCallback(function(d,h){if(h===void 0&&(h={}),!c.current)return;if(typeof d=="number"){r.go(d);return}let f=lf(d,JSON.parse(a),i,h.relative==="path");t==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:Ms([e,f.pathname])),(h.replace?r.replace:r.push)(f,h.state,h)},[e,r,a,i,t])}function uf(){let{matches:t}=P.useContext(es),e=t[t.length-1];return e?e.params:{}}function zx(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=P.useContext(Qs),{matches:s}=P.useContext(es),{pathname:i}=Ys(),a=JSON.stringify(of(s,r.v7_relativeSplatPath));return P.useMemo(()=>lf(t,JSON.parse(a),i,n==="path"),[t,a,i,n])}function jC(t,e){return DC(t,e)}function DC(t,e,n,r){Na()||Tt(!1);let{navigator:s}=P.useContext(Qs),{matches:i}=P.useContext(es),a=i[i.length-1],c=a?a.params:{};a&&a.pathname;let u=a?a.pathnameBase:"/";a&&a.route;let d=Ys(),h;if(e){var f;let k=typeof e=="string"?Sa(e):e;u==="/"||(f=k.pathname)!=null&&f.startsWith(u)||Tt(!1),h=k}else h=d;let g=h.pathname||"/",x=g;if(u!=="/"){let k=u.replace(/^\//,"").split("/");x="/"+g.replace(/^\//,"").split("/").slice(k.length).join("/")}let S=lC(t,{pathname:x}),y=FC(S&&S.map(k=>Object.assign({},k,{params:Object.assign({},c,k.params),pathname:Ms([u,s.encodeLocation?s.encodeLocation(k.pathname).pathname:k.pathname]),pathnameBase:k.pathnameBase==="/"?u:Ms([u,s.encodeLocation?s.encodeLocation(k.pathnameBase).pathname:k.pathnameBase])})),i,n,r);return e&&y?P.createElement(Au.Provider,{value:{location:Uo({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Cs.Pop}},y):y}function MC(){let t=zC(),e=kC(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return P.createElement(P.Fragment,null,P.createElement("h2",null,"Unexpected Application Error!"),P.createElement("h3",{style:{fontStyle:"italic"}},e),n?P.createElement("pre",{style:s},n):null,i)}const LC=P.createElement(MC,null);class OC extends P.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?P.createElement(es.Provider,{value:this.props.routeContext},P.createElement(Ux.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function VC(t){let{routeContext:e,match:n,children:r}=t,s=P.useContext(cf);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),P.createElement(es.Provider,{value:e},r)}function FC(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var i;if(!n)return null;if(n.errors)t=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let a=t,c=(s=n)==null?void 0:s.errors;if(c!=null){let h=a.findIndex(f=>f.route.id&&(c==null?void 0:c[f.route.id])!==void 0);h>=0||Tt(!1),a=a.slice(0,Math.min(a.length,h+1))}let u=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let h=0;h<a.length;h++){let f=a[h];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(d=h),f.route.id){let{loaderData:g,errors:x}=n,S=f.route.loader&&g[f.route.id]===void 0&&(!x||x[f.route.id]===void 0);if(f.route.lazy||S){u=!0,d>=0?a=a.slice(0,d+1):a=[a[0]];break}}}return a.reduceRight((h,f,g)=>{let x,S=!1,y=null,k=null;n&&(x=c&&f.route.id?c[f.route.id]:void 0,y=f.route.errorElement||LC,u&&(d<0&&g===0?(HC("route-fallback",!1),S=!0,k=null):d===g&&(S=!0,k=f.route.hydrateFallbackElement||null)));let b=e.concat(a.slice(0,g+1)),w=()=>{let I;return x?I=y:S?I=k:f.route.Component?I=P.createElement(f.route.Component,null):f.route.element?I=f.route.element:I=h,P.createElement(VC,{match:f,routeContext:{outlet:h,matches:b,isDataRoute:n!=null},children:I})};return n&&(f.route.ErrorBoundary||f.route.errorElement||g===0)?P.createElement(OC,{location:n.location,revalidation:n.revalidation,component:y,error:x,children:w(),routeContext:{outlet:null,matches:b,isDataRoute:!0}}):w()},null)}var Wx=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Wx||{}),Qc=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Qc||{});function $C(t){let e=P.useContext(cf);return e||Tt(!1),e}function UC(t){let e=P.useContext(AC);return e||Tt(!1),e}function BC(t){let e=P.useContext(es);return e||Tt(!1),e}function Hx(t){let e=BC(),n=e.matches[e.matches.length-1];return n.route.id||Tt(!1),n.route.id}function zC(){var t;let e=P.useContext(Ux),n=UC(Qc.UseRouteError),r=Hx(Qc.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function WC(){let{router:t}=$C(Wx.UseNavigateStable),e=Hx(Qc.UseNavigateStable),n=P.useRef(!1);return Bx(()=>{n.current=!0}),P.useCallback(function(s,i){i===void 0&&(i={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,Uo({fromRouteId:e},i)))},[t,e])}const ty={};function HC(t,e,n){!e&&!ty[t]&&(ty[t]=!0)}function qC(t,e){t==null||t.v7_startTransition,(t==null?void 0:t.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function qx(t){let{to:e,replace:n,state:r,relative:s}=t;Na()||Tt(!1);let{future:i,static:a}=P.useContext(Qs),{matches:c}=P.useContext(es),{pathname:u}=Ys(),d=Zn(),h=lf(e,of(c,i.v7_relativeSplatPath),u,s==="path"),f=JSON.stringify(h);return P.useEffect(()=>d(JSON.parse(f),{replace:n,state:r,relative:s}),[d,f,s,n,r]),null}function Ln(t){Tt(!1)}function GC(t){let{basename:e="/",children:n=null,location:r,navigationType:s=Cs.Pop,navigator:i,static:a=!1,future:c}=t;Na()&&Tt(!1);let u=e.replace(/^\/*/,"/"),d=P.useMemo(()=>({basename:u,navigator:i,static:a,future:Uo({v7_relativeSplatPath:!1},c)}),[u,c,i,a]);typeof r=="string"&&(r=Sa(r));let{pathname:h="/",search:f="",hash:g="",state:x=null,key:S="default"}=r,y=P.useMemo(()=>{let k=af(h,u);return k==null?null:{location:{pathname:k,search:f,hash:g,state:x,key:S},navigationType:s}},[u,h,f,g,x,S,s]);return y==null?null:P.createElement(Qs.Provider,{value:d},P.createElement(Au.Provider,{children:n,value:y}))}function KC(t){let{children:e,location:n}=t;return jC(Vh(e),n)}new Promise(()=>{});function Vh(t,e){e===void 0&&(e=[]);let n=[];return P.Children.forEach(t,(r,s)=>{if(!P.isValidElement(r))return;let i=[...e,s];if(r.type===P.Fragment){n.push.apply(n,Vh(r.props.children,i));return}r.type!==Ln&&Tt(!1),!r.props.index||!r.props.children||Tt(!1);let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Vh(r.props.children,i)),n.push(a)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Fh(){return Fh=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Fh.apply(this,arguments)}function QC(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function YC(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function JC(t,e){return t.button===0&&(!e||e==="_self")&&!YC(t)}const XC=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],ZC="6";try{window.__reactRouterVersion=ZC}catch{}const e1="startTransition",ny=G_[e1];function t1(t){let{basename:e,children:n,future:r,window:s}=t,i=P.useRef();i.current==null&&(i.current=iC({window:s,v5Compat:!0}));let a=i.current,[c,u]=P.useState({action:a.action,location:a.location}),{v7_startTransition:d}=r||{},h=P.useCallback(f=>{d&&ny?ny(()=>u(f)):u(f)},[u,d]);return P.useLayoutEffect(()=>a.listen(h),[a,h]),P.useEffect(()=>qC(r),[r]),P.createElement(GC,{basename:e,children:n,location:c.location,navigationType:c.action,navigator:a,future:r})}const n1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",r1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,xr=P.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:i,replace:a,state:c,target:u,to:d,preventScrollReset:h,viewTransition:f}=e,g=QC(e,XC),{basename:x}=P.useContext(Qs),S,y=!1;if(typeof d=="string"&&r1.test(d)&&(S=d,n1))try{let I=new URL(window.location.href),j=d.startsWith("//")?new URL(I.protocol+d):new URL(d),$=af(j.pathname,x);j.origin===I.origin&&$!=null?d=$+j.search+j.hash:y=!0}catch{}let k=PC(d,{relative:s}),b=s1(d,{replace:a,state:c,target:u,preventScrollReset:h,relative:s,viewTransition:f});function w(I){r&&r(I),I.defaultPrevented||b(I)}return P.createElement("a",Fh({},g,{href:S||k,onClick:y||i?r:w,ref:n,target:u}))});var ry;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(ry||(ry={}));var sy;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(sy||(sy={}));function s1(t,e){let{target:n,replace:r,state:s,preventScrollReset:i,relative:a,viewTransition:c}=e===void 0?{}:e,u=Zn(),d=Ys(),h=zx(t,{relative:a});return P.useCallback(f=>{if(JC(f,n)){f.preventDefault();let g=r!==void 0?r:Kc(d)===Kc(h);u(t,{replace:g,state:s,preventScrollReset:i,relative:a,viewTransition:c})}},[d,u,h,r,s,n,t,i,a,c])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gx=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},i1=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],a=t[n++],c=t[n++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=t[n++],a=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},Kx={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],a=s+1<t.length,c=a?t[s+1]:0,u=s+2<t.length,d=u?t[s+2]:0,h=i>>2,f=(i&3)<<4|c>>4;let g=(c&15)<<2|d>>6,x=d&63;u||(x=64,a||(g=64)),r.push(n[h],n[f],n[g],n[x])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Gx(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):i1(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],c=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const f=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||c==null||d==null||f==null)throw new a1;const g=i<<2|c>>4;if(r.push(g),d!==64){const x=c<<4&240|d>>2;if(r.push(x),f!==64){const S=d<<6&192|f;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class a1 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o1=function(t){const e=Gx(t);return Kx.encodeByteArray(e,!0)},Yc=function(t){return o1(t).replace(/\./g,"")},Qx=function(t){try{return Kx.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l1(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c1=()=>l1().__FIREBASE_DEFAULTS__,u1=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},d1=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Qx(t[1]);return e&&JSON.parse(e)},Pu=()=>{try{return c1()||u1()||d1()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Yx=t=>{var e,n;return(n=(e=Pu())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},h1=t=>{const e=Yx(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Jx=()=>{var t;return(t=Pu())===null||t===void 0?void 0:t.config},Xx=t=>{var e;return(e=Pu())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m1{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f1(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t),c="";return[Yc(JSON.stringify(n)),Yc(JSON.stringify(a)),c].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function p1(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(dn())}function g1(){var t;const e=(t=Pu())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function y1(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function v1(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function x1(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function w1(){const t=dn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function b1(){return!g1()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _1(){try{return typeof indexedDB=="object"}catch{return!1}}function E1(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T1="FirebaseError";class ts extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=T1,Object.setPrototypeOf(this,ts.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,sl.prototype.create)}}class sl{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?C1(i,r):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new ts(s,c,r)}}function C1(t,e){return t.replace(S1,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const S1=/\{\$([^}]+)}/g;function N1(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Jc(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],a=e[s];if(iy(i)&&iy(a)){if(!Jc(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function iy(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function il(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function no(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function ro(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function k1(t,e){const n=new I1(t,e);return n.subscribe.bind(n)}class I1{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");A1(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Pd),s.error===void 0&&(s.error=Pd),s.complete===void 0&&(s.complete=Pd);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function A1(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Pd(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function It(t){return t&&t._delegate?t._delegate:t}class xi{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ii="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new m1;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(j1(e))try{this.getOrInitializeService({instanceIdentifier:ii})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ii){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ii){return this.instances.has(e)}getOptions(e=ii){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);r===c&&a.resolve(s)}return s}onInit(e,n){var r;const s=this.normalizeInstanceIdentifier(n),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const a=this.instances.get(s);return a&&e(a,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:R1(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ii){return this.component?this.component.multipleInstances?e:ii:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function R1(t){return t===ii?void 0:t}function j1(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new P1(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ue;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Ue||(Ue={}));const M1={debug:Ue.DEBUG,verbose:Ue.VERBOSE,info:Ue.INFO,warn:Ue.WARN,error:Ue.ERROR,silent:Ue.SILENT},L1=Ue.INFO,O1={[Ue.DEBUG]:"log",[Ue.VERBOSE]:"log",[Ue.INFO]:"info",[Ue.WARN]:"warn",[Ue.ERROR]:"error"},V1=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=O1[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class df{constructor(e){this.name=e,this._logLevel=L1,this._logHandler=V1,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ue))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?M1[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ue.DEBUG,...e),this._logHandler(this,Ue.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ue.VERBOSE,...e),this._logHandler(this,Ue.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ue.INFO,...e),this._logHandler(this,Ue.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ue.WARN,...e),this._logHandler(this,Ue.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ue.ERROR,...e),this._logHandler(this,Ue.ERROR,...e)}}const F1=(t,e)=>e.some(n=>t instanceof n);let ay,oy;function $1(){return ay||(ay=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function U1(){return oy||(oy=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Zx=new WeakMap,$h=new WeakMap,ew=new WeakMap,Rd=new WeakMap,hf=new WeakMap;function B1(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",a)},i=()=>{n(Ls(t.result)),s()},a=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",a)});return e.then(n=>{n instanceof IDBCursor&&Zx.set(n,t)}).catch(()=>{}),hf.set(e,t),e}function z1(t){if($h.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",a),t.removeEventListener("abort",a)},i=()=>{n(),s()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",a),t.addEventListener("abort",a)});$h.set(t,e)}let Uh={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return $h.get(t);if(e==="objectStoreNames")return t.objectStoreNames||ew.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ls(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function W1(t){Uh=t(Uh)}function H1(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(jd(this),e,...n);return ew.set(r,e.sort?e.sort():[e]),Ls(r)}:U1().includes(t)?function(...e){return t.apply(jd(this),e),Ls(Zx.get(this))}:function(...e){return Ls(t.apply(jd(this),e))}}function q1(t){return typeof t=="function"?H1(t):(t instanceof IDBTransaction&&z1(t),F1(t,$1())?new Proxy(t,Uh):t)}function Ls(t){if(t instanceof IDBRequest)return B1(t);if(Rd.has(t))return Rd.get(t);const e=q1(t);return e!==t&&(Rd.set(t,e),hf.set(e,t)),e}const jd=t=>hf.get(t);function G1(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(t,e),c=Ls(a);return r&&a.addEventListener("upgradeneeded",u=>{r(Ls(a.result),u.oldVersion,u.newVersion,Ls(a.transaction),u)}),n&&a.addEventListener("blocked",u=>n(u.oldVersion,u.newVersion,u)),c.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const K1=["get","getKey","getAll","getAllKeys","count"],Q1=["put","add","delete","clear"],Dd=new Map;function ly(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Dd.get(e))return Dd.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=Q1.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||K1.includes(n)))return;const i=async function(a,...c){const u=this.transaction(a,s?"readwrite":"readonly");let d=u.store;return r&&(d=d.index(c.shift())),(await Promise.all([d[n](...c),s&&u.done]))[0]};return Dd.set(e,i),i}W1(t=>({...t,get:(e,n,r)=>ly(e,n)||t.get(e,n,r),has:(e,n)=>!!ly(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y1{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(J1(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function J1(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Bh="@firebase/app",cy="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kr=new df("@firebase/app"),X1="@firebase/app-compat",Z1="@firebase/analytics-compat",eS="@firebase/analytics",tS="@firebase/app-check-compat",nS="@firebase/app-check",rS="@firebase/auth",sS="@firebase/auth-compat",iS="@firebase/database",aS="@firebase/data-connect",oS="@firebase/database-compat",lS="@firebase/functions",cS="@firebase/functions-compat",uS="@firebase/installations",dS="@firebase/installations-compat",hS="@firebase/messaging",mS="@firebase/messaging-compat",fS="@firebase/performance",pS="@firebase/performance-compat",gS="@firebase/remote-config",yS="@firebase/remote-config-compat",vS="@firebase/storage",xS="@firebase/storage-compat",wS="@firebase/firestore",bS="@firebase/vertexai-preview",_S="@firebase/firestore-compat",ES="firebase",TS="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zh="[DEFAULT]",CS={[Bh]:"fire-core",[X1]:"fire-core-compat",[eS]:"fire-analytics",[Z1]:"fire-analytics-compat",[nS]:"fire-app-check",[tS]:"fire-app-check-compat",[rS]:"fire-auth",[sS]:"fire-auth-compat",[iS]:"fire-rtdb",[aS]:"fire-data-connect",[oS]:"fire-rtdb-compat",[lS]:"fire-fn",[cS]:"fire-fn-compat",[uS]:"fire-iid",[dS]:"fire-iid-compat",[hS]:"fire-fcm",[mS]:"fire-fcm-compat",[fS]:"fire-perf",[pS]:"fire-perf-compat",[gS]:"fire-rc",[yS]:"fire-rc-compat",[vS]:"fire-gcs",[xS]:"fire-gcs-compat",[wS]:"fire-fst",[_S]:"fire-fst-compat",[bS]:"fire-vertex","fire-js":"fire-js",[ES]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xc=new Map,SS=new Map,Wh=new Map;function uy(t,e){try{t.container.addComponent(e)}catch(n){Kr.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function pa(t){const e=t.name;if(Wh.has(e))return Kr.debug(`There were multiple attempts to register component ${e}.`),!1;Wh.set(e,t);for(const n of Xc.values())uy(n,t);for(const n of SS.values())uy(n,t);return!0}function mf(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function br(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Os=new sl("app","Firebase",NS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kS{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new xi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Os.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ka=TS;function tw(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:zh,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Os.create("bad-app-name",{appName:String(s)});if(n||(n=Jx()),!n)throw Os.create("no-options");const i=Xc.get(s);if(i){if(Jc(n,i.options)&&Jc(r,i.config))return i;throw Os.create("duplicate-app",{appName:s})}const a=new D1(s);for(const u of Wh.values())a.addComponent(u);const c=new kS(n,r,a);return Xc.set(s,c),c}function nw(t=zh){const e=Xc.get(t);if(!e&&t===zh&&Jx())return tw();if(!e)throw Os.create("no-app",{appName:t});return e}function Vs(t,e,n){var r;let s=(r=CS[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const c=[`Unable to register library "${s}" with version "${e}":`];i&&c.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&a&&c.push("and"),a&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Kr.warn(c.join(" "));return}pa(new xi(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IS="firebase-heartbeat-database",AS=1,Bo="firebase-heartbeat-store";let Md=null;function rw(){return Md||(Md=G1(IS,AS,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Bo)}catch(n){console.warn(n)}}}}).catch(t=>{throw Os.create("idb-open",{originalErrorMessage:t.message})})),Md}async function PS(t){try{const n=(await rw()).transaction(Bo),r=await n.objectStore(Bo).get(sw(t));return await n.done,r}catch(e){if(e instanceof ts)Kr.warn(e.message);else{const n=Os.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Kr.warn(n.message)}}}async function dy(t,e){try{const r=(await rw()).transaction(Bo,"readwrite");await r.objectStore(Bo).put(e,sw(t)),await r.done}catch(n){if(n instanceof ts)Kr.warn(n.message);else{const r=Os.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Kr.warn(r.message)}}}function sw(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RS=1024,jS=30*24*60*60*1e3;class DS{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new LS(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=hy();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const c=new Date(a.date).valueOf();return Date.now()-c<=jS}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Kr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=hy(),{heartbeatsToSend:r,unsentEntries:s}=MS(this._heartbeatsCache.heartbeats),i=Yc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Kr.warn(n),""}}}function hy(){return new Date().toISOString().substring(0,10)}function MS(t,e=RS){const n=[];let r=t.slice();for(const s of t){const i=n.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),my(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),my(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class LS{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return _1()?E1().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await PS(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return dy(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return dy(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function my(t){return Yc(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OS(t){pa(new xi("platform-logger",e=>new Y1(e),"PRIVATE")),pa(new xi("heartbeat",e=>new DS(e),"PRIVATE")),Vs(Bh,cy,t),Vs(Bh,cy,"esm2017"),Vs("fire-js","")}OS("");function ff(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function iw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const VS=iw,aw=new sl("auth","Firebase",iw());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zc=new df("@firebase/auth");function FS(t,...e){Zc.logLevel<=Ue.WARN&&Zc.warn(`Auth (${ka}): ${t}`,...e)}function mc(t,...e){Zc.logLevel<=Ue.ERROR&&Zc.error(`Auth (${ka}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hr(t,...e){throw pf(t,...e)}function Tr(t,...e){return pf(t,...e)}function ow(t,e,n){const r=Object.assign(Object.assign({},VS()),{[e]:n});return new sl("auth","Firebase",r).create(e,{appName:t.name})}function Br(t){return ow(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function pf(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return aw.create(t,...e)}function be(t,e,...n){if(!t)throw pf(e,...n)}function Vr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw mc(e),new Error(e)}function Qr(t,e){t||Vr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hh(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function $S(){return fy()==="http:"||fy()==="https:"}function fy(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function US(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&($S()||v1()||"connection"in navigator)?navigator.onLine:!0}function BS(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(e,n){this.shortDelay=e,this.longDelay=n,Qr(n>e,"Short delay should be less than long delay!"),this.isMobile=p1()||x1()}get(){return US()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gf(t,e){Qr(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lw{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Vr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Vr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Vr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zS={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WS=new al(3e4,6e4);function ns(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function rs(t,e,n,r,s={}){return cw(t,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const c=il(Object.assign({key:t.config.apiKey},a)).slice(1),u=await t._getAdditionalHeaders();u["Content-Type"]="application/json",t.languageCode&&(u["X-Firebase-Locale"]=t.languageCode);const d=Object.assign({method:e,headers:u},i);return y1()||(d.referrerPolicy="no-referrer"),lw.fetch()(uw(t,t.config.apiHost,n,c),d)})}async function cw(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},zS),e);try{const s=new qS(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Ql(t,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const c=i.ok?a.errorMessage:a.error.message,[u,d]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ql(t,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw Ql(t,"email-already-in-use",a);if(u==="USER_DISABLED")throw Ql(t,"user-disabled",a);const h=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw ow(t,h,d);hr(t,h)}}catch(s){if(s instanceof ts)throw s;hr(t,"network-request-failed",{message:String(s)})}}async function ol(t,e,n,r,s={}){const i=await rs(t,e,n,r,s);return"mfaPendingCredential"in i&&hr(t,"multi-factor-auth-required",{_serverResponse:i}),i}function uw(t,e,n,r){const s=`${e}${n}?${r}`;return t.config.emulator?gf(t.config,s):`${t.config.apiScheme}://${s}`}function HS(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class qS{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Tr(this.auth,"network-request-failed")),WS.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ql(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Tr(t,e,r);return s.customData._tokenResponse=n,s}function py(t){return t!==void 0&&t.enterprise!==void 0}class GS{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return HS(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function KS(t,e){return rs(t,"GET","/v2/recaptchaConfig",ns(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QS(t,e){return rs(t,"POST","/v1/accounts:delete",e)}async function dw(t,e){return rs(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vo(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function YS(t,e=!1){const n=It(t),r=await n.getIdToken(e),s=yf(r);be(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:vo(Ld(s.auth_time)),issuedAtTime:vo(Ld(s.iat)),expirationTime:vo(Ld(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Ld(t){return Number(t)*1e3}function yf(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return mc("JWT malformed, contained fewer than 3 sections"),null;try{const s=Qx(n);return s?JSON.parse(s):(mc("Failed to decode base64 JWT payload"),null)}catch(s){return mc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function gy(t){const e=yf(t);return be(e,"internal-error"),be(typeof e.exp<"u","internal-error"),be(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zo(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof ts&&JS(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function JS({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XS{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qh{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=vo(this.lastLoginAt),this.creationTime=vo(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eu(t){var e;const n=t.auth,r=await t.getIdToken(),s=await zo(t,dw(n,{idToken:r}));be(s==null?void 0:s.users.length,n,"internal-error");const i=s.users[0];t._notifyReloadListener(i);const a=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?hw(i.providerUserInfo):[],c=eN(t.providerData,a),u=t.isAnonymous,d=!(t.email&&i.passwordHash)&&!(c!=null&&c.length),h=u?d:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new qh(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(t,f)}async function ZS(t){const e=It(t);await eu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function eN(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function hw(t){return t.map(e=>{var{providerId:n}=e,r=ff(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tN(t,e){const n=await cw(t,{},async()=>{const r=il({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,a=uw(t,s,"/v1/token",`key=${i}`),c=await t._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",lw.fetch()(a,{method:"POST",headers:c,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function nN(t,e){return rs(t,"POST","/v2/accounts:revokeToken",ns(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){be(e.idToken,"internal-error"),be(typeof e.idToken<"u","internal-error"),be(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):gy(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){be(e.length!==0,"internal-error");const n=gy(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(be(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await tN(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,a=new sa;return r&&(be(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(be(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(be(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new sa,this.toJSON())}_performRefresh(){return Vr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ms(t,e){be(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Fr{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,i=ff(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new XS(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new qh(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await zo(this,this.stsTokenManager.getToken(this.auth,e));return be(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return YS(this,e)}reload(){return ZS(this)}_assign(e){this!==e&&(be(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Fr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){be(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await eu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(br(this.auth.app))return Promise.reject(Br(this.auth));const e=await this.getIdToken();return await zo(this,QS(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,i,a,c,u,d,h;const f=(r=n.displayName)!==null&&r!==void 0?r:void 0,g=(s=n.email)!==null&&s!==void 0?s:void 0,x=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,S=(a=n.photoURL)!==null&&a!==void 0?a:void 0,y=(c=n.tenantId)!==null&&c!==void 0?c:void 0,k=(u=n._redirectEventId)!==null&&u!==void 0?u:void 0,b=(d=n.createdAt)!==null&&d!==void 0?d:void 0,w=(h=n.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:I,emailVerified:j,isAnonymous:$,providerData:H,stsTokenManager:E}=n;be(I&&E,e,"internal-error");const _=sa.fromJSON(this.name,E);be(typeof I=="string",e,"internal-error"),ms(f,e.name),ms(g,e.name),be(typeof j=="boolean",e,"internal-error"),be(typeof $=="boolean",e,"internal-error"),ms(x,e.name),ms(S,e.name),ms(y,e.name),ms(k,e.name),ms(b,e.name),ms(w,e.name);const C=new Fr({uid:I,auth:e,email:g,emailVerified:j,displayName:f,isAnonymous:$,photoURL:S,phoneNumber:x,tenantId:y,stsTokenManager:_,createdAt:b,lastLoginAt:w});return H&&Array.isArray(H)&&(C.providerData=H.map(A=>Object.assign({},A))),k&&(C._redirectEventId=k),C}static async _fromIdTokenResponse(e,n,r=!1){const s=new sa;s.updateFromServerResponse(n);const i=new Fr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await eu(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];be(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?hw(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),c=new sa;c.updateFromIdToken(r);const u=new Fr({uid:s.localId,auth:e,stsTokenManager:c,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new qh(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(u,d),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yy=new Map;function $r(t){Qr(t instanceof Function,"Expected a class definition");let e=yy.get(t);return e?(Qr(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,yy.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}mw.type="NONE";const vy=mw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fc(t,e,n){return`firebase:${t}:${e}:${n}`}class ia{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=fc(this.userKey,s.apiKey,i),this.fullPersistenceKey=fc("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Fr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new ia($r(vy),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||$r(vy);const a=fc(r,e.config.apiKey,e.name);let c=null;for(const d of n)try{const h=await d._get(a);if(h){const f=Fr._fromJSON(e,h);d!==i&&(c=f),i=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new ia(i,e,r):(i=u[0],c&&await i._set(a,c.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new ia(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xy(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(yw(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(fw(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(xw(e))return"Blackberry";if(ww(e))return"Webos";if(pw(e))return"Safari";if((e.includes("chrome/")||gw(e))&&!e.includes("edge/"))return"Chrome";if(vw(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function fw(t=dn()){return/firefox\//i.test(t)}function pw(t=dn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function gw(t=dn()){return/crios\//i.test(t)}function yw(t=dn()){return/iemobile/i.test(t)}function vw(t=dn()){return/android/i.test(t)}function xw(t=dn()){return/blackberry/i.test(t)}function ww(t=dn()){return/webos/i.test(t)}function vf(t=dn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function rN(t=dn()){var e;return vf(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function sN(){return w1()&&document.documentMode===10}function bw(t=dn()){return vf(t)||vw(t)||ww(t)||xw(t)||/windows phone/i.test(t)||yw(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _w(t,e=[]){let n;switch(t){case"Browser":n=xy(dn());break;case"Worker":n=`${xy(dn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${ka}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((a,c)=>{try{const u=e(i);a(u)}catch(u){c(u)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aN(t,e={}){return rs(t,"GET","/v2/passwordPolicy",ns(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oN=6;class lN{constructor(e){var n,r,s,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=a.minPasswordLength)!==null&&n!==void 0?n:oN,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,s,i,a,c;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(n=u.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(s=u.containsLowercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(i=u.containsUppercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(a=u.containsNumericCharacter)!==null&&a!==void 0?a:!0),u.isValid&&(u.isValid=(c=u.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),u}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cN{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new wy(this),this.idTokenSubscription=new wy(this),this.beforeStateQueue=new iN(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=aw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=$r(n)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await ia.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await dw(this,{idToken:e}),r=await Fr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(br(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(c,c))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,c=s==null?void 0:s._redirectEventId,u=await this.tryRedirectSignIn(e);(!a||a===c)&&(u!=null&&u.user)&&(s=u.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return be(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await eu(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=BS()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(br(this.app))return Promise.reject(Br(this));const n=e?It(e):null;return n&&be(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&be(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return br(this.app)?Promise.reject(Br(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return br(this.app)?Promise.reject(Br(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence($r(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await aN(this),n=new lN(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new sl("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await nN(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&$r(e)||this._popupRedirectResolver;be(n,this,"argument-error"),this.redirectPersistenceManager=await ia.create(this,[$r(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let a=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(be(c,this,"internal-error"),c.then(()=>{a||i(this.currentUser)}),typeof n=="function"){const u=e.addObserver(n,r,s);return()=>{a=!0,u()}}else{const u=e.addObserver(n);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return be(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=_w(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&FS(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Ni(t){return It(t)}class wy{constructor(e){this.auth=e,this.observer=null,this.addObserver=k1(n=>this.observer=n)}get next(){return be(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ru={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function uN(t){Ru=t}function Ew(t){return Ru.loadJS(t)}function dN(){return Ru.recaptchaEnterpriseScript}function hN(){return Ru.gapiScript}function mN(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const fN="recaptcha-enterprise",pN="NO_RECAPTCHA";class gN{constructor(e){this.type=fN,this.auth=Ni(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,c)=>{KS(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const d=new GS(u);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(u=>{c(u)})})}function s(i,a,c){const u=window.grecaptcha;py(u)?u.enterprise.ready(()=>{u.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(pN)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,a)=>{r(this.auth).then(c=>{if(!n&&py(window.grecaptcha))s(c,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=dN();u.length!==0&&(u+=c),Ew(u).then(()=>{s(c,i,a)}).catch(d=>{a(d)})}}).catch(c=>{a(c)})})}}async function by(t,e,n,r=!1){const s=new gN(t);let i;try{i=await s.verify(n)}catch{i=await s.verify(n,!0)}const a=Object.assign({},e);return r?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Gh(t,e,n,r){var s;if(!((s=t._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await by(t,e,n,n==="getOobCode");return r(t,i)}else return r(t,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await by(t,e,n,n==="getOobCode");return r(t,a)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yN(t,e){const n=mf(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Jc(i,e??{}))return s;hr(s,"already-initialized")}return n.initialize({options:e})}function vN(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map($r);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function xN(t,e,n){const r=Ni(t);be(r._canInitEmulator,r,"emulator-config-failed"),be(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(n!=null&&n.disableWarnings),i=Tw(e),{host:a,port:c}=wN(e),u=c===null?"":`:${c}`;r.config.emulator={url:`${i}//${a}${u}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||bN()}function Tw(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function wN(t){const e=Tw(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:_y(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:_y(a)}}}function _y(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function bN(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Vr("not implemented")}_getIdTokenResponse(e){return Vr("not implemented")}_linkToIdToken(e,n){return Vr("not implemented")}_getReauthenticationResolver(e){return Vr("not implemented")}}async function _N(t,e){return rs(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EN(t,e){return ol(t,"POST","/v1/accounts:signInWithPassword",ns(t,e))}async function TN(t,e){return rs(t,"POST","/v1/accounts:sendOobCode",ns(t,e))}async function CN(t,e){return TN(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SN(t,e){return ol(t,"POST","/v1/accounts:signInWithEmailLink",ns(t,e))}async function NN(t,e){return ol(t,"POST","/v1/accounts:signInWithEmailLink",ns(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo extends xf{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Wo(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Wo(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Gh(e,n,"signInWithPassword",EN);case"emailLink":return SN(e,{email:this._email,oobCode:this._password});default:hr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Gh(e,r,"signUpPassword",_N);case"emailLink":return NN(e,{idToken:n,email:this._email,oobCode:this._password});default:hr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aa(t,e){return ol(t,"POST","/v1/accounts:signInWithIdp",ns(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kN="http://localhost";class wi extends xf{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new wi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):hr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,i=ff(n,["providerId","signInMethod"]);if(!r||!s)return null;const a=new wi(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const n=this.buildRequest();return aa(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,aa(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,aa(e,n)}buildRequest(){const e={requestUri:kN,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=il(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IN(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function AN(t){const e=no(ro(t)).link,n=e?no(ro(e)).deep_link_id:null,r=no(ro(t)).deep_link_id;return(r?no(ro(r)).link:null)||r||n||e||t}class wf{constructor(e){var n,r,s,i,a,c;const u=no(ro(e)),d=(n=u.apiKey)!==null&&n!==void 0?n:null,h=(r=u.oobCode)!==null&&r!==void 0?r:null,f=IN((s=u.mode)!==null&&s!==void 0?s:null);be(d&&h&&f,"argument-error"),this.apiKey=d,this.operation=f,this.code=h,this.continueUrl=(i=u.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(a=u.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(c=u.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){const n=AN(e);try{return new wf(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ia{constructor(){this.providerId=Ia.PROVIDER_ID}static credential(e,n){return Wo._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=wf.parseLink(n);return be(r,"argument-error"),Wo._fromEmailAndCode(e,r.code,r.tenantId)}}Ia.PROVIDER_ID="password";Ia.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ia.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cw{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll extends Cw{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs extends ll{constructor(){super("facebook.com")}static credential(e){return wi._fromParams({providerId:xs.PROVIDER_ID,signInMethod:xs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return xs.credentialFromTaggedObject(e)}static credentialFromError(e){return xs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return xs.credential(e.oauthAccessToken)}catch{return null}}}xs.FACEBOOK_SIGN_IN_METHOD="facebook.com";xs.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends ll{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return wi._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return ws.credential(n,r)}catch{return null}}}ws.GOOGLE_SIGN_IN_METHOD="google.com";ws.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs extends ll{constructor(){super("github.com")}static credential(e){return wi._fromParams({providerId:bs.PROVIDER_ID,signInMethod:bs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return bs.credentialFromTaggedObject(e)}static credentialFromError(e){return bs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return bs.credential(e.oauthAccessToken)}catch{return null}}}bs.GITHUB_SIGN_IN_METHOD="github.com";bs.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s extends ll{constructor(){super("twitter.com")}static credential(e,n){return wi._fromParams({providerId:_s.PROVIDER_ID,signInMethod:_s.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return _s.credentialFromTaggedObject(e)}static credentialFromError(e){return _s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return _s.credential(n,r)}catch{return null}}}_s.TWITTER_SIGN_IN_METHOD="twitter.com";_s.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PN(t,e){return ol(t,"POST","/v1/accounts:signUp",ns(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bi{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await Fr._fromIdTokenResponse(e,r,s),a=Ey(r);return new bi({user:i,providerId:a,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=Ey(r);return new bi({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function Ey(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu extends ts{constructor(e,n,r,s){var i;super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,tu.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new tu(e,n,r,s)}}function Sw(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?tu._fromErrorAndOperation(t,i,e,r):i})}async function RN(t,e,n=!1){const r=await zo(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return bi._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jN(t,e,n=!1){const{auth:r}=t;if(br(r.app))return Promise.reject(Br(r));const s="reauthenticate";try{const i=await zo(t,Sw(r,s,e,t),n);be(i.idToken,r,"internal-error");const a=yf(i.idToken);be(a,r,"internal-error");const{sub:c}=a;return be(t.uid===c,r,"user-mismatch"),bi._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&hr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nw(t,e,n=!1){if(br(t.app))return Promise.reject(Br(t));const r="signIn",s=await Sw(t,r,e),i=await bi._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function DN(t,e){return Nw(Ni(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MN(t,e,n){var r;be(((r=n.url)===null||r===void 0?void 0:r.length)>0,t,"invalid-continue-uri"),be(typeof n.dynamicLinkDomain>"u"||n.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=n.url,e.dynamicLinkDomain=n.dynamicLinkDomain,e.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(be(n.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=n.iOS.bundleId),n.android&&(be(n.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=n.android.installApp,e.androidMinimumVersionCode=n.android.minimumVersion,e.androidPackageName=n.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kw(t){const e=Ni(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function LN(t,e,n){if(br(t.app))return Promise.reject(Br(t));const r=Ni(t),a=await Gh(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",PN).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&kw(t),u}),c=await bi._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(c.user),c}function ON(t,e,n){return br(t.app)?Promise.reject(Br(t)):DN(It(t),Ia.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&kw(t),r})}async function VN(t,e){const n=It(t),s={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()};e&&MN(n.auth,s,e);const{email:i}=await CN(n.auth,s);i!==t.email&&await t.reload()}function FN(t,e,n,r){return It(t).onIdTokenChanged(e,n,r)}function $N(t,e,n){return It(t).beforeAuthStateChanged(e,n)}function Iw(t,e,n,r){return It(t).onAuthStateChanged(e,n,r)}function Aw(t){return It(t).signOut()}const nu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pw{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(nu,"1"),this.storage.removeItem(nu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UN=1e3,BN=10;class Rw extends Pw{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=bw(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((a,c,u)=>{this.notifyListeners(a,u)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!n&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);sN()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,BN):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},UN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}Rw.type="LOCAL";const zN=Rw;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jw extends Pw{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}jw.type="SESSION";const Dw=jw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WN(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new ju(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const c=Array.from(a).map(async d=>d(n.origin,i)),u=await WN(c);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ju.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bf(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HN{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((c,u)=>{const d=bf("",20);s.port1.start();const h=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===d)switch(g.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(g.data.response);break;default:clearTimeout(h),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cr(){return window}function qN(t){Cr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mw(){return typeof Cr().WorkerGlobalScope<"u"&&typeof Cr().importScripts=="function"}async function GN(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function KN(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function QN(){return Mw()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lw="firebaseLocalStorageDb",YN=1,ru="firebaseLocalStorage",Ow="fbase_key";class cl{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Du(t,e){return t.transaction([ru],e?"readwrite":"readonly").objectStore(ru)}function JN(){const t=indexedDB.deleteDatabase(Lw);return new cl(t).toPromise()}function Kh(){const t=indexedDB.open(Lw,YN);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(ru,{keyPath:Ow})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(ru)?e(r):(r.close(),await JN(),e(await Kh()))})})}async function Ty(t,e,n){const r=Du(t,!0).put({[Ow]:e,value:n});return new cl(r).toPromise()}async function XN(t,e){const n=Du(t,!1).get(e),r=await new cl(n).toPromise();return r===void 0?null:r.value}function Cy(t,e){const n=Du(t,!0).delete(e);return new cl(n).toPromise()}const ZN=800,ek=3;class Vw{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Kh(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>ek)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Mw()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ju._getInstance(QN()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await GN(),!this.activeServiceWorker)return;this.sender=new HN(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||KN()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Kh();return await Ty(e,nu,"1"),await Cy(e,nu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Ty(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>XN(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Cy(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Du(s,!1).getAll();return new cl(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),ZN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Vw.type="LOCAL";const tk=Vw;new al(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nk(t,e){return e?$r(e):(be(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f extends xf{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return aa(e,this._buildIdpRequest())}_linkToIdToken(e,n){return aa(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return aa(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function rk(t){return Nw(t.auth,new _f(t),t.bypassAuthState)}function sk(t){const{auth:e,user:n}=t;return be(n,e,"internal-error"),jN(n,new _f(t),t.bypassAuthState)}async function ik(t){const{auth:e,user:n}=t;return be(n,e,"internal-error"),RN(n,new _f(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:a,type:c}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return rk;case"linkViaPopup":case"linkViaRedirect":return ik;case"reauthViaPopup":case"reauthViaRedirect":return sk;default:hr(this.auth,"internal-error")}}resolve(e){Qr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Qr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ak=new al(2e3,1e4);class Ji extends Fw{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Ji.currentPopupAction&&Ji.currentPopupAction.cancel(),Ji.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return be(e,this.auth,"internal-error"),e}async onExecution(){Qr(this.filter.length===1,"Popup operations only handle one event");const e=bf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Tr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Tr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ji.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Tr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,ak.get())};e()}}Ji.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ok="pendingRedirect",pc=new Map;class lk extends Fw{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=pc.get(this.auth._key());if(!e){try{const r=await ck(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}pc.set(this.auth._key(),e)}return this.bypassAuthState||pc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ck(t,e){const n=hk(e),r=dk(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function uk(t,e){pc.set(t._key(),e)}function dk(t){return $r(t._redirectPersistence)}function hk(t){return fc(ok,t.config.apiKey,t.name)}async function mk(t,e,n=!1){if(br(t.app))return Promise.reject(Br(t));const r=Ni(t),s=nk(r,e),a=await new lk(r,s,n).execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fk=10*60*1e3;class pk{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!gk(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!$w(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(Tr(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=fk&&this.cachedEventUids.clear(),this.cachedEventUids.has(Sy(e))}saveEventToCache(e){this.cachedEventUids.add(Sy(e)),this.lastProcessedEventTime=Date.now()}}function Sy(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function $w({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function gk(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return $w(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yk(t,e={}){return rs(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vk=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,xk=/^https?/;async function wk(t){if(t.config.emulator)return;const{authorizedDomains:e}=await yk(t);for(const n of e)try{if(bk(n))return}catch{}hr(t,"unauthorized-domain")}function bk(t){const e=Hh(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&a.hostname===r}if(!xk.test(n))return!1;if(vk.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _k=new al(3e4,6e4);function Ny(){const t=Cr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function Ek(t){return new Promise((e,n)=>{var r,s,i;function a(){Ny(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ny(),n(Tr(t,"network-request-failed"))},timeout:_k.get()})}if(!((s=(r=Cr().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Cr().gapi)===null||i===void 0)&&i.load)a();else{const c=mN("iframefcb");return Cr()[c]=()=>{gapi.load?a():n(Tr(t,"network-request-failed"))},Ew(`${hN()}?onload=${c}`).catch(u=>n(u))}}).catch(e=>{throw gc=null,e})}let gc=null;function Tk(t){return gc=gc||Ek(t),gc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ck=new al(5e3,15e3),Sk="__/auth/iframe",Nk="emulator/auth/iframe",kk={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ik=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ak(t){const e=t.config;be(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?gf(e,Nk):`https://${t.config.authDomain}/${Sk}`,r={apiKey:e.apiKey,appName:t.name,v:ka},s=Ik.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${il(r).slice(1)}`}async function Pk(t){const e=await Tk(t),n=Cr().gapi;return be(n,t,"internal-error"),e.open({where:document.body,url:Ak(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:kk,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=Tr(t,"network-request-failed"),c=Cr().setTimeout(()=>{i(a)},Ck.get());function u(){Cr().clearTimeout(c),s(r)}r.ping(u).then(u,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rk={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},jk=500,Dk=600,Mk="_blank",Lk="http://localhost";class ky{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Ok(t,e,n,r=jk,s=Dk){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},Rk),{width:r.toString(),height:s.toString(),top:i,left:a}),d=dn().toLowerCase();n&&(c=gw(d)?Mk:n),fw(d)&&(e=e||Lk,u.scrollbars="yes");const h=Object.entries(u).reduce((g,[x,S])=>`${g}${x}=${S},`,"");if(rN(d)&&c!=="_self")return Vk(e||"",c),new ky(null);const f=window.open(e||"",c,h);be(f,t,"popup-blocked");try{f.focus()}catch{}return new ky(f)}function Vk(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fk="__/auth/handler",$k="emulator/auth/handler",Uk=encodeURIComponent("fac");async function Iy(t,e,n,r,s,i){be(t.config.authDomain,t,"auth-domain-config-required"),be(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:ka,eventId:s};if(e instanceof Cw){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",N1(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))a[h]=f}if(e instanceof ll){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(a.scopes=h.join(","))}t.tenantId&&(a.tid=t.tenantId);const c=a;for(const h of Object.keys(c))c[h]===void 0&&delete c[h];const u=await t._getAppCheckToken(),d=u?`#${Uk}=${encodeURIComponent(u)}`:"";return`${Bk(t)}?${il(c).slice(1)}${d}`}function Bk({config:t}){return t.emulator?gf(t,$k):`https://${t.authDomain}/${Fk}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Od="webStorageSupport";class zk{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Dw,this._completeRedirectFn=mk,this._overrideRedirectResult=uk}async _openPopup(e,n,r,s){var i;Qr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await Iy(e,n,r,Hh(),s);return Ok(e,a,bf())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await Iy(e,n,r,Hh(),s);return qN(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(Qr(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await Pk(e),r=new pk(e);return n.register("authEvent",s=>(be(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Od,{type:Od},s=>{var i;const a=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Od];a!==void 0&&n(!!a),hr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=wk(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return bw()||pw()||vf()}}const Wk=zk;var Ay="@firebase/auth",Py="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){be(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qk(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Gk(t){pa(new xi("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=r.options;be(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:c,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_w(t)},d=new cN(r,s,i,u);return vN(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),pa(new xi("auth-internal",e=>{const n=Ni(e.getProvider("auth").getImmediate());return(r=>new Hk(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Vs(Ay,Py,qk(t)),Vs(Ay,Py,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kk=5*60,Qk=Xx("authIdTokenMaxAge")||Kk;let Ry=null;const Yk=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>Qk)return;const s=n==null?void 0:n.token;Ry!==s&&(Ry=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Jk(t=nw()){const e=mf(t,"auth");if(e.isInitialized())return e.getImmediate();const n=yN(t,{popupRedirectResolver:Wk,persistence:[tk,zN,Dw]}),r=Xx("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=Yk(i.toString());$N(n,a,()=>a(n.currentUser)),FN(n,c=>a(c))}}const s=Yx("auth");return s&&xN(n,`http://${s}`),n}function Xk(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}uN({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Tr("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",Xk().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Gk("Browser");var Zk="firebase",eI="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Vs(Zk,eI,"app");var jy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var mi,Uw;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(E,_){function C(){}C.prototype=_.prototype,E.D=_.prototype,E.prototype=new C,E.prototype.constructor=E,E.C=function(A,D,N){for(var T=Array(arguments.length-2),Me=2;Me<arguments.length;Me++)T[Me-2]=arguments[Me];return _.prototype[D].apply(A,T)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,_,C){C||(C=0);var A=Array(16);if(typeof _=="string")for(var D=0;16>D;++D)A[D]=_.charCodeAt(C++)|_.charCodeAt(C++)<<8|_.charCodeAt(C++)<<16|_.charCodeAt(C++)<<24;else for(D=0;16>D;++D)A[D]=_[C++]|_[C++]<<8|_[C++]<<16|_[C++]<<24;_=E.g[0],C=E.g[1],D=E.g[2];var N=E.g[3],T=_+(N^C&(D^N))+A[0]+3614090360&4294967295;_=C+(T<<7&4294967295|T>>>25),T=N+(D^_&(C^D))+A[1]+3905402710&4294967295,N=_+(T<<12&4294967295|T>>>20),T=D+(C^N&(_^C))+A[2]+606105819&4294967295,D=N+(T<<17&4294967295|T>>>15),T=C+(_^D&(N^_))+A[3]+3250441966&4294967295,C=D+(T<<22&4294967295|T>>>10),T=_+(N^C&(D^N))+A[4]+4118548399&4294967295,_=C+(T<<7&4294967295|T>>>25),T=N+(D^_&(C^D))+A[5]+1200080426&4294967295,N=_+(T<<12&4294967295|T>>>20),T=D+(C^N&(_^C))+A[6]+2821735955&4294967295,D=N+(T<<17&4294967295|T>>>15),T=C+(_^D&(N^_))+A[7]+4249261313&4294967295,C=D+(T<<22&4294967295|T>>>10),T=_+(N^C&(D^N))+A[8]+1770035416&4294967295,_=C+(T<<7&4294967295|T>>>25),T=N+(D^_&(C^D))+A[9]+2336552879&4294967295,N=_+(T<<12&4294967295|T>>>20),T=D+(C^N&(_^C))+A[10]+4294925233&4294967295,D=N+(T<<17&4294967295|T>>>15),T=C+(_^D&(N^_))+A[11]+2304563134&4294967295,C=D+(T<<22&4294967295|T>>>10),T=_+(N^C&(D^N))+A[12]+1804603682&4294967295,_=C+(T<<7&4294967295|T>>>25),T=N+(D^_&(C^D))+A[13]+4254626195&4294967295,N=_+(T<<12&4294967295|T>>>20),T=D+(C^N&(_^C))+A[14]+2792965006&4294967295,D=N+(T<<17&4294967295|T>>>15),T=C+(_^D&(N^_))+A[15]+1236535329&4294967295,C=D+(T<<22&4294967295|T>>>10),T=_+(D^N&(C^D))+A[1]+4129170786&4294967295,_=C+(T<<5&4294967295|T>>>27),T=N+(C^D&(_^C))+A[6]+3225465664&4294967295,N=_+(T<<9&4294967295|T>>>23),T=D+(_^C&(N^_))+A[11]+643717713&4294967295,D=N+(T<<14&4294967295|T>>>18),T=C+(N^_&(D^N))+A[0]+3921069994&4294967295,C=D+(T<<20&4294967295|T>>>12),T=_+(D^N&(C^D))+A[5]+3593408605&4294967295,_=C+(T<<5&4294967295|T>>>27),T=N+(C^D&(_^C))+A[10]+38016083&4294967295,N=_+(T<<9&4294967295|T>>>23),T=D+(_^C&(N^_))+A[15]+3634488961&4294967295,D=N+(T<<14&4294967295|T>>>18),T=C+(N^_&(D^N))+A[4]+3889429448&4294967295,C=D+(T<<20&4294967295|T>>>12),T=_+(D^N&(C^D))+A[9]+568446438&4294967295,_=C+(T<<5&4294967295|T>>>27),T=N+(C^D&(_^C))+A[14]+3275163606&4294967295,N=_+(T<<9&4294967295|T>>>23),T=D+(_^C&(N^_))+A[3]+4107603335&4294967295,D=N+(T<<14&4294967295|T>>>18),T=C+(N^_&(D^N))+A[8]+1163531501&4294967295,C=D+(T<<20&4294967295|T>>>12),T=_+(D^N&(C^D))+A[13]+2850285829&4294967295,_=C+(T<<5&4294967295|T>>>27),T=N+(C^D&(_^C))+A[2]+4243563512&4294967295,N=_+(T<<9&4294967295|T>>>23),T=D+(_^C&(N^_))+A[7]+1735328473&4294967295,D=N+(T<<14&4294967295|T>>>18),T=C+(N^_&(D^N))+A[12]+2368359562&4294967295,C=D+(T<<20&4294967295|T>>>12),T=_+(C^D^N)+A[5]+4294588738&4294967295,_=C+(T<<4&4294967295|T>>>28),T=N+(_^C^D)+A[8]+2272392833&4294967295,N=_+(T<<11&4294967295|T>>>21),T=D+(N^_^C)+A[11]+1839030562&4294967295,D=N+(T<<16&4294967295|T>>>16),T=C+(D^N^_)+A[14]+4259657740&4294967295,C=D+(T<<23&4294967295|T>>>9),T=_+(C^D^N)+A[1]+2763975236&4294967295,_=C+(T<<4&4294967295|T>>>28),T=N+(_^C^D)+A[4]+1272893353&4294967295,N=_+(T<<11&4294967295|T>>>21),T=D+(N^_^C)+A[7]+4139469664&4294967295,D=N+(T<<16&4294967295|T>>>16),T=C+(D^N^_)+A[10]+3200236656&4294967295,C=D+(T<<23&4294967295|T>>>9),T=_+(C^D^N)+A[13]+681279174&4294967295,_=C+(T<<4&4294967295|T>>>28),T=N+(_^C^D)+A[0]+3936430074&4294967295,N=_+(T<<11&4294967295|T>>>21),T=D+(N^_^C)+A[3]+3572445317&4294967295,D=N+(T<<16&4294967295|T>>>16),T=C+(D^N^_)+A[6]+76029189&4294967295,C=D+(T<<23&4294967295|T>>>9),T=_+(C^D^N)+A[9]+3654602809&4294967295,_=C+(T<<4&4294967295|T>>>28),T=N+(_^C^D)+A[12]+3873151461&4294967295,N=_+(T<<11&4294967295|T>>>21),T=D+(N^_^C)+A[15]+530742520&4294967295,D=N+(T<<16&4294967295|T>>>16),T=C+(D^N^_)+A[2]+3299628645&4294967295,C=D+(T<<23&4294967295|T>>>9),T=_+(D^(C|~N))+A[0]+4096336452&4294967295,_=C+(T<<6&4294967295|T>>>26),T=N+(C^(_|~D))+A[7]+1126891415&4294967295,N=_+(T<<10&4294967295|T>>>22),T=D+(_^(N|~C))+A[14]+2878612391&4294967295,D=N+(T<<15&4294967295|T>>>17),T=C+(N^(D|~_))+A[5]+4237533241&4294967295,C=D+(T<<21&4294967295|T>>>11),T=_+(D^(C|~N))+A[12]+1700485571&4294967295,_=C+(T<<6&4294967295|T>>>26),T=N+(C^(_|~D))+A[3]+2399980690&4294967295,N=_+(T<<10&4294967295|T>>>22),T=D+(_^(N|~C))+A[10]+4293915773&4294967295,D=N+(T<<15&4294967295|T>>>17),T=C+(N^(D|~_))+A[1]+2240044497&4294967295,C=D+(T<<21&4294967295|T>>>11),T=_+(D^(C|~N))+A[8]+1873313359&4294967295,_=C+(T<<6&4294967295|T>>>26),T=N+(C^(_|~D))+A[15]+4264355552&4294967295,N=_+(T<<10&4294967295|T>>>22),T=D+(_^(N|~C))+A[6]+2734768916&4294967295,D=N+(T<<15&4294967295|T>>>17),T=C+(N^(D|~_))+A[13]+1309151649&4294967295,C=D+(T<<21&4294967295|T>>>11),T=_+(D^(C|~N))+A[4]+4149444226&4294967295,_=C+(T<<6&4294967295|T>>>26),T=N+(C^(_|~D))+A[11]+3174756917&4294967295,N=_+(T<<10&4294967295|T>>>22),T=D+(_^(N|~C))+A[2]+718787259&4294967295,D=N+(T<<15&4294967295|T>>>17),T=C+(N^(D|~_))+A[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(D+(T<<21&4294967295|T>>>11))&4294967295,E.g[2]=E.g[2]+D&4294967295,E.g[3]=E.g[3]+N&4294967295}r.prototype.u=function(E,_){_===void 0&&(_=E.length);for(var C=_-this.blockSize,A=this.B,D=this.h,N=0;N<_;){if(D==0)for(;N<=C;)s(this,E,N),N+=this.blockSize;if(typeof E=="string"){for(;N<_;)if(A[D++]=E.charCodeAt(N++),D==this.blockSize){s(this,A),D=0;break}}else for(;N<_;)if(A[D++]=E[N++],D==this.blockSize){s(this,A),D=0;break}}this.h=D,this.o+=_},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;var C=8*this.o;for(_=E.length-8;_<E.length;++_)E[_]=C&255,C/=256;for(this.u(E),E=Array(16),_=C=0;4>_;++_)for(var A=0;32>A;A+=8)E[C++]=this.g[_]>>>A&255;return E};function i(E,_){var C=c;return Object.prototype.hasOwnProperty.call(C,E)?C[E]:C[E]=_(E)}function a(E,_){this.h=_;for(var C=[],A=!0,D=E.length-1;0<=D;D--){var N=E[D]|0;A&&N==_||(C[D]=N,A=!1)}this.g=C}var c={};function u(E){return-128<=E&&128>E?i(E,function(_){return new a([_|0],0>_?-1:0)}):new a([E|0],0>E?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return f;if(0>E)return k(d(-E));for(var _=[],C=1,A=0;E>=C;A++)_[A]=E/C|0,C*=4294967296;return new a(_,0)}function h(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return k(h(E.substring(1),_));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var C=d(Math.pow(_,8)),A=f,D=0;D<E.length;D+=8){var N=Math.min(8,E.length-D),T=parseInt(E.substring(D,D+N),_);8>N?(N=d(Math.pow(_,N)),A=A.j(N).add(d(T))):(A=A.j(C),A=A.add(d(T)))}return A}var f=u(0),g=u(1),x=u(16777216);t=a.prototype,t.m=function(){if(y(this))return-k(this).m();for(var E=0,_=1,C=0;C<this.g.length;C++){var A=this.i(C);E+=(0<=A?A:4294967296+A)*_,_*=4294967296}return E},t.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(S(this))return"0";if(y(this))return"-"+k(this).toString(E);for(var _=d(Math.pow(E,6)),C=this,A="";;){var D=j(C,_).g;C=b(C,D.j(_));var N=((0<C.g.length?C.g[0]:C.h)>>>0).toString(E);if(C=D,S(C))return N+A;for(;6>N.length;)N="0"+N;A=N+A}},t.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function S(E){if(E.h!=0)return!1;for(var _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function y(E){return E.h==-1}t.l=function(E){return E=b(this,E),y(E)?-1:S(E)?0:1};function k(E){for(var _=E.g.length,C=[],A=0;A<_;A++)C[A]=~E.g[A];return new a(C,~E.h).add(g)}t.abs=function(){return y(this)?k(this):this},t.add=function(E){for(var _=Math.max(this.g.length,E.g.length),C=[],A=0,D=0;D<=_;D++){var N=A+(this.i(D)&65535)+(E.i(D)&65535),T=(N>>>16)+(this.i(D)>>>16)+(E.i(D)>>>16);A=T>>>16,N&=65535,T&=65535,C[D]=T<<16|N}return new a(C,C[C.length-1]&-2147483648?-1:0)};function b(E,_){return E.add(k(_))}t.j=function(E){if(S(this)||S(E))return f;if(y(this))return y(E)?k(this).j(k(E)):k(k(this).j(E));if(y(E))return k(this.j(k(E)));if(0>this.l(x)&&0>E.l(x))return d(this.m()*E.m());for(var _=this.g.length+E.g.length,C=[],A=0;A<2*_;A++)C[A]=0;for(A=0;A<this.g.length;A++)for(var D=0;D<E.g.length;D++){var N=this.i(A)>>>16,T=this.i(A)&65535,Me=E.i(D)>>>16,Pe=E.i(D)&65535;C[2*A+2*D]+=T*Pe,w(C,2*A+2*D),C[2*A+2*D+1]+=N*Pe,w(C,2*A+2*D+1),C[2*A+2*D+1]+=T*Me,w(C,2*A+2*D+1),C[2*A+2*D+2]+=N*Me,w(C,2*A+2*D+2)}for(A=0;A<_;A++)C[A]=C[2*A+1]<<16|C[2*A];for(A=_;A<2*_;A++)C[A]=0;return new a(C,0)};function w(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function I(E,_){this.g=E,this.h=_}function j(E,_){if(S(_))throw Error("division by zero");if(S(E))return new I(f,f);if(y(E))return _=j(k(E),_),new I(k(_.g),k(_.h));if(y(_))return _=j(E,k(_)),new I(k(_.g),_.h);if(30<E.g.length){if(y(E)||y(_))throw Error("slowDivide_ only works with positive integers.");for(var C=g,A=_;0>=A.l(E);)C=$(C),A=$(A);var D=H(C,1),N=H(A,1);for(A=H(A,2),C=H(C,2);!S(A);){var T=N.add(A);0>=T.l(E)&&(D=D.add(C),N=T),A=H(A,1),C=H(C,1)}return _=b(E,D.j(_)),new I(D,_)}for(D=f;0<=E.l(_);){for(C=Math.max(1,Math.floor(E.m()/_.m())),A=Math.ceil(Math.log(C)/Math.LN2),A=48>=A?1:Math.pow(2,A-48),N=d(C),T=N.j(_);y(T)||0<T.l(E);)C-=A,N=d(C),T=N.j(_);S(N)&&(N=g),D=D.add(N),E=b(E,T)}return new I(D,E)}t.A=function(E){return j(this,E).h},t.and=function(E){for(var _=Math.max(this.g.length,E.g.length),C=[],A=0;A<_;A++)C[A]=this.i(A)&E.i(A);return new a(C,this.h&E.h)},t.or=function(E){for(var _=Math.max(this.g.length,E.g.length),C=[],A=0;A<_;A++)C[A]=this.i(A)|E.i(A);return new a(C,this.h|E.h)},t.xor=function(E){for(var _=Math.max(this.g.length,E.g.length),C=[],A=0;A<_;A++)C[A]=this.i(A)^E.i(A);return new a(C,this.h^E.h)};function $(E){for(var _=E.g.length+1,C=[],A=0;A<_;A++)C[A]=E.i(A)<<1|E.i(A-1)>>>31;return new a(C,E.h)}function H(E,_){var C=_>>5;_%=32;for(var A=E.g.length-C,D=[],N=0;N<A;N++)D[N]=0<_?E.i(N+C)>>>_|E.i(N+C+1)<<32-_:E.i(N+C);return new a(D,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Uw=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=h,mi=a}).apply(typeof jy<"u"?jy:typeof self<"u"?self:typeof window<"u"?window:{});var Yl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Bw,so,zw,yc,Qh,Ww,Hw,qw;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,m,p){return l==Array.prototype||l==Object.prototype||(l[m]=p.value),l};function n(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Yl=="object"&&Yl];for(var m=0;m<l.length;++m){var p=l[m];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=n(this);function s(l,m){if(m)e:{var p=r;l=l.split(".");for(var v=0;v<l.length-1;v++){var O=l[v];if(!(O in p))break e;p=p[O]}l=l[l.length-1],v=p[l],m=m(v),m!=v&&m!=null&&e(p,l,{configurable:!0,writable:!0,value:m})}}function i(l,m){l instanceof String&&(l+="");var p=0,v=!1,O={next:function(){if(!v&&p<l.length){var F=p++;return{value:m(F,l[F]),done:!1}}return v=!0,{done:!0,value:void 0}}};return O[Symbol.iterator]=function(){return O},O}s("Array.prototype.values",function(l){return l||function(){return i(this,function(m,p){return p})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},c=this||self;function u(l){var m=typeof l;return m=m!="object"?m:l?Array.isArray(l)?"array":m:"null",m=="array"||m=="object"&&typeof l.length=="number"}function d(l){var m=typeof l;return m=="object"&&l!=null||m=="function"}function h(l,m,p){return l.call.apply(l.bind,arguments)}function f(l,m,p){if(!l)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var O=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(O,v),l.apply(m,O)}}return function(){return l.apply(m,arguments)}}function g(l,m,p){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,g.apply(null,arguments)}function x(l,m){var p=Array.prototype.slice.call(arguments,1);return function(){var v=p.slice();return v.push.apply(v,arguments),l.apply(this,v)}}function S(l,m){function p(){}p.prototype=m.prototype,l.aa=m.prototype,l.prototype=new p,l.prototype.constructor=l,l.Qb=function(v,O,F){for(var ne=Array(arguments.length-2),tt=2;tt<arguments.length;tt++)ne[tt-2]=arguments[tt];return m.prototype[O].apply(v,ne)}}function y(l){const m=l.length;if(0<m){const p=Array(m);for(let v=0;v<m;v++)p[v]=l[v];return p}return[]}function k(l,m){for(let p=1;p<arguments.length;p++){const v=arguments[p];if(u(v)){const O=l.length||0,F=v.length||0;l.length=O+F;for(let ne=0;ne<F;ne++)l[O+ne]=v[ne]}else l.push(v)}}class b{constructor(m,p){this.i=m,this.j=p,this.h=0,this.g=null}get(){let m;return 0<this.h?(this.h--,m=this.g,this.g=m.next,m.next=null):m=this.i(),m}}function w(l){return/^[\s\xa0]*$/.test(l)}function I(){var l=c.navigator;return l&&(l=l.userAgent)?l:""}function j(l){return j[" "](l),l}j[" "]=function(){};var $=I().indexOf("Gecko")!=-1&&!(I().toLowerCase().indexOf("webkit")!=-1&&I().indexOf("Edge")==-1)&&!(I().indexOf("Trident")!=-1||I().indexOf("MSIE")!=-1)&&I().indexOf("Edge")==-1;function H(l,m,p){for(const v in l)m.call(p,l[v],v,l)}function E(l,m){for(const p in l)m.call(void 0,l[p],p,l)}function _(l){const m={};for(const p in l)m[p]=l[p];return m}const C="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function A(l,m){let p,v;for(let O=1;O<arguments.length;O++){v=arguments[O];for(p in v)l[p]=v[p];for(let F=0;F<C.length;F++)p=C[F],Object.prototype.hasOwnProperty.call(v,p)&&(l[p]=v[p])}}function D(l){var m=1;l=l.split(":");const p=[];for(;0<m&&l.length;)p.push(l.shift()),m--;return l.length&&p.push(l.join(":")),p}function N(l){c.setTimeout(()=>{throw l},0)}function T(){var l=ie;let m=null;return l.g&&(m=l.g,l.g=l.g.next,l.g||(l.h=null),m.next=null),m}class Me{constructor(){this.h=this.g=null}add(m,p){const v=Pe.get();v.set(m,p),this.h?this.h.next=v:this.g=v,this.h=v}}var Pe=new b(()=>new Re,l=>l.reset());class Re{constructor(){this.next=this.g=this.h=null}set(m,p){this.h=m,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let Te,G=!1,ie=new Me,pe=()=>{const l=c.Promise.resolve(void 0);Te=()=>{l.then(J)}};var J=()=>{for(var l;l=T();){try{l.h.call(l.g)}catch(p){N(p)}var m=Pe;m.j(l),100>m.h&&(m.h++,l.next=m.g,m.g=l)}G=!1};function B(){this.s=this.s,this.C=this.C}B.prototype.s=!1,B.prototype.ma=function(){this.s||(this.s=!0,this.N())},B.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function X(l,m){this.type=l,this.g=this.target=m,this.defaultPrevented=!1}X.prototype.h=function(){this.defaultPrevented=!0};var ce=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var l=!1,m=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const p=()=>{};c.addEventListener("test",p,m),c.removeEventListener("test",p,m)}catch{}return l}();function je(l,m){if(X.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var p=this.type=l.type,v=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=m,m=l.relatedTarget){if($){e:{try{j(m.nodeName);var O=!0;break e}catch{}O=!1}O||(m=null)}}else p=="mouseover"?m=l.fromElement:p=="mouseout"&&(m=l.toElement);this.relatedTarget=m,v?(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:de[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&je.aa.h.call(this)}}S(je,X);var de={2:"touch",3:"pen",4:"mouse"};je.prototype.h=function(){je.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var le="closure_listenable_"+(1e6*Math.random()|0),Z=0;function Se(l,m,p,v,O){this.listener=l,this.proxy=null,this.src=m,this.type=p,this.capture=!!v,this.ha=O,this.key=++Z,this.da=this.fa=!1}function ye(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Fe(l){this.src=l,this.g={},this.h=0}Fe.prototype.add=function(l,m,p,v,O){var F=l.toString();l=this.g[F],l||(l=this.g[F]=[],this.h++);var ne=lt(l,m,v,O);return-1<ne?(m=l[ne],p||(m.fa=!1)):(m=new Se(m,this.src,F,!!v,O),m.fa=p,l.push(m)),m};function W(l,m){var p=m.type;if(p in l.g){var v=l.g[p],O=Array.prototype.indexOf.call(v,m,void 0),F;(F=0<=O)&&Array.prototype.splice.call(v,O,1),F&&(ye(m),l.g[p].length==0&&(delete l.g[p],l.h--))}}function lt(l,m,p,v){for(var O=0;O<l.length;++O){var F=l[O];if(!F.da&&F.listener==m&&F.capture==!!p&&F.ha==v)return O}return-1}var ct="closure_lm_"+(1e6*Math.random()|0),Ee={};function Yt(l,m,p,v,O){if(v&&v.once)return wt(l,m,p,v,O);if(Array.isArray(m)){for(var F=0;F<m.length;F++)Yt(l,m[F],p,v,O);return null}return p=mn(p),l&&l[le]?l.K(m,p,d(v)?!!v.capture:!!v,O):fr(l,m,p,!1,v,O)}function fr(l,m,p,v,O,F){if(!m)throw Error("Invalid event type");var ne=d(O)?!!O.capture:!!O,tt=Rn(l);if(tt||(l[ct]=tt=new Fe(l)),p=tt.add(m,p,v,ne,F),p.proxy)return p;if(v=Je(),p.proxy=v,v.src=l,v.listener=p,l.addEventListener)ce||(O=ne),O===void 0&&(O=!1),l.addEventListener(m.toString(),v,O);else if(l.attachEvent)l.attachEvent(is(m.toString()),v);else if(l.addListener&&l.removeListener)l.addListener(v);else throw Error("addEventListener and attachEvent are unavailable.");return p}function Je(){function l(p){return m.call(l.src,l.listener,p)}const m=ht;return l}function wt(l,m,p,v,O){if(Array.isArray(m)){for(var F=0;F<m.length;F++)wt(l,m[F],p,v,O);return null}return p=mn(p),l&&l[le]?l.L(m,p,d(v)?!!v.capture:!!v,O):fr(l,m,p,!0,v,O)}function Ge(l,m,p,v,O){if(Array.isArray(m))for(var F=0;F<m.length;F++)Ge(l,m[F],p,v,O);else v=d(v)?!!v.capture:!!v,p=mn(p),l&&l[le]?(l=l.i,m=String(m).toString(),m in l.g&&(F=l.g[m],p=lt(F,p,v,O),-1<p&&(ye(F[p]),Array.prototype.splice.call(F,p,1),F.length==0&&(delete l.g[m],l.h--)))):l&&(l=Rn(l))&&(m=l.g[m.toString()],l=-1,m&&(l=lt(m,p,v,O)),(p=-1<l?m[l]:null)&&Jt(p))}function Jt(l){if(typeof l!="number"&&l&&!l.da){var m=l.src;if(m&&m[le])W(m.i,l);else{var p=l.type,v=l.proxy;m.removeEventListener?m.removeEventListener(p,v,l.capture):m.detachEvent?m.detachEvent(is(p),v):m.addListener&&m.removeListener&&m.removeListener(v),(p=Rn(m))?(W(p,l),p.h==0&&(p.src=null,m[ct]=null)):ye(l)}}}function is(l){return l in Ee?Ee[l]:Ee[l]="on"+l}function ht(l,m){if(l.da)l=!0;else{m=new je(m,this);var p=l.listener,v=l.ha||l.src;l.fa&&Jt(l),l=p.call(v,m)}return l}function Rn(l){return l=l[ct],l instanceof Fe?l:null}var bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function mn(l){return typeof l=="function"?l:(l[bt]||(l[bt]=function(m){return l.handleEvent(m)}),l[bt])}function L(){B.call(this),this.i=new Fe(this),this.M=this,this.F=null}S(L,B),L.prototype[le]=!0,L.prototype.removeEventListener=function(l,m,p,v){Ge(this,l,m,p,v)};function U(l,m){var p,v=l.F;if(v)for(p=[];v;v=v.F)p.push(v);if(l=l.M,v=m.type||m,typeof m=="string")m=new X(m,l);else if(m instanceof X)m.target=m.target||l;else{var O=m;m=new X(v,l),A(m,O)}if(O=!0,p)for(var F=p.length-1;0<=F;F--){var ne=m.g=p[F];O=ge(ne,v,!0,m)&&O}if(ne=m.g=l,O=ge(ne,v,!0,m)&&O,O=ge(ne,v,!1,m)&&O,p)for(F=0;F<p.length;F++)ne=m.g=p[F],O=ge(ne,v,!1,m)&&O}L.prototype.N=function(){if(L.aa.N.call(this),this.i){var l=this.i,m;for(m in l.g){for(var p=l.g[m],v=0;v<p.length;v++)ye(p[v]);delete l.g[m],l.h--}}this.F=null},L.prototype.K=function(l,m,p,v){return this.i.add(String(l),m,!1,p,v)},L.prototype.L=function(l,m,p,v){return this.i.add(String(l),m,!0,p,v)};function ge(l,m,p,v){if(m=l.i.g[String(m)],!m)return!0;m=m.concat();for(var O=!0,F=0;F<m.length;++F){var ne=m[F];if(ne&&!ne.da&&ne.capture==p){var tt=ne.listener,Bt=ne.ha||ne.src;ne.fa&&W(l.i,ne),O=tt.call(Bt,v)!==!1&&O}}return O&&!v.defaultPrevented}function Ne(l,m,p){if(typeof l=="function")p&&(l=g(l,p));else if(l&&typeof l.handleEvent=="function")l=g(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(m)?-1:c.setTimeout(l,m||0)}function $t(l){l.g=Ne(()=>{l.g=null,l.i&&(l.i=!1,$t(l))},l.l);const m=l.h;l.h=null,l.m.apply(null,m)}class Ut extends B{constructor(m,p){super(),this.m=m,this.l=p,this.h=null,this.i=!1,this.g=null}j(m){this.h=arguments,this.g?this.i=!0:$t(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ut(l){B.call(this),this.h=l,this.g={}}S(ut,B);var Ir=[];function Ar(l){H(l.g,function(m,p){this.g.hasOwnProperty(p)&&Jt(m)},l),l.g={}}ut.prototype.N=function(){ut.aa.N.call(this),Ar(this)},ut.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ze=c.JSON.stringify,pr=c.JSON.parse,er=class{stringify(l){return c.JSON.stringify(l,void 0)}parse(l){return c.JSON.parse(l,void 0)}};function Wn(){}Wn.prototype.h=null;function as(l){return l.h||(l.h=l.i())}function Dt(){}var jn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function R(){X.call(this,"d")}S(R,X);function te(){X.call(this,"c")}S(te,X);var me={},ve=null;function xe(){return ve=ve||new L}me.La="serverreachability";function re(l){X.call(this,me.La,l)}S(re,X);function De(l){const m=xe();U(m,new re(m))}me.STAT_EVENT="statevent";function At(l,m){X.call(this,me.STAT_EVENT,l),this.stat=m}S(At,X);function yt(l){const m=xe();U(m,new At(m,l))}me.Ma="timingevent";function Zs(l,m){X.call(this,me.Ma,l),this.size=m}S(Zs,X);function Xt(l,m){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){l()},m)}function gr(){this.g=!0}gr.prototype.xa=function(){this.g=!1};function ei(l,m,p,v,O,F){l.info(function(){if(l.g)if(F)for(var ne="",tt=F.split("&"),Bt=0;Bt<tt.length;Bt++){var He=tt[Bt].split("=");if(1<He.length){var tn=He[0];He=He[1];var nn=tn.split("_");ne=2<=nn.length&&nn[1]=="type"?ne+(tn+"="+He+"&"):ne+(tn+"=redacted&")}}else ne=null;else ne=F;return"XMLHTTP REQ ("+v+") [attempt "+O+"]: "+m+`
`+p+`
`+ne})}function Ai(l,m,p,v,O,F,ne){l.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+O+"]: "+m+`
`+p+`
`+F+" "+ne})}function tr(l,m,p,v){l.info(function(){return"XMLHTTP TEXT ("+m+"): "+M(l,p)+(v?" "+v:"")})}function Da(l,m){l.info(function(){return"TIMEOUT: "+m})}gr.prototype.info=function(){};function M(l,m){if(!l.g)return m;if(!m)return null;try{var p=JSON.parse(m);if(p){for(l=0;l<p.length;l++)if(Array.isArray(p[l])){var v=p[l];if(!(2>v.length)){var O=v[1];if(Array.isArray(O)&&!(1>O.length)){var F=O[0];if(F!="noop"&&F!="stop"&&F!="close")for(var ne=1;ne<O.length;ne++)O[ne]=""}}}}return Ze(p)}catch{return m}}var V={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},se={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},K;function q(){}S(q,Wn),q.prototype.g=function(){return new XMLHttpRequest},q.prototype.i=function(){return{}},K=new q;function ue(l,m,p,v){this.j=l,this.i=m,this.l=p,this.R=v||1,this.U=new ut(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ee}function ee(){this.i=null,this.g="",this.h=!1}var fe={},_e={};function ke(l,m,p){l.L=1,l.v=El(Pr(m)),l.m=p,l.P=!0,Le(l,null)}function Le(l,m){l.F=Date.now(),$e(l),l.A=Pr(l.v);var p=l.A,v=l.R;Array.isArray(v)||(v=[String(v)]),xp(p.i,"t",v),l.C=0,p=l.j.J,l.h=new ee,l.g=Op(l.j,p?m:null,!l.m),0<l.O&&(l.M=new Ut(g(l.Y,l,l.g),l.O)),m=l.U,p=l.g,v=l.ca;var O="readystatechange";Array.isArray(O)||(O&&(Ir[0]=O.toString()),O=Ir);for(var F=0;F<O.length;F++){var ne=Yt(p,O[F],v||m.handleEvent,!1,m.h||m);if(!ne)break;m.g[ne.key]=ne}m=l.H?_(l.H):{},l.m?(l.u||(l.u="POST"),m["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,m)):(l.u="GET",l.g.ea(l.A,l.u,null,m)),De(),ei(l.i,l.u,l.A,l.l,l.R,l.m)}ue.prototype.ca=function(l){l=l.target;const m=this.M;m&&Rr(l)==3?m.j():this.Y(l)},ue.prototype.Y=function(l){try{if(l==this.g)e:{const nn=Rr(this.g);var m=this.g.Ba();const ji=this.g.Z();if(!(3>nn)&&(nn!=3||this.g&&(this.h.h||this.g.oa()||Sp(this.g)))){this.J||nn!=4||m==7||(m==8||0>=ji?De(3):De(2)),Mt(this);var p=this.g.Z();this.X=p;t:if(Xe(this)){var v=Sp(this.g);l="";var O=v.length,F=Rr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Cn(this),Zt(this);var ne="";break t}this.h.i=new c.TextDecoder}for(m=0;m<O;m++)this.h.h=!0,l+=this.h.i.decode(v[m],{stream:!(F&&m==O-1)});v.length=0,this.h.g+=l,this.C=0,ne=this.h.g}else ne=this.g.oa();if(this.o=p==200,Ai(this.i,this.u,this.A,this.l,this.R,nn,p),this.o){if(this.T&&!this.K){t:{if(this.g){var tt,Bt=this.g;if((tt=Bt.g?Bt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!w(tt)){var He=tt;break t}}He=null}if(p=He)tr(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,nr(this,p);else{this.o=!1,this.s=3,yt(12),Cn(this),Zt(this);break e}}if(this.P){p=!0;let rr;for(;!this.J&&this.C<ne.length;)if(rr=et(this,ne),rr==_e){nn==4&&(this.s=4,yt(14),p=!1),tr(this.i,this.l,null,"[Incomplete Response]");break}else if(rr==fe){this.s=4,yt(15),tr(this.i,this.l,ne,"[Invalid Chunk]"),p=!1;break}else tr(this.i,this.l,rr,null),nr(this,rr);if(Xe(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),nn!=4||ne.length!=0||this.h.h||(this.s=1,yt(16),p=!1),this.o=this.o&&p,!p)tr(this.i,this.l,ne,"[Invalid Chunked Response]"),Cn(this),Zt(this);else if(0<ne.length&&!this.W){this.W=!0;var tn=this.j;tn.g==this&&tn.ba&&!tn.M&&(tn.j.info("Great, no buffering proxy detected. Bytes received: "+ne.length),nd(tn),tn.M=!0,yt(11))}}else tr(this.i,this.l,ne,null),nr(this,ne);nn==4&&Cn(this),this.o&&!this.J&&(nn==4?jp(this.j,this):(this.o=!1,$e(this)))}else k_(this.g),p==400&&0<ne.indexOf("Unknown SID")?(this.s=3,yt(12)):(this.s=0,yt(13)),Cn(this),Zt(this)}}}catch{}finally{}};function Xe(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function et(l,m){var p=l.C,v=m.indexOf(`
`,p);return v==-1?_e:(p=Number(m.substring(p,v)),isNaN(p)?fe:(v+=1,v+p>m.length?_e:(m=m.slice(v,v+p),l.C=v+p,m)))}ue.prototype.cancel=function(){this.J=!0,Cn(this)};function $e(l){l.S=Date.now()+l.I,Dn(l,l.I)}function Dn(l,m){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Xt(g(l.ba,l),m)}function Mt(l){l.B&&(c.clearTimeout(l.B),l.B=null)}ue.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(Da(this.i,this.A),this.L!=2&&(De(),yt(17)),Cn(this),this.s=2,Zt(this)):Dn(this,this.S-l)};function Zt(l){l.j.G==0||l.J||jp(l.j,l)}function Cn(l){Mt(l);var m=l.M;m&&typeof m.ma=="function"&&m.ma(),l.M=null,Ar(l.U),l.g&&(m=l.g,l.g=null,m.abort(),m.ma())}function nr(l,m){try{var p=l.j;if(p.G!=0&&(p.g==l||Ke(p.h,l))){if(!l.K&&Ke(p.h,l)&&p.G==3){try{var v=p.Da.g.parse(m)}catch{v=null}if(Array.isArray(v)&&v.length==3){var O=v;if(O[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<l.F)Il(p),Nl(p);else break e;td(p),yt(18)}}else p.za=O[1],0<p.za-p.T&&37500>O[2]&&p.F&&p.v==0&&!p.C&&(p.C=Xt(g(p.Za,p),6e3));if(1>=ls(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else ni(p,11)}else if((l.K||p.g==l)&&Il(p),!w(m))for(O=p.Da.g.parse(m),m=0;m<O.length;m++){let He=O[m];if(p.T=He[0],He=He[1],p.G==2)if(He[0]=="c"){p.K=He[1],p.ia=He[2];const tn=He[3];tn!=null&&(p.la=tn,p.j.info("VER="+p.la));const nn=He[4];nn!=null&&(p.Aa=nn,p.j.info("SVER="+p.Aa));const ji=He[5];ji!=null&&typeof ji=="number"&&0<ji&&(v=1.5*ji,p.L=v,p.j.info("backChannelRequestTimeoutMs_="+v)),v=p;const rr=l.g;if(rr){const Pl=rr.g?rr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Pl){var F=v.h;F.g||Pl.indexOf("spdy")==-1&&Pl.indexOf("quic")==-1&&Pl.indexOf("h2")==-1||(F.j=F.l,F.g=new Set,F.h&&(Hn(F,F.h),F.h=null))}if(v.D){const rd=rr.g?rr.g.getResponseHeader("X-HTTP-Session-Id"):null;rd&&(v.ya=rd,rt(v.I,v.D,rd))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-l.F,p.j.info("Handshake RTT: "+p.R+"ms")),v=p;var ne=l;if(v.qa=Lp(v,v.J?v.ia:null,v.W),ne.K){cs(v.h,ne);var tt=ne,Bt=v.L;Bt&&(tt.I=Bt),tt.B&&(Mt(tt),$e(tt)),v.g=ne}else Pp(v);0<p.i.length&&kl(p)}else He[0]!="stop"&&He[0]!="close"||ni(p,7);else p.G==3&&(He[0]=="stop"||He[0]=="close"?He[0]=="stop"?ni(p,7):ed(p):He[0]!="noop"&&p.l&&p.l.ta(He),p.v=0)}}De(4)}catch{}}var Ma=class{constructor(l,m){this.g=l,this.map=m}};function os(l){this.l=l||10,c.PerformanceNavigationTiming?(l=c.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function fn(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function ls(l){return l.h?1:l.g?l.g.size:0}function Ke(l,m){return l.h?l.h==m:l.g?l.g.has(m):!1}function Hn(l,m){l.g?l.g.add(m):l.h=m}function cs(l,m){l.h&&l.h==m?l.h=null:l.g&&l.g.has(m)&&l.g.delete(m)}os.prototype.cancel=function(){if(this.i=en(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function en(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let m=l.i;for(const p of l.g.values())m=m.concat(p.D);return m}return y(l.i)}function wl(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var m=[],p=l.length,v=0;v<p;v++)m.push(l[v]);return m}m=[],p=0;for(v in l)m[p++]=l[v];return m}function f_(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||typeof l=="string"){var m=[];l=l.length;for(var p=0;p<l;p++)m.push(p);return m}m=[],p=0;for(const v in l)m[p++]=v;return m}}}function mp(l,m){if(l.forEach&&typeof l.forEach=="function")l.forEach(m,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,m,void 0);else for(var p=f_(l),v=wl(l),O=v.length,F=0;F<O;F++)m.call(void 0,v[F],p&&p[F],l)}var fp=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function p_(l,m){if(l){l=l.split("&");for(var p=0;p<l.length;p++){var v=l[p].indexOf("="),O=null;if(0<=v){var F=l[p].substring(0,v);O=l[p].substring(v+1)}else F=l[p];m(F,O?decodeURIComponent(O.replace(/\+/g," ")):"")}}}function ti(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof ti){this.h=l.h,bl(this,l.j),this.o=l.o,this.g=l.g,_l(this,l.s),this.l=l.l;var m=l.i,p=new Va;p.i=m.i,m.g&&(p.g=new Map(m.g),p.h=m.h),pp(this,p),this.m=l.m}else l&&(m=String(l).match(fp))?(this.h=!1,bl(this,m[1]||"",!0),this.o=La(m[2]||""),this.g=La(m[3]||"",!0),_l(this,m[4]),this.l=La(m[5]||"",!0),pp(this,m[6]||"",!0),this.m=La(m[7]||"")):(this.h=!1,this.i=new Va(null,this.h))}ti.prototype.toString=function(){var l=[],m=this.j;m&&l.push(Oa(m,gp,!0),":");var p=this.g;return(p||m=="file")&&(l.push("//"),(m=this.o)&&l.push(Oa(m,gp,!0),"@"),l.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&l.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&l.push("/"),l.push(Oa(p,p.charAt(0)=="/"?v_:y_,!0))),(p=this.i.toString())&&l.push("?",p),(p=this.m)&&l.push("#",Oa(p,w_)),l.join("")};function Pr(l){return new ti(l)}function bl(l,m,p){l.j=p?La(m,!0):m,l.j&&(l.j=l.j.replace(/:$/,""))}function _l(l,m){if(m){if(m=Number(m),isNaN(m)||0>m)throw Error("Bad port number "+m);l.s=m}else l.s=null}function pp(l,m,p){m instanceof Va?(l.i=m,b_(l.i,l.h)):(p||(m=Oa(m,x_)),l.i=new Va(m,l.h))}function rt(l,m,p){l.i.set(m,p)}function El(l){return rt(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function La(l,m){return l?m?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Oa(l,m,p){return typeof l=="string"?(l=encodeURI(l).replace(m,g_),p&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function g_(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var gp=/[#\/\?@]/g,y_=/[#\?:]/g,v_=/[#\?]/g,x_=/[#\?@]/g,w_=/#/g;function Va(l,m){this.h=this.g=null,this.i=l||null,this.j=!!m}function us(l){l.g||(l.g=new Map,l.h=0,l.i&&p_(l.i,function(m,p){l.add(decodeURIComponent(m.replace(/\+/g," ")),p)}))}t=Va.prototype,t.add=function(l,m){us(this),this.i=null,l=Pi(this,l);var p=this.g.get(l);return p||this.g.set(l,p=[]),p.push(m),this.h+=1,this};function yp(l,m){us(l),m=Pi(l,m),l.g.has(m)&&(l.i=null,l.h-=l.g.get(m).length,l.g.delete(m))}function vp(l,m){return us(l),m=Pi(l,m),l.g.has(m)}t.forEach=function(l,m){us(this),this.g.forEach(function(p,v){p.forEach(function(O){l.call(m,O,v,this)},this)},this)},t.na=function(){us(this);const l=Array.from(this.g.values()),m=Array.from(this.g.keys()),p=[];for(let v=0;v<m.length;v++){const O=l[v];for(let F=0;F<O.length;F++)p.push(m[v])}return p},t.V=function(l){us(this);let m=[];if(typeof l=="string")vp(this,l)&&(m=m.concat(this.g.get(Pi(this,l))));else{l=Array.from(this.g.values());for(let p=0;p<l.length;p++)m=m.concat(l[p])}return m},t.set=function(l,m){return us(this),this.i=null,l=Pi(this,l),vp(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[m]),this.h+=1,this},t.get=function(l,m){return l?(l=this.V(l),0<l.length?String(l[0]):m):m};function xp(l,m,p){yp(l,m),0<p.length&&(l.i=null,l.g.set(Pi(l,m),y(p)),l.h+=p.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],m=Array.from(this.g.keys());for(var p=0;p<m.length;p++){var v=m[p];const F=encodeURIComponent(String(v)),ne=this.V(v);for(v=0;v<ne.length;v++){var O=F;ne[v]!==""&&(O+="="+encodeURIComponent(String(ne[v]))),l.push(O)}}return this.i=l.join("&")};function Pi(l,m){return m=String(m),l.j&&(m=m.toLowerCase()),m}function b_(l,m){m&&!l.j&&(us(l),l.i=null,l.g.forEach(function(p,v){var O=v.toLowerCase();v!=O&&(yp(this,v),xp(this,O,p))},l)),l.j=m}function __(l,m){const p=new gr;if(c.Image){const v=new Image;v.onload=x(ds,p,"TestLoadImage: loaded",!0,m,v),v.onerror=x(ds,p,"TestLoadImage: error",!1,m,v),v.onabort=x(ds,p,"TestLoadImage: abort",!1,m,v),v.ontimeout=x(ds,p,"TestLoadImage: timeout",!1,m,v),c.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=l}else m(!1)}function E_(l,m){const p=new gr,v=new AbortController,O=setTimeout(()=>{v.abort(),ds(p,"TestPingServer: timeout",!1,m)},1e4);fetch(l,{signal:v.signal}).then(F=>{clearTimeout(O),F.ok?ds(p,"TestPingServer: ok",!0,m):ds(p,"TestPingServer: server error",!1,m)}).catch(()=>{clearTimeout(O),ds(p,"TestPingServer: error",!1,m)})}function ds(l,m,p,v,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),v(p)}catch{}}function T_(){this.g=new er}function C_(l,m,p){const v=p||"";try{mp(l,function(O,F){let ne=O;d(O)&&(ne=Ze(O)),m.push(v+F+"="+encodeURIComponent(ne))})}catch(O){throw m.push(v+"type="+encodeURIComponent("_badmap")),O}}function Tl(l){this.l=l.Ub||null,this.j=l.eb||!1}S(Tl,Wn),Tl.prototype.g=function(){return new Cl(this.l,this.j)},Tl.prototype.i=function(l){return function(){return l}}({});function Cl(l,m){L.call(this),this.D=l,this.o=m,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}S(Cl,L),t=Cl.prototype,t.open=function(l,m){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=m,this.readyState=1,$a(this)},t.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const m={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(m.body=l),(this.D||c).fetch(new Request(this.A,m)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Fa(this)),this.readyState=0},t.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,$a(this)),this.g&&(this.readyState=3,$a(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;wp(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function wp(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}t.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var m=l.value?l.value:new Uint8Array(0);(m=this.v.decode(m,{stream:!l.done}))&&(this.response=this.responseText+=m)}l.done?Fa(this):$a(this),this.readyState==3&&wp(this)}},t.Ra=function(l){this.g&&(this.response=this.responseText=l,Fa(this))},t.Qa=function(l){this.g&&(this.response=l,Fa(this))},t.ga=function(){this.g&&Fa(this)};function Fa(l){l.readyState=4,l.l=null,l.j=null,l.v=null,$a(l)}t.setRequestHeader=function(l,m){this.u.append(l,m)},t.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],m=this.h.entries();for(var p=m.next();!p.done;)p=p.value,l.push(p[0]+": "+p[1]),p=m.next();return l.join(`\r
`)};function $a(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Cl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function bp(l){let m="";return H(l,function(p,v){m+=v,m+=":",m+=p,m+=`\r
`}),m}function Zu(l,m,p){e:{for(v in p){var v=!1;break e}v=!0}v||(p=bp(p),typeof l=="string"?p!=null&&encodeURIComponent(String(p)):rt(l,m,p))}function vt(l){L.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}S(vt,L);var S_=/^https?$/i,N_=["POST","PUT"];t=vt.prototype,t.Ha=function(l){this.J=l},t.ea=function(l,m,p,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);m=m?m.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():K.g(),this.v=this.o?as(this.o):as(K),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(m,String(l),!0),this.B=!1}catch(F){_p(this,F);return}if(l=p||"",p=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var O in v)p.set(O,v[O]);else if(typeof v.keys=="function"&&typeof v.get=="function")for(const F of v.keys())p.set(F,v.get(F));else throw Error("Unknown input type for opt_headers: "+String(v));v=Array.from(p.keys()).find(F=>F.toLowerCase()=="content-type"),O=c.FormData&&l instanceof c.FormData,!(0<=Array.prototype.indexOf.call(N_,m,void 0))||v||O||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[F,ne]of p)this.g.setRequestHeader(F,ne);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Cp(this),this.u=!0,this.g.send(l),this.u=!1}catch(F){_p(this,F)}};function _p(l,m){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=m,l.m=5,Ep(l),Sl(l)}function Ep(l){l.A||(l.A=!0,U(l,"complete"),U(l,"error"))}t.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,U(this,"complete"),U(this,"abort"),Sl(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Sl(this,!0)),vt.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Tp(this):this.bb())},t.bb=function(){Tp(this)};function Tp(l){if(l.h&&typeof a<"u"&&(!l.v[1]||Rr(l)!=4||l.Z()!=2)){if(l.u&&Rr(l)==4)Ne(l.Ea,0,l);else if(U(l,"readystatechange"),Rr(l)==4){l.h=!1;try{const ne=l.Z();e:switch(ne){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var m=!0;break e;default:m=!1}var p;if(!(p=m)){var v;if(v=ne===0){var O=String(l.D).match(fp)[1]||null;!O&&c.self&&c.self.location&&(O=c.self.location.protocol.slice(0,-1)),v=!S_.test(O?O.toLowerCase():"")}p=v}if(p)U(l,"complete"),U(l,"success");else{l.m=6;try{var F=2<Rr(l)?l.g.statusText:""}catch{F=""}l.l=F+" ["+l.Z()+"]",Ep(l)}}finally{Sl(l)}}}}function Sl(l,m){if(l.g){Cp(l);const p=l.g,v=l.v[0]?()=>{}:null;l.g=null,l.v=null,m||U(l,"ready");try{p.onreadystatechange=v}catch{}}}function Cp(l){l.I&&(c.clearTimeout(l.I),l.I=null)}t.isActive=function(){return!!this.g};function Rr(l){return l.g?l.g.readyState:0}t.Z=function(){try{return 2<Rr(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(l){if(this.g){var m=this.g.responseText;return l&&m.indexOf(l)==0&&(m=m.substring(l.length)),pr(m)}};function Sp(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function k_(l){const m={};l=(l.g&&2<=Rr(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let v=0;v<l.length;v++){if(w(l[v]))continue;var p=D(l[v]);const O=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();const F=m[O]||[];m[O]=F,F.push(p)}E(m,function(v){return v.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ua(l,m,p){return p&&p.internalChannelParams&&p.internalChannelParams[l]||m}function Np(l){this.Aa=0,this.i=[],this.j=new gr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ua("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ua("baseRetryDelayMs",5e3,l),this.cb=Ua("retryDelaySeedMs",1e4,l),this.Wa=Ua("forwardChannelMaxRetries",2,l),this.wa=Ua("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new os(l&&l.concurrentRequestLimit),this.Da=new T_,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=Np.prototype,t.la=8,t.G=1,t.connect=function(l,m,p,v){yt(0),this.W=l,this.H=m||{},p&&v!==void 0&&(this.H.OSID=p,this.H.OAID=v),this.F=this.X,this.I=Lp(this,null,this.W),kl(this)};function ed(l){if(kp(l),l.G==3){var m=l.U++,p=Pr(l.I);if(rt(p,"SID",l.K),rt(p,"RID",m),rt(p,"TYPE","terminate"),Ba(l,p),m=new ue(l,l.j,m),m.L=2,m.v=El(Pr(p)),p=!1,c.navigator&&c.navigator.sendBeacon)try{p=c.navigator.sendBeacon(m.v.toString(),"")}catch{}!p&&c.Image&&(new Image().src=m.v,p=!0),p||(m.g=Op(m.j,null),m.g.ea(m.v)),m.F=Date.now(),$e(m)}Mp(l)}function Nl(l){l.g&&(nd(l),l.g.cancel(),l.g=null)}function kp(l){Nl(l),l.u&&(c.clearTimeout(l.u),l.u=null),Il(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&c.clearTimeout(l.s),l.s=null)}function kl(l){if(!fn(l.h)&&!l.s){l.s=!0;var m=l.Ga;Te||pe(),G||(Te(),G=!0),ie.add(m,l),l.B=0}}function I_(l,m){return ls(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=m.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Xt(g(l.Ga,l,m),Dp(l,l.B)),l.B++,!0)}t.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const O=new ue(this,this.j,l);let F=this.o;if(this.S&&(F?(F=_(F),A(F,this.S)):F=this.S),this.m!==null||this.O||(O.H=F,F=null),this.P)e:{for(var m=0,p=0;p<this.i.length;p++){t:{var v=this.i[p];if("__data__"in v.map&&(v=v.map.__data__,typeof v=="string")){v=v.length;break t}v=void 0}if(v===void 0)break;if(m+=v,4096<m){m=p;break e}if(m===4096||p===this.i.length-1){m=p+1;break e}}m=1e3}else m=1e3;m=Ap(this,O,m),p=Pr(this.I),rt(p,"RID",l),rt(p,"CVER",22),this.D&&rt(p,"X-HTTP-Session-Id",this.D),Ba(this,p),F&&(this.O?m="headers="+encodeURIComponent(String(bp(F)))+"&"+m:this.m&&Zu(p,this.m,F)),Hn(this.h,O),this.Ua&&rt(p,"TYPE","init"),this.P?(rt(p,"$req",m),rt(p,"SID","null"),O.T=!0,ke(O,p,null)):ke(O,p,m),this.G=2}}else this.G==3&&(l?Ip(this,l):this.i.length==0||fn(this.h)||Ip(this))};function Ip(l,m){var p;m?p=m.l:p=l.U++;const v=Pr(l.I);rt(v,"SID",l.K),rt(v,"RID",p),rt(v,"AID",l.T),Ba(l,v),l.m&&l.o&&Zu(v,l.m,l.o),p=new ue(l,l.j,p,l.B+1),l.m===null&&(p.H=l.o),m&&(l.i=m.D.concat(l.i)),m=Ap(l,p,1e3),p.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Hn(l.h,p),ke(p,v,m)}function Ba(l,m){l.H&&H(l.H,function(p,v){rt(m,v,p)}),l.l&&mp({},function(p,v){rt(m,v,p)})}function Ap(l,m,p){p=Math.min(l.i.length,p);var v=l.l?g(l.l.Na,l.l,l):null;e:{var O=l.i;let F=-1;for(;;){const ne=["count="+p];F==-1?0<p?(F=O[0].g,ne.push("ofs="+F)):F=0:ne.push("ofs="+F);let tt=!0;for(let Bt=0;Bt<p;Bt++){let He=O[Bt].g;const tn=O[Bt].map;if(He-=F,0>He)F=Math.max(0,O[Bt].g-100),tt=!1;else try{C_(tn,ne,"req"+He+"_")}catch{v&&v(tn)}}if(tt){v=ne.join("&");break e}}}return l=l.i.splice(0,p),m.D=l,v}function Pp(l){if(!l.g&&!l.u){l.Y=1;var m=l.Fa;Te||pe(),G||(Te(),G=!0),ie.add(m,l),l.v=0}}function td(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Xt(g(l.Fa,l),Dp(l,l.v)),l.v++,!0)}t.Fa=function(){if(this.u=null,Rp(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Xt(g(this.ab,this),l)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,yt(10),Nl(this),Rp(this))};function nd(l){l.A!=null&&(c.clearTimeout(l.A),l.A=null)}function Rp(l){l.g=new ue(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var m=Pr(l.qa);rt(m,"RID","rpc"),rt(m,"SID",l.K),rt(m,"AID",l.T),rt(m,"CI",l.F?"0":"1"),!l.F&&l.ja&&rt(m,"TO",l.ja),rt(m,"TYPE","xmlhttp"),Ba(l,m),l.m&&l.o&&Zu(m,l.m,l.o),l.L&&(l.g.I=l.L);var p=l.g;l=l.ia,p.L=1,p.v=El(Pr(m)),p.m=null,p.P=!0,Le(p,l)}t.Za=function(){this.C!=null&&(this.C=null,Nl(this),td(this),yt(19))};function Il(l){l.C!=null&&(c.clearTimeout(l.C),l.C=null)}function jp(l,m){var p=null;if(l.g==m){Il(l),nd(l),l.g=null;var v=2}else if(Ke(l.h,m))p=m.D,cs(l.h,m),v=1;else return;if(l.G!=0){if(m.o)if(v==1){p=m.m?m.m.length:0,m=Date.now()-m.F;var O=l.B;v=xe(),U(v,new Zs(v,p)),kl(l)}else Pp(l);else if(O=m.s,O==3||O==0&&0<m.X||!(v==1&&I_(l,m)||v==2&&td(l)))switch(p&&0<p.length&&(m=l.h,m.i=m.i.concat(p)),O){case 1:ni(l,5);break;case 4:ni(l,10);break;case 3:ni(l,6);break;default:ni(l,2)}}}function Dp(l,m){let p=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(p*=2),p*m}function ni(l,m){if(l.j.info("Error code "+m),m==2){var p=g(l.fb,l),v=l.Xa;const O=!v;v=new ti(v||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||bl(v,"https"),El(v),O?__(v.toString(),p):E_(v.toString(),p)}else yt(2);l.G=0,l.l&&l.l.sa(m),Mp(l),kp(l)}t.fb=function(l){l?(this.j.info("Successfully pinged google.com"),yt(2)):(this.j.info("Failed to ping google.com"),yt(1))};function Mp(l){if(l.G=0,l.ka=[],l.l){const m=en(l.h);(m.length!=0||l.i.length!=0)&&(k(l.ka,m),k(l.ka,l.i),l.h.i.length=0,y(l.i),l.i.length=0),l.l.ra()}}function Lp(l,m,p){var v=p instanceof ti?Pr(p):new ti(p);if(v.g!="")m&&(v.g=m+"."+v.g),_l(v,v.s);else{var O=c.location;v=O.protocol,m=m?m+"."+O.hostname:O.hostname,O=+O.port;var F=new ti(null);v&&bl(F,v),m&&(F.g=m),O&&_l(F,O),p&&(F.l=p),v=F}return p=l.D,m=l.ya,p&&m&&rt(v,p,m),rt(v,"VER",l.la),Ba(l,v),v}function Op(l,m,p){if(m&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return m=l.Ca&&!l.pa?new vt(new Tl({eb:p})):new vt(l.pa),m.Ha(l.J),m}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Vp(){}t=Vp.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function Al(){}Al.prototype.g=function(l,m){return new Mn(l,m)};function Mn(l,m){L.call(this),this.g=new Np(m),this.l=l,this.h=m&&m.messageUrlParams||null,l=m&&m.messageHeaders||null,m&&m.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=m&&m.initMessageHeaders||null,m&&m.messageContentType&&(l?l["X-WebChannel-Content-Type"]=m.messageContentType:l={"X-WebChannel-Content-Type":m.messageContentType}),m&&m.va&&(l?l["X-WebChannel-Client-Profile"]=m.va:l={"X-WebChannel-Client-Profile":m.va}),this.g.S=l,(l=m&&m.Sb)&&!w(l)&&(this.g.m=l),this.v=m&&m.supportsCrossDomainXhr||!1,this.u=m&&m.sendRawJson||!1,(m=m&&m.httpSessionIdParam)&&!w(m)&&(this.g.D=m,l=this.h,l!==null&&m in l&&(l=this.h,m in l&&delete l[m])),this.j=new Ri(this)}S(Mn,L),Mn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Mn.prototype.close=function(){ed(this.g)},Mn.prototype.o=function(l){var m=this.g;if(typeof l=="string"){var p={};p.__data__=l,l=p}else this.u&&(p={},p.__data__=Ze(l),l=p);m.i.push(new Ma(m.Ya++,l)),m.G==3&&kl(m)},Mn.prototype.N=function(){this.g.l=null,delete this.j,ed(this.g),delete this.g,Mn.aa.N.call(this)};function Fp(l){R.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var m=l.__sm__;if(m){e:{for(const p in m){l=p;break e}l=void 0}(this.i=l)&&(l=this.i,m=m!==null&&l in m?m[l]:void 0),this.data=m}else this.data=l}S(Fp,R);function $p(){te.call(this),this.status=1}S($p,te);function Ri(l){this.g=l}S(Ri,Vp),Ri.prototype.ua=function(){U(this.g,"a")},Ri.prototype.ta=function(l){U(this.g,new Fp(l))},Ri.prototype.sa=function(l){U(this.g,new $p)},Ri.prototype.ra=function(){U(this.g,"b")},Al.prototype.createWebChannel=Al.prototype.g,Mn.prototype.send=Mn.prototype.o,Mn.prototype.open=Mn.prototype.m,Mn.prototype.close=Mn.prototype.close,qw=function(){return new Al},Hw=function(){return xe()},Ww=me,Qh={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},V.NO_ERROR=0,V.TIMEOUT=8,V.HTTP_ERROR=6,yc=V,se.COMPLETE="complete",zw=se,Dt.EventType=jn,jn.OPEN="a",jn.CLOSE="b",jn.ERROR="c",jn.MESSAGE="d",L.prototype.listen=L.prototype.K,so=Dt,vt.prototype.listenOnce=vt.prototype.L,vt.prototype.getLastError=vt.prototype.Ka,vt.prototype.getLastErrorCode=vt.prototype.Ba,vt.prototype.getStatus=vt.prototype.Z,vt.prototype.getResponseJson=vt.prototype.Oa,vt.prototype.getResponseText=vt.prototype.oa,vt.prototype.send=vt.prototype.ea,vt.prototype.setWithCredentials=vt.prototype.Ha,Bw=vt}).apply(typeof Yl<"u"?Yl:typeof self<"u"?self:typeof window<"u"?window:{});const Dy="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}on.UNAUTHENTICATED=new on(null),on.GOOGLE_CREDENTIALS=new on("google-credentials-uid"),on.FIRST_PARTY=new on("first-party-uid"),on.MOCK_USER=new on("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Aa="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _i=new df("@firebase/firestore");function Ja(){return _i.logLevel}function he(t,...e){if(_i.logLevel<=Ue.DEBUG){const n=e.map(Ef);_i.debug(`Firestore (${Aa}): ${t}`,...n)}}function Yr(t,...e){if(_i.logLevel<=Ue.ERROR){const n=e.map(Ef);_i.error(`Firestore (${Aa}): ${t}`,...n)}}function ga(t,...e){if(_i.logLevel<=Ue.WARN){const n=e.map(Ef);_i.warn(`Firestore (${Aa}): ${t}`,...n)}}function Ef(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ce(t="Unexpected state"){const e=`FIRESTORE (${Aa}) INTERNAL ASSERTION FAILED: `+t;throw Yr(e),new Error(e)}function Ye(t,e){t||Ce()}function Ae(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ae extends ts{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gw{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tI{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(on.UNAUTHENTICATED))}shutdown(){}}class nI{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class rI{constructor(e){this.t=e,this.currentUser=on.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Ye(this.o===void 0);let r=this.i;const s=u=>this.i!==r?(r=this.i,n(u)):Promise.resolve();let i=new zr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new zr,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const u=i;e.enqueueRetryable(async()=>{await u.promise,await s(this.currentUser)})},c=u=>{he("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?c(u):(he("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new zr)}},0),a()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(he("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ye(typeof r.accessToken=="string"),new Gw(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ye(e===null||typeof e=="string"),new on(e)}}class sI{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=on.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class iI{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new sI(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(on.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class aI{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class oI{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){Ye(this.o===void 0);const r=i=>{i.error!=null&&he("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.R;return this.R=i.token,he("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{he("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):he("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Ye(typeof n.token=="string"),this.R=n.token,new aI(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lI(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=lI(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%e.length))}return r}}function qe(t,e){return t<e?-1:t>e?1:0}function ya(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new ae(z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ae(z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new ae(z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ae(z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return jt.fromMillis(Date.now())}static fromDate(e){return jt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new jt(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?qe(this.nanoseconds,e.nanoseconds):qe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ie(e)}static min(){return new Ie(new jt(0,0))}static max(){return new Ie(new jt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(e,n,r){n===void 0?n=0:n>e.length&&Ce(),r===void 0?r=e.length-n:r>e.length-n&&Ce(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Ho.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Ho?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=e.get(s),a=n.get(s);if(i<a)return-1;if(i>a)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class it extends Ho{construct(e,n,r){return new it(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new ae(z.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new it(n)}static emptyPath(){return new it([])}}const cI=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ht extends Ho{construct(e,n,r){return new Ht(e,n,r)}static isValidIdentifier(e){return cI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ht.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ht(["__name__"])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ae(z.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let a=!1;for(;s<e.length;){const c=e[s];if(c==="\\"){if(s+1===e.length)throw new ae(z.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new ae(z.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(r+=c,s++):(i(),s++)}if(i(),a)throw new ae(z.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ht(n)}static emptyPath(){return new Ht([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{constructor(e){this.path=e}static fromPath(e){return new we(it.fromString(e))}static fromName(e){return new we(it.fromString(e).popFirst(5))}static empty(){return new we(it.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&it.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return it.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new we(new it(e.slice()))}}function uI(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=Ie.fromTimestamp(r===1e9?new jt(n+1,0):new jt(n,r));return new Bs(s,we.empty(),e)}function dI(t){return new Bs(t.readTime,t.key,-1)}class Bs{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Bs(Ie.min(),we.empty(),-1)}static max(){return new Bs(Ie.max(),we.empty(),-1)}}function hI(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=we.comparator(t.documentKey,e.documentKey),n!==0?n:qe(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class fI{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ul(t){if(t.code!==z.FAILED_PRECONDITION||t.message!==mI)throw t;he("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ce(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new Q((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof Q?n:Q.resolve(n)}catch(n){return Q.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):Q.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):Q.reject(n)}static resolve(e){return new Q((n,r)=>{n(e)})}static reject(e){return new Q((n,r)=>{r(e)})}static waitFor(e){return new Q((n,r)=>{let s=0,i=0,a=!1;e.forEach(c=>{++s,c.next(()=>{++i,a&&i===s&&n()},u=>r(u))}),a=!0,i===s&&n()})}static or(e){let n=Q.resolve(!1);for(const r of e)n=n.next(s=>s?Q.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new Q((r,s)=>{const i=e.length,a=new Array(i);let c=0;for(let u=0;u<i;u++){const d=u;n(e[d]).next(h=>{a[d]=h,++c,c===i&&r(a)},h=>s(h))}})}static doWhile(e,n){return new Q((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}function pI(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function dl(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Tf.oe=-1;function Mu(t){return t==null}function su(t){return t===0&&1/t==-1/0}function gI(t){return typeof t=="number"&&Number.isInteger(t)&&!su(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function My(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ki(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Qw(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(e,n){this.comparator=e,this.root=n||Wt.EMPTY}insert(e,n){return new gt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Wt.BLACK,null,null))}remove(e){return new gt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wt.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Jl(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Jl(this.root,e,this.comparator,!1)}getReverseIterator(){return new Jl(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Jl(this.root,e,this.comparator,!0)}}class Jl{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Wt{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??Wt.RED,this.left=s??Wt.EMPTY,this.right=i??Wt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new Wt(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Wt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return Wt.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Wt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Wt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ce();const e=this.left.check();if(e!==this.right.check())throw Ce();return e+(this.isRed()?0:1)}}Wt.EMPTY=null,Wt.RED=!0,Wt.BLACK=!1;Wt.EMPTY=new class{constructor(){this.size=0}get key(){throw Ce()}get value(){throw Ce()}get color(){throw Ce()}get left(){throw Ce()}get right(){throw Ce()}copy(e,n,r,s,i){return this}insert(e,n,r){return new Wt(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{constructor(e){this.comparator=e,this.data=new gt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Ly(this.data.getIterator())}getIteratorFrom(e){return new Ly(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof Gt)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Gt(this.comparator);return n.data=e,n}}class Ly{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e){this.fields=e,e.sort(Ht.comparator)}static empty(){return new Fn([])}unionWith(e){let n=new Gt(Ht.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Fn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return ya(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Yw("Invalid base64 string: "+i):i}}(e);return new Qt(n)}static fromUint8Array(e){const n=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new Qt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return qe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qt.EMPTY_BYTE_STRING=new Qt("");const yI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function zs(t){if(Ye(!!t),typeof t=="string"){let e=0;const n=yI.exec(t);if(Ye(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:_t(t.seconds),nanos:_t(t.nanos)}}function _t(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ei(t){return typeof t=="string"?Qt.fromBase64String(t):Qt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cf(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Sf(t){const e=t.mapValue.fields.__previous_value__;return Cf(e)?Sf(e):e}function qo(t){const e=zs(t.mapValue.fields.__local_write_time__.timestampValue);return new jt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vI{constructor(e,n,r,s,i,a,c,u,d){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=d}}class Go{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new Go("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Go&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xl={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Ti(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Cf(t)?4:wI(t)?9007199254740991:xI(t)?10:11:Ce()}function kr(t,e){if(t===e)return!0;const n=Ti(t);if(n!==Ti(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return qo(t).isEqual(qo(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=zs(s.timestampValue),c=zs(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return Ei(s.bytesValue).isEqual(Ei(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return _t(s.geoPointValue.latitude)===_t(i.geoPointValue.latitude)&&_t(s.geoPointValue.longitude)===_t(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return _t(s.integerValue)===_t(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=_t(s.doubleValue),c=_t(i.doubleValue);return a===c?su(a)===su(c):isNaN(a)&&isNaN(c)}return!1}(t,e);case 9:return ya(t.arrayValue.values||[],e.arrayValue.values||[],kr);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},c=i.mapValue.fields||{};if(My(a)!==My(c))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(c[u]===void 0||!kr(a[u],c[u])))return!1;return!0}(t,e);default:return Ce()}}function Ko(t,e){return(t.values||[]).find(n=>kr(n,e))!==void 0}function va(t,e){if(t===e)return 0;const n=Ti(t),r=Ti(e);if(n!==r)return qe(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return qe(t.booleanValue,e.booleanValue);case 2:return function(i,a){const c=_t(i.integerValue||i.doubleValue),u=_t(a.integerValue||a.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(t,e);case 3:return Oy(t.timestampValue,e.timestampValue);case 4:return Oy(qo(t),qo(e));case 5:return qe(t.stringValue,e.stringValue);case 6:return function(i,a){const c=Ei(i),u=Ei(a);return c.compareTo(u)}(t.bytesValue,e.bytesValue);case 7:return function(i,a){const c=i.split("/"),u=a.split("/");for(let d=0;d<c.length&&d<u.length;d++){const h=qe(c[d],u[d]);if(h!==0)return h}return qe(c.length,u.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,a){const c=qe(_t(i.latitude),_t(a.latitude));return c!==0?c:qe(_t(i.longitude),_t(a.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Vy(t.arrayValue,e.arrayValue);case 10:return function(i,a){var c,u,d,h;const f=i.fields||{},g=a.fields||{},x=(c=f.value)===null||c===void 0?void 0:c.arrayValue,S=(u=g.value)===null||u===void 0?void 0:u.arrayValue,y=qe(((d=x==null?void 0:x.values)===null||d===void 0?void 0:d.length)||0,((h=S==null?void 0:S.values)===null||h===void 0?void 0:h.length)||0);return y!==0?y:Vy(x,S)}(t.mapValue,e.mapValue);case 11:return function(i,a){if(i===Xl.mapValue&&a===Xl.mapValue)return 0;if(i===Xl.mapValue)return 1;if(a===Xl.mapValue)return-1;const c=i.fields||{},u=Object.keys(c),d=a.fields||{},h=Object.keys(d);u.sort(),h.sort();for(let f=0;f<u.length&&f<h.length;++f){const g=qe(u[f],h[f]);if(g!==0)return g;const x=va(c[u[f]],d[h[f]]);if(x!==0)return x}return qe(u.length,h.length)}(t.mapValue,e.mapValue);default:throw Ce()}}function Oy(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return qe(t,e);const n=zs(t),r=zs(e),s=qe(n.seconds,r.seconds);return s!==0?s:qe(n.nanos,r.nanos)}function Vy(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=va(n[s],r[s]);if(i)return i}return qe(n.length,r.length)}function xa(t){return Yh(t)}function Yh(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=zs(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Ei(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return we.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=Yh(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${Yh(n.fields[a])}`;return s+"}"}(t.mapValue):Ce()}function Fy(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Jh(t){return!!t&&"integerValue"in t}function Nf(t){return!!t&&"arrayValue"in t}function $y(t){return!!t&&"nullValue"in t}function Uy(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function vc(t){return!!t&&"mapValue"in t}function xI(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function xo(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ki(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=xo(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=xo(t.arrayValue.values[n]);return e}return Object.assign({},t)}function wI(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nn{constructor(e){this.value=e}static empty(){return new Nn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!vc(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=xo(n)}setAll(e){let n=Ht.emptyPath(),r={},s=[];e.forEach((a,c)=>{if(!n.isImmediateParentOf(c)){const u=this.getFieldsMap(n);this.applyChanges(u,r,s),r={},s=[],n=c.popLast()}a?r[c.lastSegment()]=xo(a):s.push(c.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());vc(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return kr(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];vc(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){ki(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Nn(xo(this.value))}}function Jw(t){const e=[];return ki(t.fields,(n,r)=>{const s=new Ht([n]);if(vc(r)){const i=Jw(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new Fn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn{constructor(e,n,r,s,i,a,c){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(e){return new cn(e,0,Ie.min(),Ie.min(),Ie.min(),Nn.empty(),0)}static newFoundDocument(e,n,r,s){return new cn(e,1,n,Ie.min(),r,s,0)}static newNoDocument(e,n){return new cn(e,2,n,Ie.min(),Ie.min(),Nn.empty(),0)}static newUnknownDocument(e,n){return new cn(e,3,n,Ie.min(),Ie.min(),Nn.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Ie.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Nn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Nn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ie.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof cn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new cn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iu{constructor(e,n){this.position=e,this.inclusive=n}}function By(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],a=t.position[s];if(i.field.isKeyField()?r=we.comparator(we.fromName(a.referenceValue),n.key):r=va(a,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function zy(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!kr(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class au{constructor(e,n="asc"){this.field=e,this.dir=n}}function bI(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xw{}class kt extends Xw{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new EI(e,n,r):n==="array-contains"?new SI(e,r):n==="in"?new NI(e,r):n==="not-in"?new kI(e,r):n==="array-contains-any"?new II(e,r):new kt(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new TI(e,r):new CI(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(va(n,this.value)):n!==null&&Ti(this.value)===Ti(n)&&this.matchesComparison(va(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ce()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class mr extends Xw{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new mr(e,n)}matches(e){return Zw(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Zw(t){return t.op==="and"}function eb(t){return _I(t)&&Zw(t)}function _I(t){for(const e of t.filters)if(e instanceof mr)return!1;return!0}function Xh(t){if(t instanceof kt)return t.field.canonicalString()+t.op.toString()+xa(t.value);if(eb(t))return t.filters.map(e=>Xh(e)).join(",");{const e=t.filters.map(n=>Xh(n)).join(",");return`${t.op}(${e})`}}function tb(t,e){return t instanceof kt?function(r,s){return s instanceof kt&&r.op===s.op&&r.field.isEqual(s.field)&&kr(r.value,s.value)}(t,e):t instanceof mr?function(r,s){return s instanceof mr&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,c)=>i&&tb(a,s.filters[c]),!0):!1}(t,e):void Ce()}function nb(t){return t instanceof kt?function(n){return`${n.field.canonicalString()} ${n.op} ${xa(n.value)}`}(t):t instanceof mr?function(n){return n.op.toString()+" {"+n.getFilters().map(nb).join(" ,")+"}"}(t):"Filter"}class EI extends kt{constructor(e,n,r){super(e,n,r),this.key=we.fromName(r.referenceValue)}matches(e){const n=we.comparator(e.key,this.key);return this.matchesComparison(n)}}class TI extends kt{constructor(e,n){super(e,"in",n),this.keys=rb("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class CI extends kt{constructor(e,n){super(e,"not-in",n),this.keys=rb("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function rb(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>we.fromName(r.referenceValue))}class SI extends kt{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Nf(n)&&Ko(n.arrayValue,this.value)}}class NI extends kt{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Ko(this.value.arrayValue,n)}}class kI extends kt{constructor(e,n){super(e,"not-in",n)}matches(e){if(Ko(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!Ko(this.value.arrayValue,n)}}class II extends kt{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Nf(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Ko(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AI{constructor(e,n=null,r=[],s=[],i=null,a=null,c=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=c,this.ue=null}}function Wy(t,e=null,n=[],r=[],s=null,i=null,a=null){return new AI(t,e,n,r,s,i,a)}function kf(t){const e=Ae(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>Xh(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Mu(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>xa(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>xa(r)).join(",")),e.ue=n}return e.ue}function If(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!bI(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!tb(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!zy(t.startAt,e.startAt)&&zy(t.endAt,e.endAt)}function Zh(t){return we.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(e,n=null,r=[],s=[],i=null,a="F",c=null,u=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function PI(t,e,n,r,s,i,a,c){return new hl(t,e,n,r,s,i,a,c)}function Lu(t){return new hl(t)}function Hy(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function sb(t){return t.collectionGroup!==null}function wo(t){const e=Ae(t);if(e.ce===null){e.ce=[];const n=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new Gt(Ht.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(d=>{d.isInequality()&&(c=c.add(d.field))})}),c})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.ce.push(new au(i,r))}),n.has(Ht.keyField().canonicalString())||e.ce.push(new au(Ht.keyField(),r))}return e.ce}function Sr(t){const e=Ae(t);return e.le||(e.le=RI(e,wo(t))),e.le}function RI(t,e){if(t.limitType==="F")return Wy(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new au(s.field,i)});const n=t.endAt?new iu(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new iu(t.startAt.position,t.startAt.inclusive):null;return Wy(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function em(t,e){const n=t.filters.concat([e]);return new hl(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function ou(t,e,n){return new hl(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ou(t,e){return If(Sr(t),Sr(e))&&t.limitType===e.limitType}function ib(t){return`${kf(Sr(t))}|lt:${t.limitType}`}function Li(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>nb(s)).join(", ")}]`),Mu(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>xa(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>xa(s)).join(",")),`Target(${r})`}(Sr(t))}; limitType=${t.limitType})`}function Vu(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):we.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of wo(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(a,c,u){const d=By(a,c,u);return a.inclusive?d<=0:d<0}(r.startAt,wo(r),s)||r.endAt&&!function(a,c,u){const d=By(a,c,u);return a.inclusive?d>=0:d>0}(r.endAt,wo(r),s))}(t,e)}function jI(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function ab(t){return(e,n)=>{let r=!1;for(const s of wo(t)){const i=DI(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function DI(t,e,n){const r=t.field.isKeyField()?we.comparator(e.key,n.key):function(i,a,c){const u=a.data.field(i),d=c.data.field(i);return u!==null&&d!==null?va(u,d):Ce()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ce()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){ki(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Qw(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MI=new gt(we.comparator);function Jr(){return MI}const ob=new gt(we.comparator);function io(...t){let e=ob;for(const n of t)e=e.insert(n.key,n);return e}function lb(t){let e=ob;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function ui(){return bo()}function cb(){return bo()}function bo(){return new Pa(t=>t.toString(),(t,e)=>t.isEqual(e))}const LI=new gt(we.comparator),OI=new Gt(we.comparator);function Ve(...t){let e=OI;for(const n of t)e=e.add(n);return e}const VI=new Gt(qe);function FI(){return VI}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Af(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:su(e)?"-0":e}}function ub(t){return{integerValue:""+t}}function $I(t,e){return gI(e)?ub(e):Af(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu{constructor(){this._=void 0}}function UI(t,e,n){return t instanceof Qo?function(s,i){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Cf(i)&&(i=Sf(i)),i&&(a.fields.__previous_value__=i),{mapValue:a}}(n,e):t instanceof Yo?hb(t,e):t instanceof Jo?mb(t,e):function(s,i){const a=db(s,i),c=qy(a)+qy(s.Pe);return Jh(a)&&Jh(s.Pe)?ub(c):Af(s.serializer,c)}(t,e)}function BI(t,e,n){return t instanceof Yo?hb(t,e):t instanceof Jo?mb(t,e):n}function db(t,e){return t instanceof lu?function(r){return Jh(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Qo extends Fu{}class Yo extends Fu{constructor(e){super(),this.elements=e}}function hb(t,e){const n=fb(e);for(const r of t.elements)n.some(s=>kr(s,r))||n.push(r);return{arrayValue:{values:n}}}class Jo extends Fu{constructor(e){super(),this.elements=e}}function mb(t,e){let n=fb(e);for(const r of t.elements)n=n.filter(s=>!kr(s,r));return{arrayValue:{values:n}}}class lu extends Fu{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function qy(t){return _t(t.integerValue||t.doubleValue)}function fb(t){return Nf(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zI{constructor(e,n){this.field=e,this.transform=n}}function WI(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof Yo&&s instanceof Yo||r instanceof Jo&&s instanceof Jo?ya(r.elements,s.elements,kr):r instanceof lu&&s instanceof lu?kr(r.Pe,s.Pe):r instanceof Qo&&s instanceof Qo}(t.transform,e.transform)}class HI{constructor(e,n){this.version=e,this.transformResults=n}}class ur{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new ur}static exists(e){return new ur(void 0,e)}static updateTime(e){return new ur(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function xc(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class $u{}function pb(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Pf(t.key,ur.none()):new ml(t.key,t.data,ur.none());{const n=t.data,r=Nn.empty();let s=new Gt(Ht.comparator);for(let i of e.fields)if(!s.has(i)){let a=n.field(i);a===null&&i.length>1&&(i=i.popLast(),a=n.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Js(t.key,r,new Fn(s.toArray()),ur.none())}}function qI(t,e,n){t instanceof ml?function(s,i,a){const c=s.value.clone(),u=Ky(s.fieldTransforms,i,a.transformResults);c.setAll(u),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(t,e,n):t instanceof Js?function(s,i,a){if(!xc(s.precondition,i))return void i.convertToUnknownDocument(a.version);const c=Ky(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(gb(s)),u.setAll(c),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(t,e,n):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,n)}function _o(t,e,n,r){return t instanceof ml?function(i,a,c,u){if(!xc(i.precondition,a))return c;const d=i.value.clone(),h=Qy(i.fieldTransforms,u,a);return d.setAll(h),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof Js?function(i,a,c,u){if(!xc(i.precondition,a))return c;const d=Qy(i.fieldTransforms,u,a),h=a.data;return h.setAll(gb(i)),h.setAll(d),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(t,e,n,r):function(i,a,c){return xc(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c}(t,e,n)}function GI(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=db(r.transform,s||null);i!=null&&(n===null&&(n=Nn.empty()),n.set(r.field,i))}return n||null}function Gy(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ya(r,s,(i,a)=>WI(i,a))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class ml extends $u{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Js extends $u{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function gb(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function Ky(t,e,n){const r=new Map;Ye(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],a=i.transform,c=e.data.field(i.field);r.set(i.field,BI(a,c,n[s]))}return r}function Qy(t,e,n){const r=new Map;for(const s of t){const i=s.transform,a=n.data.field(s.field);r.set(s.field,UI(i,a,e))}return r}class Pf extends $u{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class KI extends $u{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QI{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&qI(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=_o(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=_o(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=cb();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let c=this.applyToLocalView(a,i.mutatedFields);c=n.has(s.key)?null:c;const u=pb(a,c);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(Ie.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ve())}isEqual(e){return this.batchId===e.batchId&&ya(this.mutations,e.mutations,(n,r)=>Gy(n,r))&&ya(this.baseMutations,e.baseMutations,(n,r)=>Gy(n,r))}}class Rf{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Ye(e.mutations.length===r.length);let s=function(){return LI}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new Rf(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YI{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JI{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var St,ze;function XI(t){switch(t){default:return Ce();case z.CANCELLED:case z.UNKNOWN:case z.DEADLINE_EXCEEDED:case z.RESOURCE_EXHAUSTED:case z.INTERNAL:case z.UNAVAILABLE:case z.UNAUTHENTICATED:return!1;case z.INVALID_ARGUMENT:case z.NOT_FOUND:case z.ALREADY_EXISTS:case z.PERMISSION_DENIED:case z.FAILED_PRECONDITION:case z.ABORTED:case z.OUT_OF_RANGE:case z.UNIMPLEMENTED:case z.DATA_LOSS:return!0}}function yb(t){if(t===void 0)return Yr("GRPC error has no .code"),z.UNKNOWN;switch(t){case St.OK:return z.OK;case St.CANCELLED:return z.CANCELLED;case St.UNKNOWN:return z.UNKNOWN;case St.DEADLINE_EXCEEDED:return z.DEADLINE_EXCEEDED;case St.RESOURCE_EXHAUSTED:return z.RESOURCE_EXHAUSTED;case St.INTERNAL:return z.INTERNAL;case St.UNAVAILABLE:return z.UNAVAILABLE;case St.UNAUTHENTICATED:return z.UNAUTHENTICATED;case St.INVALID_ARGUMENT:return z.INVALID_ARGUMENT;case St.NOT_FOUND:return z.NOT_FOUND;case St.ALREADY_EXISTS:return z.ALREADY_EXISTS;case St.PERMISSION_DENIED:return z.PERMISSION_DENIED;case St.FAILED_PRECONDITION:return z.FAILED_PRECONDITION;case St.ABORTED:return z.ABORTED;case St.OUT_OF_RANGE:return z.OUT_OF_RANGE;case St.UNIMPLEMENTED:return z.UNIMPLEMENTED;case St.DATA_LOSS:return z.DATA_LOSS;default:return Ce()}}(ze=St||(St={}))[ze.OK=0]="OK",ze[ze.CANCELLED=1]="CANCELLED",ze[ze.UNKNOWN=2]="UNKNOWN",ze[ze.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ze[ze.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ze[ze.NOT_FOUND=5]="NOT_FOUND",ze[ze.ALREADY_EXISTS=6]="ALREADY_EXISTS",ze[ze.PERMISSION_DENIED=7]="PERMISSION_DENIED",ze[ze.UNAUTHENTICATED=16]="UNAUTHENTICATED",ze[ze.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ze[ze.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ze[ze.ABORTED=10]="ABORTED",ze[ze.OUT_OF_RANGE=11]="OUT_OF_RANGE",ze[ze.UNIMPLEMENTED=12]="UNIMPLEMENTED",ze[ze.INTERNAL=13]="INTERNAL",ze[ze.UNAVAILABLE=14]="UNAVAILABLE",ze[ze.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZI(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eA=new mi([4294967295,4294967295],0);function Yy(t){const e=ZI().encode(t),n=new Uw;return n.update(e),new Uint8Array(n.digest())}function Jy(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new mi([n,r],0),new mi([s,i],0)]}class jf{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new ao(`Invalid padding: ${n}`);if(r<0)throw new ao(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ao(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new ao(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=mi.fromNumber(this.Ie)}Ee(e,n,r){let s=e.add(n.multiply(mi.fromNumber(r)));return s.compare(eA)===1&&(s=new mi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const n=Yy(e),[r,s]=Jy(n);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);if(!this.de(a))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new jf(i,s,n);return r.forEach(c=>a.insert(c)),a}insert(e){if(this.Ie===0)return;const n=Yy(e),[r,s]=Jy(n);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);this.Ae(a)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class ao extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,fl.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new Uu(Ie.min(),s,new gt(qe),Jr(),Ve())}}class fl{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new fl(r,n,Ve(),Ve(),Ve())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(e,n,r,s){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=s}}class vb{constructor(e,n){this.targetId=e,this.me=n}}class xb{constructor(e,n,r=Qt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class Xy{constructor(){this.fe=0,this.ge=e0(),this.pe=Qt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ve(),n=Ve(),r=Ve();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:Ce()}}),new fl(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=e0()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ye(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class tA{constructor(e){this.Le=e,this.Be=new Map,this.ke=Jr(),this.qe=Zy(),this.Qe=new gt(qe)}Ke(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{const r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:Ce()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,s)=>{this.ze(s)&&n(s)})}He(e){const n=e.targetId,r=e.me.count,s=this.Je(n);if(s){const i=s.target;if(Zh(i))if(r===0){const a=new we(i.path);this.Ue(n,a,cn.newNoDocument(a,Ie.min()))}else Ye(r===1);else{const a=this.Ye(n);if(a!==r){const c=this.Ze(e),u=c?this.Xe(c,e,a):1;if(u!==0){this.je(n);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,d)}}}}}Ze(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let a,c;try{a=Ei(r).toUint8Array()}catch(u){if(u instanceof Yw)return ga("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new jf(a,s,i)}catch(u){return ga(u instanceof ao?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.Ie===0?null:c}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const a=this.Le.tt(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.Ue(n,i,null),s++)}),s}rt(e){const n=new Map;this.Be.forEach((i,a)=>{const c=this.Je(a);if(c){if(i.current&&Zh(c.target)){const u=new we(c.target.path);this.ke.get(u)!==null||this.it(a,u)||this.Ue(a,u,cn.newNoDocument(u,e))}i.be&&(n.set(a,i.ve()),i.Ce())}});let r=Ve();this.qe.forEach((i,a)=>{let c=!0;a.forEachWhile(u=>{const d=this.Je(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(i))}),this.ke.forEach((i,a)=>a.setReadTime(e));const s=new Uu(e,n,this.Qe,this.ke,r);return this.ke=Jr(),this.qe=Zy(),this.Qe=new gt(qe),s}$e(e,n){if(!this.ze(e))return;const r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,n)?s.Fe(n,1):s.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const n=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new Xy,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new Gt(qe),this.qe=this.qe.insert(e,n)),n}ze(e){const n=this.Je(e)!==null;return n||he("WatchChangeAggregator","Detected inactive target",e),n}Je(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Xy),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function Zy(){return new gt(we.comparator)}function e0(){return new gt(we.comparator)}const nA=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),rA=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),sA=(()=>({and:"AND",or:"OR"}))();class iA{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function tm(t,e){return t.useProto3Json||Mu(e)?e:{value:e}}function cu(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function wb(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function aA(t,e){return cu(t,e.toTimestamp())}function Nr(t){return Ye(!!t),Ie.fromTimestamp(function(n){const r=zs(n);return new jt(r.seconds,r.nanos)}(t))}function Df(t,e){return nm(t,e).canonicalString()}function nm(t,e){const n=function(s){return new it(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function bb(t){const e=it.fromString(t);return Ye(Sb(e)),e}function rm(t,e){return Df(t.databaseId,e.path)}function Vd(t,e){const n=bb(e);if(n.get(1)!==t.databaseId.projectId)throw new ae(z.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ae(z.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new we(Eb(n))}function _b(t,e){return Df(t.databaseId,e)}function oA(t){const e=bb(t);return e.length===4?it.emptyPath():Eb(e)}function sm(t){return new it(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Eb(t){return Ye(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function t0(t,e,n){return{name:rm(t,e),fields:n.value.mapValue.fields}}function lA(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:Ce()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,h){return d.useProto3Json?(Ye(h===void 0||typeof h=="string"),Qt.fromBase64String(h||"")):(Ye(h===void 0||h instanceof Buffer||h instanceof Uint8Array),Qt.fromUint8Array(h||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&function(d){const h=d.code===void 0?z.UNKNOWN:yb(d.code);return new ae(h,d.message||"")}(a);n=new xb(r,s,i,c||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Vd(t,r.document.name),i=Nr(r.document.updateTime),a=r.document.createTime?Nr(r.document.createTime):Ie.min(),c=new Nn({mapValue:{fields:r.document.fields}}),u=cn.newFoundDocument(s,i,a,c),d=r.targetIds||[],h=r.removedTargetIds||[];n=new wc(d,h,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Vd(t,r.document),i=r.readTime?Nr(r.readTime):Ie.min(),a=cn.newNoDocument(s,i),c=r.removedTargetIds||[];n=new wc([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Vd(t,r.document),i=r.removedTargetIds||[];n=new wc([],i,s,null)}else{if(!("filter"in e))return Ce();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new JI(s,i),c=r.targetId;n=new vb(c,a)}}return n}function cA(t,e){let n;if(e instanceof ml)n={update:t0(t,e.key,e.value)};else if(e instanceof Pf)n={delete:rm(t,e.key)};else if(e instanceof Js)n={update:t0(t,e.key,e.data),updateMask:vA(e.fieldMask)};else{if(!(e instanceof KI))return Ce();n={verify:rm(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,a){const c=a.transform;if(c instanceof Qo)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Yo)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Jo)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof lu)return{fieldPath:a.field.canonicalString(),increment:c.Pe};throw Ce()}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:aA(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ce()}(t,e.precondition)),n}function uA(t,e){return t&&t.length>0?(Ye(e!==void 0),t.map(n=>function(s,i){let a=s.updateTime?Nr(s.updateTime):Nr(i);return a.isEqual(Ie.min())&&(a=Nr(i)),new HI(a,s.transformResults||[])}(n,e))):[]}function dA(t,e){return{documents:[_b(t,e.path)]}}function hA(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=_b(t,s);const i=function(d){if(d.length!==0)return Cb(mr.create(d,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const a=function(d){if(d.length!==0)return d.map(h=>function(g){return{field:Oi(g.field),direction:pA(g.dir)}}(h))}(e.orderBy);a&&(n.structuredQuery.orderBy=a);const c=tm(t,e.limit);return c!==null&&(n.structuredQuery.limit=c),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:n,parent:s}}function mA(t){let e=oA(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Ye(r===1);const h=n.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];n.where&&(i=function(f){const g=Tb(f);return g instanceof mr&&eb(g)?g.getFilters():[g]}(n.where));let a=[];n.orderBy&&(a=function(f){return f.map(g=>function(S){return new au(Vi(S.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(S.direction))}(g))}(n.orderBy));let c=null;n.limit&&(c=function(f){let g;return g=typeof f=="object"?f.value:f,Mu(g)?null:g}(n.limit));let u=null;n.startAt&&(u=function(f){const g=!!f.before,x=f.values||[];return new iu(x,g)}(n.startAt));let d=null;return n.endAt&&(d=function(f){const g=!f.before,x=f.values||[];return new iu(x,g)}(n.endAt)),PI(e,s,a,i,c,"F",u,d)}function fA(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ce()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function Tb(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Vi(n.unaryFilter.field);return kt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Vi(n.unaryFilter.field);return kt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Vi(n.unaryFilter.field);return kt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Vi(n.unaryFilter.field);return kt.create(a,"!=",{nullValue:"NULL_VALUE"});default:return Ce()}}(t):t.fieldFilter!==void 0?function(n){return kt.create(Vi(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ce()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return mr.create(n.compositeFilter.filters.map(r=>Tb(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Ce()}}(n.compositeFilter.op))}(t):Ce()}function pA(t){return nA[t]}function gA(t){return rA[t]}function yA(t){return sA[t]}function Oi(t){return{fieldPath:t.canonicalString()}}function Vi(t){return Ht.fromServerFormat(t.fieldPath)}function Cb(t){return t instanceof kt?function(n){if(n.op==="=="){if(Uy(n.value))return{unaryFilter:{field:Oi(n.field),op:"IS_NAN"}};if($y(n.value))return{unaryFilter:{field:Oi(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Uy(n.value))return{unaryFilter:{field:Oi(n.field),op:"IS_NOT_NAN"}};if($y(n.value))return{unaryFilter:{field:Oi(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Oi(n.field),op:gA(n.op),value:n.value}}}(t):t instanceof mr?function(n){const r=n.getFilters().map(s=>Cb(s));return r.length===1?r[0]:{compositeFilter:{op:yA(n.op),filters:r}}}(t):Ce()}function vA(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function Sb(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss{constructor(e,n,r,s,i=Ie.min(),a=Ie.min(),c=Qt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new Ss(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Ss(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ss(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ss(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xA{constructor(e){this.ct=e}}function wA(t){const e=mA({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?ou(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bA{constructor(){this.un=new _A}addToCollectionParentIndex(e,n){return this.un.add(n),Q.resolve()}getCollectionParents(e,n){return Q.resolve(this.un.getEntries(n))}addFieldIndex(e,n){return Q.resolve()}deleteFieldIndex(e,n){return Q.resolve()}deleteAllFieldIndexes(e){return Q.resolve()}createTargetIndexes(e,n){return Q.resolve()}getDocumentsMatchingTarget(e,n){return Q.resolve(null)}getIndexType(e,n){return Q.resolve(0)}getFieldIndexes(e,n){return Q.resolve([])}getNextCollectionGroupToUpdate(e){return Q.resolve(null)}getMinOffset(e,n){return Q.resolve(Bs.min())}getMinOffsetFromCollectionGroup(e,n){return Q.resolve(Bs.min())}updateCollectionGroup(e,n,r){return Q.resolve()}updateIndexEntries(e,n){return Q.resolve()}}class _A{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new Gt(it.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Gt(it.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wa{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new wa(0)}static kn(){return new wa(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EA{constructor(){this.changes=new Pa(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,cn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?Q.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TA{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CA{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&_o(r.mutation,s,Fn.empty(),jt.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Ve()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Ve()){const s=ui();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let a=io();return i.forEach((c,u)=>{a=a.insert(c,u.overlayedDocument)}),a}))}getOverlayedDocuments(e,n){const r=ui();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Ve()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,c)=>{n.set(a,c)})})}computeViews(e,n,r,s){let i=Jr();const a=bo(),c=function(){return bo()}();return n.forEach((u,d)=>{const h=r.get(d.key);s.has(d.key)&&(h===void 0||h.mutation instanceof Js)?i=i.insert(d.key,d):h!==void 0?(a.set(d.key,h.mutation.getFieldMask()),_o(h.mutation,d,h.mutation.getFieldMask(),jt.now())):a.set(d.key,Fn.empty())}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((d,h)=>a.set(d,h)),n.forEach((d,h)=>{var f;return c.set(d,new TA(h,(f=a.get(d))!==null&&f!==void 0?f:null))}),c))}recalculateAndSaveOverlays(e,n){const r=bo();let s=new gt((a,c)=>a-c),i=Ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(a=>{for(const c of a)c.keys().forEach(u=>{const d=n.get(u);if(d===null)return;let h=r.get(u)||Fn.empty();h=c.applyToLocalView(d,h),r.set(u,h);const f=(s.get(c.batchId)||Ve()).add(u);s=s.insert(c.batchId,f)})}).next(()=>{const a=[],c=s.getReverseIterator();for(;c.hasNext();){const u=c.getNext(),d=u.key,h=u.value,f=cb();h.forEach(g=>{if(!i.has(g)){const x=pb(n.get(g),r.get(g));x!==null&&f.set(g,x),i=i.add(g)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,f))}return Q.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(a){return we.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):sb(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):Q.resolve(ui());let c=-1,u=i;return a.next(d=>Q.forEach(d,(h,f)=>(c<f.largestBatchId&&(c=f.largestBatchId),i.get(h)?Q.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{u=u.insert(h,g)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,u,d,Ve())).next(h=>({batchId:c,changes:lb(h)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new we(n)).next(r=>{let s=io();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let a=io();return this.indexManager.getCollectionParents(e,i).next(c=>Q.forEach(c,u=>{const d=function(f,g){return new hl(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(n,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(h=>{h.forEach((f,g)=>{a=a.insert(f,g)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(a=>{i.forEach((u,d)=>{const h=d.getKey();a.get(h)===null&&(a=a.insert(h,cn.newInvalidDocument(h)))});let c=io();return a.forEach((u,d)=>{const h=i.get(u);h!==void 0&&_o(h.mutation,d,Fn.empty(),jt.now()),Vu(n,d)&&(c=c.insert(u,d))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SA{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,n){return Q.resolve(this.hr.get(n))}saveBundleMetadata(e,n){return this.hr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:Nr(s.createTime)}}(n)),Q.resolve()}getNamedQuery(e,n){return Q.resolve(this.Pr.get(n))}saveNamedQuery(e,n){return this.Pr.set(n.name,function(s){return{name:s.name,query:wA(s.bundledQuery),readTime:Nr(s.readTime)}}(n)),Q.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NA{constructor(){this.overlays=new gt(we.comparator),this.Ir=new Map}getOverlay(e,n){return Q.resolve(this.overlays.get(n))}getOverlays(e,n){const r=ui();return Q.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.ht(e,n,i)}),Q.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),Q.resolve()}getOverlaysForCollection(e,n,r){const s=ui(),i=n.length+1,a=new we(n.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const u=c.getNext().value,d=u.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return Q.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new gt((d,h)=>d-h);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let h=i.get(d.largestBatchId);h===null&&(h=ui(),i=i.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const c=ui(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((d,h)=>c.set(d,h)),!(c.size()>=s)););return Q.resolve(c)}ht(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new YI(n,r));let i=this.Ir.get(n);i===void 0&&(i=Ve(),this.Ir.set(n,i)),this.Ir.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kA{constructor(){this.sessionToken=Qt.EMPTY_BYTE_STRING}getSessionToken(e){return Q.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,Q.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf{constructor(){this.Tr=new Gt(Lt.Er),this.dr=new Gt(Lt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,n){const r=new Lt(e,n);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Vr(new Lt(e,n))}mr(e,n){e.forEach(r=>this.removeReference(r,n))}gr(e){const n=new we(new it([])),r=new Lt(n,e),s=new Lt(n,e+1),i=[];return this.dr.forEachInRange([r,s],a=>{this.Vr(a),i.push(a.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const n=new we(new it([])),r=new Lt(n,e),s=new Lt(n,e+1);let i=Ve();return this.dr.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){const n=new Lt(e,0),r=this.Tr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Lt{constructor(e,n){this.key=e,this.wr=n}static Er(e,n){return we.comparator(e.key,n.key)||qe(e.wr,n.wr)}static Ar(e,n){return qe(e.wr,n.wr)||we.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IA{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new Gt(Lt.Er)}checkEmpty(e){return Q.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new QI(i,n,r,s);this.mutationQueue.push(a);for(const c of s)this.br=this.br.add(new Lt(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return Q.resolve(a)}lookupMutationBatch(e,n){return Q.resolve(this.Dr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.vr(r),i=s<0?0:s;return Q.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Q.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return Q.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Lt(n,0),s=new Lt(n,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],a=>{const c=this.Dr(a.wr);i.push(c)}),Q.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Gt(qe);return n.forEach(s=>{const i=new Lt(s,0),a=new Lt(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,a],c=>{r=r.add(c.wr)})}),Q.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;we.isDocumentKey(i)||(i=i.child(""));const a=new Lt(new we(i),0);let c=new Gt(qe);return this.br.forEachWhile(u=>{const d=u.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(c=c.add(u.wr)),!0)},a),Q.resolve(this.Cr(c))}Cr(e){const n=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){Ye(this.Fr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return Q.forEach(n.mutations,s=>{const i=new Lt(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,n){const r=new Lt(n,0),s=this.br.firstAfterOrEqual(r);return Q.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,Q.resolve()}Fr(e,n){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const n=this.vr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AA{constructor(e){this.Mr=e,this.docs=function(){return new gt(we.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,a=this.Mr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return Q.resolve(r?r.document.mutableCopy():cn.newInvalidDocument(n))}getEntries(e,n){let r=Jr();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():cn.newInvalidDocument(s))}),Q.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=Jr();const a=n.path,c=new we(a.child("")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){const{key:d,value:{document:h}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||hI(dI(h),r)<=0||(s.has(h.key)||Vu(n,h))&&(i=i.insert(h.key,h.mutableCopy()))}return Q.resolve(i)}getAllFromCollectionGroup(e,n,r,s){Ce()}Or(e,n){return Q.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new PA(this)}getSize(e){return Q.resolve(this.size)}}class PA extends EA{constructor(e){super(),this.cr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),Q.waitFor(n)}getFromCache(e,n){return this.cr.getEntry(e,n)}getAllFromCache(e,n){return this.cr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RA{constructor(e){this.persistence=e,this.Nr=new Pa(n=>kf(n),If),this.lastRemoteSnapshotVersion=Ie.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Mf,this.targetCount=0,this.kr=wa.Bn()}forEachTarget(e,n){return this.Nr.forEach((r,s)=>n(s)),Q.resolve()}getLastRemoteSnapshotVersion(e){return Q.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Q.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),Q.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Lr&&(this.Lr=n),Q.resolve()}Kn(e){this.Nr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.kr=new wa(n),this.highestTargetId=n),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,n){return this.Kn(n),this.targetCount+=1,Q.resolve()}updateTargetData(e,n){return this.Kn(n),Q.resolve()}removeTargetData(e,n){return this.Nr.delete(n.target),this.Br.gr(n.targetId),this.targetCount-=1,Q.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.Nr.forEach((a,c)=>{c.sequenceNumber<=n&&r.get(c.targetId)===null&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),s++)}),Q.waitFor(i).next(()=>s)}getTargetCount(e){return Q.resolve(this.targetCount)}getTargetData(e,n){const r=this.Nr.get(n)||null;return Q.resolve(r)}addMatchingKeys(e,n,r){return this.Br.Rr(n,r),Q.resolve()}removeMatchingKeys(e,n,r){this.Br.mr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),Q.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.Br.gr(n),Q.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Br.yr(n);return Q.resolve(r)}containsKey(e,n){return Q.resolve(this.Br.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jA{constructor(e,n){this.qr={},this.overlays={},this.Qr=new Tf(0),this.Kr=!1,this.Kr=!0,this.$r=new kA,this.referenceDelegate=e(this),this.Ur=new RA(this),this.indexManager=new bA,this.remoteDocumentCache=function(s){return new AA(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new xA(n),this.Gr=new SA(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new NA,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.qr[e.toKey()];return r||(r=new IA(n,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,n,r){he("MemoryPersistence","Starting transaction:",e);const s=new DA(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,n){return Q.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,n)))}}class DA extends fI{constructor(e){super(),this.currentSequenceNumber=e}}class Lf{constructor(e){this.persistence=e,this.Jr=new Mf,this.Yr=null}static Zr(e){return new Lf(e)}get Xr(){if(this.Yr)return this.Yr;throw Ce()}addReference(e,n,r){return this.Jr.addReference(r,n),this.Xr.delete(r.toString()),Q.resolve()}removeReference(e,n,r){return this.Jr.removeReference(r,n),this.Xr.add(r.toString()),Q.resolve()}markPotentiallyOrphaned(e,n){return this.Xr.add(n.toString()),Q.resolve()}removeTarget(e,n){this.Jr.gr(n.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}zr(){this.Yr=new Set}jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Q.forEach(this.Xr,r=>{const s=we.fromPath(r);return this.ei(e,s).next(i=>{i||n.removeEntry(s,Ie.min())})}).next(()=>(this.Yr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ei(e,n).next(r=>{r?this.Xr.delete(n.toString()):this.Xr.add(n.toString())})}Wr(e){return 0}ei(e,n){return Q.or([()=>Q.resolve(this.Jr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Hr(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.$i=r,this.Ui=s}static Wi(e,n){let r=Ve(),s=Ve();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Of(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MA{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LA{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return b1()?8:pI(dn())>0?6:4}()}initialize(e,n){this.Ji=e,this.indexManager=n,this.Gi=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.Yi(e,n).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.Zi(e,n,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new MA;return this.Xi(e,n,a).next(c=>{if(i.result=c,this.zi)return this.es(e,n,a,c.size)})}).next(()=>i.result)}es(e,n,r,s){return r.documentReadCount<this.ji?(Ja()<=Ue.DEBUG&&he("QueryEngine","SDK will not create cache indexes for query:",Li(n),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Q.resolve()):(Ja()<=Ue.DEBUG&&he("QueryEngine","Query:",Li(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Ja()<=Ue.DEBUG&&he("QueryEngine","The SDK decides to create cache indexes for query:",Li(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Sr(n))):Q.resolve())}Yi(e,n){if(Hy(n))return Q.resolve(null);let r=Sr(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=ou(n,null,"F"),r=Sr(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const a=Ve(...i);return this.Ji.getDocuments(e,a).next(c=>this.indexManager.getMinOffset(e,r).next(u=>{const d=this.ts(n,c);return this.ns(n,d,a,u.readTime)?this.Yi(e,ou(n,null,"F")):this.rs(e,d,n,u)}))})))}Zi(e,n,r,s){return Hy(n)||s.isEqual(Ie.min())?Q.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const a=this.ts(n,i);return this.ns(n,a,r,s)?Q.resolve(null):(Ja()<=Ue.DEBUG&&he("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Li(n)),this.rs(e,a,n,uI(s,-1)).next(c=>c))})}ts(e,n){let r=new Gt(ab(e));return n.forEach((s,i)=>{Vu(e,i)&&(r=r.add(i))}),r}ns(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,n,r){return Ja()<=Ue.DEBUG&&he("QueryEngine","Using full collection scan to execute query:",Li(n)),this.Ji.getDocumentsMatchingQuery(e,n,Bs.min(),r)}rs(e,n,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OA{constructor(e,n,r,s){this.persistence=e,this.ss=n,this.serializer=s,this.os=new gt(qe),this._s=new Pa(i=>kf(i),If),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new CA(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.os))}}function VA(t,e,n,r){return new OA(t,e,n,r)}async function Nb(t,e){const n=Ae(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.ls(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const a=[],c=[];let u=Ve();for(const d of s){a.push(d.batchId);for(const h of d.mutations)u=u.add(h.key)}for(const d of i){c.push(d.batchId);for(const h of d.mutations)u=u.add(h.key)}return n.localDocuments.getDocuments(r,u).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:c}))})})}function FA(t,e){const n=Ae(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(c,u,d,h){const f=d.batch,g=f.keys();let x=Q.resolve();return g.forEach(S=>{x=x.next(()=>h.getEntry(u,S)).next(y=>{const k=d.docVersions.get(S);Ye(k!==null),y.version.compareTo(k)<0&&(f.applyToRemoteDocument(y,d),y.isValidDocument()&&(y.setReadTime(d.commitVersion),h.addEntry(y)))})}),x.next(()=>c.mutationQueue.removeMutationBatch(u,f))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(c){let u=Ve();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(u=u.add(c.batch.mutations[d].key));return u}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function kb(t){const e=Ae(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ur.getLastRemoteSnapshotVersion(n))}function $A(t,e){const n=Ae(t),r=e.snapshotVersion;let s=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=n.cs.newChangeBuffer({trackRemovals:!0});s=n.os;const c=[];e.targetChanges.forEach((h,f)=>{const g=s.get(f);if(!g)return;c.push(n.Ur.removeMatchingKeys(i,h.removedDocuments,f).next(()=>n.Ur.addMatchingKeys(i,h.addedDocuments,f)));let x=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?x=x.withResumeToken(Qt.EMPTY_BYTE_STRING,Ie.min()).withLastLimboFreeSnapshotVersion(Ie.min()):h.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(h.resumeToken,r)),s=s.insert(f,x),function(y,k,b){return y.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=3e8?!0:b.addedDocuments.size+b.modifiedDocuments.size+b.removedDocuments.size>0}(g,x,h)&&c.push(n.Ur.updateTargetData(i,x))});let u=Jr(),d=Ve();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&c.push(n.persistence.referenceDelegate.updateLimboDocument(i,h))}),c.push(UA(i,a,e.documentUpdates).next(h=>{u=h.Ps,d=h.Is})),!r.isEqual(Ie.min())){const h=n.Ur.getLastRemoteSnapshotVersion(i).next(f=>n.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));c.push(h)}return Q.waitFor(c).next(()=>a.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,u,d)).next(()=>u)}).then(i=>(n.os=s,i))}function UA(t,e,n){let r=Ve(),s=Ve();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let a=Jr();return n.forEach((c,u)=>{const d=i.get(c);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(c)),u.isNoDocument()&&u.version.isEqual(Ie.min())?(e.removeEntry(c,u.readTime),a=a.insert(c,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),a=a.insert(c,u)):he("LocalStore","Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",u.version)}),{Ps:a,Is:s}})}function BA(t,e){const n=Ae(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function zA(t,e){const n=Ae(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Ur.getTargetData(r,e).next(i=>i?(s=i,Q.resolve(s)):n.Ur.allocateTargetId(r).next(a=>(s=new Ss(e,a,"TargetPurposeListen",r.currentSequenceNumber),n.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.os=n.os.insert(r.targetId,r),n._s.set(e,r.targetId)),r})}async function im(t,e,n){const r=Ae(t),s=r.os.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!dl(a))throw a;he("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function n0(t,e,n){const r=Ae(t);let s=Ie.min(),i=Ve();return r.persistence.runTransaction("Execute query","readwrite",a=>function(u,d,h){const f=Ae(u),g=f._s.get(h);return g!==void 0?Q.resolve(f.os.get(g)):f.Ur.getTargetData(d,h)}(r,a,Sr(e)).next(c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,c.targetId).next(u=>{i=u})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,n?s:Ie.min(),n?i:Ve())).next(c=>(WA(r,jI(e),c),{documents:c,Ts:i})))}function WA(t,e,n){let r=t.us.get(e)||Ie.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.us.set(e,r)}class r0{constructor(){this.activeTargetIds=FI()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class HA{constructor(){this.so=new r0,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,n,r){this.oo[e]=n}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new r0,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qA{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){he("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){he("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zl=null;function Fd(){return Zl===null?Zl=function(){return 268435456+Math.round(2147483648*Math.random())}():Zl++,"0x"+Zl.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GA={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KA{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const an="WebChannelConnection";class QA extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+n.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(n,r,s,i,a){const c=Fd(),u=this.xo(n,r.toUriEncodedString());he("RestConnection",`Sending RPC '${n}' ${c}:`,u,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,i,a),this.No(n,u,d,s).then(h=>(he("RestConnection",`Received RPC '${n}' ${c}: `,h),h),h=>{throw ga("RestConnection",`RPC '${n}' ${c} failed with error: `,h,"url: ",u,"request:",s),h})}Lo(n,r,s,i,a,c){return this.Mo(n,r,s,i,a)}Oo(n,r,s){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Aa}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,a)=>n[a]=i),s&&s.headers.forEach((i,a)=>n[a]=i)}xo(n,r){const s=GA[n];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,n,r,s){const i=Fd();return new Promise((a,c)=>{const u=new Bw;u.setWithCredentials(!0),u.listenOnce(zw.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case yc.NO_ERROR:const h=u.getResponseJson();he(an,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),a(h);break;case yc.TIMEOUT:he(an,`RPC '${e}' ${i} timed out`),c(new ae(z.DEADLINE_EXCEEDED,"Request time out"));break;case yc.HTTP_ERROR:const f=u.getStatus();if(he(an,`RPC '${e}' ${i} failed with status:`,f,"response text:",u.getResponseText()),f>0){let g=u.getResponseJson();Array.isArray(g)&&(g=g[0]);const x=g==null?void 0:g.error;if(x&&x.status&&x.message){const S=function(k){const b=k.toLowerCase().replace(/_/g,"-");return Object.values(z).indexOf(b)>=0?b:z.UNKNOWN}(x.status);c(new ae(S,x.message))}else c(new ae(z.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new ae(z.UNAVAILABLE,"Connection failed."));break;default:Ce()}}finally{he(an,`RPC '${e}' ${i} completed.`)}});const d=JSON.stringify(s);he(an,`RPC '${e}' ${i} sending request:`,s),u.send(n,"POST",d,r,15)})}Bo(e,n,r){const s=Fd(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=qw(),c=Hw(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,n,r),u.encodeInitMessageHeaders=!0;const h=i.join("");he(an,`Creating RPC '${e}' stream ${s}: ${h}`,u);const f=a.createWebChannel(h,u);let g=!1,x=!1;const S=new KA({Io:k=>{x?he(an,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(g||(he(an,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),he(an,`RPC '${e}' stream ${s} sending:`,k),f.send(k))},To:()=>f.close()}),y=(k,b,w)=>{k.listen(b,I=>{try{w(I)}catch(j){setTimeout(()=>{throw j},0)}})};return y(f,so.EventType.OPEN,()=>{x||(he(an,`RPC '${e}' stream ${s} transport opened.`),S.yo())}),y(f,so.EventType.CLOSE,()=>{x||(x=!0,he(an,`RPC '${e}' stream ${s} transport closed`),S.So())}),y(f,so.EventType.ERROR,k=>{x||(x=!0,ga(an,`RPC '${e}' stream ${s} transport errored:`,k),S.So(new ae(z.UNAVAILABLE,"The operation could not be completed")))}),y(f,so.EventType.MESSAGE,k=>{var b;if(!x){const w=k.data[0];Ye(!!w);const I=w,j=I.error||((b=I[0])===null||b===void 0?void 0:b.error);if(j){he(an,`RPC '${e}' stream ${s} received error:`,j);const $=j.status;let H=function(C){const A=St[C];if(A!==void 0)return yb(A)}($),E=j.message;H===void 0&&(H=z.INTERNAL,E="Unknown error status: "+$+" with message "+j.message),x=!0,S.So(new ae(H,E)),f.close()}else he(an,`RPC '${e}' stream ${s} received:`,w),S.bo(w)}}),y(c,Ww.STAT_EVENT,k=>{k.stat===Qh.PROXY?he(an,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===Qh.NOPROXY&&he(an,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{S.wo()},0),S}}function $d(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bu(t){return new iA(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ib{constructor(e,n,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=n,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,n-r);s>0&&he("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ab{constructor(e,n,r,s,i,a,c,u){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Ib(e,n)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,n){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():n&&n.code===z.RESOURCE_EXHAUSTED?(Yr(n.toString()),Yr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===z.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(n)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===n&&this.P_(r,s)},r=>{e(()=>{const s=new ae(z.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,n){const r=this.h_(this.Yo);this.stream=this.T_(e,n),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return he("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return n=>{this.ui.enqueueAndForget(()=>this.Yo===e?n():(he("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class YA extends Ab{constructor(e,n,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}T_(e,n){return this.connection.Bo("Listen",e,n)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const n=lA(this.serializer,e),r=function(i){if(!("targetChange"in i))return Ie.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?Ie.min():a.readTime?Nr(a.readTime):Ie.min()}(e);return this.listener.d_(n,r)}A_(e){const n={};n.database=sm(this.serializer),n.addTarget=function(i,a){let c;const u=a.target;if(c=Zh(u)?{documents:dA(i,u)}:{query:hA(i,u)._t},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=wb(i,a.resumeToken);const d=tm(i,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo(Ie.min())>0){c.readTime=cu(i,a.snapshotVersion.toTimestamp());const d=tm(i,a.expectedCount);d!==null&&(c.expectedCount=d)}return c}(this.serializer,e);const r=fA(this.serializer,e);r&&(n.labels=r),this.a_(n)}R_(e){const n={};n.database=sm(this.serializer),n.removeTarget=e,this.a_(n)}}class JA extends Ab{constructor(e,n,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,n){return this.connection.Bo("Write",e,n)}E_(e){return Ye(!!e.streamToken),this.lastStreamToken=e.streamToken,Ye(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Ye(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const n=uA(e.writeResults,e.commitTime),r=Nr(e.commitTime);return this.listener.g_(r,n)}p_(){const e={};e.database=sm(this.serializer),this.a_(e)}m_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>cA(this.serializer,r))};this.a_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XA extends class{}{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new ae(z.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,n,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Mo(e,nm(n,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ae(z.UNKNOWN,i.toString())})}Lo(e,n,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Lo(e,nm(n,r),s,a,c,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new ae(z.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class ZA{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Yr(n),this.D_=!1):he("OnlineStateTracker",n)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eP{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(a=>{r.enqueueAndForget(async()=>{Ii(this)&&(he("RemoteStore","Restarting streams for network reachability change."),await async function(u){const d=Ae(u);d.L_.add(4),await pl(d),d.q_.set("Unknown"),d.L_.delete(4),await zu(d)}(this))})}),this.q_=new ZA(r,s)}}async function zu(t){if(Ii(t))for(const e of t.B_)await e(!0)}async function pl(t){for(const e of t.B_)await e(!1)}function Pb(t,e){const n=Ae(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),Uf(n)?$f(n):Ra(n).r_()&&Ff(n,e))}function Vf(t,e){const n=Ae(t),r=Ra(n);n.N_.delete(e),r.r_()&&Rb(n,e),n.N_.size===0&&(r.r_()?r.o_():Ii(n)&&n.q_.set("Unknown"))}function Ff(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ie.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ra(t).A_(e)}function Rb(t,e){t.Q_.xe(e),Ra(t).R_(e)}function $f(t){t.Q_=new tA({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),Ra(t).start(),t.q_.v_()}function Uf(t){return Ii(t)&&!Ra(t).n_()&&t.N_.size>0}function Ii(t){return Ae(t).L_.size===0}function jb(t){t.Q_=void 0}async function tP(t){t.q_.set("Online")}async function nP(t){t.N_.forEach((e,n)=>{Ff(t,e)})}async function rP(t,e){jb(t),Uf(t)?(t.q_.M_(e),$f(t)):t.q_.set("Unknown")}async function sP(t,e,n){if(t.q_.set("Online"),e instanceof xb&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const c of i.targetIds)s.N_.has(c)&&(await s.remoteSyncer.rejectListen(c,a),s.N_.delete(c),s.Q_.removeTarget(c))}(t,e)}catch(r){he("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await uu(t,r)}else if(e instanceof wc?t.Q_.Ke(e):e instanceof vb?t.Q_.He(e):t.Q_.We(e),!n.isEqual(Ie.min()))try{const r=await kb(t.localStore);n.compareTo(r)>=0&&await function(i,a){const c=i.Q_.rt(a);return c.targetChanges.forEach((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const h=i.N_.get(d);h&&i.N_.set(d,h.withResumeToken(u.resumeToken,a))}}),c.targetMismatches.forEach((u,d)=>{const h=i.N_.get(u);if(!h)return;i.N_.set(u,h.withResumeToken(Qt.EMPTY_BYTE_STRING,h.snapshotVersion)),Rb(i,u);const f=new Ss(h.target,u,d,h.sequenceNumber);Ff(i,f)}),i.remoteSyncer.applyRemoteEvent(c)}(t,n)}catch(r){he("RemoteStore","Failed to raise snapshot:",r),await uu(t,r)}}async function uu(t,e,n){if(!dl(e))throw e;t.L_.add(1),await pl(t),t.q_.set("Offline"),n||(n=()=>kb(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{he("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await zu(t)})}function Db(t,e){return e().catch(n=>uu(t,n,e))}async function Wu(t){const e=Ae(t),n=Ws(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;iP(e);)try{const s=await BA(e.localStore,r);if(s===null){e.O_.length===0&&n.o_();break}r=s.batchId,aP(e,s)}catch(s){await uu(e,s)}Mb(e)&&Lb(e)}function iP(t){return Ii(t)&&t.O_.length<10}function aP(t,e){t.O_.push(e);const n=Ws(t);n.r_()&&n.V_&&n.m_(e.mutations)}function Mb(t){return Ii(t)&&!Ws(t).n_()&&t.O_.length>0}function Lb(t){Ws(t).start()}async function oP(t){Ws(t).p_()}async function lP(t){const e=Ws(t);for(const n of t.O_)e.m_(n.mutations)}async function cP(t,e,n){const r=t.O_.shift(),s=Rf.from(r,e,n);await Db(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await Wu(t)}async function uP(t,e){e&&Ws(t).V_&&await async function(r,s){if(function(a){return XI(a)&&a!==z.ABORTED}(s.code)){const i=r.O_.shift();Ws(r).s_(),await Db(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Wu(r)}}(t,e),Mb(t)&&Lb(t)}async function i0(t,e){const n=Ae(t);n.asyncQueue.verifyOperationInProgress(),he("RemoteStore","RemoteStore received new credentials");const r=Ii(n);n.L_.add(3),await pl(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await zu(n)}async function dP(t,e){const n=Ae(t);e?(n.L_.delete(2),await zu(n)):e||(n.L_.add(2),await pl(n),n.q_.set("Unknown"))}function Ra(t){return t.K_||(t.K_=function(n,r,s){const i=Ae(n);return i.w_(),new YA(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:tP.bind(null,t),Ro:nP.bind(null,t),mo:rP.bind(null,t),d_:sP.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),Uf(t)?$f(t):t.q_.set("Unknown")):(await t.K_.stop(),jb(t))})),t.K_}function Ws(t){return t.U_||(t.U_=function(n,r,s){const i=Ae(n);return i.w_(),new JA(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:oP.bind(null,t),mo:uP.bind(null,t),f_:lP.bind(null,t),g_:cP.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await Wu(t)):(await t.U_.stop(),t.O_.length>0&&(he("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new zr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const a=Date.now()+r,c=new Bf(e,n,a,s,i);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ae(z.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zf(t,e){if(Yr("AsyncQueue",`${e}: ${t}`),dl(t))return new ae(z.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(e){this.comparator=e?(n,r)=>e(n,r)||we.comparator(n.key,r.key):(n,r)=>we.comparator(n.key,r.key),this.keyedMap=io(),this.sortedSet=new gt(this.comparator)}static emptySet(e){return new oa(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof oa)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new oa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a0{constructor(){this.W_=new gt(we.comparator)}track(e){const n=e.doc.key,r=this.W_.get(n);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(n,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(n):e.type===1&&r.type===2?this.W_=this.W_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):Ce():this.W_=this.W_.insert(n,e)}G_(){const e=[];return this.W_.inorderTraversal((n,r)=>{e.push(r)}),e}}class ba{constructor(e,n,r,s,i,a,c,u,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,i){const a=[];return n.forEach(c=>{a.push({type:0,doc:c})}),new ba(e,n,oa.emptySet(n),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ou(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hP{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class mP{constructor(){this.queries=o0(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(n,r){const s=Ae(n),i=s.queries;s.queries=o0(),i.forEach((a,c)=>{for(const u of c.j_)u.onError(r)})})(this,new ae(z.ABORTED,"Firestore shutting down"))}}function o0(){return new Pa(t=>ib(t),Ou)}async function Wf(t,e){const n=Ae(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new hP,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await n.onListen(s,!0);break;case 1:i.z_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(a){const c=zf(a,`Initialization of query '${Li(e.query)}' failed`);return void e.onError(c)}n.queries.set(s,i),i.j_.push(e),e.Z_(n.onlineState),i.z_&&e.X_(i.z_)&&qf(n)}async function Hf(t,e){const n=Ae(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const a=i.j_.indexOf(e);a>=0&&(i.j_.splice(a,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function fP(t,e){const n=Ae(t);let r=!1;for(const s of e){const i=s.query,a=n.queries.get(i);if(a){for(const c of a.j_)c.X_(s)&&(r=!0);a.z_=s}}r&&qf(n)}function pP(t,e,n){const r=Ae(t),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(n);r.queries.delete(e)}function qf(t){t.Y_.forEach(e=>{e.next()})}var am,l0;(l0=am||(am={})).ea="default",l0.Cache="cache";class Gf{constructor(e,n,r){this.query=e,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new ba(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.na?this.ia(e)&&(this.ta.next(e),n=!0):this.sa(e,this.onlineState)&&(this.oa(e),n=!0),this.ra=e,n}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let n=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),n=!0),n}sa(e,n){if(!e.fromCache||!this.J_())return!0;const r=n!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const n=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}oa(e){e=ba.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==am.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ob{constructor(e){this.key=e}}class Vb{constructor(e){this.key=e}}class gP{constructor(e,n){this.query=e,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ve(),this.mutatedKeys=Ve(),this.Aa=ab(e),this.Ra=new oa(this.Aa)}get Va(){return this.Ta}ma(e,n){const r=n?n.fa:new a0,s=n?n.Ra:this.Ra;let i=n?n.mutatedKeys:this.mutatedKeys,a=s,c=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const g=s.get(h),x=Vu(this.query,f)?f:null,S=!!g&&this.mutatedKeys.has(g.key),y=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let k=!1;g&&x?g.data.isEqual(x.data)?S!==y&&(r.track({type:3,doc:x}),k=!0):this.ga(g,x)||(r.track({type:2,doc:x}),k=!0,(u&&this.Aa(x,u)>0||d&&this.Aa(x,d)<0)&&(c=!0)):!g&&x?(r.track({type:0,doc:x}),k=!0):g&&!x&&(r.track({type:1,doc:g}),k=!0,(u||d)&&(c=!0)),k&&(x?(a=a.add(x),i=y?i.add(h):i.delete(h)):(a=a.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:a,fa:r,ns:c,mutatedKeys:i}}ga(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((h,f)=>function(x,S){const y=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ce()}};return y(x)-y(S)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),s=s!=null&&s;const c=n&&!s?this.ya():[],u=this.da.size===0&&this.current&&!s?1:0,d=u!==this.Ea;return this.Ea=u,a.length!==0||d?{snapshot:new ba(this.query,e.Ra,i,a,e.mutatedKeys,u===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new a0,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(n=>this.Ta=this.Ta.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ta=this.Ta.delete(n)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Ve(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const n=[];return e.forEach(r=>{this.da.has(r)||n.push(new Vb(r))}),this.da.forEach(r=>{e.has(r)||n.push(new Ob(r))}),n}ba(e){this.Ta=e.Ts,this.da=Ve();const n=this.ma(e.documents);return this.applyChanges(n,!0)}Da(){return ba.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class yP{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class vP{constructor(e){this.key=e,this.va=!1}}class xP{constructor(e,n,r,s,i,a){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new Pa(c=>ib(c),Ou),this.Ma=new Map,this.xa=new Set,this.Oa=new gt(we.comparator),this.Na=new Map,this.La=new Mf,this.Ba={},this.ka=new Map,this.qa=wa.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function wP(t,e,n=!0){const r=Wb(t);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await Fb(r,e,n,!0),s}async function bP(t,e){const n=Wb(t);await Fb(n,e,!0,!1)}async function Fb(t,e,n,r){const s=await zA(t.localStore,Sr(e)),i=s.targetId,a=t.sharedClientState.addLocalQueryTarget(i,n);let c;return r&&(c=await _P(t,e,i,a==="current",s.resumeToken)),t.isPrimaryClient&&n&&Pb(t.remoteStore,s),c}async function _P(t,e,n,r,s){t.Ka=(f,g,x)=>async function(y,k,b,w){let I=k.view.ma(b);I.ns&&(I=await n0(y.localStore,k.query,!1).then(({documents:E})=>k.view.ma(E,I)));const j=w&&w.targetChanges.get(k.targetId),$=w&&w.targetMismatches.get(k.targetId)!=null,H=k.view.applyChanges(I,y.isPrimaryClient,j,$);return u0(y,k.targetId,H.wa),H.snapshot}(t,f,g,x);const i=await n0(t.localStore,e,!0),a=new gP(e,i.Ts),c=a.ma(i.documents),u=fl.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=a.applyChanges(c,t.isPrimaryClient,u);u0(t,n,d.wa);const h=new yP(e,n,a);return t.Fa.set(e,h),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),d.snapshot}async function EP(t,e,n){const r=Ae(t),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(a=>!Ou(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await im(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&Vf(r.remoteStore,s.targetId),om(r,s.targetId)}).catch(ul)):(om(r,s.targetId),await im(r.localStore,s.targetId,!0))}async function TP(t,e){const n=Ae(t),r=n.Fa.get(e),s=n.Ma.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Vf(n.remoteStore,r.targetId))}async function CP(t,e,n){const r=RP(t);try{const s=await function(a,c){const u=Ae(a),d=jt.now(),h=c.reduce((x,S)=>x.add(S.key),Ve());let f,g;return u.persistence.runTransaction("Locally write mutations","readwrite",x=>{let S=Jr(),y=Ve();return u.cs.getEntries(x,h).next(k=>{S=k,S.forEach((b,w)=>{w.isValidDocument()||(y=y.add(b))})}).next(()=>u.localDocuments.getOverlayedDocuments(x,S)).next(k=>{f=k;const b=[];for(const w of c){const I=GI(w,f.get(w.key).overlayedDocument);I!=null&&b.push(new Js(w.key,I,Jw(I.value.mapValue),ur.exists(!0)))}return u.mutationQueue.addMutationBatch(x,d,b,c)}).next(k=>{g=k;const b=k.applyToLocalDocumentSet(f,y);return u.documentOverlayCache.saveOverlays(x,k.batchId,b)})}).then(()=>({batchId:g.batchId,changes:lb(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,c,u){let d=a.Ba[a.currentUser.toKey()];d||(d=new gt(qe)),d=d.insert(c,u),a.Ba[a.currentUser.toKey()]=d}(r,s.batchId,n),await gl(r,s.changes),await Wu(r.remoteStore)}catch(s){const i=zf(s,"Failed to persist write");n.reject(i)}}async function $b(t,e){const n=Ae(t);try{const r=await $A(n.localStore,e);e.targetChanges.forEach((s,i)=>{const a=n.Na.get(i);a&&(Ye(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.va=!0:s.modifiedDocuments.size>0?Ye(a.va):s.removedDocuments.size>0&&(Ye(a.va),a.va=!1))}),await gl(n,r,e)}catch(r){await ul(r)}}function c0(t,e,n){const r=Ae(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Fa.forEach((i,a)=>{const c=a.view.Z_(e);c.snapshot&&s.push(c.snapshot)}),function(a,c){const u=Ae(a);u.onlineState=c;let d=!1;u.queries.forEach((h,f)=>{for(const g of f.j_)g.Z_(c)&&(d=!0)}),d&&qf(u)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function SP(t,e,n){const r=Ae(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Na.get(e),i=s&&s.key;if(i){let a=new gt(we.comparator);a=a.insert(i,cn.newNoDocument(i,Ie.min()));const c=Ve().add(i),u=new Uu(Ie.min(),new Map,new gt(qe),a,c);await $b(r,u),r.Oa=r.Oa.remove(i),r.Na.delete(e),Kf(r)}else await im(r.localStore,e,!1).then(()=>om(r,e,n)).catch(ul)}async function NP(t,e){const n=Ae(t),r=e.batch.batchId;try{const s=await FA(n.localStore,e);Bb(n,r,null),Ub(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await gl(n,s)}catch(s){await ul(s)}}async function kP(t,e,n){const r=Ae(t);try{const s=await function(a,c){const u=Ae(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let h;return u.mutationQueue.lookupMutationBatch(d,c).next(f=>(Ye(f!==null),h=f.keys(),u.mutationQueue.removeMutationBatch(d,f))).next(()=>u.mutationQueue.performConsistencyCheck(d)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(d,h,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h)).next(()=>u.localDocuments.getDocuments(d,h))})}(r.localStore,e);Bb(r,e,n),Ub(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await gl(r,s)}catch(s){await ul(s)}}function Ub(t,e){(t.ka.get(e)||[]).forEach(n=>{n.resolve()}),t.ka.delete(e)}function Bb(t,e,n){const r=Ae(t);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function om(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||zb(t,r)})}function zb(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);n!==null&&(Vf(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),Kf(t))}function u0(t,e,n){for(const r of n)r instanceof Ob?(t.La.addReference(r.key,e),IP(t,r)):r instanceof Vb?(he("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||zb(t,r.key)):Ce()}function IP(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(he("SyncEngine","New document in limbo: "+n),t.xa.add(r),Kf(t))}function Kf(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new we(it.fromString(e)),r=t.qa.next();t.Na.set(r,new vP(n)),t.Oa=t.Oa.insert(n,r),Pb(t.remoteStore,new Ss(Sr(Lu(n.path)),r,"TargetPurposeLimboResolution",Tf.oe))}}async function gl(t,e,n){const r=Ae(t),s=[],i=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((c,u)=>{a.push(r.Ka(u,e,n).then(d=>{var h;if((d||n)&&r.isPrimaryClient){const f=d?!d.fromCache:(h=n==null?void 0:n.targetChanges.get(u.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(d){s.push(d);const f=Of.Wi(u.targetId,d);i.push(f)}}))}),await Promise.all(a),r.Ca.d_(s),await async function(u,d){const h=Ae(u);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>Q.forEach(d,g=>Q.forEach(g.$i,x=>h.persistence.referenceDelegate.addReference(f,g.targetId,x)).next(()=>Q.forEach(g.Ui,x=>h.persistence.referenceDelegate.removeReference(f,g.targetId,x)))))}catch(f){if(!dl(f))throw f;he("LocalStore","Failed to update sequence numbers: "+f)}for(const f of d){const g=f.targetId;if(!f.fromCache){const x=h.os.get(g),S=x.snapshotVersion,y=x.withLastLimboFreeSnapshotVersion(S);h.os=h.os.insert(g,y)}}}(r.localStore,i))}async function AP(t,e){const n=Ae(t);if(!n.currentUser.isEqual(e)){he("SyncEngine","User change. New user:",e.toKey());const r=await Nb(n.localStore,e);n.currentUser=e,function(i,a){i.ka.forEach(c=>{c.forEach(u=>{u.reject(new ae(z.CANCELLED,a))})}),i.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await gl(n,r.hs)}}function PP(t,e){const n=Ae(t),r=n.Na.get(e);if(r&&r.va)return Ve().add(r.key);{let s=Ve();const i=n.Ma.get(e);if(!i)return s;for(const a of i){const c=n.Fa.get(a);s=s.unionWith(c.view.Va)}return s}}function Wb(t){const e=Ae(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=$b.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=PP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=SP.bind(null,e),e.Ca.d_=fP.bind(null,e.eventManager),e.Ca.$a=pP.bind(null,e.eventManager),e}function RP(t){const e=Ae(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=NP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=kP.bind(null,e),e}class du{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Bu(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,n){return null}Ha(e,n){return null}za(e){return VA(this.persistence,new LA,e.initialUser,this.serializer)}Ga(e){return new jA(Lf.Zr,this.serializer)}Wa(e){return new HA}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}du.provider={build:()=>new du};class lm{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>c0(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=AP.bind(null,this.syncEngine),await dP(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new mP}()}createDatastore(e){const n=Bu(e.databaseInfo.databaseId),r=function(i){return new QA(i)}(e.databaseInfo);return function(i,a,c,u){return new XA(i,a,c,u)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,a,c){return new eP(r,s,i,a,c)}(this.localStore,this.datastore,e.asyncQueue,n=>c0(this.syncEngine,n,0),function(){return s0.D()?new s0:new qA}())}createSyncEngine(e,n){return function(s,i,a,c,u,d,h){const f=new xP(s,i,a,c,u,d);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=Ae(s);he("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await pl(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}lm.provider={build:()=>new lm};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Yr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jP{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=on.UNAUTHENTICATED,this.clientId=Kw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{he("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(he("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new zr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=zf(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Ud(t,e){t.asyncQueue.verifyOperationInProgress(),he("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Nb(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function d0(t,e){t.asyncQueue.verifyOperationInProgress();const n=await DP(t);he("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>i0(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>i0(e.remoteStore,s)),t._onlineComponents=e}async function DP(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){he("FirestoreClient","Using user provided OfflineComponentProvider");try{await Ud(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===z.FAILED_PRECONDITION||s.code===z.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;ga("Error using user provided cache. Falling back to memory cache: "+n),await Ud(t,new du)}}else he("FirestoreClient","Using default OfflineComponentProvider"),await Ud(t,new du);return t._offlineComponents}async function Hb(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(he("FirestoreClient","Using user provided OnlineComponentProvider"),await d0(t,t._uninitializedComponentsProvider._online)):(he("FirestoreClient","Using default OnlineComponentProvider"),await d0(t,new lm))),t._onlineComponents}function MP(t){return Hb(t).then(e=>e.syncEngine)}async function hu(t){const e=await Hb(t),n=e.eventManager;return n.onListen=wP.bind(null,e.syncEngine),n.onUnlisten=EP.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=bP.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=TP.bind(null,e.syncEngine),n}function LP(t,e,n={}){const r=new zr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,c,u,d){const h=new Qf({next:g=>{h.Za(),a.enqueueAndForget(()=>Hf(i,f));const x=g.docs.has(c);!x&&g.fromCache?d.reject(new ae(z.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&g.fromCache&&u&&u.source==="server"?d.reject(new ae(z.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(g)},error:g=>d.reject(g)}),f=new Gf(Lu(c.path),h,{includeMetadataChanges:!0,_a:!0});return Wf(i,f)}(await hu(t),t.asyncQueue,e,n,r)),r.promise}function OP(t,e,n={}){const r=new zr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,c,u,d){const h=new Qf({next:g=>{h.Za(),a.enqueueAndForget(()=>Hf(i,f)),g.fromCache&&u.source==="server"?d.reject(new ae(z.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(g)},error:g=>d.reject(g)}),f=new Gf(c,h,{includeMetadataChanges:!0,_a:!0});return Wf(i,f)}(await hu(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qb(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h0=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gb(t,e,n){if(!n)throw new ae(z.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function VP(t,e,n,r){if(e===!0&&r===!0)throw new ae(z.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function m0(t){if(!we.isDocumentKey(t))throw new ae(z.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function f0(t){if(we.isDocumentKey(t))throw new ae(z.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Hu(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ce()}function Yn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ae(z.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Hu(t);throw new ae(z.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function FP(t,e){if(e<=0)throw new ae(z.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p0{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new ae(z.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ae(z.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}VP("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=qb((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ae(z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ae(z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ae(z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class qu{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new p0({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ae(z.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ae(z.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new p0(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new tI;switch(r.type){case"firstParty":return new iI(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ae(z.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=h0.get(n);r&&(he("ComponentProvider","Removing Datastore"),h0.delete(n),r.terminate())}(this),Promise.resolve()}}function $P(t,e,n,r={}){var s;const i=(t=Yn(t,qu))._getSettings(),a=`${e}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==a&&ga("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:a,ssl:!1})),r.mockUserToken){let c,u;if(typeof r.mockUserToken=="string")c=r.mockUserToken,u=on.MOCK_USER;else{c=f1(r.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new ae(z.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new on(d)}t._authCredentials=new nI(new Gw(c,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Xs(this.firestore,e,this._query)}}class xn{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Fs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new xn(this.firestore,e,this._key)}}class Fs extends Xs{constructor(e,n,r){super(e,n,Lu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new xn(this.firestore,null,new we(e))}withConverter(e){return new Fs(this.firestore,e,this._path)}}function Ct(t,e,...n){if(t=It(t),Gb("collection","path",e),t instanceof qu){const r=it.fromString(e,...n);return f0(r),new Fs(t,null,r)}{if(!(t instanceof xn||t instanceof Fs))throw new ae(z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(it.fromString(e,...n));return f0(r),new Fs(t.firestore,null,r)}}function Tn(t,e,...n){if(t=It(t),arguments.length===1&&(e=Kw.newId()),Gb("doc","path",e),t instanceof qu){const r=it.fromString(e,...n);return m0(r),new xn(t,null,new we(r))}{if(!(t instanceof xn||t instanceof Fs))throw new ae(z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(it.fromString(e,...n));return m0(r),new xn(t.firestore,t instanceof Fs?t.converter:null,new we(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g0{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Ib(this,"async_queue_retry"),this.Vu=()=>{const r=$d();r&&he("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const n=$d();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const n=$d();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const n=new zr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!dl(e))throw e;he("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const n=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(a){let c=a.message||"";return a.stack&&(c=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),c}(r);throw Yr("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=n,n}enqueueAfterDelay(e,n,r){this.fu(),this.Ru.indexOf(e)>-1&&(n=0);const s=Bf.createAndSchedule(this,e,n,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Ce()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const n of this.Tu)if(n.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Tu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const n=this.Tu.indexOf(e);this.Tu.splice(n,1)}}function y0(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class Hs extends qu{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new g0,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new g0(e),this._firestoreClient=void 0,await e}}}function UP(t,e){const n=typeof t=="object"?t:nw(),r=typeof t=="string"?t:e||"(default)",s=mf(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=h1("firestore");i&&$P(s,...i)}return s}function Gu(t){if(t._terminated)throw new ae(z.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||BP(t),t._firestoreClient}function BP(t){var e,n,r;const s=t._freezeSettings(),i=function(c,u,d,h){return new vI(c,u,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,qb(h.experimentalLongPollingOptions),h.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new jP(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(c){const u=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(u),_online:u}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(e){this._byteString=e}static fromBase64String(e){try{return new _a(Qt.fromBase64String(e))}catch(n){throw new ae(z.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new _a(Qt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ku{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new ae(z.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ht(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qu{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new ae(z.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new ae(z.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return qe(this._lat,e._lat)||qe(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zP=/^__.*__$/;class WP{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Js(e,this.data,this.fieldMask,n,this.fieldTransforms):new ml(e,this.data,n,this.fieldTransforms)}}class Kb{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Js(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function Qb(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ce()}}class Xf{constructor(e,n,r,s,i,a){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Xf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return mu(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Qb(this.Cu)&&zP.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class HP{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||Bu(e)}Qu(e,n,r,s=!1){return new Xf({Cu:e,methodName:n,qu:r,path:Ht.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Zf(t){const e=t._freezeSettings(),n=Bu(t._databaseId);return new HP(t._databaseId,!!e.ignoreUndefinedProperties,n)}function qP(t,e,n,r,s,i={}){const a=t.Qu(i.merge||i.mergeFields?2:0,e,n,s);tp("Data must be an object, but it was:",a,r);const c=Yb(r,a);let u,d;if(i.merge)u=new Fn(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const g=cm(e,f,n);if(!a.contains(g))throw new ae(z.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);Xb(h,g)||h.push(g)}u=new Fn(h),d=a.fieldTransforms.filter(f=>u.covers(f.field))}else u=null,d=a.fieldTransforms;return new WP(new Nn(c),u,d)}class Yu extends Qu{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Yu}}class ep extends Qu{_toFieldTransform(e){return new zI(e.path,new Qo)}isEqual(e){return e instanceof ep}}function GP(t,e,n,r){const s=t.Qu(1,e,n);tp("Data must be an object, but it was:",s,r);const i=[],a=Nn.empty();ki(r,(u,d)=>{const h=np(e,u,n);d=It(d);const f=s.Nu(h);if(d instanceof Yu)i.push(h);else{const g=yl(d,f);g!=null&&(i.push(h),a.set(h,g))}});const c=new Fn(i);return new Kb(a,c,s.fieldTransforms)}function KP(t,e,n,r,s,i){const a=t.Qu(1,e,n),c=[cm(e,r,n)],u=[s];if(i.length%2!=0)throw new ae(z.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)c.push(cm(e,i[g])),u.push(i[g+1]);const d=[],h=Nn.empty();for(let g=c.length-1;g>=0;--g)if(!Xb(d,c[g])){const x=c[g];let S=u[g];S=It(S);const y=a.Nu(x);if(S instanceof Yu)d.push(x);else{const k=yl(S,y);k!=null&&(d.push(x),h.set(x,k))}}const f=new Fn(d);return new Kb(h,f,a.fieldTransforms)}function QP(t,e,n,r=!1){return yl(n,t.Qu(r?4:3,e))}function yl(t,e){if(Jb(t=It(t)))return tp("Unsupported field value:",e,t),Yb(t,e);if(t instanceof Qu)return function(r,s){if(!Qb(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let a=0;for(const c of r){let u=yl(c,s.Lu(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=It(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return $I(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=jt.fromDate(r);return{timestampValue:cu(s.serializer,i)}}if(r instanceof jt){const i=new jt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:cu(s.serializer,i)}}if(r instanceof Yf)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof _a)return{bytesValue:wb(s.serializer,r._byteString)};if(r instanceof xn){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Df(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Jf)return function(a,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(u=>{if(typeof u!="number")throw c.Bu("VectorValues must only contain numeric values.");return Af(c.serializer,u)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Hu(r)}`)}(t,e)}function Yb(t,e){const n={};return Qw(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ki(t,(r,s)=>{const i=yl(s,e.Mu(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function Jb(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof jt||t instanceof Yf||t instanceof _a||t instanceof xn||t instanceof Qu||t instanceof Jf)}function tp(t,e,n){if(!Jb(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const r=Hu(n);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function cm(t,e,n){if((e=It(e))instanceof Ku)return e._internalPath;if(typeof e=="string")return np(t,e);throw mu("Field path arguments must be of type string or ",t,!1,void 0,n)}const YP=new RegExp("[~\\*/\\[\\]]");function np(t,e,n){if(e.search(YP)>=0)throw mu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Ku(...e.split("."))._internalPath}catch{throw mu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function mu(t,e,n,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let c=`Function ${e}() called with invalid data`;n&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new ae(z.INVALID_ARGUMENT,c+t+u)}function Xb(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zb{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new xn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new JP(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(rp("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class JP extends Zb{data(){return super.data()}}function rp(t,e){return typeof e=="string"?np(t,e):e instanceof Ku?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e_(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new ae(z.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class sp{}class t_ extends sp{}function hn(t,e,...n){let r=[];e instanceof sp&&r.push(e),r=r.concat(n),function(i){const a=i.filter(u=>u instanceof ip).length,c=i.filter(u=>u instanceof Ju).length;if(a>1||a>0&&c>0)throw new ae(z.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Ju extends t_{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Ju(e,n,r)}_apply(e){const n=this._parse(e);return n_(e._query,n),new Xs(e.firestore,e.converter,em(e._query,n))}_parse(e){const n=Zf(e.firestore);return function(i,a,c,u,d,h,f){let g;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new ae(z.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){x0(f,h);const x=[];for(const S of f)x.push(v0(u,i,S));g={arrayValue:{values:x}}}else g=v0(u,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||x0(f,h),g=QP(c,a,f,h==="in"||h==="not-in");return kt.create(d,h,g)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function Ft(t,e,n){const r=e,s=rp("where",t);return Ju._create(s,r,n)}class ip extends sp{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new ip(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:mr.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let a=s;const c=i.getFlattenedFilters();for(const u of c)n_(a,u),a=em(a,u)}(e._query,n),new Xs(e.firestore,e.converter,em(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ap extends t_{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new ap(e,n,r)}_apply(e){return new Xs(e.firestore,e.converter,ou(e._query,this._limit,this._limitType))}}function XP(t){return FP("limit",t),ap._create("limit",t,"F")}function v0(t,e,n){if(typeof(n=It(n))=="string"){if(n==="")throw new ae(z.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sb(e)&&n.indexOf("/")!==-1)throw new ae(z.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(it.fromString(n));if(!we.isDocumentKey(r))throw new ae(z.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Fy(t,new we(r))}if(n instanceof xn)return Fy(t,n._key);throw new ae(z.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Hu(n)}.`)}function x0(t,e){if(!Array.isArray(t)||t.length===0)throw new ae(z.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function n_(t,e){const n=function(s,i){for(const a of s)for(const c of a.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new ae(z.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ae(z.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class ZP{convertValue(e,n="none"){switch(Ti(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _t(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ei(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ce()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return ki(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var n,r,s;const i=(s=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(a=>_t(a.doubleValue));return new Jf(i)}convertGeoPoint(e){return new Yf(_t(e.latitude),_t(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Sf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(qo(e));default:return null}}convertTimestamp(e){const n=zs(e);return new jt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=it.fromString(e);Ye(Sb(r));const s=new Go(r.get(1),r.get(3)),i=new we(r.popFirst(5));return s.isEqual(n)||Yr(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eR(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class r_ extends Zb{constructor(e,n,r,s,i,a){super(e,n,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new bc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(rp("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class bc extends r_{data(e={}){return super.data(e)}}class s_{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new oo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new bc(this._firestore,this._userDataWriter,r.key,r,new oo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new ae(z.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(c=>{const u=new bc(s._firestore,s._userDataWriter,c.doc.key,c.doc,new oo(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{const u=new bc(s._firestore,s._userDataWriter,c.doc.key,c.doc,new oo(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,h=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),h=a.indexOf(c.doc.key)),{type:tR(c.type),doc:u,oldIndex:d,newIndex:h}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function tR(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ce()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vl(t){t=Yn(t,xn);const e=Yn(t.firestore,Hs);return LP(Gu(e),t._key).then(n=>i_(e,t,n))}class op extends ZP{constructor(e){super(),this.firestore=e}convertBytes(e){return new _a(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new xn(this.firestore,null,n)}}function wn(t){t=Yn(t,Xs);const e=Yn(t.firestore,Hs),n=Gu(e),r=new op(e);return e_(t._query),OP(n,t._query).then(s=>new s_(e,r,t,s))}function ss(t,e,n,...r){t=Yn(t,xn);const s=Yn(t.firestore,Hs),i=Zf(s);let a;return a=typeof(e=It(e))=="string"||e instanceof Ku?KP(i,"updateDoc",t._key,e,n,r):GP(i,"updateDoc",t._key,e),cp(s,[a.toMutation(t._key,ur.exists(!0))])}function _c(t){return cp(Yn(t.firestore,Hs),[new Pf(t._key,ur.none())])}function xl(t,e){const n=Yn(t.firestore,Hs),r=Tn(t),s=eR(t.converter,e);return cp(n,[qP(Zf(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,ur.exists(!1))]).then(()=>r)}function lp(t,...e){var n,r,s;t=It(t);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||y0(e[a])||(i=e[a],a++);const c={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(y0(e[a])){const f=e[a];e[a]=(n=f.next)===null||n===void 0?void 0:n.bind(f),e[a+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[a+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let u,d,h;if(t instanceof xn)d=Yn(t.firestore,Hs),h=Lu(t._key.path),u={next:f=>{e[a]&&e[a](i_(d,t,f))},error:e[a+1],complete:e[a+2]};else{const f=Yn(t,Xs);d=Yn(f.firestore,Hs),h=f._query;const g=new op(d);u={next:x=>{e[a]&&e[a](new s_(d,g,f,x))},error:e[a+1],complete:e[a+2]},e_(t._query)}return function(g,x,S,y){const k=new Qf(y),b=new Gf(x,k,S);return g.asyncQueue.enqueueAndForget(async()=>Wf(await hu(g),b)),()=>{k.Za(),g.asyncQueue.enqueueAndForget(async()=>Hf(await hu(g),b))}}(Gu(d),h,c,u)}function cp(t,e){return function(r,s){const i=new zr;return r.asyncQueue.enqueueAndForget(async()=>CP(await MP(r),s,i)),i.promise}(Gu(t),e)}function i_(t,e,n){const r=n.docs.get(e._key),s=new op(t);return new r_(t,s,e._key,r,new oo(n.hasPendingWrites,n.fromCache),e.converter)}function bn(){return new ep("serverTimestamp")}(function(e,n=!0){(function(s){Aa=s})(ka),pa(new xi("firestore",(r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),c=new Hs(new rI(r.getProvider("auth-internal")),new oI(r.getProvider("app-check-internal")),function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new ae(z.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Go(d.options.projectId,h)}(a,s),a);return i=Object.assign({useFetchStreams:n},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),Vs(Dy,"4.7.3",e),Vs(Dy,"4.7.3","esm2017")})();const nR={apiKey:"AIzaSyB_1Dn63ZHRnA-jXytu95WEBWNFQ64Jo_E",authDomain:"dnd-v1-17acc.firebaseapp.com",projectId:"dnd-v1-17acc",storageBucket:"dnd-v1-17acc.firebasestorage.app",messagingSenderId:"976056329393",appId:"1:976056329393:web:7c8170e906162fe4ef2e90"},a_=tw(nR),Xr=Jk(a_),Be=UP(a_),rR=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),ot=(t,e)=>{throw console.error(`Error in ${e}:`,t),t.code==="unavailable"||t.code==="deadline-exceeded"?new Error("Network connection issue. Please check your internet connection and try again."):t.code==="permission-denied"?new Error("Access denied. Please check your permissions."):t.code==="not-found"?new Error("The requested data was not found."):new Error(`Database error: ${t.message}`)},sR=async(t,e)=>{try{const n={...e,userId:t,createdAt:bn(),updatedAt:bn()};return{id:(await xl(Ct(Be,"userProfiles"),n)).id,...n}}catch(n){ot(n,"createUserProfile")}},Xu=async t=>{try{const e=hn(Ct(Be,"userProfiles"),Ft("userId","==",t)),n=await wn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){ot(e,"getUserProfile")}},w0=async t=>{try{if(!t||t.length===0)return[];const e=[];for(let s=0;s<t.length;s+=10){const i=t.slice(s,s+10),a=hn(Ct(Be,"userProfiles"),Ft("userId","in",i));e.push(wn(a))}const n=await Promise.all(e),r=[];return n.forEach(s=>{s.docs.forEach(i=>{r.push({id:i.id,...i.data()})})}),r}catch(e){ot(e,"getUserProfiles")}},iR=async t=>{try{const e=hn(Ct(Be,"userProfiles"),Ft("username","==",t));return(await wn(e)).empty}catch(e){ot(e,"checkUsernameAvailability")}},o_=t=>{const{class:e,level:n,constitution:r,dexterity:s,strength:i}=t,c={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[e]||8,u=Math.floor((r-10)/2),d=Math.max(1,(c+u)*n),h=10,f=Math.floor((s-10)/2),x={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[e]||0,S=h+f+x;return{hp:Math.max(1,d),maxHp:Math.max(1,d),ac:Math.max(10,S)}},aR=async(t,e,n)=>{try{const r=Ct(Be,"characters"),s=o_(n),i={...n,...s,userId:t,partyId:e,createdAt:new Date,updatedAt:new Date};return{id:(await xl(r,i)).id,...i}}catch(r){throw new Error(`Failed to save character: ${r.message}`)}},Ec=async t=>{try{const e=Ct(Be,"characters"),n=hn(e,Ft("userId","==",t));return(await wn(n)).docs.map(i=>({id:i.id,...i.data()}))}catch(e){throw new Error(`Failed to get user characters: ${e.message}`)}},oR=async(t,e)=>{try{const n=Ct(Be,"characters"),r=hn(n,Ft("userId","==",t),Ft("partyId","==",e)),s=await wn(r);if(s.empty)return null;const i=s.docs[0];return{id:i.id,...i.data()}}catch(n){throw new Error(`Failed to get character: ${n.message}`)}},Xo=async t=>{try{const e=hn(Ct(Be,"characters"),Ft("partyId","==",t));return(await wn(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){ot(e,"getPartyCharacters")}},um=async t=>{try{const e=Tn(Be,"characters",t);return await _c(e),!0}catch(e){throw new Error(`Failed to delete character: ${e.message}`)}},lR=async t=>{try{console.log("Debugging characters for user:",t);const e=hn(Ct(Be,"characters"),Ft("userId","==",t)),r=(await wn(e)).docs.map(a=>({id:a.id,...a.data()}));console.log("All characters for user:",r);const s=r.filter(a=>!a.partyId);s.length>0&&console.warn("Found characters without partyId:",s);const i={};return r.forEach(a=>{a.partyId&&(i[a.partyId]||(i[a.partyId]=[]),i[a.partyId].push(a))}),Object.entries(i).forEach(([a,c])=>{c.length>1&&console.warn(`Multiple characters found for party ${a}:`,c)}),{totalCharacters:r.length,orphanedCharacters:s.length,partyGroups:i}}catch(e){throw console.error("Error debugging characters:",e),e}},cR=async t=>{try{const n=(await Ec(t)).filter(s=>!s.partyId);if(n.length===0)return{deleted:0};const r=n.map(s=>um(s.id));return await Promise.all(r),{deleted:n.length}}catch(e){throw new Error(`Failed to cleanup orphaned characters: ${e.message}`)}},l_=async(t,e)=>{try{const n={...e,dmId:t,members:[t],createdAt:bn(),updatedAt:bn()};return{id:(await xl(Ct(Be,"parties"),n)).id,...n}}catch(n){ot(n,"createParty")}},c_=async t=>{try{const e=hn(Ct(Be,"parties"),Ft("members","array-contains",t));return(await wn(e)).docs.map(s=>{const i=s.data();return{id:s.id,...i}})}catch(e){ot(e,"getUserParties")}},uR=async()=>{try{const t=hn(Ct(Be,"parties"),Ft("isPublic","==",!0));return(await wn(t)).docs.map(r=>{const s=r.data();return{id:r.id,...s}}).sort((r,s)=>{var c,u,d,h;const i=((u=(c=r.createdAt)==null?void 0:c.toDate)==null?void 0:u.call(c))||r.createdAt||new Date(0);return(((h=(d=s.createdAt)==null?void 0:d.toDate)==null?void 0:h.call(d))||s.createdAt||new Date(0))-i})}catch(t){ot(t,"getPublicParties")}},b0=async(t,e)=>{try{const n=Tn(Be,"parties",t),r=await vl(n);if(!r.exists())throw new Error("Party not found");const s=r.data();if(s.members.includes(e))throw new Error("User already in party");await ss(n,{members:[...s.members,e],updatedAt:bn()})}catch(n){ot(n,"joinParty")}},u_=async(t,e)=>{try{const n=Tn(Be,"parties",t),r=await vl(n);if(!r.exists())throw new Error("Party not found");if(r.data().dmId!==e)throw new Error("Only the party leader can disband the party");await _c(n);const i=hn(Ct(Be,"characters"),Ft("partyId","==",t)),c=(await wn(i)).docs.map(f=>_c(f.ref));await Promise.all(c);const u=hn(Ct(Be,"campaignStories"),Ft("partyId","==",t)),h=(await wn(u)).docs.map(f=>_c(f.ref));await Promise.all(h)}catch(n){ot(n,"disbandParty")}},dR=async t=>{try{const e=hn(Ct(Be,"parties"),Ft("inviteCode","==",t)),n=await wn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){ot(e,"getPartyByInviteCode")}},hR=async t=>{try{const e=Tn(Be,"parties",t),n=await vl(e);return n.exists()?{id:n.id,...n.data()}:null}catch(e){ot(e,"getPartyById")}},mR=(t,e)=>{const n=Tn(Be,"parties",t);return lp(n,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})},fR=async t=>{try{const e={partyId:t,status:"ready_up",currentPlot:null,storyMessages:[],votingSession:null,readyPlayers:[],lastUpdated:bn(),createdAt:bn()};return{id:(await xl(Ct(Be,"campaignStories"),e)).id,...e}}catch(e){ot(e,"createCampaignStory")}},pR=async t=>{try{const e=hn(Ct(Be,"campaignStories"),Ft("partyId","==",t)),n=await wn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){ot(e,"getCampaignStory")}},gn=async(t,e)=>{try{const n=Tn(Be,"campaignStories",t);await ss(n,{...e,lastUpdated:bn()})}catch(n){ot(n,"updateCampaignStory")}},gR=async(t,e)=>{try{const n=Tn(Be,"campaignStories",t),i=(await vl(n)).data().readyPlayers||[];i.includes(e)||await ss(n,{readyPlayers:[...i,e],lastUpdated:bn()})}catch(n){ot(n,"setPlayerReady")}},yR=(t,e)=>{try{const n=Tn(Be,"campaignStories",t);return lp(n,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})}catch(n){ot(n,"subscribeToCampaignStory")}},vR=async(t,e)=>{try{const n=Tn(Be,"campaignStories",t);await ss(n,{currentSpeaker:e,lastUpdated:bn()})}catch(n){ot(n,"setCurrentSpeaker")}},Bd=async(t,e)=>{try{const n={partyId:t,status:"active",storyContext:e.storyContext,partyMembers:e.partyMembers,enemies:e.enemies,initiative:e.initiative,currentTurn:e.currentTurn||0,round:e.round||1,combatState:e.combatState||"active",environmentalFeatures:e.environmentalFeatures,teamUpOpportunities:e.teamUpOpportunities,narrativeElements:e.narrativeElements,createdAt:bn(),updatedAt:bn()};return{id:(await xl(Ct(Be,"combatSessions"),n)).id,...n}}catch(n){ot(n,"createCombatSession")}},_0=async t=>{try{const e=hn(Ct(Be,"combatSessions"),Ft("partyId","==",t),Ft("status","==","active")),n=await wn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){ot(e,"getCombatSession")}},ai=async(t,e)=>{try{const n=Tn(Be,"combatSessions",t);await ss(n,{...e,updatedAt:bn()})}catch(n){ot(n,"updateCombatSession")}},d_=(t,e)=>{try{const n=hn(Ct(Be,"combatSessions"),Ft("partyId","==",t),Ft("status","==","active"));return lp(n,r=>{if(r.empty)e(null);else{const s=r.docs[0];e({id:s.id,...s.data()})}})}catch(n){ot(n,"subscribeToCombatSession")}},xR=async(t,e)=>{try{const n=await Xu(t);if(!n)throw new Error("User profile not found");const r={id:rR(),...e,createdAt:new Date},i=[...n.characterPresets||[],r];return await ss(Tn(Be,"userProfiles",n.id),{characterPresets:i}),r}catch(n){throw new Error(`Failed to save character preset: ${n.message}`)}},wR=async t=>{try{const e=await Xu(t);return e?e.characterPresets||[]:[]}catch(e){ot(e,"getUserCharacterPresets")}},bR=async(t,e)=>{try{const n=await Xu(t);if(!n)throw new Error("User profile not found");const s=(n.characterPresets||[]).filter(a=>a.id!==e),i=Tn(Be,"userProfiles",n.id);await ss(i,{characterPresets:s,updatedAt:bn()})}catch(n){ot(n,"deleteCharacterPreset")}},_R=async(t,e)=>{try{const n=Tn(Be,"combatSessions",t);await ss(n,{...e,updatedAt:bn()})}catch(n){ot(n,"updateCombatSessionWithNarrative")}},ER=async t=>{try{const e=Tn(Be,"characters",t),n=await vl(e);if(!n.exists())throw new Error(`Character document with ID ${t} does not exist`);const r=n.data(),s=o_(r);return await ss(e,{...s,updatedAt:new Date}),{id:t,...r,...s}}catch(e){throw new Error(`Failed to recalculate character stats: ${e.message}`)}},TR=async t=>{try{const n=(await Xo(t)).filter(s=>!s.hp||!s.maxHp||!s.ac).map(s=>ER(s.id));return await Promise.all(n)}catch(e){throw new Error(`Failed to update party character stats: ${e.message}`)}},CR=()=>{const[t,e]=P.useState(null),[n,r]=P.useState(!0);return P.useEffect(()=>Iw(Xr,i=>{e(i),r(!1)}),[]),{user:t,loading:n}},SR=async(t,e,n)=>{try{if(console.log("Starting registration for:",t,n),!await iR(n))return console.log("Username not available:",n),{user:null,error:"Username is already taken. Please choose a different username."};console.log("Username available:",n);const s=await LN(Xr,t,e);console.log("User created successfully:",s.user.uid);try{await sR(s.user.uid,{username:n,email:t,displayName:n}),console.log("User profile created successfully")}catch(a){console.error("Error creating user profile:",a)}let i=!1;try{await VN(s.user),console.log("Email verification sent successfully"),i=!0}catch(a){console.error("Error sending email verification:",a)}return await Aw(Xr),console.log("User signed out after registration"),{user:null,error:null,success:!0}}catch(r){return console.error("Registration error:",r),{user:null,error:r.message}}},NR=async(t,e)=>{try{return{user:(await ON(Xr,t,e)).user,error:null}}catch(n){return{user:null,error:n.message}}},kR=async()=>{try{return await Aw(Xr),{error:null}}catch(t){return{error:t.message}}},ja=t=>Iw(Xr,async e=>{t(e)}),IR=async()=>{try{return console.log("Testing Firebase connection..."),console.log("Auth domain:",Xr.config.authDomain),console.log("Project ID:",Xr.config.projectId),{success:!0,message:"Firebase connection successful"}}catch(t){return console.error("Firebase connection test failed:",t),{success:!1,error:t.message}}};function AR(){const[t,e]=P.useState(null),[n,r]=P.useState(null),[s,i]=P.useState(!1),[a,c]=P.useState(!1),[u,d]=P.useState("connected"),h=Zn();P.useEffect(()=>{const x=ja(async S=>{if(e(S),S)try{const y=await Xu(S.uid);r(y)}catch(y){console.error("Error loading user profile:",y)}else r(null)});return()=>x()},[h]),P.useEffect(()=>{const x=async()=>{try{const y=hn(Ct(Be,"_test"),XP(1));await wn(y),d("connected")}catch(y){console.warn("Firestore connection issue detected:",y),d("disconnected"),setTimeout(()=>{d("reconnecting"),x()},5e3)}};x();const S=setInterval(x,3e4);return()=>clearInterval(S)},[]);const f=async()=>{const{error:x}=await kR();x||(h("/"),c(!1),i(!1))},g=(n==null?void 0:n.username)||(t==null?void 0:t.email);return o.jsx("nav",{className:"bg-gray-900 text-gray-100 shadow-lg border-b border-gray-700",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx(xr,{to:"/",className:"text-xl sm:text-2xl font-bold font-['Cinzel'] text-amber-400",children:"DND-V1"}),o.jsxs("div",{className:"flex items-center space-x-2 mr-4",children:[o.jsx("div",{className:`w-2 h-2 rounded-full ${u==="connected"?"bg-green-500":u==="reconnecting"?"bg-yellow-500":"bg-red-500"}`}),o.jsx("span",{className:"text-xs text-gray-400 hidden sm:inline",children:u==="connected"?"Connected":u==="reconnecting"?"Reconnecting...":"Disconnected"})]}),o.jsx("div",{className:"hidden md:flex items-center space-x-4",children:t?o.jsxs(o.Fragment,{children:[o.jsx(xr,{to:"/dashboard",className:"fantasy-button",children:"Dashboard"}),o.jsx(xr,{to:"/party-management",className:"fantasy-button",children:"Parties"}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{onClick:()=>i(!s),className:"fantasy-button bg-gray-700 hover:bg-gray-600",children:g}),s&&o.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-600 z-50",children:o.jsxs("div",{className:"py-2",children:[o.jsxs("div",{className:"px-4 py-2 text-sm text-gray-200 border-b border-gray-600",children:[o.jsx("div",{className:"font-medium",children:g}),o.jsx("div",{className:"text-xs text-gray-400",children:t.email})]}),o.jsx("button",{onClick:f,className:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-700",children:"Logout"})]})})]})]}):o.jsx(xr,{to:"/login",className:"fantasy-button",children:"Login"})}),o.jsx("div",{className:"md:hidden",children:o.jsx("button",{onClick:()=>c(!a),className:"fantasy-button bg-gray-700 hover:bg-gray-600 p-2",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a?o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})})]}),a&&o.jsx("div",{className:"md:hidden mt-4 pb-4 border-t border-gray-700",children:t?o.jsxs("div",{className:"pt-4 space-y-3",children:[o.jsx(xr,{to:"/dashboard",className:"fantasy-button block w-full text-center",onClick:()=>c(!1),children:"Dashboard"}),o.jsx(xr,{to:"/party-management",className:"fantasy-button block w-full text-center",onClick:()=>c(!1),children:"Parties"}),o.jsxs("div",{className:"pt-3 border-t border-gray-700",children:[o.jsxs("div",{className:"px-4 py-2 text-sm text-gray-200",children:[o.jsx("div",{className:"font-medium",children:g}),o.jsx("div",{className:"text-xs text-gray-400",children:t.email})]}),o.jsx("button",{onClick:f,className:"w-full text-left px-4 py-3 text-sm text-gray-200 hover:bg-gray-700 rounded-lg mt-2",children:"Logout"})]})]}):o.jsx("div",{className:"pt-4",children:o.jsx(xr,{to:"/login",className:"fantasy-button block w-full text-center",onClick:()=>c(!1),children:"Login"})})})]})})}function PR(){return o.jsx("div",{className:"text-xs text-gray-400 text-center mt-2",children:"Version 3.1.0"})}function RR(){return o.jsxs("div",{className:"relative overflow-hidden",children:[o.jsx("div",{className:"fantasy-container",children:o.jsxs("div",{className:"relative z-10 py-8 sm:py-16 lg:py-24 text-center",children:[o.jsx("h1",{className:"fantasy-title text-5xl sm:text-6xl lg:text-7xl",children:"Manage your D&D world like a real adventurer's tome"}),o.jsx("p",{className:"fantasy-subtitle max-w-2xl mx-auto",children:"Create parties, invite friends, and share story objectives in a beautifully crafted digital environment that feels like a magical grimoire."}),o.jsxs("div",{className:"mt-8 flex justify-center space-x-6",children:[o.jsx(xr,{to:"/register",className:"fantasy-button text-lg px-8 py-3",children:"Start Your Journey"}),o.jsx(xr,{to:"/login",className:"fantasy-button text-lg px-8 py-3 bg-gray-600 hover:bg-gray-700",children:"Return to Campaign"})]})]})}),o.jsx("div",{className:"absolute inset-0 bg-gray-700/10 pattern-grid-lg"})]})}function jR(){return o.jsxs("div",{children:[o.jsx(RR,{}),o.jsx("div",{className:"fantasy-container py-16",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Create Parties"}),o.jsx("p",{className:"text-gray-300",children:"Form adventuring parties with your friends and manage your campaign together in a shared space."})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Track Objectives"}),o.jsx("p",{className:"text-gray-300",children:"Keep track of your party's quests, storylines, and achievements in an organized magical tome."})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Share Stories"}),o.jsx("p",{className:"text-gray-300",children:"Document your adventures and share them with your fellow party members in an immersive fantasy setting."})]})]})})]})}function DR(){const[t,e]=P.useState(""),[n,r]=P.useState(""),[s,i]=P.useState(!1),[a,c]=P.useState(""),[u,d]=P.useState(""),h=Zn(),f=Ys();P.useEffect(()=>{var S;(S=f.state)!=null&&S.message&&(d(f.state.message),h(f.pathname,{replace:!0}));const x=ja(y=>{y&&h("/dashboard")});return()=>x()},[h,f]);const g=async x=>{x.preventDefault(),i(!0),c("");const S=await NR(t,n);S.error&&(S.error.includes("auth/invalid-credential")?c("Invalid email or password. Please check your credentials or register a new account."):S.error.includes("auth/user-not-found")?c("No account found with this email. Please register first."):S.error.includes("auth/wrong-password")?c("Incorrect password. Please try again."):S.error.includes("auth/user-disabled")?c("This account has been disabled. Please contact support."):S.error.includes("auth/too-many-requests")?c("Too many failed login attempts. Please try again later."):c(S.error)),i(!1)};return o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card max-w-md mx-auto",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Login"}),u&&o.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded-lg mb-4",children:u}),o.jsxs("form",{onSubmit:g,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-200 mb-2",children:"Email"}),o.jsx("input",{id:"email",type:"email",value:t,onChange:x=>e(x.target.value),className:"fantasy-input",autoComplete:"email",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-200 mb-2",children:"Password"}),o.jsx("input",{id:"password",type:"password",value:n,onChange:x=>r(x.target.value),className:"fantasy-input",autoComplete:"current-password",required:!0})]}),a&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded-lg",children:a}),o.jsx("button",{type:"submit",disabled:s,className:"fantasy-button w-full",children:s?"Logging in...":"Login"})]}),o.jsx("div",{className:"mt-6 text-center",children:o.jsxs("p",{className:"text-gray-300",children:["Don't have an account?"," ",o.jsx("button",{onClick:()=>h("/register"),className:"text-amber-400 hover:text-amber-300 font-medium",children:"Register here"})]})})]})})}function MR(){const[t,e]=P.useState(""),[n,r]=P.useState(""),[s,i]=P.useState(""),[a,c]=P.useState(""),[u,d]=P.useState(""),[h,f]=P.useState(""),g=Zn();P.useEffect(()=>{IR().then(S=>{console.log("Firebase test result:",S)})},[]);const x=async S=>{if(S.preventDefault(),d(""),f(""),s!==a){d("Passwords do not match");return}if(!n.trim()){d("Username is required");return}if(n.length<3){d("Username must be at least 3 characters long");return}if(!/^[a-zA-Z0-9_]+$/.test(n)){d("Username can only contain letters, numbers, and underscores");return}console.log("Submitting registration for:",t,n);const{user:y,error:k,success:b}=await SR(t,s,n);if(console.log("Registration result:",{user:y,error:k,success:b}),k){console.log("Setting error:",k),d(k);return}b?(console.log("Registration successful, redirecting to login"),g("/login",{state:{message:"Registration successful! Please check your email to verify your account before logging in."}})):console.log("No success received from registration")};return o.jsx("div",{className:"fantasy-container min-h-screen flex items-center justify-center",children:o.jsxs("div",{className:"fantasy-card w-full max-w-md",children:[o.jsx("h2",{className:"fantasy-title text-center",children:"Begin Your Adventure"}),u&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded mb-4",children:u}),h&&o.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded mb-4",children:h}),o.jsxs("form",{onSubmit:x,className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-200",children:"Username"}),o.jsx("input",{id:"username",type:"text",required:!0,value:n,onChange:S=>r(S.target.value),className:"fantasy-input mt-1",placeholder:"Choose a unique username"}),o.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Letters, numbers, and underscores only. 3+ characters."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-200",children:"Email"}),o.jsx("input",{id:"email",type:"email",required:!0,value:t,onChange:S=>e(S.target.value),className:"fantasy-input mt-1"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-200",children:"Password"}),o.jsx("input",{id:"password",type:"password",required:!0,value:s,onChange:S=>i(S.target.value),className:"fantasy-input mt-1"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-200",children:"Confirm Password"}),o.jsx("input",{id:"confirmPassword",type:"password",required:!0,value:a,onChange:S=>c(S.target.value),className:"fantasy-input mt-1"})]}),o.jsx("button",{type:"submit",className:"fantasy-button w-full",children:"Register"})]}),o.jsxs("p",{className:"mt-4 text-center text-sm text-gray-300",children:["Already have an account?"," ",o.jsx(xr,{to:"/login",className:"text-amber-400 hover:text-amber-300",children:"Return to your campaign"})]})]})})}function h_({validation:t,onClose:e,onProceed:n,onRevise:r}){const[s,i]=P.useState(!1),[a,c]=P.useState(!1),[u,d]=P.useState(null);if(P.useEffect(()=>{if(t!=null&&t.diceResult){i(!0),c(!0);const g=setTimeout(()=>{c(!1),d(t.diceResult)},2e3);return()=>clearTimeout(g)}},[t]),!t)return null;const h=(g,x)=>x==="critical success"?"text-green-800 bg-green-200 border-green-400":x==="great success"?"text-green-700 bg-green-100 border-green-300":x==="success"?"text-green-600 bg-green-50 border-green-200":x==="failure"?"text-red-600 bg-red-50 border-red-200":x==="great failure"?"text-red-700 bg-red-100 border-red-300":x==="critical failure"?"text-red-800 bg-red-200 border-red-400":g?"text-green-600 bg-green-100 border-green-300":"text-red-600 bg-red-100 border-red-300",f=()=>t.diceResult?o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-gradient-to-br from-amber-900 to-amber-800 rounded-2xl p-8 max-w-2xl w-full mx-4 border-4 border-amber-600 shadow-2xl",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"text-amber-200 text-lg font-bold mb-2",children:"🎲 THE DICE HAVE BEEN CAST 🎲"}),o.jsx("div",{className:"text-amber-300 text-sm",children:"The fate of your party hangs in the balance..."})]}),o.jsxs("div",{className:"bg-amber-950/50 rounded-lg p-4 mb-6 border border-amber-500",children:[o.jsx("div",{className:"text-amber-200 font-bold text-lg mb-2",children:"Your Action"}),o.jsx("div",{className:"text-amber-100 text-sm",children:t.diceResult.actions?t.diceResult.actions.map((g,x)=>o.jsxs("div",{className:"mb-2",children:[o.jsx("span",{className:"font-semibold capitalize",children:g.action}),o.jsxs("span",{className:"text-amber-300",children:[": ",g.description]})]},x)).join(""):"Rolling the dice..."})]}),a?o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"text-6xl mb-4 animate-bounce",children:"🎲"}),o.jsx("div",{className:"text-amber-200 text-xl font-bold mb-2",children:"Rolling..."}),o.jsx("div",{className:"text-amber-300 text-sm",children:"The dice tumble across the table"})]}):o.jsxs("div",{className:"space-y-4",children:[t.diceResult.actions?t.diceResult.actions.map((g,x)=>o.jsxs("div",{className:`rounded-lg p-4 border-2 ${h(g.check.isSuccess,g.check.degree)}`,children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("div",{className:"text-lg font-bold capitalize",children:g.action}),o.jsx("div",{className:"text-2xl font-bold",children:g.check.degree?g.check.degree.replace("_"," ").toUpperCase():g.check.isSuccess?"SUCCESS":"FAILURE"})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center mb-3",children:[o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"ROLL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:g.check.roll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"TOTAL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:g.check.totalRoll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"DC"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:g.check.dc})]})]}),o.jsx("div",{className:"text-sm text-amber-200",children:g.description})]},x)):o.jsxs("div",{className:`rounded-lg p-6 border-2 text-center ${h(t.diceResult.isSuccess)}`,children:[o.jsx("div",{className:"text-2xl font-bold mb-4",children:t.diceResult.isSuccess?"SUCCESS!":"FAILURE!"}),o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"ROLL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:t.diceResult.roll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"TOTAL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:t.diceResult.totalRoll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"DC"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:t.diceResult.dc})]})]})]}),t.diceResult.overallSuccess!==void 0&&o.jsxs("div",{className:`rounded-lg p-4 border-2 text-center ${t.diceResult.overallSuccess?"border-green-400 bg-green-900/50":"border-red-400 bg-red-900/50"}`,children:[o.jsx("div",{className:"text-xl font-bold mb-2",children:t.diceResult.overallSuccess?"🎉 MISSION ACCOMPLISHED! 🎉":"💀 THE DICE HAVE SPOKEN... 💀"}),o.jsx("div",{className:"text-sm",children:t.diceResult.overallSuccess?"Your party's combined efforts have succeeded!":"The challenge has proven too great this time..."})]})]}),!a&&o.jsxs("div",{className:"bg-amber-950/50 rounded-lg p-4 mt-6 border border-amber-500",children:[o.jsx("div",{className:"text-amber-200 font-bold mb-2",children:"🎭 Dungeon Master's Commentary"}),o.jsx("div",{className:"text-amber-100 text-sm italic",children:typeof t.response=="string"?t.response:t.response.story})]}),!a&&o.jsxs("div",{className:"mt-6 flex justify-center space-x-4",children:[t.type==="valid"?o.jsx("button",{onClick:n,className:"fantasy-button bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:"🚀 PROCEED WITH FATE"}):o.jsx("button",{onClick:r,className:"fantasy-button bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:"🔄 TRY AGAIN"}),o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:"❌ CANCEL"})]})]})}):null;return s?f():o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-gradient-to-br from-stone-800 to-stone-900 rounded-lg p-6 max-w-2xl w-full mx-4 border-2 border-stone-600 shadow-xl",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-stone-200",children:"🎭 Action Validation"}),o.jsx("button",{onClick:e,className:"text-stone-400 hover:text-stone-200 text-xl",children:"✕"})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"p-4 bg-stone-700 rounded-lg border border-stone-600",children:[o.jsx("h4",{className:"font-semibold text-stone-200 mb-2",children:"🎭 Dungeon Master's Response"}),o.jsx("div",{className:"text-stone-300 italic leading-relaxed",children:typeof t.response=="string"?t.response:t.response.story})]}),t.suggestion&&o.jsxs("div",{className:"p-4 bg-blue-900/50 rounded-lg border border-blue-600",children:[o.jsx("h4",{className:"font-semibold text-blue-200 mb-2",children:"💡 Suggestion"}),o.jsx("p",{className:"text-blue-100",children:t.suggestion})]}),t.type!=="valid"&&o.jsxs("div",{className:"p-4 bg-purple-900/50 rounded-lg border border-purple-600",children:[o.jsx("h4",{className:"font-semibold text-purple-200 mb-2",children:"🔄 Alternative Approaches"}),o.jsxs("ul",{className:"text-purple-100 text-sm space-y-1",children:[o.jsx("li",{children:"• Try a more focused, single action"}),o.jsx("li",{children:"• Consider your character's abilities and limitations"}),o.jsx("li",{children:"• Think about what would be realistic in this situation"}),o.jsx("li",{children:"• Ask for clarification about what you're trying to achieve"})]})]})]}),o.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[t.type==="valid"?o.jsx("button",{onClick:n,className:"fantasy-button bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold",children:"Proceed with Action"}):o.jsx("button",{onClick:r,className:"fantasy-button bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-bold",children:"Revise Action"}),o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700 text-white px-4 py-2 rounded font-bold",children:"Cancel"})]})]})})}function m_({diceResult:t,onClose:e}){if(!t)return null;const n=s=>{switch(s){case"critical success":return"text-green-600 bg-green-100";case"great success":return"text-green-700 bg-green-50";case"success":return"text-blue-600 bg-blue-100";case"failure":return"text-yellow-600 bg-yellow-100";case"great failure":return"text-orange-600 bg-orange-100";case"critical failure":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},r=s=>{switch(s){case"critical success":return"🎯";case"great success":return"✅";case"success":return"✓";case"failure":return"⚠️";case"great failure":return"❌";case"critical failure":return"💥";default:return"🎲"}};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Dice Roll Results"}),o.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),t.actions?o.jsxs("div",{className:"space-y-4",children:[t.actions.map((s,i)=>o.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:s.action}),o.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${n(s.check.degree)}`,children:[r(s.check.degree)," ",s.check.degree]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Roll:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.roll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Total:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.totalRoll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"DC:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.dc})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Margin:"}),o.jsxs("span",{className:`font-mono ml-1 ${s.check.margin>=0?"text-green-600":"text-red-600"}`,children:[s.check.margin>=0?"+":"",s.check.margin]})]})]}),s.check.circumstanceBonus!==0&&o.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:["Circumstance bonus: ",s.check.circumstanceBonus>=0?"+":"",s.check.circumstanceBonus]})]},i)),o.jsxs("div",{className:"mt-4 p-3 bg-stone-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"Overall Result"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${t.overallSuccess?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:t.overallSuccess?"✅ Success":"❌ Partial Failure"}),t.hasCriticalFailures&&o.jsx("span",{className:"text-red-600 text-sm",children:"⚠️ Critical failures occurred"})]})]})]}):o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:t.actionType}),o.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${n(t.degree)}`,children:[r(t.degree)," ",t.degree]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Roll:"}),o.jsx("span",{className:"font-mono ml-1",children:t.roll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Total:"}),o.jsx("span",{className:"font-mono ml-1",children:t.totalRoll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"DC:"}),o.jsx("span",{className:"font-mono ml-1",children:t.dc})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Margin:"}),o.jsxs("span",{className:`font-mono ml-1 ${t.margin>=0?"text-green-600":"text-red-600"}`,children:[t.margin>=0?"+":"",t.margin]})]})]}),o.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:[o.jsxs("div",{children:["Primary Mod: ",t.primaryMod>=0?"+":"",t.primaryMod]}),o.jsxs("div",{children:["Proficiency: ",t.proficiencyMod>=0?"+":"",t.proficiencyMod]}),t.circumstanceBonus!==0&&o.jsxs("div",{children:["Circumstance: ",t.circumstanceBonus>=0?"+":"",t.circumstanceBonus]})]})]})}),o.jsx("div",{className:"mt-4 flex justify-end",children:o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Close"})})]})})}function LR({multipleResults:t,onClose:e}){const[n,r]=P.useState(!1),[s,i]=P.useState(null);if(!t)return null;const{actionType:a,numberOfAttempts:c,results:u,statistics:d}=t,h=y=>y.adjustedSuccess&&y.adjustedMargin>=10?"bg-green-500":y.adjustedSuccess?"bg-green-400":!y.adjustedSuccess&&y.adjustedMargin<=-10?"bg-red-500":"bg-red-400",f=y=>y.adjustedSuccess&&y.adjustedMargin>=10?"🎯":y.adjustedSuccess?"✅":!y.adjustedSuccess&&y.adjustedMargin<=-10?"💥":"❌",g=y=>{const k=`Attempt ${y.attemptNumber}: ${y.roll} + ${y.primaryMod} + ${y.proficiencyMod}`,b=y.fatiguePenalty>0?` - ${y.fatiguePenalty} (fatigue)`:"",w=` = ${y.adjustedTotalRoll} vs DC ${y.dc}`,I=y.adjustedSuccess?" (Success)":" (Failure)";return k+b+w+I},S=((y,k=50)=>{const b=[];for(let w=0;w<y.length;w+=k)b.push(y.slice(w,w+k));return b})(u);return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsxs("h3",{className:"text-lg font-bold text-stone-800",children:["Multiple Attempts: ",a," (",c," attempts)"]}),o.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),o.jsxs("div",{className:"mb-6 p-4 bg-stone-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-stone-700 mb-3",children:"Overall Statistics"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.successfulAttempts}),o.jsx("div",{className:"text-sm text-stone-600",children:"Successful"})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[d.successRate.toFixed(1),"%"]}),o.jsx("div",{className:"text-sm text-stone-600",children:"Success Rate"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-amber-600",children:d.criticalSuccesses}),o.jsx("div",{className:"text-sm text-stone-600",children:"Critical Successes"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-red-600",children:d.criticalFailures}),o.jsx("div",{className:"text-sm text-stone-600",children:"Critical Failures"})]})]}),o.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Average Roll:"})," ",d.averageRoll.toFixed(1)]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Best Roll:"})," ",d.bestRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Worst Roll:"})," ",d.worstRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Average Total:"})," ",d.averageTotalRoll.toFixed(1)]})]})]}),o.jsxs("div",{className:"mb-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700",children:"Individual Attempts"}),o.jsx("button",{onClick:()=>r(!n),className:"text-sm text-blue-600 hover:text-blue-800",children:n?"Hide Details":"Show Details"})]}),o.jsx("div",{className:"space-y-2",children:S.map((y,k)=>o.jsxs("div",{className:"flex flex-wrap gap-1",children:[y.map(b=>o.jsx("div",{className:`w-6 h-6 rounded text-xs flex items-center justify-center cursor-pointer transition-colors ${h(b)} text-white font-bold`,title:g(b),onClick:()=>i(b),children:f(b)},b.attemptNumber)),k<S.length-1&&o.jsx("div",{className:"w-full h-px bg-stone-300 my-2"})]},k))})]}),o.jsxs("div",{className:"mb-4 p-3 bg-stone-50 rounded-lg",children:[o.jsx("h5",{className:"font-semibold text-stone-700 mb-2",children:"Legend"}),o.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-green-500 rounded text-white text-xs flex items-center justify-center",children:"🎯"}),o.jsx("span",{children:"Critical Success"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-green-400 rounded text-white text-xs flex items-center justify-center",children:"✅"}),o.jsx("span",{children:"Success"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-red-400 rounded text-white text-xs flex items-center justify-center",children:"❌"}),o.jsx("span",{children:"Failure"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-red-500 rounded text-white text-xs flex items-center justify-center",children:"💥"}),o.jsx("span",{children:"Critical Failure"})]})]})]}),s&&o.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[o.jsxs("h5",{className:"font-semibold text-blue-700 mb-2",children:["Attempt ",s.attemptNumber," Details"]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Roll:"})," ",s.roll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Primary Mod:"})," ",s.primaryMod>=0?"+":"",s.primaryMod]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Proficiency:"})," ",s.proficiencyMod>=0?"+":"",s.proficiencyMod]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Fatigue Penalty:"})," -",s.fatiguePenalty]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Total:"})," ",s.adjustedTotalRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"DC:"})," ",s.dc]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Margin:"})," ",s.adjustedMargin>=0?"+":"",s.adjustedMargin]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Result:"}),o.jsx("span",{className:`ml-1 px-2 py-1 rounded text-xs font-medium ${s.adjustedSuccess?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.adjustedSuccess?"Success":"Failure"})]})]}),o.jsx("button",{onClick:()=>i(null),className:"mt-2 text-sm text-blue-600 hover:text-blue-800",children:"Close Details"})]}),n&&o.jsxs("div",{className:"mb-4",children:[o.jsx("h5",{className:"font-semibold text-stone-700 mb-2",children:"Detailed Results"}),o.jsx("div",{className:"max-h-64 overflow-y-auto",children:o.jsxs("table",{className:"w-full text-sm",children:[o.jsx("thead",{className:"bg-stone-100",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-2 py-1 text-left",children:"#"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Roll"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Total"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"DC"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Fatigue"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Result"})]})}),o.jsx("tbody",{children:u.map(y=>o.jsxs("tr",{className:"border-b border-stone-200",children:[o.jsx("td",{className:"px-2 py-1",children:y.attemptNumber}),o.jsx("td",{className:"px-2 py-1",children:y.roll}),o.jsx("td",{className:"px-2 py-1",children:y.adjustedTotalRoll}),o.jsx("td",{className:"px-2 py-1",children:y.dc}),o.jsxs("td",{className:"px-2 py-1",children:["-",y.fatiguePenalty]}),o.jsx("td",{className:"px-2 py-1",children:o.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${y.adjustedSuccess?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:y.adjustedSuccess?"Success":"Failure"})})]},y.attemptNumber))})]})})]}),o.jsx("div",{className:"flex justify-end",children:o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Close"})})]})})}function OR(){const t=Zn(),[e,n]=P.useState(null),[r,s]=P.useState([]),[i,a]=P.useState(!0);P.useState(""),P.useState(""),P.useState(null),P.useState(!1),P.useState(!1),P.useState(!1),P.useState(null),P.useState(null),P.useState(null),P.useEffect(()=>{const y=Xr.onAuthStateChanged(async k=>{k?(n(k),await c(k.uid)):t("/login")});return()=>y()},[t]);const c=async y=>{try{const k=await c_(y);await u(k),s(k)}catch(k){console.error("Error loading user data:",k)}finally{a(!1)}},u=async y=>{for(const k of y)if(k.members)for(const b of k.members)b.profileId},d=async y=>{try{await u_(y,e.uid),s(k=>k.filter(b=>b.id!==y))}catch(k){console.error("Error deleting party:",k)}},h=async y=>{try{if(console.log("=== CONTINUE CAMPAIGN DEBUG ==="),console.log("handleContinueCampaign called with partyId:",y),console.log("Current user:",e==null?void 0:e.uid),console.log("User object:",e),!(e!=null&&e.uid)){console.error("No user ID found!"),alert("User not authenticated. Please log in again.");return}if(!y){console.error("No party ID provided!"),alert("Invalid party information.");return}console.log("Calling getCharacterByUserAndParty...");const k=await oR(e.uid,y);console.log("Character check result:",k),k?(console.log("User has character, navigating to campaign:",k.name),console.log("Navigation URL will be:",`/campaign/${y}`),t(`/campaign/${y}`)):(console.log("No character found, navigating to character creation"),console.log("Navigation URL will be:",`/character-creation/${y}`),t(`/character-creation/${y}`))}catch(k){console.error("Error in handleContinueCampaign:",k),console.error("Error details:",{message:k.message,stack:k.stack}),console.log("Error occurred, defaulting to character creation"),t(`/character-creation/${y}`)}},f=()=>{t("/test-environment")},g=async()=>{if(e)try{console.log("=== DEBUGGING CHARACTERS ===");const y=await lR(e.uid);console.log("Debug info:",y),alert(`Debug complete! Check console for details.
Total characters: ${y.totalCharacters}
Orphaned: ${y.orphanedCharacters}`)}catch(y){console.error("Debug error:",y),alert("Debug failed: "+y.message)}},x=()=>{if(r.length>0){const y=r[0];console.log("Testing direct navigation to character creation for party:",y.id),t(`/character-creation/${y.id}`)}else alert("No parties available for testing")},S=async()=>{if(e)try{console.log("=== CLEANING UP ORPHANED CHARACTERS ===");const y=await cR(e.uid);console.log("Cleanup result:",y),alert(`Cleanup complete! Deleted ${y.deleted} orphaned characters.`),window.location.reload()}catch(y){console.error("Cleanup error:",y),alert("Cleanup failed: "+y.message)}};return i?o.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto"}),o.jsx("p",{className:"mt-4 text-gray-300",children:"Loading..."})]})}):o.jsx("div",{className:"min-h-screen bg-gray-900",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"mb-6 sm:mb-8",children:[o.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-100",children:"Dashboard"}),o.jsxs("p",{className:"text-gray-300 mt-2 text-sm sm:text-base",children:["Welcome back, ",(e==null?void 0:e.displayName)||(e==null?void 0:e.email),"! Manage your campaigns and test the system."]})]}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Test Environment"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Test action validation, dice rolling, and combat detection in a controlled environment."}),o.jsx("button",{onClick:f,className:"w-full fantasy-button bg-green-600 hover:bg-green-700",children:"Open Test Environment"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Create New Campaign"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Start a new campaign with your party."}),o.jsx("button",{onClick:()=>t("/campaign-management"),className:"w-full fantasy-button bg-blue-600 hover:bg-blue-700",children:"Create Campaign"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Party Management"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Join existing parties or manage your party memberships."}),o.jsx("button",{onClick:()=>t("/party-management"),className:"w-full fantasy-button bg-purple-600 hover:bg-purple-700",children:"Manage Parties"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Debug Characters"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Debug character issues and check for orphaned characters."}),o.jsx("button",{onClick:g,className:"w-full fantasy-button bg-red-600 hover:bg-red-700",children:"Debug Characters"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Test Character Creation"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Test direct navigation to character creation (bypasses character check)."}),o.jsx("button",{onClick:x,className:"w-full fantasy-button bg-orange-600 hover:bg-orange-700",children:"Test Character Creation"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Cleanup Characters"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Remove orphaned characters that don't have a party ID."}),o.jsx("button",{onClick:S,className:"w-full fantasy-button bg-yellow-600 hover:bg-yellow-700",children:"Cleanup Characters"})]})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("div",{className:"border-b border-gray-700 pb-4 mb-4",children:o.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:"Your Campaigns"})}),r.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-gray-300 mb-4",children:"You haven't created any campaigns yet."}),o.jsx("button",{onClick:()=>t("/campaign-management"),className:"fantasy-button bg-blue-600 hover:bg-blue-700",children:"Create Your First Campaign"})]}):o.jsx("div",{className:"space-y-4",children:r.map(y=>{var k;return o.jsx("div",{className:"border border-gray-600 rounded-lg p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100",children:y.name}),o.jsx("p",{className:"text-gray-300 mt-1 text-sm",children:y.description}),o.jsxs("div",{className:"flex flex-wrap items-center mt-2 gap-2 text-xs sm:text-sm text-gray-400",children:[o.jsxs("span",{children:[((k=y.members)==null?void 0:k.length)||0," members"]}),o.jsx("span",{children:"•"}),o.jsxs("span",{children:["Theme: ",y.theme]}),o.jsx("span",{children:"•"}),o.jsxs("span",{children:["Created: ",new Date(y.createdAt).toLocaleDateString()]})]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[o.jsx("button",{onClick:()=>h(y.id),className:"fantasy-button bg-blue-600 hover:bg-blue-700 flex-1",children:"Continue"}),o.jsx("button",{onClick:()=>d(y.id),className:"fantasy-button bg-red-600 hover:bg-red-700 flex-1",children:"Delete"})]})]})},y.id)})})]})]})})}class up{constructor(){this.diceTypes={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20,d100:100},this.difficultyClasses={veryEasy:5,easy:10,medium:15,hard:20,veryHard:25,nearlyImpossible:30},this.actionTypes={attack:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:10,description:"Physical attack roll"},spell:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:12,description:"Spell casting check"},dodge:{primaryAbility:"dexterity",secondaryAbility:"wisdom",baseDC:15,description:"Dodge incoming attacks"},parry:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:18,description:"Parry with weapon"},backflip:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:20,description:"Perform a backflip"},somersault:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:18,description:"Perform a somersault"},cartwheel:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:16,description:"Perform a cartwheel"},wallRun:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:22,description:"Run up a wall"},jump:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:12,description:"Jump over obstacles"},climb:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:15,description:"Climb surfaces"},swim:{primaryAbility:"strength",secondaryAbility:"constitution",baseDC:14,description:"Swim through water"},fly:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:30,description:"Fly through the air"},persuade:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:15,description:"Persuade someone"},intimidate:{primaryAbility:"charisma",secondaryAbility:"strength",baseDC:16,description:"Intimidate someone"},deceive:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:18,description:"Deceive someone"},spot:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:12,description:"Spot hidden objects or creatures"},listen:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:10,description:"Listen for sounds"},search:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:14,description:"Search for hidden items"},pickLock:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:20,description:"Pick a lock"},disarmTrap:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:22,description:"Disarm a trap"},heal:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:16,description:"Provide medical aid"},craft:{primaryAbility:"intelligence",secondaryAbility:"dexterity",baseDC:18,description:"Craft an item"}},this.impossibleActionPatterns=[/\b(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,/\b(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,/\b(?:jump|leap)\s+(?:to|over|across)\s+(?:the\s+)?(?:moon|sky|clouds?)\b/gi,/\b(?:teleport|blink|phase)\s+(?:to|through)\b/gi,/\b(?:time\s+travel|rewind|fast\s+forward)\b/gi,/\b(?:summon|create)\s+(?:a\s+)?(?:dragon|god|demon)\b/gi,/\b(?:become|turn\s+into)\s+(?:invisible|invincible|immortal)\b/gi,/\b(?:kill|destroy|eliminate)\s+(?:the\s+)?(?:dm|dungeon\s+master|narrator)\b/gi,/\b(?:break|destroy)\s+(?:the\s+)?(?:fourth\s+wall|game|story)\b/gi,/\b(?:skip|ignore)\s+(?:the\s+)?(?:quest|mission|story)\b/gi,/\b(?:teleport|go)\s+(?:to\s+)?(?:the\s+)?(?:end|final\s+boss|treasure)\b/gi,/\b(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,/\b(?:open|unlock)\s+(?:the\s+)?(?:door|chest)\s+(?:without\s+)?(?:key|lockpick)\b/gi,/\b(?:find|locate)\s+(?:the\s+)?(?:hidden\s+)?(?:passage|door)\s+(?:without\s+)?(?:searching)\b/gi],this.circumstanceModifiers={"in darkness":-2,"in bright light":1,"in difficult terrain":-2,"on slippery surface":-3,"in water":-2,"in tight space":-1,"with cover":2,"with high ground":1,"with low ground":-1,"with proper tools":2,"with improvised tools":-1,"without tools":-3,"with magical item":1,"with masterwork item":2,"while injured":-2,"while exhausted":-3,"while hasted":2,"while blessed":1,"while cursed":-2,"while poisoned":-1,"under time pressure":-2,"with preparation":1,"with careful planning":2,"in a hurry":-2,"with authority":1,"with evidence":2,"with witnesses":-1,"in private":1,"in public":-1}}rollDie(e){return Math.floor(Math.random()*e)+1}rollDice(e,n){const r=[];for(let s=0;s<e;s++)r.push(this.rollDie(n));return r}rollWithAdvantage(){const e=this.rollDie(20),n=this.rollDie(20);return{result:Math.max(e,n),rolls:[e,n],advantage:!0}}rollWithDisadvantage(){const e=this.rollDie(20),n=this.rollDie(20);return{result:Math.min(e,n),rolls:[e,n],disadvantage:!0}}getAbilityModifier(e){return Math.floor((e-10)/2)}getProficiencyBonus(e){return Math.floor((e-1)/4)+2}performSkillCheck(e,n,r=[],s=null){const i=this.actionTypes[n];if(!i)throw new Error(`Unknown action type: ${n}`);let a=s||i.baseDC,c=0;r.forEach(w=>{this.circumstanceModifiers[w]&&(c+=this.circumstanceModifiers[w])});const u=this.getAbilityModifier(e[i.primaryAbility]||10),d=this.getAbilityModifier(e[i.secondaryAbility]||10),h=this.getProficiencyBonus(e.level||1),g=this.checkProficiency(e,n)?h:0,x=this.rollDie(20),S=x+u+g+c,y=S>=a,k=S-a;let b="failure";return y?k>=10?b="critical success":k>=5?b="great success":b="success":k<=-10?b="critical failure":k<=-5?b="great failure":b="failure",{actionType:n,roll:x,totalRoll:S,dc:a,primaryMod:u,secondaryMod:d,proficiencyMod:g,circumstanceBonus:c,isSuccess:y,degree:b,margin:k,circumstances:r,character:{name:e.name,level:e.level,[i.primaryAbility]:e[i.primaryAbility],[i.secondaryAbility]:e[i.secondaryAbility]}}}checkProficiency(e,n){const r=e.proficiencies||[],i={Fighter:["attack","dodge","parry"],Rogue:["dodge","pickLock","disarmTrap","spot","listen"],Wizard:["spell","search","craft"],Cleric:["heal","persuade","spot"],Ranger:["spot","listen","climb","swim"],Paladin:["attack","parry","persuade"],Monk:["attack","dodge","backflip","somersault","cartwheel"],Bard:["persuade","deceive","intimidate"],Druid:["heal","spot","listen"],Sorcerer:["spell","persuade"],Warlock:["spell","intimidate"],Barbarian:["attack","intimidate","jump","climb"]}[e.class]||[];return r.includes(n)||i.includes(n)}validateAction(e,n,r={}){const s=e.toLowerCase();for(const y of this.impossibleActionPatterns)if(y.test(s))return{possible:!1,reason:"This action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};let i=this.extractActionsFromDescription(s);if(i=i.filter(y=>y.type!==void 0),i.length===0)return{possible:!0,reason:"No valid action detected. Action appears to be narrative or unsupported.",suggestion:"Try a different action or rephrase your input.",actions:[],overallSuccess:!0,hasCriticalFailures:!1,criticalFailures:[]};const a=r.customContext;let c=[],u=[],d=[];a&&(a.environmentalFeatures&&(u=a.environmentalFeatures,c.push(`Environmental features: ${u.join(", ")}`)),a.npcs&&(d=a.npcs,c.push(`NPCs present: ${d.map(y=>y.name).join(", ")}`)),a.circumstances&&c.push(`Circumstances: ${a.circumstances.join(", ")}`));const h=i.map((y,k)=>{const b=Math.max(0,k*2),w=Array.isArray(y.circumstances)?[...y.circumstances]:[];b>0&&w.push(`while fatigued (action ${k+1} of ${i.length})`),u.forEach(j=>{w.includes(j)||w.push(j)}),a&&a.circumstances&&a.circumstances.forEach(j=>{w.includes(j)||w.push(j)});const I=this.performSkillCheck(n,y.type,w);return{action:y.type,description:y.description,check:I,difficulty:this.getDifficultyDescription(I.dc),position:y.position||k+1,totalInSequence:y.totalInSequence||i.length,quantity:y.quantity||1,keyword:y.keyword,isSequence:y.isSequence||!1,fatiguePenalty:b,contextModifiers:c.length>0?c:null}}),f=h.every(y=>y.check.isSuccess),g=h.filter(y=>y.check.degree==="critical failure"),x=h.filter(y=>!y.check.isSuccess);let S="";if(i.length===1)S=`Single action detected: ${h[0].description}`;else{const y=[...new Set(h.map(b=>b.action))];S=`Multiple actions detected: ${h.reduce((b,w)=>b+w.quantity,0)} total actions across ${y.length} different types`}return a&&(S+=` | Context: ${a.description.substring(0,50)}${a.description.length>50?"...":""}`),{possible:!0,actions:h,overallSuccess:f,hasCriticalFailures:g.length>0,criticalFailures:g,failures:x,totalActions:i.length,summary:S,contextInfo:a?{description:a.description,environmentalFeatures:u,npcs:d,circumstances:a.circumstances||[]}:null,suggestion:this.generateActionSuggestion(h,n)}}extractActionsFromDescription(e){var u,d;const n=[],r=e.toLowerCase(),s=[/\b(\d+)\s+(backflips?|somersaults?|cartwheels?|jumps?|leaps?|hops?)\b/gi,/\b(\d+)\s+(punches?|kicks?|strikes?|attacks?|swings?|slashes?)\b/gi,/\b(\d+)\s+(spells?|casts?|magic\s+spells?)\b/gi,/\b(\d+)\s+(dodges?|evades?|parries?|blocks?)\b/gi,/\b(\d+)\s+(climbs?|scales?|swims?)\b/gi,/\b(\d+)\s+(searches?|looks?|examines?)\b/gi,/\b(\d+)\s+(persuades?|intimidates?|deceives?)\b/gi];s.forEach(h=>{var g;let f;for(;(f=h.exec(r))!==null;){const x=parseInt(f[1]),S=f[2],y=this.mapKeywordToActionType(S);if(y)for(let k=0;k<x;k++){const b=this.extractCircumstances(e);n.push({type:y,description:((g=this.actionTypes[y])==null?void 0:g.description)||`${y} action`,circumstances:b,keyword:S,quantity:x,position:k+1,totalInSequence:x})}}}),Object.entries(this.actionTypes).forEach(([h,f])=>{this.getActionKeywords(h).forEach(x=>{if(!n.some(y=>y.type===h)&&r.includes(x)&&!s.some(k=>new RegExp(k.source.replace(/\\d\+/,"\\d+"),"gi").test(r))){const k=this.extractCircumstances(e);n.push({type:h,description:f.description,circumstances:k,keyword:x,quantity:1,position:1,totalInSequence:1})}})}),[/\b(backflip|somersault|cartwheel|jump|leap|hop)\s+(?:and\s+then\s+)?(punch|kick|strike|attack|swing|slash)\b/gi,/\b(punch|kick|strike|attack|swing|slash)\s+(?:and\s+then\s+)?(backflip|somersault|cartwheel|jump|leap|hop)\b/gi,/\b(dodge|evade|parry|block)\s+(?:and\s+then\s+)?(attack|strike|punch|kick)\b/gi,/\b(attack|strike|punch|kick)\s+(?:and\s+then\s+)?(dodge|evade|parry|block)\b/gi].forEach(h=>{var g,x;let f;for(;(f=h.exec(r))!==null;){const S=this.mapKeywordToActionType(f[1]),y=this.mapKeywordToActionType(f[2]);if(S&&y){const k=this.extractCircumstances(e);n.some(b=>b.type===S&&b.keyword===f[1])||n.push({type:S,description:((g=this.actionTypes[S])==null?void 0:g.description)||`${S} action`,circumstances:k,keyword:f[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),n.some(b=>b.type===y&&b.keyword===f[2])||n.push({type:y,description:((x=this.actionTypes[y])==null?void 0:x.description)||`${y} action`,circumstances:k,keyword:f[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}});const a=/\b(\w+)\s+and\s+(\w+)\b/gi;let c;for(;(c=a.exec(r))!==null;){const h=this.mapKeywordToActionType(c[1]),f=this.mapKeywordToActionType(c[2]);if(h&&f){const g=this.extractCircumstances(e);n.some(x=>x.type===h&&x.keyword===c[1])||n.push({type:h,description:((u=this.actionTypes[h])==null?void 0:u.description)||`${h} action`,circumstances:g,keyword:c[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),n.some(x=>x.type===f&&x.keyword===c[2])||n.push({type:f,description:((d=this.actionTypes[f])==null?void 0:d.description)||`${f} action`,circumstances:g,keyword:c[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}return n}mapKeywordToActionType(e){return{punch:"attack",punches:"attack",kick:"attack",kicks:"attack",strike:"attack",strikes:"attack",attack:"attack",attacks:"attack",swing:"attack",swings:"attack",slash:"attack",slashes:"attack",thrust:"attack",thrusts:"attack",backflip:"backflip",backflips:"backflip",somersault:"somersault",somersaults:"somersault",cartwheel:"cartwheel",cartwheels:"cartwheel",jump:"jump",jumps:"jump",leap:"jump",leaps:"jump",hop:"jump",hops:"jump",climb:"climb",climbs:"climb",scale:"climb",scales:"climb",swim:"swim",swims:"swim",dodge:"dodge",dodges:"dodge",evade:"dodge",evades:"dodge",parry:"parry",parries:"parry",block:"parry",blocks:"parry",spell:"spell",spells:"spell",cast:"spell",casts:"spell","magic spell":"spell","magic spells":"spell",persuade:"persuade",persuades:"persuade",intimidate:"intimidate",intimidates:"intimidate",deceive:"deceive",deceives:"deceive",search:"search",searches:"search",look:"search",looks:"search",examine:"search",examines:"search"}[e.toLowerCase()]}getActionKeywords(e){return{attack:["attack","strike","hit","swing","slash","thrust","punch","kick"],spell:["cast","spell","magic","enchant","charm"],dodge:["dodge","evade","avoid","sidestep"],parry:["parry","block","deflect"],backflip:["backflip","back flip"],somersault:["somersault","forward roll"],cartwheel:["cartwheel"],wallRun:["wall run","run up wall"],jump:["jump","leap","hop"],climb:["climb","scale"],swim:["swim"],fly:["fly","levitate","float"],persuade:["persuade","convince","talk into"],intimidate:["intimidate","threaten","scare"],deceive:["deceive","lie","trick"],spot:["spot","see","notice","observe"],listen:["listen","hear"],search:["search","look for","find"],pickLock:["pick lock","lockpick"],disarmTrap:["disarm","trap"],heal:["heal","cure","treat"],craft:["craft","make","create","build"]}[e]||[]}extractCircumstances(e){const n=[];return Object.keys(this.circumstanceModifiers).forEach(r=>{e.includes(r)&&n.push(r)}),n}getDifficultyDescription(e){return e<=5?"Very Easy":e<=10?"Easy":e<=15?"Medium":e<=20?"Hard":e<=25?"Very Hard":"Nearly Impossible"}generateActionSuggestion(e,n){const r=e.filter(i=>!i.check.isSuccess);return r.length===0?"All actions are within your capabilities. Proceed with confidence!":r.map(i=>{const a=i.action;return i.check.degree==="critical failure"?`The ${a} is extremely difficult for you. Consider an alternative approach or ask for help.`:`The ${a} is challenging. You might want to take your time or use better equipment.`}).join(" ")}performActionSequence(e,n,r={}){const s=[];let i=0;for(let u=0;u<n.length;u++){const d=n[u],h=Array.isArray(d.circumstances)?[...d.circumstances]:[];i>0?h.push("with momentum"):i<0&&h.push("while fatigued");const f=this.performSkillCheck(e,d.type,h);s.push({action:d.type,check:f,sequencePosition:u+1}),f.isSuccess?i+=1:i-=2}const a=s.every(u=>u.check.isSuccess),c=s.filter(u=>u.check.degree==="critical failure");return{actions:s,overallSuccess:a,hasCriticalFailures:c.length>0,criticalFailures:c,sequenceLength:n.length,finalModifier:i}}generateActionNarrative(e,n){const{actionType:r,check:s,degree:i}=e;this.actionTypes[r];const a={attack:{"critical success":`${n.name} executes a perfect ${r}, striking with incredible precision!`,"great success":`${n.name} performs an excellent ${r}, hitting the target solidly.`,success:`${n.name} successfully ${r}s the target.`,failure:`${n.name} attempts to ${r} but misses the mark.`,"great failure":`${n.name} completely fails to ${r}, leaving themselves open.`,"critical failure":`${n.name} botches the ${r} spectacularly, potentially harming themselves!`},backflip:{"critical success":`${n.name} performs a flawless backflip, landing gracefully with perfect form!`,"great success":`${n.name} executes a smooth backflip, impressing onlookers.`,success:`${n.name} manages to complete the backflip successfully.`,failure:`${n.name} attempts a backflip but loses balance and stumbles.`,"great failure":`${n.name} fails the backflip badly, landing awkwardly.`,"critical failure":`${n.name} completely fails the backflip, potentially injuring themselves!`},fly:{"critical success":`${n.name} somehow defies gravity and soars through the air with supernatural grace!`,"great success":`${n.name} manages to achieve brief flight through incredible effort!`,success:`${n.name} makes a valiant attempt at flight, achieving a brief hover.`,failure:`${n.name} tries to fly but only manages an awkward hop.`,"great failure":`${n.name} attempts flight but falls flat on their face.`,"critical failure":`${n.name} tries to fly and crashes spectacularly, looking quite foolish!`}},c=a[r]||a.attack;return c[i]||c.failure}performMultipleSkillChecks(e,n,r,s=[],i=null){var x,S,y,k;const a=[];let c=0;const u=1;for(let b=1;b<=r;b++){const w=c*u,I=[...s];c>0&&I.push(`while fatigued (attempt ${b})`);const j=this.performSkillCheck(e,n,I,i),$={...j,attemptNumber:b,fatigueLevel:c,fatiguePenalty:w,adjustedTotalRoll:j.totalRoll-w,adjustedMargin:j.totalRoll-w-j.dc,adjustedSuccess:j.totalRoll-w>=j.dc};a.push($),c++}const d=a.filter(b=>b.adjustedSuccess).length,h=a.filter(b=>b.adjustedSuccess&&b.adjustedMargin>=10).length,f=a.filter(b=>!b.adjustedSuccess&&b.adjustedMargin<=-10).length,g=d/r*100;return{actionType:n,numberOfAttempts:r,results:a,statistics:{successfulAttempts:d,criticalSuccesses:h,criticalFailures:f,successRate:g,averageRoll:a.reduce((b,w)=>b+w.roll,0)/r,averageTotalRoll:a.reduce((b,w)=>b+w.adjustedTotalRoll,0)/r,bestRoll:Math.max(...a.map(b=>b.adjustedTotalRoll)),worstRoll:Math.min(...a.map(b=>b.adjustedTotalRoll))},character:{name:e.name,level:e.level,[(x=this.actionTypes[n])==null?void 0:x.primaryAbility]:e[(S=this.actionTypes[n])==null?void 0:S.primaryAbility],[(y=this.actionTypes[n])==null?void 0:y.secondaryAbility]:e[(k=this.actionTypes[n])==null?void 0:k.secondaryAbility]}}}performMultipleDiceRolls(e,n,r="standard"){const s=[];for(let d=1;d<=e;d++){let h;switch(r){case"advantage":h=this.rollWithAdvantage();break;case"disadvantage":h=this.rollWithDisadvantage();break;default:h={result:this.rollDie(n),rolls:[this.rollDie(n)],advantage:!1,disadvantage:!1}}s.push({...h,rollNumber:d,sides:n})}const i=s.map(d=>d.result),a=i.reduce((d,h)=>d+h,0)/e,c=Math.max(...i),u=Math.min(...i);return{numberOfRolls:e,sides:n,rollType:r,results:s,statistics:{average:a,max:c,min:u,total:i.reduce((d,h)=>d+h,0),natural20s:i.filter(d=>d===20).length,natural1s:i.filter(d=>d===1).length}}}generateMultipleAttemptsNarrative(e,n){const{actionType:r,numberOfAttempts:s,statistics:i}=e,a=this.actionTypes[r];if(!a)return`${n.name} attempts ${r} ${s} times.`;const c=i.successRate,u=i.criticalSuccesses,d=i.criticalFailures;let h=`${n.name} attempts to ${a.description} ${s} times. `;return c>=80?h+=`They perform exceptionally well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:c>=60?h+=`They perform well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:c>=40?h+=`They have mixed results, succeeding ${i.successfulAttempts} out of ${s} attempts.`:c>=20?h+=`They struggle, only succeeding ${i.successfulAttempts} out of ${s} attempts.`:h+=`They perform poorly, only succeeding ${i.successfulAttempts} out of ${s} attempts.`,u>0&&(h+=` They achieve ${u} spectacular successes!`),d>0&&(h+=` They suffer ${d} embarrassing failures.`),s>10&&(h+=" The repeated attempts take their toll, and fatigue begins to set in."),h}}class dp{constructor(){this.diceService=new up,this.storyRules={redirectPatterns:[{pattern:/\b(?:i\s+)?(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,response:"While impressive acrobatics are possible, let's focus on actions that advance the story. What's your main goal here?",suggestion:"Try describing a more focused action that helps with the current situation."},{pattern:/\b(?:i\s+)?(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,response:"Flight isn't currently possible in this situation. What are you trying to achieve?",suggestion:"Consider climbing, jumping, or finding another way to reach your destination."},{pattern:/\b(?:i\s+)?(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,response:"The quest item isn't just lying around. You'll need to find it through exploration and investigation.",suggestion:"Try searching the area, asking NPCs, or following clues to locate the item."},{pattern:/\b(?:i\s+)?(?:attack|kill|destroy)\s+(?:everyone|all|each)\s+(?:enemy|person|creature)\b/gi,response:"While combat is possible, attacking everyone at once isn't practical. Let's focus on the immediate threat.",suggestion:"Choose a specific target or describe a more strategic approach."}],expandPatterns:[{pattern:/\b(?:i\s+)?(?:search|look|examine)\b/gi,response:"What specifically are you searching for or looking at?",suggestion:"Be more specific about what you're searching for or examining."},{pattern:/\b(?:i\s+)?(?:talk|speak|ask)\b/gi,response:"Who would you like to talk to, and what would you like to discuss?",suggestion:"Specify the person and topic of conversation."},{pattern:/\b(?:i\s+)?(?:go|move|walk)\b/gi,response:"Where would you like to go?",suggestion:"Specify your destination or direction."}],encouragePatterns:[{pattern:/\b(?:i\s+)?(?:investigate|explore|examine)\b/gi,response:"Great! Investigation and exploration are key to advancing the story.",suggestion:"What specific aspect would you like to investigate?"},{pattern:/\b(?:i\s+)?(?:help|assist|aid)\b/gi,response:"Helping others is always a noble choice. Who would you like to help?",suggestion:"Specify who needs help and how you can assist them."},{pattern:/\b(?:i\s+)?(?:negotiate|diplomacy|peace)\b/gi,response:"Diplomacy can often achieve more than violence. Good thinking!",suggestion:"How would you like to approach the negotiation?"}]},this.contextResponses={combat:{impossible:"That action isn't possible in combat. Focus on your available combat options.",difficult:"That's a challenging action in combat. Are you sure you want to attempt it?",strategic:"That's a good strategic choice. How do you want to execute it?"},exploration:{impossible:"That action doesn't make sense in this environment. What are you trying to achieve?",difficult:"That will be challenging given the current circumstances.",strategic:"That's a good approach to exploration. Let's see how it goes."},social:{impossible:"That action isn't appropriate in this social situation.",difficult:"That's a bold social move. Are you prepared for the consequences?",strategic:"That's a good approach to the situation. How do you want to proceed?"}}}validatePlayerAction(e,n,r={}){const s=e.toLowerCase(),i=this.checkImpossibleActions(s);if(!i.possible)return{valid:!1,type:"impossible",response:i.response,suggestion:i.suggestion,diceResult:null};const a=this.checkRedirectPatterns(s);if(a.needsRedirect)return{valid:!1,type:"redirect",response:a.response,suggestion:a.suggestion,diceResult:null};const c=this.checkExpandPatterns(s);if(c.needsExpansion)return{valid:!1,type:"expand",response:c.response,suggestion:c.suggestion,diceResult:null};const u=this.diceService.validateAction(e,n,r);return{valid:!0,type:"valid",response:this.generateValidationResponse(u,n,r),suggestion:u.suggestion,diceResult:u}}checkImpossibleActions(e){for(const n of this.diceService.impossibleActionPatterns)if(n.test(e))return{possible:!1,response:"That action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};return{possible:!0}}checkRedirectPatterns(e){for(const n of this.storyRules.redirectPatterns)if(n.pattern.test(e))return{needsRedirect:!0,response:n.response,suggestion:n.suggestion};return{needsRedirect:!1}}checkExpandPatterns(e){for(const n of this.storyRules.expandPatterns)if(n.pattern.test(e))return{needsExpansion:!0,response:n.response,suggestion:n.suggestion};return{needsExpansion:!1}}generateValidationResponse(e,n,r){if(!e.overallSuccess)return e.actions.filter(u=>!u.check.isSuccess).filter(u=>u.check.degree==="critical failure").length>0?`The actions you described are beyond your current capabilities. ${e.suggestion}`:`The actions you described are challenging but possible. ${e.suggestion}`;const s=this.generateAtmosphericResponse(e,n,r),i=this.extractEntities(s,r);return{story:s,entities:i}}generateAtmosphericResponse(e,n,r){const{actions:s,overallSuccess:i,hasCriticalFailures:a}=e,c=r==null?void 0:r.customContext;let u=this.getAtmosphericElements(c),d=this.calculateTensionLevel(s,a),h="";return s.length===1?h=this.generateSingleActionResponse(s[0],n,u,d):h=this.generateMultiActionResponse(s,n,u,d),c&&c.environmentalFeatures&&(h+=this.addEnvironmentalDetails(c.environmentalFeatures,d)),c&&c.npcs&&(h+=this.addNPCReactions(c.npcs,s,i)),h+=this.addStoryProgressionHook(s,d,c),h}getAtmosphericElements(e){const n={lighting:"dim",weather:"calm",mood:"neutral",tension:"low"};if(!e)return n;const r=e.description.toLowerCase();return(r.includes("dark")||r.includes("shadow"))&&(n.lighting="dark"),(r.includes("bright")||r.includes("sunlight"))&&(n.lighting="bright"),(r.includes("dim")||r.includes("flickering"))&&(n.lighting="dim"),(r.includes("storm")||r.includes("rain"))&&(n.weather="stormy"),(r.includes("fog")||r.includes("mist"))&&(n.weather="foggy"),r.includes("wind")&&(n.weather="windy"),(r.includes("tension")||r.includes("danger"))&&(n.mood="tense"),(r.includes("peaceful")||r.includes("calm"))&&(n.mood="peaceful"),(r.includes("eerie")||r.includes("creepy"))&&(n.mood="eerie"),n}calculateTensionLevel(e,n){let r="low";const s=e.filter(i=>["attack","spell","dodge","parry"].includes(i.action));return s.length>0&&(r="medium"),s.length>2&&(r="high"),n&&(r="critical"),r}generateSingleActionResponse(e,n,r,s){const{action:i,check:a,keyword:c}=e,u=a.isSuccess;a.degree;const d={attack:{success:{low:`${n.name} strikes true, the blow landing with satisfying impact.`,medium:`${n.name}'s weapon finds its mark, the strike ringing out in the ${r.lighting} light.`,high:`${n.name} delivers a devastating blow, the force of the attack echoing through the ${r.weather} air.`,critical:`${n.name} executes a perfect strike, the precision of the attack leaving no room for error.`},failure:{low:`${n.name} swings wide, the attack missing its intended target.`,medium:`${n.name}'s strike goes awry, the weapon clattering against stone or wood.`,high:`${n.name} completely misses, the failed attack leaving them momentarily vulnerable.`,critical:`${n.name} stumbles in their attack, the botched strike nearly causing them to fall.`}},backflip:{success:{low:`${n.name} executes a graceful backflip, landing softly on their feet.`,medium:`${n.name} performs an impressive backflip, the acrobatic feat drawing attention.`,high:`${n.name} completes a spectacular backflip, the display of agility leaving onlookers amazed.`,critical:`${n.name} achieves a flawless backflip, the perfect form and landing drawing gasps of admiration.`},failure:{low:`${n.name} attempts a backflip but loses balance, stumbling slightly.`,medium:`${n.name} fails the backflip, landing awkwardly and looking embarrassed.`,high:`${n.name} completely botches the backflip, falling hard to the ground.`,critical:`${n.name} crashes spectacularly during the backflip, potentially injuring themselves.`}},search:{success:{low:`${n.name} searches carefully, their trained eyes picking up subtle details.`,medium:`${n.name} conducts a thorough search, methodically examining every corner.`,high:`${n.name} performs an exhaustive search, their attention to detail revealing hidden secrets.`,critical:`${n.name} discovers something extraordinary, their keen observation uncovering a crucial clue.`},failure:{low:`${n.name} looks around but finds nothing of interest.`,medium:`${n.name} searches but misses several obvious details.`,high:`${n.name} fails to notice important clues, their search proving fruitless.`,critical:`${n.name} overlooks critical information, their poor search skills costing them dearly.`}},persuade:{success:{low:`${n.name} makes a reasonable argument, their words carrying some weight.`,medium:`${n.name} presents a compelling case, their charisma swaying the listener.`,high:`${n.name} delivers a masterful persuasion, their words impossible to ignore.`,critical:`${n.name} achieves the impossible, their silver tongue turning enemies into allies.`},failure:{low:`${n.name} tries to persuade but fails to make a convincing argument.`,medium:`${n.name}'s attempt at persuasion falls flat, their words lacking impact.`,high:`${n.name} completely fails to persuade, their poor communication skills evident.`,critical:`${n.name} not only fails to persuade but manages to offend the listener.`}}},h=d[i]||d.attack,f=u?"success":"failure",g=s==="critical"?"high":s;return h[f][g]}generateMultiActionResponse(e,n,r,s){const i=e.length,a=e.filter(u=>u.check.isSuccess).length,c=i-a;return a===i?`${n.name} executes a flawless sequence of actions, each movement flowing seamlessly into the next. The display of skill and coordination is impressive to behold.`:a>c?`${n.name} performs admirably, with most actions succeeding despite the challenging circumstances. A few missteps don't diminish the overall effectiveness.`:c>a?`${n.name} struggles with the complex sequence, many actions failing to achieve their intended results. The difficulty of the task proves overwhelming.`:`${n.name} has mixed results, with some actions succeeding while others fail. The outcome remains uncertain.`}addEnvironmentalDetails(e,n){if(e.length===0)return"";const r={dark:{low:" The darkness seems to swallow sound, making every movement feel more significant.",medium:" Shadows dance in the darkness, creating an atmosphere of uncertainty.",high:" The oppressive darkness makes every action feel more dangerous and urgent.",critical:" The pitch-black environment amplifies every sound, every movement potentially deadly."},stormy:{low:" Rain patters against surfaces, adding a rhythmic backdrop to the scene.",medium:" The storm intensifies, wind and rain making movement more challenging.",high:" The raging storm creates a chaotic environment where every action is a gamble.",critical:" The violent storm threatens to overwhelm all but the most determined efforts."},foggy:{low:" Mist swirls gently, obscuring distant details.",medium:" The fog thickens, reducing visibility and creating an eerie atmosphere.",high:" Dense fog makes navigation difficult and every shadow a potential threat.",critical:" The impenetrable fog isolates you completely, each step into the unknown."}};let s="";return e.forEach(i=>{r[i]&&(s+=r[i][n]||"")}),s}addNPCReactions(e,n,r){if(e.length===0)return"";const s=e.map(i=>i.name).join(" and ");return r?` ${s} watch with growing interest, clearly impressed by your actions.`:` ${s} exchange concerned glances, their confidence in your abilities wavering.`}addStoryProgressionHook(e,n,r){const s=e.some(c=>["attack","spell","dodge","parry"].includes(c.action)),i=e.some(c=>["search","climb","jump"].includes(c.action)),a=e.some(c=>["persuade","intimidate","deceive"].includes(c.action));return s&&n==="high"?" The tension in the air is palpable. Something is about to happen...":i?" Your investigation reveals new possibilities. What will you discover next?":a?" The social dynamics shift with your words. How will others respond?":" The situation continues to unfold. What will you do next?"}generateStoryResponse(e,n,r={}){const s=this.validatePlayerAction(e,n,r);if(!s.valid)return{response:s.response,suggestion:s.suggestion,shouldProceed:!1,diceResult:null};const i=[];return s.diceResult.actions&&s.diceResult.actions.forEach(a=>{const c=this.diceService.generateActionNarrative(a.check,n);i.push(c)}),{response:i.join(" "),suggestion:s.suggestion,shouldProceed:!0,diceResult:s.diceResult}}handleComplexAction(e,n,r={}){const s=this.diceService.extractActionsFromDescription(e.toLowerCase());if(s.length===0)return{response:"I understand your intent. Let's see how this plays out in the story.",shouldProceed:!0,type:"narrative"};if(s.length===1)return this.generateStoryResponse(e,n,r);const i=this.diceService.performActionSequence(n,s,r);return i.overallSuccess?{response:i.actions.map(c=>this.diceService.generateActionNarrative(c.check,n)).join(" "),shouldProceed:!0,type:"sequence",diceResult:i}:i.actions.filter(u=>!u.check.isSuccess).filter(u=>u.check.degree==="critical failure").length>0?{response:"The sequence of actions you described is too complex for your current abilities. Try breaking it down into simpler steps.",shouldProceed:!1,type:"sequence_failure",diceResult:i}:{response:"Some parts of your action sequence are challenging. You might want to simplify your approach.",shouldProceed:!1,type:"sequence_partial",diceResult:i}}provideAlternatives(e,n,r={}){const s=e.toLowerCase(),i=[];return(s.includes("backflip")||s.includes("somersault"))&&i.push({action:"dodge",description:"Try dodging or evading instead of acrobatics",difficulty:"easier"}),(s.includes("fly")||s.includes("levitate"))&&i.push({action:"climb",description:"Try climbing or finding another way up",difficulty:"realistic"}),s.includes("attack everyone")&&i.push({action:"focus",description:"Focus on one target at a time for better effectiveness",difficulty:"strategic"}),s.includes("grab quest item")&&i.push({action:"search",description:"Search the area thoroughly to find the item",difficulty:"appropriate"}),i}maintainStoryCoherence(e,n,r){const s={storyPhase:this.checkStoryPhase(e,n),establishedFacts:this.checkEstablishedFacts(e,n),plotAdvancement:this.checkPlotAdvancement(e,n),characterDevelopment:this.checkCharacterDevelopment(e,r)},i=Object.entries(s).filter(([a,c])=>!c.valid).map(([a,c])=>c.issue);return{coherent:i.length===0,issues:i,suggestions:this.generateCoherenceSuggestions(i,n)}}checkStoryPhase(e,n){const r=n.phase||"exploration",s=e.toLowerCase(),c=({introduction:["attack","kill","destroy"],exploration:["end quest","skip to boss"],combat:["negotiate peace","run away"],resolution:["start new quest","begin adventure"]}[r]||[]).some(u=>s.includes(u));return{valid:!c,issue:c?`This action doesn't fit the current story phase (${r})`:null}}checkEstablishedFacts(e,n){const r=n.establishedFacts||[],s=e.toLowerCase();for(const i of r)if(i.contradicts&&i.contradicts.some(a=>s.includes(a.toLowerCase())))return{valid:!1,issue:`This action contradicts established story facts: ${i.description}`};return{valid:!0}}checkPlotAdvancement(e,n){const r=n.plotPoints||[],s=e.toLowerCase(),i=r.find(a=>a.active);return i&&i.keywords&&!i.keywords.some(c=>s.includes(c.toLowerCase()))?{valid:!1,issue:"This action doesn't address the current plot point"}:{valid:!0}}checkCharacterDevelopment(e,n){const r=n.alignment||"Neutral",s=e.toLowerCase(),c=({"Lawful Good":["steal","deceive","harm innocent"],"Chaotic Evil":["help others","follow rules","show mercy"],"Neutral Good":["harm innocent","betray allies"],"Lawful Evil":["break laws","show mercy","help weak"],"Chaotic Good":["follow strict rules","harm innocent"],"True Neutral":["take extreme actions","show strong emotions"],"Lawful Neutral":["break laws","show mercy","act chaotically"],"Neutral Evil":["help others","follow laws","show mercy"],"Chaotic Neutral":["follow strict rules","show strong loyalty"]}[r]||[]).some(u=>s.includes(u));return{valid:!c,issue:c?`This action doesn't align with your character's alignment (${r})`:null}}generateCoherenceSuggestions(e,n){const r=[];return e.forEach(s=>{s.includes("story phase")?r.push("Consider actions that fit the current phase of the story."):s.includes("established facts")?r.push("Remember what has already been established in the story."):s.includes("plot point")?r.push("Focus on actions that advance the current plot."):s.includes("alignment")&&r.push("Consider actions that align with your character's moral compass.")}),r}extractEntities(e,n={}){const r={enemies:[],items:[],locations:[],statusEffects:[],questHooks:[],npcs:[]};return e.toLowerCase(),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:the\s+)?(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster|boss|mini-boss)/gi,/\b(goblin|orc|troll|dragon|bandit|skeleton|zombie|ghost|spirit|demon|devil|fiend|beast|creature|monster)\b/gi,/(?:mini-boss|boss)\s*[–-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/\[Combat\s+Trigger[^]]*[–-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\]/gi].forEach(h=>{let f;for(;(f=h.exec(e))!==null;){const g=f[1]||f[0];g&&!r.enemies.some(x=>x.name.toLowerCase()===g.toLowerCase())&&r.enemies.push({name:g,type:"enemy",subtype:this.determineEnemySubtype(g,e),status:this.determineEnemyStatus(g,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:of\s+[A-Z][a-z]+)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:sword|dagger|staff|wand|scroll|potion|ring|amulet|crown|robe|armor|shield)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cursed|forbidden|ancient|legendary)/gi].forEach(h=>{let f;for(;(f=h.exec(e))!==null;){const g=f[1]||f[0];g&&!r.items.some(x=>x.name.toLowerCase()===g.toLowerCase())&&r.items.push({name:g,type:"item",subtype:this.determineItemSubtype(g,e),status:this.determineItemStatus(g,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:shrine|temple|castle|tower|dungeon|cave|tunnel|chamber|room|hall|garden|forest|mountain|river|lake|ocean|tavern|inn)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cliffs|beach|island|valley|peak|summit|depths|heights)/gi].forEach(h=>{let f;for(;(f=h.exec(e))!==null;){const g=f[1]||f[0];g&&!r.locations.some(x=>x.name.toLowerCase()===g.toLowerCase())&&r.locations.push({name:g,type:"location",subtype:this.determineLocationSubtype(g,e),tags:this.determineLocationTags(g,e)})}}),[/(?:cursed|blessed|enchanted|poisoned|paralyzed|charmed|frightened|invisible|ethereal|ethereal|flying|levitating)/gi,/(?:in\s+darkness|in\s+bright\s+light|under\s+pressure|in\s+a\s+hurry|carefully|stealthily|aggressively|defensively)/gi].forEach(h=>{let f;for(;(f=h.exec(e))!==null;){const g=f[0];g&&!r.statusEffects.some(x=>x.name.toLowerCase()===g.toLowerCase())&&r.statusEffects.push({name:g,type:"status_effect",effect:this.determineStatusEffect(g,e)})}}),[/(?:break|destroy|find|retrieve|defeat|save|protect|escort|investigate|explore)\s+(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/(?:quest|mission|objective|goal|task|duty|responsibility)/gi].forEach(h=>{let f;for(;(f=h.exec(e))!==null;){const g=f[1]||f[0];g&&!r.questHooks.some(x=>x.name.toLowerCase()===g.toLowerCase())&&r.questHooks.push({name:g,type:"quest_hook",objective:this.determineQuestObjective(g,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:merchant|trader|noble|lord|lady|king|queen|prince|princess|mayor|priest|shaman|hunter|fisherman|farmer)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:quest\s+giver|guide|mentor|teacher|master)/gi].forEach(h=>{let f;for(;(f=h.exec(e))!==null;){const g=f[1]||f[0];g&&!r.npcs.some(x=>x.name.toLowerCase()===g.toLowerCase())&&r.npcs.push({name:g,type:"npc",role:this.determineNPCRole(g,e),disposition:"friendly"})}}),r}determineEnemySubtype(e,n){n.toLowerCase();const r=e.toLowerCase();return r.includes("boss")||r.includes("mini-boss")?"boss":r.includes("priest")||r.includes("cleric")?"priest":r.includes("wizard")||r.includes("mage")?"wizard":r.includes("dragon")?"dragon":r.includes("undead")||r.includes("skeleton")||r.includes("zombie")?"undead":r.includes("goblin")||r.includes("orc")||r.includes("troll")?"monster":"enemy"}determineEnemyStatus(e,n){const r=n.toLowerCase();return r.includes("snarls")||r.includes("aggressive")?"hostile":r.includes("defensive")||r.includes("cautious")?"defensive":r.includes("chanting")||r.includes("casting")?"casting":"active"}determineItemSubtype(e,n){const r=e.toLowerCase();return r.includes("sword")||r.includes("dagger")||r.includes("staff")?"weapon":r.includes("potion")||r.includes("scroll")?"consumable":r.includes("ring")||r.includes("amulet")||r.includes("crown")?"accessory":r.includes("armor")||r.includes("robe")||r.includes("shield")?"armor":"item"}determineItemStatus(e,n){const r=n.toLowerCase(),s=e.toLowerCase();return s.includes("cursed")||r.includes("cursed")?"cursed":s.includes("forbidden")||r.includes("forbidden")?"forbidden":s.includes("ancient")||r.includes("ancient")?"ancient":s.includes("legendary")||r.includes("legendary")?"legendary":r.includes("magical")||r.includes("enchanted")?"magical":"normal"}determineLocationSubtype(e,n){const r=e.toLowerCase();return r.includes("shrine")||r.includes("temple")?"religious":r.includes("castle")||r.includes("tower")?"fortification":r.includes("cave")||r.includes("tunnel")?"underground":r.includes("forest")||r.includes("garden")?"natural":r.includes("tavern")||r.includes("inn")?"settlement":"location"}determineLocationTags(e,n){const r=[],s=n.toLowerCase();return(s.includes("ancient")||s.includes("old"))&&r.push("ancient"),(s.includes("dangerous")||s.includes("hostile"))&&r.push("dangerous"),(s.includes("sacred")||s.includes("holy"))&&r.push("sacred"),(s.includes("cursed")||s.includes("evil"))&&r.push("cursed"),(s.includes("coastal")||s.includes("ocean"))&&r.push("coastal"),(s.includes("mountain")||s.includes("high"))&&r.push("mountainous"),r}determineStatusEffect(e,n){const r=e.toLowerCase();return r.includes("cursed")?"disables healing":r.includes("poisoned")?"damage over time":r.includes("paralyzed")?"prevents movement":r.includes("charmed")?"mind control":r.includes("invisible")?"stealth bonus":r.includes("flying")?"flight ability":"unknown effect"}determineQuestObjective(e,n){const r=e.toLowerCase();return r.includes("break")||r.includes("destroy")?"destruction":r.includes("find")||r.includes("retrieve")?"retrieval":r.includes("defeat")||r.includes("kill")?"combat":r.includes("save")||r.includes("protect")?"protection":r.includes("escort")?"escort":r.includes("investigate")||r.includes("explore")?"exploration":"objective"}determineNPCRole(e,n){const r=e.toLowerCase();return r.includes("merchant")||r.includes("trader")?"merchant":r.includes("noble")||r.includes("lord")||r.includes("lady")?"noble":r.includes("king")||r.includes("queen")?"royalty":r.includes("priest")||r.includes("shaman")?"religious":r.includes("quest giver")||r.includes("guide")?"quest_giver":"npc"}}const VR=new dp,zd=new up;function FR(){const t=Zn(),[e,n]=P.useState(""),[r,s]=P.useState(""),[i,a]=P.useState(null),[c,u]=P.useState(!1),[d,h]=P.useState(!1),[f,g]=P.useState(!1),[x,S]=P.useState(null),[y,k]=P.useState(null),[b,w]=P.useState(null),[I,j]=P.useState("Fighter"),$=[{name:"Drowned Priest Boss Fight",storyContext:"In a dark, misty swamp, a Drowned Priest emerges from the murky water, chanting dark spells. The air is thick with malevolence as undead minions rise from the depths. The water bubbles with dark energy, and the priest's glowing eyes pierce through the fog.",suggestedAction:"I charge forward and attack the Drowned Priest with my sword"},{name:"Forest Ambush",storyContext:"The party is traveling through a dense forest when suddenly, goblin archers emerge from the trees above. The forest floor is covered in fallen leaves that crunch underfoot, and the canopy blocks most of the sunlight. The goblins are well-hidden in the branches, their green skin blending with the foliage.",suggestedAction:"I take cover behind a large tree and cast a fireball at the goblin archers"},{name:"Tavern Brawl",storyContext:"A rowdy group of bandits has taken over the local tavern, threatening the patrons. The tavern is filled with overturned tables, broken chairs, and spilled ale. The bandit leader, a scarred warrior with a wicked grin, stands on the bar counter brandishing his sword.",suggestedAction:"I leap over a table and tackle the bandit leader to the ground"}],E={Fighter:{id:"test_fighter_1",name:"Test Fighter",level:5,class:"Fighter",strength:18,dexterity:14,constitution:16,intelligence:10,wisdom:10,charisma:12,hp:45,maxHp:45,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Longsword",damageBonus:2},armor:{name:"Chain Mail",defenseBonus:4},shield:{name:"Shield",defenseBonus:2}}},Wizard:{id:"test_wizard_1",name:"Test Wizard",level:5,class:"Wizard",strength:8,dexterity:14,constitution:12,intelligence:18,wisdom:12,charisma:10,hp:32,maxHp:32,ac:14,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["spell","attack","defend"],equipment:{weapon:{name:"Staff",damageBonus:0},armor:{name:"Robe",defenseBonus:2},focus:{name:"Arcane Focus",spellBonus:1}}},Rogue:{id:"test_rogue_1",name:"Test Rogue",level:5,class:"Rogue",strength:12,dexterity:18,constitution:14,intelligence:12,wisdom:10,charisma:14,hp:38,maxHp:38,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Daggers",damageBonus:1},armor:{name:"Leather Armor",defenseBonus:2},tools:{name:"Thieves Tools",utilityBonus:2}}},Cleric:{id:"test_cleric_1",name:"Test Cleric",level:5,class:"Cleric",strength:14,dexterity:10,constitution:16,intelligence:12,wisdom:18,charisma:12,hp:42,maxHp:42,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["spell","attack","defend"],equipment:{weapon:{name:"Mace",damageBonus:1},armor:{name:"Scale Mail",defenseBonus:3},holySymbol:{name:"Holy Symbol",spellBonus:1}}},Ranger:{id:"test_ranger_1",name:"Test Ranger",level:5,class:"Ranger",strength:14,dexterity:16,constitution:14,intelligence:12,wisdom:16,charisma:10,hp:40,maxHp:40,ac:15,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Longbow",damageBonus:1},armor:{name:"Studded Leather",defenseBonus:2},companion:{name:"Wolf Companion",utilityBonus:1}}},Paladin:{id:"test_paladin_1",name:"Test Paladin",level:5,class:"Paladin",strength:16,dexterity:10,constitution:16,intelligence:10,wisdom:12,charisma:16,hp:44,maxHp:44,ac:17,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","defend"],equipment:{weapon:{name:"Greatsword",damageBonus:2},armor:{name:"Plate Mail",defenseBonus:5},holySymbol:{name:"Holy Symbol",spellBonus:1}}}}[I],_=J=>{s(J.storyContext),n(J.suggestedAction)},C=async()=>{if(e.trim())try{const J={environmentalFeatures:T(r),npcs:Me(r),circumstances:Pe(r)},B=VR.validatePlayerAction(e,E,J);S(B);const X=A(e,r,B);if(X.shouldInitiate){const ce=D(X.enemyType,X.specificEnemyName);if(console.log("Combat detected, generated enemies:",ce),a({type:"combat",message:`⚔️ Combat Detected! ${X.reason==="action_triggered_combat"?"Your action has triggered combat with the enemies in the area.":"The situation has escalated to combat."}`,context:J,enemyType:X.enemyType,enemies:ce,storyContext:r}),B.valid&&B.diceResult){const je=(B.diceResult.actions||[]).filter(de=>de.type!==void 0);if(je.length>0){const de=zd.performActionSequence(E,je,J);k(de),h(!0)}}}else if(B.valid){if(B.diceResult){const je=(B.diceResult.actions||[]).filter(de=>de.type!==void 0);if(je.length>0){const de=zd.performActionSequence(E,je,J);k(de),h(!0)}else a({type:"invalid",message:"No valid actions detected. Try a different action or rephrase your input.",context:J})}else a({type:"simple",message:`The ${E.name} performs the action successfully.`,context:J});const ce=N(B,E,J);a(je=>({...je,message:ce}))}else{const ce=N(B,E,J);a({type:"invalid",message:ce,context:J})}u(!0)}catch(J){console.error("Error processing test message:",J),a({type:"error",message:"An error occurred while processing your action."})}},A=(J,B,X)=>{var lt,ct;const ce=["attack","fight","battle","combat","strike","slash","stab","shoot","cast spell","fire spell","magic"],je=["enemy","monster","goblin","orc","troll","dragon","bandit","skeleton","zombie","priest","boss","creature","beast","fiend","demon","devil","ghost","spirit","undead","abomination","horror","terror","nightmare","phantom","specter","wraith","lich","vampire","werewolf","shapeshifter","elemental","construct"],de=ce.some(Ee=>J.toLowerCase().includes(Ee)),le=B.toLowerCase(),Z=je.some(Ee=>le.includes(Ee))||le.includes("hostile")||le.includes("aggressive")||le.includes("snarls")||le.includes("chanting")||le.includes("combat trigger")||le.includes("mini-boss")||le.includes("boss")||/\b(?:the\s+)?(\w+)\s+(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster)\b/i.test(B)||le.includes("raises")&&le.includes("staff")||le.includes("emerges")&&le.includes("mist")||le.includes("glowing")&&le.includes("eyes"),Se=(ct=(lt=X==null?void 0:X.diceResult)==null?void 0:lt.actions)==null?void 0:ct.some(Ee=>["attack","spell","dodge","parry","cast"].includes(Ee.action));let ye="bandit",Fe=null;const W=B.match(/\b(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster|boss)\b/i);return W&&(Fe=W[1]),le.includes("drowned priest")&&(Fe="Drowned Priest",ye="priest"),le.includes("goblin")?ye="goblin":le.includes("orc")?ye="orc":le.includes("troll")?ye="troll":le.includes("dragon")?ye="dragon":le.includes("undead")||le.includes("skeleton")||le.includes("zombie")?ye="skeleton":le.includes("priest")||le.includes("cleric")||le.includes("paladin")?ye="priest":le.includes("wizard")||le.includes("mage")||le.includes("sorcerer")?ye="wizard":le.includes("dragon")||le.includes("wyrm")||le.includes("wyvern")?ye="dragon":(le.includes("boss")||le.includes("mini-boss"))&&(ye="boss"),Fe&&ye==="bandit"&&(ye="boss"),{shouldInitiate:de&&Z||Se&&Z,reason:de?"action_triggered_combat":"context_triggered_combat",enemyType:ye,specificEnemyName:Fe}},D=(J="bandit",B=null)=>{const X={goblin:{name:"Goblin",hp:12,ac:14,level:1,strength:8,dexterity:14,constitution:10,intelligence:10,wisdom:8,charisma:8},orc:{name:"Orc",hp:30,ac:16,level:3,strength:16,dexterity:12,constitution:16,intelligence:7,wisdom:11,charisma:10},troll:{name:"Troll",hp:84,ac:15,level:5,strength:18,dexterity:13,constitution:20,intelligence:7,wisdom:9,charisma:7},dragon:{name:"Dragon",hp:200,ac:19,level:10,strength:27,dexterity:14,constitution:25,intelligence:16,wisdom:13,charisma:15},bandit:{name:"Bandit",hp:16,ac:12,level:1,strength:12,dexterity:12,constitution:12,intelligence:10,wisdom:10,charisma:10},skeleton:{name:"Skeleton",hp:13,ac:13,level:1,strength:10,dexterity:14,constitution:15,intelligence:6,wisdom:8,charisma:5},zombie:{name:"Zombie",hp:22,ac:8,level:1,strength:13,dexterity:6,constitution:16,intelligence:3,wisdom:6,charisma:5},priest:{name:"Priest",hp:45,ac:16,level:5,strength:12,dexterity:10,constitution:14,intelligence:12,wisdom:16,charisma:14},wizard:{name:"Wizard",hp:40,ac:15,level:5,strength:9,dexterity:14,constitution:12,intelligence:16,wisdom:12,charisma:10},boss:{name:"Boss",hp:120,ac:18,level:8,strength:18,dexterity:16,constitution:18,intelligence:14,wisdom:16,charisma:16},undead:{name:"Undead",hp:15,ac:12,level:1,strength:12,dexterity:10,constitution:14,intelligence:6,wisdom:8,charisma:5}},ce=X[J]||X.bandit;let je=1,de=!1;B||J==="boss"?(de=!0,je=1):je=Math.min(3,4);const le=[];for(let Z=0;Z<je;Z++){let Se,ye=ce.hp,Fe=ce.ac,W=ce.level,lt=J;B?(Se=B,ye=Math.max(ce.hp*2,80),Fe=ce.ac+2,W=Math.max(ce.level+2,7),lt="boss"):de?(Se="Drowned Priest",ye=Math.max(ce.hp*2,80),Fe=ce.ac+2,W=Math.max(ce.level+2,7),lt="boss"):(Se=`${ce.name} ${Z+1}`,ye=ce.hp+Math.floor(Math.random()*10),Fe=ce.ac+Math.floor(Math.random()*3)),le.push({id:`enemy_${Z}`,name:Se,type:ce.name,class:lt,hp:ye,maxHp:ye,ac:Fe,level:W,strength:ce.strength,dexterity:ce.dexterity,constitution:ce.constitution,intelligence:ce.intelligence,wisdom:ce.wisdom,charisma:ce.charisma,initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","special","defend"]})}if(B==="Drowned Priest"||de&&J==="priest")for(let Se=0;Se<2;Se++){const ye=15+Math.floor(Math.random()*8);le.push({id:`enemy_minion_${Se}`,name:`Undead Minion ${Se+1}`,type:"Skeleton",class:"undead",hp:ye,maxHp:ye,ac:12+Math.floor(Math.random()*3),level:1,strength:12,dexterity:10,constitution:14,intelligence:6,wisdom:8,charisma:5,initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","defend"]})}return le},N=(J,B,X)=>{const{environmentalFeatures:ce,npcs:je,circumstances:de}=X,le=je.some(Se=>Se.role==="enemy")||ce.some(Se=>["dangerous","hostile","threatening","eerie","creepy"].includes(Se));let Z="";if(J.valid)if(J.diceResult){const Se=J.diceResult.actions||[],ye=Se.length;if(le){if(Z=`The ${B.name} ${Se.map(W=>W.action).join(" and ")} with determination. `,ce.length>0){const W=ce.filter(lt=>["dark","fog","mist","eerie","creepy","dangerous"].includes(lt));W.length>0&&(Z+=`The ${W.join(" and ")} ${W.length===1?"adds":"add"} to the tension. `)}const Fe=je.filter(W=>W.role==="enemy");if(Fe.length>0){const W=Fe.map(lt=>lt.name).join(", ");Z+=`${W} ${Fe.length===1?"reacts":"react"} with ${["hostility","anger","defiance","malice"].sort(()=>.5-Math.random())[0]}. `}ye>1&&(Z+="Multiple actions detected - this complex maneuver will require precise timing and coordination. "),Z+=`

The outcome hangs in the balance. Roll the dice to determine your fate.`}else{if(Z=`The ${B.name} prepares to ${Se.map(Fe=>Fe.action).join(" and ")}. `,ye>1&&(Z+="Multiple actions detected - this will require careful coordination and may incur fatigue penalties. "),ce.length>0&&(Z+=`The ${ce.join(" and ")} ${ce.length===1?"affects":"affect"} the situation. `),je.length>0){const Fe=je.map(W=>W.name).join(", ");Z+=`${Fe} ${je.length===1?"watches":"watch"} with interest. `}de.length>0&&(Z+=`The circumstances (${de.join(", ")}) ${de.length===1?"adds":"add"} complexity to the action. `),Z+=`

Roll the dice to determine the outcome of this challenging action.`}}else if(le){Z=`${B.name}'s action is straightforward but the situation remains tense. `;const Se=je.filter(ye=>ye.role==="enemy");if(Se.length>0){const ye=Se.map(Fe=>Fe.name).join(", ");Z+=`${ye} ${Se.length===1?"maintains":"maintain"} a defensive stance. `}Z+=`

The action proceeds, but danger still lurks nearby.`}else{if(Z=`${B.name}'s action is straightforward and doesn't require a skill check. `,ce.length>0&&(Z+=`The ${ce.join(" and ")} ${ce.length===1?"provides":"provide"} a suitable backdrop. `),je.length>0){const Se=je.map(ye=>ye.name).join(", ");Z+=`${Se} ${je.length===1?"responds":"respond"} appropriately to the action. `}Z+=`

The action proceeds smoothly.`}else le?(Z="The proposed action doesn't seem feasible in this dangerous situation. ",J.reason&&(Z+=`${J.reason} `),Z+=`

In combat, every action must be precise and deliberate. Consider a different approach.`):(Z="The proposed action doesn't seem feasible. ",J.reason&&(Z+=`${J.reason} `),Z+=`

Try a different approach or rephrase your action.`);return Z},T=J=>{if(!J)return[];const B=J.toLowerCase(),X=[];return(B.includes("dark")||B.includes("shadow"))&&X.push("darkness"),(B.includes("fog")||B.includes("mist"))&&X.push("fog"),(B.includes("forest")||B.includes("tree"))&&X.push("forest"),(B.includes("cave")||B.includes("cavern"))&&X.push("cave"),(B.includes("tavern")||B.includes("inn"))&&X.push("tavern"),(B.includes("castle")||B.includes("fortress"))&&X.push("castle"),(B.includes("dungeon")||B.includes("underground"))&&X.push("dungeon"),(B.includes("water")||B.includes("swamp"))&&X.push("water"),(B.includes("fire")||B.includes("flame"))&&X.push("fire"),(B.includes("ice")||B.includes("cold"))&&X.push("ice"),(B.includes("wind")||B.includes("storm"))&&X.push("wind"),(B.includes("eerie")||B.includes("creepy"))&&X.push("eerie"),(B.includes("dangerous")||B.includes("hostile"))&&X.push("dangerous"),X},Me=J=>{if(!J)return[];const B=[],X=J.toLowerCase();return X.includes("drowned priest")&&B.push({name:"Drowned Priest",role:"enemy",type:"boss"}),X.includes("goblin")&&B.push({name:"Goblin Archers",role:"enemy",type:"goblin"}),X.includes("bandit")&&B.push({name:"Bandit Leader",role:"enemy",type:"bandit"}),(X.includes("undead")||X.includes("skeleton")||X.includes("zombie"))&&B.push({name:"Undead Minions",role:"enemy",type:"undead"}),(X.includes("patron")||X.includes("customer"))&&B.push({name:"Tavern Patrons",role:"friendly",type:"civilian"}),(X.includes("party")||X.includes("companion"))&&B.push({name:"Party Members",role:"ally",type:"adventurer"}),B},Pe=J=>{if(!J)return[];const B=[],X=J.toLowerCase();return(X.includes("dark")||X.includes("night"))&&B.push("low visibility"),(X.includes("wet")||X.includes("slippery"))&&B.push("difficult footing"),(X.includes("crowded")||X.includes("tight"))&&B.push("confined space"),(X.includes("noisy")||X.includes("loud"))&&B.push("distracting environment"),(X.includes("hurry")||X.includes("rush"))&&B.push("time pressure"),(X.includes("stealth")||X.includes("sneak"))&&B.push("stealth required"),B},Re=()=>{u(!1)},Te=()=>{h(!1)},G=async()=>{var J,B;if((i==null?void 0:i.type)==="combat")console.log("Combat detected, preparing to navigate with data:",{partyMembers:[E],enemies:i.enemies,storyContext:i.storyContext,enemyCount:(J=i.enemies)==null?void 0:J.length}),t("/combat",{state:{isTestCombat:!0,partyMembers:[E],enemies:i.enemies,storyContext:i.storyContext}});else if(y&&y.actions&&y.actions.length>1){const X=zd.performMultipleSkillChecks(E,"attack",3,((B=i==null?void 0:i.context)==null?void 0:B.circumstances)||[]);w(X),g(!0)}h(!1)},ie=()=>{u(!1),h(!1),a(null)},pe=()=>{t("/dashboard")};return o.jsx("div",{className:"min-h-screen bg-gray-900",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"mb-6 sm:mb-8",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[o.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-100",children:"Test Environment"}),o.jsx("button",{onClick:pe,className:"fantasy-button bg-blue-600 hover:bg-blue-700",children:"Back to Dashboard"})]}),o.jsx("p",{className:"text-gray-300 mt-2 text-sm sm:text-base",children:"Test action validation, dice rolling, and combat detection in a controlled environment."})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8",children:[o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-class",className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Class"}),o.jsxs("select",{id:"character-class",value:I,onChange:J=>j(J.target.value),className:"fantasy-input",children:[o.jsx("option",{value:"Fighter",children:"⚔️ Fighter"}),o.jsx("option",{value:"Wizard",children:"🔮 Wizard"}),o.jsx("option",{value:"Rogue",children:"🗡️ Rogue"}),o.jsx("option",{value:"Cleric",children:"⛪ Cleric"}),o.jsx("option",{value:"Ranger",children:"🏹 Ranger"}),o.jsx("option",{value:"Paladin",children:"️ Paladin"})]}),o.jsxs("div",{className:"mt-3 p-3 bg-gray-700 border border-gray-600 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-gray-100 mb-2",children:E.name}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"HP:"})," ",o.jsxs("span",{className:"text-gray-300",children:[E.hp,"/",E.maxHp]})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"AC:"})," ",o.jsx("span",{className:"text-gray-300",children:E.ac})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"STR:"})," ",o.jsx("span",{className:"text-gray-300",children:E.strength})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"DEX:"})," ",o.jsx("span",{className:"text-gray-300",children:E.dexterity})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"CON:"})," ",o.jsx("span",{className:"text-gray-300",children:E.constitution})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"INT:"})," ",o.jsx("span",{className:"text-gray-300",children:E.intelligence})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"WIS:"})," ",o.jsx("span",{className:"text-gray-300",children:E.wisdom})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"CHA:"})," ",o.jsx("span",{className:"text-gray-300",children:E.charisma})]})]}),o.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:[o.jsx("strong",{children:"Equipment:"})," ",E.equipment.weapon.name,", ",E.equipment.armor.name]})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"test-scenarios",className:"block text-sm font-medium text-gray-200 mb-2",children:"Quick Test Scenarios"}),o.jsx("div",{id:"test-scenarios",className:"space-y-2",children:$.map((J,B)=>o.jsxs("button",{onClick:()=>_(J),className:"w-full p-3 text-left bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 transition-colors",children:[o.jsx("div",{className:"font-medium text-gray-100",children:J.name}),o.jsxs("div",{className:"text-sm text-gray-300 mt-1",children:[J.storyContext.substring(0,80),"..."]})]},B))})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"story-context",className:"block text-sm font-medium text-gray-200 mb-2",children:"Story Context"}),o.jsx("textarea",{id:"story-context",value:r,onChange:J=>s(J.target.value),placeholder:"Describe the environment, NPCs, and circumstances. For example: 'In a dark, misty swamp, a Drowned Priest emerges from the water, chanting dark spells. The air is thick with malevolence.'",className:"fantasy-input h-32 resize-none"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-action",className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Action"}),o.jsx("textarea",{id:"character-action",value:e,onChange:J=>n(J.target.value),placeholder:"Describe any action your character would take. The system will analyze it for skill checks, combat actions, or story interactions.",className:"fantasy-input h-24 resize-none"})]}),o.jsx("button",{onClick:C,disabled:!e.trim(),className:"w-full fantasy-button bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed",children:"Test Action"})]}),o.jsx("div",{className:"space-y-6",children:i&&o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[i.type==="combat"&&o.jsx("span",{className:"text-2xl mr-2",children:"⚔️"}),o.jsx("h3",{className:"text-lg font-semibold text-gray-100",children:i.type==="combat"?"Combat Detected":i.type==="story"?"Story Response":i.type==="invalid"?"Invalid Action":"Test Result"})]}),o.jsxs("div",{className:"prose max-w-none",children:[o.jsx("p",{className:"text-gray-300 mb-4",children:i.message}),i.type==="combat"&&o.jsxs("div",{className:"bg-red-900/20 border border-red-600 rounded-lg p-4",children:[o.jsx("h4",{className:"text-lg font-bold text-red-400",children:"Combat Initiated!"}),o.jsxs("p",{className:"text-red-300 mb-2",children:["Enemy Type: ",i.enemyType]}),o.jsx("div",{className:"space-y-2",children:i.enemies.map((J,B)=>o.jsxs("div",{className:"flex justify-between items-center bg-gray-700 p-2 rounded",children:[o.jsx("span",{className:"font-medium text-gray-100",children:J.name}),o.jsxs("span",{className:"text-sm text-gray-300",children:["HP: ",J.hp," | AC: ",J.ac," | Level: ",J.level]})]},B))}),o.jsx("button",{onClick:()=>t("/combat",{state:{isTestCombat:!0,partyMembers:[E],enemies:i.enemies,storyContext:i.storyContext}}),className:"mt-3 fantasy-button bg-red-600 hover:bg-red-700",children:"Enter Combat"})]}),i.context&&o.jsxs("div",{className:"mt-4 space-y-2",children:[o.jsx("h5",{className:"font-semibold text-gray-100",children:"Context Analysis:"}),i.context.environmentalFeatures.length>0&&o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"Environment:"})," ",i.context.environmentalFeatures.join(", ")]}),i.context.npcs.length>0&&o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"NPCs:"})," ",i.context.npcs.map(J=>`${J.name} (${J.role})`).join(", ")]})]})]})]})})]}),c&&x&&o.jsx(h_,{result:x,onClose:Re,onProceed:G,onRevise:ie}),d&&y&&o.jsx(m_,{result:y,onClose:Te,onProceed:G,onRevise:ie}),f&&b&&o.jsx(LR,{result:b,onClose:()=>g(!1)})]})})}class hp{constructor(){this.actionTypes={attack:{name:"Attack",cooldown:0,priority:"normal",description:"A basic physical attack",narrativeTemplate:"{character} {action} with {weapon}!"},spell:{name:"Cast Spell",cooldown:1,priority:"normal",description:"Cast a magical spell",narrativeTemplate:"{character} channels arcane energy into {spell}!"},special:{name:"Special Ability",cooldown:2,priority:"high",description:"Use a special class ability",narrativeTemplate:"{character} unleashes their {ability}!"},item:{name:"Use Item",cooldown:0,priority:"low",description:"Use an item or consumable",narrativeTemplate:"{character} uses {item}!"},defend:{name:"Defend",cooldown:0,priority:"high",description:"Take a defensive stance",narrativeTemplate:"{character} takes a defensive stance!"},environmental:{name:"Environmental Action",cooldown:1,priority:"normal",description:"Use the environment to your advantage",narrativeTemplate:"{character} uses the {environment} to their advantage!"},teamUp:{name:"Team Up",cooldown:3,priority:"high",description:"Coordinate with another party member",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}},this.statusEffects={poisoned:{name:"Poisoned",duration:3,effect:"lose 1 HP per turn",narrative:"is suffering from poison"},burned:{name:"Burned",duration:2,effect:"lose 2 HP per turn",narrative:"is burning with magical flames"},frozen:{name:"Frozen",duration:1,effect:"skip next turn",narrative:"is frozen solid"},paralyzed:{name:"Paralyzed",duration:2,effect:"50% chance to skip turn",narrative:"is paralyzed and can barely move"},confused:{name:"Confused",duration:2,effect:"may attack randomly",narrative:"is confused and disoriented"},blessed:{name:"Blessed",duration:3,effect:"+2 to attack rolls",narrative:"is blessed with divine favor"},hasted:{name:"Hasted",duration:2,effect:"extra action per turn",narrative:"is moving with supernatural speed"}},this.classAbilities={fighter:{name:"Second Wind",description:"Recover some HP",effect:"heal 1d6+2 HP",cooldown:3},wizard:{name:"Arcane Surge",description:"Enhance next spell",effect:"+2 to spell damage",cooldown:2},rogue:{name:"Sneak Attack",description:"Deal extra damage from stealth",effect:"+1d6 damage if target is unaware",cooldown:1},cleric:{name:"Divine Favor",description:"Bless an ally",effect:"target gets +1 to all rolls",cooldown:2}}}initializeCombat(e,n,r){return{combatants:[...e,...n].map(a=>({...a,initiative:this.calculateInitiative(a),statusEffects:[],cooldowns:{},lastAction:null,turnCount:0})).sort((a,c)=>c.initiative-a.initiative),currentTurn:0,round:1,combatState:"active",storyContext:r,environmentalFeatures:this.extractEnvironmentalFeatures(r),teamUpOpportunities:this.identifyTeamUpOpportunities(e),narrativeElements:this.extractNarrativeElements(r)}}calculateInitiative(e){var s,i,a;let n=Math.floor(Math.random()*20)+1;return n+={rogue:3,monk:2,ranger:1,fighter:0,cleric:0,wizard:-1,paladin:-1}[(s=e.class)==null?void 0:s.toLowerCase()]||0,(i=e.statusEffects)!=null&&i.includes("hasted")&&(n+=5),(a=e.statusEffects)!=null&&a.includes("paralyzed")&&(n-=3),n}extractEnvironmentalFeatures(e){const n=[],r={forest:["trees","cover","difficult terrain"],cave:["darkness","echoes","tight spaces"],tavern:["furniture","crowds","flammable materials"],castle:["stone walls","narrow corridors","defensive positions"],dungeon:["traps","darkness","confined spaces"],outdoors:["weather","open space","natural cover"]},s=e.toLowerCase();return Object.entries(r).forEach(([i,a])=>{s.includes(i)&&n.push(...a)}),n}identifyTeamUpOpportunities(e){const n=[];return[{classes:["fighter","rogue"],description:"Fighter distracts while Rogue sneaks in for a backstab"},{classes:["wizard","cleric"],description:"Wizard casts area spell while Cleric protects the party"},{classes:["fighter","cleric"],description:"Fighter tanks while Cleric provides healing support"},{classes:["rogue","wizard"],description:"Rogue scouts while Wizard provides magical backup"}].forEach(s=>{s.classes.every(a=>e.some(c=>{var u;return((u=c.class)==null?void 0:u.toLowerCase())===a}))&&n.push(s)}),n}extractNarrativeElements(e){return{mood:this.determineCombatMood(e),stakes:this.determineStakes(e),environmentalHazards:this.identifyHazards(e),npcInvolvement:this.extractNPCs(e)}}determineCombatMood(e){const n=e.toLowerCase();return n.includes("desperate")||n.includes("last stand")?"desperate":n.includes("training")||n.includes("practice")?"casual":n.includes("revenge")||n.includes("vengeance")?"vengeful":n.includes("defense")||n.includes("protect")?"defensive":"standard"}determineStakes(e){const n=e.toLowerCase();return n.includes("life")||n.includes("death")||n.includes("kill")?"life_or_death":n.includes("escape")||n.includes("flee")?"escape":n.includes("capture")||n.includes("arrest")?"capture":n.includes("treasure")||n.includes("loot")?"treasure":"standard"}identifyHazards(e){const n=[],r=e.toLowerCase();return(r.includes("fire")||r.includes("flame"))&&n.push("fire"),(r.includes("water")||r.includes("river")||r.includes("lake"))&&n.push("water"),(r.includes("height")||r.includes("cliff")||r.includes("fall"))&&n.push("height"),(r.includes("trap")||r.includes("pit"))&&n.push("traps"),n}extractNPCs(e){const n=[];return[/(\w+)\s+(?:the\s+)?(?:guard|merchant|wizard|knight|rogue|priest)/gi,/(?:named|called)\s+(\w+)/gi].forEach(s=>{[...e.matchAll(s)].forEach(a=>{n.push(a[1])})}),n}async executeAction(e,n,r,s,i={}){const a=e.combatants.find(x=>x.id===n),c=e.combatants.find(x=>x.id===s);if(!a||!c)throw new Error("Invalid combatant or target");if(a.cooldowns&&a.cooldowns[r]>0)return{success:!1,message:`${a.name} cannot use ${r} yet (cooldown: ${a.cooldowns[r]} turns)`};const u=this.generateActionNarrative(a,r,c,i),d=this.calculateActionResults(a,r,c,i);this.applyActionEffects(e,a,c,d),this.updateCooldowns(e,a,r);const h=this.checkStatusEffectApplication(a,r,c,d),f=(e.currentTurn+1)%e.combatants.length,g={...e,currentTurn:f};return f===0&&(g.round=g.round+1),{success:!0,narrative:u,results:d,statusEffects:h,environmentalImpact:this.calculateEnvironmentalImpact(e,r,d),targetId:s,updatedSession:g,damage:d.damage,healing:d.healing}}generateActionNarrative(e,n,r,s){let a=this.actionTypes[n].narrativeTemplate;a=a.replace("{character}",e.name),a=a.replace("{action}",this.getActionVerb(n,e.class)),a=a.replace("{weapon}",s.weapon||"their weapon"),a=a.replace("{spell}",s.spell||"a spell"),a=a.replace("{ability}",s.ability||"special ability"),a=a.replace("{item}",s.item||"an item"),a=a.replace("{environment}",s.environment||"surroundings"),a=a.replace("{ally}",s.ally||"ally"),s.specialAttack&&s.specialAttack!=="Standard Action"&&(a=`${e.name} uses ${s.specialAttack}! `+a),s.damageType&&s.damageType!=="physical"&&(a+=` The attack deals ${s.damageType} damage.`);const c=this.getClassFlavor(e.class,n);return c&&(a+=` ${c}`),a}getActionVerb(e,n){var s;return((s={fighter:{attack:"charges forward with a mighty swing",defend:"raises their shield defensively",special:"unleashes their combat expertise"},wizard:{attack:"casts a magical bolt",spell:"weaves arcane energy",special:"channels pure magical power"},rogue:{attack:"strikes from the shadows",defend:"dodges and weaves",special:"executes a perfect sneak attack"},cleric:{attack:"calls upon divine power",spell:"prays for divine intervention",special:"channels holy energy"}}[n==null?void 0:n.toLowerCase()])==null?void 0:s[e])||"performs an action"}getClassFlavor(e,n){var s;return((s={priest:{attack:"Divine energy crackles around their weapon.",spell:"Holy light emanates from their hands.",heal:"A warm, healing glow surrounds them."},wizard:{attack:"Arcane energy flows through their weapon.",spell:"Mystical runes appear in the air.",special:"Ancient magic surges through them."},warrior:{attack:"Their combat training shows in every move.",special:"Years of battle experience guide their strike.",defend:"They adopt a defensive stance with practiced ease."},rogue:{attack:"They move with deadly precision.",special:"Shadow and stealth enhance their attack.",defend:"They dodge and weave with acrobatic grace."},boss:{attack:"Their overwhelming presence fills the battlefield.",special:"Ancient power courses through their veins.",spell:"Reality itself seems to bend to their will."},undead:{attack:"Necrotic energy pulses from their form.",spell:"Death magic swirls around them.",special:"The very air grows cold with their presence."}}[e==null?void 0:e.toLowerCase()])==null?void 0:s[n])||""}calculateActionResults(e,n,r,s){const i={damage:0,healing:0,statusEffects:[],environmentalEffects:[],narrative:"",specialAttack:s.specialAttack||"Standard Action",damageType:s.damageType||"physical",attribute:s.attribute||"strength"};switch(n){case"attack":i.damage=this.calculateAttackDamage(e,r,s);break;case"spell":i.damage=this.calculateSpellDamage(e,r,s);break;case"special":i.damage=this.calculateSpecialDamage(e,r,s);break;case"item":i.healing=this.calculateItemEffect(e,r,s);break;case"defend":i.statusEffects.push({type:"defensive",duration:1});break;case"environmental":i.environmentalEffects=this.calculateEnvironmentalEffects(e,r,s);break;case"teamUp":i.damage=this.calculateTeamUpDamage(e,r,s);break}return i}calculateAttackDamage(e,n,r){const s=Math.floor(Math.random()*8)+1,i=Math.floor((e.strength-10)/2),a=r.weaponBonus||0;let c=1,u=0;if(e.id.startsWith("enemy_")){c=1+(e.level-1)*.3;const d=r.attribute||"strength";u=Math.floor((e[d]-10)/2);const h=this.calculateEnemyItemBonus(e);let f=0;r.specialAttack&&r.specialAttack!=="Standard Attack"&&(f=Math.floor(Math.random()*4)+2),r.isBossAttack&&(f+=5);let g=(s+i+a+u+h+f)*c;return Math.floor(Math.random()*20)+1===20&&(g*=2),console.log(`Enhanced enemy damage calculation for ${e.name}:`,{baseDamage:s,strengthMod:i,weaponBonus:a,attributeMod:u,itemBonus:h,specialBonus:f,levelScaling:c,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,totalDamage:Math.max(1,Math.floor(g))}),Math.max(1,Math.floor(g))}else{const d=Math.floor((e.dexterity-10)/2),h=Math.floor((e.level-1)*.5);let f=s+i+d+a+h;return Math.floor(Math.random()*20)+1===20&&(f*=2),Math.max(1,Math.floor(f))}}getEnemyPrimaryAttribute(e){return{Warrior:"strength",Archer:"dexterity",Mage:"intelligence",Cleric:"wisdom",Rogue:"dexterity",Paladin:"strength",Ranger:"dexterity",Wizard:"intelligence",Fighter:"strength"}[e]||"strength"}calculateEnemyItemBonus(e){let n=0;return e.equipment&&(e.equipment.weapon&&(n+=e.equipment.weapon.damageBonus||0),e.equipment.armor&&(n+=e.equipment.armor.defenseBonus||0),e.equipment.accessory&&(n+=e.equipment.accessory.bonus||0)),e.level>3&&(n+=Math.floor((e.level-3)/2)),n}calculateSpellDamage(e,n,r){const s=Math.floor(Math.random()*6)+1,i=Math.floor((e.intelligence-10)/2),a=r.spellLevel||1;if(e.id.startsWith("enemy_")){const c=1+(e.level-1)*.4,u=Math.floor((e.wisdom-10)/2),d=this.calculateEnemyItemBonus(e);let h=(s+i+u+a+d)*c;return Math.floor(Math.random()*20)+1>=19&&(h*=1.5),Math.max(1,Math.floor(h))}else return Math.max(1,s+i+a)}calculateSpecialDamage(e,n,r){var c;if(!this.classAbilities[(c=e.class)==null?void 0:c.toLowerCase()])return 0;const i=Math.floor(Math.random()*10)+2,a=Math.floor((e.level||1)/2);return Math.max(1,i+a)}calculateItemEffect(e,n,r){switch(r.itemType||"potion"){case"healing":return Math.floor(Math.random()*8)+2;case"antidote":return 0;case"blessing":return 0;default:return Math.floor(Math.random()*4)+1}}calculateTeamUpDamage(e,n,r){const s=Math.floor(Math.random()*12)+3;return Math.max(1,s+2)}applyActionEffects(e,n,r,s){s.damage>0&&(r.hp=Math.max(0,r.hp-s.damage)),s.healing>0&&(r.hp=Math.min(r.maxHp,r.hp+s.healing)),r.statusEffects||(r.statusEffects=[]),s.statusEffects.forEach(i=>{r.statusEffects.some(a=>a.type===i.type)||r.statusEffects.push({type:i.type,duration:i.duration,appliedBy:n.id})})}updateCooldowns(e,n,r){const s=this.actionTypes[r];n.cooldowns||(n.cooldowns={}),n.cooldowns[r]=s.cooldown,Object.keys(n.cooldowns).forEach(i=>{i!==r&&n.cooldowns[i]>0&&n.cooldowns[i]--})}checkStatusEffectApplication(e,n,r,s){const i=[];if(r.statusEffects||(r.statusEffects=[]),s.damage>10){const a=["stunned","bleeding"],c=a[Math.floor(Math.random()*a.length)];r.statusEffects.some(u=>u.type===c)||i.push({type:c,duration:1,appliedBy:e.id})}return i}calculateEnvironmentalImpact(e,n,r){const s=[];return n==="spell"&&r.damage>8&&s.push("The magical energy disturbs the environment"),n==="environmental"&&s.push("The environment responds to the action"),s}processStatusEffects(e,n){const r=[];return n.statusEffects&&n.statusEffects.forEach((s,i)=>{switch(s.duration--,s.type){case"poisoned":n.hp=Math.max(0,n.hp-1),r.push(`${n.name} takes 1 poison damage`);break;case"burned":n.hp=Math.max(0,n.hp-2),r.push(`${n.name} takes 2 burn damage`);break;case"frozen":r.push(`${n.name} is frozen and cannot act`);break;case"paralyzed":Math.random()<.5&&r.push(`${n.name} is paralyzed and cannot act`);break;case"blessed":r.push(`${n.name} is blessed with divine favor`);break;case"hasted":r.push(`${n.name} moves with supernatural speed`);break}s.duration<=0&&(n.statusEffects.splice(i,1),r.push(`${n.name} is no longer ${s.type}`))}),r}checkCombatEnd(e){const n=e.combatants.filter(a=>!a.id.startsWith("enemy_")),r=e.combatants.filter(a=>a.id.startsWith("enemy_")),s=n.some(a=>a.hp>0),i=r.some(a=>a.hp>0);return s?i?{ended:!1}:{ended:!0,result:"victory",narrative:"The enemies have been defeated!"}:{ended:!0,result:"defeat",narrative:"The party has been defeated..."}}generateCombatSummary(e,n){return{result:n,duration:e.round,participants:e.combatants.map(s=>({name:s.name,finalHp:s.hp,actions:s.turnCount,statusEffects:s.statusEffects.length})),narrative:this.generateCombatNarrative(e,n)}}generateCombatNarrative(e,n){const r=e.combatants.filter(s=>!s.id.startsWith("enemy_"));return e.combatants.filter(s=>s.id.startsWith("enemy_")),n==="victory"?`The party emerges victorious from the battle. ${r.map(s=>s.name).join(", ")} stand triumphant over their fallen foes.`:n==="defeat"?"The battle ends in defeat. The party has been overwhelmed by their enemies.":"The battle ends in a draw, with both sides withdrawing to regroup."}chooseEnemyAction(e,n){const r=this.getAvailableActions(e),s=this.getValidTargets(e,"attack",n);return console.log(`Enemy ${e.name} available actions:`,r),console.log(`Enemy ${e.name} valid targets:`,s.map(i=>i.name)),s.length===0?(console.log(`No valid targets for ${e.name}, defaulting to defend`),{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}):this.makeEnemyDecision(e,r,s,n)}getAvailableActions(e){var s;const n=[],r=e.cooldowns||{};return console.log("Getting enemy available actions for:",e.name,{cooldowns:r,class:e.class,hasClassAbility:!!this.classAbilities[(s=e.class)==null?void 0:s.toLowerCase()]}),Object.entries(this.actionTypes).forEach(([i,a])=>{(!r.hasOwnProperty(i)||r[i]<=0)&&n.push(i)}),e.class&&this.classAbilities[e.class.toLowerCase()]&&(!r.hasOwnProperty("special")||r.special<=0)&&n.push("special"),console.log("Available actions for enemy:",e.name,n),n}getValidTargets(e,n,r){const s=[],i=r.combatants.filter(a=>a.hp>0);if(i.length===0)return console.log("No alive combatants found"),[];switch(n){case"attack":case"spell":case"special":e.id.startsWith("enemy_")?s.push(...i.filter(a=>!a.id.startsWith("enemy_"))):s.push(...i.filter(a=>a.id.startsWith("enemy_")));break;case"heal":case"item":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_"))):s.push(...i.filter(a=>!a.id.startsWith("enemy_")));break;case"defend":case"environmental":s.push(e);break;case"teamUp":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_")&&a.id!==e.id)):s.push(...i.filter(a=>!a.id.startsWith("enemy_")&&a.id!==e.id));break;default:s.push(...i)}return console.log(`Valid targets for ${e.name} (${n}):`,s.map(a=>a.name)),s}makeEnemyDecision(e,n,r,s){var h;if(n.length===0)return console.log("No available actions for enemy, defaulting to defend"),{action:"defend",targetId:e.id,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"};if(r.length===0)return console.log("No valid targets for enemy, defaulting to defend"),{action:"defend",targetId:e.id,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"};const i=r[Math.floor(Math.random()*r.length)],a=e.hp/e.maxHp,c=(h=e.class)==null?void 0:h.toLowerCase();if(e.level,c==="priest"||c==="cleric"){if(a<.4&&n.includes("spell"))return{action:"spell",targetId:e.id,spellType:"healing",specialAttack:"Divine Healing",damageType:"healing",attribute:"wisdom"};if(n.includes("spell"))return{action:"spell",targetId:i.id,spellType:"divine",specialAttack:"Divine Smite",damageType:"radiant",attribute:"wisdom"}}if((c==="wizard"||c==="mage"||c==="sorcerer")&&n.includes("spell")){const f=["fireball","lightning","ice","arcane"],g=f[Math.floor(Math.random()*f.length)];return{action:"spell",targetId:i.id,spellType:g,specialAttack:`${g.charAt(0).toUpperCase()+g.slice(1)} Spell`,damageType:g==="fireball"?"fire":g==="lightning"?"lightning":g==="ice"?"cold":"arcane",attribute:"intelligence"}}if((c==="boss"||c==="dragon")&&n.includes("special"))return{action:"special",targetId:i.id,specialAttack:"Devastating Strike",damageType:"physical",attribute:"strength",isBossAttack:!0};if((c==="undead"||c==="skeleton"||c==="zombie")&&n.includes("spell"))return{action:"spell",targetId:i.id,spellType:"necrotic",specialAttack:"Death Touch",damageType:"necrotic",attribute:"constitution"};if(a<.3){if(n.includes("item"))return{action:"item",targetId:e.id,itemType:"healing",specialAttack:"Use Healing Potion",damageType:"healing",attribute:"constitution"};if(n.includes("defend"))return{action:"defend",targetId:e.id,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}}return s.combatants.filter(f=>f.id.startsWith("enemy_")&&f.hp/f.maxHp<.5).length>1&&n.includes("spell")?{action:"spell",targetId:i.id,spellType:"area",specialAttack:"Area Attack",damageType:"mixed",attribute:"intelligence"}:n.includes("attack")?{action:"attack",targetId:i.id,specialAttack:"Standard Attack",damageType:"physical",attribute:"strength"}:{action:n[Math.floor(Math.random()*n.length)],targetId:i.id,specialAttack:"Basic Action",damageType:"physical",attribute:"strength"}}async executeEnemyTurn(e,n){const r=this.chooseEnemyAction(n,e);return console.log("Enemy decision details:",{enemy:n.name,decision:r,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute}),r.targetId?await this.executeAction(e,n.id,r.action,r.targetId,{itemType:r.itemType,spellType:r.spellType,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,isBossAttack:r.isBossAttack}):await this.executeAction(e,n.id,"defend",n.id,{specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute})}}const fs=new hp,$R="https://dnd-v1-backend.onrender.com",pn=async(t,e="gpt-4",n=1e3,r=.8)=>{try{const s=t.filter(c=>!c||typeof c!="object"?(console.warn("Invalid message object:",c),!1):!c.role||!c.content?(console.warn("Message missing role or content:",c),!1):!0);if(s.length===0)throw new Error("No valid messages to send to API");const i=await fetch(`${$R}/api/openai`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:s,model:e,max_tokens:n,temperature:r})});if(!i.ok){let c="Backend API request failed";try{c=(await i.json()).error||c}catch{c=`${i.status}: ${i.statusText}`}throw i.status===500?c=`AI service error: ${c}. This might be due to missing API key, rate limiting, or network issues.`:i.status===404?c="AI service endpoint not found. Please check the backend configuration.":i.status===503&&(c="AI service temporarily unavailable. Please try again later."),new Error(c)}return await i.json()}catch(s){throw console.error("Backend API Error:",s),new Error(`Failed to communicate with backend: ${s.message}`)}};class UR{constructor(){this.systemPrompt=`You are an experienced Dungeon Master for Dungeons & Dragons 5th Edition. You excel at:
- Creating engaging storylines and plot hooks
- Developing detailed character descriptions and backstories
- Generating multiple story options when specifically requested
- Providing atmospheric descriptions and immersive storytelling
- Balancing combat encounters and managing game mechanics
- Creating memorable NPCs and villains
- Adapting to player choices and creating dynamic narratives
- Maintaining story consistency and character development
- Building upon established relationships and plot threads

IMPORTANT: Only generate multiple options when explicitly requested. When asked to generate a single story introduction, campaign goal, or other content, provide ONLY ONE response.

Always respond in character as a Dungeon Master, providing rich, descriptive content that enhances the gaming experience. Maintain consistency with previous story elements, character relationships, and established plot threads.`,this.diceService=new up,this.actionValidationService=new dp,this.combatService=new hp}async generateStoryPlots(e,n="",r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class} (${u.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 3 different story plot options for a D&D campaign.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

IMPORTANT: You MUST format your response EXACTLY as follows for each plot option:

**Plot Option 1:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

**Plot Option 2:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

**Plot Option 3:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

Guidelines for the plots:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

CRITICAL: Do not deviate from this exact format. Each plot must start with "**Plot Option X:**" and use the numbered format exactly as shown above.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1e3,.8)).choices[0].message.content}catch(s){throw new Error(`Failed to generate story plots: ${s.message}`)}}async generateCharacterDetails(e){try{const n=`As a Dungeon Master, I need you to expand on this character's details and create a rich, detailed description.

Character: ${e.name} - Level ${e.level} ${e.race} ${e.class}
Background: ${e.background}
Alignment: ${e.alignment}
Personality: ${e.personality||"Not specified"}
Ideals: ${e.ideals||"Not specified"}
Bonds: ${e.bonds||"Not specified"}
Flaws: ${e.flaws||"Not specified"}
Backstory: ${e.backstory||"Not specified"}

Please provide:
1. A detailed physical description (appearance, mannerisms, distinctive features)
2. An expanded personality profile with quirks and habits
3. A deeper backstory with key events and relationships
4. Character motivations and goals
5. Potential story hooks and plot threads related to this character
6. How this character might interact with the party and world

Make the character feel alive and three-dimensional, with details that could drive story development.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:n}],"gpt-4",800,.7)).choices[0].message.content}catch(n){throw console.error("Error generating character details:",n),new Error(`Failed to generate character details: ${n.message}`)}}async generateStorySummary(e,n){try{const r=n.map(a=>`${a.name} (${a.race} ${a.class})`).join(", "),s=`As a Dungeon Master, I need you to create a detailed story summary and outline for this campaign plot.

Plot: ${e}
Party: ${r}

Please provide:
1. A detailed campaign overview (3-4 paragraphs)
2. Key story beats and major events
3. Important NPCs and their roles
4. Potential challenges and obstacles
5. Story themes and motifs
6. How each party member might be personally invested
7. Potential branching paths and player choices
8. Climactic moments and resolution possibilities

Make this feel like a professional campaign module with rich storytelling potential.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:s}],"gpt-4",1200,.7)).choices[0].message.content}catch(r){throw console.error("Error generating story summary:",r),new Error(`Failed to generate story summary: ${r.message}`)}}async generateMultipleStoryPlots(e,n="",r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class} (${u.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 5 different story plot options for a D&D campaign, each with a detailed summary.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

For each of the 5 plot options, provide:
1. A compelling title
2. A detailed summary (3-4 paragraphs)
3. The main conflict or challenge
4. Key story beats and major events
5. Important NPCs and their roles
6. Potential story hooks for the party
7. Estimated campaign length (short, medium, or long)
8. Themes and motifs
9. How each party member might be personally invested

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options. Number each plot clearly (Plot 1, Plot 2, etc.).`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1500,.8)).choices[0].message.content}catch(s){throw console.error("Error generating multiple story plots:",s),new Error(`Failed to generate multiple story plots: ${s.message}`)}}async generateNPC(e,n=""){try{const r=`As a Dungeon Master, I need you to create a detailed NPC for this role and context.

NPC Role: ${e}
Context: ${n||"General campaign context"}

Please provide:
1. A detailed physical description
2. Personality traits and mannerisms
3. Background and motivations
4. Current situation and goals
5. How they might interact with the party
6. Potential story hooks or plot threads they could introduce
7. Their relationship to the world and other NPCs
8. Any secrets or hidden aspects of their character

Make this NPC feel like a real person with depth and complexity.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:r}],"gpt-4",800,.7)).choices[0].message.content}catch(r){throw console.error("Error generating NPC:",r),new Error(`Failed to generate NPC: ${r.message}`)}}async generateCombatEncounter(e,n,r="medium",s=""){try{const i=`As a Dungeon Master, I need you to create a detailed combat encounter.

Party Level: ${e}
Party Size: ${n}
Difficulty: ${r}
Theme: ${s||"General fantasy"}

Please provide:
1. A detailed description of the encounter location
2. Enemy types and their motivations
3. Tactical considerations and terrain features
4. Potential story elements or plot hooks
5. Non-combat resolution options
6. Consequences of victory or defeat
7. Environmental hazards or advantages
8. How this encounter fits into the larger story

Make this encounter feel meaningful and story-driven, not just a random fight.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:i}],"gpt-4",800,.7)).choices[0].message.content}catch(i){throw console.error("Error generating combat encounter:",i),new Error(`Failed to generate combat encounter: ${i.message}`)}}async generateStoryContinuation(e,n,r,s=null,i="individual",a=null){var c,u,d,h,f;try{const g=e.map($=>`${$.name} - Level ${$.level} ${$.race} ${$.class}`).join(", ");let x=null,S=null,y="";if(i==="individual"){const $=e[e.length-1];if($)if(x=this.actionValidationService.validatePlayerAction(r,$,{context:"story",storyState:s}),x.valid&&x.diceResult){if(S=x.diceResult,S.overallSuccess){if(y=`

ACTION VALIDATION: The action is within your character's capabilities.`,S.actions){const H=S.actions.map(E=>`${E.action}: ${E.check.isSuccess?"Success":"Failure"} (Roll: ${E.check.roll}, DC: ${E.check.dc})`).join(", ");y+=`
Dice Results: ${H}`}}else if(y=`

ACTION VALIDATION: Some aspects of this action are challenging for your character.`,S.actions){const E=S.actions.filter(_=>!_.check.isSuccess).map(_=>`${_.action}: Failure (Roll: ${_.check.roll}, DC: ${_.check.dc})`).join(", ");y+=`
Failed Actions: ${E}`}}else x.valid||(y=`

ACTION VALIDATION: ${x.response}`,x.suggestion&&(y+=`
Suggestion: ${x.suggestion}`))}const k=n.map($=>({role:$.role,content:$.content}));let b="";a&&(b=`
Party Theme: ${a.description||"No theme provided"}`);let w="";s&&(w=`
STORY STATE CONTEXT:
Current Location: ${((c=s.currentLocation)==null?void 0:c.name)||"Unknown"} - ${((u=s.currentLocation)==null?void 0:u.description)||""}
Active NPCs: ${Object.keys(s.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((d=s.activePlotThreads)==null?void 0:d.map($=>`${$.title} (${Math.round($.progress*100)}%)`).join(", "))||"None"}
Recent Events: ${((f=(h=s.worldState)==null?void 0:h.recentEvents)==null?void 0:f.slice(-3).map($=>$.event).join(", "))||"None"}

CHARACTER RELATIONSHIPS:
${e.map($=>{var _;const H=((_=s.characterArcs)==null?void 0:_[$.id])||{},E=Object.entries(H.relationships||{}).map(([C,A])=>`${C} (${A})`).join(", ");return`${$.name}: ${E||"No established relationships"}`}).join(`
`)}

NPC CONTEXT:
${Object.entries(s.activeNPCs||{}).map(([$,H])=>{var E;return`${$}: ${H.disposition} disposition, knowledge: ${((E=H.knowledge)==null?void 0:E.join(", "))||"none"}, goal: ${H.currentGoal||"unknown"}`}).join(`
`)}`);const I=`As a Dungeon Master, continue the story based on the player's response.

Party: ${g}${b}
Player Response: "${r}" (Type: ${i})
Response Type Context:
- individual: One character's personal action
- team: Group action or decision
- investigate: Looking for clues or information
- combat: Combat-related action
- social: Social interaction or diplomacy${w}

Previous Story Context:
${k.map($=>`${$.role==="assistant"?"DM":"Player"}: ${$.content}`).join(`
`)}

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

ACTION VALIDATION GUIDELINES:
- If the action validation shows the action is impossible, gently redirect the player while maintaining story flow
- If the action validation shows the action is challenging, incorporate the difficulty into the narrative
- If the action validation shows the action is successful, proceed with the action as described
- Always maintain story coherence and character consistency
- Use the validation results to inform how the action plays out in the story

Please provide a compelling continuation that:
1. Acknowledges the player's action in context of the current situation and location
2. References relevant NPCs and their established relationships with the party
3. Continues or advances active plot threads appropriately
4. Updates character relationships based on the action
5. Maintains location and atmosphere consistency
6. Ends with a clear situation that invites the next player to respond
7. Encourages character interaction and roleplay
8. Provides multiple possible directions for the party to explore
9. Builds upon the established story state and character development
10. Incorporates action validation results naturally into the narrative

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.${y}`;return{content:(await pn([{role:"system",content:this.systemPrompt},...k,{role:"user",content:I}],"gpt-4",800,.8)).choices[0].message.content,actionValidation:x,diceResult:S}}catch(g){throw console.error("Error generating story continuation:",g),new Error(`Failed to generate story continuation: ${g.message}`)}}async generatePlotOptions(e,n=null){try{const r=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class}. ${u.personality||""}. ${u.backstory||""}`).join(`
`);let s="";n&&(s=`
Party Theme: ${n.description||"No theme provided"}`);const i="You are a Dungeon Master for D&D 5e. You MUST generate exactly 3 plot options, no more, no less. Follow the exact format provided. Do not use party names in the plots. Keep summaries brief (1-2 sentences maximum). DO NOT repeat plots or generate duplicates.",a=`Generate exactly 3 distinct campaign plot options for this party. 

REQUIRED FORMAT - Follow this exact structure:

Plot 1: [Title]
[Brief summary - 1-2 sentences maximum]

Plot 2: [Title]  
[Brief summary - 1-2 sentences maximum]

Plot 3: [Title]
[Brief summary - 1-2 sentences maximum]

Party: ${r}${s}

CRITICAL REQUIREMENTS:
- Generate EXACTLY 3 plots, no more, no less
- Use the party theme to influence the plot lines and atmosphere
- Do NOT use the party name in the plots - focus on the characters and theme
- Each summary must be 1-2 sentences maximum
- Follow the exact format above with "Plot 1:", "Plot 2:", "Plot 3:" labels
- Do not add any additional text, explanations, or formatting
- Do not repeat or duplicate any plots
- Stop after Plot 3 - do not generate more plots

Make each plot distinct and appealing to different play styles.`;return(await pn([{role:"system",content:i},{role:"user",content:a}],"gpt-4",600,.8)).choices[0].message.content}catch(r){throw console.error("Error generating plot options:",r),new Error(`Failed to generate plot options: ${r.message}`)}}async generateStoryIntroduction(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}. ${d.personality||""}. ${d.backstory||""}`).join(`
`);let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const c=`As a Dungeon Master, create an engaging story introduction for the beginning of this campaign.

Party: ${i}${a}
Selected Plot: ${n}
Plot Number: ${r}

IMPORTANT: Generate ONLY ONE story introduction for the selected plot above. Do NOT generate introductions for multiple plots or options.

Create an introduction that includes:
1. A vivid description of the starting town/settlement where the party begins
2. How each character arrives or is already present in this location
3. The initial situation or hook that draws the party together
4. A sense of atmosphere and setting that matches the chosen plot
5. An opening scene that gives the party their first decision or action to take

Important Guidelines:
- Use the party theme to influence the atmosphere and context
- Incorporate themes and elements from the party theme to create atmosphere and context
- Consider how the party's background and composition might influence the starting situation
- Focus on the characters and their individual stories
- The story should feel cohesive with the established theme
- Generate ONLY ONE introduction for the selected plot

Make this feel like the opening of an epic adventure. Set the tone, establish the setting, and give the party a clear starting point. End with a situation that requires the party to make a choice or take action.

Keep the introduction engaging but concise (3-4 paragraphs maximum).`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:c}],"gpt-4",800,.8)).choices[0].message.content}catch(i){throw console.error("Error generating story introduction:",i),new Error(`Failed to generate story introduction: ${i.message}`)}}async generateStructuredStoryResponse(e,n,r,s,i,a=null,c=null){var u,d,h;try{const f=e.map(w=>`${w.name} - Level ${w.level} ${w.race} ${w.class}`).join(", "),g=n.filter(w=>w&&typeof w=="object"&&w.role&&w.content).map(w=>({role:w.role,content:w.content}));let x="";c&&(x=`
Party Theme: ${c.description||"No theme provided"}`);const S=i.length>0?`
Discovered Objectives: ${i.map(w=>w.title).join(", ")}`:"";let y="";a&&(y=`
STORY STATE CONTEXT:
Current Location: ${((u=a.currentLocation)==null?void 0:u.name)||"Unknown"} - ${((d=a.currentLocation)==null?void 0:d.description)||""}
Active NPCs: ${Object.keys(a.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((h=a.activePlotThreads)==null?void 0:h.map(w=>`${w.title} (${Math.round(w.progress*100)}%)`).join(", "))||"None"}
Character Relationships: ${Object.entries(a.characterArcs||{}).map(([w,I])=>{const j=e.find($=>$.id===w);return`${j==null?void 0:j.name}: ${Object.entries(I.relationships||{}).map(([$,H])=>`${$} (${H})`).join(", ")||"No relationships"}`}).join("; ")}`);const k=`As a Dungeon Master, continue the story based on the player's response, considering the current story phase and discovered objectives.

Party: ${f}${x}
Current Phase: ${s}
Player Response: "${r}"${S}${y}

Story Phases:
- Investigation: Focus on discovery, clues, and gathering information
- Conflict: Focus on tension, threats, and potential combat
- Resolution: Focus on choices, consequences, and story conclusion

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

ENEMY INFORMATION REQUIREMENTS (when in Conflict phase):
If the story involves combat or enemies, provide detailed enemy information in the following format:

**ENEMY_DETAILS:**
[For each enemy present, provide:]
Name: [Enemy name if humanoid, or descriptive name like "Alpha Wolf"]
Type: [Enemy type: humanoid, beast, undead, etc.]
Level: [Enemy level relative to party]
HP: [Hit points]
AC: [Armor class]
Basic Attack: [Description of basic attack and damage]
Special Ability: [Description of special ability or attack]
Stats: [Brief description of key stats like "Strong and aggressive" or "Quick and stealthy"]

IMPORTANT: You MUST format your response EXACTLY as follows:

**STORY_CONTENT:**
[Your main story continuation here - 2-3 paragraphs that acknowledge the player's action, continue the plot, and set up the next situation]

**CURRENT_LOCATION:**
[Updated location description or "No change" if location remains the same]

**ACTIVE_NPCS:**
[List of NPCs currently present or relevant to the scene, separated by commas]

**PLOT_DEVELOPMENTS:**
[Key plot developments or revelations from this response]

**CHARACTER_REACTIONS:**
[How NPCs react to the player's action, if applicable]

**NEXT_ACTIONS:**
[2-3 clear options or directions the party can take next]

**STORY_TONE:**
[The current mood/atmosphere: tense, mysterious, hopeful, dangerous, etc.]

**PHASE_STATUS:**
[Current story phase: investigation, conflict, or resolution]

**ENEMY_DETAILS:** (only include if enemies are present)
[Detailed enemy information as specified above]

Keep your response engaging but concise. Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.`;return(await pn([{role:"system",content:this.systemPrompt},...g,{role:"user",content:k}],"gpt-4",1e3,.8)).choices[0].message.content}catch(f){throw console.error("Error generating structured story response:",f),new Error(`Failed to generate structured story response: ${f.message}`)}}async generatePhaseTransition(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const c=`As a Dungeon Master, create a phase transition message for the story.

Party: ${i}${a}
Current Phase: ${n}
Story Progress: ${r}

Create a transition that:
1. Acknowledges the progress made so far
2. Signals the shift to the new phase
3. Sets up the new challenges and opportunities
4. Maintains the established tone and atmosphere
5. Gives the party clear direction for the next phase

Make this feel like a natural progression in the story.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:c}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating phase transition:",i),new Error(`Failed to generate phase transition: ${i.message}`)}}async generateObjectiveCompletion(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const c=`As a Dungeon Master, create a completion message for an objective.

Party: ${i}${a}
Completed Objective: ${n.title}
Story Context: ${r}

Create a completion message that:
1. Celebrates the achievement
2. Provides closure for this objective
3. Sets up the next challenge or objective
4. Maintains story momentum
5. Acknowledges the party's efforts

Make this feel rewarding and meaningful.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:c}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating objective completion:",i),new Error(`Failed to generate objective completion: ${i.message}`)}}async generateCampaignContinuation(e,n,r,s,i=null){try{const a=e.map(f=>`${f.name} - Level ${f.level} ${f.race} ${f.class}`).join(", "),c=r.filter(f=>f&&typeof f=="object"&&f.role&&f.content).map(f=>({role:f.role,content:f.content}));let u="";i&&(u=`
Party Theme: ${i.description||"No theme provided"}`);const d=`As a Dungeon Master, continue the ongoing campaign story.

Party: ${a}${u}
Campaign Goal: ${n.mainGoal||"No specific goal"}
Campaign Progress: ${n.campaignProgress||"Beginning"}
Player Response: "${s}"

Previous Story Context:
${c.map(f=>`${f.role==="assistant"?"DM":"Player"}: ${f.content}`).join(`
`)}

Continue the story while:
1. Building toward the main campaign goal
2. Maintaining consistency with previous events
3. Developing character relationships and arcs
4. Creating meaningful choices and consequences
5. Advancing the overall plot

Keep your response engaging but concise (2-3 paragraphs maximum).`;return(await pn([{role:"system",content:this.systemPrompt},...c,{role:"user",content:d}],"gpt-4",800,.8)).choices[0].message.content}catch(a){throw console.error("Error generating campaign continuation:",a),new Error(`Failed to generate campaign continuation: ${a.message}`)}}async generateCampaignGoal(e,n,r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class}`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, create a clear campaign goal based on the selected plot.

Party: ${s}${i}
Selected Plot: ${n}

IMPORTANT: Generate ONLY ONE campaign goal for the selected plot above. Do NOT generate multiple goals or options.

Create a campaign goal that:
1. Is clear and achievable
2. Provides direction for the entire campaign
3. Involves all party members
4. Has multiple possible paths to completion
5. Creates meaningful stakes and consequences
6. Is specific to the selected plot only

Make this goal compelling and motivating for the party. Generate ONLY ONE goal.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",600,.7)).choices[0].message.content}catch(s){throw console.error("Error generating campaign goal:",s),new Error(`Failed to generate campaign goal: ${s.message}`)}}async generateSessionSummary(e,n,r,s,i=null){try{const a=s.map(h=>`${h.name} - Level ${h.level} ${h.race} ${h.class}`).join(", ");let c="";i&&(c=`
Party Theme: ${i.description||"No theme provided"}`);const u=`As a Dungeon Master, create a session summary for this campaign session.

Party: ${a}${c}
Campaign Goal: ${e.mainGoal||"No specific goal"}
Objectives: ${r.map(h=>h.title).join(", ")}
Story Messages: ${n.length} total messages

Create a summary that:
1. Recaps the major events of the session
2. Highlights character development and relationships
3. Notes progress toward objectives
4. Sets up expectations for the next session
5. Maintains the established tone and atmosphere

Make this summary engaging and informative.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:u}],"gpt-4",800,.7)).choices[0].message.content}catch(a){throw console.error("Error generating session summary:",a),new Error(`Failed to generate session summary: ${a.message}`)}}}const ec=new UR;function BR(){const t=Zn(),[e,n]=P.useState(null),[r,s]=P.useState(!1),[i,a]=P.useState({name:"",description:"",theme:"Fantasy",maxPlayers:6,isPublic:!0});P.useEffect(()=>{const d=ja(h=>{if(!h){t("/login");return}n(h)});return()=>d()},[t]);const c=(d,h)=>{a(f=>({...f,[d]:h}))},u=async()=>{try{s(!0),await l_(e.uid,i),t("/party-management")}catch{}finally{s(!1)}};return!e||r?o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-stone-600",children:"Loading..."})})})}):o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:"Campaign Management"}),o.jsxs("div",{className:"text-sm text-stone-600",children:["Playing as: ",o.jsx("span",{className:"font-medium",children:e.displayName})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"campaign-name",className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Name"}),o.jsx("input",{id:"campaign-name",type:"text",value:i.name,onChange:d=>c("name",d.target.value),className:"fantasy-input",placeholder:"Enter campaign name..."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"campaign-description",className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Description"}),o.jsx("textarea",{id:"campaign-description",value:i.description,onChange:d=>c("description",d.target.value),className:"fantasy-input",rows:"4",placeholder:"Describe your campaign..."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"campaign-theme",className:"block text-sm font-medium text-stone-700 mb-2",children:"Theme"}),o.jsx("input",{id:"campaign-theme",type:"text",value:i.theme,onChange:d=>c("theme",d.target.value),className:"fantasy-input",placeholder:"Enter campaign theme..."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"max-players",className:"block text-sm font-medium text-stone-700 mb-2",children:"Maximum Players"}),o.jsx("input",{id:"max-players",type:"number",value:i.maxPlayers,onChange:d=>c("maxPlayers",Number(d.target.value)),className:"fantasy-input",placeholder:"Enter maximum number of players..."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"public-campaign",className:"block text-sm font-medium text-stone-700 mb-2",children:"Public Campaign"}),o.jsx("input",{id:"public-campaign",type:"checkbox",checked:i.isPublic,onChange:d=>c("isPublic",d.target.checked),className:"mr-2"})]}),o.jsx("div",{className:"text-center py-8",children:o.jsx("button",{onClick:u,className:"fantasy-button text-lg px-8 py-3",disabled:r,children:r?"Creating...":"Create Campaign"})})]})]})})}function zR(){var Rn,bt,mn;const t=Zn(),{partyId:e}=uf(),[n,r]=P.useState(null),[s,i]=P.useState(!1),[a,c]=P.useState(""),[u,d]=P.useState("");P.useState(!1);const[h,f]=P.useState(null),[g,x]=P.useState([]),[S,y]=P.useState(!1),[k,b]=P.useState(""),[w,I]=P.useState(!1),[j,$]=P.useState({name:"",race:"",class:"",level:1,background:"",alignment:"",strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10,age:"",height:"",weight:"",eyes:"",skin:"",hair:"",personality:"",ideals:"",bonds:"",flaws:"",backstory:"",equipment:[],spells:[],proficiencies:[],portrait:"/placeholder-character.png"}),[H,E]=P.useState("standard"),[_,C]=P.useState([]),[A,D]=P.useState([]),[N,T]=P.useState({}),[Me,Pe]=P.useState(!1),[Re,Te]=P.useState({}),[G,ie]=P.useState([]);P.useEffect(()=>{const L=ja(U=>{if(!U){t("/login");return}r(U),e&&pe(U.uid,e).catch(ge=>{}),X(U.uid).catch(ge=>{})});return()=>L()},[t,e]),P.useEffect(()=>{h&&($({name:h.name||"",race:h.race||"",class:h.class||"",level:h.level||1,background:h.background||"",alignment:h.alignment||"",strength:h.strength||10,dexterity:h.dexterity||10,constitution:h.constitution||10,intelligence:h.intelligence||10,wisdom:h.wisdom||10,charisma:h.charisma||10,age:h.age||"",height:h.height||"",weight:h.weight||"",eyes:h.eyes||"",skin:h.skin||"",hair:h.hair||"",personality:h.personality||"",ideals:h.ideals||"",bonds:h.bonds||"",flaws:h.flaws||"",backstory:h.backstory||"",equipment:h.equipment||[],spells:h.spells||[],proficiencies:h.proficiencies||[],portrait:h.portrait||"/placeholder-character.png"}),h.weaponChoices&&Te(h.weaponChoices),h.spellChoices&&ie(h.spellChoices),h.abilityScoreMethod&&E(h.abilityScoreMethod),h.rolledScores&&(C(h.rolledScores),T(h.assignedScores||{}),Pe(h.rolledScores.length>0)))},[h]),P.useEffect(()=>{n&&e&&(async()=>{try{(await Ec(n.uid)).filter(Ne=>Ne.partyId===e).length>1&&(await B(),await pe(n.uid,e))}catch{}})()},[n,e]);const pe=async(L,U)=>{try{const Ne=(await Ec(L)).filter(Ut=>Ut.partyId===U);if(Ne.length===0){f(null);return}if(Ne.length===1){f(Ne[0]);return}const $t=Ne.sort((Ut,ut)=>{var Ze,pr,er,Wn;const Ir=((pr=(Ze=Ut.updatedAt)==null?void 0:Ze.toDate)==null?void 0:pr.call(Ze))||Ut.updatedAt||new Date(0);return(((Wn=(er=ut.updatedAt)==null?void 0:er.toDate)==null?void 0:Wn.call(er))||ut.updatedAt||new Date(0))-Ir})[0];f($t),await J(Ne,$t.id)}catch{}},J=async(L,U)=>{try{const ge=L.filter(Ne=>Ne.id!==U).map(Ne=>um(Ne.id));await Promise.all(ge)}catch{}},B=async()=>{try{const U=(await Ec(n.uid)).filter(ge=>ge.partyId===e);if(U.length>0){const ge=U.map(async Ne=>{try{return await um(Ne.id),{success:!0,id:Ne.id}}catch($t){return{success:!1,id:Ne.id,error:$t}}});await Promise.all(ge),await new Promise(Ne=>setTimeout(Ne,1e3))}}catch{}},X=async L=>{try{const U=await wR(L);x(U)}catch{}},ce=["Human","Elf","Dwarf","Halfling","Dragonborn","Tiefling","Half-Elf","Half-Orc","Gnome","Aarakocra","Genasi","Goliath"],je=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"],de=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],le=["Acolyte","Criminal","Folk Hero","Noble","Sage","Soldier"],Z=[15,14,13,12,10,8],Se={Fighter:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Paladin:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Barbarian:{"Martial Melee Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"]},Bard:{Weapon:["Rapier","Longsword"]},Druid:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Monk:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Sorcerer:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Warlock:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]}},ye={Wizard:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Sorcerer:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Warlock:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Eldritch Blast",description:"A beam of crackling energy that deals force damage and can hit multiple targets."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Cleric:[{name:"Guidance",description:"Touch a creature to give them +1d4 to their next ability check."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Resistance",description:"Touch a creature to give them +1d4 to their next saving throw."},{name:"Sacred Flame",description:"Flame-like radiance descends on a creature within 60 feet, dealing radiant damage."},{name:"Spare the Dying",description:"Touch a dying creature to stabilize them at 0 hit points."},{name:"Thaumaturgy",description:"Perform minor magical tricks - make your voice boom, cause tremors, or change eye color."}],Druid:[{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Druidcraft",description:"Predict weather, make a flower bloom, or create a harmless sensory effect."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Primal Savagery",description:"Transform your hand into a claw that deals acid damage to a creature you touch."},{name:"Produce Flame",description:"Create a flickering flame in your hand that you can throw for fire damage."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shillelagh",description:"Transform a club or quarterstaff into a magical weapon that uses your spellcasting ability."},{name:"Thorn Whip",description:"Create a vine-like whip that pulls a creature toward you and deals piercing damage."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."}],Bard:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."},{name:"Vicious Mockery",description:"Insult a creature within 60 feet, dealing psychic damage and possibly giving disadvantage."}]},Fe={Wizard:{cantrips:3,spells:6},Sorcerer:{cantrips:4,spells:2},Warlock:{cantrips:2,spells:2},Cleric:{cantrips:3,spells:2},Druid:{cantrips:2,spells:2},Bard:{cantrips:2,spells:4}},W=L=>{const ge=[...{Fighter:["Chain mail armor","Light crossbow and 20 bolts","Dungeoneer's pack","5 gp"],Wizard:["Arcane focus","Scholar's pack","Component pouch","5 gp"],Cleric:["Chain mail armor","Light crossbow and 20 bolts","Priest's pack","Shield","Holy symbol","5 gp"],Rogue:["Leather armor","Shortbow and 20 arrows","Burglar's pack","Thieves' tools","5 gp"],Ranger:["Scale mail armor","Longbow and 20 arrows","Explorer's pack","5 gp"],Paladin:["Chain mail armor","Javelins (5)","Priest's pack","Holy symbol","5 gp"],Barbarian:["Javelins (4)","Explorer's pack","5 gp"],Bard:["Leather armor","Diplomat's pack OR entertainer's pack","Lute OR any other musical instrument","5 gp"],Druid:["Leather armor","Druidic focus","Explorer's pack","Shield","5 gp"],Monk:["Dungeoneer's pack OR explorer's pack","5 gp"],Sorcerer:["Component pouch OR arcane focus","Dungeoneer's pack","5 gp"],Warlock:["Component pouch OR arcane focus","Scholar's pack","5 gp"]}[L]||["Adventurer's pack","Simple weapon","5 gp"]];return Re.weapon&&ge.push(Re.weapon),Re.shield&&ge.push(Re.shield),G.length>0&&ge.push(`Spells: ${G.join(", ")}`),ge},lt=()=>{const L=[];for(let U=0;U<4;U++)L.push(Math.floor(Math.random()*6)+1);return L.sort((U,ge)=>ge-U),L.slice(0,3).reduce((U,ge)=>U+ge,0)},ct=()=>{const L=[];for(let U=0;U<6;U++)L.push(lt());return L.sort((U,ge)=>ge-U),C(L),D([...L]),T({}),Pe(!0),L},Ee=(L,U)=>{const ge=A.filter(Ne=>Ne!==L);D(ge),T(Ne=>({...Ne,[U]:L})),Je(U,L)},Yt=L=>{const U=N[L];if(U){D(Ne=>[...Ne,U].sort(($t,Ut)=>Ut-$t));const ge={...N};delete ge[L],T(ge),Je(L,10)}},fr=()=>{const L=["strength","dexterity","constitution","intelligence","wisdom","charisma"],U={...j};Z.forEach((ge,Ne)=>{U[L[Ne]]=ge}),$(U),T({}),D([]),Pe(!1)},Je=(L,U)=>{$(ge=>({...ge,[L]:U||""}))},wt=async L=>{L.preventDefault(),i(!0),c("");try{const U={name:j.name,race:j.race,class:j.class,level:j.level,userId:n.uid,partyId:e,weaponChoices:Re,spellChoices:G,abilityScoreMethod:H,rolledScores:_,assignedScores:N,createdAt:new Date,updatedAt:new Date};await B();const ge=await aR(n.uid,e,U);$(ge),d("Character saved successfully!"),setTimeout(()=>{t(`/campaign/${e}`)},1e3)}catch{c("Failed to save character")}finally{i(!1)}},Ge=async()=>{if(!k.trim()){alert("Please enter a name for your preset");return}if(!j.name||!j.race||!j.class){alert("Please fill in at least the basic character information (name, race, class) before saving as preset");return}try{const L={name:k,data:{...j,weaponChoices:Re,spellChoices:G,abilityScoreMethod:H,rolledScores:_,assignedScores:N}},U=await xR(n.uid,L);b(""),y(!1),await X(n.uid),alert("Character preset saved successfully!")}catch(L){L.message.includes("User profile not found")?alert("User profile not found. Please try logging out and back in."):L.message.includes("permission")?alert("Permission denied. Please check your account status."):alert(`Failed to save preset: ${L.message}`)}},Jt=L=>{L.key==="Enter"&&k.trim()&&Ge()},is=L=>{const U=L.data;$({name:(U.name||"")+" (Copy)",race:U.race||"",class:U.class||"",level:U.level||1,background:U.background||"",alignment:U.alignment||"",strength:U.strength||10,dexterity:U.dexterity||10,constitution:U.constitution||10,intelligence:U.intelligence||10,wisdom:U.wisdom||10,charisma:U.charisma||10,age:U.age||"",height:U.height||"",weight:U.weight||"",eyes:U.eyes||"",skin:U.skin||"",hair:U.hair||"",personality:U.personality||"",ideals:U.ideals||"",bonds:U.bonds||"",flaws:U.flaws||"",backstory:U.backstory||"",equipment:[],spells:U.spells||[],proficiencies:U.proficiencies||[],portrait:U.portrait||"/placeholder-character.png"}),U.weaponChoices&&Te(U.weaponChoices),U.spellChoices&&ie(U.spellChoices),U.abilityScoreMethod&&E(U.abilityScoreMethod),U.rolledScores&&(C(U.rolledScores),T(U.assignedScores||{}),Pe(U.rolledScores.length>0)),I(!1)},ht=async L=>{if(confirm("Are you sure you want to delete this preset? This action cannot be undone."))try{await bR(n.uid,L),await X(n.uid),alert("Preset deleted successfully!")}catch{alert("Failed to delete preset. Please try again.")}};if(!n)return null;if(!e)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-300",children:"Loading character creation..."}),o.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"No party ID found"})]})})});try{return o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),o.jsx("p",{className:"text-center text-gray-300 mb-6",children:h?"Edit your character below. When you're ready, click 'Ready Up & Join Campaign' at the bottom!":"Create your character to join the campaign. Once created, you'll be able to ready up and join the adventure!"}),h&&o.jsx("div",{className:"mb-6 flex justify-center",children:o.jsx("button",{type:"button",className:"fantasy-button bg-blue-600 hover:bg-blue-700",onClick:()=>t(`/campaign/${e}`),children:"← Back to Campaign"})}),o.jsxs("div",{className:"mb-8 p-4 bg-gray-700 rounded-lg border border-gray-600",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-4",children:"Character Presets"}),o.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[o.jsxs("button",{type:"button",onClick:()=>I(!0),className:"fantasy-button bg-amber-600 hover:bg-amber-700",disabled:g.length===0,children:["📋 Load Preset (",g.length,")"]}),o.jsx("button",{type:"button",onClick:()=>y(!0),className:"fantasy-button bg-emerald-600 hover:bg-emerald-700",children:"💾 Save as Preset"})]}),g.length>0&&o.jsx("p",{className:"text-sm text-gray-300",children:"Save your current character configuration as a preset to easily recreate it for other parties."})]}),o.jsxs("form",{onSubmit:L=>{wt(L)},className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-name",className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Name"}),o.jsx("input",{id:"character-name",name:"character-name",type:"text",value:j.name,onChange:L=>Je("name",L.target.value),className:"fantasy-input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-race",className:"block text-sm font-medium text-gray-200 mb-2",children:"Race"}),o.jsxs("select",{id:"character-race",name:"character-race",value:j.race,onChange:L=>Je("race",L.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Race"}),ce.map(L=>o.jsx("option",{value:L,children:L},L))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-class",className:"block text-sm font-medium text-gray-200 mb-2",children:"Class"}),o.jsxs("select",{id:"character-class",name:"character-class",value:j.class,onChange:L=>Je("class",L.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Class"}),je.map(L=>o.jsx("option",{value:L,children:L},L))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-background",className:"block text-sm font-medium text-gray-200 mb-2",children:"Background"}),o.jsxs("select",{id:"character-background",name:"character-background",value:j.background,onChange:L=>Je("background",L.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Background"}),le.map(L=>o.jsx("option",{value:L,children:L},L))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-alignment",className:"block text-sm font-medium text-gray-200 mb-2",children:"Alignment"}),o.jsxs("select",{id:"character-alignment",name:"character-alignment",value:j.alignment,onChange:L=>Je("alignment",L.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Alignment"}),de.map(L=>o.jsx("option",{value:L,children:L},L))]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Ability Scores"}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{htmlFor:"ability-method-standard",className:"block text-sm font-medium text-gray-200 mb-2",children:"Ability Score Generation Method"}),o.jsxs("div",{className:"flex space-x-4 mb-4",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{id:"ability-method-standard",type:"radio",name:"abilityMethod",value:"standard",checked:H==="standard",onChange:L=>E(L.target.value),className:"mr-2"}),o.jsx("span",{className:"text-gray-200",children:"Standard Array (15, 14, 13, 12, 10, 8)"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{id:"ability-method-roll",type:"radio",name:"abilityMethod",value:"roll",checked:H==="roll",onChange:L=>E(L.target.value),className:"mr-2"}),o.jsx("span",{className:"text-gray-200",children:"Roll 4d6, Drop Lowest"})]})]}),H==="standard"&&o.jsx("button",{type:"button",onClick:fr,className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Apply Standard Array"}),H==="roll"&&o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{type:"button",onClick:ct,disabled:Me,className:`fantasy-button ${Me?"bg-gray-500 cursor-not-allowed":"bg-gray-600 hover:bg-gray-700"}`,children:Me?"Scores Already Rolled":"Roll Ability Scores"}),Me&&o.jsx("p",{className:"text-sm text-gray-300",children:"You can only roll once, but you can reassign scores as many times as you like."}),_.length>0&&o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-semibold text-gray-100 mb-2",children:"Rolled Scores"}),o.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:A.map((L,U)=>o.jsx("span",{className:"bg-amber-900 text-amber-200 border border-amber-600 px-3 py-1 rounded-full text-sm font-medium",children:L},`${L}-${U}`))}),o.jsx("p",{className:"text-sm text-gray-300",children:"Click on an ability score below to assign your rolled scores. You can reassign them as many times as you want."})]})]})]}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:["strength","dexterity","constitution","intelligence","wisdom","charisma"].map(L=>{const U=N[L],ge=j[L]||10;return o.jsxs("div",{className:"border border-gray-600 rounded-lg p-4",children:[o.jsx("label",{htmlFor:`ability-${L}`,className:"block text-sm font-medium text-gray-200 mb-2 capitalize",children:L}),U?o.jsxs("div",{className:"space-y-2",children:[o.jsx("div",{className:"text-lg font-bold text-amber-400",children:U}),o.jsx("button",{type:"button",onClick:()=>Yt(L),className:"text-xs text-red-400 hover:text-red-300",children:"Unassign"})]}):o.jsxs("div",{className:"space-y-2",children:[o.jsx("input",{id:`ability-${L}`,name:`ability-${L}`,type:"number",min:"1",max:"20",value:ge,onChange:Ne=>Je(L,parseInt(Ne.target.value)),className:"fantasy-input",required:!0}),A.length>0&&o.jsx("div",{className:"flex flex-wrap gap-1",children:A.map((Ne,$t)=>o.jsx("button",{type:"button",onClick:()=>Ee(Ne,L),className:"bg-amber-900 hover:bg-amber-800 border border-amber-600 text-amber-200 px-2 py-1 rounded text-xs font-medium",children:Ne},`${Ne}-${$t}`))})]}),o.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Modifier: ",Math.floor((ge-10)/2)]})]},L)})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Physical Description"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-age",className:"block text-sm font-medium text-gray-200 mb-2",children:"Age"}),o.jsx("input",{id:"character-age",name:"character-age",type:"text",placeholder:"Age",value:j.age,onChange:L=>Je("age",L.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-height",className:"block text-sm font-medium text-gray-200 mb-2",children:"Height"}),o.jsx("input",{id:"character-height",name:"character-height",type:"text",placeholder:"Height",value:j.height,onChange:L=>Je("height",L.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-weight",className:"block text-sm font-medium text-gray-200 mb-2",children:"Weight"}),o.jsx("input",{id:"character-weight",name:"character-weight",type:"text",placeholder:"Weight",value:j.weight,onChange:L=>Je("weight",L.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-eyes",className:"block text-sm font-medium text-gray-200 mb-2",children:"Eye Color"}),o.jsx("input",{id:"character-eyes",name:"character-eyes",type:"text",placeholder:"Eye Color",value:j.eyes,onChange:L=>Je("eyes",L.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-skin",className:"block text-sm font-medium text-gray-200 mb-2",children:"Skin Color"}),o.jsx("input",{id:"character-skin",name:"character-skin",type:"text",placeholder:"Skin Color",value:j.skin,onChange:L=>Je("skin",L.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-hair",className:"block text-sm font-medium text-gray-200 mb-2",children:"Hair Color"}),o.jsx("input",{id:"character-hair",name:"character-hair",type:"text",placeholder:"Hair Color",value:j.hair,onChange:L=>Je("hair",L.target.value),className:"fantasy-input"})]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Personality"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-personality",className:"block text-sm font-medium text-gray-200 mb-2",children:"Personality Traits"}),o.jsx("textarea",{id:"character-personality",name:"character-personality",value:j.personality,onChange:L=>Je("personality",L.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your character's personality..."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-ideals",className:"block text-sm font-medium text-gray-200 mb-2",children:"Ideals"}),o.jsx("textarea",{id:"character-ideals",name:"character-ideals",value:j.ideals,onChange:L=>Je("ideals",L.target.value),className:"fantasy-input",rows:"3",placeholder:"What does your character believe in?"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-bonds",className:"block text-sm font-medium text-gray-200 mb-2",children:"Bonds"}),o.jsx("textarea",{id:"character-bonds",name:"character-bonds",value:j.bonds,onChange:L=>Je("bonds",L.target.value),className:"fantasy-input",rows:"3",placeholder:"What connections does your character have?"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-flaws",className:"block text-sm font-medium text-gray-200 mb-2",children:"Flaws"}),o.jsx("textarea",{id:"character-flaws",name:"character-flaws",value:j.flaws,onChange:L=>Je("flaws",L.target.value),className:"fantasy-input",rows:"3",placeholder:"What are your character's weaknesses?"})]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Backstory"}),o.jsx("textarea",{id:"character-backstory",name:"character-backstory",value:j.backstory,onChange:L=>Je("backstory",L.target.value),className:"fantasy-input",rows:"6",placeholder:"Tell the story of your character's life before the adventure..."})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Starting Equipment"}),j.class&&Se[j.class]&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Weapons"}),o.jsx("div",{className:"space-y-4",children:Object.entries(Se[j.class]).map(([L,U])=>o.jsxs("div",{children:[o.jsx("label",{htmlFor:`weapon-${L.toLowerCase().replace(/\s+/g,"")}`,className:"block text-sm font-medium text-gray-200 mb-2",children:L}),o.jsxs("select",{id:`weapon-${L.toLowerCase().replace(/\s+/g,"")}`,name:`weapon-${L.toLowerCase().replace(/\s+/g,"")}`,value:Re[L.toLowerCase().replace(/\s+/g,"")]||"",onChange:ge=>Te(Ne=>({...Ne,[L.toLowerCase().replace(/\s+/g,"")]:ge.target.value})),className:"fantasy-input",children:[o.jsxs("option",{value:"",children:["Select ",L]}),U.map(ge=>o.jsx("option",{value:ge,children:ge},ge))]})]},L))})]}),j.class&&ye[j.class]&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Cantrips"}),o.jsxs("p",{className:"text-sm text-gray-300 mb-3",children:["Select your starting cantrips (0-level spells). You can choose up to ",((Rn=Fe[j.class])==null?void 0:Rn.cantrips)||0," cantrips."]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto border border-gray-600 rounded-lg p-4",children:ye[j.class].map(L=>{var Ne;const U=G.includes(L.name),ge=!U&&G.length>=(((Ne=Fe[j.class])==null?void 0:Ne.cantrips)||0);return o.jsx("div",{className:`border rounded-lg p-3 ${U?"border-amber-500 bg-amber-900/20":"border-gray-600"} ${ge?"opacity-50":"hover:border-gray-500"}`,children:o.jsxs("label",{className:`flex items-start space-x-3 cursor-pointer ${ge?"cursor-not-allowed":""}`,children:[o.jsx("input",{id:`spell-${L.name.toLowerCase().replace(/\s+/g,"-")}`,name:`spell-${L.name.toLowerCase().replace(/\s+/g,"-")}`,type:"checkbox",checked:U,disabled:ge,onChange:$t=>{$t.target.checked?ie(Ut=>[...Ut,L.name]):ie(Ut=>Ut.filter(ut=>ut!==L.name))},className:"rounded mt-1"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-medium text-gray-100",children:L.name}),o.jsx("div",{className:"text-sm text-gray-300 mt-1",children:L.description})]})]})},L.name)})}),o.jsxs("div",{className:"flex justify-between items-center mt-3",children:[o.jsxs("p",{className:"text-sm text-gray-400",children:["Selected: ",G.length," / ",((bt=Fe[j.class])==null?void 0:bt.cantrips)||0," cantrips"]}),G.length>=(((mn=Fe[j.class])==null?void 0:mn.cantrips)||0)&&o.jsx("p",{className:"text-sm text-green-400 font-medium",children:"✓ Cantrip selection complete"})]})]}),j.class?o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsxs("h3",{className:"font-semibold text-gray-100 mb-3",children:[j.class," Starting Equipment"]}),o.jsx("ul",{className:"space-y-1",children:W(j.class).map((L,U)=>o.jsxs("li",{className:"text-gray-200 flex items-start",children:[o.jsx("span",{className:"text-gray-400 mr-2",children:"•"}),L]},U))}),o.jsx("p",{className:"text-sm text-gray-300 mt-3",children:"This equipment will be automatically assigned to your character."})]}):o.jsx("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:o.jsx("p",{className:"text-gray-300",children:"Select a class to see your starting equipment."})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Character Portrait"}),o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("div",{className:"w-32 h-32 bg-gray-600 rounded-lg flex items-center justify-center",children:o.jsx("span",{className:"text-gray-400",children:"Portrait Placeholder"})}),o.jsx("button",{type:"button",className:"fantasy-button",onClick:()=>{},children:"Upload Image"})]})]}),o.jsx("div",{className:"flex justify-center",children:h?o.jsx("button",{type:"submit",className:"fantasy-button bg-blue-600 hover:bg-blue-700",disabled:s,children:s?"Updating Character...":"Update Character"}):o.jsx("button",{type:"submit",className:"fantasy-button",disabled:s,children:s?"Saving Character...":"Save Character"})})]}),S&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"fantasy-card max-w-md w-full mx-4",children:[o.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Save Character Preset"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"preset-name",className:"block text-sm font-medium text-gray-200 mb-2",children:"Preset Name"}),o.jsx("input",{id:"preset-name",name:"preset-name",type:"text",value:k,onChange:L=>b(L.target.value),onKeyPress:Jt,className:"fantasy-input",placeholder:"Enter a name for your preset",autoFocus:!0})]}),o.jsxs("div",{className:"flex space-x-3",children:[o.jsx("button",{type:"button",onClick:()=>{y(!1),b("")},className:"fantasy-button bg-gray-600 hover:bg-gray-700 flex-1",children:"Cancel"}),o.jsx("button",{type:"button",onClick:Ge,className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 flex-1",children:"Save Preset"})]})]})]})}),w&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"fantasy-card max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Load Character Preset"}),g.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-gray-300 mb-4",children:"No character presets found."}),o.jsx("p",{className:"text-sm text-gray-400",children:"Create a character and save it as a preset to see it here."}),o.jsx("button",{type:"button",onClick:()=>I(!1),className:"fantasy-button mt-4",children:"Close"})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"grid gap-4",children:g.map(L=>o.jsxs("div",{className:"border border-gray-600 rounded-lg p-4 hover:border-gray-500",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-100",children:L.name}),o.jsxs("p",{className:"text-sm text-gray-300",children:[L.data.race," ",L.data.class," • Level ",L.data.level]}),L.data.background&&o.jsx("p",{className:"text-sm text-gray-400",children:L.data.background}),L.createdAt&&o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Created: ",new Date(L.createdAt.toDate()).toLocaleDateString()]})]}),o.jsx("button",{type:"button",onClick:()=>ht(L.id),className:"text-red-400 hover:text-red-300 text-sm",title:"Delete preset",children:"🗑️"})]}),o.jsx("div",{className:"flex space-x-2",children:o.jsx("button",{type:"button",onClick:()=>is(L),className:"fantasy-button bg-amber-600 hover:bg-amber-700 flex-1",children:"Load Preset"})})]},L.id))}),o.jsx("div",{className:"flex justify-center",children:o.jsx("button",{type:"button",onClick:()=>I(!1),className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Cancel"})})]})]})})]})})}catch(L){return console.error("Error rendering CharacterCreation:",L),o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-red-400 text-sm",children:"An error occurred while rendering the component."}),o.jsx("p",{className:"text-gray-300",children:"Please try again later."})]})})})}}const Mi={INVESTIGATION:"investigation",COMBAT:"combat",PERSUASION:"persuasion",EXPLORATION:"exploration",SOCIAL:"social"},Mr={HIDDEN:"hidden",DISCOVERED:"discovered",IN_PROGRESS:"in_progress",COMPLETED:"completed",FAILED:"failed"},WR=t=>{const e=[{id:"investigate_area",type:Mi.INVESTIGATION,title:"Investigate the Area",description:"Search for clues and gather information about the situation",keywords:["search","investigate","examine","look around","check","explore"],state:Mr.HIDDEN,discoveredAt:null,completedAt:null},{id:"resolve_conflict",type:Mi.COMBAT,title:"Resolve the Conflict",description:"Engage in combat to overcome the threat",keywords:["fight","attack","defend","combat","battle"],state:Mr.HIDDEN,discoveredAt:null,completedAt:null},{id:"negotiate_peace",type:Mi.PERSUASION,title:"Negotiate Peace",description:"Use diplomacy and persuasion to resolve the situation peacefully",keywords:["talk","negotiate","persuade","convince","diplomacy","peace"],state:Mr.HIDDEN,discoveredAt:null,completedAt:null}],n=[];return(t.toLowerCase().includes("thief")||t.toLowerCase().includes("stealth"))&&n.push({id:"stealth_approach",type:Mi.EXPLORATION,title:"Stealth Approach",description:"Use stealth to avoid detection and gather information",keywords:["sneak","stealth","hide","silent","unnoticed"],state:Mr.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("merchant")||t.toLowerCase().includes("trade"))&&n.push({id:"establish_trade",type:Mi.SOCIAL,title:"Establish Trade Relations",description:"Build economic relationships with the locals",keywords:["trade","bargain","deal","commerce","business"],state:Mr.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("scholar")||t.toLowerCase().includes("knowledge"))&&n.push({id:"gather_knowledge",type:Mi.INVESTIGATION,title:"Gather Ancient Knowledge",description:"Discover and preserve valuable information",keywords:["research","study","learn","knowledge","ancient","lore"],state:Mr.HIDDEN,discoveredAt:null,completedAt:null}),[...e,...n]},E0=t=>t.filter(e=>e.state===Mr.DISCOVERED||e.state===Mr.IN_PROGRESS||e.state===Mr.COMPLETED);function HR(){var R,te,me,ve,xe,re,De,At,yt,Zs,Xt,gr,ei,Ai,tr,Da;const{user:t,loading:e}=CR(),{partyId:n}=uf(),r=Zn(),[s,i]=P.useState(null),[a,c]=P.useState(null),[u,d]=P.useState([]),[h,f]=P.useState([]),[g,x]=P.useState(!0),[S,y]=P.useState(""),[k,b]=P.useState(""),[w,I]=P.useState("storytelling"),[j,$]=P.useState([]),[H,E]=P.useState(null),[_,C]=P.useState(!1),[A,D]=P.useState(null),[N,T]=P.useState(!1),[Me,Pe]=P.useState(null),[Re,Te]=P.useState(null),[G,ie]=P.useState(!1),[pe,J]=P.useState(!1),[B,X]=P.useState(!1),[ce,je]=P.useState(!1),[de,le]=P.useState("inactive"),[Z,Se]=P.useState(null),[ye,Fe]=P.useState(null),[W,lt]=P.useState(null),[ct,Ee]=P.useState(!1),[Yt,fr]=P.useState([]),[Je,wt]=P.useState(!1),[Ge,Jt]=P.useState(!1),is=new dp,ht=new hp,Rn=()=>{var M;return((M=s==null?void 0:s.readyPlayers)==null?void 0:M.length)||0},bt=()=>u.length,mn=()=>h.sort((M,V)=>M.name.localeCompare(V.name)),L=M=>M?M.replace(/\*\*(.*?)\*\*/g,'<strong class="text-yellow-400 font-bold">$1</strong>').replace(/\*(.*?)\*/g,'<em class="text-blue-400 italic">$1</em>').replace(/`(.*?)`/g,'<code class="bg-slate-700 px-2 py-1 rounded text-slate-200 font-mono text-sm">$1</code>').replace(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*):/g,'<span class="text-green-400 font-semibold">$1:</span>').replace(/\b(weapon|sword|shield|armor|magic|spell|dragon|monster|treasure|gold|silver|quest|adventure|hero|villain)\b/gi,'<span class="text-orange-400 font-medium">$1</span>').replace(/\b([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\b/g,V=>V.includes("<")||["The","A","An","And","Or","But","In","On","At","To","For","Of","With","By"].includes(V)?V:`<span class="text-purple-400 font-medium">${V}</span>`).replace(/\n/g,"<br>"):"";P.useEffect(()=>{!t&&!e&&r("/login")},[t,e,r]),P.useEffect(()=>{n&&t&&!e&&U()},[n,t,e]),P.useEffect(()=>{if(s!=null&&s.id){console.log("📡 Setting up real-time subscription for story:",s.id);const M=yR(s.id,V=>{var se,K,q,ue,ee,fe,_e,ke,Le,Xe;if(V){console.log("📡 Story update received:",V),i(V);const et=V.currentContent||"",$e=V.storyMetadata||{},Dn=$e.phaseStatus||(et.toLowerCase().includes("phase_status:")?(K=(se=et.toLowerCase().split("phase_status:")[1])==null?void 0:se.split(`
`)[0])==null?void 0:K.trim():null)||(et.toLowerCase().includes("conflict")?"conflict":null),Zt=["attack","battle","combat","fight","enemy","enemies","monster","creature","ghoul","bandit","goblin","troll"].some(nr=>et.toLowerCase().includes(nr));if(console.log("🔍 Phase detection debug:",{storyMetadataPhase:$e.phaseStatus,contentPhase:et.toLowerCase().includes("phase_status:")?(ue=(q=et.toLowerCase().split("phase_status:")[1])==null?void 0:q.split(`
`)[0])==null?void 0:ue.trim():"not found",conflictKeywords:et.toLowerCase().includes("conflict"),combatKeywords:Zt,finalPhaseStatus:Dn}),Dn&&String(Dn).toLowerCase()==="conflict"||Zt&&et.toLowerCase().includes("attack")&&!Je){console.log("⚔️ Conflict phase detected, preparing combat session..."),wt(!0),Jt(!0);const nr=(a==null?void 0:a.members)||[];if(((ee=V.readyPlayers)==null?void 0:ee.length)===nr.length&&nr.length>0){console.log("🎉 All players ready, creating combat session..."),console.log("🔍 Debugging party members before combat session creation:",u),console.log("🔍 Debugging party characters before combat session creation:",h);const os=(h.length>0?h:u).map((Ke,Hn)=>{if(console.log(`🔍 Validating member ${Hn}:`,Ke),typeof Ke=="string"){console.log(`⚠️ Member ${Hn} is a user ID string, creating basic character object`);const en={id:`member_${Hn}`,name:`Player ${Hn+1}`,userId:Ke,race:"Unknown",class:"Unknown",level:1,initiative:Math.floor(Math.random()*20)+1,hp:10,maxHp:10,ac:10};return console.log("✅ Created basic character for user ID:",en),en}const cs={id:Ke.id||`member_${Hn}`,name:Ke.name||`Unknown Member ${Hn}`,userId:Ke.userId||null,race:Ke.race||"Unknown",class:Ke.class||"Unknown",level:Ke.level||1,initiative:Ke.initiative||Math.floor(Math.random()*20)+1,hp:Ke.hp||Ke.maxHp||10,maxHp:Ke.maxHp||Ke.hp||10,ac:Ke.ac||10,...Object.fromEntries(Object.entries(Ke).filter(([en,wl])=>wl!=null&&en!=="id"&&en!=="name"&&en!=="userId"&&en!=="race"&&en!=="class"&&en!=="level"&&en!=="initiative"&&en!=="hp"&&en!=="maxHp"&&en!=="ac"))};return console.log(`✅ Cleaned member ${Hn}:`,cs),cs});console.log("✅ Final validated party members:",os);let fn=[];if(console.log("🔍 Story metadata:",V.storyMetadata),console.log("🔍 Story metadata enemy details:",(fe=V.storyMetadata)==null?void 0:fe.enemyDetails),(_e=V.storyMetadata)!=null&&_e.enemyDetails&&V.storyMetadata.enemyDetails.length>0&&(console.log("🔍 Found enemy details in story metadata:",V.storyMetadata.enemyDetails),fn=as(V.storyMetadata.enemyDetails),console.log("⚔️ Extracted enemies from story metadata:",fn)),fn.length===0&&V.currentContent){console.log("🔍 No enemies in metadata, trying to parse story content...");const Ke=Wn(V.currentContent);Ke.enemyDetails&&Ke.enemyDetails.length>0&&(fn=as(Ke.enemyDetails),console.log("⚔️ Extracted enemies from story content:",fn))}fn.length===0&&(console.log("⚠️ No enemies found in story or metadata, using fallback enemies"),fn=[{id:"enemy_0",name:"Gnoll Tribesmen",hp:12,maxHp:12,ac:15,level:1,class:"humanoid",race:"gnoll",initiative:Math.floor(Math.random()*20)+1,strength:14,dexterity:12,constitution:12,intelligence:8,wisdom:8,charisma:6,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,basicAttack:"Spiked Club (1d6 + 2 bludgeoning damage)",specialAbility:"Pack Tactics (The Gnoll has advantage on an attack roll against a creature if at least one of the gnoll's allies is within 5 feet of the creature and the ally isn't incapacitated.)"}]),console.log("⚔️ Final enemies for combat session:",fn);const ls={partyId:n,partyMembers:os,enemies:fn,storyContext:V.currentContent||"Combat encounter",combatState:"initialized",currentTurn:0,round:1,initiative:[],environmentalFeatures:[],teamUpOpportunities:[],narrativeElements:[]};console.log("✅ Final combat session object:",ls),Bd(n,ls).then(()=>{console.log("⚔️ Basic combat session created, navigating to Combat page..."),Jt(!1),wt(!0),r(`/combat/${n}`)}).catch(Ke=>{console.error("❌ Failed to create combat session:",Ke),Jt(!1),wt(!1)}),setTimeout(()=>{Ge&&(console.warn("⚠️ Combat loading timeout, resetting state..."),Jt(!1),wt(!1))},5e3)}else console.log("⏳ Waiting for all players to be ready before combat...")}else V.storyMetadata&&String(V.storyMetadata.phaseStatus).toLowerCase()!=="conflict"&&(wt(!1),Jt(!1));(ke=V.readyPlayers)!=null&&ke.includes(t==null?void 0:t.uid)&&(console.log("✅ User is ready"),ie(!0));const Cn=(a==null?void 0:a.members)||[];((Le=V.readyPlayers)==null?void 0:Le.length)===Cn.length&&Cn.length>0?(console.log("🎉 All players are ready!"),J(!0)):(console.log("⏳ Not all players ready yet:",(Xe=V.readyPlayers)==null?void 0:Xe.length,"/",Cn.length),J(!1))}});return Te(()=>M),()=>M()}},[s==null?void 0:s.id,t==null?void 0:t.uid,a==null?void 0:a.members,de,r,Je]),P.useEffect(()=>{if(ye){console.log("⚔️ Setting up real-time subscription for combat session:",ye);const M=d_(n,V=>{if(V){console.log("⚔️ Combat session update received:",V),console.log("⚔️ Combat session state:",V.combatState),console.log("⚔️ Combat session ID:",V.id);const se={combatants:[...V.partyMembers,...V.enemies],currentTurn:V.currentTurn,round:V.round,combatState:V.combatState,storyContext:V.storyContext,environmentalFeatures:V.environmentalFeatures,teamUpOpportunities:V.teamUpOpportunities,narrativeElements:V.narrativeElements};console.log("⚔️ Reconstructed session:",se),Se(se),lt(se.combatants[V.currentTurn]),le(V.combatState)}else console.log("⚔️ Combat session ended or not found"),console.log("⚔️ Clearing combat state..."),Se(null),Fe(null),le("inactive"),lt(null)});return()=>M()}},[ye,n]),P.useEffect(()=>{W&&Z&&(console.log("🔄 Turn changed to:",W.name,"at index:",Z.currentTurn),console.log("🔄 Full turn order:",Z.combatants.map((M,V)=>`${V}: ${M.name} (${M.initiative})`)))},[W,Z]),P.useEffect(()=>{if(de==="active"&&W&&W.id.startsWith("enemy_")&&!ct){console.log("🤖 Auto-processing enemy turn for:",W.name),console.log("🤖 Current turn order:",Z==null?void 0:Z.combatants.map((V,se)=>`${se}: ${V.name} (${V.initiative})`)),console.log("🤖 Current turn index:",Z==null?void 0:Z.currentTurn);const M=setTimeout(async()=>{var V;try{Ee(!0);const se=ht.getAvailableActions(W);console.log("🤖 Available actions for enemy:",se);const K=ht.getValidTargets(W,"attack",Z);console.log("🤖 Valid targets for enemy:",K.map(ee=>ee.name));const q=ht.makeEnemyDecision(W,se,K,Z);console.log("🤖 Enemy decision:",q);const ue=await ht.executeAction(Z,W.id,q.action,q.targetId);if(ue.success){console.log("🤖 Enemy action result:",ue),console.log("🤖 Action details:",{enemy:W.name,action:q.action,target:q.targetId,specialAttack:q.specialAttack,damageType:q.damageType});const ee=ue.combatSession;if(ue.results&&ue.results.damage>0){const ke=ee.combatants.find(Le=>Le.id===q.targetId);if(ke){const Le=ke.hp;ke.hp=Math.max(0,ke.hp-ue.results.damage),console.log(`🤖 Enemy applied ${ue.results.damage} damage to ${ke.name}. HP: ${Le} → ${ke.hp}`),Dt({type:"damage",attacker:W.name,target:ke.name,damage:ue.results.damage,targetHp:ke.hp,action:q.action,message:`${W.name} deals ${ue.results.damage} damage to ${ke.name} (${ke.hp} HP remaining)`})}}else if(ue.results&&ue.results.healing>0){const ke=ee.combatants.find(Le=>Le.id===q.targetId);ke&&Dt({type:"healing",healer:W.name,target:ke.name,healing:ue.results.healing,action:q.action,message:`${W.name} heals ${ke.name} for ${ue.results.healing} HP`})}else Dt({type:"action",actor:W.name,action:q.action,target:((V=ee.combatants.find(ke=>ke.id===q.targetId))==null?void 0:V.name)||"None",message:`${W.name} uses ${q.action}`});console.log("🤖 Updated combat session:",ee),console.log("🤖 Combatants after enemy action:",ee.combatants.map(ke=>`${ke.name}: ${ke.hp}/${ke.maxHp}`)),Se(ee),ye&&await ai(ye,{currentTurn:ee.currentTurn,round:ee.round,combatState:ee.combatState,partyMembers:ee.combatants.filter(ke=>!ke.id.startsWith("enemy_")),enemies:ee.combatants.filter(ke=>ke.id.startsWith("enemy_"))});const fe=ee.combatants[ee.currentTurn];lt(fe);const _e=ht.checkCombatEnd(ee);if(_e.isComplete){console.log("⚔️ Combat ended:",_e),le("complete"),Dt({type:"combat_end",result:_e.result,message:_e.result==="victory"?"🎉 Victory! All enemies have been defeated!":_e.result==="defeat"?"💀 Defeat! The party has been overwhelmed!":"🤝 Combat ends in a draw."}),setTimeout(()=>{fr([])},5e3);const ke=ht.generateCombatSummary(ee,_e),Le=ht.generateCombatNarrative(ee,_e);await gn(s.id,{currentContent:Le,storyMetadata:{...s.storyMetadata,phaseStatus:"Storytelling",combatResult:_e}})}else ee.combatants.filter(Le=>Le.id.startsWith("enemy_")&&Le.hp<=0&&Le.maxHp>0).forEach(Le=>{Le.maxHp=0,Dt({type:"enemy_death",enemy:Le.name,message:`💀 ${Le.name} has been defeated!`})})}Ee(!1)}catch(se){console.error("❌ Error processing enemy turn:",se),Ee(!1)}},2e3);return()=>clearTimeout(M)}},[W,de,Z,s==null?void 0:s.id,s==null?void 0:s.storyMetadata,ht,ct,ye]),P.useEffect(()=>{if(n){console.log("👥 Setting up real-time subscription for characters:",n);const M=mR(n,async V=>{if(V){console.log("👥 Party update received:",V),c(V),d(V.members||[]);try{const se=await Xo(n);console.log("🎭 Characters reloaded:",se),console.log("🎭 Character count:",se.length),console.log("🎭 Character details:",se.map(K=>({id:K.id,name:K.name,userId:K.userId,partyId:K.partyId}))),f(se)}catch(se){console.error("❌ Error reloading characters:",se)}}});return()=>M()}},[n]),P.useEffect(()=>()=>{Re&&Re()},[Re]);const U=P.useCallback(async()=>{if(n)try{console.log("🔄 Starting loadStoryAndCharacters..."),x(!0);const M=await hR(n);console.log("👥 Party data loaded:",M),c(M);const V=(M==null?void 0:M.members)||[];d(V);let se=await pR(n);console.log("📖 Story data loaded:",se),se||(console.log("📝 Creating new campaign story..."),se=await fR(n),console.log("✅ New story created:",se)),i(se);const K=await Xo(n);console.log("🎭 Characters loaded:",K),console.log("🎭 Character count:",K.length),console.log("🎭 Character details:",K.map(ue=>({id:ue.id,name:ue.name,userId:ue.userId,partyId:ue.partyId}))),f(K);const q=WR((M==null?void 0:M.description)||"adventure");$(q),console.log("✅ loadStoryAndCharacters completed successfully")}catch(M){console.error("❌ Error loading story and characters:",M),y("Failed to load campaign data")}finally{x(!1)}},[n]),ge=P.useCallback(async()=>{if(!(!t||!s))try{console.log("👋 User readying up..."),x(!0),await gR(s.id,t.uid),console.log("✅ Player ready status set")}catch(M){console.error("❌ Error readying up:",M),y("Failed to ready up")}finally{x(!1)}},[t,s]),Ne=P.useCallback(async()=>{if(!(!t||!s))try{console.log("🚀 Starting story generation..."),x(!0),X(!0),await gn(s.id,{status:"generating"}),console.log("📊 Status set to generating");try{const M=await ec.generateStoryPlots(h,(a==null?void 0:a.description)||"An epic adventure awaits!",j);console.log("📜 Generated plots response:",M);const V=er(M);console.log("✅ Parsed plots array:",V),await gn(s.id,{status:"voting",availablePlots:V}),console.log("🗳️ Moved to voting phase")}catch(M){console.warn("AI service unavailable, using fallback plots:",M);const V=[{title:"The Lost Artifact",description:"A powerful artifact has been stolen and the party must track it down through dangerous territory.",summary:"An ancient artifact of great power has been stolen from the local temple. The party must follow the trail of the thieves through dangerous wilderness and hostile territory.",campaignLength:"medium"},{title:"The Dark Forest",description:"A mysterious forest has appeared overnight, and strange creatures are emerging from its depths.",summary:"A dark forest has mysteriously appeared on the outskirts of town. Strange creatures and magical phenomena are emerging, and the party must investigate the source.",campaignLength:"short"},{title:"The Dragon's Lair",description:"A dragon has been terrorizing the countryside, and the party must find a way to stop it.",summary:"A fearsome dragon has been attacking villages and stealing livestock. The party must find the dragon's lair and either defeat it or negotiate a peaceful solution.",campaignLength:"long"}];await gn(s.id,{status:"voting",availablePlots:V}),console.log("🗳️ Moved to voting phase with fallback plots"),y("AI service temporarily unavailable. Using predefined plot options.")}}catch(M){console.error("❌ Error starting story:",M),y("Failed to start story generation"),await gn(s.id,{status:"ready_up"})}finally{x(!1),X(!1)}},[t,s,h,a==null?void 0:a.description,j]),$t=P.useCallback(async M=>{var V;try{console.log("🎯 Selecting plot:",M),x(!0);const se=((V=s==null?void 0:s.availablePlots)==null?void 0:V.filter(q=>q.title&&!q.title.startsWith("Plot ")))||[],K=se[M];if(console.log("📋 Available plots:",s==null?void 0:s.availablePlots),console.log("🎯 Valid plots:",se),console.log("🎯 Selected plot:",K),!K){console.error("❌ Selected plot not found"),y("Selected plot not found");return}await gn(s.id,{status:"generating_story",selectedPlot:M,selectedPlotData:K,currentContent:`Generating story content for: ${K.title}...`}),console.log("📝 Status set to generating_story");try{const q=await ec.generateStoryIntroduction(h,K.description,K.title,a);console.log("📖 Generated story content:",q),await gn(s.id,{status:"storytelling",currentContent:q||`The adventure begins with ${K.title}!`,currentSpeaker:{userId:a.dmId,name:"Dungeon Master",id:"dm",race:"DM",class:"Dungeon Master"}}),console.log("✅ Plot selected and story generated successfully")}catch(q){console.warn("AI service unavailable, using fallback story:",q);const ue=`The adventure begins with ${K.title}!

${K.summary}

The party finds themselves at the beginning of this epic journey. The path ahead is uncertain, but the promise of adventure and glory awaits those brave enough to take the first step.

What would you like to do?`;await gn(s.id,{status:"storytelling",currentContent:ue,currentSpeaker:{userId:a.dmId,name:"Dungeon Master",id:"dm",race:"DM",class:"Dungeon Master"}}),console.log("✅ Plot selected with fallback story content"),y("AI service temporarily unavailable. Using simplified story introduction.")}}catch(se){console.error("❌ Error selecting plot:",se),y("Failed to select plot"),await gn(s.id,{status:"voting"})}finally{x(!1)}},[s,h,a]),Ut=P.useCallback(async()=>{var M,V;if(k.trim())try{x(!0),y("");const se=h.find(K=>K.userId===(t==null?void 0:t.uid));if(!se){y("You need a character to participate in the story");return}try{const K=await is.validatePlayerAction(k,se,{storyState:s,currentContent:(s==null?void 0:s.currentContent)||"",party:a});E(K),K.diceResult&&(C(!0),D(K))}catch(K){console.warn("Action validation unavailable:",K)}try{const K=await ec.generateStructuredStoryResponse(h,(s==null?void 0:s.storyMessages)||[],k,w,E0(j),null,a),q=Wn(K),ue={speaker:((M=s==null?void 0:s.currentSpeaker)==null?void 0:M.name)||se.name,content:k,timestamp:new Date};await gn(s.id,{currentContent:q.storyContent||`${(s==null?void 0:s.currentContent)||""}

${se.name}: "${k}"`,currentSpeaker:null,storyMessages:[...(s==null?void 0:s.storyMessages)||[],ue],storyMetadata:{currentLocation:q.currentLocation,activeNPCs:q.activeNPCs,plotDevelopments:q.plotDevelopments,characterReactions:q.characterReactions,nextActions:q.nextActions,storyTone:q.storyTone,phaseStatus:q.phaseStatus,enemyDetails:q.enemyDetails||[]}})}catch(K){console.warn("AI service unavailable, continuing story manually:",K);const q={speaker:((V=s==null?void 0:s.currentSpeaker)==null?void 0:V.name)||se.name,content:k,timestamp:new Date};await gn(s.id,{currentContent:`${(s==null?void 0:s.currentContent)||""}

${se.name}: "${k}"`,currentSpeaker:null,storyMessages:[...(s==null?void 0:s.storyMessages)||[],q]}),y("AI service temporarily unavailable. Story continued manually.")}b(""),E(null),await U()}catch(se){console.error("Error sending response:",se),y("Failed to send response")}finally{x(!1)}},[k,h,t==null?void 0:t.uid,s,a,w,j,U]),ut=P.useCallback(()=>{C(!1),D(null)},[]),Ir=P.useCallback(()=>{T(!1),Pe(null)},[]),Ar=P.useCallback(async()=>{C(!1)},[]),Ze=P.useCallback(()=>{C(!1),D(null)},[]),pr=P.useCallback(async M=>{try{console.log("🎤 Setting speaker:",M),console.log("🎤 Character data:",JSON.stringify(M)),console.log("🎤 Story ID:",s==null?void 0:s.id),x(!0),M?await vR(s.id,M):await gn(s.id,{currentSpeaker:null}),console.log("✅ Speaker set")}catch(V){console.error("❌ Error setting speaker:",V),y("Failed to set speaker")}finally{x(!1)}},[s==null?void 0:s.id]);P.useCallback(async()=>{try{console.log("🚀 Continuing story..."),x(!0);const M=await ec.generateStoryContinuation(h,(s==null?void 0:s.storyMessages)||[],"The story continues...",w,E0(j),null,a);await gn(s.id,{currentContent:M||"The story continues...",currentSpeaker:null}),console.log("✅ Story continued")}catch(M){console.error("❌ Error continuing story:",M),y("Failed to continue story")}finally{x(!1)}},[h,s,w,j,a]);const er=M=>{try{console.log("🔍 Parsing plots from response...");const V=M.split(/\*\*Plot Option \d+:\*\*/).filter(K=>K.trim());console.log("📋 Found plot sections:",V.length);const se=V.map((K,q)=>{const ue=K.trim().split(`
`).filter(Le=>Le.trim());let ee=`Plot ${q+1}`,fe="",_e="",ke="";for(let Le=0;Le<ue.length;Le++){const Xe=ue[Le].trim();if(Xe.startsWith("1. Title:")){const et=Xe.match(/1\.\s*Title:\s*"([^"]+)"/);et&&(ee=et[1])}if(Xe.startsWith("2. Summary:")){let et=Xe.replace("2. Summary:","").trim(),$e=Le+1;for(;$e<ue.length&&!ue[$e].trim().startsWith("3.");)et+=" "+ue[$e].trim(),$e++;_e=et.trim(),Le=$e-1}if(Xe.startsWith("3. Main Conflict:")){let et=Xe.replace("3. Main Conflict:","").trim(),$e=Le+1;for(;$e<ue.length&&!ue[$e].trim().startsWith("4.");)et+=" "+ue[$e].trim(),$e++;fe=et.trim(),Le=$e-1}if(Xe.startsWith("5. Estimated Campaign Length:")){const et=Xe.match(/5\.\s*Estimated Campaign Length:\s*(short|medium|long)/i);et&&(ke=et[1].toLowerCase())}}return!fe&&_e&&(fe=_e),console.log(`📋 Plot ${q+1} parsed:`,{title:ee,description:fe,summary:_e,campaignLength:ke}),{id:q,title:ee,description:fe||_e||`Plot ${q+1} description`,summary:_e,campaignLength:ke,index:q}});return console.log("✅ Parsed plots:",se),se}catch(V){return console.error("❌ Error parsing plots:",V),[{id:0,title:"Plot 1",description:"Adventure awaits!",index:0},{id:1,title:"Plot 2",description:"Another exciting journey!",index:1},{id:2,title:"Plot 3",description:"A mysterious quest!",index:2}]}},Wn=M=>{try{console.log("🔍 Parsing structured response:",M);const V={storyContent:"",currentLocation:"",activeNPCs:[],plotDevelopments:"",characterReactions:"",nextActions:[],storyTone:"",phaseStatus:"",enemyDetails:[]},se=M.match(/\*\*STORY_CONTENT:\*\*\s*([\s\S]*?)(?=\*\*|$)/);se&&(V.storyContent=se[1].trim());const K=M.match(/\*\*CURRENT_LOCATION:\*\*\s*([\s\S]*?)(?=\*\*|$)/);K&&(V.currentLocation=K[1].trim());const q=M.match(/\*\*ACTIVE_NPCS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);q&&(V.activeNPCs=q[1].trim().split(",").map(Xe=>Xe.trim()).filter(Xe=>Xe));const ue=M.match(/\*\*PLOT_DEVELOPMENTS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);ue&&(V.plotDevelopments=ue[1].trim());const ee=M.match(/\*\*CHARACTER_REACTIONS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);ee&&(V.characterReactions=ee[1].trim());const fe=M.match(/\*\*NEXT_ACTIONS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);fe&&(V.nextActions=fe[1].trim().split(",").map(Xe=>Xe.trim()).filter(Xe=>Xe));const _e=M.match(/\*\*STORY_TONE:\*\*\s*([\s\S]*?)(?=\*\*|$)/);_e&&(V.storyTone=_e[1].trim());const ke=M.match(/\*\*PHASE_STATUS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);ke&&(V.phaseStatus=ke[1].trim());const Le=M.match(/\*\*ENEMY_DETAILS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);if(Le){const Xe=Le[1].trim();console.log("🔍 Raw enemy details text:",Xe);const et=Xe.split(/(?=Name:)/).filter($e=>$e.trim());console.log("🔍 Enemy blocks found:",et.length),V.enemyDetails=et.map(($e,Dn)=>{console.log(`🔍 Parsing enemy block ${Dn}:`,$e);const Mt={},Zt=$e.match(/Name:\s*([^\n]+)/);Zt&&(Mt.name=Zt[1].trim());const Cn=$e.match(/Type:\s*([^\n]+)/);Cn&&(Mt.type=Cn[1].trim());const nr=$e.match(/Level:\s*([^\n]+)/);nr&&(Mt.level=parseInt(nr[1].trim())||1);const Ma=$e.match(/HP:\s*([^\n]+)/);if(Ma){const cs=Ma[1].trim().match(/(\d+)/);Mt.hp=cs?parseInt(cs[1]):20}const os=$e.match(/AC:\s*([^\n]+)/);os&&(Mt.ac=parseInt(os[1].trim())||12);const fn=$e.match(/Basic Attack:\s*([^\n]+)/);fn&&(Mt.basicAttack=fn[1].trim());const ls=$e.match(/Special Ability:\s*([^\n]+)/);ls&&(Mt.specialAbility=ls[1].trim());const Ke=$e.match(/Stats:\s*([^\n]+)/);return Ke&&(Mt.stats=Ke[1].trim()),console.log(`✅ Parsed enemy ${Dn}:`,Mt),Mt})}return console.log("✅ Parsed structured response:",V),V}catch(V){return console.error("❌ Error parsing structured response:",V),{storyContent:M,currentLocation:"",activeNPCs:[],plotDevelopments:"",characterReactions:"",nextActions:[],storyTone:"",phaseStatus:"",enemyDetails:[]}}},as=M=>!Array.isArray(M)||M.length===0?(console.log("⚠️ No enemy details provided, returning empty array"),[]):(console.log("🔧 Converting enemy details to combat-ready enemies:",M),M.map((V,se)=>{var ue,ee;const q={id:`enemy_${se}`,name:V.name||`Enemy ${se+1}`,hp:V.hp||20,maxHp:V.hp||20,ac:V.ac||12,level:V.level||1,class:((ue=V.type)==null?void 0:ue.toLowerCase())||"enemy",race:((ee=V.type)==null?void 0:ee.toLowerCase())||"unknown",initiative:Math.floor(Math.random()*20)+1,strength:12,dexterity:10,constitution:12,intelligence:8,wisdom:8,charisma:6,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,basicAttack:V.basicAttack||"Basic attack (1d6 damage)",specialAbility:V.specialAbility||"None",type:V.type||"humanoid",stats:V.stats||"Standard enemy stats"};return console.log(`✅ Converted enemy ${se}:`,q),q})),Dt=P.useCallback(M=>{const V=new Date().toLocaleTimeString(),se={id:Date.now(),timestamp:V,...M};fr(K=>[...K,se]),console.log("📜 Battle Log Entry:",se)},[]);P.useCallback(async M=>{var V;try{console.log("⚔️ Initializing combat...");let se=[];Array.isArray((V=M.storyMetadata)==null?void 0:V.enemies)&&M.storyMetadata.enemies.length>0?se=[...M.storyMetadata.enemies]:(se=[{id:"enemy_0",name:"Gnoll Pack",hp:20,maxHp:20,ac:12,level:1,class:"enemy",race:"unknown",initiative:Math.floor(Math.random()*20)+1,strength:12,dexterity:10,constitution:12,intelligence:8,wisdom:8,charisma:6},{id:"enemy_1",name:"Gnoll Pack-Leader",hp:25,maxHp:25,ac:14,level:2,class:"enemy",race:"unknown",initiative:Math.floor(Math.random()*20)+1,strength:14,dexterity:12,constitution:14,intelligence:10,wisdom:10,charisma:8}],console.log("⚔️ Using fallback enemy details:",se)),setEnemies(se),Dt({type:"combat_start",message:`Combat begins! ${se.length} enemies appear.`,enemies:se.map(ee=>ee.name)});const K=h.map(ee=>{var Le,Xe;let fe=ee.hp,_e=ee.maxHp;if(!fe||!_e){const $e={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[ee.class]||8,Dn=((Le=ee.assignedScores)==null?void 0:Le.constitution)||10,Mt=Math.floor((Dn-10)/2),Zt=Math.max(1,($e+Mt)*(ee.level||1));fe=Zt,_e=Zt}let ke=ee.ac;if(!ke){const $e=((Xe=ee.assignedScores)==null?void 0:Xe.dexterity)||10,Dn=Math.floor(($e-10)/2),Zt={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[ee.class]||0;ke=Math.max(10,10+Dn+Zt)}return{...ee,hp:fe,maxHp:_e,ac:ke,initiative:Math.floor(Math.random()*20)+1}});console.log("⚔️ Prepared party characters:",K);const q=ht.initializeCombat(K,se,M.currentContent||"Combat encounter");console.log("⚔️ Combat initialized with turn order:",q.combatants.map((ee,fe)=>`${fe}: ${ee.name} (initiative: ${ee.initiative})`));const ue=await Bd(n,{storyContext:q.storyContext,partyMembers:q.combatants.filter(ee=>!ee.id.startsWith("enemy_")),enemies:q.combatants.filter(ee=>ee.id.startsWith("enemy_")),initiative:q.combatants.map(ee=>({id:ee.id,name:ee.name,initiative:ee.initiative})),currentTurn:q.currentTurn,round:q.round,combatState:q.combatState,environmentalFeatures:q.environmentalFeatures,teamUpOpportunities:q.teamUpOpportunities,narrativeElements:q.narrativeElements});console.log("⚔️ Combat session stored in database:",ue),Se(q),Fe(ue.id),le("active"),lt(q.combatants[0]),console.log("⚔️ Combat initialized:",q)}catch(se){console.error("❌ Error initializing combat:",se)}},[h,ht,Dt,n]);const jn=P.useCallback(async(M,V)=>{var se;try{if(ct){console.log("⚔️ Combat action already processing, skipping...");return}if(console.log("⚔️ Executing combat action:",M,"on target:",V),Ee(!0),!Z||!W){console.error("❌ No active combat session or current combatant"),Ee(!1);return}const K=await ht.executeAction(Z,W.id,M,V);if(!K.success){console.error("❌ Combat action failed:",K.message),Ee(!1);return}console.log("⚔️ Combat action result:",K);const q=K.combatSession;if(K.results&&K.results.damage>0){const fe=q.combatants.find(_e=>_e.id===V);if(fe){const _e=fe.hp;fe.hp=Math.max(0,fe.hp-K.results.damage),console.log(`⚔️ Applied ${K.results.damage} damage to ${fe.name}. HP: ${_e} → ${fe.hp}`),Dt({type:"damage",attacker:W.name,target:fe.name,damage:K.results.damage,targetHp:fe.hp,action:M,message:`${W.name} deals ${K.results.damage} damage to ${fe.name} (${fe.hp} HP remaining)`})}}else if(K.results&&K.results.healing>0){const fe=q.combatants.find(_e=>_e.id===V);fe&&Dt({type:"healing",healer:W.name,target:fe.name,healing:K.results.healing,action:M,message:`${W.name} heals ${fe.name} for ${K.results.healing} HP`})}else Dt({type:"action",actor:W.name,action:M,target:((se=q.combatants.find(fe=>fe.id===V))==null?void 0:se.name)||"None",message:`${W.name} uses ${M}`});console.log("⚔️ Updated combat session:",q),console.log("⚔️ Combatants after action:",q.combatants.map(fe=>`${fe.name}: ${fe.hp}/${fe.maxHp}`)),Se(q),ye&&await ai(ye,{currentTurn:q.currentTurn,round:q.round,combatState:q.combatState,partyMembers:q.combatants.filter(fe=>!fe.id.startsWith("enemy_")),enemies:q.combatants.filter(fe=>fe.id.startsWith("enemy_"))});const ue=q.combatants[q.currentTurn];lt(ue),setSelectedAction(null);const ee=ht.checkCombatEnd(q);if(ee.isComplete){console.log("⚔️ Combat ended:",ee),le("complete"),Dt({type:"combat_end",result:ee.result,message:ee.result==="victory"?"🎉 Victory! All enemies have been defeated!":ee.result==="defeat"?"💀 Defeat! The party has been overwhelmed!":"🤝 Combat ends in a draw."}),setTimeout(()=>{fr([])},5e3);const fe=ht.generateCombatSummary(q,ee),_e=ht.generateCombatNarrative(q,ee);await gn(s.id,{currentContent:_e,storyMetadata:{...s.storyMetadata,phaseStatus:"Storytelling",combatResult:ee}})}else q.combatants.filter(_e=>_e.id.startsWith("enemy_")&&_e.hp<=0&&_e.maxHp>0).forEach(_e=>{_e.maxHp=0,Dt({type:"enemy_death",enemy:_e.name,message:`💀 ${_e.name} has been defeated!`})});Ee(!1)}catch(K){console.error("❌ Error executing combat action:",K),Ee(!1)}},[Z,W,s==null?void 0:s.id,s==null?void 0:s.storyMetadata,ht,ct,ye]);return e?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),o.jsx("p",{className:"text-slate-300",children:"Loading campaign..."})]})}):S?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-red-400 mb-4",children:S}),o.jsxs("div",{className:"space-x-4",children:[o.jsx("button",{onClick:()=>{y(""),U()},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Retry"}),o.jsx("button",{onClick:()=>r("/dashboard"),className:"bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg transition-colors",children:"Back to Dashboard"})]})]})}):s?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:o.jsxs("div",{className:"container mx-auto px-4 py-6",children:[o.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-lg p-6 mb-6",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-3xl font-bold text-slate-200 mb-2",children:(a==null?void 0:a.name)||"Campaign Story"}),o.jsx("p",{className:"text-slate-300",children:(a==null?void 0:a.description)||"Adventure awaits!"})]}),o.jsx("div",{className:"text-right",children:o.jsxs("div",{className:"text-slate-300 text-sm",children:["Status: ",o.jsx("span",{className:"font-semibold text-slate-200",children:(s==null?void 0:s.status)||"unknown"})]})})]})}),(s==null?void 0:s.status)==="ready_up"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-3",children:"Campaign Lobby"}),o.jsx("p",{className:"text-slate-300 text-lg",children:"Waiting for all players to ready up"}),o.jsxs("div",{className:"mt-8 mb-8",children:[o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-4",children:[o.jsxs("div",{className:"text-2xl font-semibold text-slate-300",children:[Rn(),"/",bt()," Players Ready"]}),o.jsxs("div",{className:"text-lg text-slate-400",children:["(",Math.round(Rn()/bt()*100),"%)"]})]}),o.jsx("div",{className:"w-full bg-slate-700 rounded-full h-4 max-w-lg mx-auto",children:o.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-400 h-4 rounded-full transition-all duration-500",style:{width:`${Rn()/bt()*100}%`}})})]})]}),o.jsxs("div",{className:"text-center",children:[G?o.jsx("div",{className:"text-green-400 font-semibold text-xl bg-green-900/30 px-6 py-3 rounded-xl",children:"You are ready!"}):o.jsx("div",{className:"space-y-4",children:h.find(M=>M.userId===(t==null?void 0:t.uid))?o.jsx("button",{onClick:ge,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Ready Up"}):o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-slate-300",children:"You need to create a character first"}),o.jsx("button",{onClick:()=>r(`/character-creation/${n}`),className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Create Character"})]})}),pe&&(a==null?void 0:a.dmId)===(t==null?void 0:t.uid)&&o.jsx("div",{className:"mt-6",children:o.jsx("button",{onClick:Ne,disabled:g||B,className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:g||B?"Generating Story...":"Start Story Generation"})}),pe&&(a==null?void 0:a.dmId)!==(t==null?void 0:t.uid)&&o.jsx("div",{className:"mt-6",children:o.jsx("div",{className:"text-blue-400 font-semibold text-lg bg-blue-900/30 px-6 py-3 rounded-xl",children:"Waiting for Dungeon Master to start the story..."})})]})]}),(s==null?void 0:s.status)==="generating"&&o.jsx("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-4",children:"Generating Your Adventure"}),o.jsx("p",{className:"text-slate-300 text-lg mb-8",children:"The Dungeon Master is crafting your story. This may take a moment..."}),o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-400"}),o.jsx("div",{className:"text-slate-300 font-semibold text-lg",children:"Creating Story Plots..."})]})]})}),(s==null?void 0:s.status)==="generating_story"&&o.jsx("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-4",children:"Crafting Your Story"}),o.jsx("p",{className:"text-slate-300 text-lg mb-8",children:"The Dungeon Master is weaving the tale of your adventure..."}),o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-400"}),o.jsx("div",{className:"text-slate-300 font-semibold text-lg",children:"Generating Story Content..."})]}),(s==null?void 0:s.selectedPlotData)&&o.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 max-w-2xl mx-auto",children:[o.jsxs("h3",{className:"text-slate-200 font-semibold mb-2",children:["Selected Plot: ",s.selectedPlotData.title]}),o.jsx("p",{className:"text-slate-300 text-sm",children:s.selectedPlotData.description})]})]})}),(s==null?void 0:s.status)==="voting"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-6 text-center",children:"Choose Your Adventure"}),o.jsx("div",{className:"mb-4 flex justify-center",children:o.jsx("button",{onClick:()=>je(!ce),className:"bg-slate-700 hover:bg-slate-600 text-slate-300 px-4 py-2 rounded-lg text-sm transition-colors",children:ce?"Hide Debug":"Show Debug"})}),ce&&o.jsxs("div",{className:"mb-4 p-4 bg-slate-700/50 rounded-lg",children:[o.jsxs("p",{className:"text-slate-300 text-sm",children:["Debug: Available plots count: ",((R=s==null?void 0:s.availablePlots)==null?void 0:R.length)||0]}),o.jsxs("p",{className:"text-slate-300 text-sm",children:["Debug: Raw plots: ",JSON.stringify((te=s==null?void 0:s.availablePlots)==null?void 0:te.slice(0,2))]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Array.isArray(s==null?void 0:s.availablePlots)&&s.availablePlots.length>0?s.availablePlots.map((M,V)=>o.jsxs("div",{className:"bg-slate-800/70 border-2 border-slate-600 rounded-xl p-6 hover:border-slate-500 transition-all duration-300",children:[o.jsx("h3",{className:"font-bold text-slate-200 text-xl mb-3",children:M.title}),o.jsx("p",{className:"text-slate-300 mb-4",children:M.description||"Adventure description here..."}),M.campaignLength&&o.jsxs("div",{className:"mb-4",children:[o.jsx("span",{className:"text-slate-400 text-sm",children:"Length: "}),o.jsx("span",{className:"text-slate-200 font-semibold capitalize",children:M.campaignLength})]}),(a==null?void 0:a.dmId)===(t==null?void 0:t.uid)?o.jsx("button",{onClick:()=>$t(V),disabled:g,className:"w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Selecting...":"Choose This Plot"}):o.jsx("div",{className:"text-center py-3",children:o.jsx("span",{className:"text-slate-400 text-sm",children:"Waiting for DM to choose..."})})]},V)):o.jsxs("div",{className:"col-span-3 text-center",children:[o.jsx("p",{className:"text-slate-300",children:"No plots available. Please try generating the story again."}),(a==null?void 0:a.dmId)===(t==null?void 0:t.uid)&&o.jsx("button",{onClick:Ne,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors",children:"Regenerate Plots"})]})}),(a==null?void 0:a.dmId)!==(t==null?void 0:t.uid)&&o.jsx("div",{className:"text-center mt-6",children:o.jsx("p",{className:"text-slate-300 text-lg",children:"Waiting for the Dungeon Master to select a plot..."})})]}),(s==null?void 0:s.status)==="storytelling"&&o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[o.jsx("div",{className:"lg:col-span-1",children:o.jsxs("div",{className:"flex flex-col gap-y-6 lg:sticky lg:top-6",children:[o.jsxs("div",{className:"hidden lg:block bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsx("h3",{className:"font-bold text-slate-200",children:"Party Members"}),o.jsx("button",{onClick:()=>je(!ce),className:"text-xs bg-slate-600 hover:bg-slate-500 px-2 py-1 rounded text-slate-200",children:ce?"Hide Debug":"Show Debug"})]}),ce&&o.jsxs("div",{className:"mb-2 p-2 bg-slate-700/50 rounded text-xs",children:[o.jsxs("p",{className:"text-slate-300",children:["Debug: Characters loaded: ",h.length]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Party members: ",u.length]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Characters: ",JSON.stringify(h.map(M=>({name:M.name,userId:M.userId})))]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Current Speaker: ",JSON.stringify(s==null?void 0:s.currentSpeaker)]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: User UID: ",t==null?void 0:t.uid]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Party DM ID: ",a==null?void 0:a.dmId]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Is DM speaking: ",((me=s==null?void 0:s.currentSpeaker)==null?void 0:me.id)==="dm"?"Yes":"No"]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Is user DM: ",(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)?"Yes":"No"]})]}),o.jsx("div",{className:"space-y-2",children:mn().map(M=>{var q,ue,ee,fe,_e;const V=((q=s==null?void 0:s.currentSpeaker)==null?void 0:q.userId)===M.userId;t==null||t.uid,M.userId;const se=de==="active"&&((ee=(ue=Z==null?void 0:Z.combatants)==null?void 0:ue[Z.currentTurn])==null?void 0:ee.userId)===M.userId,K=de!=="active"&&(((fe=s==null?void 0:s.currentSpeaker)==null?void 0:fe.userId)===(t==null?void 0:t.uid)||((_e=s==null?void 0:s.currentSpeaker)==null?void 0:_e.id)==="dm"&&(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)||!(s!=null&&s.currentSpeaker)&&(t==null?void 0:t.uid)===(a==null?void 0:a.dmId))&&!V;return o.jsxs("div",{className:`p-2 rounded transition-colors ${V?"bg-blue-600/30 border border-blue-500":K?"bg-slate-700/50 hover:bg-slate-600/50 cursor-pointer":"bg-slate-700/30 opacity-60 cursor-not-allowed"}`,onClick:K?()=>pr(M):void 0,children:[o.jsx("div",{className:"font-semibold text-slate-200 text-xs",children:M.name}),o.jsxs("div",{className:"text-slate-400 text-xs",children:[M.race," ",M.class]}),de==="active"?se?o.jsx("div",{className:"text-yellow-400 text-xs mt-1",children:"🎲 Current Turn"}):o.jsx("div",{className:"text-red-400 text-xs mt-1",children:"⚔️ Combat Active"}):V&&o.jsx("div",{className:"text-blue-400 text-xs mt-1",children:"Currently Speaking"}),!K&&!V&&de!=="active"&&o.jsx("div",{className:"text-slate-500 text-xs mt-1",children:"Waiting for turn..."}),K&&!V&&o.jsx("div",{className:"text-green-400 text-xs mt-1",children:"Click to select"})]},M.id)})})]}),(s==null?void 0:s.campaignMetadata)&&de!=="active"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Campaign Progress"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Session:"}),o.jsx("span",{className:"text-slate-200 font-semibold",children:s.campaignMetadata.sessionNumber})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Progress:"}),o.jsxs("span",{className:"text-slate-200 font-semibold",children:[s.campaignMetadata.campaignProgress,"%"]})]})]})]}),j.length>0&&de!=="active"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Objectives"}),o.jsx("div",{className:"space-y-2",children:j.map((M,V)=>o.jsxs("div",{className:"text-sm",children:[o.jsx("div",{className:"text-slate-300",children:M.title}),o.jsx("div",{className:"text-slate-400 text-xs",children:M.description})]},V))})]})]})}),o.jsxs("div",{className:"lg:col-span-3",children:[(s==null?void 0:s.currentContent)&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 mb-8 shadow-lg",children:[o.jsx("div",{className:"mb-6",children:o.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2 border-b border-slate-600 pb-3",children:"📖 Current Story"})}),o.jsx("div",{className:"text-slate-200 leading-8 text-lg max-w-none prose prose-invert prose-lg prose-slate",style:{lineHeight:"1.8",fontSize:"1.125rem",letterSpacing:"0.025em"},dangerouslySetInnerHTML:{__html:L(s.currentContent)}}),(s==null?void 0:s.storyMetadata)&&o.jsxs("div",{className:"mt-6 p-4 bg-slate-700/30 rounded-lg border border-slate-600",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.storyMetadata.currentLocation&&o.jsxs("div",{children:[o.jsx("span",{className:"text-blue-400 font-semibold",children:"📍 Location:"}),o.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.currentLocation})]}),s.storyMetadata.storyTone&&o.jsxs("div",{children:[o.jsx("span",{className:"text-purple-400 font-semibold",children:"🎭 Tone:"}),o.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.storyTone})]}),s.storyMetadata.activeNPCs&&s.storyMetadata.activeNPCs.length>0&&o.jsxs("div",{children:[o.jsx("span",{className:"text-green-400 font-semibold",children:"👥 Active NPCs:"}),o.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.activeNPCs.join(", ")})]}),s.storyMetadata.phaseStatus&&o.jsxs("div",{children:[o.jsx("span",{className:"text-orange-400 font-semibold",children:"📊 Phase:"}),o.jsx("span",{className:"text-slate-300 ml-2 capitalize",children:s.storyMetadata.phaseStatus})]})]}),s.storyMetadata.nextActions&&s.storyMetadata.nextActions.length>0&&o.jsxs("div",{className:"mt-4",children:[o.jsx("span",{className:"text-yellow-400 font-semibold",children:"🎯 Possible Actions:"}),o.jsx("ul",{className:"mt-2 space-y-1",children:s.storyMetadata.nextActions.map((M,V)=>o.jsxs("li",{className:"text-slate-300 text-sm",children:["• ",M]},V))})]})]})]}),Ge&&o.jsx("div",{className:"bg-gradient-to-br from-blue-800/50 to-blue-700/50 border border-blue-600 rounded-lg p-6 mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-blue-200 text-lg font-semibold mb-2",children:"⚔️ Combat is Loading..."}),o.jsx("div",{className:"text-blue-300 text-sm",children:"Preparing combat encounter..."}),o.jsx("div",{className:"mt-3 text-blue-400 text-xs",children:"Waiting for all players to be ready..."})]})}),de==="active"&&Z&&o.jsxs("div",{className:"bg-gradient-to-br from-red-800/50 to-red-700/50 border border-red-600 rounded-lg p-6 mb-6",children:[o.jsxs("div",{className:"mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-red-100 mb-2 border-b border-red-600 pb-2",children:"⚔️ Combat Encounter"}),o.jsxs("div",{className:"text-red-200 text-sm",children:["Round: ",Z.round," | Turn: ",Z.currentTurn+1]}),o.jsxs("div",{className:"mt-3 p-3 bg-slate-800/30 rounded-lg",children:[o.jsx("h5",{className:"text-slate-300 font-medium mb-2",children:"Turn Order (Initiative):"}),o.jsx("div",{className:"flex flex-wrap gap-1",children:Z.combatants.map((M,V)=>o.jsxs("div",{className:`px-2 py-1 rounded text-xs font-medium ${V===Z.currentTurn?"bg-yellow-600 text-yellow-100 border border-yellow-500":"bg-slate-700 text-slate-300"}`,children:[V+1,". ",M.name," (",M.initiative,")"]},M.id))})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-green-400 font-semibold mb-2",children:"Party Members"}),o.jsx("div",{className:"space-y-2",children:(ve=Z.combatants)==null?void 0:ve.filter(M=>!M.id.startsWith("enemy_")).map(M=>o.jsxs("div",{className:`p-2 rounded ${M.id===(W==null?void 0:W.id)?"bg-green-600/30 border border-green-500":"bg-slate-700/30"}`,children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-slate-200 font-medium",children:M.name}),o.jsxs("span",{className:"text-slate-300 text-sm",children:["HP: ",M.hp||0,"/",M.maxHp||0]})]}),M.id===(W==null?void 0:W.id)&&o.jsx("div",{className:"text-green-400 text-xs mt-1",children:"Current Turn"})]},M.id))})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-red-400 font-semibold mb-2",children:"Enemies"}),o.jsx("div",{className:"space-y-2",children:(xe=Z.combatants)==null?void 0:xe.filter(M=>M.id.startsWith("enemy_")).map(M=>o.jsxs("div",{className:`p-2 rounded ${M.id===(W==null?void 0:W.id)?"bg-red-600/30 border border-red-500":"bg-slate-700/30"}`,children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-slate-200 font-medium",children:M.name}),o.jsxs("span",{className:"text-slate-300 text-sm",children:["HP: ",M.hp||0,"/",M.maxHp||0]})]}),M.id===(W==null?void 0:W.id)&&o.jsx("div",{className:"text-red-400 text-xs mt-1",children:"Current Turn"})]},M.id))})]})]}),W&&!W.id.startsWith("enemy_")&&(W.userId===(t==null?void 0:t.uid)||!W.userId)&&o.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[o.jsxs("h4",{className:"text-blue-400 font-semibold mb-3",children:["Actions for ",W.name]}),ct&&o.jsx("div",{className:"mb-3 p-2 bg-blue-600/30 border border-blue-500 rounded text-blue-200 text-sm",children:"⚔️ Processing combat action..."}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:Object.entries(ht.actionTypes).map(([M,V])=>o.jsx("button",{onClick:()=>setSelectedAction(M),disabled:ct,className:`p-2 rounded text-sm transition-colors ${selectedAction===M?"bg-blue-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-200"} disabled:opacity-50 disabled:cursor-not-allowed`,children:V.name},M))}),selectedAction&&o.jsxs("div",{className:"mt-4",children:[o.jsx("h5",{className:"text-slate-300 font-medium mb-2",children:"Select Target:"}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:(re=Z.combatants)==null?void 0:re.filter(M=>M.id!==W.id).map(M=>o.jsx("button",{onClick:()=>jn(selectedAction,M.id),disabled:ct,className:"p-2 rounded bg-slate-700 hover:bg-slate-600 text-slate-200 text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:ct?"Processing...":M.name},M.id))})]})]}),de==="active"&&W&&!W.id.startsWith("enemy_")&&W.userId!==(t==null?void 0:t.uid)&&W.userId&&o.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[o.jsxs("h4",{className:"text-orange-400 font-semibold mb-3",children:["⚠️ Fallback Actions for ",W.name]}),o.jsx("p",{className:"text-slate-300 text-sm mb-3",children:"User ID mismatch detected. Showing actions anyway."}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:Object.entries(ht.actionTypes).map(([M,V])=>o.jsx("button",{onClick:()=>setSelectedAction(M),disabled:ct,className:`p-2 rounded text-sm transition-colors ${selectedAction===M?"bg-orange-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-200"} disabled:opacity-50 disabled:cursor-not-allowed`,children:V.name},M))}),selectedAction&&o.jsxs("div",{className:"mt-4",children:[o.jsx("h5",{className:"text-slate-300 font-medium mb-2",children:"Select Target:"}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:(De=Z.combatants)==null?void 0:De.filter(M=>M.id!==W.id).map(M=>o.jsx("button",{onClick:()=>jn(selectedAction,M.id),disabled:ct,className:"p-2 rounded bg-slate-700 hover:bg-slate-600 text-slate-200 text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:ct?"Processing...":M.name},M.id))})]})]}),de==="active"&&o.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 mt-4",children:[o.jsx("h4",{className:"text-yellow-400 font-semibold mb-3",children:"🐛 Combat Debug Info"}),o.jsxs("div",{className:"text-xs text-slate-300 space-y-1",children:[o.jsxs("div",{children:["Combat State: ",de]}),o.jsxs("div",{children:["Current Combatant: ",(W==null?void 0:W.name)||"None"," (ID: ",(W==null?void 0:W.id)||"None",")"]}),o.jsxs("div",{children:["Current User: ",(t==null?void 0:t.uid)||"None"]}),o.jsxs("div",{children:["Combatant User ID: ",(W==null?void 0:W.userId)||"None"]}),o.jsxs("div",{children:["Is Enemy: ",(At=W==null?void 0:W.id)!=null&&At.startsWith("enemy_")?"Yes":"No"]}),o.jsxs("div",{children:["User Match: ",(W==null?void 0:W.userId)===(t==null?void 0:t.uid)?"Yes":"No"]}),o.jsxs("div",{children:["Should Show Actions: ",W&&!W.id.startsWith("enemy_")&&W.userId===(t==null?void 0:t.uid)?"Yes":"No"]}),o.jsxs("div",{children:["Combat Session: ",Z?"Active":"None"]}),o.jsxs("div",{children:["Current Turn: ",(Z==null?void 0:Z.currentTurn)||"None"]}),o.jsxs("div",{children:["Total Combatants: ",((yt=Z==null?void 0:Z.combatants)==null?void 0:yt.length)||0]})]}),W&&!W.id.startsWith("enemy_")&&o.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-700",children:[o.jsx("h5",{className:"text-yellow-400 font-medium mb-2",children:"Manual Action Trigger"}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsx("button",{onClick:()=>{const M=Z.combatants.filter(V=>V.id.startsWith("enemy_"));M.length>0&&jn("attack",M[0].id)},disabled:ct,className:"p-2 rounded bg-red-700 hover:bg-red-600 text-white text-xs transition-colors disabled:opacity-50",children:"Attack First Enemy"}),o.jsx("button",{onClick:()=>{const M=Z.combatants.filter(V=>!V.id.startsWith("enemy_")&&V.id!==W.id);M.length>0&&jn("defend",M[0].id)},disabled:ct,className:"p-2 rounded bg-blue-700 hover:bg-blue-600 text-white text-xs transition-colors disabled:opacity-50",children:"Defend Ally"})]})]})]}),W&&!W.id.startsWith("enemy_")&&W.userId!==(t==null?void 0:t.uid)&&o.jsxs("div",{className:"bg-blue-800/30 rounded-lg p-4 text-center",children:[o.jsxs("div",{className:"text-blue-300 font-medium",children:["Player Turn: ",W.name]}),o.jsxs("div",{className:"text-blue-400 text-sm mt-1",children:["Waiting for ",W.name," to take their action..."]})]}),W&&W.id.startsWith("enemy_")&&o.jsxs("div",{className:"bg-red-800/30 rounded-lg p-4 text-center",children:[o.jsxs("div",{className:"text-red-300 font-medium",children:["Enemy Turn: ",W.name]}),o.jsx("div",{className:"text-red-400 text-sm mt-1",children:"Processing enemy action..."})]}),Yt.length>0&&o.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 mt-4",children:[o.jsx("h4",{className:"text-yellow-400 font-semibold mb-3",children:"📜 Battle Log"}),o.jsx("div",{className:"max-h-40 overflow-y-auto space-y-2",children:Yt.slice(-10).map(M=>o.jsx("div",{className:`text-sm p-2 rounded ${M.type==="damage"?"bg-red-800/30 border-l-4 border-red-500":M.type==="healing"?"bg-green-800/30 border-l-4 border-green-500":M.type==="combat_start"?"bg-blue-800/30 border-l-4 border-blue-500":M.type==="enemy_death"?"bg-purple-800/30 border-l-4 border-purple-500":M.type==="combat_end"?"bg-yellow-800/30 border-l-4 border-yellow-500":"bg-slate-800/30 border-l-4 border-slate-500"}`,children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsx("span",{className:"text-slate-200",children:M.message}),o.jsx("span",{className:"text-slate-400 text-xs ml-2",children:M.timestamp})]})},M.id))})]})]}),s!=null&&s.currentSpeaker&&de!=="active"?o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mb-6",children:[o.jsxs("h3",{className:"font-bold text-slate-200 mb-4",children:["Current Speaker: ",s.currentSpeaker.name]}),((Zs=s==null?void 0:s.currentSpeaker)==null?void 0:Zs.userId)===(t==null?void 0:t.uid)||((Xt=s==null?void 0:s.currentSpeaker)==null?void 0:Xt.id)==="dm"&&(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)?o.jsxs("div",{className:"space-y-4",children:[o.jsx("textarea",{value:k,onChange:M=>b(M.target.value),placeholder:((gr=s==null?void 0:s.currentSpeaker)==null?void 0:gr.id)==="dm"?"Continue the story or describe what happens next...":`What does ${s.currentSpeaker.name} do?`,className:"w-full bg-slate-800/50 border border-slate-600 text-slate-100 px-4 py-3 rounded-lg focus:border-slate-500 focus:outline-none transition-colors min-h-[120px] resize-none",rows:4}),o.jsx("div",{className:"flex space-x-3",children:o.jsx("button",{onClick:Ut,disabled:!k.trim()||g,className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Processing...":((ei=s==null?void 0:s.currentSpeaker)==null?void 0:ei.id)==="dm"?"Continue Story":"Send Response"})})]}):o.jsxs("p",{className:"text-slate-300",children:["Waiting for ",s.currentSpeaker.name," to respond..."]})]}):de!=="active"&&(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mb-6",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-4",children:"Dungeon Master Response"}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("textarea",{value:k,onChange:M=>b(M.target.value),placeholder:"Continue the story or describe what happens next...",className:"w-full bg-slate-800/50 border border-slate-600 text-slate-100 px-4 py-3 rounded-lg focus:border-slate-500 focus:outline-none transition-colors min-h-[120px] resize-none",rows:4}),o.jsx("div",{className:"flex space-x-3",children:o.jsx("button",{onClick:Ut,disabled:!k.trim()||g,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Processing...":"Continue Story"})})]})]}),o.jsxs("div",{className:"lg:hidden bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4 mb-6",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Party Members"}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:mn().map(M=>{var q,ue,ee,fe,_e;const V=((q=s==null?void 0:s.currentSpeaker)==null?void 0:q.userId)===M.userId;t==null||t.uid,M.userId;const se=de==="active"&&((ee=(ue=Z==null?void 0:Z.combatants)==null?void 0:ue[Z.currentTurn])==null?void 0:ee.userId)===M.userId,K=de!=="active"&&(((fe=s==null?void 0:s.currentSpeaker)==null?void 0:fe.userId)===(t==null?void 0:t.uid)||((_e=s==null?void 0:s.currentSpeaker)==null?void 0:_e.id)==="dm"&&(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)||!(s!=null&&s.currentSpeaker)&&(t==null?void 0:t.uid)===(a==null?void 0:a.dmId))&&!V;return o.jsxs("div",{className:`p-2 rounded transition-colors ${V?"bg-blue-600/30 border border-blue-500":K?"bg-slate-700/50 hover:bg-slate-600/50 cursor-pointer":"bg-slate-700/30 opacity-60 cursor-not-allowed"}`,onClick:K?()=>pr(M):void 0,children:[o.jsx("div",{className:"font-semibold text-slate-200 text-xs",children:M.name}),o.jsxs("div",{className:"text-slate-400 text-xs",children:[M.race," ",M.class]}),de==="active"?se?o.jsx("div",{className:"text-yellow-400 text-xs mt-1",children:"🎲 Current Turn"}):o.jsx("div",{className:"text-red-400 text-xs mt-1",children:"⚔️ Combat Active"}):V&&o.jsx("div",{className:"text-blue-400 text-xs mt-1",children:"Currently Speaking"}),!K&&!V&&de!=="active"&&o.jsx("div",{className:"text-slate-500 text-xs mt-1",children:"Waiting for turn..."}),K&&!V&&o.jsx("div",{className:"text-green-400 text-xs mt-1",children:"Click to select"})]},M.id)})})]}),(s==null?void 0:s.storyMessages)&&s.storyMessages.length>0&&de!=="active"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mt-8 shadow-lg",children:[o.jsx("div",{className:"mb-6",children:o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-2 border-b border-slate-600 pb-3",children:"📜 Story History"})}),o.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:s.storyMessages.map((M,V)=>o.jsxs("div",{className:"border-l-4 border-slate-500 pl-4 py-2 bg-slate-800/30 rounded-r-lg",children:[o.jsxs("div",{className:"text-slate-300 text-sm font-semibold mb-2 flex items-center",children:[o.jsx("span",{className:"mr-2",children:"👤"}),M.speaker||"Narrator"]}),o.jsx("div",{className:"text-slate-400 text-sm leading-6 pl-6 border-l border-slate-600",dangerouslySetInnerHTML:{__html:L(M.content)}})]},V))})]}),S&&o.jsx("div",{className:"bg-gradient-to-r from-red-900/50 to-red-800/50 border border-red-600 rounded-lg p-4 mb-6",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"text-red-400 text-xl",children:"⚠️"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-red-200 mb-2",children:"Notice"}),o.jsx("p",{className:"text-red-100 text-sm mb-3",children:S}),S.includes("AI service")&&o.jsxs("div",{className:"bg-red-800/30 border border-red-600 rounded p-3",children:[o.jsxs("p",{className:"text-red-200 text-xs mb-2",children:[o.jsx("strong",{children:"What this means:"})," The AI storytelling service is temporarily unavailable."]}),o.jsx("p",{className:"text-red-200 text-xs mb-2",children:o.jsx("strong",{children:"You can still:"})}),o.jsxs("ul",{className:"text-red-200 text-xs list-disc list-inside space-y-1",children:[o.jsx("li",{children:"Continue the story manually by typing your responses"}),o.jsx("li",{children:"Use the predefined plot options if available"}),o.jsx("li",{children:"Wait a few minutes and try again"})]})]})]}),o.jsx("button",{onClick:()=>y(""),className:"text-red-400 hover:text-red-200 transition-colors",children:"✕"})]})}),ce&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-900/50 to-slate-800/50 border border-slate-600 rounded-lg p-6 mb-6",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-4",children:"🐛 Debug Information"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:"Story State"}),o.jsxs("div",{className:"space-y-1 text-slate-400",children:[o.jsxs("div",{children:["Story ID: ",(s==null?void 0:s.id)||"None"]}),o.jsxs("div",{children:["Status: ",(s==null?void 0:s.status)||"None"]}),o.jsxs("div",{children:["Phase: ",((Ai=s==null?void 0:s.storyMetadata)==null?void 0:Ai.phaseStatus)||"None"]}),o.jsxs("div",{children:["Ready Players: ",((tr=s==null?void 0:s.readyPlayers)==null?void 0:tr.length)||0,"/",u.length]}),o.jsxs("div",{children:["Current Speaker: ",((Da=s==null?void 0:s.currentSpeaker)==null?void 0:Da.name)||"None"]})]})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:"User State"}),o.jsxs("div",{className:"space-y-1 text-slate-400",children:[o.jsxs("div",{children:["User ID: ",(t==null?void 0:t.uid)||"None"]}),o.jsxs("div",{children:["Is DM: ",(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)?"Yes":"No"]}),o.jsxs("div",{children:["Is Ready: ",G?"Yes":"No"]}),o.jsxs("div",{children:["All Ready: ",pe?"Yes":"No"]}),o.jsxs("div",{children:["Combat State: ",de]}),o.jsxs("div",{children:["Combat Loading: ",Ge?"Yes":"No"]}),o.jsxs("div",{children:["Has Navigated: ",Je?"Yes":"No"]})]})]})]}),(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)&&o.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-600",children:[o.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:"⚔️ Manual Combat Controls"}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>{console.log("🎮 DM manually triggering combat..."),wt(!0),Jt(!0),console.log("🔍 Debugging party members for manual combat:",u),console.log("🔍 Debugging party characters for manual combat:",h);const V=(h.length>0?h:u).map((K,q)=>{if(console.log(`🔍 Validating member ${q} for manual combat:`,K),typeof K=="string"){console.log(`⚠️ Member ${q} is a user ID string, creating basic character object for manual combat`);const ee={id:`member_${q}`,name:`Player ${q+1}`,userId:K,race:"Unknown",class:"Unknown",level:1,initiative:Math.floor(Math.random()*20)+1,hp:10,maxHp:10,ac:10};return console.log("✅ Created basic character for user ID in manual combat:",ee),ee}const ue={id:K.id||`member_${q}`,name:K.name||`Unknown Member ${q}`,userId:K.userId||null,race:K.race||"Unknown",class:K.class||"Unknown",level:K.level||1,initiative:K.initiative||Math.floor(Math.random()*20)+1,hp:K.hp||K.maxHp||10,maxHp:K.maxHp||K.hp||10,ac:K.ac||10,...Object.fromEntries(Object.entries(K).filter(([ee,fe])=>fe!=null&&ee!=="id"&&ee!=="name"&&ee!=="userId"&&ee!=="race"&&ee!=="class"&&ee!=="level"&&ee!=="initiative"&&ee!=="hp"&&ee!=="maxHp"&&ee!=="ac"))};return console.log(`✅ Cleaned member ${q} for manual combat:`,ue),ue});console.log("✅ Final validated party members for manual combat:",V);const se={partyId:n,partyMembers:V,enemies:[],storyContext:(s==null?void 0:s.currentContent)||"Manual combat encounter",combatState:"initialized",currentTurn:0,round:1,environmentalFeatures:[],teamUpOpportunities:[],narrativeElements:[]};console.log("✅ Final combat session object for manual combat:",se),Bd(n,se).then(()=>{console.log("⚔️ Manual combat session created, navigating..."),r(`/combat/${n}`)}).catch(K=>{console.error("❌ Failed to create manual combat session:",K),Jt(!1),wt(!1)})},disabled:Ge||Je,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:Ge?"Loading...":"Trigger Combat"}),o.jsx("button",{onClick:()=>{wt(!1),Jt(!1),console.log("🔄 Reset combat navigation state")},className:"bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors",children:"Reset State"})]})]})]})]})]}),_&&o.jsx(h_,{validation:A,onClose:ut,onProceed:Ar,onRevise:Ze}),N&&o.jsx(m_,{diceResult:Me,onClose:Ir})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-slate-300",children:"Story not found"}),o.jsx("button",{onClick:()=>r("/dashboard"),className:"mt-4 bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg transition-colors",children:"Back to Dashboard"})]})})}function qR(){var pr,er,Wn,as,Dt,jn;const{partyId:t}=uf(),e=Zn(),n=Ys(),[r,s]=P.useState(null),[i,a]=P.useState(null),[c,u]=P.useState(!0),[d,h]=P.useState([]),[f,g]=P.useState(null),[x,S]=P.useState(null),[y,k]=P.useState(""),[b,w]=P.useState(""),[I,j]=P.useState([]),[$,H]=P.useState([]),[E,_]=P.useState([]),[C,A]=P.useState(!1),[D,N]=P.useState(""),[T,Me]=P.useState(""),[Pe,Re]=P.useState(!1),[Te,G]=P.useState(!1),[ie,pe]=P.useState(null),[J,B]=P.useState(-1),[X,ce]=P.useState(null),[je,de]=P.useState(!1),[le,Z]=P.useState(!1),[Se,ye]=P.useState(new Set),[Fe,W]=P.useState([]),[lt,ct]=P.useState(!1),Ee=(pr=n.state)==null?void 0:pr.isTestCombat,Yt=n.state;P.useEffect(()=>{const R=ja(te=>{if(!te){e("/login");return}s(te)});return()=>R()},[e]),P.useEffect(()=>{Ee&&Yt?fr():t&&Je()},[Ee,Yt,t]),P.useEffect(()=>{if(t&&!Ee){const R=d_(t,te=>{var me;if(a(te),u(!1),te){wt(te),H(te.environmentalFeatures||[]),_(te.teamUpOpportunities||[]),ge();const ve=(me=te.combatants)==null?void 0:me[te.currentTurn];ve&&ve.id.startsWith("enemy_")&&te.combatState==="active"&&te.currentTurn!==J&&!Pe&&!C&&(console.log("Auto-processing enemy turn for:",ve.name,"turn:",te.currentTurn),B(te.currentTurn),setTimeout(()=>{Rn()},1e3))}});return()=>R()}},[t,J,Pe,C,Ee]),P.useEffect(()=>{if(Ee&&i&&i.combatState==="active"){const R=L();if(R&&R.id.startsWith("enemy_")){const te=setTimeout(()=>{Rn()},2e3);return()=>clearTimeout(te)}}},[i==null?void 0:i.currentTurn,Ee]),P.useEffect(()=>{if(i&&le&&Ut()){const R=setTimeout(()=>{Z(!1),ye(new Set),bt()},1e3);return()=>clearTimeout(R)}},[le,Se.size,(er=i==null?void 0:i.partyMembers)==null?void 0:er.length]),P.useEffect(()=>{i&&i.combatState==="active"&&wt(i)},[i==null?void 0:i.currentTurn,i==null?void 0:i.combatState]);const fr=async()=>{try{u(!0);const te={id:"test_combat_session",partyMembers:Yt.partyMembers.map(xe=>{if(!xe.hp||!xe.maxHp||!xe.ac){const{class:re,level:De,constitution:At,dexterity:yt}=xe,Xt={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[re]||8,gr=Math.floor((At-10)/2),ei=Math.max(1,(Xt+gr)*De),Ai=10,tr=Math.floor((yt-10)/2),M={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[re]||0,V=Math.max(10,Ai+tr+M);return{...xe,hp:ei,maxHp:ei,ac:V}}return xe})||[],enemies:Yt.enemies||[],storyContext:Yt.storyContext||"Test combat environment",combatState:"initialized",currentTurn:0,combatants:[],round:1};if(!te.enemies||te.enemies.length===0){console.error("No enemies provided for test combat!"),a({...te,status:"no_enemies",combatState:"ended"}),u(!1);return}const me=fs.initializeCombat(te.partyMembers,te.enemies,te.storyContext),ve={...te,...me,currentTurn:0,combatState:"active"};a(ve),u(!1),wt(ve),H(ve.environmentalFeatures||[]),_(ve.teamUpOpportunities||[])}catch(R){console.error("Error initializing test combat:",R),u(!1)}},Je=async()=>{if(t)try{u(!0);const R=await _0(t);if(!R){try{e(`/campaign/${t}`)}catch(me){console.error("Navigation error in loadCombatData:",me),e("/dashboard")}return}const te=await Xo(t);try{await TR(t);const me=await Xo(t);h(me)}catch(me){console.warn("Failed to update character stats:",me),h(te)}if(R.enemies&&R.enemies.length===0&&!Ee){a({...R,status:"no_enemies"});return}a(R),wt(R),H(R.environmentalFeatures||[]),_(R.teamUpOpportunities||[])}catch(R){console.error("Error loading combat data:",R)}finally{u(!1)}},wt=R=>{var re;const te=L(R);if(!te)return;const me=[],ve=te.cooldowns||{};Object.entries(fs.actionTypes).forEach(([De,At])=>{(ve[De]===0||ve[De]===void 0)&&me.push({type:De,name:At.name,description:At.description,priority:At.priority,narrativeTemplate:At.narrativeTemplate})});const xe=fs.classAbilities[(re=te.class)==null?void 0:re.toLowerCase()];xe&&(ve.special===0||ve.special===void 0)&&me.push({type:"special",name:xe.name,description:xe.description,priority:"high",narrativeTemplate:"{character} uses their {ability}!"}),$.length>0&&me.push({type:"environmental",name:"Use Environment",description:"Use the environment to your advantage",priority:"normal",narrativeTemplate:"{character} uses the {environment} to their advantage!"}),E.length>0&&me.push({type:"teamUp",name:"Team Up",description:"Coordinate with another party member",priority:"high",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}),j(me)},Ge=R=>{const te=new Date().toLocaleTimeString(),me={id:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:te,round:(i==null?void 0:i.round)||1,turn:(i==null?void 0:i.currentTurn)||0,...R};W(ve=>[...ve,me])},Jt=async()=>{if(i)try{Re(!0),W([]);const R={...i,combatState:"ready",currentTurn:0,round:1};Ee?(a(R),wt(R)):await ai(t,R),Ge({type:"combat_start",description:"Combat is ready to begin!"})}catch(R){console.error("Error starting combat:",R)}finally{Re(!1)}},is=async()=>{if(i)try{Re(!0);const R={...i,combatState:"active"};Ee?(a(R),wt(R)):await ai(t,R),Ge({type:"combat_begin",description:"Fight!"}),ct(!0)}catch(R){console.error("Error beginning combat:",R)}finally{Re(!1)}},ht=async(R,te,me={})=>{if(!(!i||Pe))try{Re(!0),k(""),w("");const ve=L();if(!ve)throw new Error("No current combatant found");const xe=i.combatants.find(At=>At.id===te);if(!xe)throw new Error("Target not found");const re=await fs.executeAction(i,ve.id,R,te,me),De={...i,...re.updatedSession};if(Ee?a(De):await ai(t,De),Ge({type:re.success?"action":"action_failed",description:re.narrative}),re.damage>0&&xe&&Ge({type:"damage",actor:ve.name,target:xe.name,damage:re.damage,description:`${ve.name} deals ${re.damage} damage to ${xe.name}`}),re.healing>0&&xe&&Ge({type:"healing",actor:ve.name,target:xe.name,healing:re.healing,description:`${ve.name} heals ${xe.name} for ${re.healing} HP`}),k(re.narrative),re.description&&w(re.description),re.combatEnded){mn();return}ve.id.startsWith("enemy_")?(Z(!0),N(re.narrative),Me(re.description)):bt(),re.damage>0&&xe&&(ce({targetId:xe.id,damage:re.damage,type:"damage"}),de(!0),setTimeout(()=>de(!1),2e3)),re.healing>0&&xe&&(ce({targetId:xe.id,damage:re.healing,type:"healing"}),de(!0),setTimeout(()=>de(!1),2e3)),g(null),S(null)}catch(ve){console.error("Error executing action:",ve),k(`Error: ${ve.message}`),Ge({type:"error",description:`Error executing action: ${ve.message}`})}finally{Re(!1)}},Rn=async()=>{var te;if(!i||i.combatState!=="active"){console.error("Combat not active");return}const R=L();if(!R||!R.id.startsWith("enemy_")){console.error("Not an enemy turn");return}console.log("Processing enemy turn for:",R.name);try{Re(!0),A(!0),Ge({type:"turn_start",actor:R.name,description:`${R.name}'s turn begins`});const me=fs.chooseEnemyAction(R,i);if(console.log("Selected enemy action:",me),!me){console.log("No action selected for enemy"),Ge({type:"no_action",actor:R.name,description:`${R.name} cannot decide on an action`}),setTimeout(()=>{bt()},1e3);return}const ve=me.action,xe=me.target;if(!ve){console.log("No action type in selected action"),Ge({type:"no_action",actor:R.name,description:`${R.name} has no valid action type`}),setTimeout(()=>{bt()},1e3);return}const re=i.combatants.find(At=>At.id===xe);if(!re&&ve!=="defend"){console.log("No target found for enemy action"),Ge({type:"no_target",actor:R.name,action:ve,description:`${R.name} cannot find a target for ${ve}`}),setTimeout(()=>{bt()},1e3);return}Ge({type:"action",actor:R.name,action:ve,target:(re==null?void 0:re.name)||"self",description:`${R.name} uses ${ve}${re?` on ${re.name}`:""}`});const De=await fs.executeAction(i,R.id,ve,xe,me);if(De.success){console.log("Enemy action executed successfully:",De);const At={...i,...De.updatedSession||{},currentTurn:((te=De.updatedSession)==null?void 0:te.currentTurn)!==void 0?De.updatedSession.currentTurn:i.currentTurn};De.damage&&Ge({type:"damage",actor:R.name,target:(re==null?void 0:re.name)||"self",damage:De.damage,description:`${R.name} deals ${De.damage} damage to ${(re==null?void 0:re.name)||"self"}`}),De.healing&&Ge({type:"healing",actor:R.name,target:(re==null?void 0:re.name)||"self",healing:De.healing,description:`${R.name} heals ${(re==null?void 0:re.name)||"self"} for ${De.healing} HP`}),De.statusEffects&&De.statusEffects.length>0&&De.statusEffects.forEach(Xt=>{Ge({type:"status_effect",actor:R.name,target:(re==null?void 0:re.name)||"self",effect:Xt.type,description:`${(re==null?void 0:re.name)||"self"} is affected by ${Xt.type}`})}),De.targetDied&&Ge({type:"death",actor:R.name,target:(re==null?void 0:re.name)||"self",description:`${(re==null?void 0:re.name)||"self"} has been defeated!`}),a(At),De.damage&&re&&(ce({targetId:re.id,damage:De.damage,type:"damage"}),de(!0),setTimeout(()=>de(!1),2e3)),De.healing&&re&&(ce({targetId:re.id,damage:De.healing,type:"healing"}),de(!0),setTimeout(()=>de(!1),2e3));const yt=fs.generateActionNarrative(R,ve,re,me);if(N(`${R.name} uses ${ve}!`),Me(yt),De.combatEnded){console.log("Combat ended"),Ee?e("/test-environment",{state:{...Yt,combatResult:De.combatResult}}):await mn();return}if(At.combatants.filter(Xt=>!Xt.id.startsWith("enemy_")&&Xt.hp>0).length===0){console.log("All players dead, ending combat"),Ee?e("/test-environment",{state:{...Yt,combatResult:"defeat"}}):await mn();return}setTimeout(()=>{bt()},1e3)}else console.error("Enemy action execution failed:",De.error),Ge({type:"action_failed",actor:R.name,action:ve,description:`${R.name}'s ${ve} failed`}),setTimeout(()=>{bt()},1e3)}catch(me){console.error("Error processing enemy turn:",me),Ge({type:"error",actor:R.name,description:`Error during ${R.name}'s turn`}),setTimeout(()=>{bt()},1e3)}finally{Re(!1),A(!1)}},bt=async()=>{var xe;if(!i||i.combatState!=="active"){console.error("Combat not active");return}console.log("Advancing turn from:",i.currentTurn);let R=(i.currentTurn+1)%i.combatants.length,te=0;const me=i.combatants.length;for(;te<me;){const re=i.combatants[R];if(re&&re.hp>0)break;R=(R+1)%i.combatants.length,te++}if(te>=me){console.log("No alive combatants found, ending combat"),Ee?e("/test-environment",{state:{...Yt,combatResult:"draw"}}):await mn();return}if(R===0){const re={...i,currentTurn:R,round:i.round+1};Ee?a(re):await ai(t,re)}else{const re={...i,currentTurn:R};Ee?a(re):await ai(t,re)}console.log("Turn advanced to:",R,"combatant:",(xe=i.combatants[R])==null?void 0:xe.name);const ve=Ee?i:await _0(t);ve&&wt(ve)},mn=async()=>{if(!i)return;const R=fs.generateCombatSummary(i,"victory");Ee?(a(te=>({...te,status:"ended",combatState:"ended",summary:R})),e("/test-environment")):(await _R(i.id,{status:"ended",combatState:"ended",summary:R}),await gn(t,{status:"storytelling",currentCombat:null}),e(`/campaign/${t}`))},L=(R=i)=>{if(!R)return null;const te=R.combatants||[],me=R.currentTurn||0;return te.length===0||me>=te.length?null:te[me]},U=()=>{const R=L();return R?Ee?!R.isEnemy:R.userId===(r==null?void 0:r.uid):!1},ge=()=>{if(i){if(Ee){const R=i.combatants.find(te=>!te.isEnemy);R&&R.hp<=0&&(G(!0),pe(R))}else if(r){const R=i.partyMembers.find(te=>te.userId===r.uid)||i.combatants.find(te=>te.userId===r.uid&&!te.isEnemy);R&&R.hp<=0&&(G(!0),pe(R))}}},Ne=()=>{e(Ee?"/dashboard":`/character-creation/${t}`)},$t=()=>{if(Ee)Z(!1),ye(new Set),bt();else{const R=r==null?void 0:r.uid;R&&ye(te=>new Set([...te,R]))}},Ut=()=>{if(Ee)return!0;if(!(i!=null&&i.partyMembers))return!1;const R=i.partyMembers.filter(me=>me.hp>0);return Se.size>=R.length},ut=Array.isArray(i==null?void 0:i.combatants)?i.combatants:Array.isArray(i==null?void 0:i.partyMembers)&&Array.isArray(i==null?void 0:i.enemies)?[...i.partyMembers.map(R=>({...R,isEnemy:!1,userId:R.userId,cooldowns:R.cooldowns||{},statusEffects:R.statusEffects||[],hp:R.hp??R.maxHp??1,maxHp:R.maxHp??R.hp??1})),...i.enemies.map(R=>({...R,isEnemy:!0,userId:null,cooldowns:R.cooldowns||{},statusEffects:R.statusEffects||[],hp:R.hp??R.maxHp??1,maxHp:R.maxHp??R.hp??1}))]:[],Ir=R=>{if(!R||!ut.length)return[];const te=ut.filter(xe=>xe.hp>0),me=L();if(!me)return[];const ve=!me.id.startsWith("enemy_");switch(R){case"attack":case"spell":case"special":return ve?te.filter(xe=>xe.id.startsWith("enemy_")):te.filter(xe=>!xe.id.startsWith("enemy_"));case"heal":case"item":return ve?te.filter(xe=>!xe.id.startsWith("enemy_")&&xe.id!==me.id):te.filter(xe=>xe.id.startsWith("enemy_")&&xe.id!==me.id);case"defend":case"environmental":return[me];case"teamUp":return ve?te.filter(xe=>!xe.id.startsWith("enemy_")&&xe.id!==me.id):te.filter(xe=>xe.id.startsWith("enemy_")&&xe.id!==me.id);default:return te}},Ar=Array.isArray(i==null?void 0:i.enemies)?i.enemies:[];if(!r)return null;if(c)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:"⚔️"}),o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Loading Combat..."}),o.jsx("p",{className:"text-gray-300 mb-6",children:"Preparing the battlefield and gathering combatants..."}),o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto"})]})})});if(!i)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("div",{className:"text-gray-400",children:"No active combat session found."})})})});if((i.status==="no_enemies"||Ar.length===0)&&!Ee)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:"🕊️"}),o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"No Enemies to Fight"}),o.jsx("p",{className:"text-gray-300 mb-6",children:"There are no enemies present in this area. Combat cannot begin."}),o.jsx("p",{className:"text-gray-400 text-sm",children:"The combat session will end automatically."})]})})});const Ze=L();return Te&&ie?o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card bg-red-50 border-red-200",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:"💀"}),o.jsx("h1",{className:"text-3xl font-bold text-red-800 mb-4",children:"Character Death"}),o.jsxs("div",{className:"text-xl text-red-700 mb-6",children:[ie.name," has fallen in battle..."]}),o.jsxs("div",{className:"bg-white p-6 rounded-lg border border-red-300 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-stone-800 mb-2",children:"Fallen Hero"}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Name:"})," ",ie.name]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Class:"})," ",ie.class]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Level:"})," ",ie.level]}),o.jsxs("p",{className:"text-stone-600",children:[o.jsx("strong",{children:"Final HP:"})," ",ie.hp,"/",ie.maxHp]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-stone-600",children:"Your character has been defeated. You must create a new character to continue."}),o.jsx("button",{onClick:Ne,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})}):o.jsx("div",{className:"min-h-screen bg-gray-900 text-gray-100 p-4",children:o.jsxs("div",{className:"fantasy-container py-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:"⚔️ Combat Arena"}),o.jsx("div",{className:"flex space-x-2",children:i.combatState==="active"&&o.jsx("button",{onClick:mn,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"End Combat"})})]}),i.storyContext&&o.jsxs("div",{className:"fantasy-card mb-6",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-2",children:"Story Context"}),o.jsx("p",{className:"text-gray-300 italic text-sm",children:i.storyContext})]}),o.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6",children:[o.jsxs("div",{className:"xl:col-span-1 space-y-6",children:[o.jsxs("div",{className:"fantasy-card h-96",children:[o.jsx("h3",{className:"text-lg font-semibold mb-4 text-yellow-400",children:"Battle Log"}),o.jsx("div",{className:"space-y-2 h-80 overflow-y-auto",children:Fe.length===0?o.jsx("p",{className:"text-gray-400 text-sm",children:"No actions recorded yet..."}):Fe.map(R=>o.jsxs("div",{className:"text-sm border-l-2 border-gray-600 pl-3 py-1",children:[o.jsxs("div",{className:"flex justify-between items-start mb-1",children:[o.jsx("span",{className:"text-gray-400 text-xs",children:R.timestamp}),o.jsxs("span",{className:"text-blue-400 text-xs",children:["R",R.round," T",R.turn]})]}),o.jsx("div",{className:`${R.type==="damage"?"text-red-400":R.type==="healing"?"text-green-400":R.type==="death"?"text-red-500 font-semibold":R.type==="status_effect"?"text-purple-400":R.type==="action_failed"?"text-orange-400":R.type==="error"?"text-red-500":"text-gray-200"}`,children:R.description})]},R.id))})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3",children:"Combat Status"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-blue-300 mb-2",children:"Party Members"}),o.jsx("div",{className:"space-y-2",children:ut.filter(R=>!R.id.startsWith("enemy_")).map(R=>o.jsxs("div",{className:`p-2 rounded border ${R.hp<=0?"bg-red-900/20 border-red-600":R.hp<R.maxHp*.5?"bg-yellow-900/20 border-yellow-600":"bg-blue-900/20 border-blue-600"} ${(Ze==null?void 0:Ze.id)===R.id?"ring-2 ring-amber-400":""}`,children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("span",{className:"font-medium text-gray-100",children:[R.name,(Ze==null?void 0:Ze.id)===R.id&&o.jsx("span",{className:"ml-2 text-amber-400",children:"🎲"})]}),o.jsxs("span",{className:`text-sm ${R.hp<=0?"text-red-400":R.hp<R.maxHp*.5?"text-yellow-400":"text-green-400"}`,children:[R.hp,"/",R.maxHp," HP"]})]}),R.hp<=0&&o.jsx("div",{className:"text-xs text-red-400 mt-1",children:"💀 Defeated"})]},R.id))})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-red-300 mb-2",children:"Enemies"}),o.jsx("div",{className:"space-y-2",children:ut.filter(R=>R.id.startsWith("enemy_")).map(R=>o.jsxs("div",{className:`p-2 rounded border ${R.hp<=0?"bg-red-900/20 border-red-600":R.hp<R.maxHp*.5?"bg-yellow-900/20 border-yellow-600":"bg-red-900/20 border-red-600"} ${(Ze==null?void 0:Ze.id)===R.id?"ring-2 ring-amber-400":""}`,children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("span",{className:"font-medium text-gray-100",children:[R.name,(Ze==null?void 0:Ze.id)===R.id&&o.jsx("span",{className:"ml-2 text-amber-400",children:"🎲"})]}),o.jsxs("span",{className:`text-sm ${R.hp<=0?"text-red-400":R.hp<R.maxHp*.5?"text-yellow-400":"text-red-400"}`,children:[R.hp,"/",R.maxHp," HP"]})]}),R.hp<=0&&o.jsx("div",{className:"text-xs text-red-400 mt-1",children:"💀 Defeated"})]},R.id))})]})]})]}),$.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-blue-300 mb-2",children:"🌍 Environmental Features"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:$.map((R,te)=>o.jsx("span",{className:"px-3 py-1 bg-blue-900 text-blue-200 rounded-full text-sm",children:R},te))})]}),E.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-purple-300 mb-2",children:"🤝 Team Up Opportunities"}),o.jsx("div",{className:"space-y-2",children:E.map((R,te)=>o.jsxs("div",{className:"text-purple-200 text-sm",children:[o.jsxs("strong",{children:[R.classes.join(" + "),":"]})," ",R.description]},te))})]})]}),o.jsxs("div",{className:"xl:col-span-2 space-y-6",children:[Ze&&ut.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("h3",{className:"font-bold text-gray-100 mb-3",children:["🎲 ",Ze.name,"'s Turn"]}),U()?o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-200 mb-2",children:"Available Actions:"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:I.map((R,te)=>o.jsxs("button",{onClick:()=>g(R),className:`p-3 rounded-lg border-2 transition-colors text-left ${(f==null?void 0:f.type)===R.type?"border-amber-500 bg-amber-900/20":"border-gray-600 bg-gray-700 hover:border-gray-500"}`,children:[o.jsx("div",{className:"font-medium text-gray-100",children:R.name}),o.jsx("div",{className:"text-sm text-gray-300",children:R.description}),o.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Priority: ",R.priority]})]},te))})]}),f&&o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-200 mb-2",children:"Select Target:"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Ir(f.type).map(R=>o.jsxs("button",{onClick:()=>S(R),className:`p-3 rounded-lg border-2 transition-colors ${(x==null?void 0:x.id)===R.id?"border-red-500 bg-red-900/20":"border-gray-600 bg-gray-700 hover:border-gray-500"}`,children:[o.jsx("div",{className:"font-medium text-gray-100",children:R.name}),o.jsxs("div",{className:"text-sm text-gray-300",children:["HP: ",R.hp,"/",R.maxHp," | AC: ",R.ac]}),o.jsx("div",{className:"text-xs text-gray-400",children:R.id.startsWith("enemy_")?"Enemy":"Ally"})]},R.id))}),Ir(f.type).length===0&&o.jsx("div",{className:"text-center p-4 bg-gray-700 border border-gray-600 rounded",children:o.jsx("p",{className:"text-gray-300",children:"No valid targets for this action."})})]}),f&&x&&o.jsx("div",{className:"text-center",children:o.jsx("button",{onClick:()=>ht(f.type,x.id),disabled:Pe,className:"fantasy-button bg-amber-600 hover:bg-amber-700",children:Pe?"Executing...":`Execute ${f.name}`})})]}):o.jsxs("div",{className:"bg-blue-900/20 border border-blue-700 rounded-lg p-4",children:[o.jsxs("h4",{className:"font-bold text-blue-300 mb-2",children:["Waiting for ",Ze.name," to act"]}),o.jsx("p",{className:"text-blue-200",children:Ze.userId===(r==null?void 0:r.uid)?"It's your turn! Please select an action.":"Please wait for the current player to make their move."})]})]}),(!ut.length||!Ar.length)&&o.jsxs("div",{className:"fantasy-card bg-gray-800 border-gray-600",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3",children:"Combat Status"}),o.jsxs("div",{className:"text-gray-300 space-y-2",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Combat State:"})," ",i.combatState]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Combatants:"})," ",ut.length]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Enemies:"})," ",Ar.length]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Current Turn:"})," ",i.currentTurn]}),i.combatState==="preparation"&&o.jsx("button",{onClick:Jt,className:"fantasy-button bg-yellow-600 hover:bg-yellow-700 mt-4",children:"Start Combat"})]})]}),y&&o.jsxs("div",{className:"fantasy-card bg-green-900/20 border-green-700",children:[o.jsx("h4",{className:"font-bold text-green-300 mb-2",children:"Action Result"}),o.jsx("p",{className:"text-green-200",children:y}),b&&o.jsx("div",{className:"mt-2 p-3 bg-gray-700 border border-green-600 rounded",children:o.jsx("p",{className:"text-gray-200 italic",children:b})})]}),C&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700 animate-pulse",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-red-300 mb-3 text-xl",children:"🦹 Enemy Turn"}),D&&o.jsx("div",{className:"text-red-200 font-bold text-lg mb-3 bg-gray-700 p-3 rounded border border-red-600",children:D}),T&&o.jsx("div",{className:"mt-3 p-4 bg-gray-700 border border-red-600 rounded",children:o.jsx("p",{className:"text-gray-200 italic",children:T})}),o.jsxs("div",{className:"mt-4 flex items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"}),o.jsx("span",{className:"ml-3 text-red-300 font-medium",children:"Enemy is acting..."})]})]})}),le&&o.jsx("div",{className:"fantasy-card bg-blue-900/20 border-blue-700",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-blue-300 mb-3 text-xl",children:"✅ Enemy Turn Complete"}),o.jsx("p",{className:"text-blue-200 mb-4",children:Ee?"The enemy has finished their turn. Click 'Confirm' to proceed to the next turn.":"The enemy has finished their turn. All party members must click 'Confirm' to proceed."}),!Ee&&o.jsxs("div",{className:"mb-4 p-3 bg-gray-700 border border-blue-600 rounded",children:[o.jsxs("p",{className:"text-sm text-blue-200",children:[o.jsx("strong",{children:"Ready to continue:"})," ",Se.size," / ",((Wn=i==null?void 0:i.partyMembers)==null?void 0:Wn.filter(R=>R.hp>0).length)||0," party members"]}),Se.size>0&&o.jsxs("div",{className:"mt-2 text-xs text-blue-300",children:["Waiting for: ",((jn=(Dt=(as=i==null?void 0:i.partyMembers)==null?void 0:as.filter(R=>R.hp>0&&!Se.has(R.userId)))==null?void 0:Dt.map(R=>R.name))==null?void 0:jn.join(", "))||"None"]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center items-center",children:[o.jsx("button",{onClick:$t,disabled:!Ee&&Se.has(r==null?void 0:r.uid),className:`fantasy-button px-8 py-3 text-lg font-semibold ${!Ee&&Se.has(r==null?void 0:r.uid)?"bg-green-700 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 shadow-lg"}`,children:!Ee&&Se.has(r==null?void 0:r.uid)?"✓ Ready":"Confirm"}),Ee&&o.jsx("button",{onClick:()=>{Z(!1),ye(new Set),bt()},className:"fantasy-button px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white",children:"Skip Confirmation"})]}),o.jsx("div",{className:"mt-4 p-3 bg-yellow-900/20 border border-yellow-600 rounded",children:o.jsxs("p",{className:"text-sm text-yellow-200",children:[o.jsx("strong",{children:"Note:"})," Review the battle log and enemy actions before continuing to the next turn."]})})]})}),Pe&&!C&&o.jsx("div",{className:"fantasy-card bg-amber-900/20 border-amber-700",children:o.jsxs("div",{className:"flex items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-amber-500"}),o.jsx("span",{className:"ml-2 text-amber-300 font-medium",children:"Processing turn..."})]})}),(i==null?void 0:i.combatState)==="ready"&&!lt&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-red-300 mb-4 text-2xl",children:"⚔️ Combat Ready!"}),o.jsx("p",{className:"text-red-200 mb-6 text-lg",children:"All combatants are in position. Click 'Fight!' to begin the battle."}),o.jsx("button",{onClick:is,disabled:Pe,className:"fantasy-button px-12 py-4 text-xl font-bold bg-red-600 hover:bg-red-700 shadow-lg",children:Pe?"Preparing...":"Fight!"})]})})]}),o.jsxs("div",{className:"xl:col-span-1 space-y-6",children:[ut.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3",children:"🎯 Turn Order"}),o.jsx("div",{className:"space-y-2",children:ut.map(R=>{var te,me;return o.jsx("div",{className:`p-3 rounded-lg border-2 transition-colors ${R.id===((te=ut[i.currentTurn])==null?void 0:te.id)?"border-amber-500 bg-amber-900/20":"border-gray-600 bg-gray-700"}`,children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"font-medium text-gray-100",children:[R.name,R.id===((me=ut[i.currentTurn])==null?void 0:me.id)&&o.jsx("span",{className:"ml-2 text-amber-400",children:"← Current Turn"})]}),o.jsxs("div",{className:"text-sm text-gray-300",children:["HP: ",R.hp,"/",R.maxHp," | AC: ",R.ac]}),R.statusEffects&&R.statusEffects.length>0&&o.jsx("div",{className:"text-xs text-red-400 mt-1",children:R.statusEffects.map(ve=>ve.type).join(", ")})]}),o.jsxs("div",{className:"text-sm text-gray-400",children:["Initiative: ",R.initiative]})]})},R.id)})})]}),je&&X&&o.jsx("div",{className:"fixed inset-0 pointer-events-none z-50 flex items-center justify-center",children:o.jsxs("div",{className:`text-6xl font-bold animate-bounce px-6 py-4 rounded-lg shadow-lg ${X.type==="damage"?"text-red-400 bg-red-900/80":"text-green-400 bg-green-900/80"}`,children:[X.type==="damage"?"-":"+",X.damage]})}),Te&&ie&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:"💀"}),o.jsx("h1",{className:"text-3xl font-bold text-red-300 mb-4",children:"Character Death"}),o.jsxs("div",{className:"text-xl text-red-200 mb-6",children:[ie.name," has fallen in battle..."]}),o.jsxs("div",{className:"bg-gray-700 p-6 rounded-lg border border-red-600 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Fallen Hero"}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Name:"})," ",ie.name]}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Class:"})," ",ie.class]}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Level:"})," ",ie.level]}),o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"Final HP:"})," ",ie.hp,"/",ie.maxHp]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-gray-300",children:"Your character has been defeated. You must create a new character to continue."}),o.jsx("button",{onClick:Ne,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})]})]})]})})}function GR(){const t=Zn(),[e,n]=P.useState(null),[r,s]=P.useState([]),[i,a]=P.useState([]),[c,u]=P.useState({}),[d,h]=P.useState({}),[f,g]=P.useState(!1),[x,S]=P.useState(!1),[y,k]=P.useState(""),[b,w]=P.useState({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""});P.useEffect(()=>{const N=ja(T=>{if(!T){t("/login");return}n(T),I(T.uid),j()});return()=>N()},[t]);const I=async N=>{try{const T=await c_(N);s(T),await $(T)}catch(T){console.error("Error loading parties:",T.message)}},j=async()=>{try{const T=(await uR()).filter(Me=>{var Pe;return!((Pe=Me.members)!=null&&Pe.includes(e==null?void 0:e.uid))});a(T),await H(T)}catch(N){console.error("Error loading public parties:",N.message)}},$=async N=>{try{const T=new Set;if(N.forEach(Te=>{Te.members&&Array.isArray(Te.members)&&Te.members.forEach(G=>T.add(G))}),T.size===0)return;const Me=await w0(Array.from(T)),Pe={};Me.forEach(Te=>{Pe[Te.userId]=Te});const Re={};N.forEach(Te=>{Te.members&&Array.isArray(Te.members)&&(Re[Te.id]=Te.members.map(G=>({userId:G,profile:Pe[G]||null})))}),u(Re)}catch(T){console.error("Error loading party member profiles:",T)}},H=async N=>{try{const T=new Set;if(N.forEach(Te=>{Te.members&&Array.isArray(Te.members)&&Te.members.forEach(G=>T.add(G))}),T.size===0)return;const Me=await w0(Array.from(T)),Pe={};Me.forEach(Te=>{Pe[Te.userId]=Te});const Re={};N.forEach(Te=>{Te.members&&Array.isArray(Te.members)&&(Re[Te.id]=Te.members.map(G=>({userId:G,profile:Pe[G]||null})))}),h(Re)}catch(T){console.error("Error loading public party member profiles:",T)}},E=async N=>{if(N.preventDefault(),!e){console.error("You must be logged in to create a party");return}g(!0);try{const T={...b,inviteCode:Math.random().toString(36).substr(2,8).toUpperCase()},Me=await l_(e.uid,T);S(!1),w({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""}),await I(e.uid),await j(),console.log("Party created successfully!")}catch(T){console.error("Error creating party:",T.message)}finally{g(!1)}},_=async()=>{if(!y.trim()){console.error("Please enter an invite code");return}if(!e){console.error("You must be logged in to join a party");return}g(!0);try{const N=await dR(y.toUpperCase());if(!N){console.error("Invalid invite code");return}await b0(N.id,e.uid),k(""),await I(e.uid),await j(),console.log("Successfully joined party!")}catch(N){console.error(N.message||"Error joining party. Please try again.")}finally{g(!1)}},C=async N=>{if(!e){console.error("You must be logged in to join a party");return}g(!0);try{await b0(N,e.uid),await I(e.uid),await j(),console.log("Successfully joined public party!")}catch(T){console.error(T.message||"Error joining party. Please try again.")}finally{g(!1)}},A=N=>{navigator.clipboard.writeText(N),console.log("Invite code copied to clipboard!")},D=async(N,T)=>{if(confirm(`Are you sure you want to disband "${T}"? This action cannot be undone and will remove all party members and characters.`)){g(!0);try{await u_(N,e.uid),await I(e.uid),await j(),console.log("Party disbanded successfully")}catch(Me){console.error("Error disbanding party:",Me.message)}finally{g(!1)}}};return e?o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:"Party Management"}),o.jsx("button",{onClick:()=>S(!0),className:"fantasy-button",disabled:f,children:"Create New Party"})]}),x&&o.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600 mb-6",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-4",children:"Create New Party"}),o.jsxs("form",{onSubmit:E,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"party-name",className:"block text-sm font-medium text-gray-200 mb-2",children:"Party Name"}),o.jsx("input",{id:"party-name",type:"text",value:b.name,onChange:N=>w(T=>({...T,name:N.target.value})),className:"fantasy-input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"party-theme",className:"block text-sm font-medium text-gray-200 mb-2",children:"Theme"}),o.jsx("textarea",{id:"party-theme",value:b.description,onChange:N=>w(T=>({...T,description:N.target.value})),className:"fantasy-input",rows:"3",placeholder:"Enter the theme or atmosphere for your campaign..."})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"max-players",className:"block text-sm font-medium text-gray-200 mb-2",children:"Max Players"}),o.jsx("input",{id:"max-players",type:"number",min:"2",max:"10",value:b.maxPlayers,onChange:N=>w(T=>({...T,maxPlayers:parseInt(N.target.value)})),className:"fantasy-input"})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"isPublic",checked:b.isPublic,onChange:N=>w(T=>({...T,isPublic:N.target.checked})),className:"mr-2"}),o.jsx("label",{htmlFor:"isPublic",className:"text-sm font-medium text-gray-200",children:"Public Party (visible to all users)"})]})]}),o.jsxs("div",{className:"flex space-x-4",children:[o.jsx("button",{type:"submit",className:"fantasy-button",disabled:f,children:f?"Creating...":"Create Party"}),o.jsx("button",{type:"button",onClick:()=>S(!1),className:"fantasy-button bg-gray-600 hover:bg-gray-700",disabled:f,children:"Cancel"})]})]})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"My Parties"}),r.length===0?o.jsxs("div",{className:"text-center py-8 text-gray-300",children:[o.jsx("p",{children:"You haven't joined any parties yet."}),o.jsx("p",{children:'Click "Create New Party" to get started!'})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:r.map(N=>{var Me,Pe;const T=c[N.id]||[];return o.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100",children:N.name}),o.jsxs("span",{className:"text-sm text-gray-300",children:[((Me=N.members)==null?void 0:Me.length)||1,"/",N.maxPlayers," players"]})]}),N.description&&o.jsxs("div",{className:"mb-4",children:[o.jsx("span",{className:"text-sm font-semibold text-gray-200",children:"Theme: "}),o.jsx("span",{className:"text-gray-300",children:N.description})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-200 mb-2",children:"Party Members:"}),o.jsx("div",{className:"space-y-1",children:T.map((Re,Te)=>{var pe;const G=((pe=Re.profile)==null?void 0:pe.username)||`User ${Te+1}`,ie=Re.userId===N.dmId;return o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-gray-300",children:G}),ie&&o.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),Re.userId===(e==null?void 0:e.uid)&&o.jsx("span",{className:"text-blue-400 text-xs font-medium",children:"(You)"})]},Re.userId)})})]}),N.dmId===e.uid&&o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{htmlFor:`invite-code-${N.id}`,className:"block text-sm font-medium text-gray-200 mb-2",children:"Invite Code"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{id:`invite-code-${N.id}`,type:"text",value:N.inviteCode,readOnly:!0,className:"fantasy-input bg-gray-700"}),o.jsx("button",{onClick:()=>A(N.inviteCode),className:"fantasy-button text-sm",children:"Copy"})]})]}),o.jsx("div",{className:"flex space-x-2",children:(Pe=N.members)!=null&&Pe.includes(e==null?void 0:e.uid)?o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>t(`/campaign/${N.id}`),className:"fantasy-button",children:"Campaign"}),N.dmId===e.uid&&o.jsx("button",{onClick:()=>D(N.id,N.name),className:"fantasy-button bg-red-600 hover:bg-red-700",disabled:f,children:"Disband"})]}):o.jsx("button",{onClick:()=>C(N.id),className:"fantasy-button bg-green-600 hover:bg-green-700",disabled:f,children:"Join Party"})})]},N.id)})})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Public Parties"}),i.length===0?o.jsx("div",{className:"text-center py-8 text-gray-300",children:o.jsx("p",{children:"No public parties available."})}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:i.map(N=>{var Me;const T=d[N.id]||[];return o.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100",children:N.name}),o.jsxs("span",{className:"text-sm text-gray-300",children:[((Me=N.members)==null?void 0:Me.length)||1,"/",N.maxPlayers," players"]})]}),N.description&&o.jsxs("div",{className:"mb-4",children:[o.jsx("span",{className:"text-sm font-semibold text-gray-200",children:"Theme: "}),o.jsx("span",{className:"text-gray-300",children:N.description})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-200 mb-2",children:"Party Members:"}),o.jsx("div",{className:"space-y-1",children:T.map((Pe,Re)=>{var ie;const Te=((ie=Pe.profile)==null?void 0:ie.username)||`User ${Re+1}`,G=Pe.userId===N.dmId;return o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-gray-300",children:Te}),G&&o.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),Pe.userId===(e==null?void 0:e.uid)&&o.jsx("span",{className:"text-blue-400 text-xs font-medium",children:"(You)"})]},Pe.userId)})})]}),N.dmId===e.uid&&o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{htmlFor:`invite-code-${N.id}`,className:"block text-sm font-medium text-gray-200 mb-2",children:"Invite Code"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{id:`invite-code-${N.id}`,type:"text",value:N.inviteCode,readOnly:!0,className:"fantasy-input bg-gray-700"}),o.jsx("button",{onClick:()=>A(N.inviteCode),className:"fantasy-button text-sm",children:"Copy"})]})]}),o.jsx("div",{className:"flex space-x-2",children:o.jsx("button",{onClick:()=>C(N.id),className:"fantasy-button bg-green-600 hover:bg-green-700",disabled:f,children:"Join Party"})})]},N.id)})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Join a Party"}),o.jsx("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("input",{id:"join-code",type:"text",placeholder:"Enter invite code",value:y,onChange:N=>k(N.target.value),className:"fantasy-input flex-1",disabled:f}),o.jsx("button",{onClick:_,className:"fantasy-button",disabled:f,children:f?"Joining...":"Join Party"})]})})]})]})}):null}function KR(){const t=Ys(),e=t.pathname.split("/campaign-story/")[1];return console.log("Old route detected:",t.pathname),console.log("PartyId extracted:",e),console.log("Redirecting to:",`/campaign/${e}`),o.jsx(qx,{to:`/campaign/${e}`,replace:!0})}function QR(){return o.jsx(t1,{basename:"/DND-V1",future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:o.jsxs("div",{className:"min-h-screen flex flex-col",children:[o.jsx(AR,{}),o.jsx("main",{className:"flex-grow",children:o.jsxs(KC,{children:[o.jsx(Ln,{path:"/",element:o.jsx(jR,{})}),o.jsx(Ln,{path:"/login",element:o.jsx(DR,{})}),o.jsx(Ln,{path:"/register",element:o.jsx(MR,{})}),o.jsx(Ln,{path:"/dashboard",element:o.jsx(OR,{})}),o.jsx(Ln,{path:"/test-environment",element:o.jsx(FR,{})}),o.jsx(Ln,{path:"/campaign-management",element:o.jsx(BR,{})}),o.jsx(Ln,{path:"/character-creation/:partyId",element:o.jsx(zR,{})}),o.jsx(Ln,{path:"/campaign/:partyId",element:o.jsx(HR,{})}),o.jsx(Ln,{path:"/combat/:partyId",element:o.jsx(qR,{})}),o.jsx(Ln,{path:"/party-management",element:o.jsx(GR,{})}),o.jsx(Ln,{path:"/campaign-story/:partyId",element:o.jsx(KR,{})}),o.jsx(Ln,{path:"*",element:o.jsx(qx,{to:"/dashboard",replace:!0})})]})}),o.jsx(PR,{})]})})}Wd.createRoot(document.getElementById("root")).render(o.jsx(D0.StrictMode,{children:o.jsx(QR,{})}));
