function gE(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function yE(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var rv={exports:{}},xc={},sv={exports:{}},he={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ra=Symbol.for("react.element"),vE=Symbol.for("react.portal"),_E=Symbol.for("react.fragment"),wE=Symbol.for("react.strict_mode"),xE=Symbol.for("react.profiler"),EE=Symbol.for("react.provider"),TE=Symbol.for("react.context"),IE=Symbol.for("react.forward_ref"),SE=Symbol.for("react.suspense"),bE=Symbol.for("react.memo"),CE=Symbol.for("react.lazy"),Tm=Symbol.iterator;function PE(t){return t===null||typeof t!="object"?null:(t=Tm&&t[Tm]||t["@@iterator"],typeof t=="function"?t:null)}var iv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ov=Object.assign,av={};function Si(t,e,n){this.props=t,this.context=e,this.refs=av,this.updater=n||iv}Si.prototype.isReactComponent={};Si.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Si.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function lv(){}lv.prototype=Si.prototype;function Ah(t,e,n){this.props=t,this.context=e,this.refs=av,this.updater=n||iv}var Rh=Ah.prototype=new lv;Rh.constructor=Ah;ov(Rh,Si.prototype);Rh.isPureReactComponent=!0;var Im=Array.isArray,cv=Object.prototype.hasOwnProperty,jh={current:null},uv={key:!0,ref:!0,__self:!0,__source:!0};function dv(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)cv.call(e,r)&&!uv.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:ra,type:t,key:i,ref:o,props:s,_owner:jh.current}}function NE(t,e){return{$$typeof:ra,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Dh(t){return typeof t=="object"&&t!==null&&t.$$typeof===ra}function kE(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Sm=/\/+/g;function Eu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?kE(""+t.key):e.toString(36)}function dl(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case ra:case vE:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Eu(o,0):r,Im(s)?(n="",t!=null&&(n=t.replace(Sm,"$&/")+"/"),dl(s,e,n,"",function(d){return d})):s!=null&&(Dh(s)&&(s=NE(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Sm,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Im(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+Eu(i,l);o+=dl(i,e,n,c,s)}else if(c=PE(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+Eu(i,l++),o+=dl(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function za(t,e,n){if(t==null)return t;var r=[],s=0;return dl(t,r,"","",function(i){return e.call(n,i,s++)}),r}function AE(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Dt={current:null},hl={transition:null},RE={ReactCurrentDispatcher:Dt,ReactCurrentBatchConfig:hl,ReactCurrentOwner:jh};function hv(){throw Error("act(...) is not supported in production builds of React.")}he.Children={map:za,forEach:function(t,e,n){za(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return za(t,function(){e++}),e},toArray:function(t){return za(t,function(e){return e})||[]},only:function(t){if(!Dh(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};he.Component=Si;he.Fragment=_E;he.Profiler=xE;he.PureComponent=Ah;he.StrictMode=wE;he.Suspense=SE;he.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RE;he.act=hv;he.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=ov({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=jh.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)cv.call(e,c)&&!uv.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:ra,type:t.type,key:s,ref:i,props:r,_owner:o}};he.createContext=function(t){return t={$$typeof:TE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:EE,_context:t},t.Consumer=t};he.createElement=dv;he.createFactory=function(t){var e=dv.bind(null,t);return e.type=t,e};he.createRef=function(){return{current:null}};he.forwardRef=function(t){return{$$typeof:IE,render:t}};he.isValidElement=Dh;he.lazy=function(t){return{$$typeof:CE,_payload:{_status:-1,_result:t},_init:AE}};he.memo=function(t,e){return{$$typeof:bE,type:t,compare:e===void 0?null:e}};he.startTransition=function(t){var e=hl.transition;hl.transition={};try{t()}finally{hl.transition=e}};he.unstable_act=hv;he.useCallback=function(t,e){return Dt.current.useCallback(t,e)};he.useContext=function(t){return Dt.current.useContext(t)};he.useDebugValue=function(){};he.useDeferredValue=function(t){return Dt.current.useDeferredValue(t)};he.useEffect=function(t,e){return Dt.current.useEffect(t,e)};he.useId=function(){return Dt.current.useId()};he.useImperativeHandle=function(t,e,n){return Dt.current.useImperativeHandle(t,e,n)};he.useInsertionEffect=function(t,e){return Dt.current.useInsertionEffect(t,e)};he.useLayoutEffect=function(t,e){return Dt.current.useLayoutEffect(t,e)};he.useMemo=function(t,e){return Dt.current.useMemo(t,e)};he.useReducer=function(t,e,n){return Dt.current.useReducer(t,e,n)};he.useRef=function(t){return Dt.current.useRef(t)};he.useState=function(t){return Dt.current.useState(t)};he.useSyncExternalStore=function(t,e,n){return Dt.current.useSyncExternalStore(t,e,n)};he.useTransition=function(){return Dt.current.useTransition()};he.version="18.3.1";sv.exports=he;var D=sv.exports;const fv=yE(D),jE=gE({__proto__:null,default:fv},[D]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DE=D,ME=Symbol.for("react.element"),OE=Symbol.for("react.fragment"),LE=Object.prototype.hasOwnProperty,VE=DE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,FE={key:!0,ref:!0,__self:!0,__source:!0};function pv(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)LE.call(e,r)&&!FE.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:ME,type:t,key:i,ref:o,props:s,_owner:VE.current}}xc.Fragment=OE;xc.jsx=pv;xc.jsxs=pv;rv.exports=xc;var u=rv.exports,ud={},mv={exports:{}},Kt={},gv={exports:{}},yv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(G,te){var A=G.length;G.push(te);e:for(;0<A;){var H=A-1>>>1,Z=G[H];if(0<s(Z,te))G[H]=te,G[A]=Z,A=H;else break e}}function n(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var te=G[0],A=G.pop();if(A!==te){G[0]=A;e:for(var H=0,Z=G.length,q=Z>>>1;H<q;){var oe=2*(H+1)-1,de=G[oe],je=oe+1,De=G[je];if(0>s(de,A))je<Z&&0>s(De,de)?(G[H]=De,G[je]=A,H=je):(G[H]=de,G[oe]=A,H=oe);else if(je<Z&&0>s(De,A))G[H]=De,G[je]=A,H=je;else break e}}return te}function s(G,te){var A=G.sortIndex-te.sortIndex;return A!==0?A:G.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],p=1,m=null,g=3,S=!1,C=!1,k=!1,R=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(G){for(var te=n(d);te!==null;){if(te.callback===null)r(d);else if(te.startTime<=G)r(d),te.sortIndex=te.expirationTime,e(c,te);else break;te=n(d)}}function M(G){if(k=!1,b(G),!C)if(n(c)!==null)C=!0,Qe(O);else{var te=n(d);te!==null&&Ye(M,te.startTime-G)}}function O(G,te){C=!1,k&&(k=!1,I(y),y=-1),S=!0;var A=g;try{for(b(te),m=n(c);m!==null&&(!(m.expirationTime>te)||G&&!P());){var H=m.callback;if(typeof H=="function"){m.callback=null,g=m.priorityLevel;var Z=H(m.expirationTime<=te);te=t.unstable_now(),typeof Z=="function"?m.callback=Z:m===n(c)&&r(c),b(te)}else r(c);m=n(c)}if(m!==null)var q=!0;else{var oe=n(d);oe!==null&&Ye(M,oe.startTime-te),q=!1}return q}finally{m=null,g=A,S=!1}}var V=!1,_=null,y=-1,x=5,E=-1;function P(){return!(t.unstable_now()-E<x)}function N(){if(_!==null){var G=t.unstable_now();E=G;var te=!0;try{te=_(!0,G)}finally{te?T():(V=!1,_=null)}}else V=!1}var T;if(typeof w=="function")T=function(){w(N)};else if(typeof MessageChannel<"u"){var _e=new MessageChannel,mt=_e.port2;_e.port1.onmessage=N,T=function(){mt.postMessage(null)}}else T=function(){R(N,0)};function Qe(G){_=G,V||(V=!0,T())}function Ye(G,te){y=R(function(){G(t.unstable_now())},te)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(G){G.callback=null},t.unstable_continueExecution=function(){C||S||(C=!0,Qe(O))},t.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<G?Math.floor(1e3/G):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(G){switch(g){case 1:case 2:case 3:var te=3;break;default:te=g}var A=g;g=te;try{return G()}finally{g=A}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(G,te){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var A=g;g=G;try{return te()}finally{g=A}},t.unstable_scheduleCallback=function(G,te,A){var H=t.unstable_now();switch(typeof A=="object"&&A!==null?(A=A.delay,A=typeof A=="number"&&0<A?H+A:H):A=H,G){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=A+Z,G={id:p++,callback:te,priorityLevel:G,startTime:A,expirationTime:Z,sortIndex:-1},A>H?(G.sortIndex=A,e(d,G),n(c)===null&&G===n(d)&&(k?(I(y),y=-1):k=!0,Ye(M,A-H))):(G.sortIndex=Z,e(c,G),C||S||(C=!0,Qe(O))),G},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(G){var te=g;return function(){var A=g;g=te;try{return G.apply(this,arguments)}finally{g=A}}}})(yv);gv.exports=yv;var UE=gv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $E=D,Gt=UE;function z(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var vv=new Set,Po={};function Ts(t,e){ui(t,e),ui(t+"Capture",e)}function ui(t,e){for(Po[t]=e,t=0;t<e.length;t++)vv.add(e[t])}var Qn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),dd=Object.prototype.hasOwnProperty,BE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,bm={},Cm={};function zE(t){return dd.call(Cm,t)?!0:dd.call(bm,t)?!1:BE.test(t)?Cm[t]=!0:(bm[t]=!0,!1)}function WE(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function HE(t,e,n,r){if(e===null||typeof e>"u"||WE(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Mt(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var dt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){dt[t]=new Mt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];dt[e]=new Mt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){dt[t]=new Mt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){dt[t]=new Mt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){dt[t]=new Mt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){dt[t]=new Mt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){dt[t]=new Mt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){dt[t]=new Mt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){dt[t]=new Mt(t,5,!1,t.toLowerCase(),null,!1,!1)});var Mh=/[\-:]([a-z])/g;function Oh(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Mh,Oh);dt[e]=new Mt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Mh,Oh);dt[e]=new Mt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Mh,Oh);dt[e]=new Mt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){dt[t]=new Mt(t,1,!1,t.toLowerCase(),null,!1,!1)});dt.xlinkHref=new Mt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){dt[t]=new Mt(t,1,!1,t.toLowerCase(),null,!0,!0)});function Lh(t,e,n,r){var s=dt.hasOwnProperty(e)?dt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(HE(e,n,s,r)&&(n=null),r||s===null?zE(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var rr=$E.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Wa=Symbol.for("react.element"),$s=Symbol.for("react.portal"),Bs=Symbol.for("react.fragment"),Vh=Symbol.for("react.strict_mode"),hd=Symbol.for("react.profiler"),_v=Symbol.for("react.provider"),wv=Symbol.for("react.context"),Fh=Symbol.for("react.forward_ref"),fd=Symbol.for("react.suspense"),pd=Symbol.for("react.suspense_list"),Uh=Symbol.for("react.memo"),fr=Symbol.for("react.lazy"),xv=Symbol.for("react.offscreen"),Pm=Symbol.iterator;function Ki(t){return t===null||typeof t!="object"?null:(t=Pm&&t[Pm]||t["@@iterator"],typeof t=="function"?t:null)}var Ve=Object.assign,Tu;function ro(t){if(Tu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Tu=e&&e[1]||""}return`
`+Tu+t}var Iu=!1;function Su(t,e){if(!t||Iu)return"";Iu=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{Iu=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ro(t):""}function qE(t){switch(t.tag){case 5:return ro(t.type);case 16:return ro("Lazy");case 13:return ro("Suspense");case 19:return ro("SuspenseList");case 0:case 2:case 15:return t=Su(t.type,!1),t;case 11:return t=Su(t.type.render,!1),t;case 1:return t=Su(t.type,!0),t;default:return""}}function md(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Bs:return"Fragment";case $s:return"Portal";case hd:return"Profiler";case Vh:return"StrictMode";case fd:return"Suspense";case pd:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case wv:return(t.displayName||"Context")+".Consumer";case _v:return(t._context.displayName||"Context")+".Provider";case Fh:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Uh:return e=t.displayName||null,e!==null?e:md(t.type)||"Memo";case fr:e=t._payload,t=t._init;try{return md(t(e))}catch{}}return null}function GE(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return md(e);case 8:return e===Vh?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Vr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Ev(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function KE(t){var e=Ev(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Ha(t){t._valueTracker||(t._valueTracker=KE(t))}function Tv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Ev(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Rl(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function gd(t,e){var n=e.checked;return Ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Nm(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Vr(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Iv(t,e){e=e.checked,e!=null&&Lh(t,"checked",e,!1)}function yd(t,e){Iv(t,e);var n=Vr(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?vd(t,e.type,n):e.hasOwnProperty("defaultValue")&&vd(t,e.type,Vr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function km(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function vd(t,e,n){(e!=="number"||Rl(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var so=Array.isArray;function ei(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Vr(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function _d(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(z(91));return Ve({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Am(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(z(92));if(so(n)){if(1<n.length)throw Error(z(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Vr(n)}}function Sv(t,e){var n=Vr(e.value),r=Vr(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Rm(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function bv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function wd(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?bv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var qa,Cv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(qa=qa||document.createElement("div"),qa.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=qa.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function No(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var po={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},QE=["Webkit","ms","Moz","O"];Object.keys(po).forEach(function(t){QE.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),po[e]=po[t]})});function Pv(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||po.hasOwnProperty(t)&&po[t]?(""+e).trim():e+"px"}function Nv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Pv(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var YE=Ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xd(t,e){if(e){if(YE[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(z(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(z(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(z(61))}if(e.style!=null&&typeof e.style!="object")throw Error(z(62))}}function Ed(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Td=null;function $h(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Id=null,ti=null,ni=null;function jm(t){if(t=oa(t)){if(typeof Id!="function")throw Error(z(280));var e=t.stateNode;e&&(e=bc(e),Id(t.stateNode,t.type,e))}}function kv(t){ti?ni?ni.push(t):ni=[t]:ti=t}function Av(){if(ti){var t=ti,e=ni;if(ni=ti=null,jm(t),e)for(t=0;t<e.length;t++)jm(e[t])}}function Rv(t,e){return t(e)}function jv(){}var bu=!1;function Dv(t,e,n){if(bu)return t(e,n);bu=!0;try{return Rv(t,e,n)}finally{bu=!1,(ti!==null||ni!==null)&&(jv(),Av())}}function ko(t,e){var n=t.stateNode;if(n===null)return null;var r=bc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(z(231,e,typeof n));return n}var Sd=!1;if(Qn)try{var Qi={};Object.defineProperty(Qi,"passive",{get:function(){Sd=!0}}),window.addEventListener("test",Qi,Qi),window.removeEventListener("test",Qi,Qi)}catch{Sd=!1}function JE(t,e,n,r,s,i,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(p){this.onError(p)}}var mo=!1,jl=null,Dl=!1,bd=null,XE={onError:function(t){mo=!0,jl=t}};function ZE(t,e,n,r,s,i,o,l,c){mo=!1,jl=null,JE.apply(XE,arguments)}function eT(t,e,n,r,s,i,o,l,c){if(ZE.apply(this,arguments),mo){if(mo){var d=jl;mo=!1,jl=null}else throw Error(z(198));Dl||(Dl=!0,bd=d)}}function Is(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Mv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Dm(t){if(Is(t)!==t)throw Error(z(188))}function tT(t){var e=t.alternate;if(!e){if(e=Is(t),e===null)throw Error(z(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Dm(s),t;if(i===r)return Dm(s),e;i=i.sibling}throw Error(z(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(z(189))}}if(n.alternate!==r)throw Error(z(190))}if(n.tag!==3)throw Error(z(188));return n.stateNode.current===n?t:e}function Ov(t){return t=tT(t),t!==null?Lv(t):null}function Lv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Lv(t);if(e!==null)return e;t=t.sibling}return null}var Vv=Gt.unstable_scheduleCallback,Mm=Gt.unstable_cancelCallback,nT=Gt.unstable_shouldYield,rT=Gt.unstable_requestPaint,ze=Gt.unstable_now,sT=Gt.unstable_getCurrentPriorityLevel,Bh=Gt.unstable_ImmediatePriority,Fv=Gt.unstable_UserBlockingPriority,Ml=Gt.unstable_NormalPriority,iT=Gt.unstable_LowPriority,Uv=Gt.unstable_IdlePriority,Ec=null,bn=null;function oT(t){if(bn&&typeof bn.onCommitFiberRoot=="function")try{bn.onCommitFiberRoot(Ec,t,void 0,(t.current.flags&128)===128)}catch{}}var hn=Math.clz32?Math.clz32:cT,aT=Math.log,lT=Math.LN2;function cT(t){return t>>>=0,t===0?32:31-(aT(t)/lT|0)|0}var Ga=64,Ka=4194304;function io(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ol(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=io(l):(i&=o,i!==0&&(r=io(i)))}else o=n&~s,o!==0?r=io(o):i!==0&&(r=io(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-hn(e),s=1<<n,r|=t[n],e&=~s;return r}function uT(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dT(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-hn(i),l=1<<o,c=s[o];c===-1?(!(l&n)||l&r)&&(s[o]=uT(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function Cd(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function $v(){var t=Ga;return Ga<<=1,!(Ga&4194240)&&(Ga=64),t}function Cu(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function sa(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-hn(e),t[e]=n}function hT(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-hn(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function zh(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-hn(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Te=0;function Bv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var zv,Wh,Wv,Hv,qv,Pd=!1,Qa=[],Sr=null,br=null,Cr=null,Ao=new Map,Ro=new Map,mr=[],fT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Om(t,e){switch(t){case"focusin":case"focusout":Sr=null;break;case"dragenter":case"dragleave":br=null;break;case"mouseover":case"mouseout":Cr=null;break;case"pointerover":case"pointerout":Ao.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ro.delete(e.pointerId)}}function Yi(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=oa(e),e!==null&&Wh(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function pT(t,e,n,r,s){switch(e){case"focusin":return Sr=Yi(Sr,t,e,n,r,s),!0;case"dragenter":return br=Yi(br,t,e,n,r,s),!0;case"mouseover":return Cr=Yi(Cr,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Ao.set(i,Yi(Ao.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Ro.set(i,Yi(Ro.get(i)||null,t,e,n,r,s)),!0}return!1}function Gv(t){var e=rs(t.target);if(e!==null){var n=Is(e);if(n!==null){if(e=n.tag,e===13){if(e=Mv(n),e!==null){t.blockedOn=e,qv(t.priority,function(){Wv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function fl(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Nd(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Td=r,n.target.dispatchEvent(r),Td=null}else return e=oa(n),e!==null&&Wh(e),t.blockedOn=n,!1;e.shift()}return!0}function Lm(t,e,n){fl(t)&&n.delete(e)}function mT(){Pd=!1,Sr!==null&&fl(Sr)&&(Sr=null),br!==null&&fl(br)&&(br=null),Cr!==null&&fl(Cr)&&(Cr=null),Ao.forEach(Lm),Ro.forEach(Lm)}function Ji(t,e){t.blockedOn===e&&(t.blockedOn=null,Pd||(Pd=!0,Gt.unstable_scheduleCallback(Gt.unstable_NormalPriority,mT)))}function jo(t){function e(s){return Ji(s,t)}if(0<Qa.length){Ji(Qa[0],t);for(var n=1;n<Qa.length;n++){var r=Qa[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Sr!==null&&Ji(Sr,t),br!==null&&Ji(br,t),Cr!==null&&Ji(Cr,t),Ao.forEach(e),Ro.forEach(e),n=0;n<mr.length;n++)r=mr[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<mr.length&&(n=mr[0],n.blockedOn===null);)Gv(n),n.blockedOn===null&&mr.shift()}var ri=rr.ReactCurrentBatchConfig,Ll=!0;function gT(t,e,n,r){var s=Te,i=ri.transition;ri.transition=null;try{Te=1,Hh(t,e,n,r)}finally{Te=s,ri.transition=i}}function yT(t,e,n,r){var s=Te,i=ri.transition;ri.transition=null;try{Te=4,Hh(t,e,n,r)}finally{Te=s,ri.transition=i}}function Hh(t,e,n,r){if(Ll){var s=Nd(t,e,n,r);if(s===null)Lu(t,e,r,Vl,n),Om(t,r);else if(pT(s,t,e,n,r))r.stopPropagation();else if(Om(t,r),e&4&&-1<fT.indexOf(t)){for(;s!==null;){var i=oa(s);if(i!==null&&zv(i),i=Nd(t,e,n,r),i===null&&Lu(t,e,r,Vl,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else Lu(t,e,r,null,n)}}var Vl=null;function Nd(t,e,n,r){if(Vl=null,t=$h(r),t=rs(t),t!==null)if(e=Is(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Mv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Vl=t,null}function Kv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(sT()){case Bh:return 1;case Fv:return 4;case Ml:case iT:return 16;case Uv:return 536870912;default:return 16}default:return 16}}var xr=null,qh=null,pl=null;function Qv(){if(pl)return pl;var t,e=qh,n=e.length,r,s="value"in xr?xr.value:xr.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return pl=s.slice(t,1<r?1-r:void 0)}function ml(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ya(){return!0}function Vm(){return!1}function Qt(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ya:Vm,this.isPropagationStopped=Vm,this}return Ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ya)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ya)},persist:function(){},isPersistent:Ya}),e}var bi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Gh=Qt(bi),ia=Ve({},bi,{view:0,detail:0}),vT=Qt(ia),Pu,Nu,Xi,Tc=Ve({},ia,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Kh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Xi&&(Xi&&t.type==="mousemove"?(Pu=t.screenX-Xi.screenX,Nu=t.screenY-Xi.screenY):Nu=Pu=0,Xi=t),Pu)},movementY:function(t){return"movementY"in t?t.movementY:Nu}}),Fm=Qt(Tc),_T=Ve({},Tc,{dataTransfer:0}),wT=Qt(_T),xT=Ve({},ia,{relatedTarget:0}),ku=Qt(xT),ET=Ve({},bi,{animationName:0,elapsedTime:0,pseudoElement:0}),TT=Qt(ET),IT=Ve({},bi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),ST=Qt(IT),bT=Ve({},bi,{data:0}),Um=Qt(bT),CT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},PT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},NT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kT(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=NT[t])?!!e[t]:!1}function Kh(){return kT}var AT=Ve({},ia,{key:function(t){if(t.key){var e=CT[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ml(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?PT[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Kh,charCode:function(t){return t.type==="keypress"?ml(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ml(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),RT=Qt(AT),jT=Ve({},Tc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$m=Qt(jT),DT=Ve({},ia,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Kh}),MT=Qt(DT),OT=Ve({},bi,{propertyName:0,elapsedTime:0,pseudoElement:0}),LT=Qt(OT),VT=Ve({},Tc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),FT=Qt(VT),UT=[9,13,27,32],Qh=Qn&&"CompositionEvent"in window,go=null;Qn&&"documentMode"in document&&(go=document.documentMode);var $T=Qn&&"TextEvent"in window&&!go,Yv=Qn&&(!Qh||go&&8<go&&11>=go),Bm=String.fromCharCode(32),zm=!1;function Jv(t,e){switch(t){case"keyup":return UT.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Xv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var zs=!1;function BT(t,e){switch(t){case"compositionend":return Xv(e);case"keypress":return e.which!==32?null:(zm=!0,Bm);case"textInput":return t=e.data,t===Bm&&zm?null:t;default:return null}}function zT(t,e){if(zs)return t==="compositionend"||!Qh&&Jv(t,e)?(t=Qv(),pl=qh=xr=null,zs=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Yv&&e.locale!=="ko"?null:e.data;default:return null}}var WT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!WT[t.type]:e==="textarea"}function Zv(t,e,n,r){kv(r),e=Fl(e,"onChange"),0<e.length&&(n=new Gh("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var yo=null,Do=null;function HT(t){u0(t,0)}function Ic(t){var e=qs(t);if(Tv(e))return t}function qT(t,e){if(t==="change")return e}var e0=!1;if(Qn){var Au;if(Qn){var Ru="oninput"in document;if(!Ru){var Hm=document.createElement("div");Hm.setAttribute("oninput","return;"),Ru=typeof Hm.oninput=="function"}Au=Ru}else Au=!1;e0=Au&&(!document.documentMode||9<document.documentMode)}function qm(){yo&&(yo.detachEvent("onpropertychange",t0),Do=yo=null)}function t0(t){if(t.propertyName==="value"&&Ic(Do)){var e=[];Zv(e,Do,t,$h(t)),Dv(HT,e)}}function GT(t,e,n){t==="focusin"?(qm(),yo=e,Do=n,yo.attachEvent("onpropertychange",t0)):t==="focusout"&&qm()}function KT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ic(Do)}function QT(t,e){if(t==="click")return Ic(e)}function YT(t,e){if(t==="input"||t==="change")return Ic(e)}function JT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var mn=typeof Object.is=="function"?Object.is:JT;function Mo(t,e){if(mn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!dd.call(e,s)||!mn(t[s],e[s]))return!1}return!0}function Gm(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Km(t,e){var n=Gm(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Gm(n)}}function n0(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?n0(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function r0(){for(var t=window,e=Rl();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Rl(t.document)}return e}function Yh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function XT(t){var e=r0(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&n0(n.ownerDocument.documentElement,n)){if(r!==null&&Yh(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Km(n,i);var o=Km(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var ZT=Qn&&"documentMode"in document&&11>=document.documentMode,Ws=null,kd=null,vo=null,Ad=!1;function Qm(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ad||Ws==null||Ws!==Rl(r)||(r=Ws,"selectionStart"in r&&Yh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),vo&&Mo(vo,r)||(vo=r,r=Fl(kd,"onSelect"),0<r.length&&(e=new Gh("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Ws)))}function Ja(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Hs={animationend:Ja("Animation","AnimationEnd"),animationiteration:Ja("Animation","AnimationIteration"),animationstart:Ja("Animation","AnimationStart"),transitionend:Ja("Transition","TransitionEnd")},ju={},s0={};Qn&&(s0=document.createElement("div").style,"AnimationEvent"in window||(delete Hs.animationend.animation,delete Hs.animationiteration.animation,delete Hs.animationstart.animation),"TransitionEvent"in window||delete Hs.transitionend.transition);function Sc(t){if(ju[t])return ju[t];if(!Hs[t])return t;var e=Hs[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in s0)return ju[t]=e[n];return t}var i0=Sc("animationend"),o0=Sc("animationiteration"),a0=Sc("animationstart"),l0=Sc("transitionend"),c0=new Map,Ym="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Wr(t,e){c0.set(t,e),Ts(e,[t])}for(var Du=0;Du<Ym.length;Du++){var Mu=Ym[Du],eI=Mu.toLowerCase(),tI=Mu[0].toUpperCase()+Mu.slice(1);Wr(eI,"on"+tI)}Wr(i0,"onAnimationEnd");Wr(o0,"onAnimationIteration");Wr(a0,"onAnimationStart");Wr("dblclick","onDoubleClick");Wr("focusin","onFocus");Wr("focusout","onBlur");Wr(l0,"onTransitionEnd");ui("onMouseEnter",["mouseout","mouseover"]);ui("onMouseLeave",["mouseout","mouseover"]);ui("onPointerEnter",["pointerout","pointerover"]);ui("onPointerLeave",["pointerout","pointerover"]);Ts("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ts("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ts("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ts("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ts("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ts("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var oo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nI=new Set("cancel close invalid load scroll toggle".split(" ").concat(oo));function Jm(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,eT(r,e,void 0,t),t.currentTarget=null}function u0(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;Jm(s,l,d),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;Jm(s,l,d),i=c}}}if(Dl)throw t=bd,Dl=!1,bd=null,t}function ke(t,e){var n=e[Od];n===void 0&&(n=e[Od]=new Set);var r=t+"__bubble";n.has(r)||(d0(e,t,2,!1),n.add(r))}function Ou(t,e,n){var r=0;e&&(r|=4),d0(n,t,r,e)}var Xa="_reactListening"+Math.random().toString(36).slice(2);function Oo(t){if(!t[Xa]){t[Xa]=!0,vv.forEach(function(n){n!=="selectionchange"&&(nI.has(n)||Ou(n,!1,t),Ou(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Xa]||(e[Xa]=!0,Ou("selectionchange",!1,e))}}function d0(t,e,n,r){switch(Kv(e)){case 1:var s=gT;break;case 4:s=yT;break;default:s=Hh}n=s.bind(null,e,n,t),s=void 0,!Sd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Lu(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=rs(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}Dv(function(){var d=i,p=$h(n),m=[];e:{var g=c0.get(t);if(g!==void 0){var S=Gh,C=t;switch(t){case"keypress":if(ml(n)===0)break e;case"keydown":case"keyup":S=RT;break;case"focusin":C="focus",S=ku;break;case"focusout":C="blur",S=ku;break;case"beforeblur":case"afterblur":S=ku;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":S=Fm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":S=wT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":S=MT;break;case i0:case o0:case a0:S=TT;break;case l0:S=LT;break;case"scroll":S=vT;break;case"wheel":S=FT;break;case"copy":case"cut":case"paste":S=ST;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":S=$m}var k=(e&4)!==0,R=!k&&t==="scroll",I=k?g!==null?g+"Capture":null:g;k=[];for(var w=d,b;w!==null;){b=w;var M=b.stateNode;if(b.tag===5&&M!==null&&(b=M,I!==null&&(M=ko(w,I),M!=null&&k.push(Lo(w,M,b)))),R)break;w=w.return}0<k.length&&(g=new S(g,C,null,n,p),m.push({event:g,listeners:k}))}}if(!(e&7)){e:{if(g=t==="mouseover"||t==="pointerover",S=t==="mouseout"||t==="pointerout",g&&n!==Td&&(C=n.relatedTarget||n.fromElement)&&(rs(C)||C[Yn]))break e;if((S||g)&&(g=p.window===p?p:(g=p.ownerDocument)?g.defaultView||g.parentWindow:window,S?(C=n.relatedTarget||n.toElement,S=d,C=C?rs(C):null,C!==null&&(R=Is(C),C!==R||C.tag!==5&&C.tag!==6)&&(C=null)):(S=null,C=d),S!==C)){if(k=Fm,M="onMouseLeave",I="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(k=$m,M="onPointerLeave",I="onPointerEnter",w="pointer"),R=S==null?g:qs(S),b=C==null?g:qs(C),g=new k(M,w+"leave",S,n,p),g.target=R,g.relatedTarget=b,M=null,rs(p)===d&&(k=new k(I,w+"enter",C,n,p),k.target=b,k.relatedTarget=R,M=k),R=M,S&&C)t:{for(k=S,I=C,w=0,b=k;b;b=Ms(b))w++;for(b=0,M=I;M;M=Ms(M))b++;for(;0<w-b;)k=Ms(k),w--;for(;0<b-w;)I=Ms(I),b--;for(;w--;){if(k===I||I!==null&&k===I.alternate)break t;k=Ms(k),I=Ms(I)}k=null}else k=null;S!==null&&Xm(m,g,S,k,!1),C!==null&&R!==null&&Xm(m,R,C,k,!0)}}e:{if(g=d?qs(d):window,S=g.nodeName&&g.nodeName.toLowerCase(),S==="select"||S==="input"&&g.type==="file")var O=qT;else if(Wm(g))if(e0)O=YT;else{O=KT;var V=GT}else(S=g.nodeName)&&S.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(O=QT);if(O&&(O=O(t,d))){Zv(m,O,n,p);break e}V&&V(t,g,d),t==="focusout"&&(V=g._wrapperState)&&V.controlled&&g.type==="number"&&vd(g,"number",g.value)}switch(V=d?qs(d):window,t){case"focusin":(Wm(V)||V.contentEditable==="true")&&(Ws=V,kd=d,vo=null);break;case"focusout":vo=kd=Ws=null;break;case"mousedown":Ad=!0;break;case"contextmenu":case"mouseup":case"dragend":Ad=!1,Qm(m,n,p);break;case"selectionchange":if(ZT)break;case"keydown":case"keyup":Qm(m,n,p)}var _;if(Qh)e:{switch(t){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else zs?Jv(t,n)&&(y="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(y="onCompositionStart");y&&(Yv&&n.locale!=="ko"&&(zs||y!=="onCompositionStart"?y==="onCompositionEnd"&&zs&&(_=Qv()):(xr=p,qh="value"in xr?xr.value:xr.textContent,zs=!0)),V=Fl(d,y),0<V.length&&(y=new Um(y,t,null,n,p),m.push({event:y,listeners:V}),_?y.data=_:(_=Xv(n),_!==null&&(y.data=_)))),(_=$T?BT(t,n):zT(t,n))&&(d=Fl(d,"onBeforeInput"),0<d.length&&(p=new Um("onBeforeInput","beforeinput",null,n,p),m.push({event:p,listeners:d}),p.data=_))}u0(m,e)})}function Lo(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Fl(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=ko(t,n),i!=null&&r.unshift(Lo(t,i,s)),i=ko(t,e),i!=null&&r.push(Lo(t,i,s))),t=t.return}return r}function Ms(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Xm(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=ko(n,i),c!=null&&o.unshift(Lo(n,c,l))):s||(c=ko(n,i),c!=null&&o.push(Lo(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var rI=/\r\n?/g,sI=/\u0000|\uFFFD/g;function Zm(t){return(typeof t=="string"?t:""+t).replace(rI,`
`).replace(sI,"")}function Za(t,e,n){if(e=Zm(e),Zm(t)!==e&&n)throw Error(z(425))}function Ul(){}var Rd=null,jd=null;function Dd(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Md=typeof setTimeout=="function"?setTimeout:void 0,iI=typeof clearTimeout=="function"?clearTimeout:void 0,eg=typeof Promise=="function"?Promise:void 0,oI=typeof queueMicrotask=="function"?queueMicrotask:typeof eg<"u"?function(t){return eg.resolve(null).then(t).catch(aI)}:Md;function aI(t){setTimeout(function(){throw t})}function Vu(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),jo(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);jo(e)}function Pr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function tg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ci=Math.random().toString(36).slice(2),In="__reactFiber$"+Ci,Vo="__reactProps$"+Ci,Yn="__reactContainer$"+Ci,Od="__reactEvents$"+Ci,lI="__reactListeners$"+Ci,cI="__reactHandles$"+Ci;function rs(t){var e=t[In];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Yn]||n[In]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=tg(t);t!==null;){if(n=t[In])return n;t=tg(t)}return e}t=n,n=t.parentNode}return null}function oa(t){return t=t[In]||t[Yn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function qs(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(z(33))}function bc(t){return t[Vo]||null}var Ld=[],Gs=-1;function Hr(t){return{current:t}}function Re(t){0>Gs||(t.current=Ld[Gs],Ld[Gs]=null,Gs--)}function Ce(t,e){Gs++,Ld[Gs]=t.current,t.current=e}var Fr={},bt=Hr(Fr),Ft=Hr(!1),ds=Fr;function di(t,e){var n=t.type.contextTypes;if(!n)return Fr;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Ut(t){return t=t.childContextTypes,t!=null}function $l(){Re(Ft),Re(bt)}function ng(t,e,n){if(bt.current!==Fr)throw Error(z(168));Ce(bt,e),Ce(Ft,n)}function h0(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(z(108,GE(t)||"Unknown",s));return Ve({},n,r)}function Bl(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Fr,ds=bt.current,Ce(bt,t),Ce(Ft,Ft.current),!0}function rg(t,e,n){var r=t.stateNode;if(!r)throw Error(z(169));n?(t=h0(t,e,ds),r.__reactInternalMemoizedMergedChildContext=t,Re(Ft),Re(bt),Ce(bt,t)):Re(Ft),Ce(Ft,n)}var Vn=null,Cc=!1,Fu=!1;function f0(t){Vn===null?Vn=[t]:Vn.push(t)}function uI(t){Cc=!0,f0(t)}function qr(){if(!Fu&&Vn!==null){Fu=!0;var t=0,e=Te;try{var n=Vn;for(Te=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Vn=null,Cc=!1}catch(s){throw Vn!==null&&(Vn=Vn.slice(t+1)),Vv(Bh,qr),s}finally{Te=e,Fu=!1}}return null}var Ks=[],Qs=0,zl=null,Wl=0,Jt=[],Xt=0,hs=null,$n=1,Bn="";function es(t,e){Ks[Qs++]=Wl,Ks[Qs++]=zl,zl=t,Wl=e}function p0(t,e,n){Jt[Xt++]=$n,Jt[Xt++]=Bn,Jt[Xt++]=hs,hs=t;var r=$n;t=Bn;var s=32-hn(r)-1;r&=~(1<<s),n+=1;var i=32-hn(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,$n=1<<32-hn(e)+s|n<<s|r,Bn=i+t}else $n=1<<i|n<<s|r,Bn=t}function Jh(t){t.return!==null&&(es(t,1),p0(t,1,0))}function Xh(t){for(;t===zl;)zl=Ks[--Qs],Ks[Qs]=null,Wl=Ks[--Qs],Ks[Qs]=null;for(;t===hs;)hs=Jt[--Xt],Jt[Xt]=null,Bn=Jt[--Xt],Jt[Xt]=null,$n=Jt[--Xt],Jt[Xt]=null}var qt=null,Wt=null,Me=!1,dn=null;function m0(t,e){var n=Zt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function sg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,qt=t,Wt=Pr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,qt=t,Wt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=hs!==null?{id:$n,overflow:Bn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Zt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,qt=t,Wt=null,!0):!1;default:return!1}}function Vd(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Fd(t){if(Me){var e=Wt;if(e){var n=e;if(!sg(t,e)){if(Vd(t))throw Error(z(418));e=Pr(n.nextSibling);var r=qt;e&&sg(t,e)?m0(r,n):(t.flags=t.flags&-4097|2,Me=!1,qt=t)}}else{if(Vd(t))throw Error(z(418));t.flags=t.flags&-4097|2,Me=!1,qt=t}}}function ig(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;qt=t}function el(t){if(t!==qt)return!1;if(!Me)return ig(t),Me=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Dd(t.type,t.memoizedProps)),e&&(e=Wt)){if(Vd(t))throw g0(),Error(z(418));for(;e;)m0(t,e),e=Pr(e.nextSibling)}if(ig(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(z(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Wt=Pr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Wt=null}}else Wt=qt?Pr(t.stateNode.nextSibling):null;return!0}function g0(){for(var t=Wt;t;)t=Pr(t.nextSibling)}function hi(){Wt=qt=null,Me=!1}function Zh(t){dn===null?dn=[t]:dn.push(t)}var dI=rr.ReactCurrentBatchConfig;function Zi(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(z(309));var r=n.stateNode}if(!r)throw Error(z(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(z(284));if(!n._owner)throw Error(z(290,t))}return t}function tl(t,e){throw t=Object.prototype.toString.call(e),Error(z(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function og(t){var e=t._init;return e(t._payload)}function y0(t){function e(I,w){if(t){var b=I.deletions;b===null?(I.deletions=[w],I.flags|=16):b.push(w)}}function n(I,w){if(!t)return null;for(;w!==null;)e(I,w),w=w.sibling;return null}function r(I,w){for(I=new Map;w!==null;)w.key!==null?I.set(w.key,w):I.set(w.index,w),w=w.sibling;return I}function s(I,w){return I=Rr(I,w),I.index=0,I.sibling=null,I}function i(I,w,b){return I.index=b,t?(b=I.alternate,b!==null?(b=b.index,b<w?(I.flags|=2,w):b):(I.flags|=2,w)):(I.flags|=1048576,w)}function o(I){return t&&I.alternate===null&&(I.flags|=2),I}function l(I,w,b,M){return w===null||w.tag!==6?(w=qu(b,I.mode,M),w.return=I,w):(w=s(w,b),w.return=I,w)}function c(I,w,b,M){var O=b.type;return O===Bs?p(I,w,b.props.children,M,b.key):w!==null&&(w.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===fr&&og(O)===w.type)?(M=s(w,b.props),M.ref=Zi(I,w,b),M.return=I,M):(M=El(b.type,b.key,b.props,null,I.mode,M),M.ref=Zi(I,w,b),M.return=I,M)}function d(I,w,b,M){return w===null||w.tag!==4||w.stateNode.containerInfo!==b.containerInfo||w.stateNode.implementation!==b.implementation?(w=Gu(b,I.mode,M),w.return=I,w):(w=s(w,b.children||[]),w.return=I,w)}function p(I,w,b,M,O){return w===null||w.tag!==7?(w=cs(b,I.mode,M,O),w.return=I,w):(w=s(w,b),w.return=I,w)}function m(I,w,b){if(typeof w=="string"&&w!==""||typeof w=="number")return w=qu(""+w,I.mode,b),w.return=I,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Wa:return b=El(w.type,w.key,w.props,null,I.mode,b),b.ref=Zi(I,null,w),b.return=I,b;case $s:return w=Gu(w,I.mode,b),w.return=I,w;case fr:var M=w._init;return m(I,M(w._payload),b)}if(so(w)||Ki(w))return w=cs(w,I.mode,b,null),w.return=I,w;tl(I,w)}return null}function g(I,w,b,M){var O=w!==null?w.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return O!==null?null:l(I,w,""+b,M);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Wa:return b.key===O?c(I,w,b,M):null;case $s:return b.key===O?d(I,w,b,M):null;case fr:return O=b._init,g(I,w,O(b._payload),M)}if(so(b)||Ki(b))return O!==null?null:p(I,w,b,M,null);tl(I,b)}return null}function S(I,w,b,M,O){if(typeof M=="string"&&M!==""||typeof M=="number")return I=I.get(b)||null,l(w,I,""+M,O);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case Wa:return I=I.get(M.key===null?b:M.key)||null,c(w,I,M,O);case $s:return I=I.get(M.key===null?b:M.key)||null,d(w,I,M,O);case fr:var V=M._init;return S(I,w,b,V(M._payload),O)}if(so(M)||Ki(M))return I=I.get(b)||null,p(w,I,M,O,null);tl(w,M)}return null}function C(I,w,b,M){for(var O=null,V=null,_=w,y=w=0,x=null;_!==null&&y<b.length;y++){_.index>y?(x=_,_=null):x=_.sibling;var E=g(I,_,b[y],M);if(E===null){_===null&&(_=x);break}t&&_&&E.alternate===null&&e(I,_),w=i(E,w,y),V===null?O=E:V.sibling=E,V=E,_=x}if(y===b.length)return n(I,_),Me&&es(I,y),O;if(_===null){for(;y<b.length;y++)_=m(I,b[y],M),_!==null&&(w=i(_,w,y),V===null?O=_:V.sibling=_,V=_);return Me&&es(I,y),O}for(_=r(I,_);y<b.length;y++)x=S(_,I,y,b[y],M),x!==null&&(t&&x.alternate!==null&&_.delete(x.key===null?y:x.key),w=i(x,w,y),V===null?O=x:V.sibling=x,V=x);return t&&_.forEach(function(P){return e(I,P)}),Me&&es(I,y),O}function k(I,w,b,M){var O=Ki(b);if(typeof O!="function")throw Error(z(150));if(b=O.call(b),b==null)throw Error(z(151));for(var V=O=null,_=w,y=w=0,x=null,E=b.next();_!==null&&!E.done;y++,E=b.next()){_.index>y?(x=_,_=null):x=_.sibling;var P=g(I,_,E.value,M);if(P===null){_===null&&(_=x);break}t&&_&&P.alternate===null&&e(I,_),w=i(P,w,y),V===null?O=P:V.sibling=P,V=P,_=x}if(E.done)return n(I,_),Me&&es(I,y),O;if(_===null){for(;!E.done;y++,E=b.next())E=m(I,E.value,M),E!==null&&(w=i(E,w,y),V===null?O=E:V.sibling=E,V=E);return Me&&es(I,y),O}for(_=r(I,_);!E.done;y++,E=b.next())E=S(_,I,y,E.value,M),E!==null&&(t&&E.alternate!==null&&_.delete(E.key===null?y:E.key),w=i(E,w,y),V===null?O=E:V.sibling=E,V=E);return t&&_.forEach(function(N){return e(I,N)}),Me&&es(I,y),O}function R(I,w,b,M){if(typeof b=="object"&&b!==null&&b.type===Bs&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Wa:e:{for(var O=b.key,V=w;V!==null;){if(V.key===O){if(O=b.type,O===Bs){if(V.tag===7){n(I,V.sibling),w=s(V,b.props.children),w.return=I,I=w;break e}}else if(V.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===fr&&og(O)===V.type){n(I,V.sibling),w=s(V,b.props),w.ref=Zi(I,V,b),w.return=I,I=w;break e}n(I,V);break}else e(I,V);V=V.sibling}b.type===Bs?(w=cs(b.props.children,I.mode,M,b.key),w.return=I,I=w):(M=El(b.type,b.key,b.props,null,I.mode,M),M.ref=Zi(I,w,b),M.return=I,I=M)}return o(I);case $s:e:{for(V=b.key;w!==null;){if(w.key===V)if(w.tag===4&&w.stateNode.containerInfo===b.containerInfo&&w.stateNode.implementation===b.implementation){n(I,w.sibling),w=s(w,b.children||[]),w.return=I,I=w;break e}else{n(I,w);break}else e(I,w);w=w.sibling}w=Gu(b,I.mode,M),w.return=I,I=w}return o(I);case fr:return V=b._init,R(I,w,V(b._payload),M)}if(so(b))return C(I,w,b,M);if(Ki(b))return k(I,w,b,M);tl(I,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,w!==null&&w.tag===6?(n(I,w.sibling),w=s(w,b),w.return=I,I=w):(n(I,w),w=qu(b,I.mode,M),w.return=I,I=w),o(I)):n(I,w)}return R}var fi=y0(!0),v0=y0(!1),Hl=Hr(null),ql=null,Ys=null,ef=null;function tf(){ef=Ys=ql=null}function nf(t){var e=Hl.current;Re(Hl),t._currentValue=e}function Ud(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function si(t,e){ql=t,ef=Ys=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Vt=!0),t.firstContext=null)}function nn(t){var e=t._currentValue;if(ef!==t)if(t={context:t,memoizedValue:e,next:null},Ys===null){if(ql===null)throw Error(z(308));Ys=t,ql.dependencies={lanes:0,firstContext:t}}else Ys=Ys.next=t;return e}var ss=null;function rf(t){ss===null?ss=[t]:ss.push(t)}function _0(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,rf(e)):(n.next=s.next,s.next=n),e.interleaved=n,Jn(t,r)}function Jn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var pr=!1;function sf(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function w0(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function qn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Nr(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ve&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Jn(t,n)}return s=r.interleaved,s===null?(e.next=e,rf(r)):(e.next=s.next,s.next=e),r.interleaved=e,Jn(t,n)}function gl(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,zh(t,n)}}function ag(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Gl(t,e,n,r){var s=t.updateQueue;pr=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var p=t.alternate;p!==null&&(p=p.updateQueue,l=p.lastBaseUpdate,l!==o&&(l===null?p.firstBaseUpdate=d:l.next=d,p.lastBaseUpdate=c))}if(i!==null){var m=s.baseState;o=0,p=d=c=null,l=i;do{var g=l.lane,S=l.eventTime;if((r&g)===g){p!==null&&(p=p.next={eventTime:S,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var C=t,k=l;switch(g=e,S=n,k.tag){case 1:if(C=k.payload,typeof C=="function"){m=C.call(S,m,g);break e}m=C;break e;case 3:C.flags=C.flags&-65537|128;case 0:if(C=k.payload,g=typeof C=="function"?C.call(S,m,g):C,g==null)break e;m=Ve({},m,g);break e;case 2:pr=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,g=s.effects,g===null?s.effects=[l]:g.push(l))}else S={eventTime:S,lane:g,tag:l.tag,payload:l.payload,callback:l.callback,next:null},p===null?(d=p=S,c=m):p=p.next=S,o|=g;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;g=l,l=g.next,g.next=null,s.lastBaseUpdate=g,s.shared.pending=null}}while(1);if(p===null&&(c=m),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=p,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ps|=o,t.lanes=o,t.memoizedState=m}}function lg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(z(191,s));s.call(r)}}}var aa={},Cn=Hr(aa),Fo=Hr(aa),Uo=Hr(aa);function is(t){if(t===aa)throw Error(z(174));return t}function of(t,e){switch(Ce(Uo,e),Ce(Fo,t),Ce(Cn,aa),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:wd(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=wd(e,t)}Re(Cn),Ce(Cn,e)}function pi(){Re(Cn),Re(Fo),Re(Uo)}function x0(t){is(Uo.current);var e=is(Cn.current),n=wd(e,t.type);e!==n&&(Ce(Fo,t),Ce(Cn,n))}function af(t){Fo.current===t&&(Re(Cn),Re(Fo))}var Oe=Hr(0);function Kl(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Uu=[];function lf(){for(var t=0;t<Uu.length;t++)Uu[t]._workInProgressVersionPrimary=null;Uu.length=0}var yl=rr.ReactCurrentDispatcher,$u=rr.ReactCurrentBatchConfig,fs=0,Le=null,Je=null,nt=null,Ql=!1,_o=!1,$o=0,hI=0;function _t(){throw Error(z(321))}function cf(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!mn(t[n],e[n]))return!1;return!0}function uf(t,e,n,r,s,i){if(fs=i,Le=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,yl.current=t===null||t.memoizedState===null?gI:yI,t=n(r,s),_o){i=0;do{if(_o=!1,$o=0,25<=i)throw Error(z(301));i+=1,nt=Je=null,e.updateQueue=null,yl.current=vI,t=n(r,s)}while(_o)}if(yl.current=Yl,e=Je!==null&&Je.next!==null,fs=0,nt=Je=Le=null,Ql=!1,e)throw Error(z(300));return t}function df(){var t=$o!==0;return $o=0,t}function En(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return nt===null?Le.memoizedState=nt=t:nt=nt.next=t,nt}function rn(){if(Je===null){var t=Le.alternate;t=t!==null?t.memoizedState:null}else t=Je.next;var e=nt===null?Le.memoizedState:nt.next;if(e!==null)nt=e,Je=t;else{if(t===null)throw Error(z(310));Je=t,t={memoizedState:Je.memoizedState,baseState:Je.baseState,baseQueue:Je.baseQueue,queue:Je.queue,next:null},nt===null?Le.memoizedState=nt=t:nt=nt.next=t}return nt}function Bo(t,e){return typeof e=="function"?e(t):e}function Bu(t){var e=rn(),n=e.queue;if(n===null)throw Error(z(311));n.lastRenderedReducer=t;var r=Je,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,c=null,d=i;do{var p=d.lane;if((fs&p)===p)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var m={lane:p,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=m,o=r):c=c.next=m,Le.lanes|=p,ps|=p}d=d.next}while(d!==null&&d!==i);c===null?o=r:c.next=l,mn(r,e.memoizedState)||(Vt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Le.lanes|=i,ps|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function zu(t){var e=rn(),n=e.queue;if(n===null)throw Error(z(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);mn(i,e.memoizedState)||(Vt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function E0(){}function T0(t,e){var n=Le,r=rn(),s=e(),i=!mn(r.memoizedState,s);if(i&&(r.memoizedState=s,Vt=!0),r=r.queue,hf(b0.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||nt!==null&&nt.memoizedState.tag&1){if(n.flags|=2048,zo(9,S0.bind(null,n,r,s,e),void 0,null),rt===null)throw Error(z(349));fs&30||I0(n,e,s)}return s}function I0(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Le.updateQueue,e===null?(e={lastEffect:null,stores:null},Le.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function S0(t,e,n,r){e.value=n,e.getSnapshot=r,C0(e)&&P0(t)}function b0(t,e,n){return n(function(){C0(e)&&P0(t)})}function C0(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!mn(t,n)}catch{return!0}}function P0(t){var e=Jn(t,1);e!==null&&fn(e,t,1,-1)}function cg(t){var e=En();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Bo,lastRenderedState:t},e.queue=t,t=t.dispatch=mI.bind(null,Le,t),[e.memoizedState,t]}function zo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Le.updateQueue,e===null?(e={lastEffect:null,stores:null},Le.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function N0(){return rn().memoizedState}function vl(t,e,n,r){var s=En();Le.flags|=t,s.memoizedState=zo(1|e,n,void 0,r===void 0?null:r)}function Pc(t,e,n,r){var s=rn();r=r===void 0?null:r;var i=void 0;if(Je!==null){var o=Je.memoizedState;if(i=o.destroy,r!==null&&cf(r,o.deps)){s.memoizedState=zo(e,n,i,r);return}}Le.flags|=t,s.memoizedState=zo(1|e,n,i,r)}function ug(t,e){return vl(8390656,8,t,e)}function hf(t,e){return Pc(2048,8,t,e)}function k0(t,e){return Pc(4,2,t,e)}function A0(t,e){return Pc(4,4,t,e)}function R0(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function j0(t,e,n){return n=n!=null?n.concat([t]):null,Pc(4,4,R0.bind(null,e,t),n)}function ff(){}function D0(t,e){var n=rn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&cf(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function M0(t,e){var n=rn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&cf(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function O0(t,e,n){return fs&21?(mn(n,e)||(n=$v(),Le.lanes|=n,ps|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Vt=!0),t.memoizedState=n)}function fI(t,e){var n=Te;Te=n!==0&&4>n?n:4,t(!0);var r=$u.transition;$u.transition={};try{t(!1),e()}finally{Te=n,$u.transition=r}}function L0(){return rn().memoizedState}function pI(t,e,n){var r=Ar(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},V0(t))F0(e,n);else if(n=_0(t,e,n,r),n!==null){var s=At();fn(n,t,r,s),U0(n,e,r)}}function mI(t,e,n){var r=Ar(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(V0(t))F0(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,n);if(s.hasEagerState=!0,s.eagerState=l,mn(l,o)){var c=e.interleaved;c===null?(s.next=s,rf(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=_0(t,e,s,r),n!==null&&(s=At(),fn(n,t,r,s),U0(n,e,r))}}function V0(t){var e=t.alternate;return t===Le||e!==null&&e===Le}function F0(t,e){_o=Ql=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function U0(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,zh(t,n)}}var Yl={readContext:nn,useCallback:_t,useContext:_t,useEffect:_t,useImperativeHandle:_t,useInsertionEffect:_t,useLayoutEffect:_t,useMemo:_t,useReducer:_t,useRef:_t,useState:_t,useDebugValue:_t,useDeferredValue:_t,useTransition:_t,useMutableSource:_t,useSyncExternalStore:_t,useId:_t,unstable_isNewReconciler:!1},gI={readContext:nn,useCallback:function(t,e){return En().memoizedState=[t,e===void 0?null:e],t},useContext:nn,useEffect:ug,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,vl(4194308,4,R0.bind(null,e,t),n)},useLayoutEffect:function(t,e){return vl(4194308,4,t,e)},useInsertionEffect:function(t,e){return vl(4,2,t,e)},useMemo:function(t,e){var n=En();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=En();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=pI.bind(null,Le,t),[r.memoizedState,t]},useRef:function(t){var e=En();return t={current:t},e.memoizedState=t},useState:cg,useDebugValue:ff,useDeferredValue:function(t){return En().memoizedState=t},useTransition:function(){var t=cg(!1),e=t[0];return t=fI.bind(null,t[1]),En().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Le,s=En();if(Me){if(n===void 0)throw Error(z(407));n=n()}else{if(n=e(),rt===null)throw Error(z(349));fs&30||I0(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,ug(b0.bind(null,r,i,t),[t]),r.flags|=2048,zo(9,S0.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=En(),e=rt.identifierPrefix;if(Me){var n=Bn,r=$n;n=(r&~(1<<32-hn(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=$o++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=hI++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},yI={readContext:nn,useCallback:D0,useContext:nn,useEffect:hf,useImperativeHandle:j0,useInsertionEffect:k0,useLayoutEffect:A0,useMemo:M0,useReducer:Bu,useRef:N0,useState:function(){return Bu(Bo)},useDebugValue:ff,useDeferredValue:function(t){var e=rn();return O0(e,Je.memoizedState,t)},useTransition:function(){var t=Bu(Bo)[0],e=rn().memoizedState;return[t,e]},useMutableSource:E0,useSyncExternalStore:T0,useId:L0,unstable_isNewReconciler:!1},vI={readContext:nn,useCallback:D0,useContext:nn,useEffect:hf,useImperativeHandle:j0,useInsertionEffect:k0,useLayoutEffect:A0,useMemo:M0,useReducer:zu,useRef:N0,useState:function(){return zu(Bo)},useDebugValue:ff,useDeferredValue:function(t){var e=rn();return Je===null?e.memoizedState=t:O0(e,Je.memoizedState,t)},useTransition:function(){var t=zu(Bo)[0],e=rn().memoizedState;return[t,e]},useMutableSource:E0,useSyncExternalStore:T0,useId:L0,unstable_isNewReconciler:!1};function cn(t,e){if(t&&t.defaultProps){e=Ve({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function $d(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ve({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Nc={isMounted:function(t){return(t=t._reactInternals)?Is(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=At(),s=Ar(t),i=qn(r,s);i.payload=e,n!=null&&(i.callback=n),e=Nr(t,i,s),e!==null&&(fn(e,t,s,r),gl(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=At(),s=Ar(t),i=qn(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Nr(t,i,s),e!==null&&(fn(e,t,s,r),gl(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=At(),r=Ar(t),s=qn(n,r);s.tag=2,e!=null&&(s.callback=e),e=Nr(t,s,r),e!==null&&(fn(e,t,r,n),gl(e,t,r))}};function dg(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Mo(n,r)||!Mo(s,i):!0}function $0(t,e,n){var r=!1,s=Fr,i=e.contextType;return typeof i=="object"&&i!==null?i=nn(i):(s=Ut(e)?ds:bt.current,r=e.contextTypes,i=(r=r!=null)?di(t,s):Fr),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Nc,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function hg(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Nc.enqueueReplaceState(e,e.state,null)}function Bd(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},sf(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=nn(i):(i=Ut(e)?ds:bt.current,s.context=di(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&($d(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Nc.enqueueReplaceState(s,s.state,null),Gl(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function mi(t,e){try{var n="",r=e;do n+=qE(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Wu(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function zd(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var _I=typeof WeakMap=="function"?WeakMap:Map;function B0(t,e,n){n=qn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Xl||(Xl=!0,Zd=r),zd(t,e)},n}function z0(t,e,n){n=qn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){zd(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){zd(t,e),typeof r!="function"&&(kr===null?kr=new Set([this]):kr.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function fg(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new _I;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=jI.bind(null,t,e,n),e.then(t,t))}function pg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function mg(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=qn(-1,1),e.tag=2,Nr(n,e,1))),n.lanes|=1),t)}var wI=rr.ReactCurrentOwner,Vt=!1;function kt(t,e,n,r){e.child=t===null?v0(e,null,n,r):fi(e,t.child,n,r)}function gg(t,e,n,r,s){n=n.render;var i=e.ref;return si(e,s),r=uf(t,e,n,r,i,s),n=df(),t!==null&&!Vt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Xn(t,e,s)):(Me&&n&&Jh(e),e.flags|=1,kt(t,e,r,s),e.child)}function yg(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!xf(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,W0(t,e,i,r,s)):(t=El(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Mo,n(o,r)&&t.ref===e.ref)return Xn(t,e,s)}return e.flags|=1,t=Rr(i,r),t.ref=e.ref,t.return=e,e.child=t}function W0(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Mo(i,r)&&t.ref===e.ref)if(Vt=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Vt=!0);else return e.lanes=t.lanes,Xn(t,e,s)}return Wd(t,e,n,r,s)}function H0(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ce(Xs,zt),zt|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ce(Xs,zt),zt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Ce(Xs,zt),zt|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Ce(Xs,zt),zt|=r;return kt(t,e,s,n),e.child}function q0(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Wd(t,e,n,r,s){var i=Ut(n)?ds:bt.current;return i=di(e,i),si(e,s),n=uf(t,e,n,r,i,s),r=df(),t!==null&&!Vt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Xn(t,e,s)):(Me&&r&&Jh(e),e.flags|=1,kt(t,e,n,s),e.child)}function vg(t,e,n,r,s){if(Ut(n)){var i=!0;Bl(e)}else i=!1;if(si(e,s),e.stateNode===null)_l(t,e),$0(e,n,r),Bd(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=nn(d):(d=Ut(n)?ds:bt.current,d=di(e,d));var p=n.getDerivedStateFromProps,m=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function";m||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&hg(e,o,r,d),pr=!1;var g=e.memoizedState;o.state=g,Gl(e,r,o,s),c=e.memoizedState,l!==r||g!==c||Ft.current||pr?(typeof p=="function"&&($d(e,n,p,r),c=e.memoizedState),(l=pr||dg(e,n,l,r,g,c,d))?(m||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,w0(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:cn(e.type,l),o.props=d,m=e.pendingProps,g=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=nn(c):(c=Ut(n)?ds:bt.current,c=di(e,c));var S=n.getDerivedStateFromProps;(p=typeof S=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==m||g!==c)&&hg(e,o,r,c),pr=!1,g=e.memoizedState,o.state=g,Gl(e,r,o,s);var C=e.memoizedState;l!==m||g!==C||Ft.current||pr?(typeof S=="function"&&($d(e,n,S,r),C=e.memoizedState),(d=pr||dg(e,n,d,r,g,C,c)||!1)?(p||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,C,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,C,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=C),o.props=r,o.state=C,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),r=!1)}return Hd(t,e,n,r,i,s)}function Hd(t,e,n,r,s,i){q0(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&rg(e,n,!1),Xn(t,e,i);r=e.stateNode,wI.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=fi(e,t.child,null,i),e.child=fi(e,null,l,i)):kt(t,e,l,i),e.memoizedState=r.state,s&&rg(e,n,!0),e.child}function G0(t){var e=t.stateNode;e.pendingContext?ng(t,e.pendingContext,e.pendingContext!==e.context):e.context&&ng(t,e.context,!1),of(t,e.containerInfo)}function _g(t,e,n,r,s){return hi(),Zh(s),e.flags|=256,kt(t,e,n,r),e.child}var qd={dehydrated:null,treeContext:null,retryLane:0};function Gd(t){return{baseLanes:t,cachePool:null,transitions:null}}function K0(t,e,n){var r=e.pendingProps,s=Oe.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Ce(Oe,s&1),t===null)return Fd(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Rc(o,r,0,null),t=cs(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Gd(n),e.memoizedState=qd,t):pf(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return xI(t,e,o,r,l,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Rr(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=Rr(l,i):(i=cs(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Gd(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=qd,r}return i=t.child,t=i.sibling,r=Rr(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function pf(t,e){return e=Rc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function nl(t,e,n,r){return r!==null&&Zh(r),fi(e,t.child,null,n),t=pf(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function xI(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=Wu(Error(z(422))),nl(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Rc({mode:"visible",children:r.children},s,0,null),i=cs(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&fi(e,t.child,null,o),e.child.memoizedState=Gd(o),e.memoizedState=qd,i);if(!(e.mode&1))return nl(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(z(419)),r=Wu(i,r,void 0),nl(t,e,o,r)}if(l=(o&t.childLanes)!==0,Vt||l){if(r=rt,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Jn(t,s),fn(r,t,s,-1))}return wf(),r=Wu(Error(z(421))),nl(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=DI.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Wt=Pr(s.nextSibling),qt=e,Me=!0,dn=null,t!==null&&(Jt[Xt++]=$n,Jt[Xt++]=Bn,Jt[Xt++]=hs,$n=t.id,Bn=t.overflow,hs=e),e=pf(e,r.children),e.flags|=4096,e)}function wg(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Ud(t.return,e,n)}function Hu(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function Q0(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(kt(t,e,r.children,n),r=Oe.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&wg(t,n,e);else if(t.tag===19)wg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ce(Oe,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Kl(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Hu(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Kl(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Hu(e,!0,n,null,i);break;case"together":Hu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function _l(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Xn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ps|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(z(153));if(e.child!==null){for(t=e.child,n=Rr(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Rr(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function EI(t,e,n){switch(e.tag){case 3:G0(e),hi();break;case 5:x0(e);break;case 1:Ut(e.type)&&Bl(e);break;case 4:of(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Ce(Hl,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ce(Oe,Oe.current&1),e.flags|=128,null):n&e.child.childLanes?K0(t,e,n):(Ce(Oe,Oe.current&1),t=Xn(t,e,n),t!==null?t.sibling:null);Ce(Oe,Oe.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return Q0(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ce(Oe,Oe.current),r)break;return null;case 22:case 23:return e.lanes=0,H0(t,e,n)}return Xn(t,e,n)}var Y0,Kd,J0,X0;Y0=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Kd=function(){};J0=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,is(Cn.current);var i=null;switch(n){case"input":s=gd(t,s),r=gd(t,r),i=[];break;case"select":s=Ve({},s,{value:void 0}),r=Ve({},r,{value:void 0}),i=[];break;case"textarea":s=_d(t,s),r=_d(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Ul)}xd(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Po.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Po.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&ke("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};X0=function(t,e,n,r){n!==r&&(e.flags|=4)};function eo(t,e){if(!Me)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function wt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function TI(t,e,n){var r=e.pendingProps;switch(Xh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wt(e),null;case 1:return Ut(e.type)&&$l(),wt(e),null;case 3:return r=e.stateNode,pi(),Re(Ft),Re(bt),lf(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(el(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,dn!==null&&(nh(dn),dn=null))),Kd(t,e),wt(e),null;case 5:af(e);var s=is(Uo.current);if(n=e.type,t!==null&&e.stateNode!=null)J0(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(z(166));return wt(e),null}if(t=is(Cn.current),el(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[In]=e,r[Vo]=i,t=(e.mode&1)!==0,n){case"dialog":ke("cancel",r),ke("close",r);break;case"iframe":case"object":case"embed":ke("load",r);break;case"video":case"audio":for(s=0;s<oo.length;s++)ke(oo[s],r);break;case"source":ke("error",r);break;case"img":case"image":case"link":ke("error",r),ke("load",r);break;case"details":ke("toggle",r);break;case"input":Nm(r,i),ke("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},ke("invalid",r);break;case"textarea":Am(r,i),ke("invalid",r)}xd(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&Za(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Za(r.textContent,l,t),s=["children",""+l]):Po.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&ke("scroll",r)}switch(n){case"input":Ha(r),km(r,i,!0);break;case"textarea":Ha(r),Rm(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Ul)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=bv(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[In]=e,t[Vo]=r,Y0(t,e,!1,!1),e.stateNode=t;e:{switch(o=Ed(n,r),n){case"dialog":ke("cancel",t),ke("close",t),s=r;break;case"iframe":case"object":case"embed":ke("load",t),s=r;break;case"video":case"audio":for(s=0;s<oo.length;s++)ke(oo[s],t);s=r;break;case"source":ke("error",t),s=r;break;case"img":case"image":case"link":ke("error",t),ke("load",t),s=r;break;case"details":ke("toggle",t),s=r;break;case"input":Nm(t,r),s=gd(t,r),ke("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Ve({},r,{value:void 0}),ke("invalid",t);break;case"textarea":Am(t,r),s=_d(t,r),ke("invalid",t);break;default:s=r}xd(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?Nv(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Cv(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&No(t,c):typeof c=="number"&&No(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Po.hasOwnProperty(i)?c!=null&&i==="onScroll"&&ke("scroll",t):c!=null&&Lh(t,i,c,o))}switch(n){case"input":Ha(t),km(t,r,!1);break;case"textarea":Ha(t),Rm(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Vr(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?ei(t,!!r.multiple,i,!1):r.defaultValue!=null&&ei(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Ul)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return wt(e),null;case 6:if(t&&e.stateNode!=null)X0(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(z(166));if(n=is(Uo.current),is(Cn.current),el(e)){if(r=e.stateNode,n=e.memoizedProps,r[In]=e,(i=r.nodeValue!==n)&&(t=qt,t!==null))switch(t.tag){case 3:Za(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Za(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[In]=e,e.stateNode=r}return wt(e),null;case 13:if(Re(Oe),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Me&&Wt!==null&&e.mode&1&&!(e.flags&128))g0(),hi(),e.flags|=98560,i=!1;else if(i=el(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(z(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(z(317));i[In]=e}else hi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;wt(e),i=!1}else dn!==null&&(nh(dn),dn=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Oe.current&1?Xe===0&&(Xe=3):wf())),e.updateQueue!==null&&(e.flags|=4),wt(e),null);case 4:return pi(),Kd(t,e),t===null&&Oo(e.stateNode.containerInfo),wt(e),null;case 10:return nf(e.type._context),wt(e),null;case 17:return Ut(e.type)&&$l(),wt(e),null;case 19:if(Re(Oe),i=e.memoizedState,i===null)return wt(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)eo(i,!1);else{if(Xe!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Kl(t),o!==null){for(e.flags|=128,eo(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ce(Oe,Oe.current&1|2),e.child}t=t.sibling}i.tail!==null&&ze()>gi&&(e.flags|=128,r=!0,eo(i,!1),e.lanes=4194304)}else{if(!r)if(t=Kl(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),eo(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Me)return wt(e),null}else 2*ze()-i.renderingStartTime>gi&&n!==1073741824&&(e.flags|=128,r=!0,eo(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=ze(),e.sibling=null,n=Oe.current,Ce(Oe,r?n&1|2:n&1),e):(wt(e),null);case 22:case 23:return _f(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?zt&1073741824&&(wt(e),e.subtreeFlags&6&&(e.flags|=8192)):wt(e),null;case 24:return null;case 25:return null}throw Error(z(156,e.tag))}function II(t,e){switch(Xh(e),e.tag){case 1:return Ut(e.type)&&$l(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return pi(),Re(Ft),Re(bt),lf(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return af(e),null;case 13:if(Re(Oe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(z(340));hi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Re(Oe),null;case 4:return pi(),null;case 10:return nf(e.type._context),null;case 22:case 23:return _f(),null;case 24:return null;default:return null}}var rl=!1,Tt=!1,SI=typeof WeakSet=="function"?WeakSet:Set,Q=null;function Js(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){$e(t,e,r)}else n.current=null}function Qd(t,e,n){try{n()}catch(r){$e(t,e,r)}}var xg=!1;function bI(t,e){if(Rd=Ll,t=r0(),Yh(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,p=0,m=t,g=null;t:for(;;){for(var S;m!==n||s!==0&&m.nodeType!==3||(l=o+s),m!==i||r!==0&&m.nodeType!==3||(c=o+r),m.nodeType===3&&(o+=m.nodeValue.length),(S=m.firstChild)!==null;)g=m,m=S;for(;;){if(m===t)break t;if(g===n&&++d===s&&(l=o),g===i&&++p===r&&(c=o),(S=m.nextSibling)!==null)break;m=g,g=m.parentNode}m=S}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(jd={focusedElem:t,selectionRange:n},Ll=!1,Q=e;Q!==null;)if(e=Q,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Q=t;else for(;Q!==null;){e=Q;try{var C=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(C!==null){var k=C.memoizedProps,R=C.memoizedState,I=e.stateNode,w=I.getSnapshotBeforeUpdate(e.elementType===e.type?k:cn(e.type,k),R);I.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(z(163))}}catch(M){$e(e,e.return,M)}if(t=e.sibling,t!==null){t.return=e.return,Q=t;break}Q=e.return}return C=xg,xg=!1,C}function wo(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Qd(e,n,i)}s=s.next}while(s!==r)}}function kc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Yd(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Z0(t){var e=t.alternate;e!==null&&(t.alternate=null,Z0(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[In],delete e[Vo],delete e[Od],delete e[lI],delete e[cI])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function e_(t){return t.tag===5||t.tag===3||t.tag===4}function Eg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||e_(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Jd(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ul));else if(r!==4&&(t=t.child,t!==null))for(Jd(t,e,n),t=t.sibling;t!==null;)Jd(t,e,n),t=t.sibling}function Xd(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Xd(t,e,n),t=t.sibling;t!==null;)Xd(t,e,n),t=t.sibling}var ot=null,un=!1;function dr(t,e,n){for(n=n.child;n!==null;)t_(t,e,n),n=n.sibling}function t_(t,e,n){if(bn&&typeof bn.onCommitFiberUnmount=="function")try{bn.onCommitFiberUnmount(Ec,n)}catch{}switch(n.tag){case 5:Tt||Js(n,e);case 6:var r=ot,s=un;ot=null,dr(t,e,n),ot=r,un=s,ot!==null&&(un?(t=ot,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):ot.removeChild(n.stateNode));break;case 18:ot!==null&&(un?(t=ot,n=n.stateNode,t.nodeType===8?Vu(t.parentNode,n):t.nodeType===1&&Vu(t,n),jo(t)):Vu(ot,n.stateNode));break;case 4:r=ot,s=un,ot=n.stateNode.containerInfo,un=!0,dr(t,e,n),ot=r,un=s;break;case 0:case 11:case 14:case 15:if(!Tt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Qd(n,e,o),s=s.next}while(s!==r)}dr(t,e,n);break;case 1:if(!Tt&&(Js(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){$e(n,e,l)}dr(t,e,n);break;case 21:dr(t,e,n);break;case 22:n.mode&1?(Tt=(r=Tt)||n.memoizedState!==null,dr(t,e,n),Tt=r):dr(t,e,n);break;default:dr(t,e,n)}}function Tg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new SI),e.forEach(function(r){var s=MI.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function ln(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:ot=l.stateNode,un=!1;break e;case 3:ot=l.stateNode.containerInfo,un=!0;break e;case 4:ot=l.stateNode.containerInfo,un=!0;break e}l=l.return}if(ot===null)throw Error(z(160));t_(i,o,s),ot=null,un=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){$e(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)n_(e,t),e=e.sibling}function n_(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ln(e,t),wn(t),r&4){try{wo(3,t,t.return),kc(3,t)}catch(k){$e(t,t.return,k)}try{wo(5,t,t.return)}catch(k){$e(t,t.return,k)}}break;case 1:ln(e,t),wn(t),r&512&&n!==null&&Js(n,n.return);break;case 5:if(ln(e,t),wn(t),r&512&&n!==null&&Js(n,n.return),t.flags&32){var s=t.stateNode;try{No(s,"")}catch(k){$e(t,t.return,k)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Iv(s,i),Ed(l,o);var d=Ed(l,i);for(o=0;o<c.length;o+=2){var p=c[o],m=c[o+1];p==="style"?Nv(s,m):p==="dangerouslySetInnerHTML"?Cv(s,m):p==="children"?No(s,m):Lh(s,p,m,d)}switch(l){case"input":yd(s,i);break;case"textarea":Sv(s,i);break;case"select":var g=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var S=i.value;S!=null?ei(s,!!i.multiple,S,!1):g!==!!i.multiple&&(i.defaultValue!=null?ei(s,!!i.multiple,i.defaultValue,!0):ei(s,!!i.multiple,i.multiple?[]:"",!1))}s[Vo]=i}catch(k){$e(t,t.return,k)}}break;case 6:if(ln(e,t),wn(t),r&4){if(t.stateNode===null)throw Error(z(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(k){$e(t,t.return,k)}}break;case 3:if(ln(e,t),wn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{jo(e.containerInfo)}catch(k){$e(t,t.return,k)}break;case 4:ln(e,t),wn(t);break;case 13:ln(e,t),wn(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(yf=ze())),r&4&&Tg(t);break;case 22:if(p=n!==null&&n.memoizedState!==null,t.mode&1?(Tt=(d=Tt)||p,ln(e,t),Tt=d):ln(e,t),wn(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!p&&t.mode&1)for(Q=t,p=t.child;p!==null;){for(m=Q=p;Q!==null;){switch(g=Q,S=g.child,g.tag){case 0:case 11:case 14:case 15:wo(4,g,g.return);break;case 1:Js(g,g.return);var C=g.stateNode;if(typeof C.componentWillUnmount=="function"){r=g,n=g.return;try{e=r,C.props=e.memoizedProps,C.state=e.memoizedState,C.componentWillUnmount()}catch(k){$e(r,n,k)}}break;case 5:Js(g,g.return);break;case 22:if(g.memoizedState!==null){Sg(m);continue}}S!==null?(S.return=g,Q=S):Sg(m)}p=p.sibling}e:for(p=null,m=t;;){if(m.tag===5){if(p===null){p=m;try{s=m.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=m.stateNode,c=m.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=Pv("display",o))}catch(k){$e(t,t.return,k)}}}else if(m.tag===6){if(p===null)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(k){$e(t,t.return,k)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;p===m&&(p=null),m=m.return}p===m&&(p=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:ln(e,t),wn(t),r&4&&Tg(t);break;case 21:break;default:ln(e,t),wn(t)}}function wn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(e_(n)){var r=n;break e}n=n.return}throw Error(z(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(No(s,""),r.flags&=-33);var i=Eg(t);Xd(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Eg(t);Jd(t,l,o);break;default:throw Error(z(161))}}catch(c){$e(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function CI(t,e,n){Q=t,r_(t)}function r_(t,e,n){for(var r=(t.mode&1)!==0;Q!==null;){var s=Q,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||rl;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||Tt;l=rl;var d=Tt;if(rl=o,(Tt=c)&&!d)for(Q=s;Q!==null;)o=Q,c=o.child,o.tag===22&&o.memoizedState!==null?bg(s):c!==null?(c.return=o,Q=c):bg(s);for(;i!==null;)Q=i,r_(i),i=i.sibling;Q=s,rl=l,Tt=d}Ig(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Q=i):Ig(t)}}function Ig(t){for(;Q!==null;){var e=Q;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Tt||kc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Tt)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:cn(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&lg(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}lg(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var p=d.memoizedState;if(p!==null){var m=p.dehydrated;m!==null&&jo(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(z(163))}Tt||e.flags&512&&Yd(e)}catch(g){$e(e,e.return,g)}}if(e===t){Q=null;break}if(n=e.sibling,n!==null){n.return=e.return,Q=n;break}Q=e.return}}function Sg(t){for(;Q!==null;){var e=Q;if(e===t){Q=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Q=n;break}Q=e.return}}function bg(t){for(;Q!==null;){var e=Q;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{kc(4,e)}catch(c){$e(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){$e(e,s,c)}}var i=e.return;try{Yd(e)}catch(c){$e(e,i,c)}break;case 5:var o=e.return;try{Yd(e)}catch(c){$e(e,o,c)}}}catch(c){$e(e,e.return,c)}if(e===t){Q=null;break}var l=e.sibling;if(l!==null){l.return=e.return,Q=l;break}Q=e.return}}var PI=Math.ceil,Jl=rr.ReactCurrentDispatcher,mf=rr.ReactCurrentOwner,en=rr.ReactCurrentBatchConfig,ve=0,rt=null,He=null,ct=0,zt=0,Xs=Hr(0),Xe=0,Wo=null,ps=0,Ac=0,gf=0,xo=null,Ot=null,yf=0,gi=1/0,Ln=null,Xl=!1,Zd=null,kr=null,sl=!1,Er=null,Zl=0,Eo=0,eh=null,wl=-1,xl=0;function At(){return ve&6?ze():wl!==-1?wl:wl=ze()}function Ar(t){return t.mode&1?ve&2&&ct!==0?ct&-ct:dI.transition!==null?(xl===0&&(xl=$v()),xl):(t=Te,t!==0||(t=window.event,t=t===void 0?16:Kv(t.type)),t):1}function fn(t,e,n,r){if(50<Eo)throw Eo=0,eh=null,Error(z(185));sa(t,n,r),(!(ve&2)||t!==rt)&&(t===rt&&(!(ve&2)&&(Ac|=n),Xe===4&&gr(t,ct)),$t(t,r),n===1&&ve===0&&!(e.mode&1)&&(gi=ze()+500,Cc&&qr()))}function $t(t,e){var n=t.callbackNode;dT(t,e);var r=Ol(t,t===rt?ct:0);if(r===0)n!==null&&Mm(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Mm(n),e===1)t.tag===0?uI(Cg.bind(null,t)):f0(Cg.bind(null,t)),oI(function(){!(ve&6)&&qr()}),n=null;else{switch(Bv(r)){case 1:n=Bh;break;case 4:n=Fv;break;case 16:n=Ml;break;case 536870912:n=Uv;break;default:n=Ml}n=d_(n,s_.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function s_(t,e){if(wl=-1,xl=0,ve&6)throw Error(z(327));var n=t.callbackNode;if(ii()&&t.callbackNode!==n)return null;var r=Ol(t,t===rt?ct:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=ec(t,r);else{e=r;var s=ve;ve|=2;var i=o_();(rt!==t||ct!==e)&&(Ln=null,gi=ze()+500,ls(t,e));do try{AI();break}catch(l){i_(t,l)}while(1);tf(),Jl.current=i,ve=s,He!==null?e=0:(rt=null,ct=0,e=Xe)}if(e!==0){if(e===2&&(s=Cd(t),s!==0&&(r=s,e=th(t,s))),e===1)throw n=Wo,ls(t,0),gr(t,r),$t(t,ze()),n;if(e===6)gr(t,r);else{if(s=t.current.alternate,!(r&30)&&!NI(s)&&(e=ec(t,r),e===2&&(i=Cd(t),i!==0&&(r=i,e=th(t,i))),e===1))throw n=Wo,ls(t,0),gr(t,r),$t(t,ze()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(z(345));case 2:ts(t,Ot,Ln);break;case 3:if(gr(t,r),(r&130023424)===r&&(e=yf+500-ze(),10<e)){if(Ol(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){At(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Md(ts.bind(null,t,Ot,Ln),e);break}ts(t,Ot,Ln);break;case 4:if(gr(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-hn(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=ze()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*PI(r/1960))-r,10<r){t.timeoutHandle=Md(ts.bind(null,t,Ot,Ln),r);break}ts(t,Ot,Ln);break;case 5:ts(t,Ot,Ln);break;default:throw Error(z(329))}}}return $t(t,ze()),t.callbackNode===n?s_.bind(null,t):null}function th(t,e){var n=xo;return t.current.memoizedState.isDehydrated&&(ls(t,e).flags|=256),t=ec(t,e),t!==2&&(e=Ot,Ot=n,e!==null&&nh(e)),t}function nh(t){Ot===null?Ot=t:Ot.push.apply(Ot,t)}function NI(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!mn(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function gr(t,e){for(e&=~gf,e&=~Ac,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-hn(e),r=1<<n;t[n]=-1,e&=~r}}function Cg(t){if(ve&6)throw Error(z(327));ii();var e=Ol(t,0);if(!(e&1))return $t(t,ze()),null;var n=ec(t,e);if(t.tag!==0&&n===2){var r=Cd(t);r!==0&&(e=r,n=th(t,r))}if(n===1)throw n=Wo,ls(t,0),gr(t,e),$t(t,ze()),n;if(n===6)throw Error(z(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ts(t,Ot,Ln),$t(t,ze()),null}function vf(t,e){var n=ve;ve|=1;try{return t(e)}finally{ve=n,ve===0&&(gi=ze()+500,Cc&&qr())}}function ms(t){Er!==null&&Er.tag===0&&!(ve&6)&&ii();var e=ve;ve|=1;var n=en.transition,r=Te;try{if(en.transition=null,Te=1,t)return t()}finally{Te=r,en.transition=n,ve=e,!(ve&6)&&qr()}}function _f(){zt=Xs.current,Re(Xs)}function ls(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,iI(n)),He!==null)for(n=He.return;n!==null;){var r=n;switch(Xh(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&$l();break;case 3:pi(),Re(Ft),Re(bt),lf();break;case 5:af(r);break;case 4:pi();break;case 13:Re(Oe);break;case 19:Re(Oe);break;case 10:nf(r.type._context);break;case 22:case 23:_f()}n=n.return}if(rt=t,He=t=Rr(t.current,null),ct=zt=e,Xe=0,Wo=null,gf=Ac=ps=0,Ot=xo=null,ss!==null){for(e=0;e<ss.length;e++)if(n=ss[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}ss=null}return t}function i_(t,e){do{var n=He;try{if(tf(),yl.current=Yl,Ql){for(var r=Le.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Ql=!1}if(fs=0,nt=Je=Le=null,_o=!1,$o=0,mf.current=null,n===null||n.return===null){Xe=1,Wo=e,He=null;break}e:{var i=t,o=n.return,l=n,c=e;if(e=ct,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,p=l,m=p.tag;if(!(p.mode&1)&&(m===0||m===11||m===15)){var g=p.alternate;g?(p.updateQueue=g.updateQueue,p.memoizedState=g.memoizedState,p.lanes=g.lanes):(p.updateQueue=null,p.memoizedState=null)}var S=pg(o);if(S!==null){S.flags&=-257,mg(S,o,l,i,e),S.mode&1&&fg(i,d,e),e=S,c=d;var C=e.updateQueue;if(C===null){var k=new Set;k.add(c),e.updateQueue=k}else C.add(c);break e}else{if(!(e&1)){fg(i,d,e),wf();break e}c=Error(z(426))}}else if(Me&&l.mode&1){var R=pg(o);if(R!==null){!(R.flags&65536)&&(R.flags|=256),mg(R,o,l,i,e),Zh(mi(c,l));break e}}i=c=mi(c,l),Xe!==4&&(Xe=2),xo===null?xo=[i]:xo.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var I=B0(i,c,e);ag(i,I);break e;case 1:l=c;var w=i.type,b=i.stateNode;if(!(i.flags&128)&&(typeof w.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(kr===null||!kr.has(b)))){i.flags|=65536,e&=-e,i.lanes|=e;var M=z0(i,l,e);ag(i,M);break e}}i=i.return}while(i!==null)}l_(n)}catch(O){e=O,He===n&&n!==null&&(He=n=n.return);continue}break}while(1)}function o_(){var t=Jl.current;return Jl.current=Yl,t===null?Yl:t}function wf(){(Xe===0||Xe===3||Xe===2)&&(Xe=4),rt===null||!(ps&268435455)&&!(Ac&268435455)||gr(rt,ct)}function ec(t,e){var n=ve;ve|=2;var r=o_();(rt!==t||ct!==e)&&(Ln=null,ls(t,e));do try{kI();break}catch(s){i_(t,s)}while(1);if(tf(),ve=n,Jl.current=r,He!==null)throw Error(z(261));return rt=null,ct=0,Xe}function kI(){for(;He!==null;)a_(He)}function AI(){for(;He!==null&&!nT();)a_(He)}function a_(t){var e=u_(t.alternate,t,zt);t.memoizedProps=t.pendingProps,e===null?l_(t):He=e,mf.current=null}function l_(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=II(n,e),n!==null){n.flags&=32767,He=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Xe=6,He=null;return}}else if(n=TI(n,e,zt),n!==null){He=n;return}if(e=e.sibling,e!==null){He=e;return}He=e=t}while(e!==null);Xe===0&&(Xe=5)}function ts(t,e,n){var r=Te,s=en.transition;try{en.transition=null,Te=1,RI(t,e,n,r)}finally{en.transition=s,Te=r}return null}function RI(t,e,n,r){do ii();while(Er!==null);if(ve&6)throw Error(z(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(z(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(hT(t,i),t===rt&&(He=rt=null,ct=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||sl||(sl=!0,d_(Ml,function(){return ii(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=en.transition,en.transition=null;var o=Te;Te=1;var l=ve;ve|=4,mf.current=null,bI(t,n),n_(n,t),XT(jd),Ll=!!Rd,jd=Rd=null,t.current=n,CI(n),rT(),ve=l,Te=o,en.transition=i}else t.current=n;if(sl&&(sl=!1,Er=t,Zl=s),i=t.pendingLanes,i===0&&(kr=null),oT(n.stateNode),$t(t,ze()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Xl)throw Xl=!1,t=Zd,Zd=null,t;return Zl&1&&t.tag!==0&&ii(),i=t.pendingLanes,i&1?t===eh?Eo++:(Eo=0,eh=t):Eo=0,qr(),null}function ii(){if(Er!==null){var t=Bv(Zl),e=en.transition,n=Te;try{if(en.transition=null,Te=16>t?16:t,Er===null)var r=!1;else{if(t=Er,Er=null,Zl=0,ve&6)throw Error(z(331));var s=ve;for(ve|=4,Q=t.current;Q!==null;){var i=Q,o=i.child;if(Q.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(Q=d;Q!==null;){var p=Q;switch(p.tag){case 0:case 11:case 15:wo(8,p,i)}var m=p.child;if(m!==null)m.return=p,Q=m;else for(;Q!==null;){p=Q;var g=p.sibling,S=p.return;if(Z0(p),p===d){Q=null;break}if(g!==null){g.return=S,Q=g;break}Q=S}}}var C=i.alternate;if(C!==null){var k=C.child;if(k!==null){C.child=null;do{var R=k.sibling;k.sibling=null,k=R}while(k!==null)}}Q=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Q=o;else e:for(;Q!==null;){if(i=Q,i.flags&2048)switch(i.tag){case 0:case 11:case 15:wo(9,i,i.return)}var I=i.sibling;if(I!==null){I.return=i.return,Q=I;break e}Q=i.return}}var w=t.current;for(Q=w;Q!==null;){o=Q;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,Q=b;else e:for(o=w;Q!==null;){if(l=Q,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:kc(9,l)}}catch(O){$e(l,l.return,O)}if(l===o){Q=null;break e}var M=l.sibling;if(M!==null){M.return=l.return,Q=M;break e}Q=l.return}}if(ve=s,qr(),bn&&typeof bn.onPostCommitFiberRoot=="function")try{bn.onPostCommitFiberRoot(Ec,t)}catch{}r=!0}return r}finally{Te=n,en.transition=e}}return!1}function Pg(t,e,n){e=mi(n,e),e=B0(t,e,1),t=Nr(t,e,1),e=At(),t!==null&&(sa(t,1,e),$t(t,e))}function $e(t,e,n){if(t.tag===3)Pg(t,t,n);else for(;e!==null;){if(e.tag===3){Pg(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(kr===null||!kr.has(r))){t=mi(n,t),t=z0(e,t,1),e=Nr(e,t,1),t=At(),e!==null&&(sa(e,1,t),$t(e,t));break}}e=e.return}}function jI(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=At(),t.pingedLanes|=t.suspendedLanes&n,rt===t&&(ct&n)===n&&(Xe===4||Xe===3&&(ct&130023424)===ct&&500>ze()-yf?ls(t,0):gf|=n),$t(t,e)}function c_(t,e){e===0&&(t.mode&1?(e=Ka,Ka<<=1,!(Ka&130023424)&&(Ka=4194304)):e=1);var n=At();t=Jn(t,e),t!==null&&(sa(t,e,n),$t(t,n))}function DI(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),c_(t,n)}function MI(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(z(314))}r!==null&&r.delete(e),c_(t,n)}var u_;u_=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ft.current)Vt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Vt=!1,EI(t,e,n);Vt=!!(t.flags&131072)}else Vt=!1,Me&&e.flags&1048576&&p0(e,Wl,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;_l(t,e),t=e.pendingProps;var s=di(e,bt.current);si(e,n),s=uf(null,e,r,t,s,n);var i=df();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ut(r)?(i=!0,Bl(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,sf(e),s.updater=Nc,e.stateNode=s,s._reactInternals=e,Bd(e,r,t,n),e=Hd(null,e,r,!0,i,n)):(e.tag=0,Me&&i&&Jh(e),kt(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(_l(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=LI(r),t=cn(r,t),s){case 0:e=Wd(null,e,r,t,n);break e;case 1:e=vg(null,e,r,t,n);break e;case 11:e=gg(null,e,r,t,n);break e;case 14:e=yg(null,e,r,cn(r.type,t),n);break e}throw Error(z(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cn(r,s),Wd(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cn(r,s),vg(t,e,r,s,n);case 3:e:{if(G0(e),t===null)throw Error(z(387));r=e.pendingProps,i=e.memoizedState,s=i.element,w0(t,e),Gl(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=mi(Error(z(423)),e),e=_g(t,e,r,n,s);break e}else if(r!==s){s=mi(Error(z(424)),e),e=_g(t,e,r,n,s);break e}else for(Wt=Pr(e.stateNode.containerInfo.firstChild),qt=e,Me=!0,dn=null,n=v0(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(hi(),r===s){e=Xn(t,e,n);break e}kt(t,e,r,n)}e=e.child}return e;case 5:return x0(e),t===null&&Fd(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,Dd(r,s)?o=null:i!==null&&Dd(r,i)&&(e.flags|=32),q0(t,e),kt(t,e,o,n),e.child;case 6:return t===null&&Fd(e),null;case 13:return K0(t,e,n);case 4:return of(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=fi(e,null,r,n):kt(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cn(r,s),gg(t,e,r,s,n);case 7:return kt(t,e,e.pendingProps,n),e.child;case 8:return kt(t,e,e.pendingProps.children,n),e.child;case 12:return kt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Ce(Hl,r._currentValue),r._currentValue=o,i!==null)if(mn(i.value,o)){if(i.children===s.children&&!Ft.current){e=Xn(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=qn(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var p=d.pending;p===null?c.next=c:(c.next=p.next,p.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Ud(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(z(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Ud(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}kt(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,si(e,n),s=nn(s),r=r(s),e.flags|=1,kt(t,e,r,n),e.child;case 14:return r=e.type,s=cn(r,e.pendingProps),s=cn(r.type,s),yg(t,e,r,s,n);case 15:return W0(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cn(r,s),_l(t,e),e.tag=1,Ut(r)?(t=!0,Bl(e)):t=!1,si(e,n),$0(e,r,s),Bd(e,r,s,n),Hd(null,e,r,!0,t,n);case 19:return Q0(t,e,n);case 22:return H0(t,e,n)}throw Error(z(156,e.tag))};function d_(t,e){return Vv(t,e)}function OI(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zt(t,e,n,r){return new OI(t,e,n,r)}function xf(t){return t=t.prototype,!(!t||!t.isReactComponent)}function LI(t){if(typeof t=="function")return xf(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Fh)return 11;if(t===Uh)return 14}return 2}function Rr(t,e){var n=t.alternate;return n===null?(n=Zt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function El(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")xf(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Bs:return cs(n.children,s,i,e);case Vh:o=8,s|=8;break;case hd:return t=Zt(12,n,e,s|2),t.elementType=hd,t.lanes=i,t;case fd:return t=Zt(13,n,e,s),t.elementType=fd,t.lanes=i,t;case pd:return t=Zt(19,n,e,s),t.elementType=pd,t.lanes=i,t;case xv:return Rc(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case _v:o=10;break e;case wv:o=9;break e;case Fh:o=11;break e;case Uh:o=14;break e;case fr:o=16,r=null;break e}throw Error(z(130,t==null?t:typeof t,""))}return e=Zt(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function cs(t,e,n,r){return t=Zt(7,t,r,e),t.lanes=n,t}function Rc(t,e,n,r){return t=Zt(22,t,r,e),t.elementType=xv,t.lanes=n,t.stateNode={isHidden:!1},t}function qu(t,e,n){return t=Zt(6,t,null,e),t.lanes=n,t}function Gu(t,e,n){return e=Zt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function VI(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Cu(0),this.expirationTimes=Cu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cu(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Ef(t,e,n,r,s,i,o,l,c){return t=new VI(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Zt(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},sf(i),t}function FI(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$s,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function h_(t){if(!t)return Fr;t=t._reactInternals;e:{if(Is(t)!==t||t.tag!==1)throw Error(z(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ut(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(z(171))}if(t.tag===1){var n=t.type;if(Ut(n))return h0(t,n,e)}return e}function f_(t,e,n,r,s,i,o,l,c){return t=Ef(n,r,!0,t,s,i,o,l,c),t.context=h_(null),n=t.current,r=At(),s=Ar(n),i=qn(r,s),i.callback=e??null,Nr(n,i,s),t.current.lanes=s,sa(t,s,r),$t(t,r),t}function jc(t,e,n,r){var s=e.current,i=At(),o=Ar(s);return n=h_(n),e.context===null?e.context=n:e.pendingContext=n,e=qn(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Nr(s,e,o),t!==null&&(fn(t,s,o,i),gl(t,s,o)),o}function tc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Ng(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Tf(t,e){Ng(t,e),(t=t.alternate)&&Ng(t,e)}function UI(){return null}var p_=typeof reportError=="function"?reportError:function(t){console.error(t)};function If(t){this._internalRoot=t}Dc.prototype.render=If.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(z(409));jc(t,e,null,null)};Dc.prototype.unmount=If.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ms(function(){jc(null,t,null,null)}),e[Yn]=null}};function Dc(t){this._internalRoot=t}Dc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Hv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<mr.length&&e!==0&&e<mr[n].priority;n++);mr.splice(n,0,t),n===0&&Gv(t)}};function Sf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Mc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function kg(){}function $I(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=tc(o);i.call(d)}}var o=f_(e,r,t,0,null,!1,!1,"",kg);return t._reactRootContainer=o,t[Yn]=o.current,Oo(t.nodeType===8?t.parentNode:t),ms(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=tc(c);l.call(d)}}var c=Ef(t,0,!1,null,null,!1,!1,"",kg);return t._reactRootContainer=c,t[Yn]=c.current,Oo(t.nodeType===8?t.parentNode:t),ms(function(){jc(e,c,n,r)}),c}function Oc(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var c=tc(o);l.call(c)}}jc(e,o,t,s)}else o=$I(n,e,t,s,r);return tc(o)}zv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=io(e.pendingLanes);n!==0&&(zh(e,n|1),$t(e,ze()),!(ve&6)&&(gi=ze()+500,qr()))}break;case 13:ms(function(){var r=Jn(t,1);if(r!==null){var s=At();fn(r,t,1,s)}}),Tf(t,1)}};Wh=function(t){if(t.tag===13){var e=Jn(t,134217728);if(e!==null){var n=At();fn(e,t,134217728,n)}Tf(t,134217728)}};Wv=function(t){if(t.tag===13){var e=Ar(t),n=Jn(t,e);if(n!==null){var r=At();fn(n,t,e,r)}Tf(t,e)}};Hv=function(){return Te};qv=function(t,e){var n=Te;try{return Te=t,e()}finally{Te=n}};Id=function(t,e,n){switch(e){case"input":if(yd(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=bc(r);if(!s)throw Error(z(90));Tv(r),yd(r,s)}}}break;case"textarea":Sv(t,n);break;case"select":e=n.value,e!=null&&ei(t,!!n.multiple,e,!1)}};Rv=vf;jv=ms;var BI={usingClientEntryPoint:!1,Events:[oa,qs,bc,kv,Av,vf]},to={findFiberByHostInstance:rs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},zI={bundleType:to.bundleType,version:to.version,rendererPackageName:to.rendererPackageName,rendererConfig:to.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:rr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Ov(t),t===null?null:t.stateNode},findFiberByHostInstance:to.findFiberByHostInstance||UI,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var il=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!il.isDisabled&&il.supportsFiber)try{Ec=il.inject(zI),bn=il}catch{}}Kt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=BI;Kt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Sf(e))throw Error(z(200));return FI(t,e,null,n)};Kt.createRoot=function(t,e){if(!Sf(t))throw Error(z(299));var n=!1,r="",s=p_;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Ef(t,1,!1,null,null,n,!1,r,s),t[Yn]=e.current,Oo(t.nodeType===8?t.parentNode:t),new If(e)};Kt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(z(188)):(t=Object.keys(t).join(","),Error(z(268,t)));return t=Ov(e),t=t===null?null:t.stateNode,t};Kt.flushSync=function(t){return ms(t)};Kt.hydrate=function(t,e,n){if(!Mc(e))throw Error(z(200));return Oc(null,t,e,!0,n)};Kt.hydrateRoot=function(t,e,n){if(!Sf(t))throw Error(z(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=p_;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=f_(e,null,t,1,n??null,s,!1,i,o),t[Yn]=e.current,Oo(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Dc(e)};Kt.render=function(t,e,n){if(!Mc(e))throw Error(z(200));return Oc(null,t,e,!1,n)};Kt.unmountComponentAtNode=function(t){if(!Mc(t))throw Error(z(40));return t._reactRootContainer?(ms(function(){Oc(null,null,t,!1,function(){t._reactRootContainer=null,t[Yn]=null})}),!0):!1};Kt.unstable_batchedUpdates=vf;Kt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Mc(n))throw Error(z(200));if(t==null||t._reactInternals===void 0)throw Error(z(38));return Oc(t,e,n,!1,r)};Kt.version="18.3.1-next-f1338f8080-20240426";function m_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(m_)}catch(t){console.error(t)}}m_(),mv.exports=Kt;var WI=mv.exports,Ag=WI;ud.createRoot=Ag.createRoot,ud.hydrateRoot=Ag.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ho(){return Ho=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Ho.apply(this,arguments)}var Tr;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Tr||(Tr={}));const Rg="popstate";function HI(t){t===void 0&&(t={});function e(r,s){let{pathname:i,search:o,hash:l}=r.location;return rh("",{pathname:i,search:o,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:nc(s)}return GI(e,n,null,t)}function Ge(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function g_(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function qI(){return Math.random().toString(36).substr(2,8)}function jg(t,e){return{usr:t.state,key:t.key,idx:e}}function rh(t,e,n,r){return n===void 0&&(n=null),Ho({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Pi(e):e,{state:n,key:e&&e.key||r||qI()})}function nc(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Pi(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function GI(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,l=Tr.Pop,c=null,d=p();d==null&&(d=0,o.replaceState(Ho({},o.state,{idx:d}),""));function p(){return(o.state||{idx:null}).idx}function m(){l=Tr.Pop;let R=p(),I=R==null?null:R-d;d=R,c&&c({action:l,location:k.location,delta:I})}function g(R,I){l=Tr.Push;let w=rh(k.location,R,I);n&&n(w,R),d=p()+1;let b=jg(w,d),M=k.createHref(w);try{o.pushState(b,"",M)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;s.location.assign(M)}i&&c&&c({action:l,location:k.location,delta:1})}function S(R,I){l=Tr.Replace;let w=rh(k.location,R,I);n&&n(w,R),d=p();let b=jg(w,d),M=k.createHref(w);o.replaceState(b,"",M),i&&c&&c({action:l,location:k.location,delta:0})}function C(R){let I=s.location.origin!=="null"?s.location.origin:s.location.href,w=typeof R=="string"?R:nc(R);return w=w.replace(/ $/,"%20"),Ge(I,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,I)}let k={get action(){return l},get location(){return t(s,o)},listen(R){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(Rg,m),c=R,()=>{s.removeEventListener(Rg,m),c=null}},createHref(R){return e(s,R)},createURL:C,encodeLocation(R){let I=C(R);return{pathname:I.pathname,search:I.search,hash:I.hash}},push:g,replace:S,go(R){return o.go(R)}};return k}var Dg;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Dg||(Dg={}));function KI(t,e,n){return n===void 0&&(n="/"),QI(t,e,n,!1)}function QI(t,e,n,r){let s=typeof e=="string"?Pi(e):e,i=bf(s.pathname||"/",n);if(i==null)return null;let o=y_(t);YI(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let d=aS(i);l=iS(o[c],d,r)}return l}function y_(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(i,o,l)=>{let c={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};c.relativePath.startsWith("/")&&(Ge(c.relativePath.startsWith(r),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(r.length));let d=jr([r,c.relativePath]),p=n.concat(c);i.children&&i.children.length>0&&(Ge(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),y_(i.children,e,p,d)),!(i.path==null&&!i.index)&&e.push({path:d,score:rS(d,i.index),routesMeta:p})};return t.forEach((i,o)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))s(i,o);else for(let c of v_(i.path))s(i,o,c)}),e}function v_(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=v_(r.join("/")),l=[];return l.push(...o.map(c=>c===""?i:[i,c].join("/"))),s&&l.push(...o),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function YI(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:sS(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const JI=/^:[\w-]+$/,XI=3,ZI=2,eS=1,tS=10,nS=-2,Mg=t=>t==="*";function rS(t,e){let n=t.split("/"),r=n.length;return n.some(Mg)&&(r+=nS),e&&(r+=ZI),n.filter(s=>!Mg(s)).reduce((s,i)=>s+(JI.test(i)?XI:i===""?eS:tS),r)}function sS(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function iS(t,e,n){n===void 0&&(n=!1);let{routesMeta:r}=t,s={},i="/",o=[];for(let l=0;l<r.length;++l){let c=r[l],d=l===r.length-1,p=i==="/"?e:e.slice(i.length)||"/",m=Og({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},p),g=c.route;if(!m&&d&&n&&!r[r.length-1].route.index&&(m=Og({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},p)),!m)return null;Object.assign(s,m.params),o.push({params:s,pathname:jr([i,m.pathname]),pathnameBase:dS(jr([i,m.pathnameBase])),route:g}),m.pathnameBase!=="/"&&(i=jr([i,m.pathnameBase]))}return o}function Og(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=oS(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,p,m)=>{let{paramName:g,isOptional:S}=p;if(g==="*"){let k=l[m]||"";o=i.slice(0,i.length-k.length).replace(/(.)\/+$/,"$1")}const C=l[m];return S&&!C?d[g]=void 0:d[g]=(C||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:o,pattern:t}}function oS(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),g_(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function aS(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return g_(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function bf(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function lS(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Pi(t):t;return{pathname:n?n.startsWith("/")?n:cS(n,e):e,search:hS(r),hash:fS(s)}}function cS(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function Ku(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function uS(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function __(t,e){let n=uS(t);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function w_(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=Pi(t):(s=Ho({},t),Ge(!s.pathname||!s.pathname.includes("?"),Ku("?","pathname","search",s)),Ge(!s.pathname||!s.pathname.includes("#"),Ku("#","pathname","hash",s)),Ge(!s.search||!s.search.includes("#"),Ku("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,l;if(o==null)l=n;else{let m=e.length-1;if(!r&&o.startsWith("..")){let g=o.split("/");for(;g[0]==="..";)g.shift(),m-=1;s.pathname=g.join("/")}l=m>=0?e[m]:"/"}let c=lS(s,l),d=o&&o!=="/"&&o.endsWith("/"),p=(i||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||p)&&(c.pathname+="/"),c}const jr=t=>t.join("/").replace(/\/\/+/g,"/"),dS=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),hS=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,fS=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function pS(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const x_=["post","put","patch","delete"];new Set(x_);const mS=["get",...x_];new Set(mS);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function qo(){return qo=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},qo.apply(this,arguments)}const Cf=D.createContext(null),gS=D.createContext(null),Ss=D.createContext(null),Lc=D.createContext(null),Gr=D.createContext({outlet:null,matches:[],isDataRoute:!1}),E_=D.createContext(null);function yS(t,e){let{relative:n}=e===void 0?{}:e;la()||Ge(!1);let{basename:r,navigator:s}=D.useContext(Ss),{hash:i,pathname:o,search:l}=I_(t,{relative:n}),c=o;return r!=="/"&&(c=o==="/"?r:jr([r,o])),s.createHref({pathname:c,search:l,hash:i})}function la(){return D.useContext(Lc)!=null}function ca(){return la()||Ge(!1),D.useContext(Lc).location}function T_(t){D.useContext(Ss).static||D.useLayoutEffect(t)}function jn(){let{isDataRoute:t}=D.useContext(Gr);return t?kS():vS()}function vS(){la()||Ge(!1);let t=D.useContext(Cf),{basename:e,future:n,navigator:r}=D.useContext(Ss),{matches:s}=D.useContext(Gr),{pathname:i}=ca(),o=JSON.stringify(__(s,n.v7_relativeSplatPath)),l=D.useRef(!1);return T_(()=>{l.current=!0}),D.useCallback(function(d,p){if(p===void 0&&(p={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let m=w_(d,JSON.parse(o),i,p.relative==="path");t==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:jr([e,m.pathname])),(p.replace?r.replace:r.push)(m,p.state,p)},[e,r,o,i,t])}function Vc(){let{matches:t}=D.useContext(Gr),e=t[t.length-1];return e?e.params:{}}function I_(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=D.useContext(Ss),{matches:s}=D.useContext(Gr),{pathname:i}=ca(),o=JSON.stringify(__(s,r.v7_relativeSplatPath));return D.useMemo(()=>w_(t,JSON.parse(o),i,n==="path"),[t,o,i,n])}function _S(t,e){return wS(t,e)}function wS(t,e,n,r){la()||Ge(!1);let{navigator:s}=D.useContext(Ss),{matches:i}=D.useContext(Gr),o=i[i.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let d=ca(),p;if(e){var m;let R=typeof e=="string"?Pi(e):e;c==="/"||(m=R.pathname)!=null&&m.startsWith(c)||Ge(!1),p=R}else p=d;let g=p.pathname||"/",S=g;if(c!=="/"){let R=c.replace(/^\//,"").split("/");S="/"+g.replace(/^\//,"").split("/").slice(R.length).join("/")}let C=KI(t,{pathname:S}),k=SS(C&&C.map(R=>Object.assign({},R,{params:Object.assign({},l,R.params),pathname:jr([c,s.encodeLocation?s.encodeLocation(R.pathname).pathname:R.pathname]),pathnameBase:R.pathnameBase==="/"?c:jr([c,s.encodeLocation?s.encodeLocation(R.pathnameBase).pathname:R.pathnameBase])})),i,n,r);return e&&k?D.createElement(Lc.Provider,{value:{location:qo({pathname:"/",search:"",hash:"",state:null,key:"default"},p),navigationType:Tr.Pop}},k):k}function xS(){let t=NS(),e=pS(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return D.createElement(D.Fragment,null,D.createElement("h2",null,"Unexpected Application Error!"),D.createElement("h3",{style:{fontStyle:"italic"}},e),n?D.createElement("pre",{style:s},n):null,i)}const ES=D.createElement(xS,null);class TS extends D.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?D.createElement(Gr.Provider,{value:this.props.routeContext},D.createElement(E_.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function IS(t){let{routeContext:e,match:n,children:r}=t,s=D.useContext(Cf);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),D.createElement(Gr.Provider,{value:e},r)}function SS(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var i;if(!n)return null;if(n.errors)t=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=(s=n)==null?void 0:s.errors;if(l!=null){let p=o.findIndex(m=>m.route.id&&(l==null?void 0:l[m.route.id])!==void 0);p>=0||Ge(!1),o=o.slice(0,Math.min(o.length,p+1))}let c=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let p=0;p<o.length;p++){let m=o[p];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(d=p),m.route.id){let{loaderData:g,errors:S}=n,C=m.route.loader&&g[m.route.id]===void 0&&(!S||S[m.route.id]===void 0);if(m.route.lazy||C){c=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((p,m,g)=>{let S,C=!1,k=null,R=null;n&&(S=l&&m.route.id?l[m.route.id]:void 0,k=m.route.errorElement||ES,c&&(d<0&&g===0?(AS("route-fallback",!1),C=!0,R=null):d===g&&(C=!0,R=m.route.hydrateFallbackElement||null)));let I=e.concat(o.slice(0,g+1)),w=()=>{let b;return S?b=k:C?b=R:m.route.Component?b=D.createElement(m.route.Component,null):m.route.element?b=m.route.element:b=p,D.createElement(IS,{match:m,routeContext:{outlet:p,matches:I,isDataRoute:n!=null},children:b})};return n&&(m.route.ErrorBoundary||m.route.errorElement||g===0)?D.createElement(TS,{location:n.location,revalidation:n.revalidation,component:k,error:S,children:w(),routeContext:{outlet:null,matches:I,isDataRoute:!0}}):w()},null)}var S_=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(S_||{}),rc=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(rc||{});function bS(t){let e=D.useContext(Cf);return e||Ge(!1),e}function CS(t){let e=D.useContext(gS);return e||Ge(!1),e}function PS(t){let e=D.useContext(Gr);return e||Ge(!1),e}function b_(t){let e=PS(),n=e.matches[e.matches.length-1];return n.route.id||Ge(!1),n.route.id}function NS(){var t;let e=D.useContext(E_),n=CS(rc.UseRouteError),r=b_(rc.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function kS(){let{router:t}=bS(S_.UseNavigateStable),e=b_(rc.UseNavigateStable),n=D.useRef(!1);return T_(()=>{n.current=!0}),D.useCallback(function(s,i){i===void 0&&(i={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,qo({fromRouteId:e},i)))},[t,e])}const Lg={};function AS(t,e,n){!e&&!Lg[t]&&(Lg[t]=!0)}function RS(t,e){t==null||t.v7_startTransition,(t==null?void 0:t.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function xn(t){Ge(!1)}function jS(t){let{basename:e="/",children:n=null,location:r,navigationType:s=Tr.Pop,navigator:i,static:o=!1,future:l}=t;la()&&Ge(!1);let c=e.replace(/^\/*/,"/"),d=D.useMemo(()=>({basename:c,navigator:i,static:o,future:qo({v7_relativeSplatPath:!1},l)}),[c,l,i,o]);typeof r=="string"&&(r=Pi(r));let{pathname:p="/",search:m="",hash:g="",state:S=null,key:C="default"}=r,k=D.useMemo(()=>{let R=bf(p,c);return R==null?null:{location:{pathname:R,search:m,hash:g,state:S,key:C},navigationType:s}},[c,p,m,g,S,C,s]);return k==null?null:D.createElement(Ss.Provider,{value:d},D.createElement(Lc.Provider,{children:n,value:k}))}function DS(t){let{children:e,location:n}=t;return _S(sh(e),n)}new Promise(()=>{});function sh(t,e){e===void 0&&(e=[]);let n=[];return D.Children.forEach(t,(r,s)=>{if(!D.isValidElement(r))return;let i=[...e,s];if(r.type===D.Fragment){n.push.apply(n,sh(r.props.children,i));return}r.type!==xn&&Ge(!1),!r.props.index||!r.props.children||Ge(!1);let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=sh(r.props.children,i)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ih(){return ih=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ih.apply(this,arguments)}function MS(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function OS(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function LS(t,e){return t.button===0&&(!e||e==="_self")&&!OS(t)}const VS=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],FS="6";try{window.__reactRouterVersion=FS}catch{}const US="startTransition",Vg=jE[US];function $S(t){let{basename:e,children:n,future:r,window:s}=t,i=D.useRef();i.current==null&&(i.current=HI({window:s,v5Compat:!0}));let o=i.current,[l,c]=D.useState({action:o.action,location:o.location}),{v7_startTransition:d}=r||{},p=D.useCallback(m=>{d&&Vg?Vg(()=>c(m)):c(m)},[c,d]);return D.useLayoutEffect(()=>o.listen(p),[o,p]),D.useEffect(()=>RS(r),[r]),D.createElement(jS,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:o,future:r})}const BS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",zS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,os=D.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:i,replace:o,state:l,target:c,to:d,preventScrollReset:p,viewTransition:m}=e,g=MS(e,VS),{basename:S}=D.useContext(Ss),C,k=!1;if(typeof d=="string"&&zS.test(d)&&(C=d,BS))try{let b=new URL(window.location.href),M=d.startsWith("//")?new URL(b.protocol+d):new URL(d),O=bf(M.pathname,S);M.origin===b.origin&&O!=null?d=O+M.search+M.hash:k=!0}catch{}let R=yS(d,{relative:s}),I=WS(d,{replace:o,state:l,target:c,preventScrollReset:p,relative:s,viewTransition:m});function w(b){r&&r(b),b.defaultPrevented||I(b)}return D.createElement("a",ih({},g,{href:C||R,onClick:k||i?r:w,ref:n,target:c}))});var Fg;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Fg||(Fg={}));var Ug;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Ug||(Ug={}));function WS(t,e){let{target:n,replace:r,state:s,preventScrollReset:i,relative:o,viewTransition:l}=e===void 0?{}:e,c=jn(),d=ca(),p=I_(t,{relative:o});return D.useCallback(m=>{if(LS(m,n)){m.preventDefault();let g=r!==void 0?r:nc(d)===nc(p);c(t,{replace:g,state:s,preventScrollReset:i,relative:o,viewTransition:l})}},[d,c,p,r,s,n,t,i,o,l])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C_=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},HS=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},P_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,l=o?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,p=i>>2,m=(i&3)<<4|l>>4;let g=(l&15)<<2|d>>6,S=d&63;c||(S=64,o||(g=64)),r.push(n[p],n[m],n[g],n[S])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(C_(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):HS(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const m=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||m==null)throw new qS;const g=i<<2|l>>4;if(r.push(g),d!==64){const S=l<<4&240|d>>2;if(r.push(S),m!==64){const C=d<<6&192|m;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class qS extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const GS=function(t){const e=C_(t);return P_.encodeByteArray(e,!0)},sc=function(t){return GS(t).replace(/\./g,"")},N_=function(t){try{return P_.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KS(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QS=()=>KS().__FIREBASE_DEFAULTS__,YS=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},JS=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&N_(t[1]);return e&&JSON.parse(e)},Fc=()=>{try{return QS()||YS()||JS()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},k_=t=>{var e,n;return(n=(e=Fc())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},XS=t=>{const e=k_(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},A_=()=>{var t;return(t=Fc())===null||t===void 0?void 0:t.config},R_=t=>{var e;return(e=Fc())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZS{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e1(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t),l="";return[sc(JSON.stringify(n)),sc(JSON.stringify(o)),l].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ct(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function t1(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ct())}function n1(){var t;const e=(t=Fc())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function r1(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function s1(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function i1(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function o1(){const t=Ct();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function a1(){return!n1()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function l1(){try{return typeof indexedDB=="object"}catch{return!1}}function c1(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u1="FirebaseError";class sr extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=u1,Object.setPrototypeOf(this,sr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ua.prototype.create)}}class ua{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?d1(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new sr(s,l,r)}}function d1(t,e){return t.replace(h1,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const h1=/\{\$([^}]+)}/g;function f1(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function ic(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if($g(i)&&$g(o)){if(!ic(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function $g(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function da(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function ao(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function lo(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function p1(t,e){const n=new m1(t,e);return n.subscribe.bind(n)}class m1{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");g1(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Qu),s.error===void 0&&(s.error=Qu),s.complete===void 0&&(s.complete=Qu);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function g1(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Qu(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ke(t){return t&&t._delegate?t._delegate:t}class gs{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ns="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y1{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new ZS;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(_1(e))try{this.getOrInitializeService({instanceIdentifier:ns})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ns){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ns){return this.instances.has(e)}getOptions(e=ns){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,n){var r;const s=this.normalizeInstanceIdentifier(n),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:v1(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ns){return this.component?this.component.multipleInstances?e:ns:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function v1(t){return t===ns?void 0:t}function _1(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w1{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new y1(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var me;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(me||(me={}));const x1={debug:me.DEBUG,verbose:me.VERBOSE,info:me.INFO,warn:me.WARN,error:me.ERROR,silent:me.SILENT},E1=me.INFO,T1={[me.DEBUG]:"log",[me.VERBOSE]:"log",[me.INFO]:"info",[me.WARN]:"warn",[me.ERROR]:"error"},I1=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=T1[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Pf{constructor(e){this.name=e,this._logLevel=E1,this._logHandler=I1,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in me))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?x1[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,me.DEBUG,...e),this._logHandler(this,me.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,me.VERBOSE,...e),this._logHandler(this,me.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,me.INFO,...e),this._logHandler(this,me.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,me.WARN,...e),this._logHandler(this,me.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,me.ERROR,...e),this._logHandler(this,me.ERROR,...e)}}const S1=(t,e)=>e.some(n=>t instanceof n);let Bg,zg;function b1(){return Bg||(Bg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function C1(){return zg||(zg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const j_=new WeakMap,oh=new WeakMap,D_=new WeakMap,Yu=new WeakMap,Nf=new WeakMap;function P1(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(Dr(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&j_.set(n,t)}).catch(()=>{}),Nf.set(e,t),e}function N1(t){if(oh.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});oh.set(t,e)}let ah={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return oh.get(t);if(e==="objectStoreNames")return t.objectStoreNames||D_.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Dr(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function k1(t){ah=t(ah)}function A1(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Ju(this),e,...n);return D_.set(r,e.sort?e.sort():[e]),Dr(r)}:C1().includes(t)?function(...e){return t.apply(Ju(this),e),Dr(j_.get(this))}:function(...e){return Dr(t.apply(Ju(this),e))}}function R1(t){return typeof t=="function"?A1(t):(t instanceof IDBTransaction&&N1(t),S1(t,b1())?new Proxy(t,ah):t)}function Dr(t){if(t instanceof IDBRequest)return P1(t);if(Yu.has(t))return Yu.get(t);const e=R1(t);return e!==t&&(Yu.set(t,e),Nf.set(e,t)),e}const Ju=t=>Nf.get(t);function j1(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),l=Dr(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Dr(o.result),c.oldVersion,c.newVersion,Dr(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const D1=["get","getKey","getAll","getAllKeys","count"],M1=["put","add","delete","clear"],Xu=new Map;function Wg(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Xu.get(e))return Xu.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=M1.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||D1.includes(n)))return;const i=async function(o,...l){const c=this.transaction(o,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return Xu.set(e,i),i}k1(t=>({...t,get:(e,n,r)=>Wg(e,n)||t.get(e,n,r),has:(e,n)=>!!Wg(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O1{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(L1(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function L1(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const lh="@firebase/app",Hg="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zn=new Pf("@firebase/app"),V1="@firebase/app-compat",F1="@firebase/analytics-compat",U1="@firebase/analytics",$1="@firebase/app-check-compat",B1="@firebase/app-check",z1="@firebase/auth",W1="@firebase/auth-compat",H1="@firebase/database",q1="@firebase/data-connect",G1="@firebase/database-compat",K1="@firebase/functions",Q1="@firebase/functions-compat",Y1="@firebase/installations",J1="@firebase/installations-compat",X1="@firebase/messaging",Z1="@firebase/messaging-compat",eb="@firebase/performance",tb="@firebase/performance-compat",nb="@firebase/remote-config",rb="@firebase/remote-config-compat",sb="@firebase/storage",ib="@firebase/storage-compat",ob="@firebase/firestore",ab="@firebase/vertexai-preview",lb="@firebase/firestore-compat",cb="firebase",ub="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ch="[DEFAULT]",db={[lh]:"fire-core",[V1]:"fire-core-compat",[U1]:"fire-analytics",[F1]:"fire-analytics-compat",[B1]:"fire-app-check",[$1]:"fire-app-check-compat",[z1]:"fire-auth",[W1]:"fire-auth-compat",[H1]:"fire-rtdb",[q1]:"fire-data-connect",[G1]:"fire-rtdb-compat",[K1]:"fire-fn",[Q1]:"fire-fn-compat",[Y1]:"fire-iid",[J1]:"fire-iid-compat",[X1]:"fire-fcm",[Z1]:"fire-fcm-compat",[eb]:"fire-perf",[tb]:"fire-perf-compat",[nb]:"fire-rc",[rb]:"fire-rc-compat",[sb]:"fire-gcs",[ib]:"fire-gcs-compat",[ob]:"fire-fst",[lb]:"fire-fst-compat",[ab]:"fire-vertex","fire-js":"fire-js",[cb]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oc=new Map,hb=new Map,uh=new Map;function qg(t,e){try{t.container.addComponent(e)}catch(n){Zn.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function yi(t){const e=t.name;if(uh.has(e))return Zn.debug(`There were multiple attempts to register component ${e}.`),!1;uh.set(e,t);for(const n of oc.values())qg(n,t);for(const n of hb.values())qg(n,t);return!0}function kf(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Sn(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fb={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Mr=new ua("app","Firebase",fb);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pb{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new gs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Mr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ni=ub;function M_(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:ch,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Mr.create("bad-app-name",{appName:String(s)});if(n||(n=A_()),!n)throw Mr.create("no-options");const i=oc.get(s);if(i){if(ic(n,i.options)&&ic(r,i.config))return i;throw Mr.create("duplicate-app",{appName:s})}const o=new w1(s);for(const c of uh.values())o.addComponent(c);const l=new pb(n,r,o);return oc.set(s,l),l}function O_(t=ch){const e=oc.get(t);if(!e&&t===ch&&A_())return M_();if(!e)throw Mr.create("no-app",{appName:t});return e}function Or(t,e,n){var r;let s=(r=db[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${s}" with version "${e}":`];i&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Zn.warn(l.join(" "));return}yi(new gs(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mb="firebase-heartbeat-database",gb=1,Go="firebase-heartbeat-store";let Zu=null;function L_(){return Zu||(Zu=j1(mb,gb,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Go)}catch(n){console.warn(n)}}}}).catch(t=>{throw Mr.create("idb-open",{originalErrorMessage:t.message})})),Zu}async function yb(t){try{const n=(await L_()).transaction(Go),r=await n.objectStore(Go).get(V_(t));return await n.done,r}catch(e){if(e instanceof sr)Zn.warn(e.message);else{const n=Mr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Zn.warn(n.message)}}}async function Gg(t,e){try{const r=(await L_()).transaction(Go,"readwrite");await r.objectStore(Go).put(e,V_(t)),await r.done}catch(n){if(n instanceof sr)Zn.warn(n.message);else{const r=Mr.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Zn.warn(r.message)}}}function V_(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vb=1024,_b=30*24*60*60*1e3;class wb{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Eb(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Kg();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const l=new Date(o.date).valueOf();return Date.now()-l<=_b}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Zn.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Kg(),{heartbeatsToSend:r,unsentEntries:s}=xb(this._heartbeatsCache.heartbeats),i=sc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Zn.warn(n),""}}}function Kg(){return new Date().toISOString().substring(0,10)}function xb(t,e=vb){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Qg(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Qg(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class Eb{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return l1()?c1().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await yb(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return Gg(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return Gg(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Qg(t){return sc(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tb(t){yi(new gs("platform-logger",e=>new O1(e),"PRIVATE")),yi(new gs("heartbeat",e=>new wb(e),"PRIVATE")),Or(lh,Hg,t),Or(lh,Hg,"esm2017"),Or("fire-js","")}Tb("");function Af(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function F_(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Ib=F_,U_=new ua("auth","Firebase",F_());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ac=new Pf("@firebase/auth");function Sb(t,...e){ac.logLevel<=me.WARN&&ac.warn(`Auth (${Ni}): ${t}`,...e)}function Tl(t,...e){ac.logLevel<=me.ERROR&&ac.error(`Auth (${Ni}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gn(t,...e){throw Rf(t,...e)}function Pn(t,...e){return Rf(t,...e)}function $_(t,e,n){const r=Object.assign(Object.assign({},Ib()),{[e]:n});return new ua("auth","Firebase",r).create(e,{appName:t.name})}function Gn(t){return $_(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Rf(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return U_.create(t,...e)}function ne(t,e,...n){if(!t)throw Rf(e,...n)}function zn(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Tl(e),new Error(e)}function er(t,e){t||zn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dh(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function bb(){return Yg()==="http:"||Yg()==="https:"}function Yg(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cb(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(bb()||s1()||"connection"in navigator)?navigator.onLine:!0}function Pb(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(e,n){this.shortDelay=e,this.longDelay=n,er(n>e,"Short delay should be less than long delay!"),this.isMobile=t1()||i1()}get(){return Cb()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jf(t,e){er(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B_{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;zn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;zn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;zn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nb={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kb=new ha(3e4,6e4);function ir(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function or(t,e,n,r,s={}){return z_(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=da(Object.assign({key:t.config.apiKey},o)).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d=Object.assign({method:e,headers:c},i);return r1()||(d.referrerPolicy="no-referrer"),B_.fetch()(W_(t,t.config.apiHost,n,l),d)})}async function z_(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},Nb),e);try{const s=new Rb(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw ol(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw ol(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw ol(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw ol(t,"user-disabled",o);const p=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw $_(t,p,d);gn(t,p)}}catch(s){if(s instanceof sr)throw s;gn(t,"network-request-failed",{message:String(s)})}}async function fa(t,e,n,r,s={}){const i=await or(t,e,n,r,s);return"mfaPendingCredential"in i&&gn(t,"multi-factor-auth-required",{_serverResponse:i}),i}function W_(t,e,n,r){const s=`${e}${n}?${r}`;return t.config.emulator?jf(t.config,s):`${t.config.apiScheme}://${s}`}function Ab(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Rb{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Pn(this.auth,"network-request-failed")),kb.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function ol(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Pn(t,e,r);return s.customData._tokenResponse=n,s}function Jg(t){return t!==void 0&&t.enterprise!==void 0}class jb{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return Ab(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function Db(t,e){return or(t,"GET","/v2/recaptchaConfig",ir(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mb(t,e){return or(t,"POST","/v1/accounts:delete",e)}async function H_(t,e){return or(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function To(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Ob(t,e=!1){const n=Ke(t),r=await n.getIdToken(e),s=Df(r);ne(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:To(ed(s.auth_time)),issuedAtTime:To(ed(s.iat)),expirationTime:To(ed(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function ed(t){return Number(t)*1e3}function Df(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Tl("JWT malformed, contained fewer than 3 sections"),null;try{const s=N_(n);return s?JSON.parse(s):(Tl("Failed to decode base64 JWT payload"),null)}catch(s){return Tl("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Xg(t){const e=Df(t);return ne(e,"internal-error"),ne(typeof e.exp<"u","internal-error"),ne(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ko(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof sr&&Lb(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function Lb({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vb{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hh{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=To(this.lastLoginAt),this.creationTime=To(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lc(t){var e;const n=t.auth,r=await t.getIdToken(),s=await Ko(t,H_(n,{idToken:r}));ne(s==null?void 0:s.users.length,n,"internal-error");const i=s.users[0];t._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?q_(i.providerUserInfo):[],l=Ub(t.providerData,o),c=t.isAnonymous,d=!(t.email&&i.passwordHash)&&!(l!=null&&l.length),p=c?d:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new hh(i.createdAt,i.lastLoginAt),isAnonymous:p};Object.assign(t,m)}async function Fb(t){const e=Ke(t);await lc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Ub(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function q_(t){return t.map(e=>{var{providerId:n}=e,r=Af(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $b(t,e){const n=await z_(t,{},async()=>{const r=da({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=W_(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",B_.fetch()(o,{method:"POST",headers:l,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function Bb(t,e){return or(t,"POST","/v2/accounts:revokeToken",ir(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ne(e.idToken,"internal-error"),ne(typeof e.idToken<"u","internal-error"),ne(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Xg(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){ne(e.length!==0,"internal-error");const n=Xg(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(ne(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await $b(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new oi;return r&&(ne(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ne(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ne(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new oi,this.toJSON())}_performRefresh(){return zn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hr(t,e){ne(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Wn{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,i=Af(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Vb(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new hh(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Ko(this,this.stsTokenManager.getToken(this.auth,e));return ne(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return Ob(this,e)}reload(){return Fb(this)}_assign(e){this!==e&&(ne(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Wn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){ne(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await lc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Sn(this.auth.app))return Promise.reject(Gn(this.auth));const e=await this.getIdToken();return await Ko(this,Mb(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,i,o,l,c,d,p;const m=(r=n.displayName)!==null&&r!==void 0?r:void 0,g=(s=n.email)!==null&&s!==void 0?s:void 0,S=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,C=(o=n.photoURL)!==null&&o!==void 0?o:void 0,k=(l=n.tenantId)!==null&&l!==void 0?l:void 0,R=(c=n._redirectEventId)!==null&&c!==void 0?c:void 0,I=(d=n.createdAt)!==null&&d!==void 0?d:void 0,w=(p=n.lastLoginAt)!==null&&p!==void 0?p:void 0,{uid:b,emailVerified:M,isAnonymous:O,providerData:V,stsTokenManager:_}=n;ne(b&&_,e,"internal-error");const y=oi.fromJSON(this.name,_);ne(typeof b=="string",e,"internal-error"),hr(m,e.name),hr(g,e.name),ne(typeof M=="boolean",e,"internal-error"),ne(typeof O=="boolean",e,"internal-error"),hr(S,e.name),hr(C,e.name),hr(k,e.name),hr(R,e.name),hr(I,e.name),hr(w,e.name);const x=new Wn({uid:b,auth:e,email:g,emailVerified:M,displayName:m,isAnonymous:O,photoURL:C,phoneNumber:S,tenantId:k,stsTokenManager:y,createdAt:I,lastLoginAt:w});return V&&Array.isArray(V)&&(x.providerData=V.map(E=>Object.assign({},E))),R&&(x._redirectEventId=R),x}static async _fromIdTokenResponse(e,n,r=!1){const s=new oi;s.updateFromServerResponse(n);const i=new Wn({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await lc(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];ne(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?q_(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new oi;l.updateFromIdToken(r);const c=new Wn({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new hh(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zg=new Map;function Hn(t){er(t instanceof Function,"Expected a class definition");let e=Zg.get(t);return e?(er(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Zg.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G_{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}G_.type="NONE";const ey=G_;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(t,e,n){return`firebase:${t}:${e}:${n}`}class ai{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Il(this.userKey,s.apiKey,i),this.fullPersistenceKey=Il("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Wn._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new ai(Hn(ey),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||Hn(ey);const o=Il(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const p=await d._get(o);if(p){const m=Wn._fromJSON(e,p);d!==i&&(l=m),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new ai(i,e,r):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new ai(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ty(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(J_(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(K_(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Z_(e))return"Blackberry";if(ew(e))return"Webos";if(Q_(e))return"Safari";if((e.includes("chrome/")||Y_(e))&&!e.includes("edge/"))return"Chrome";if(X_(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function K_(t=Ct()){return/firefox\//i.test(t)}function Q_(t=Ct()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Y_(t=Ct()){return/crios\//i.test(t)}function J_(t=Ct()){return/iemobile/i.test(t)}function X_(t=Ct()){return/android/i.test(t)}function Z_(t=Ct()){return/blackberry/i.test(t)}function ew(t=Ct()){return/webos/i.test(t)}function Mf(t=Ct()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function zb(t=Ct()){var e;return Mf(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Wb(){return o1()&&document.documentMode===10}function tw(t=Ct()){return Mf(t)||X_(t)||ew(t)||Z_(t)||/windows phone/i.test(t)||J_(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nw(t,e=[]){let n;switch(t){case"Browser":n=ty(Ct());break;case"Worker":n=`${ty(Ct())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ni}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hb{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qb(t,e={}){return or(t,"GET","/v2/passwordPolicy",ir(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gb=6;class Kb{constructor(e){var n,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:Gb,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,s,i,o,l;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(n=c.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(s=c.containsLowercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(i=c.containsUppercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(l=c.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),c}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qb{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ny(this),this.idTokenSubscription=new ny(this),this.beforeStateQueue=new Hb(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=U_,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Hn(n)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await ai.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await H_(this,{idToken:e}),r=await Wn._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(Sn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,l=s==null?void 0:s._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(s=c.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ne(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await lc(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Pb()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Sn(this.app))return Promise.reject(Gn(this));const n=e?Ke(e):null;return n&&ne(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&ne(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Sn(this.app)?Promise.reject(Gn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Sn(this.app)?Promise.reject(Gn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Hn(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await qb(this),n=new Kb(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ua("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await Bb(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Hn(e)||this._popupRedirectResolver;ne(n,this,"argument-error"),this.redirectPersistenceManager=await ai.create(this,[Hn(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(ne(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ne(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=nw(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&Sb(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function bs(t){return Ke(t)}class ny{constructor(e){this.auth=e,this.observer=null,this.addObserver=p1(n=>this.observer=n)}get next(){return ne(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Uc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Yb(t){Uc=t}function rw(t){return Uc.loadJS(t)}function Jb(){return Uc.recaptchaEnterpriseScript}function Xb(){return Uc.gapiScript}function Zb(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const eC="recaptcha-enterprise",tC="NO_RECAPTCHA";class nC{constructor(e){this.type=eC,this.auth=bs(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,l)=>{Db(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new jb(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,o,l){const c=window.grecaptcha;Jg(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o(tC)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(l=>{if(!n&&Jg(window.grecaptcha))s(l,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=Jb();c.length!==0&&(c+=l),rw(c).then(()=>{s(l,i,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function ry(t,e,n,r=!1){const s=new nC(t);let i;try{i=await s.verify(n)}catch{i=await s.verify(n,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function fh(t,e,n,r){var s;if(!((s=t._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await ry(t,e,n,n==="getOobCode");return r(t,i)}else return r(t,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await ry(t,e,n,n==="getOobCode");return r(t,o)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rC(t,e){const n=kf(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(ic(i,e??{}))return s;gn(s,"already-initialized")}return n.initialize({options:e})}function sC(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Hn);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function iC(t,e,n){const r=bs(t);ne(r._canInitEmulator,r,"emulator-config-failed"),ne(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(n!=null&&n.disableWarnings),i=sw(e),{host:o,port:l}=oC(e),c=l===null?"":`:${l}`;r.config.emulator={url:`${i}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||aC()}function sw(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function oC(t){const e=sw(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:sy(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:sy(o)}}}function sy(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function aC(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return zn("not implemented")}_getIdTokenResponse(e){return zn("not implemented")}_linkToIdToken(e,n){return zn("not implemented")}_getReauthenticationResolver(e){return zn("not implemented")}}async function lC(t,e){return or(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cC(t,e){return fa(t,"POST","/v1/accounts:signInWithPassword",ir(t,e))}async function uC(t,e){return or(t,"POST","/v1/accounts:sendOobCode",ir(t,e))}async function dC(t,e){return uC(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hC(t,e){return fa(t,"POST","/v1/accounts:signInWithEmailLink",ir(t,e))}async function fC(t,e){return fa(t,"POST","/v1/accounts:signInWithEmailLink",ir(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo extends Of{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Qo(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Qo(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fh(e,n,"signInWithPassword",cC);case"emailLink":return hC(e,{email:this._email,oobCode:this._password});default:gn(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fh(e,r,"signUpPassword",lC);case"emailLink":return fC(e,{idToken:n,email:this._email,oobCode:this._password});default:gn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function li(t,e){return fa(t,"POST","/v1/accounts:signInWithIdp",ir(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pC="http://localhost";class ys extends Of{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new ys(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):gn("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,i=Af(n,["providerId","signInMethod"]);if(!r||!s)return null;const o=new ys(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return li(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,li(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,li(e,n)}buildRequest(){const e={requestUri:pC,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=da(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mC(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function gC(t){const e=ao(lo(t)).link,n=e?ao(lo(e)).deep_link_id:null,r=ao(lo(t)).deep_link_id;return(r?ao(lo(r)).link:null)||r||n||e||t}class Lf{constructor(e){var n,r,s,i,o,l;const c=ao(lo(e)),d=(n=c.apiKey)!==null&&n!==void 0?n:null,p=(r=c.oobCode)!==null&&r!==void 0?r:null,m=mC((s=c.mode)!==null&&s!==void 0?s:null);ne(d&&p&&m,"argument-error"),this.apiKey=d,this.operation=m,this.code=p,this.continueUrl=(i=c.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=c.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(l=c.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const n=gC(e);try{return new Lf(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki{constructor(){this.providerId=ki.PROVIDER_ID}static credential(e,n){return Qo._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Lf.parseLink(n);return ne(r,"argument-error"),Qo._fromEmailAndCode(e,r.code,r.tenantId)}}ki.PROVIDER_ID="password";ki.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ki.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa extends iw{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr extends pa{constructor(){super("facebook.com")}static credential(e){return ys._fromParams({providerId:yr.PROVIDER_ID,signInMethod:yr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return yr.credentialFromTaggedObject(e)}static credentialFromError(e){return yr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return yr.credential(e.oauthAccessToken)}catch{return null}}}yr.FACEBOOK_SIGN_IN_METHOD="facebook.com";yr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr extends pa{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return ys._fromParams({providerId:vr.PROVIDER_ID,signInMethod:vr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return vr.credentialFromTaggedObject(e)}static credentialFromError(e){return vr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return vr.credential(n,r)}catch{return null}}}vr.GOOGLE_SIGN_IN_METHOD="google.com";vr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r extends pa{constructor(){super("github.com")}static credential(e){return ys._fromParams({providerId:_r.PROVIDER_ID,signInMethod:_r.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _r.credentialFromTaggedObject(e)}static credentialFromError(e){return _r.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return _r.credential(e.oauthAccessToken)}catch{return null}}}_r.GITHUB_SIGN_IN_METHOD="github.com";_r.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr extends pa{constructor(){super("twitter.com")}static credential(e,n){return ys._fromParams({providerId:wr.PROVIDER_ID,signInMethod:wr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return wr.credentialFromTaggedObject(e)}static credentialFromError(e){return wr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return wr.credential(n,r)}catch{return null}}}wr.TWITTER_SIGN_IN_METHOD="twitter.com";wr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yC(t,e){return fa(t,"POST","/v1/accounts:signUp",ir(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await Wn._fromIdTokenResponse(e,r,s),o=iy(r);return new vs({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=iy(r);return new vs({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function iy(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc extends sr{constructor(e,n,r,s){var i;super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,cc.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new cc(e,n,r,s)}}function ow(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?cc._fromErrorAndOperation(t,i,e,r):i})}async function vC(t,e,n=!1){const r=await Ko(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return vs._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _C(t,e,n=!1){const{auth:r}=t;if(Sn(r.app))return Promise.reject(Gn(r));const s="reauthenticate";try{const i=await Ko(t,ow(r,s,e,t),n);ne(i.idToken,r,"internal-error");const o=Df(i.idToken);ne(o,r,"internal-error");const{sub:l}=o;return ne(t.uid===l,r,"user-mismatch"),vs._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&gn(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aw(t,e,n=!1){if(Sn(t.app))return Promise.reject(Gn(t));const r="signIn",s=await ow(t,r,e),i=await vs._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function wC(t,e){return aw(bs(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xC(t,e,n){var r;ne(((r=n.url)===null||r===void 0?void 0:r.length)>0,t,"invalid-continue-uri"),ne(typeof n.dynamicLinkDomain>"u"||n.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=n.url,e.dynamicLinkDomain=n.dynamicLinkDomain,e.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(ne(n.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=n.iOS.bundleId),n.android&&(ne(n.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=n.android.installApp,e.androidMinimumVersionCode=n.android.minimumVersion,e.androidPackageName=n.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lw(t){const e=bs(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function EC(t,e,n){if(Sn(t.app))return Promise.reject(Gn(t));const r=bs(t),o=await fh(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",yC).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&lw(t),c}),l=await vs._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(l.user),l}function TC(t,e,n){return Sn(t.app)?Promise.reject(Gn(t)):wC(Ke(t),ki.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&lw(t),r})}async function IC(t,e){const n=Ke(t),s={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()};e&&xC(n.auth,s,e);const{email:i}=await dC(n.auth,s);i!==t.email&&await t.reload()}function SC(t,e,n,r){return Ke(t).onIdTokenChanged(e,n,r)}function bC(t,e,n){return Ke(t).beforeAuthStateChanged(e,n)}function CC(t,e,n,r){return Ke(t).onAuthStateChanged(e,n,r)}function cw(t){return Ke(t).signOut()}const uc="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uw{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(uc,"1"),this.storage.removeItem(uc),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PC=1e3,NC=10;class dw extends uw{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=tw(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);Wb()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,NC):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},PC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}dw.type="LOCAL";const kC=dw;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hw extends uw{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}hw.type="SESSION";const fw=hw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AC(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $c{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new $c(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async d=>d(n.origin,i)),c=await AC(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$c.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vf(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RC{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const d=Vf("",20);s.port1.start();const p=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(m){const g=m;if(g.data.eventId===d)switch(g.data.status){case"ack":clearTimeout(p),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(g.data.response);break;default:clearTimeout(p),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nn(){return window}function jC(t){Nn().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pw(){return typeof Nn().WorkerGlobalScope<"u"&&typeof Nn().importScripts=="function"}async function DC(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function MC(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function OC(){return pw()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mw="firebaseLocalStorageDb",LC=1,dc="firebaseLocalStorage",gw="fbase_key";class ma{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Bc(t,e){return t.transaction([dc],e?"readwrite":"readonly").objectStore(dc)}function VC(){const t=indexedDB.deleteDatabase(mw);return new ma(t).toPromise()}function ph(){const t=indexedDB.open(mw,LC);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(dc,{keyPath:gw})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(dc)?e(r):(r.close(),await VC(),e(await ph()))})})}async function oy(t,e,n){const r=Bc(t,!0).put({[gw]:e,value:n});return new ma(r).toPromise()}async function FC(t,e){const n=Bc(t,!1).get(e),r=await new ma(n).toPromise();return r===void 0?null:r.value}function ay(t,e){const n=Bc(t,!0).delete(e);return new ma(n).toPromise()}const UC=800,$C=3;class yw{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ph(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>$C)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return pw()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$c._getInstance(OC()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await DC(),!this.activeServiceWorker)return;this.sender=new RC(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||MC()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ph();return await oy(e,uc,"1"),await ay(e,uc),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>oy(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>FC(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>ay(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Bc(s,!1).getAll();return new ma(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),UC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}yw.type="LOCAL";const BC=yw;new ha(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zC(t,e){return e?Hn(e):(ne(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff extends Of{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return li(e,this._buildIdpRequest())}_linkToIdToken(e,n){return li(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return li(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function WC(t){return aw(t.auth,new Ff(t),t.bypassAuthState)}function HC(t){const{auth:e,user:n}=t;return ne(n,e,"internal-error"),_C(n,new Ff(t),t.bypassAuthState)}async function qC(t){const{auth:e,user:n}=t;return ne(n,e,"internal-error"),vC(n,new Ff(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vw{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return WC;case"linkViaPopup":case"linkViaRedirect":return qC;case"reauthViaPopup":case"reauthViaRedirect":return HC;default:gn(this.auth,"internal-error")}}resolve(e){er(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){er(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GC=new ha(2e3,1e4);class Zs extends vw{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Zs.currentPopupAction&&Zs.currentPopupAction.cancel(),Zs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ne(e,this.auth,"internal-error"),e}async onExecution(){er(this.filter.length===1,"Popup operations only handle one event");const e=Vf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Pn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Pn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Zs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Pn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,GC.get())};e()}}Zs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KC="pendingRedirect",Sl=new Map;class QC extends vw{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Sl.get(this.auth._key());if(!e){try{const r=await YC(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Sl.set(this.auth._key(),e)}return this.bypassAuthState||Sl.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function YC(t,e){const n=ZC(e),r=XC(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function JC(t,e){Sl.set(t._key(),e)}function XC(t){return Hn(t._redirectPersistence)}function ZC(t){return Il(KC,t.config.apiKey,t.name)}async function eP(t,e,n=!1){if(Sn(t.app))return Promise.reject(Gn(t));const r=bs(t),s=zC(r,e),o=await new QC(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tP=10*60*1e3;class nP{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!rP(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!_w(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(Pn(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=tP&&this.cachedEventUids.clear(),this.cachedEventUids.has(ly(e))}saveEventToCache(e){this.cachedEventUids.add(ly(e)),this.lastProcessedEventTime=Date.now()}}function ly(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function _w({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function rP(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return _w(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sP(t,e={}){return or(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iP=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,oP=/^https?/;async function aP(t){if(t.config.emulator)return;const{authorizedDomains:e}=await sP(t);for(const n of e)try{if(lP(n))return}catch{}gn(t,"unauthorized-domain")}function lP(t){const e=dh(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!oP.test(n))return!1;if(iP.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cP=new ha(3e4,6e4);function cy(){const t=Nn().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function uP(t){return new Promise((e,n)=>{var r,s,i;function o(){cy(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{cy(),n(Pn(t,"network-request-failed"))},timeout:cP.get()})}if(!((s=(r=Nn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Nn().gapi)===null||i===void 0)&&i.load)o();else{const l=Zb("iframefcb");return Nn()[l]=()=>{gapi.load?o():n(Pn(t,"network-request-failed"))},rw(`${Xb()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw bl=null,e})}let bl=null;function dP(t){return bl=bl||uP(t),bl}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hP=new ha(5e3,15e3),fP="__/auth/iframe",pP="emulator/auth/iframe",mP={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},gP=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function yP(t){const e=t.config;ne(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?jf(e,pP):`https://${t.config.authDomain}/${fP}`,r={apiKey:e.apiKey,appName:t.name,v:Ni},s=gP.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${da(r).slice(1)}`}async function vP(t){const e=await dP(t),n=Nn().gapi;return ne(n,t,"internal-error"),e.open({where:document.body,url:yP(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:mP,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Pn(t,"network-request-failed"),l=Nn().setTimeout(()=>{i(o)},hP.get());function c(){Nn().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _P={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},wP=500,xP=600,EP="_blank",TP="http://localhost";class uy{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function IP(t,e,n,r=wP,s=xP){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c=Object.assign(Object.assign({},_P),{width:r.toString(),height:s.toString(),top:i,left:o}),d=Ct().toLowerCase();n&&(l=Y_(d)?EP:n),K_(d)&&(e=e||TP,c.scrollbars="yes");const p=Object.entries(c).reduce((g,[S,C])=>`${g}${S}=${C},`,"");if(zb(d)&&l!=="_self")return SP(e||"",l),new uy(null);const m=window.open(e||"",l,p);ne(m,t,"popup-blocked");try{m.focus()}catch{}return new uy(m)}function SP(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bP="__/auth/handler",CP="emulator/auth/handler",PP=encodeURIComponent("fac");async function dy(t,e,n,r,s,i){ne(t.config.authDomain,t,"auth-domain-config-required"),ne(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Ni,eventId:s};if(e instanceof iw){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",f1(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,m]of Object.entries(i||{}))o[p]=m}if(e instanceof pa){const p=e.getScopes().filter(m=>m!=="");p.length>0&&(o.scopes=p.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const p of Object.keys(l))l[p]===void 0&&delete l[p];const c=await t._getAppCheckToken(),d=c?`#${PP}=${encodeURIComponent(c)}`:"";return`${NP(t)}?${da(l).slice(1)}${d}`}function NP({config:t}){return t.emulator?jf(t,CP):`https://${t.authDomain}/${bP}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const td="webStorageSupport";class kP{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=fw,this._completeRedirectFn=eP,this._overrideRedirectResult=JC}async _openPopup(e,n,r,s){var i;er((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await dy(e,n,r,dh(),s);return IP(e,o,Vf())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await dy(e,n,r,dh(),s);return jC(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(er(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await vP(e),r=new nP(e);return n.register("authEvent",s=>(ne(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(td,{type:td},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[td];o!==void 0&&n(!!o),gn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=aP(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return tw()||Q_()||Mf()}}const AP=kP;var hy="@firebase/auth",fy="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RP{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){ne(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jP(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function DP(t){yi(new gs("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;ne(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nw(t)},d=new Qb(r,s,i,c);return sC(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),yi(new gs("auth-internal",e=>{const n=bs(e.getProvider("auth").getImmediate());return(r=>new RP(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Or(hy,fy,jP(t)),Or(hy,fy,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MP=5*60,OP=R_("authIdTokenMaxAge")||MP;let py=null;const LP=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>OP)return;const s=n==null?void 0:n.token;py!==s&&(py=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function VP(t=O_()){const e=kf(t,"auth");if(e.isInitialized())return e.getImmediate();const n=rC(t,{popupRedirectResolver:AP,persistence:[BC,kC,fw]}),r=R_("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=LP(i.toString());bC(n,o,()=>o(n.currentUser)),SC(n,l=>o(l))}}const s=k_("auth");return s&&iC(n,`http://${s}`),n}function FP(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}Yb({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Pn("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",FP().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});DP("Browser");var UP="firebase",$P="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Or(UP,$P,"app");var my=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var us,ww;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(_,y){function x(){}x.prototype=y.prototype,_.D=y.prototype,_.prototype=new x,_.prototype.constructor=_,_.C=function(E,P,N){for(var T=Array(arguments.length-2),_e=2;_e<arguments.length;_e++)T[_e-2]=arguments[_e];return y.prototype[P].apply(E,T)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(_,y,x){x||(x=0);var E=Array(16);if(typeof y=="string")for(var P=0;16>P;++P)E[P]=y.charCodeAt(x++)|y.charCodeAt(x++)<<8|y.charCodeAt(x++)<<16|y.charCodeAt(x++)<<24;else for(P=0;16>P;++P)E[P]=y[x++]|y[x++]<<8|y[x++]<<16|y[x++]<<24;y=_.g[0],x=_.g[1],P=_.g[2];var N=_.g[3],T=y+(N^x&(P^N))+E[0]+3614090360&4294967295;y=x+(T<<7&4294967295|T>>>25),T=N+(P^y&(x^P))+E[1]+3905402710&4294967295,N=y+(T<<12&4294967295|T>>>20),T=P+(x^N&(y^x))+E[2]+606105819&4294967295,P=N+(T<<17&4294967295|T>>>15),T=x+(y^P&(N^y))+E[3]+3250441966&4294967295,x=P+(T<<22&4294967295|T>>>10),T=y+(N^x&(P^N))+E[4]+4118548399&4294967295,y=x+(T<<7&4294967295|T>>>25),T=N+(P^y&(x^P))+E[5]+1200080426&4294967295,N=y+(T<<12&4294967295|T>>>20),T=P+(x^N&(y^x))+E[6]+2821735955&4294967295,P=N+(T<<17&4294967295|T>>>15),T=x+(y^P&(N^y))+E[7]+4249261313&4294967295,x=P+(T<<22&4294967295|T>>>10),T=y+(N^x&(P^N))+E[8]+1770035416&4294967295,y=x+(T<<7&4294967295|T>>>25),T=N+(P^y&(x^P))+E[9]+2336552879&4294967295,N=y+(T<<12&4294967295|T>>>20),T=P+(x^N&(y^x))+E[10]+4294925233&4294967295,P=N+(T<<17&4294967295|T>>>15),T=x+(y^P&(N^y))+E[11]+2304563134&4294967295,x=P+(T<<22&4294967295|T>>>10),T=y+(N^x&(P^N))+E[12]+1804603682&4294967295,y=x+(T<<7&4294967295|T>>>25),T=N+(P^y&(x^P))+E[13]+4254626195&4294967295,N=y+(T<<12&4294967295|T>>>20),T=P+(x^N&(y^x))+E[14]+2792965006&4294967295,P=N+(T<<17&4294967295|T>>>15),T=x+(y^P&(N^y))+E[15]+1236535329&4294967295,x=P+(T<<22&4294967295|T>>>10),T=y+(P^N&(x^P))+E[1]+4129170786&4294967295,y=x+(T<<5&4294967295|T>>>27),T=N+(x^P&(y^x))+E[6]+3225465664&4294967295,N=y+(T<<9&4294967295|T>>>23),T=P+(y^x&(N^y))+E[11]+643717713&4294967295,P=N+(T<<14&4294967295|T>>>18),T=x+(N^y&(P^N))+E[0]+3921069994&4294967295,x=P+(T<<20&4294967295|T>>>12),T=y+(P^N&(x^P))+E[5]+3593408605&4294967295,y=x+(T<<5&4294967295|T>>>27),T=N+(x^P&(y^x))+E[10]+38016083&4294967295,N=y+(T<<9&4294967295|T>>>23),T=P+(y^x&(N^y))+E[15]+3634488961&4294967295,P=N+(T<<14&4294967295|T>>>18),T=x+(N^y&(P^N))+E[4]+3889429448&4294967295,x=P+(T<<20&4294967295|T>>>12),T=y+(P^N&(x^P))+E[9]+568446438&4294967295,y=x+(T<<5&4294967295|T>>>27),T=N+(x^P&(y^x))+E[14]+3275163606&4294967295,N=y+(T<<9&4294967295|T>>>23),T=P+(y^x&(N^y))+E[3]+4107603335&4294967295,P=N+(T<<14&4294967295|T>>>18),T=x+(N^y&(P^N))+E[8]+1163531501&4294967295,x=P+(T<<20&4294967295|T>>>12),T=y+(P^N&(x^P))+E[13]+2850285829&4294967295,y=x+(T<<5&4294967295|T>>>27),T=N+(x^P&(y^x))+E[2]+4243563512&4294967295,N=y+(T<<9&4294967295|T>>>23),T=P+(y^x&(N^y))+E[7]+1735328473&4294967295,P=N+(T<<14&4294967295|T>>>18),T=x+(N^y&(P^N))+E[12]+2368359562&4294967295,x=P+(T<<20&4294967295|T>>>12),T=y+(x^P^N)+E[5]+4294588738&4294967295,y=x+(T<<4&4294967295|T>>>28),T=N+(y^x^P)+E[8]+2272392833&4294967295,N=y+(T<<11&4294967295|T>>>21),T=P+(N^y^x)+E[11]+1839030562&4294967295,P=N+(T<<16&4294967295|T>>>16),T=x+(P^N^y)+E[14]+4259657740&4294967295,x=P+(T<<23&4294967295|T>>>9),T=y+(x^P^N)+E[1]+2763975236&4294967295,y=x+(T<<4&4294967295|T>>>28),T=N+(y^x^P)+E[4]+1272893353&4294967295,N=y+(T<<11&4294967295|T>>>21),T=P+(N^y^x)+E[7]+4139469664&4294967295,P=N+(T<<16&4294967295|T>>>16),T=x+(P^N^y)+E[10]+3200236656&4294967295,x=P+(T<<23&4294967295|T>>>9),T=y+(x^P^N)+E[13]+681279174&4294967295,y=x+(T<<4&4294967295|T>>>28),T=N+(y^x^P)+E[0]+3936430074&4294967295,N=y+(T<<11&4294967295|T>>>21),T=P+(N^y^x)+E[3]+3572445317&4294967295,P=N+(T<<16&4294967295|T>>>16),T=x+(P^N^y)+E[6]+76029189&4294967295,x=P+(T<<23&4294967295|T>>>9),T=y+(x^P^N)+E[9]+3654602809&4294967295,y=x+(T<<4&4294967295|T>>>28),T=N+(y^x^P)+E[12]+3873151461&4294967295,N=y+(T<<11&4294967295|T>>>21),T=P+(N^y^x)+E[15]+530742520&4294967295,P=N+(T<<16&4294967295|T>>>16),T=x+(P^N^y)+E[2]+3299628645&4294967295,x=P+(T<<23&4294967295|T>>>9),T=y+(P^(x|~N))+E[0]+4096336452&4294967295,y=x+(T<<6&4294967295|T>>>26),T=N+(x^(y|~P))+E[7]+1126891415&4294967295,N=y+(T<<10&4294967295|T>>>22),T=P+(y^(N|~x))+E[14]+2878612391&4294967295,P=N+(T<<15&4294967295|T>>>17),T=x+(N^(P|~y))+E[5]+4237533241&4294967295,x=P+(T<<21&4294967295|T>>>11),T=y+(P^(x|~N))+E[12]+1700485571&4294967295,y=x+(T<<6&4294967295|T>>>26),T=N+(x^(y|~P))+E[3]+2399980690&4294967295,N=y+(T<<10&4294967295|T>>>22),T=P+(y^(N|~x))+E[10]+4293915773&4294967295,P=N+(T<<15&4294967295|T>>>17),T=x+(N^(P|~y))+E[1]+2240044497&4294967295,x=P+(T<<21&4294967295|T>>>11),T=y+(P^(x|~N))+E[8]+1873313359&4294967295,y=x+(T<<6&4294967295|T>>>26),T=N+(x^(y|~P))+E[15]+4264355552&4294967295,N=y+(T<<10&4294967295|T>>>22),T=P+(y^(N|~x))+E[6]+2734768916&4294967295,P=N+(T<<15&4294967295|T>>>17),T=x+(N^(P|~y))+E[13]+1309151649&4294967295,x=P+(T<<21&4294967295|T>>>11),T=y+(P^(x|~N))+E[4]+4149444226&4294967295,y=x+(T<<6&4294967295|T>>>26),T=N+(x^(y|~P))+E[11]+3174756917&4294967295,N=y+(T<<10&4294967295|T>>>22),T=P+(y^(N|~x))+E[2]+718787259&4294967295,P=N+(T<<15&4294967295|T>>>17),T=x+(N^(P|~y))+E[9]+3951481745&4294967295,_.g[0]=_.g[0]+y&4294967295,_.g[1]=_.g[1]+(P+(T<<21&4294967295|T>>>11))&4294967295,_.g[2]=_.g[2]+P&4294967295,_.g[3]=_.g[3]+N&4294967295}r.prototype.u=function(_,y){y===void 0&&(y=_.length);for(var x=y-this.blockSize,E=this.B,P=this.h,N=0;N<y;){if(P==0)for(;N<=x;)s(this,_,N),N+=this.blockSize;if(typeof _=="string"){for(;N<y;)if(E[P++]=_.charCodeAt(N++),P==this.blockSize){s(this,E),P=0;break}}else for(;N<y;)if(E[P++]=_[N++],P==this.blockSize){s(this,E),P=0;break}}this.h=P,this.o+=y},r.prototype.v=function(){var _=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);_[0]=128;for(var y=1;y<_.length-8;++y)_[y]=0;var x=8*this.o;for(y=_.length-8;y<_.length;++y)_[y]=x&255,x/=256;for(this.u(_),_=Array(16),y=x=0;4>y;++y)for(var E=0;32>E;E+=8)_[x++]=this.g[y]>>>E&255;return _};function i(_,y){var x=l;return Object.prototype.hasOwnProperty.call(x,_)?x[_]:x[_]=y(_)}function o(_,y){this.h=y;for(var x=[],E=!0,P=_.length-1;0<=P;P--){var N=_[P]|0;E&&N==y||(x[P]=N,E=!1)}this.g=x}var l={};function c(_){return-128<=_&&128>_?i(_,function(y){return new o([y|0],0>y?-1:0)}):new o([_|0],0>_?-1:0)}function d(_){if(isNaN(_)||!isFinite(_))return m;if(0>_)return R(d(-_));for(var y=[],x=1,E=0;_>=x;E++)y[E]=_/x|0,x*=4294967296;return new o(y,0)}function p(_,y){if(_.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(_.charAt(0)=="-")return R(p(_.substring(1),y));if(0<=_.indexOf("-"))throw Error('number format error: interior "-" character');for(var x=d(Math.pow(y,8)),E=m,P=0;P<_.length;P+=8){var N=Math.min(8,_.length-P),T=parseInt(_.substring(P,P+N),y);8>N?(N=d(Math.pow(y,N)),E=E.j(N).add(d(T))):(E=E.j(x),E=E.add(d(T)))}return E}var m=c(0),g=c(1),S=c(16777216);t=o.prototype,t.m=function(){if(k(this))return-R(this).m();for(var _=0,y=1,x=0;x<this.g.length;x++){var E=this.i(x);_+=(0<=E?E:4294967296+E)*y,y*=4294967296}return _},t.toString=function(_){if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(C(this))return"0";if(k(this))return"-"+R(this).toString(_);for(var y=d(Math.pow(_,6)),x=this,E="";;){var P=M(x,y).g;x=I(x,P.j(y));var N=((0<x.g.length?x.g[0]:x.h)>>>0).toString(_);if(x=P,C(x))return N+E;for(;6>N.length;)N="0"+N;E=N+E}},t.i=function(_){return 0>_?0:_<this.g.length?this.g[_]:this.h};function C(_){if(_.h!=0)return!1;for(var y=0;y<_.g.length;y++)if(_.g[y]!=0)return!1;return!0}function k(_){return _.h==-1}t.l=function(_){return _=I(this,_),k(_)?-1:C(_)?0:1};function R(_){for(var y=_.g.length,x=[],E=0;E<y;E++)x[E]=~_.g[E];return new o(x,~_.h).add(g)}t.abs=function(){return k(this)?R(this):this},t.add=function(_){for(var y=Math.max(this.g.length,_.g.length),x=[],E=0,P=0;P<=y;P++){var N=E+(this.i(P)&65535)+(_.i(P)&65535),T=(N>>>16)+(this.i(P)>>>16)+(_.i(P)>>>16);E=T>>>16,N&=65535,T&=65535,x[P]=T<<16|N}return new o(x,x[x.length-1]&-2147483648?-1:0)};function I(_,y){return _.add(R(y))}t.j=function(_){if(C(this)||C(_))return m;if(k(this))return k(_)?R(this).j(R(_)):R(R(this).j(_));if(k(_))return R(this.j(R(_)));if(0>this.l(S)&&0>_.l(S))return d(this.m()*_.m());for(var y=this.g.length+_.g.length,x=[],E=0;E<2*y;E++)x[E]=0;for(E=0;E<this.g.length;E++)for(var P=0;P<_.g.length;P++){var N=this.i(E)>>>16,T=this.i(E)&65535,_e=_.i(P)>>>16,mt=_.i(P)&65535;x[2*E+2*P]+=T*mt,w(x,2*E+2*P),x[2*E+2*P+1]+=N*mt,w(x,2*E+2*P+1),x[2*E+2*P+1]+=T*_e,w(x,2*E+2*P+1),x[2*E+2*P+2]+=N*_e,w(x,2*E+2*P+2)}for(E=0;E<y;E++)x[E]=x[2*E+1]<<16|x[2*E];for(E=y;E<2*y;E++)x[E]=0;return new o(x,0)};function w(_,y){for(;(_[y]&65535)!=_[y];)_[y+1]+=_[y]>>>16,_[y]&=65535,y++}function b(_,y){this.g=_,this.h=y}function M(_,y){if(C(y))throw Error("division by zero");if(C(_))return new b(m,m);if(k(_))return y=M(R(_),y),new b(R(y.g),R(y.h));if(k(y))return y=M(_,R(y)),new b(R(y.g),y.h);if(30<_.g.length){if(k(_)||k(y))throw Error("slowDivide_ only works with positive integers.");for(var x=g,E=y;0>=E.l(_);)x=O(x),E=O(E);var P=V(x,1),N=V(E,1);for(E=V(E,2),x=V(x,2);!C(E);){var T=N.add(E);0>=T.l(_)&&(P=P.add(x),N=T),E=V(E,1),x=V(x,1)}return y=I(_,P.j(y)),new b(P,y)}for(P=m;0<=_.l(y);){for(x=Math.max(1,Math.floor(_.m()/y.m())),E=Math.ceil(Math.log(x)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),N=d(x),T=N.j(y);k(T)||0<T.l(_);)x-=E,N=d(x),T=N.j(y);C(N)&&(N=g),P=P.add(N),_=I(_,T)}return new b(P,_)}t.A=function(_){return M(this,_).h},t.and=function(_){for(var y=Math.max(this.g.length,_.g.length),x=[],E=0;E<y;E++)x[E]=this.i(E)&_.i(E);return new o(x,this.h&_.h)},t.or=function(_){for(var y=Math.max(this.g.length,_.g.length),x=[],E=0;E<y;E++)x[E]=this.i(E)|_.i(E);return new o(x,this.h|_.h)},t.xor=function(_){for(var y=Math.max(this.g.length,_.g.length),x=[],E=0;E<y;E++)x[E]=this.i(E)^_.i(E);return new o(x,this.h^_.h)};function O(_){for(var y=_.g.length+1,x=[],E=0;E<y;E++)x[E]=_.i(E)<<1|_.i(E-1)>>>31;return new o(x,_.h)}function V(_,y){var x=y>>5;y%=32;for(var E=_.g.length-x,P=[],N=0;N<E;N++)P[N]=0<y?_.i(N+x)>>>y|_.i(N+x+1)<<32-y:_.i(N+x);return new o(P,_.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,ww=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=p,us=o}).apply(typeof my<"u"?my:typeof self<"u"?self:typeof window<"u"?window:{});var al=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xw,co,Ew,Cl,mh,Tw,Iw,Sw;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,h,f){return a==Array.prototype||a==Object.prototype||(a[h]=f.value),a};function n(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof al=="object"&&al];for(var h=0;h<a.length;++h){var f=a[h];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var r=n(this);function s(a,h){if(h)e:{var f=r;a=a.split(".");for(var v=0;v<a.length-1;v++){var j=a[v];if(!(j in f))break e;f=f[j]}a=a[a.length-1],v=f[a],h=h(v),h!=v&&h!=null&&e(f,a,{configurable:!0,writable:!0,value:h})}}function i(a,h){a instanceof String&&(a+="");var f=0,v=!1,j={next:function(){if(!v&&f<a.length){var L=f++;return{value:h(L,a[L]),done:!1}}return v=!0,{done:!0,value:void 0}}};return j[Symbol.iterator]=function(){return j},j}s("Array.prototype.values",function(a){return a||function(){return i(this,function(h,f){return f})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function c(a){var h=typeof a;return h=h!="object"?h:a?Array.isArray(a)?"array":h:"null",h=="array"||h=="object"&&typeof a.length=="number"}function d(a){var h=typeof a;return h=="object"&&a!=null||h=="function"}function p(a,h,f){return a.call.apply(a.bind,arguments)}function m(a,h,f){if(!a)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var j=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(j,v),a.apply(h,j)}}return function(){return a.apply(h,arguments)}}function g(a,h,f){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:m,g.apply(null,arguments)}function S(a,h){var f=Array.prototype.slice.call(arguments,1);return function(){var v=f.slice();return v.push.apply(v,arguments),a.apply(this,v)}}function C(a,h){function f(){}f.prototype=h.prototype,a.aa=h.prototype,a.prototype=new f,a.prototype.constructor=a,a.Qb=function(v,j,L){for(var W=Array(arguments.length-2),Se=2;Se<arguments.length;Se++)W[Se-2]=arguments[Se];return h.prototype[j].apply(v,W)}}function k(a){const h=a.length;if(0<h){const f=Array(h);for(let v=0;v<h;v++)f[v]=a[v];return f}return[]}function R(a,h){for(let f=1;f<arguments.length;f++){const v=arguments[f];if(c(v)){const j=a.length||0,L=v.length||0;a.length=j+L;for(let W=0;W<L;W++)a[j+W]=v[W]}else a.push(v)}}class I{constructor(h,f){this.i=h,this.j=f,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function w(a){return/^[\s\xa0]*$/.test(a)}function b(){var a=l.navigator;return a&&(a=a.userAgent)?a:""}function M(a){return M[" "](a),a}M[" "]=function(){};var O=b().indexOf("Gecko")!=-1&&!(b().toLowerCase().indexOf("webkit")!=-1&&b().indexOf("Edge")==-1)&&!(b().indexOf("Trident")!=-1||b().indexOf("MSIE")!=-1)&&b().indexOf("Edge")==-1;function V(a,h,f){for(const v in a)h.call(f,a[v],v,a)}function _(a,h){for(const f in a)h.call(void 0,a[f],f,a)}function y(a){const h={};for(const f in a)h[f]=a[f];return h}const x="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(a,h){let f,v;for(let j=1;j<arguments.length;j++){v=arguments[j];for(f in v)a[f]=v[f];for(let L=0;L<x.length;L++)f=x[L],Object.prototype.hasOwnProperty.call(v,f)&&(a[f]=v[f])}}function P(a){var h=1;a=a.split(":");const f=[];for(;0<h&&a.length;)f.push(a.shift()),h--;return a.length&&f.push(a.join(":")),f}function N(a){l.setTimeout(()=>{throw a},0)}function T(){var a=te;let h=null;return a.g&&(h=a.g,a.g=a.g.next,a.g||(a.h=null),h.next=null),h}class _e{constructor(){this.h=this.g=null}add(h,f){const v=mt.get();v.set(h,f),this.h?this.h.next=v:this.g=v,this.h=v}}var mt=new I(()=>new Qe,a=>a.reset());class Qe{constructor(){this.next=this.g=this.h=null}set(h,f){this.h=h,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let Ye,G=!1,te=new _e,A=()=>{const a=l.Promise.resolve(void 0);Ye=()=>{a.then(H)}};var H=()=>{for(var a;a=T();){try{a.h.call(a.g)}catch(f){N(f)}var h=mt;h.j(a),100>h.h&&(h.h++,a.next=h.g,h.g=a)}G=!1};function Z(){this.s=this.s,this.C=this.C}Z.prototype.s=!1,Z.prototype.ma=function(){this.s||(this.s=!0,this.N())},Z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function q(a,h){this.type=a,this.g=this.target=h,this.defaultPrevented=!1}q.prototype.h=function(){this.defaultPrevented=!0};var oe=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,h=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const f=()=>{};l.addEventListener("test",f,h),l.removeEventListener("test",f,h)}catch{}return a}();function de(a,h){if(q.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var f=this.type=a.type,v=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=h,h=a.relatedTarget){if(O){e:{try{M(h.nodeName);var j=!0;break e}catch{}j=!1}j||(h=null)}}else f=="mouseover"?h=a.fromElement:f=="mouseout"&&(h=a.toElement);this.relatedTarget=h,v?(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:je[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&de.aa.h.call(this)}}C(de,q);var je={2:"touch",3:"pen",4:"mouse"};de.prototype.h=function(){de.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var De="closure_listenable_"+(1e6*Math.random()|0),F=0;function re(a,h,f,v,j){this.listener=a,this.proxy=null,this.src=h,this.type=f,this.capture=!!v,this.ha=j,this.key=++F,this.da=this.fa=!1}function se(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function ye(a){this.src=a,this.g={},this.h=0}ye.prototype.add=function(a,h,f,v,j){var L=a.toString();a=this.g[L],a||(a=this.g[L]=[],this.h++);var W=K(a,h,v,j);return-1<W?(h=a[W],f||(h.fa=!1)):(h=new re(h,this.src,L,!!v,j),h.fa=f,a.push(h)),h};function U(a,h){var f=h.type;if(f in a.g){var v=a.g[f],j=Array.prototype.indexOf.call(v,h,void 0),L;(L=0<=j)&&Array.prototype.splice.call(v,j,1),L&&(se(h),a.g[f].length==0&&(delete a.g[f],a.h--))}}function K(a,h,f,v){for(var j=0;j<a.length;++j){var L=a[j];if(!L.da&&L.listener==h&&L.capture==!!f&&L.ha==v)return j}return-1}var X="closure_lm_"+(1e6*Math.random()|0),ue={};function pe(a,h,f,v,j){if(v&&v.once)return Ee(a,h,f,v,j);if(Array.isArray(h)){for(var L=0;L<h.length;L++)pe(a,h[L],f,v,j);return null}return f=Di(f),a&&a[De]?a.K(h,f,d(v)?!!v.capture:!!v,j):ae(a,h,f,!1,v,j)}function ae(a,h,f,v,j,L){if(!h)throw Error("Invalid event type");var W=d(j)?!!j.capture:!!j,Se=et(a);if(Se||(a[X]=Se=new ye(a)),f=Se.add(h,f,v,W,L),f.proxy)return f;if(v=Pe(),f.proxy=v,v.src=a,v.listener=f,a.addEventListener)oe||(j=W),j===void 0&&(j=!1),a.addEventListener(h.toString(),v,j);else if(a.attachEvent)a.attachEvent(ar(h.toString()),v);else if(a.addListener&&a.removeListener)a.addListener(v);else throw Error("addEventListener and attachEvent are unavailable.");return f}function Pe(){function a(f){return h.call(a.src,a.listener,f)}const h=Dn;return a}function Ee(a,h,f,v,j){if(Array.isArray(h)){for(var L=0;L<h.length;L++)Ee(a,h[L],f,v,j);return null}return f=Di(f),a&&a[De]?a.L(h,f,d(v)?!!v.capture:!!v,j):ae(a,h,f,!0,v,j)}function st(a,h,f,v,j){if(Array.isArray(h))for(var L=0;L<h.length;L++)st(a,h[L],f,v,j);else v=d(v)?!!v.capture:!!v,f=Di(f),a&&a[De]?(a=a.i,h=String(h).toString(),h in a.g&&(L=a.g[h],f=K(L,f,v,j),-1<f&&(se(L[f]),Array.prototype.splice.call(L,f,1),L.length==0&&(delete a.g[h],a.h--)))):a&&(a=et(a))&&(h=a.g[h.toString()],a=-1,h&&(a=K(h,f,v,j)),(f=-1<a?h[a]:null)&&on(f))}function on(a){if(typeof a!="number"&&a&&!a.da){var h=a.src;if(h&&h[De])U(h.i,a);else{var f=a.type,v=a.proxy;h.removeEventListener?h.removeEventListener(f,v,a.capture):h.detachEvent?h.detachEvent(ar(f),v):h.addListener&&h.removeListener&&h.removeListener(v),(f=et(h))?(U(f,a),f.h==0&&(f.src=null,h[X]=null)):se(a)}}}function ar(a){return a in ue?ue[a]:ue[a]="on"+a}function Dn(a,h){if(a.da)a=!0;else{h=new de(h,this);var f=a.listener,v=a.ha||a.src;a.fa&&on(a),a=f.call(v,h)}return a}function et(a){return a=a[X],a instanceof ye?a:null}var ba="__closure_events_fn_"+(1e9*Math.random()>>>0);function Di(a){return typeof a=="function"?a:(a[ba]||(a[ba]=function(h){return a.handleEvent(h)}),a[ba])}function gt(){Z.call(this),this.i=new ye(this),this.M=this,this.F=null}C(gt,Z),gt.prototype[De]=!0,gt.prototype.removeEventListener=function(a,h,f,v){st(this,a,h,f,v)};function Pt(a,h){var f,v=a.F;if(v)for(f=[];v;v=v.F)f.push(v);if(a=a.M,v=h.type||h,typeof h=="string")h=new q(h,a);else if(h instanceof q)h.target=h.target||a;else{var j=h;h=new q(v,a),E(h,j)}if(j=!0,f)for(var L=f.length-1;0<=L;L--){var W=h.g=f[L];j=Ca(W,v,!0,h)&&j}if(W=h.g=a,j=Ca(W,v,!0,h)&&j,j=Ca(W,v,!1,h)&&j,f)for(L=0;L<f.length;L++)W=h.g=f[L],j=Ca(W,v,!1,h)&&j}gt.prototype.N=function(){if(gt.aa.N.call(this),this.i){var a=this.i,h;for(h in a.g){for(var f=a.g[h],v=0;v<f.length;v++)se(f[v]);delete a.g[h],a.h--}}this.F=null},gt.prototype.K=function(a,h,f,v){return this.i.add(String(a),h,!1,f,v)},gt.prototype.L=function(a,h,f,v){return this.i.add(String(a),h,!0,f,v)};function Ca(a,h,f,v){if(h=a.i.g[String(h)],!h)return!0;h=h.concat();for(var j=!0,L=0;L<h.length;++L){var W=h[L];if(W&&!W.da&&W.capture==f){var Se=W.listener,it=W.ha||W.src;W.fa&&U(a.i,W),j=Se.call(it,v)!==!1&&j}}return j&&!v.defaultPrevented}function Pp(a,h,f){if(typeof a=="function")f&&(a=g(a,f));else if(a&&typeof a.handleEvent=="function")a=g(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:l.setTimeout(a,h||0)}function Np(a){a.g=Pp(()=>{a.g=null,a.i&&(a.i=!1,Np(a))},a.l);const h=a.h;a.h=null,a.m.apply(null,h)}class Wx extends Z{constructor(h,f){super(),this.m=h,this.l=f,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:Np(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Mi(a){Z.call(this),this.h=a,this.g={}}C(Mi,Z);var kp=[];function Ap(a){V(a.g,function(h,f){this.g.hasOwnProperty(f)&&on(h)},a),a.g={}}Mi.prototype.N=function(){Mi.aa.N.call(this),Ap(this)},Mi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ou=l.JSON.stringify,Hx=l.JSON.parse,qx=class{stringify(a){return l.JSON.stringify(a,void 0)}parse(a){return l.JSON.parse(a,void 0)}};function au(){}au.prototype.h=null;function Rp(a){return a.h||(a.h=a.i())}function jp(){}var Oi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function lu(){q.call(this,"d")}C(lu,q);function cu(){q.call(this,"c")}C(cu,q);var Yr={},Dp=null;function Pa(){return Dp=Dp||new gt}Yr.La="serverreachability";function Mp(a){q.call(this,Yr.La,a)}C(Mp,q);function Li(a){const h=Pa();Pt(h,new Mp(h))}Yr.STAT_EVENT="statevent";function Op(a,h){q.call(this,Yr.STAT_EVENT,a),this.stat=h}C(Op,q);function Nt(a){const h=Pa();Pt(h,new Op(h,a))}Yr.Ma="timingevent";function Lp(a,h){q.call(this,Yr.Ma,a),this.size=h}C(Lp,q);function Vi(a,h){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){a()},h)}function Fi(){this.g=!0}Fi.prototype.xa=function(){this.g=!1};function Gx(a,h,f,v,j,L){a.info(function(){if(a.g)if(L)for(var W="",Se=L.split("&"),it=0;it<Se.length;it++){var we=Se[it].split("=");if(1<we.length){var yt=we[0];we=we[1];var vt=yt.split("_");W=2<=vt.length&&vt[1]=="type"?W+(yt+"="+we+"&"):W+(yt+"=redacted&")}}else W=null;else W=L;return"XMLHTTP REQ ("+v+") [attempt "+j+"]: "+h+`
`+f+`
`+W})}function Kx(a,h,f,v,j,L,W){a.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+j+"]: "+h+`
`+f+`
`+L+" "+W})}function As(a,h,f,v){a.info(function(){return"XMLHTTP TEXT ("+h+"): "+Yx(a,f)+(v?" "+v:"")})}function Qx(a,h){a.info(function(){return"TIMEOUT: "+h})}Fi.prototype.info=function(){};function Yx(a,h){if(!a.g)return h;if(!h)return null;try{var f=JSON.parse(h);if(f){for(a=0;a<f.length;a++)if(Array.isArray(f[a])){var v=f[a];if(!(2>v.length)){var j=v[1];if(Array.isArray(j)&&!(1>j.length)){var L=j[0];if(L!="noop"&&L!="stop"&&L!="close")for(var W=1;W<j.length;W++)j[W]=""}}}}return ou(f)}catch{return h}}var Na={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Vp={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},uu;function ka(){}C(ka,au),ka.prototype.g=function(){return new XMLHttpRequest},ka.prototype.i=function(){return{}},uu=new ka;function lr(a,h,f,v){this.j=a,this.i=h,this.l=f,this.R=v||1,this.U=new Mi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Fp}function Fp(){this.i=null,this.g="",this.h=!1}var Up={},du={};function hu(a,h,f){a.L=1,a.v=Da(Mn(h)),a.m=f,a.P=!0,$p(a,null)}function $p(a,h){a.F=Date.now(),Aa(a),a.A=Mn(a.v);var f=a.A,v=a.R;Array.isArray(v)||(v=[String(v)]),tm(f.i,"t",v),a.C=0,f=a.j.J,a.h=new Fp,a.g=_m(a.j,f?h:null,!a.m),0<a.O&&(a.M=new Wx(g(a.Y,a,a.g),a.O)),h=a.U,f=a.g,v=a.ca;var j="readystatechange";Array.isArray(j)||(j&&(kp[0]=j.toString()),j=kp);for(var L=0;L<j.length;L++){var W=pe(f,j[L],v||h.handleEvent,!1,h.h||h);if(!W)break;h.g[W.key]=W}h=a.H?y(a.H):{},a.m?(a.u||(a.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,h)):(a.u="GET",a.g.ea(a.A,a.u,null,h)),Li(),Gx(a.i,a.u,a.A,a.l,a.R,a.m)}lr.prototype.ca=function(a){a=a.target;const h=this.M;h&&On(a)==3?h.j():this.Y(a)},lr.prototype.Y=function(a){try{if(a==this.g)e:{const vt=On(this.g);var h=this.g.Ba();const Ds=this.g.Z();if(!(3>vt)&&(vt!=3||this.g&&(this.h.h||this.g.oa()||lm(this.g)))){this.J||vt!=4||h==7||(h==8||0>=Ds?Li(3):Li(2)),fu(this);var f=this.g.Z();this.X=f;t:if(Bp(this)){var v=lm(this.g);a="";var j=v.length,L=On(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Jr(this),Ui(this);var W="";break t}this.h.i=new l.TextDecoder}for(h=0;h<j;h++)this.h.h=!0,a+=this.h.i.decode(v[h],{stream:!(L&&h==j-1)});v.length=0,this.h.g+=a,this.C=0,W=this.h.g}else W=this.g.oa();if(this.o=f==200,Kx(this.i,this.u,this.A,this.l,this.R,vt,f),this.o){if(this.T&&!this.K){t:{if(this.g){var Se,it=this.g;if((Se=it.g?it.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!w(Se)){var we=Se;break t}}we=null}if(f=we)As(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,pu(this,f);else{this.o=!1,this.s=3,Nt(12),Jr(this),Ui(this);break e}}if(this.P){f=!0;let an;for(;!this.J&&this.C<W.length;)if(an=Jx(this,W),an==du){vt==4&&(this.s=4,Nt(14),f=!1),As(this.i,this.l,null,"[Incomplete Response]");break}else if(an==Up){this.s=4,Nt(15),As(this.i,this.l,W,"[Invalid Chunk]"),f=!1;break}else As(this.i,this.l,an,null),pu(this,an);if(Bp(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),vt!=4||W.length!=0||this.h.h||(this.s=1,Nt(16),f=!1),this.o=this.o&&f,!f)As(this.i,this.l,W,"[Invalid Chunked Response]"),Jr(this),Ui(this);else if(0<W.length&&!this.W){this.W=!0;var yt=this.j;yt.g==this&&yt.ba&&!yt.M&&(yt.j.info("Great, no buffering proxy detected. Bytes received: "+W.length),wu(yt),yt.M=!0,Nt(11))}}else As(this.i,this.l,W,null),pu(this,W);vt==4&&Jr(this),this.o&&!this.J&&(vt==4?mm(this.j,this):(this.o=!1,Aa(this)))}else pE(this.g),f==400&&0<W.indexOf("Unknown SID")?(this.s=3,Nt(12)):(this.s=0,Nt(13)),Jr(this),Ui(this)}}}catch{}finally{}};function Bp(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function Jx(a,h){var f=a.C,v=h.indexOf(`
`,f);return v==-1?du:(f=Number(h.substring(f,v)),isNaN(f)?Up:(v+=1,v+f>h.length?du:(h=h.slice(v,v+f),a.C=v+f,h)))}lr.prototype.cancel=function(){this.J=!0,Jr(this)};function Aa(a){a.S=Date.now()+a.I,zp(a,a.I)}function zp(a,h){if(a.B!=null)throw Error("WatchDog timer not null");a.B=Vi(g(a.ba,a),h)}function fu(a){a.B&&(l.clearTimeout(a.B),a.B=null)}lr.prototype.ba=function(){this.B=null;const a=Date.now();0<=a-this.S?(Qx(this.i,this.A),this.L!=2&&(Li(),Nt(17)),Jr(this),this.s=2,Ui(this)):zp(this,this.S-a)};function Ui(a){a.j.G==0||a.J||mm(a.j,a)}function Jr(a){fu(a);var h=a.M;h&&typeof h.ma=="function"&&h.ma(),a.M=null,Ap(a.U),a.g&&(h=a.g,a.g=null,h.abort(),h.ma())}function pu(a,h){try{var f=a.j;if(f.G!=0&&(f.g==a||mu(f.h,a))){if(!a.K&&mu(f.h,a)&&f.G==3){try{var v=f.Da.g.parse(h)}catch{v=null}if(Array.isArray(v)&&v.length==3){var j=v;if(j[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<a.F)Ua(f),Va(f);else break e;_u(f),Nt(18)}}else f.za=j[1],0<f.za-f.T&&37500>j[2]&&f.F&&f.v==0&&!f.C&&(f.C=Vi(g(f.Za,f),6e3));if(1>=qp(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else Zr(f,11)}else if((a.K||f.g==a)&&Ua(f),!w(h))for(j=f.Da.g.parse(h),h=0;h<j.length;h++){let we=j[h];if(f.T=we[0],we=we[1],f.G==2)if(we[0]=="c"){f.K=we[1],f.ia=we[2];const yt=we[3];yt!=null&&(f.la=yt,f.j.info("VER="+f.la));const vt=we[4];vt!=null&&(f.Aa=vt,f.j.info("SVER="+f.Aa));const Ds=we[5];Ds!=null&&typeof Ds=="number"&&0<Ds&&(v=1.5*Ds,f.L=v,f.j.info("backChannelRequestTimeoutMs_="+v)),v=f;const an=a.g;if(an){const Ba=an.g?an.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ba){var L=v.h;L.g||Ba.indexOf("spdy")==-1&&Ba.indexOf("quic")==-1&&Ba.indexOf("h2")==-1||(L.j=L.l,L.g=new Set,L.h&&(gu(L,L.h),L.h=null))}if(v.D){const xu=an.g?an.g.getResponseHeader("X-HTTP-Session-Id"):null;xu&&(v.ya=xu,Ne(v.I,v.D,xu))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-a.F,f.j.info("Handshake RTT: "+f.R+"ms")),v=f;var W=a;if(v.qa=vm(v,v.J?v.ia:null,v.W),W.K){Gp(v.h,W);var Se=W,it=v.L;it&&(Se.I=it),Se.B&&(fu(Se),Aa(Se)),v.g=W}else fm(v);0<f.i.length&&Fa(f)}else we[0]!="stop"&&we[0]!="close"||Zr(f,7);else f.G==3&&(we[0]=="stop"||we[0]=="close"?we[0]=="stop"?Zr(f,7):vu(f):we[0]!="noop"&&f.l&&f.l.ta(we),f.v=0)}}Li(4)}catch{}}var Xx=class{constructor(a,h){this.g=a,this.map=h}};function Wp(a){this.l=a||10,l.PerformanceNavigationTiming?(a=l.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Hp(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function qp(a){return a.h?1:a.g?a.g.size:0}function mu(a,h){return a.h?a.h==h:a.g?a.g.has(h):!1}function gu(a,h){a.g?a.g.add(h):a.h=h}function Gp(a,h){a.h&&a.h==h?a.h=null:a.g&&a.g.has(h)&&a.g.delete(h)}Wp.prototype.cancel=function(){if(this.i=Kp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const a of this.g.values())a.cancel();this.g.clear()}};function Kp(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let h=a.i;for(const f of a.g.values())h=h.concat(f.D);return h}return k(a.i)}function Zx(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(c(a)){for(var h=[],f=a.length,v=0;v<f;v++)h.push(a[v]);return h}h=[],f=0;for(v in a)h[f++]=a[v];return h}function eE(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(c(a)||typeof a=="string"){var h=[];a=a.length;for(var f=0;f<a;f++)h.push(f);return h}h=[],f=0;for(const v in a)h[f++]=v;return h}}}function Qp(a,h){if(a.forEach&&typeof a.forEach=="function")a.forEach(h,void 0);else if(c(a)||typeof a=="string")Array.prototype.forEach.call(a,h,void 0);else for(var f=eE(a),v=Zx(a),j=v.length,L=0;L<j;L++)h.call(void 0,v[L],f&&f[L],a)}var Yp=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tE(a,h){if(a){a=a.split("&");for(var f=0;f<a.length;f++){var v=a[f].indexOf("="),j=null;if(0<=v){var L=a[f].substring(0,v);j=a[f].substring(v+1)}else L=a[f];h(L,j?decodeURIComponent(j.replace(/\+/g," ")):"")}}}function Xr(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof Xr){this.h=a.h,Ra(this,a.j),this.o=a.o,this.g=a.g,ja(this,a.s),this.l=a.l;var h=a.i,f=new zi;f.i=h.i,h.g&&(f.g=new Map(h.g),f.h=h.h),Jp(this,f),this.m=a.m}else a&&(h=String(a).match(Yp))?(this.h=!1,Ra(this,h[1]||"",!0),this.o=$i(h[2]||""),this.g=$i(h[3]||"",!0),ja(this,h[4]),this.l=$i(h[5]||"",!0),Jp(this,h[6]||"",!0),this.m=$i(h[7]||"")):(this.h=!1,this.i=new zi(null,this.h))}Xr.prototype.toString=function(){var a=[],h=this.j;h&&a.push(Bi(h,Xp,!0),":");var f=this.g;return(f||h=="file")&&(a.push("//"),(h=this.o)&&a.push(Bi(h,Xp,!0),"@"),a.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&a.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&a.push("/"),a.push(Bi(f,f.charAt(0)=="/"?sE:rE,!0))),(f=this.i.toString())&&a.push("?",f),(f=this.m)&&a.push("#",Bi(f,oE)),a.join("")};function Mn(a){return new Xr(a)}function Ra(a,h,f){a.j=f?$i(h,!0):h,a.j&&(a.j=a.j.replace(/:$/,""))}function ja(a,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);a.s=h}else a.s=null}function Jp(a,h,f){h instanceof zi?(a.i=h,aE(a.i,a.h)):(f||(h=Bi(h,iE)),a.i=new zi(h,a.h))}function Ne(a,h,f){a.i.set(h,f)}function Da(a){return Ne(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function $i(a,h){return a?h?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Bi(a,h,f){return typeof a=="string"?(a=encodeURI(a).replace(h,nE),f&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function nE(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Xp=/[#\/\?@]/g,rE=/[#\?:]/g,sE=/[#\?]/g,iE=/[#\?@]/g,oE=/#/g;function zi(a,h){this.h=this.g=null,this.i=a||null,this.j=!!h}function cr(a){a.g||(a.g=new Map,a.h=0,a.i&&tE(a.i,function(h,f){a.add(decodeURIComponent(h.replace(/\+/g," ")),f)}))}t=zi.prototype,t.add=function(a,h){cr(this),this.i=null,a=Rs(this,a);var f=this.g.get(a);return f||this.g.set(a,f=[]),f.push(h),this.h+=1,this};function Zp(a,h){cr(a),h=Rs(a,h),a.g.has(h)&&(a.i=null,a.h-=a.g.get(h).length,a.g.delete(h))}function em(a,h){return cr(a),h=Rs(a,h),a.g.has(h)}t.forEach=function(a,h){cr(this),this.g.forEach(function(f,v){f.forEach(function(j){a.call(h,j,v,this)},this)},this)},t.na=function(){cr(this);const a=Array.from(this.g.values()),h=Array.from(this.g.keys()),f=[];for(let v=0;v<h.length;v++){const j=a[v];for(let L=0;L<j.length;L++)f.push(h[v])}return f},t.V=function(a){cr(this);let h=[];if(typeof a=="string")em(this,a)&&(h=h.concat(this.g.get(Rs(this,a))));else{a=Array.from(this.g.values());for(let f=0;f<a.length;f++)h=h.concat(a[f])}return h},t.set=function(a,h){return cr(this),this.i=null,a=Rs(this,a),em(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[h]),this.h+=1,this},t.get=function(a,h){return a?(a=this.V(a),0<a.length?String(a[0]):h):h};function tm(a,h,f){Zp(a,h),0<f.length&&(a.i=null,a.g.set(Rs(a,h),k(f)),a.h+=f.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],h=Array.from(this.g.keys());for(var f=0;f<h.length;f++){var v=h[f];const L=encodeURIComponent(String(v)),W=this.V(v);for(v=0;v<W.length;v++){var j=L;W[v]!==""&&(j+="="+encodeURIComponent(String(W[v]))),a.push(j)}}return this.i=a.join("&")};function Rs(a,h){return h=String(h),a.j&&(h=h.toLowerCase()),h}function aE(a,h){h&&!a.j&&(cr(a),a.i=null,a.g.forEach(function(f,v){var j=v.toLowerCase();v!=j&&(Zp(this,v),tm(this,j,f))},a)),a.j=h}function lE(a,h){const f=new Fi;if(l.Image){const v=new Image;v.onload=S(ur,f,"TestLoadImage: loaded",!0,h,v),v.onerror=S(ur,f,"TestLoadImage: error",!1,h,v),v.onabort=S(ur,f,"TestLoadImage: abort",!1,h,v),v.ontimeout=S(ur,f,"TestLoadImage: timeout",!1,h,v),l.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=a}else h(!1)}function cE(a,h){const f=new Fi,v=new AbortController,j=setTimeout(()=>{v.abort(),ur(f,"TestPingServer: timeout",!1,h)},1e4);fetch(a,{signal:v.signal}).then(L=>{clearTimeout(j),L.ok?ur(f,"TestPingServer: ok",!0,h):ur(f,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(j),ur(f,"TestPingServer: error",!1,h)})}function ur(a,h,f,v,j){try{j&&(j.onload=null,j.onerror=null,j.onabort=null,j.ontimeout=null),v(f)}catch{}}function uE(){this.g=new qx}function dE(a,h,f){const v=f||"";try{Qp(a,function(j,L){let W=j;d(j)&&(W=ou(j)),h.push(v+L+"="+encodeURIComponent(W))})}catch(j){throw h.push(v+"type="+encodeURIComponent("_badmap")),j}}function Ma(a){this.l=a.Ub||null,this.j=a.eb||!1}C(Ma,au),Ma.prototype.g=function(){return new Oa(this.l,this.j)},Ma.prototype.i=function(a){return function(){return a}}({});function Oa(a,h){gt.call(this),this.D=a,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(Oa,gt),t=Oa.prototype,t.open=function(a,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=h,this.readyState=1,Hi(this)},t.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(h.body=a),(this.D||l).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Wi(this)),this.readyState=0},t.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,Hi(this)),this.g&&(this.readyState=3,Hi(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;nm(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function nm(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}t.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var h=a.value?a.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!a.done}))&&(this.response=this.responseText+=h)}a.done?Wi(this):Hi(this),this.readyState==3&&nm(this)}},t.Ra=function(a){this.g&&(this.response=this.responseText=a,Wi(this))},t.Qa=function(a){this.g&&(this.response=a,Wi(this))},t.ga=function(){this.g&&Wi(this)};function Wi(a){a.readyState=4,a.l=null,a.j=null,a.v=null,Hi(a)}t.setRequestHeader=function(a,h){this.u.append(a,h)},t.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],h=this.h.entries();for(var f=h.next();!f.done;)f=f.value,a.push(f[0]+": "+f[1]),f=h.next();return a.join(`\r
`)};function Hi(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Oa.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function rm(a){let h="";return V(a,function(f,v){h+=v,h+=":",h+=f,h+=`\r
`}),h}function yu(a,h,f){e:{for(v in f){var v=!1;break e}v=!0}v||(f=rm(f),typeof a=="string"?f!=null&&encodeURIComponent(String(f)):Ne(a,h,f))}function Ue(a){gt.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(Ue,gt);var hE=/^https?$/i,fE=["POST","PUT"];t=Ue.prototype,t.Ha=function(a){this.J=a},t.ea=function(a,h,f,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);h=h?h.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():uu.g(),this.v=this.o?Rp(this.o):Rp(uu),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(h,String(a),!0),this.B=!1}catch(L){sm(this,L);return}if(a=f||"",f=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var j in v)f.set(j,v[j]);else if(typeof v.keys=="function"&&typeof v.get=="function")for(const L of v.keys())f.set(L,v.get(L));else throw Error("Unknown input type for opt_headers: "+String(v));v=Array.from(f.keys()).find(L=>L.toLowerCase()=="content-type"),j=l.FormData&&a instanceof l.FormData,!(0<=Array.prototype.indexOf.call(fE,h,void 0))||v||j||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[L,W]of f)this.g.setRequestHeader(L,W);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{am(this),this.u=!0,this.g.send(a),this.u=!1}catch(L){sm(this,L)}};function sm(a,h){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=h,a.m=5,im(a),La(a)}function im(a){a.A||(a.A=!0,Pt(a,"complete"),Pt(a,"error"))}t.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,Pt(this,"complete"),Pt(this,"abort"),La(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),La(this,!0)),Ue.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?om(this):this.bb())},t.bb=function(){om(this)};function om(a){if(a.h&&typeof o<"u"&&(!a.v[1]||On(a)!=4||a.Z()!=2)){if(a.u&&On(a)==4)Pp(a.Ea,0,a);else if(Pt(a,"readystatechange"),On(a)==4){a.h=!1;try{const W=a.Z();e:switch(W){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var f;if(!(f=h)){var v;if(v=W===0){var j=String(a.D).match(Yp)[1]||null;!j&&l.self&&l.self.location&&(j=l.self.location.protocol.slice(0,-1)),v=!hE.test(j?j.toLowerCase():"")}f=v}if(f)Pt(a,"complete"),Pt(a,"success");else{a.m=6;try{var L=2<On(a)?a.g.statusText:""}catch{L=""}a.l=L+" ["+a.Z()+"]",im(a)}}finally{La(a)}}}}function La(a,h){if(a.g){am(a);const f=a.g,v=a.v[0]?()=>{}:null;a.g=null,a.v=null,h||Pt(a,"ready");try{f.onreadystatechange=v}catch{}}}function am(a){a.I&&(l.clearTimeout(a.I),a.I=null)}t.isActive=function(){return!!this.g};function On(a){return a.g?a.g.readyState:0}t.Z=function(){try{return 2<On(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(a){if(this.g){var h=this.g.responseText;return a&&h.indexOf(a)==0&&(h=h.substring(a.length)),Hx(h)}};function lm(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function pE(a){const h={};a=(a.g&&2<=On(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let v=0;v<a.length;v++){if(w(a[v]))continue;var f=P(a[v]);const j=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();const L=h[j]||[];h[j]=L,L.push(f)}_(h,function(v){return v.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function qi(a,h,f){return f&&f.internalChannelParams&&f.internalChannelParams[a]||h}function cm(a){this.Aa=0,this.i=[],this.j=new Fi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=qi("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=qi("baseRetryDelayMs",5e3,a),this.cb=qi("retryDelaySeedMs",1e4,a),this.Wa=qi("forwardChannelMaxRetries",2,a),this.wa=qi("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new Wp(a&&a.concurrentRequestLimit),this.Da=new uE,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=cm.prototype,t.la=8,t.G=1,t.connect=function(a,h,f,v){Nt(0),this.W=a,this.H=h||{},f&&v!==void 0&&(this.H.OSID=f,this.H.OAID=v),this.F=this.X,this.I=vm(this,null,this.W),Fa(this)};function vu(a){if(um(a),a.G==3){var h=a.U++,f=Mn(a.I);if(Ne(f,"SID",a.K),Ne(f,"RID",h),Ne(f,"TYPE","terminate"),Gi(a,f),h=new lr(a,a.j,h),h.L=2,h.v=Da(Mn(f)),f=!1,l.navigator&&l.navigator.sendBeacon)try{f=l.navigator.sendBeacon(h.v.toString(),"")}catch{}!f&&l.Image&&(new Image().src=h.v,f=!0),f||(h.g=_m(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Aa(h)}ym(a)}function Va(a){a.g&&(wu(a),a.g.cancel(),a.g=null)}function um(a){Va(a),a.u&&(l.clearTimeout(a.u),a.u=null),Ua(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&l.clearTimeout(a.s),a.s=null)}function Fa(a){if(!Hp(a.h)&&!a.s){a.s=!0;var h=a.Ga;Ye||A(),G||(Ye(),G=!0),te.add(h,a),a.B=0}}function mE(a,h){return qp(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=h.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=Vi(g(a.Ga,a,h),gm(a,a.B)),a.B++,!0)}t.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;const j=new lr(this,this.j,a);let L=this.o;if(this.S&&(L?(L=y(L),E(L,this.S)):L=this.S),this.m!==null||this.O||(j.H=L,L=null),this.P)e:{for(var h=0,f=0;f<this.i.length;f++){t:{var v=this.i[f];if("__data__"in v.map&&(v=v.map.__data__,typeof v=="string")){v=v.length;break t}v=void 0}if(v===void 0)break;if(h+=v,4096<h){h=f;break e}if(h===4096||f===this.i.length-1){h=f+1;break e}}h=1e3}else h=1e3;h=hm(this,j,h),f=Mn(this.I),Ne(f,"RID",a),Ne(f,"CVER",22),this.D&&Ne(f,"X-HTTP-Session-Id",this.D),Gi(this,f),L&&(this.O?h="headers="+encodeURIComponent(String(rm(L)))+"&"+h:this.m&&yu(f,this.m,L)),gu(this.h,j),this.Ua&&Ne(f,"TYPE","init"),this.P?(Ne(f,"$req",h),Ne(f,"SID","null"),j.T=!0,hu(j,f,null)):hu(j,f,h),this.G=2}}else this.G==3&&(a?dm(this,a):this.i.length==0||Hp(this.h)||dm(this))};function dm(a,h){var f;h?f=h.l:f=a.U++;const v=Mn(a.I);Ne(v,"SID",a.K),Ne(v,"RID",f),Ne(v,"AID",a.T),Gi(a,v),a.m&&a.o&&yu(v,a.m,a.o),f=new lr(a,a.j,f,a.B+1),a.m===null&&(f.H=a.o),h&&(a.i=h.D.concat(a.i)),h=hm(a,f,1e3),f.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),gu(a.h,f),hu(f,v,h)}function Gi(a,h){a.H&&V(a.H,function(f,v){Ne(h,v,f)}),a.l&&Qp({},function(f,v){Ne(h,v,f)})}function hm(a,h,f){f=Math.min(a.i.length,f);var v=a.l?g(a.l.Na,a.l,a):null;e:{var j=a.i;let L=-1;for(;;){const W=["count="+f];L==-1?0<f?(L=j[0].g,W.push("ofs="+L)):L=0:W.push("ofs="+L);let Se=!0;for(let it=0;it<f;it++){let we=j[it].g;const yt=j[it].map;if(we-=L,0>we)L=Math.max(0,j[it].g-100),Se=!1;else try{dE(yt,W,"req"+we+"_")}catch{v&&v(yt)}}if(Se){v=W.join("&");break e}}}return a=a.i.splice(0,f),h.D=a,v}function fm(a){if(!a.g&&!a.u){a.Y=1;var h=a.Fa;Ye||A(),G||(Ye(),G=!0),te.add(h,a),a.v=0}}function _u(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=Vi(g(a.Fa,a),gm(a,a.v)),a.v++,!0)}t.Fa=function(){if(this.u=null,pm(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Vi(g(this.ab,this),a)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Nt(10),Va(this),pm(this))};function wu(a){a.A!=null&&(l.clearTimeout(a.A),a.A=null)}function pm(a){a.g=new lr(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var h=Mn(a.qa);Ne(h,"RID","rpc"),Ne(h,"SID",a.K),Ne(h,"AID",a.T),Ne(h,"CI",a.F?"0":"1"),!a.F&&a.ja&&Ne(h,"TO",a.ja),Ne(h,"TYPE","xmlhttp"),Gi(a,h),a.m&&a.o&&yu(h,a.m,a.o),a.L&&(a.g.I=a.L);var f=a.g;a=a.ia,f.L=1,f.v=Da(Mn(h)),f.m=null,f.P=!0,$p(f,a)}t.Za=function(){this.C!=null&&(this.C=null,Va(this),_u(this),Nt(19))};function Ua(a){a.C!=null&&(l.clearTimeout(a.C),a.C=null)}function mm(a,h){var f=null;if(a.g==h){Ua(a),wu(a),a.g=null;var v=2}else if(mu(a.h,h))f=h.D,Gp(a.h,h),v=1;else return;if(a.G!=0){if(h.o)if(v==1){f=h.m?h.m.length:0,h=Date.now()-h.F;var j=a.B;v=Pa(),Pt(v,new Lp(v,f)),Fa(a)}else fm(a);else if(j=h.s,j==3||j==0&&0<h.X||!(v==1&&mE(a,h)||v==2&&_u(a)))switch(f&&0<f.length&&(h=a.h,h.i=h.i.concat(f)),j){case 1:Zr(a,5);break;case 4:Zr(a,10);break;case 3:Zr(a,6);break;default:Zr(a,2)}}}function gm(a,h){let f=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(f*=2),f*h}function Zr(a,h){if(a.j.info("Error code "+h),h==2){var f=g(a.fb,a),v=a.Xa;const j=!v;v=new Xr(v||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Ra(v,"https"),Da(v),j?lE(v.toString(),f):cE(v.toString(),f)}else Nt(2);a.G=0,a.l&&a.l.sa(h),ym(a),um(a)}t.fb=function(a){a?(this.j.info("Successfully pinged google.com"),Nt(2)):(this.j.info("Failed to ping google.com"),Nt(1))};function ym(a){if(a.G=0,a.ka=[],a.l){const h=Kp(a.h);(h.length!=0||a.i.length!=0)&&(R(a.ka,h),R(a.ka,a.i),a.h.i.length=0,k(a.i),a.i.length=0),a.l.ra()}}function vm(a,h,f){var v=f instanceof Xr?Mn(f):new Xr(f);if(v.g!="")h&&(v.g=h+"."+v.g),ja(v,v.s);else{var j=l.location;v=j.protocol,h=h?h+"."+j.hostname:j.hostname,j=+j.port;var L=new Xr(null);v&&Ra(L,v),h&&(L.g=h),j&&ja(L,j),f&&(L.l=f),v=L}return f=a.D,h=a.ya,f&&h&&Ne(v,f,h),Ne(v,"VER",a.la),Gi(a,v),v}function _m(a,h,f){if(h&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=a.Ca&&!a.pa?new Ue(new Ma({eb:f})):new Ue(a.pa),h.Ha(a.J),h}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function wm(){}t=wm.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function $a(){}$a.prototype.g=function(a,h){return new Bt(a,h)};function Bt(a,h){gt.call(this),this.g=new cm(h),this.l=a,this.h=h&&h.messageUrlParams||null,a=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(a?a["X-WebChannel-Content-Type"]=h.messageContentType:a={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(a?a["X-WebChannel-Client-Profile"]=h.va:a={"X-WebChannel-Client-Profile":h.va}),this.g.S=a,(a=h&&h.Sb)&&!w(a)&&(this.g.m=a),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!w(h)&&(this.g.D=h,a=this.h,a!==null&&h in a&&(a=this.h,h in a&&delete a[h])),this.j=new js(this)}C(Bt,gt),Bt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Bt.prototype.close=function(){vu(this.g)},Bt.prototype.o=function(a){var h=this.g;if(typeof a=="string"){var f={};f.__data__=a,a=f}else this.u&&(f={},f.__data__=ou(a),a=f);h.i.push(new Xx(h.Ya++,a)),h.G==3&&Fa(h)},Bt.prototype.N=function(){this.g.l=null,delete this.j,vu(this.g),delete this.g,Bt.aa.N.call(this)};function xm(a){lu.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var h=a.__sm__;if(h){e:{for(const f in h){a=f;break e}a=void 0}(this.i=a)&&(a=this.i,h=h!==null&&a in h?h[a]:void 0),this.data=h}else this.data=a}C(xm,lu);function Em(){cu.call(this),this.status=1}C(Em,cu);function js(a){this.g=a}C(js,wm),js.prototype.ua=function(){Pt(this.g,"a")},js.prototype.ta=function(a){Pt(this.g,new xm(a))},js.prototype.sa=function(a){Pt(this.g,new Em)},js.prototype.ra=function(){Pt(this.g,"b")},$a.prototype.createWebChannel=$a.prototype.g,Bt.prototype.send=Bt.prototype.o,Bt.prototype.open=Bt.prototype.m,Bt.prototype.close=Bt.prototype.close,Sw=function(){return new $a},Iw=function(){return Pa()},Tw=Yr,mh={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Na.NO_ERROR=0,Na.TIMEOUT=8,Na.HTTP_ERROR=6,Cl=Na,Vp.COMPLETE="complete",Ew=Vp,jp.EventType=Oi,Oi.OPEN="a",Oi.CLOSE="b",Oi.ERROR="c",Oi.MESSAGE="d",gt.prototype.listen=gt.prototype.K,co=jp,Ue.prototype.listenOnce=Ue.prototype.L,Ue.prototype.getLastError=Ue.prototype.Ka,Ue.prototype.getLastErrorCode=Ue.prototype.Ba,Ue.prototype.getStatus=Ue.prototype.Z,Ue.prototype.getResponseJson=Ue.prototype.Oa,Ue.prototype.getResponseText=Ue.prototype.oa,Ue.prototype.send=Ue.prototype.ea,Ue.prototype.setWithCredentials=Ue.prototype.Ha,xw=Ue}).apply(typeof al<"u"?al:typeof self<"u"?self:typeof window<"u"?window:{});const gy="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Et{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Et.UNAUTHENTICATED=new Et(null),Et.GOOGLE_CREDENTIALS=new Et("google-credentials-uid"),Et.FIRST_PARTY=new Et("first-party-uid"),Et.MOCK_USER=new Et("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ai="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _s=new Pf("@firebase/firestore");function no(){return _s.logLevel}function J(t,...e){if(_s.logLevel<=me.DEBUG){const n=e.map(Uf);_s.debug(`Firestore (${Ai}): ${t}`,...n)}}function tr(t,...e){if(_s.logLevel<=me.ERROR){const n=e.map(Uf);_s.error(`Firestore (${Ai}): ${t}`,...n)}}function vi(t,...e){if(_s.logLevel<=me.WARN){const n=e.map(Uf);_s.warn(`Firestore (${Ai}): ${t}`,...n)}}function Uf(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ie(t="Unexpected state"){const e=`FIRESTORE (${Ai}) INTERNAL ASSERTION FAILED: `+t;throw tr(e),new Error(e)}function Ie(t,e){t||ie()}function ce(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Y extends sr{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bw{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class BP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Et.UNAUTHENTICATED))}shutdown(){}}class zP{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class WP{constructor(e){this.t=e,this.currentUser=Et.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Ie(this.o===void 0);let r=this.i;const s=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve();let i=new Kn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Kn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},l=c=>{J("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(J("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Kn)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(J("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ie(typeof r.accessToken=="string"),new bw(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ie(e===null||typeof e=="string"),new Et(e)}}class HP{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=Et.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class qP{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new HP(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(Et.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class GP{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class KP{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){Ie(this.o===void 0);const r=i=>{i.error!=null&&J("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,J("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{J("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):J("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Ie(typeof n.token=="string"),this.R=n.token,new GP(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QP(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=QP(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%e.length))}return r}}function xe(t,e){return t<e?-1:t>e?1:0}function _i(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ze{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Y($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Y($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new Y($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Y($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ze.fromMillis(Date.now())}static fromDate(e){return Ze.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new Ze(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?xe(this.nanoseconds,e.nanoseconds):xe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class le{constructor(e){this.timestamp=e}static fromTimestamp(e){return new le(e)}static min(){return new le(new Ze(0,0))}static max(){return new le(new Ze(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yo{constructor(e,n,r){n===void 0?n=0:n>e.length&&ie(),r===void 0?r=e.length-n:r>e.length-n&&ie(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Yo.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Yo?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=e.get(s),o=n.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class Ae extends Yo{construct(e,n,r){return new Ae(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Y($.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new Ae(n)}static emptyPath(){return new Ae([])}}const YP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class lt extends Yo{construct(e,n,r){return new lt(e,n,r)}static isValidIdentifier(e){return YP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),lt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new lt(["__name__"])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Y($.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new Y($.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new Y($.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else l==="`"?(o=!o,s++):l!=="."||o?(r+=l,s++):(i(),s++)}if(i(),o)throw new Y($.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new lt(n)}static emptyPath(){return new lt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{constructor(e){this.path=e}static fromPath(e){return new ee(Ae.fromString(e))}static fromName(e){return new ee(Ae.fromString(e).popFirst(5))}static empty(){return new ee(Ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ae.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ee(new Ae(e.slice()))}}function JP(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=le.fromTimestamp(r===1e9?new Ze(n+1,0):new Ze(n,r));return new Ur(s,ee.empty(),e)}function XP(t){return new Ur(t.readTime,t.key,-1)}class Ur{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Ur(le.min(),ee.empty(),-1)}static max(){return new Ur(le.max(),ee.empty(),-1)}}function ZP(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=ee.comparator(t.documentKey,e.documentKey),n!==0?n:xe(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eN="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class tN{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ga(t){if(t.code!==$.FAILED_PRECONDITION||t.message!==eN)throw t;J("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ie(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new B((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof B?n:B.resolve(n)}catch(n){return B.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):B.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):B.reject(n)}static resolve(e){return new B((n,r)=>{n(e)})}static reject(e){return new B((n,r)=>{r(e)})}static waitFor(e){return new B((n,r)=>{let s=0,i=0,o=!1;e.forEach(l=>{++s,l.next(()=>{++i,o&&i===s&&n()},c=>r(c))}),o=!0,i===s&&n()})}static or(e){let n=B.resolve(!1);for(const r of e)n=n.next(s=>s?B.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new B((r,s)=>{const i=e.length,o=new Array(i);let l=0;for(let c=0;c<i;c++){const d=c;n(e[d]).next(p=>{o[d]=p,++l,l===i&&r(o)},p=>s(p))}})}static doWhile(e,n){return new B((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}function nN(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function ya(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $f{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}$f.oe=-1;function zc(t){return t==null}function hc(t){return t===0&&1/t==-1/0}function rN(t){return typeof t=="number"&&Number.isInteger(t)&&!hc(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yy(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Cs(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Pw(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fe{constructor(e,n){this.comparator=e,this.root=n||at.EMPTY}insert(e,n){return new Fe(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,at.BLACK,null,null))}remove(e){return new Fe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,at.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ll(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ll(this.root,e,this.comparator,!1)}getReverseIterator(){return new ll(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ll(this.root,e,this.comparator,!0)}}class ll{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class at{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??at.RED,this.left=s??at.EMPTY,this.right=i??at.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new at(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return at.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return at.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,at.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,at.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ie();const e=this.left.check();if(e!==this.right.check())throw ie();return e+(this.isRed()?0:1)}}at.EMPTY=null,at.RED=!0,at.BLACK=!1;at.EMPTY=new class{constructor(){this.size=0}get key(){throw ie()}get value(){throw ie()}get color(){throw ie()}get left(){throw ie()}get right(){throw ie()}copy(e,n,r,s,i){return this}insert(e,n,r){return new at(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ut{constructor(e){this.comparator=e,this.data=new Fe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new vy(this.data.getIterator())}getIteratorFrom(e){return new vy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof ut)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new ut(this.comparator);return n.data=e,n}}class vy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e){this.fields=e,e.sort(lt.comparator)}static empty(){return new Ht([])}unionWith(e){let n=new ut(lt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Ht(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return _i(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Nw("Invalid base64 string: "+i):i}}(e);return new ht(n)}static fromUint8Array(e){const n=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new ht(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return xe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ht.EMPTY_BYTE_STRING=new ht("");const sN=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function $r(t){if(Ie(!!t),typeof t=="string"){let e=0;const n=sN.exec(t);if(Ie(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Be(t.seconds),nanos:Be(t.nanos)}}function Be(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ws(t){return typeof t=="string"?ht.fromBase64String(t):ht.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bf(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function zf(t){const e=t.mapValue.fields.__previous_value__;return Bf(e)?zf(e):e}function Jo(t){const e=$r(t.mapValue.fields.__local_write_time__.timestampValue);return new Ze(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(e,n,r,s,i,o,l,c,d){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=d}}class Xo{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new Xo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Xo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cl={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function xs(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Bf(t)?4:aN(t)?9007199254740991:oN(t)?10:11:ie()}function Rn(t,e){if(t===e)return!0;const n=xs(t);if(n!==xs(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Jo(t).isEqual(Jo(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=$r(s.timestampValue),l=$r(i.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return ws(s.bytesValue).isEqual(ws(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return Be(s.geoPointValue.latitude)===Be(i.geoPointValue.latitude)&&Be(s.geoPointValue.longitude)===Be(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Be(s.integerValue)===Be(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Be(s.doubleValue),l=Be(i.doubleValue);return o===l?hc(o)===hc(l):isNaN(o)&&isNaN(l)}return!1}(t,e);case 9:return _i(t.arrayValue.values||[],e.arrayValue.values||[],Rn);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},l=i.mapValue.fields||{};if(yy(o)!==yy(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!Rn(o[c],l[c])))return!1;return!0}(t,e);default:return ie()}}function Zo(t,e){return(t.values||[]).find(n=>Rn(n,e))!==void 0}function wi(t,e){if(t===e)return 0;const n=xs(t),r=xs(e);if(n!==r)return xe(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return xe(t.booleanValue,e.booleanValue);case 2:return function(i,o){const l=Be(i.integerValue||i.doubleValue),c=Be(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(t,e);case 3:return _y(t.timestampValue,e.timestampValue);case 4:return _y(Jo(t),Jo(e));case 5:return xe(t.stringValue,e.stringValue);case 6:return function(i,o){const l=ws(i),c=ws(o);return l.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(i,o){const l=i.split("/"),c=o.split("/");for(let d=0;d<l.length&&d<c.length;d++){const p=xe(l[d],c[d]);if(p!==0)return p}return xe(l.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,o){const l=xe(Be(i.latitude),Be(o.latitude));return l!==0?l:xe(Be(i.longitude),Be(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return wy(t.arrayValue,e.arrayValue);case 10:return function(i,o){var l,c,d,p;const m=i.fields||{},g=o.fields||{},S=(l=m.value)===null||l===void 0?void 0:l.arrayValue,C=(c=g.value)===null||c===void 0?void 0:c.arrayValue,k=xe(((d=S==null?void 0:S.values)===null||d===void 0?void 0:d.length)||0,((p=C==null?void 0:C.values)===null||p===void 0?void 0:p.length)||0);return k!==0?k:wy(S,C)}(t.mapValue,e.mapValue);case 11:return function(i,o){if(i===cl.mapValue&&o===cl.mapValue)return 0;if(i===cl.mapValue)return 1;if(o===cl.mapValue)return-1;const l=i.fields||{},c=Object.keys(l),d=o.fields||{},p=Object.keys(d);c.sort(),p.sort();for(let m=0;m<c.length&&m<p.length;++m){const g=xe(c[m],p[m]);if(g!==0)return g;const S=wi(l[c[m]],d[p[m]]);if(S!==0)return S}return xe(c.length,p.length)}(t.mapValue,e.mapValue);default:throw ie()}}function _y(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return xe(t,e);const n=$r(t),r=$r(e),s=xe(n.seconds,r.seconds);return s!==0?s:xe(n.nanos,r.nanos)}function wy(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=wi(n[s],r[s]);if(i)return i}return xe(n.length,r.length)}function xi(t){return gh(t)}function gh(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=$r(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return ws(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return ee.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=gh(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${gh(n.fields[o])}`;return s+"}"}(t.mapValue):ie()}function xy(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function yh(t){return!!t&&"integerValue"in t}function Wf(t){return!!t&&"arrayValue"in t}function Ey(t){return!!t&&"nullValue"in t}function Ty(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Pl(t){return!!t&&"mapValue"in t}function oN(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function Io(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Cs(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Io(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Io(t.arrayValue.values[n]);return e}return Object.assign({},t)}function aN(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(e){this.value=e}static empty(){return new Lt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Pl(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Io(n)}setAll(e){let n=lt.emptyPath(),r={},s=[];e.forEach((o,l)=>{if(!n.isImmediateParentOf(l)){const c=this.getFieldsMap(n);this.applyChanges(c,r,s),r={},s=[],n=l.popLast()}o?r[l.lastSegment()]=Io(o):s.push(l.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());Pl(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Rn(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Pl(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Cs(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Lt(Io(this.value))}}function kw(t){const e=[];return Cs(t.fields,(n,r)=>{const s=new lt([n]);if(Pl(r)){const i=kw(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Ht(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It{constructor(e,n,r,s,i,o,l){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=l}static newInvalidDocument(e){return new It(e,0,le.min(),le.min(),le.min(),Lt.empty(),0)}static newFoundDocument(e,n,r,s){return new It(e,1,n,le.min(),r,s,0)}static newNoDocument(e,n){return new It(e,2,n,le.min(),le.min(),Lt.empty(),0)}static newUnknownDocument(e,n){return new It(e,3,n,le.min(),le.min(),Lt.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(le.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Lt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Lt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=le.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof It&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new It(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fc{constructor(e,n){this.position=e,this.inclusive=n}}function Iy(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(i.field.isKeyField()?r=ee.comparator(ee.fromName(o.referenceValue),n.key):r=wi(o,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Sy(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Rn(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(e,n="asc"){this.field=e,this.dir=n}}function lN(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{}class qe extends Aw{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new uN(e,n,r):n==="array-contains"?new fN(e,r):n==="in"?new pN(e,r):n==="not-in"?new mN(e,r):n==="array-contains-any"?new gN(e,r):new qe(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new dN(e,r):new hN(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(wi(n,this.value)):n!==null&&xs(this.value)===xs(n)&&this.matchesComparison(wi(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ie()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class yn extends Aw{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new yn(e,n)}matches(e){return Rw(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Rw(t){return t.op==="and"}function jw(t){return cN(t)&&Rw(t)}function cN(t){for(const e of t.filters)if(e instanceof yn)return!1;return!0}function vh(t){if(t instanceof qe)return t.field.canonicalString()+t.op.toString()+xi(t.value);if(jw(t))return t.filters.map(e=>vh(e)).join(",");{const e=t.filters.map(n=>vh(n)).join(",");return`${t.op}(${e})`}}function Dw(t,e){return t instanceof qe?function(r,s){return s instanceof qe&&r.op===s.op&&r.field.isEqual(s.field)&&Rn(r.value,s.value)}(t,e):t instanceof yn?function(r,s){return s instanceof yn&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,l)=>i&&Dw(o,s.filters[l]),!0):!1}(t,e):void ie()}function Mw(t){return t instanceof qe?function(n){return`${n.field.canonicalString()} ${n.op} ${xi(n.value)}`}(t):t instanceof yn?function(n){return n.op.toString()+" {"+n.getFilters().map(Mw).join(" ,")+"}"}(t):"Filter"}class uN extends qe{constructor(e,n,r){super(e,n,r),this.key=ee.fromName(r.referenceValue)}matches(e){const n=ee.comparator(e.key,this.key);return this.matchesComparison(n)}}class dN extends qe{constructor(e,n){super(e,"in",n),this.keys=Ow("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class hN extends qe{constructor(e,n){super(e,"not-in",n),this.keys=Ow("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function Ow(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>ee.fromName(r.referenceValue))}class fN extends qe{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Wf(n)&&Zo(n.arrayValue,this.value)}}class pN extends qe{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Zo(this.value.arrayValue,n)}}class mN extends qe{constructor(e,n){super(e,"not-in",n)}matches(e){if(Zo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!Zo(this.value.arrayValue,n)}}class gN extends qe{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Wf(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Zo(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN{constructor(e,n=null,r=[],s=[],i=null,o=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=l,this.ue=null}}function by(t,e=null,n=[],r=[],s=null,i=null,o=null){return new yN(t,e,n,r,s,i,o)}function Hf(t){const e=ce(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>vh(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),zc(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>xi(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>xi(r)).join(",")),e.ue=n}return e.ue}function qf(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!lN(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Dw(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Sy(t.startAt,e.startAt)&&Sy(t.endAt,e.endAt)}function _h(t){return ee.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(e,n=null,r=[],s=[],i=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=l,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function vN(t,e,n,r,s,i,o,l){return new va(t,e,n,r,s,i,o,l)}function Wc(t){return new va(t)}function Cy(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Lw(t){return t.collectionGroup!==null}function So(t){const e=ce(t);if(e.ce===null){e.ce=[];const n=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new ut(lt.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.ce.push(new pc(i,r))}),n.has(lt.keyField().canonicalString())||e.ce.push(new pc(lt.keyField(),r))}return e.ce}function kn(t){const e=ce(t);return e.le||(e.le=_N(e,So(t))),e.le}function _N(t,e){if(t.limitType==="F")return by(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new pc(s.field,i)});const n=t.endAt?new fc(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new fc(t.startAt.position,t.startAt.inclusive):null;return by(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function wh(t,e){const n=t.filters.concat([e]);return new va(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function xh(t,e,n){return new va(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Hc(t,e){return qf(kn(t),kn(e))&&t.limitType===e.limitType}function Vw(t){return`${Hf(kn(t))}|lt:${t.limitType}`}function Vs(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>Mw(s)).join(", ")}]`),zc(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>xi(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>xi(s)).join(",")),`Target(${r})`}(kn(t))}; limitType=${t.limitType})`}function qc(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ee.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of So(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(o,l,c){const d=Iy(o,l,c);return o.inclusive?d<=0:d<0}(r.startAt,So(r),s)||r.endAt&&!function(o,l,c){const d=Iy(o,l,c);return o.inclusive?d>=0:d>0}(r.endAt,So(r),s))}(t,e)}function wN(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Fw(t){return(e,n)=>{let r=!1;for(const s of So(t)){const i=xN(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function xN(t,e,n){const r=t.field.isKeyField()?ee.comparator(e.key,n.key):function(i,o,l){const c=o.data.field(i),d=l.data.field(i);return c!==null&&d!==null?wi(c,d):ie()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ie()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Cs(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Pw(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EN=new Fe(ee.comparator);function nr(){return EN}const Uw=new Fe(ee.comparator);function uo(...t){let e=Uw;for(const n of t)e=e.insert(n.key,n);return e}function $w(t){let e=Uw;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function as(){return bo()}function Bw(){return bo()}function bo(){return new Ri(t=>t.toString(),(t,e)=>t.isEqual(e))}const TN=new Fe(ee.comparator),IN=new ut(ee.comparator);function fe(...t){let e=IN;for(const n of t)e=e.add(n);return e}const SN=new ut(xe);function bN(){return SN}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gf(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:hc(e)?"-0":e}}function zw(t){return{integerValue:""+t}}function CN(t,e){return rN(e)?zw(e):Gf(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(){this._=void 0}}function PN(t,e,n){return t instanceof ea?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Bf(i)&&(i=zf(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(n,e):t instanceof ta?Hw(t,e):t instanceof na?qw(t,e):function(s,i){const o=Ww(s,i),l=Py(o)+Py(s.Pe);return yh(o)&&yh(s.Pe)?zw(l):Gf(s.serializer,l)}(t,e)}function NN(t,e,n){return t instanceof ta?Hw(t,e):t instanceof na?qw(t,e):n}function Ww(t,e){return t instanceof mc?function(r){return yh(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class ea extends Gc{}class ta extends Gc{constructor(e){super(),this.elements=e}}function Hw(t,e){const n=Gw(e);for(const r of t.elements)n.some(s=>Rn(s,r))||n.push(r);return{arrayValue:{values:n}}}class na extends Gc{constructor(e){super(),this.elements=e}}function qw(t,e){let n=Gw(e);for(const r of t.elements)n=n.filter(s=>!Rn(s,r));return{arrayValue:{values:n}}}class mc extends Gc{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function Py(t){return Be(t.integerValue||t.doubleValue)}function Gw(t){return Wf(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kN{constructor(e,n){this.field=e,this.transform=n}}function AN(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof ta&&s instanceof ta||r instanceof na&&s instanceof na?_i(r.elements,s.elements,Rn):r instanceof mc&&s instanceof mc?Rn(r.Pe,s.Pe):r instanceof ea&&s instanceof ea}(t.transform,e.transform)}class RN{constructor(e,n){this.version=e,this.transformResults=n}}class pn{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new pn}static exists(e){return new pn(void 0,e)}static updateTime(e){return new pn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Nl(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Kc{}function Kw(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Kf(t.key,pn.none()):new _a(t.key,t.data,pn.none());{const n=t.data,r=Lt.empty();let s=new ut(lt.comparator);for(let i of e.fields)if(!s.has(i)){let o=n.field(i);o===null&&i.length>1&&(i=i.popLast(),o=n.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Kr(t.key,r,new Ht(s.toArray()),pn.none())}}function jN(t,e,n){t instanceof _a?function(s,i,o){const l=s.value.clone(),c=ky(s.fieldTransforms,i,o.transformResults);l.setAll(c),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):t instanceof Kr?function(s,i,o){if(!Nl(s.precondition,i))return void i.convertToUnknownDocument(o.version);const l=ky(s.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(Qw(s)),c.setAll(l),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(t,e,n):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function Co(t,e,n,r){return t instanceof _a?function(i,o,l,c){if(!Nl(i.precondition,o))return l;const d=i.value.clone(),p=Ay(i.fieldTransforms,c,o);return d.setAll(p),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof Kr?function(i,o,l,c){if(!Nl(i.precondition,o))return l;const d=Ay(i.fieldTransforms,c,o),p=o.data;return p.setAll(Qw(i)),p.setAll(d),o.convertToFoundDocument(o.version,p).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(m=>m.field))}(t,e,n,r):function(i,o,l){return Nl(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(t,e,n)}function DN(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=Ww(r.transform,s||null);i!=null&&(n===null&&(n=Lt.empty()),n.set(r.field,i))}return n||null}function Ny(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&_i(r,s,(i,o)=>AN(i,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class _a extends Kc{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Kr extends Kc{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Qw(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function ky(t,e,n){const r=new Map;Ie(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,l=e.data.field(i.field);r.set(i.field,NN(o,l,n[s]))}return r}function Ay(t,e,n){const r=new Map;for(const s of t){const i=s.transform,o=n.data.field(s.field);r.set(s.field,PN(i,o,e))}return r}class Kf extends Kc{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class MN extends Kc{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ON{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&jN(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Co(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Co(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=Bw();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let l=this.applyToLocalView(o,i.mutatedFields);l=n.has(s.key)?null:l;const c=Kw(o,l);c!==null&&r.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(le.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),fe())}isEqual(e){return this.batchId===e.batchId&&_i(this.mutations,e.mutations,(n,r)=>Ny(n,r))&&_i(this.baseMutations,e.baseMutations,(n,r)=>Ny(n,r))}}class Qf{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Ie(e.mutations.length===r.length);let s=function(){return TN}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Qf(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VN{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var We,ge;function FN(t){switch(t){default:return ie();case $.CANCELLED:case $.UNKNOWN:case $.DEADLINE_EXCEEDED:case $.RESOURCE_EXHAUSTED:case $.INTERNAL:case $.UNAVAILABLE:case $.UNAUTHENTICATED:return!1;case $.INVALID_ARGUMENT:case $.NOT_FOUND:case $.ALREADY_EXISTS:case $.PERMISSION_DENIED:case $.FAILED_PRECONDITION:case $.ABORTED:case $.OUT_OF_RANGE:case $.UNIMPLEMENTED:case $.DATA_LOSS:return!0}}function Yw(t){if(t===void 0)return tr("GRPC error has no .code"),$.UNKNOWN;switch(t){case We.OK:return $.OK;case We.CANCELLED:return $.CANCELLED;case We.UNKNOWN:return $.UNKNOWN;case We.DEADLINE_EXCEEDED:return $.DEADLINE_EXCEEDED;case We.RESOURCE_EXHAUSTED:return $.RESOURCE_EXHAUSTED;case We.INTERNAL:return $.INTERNAL;case We.UNAVAILABLE:return $.UNAVAILABLE;case We.UNAUTHENTICATED:return $.UNAUTHENTICATED;case We.INVALID_ARGUMENT:return $.INVALID_ARGUMENT;case We.NOT_FOUND:return $.NOT_FOUND;case We.ALREADY_EXISTS:return $.ALREADY_EXISTS;case We.PERMISSION_DENIED:return $.PERMISSION_DENIED;case We.FAILED_PRECONDITION:return $.FAILED_PRECONDITION;case We.ABORTED:return $.ABORTED;case We.OUT_OF_RANGE:return $.OUT_OF_RANGE;case We.UNIMPLEMENTED:return $.UNIMPLEMENTED;case We.DATA_LOSS:return $.DATA_LOSS;default:return ie()}}(ge=We||(We={}))[ge.OK=0]="OK",ge[ge.CANCELLED=1]="CANCELLED",ge[ge.UNKNOWN=2]="UNKNOWN",ge[ge.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ge[ge.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ge[ge.NOT_FOUND=5]="NOT_FOUND",ge[ge.ALREADY_EXISTS=6]="ALREADY_EXISTS",ge[ge.PERMISSION_DENIED=7]="PERMISSION_DENIED",ge[ge.UNAUTHENTICATED=16]="UNAUTHENTICATED",ge[ge.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ge[ge.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ge[ge.ABORTED=10]="ABORTED",ge[ge.OUT_OF_RANGE=11]="OUT_OF_RANGE",ge[ge.UNIMPLEMENTED=12]="UNIMPLEMENTED",ge[ge.INTERNAL=13]="INTERNAL",ge[ge.UNAVAILABLE=14]="UNAVAILABLE",ge[ge.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UN(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $N=new us([4294967295,4294967295],0);function Ry(t){const e=UN().encode(t),n=new ww;return n.update(e),new Uint8Array(n.digest())}function jy(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new us([n,r],0),new us([s,i],0)]}class Yf{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new ho(`Invalid padding: ${n}`);if(r<0)throw new ho(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ho(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new ho(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=us.fromNumber(this.Ie)}Ee(e,n,r){let s=e.add(n.multiply(us.fromNumber(r)));return s.compare($N)===1&&(s=new us([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const n=Ry(e),[r,s]=jy(n);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Yf(i,s,n);return r.forEach(l=>o.insert(l)),o}insert(e){if(this.Ie===0)return;const n=Ry(e),[r,s]=jy(n);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class ho extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,wa.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new Qc(le.min(),s,new Fe(xe),nr(),fe())}}class wa{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new wa(r,n,fe(),fe(),fe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl{constructor(e,n,r,s){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=s}}class Jw{constructor(e,n){this.targetId=e,this.me=n}}class Xw{constructor(e,n,r=ht.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class Dy{constructor(){this.fe=0,this.ge=Oy(),this.pe=ht.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=fe(),n=fe(),r=fe();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:ie()}}),new wa(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=Oy()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ie(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class BN{constructor(e){this.Le=e,this.Be=new Map,this.ke=nr(),this.qe=My(),this.Qe=new Fe(xe)}Ke(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{const r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:ie()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,s)=>{this.ze(s)&&n(s)})}He(e){const n=e.targetId,r=e.me.count,s=this.Je(n);if(s){const i=s.target;if(_h(i))if(r===0){const o=new ee(i.path);this.Ue(n,o,It.newNoDocument(o,le.min()))}else Ie(r===1);else{const o=this.Ye(n);if(o!==r){const l=this.Ze(e),c=l?this.Xe(l,e,o):1;if(c!==0){this.je(n);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,d)}}}}}Ze(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let o,l;try{o=ws(r).toUint8Array()}catch(c){if(c instanceof Nw)return vi("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new Yf(o,s,i)}catch(c){return vi(c instanceof ho?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.Ie===0?null:l}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const o=this.Le.tt(),l=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.Ue(n,i,null),s++)}),s}rt(e){const n=new Map;this.Be.forEach((i,o)=>{const l=this.Je(o);if(l){if(i.current&&_h(l.target)){const c=new ee(l.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,It.newNoDocument(c,e))}i.be&&(n.set(o,i.ve()),i.Ce())}});let r=fe();this.qe.forEach((i,o)=>{let l=!0;o.forEachWhile(c=>{const d=this.Je(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Qc(e,n,this.Qe,this.ke,r);return this.ke=nr(),this.qe=My(),this.Qe=new Fe(xe),s}$e(e,n){if(!this.ze(e))return;const r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,n)?s.Fe(n,1):s.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const n=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new Dy,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new ut(xe),this.qe=this.qe.insert(e,n)),n}ze(e){const n=this.Je(e)!==null;return n||J("WatchChangeAggregator","Detected inactive target",e),n}Je(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Dy),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function My(){return new Fe(ee.comparator)}function Oy(){return new Fe(ee.comparator)}const zN=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),WN=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),HN=(()=>({and:"AND",or:"OR"}))();class qN{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Eh(t,e){return t.useProto3Json||zc(e)?e:{value:e}}function gc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Zw(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function GN(t,e){return gc(t,e.toTimestamp())}function An(t){return Ie(!!t),le.fromTimestamp(function(n){const r=$r(n);return new Ze(r.seconds,r.nanos)}(t))}function Jf(t,e){return Th(t,e).canonicalString()}function Th(t,e){const n=function(s){return new Ae(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function ex(t){const e=Ae.fromString(t);return Ie(ix(e)),e}function Ih(t,e){return Jf(t.databaseId,e.path)}function nd(t,e){const n=ex(e);if(n.get(1)!==t.databaseId.projectId)throw new Y($.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Y($.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ee(nx(n))}function tx(t,e){return Jf(t.databaseId,e)}function KN(t){const e=ex(t);return e.length===4?Ae.emptyPath():nx(e)}function Sh(t){return new Ae(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function nx(t){return Ie(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Ly(t,e,n){return{name:Ih(t,e),fields:n.value.mapValue.fields}}function QN(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:ie()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,p){return d.useProto3Json?(Ie(p===void 0||typeof p=="string"),ht.fromBase64String(p||"")):(Ie(p===void 0||p instanceof Buffer||p instanceof Uint8Array),ht.fromUint8Array(p||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(d){const p=d.code===void 0?$.UNKNOWN:Yw(d.code);return new Y(p,d.message||"")}(o);n=new Xw(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=nd(t,r.document.name),i=An(r.document.updateTime),o=r.document.createTime?An(r.document.createTime):le.min(),l=new Lt({mapValue:{fields:r.document.fields}}),c=It.newFoundDocument(s,i,o,l),d=r.targetIds||[],p=r.removedTargetIds||[];n=new kl(d,p,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=nd(t,r.document),i=r.readTime?An(r.readTime):le.min(),o=It.newNoDocument(s,i),l=r.removedTargetIds||[];n=new kl([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=nd(t,r.document),i=r.removedTargetIds||[];n=new kl([],i,s,null)}else{if(!("filter"in e))return ie();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new VN(s,i),l=r.targetId;n=new Jw(l,o)}}return n}function YN(t,e){let n;if(e instanceof _a)n={update:Ly(t,e.key,e.value)};else if(e instanceof Kf)n={delete:Ih(t,e.key)};else if(e instanceof Kr)n={update:Ly(t,e.key,e.data),updateMask:ik(e.fieldMask)};else{if(!(e instanceof MN))return ie();n={verify:Ih(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const l=o.transform;if(l instanceof ea)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof ta)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof na)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof mc)return{fieldPath:o.field.canonicalString(),increment:l.Pe};throw ie()}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:GN(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ie()}(t,e.precondition)),n}function JN(t,e){return t&&t.length>0?(Ie(e!==void 0),t.map(n=>function(s,i){let o=s.updateTime?An(s.updateTime):An(i);return o.isEqual(le.min())&&(o=An(i)),new RN(o,s.transformResults||[])}(n,e))):[]}function XN(t,e){return{documents:[tx(t,e.path)]}}function ZN(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=tx(t,s);const i=function(d){if(d.length!==0)return sx(yn.create(d,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(d){if(d.length!==0)return d.map(p=>function(g){return{field:Fs(g.field),direction:nk(g.dir)}}(p))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const l=Eh(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:n,parent:s}}function ek(t){let e=KN(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Ie(r===1);const p=n.from[0];p.allDescendants?s=p.collectionId:e=e.child(p.collectionId)}let i=[];n.where&&(i=function(m){const g=rx(m);return g instanceof yn&&jw(g)?g.getFilters():[g]}(n.where));let o=[];n.orderBy&&(o=function(m){return m.map(g=>function(C){return new pc(Us(C.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(g))}(n.orderBy));let l=null;n.limit&&(l=function(m){let g;return g=typeof m=="object"?m.value:m,zc(g)?null:g}(n.limit));let c=null;n.startAt&&(c=function(m){const g=!!m.before,S=m.values||[];return new fc(S,g)}(n.startAt));let d=null;return n.endAt&&(d=function(m){const g=!m.before,S=m.values||[];return new fc(S,g)}(n.endAt)),vN(e,s,o,i,l,"F",c,d)}function tk(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ie()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function rx(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Us(n.unaryFilter.field);return qe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Us(n.unaryFilter.field);return qe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Us(n.unaryFilter.field);return qe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Us(n.unaryFilter.field);return qe.create(o,"!=",{nullValue:"NULL_VALUE"});default:return ie()}}(t):t.fieldFilter!==void 0?function(n){return qe.create(Us(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ie()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return yn.create(n.compositeFilter.filters.map(r=>rx(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ie()}}(n.compositeFilter.op))}(t):ie()}function nk(t){return zN[t]}function rk(t){return WN[t]}function sk(t){return HN[t]}function Fs(t){return{fieldPath:t.canonicalString()}}function Us(t){return lt.fromServerFormat(t.fieldPath)}function sx(t){return t instanceof qe?function(n){if(n.op==="=="){if(Ty(n.value))return{unaryFilter:{field:Fs(n.field),op:"IS_NAN"}};if(Ey(n.value))return{unaryFilter:{field:Fs(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Ty(n.value))return{unaryFilter:{field:Fs(n.field),op:"IS_NOT_NAN"}};if(Ey(n.value))return{unaryFilter:{field:Fs(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Fs(n.field),op:rk(n.op),value:n.value}}}(t):t instanceof yn?function(n){const r=n.getFilters().map(s=>sx(s));return r.length===1?r[0]:{compositeFilter:{op:sk(n.op),filters:r}}}(t):ie()}function ik(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function ix(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir{constructor(e,n,r,s,i=le.min(),o=le.min(),l=ht.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new Ir(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Ir(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ir(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ir(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ok{constructor(e){this.ct=e}}function ak(t){const e=ek({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?xh(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lk{constructor(){this.un=new ck}addToCollectionParentIndex(e,n){return this.un.add(n),B.resolve()}getCollectionParents(e,n){return B.resolve(this.un.getEntries(n))}addFieldIndex(e,n){return B.resolve()}deleteFieldIndex(e,n){return B.resolve()}deleteAllFieldIndexes(e){return B.resolve()}createTargetIndexes(e,n){return B.resolve()}getDocumentsMatchingTarget(e,n){return B.resolve(null)}getIndexType(e,n){return B.resolve(0)}getFieldIndexes(e,n){return B.resolve([])}getNextCollectionGroupToUpdate(e){return B.resolve(null)}getMinOffset(e,n){return B.resolve(Ur.min())}getMinOffsetFromCollectionGroup(e,n){return B.resolve(Ur.min())}updateCollectionGroup(e,n,r){return B.resolve()}updateIndexEntries(e,n){return B.resolve()}}class ck{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new ut(Ae.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ut(Ae.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Ei(0)}static kn(){return new Ei(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uk{constructor(){this.changes=new Ri(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,It.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?B.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dk{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&Co(r.mutation,s,Ht.empty(),Ze.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,fe()).next(()=>r))}getLocalViewOfDocuments(e,n,r=fe()){const s=as();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let o=uo();return i.forEach((l,c)=>{o=o.insert(l,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=as();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,fe()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,l)=>{n.set(o,l)})})}computeViews(e,n,r,s){let i=nr();const o=bo(),l=function(){return bo()}();return n.forEach((c,d)=>{const p=r.get(d.key);s.has(d.key)&&(p===void 0||p.mutation instanceof Kr)?i=i.insert(d.key,d):p!==void 0?(o.set(d.key,p.mutation.getFieldMask()),Co(p.mutation,d,p.mutation.getFieldMask(),Ze.now())):o.set(d.key,Ht.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((d,p)=>o.set(d,p)),n.forEach((d,p)=>{var m;return l.set(d,new dk(p,(m=o.get(d))!==null&&m!==void 0?m:null))}),l))}recalculateAndSaveOverlays(e,n){const r=bo();let s=new Fe((o,l)=>o-l),i=fe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const l of o)l.keys().forEach(c=>{const d=n.get(c);if(d===null)return;let p=r.get(c)||Ht.empty();p=l.applyToLocalView(d,p),r.set(c,p);const m=(s.get(l.batchId)||fe()).add(c);s=s.insert(l.batchId,m)})}).next(()=>{const o=[],l=s.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),d=c.key,p=c.value,m=Bw();p.forEach(g=>{if(!i.has(g)){const S=Kw(n.get(g),r.get(g));S!==null&&m.set(g,S),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,d,m))}return B.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(o){return ee.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):Lw(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):B.resolve(as());let l=-1,c=i;return o.next(d=>B.forEach(d,(p,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),i.get(p)?B.resolve():this.remoteDocumentCache.getEntry(e,p).next(g=>{c=c.insert(p,g)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,c,d,fe())).next(p=>({batchId:l,changes:$w(p)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new ee(n)).next(r=>{let s=uo();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let o=uo();return this.indexManager.getCollectionParents(e,i).next(l=>B.forEach(l,c=>{const d=function(m,g){return new va(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(n,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(p=>{p.forEach((m,g)=>{o=o.insert(m,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(o=>{i.forEach((c,d)=>{const p=d.getKey();o.get(p)===null&&(o=o.insert(p,It.newInvalidDocument(p)))});let l=uo();return o.forEach((c,d)=>{const p=i.get(c);p!==void 0&&Co(p.mutation,d,Ht.empty(),Ze.now()),qc(n,d)&&(l=l.insert(c,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fk{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,n){return B.resolve(this.hr.get(n))}saveBundleMetadata(e,n){return this.hr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:An(s.createTime)}}(n)),B.resolve()}getNamedQuery(e,n){return B.resolve(this.Pr.get(n))}saveNamedQuery(e,n){return this.Pr.set(n.name,function(s){return{name:s.name,query:ak(s.bundledQuery),readTime:An(s.readTime)}}(n)),B.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(){this.overlays=new Fe(ee.comparator),this.Ir=new Map}getOverlay(e,n){return B.resolve(this.overlays.get(n))}getOverlays(e,n){const r=as();return B.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.ht(e,n,i)}),B.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),B.resolve()}getOverlaysForCollection(e,n,r){const s=as(),i=n.length+1,o=new ee(n.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,d=c.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return B.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new Fe((d,p)=>d-p);const o=this.overlays.getIterator();for(;o.hasNext();){const d=o.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let p=i.get(d.largestBatchId);p===null&&(p=as(),i=i.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}const l=as(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,p)=>l.set(d,p)),!(l.size()>=s)););return B.resolve(l)}ht(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new LN(n,r));let i=this.Ir.get(n);i===void 0&&(i=fe(),this.Ir.set(n,i)),this.Ir.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{constructor(){this.sessionToken=ht.EMPTY_BYTE_STRING}getSessionToken(e){return B.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,B.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xf{constructor(){this.Tr=new ut(tt.Er),this.dr=new ut(tt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,n){const r=new tt(e,n);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Vr(new tt(e,n))}mr(e,n){e.forEach(r=>this.removeReference(r,n))}gr(e){const n=new ee(new Ae([])),r=new tt(n,e),s=new tt(n,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const n=new ee(new Ae([])),r=new tt(n,e),s=new tt(n,e+1);let i=fe();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const n=new tt(e,0),r=this.Tr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class tt{constructor(e,n){this.key=e,this.wr=n}static Er(e,n){return ee.comparator(e.key,n.key)||xe(e.wr,n.wr)}static Ar(e,n){return xe(e.wr,n.wr)||ee.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new ut(tt.Er)}checkEmpty(e){return B.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new ON(i,n,r,s);this.mutationQueue.push(o);for(const l of s)this.br=this.br.add(new tt(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return B.resolve(o)}lookupMutationBatch(e,n){return B.resolve(this.Dr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.vr(r),i=s<0?0:s;return B.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return B.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return B.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new tt(n,0),s=new tt(n,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const l=this.Dr(o.wr);i.push(l)}),B.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new ut(xe);return n.forEach(s=>{const i=new tt(s,0),o=new tt(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],l=>{r=r.add(l.wr)})}),B.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;ee.isDocumentKey(i)||(i=i.child(""));const o=new tt(new ee(i),0);let l=new ut(xe);return this.br.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(c.wr)),!0)},o),B.resolve(this.Cr(l))}Cr(e){const n=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){Ie(this.Fr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return B.forEach(n.mutations,s=>{const i=new tt(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,n){const r=new tt(n,0),s=this.br.firstAfterOrEqual(r);return B.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,B.resolve()}Fr(e,n){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const n=this.vr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e){this.Mr=e,this.docs=function(){return new Fe(ee.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return B.resolve(r?r.document.mutableCopy():It.newInvalidDocument(n))}getEntries(e,n){let r=nr();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():It.newInvalidDocument(s))}),B.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=nr();const o=n.path,l=new ee(o.child("")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:d,value:{document:p}}=c.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||ZP(XP(p),r)<=0||(s.has(p.key)||qc(n,p))&&(i=i.insert(p.key,p.mutableCopy()))}return B.resolve(i)}getAllFromCollectionGroup(e,n,r,s){ie()}Or(e,n){return B.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new vk(this)}getSize(e){return B.resolve(this.size)}}class vk extends uk{constructor(e){super(),this.cr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),B.waitFor(n)}getFromCache(e,n){return this.cr.getEntry(e,n)}getAllFromCache(e,n){return this.cr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(e){this.persistence=e,this.Nr=new Ri(n=>Hf(n),qf),this.lastRemoteSnapshotVersion=le.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Xf,this.targetCount=0,this.kr=Ei.Bn()}forEachTarget(e,n){return this.Nr.forEach((r,s)=>n(s)),B.resolve()}getLastRemoteSnapshotVersion(e){return B.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return B.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),B.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Lr&&(this.Lr=n),B.resolve()}Kn(e){this.Nr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.kr=new Ei(n),this.highestTargetId=n),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,n){return this.Kn(n),this.targetCount+=1,B.resolve()}updateTargetData(e,n){return this.Kn(n),B.resolve()}removeTargetData(e,n){return this.Nr.delete(n.target),this.Br.gr(n.targetId),this.targetCount-=1,B.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.Nr.forEach((o,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),B.waitFor(i).next(()=>s)}getTargetCount(e){return B.resolve(this.targetCount)}getTargetData(e,n){const r=this.Nr.get(n)||null;return B.resolve(r)}addMatchingKeys(e,n,r){return this.Br.Rr(n,r),B.resolve()}removeMatchingKeys(e,n,r){this.Br.mr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),B.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.Br.gr(n),B.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Br.yr(n);return B.resolve(r)}containsKey(e,n){return B.resolve(this.Br.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e,n){this.qr={},this.overlays={},this.Qr=new $f(0),this.Kr=!1,this.Kr=!0,this.$r=new mk,this.referenceDelegate=e(this),this.Ur=new _k(this),this.indexManager=new lk,this.remoteDocumentCache=function(s){return new yk(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new ok(n),this.Gr=new fk(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new pk,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.qr[e.toKey()];return r||(r=new gk(n,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,n,r){J("MemoryPersistence","Starting transaction:",e);const s=new xk(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,n){return B.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,n)))}}class xk extends tN{constructor(e){super(),this.currentSequenceNumber=e}}class Zf{constructor(e){this.persistence=e,this.Jr=new Xf,this.Yr=null}static Zr(e){return new Zf(e)}get Xr(){if(this.Yr)return this.Yr;throw ie()}addReference(e,n,r){return this.Jr.addReference(r,n),this.Xr.delete(r.toString()),B.resolve()}removeReference(e,n,r){return this.Jr.removeReference(r,n),this.Xr.add(r.toString()),B.resolve()}markPotentiallyOrphaned(e,n){return this.Xr.add(n.toString()),B.resolve()}removeTarget(e,n){this.Jr.gr(n.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}zr(){this.Yr=new Set}jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return B.forEach(this.Xr,r=>{const s=ee.fromPath(r);return this.ei(e,s).next(i=>{i||n.removeEntry(s,le.min())})}).next(()=>(this.Yr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ei(e,n).next(r=>{r?this.Xr.delete(n.toString()):this.Xr.add(n.toString())})}Wr(e){return 0}ei(e,n){return B.or([()=>B.resolve(this.Jr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Hr(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.$i=r,this.Ui=s}static Wi(e,n){let r=fe(),s=fe();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new ep(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tk{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return a1()?8:nN(Ct())>0?6:4}()}initialize(e,n){this.Ji=e,this.indexManager=n,this.Gi=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.Yi(e,n).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,n,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Ek;return this.Xi(e,n,o).next(l=>{if(i.result=l,this.zi)return this.es(e,n,o,l.size)})}).next(()=>i.result)}es(e,n,r,s){return r.documentReadCount<this.ji?(no()<=me.DEBUG&&J("QueryEngine","SDK will not create cache indexes for query:",Vs(n),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),B.resolve()):(no()<=me.DEBUG&&J("QueryEngine","Query:",Vs(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(no()<=me.DEBUG&&J("QueryEngine","The SDK decides to create cache indexes for query:",Vs(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,kn(n))):B.resolve())}Yi(e,n){if(Cy(n))return B.resolve(null);let r=kn(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=xh(n,null,"F"),r=kn(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=fe(...i);return this.Ji.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.ts(n,l);return this.ns(n,d,o,c.readTime)?this.Yi(e,xh(n,null,"F")):this.rs(e,d,n,c)}))})))}Zi(e,n,r,s){return Cy(n)||s.isEqual(le.min())?B.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(n,i);return this.ns(n,o,r,s)?B.resolve(null):(no()<=me.DEBUG&&J("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Vs(n)),this.rs(e,o,n,JP(s,-1)).next(l=>l))})}ts(e,n){let r=new ut(Fw(e));return n.forEach((s,i)=>{qc(e,i)&&(r=r.add(i))}),r}ns(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,n,r){return no()<=me.DEBUG&&J("QueryEngine","Using full collection scan to execute query:",Vs(n)),this.Ji.getDocumentsMatchingQuery(e,n,Ur.min(),r)}rs(e,n,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(e,n,r,s){this.persistence=e,this.ss=n,this.serializer=s,this.os=new Fe(xe),this._s=new Ri(i=>Hf(i),qf),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new hk(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.os))}}function Sk(t,e,n,r){return new Ik(t,e,n,r)}async function ox(t,e){const n=ce(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.ls(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],l=[];let c=fe();for(const d of s){o.push(d.batchId);for(const p of d.mutations)c=c.add(p.key)}for(const d of i){l.push(d.batchId);for(const p of d.mutations)c=c.add(p.key)}return n.localDocuments.getDocuments(r,c).next(d=>({hs:d,removedBatchIds:o,addedBatchIds:l}))})})}function bk(t,e){const n=ce(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(l,c,d,p){const m=d.batch,g=m.keys();let S=B.resolve();return g.forEach(C=>{S=S.next(()=>p.getEntry(c,C)).next(k=>{const R=d.docVersions.get(C);Ie(R!==null),k.version.compareTo(R)<0&&(m.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),p.addEntry(k)))})}),S.next(()=>l.mutationQueue.removeMutationBatch(c,m))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let c=fe();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(c=c.add(l.batch.mutations[d].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function ax(t){const e=ce(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ur.getLastRemoteSnapshotVersion(n))}function Ck(t,e){const n=ce(t),r=e.snapshotVersion;let s=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=n.cs.newChangeBuffer({trackRemovals:!0});s=n.os;const l=[];e.targetChanges.forEach((p,m)=>{const g=s.get(m);if(!g)return;l.push(n.Ur.removeMatchingKeys(i,p.removedDocuments,m).next(()=>n.Ur.addMatchingKeys(i,p.addedDocuments,m)));let S=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?S=S.withResumeToken(ht.EMPTY_BYTE_STRING,le.min()).withLastLimboFreeSnapshotVersion(le.min()):p.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(p.resumeToken,r)),s=s.insert(m,S),function(k,R,I){return k.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8?!0:I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0}(g,S,p)&&l.push(n.Ur.updateTargetData(i,S))});let c=nr(),d=fe();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(i,p))}),l.push(Pk(i,o,e.documentUpdates).next(p=>{c=p.Ps,d=p.Is})),!r.isEqual(le.min())){const p=n.Ur.getLastRemoteSnapshotVersion(i).next(m=>n.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(p)}return B.waitFor(l).next(()=>o.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,c,d)).next(()=>c)}).then(i=>(n.os=s,i))}function Pk(t,e,n){let r=fe(),s=fe();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let o=nr();return n.forEach((l,c)=>{const d=i.get(l);c.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),c.isNoDocument()&&c.version.isEqual(le.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):J("LocalStore","Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",c.version)}),{Ps:o,Is:s}})}function Nk(t,e){const n=ce(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function kk(t,e){const n=ce(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Ur.getTargetData(r,e).next(i=>i?(s=i,B.resolve(s)):n.Ur.allocateTargetId(r).next(o=>(s=new Ir(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.os=n.os.insert(r.targetId,r),n._s.set(e,r.targetId)),r})}async function bh(t,e,n){const r=ce(t),s=r.os.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!ya(o))throw o;J("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Vy(t,e,n){const r=ce(t);let s=le.min(),i=fe();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,d,p){const m=ce(c),g=m._s.get(p);return g!==void 0?B.resolve(m.os.get(g)):m.Ur.getTargetData(d,p)}(r,o,kn(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,l.targetId).next(c=>{i=c})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,n?s:le.min(),n?i:fe())).next(l=>(Ak(r,wN(e),l),{documents:l,Ts:i})))}function Ak(t,e,n){let r=t.us.get(e)||le.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.us.set(e,r)}class Fy{constructor(){this.activeTargetIds=bN()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Rk{constructor(){this.so=new Fy,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,n,r){this.oo[e]=n}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Fy,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uy{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){J("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){J("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ul=null;function rd(){return ul===null?ul=function(){return 268435456+Math.round(2147483648*Math.random())}():ul++,"0x"+ul.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dk={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mk{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xt="WebChannelConnection";class Ok extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+n.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(n,r,s,i,o){const l=rd(),c=this.xo(n,r.toUriEncodedString());J("RestConnection",`Sending RPC '${n}' ${l}:`,c,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,i,o),this.No(n,c,d,s).then(p=>(J("RestConnection",`Received RPC '${n}' ${l}: `,p),p),p=>{throw vi("RestConnection",`RPC '${n}' ${l} failed with error: `,p,"url: ",c,"request:",s),p})}Lo(n,r,s,i,o,l){return this.Mo(n,r,s,i,o)}Oo(n,r,s){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ai}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>n[o]=i),s&&s.headers.forEach((i,o)=>n[o]=i)}xo(n,r){const s=Dk[n];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,n,r,s){const i=rd();return new Promise((o,l)=>{const c=new xw;c.setWithCredentials(!0),c.listenOnce(Ew.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Cl.NO_ERROR:const p=c.getResponseJson();J(xt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(p)),o(p);break;case Cl.TIMEOUT:J(xt,`RPC '${e}' ${i} timed out`),l(new Y($.DEADLINE_EXCEEDED,"Request time out"));break;case Cl.HTTP_ERROR:const m=c.getStatus();if(J(xt,`RPC '${e}' ${i} failed with status:`,m,"response text:",c.getResponseText()),m>0){let g=c.getResponseJson();Array.isArray(g)&&(g=g[0]);const S=g==null?void 0:g.error;if(S&&S.status&&S.message){const C=function(R){const I=R.toLowerCase().replace(/_/g,"-");return Object.values($).indexOf(I)>=0?I:$.UNKNOWN}(S.status);l(new Y(C,S.message))}else l(new Y($.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new Y($.UNAVAILABLE,"Connection failed."));break;default:ie()}}finally{J(xt,`RPC '${e}' ${i} completed.`)}});const d=JSON.stringify(s);J(xt,`RPC '${e}' ${i} sending request:`,s),c.send(n,"POST",d,r,15)})}Bo(e,n,r){const s=rd(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Sw(),l=Iw(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;const p=i.join("");J(xt,`Creating RPC '${e}' stream ${s}: ${p}`,c);const m=o.createWebChannel(p,c);let g=!1,S=!1;const C=new Mk({Io:R=>{S?J(xt,`Not sending because RPC '${e}' stream ${s} is closed:`,R):(g||(J(xt,`Opening RPC '${e}' stream ${s} transport.`),m.open(),g=!0),J(xt,`RPC '${e}' stream ${s} sending:`,R),m.send(R))},To:()=>m.close()}),k=(R,I,w)=>{R.listen(I,b=>{try{w(b)}catch(M){setTimeout(()=>{throw M},0)}})};return k(m,co.EventType.OPEN,()=>{S||(J(xt,`RPC '${e}' stream ${s} transport opened.`),C.yo())}),k(m,co.EventType.CLOSE,()=>{S||(S=!0,J(xt,`RPC '${e}' stream ${s} transport closed`),C.So())}),k(m,co.EventType.ERROR,R=>{S||(S=!0,vi(xt,`RPC '${e}' stream ${s} transport errored:`,R),C.So(new Y($.UNAVAILABLE,"The operation could not be completed")))}),k(m,co.EventType.MESSAGE,R=>{var I;if(!S){const w=R.data[0];Ie(!!w);const b=w,M=b.error||((I=b[0])===null||I===void 0?void 0:I.error);if(M){J(xt,`RPC '${e}' stream ${s} received error:`,M);const O=M.status;let V=function(x){const E=We[x];if(E!==void 0)return Yw(E)}(O),_=M.message;V===void 0&&(V=$.INTERNAL,_="Unknown error status: "+O+" with message "+M.message),S=!0,C.So(new Y(V,_)),m.close()}else J(xt,`RPC '${e}' stream ${s} received:`,w),C.bo(w)}}),k(l,Tw.STAT_EVENT,R=>{R.stat===mh.PROXY?J(xt,`RPC '${e}' stream ${s} detected buffering proxy`):R.stat===mh.NOPROXY&&J(xt,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.wo()},0),C}}function sd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yc(t){return new qN(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lx{constructor(e,n,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=n,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,n-r);s>0&&J("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cx{constructor(e,n,r,s,i,o,l,c){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new lx(e,n)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,n){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():n&&n.code===$.RESOURCE_EXHAUSTED?(tr(n.toString()),tr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===$.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(n)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===n&&this.P_(r,s)},r=>{e(()=>{const s=new Y($.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,n){const r=this.h_(this.Yo);this.stream=this.T_(e,n),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return J("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return n=>{this.ui.enqueueAndForget(()=>this.Yo===e?n():(J("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Lk extends cx{constructor(e,n,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}T_(e,n){return this.connection.Bo("Listen",e,n)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const n=QN(this.serializer,e),r=function(i){if(!("targetChange"in i))return le.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?le.min():o.readTime?An(o.readTime):le.min()}(e);return this.listener.d_(n,r)}A_(e){const n={};n.database=Sh(this.serializer),n.addTarget=function(i,o){let l;const c=o.target;if(l=_h(c)?{documents:XN(i,c)}:{query:ZN(i,c)._t},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=Zw(i,o.resumeToken);const d=Eh(i,o.expectedCount);d!==null&&(l.expectedCount=d)}else if(o.snapshotVersion.compareTo(le.min())>0){l.readTime=gc(i,o.snapshotVersion.toTimestamp());const d=Eh(i,o.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=tk(this.serializer,e);r&&(n.labels=r),this.a_(n)}R_(e){const n={};n.database=Sh(this.serializer),n.removeTarget=e,this.a_(n)}}class Vk extends cx{constructor(e,n,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,n){return this.connection.Bo("Write",e,n)}E_(e){return Ie(!!e.streamToken),this.lastStreamToken=e.streamToken,Ie(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Ie(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const n=JN(e.writeResults,e.commitTime),r=An(e.commitTime);return this.listener.g_(r,n)}p_(){const e={};e.database=Sh(this.serializer),this.a_(e)}m_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>YN(this.serializer,r))};this.a_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk extends class{}{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new Y($.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,n,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Th(n,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Y($.UNKNOWN,i.toString())})}Lo(e,n,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Lo(e,Th(n,r),s,o,l,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Y($.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Uk{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(tr(n),this.D_=!1):J("OnlineStateTracker",n)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Ps(this)&&(J("RemoteStore","Restarting streams for network reachability change."),await async function(c){const d=ce(c);d.L_.add(4),await xa(d),d.q_.set("Unknown"),d.L_.delete(4),await Jc(d)}(this))})}),this.q_=new Uk(r,s)}}async function Jc(t){if(Ps(t))for(const e of t.B_)await e(!0)}async function xa(t){for(const e of t.B_)await e(!1)}function ux(t,e){const n=ce(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),sp(n)?rp(n):ji(n).r_()&&np(n,e))}function tp(t,e){const n=ce(t),r=ji(n);n.N_.delete(e),r.r_()&&dx(n,e),n.N_.size===0&&(r.r_()?r.o_():Ps(n)&&n.q_.set("Unknown"))}function np(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(le.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}ji(t).A_(e)}function dx(t,e){t.Q_.xe(e),ji(t).R_(e)}function rp(t){t.Q_=new BN({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),ji(t).start(),t.q_.v_()}function sp(t){return Ps(t)&&!ji(t).n_()&&t.N_.size>0}function Ps(t){return ce(t).L_.size===0}function hx(t){t.Q_=void 0}async function Bk(t){t.q_.set("Online")}async function zk(t){t.N_.forEach((e,n)=>{np(t,e)})}async function Wk(t,e){hx(t),sp(t)?(t.q_.M_(e),rp(t)):t.q_.set("Unknown")}async function Hk(t,e,n){if(t.q_.set("Online"),e instanceof Xw&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const l of i.targetIds)s.N_.has(l)&&(await s.remoteSyncer.rejectListen(l,o),s.N_.delete(l),s.Q_.removeTarget(l))}(t,e)}catch(r){J("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await yc(t,r)}else if(e instanceof kl?t.Q_.Ke(e):e instanceof Jw?t.Q_.He(e):t.Q_.We(e),!n.isEqual(le.min()))try{const r=await ax(t.localStore);n.compareTo(r)>=0&&await function(i,o){const l=i.Q_.rt(o);return l.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const p=i.N_.get(d);p&&i.N_.set(d,p.withResumeToken(c.resumeToken,o))}}),l.targetMismatches.forEach((c,d)=>{const p=i.N_.get(c);if(!p)return;i.N_.set(c,p.withResumeToken(ht.EMPTY_BYTE_STRING,p.snapshotVersion)),dx(i,c);const m=new Ir(p.target,c,d,p.sequenceNumber);np(i,m)}),i.remoteSyncer.applyRemoteEvent(l)}(t,n)}catch(r){J("RemoteStore","Failed to raise snapshot:",r),await yc(t,r)}}async function yc(t,e,n){if(!ya(e))throw e;t.L_.add(1),await xa(t),t.q_.set("Offline"),n||(n=()=>ax(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{J("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await Jc(t)})}function fx(t,e){return e().catch(n=>yc(t,n,e))}async function Xc(t){const e=ce(t),n=Br(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;qk(e);)try{const s=await Nk(e.localStore,r);if(s===null){e.O_.length===0&&n.o_();break}r=s.batchId,Gk(e,s)}catch(s){await yc(e,s)}px(e)&&mx(e)}function qk(t){return Ps(t)&&t.O_.length<10}function Gk(t,e){t.O_.push(e);const n=Br(t);n.r_()&&n.V_&&n.m_(e.mutations)}function px(t){return Ps(t)&&!Br(t).n_()&&t.O_.length>0}function mx(t){Br(t).start()}async function Kk(t){Br(t).p_()}async function Qk(t){const e=Br(t);for(const n of t.O_)e.m_(n.mutations)}async function Yk(t,e,n){const r=t.O_.shift(),s=Qf.from(r,e,n);await fx(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await Xc(t)}async function Jk(t,e){e&&Br(t).V_&&await async function(r,s){if(function(o){return FN(o)&&o!==$.ABORTED}(s.code)){const i=r.O_.shift();Br(r).s_(),await fx(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Xc(r)}}(t,e),px(t)&&mx(t)}async function $y(t,e){const n=ce(t);n.asyncQueue.verifyOperationInProgress(),J("RemoteStore","RemoteStore received new credentials");const r=Ps(n);n.L_.add(3),await xa(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await Jc(n)}async function Xk(t,e){const n=ce(t);e?(n.L_.delete(2),await Jc(n)):e||(n.L_.add(2),await xa(n),n.q_.set("Unknown"))}function ji(t){return t.K_||(t.K_=function(n,r,s){const i=ce(n);return i.w_(),new Lk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:Bk.bind(null,t),Ro:zk.bind(null,t),mo:Wk.bind(null,t),d_:Hk.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),sp(t)?rp(t):t.q_.set("Unknown")):(await t.K_.stop(),hx(t))})),t.K_}function Br(t){return t.U_||(t.U_=function(n,r,s){const i=ce(n);return i.w_(),new Vk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Kk.bind(null,t),mo:Jk.bind(null,t),f_:Qk.bind(null,t),g_:Yk.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await Xc(t)):(await t.U_.stop(),t.O_.length>0&&(J("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ip{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Kn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const o=Date.now()+r,l=new ip(e,n,o,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Y($.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function op(t,e){if(tr("AsyncQueue",`${e}: ${t}`),ya(t))return new Y($.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci{constructor(e){this.comparator=e?(n,r)=>e(n,r)||ee.comparator(n.key,r.key):(n,r)=>ee.comparator(n.key,r.key),this.keyedMap=uo(),this.sortedSet=new Fe(this.comparator)}static emptySet(e){return new ci(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof ci)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new ci;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(){this.W_=new Fe(ee.comparator)}track(e){const n=e.doc.key,r=this.W_.get(n);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(n,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(n):e.type===1&&r.type===2?this.W_=this.W_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):ie():this.W_=this.W_.insert(n,e)}G_(){const e=[];return this.W_.inorderTraversal((n,r)=>{e.push(r)}),e}}class Ti{constructor(e,n,r,s,i,o,l,c,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,i){const o=[];return n.forEach(l=>{o.push({type:0,doc:l})}),new Ti(e,n,ci.emptySet(n),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Hc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zk{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class eA{constructor(){this.queries=zy(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(n,r){const s=ce(n),i=s.queries;s.queries=zy(),i.forEach((o,l)=>{for(const c of l.j_)c.onError(r)})})(this,new Y($.ABORTED,"Firestore shutting down"))}}function zy(){return new Ri(t=>Vw(t),Hc)}async function ap(t,e){const n=ce(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new Zk,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await n.onListen(s,!0);break;case 1:i.z_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(o){const l=op(o,`Initialization of query '${Vs(e.query)}' failed`);return void e.onError(l)}n.queries.set(s,i),i.j_.push(e),e.Z_(n.onlineState),i.z_&&e.X_(i.z_)&&cp(n)}async function lp(t,e){const n=ce(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function tA(t,e){const n=ce(t);let r=!1;for(const s of e){const i=s.query,o=n.queries.get(i);if(o){for(const l of o.j_)l.X_(s)&&(r=!0);o.z_=s}}r&&cp(n)}function nA(t,e,n){const r=ce(t),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(n);r.queries.delete(e)}function cp(t){t.Y_.forEach(e=>{e.next()})}var Ch,Wy;(Wy=Ch||(Ch={})).ea="default",Wy.Cache="cache";class up{constructor(e,n,r){this.query=e,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ti(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.na?this.ia(e)&&(this.ta.next(e),n=!0):this.sa(e,this.onlineState)&&(this.oa(e),n=!0),this.ra=e,n}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let n=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),n=!0),n}sa(e,n){if(!e.fromCache||!this.J_())return!0;const r=n!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const n=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}oa(e){e=Ti.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Ch.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(e){this.key=e}}class yx{constructor(e){this.key=e}}class rA{constructor(e,n){this.query=e,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=fe(),this.mutatedKeys=fe(),this.Aa=Fw(e),this.Ra=new ci(this.Aa)}get Va(){return this.Ta}ma(e,n){const r=n?n.fa:new By,s=n?n.Ra:this.Ra;let i=n?n.mutatedKeys:this.mutatedKeys,o=s,l=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((p,m)=>{const g=s.get(p),S=qc(this.query,m)?m:null,C=!!g&&this.mutatedKeys.has(g.key),k=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let R=!1;g&&S?g.data.isEqual(S.data)?C!==k&&(r.track({type:3,doc:S}),R=!0):this.ga(g,S)||(r.track({type:2,doc:S}),R=!0,(c&&this.Aa(S,c)>0||d&&this.Aa(S,d)<0)&&(l=!0)):!g&&S?(r.track({type:0,doc:S}),R=!0):g&&!S&&(r.track({type:1,doc:g}),R=!0,(c||d)&&(l=!0)),R&&(S?(o=o.add(S),i=k?i.add(p):i.delete(p)):(o=o.delete(p),i=i.delete(p)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const p=this.query.limitType==="F"?o.last():o.first();o=o.delete(p.key),i=i.delete(p.key),r.track({type:1,doc:p})}return{Ra:o,fa:r,ns:l,mutatedKeys:i}}ga(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((p,m)=>function(S,C){const k=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ie()}};return k(S)-k(C)}(p.type,m.type)||this.Aa(p.doc,m.doc)),this.pa(r),s=s!=null&&s;const l=n&&!s?this.ya():[],c=this.da.size===0&&this.current&&!s?1:0,d=c!==this.Ea;return this.Ea=c,o.length!==0||d?{snapshot:new Ti(this.query,e.Ra,i,o,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new By,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(n=>this.Ta=this.Ta.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ta=this.Ta.delete(n)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=fe(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const n=[];return e.forEach(r=>{this.da.has(r)||n.push(new yx(r))}),this.da.forEach(r=>{e.has(r)||n.push(new gx(r))}),n}ba(e){this.Ta=e.Ts,this.da=fe();const n=this.ma(e.documents);return this.applyChanges(n,!0)}Da(){return Ti.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class sA{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class iA{constructor(e){this.key=e,this.va=!1}}class oA{constructor(e,n,r,s,i,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Ri(l=>Vw(l),Hc),this.Ma=new Map,this.xa=new Set,this.Oa=new Fe(ee.comparator),this.Na=new Map,this.La=new Xf,this.Ba={},this.ka=new Map,this.qa=Ei.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function aA(t,e,n=!0){const r=Tx(t);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await vx(r,e,n,!0),s}async function lA(t,e){const n=Tx(t);await vx(n,e,!0,!1)}async function vx(t,e,n,r){const s=await kk(t.localStore,kn(e)),i=s.targetId,o=t.sharedClientState.addLocalQueryTarget(i,n);let l;return r&&(l=await cA(t,e,i,o==="current",s.resumeToken)),t.isPrimaryClient&&n&&ux(t.remoteStore,s),l}async function cA(t,e,n,r,s){t.Ka=(m,g,S)=>async function(k,R,I,w){let b=R.view.ma(I);b.ns&&(b=await Vy(k.localStore,R.query,!1).then(({documents:_})=>R.view.ma(_,b)));const M=w&&w.targetChanges.get(R.targetId),O=w&&w.targetMismatches.get(R.targetId)!=null,V=R.view.applyChanges(b,k.isPrimaryClient,M,O);return qy(k,R.targetId,V.wa),V.snapshot}(t,m,g,S);const i=await Vy(t.localStore,e,!0),o=new rA(e,i.Ts),l=o.ma(i.documents),c=wa.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=o.applyChanges(l,t.isPrimaryClient,c);qy(t,n,d.wa);const p=new sA(e,n,o);return t.Fa.set(e,p),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),d.snapshot}async function uA(t,e,n){const r=ce(t),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Hc(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await bh(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&tp(r.remoteStore,s.targetId),Ph(r,s.targetId)}).catch(ga)):(Ph(r,s.targetId),await bh(r.localStore,s.targetId,!0))}async function dA(t,e){const n=ce(t),r=n.Fa.get(e),s=n.Ma.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),tp(n.remoteStore,r.targetId))}async function hA(t,e,n){const r=_A(t);try{const s=await function(o,l){const c=ce(o),d=Ze.now(),p=l.reduce((S,C)=>S.add(C.key),fe());let m,g;return c.persistence.runTransaction("Locally write mutations","readwrite",S=>{let C=nr(),k=fe();return c.cs.getEntries(S,p).next(R=>{C=R,C.forEach((I,w)=>{w.isValidDocument()||(k=k.add(I))})}).next(()=>c.localDocuments.getOverlayedDocuments(S,C)).next(R=>{m=R;const I=[];for(const w of l){const b=DN(w,m.get(w.key).overlayedDocument);b!=null&&I.push(new Kr(w.key,b,kw(b.value.mapValue),pn.exists(!0)))}return c.mutationQueue.addMutationBatch(S,d,I,l)}).next(R=>{g=R;const I=R.applyToLocalDocumentSet(m,k);return c.documentOverlayCache.saveOverlays(S,R.batchId,I)})}).then(()=>({batchId:g.batchId,changes:$w(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,l,c){let d=o.Ba[o.currentUser.toKey()];d||(d=new Fe(xe)),d=d.insert(l,c),o.Ba[o.currentUser.toKey()]=d}(r,s.batchId,n),await Ea(r,s.changes),await Xc(r.remoteStore)}catch(s){const i=op(s,"Failed to persist write");n.reject(i)}}async function _x(t,e){const n=ce(t);try{const r=await Ck(n.localStore,e);e.targetChanges.forEach((s,i)=>{const o=n.Na.get(i);o&&(Ie(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Ie(o.va):s.removedDocuments.size>0&&(Ie(o.va),o.va=!1))}),await Ea(n,r,e)}catch(r){await ga(r)}}function Hy(t,e,n){const r=ce(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Fa.forEach((i,o)=>{const l=o.view.Z_(e);l.snapshot&&s.push(l.snapshot)}),function(o,l){const c=ce(o);c.onlineState=l;let d=!1;c.queries.forEach((p,m)=>{for(const g of m.j_)g.Z_(l)&&(d=!0)}),d&&cp(c)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function fA(t,e,n){const r=ce(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Fe(ee.comparator);o=o.insert(i,It.newNoDocument(i,le.min()));const l=fe().add(i),c=new Qc(le.min(),new Map,new Fe(xe),o,l);await _x(r,c),r.Oa=r.Oa.remove(i),r.Na.delete(e),dp(r)}else await bh(r.localStore,e,!1).then(()=>Ph(r,e,n)).catch(ga)}async function pA(t,e){const n=ce(t),r=e.batch.batchId;try{const s=await bk(n.localStore,e);xx(n,r,null),wx(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Ea(n,s)}catch(s){await ga(s)}}async function mA(t,e,n){const r=ce(t);try{const s=await function(o,l){const c=ce(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return c.mutationQueue.lookupMutationBatch(d,l).next(m=>(Ie(m!==null),p=m.keys(),c.mutationQueue.removeMutationBatch(d,m))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,p,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>c.localDocuments.getDocuments(d,p))})}(r.localStore,e);xx(r,e,n),wx(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Ea(r,s)}catch(s){await ga(s)}}function wx(t,e){(t.ka.get(e)||[]).forEach(n=>{n.resolve()}),t.ka.delete(e)}function xx(t,e,n){const r=ce(t);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Ph(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||Ex(t,r)})}function Ex(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);n!==null&&(tp(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),dp(t))}function qy(t,e,n){for(const r of n)r instanceof gx?(t.La.addReference(r.key,e),gA(t,r)):r instanceof yx?(J("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||Ex(t,r.key)):ie()}function gA(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(J("SyncEngine","New document in limbo: "+n),t.xa.add(r),dp(t))}function dp(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new ee(Ae.fromString(e)),r=t.qa.next();t.Na.set(r,new iA(n)),t.Oa=t.Oa.insert(n,r),ux(t.remoteStore,new Ir(kn(Wc(n.path)),r,"TargetPurposeLimboResolution",$f.oe))}}async function Ea(t,e,n){const r=ce(t),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((l,c)=>{o.push(r.Ka(c,e,n).then(d=>{var p;if((d||n)&&r.isPrimaryClient){const m=d?!d.fromCache:(p=n==null?void 0:n.targetChanges.get(c.targetId))===null||p===void 0?void 0:p.current;r.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(d){s.push(d);const m=ep.Wi(c.targetId,d);i.push(m)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(c,d){const p=ce(c);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>B.forEach(d,g=>B.forEach(g.$i,S=>p.persistence.referenceDelegate.addReference(m,g.targetId,S)).next(()=>B.forEach(g.Ui,S=>p.persistence.referenceDelegate.removeReference(m,g.targetId,S)))))}catch(m){if(!ya(m))throw m;J("LocalStore","Failed to update sequence numbers: "+m)}for(const m of d){const g=m.targetId;if(!m.fromCache){const S=p.os.get(g),C=S.snapshotVersion,k=S.withLastLimboFreeSnapshotVersion(C);p.os=p.os.insert(g,k)}}}(r.localStore,i))}async function yA(t,e){const n=ce(t);if(!n.currentUser.isEqual(e)){J("SyncEngine","User change. New user:",e.toKey());const r=await ox(n.localStore,e);n.currentUser=e,function(i,o){i.ka.forEach(l=>{l.forEach(c=>{c.reject(new Y($.CANCELLED,o))})}),i.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ea(n,r.hs)}}function vA(t,e){const n=ce(t),r=n.Na.get(e);if(r&&r.va)return fe().add(r.key);{let s=fe();const i=n.Ma.get(e);if(!i)return s;for(const o of i){const l=n.Fa.get(o);s=s.unionWith(l.view.Va)}return s}}function Tx(t){const e=ce(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=_x.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=vA.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=fA.bind(null,e),e.Ca.d_=tA.bind(null,e.eventManager),e.Ca.$a=nA.bind(null,e.eventManager),e}function _A(t){const e=ce(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=pA.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=mA.bind(null,e),e}class vc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Yc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,n){return null}Ha(e,n){return null}za(e){return Sk(this.persistence,new Tk,e.initialUser,this.serializer)}Ga(e){return new wk(Zf.Zr,this.serializer)}Wa(e){return new Rk}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}vc.provider={build:()=>new vc};class Nh{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Hy(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=yA.bind(null,this.syncEngine),await Xk(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new eA}()}createDatastore(e){const n=Yc(e.databaseInfo.databaseId),r=function(i){return new Ok(i)}(e.databaseInfo);return function(i,o,l,c){return new Fk(i,o,l,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,o,l){return new $k(r,s,i,o,l)}(this.localStore,this.datastore,e.asyncQueue,n=>Hy(this.syncEngine,n,0),function(){return Uy.D()?new Uy:new jk}())}createSyncEngine(e,n){return function(s,i,o,l,c,d,p){const m=new oA(s,i,o,l,c,d);return p&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=ce(s);J("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await xa(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}Nh.provider={build:()=>new Nh};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):tr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wA{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=Et.UNAUTHENTICATED,this.clientId=Cw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{J("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(J("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Kn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=op(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function id(t,e){t.asyncQueue.verifyOperationInProgress(),J("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await ox(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Gy(t,e){t.asyncQueue.verifyOperationInProgress();const n=await xA(t);J("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>$y(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>$y(e.remoteStore,s)),t._onlineComponents=e}async function xA(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){J("FirestoreClient","Using user provided OfflineComponentProvider");try{await id(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===$.FAILED_PRECONDITION||s.code===$.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;vi("Error using user provided cache. Falling back to memory cache: "+n),await id(t,new vc)}}else J("FirestoreClient","Using default OfflineComponentProvider"),await id(t,new vc);return t._offlineComponents}async function Ix(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(J("FirestoreClient","Using user provided OnlineComponentProvider"),await Gy(t,t._uninitializedComponentsProvider._online)):(J("FirestoreClient","Using default OnlineComponentProvider"),await Gy(t,new Nh))),t._onlineComponents}function EA(t){return Ix(t).then(e=>e.syncEngine)}async function _c(t){const e=await Ix(t),n=e.eventManager;return n.onListen=aA.bind(null,e.syncEngine),n.onUnlisten=uA.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=lA.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=dA.bind(null,e.syncEngine),n}function TA(t,e,n={}){const r=new Kn;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,l,c,d){const p=new hp({next:g=>{p.Za(),o.enqueueAndForget(()=>lp(i,m));const S=g.docs.has(l);!S&&g.fromCache?d.reject(new Y($.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&g.fromCache&&c&&c.source==="server"?d.reject(new Y($.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(g)},error:g=>d.reject(g)}),m=new up(Wc(l.path),p,{includeMetadataChanges:!0,_a:!0});return ap(i,m)}(await _c(t),t.asyncQueue,e,n,r)),r.promise}function IA(t,e,n={}){const r=new Kn;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,l,c,d){const p=new hp({next:g=>{p.Za(),o.enqueueAndForget(()=>lp(i,m)),g.fromCache&&c.source==="server"?d.reject(new Y($.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(g)},error:g=>d.reject(g)}),m=new up(l,p,{includeMetadataChanges:!0,_a:!0});return ap(i,m)}(await _c(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sx(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ky=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bx(t,e,n){if(!n)throw new Y($.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function SA(t,e,n,r){if(e===!0&&r===!0)throw new Y($.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Qy(t){if(!ee.isDocumentKey(t))throw new Y($.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Yy(t){if(ee.isDocumentKey(t))throw new Y($.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Zc(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ie()}function tn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Y($.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Zc(t);throw new Y($.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jy{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Y($.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Y($.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}SA("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Sx((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Y($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Y($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Y($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class eu{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jy({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Y($.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Y($.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jy(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new BP;switch(r.type){case"firstParty":return new qP(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Y($.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=Ky.get(n);r&&(J("ComponentProvider","Removing Datastore"),Ky.delete(n),r.terminate())}(this),Promise.resolve()}}function bA(t,e,n,r={}){var s;const i=(t=tn(t,eu))._getSettings(),o=`${e}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&vi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let l,c;if(typeof r.mockUserToken=="string")l=r.mockUserToken,c=Et.MOCK_USER;else{l=e1(r.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new Y($.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Et(d)}t._authCredentials=new zP(new bw(l,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ns(this.firestore,e,this._query)}}class Rt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Lr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Rt(this.firestore,e,this._key)}}class Lr extends Ns{constructor(e,n,r){super(e,n,Wc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Rt(this.firestore,null,new ee(e))}withConverter(e){return new Lr(this.firestore,e,this._path)}}function ft(t,e,...n){if(t=Ke(t),bx("collection","path",e),t instanceof eu){const r=Ae.fromString(e,...n);return Yy(r),new Lr(t,null,r)}{if(!(t instanceof Rt||t instanceof Lr))throw new Y($.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ae.fromString(e,...n));return Yy(r),new Lr(t.firestore,null,r)}}function _n(t,e,...n){if(t=Ke(t),arguments.length===1&&(e=Cw.newId()),bx("doc","path",e),t instanceof eu){const r=Ae.fromString(e,...n);return Qy(r),new Rt(t,null,new ee(r))}{if(!(t instanceof Rt||t instanceof Lr))throw new Y($.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ae.fromString(e,...n));return Qy(r),new Rt(t.firestore,t instanceof Lr?t.converter:null,new ee(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new lx(this,"async_queue_retry"),this.Vu=()=>{const r=sd();r&&J("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const n=sd();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const n=sd();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const n=new Kn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ya(e))throw e;J("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const n=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let l=o.message||"";return o.stack&&(l=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),l}(r);throw tr("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=n,n}enqueueAfterDelay(e,n,r){this.fu(),this.Ru.indexOf(e)>-1&&(n=0);const s=ip.createAndSchedule(this,e,n,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&ie()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const n of this.Tu)if(n.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Tu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const n=this.Tu.indexOf(e);this.Tu.splice(n,1)}}function Zy(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class zr extends eu{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new Xy,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Xy(e),this._firestoreClient=void 0,await e}}}function CA(t,e){const n=typeof t=="object"?t:O_(),r=typeof t=="string"?t:e||"(default)",s=kf(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=XS("firestore");i&&bA(s,...i)}return s}function tu(t){if(t._terminated)throw new Y($.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||PA(t),t._firestoreClient}function PA(t){var e,n,r;const s=t._freezeSettings(),i=function(l,c,d,p){return new iN(l,c,d,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,Sx(p.experimentalLongPollingOptions),p.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new wA(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ii(ht.fromBase64String(e))}catch(n){throw new Y($.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Ii(ht.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nu{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Y($.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new lt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fp{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Y($.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Y($.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return xe(this._lat,e._lat)||xe(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pp{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NA=/^__.*__$/;class kA{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Kr(e,this.data,this.fieldMask,n,this.fieldTransforms):new _a(e,this.data,n,this.fieldTransforms)}}class Cx{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Kr(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function Px(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ie()}}class mp{constructor(e,n,r,s,i,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new mp(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return wc(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Px(this.Cu)&&NA.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class AA{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||Yc(e)}Qu(e,n,r,s=!1){return new mp({Cu:e,methodName:n,qu:r,path:lt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function gp(t){const e=t._freezeSettings(),n=Yc(t._databaseId);return new AA(t._databaseId,!!e.ignoreUndefinedProperties,n)}function RA(t,e,n,r,s,i={}){const o=t.Qu(i.merge||i.mergeFields?2:0,e,n,s);vp("Data must be an object, but it was:",o,r);const l=Nx(r,o);let c,d;if(i.merge)c=new Ht(o.fieldMask),d=o.fieldTransforms;else if(i.mergeFields){const p=[];for(const m of i.mergeFields){const g=kh(e,m,n);if(!o.contains(g))throw new Y($.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);Ax(p,g)||p.push(g)}c=new Ht(p),d=o.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,d=o.fieldTransforms;return new kA(new Lt(l),c,d)}class su extends ru{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof su}}class yp extends ru{_toFieldTransform(e){return new kN(e.path,new ea)}isEqual(e){return e instanceof yp}}function jA(t,e,n,r){const s=t.Qu(1,e,n);vp("Data must be an object, but it was:",s,r);const i=[],o=Lt.empty();Cs(r,(c,d)=>{const p=_p(e,c,n);d=Ke(d);const m=s.Nu(p);if(d instanceof su)i.push(p);else{const g=Ta(d,m);g!=null&&(i.push(p),o.set(p,g))}});const l=new Ht(i);return new Cx(o,l,s.fieldTransforms)}function DA(t,e,n,r,s,i){const o=t.Qu(1,e,n),l=[kh(e,r,n)],c=[s];if(i.length%2!=0)throw new Y($.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)l.push(kh(e,i[g])),c.push(i[g+1]);const d=[],p=Lt.empty();for(let g=l.length-1;g>=0;--g)if(!Ax(d,l[g])){const S=l[g];let C=c[g];C=Ke(C);const k=o.Nu(S);if(C instanceof su)d.push(S);else{const R=Ta(C,k);R!=null&&(d.push(S),p.set(S,R))}}const m=new Ht(d);return new Cx(p,m,o.fieldTransforms)}function MA(t,e,n,r=!1){return Ta(n,t.Qu(r?4:3,e))}function Ta(t,e){if(kx(t=Ke(t)))return vp("Unsupported field value:",e,t),Nx(t,e);if(t instanceof ru)return function(r,s){if(!Px(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const l of r){let c=Ta(l,s.Lu(o));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=Ke(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return CN(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Ze.fromDate(r);return{timestampValue:gc(s.serializer,i)}}if(r instanceof Ze){const i=new Ze(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:gc(s.serializer,i)}}if(r instanceof fp)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ii)return{bytesValue:Zw(s.serializer,r._byteString)};if(r instanceof Rt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Jf(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof pp)return function(o,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw l.Bu("VectorValues must only contain numeric values.");return Gf(l.serializer,c)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Zc(r)}`)}(t,e)}function Nx(t,e){const n={};return Pw(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Cs(t,(r,s)=>{const i=Ta(s,e.Mu(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function kx(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Ze||t instanceof fp||t instanceof Ii||t instanceof Rt||t instanceof ru||t instanceof pp)}function vp(t,e,n){if(!kx(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const r=Zc(n);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function kh(t,e,n){if((e=Ke(e))instanceof nu)return e._internalPath;if(typeof e=="string")return _p(t,e);throw wc("Field path arguments must be of type string or ",t,!1,void 0,n)}const OA=new RegExp("[~\\*/\\[\\]]");function _p(t,e,n){if(e.search(OA)>=0)throw wc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new nu(...e.split("."))._internalPath}catch{throw wc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function wc(t,e,n,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new Y($.INVALID_ARGUMENT,l+t+c)}function Ax(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rx{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Rt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new LA(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(wp("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class LA extends Rx{data(){return super.data()}}function wp(t,e){return typeof e=="string"?_p(t,e):e instanceof nu?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jx(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Y($.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class xp{}class VA extends xp{}function sn(t,e,...n){let r=[];e instanceof xp&&r.push(e),r=r.concat(n),function(i){const o=i.filter(c=>c instanceof Ep).length,l=i.filter(c=>c instanceof iu).length;if(o>1||o>0&&l>0)throw new Y($.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class iu extends VA{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new iu(e,n,r)}_apply(e){const n=this._parse(e);return Dx(e._query,n),new Ns(e.firestore,e.converter,wh(e._query,n))}_parse(e){const n=gp(e.firestore);return function(i,o,l,c,d,p,m){let g;if(d.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Y($.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){tv(m,p);const S=[];for(const C of m)S.push(ev(c,i,C));g={arrayValue:{values:S}}}else g=ev(c,i,m)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||tv(m,p),g=MA(l,o,m,p==="in"||p==="not-in");return qe.create(d,p,g)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function jt(t,e,n){const r=e,s=wp("where",t);return iu._create(s,r,n)}class Ep extends xp{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Ep(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:yn.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let o=s;const l=i.getFlattenedFilters();for(const c of l)Dx(o,c),o=wh(o,c)}(e._query,n),new Ns(e.firestore,e.converter,wh(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function ev(t,e,n){if(typeof(n=Ke(n))=="string"){if(n==="")throw new Y($.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Lw(e)&&n.indexOf("/")!==-1)throw new Y($.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ae.fromString(n));if(!ee.isDocumentKey(r))throw new Y($.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return xy(t,new ee(r))}if(n instanceof Rt)return xy(t,n._key);throw new Y($.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zc(n)}.`)}function tv(t,e){if(!Array.isArray(t)||t.length===0)throw new Y($.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Dx(t,e){const n=function(s,i){for(const o of s)for(const l of o.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new Y($.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Y($.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class FA{convertValue(e,n="none"){switch(xs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Be(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(ws(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw ie()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Cs(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var n,r,s;const i=(s=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Be(o.doubleValue));return new pp(i)}convertGeoPoint(e){return new fp(Be(e.latitude),Be(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=zf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Jo(e));default:return null}}convertTimestamp(e){const n=$r(e);return new Ze(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ae.fromString(e);Ie(ix(r));const s=new Xo(r.get(1),r.get(3)),i=new ee(r.popFirst(5));return s.isEqual(n)||tr(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UA(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fo{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Mx extends Rx{constructor(e,n,r,s,i,o){super(e,n,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Al(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(wp("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class Al extends Mx{data(e={}){return super.data(e)}}class Ox{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new fo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Al(this._firestore,this._userDataWriter,r.key,r,new fo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Y($.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(l=>{const c=new Al(s._firestore,s._userDataWriter,l.doc.key,l.doc,new fo(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const c=new Al(s._firestore,s._userDataWriter,l.doc.key,l.doc,new fo(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,p=-1;return l.type!==0&&(d=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),p=o.indexOf(l.doc.key)),{type:$A(l.type),doc:c,oldIndex:d,newIndex:p}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function $A(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ie()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ia(t){t=tn(t,Rt);const e=tn(t.firestore,zr);return TA(tu(e),t._key).then(n=>Vx(e,t,n))}class Tp extends FA{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ii(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Rt(this.firestore,null,n)}}function vn(t){t=tn(t,Ns);const e=tn(t.firestore,zr),n=tu(e),r=new Tp(e);return jx(t._query),IA(n,t._query).then(s=>new Ox(e,r,t,s))}function ks(t,e,n,...r){t=tn(t,Rt);const s=tn(t.firestore,zr),i=gp(s);let o;return o=typeof(e=Ke(e))=="string"||e instanceof nu?DA(i,"updateDoc",t._key,e,n,r):jA(i,"updateDoc",t._key,e),Ip(s,[o.toMutation(t._key,pn.exists(!0))])}function od(t){return Ip(tn(t.firestore,zr),[new Kf(t._key,pn.none())])}function Sa(t,e){const n=tn(t.firestore,zr),r=_n(t),s=UA(t.converter,e);return Ip(n,[RA(gp(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,pn.exists(!1))]).then(()=>r)}function Lx(t,...e){var n,r,s;t=Ke(t);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Zy(e[o])||(i=e[o],o++);const l={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Zy(e[o])){const m=e[o];e[o]=(n=m.next)===null||n===void 0?void 0:n.bind(m),e[o+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[o+2]=(s=m.complete)===null||s===void 0?void 0:s.bind(m)}let c,d,p;if(t instanceof Rt)d=tn(t.firestore,zr),p=Wc(t._key.path),c={next:m=>{e[o]&&e[o](Vx(d,t,m))},error:e[o+1],complete:e[o+2]};else{const m=tn(t,Ns);d=tn(m.firestore,zr),p=m._query;const g=new Tp(d);c={next:S=>{e[o]&&e[o](new Ox(d,g,m,S))},error:e[o+1],complete:e[o+2]},jx(t._query)}return function(g,S,C,k){const R=new hp(k),I=new up(S,R,C);return g.asyncQueue.enqueueAndForget(async()=>ap(await _c(g),I)),()=>{R.Za(),g.asyncQueue.enqueueAndForget(async()=>lp(await _c(g),I))}}(tu(d),p,l,c)}function Ip(t,e){return function(r,s){const i=new Kn;return r.asyncQueue.enqueueAndForget(async()=>hA(await EA(r),s,i)),i.promise}(tu(t),e)}function Vx(t,e,n){const r=n.docs.get(e._key),s=new Tp(t);return new Mx(t,s,e._key,r,new fo(n.hasPendingWrites,n.fromCache),e.converter)}function pt(){return new yp("serverTimestamp")}(function(e,n=!0){(function(s){Ai=s})(Ni),yi(new gs("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),l=new zr(new WP(r.getProvider("auth-internal")),new KP(r.getProvider("app-check-internal")),function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new Y($.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Xo(d.options.projectId,p)}(o,s),o);return i=Object.assign({useFetchStreams:n},i),l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),Or(gy,"4.7.3",e),Or(gy,"4.7.3","esm2017")})();const BA={apiKey:"AIzaSyB_1Dn63ZHRnA-jXytu95WEBWNFQ64Jo_E",authDomain:"dnd-v1-17acc.firebaseapp.com",projectId:"dnd-v1-17acc",storageBucket:"dnd-v1-17acc.firebasestorage.app",messagingSenderId:"976056329393",appId:"1:976056329393:web:7c8170e906162fe4ef2e90"},Fx=M_(BA),Es=VP(Fx),be=CA(Fx),zA=async(t,e)=>{try{const n={...e,userId:t,createdAt:pt(),updatedAt:pt()};return{id:(await Sa(ft(be,"userProfiles"),n)).id,...n}}catch(n){throw console.error("Error creating user profile:",n),n}},Sp=async t=>{try{const e=sn(ft(be,"userProfiles"),jt("userId","==",t)),n=await vn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting user profile:",e),e}},Ux=async t=>{try{if(!t||t.length===0)return[];const e=[];for(let s=0;s<t.length;s+=10){const i=t.slice(s,s+10),o=sn(ft(be,"userProfiles"),jt("userId","in",i));e.push(vn(o))}const n=await Promise.all(e),r=[];return n.forEach(s=>{s.docs.forEach(i=>{r.push({id:i.id,...i.data()})})}),r}catch(e){throw console.error("Error getting user profiles:",e),e}},WA=async t=>{try{const e=sn(ft(be,"userProfiles"),jt("username","==",t));return(await vn(e)).empty}catch(e){throw console.error("Error checking username availability:",e),e}},HA=async(t,e,n)=>{try{const r={...n,userId:t,partyId:e,createdAt:pt(),updatedAt:pt()};return{id:(await Sa(ft(be,"characters"),r)).id,...r}}catch(r){throw console.error("Error saving character:",r),r}},$x=async(t,e)=>{try{const n=sn(ft(be,"characters"),jt("userId","==",t),jt("partyId","==",e)),r=await vn(n);if(r.empty)return null;const s=r.docs[0];return{id:s.id,...s.data()}}catch(n){throw console.error("Error getting character by user and party:",n),n}},bp=async t=>{try{const e=sn(ft(be,"characters"),jt("partyId","==",t));return(await vn(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){throw console.error("Error getting party characters:",e),e}},qA=async(t,e)=>{try{const n={...e,dmId:t,members:[t],createdAt:pt(),updatedAt:pt()};return{id:(await Sa(ft(be,"parties"),n)).id,...n}}catch(n){throw console.error("Error creating party:",n),n}},Cp=async t=>{try{const e=sn(ft(be,"parties"),jt("members","array-contains",t));return(await vn(e)).docs.map(s=>{const i=s.data();return{id:s.id,...i}})}catch(e){throw e}},GA=async(t,e)=>{try{const n=_n(be,"parties",t),r=await Ia(n);if(!r.exists())throw new Error("Party not found");const s=r.data();if(s.members.includes(e))throw new Error("User already in party");await ks(n,{members:[...s.members,e],updatedAt:pt()})}catch(n){throw console.error("Error joining party:",n),n}},KA=async(t,e)=>{try{const n=_n(be,"parties",t),r=await Ia(n);if(!r.exists())throw new Error("Party not found");if(r.data().dmId!==e)throw new Error("Only the party leader can disband the party");await od(n);const i=sn(ft(be,"characters"),jt("partyId","==",t)),l=(await vn(i)).docs.map(m=>od(m.ref));await Promise.all(l);const c=sn(ft(be,"campaignStories"),jt("partyId","==",t)),p=(await vn(c)).docs.map(m=>od(m.ref));await Promise.all(p)}catch(n){throw console.error("Error disbanding party:",n),n}},QA=async t=>{try{const e=sn(ft(be,"parties"),jt("inviteCode","==",t)),n=await vn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting party by invite code:",e),e}},Bx=async t=>{try{const e=_n(be,"parties",t),n=await Ia(e);return n.exists()?{id:n.id,...n.data()}:null}catch(e){throw console.error("Error getting party by ID:",e),e}},YA=async t=>{try{const e={partyId:t,status:"ready_up",currentPlot:null,storyMessages:[],votingSession:null,readyPlayers:[],lastUpdated:pt(),createdAt:pt()};return{id:(await Sa(ft(be,"campaignStories"),e)).id,...e}}catch(e){throw console.error("Error creating campaign story:",e),e}},JA=async t=>{try{const e=sn(ft(be,"campaignStories"),jt("partyId","==",t)),n=await vn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting campaign story:",e),e}},Tn=async(t,e)=>{try{const n=_n(be,"campaignStories",t);await ks(n,{...e,lastUpdated:pt()})}catch(n){throw console.error("Error updating campaign story:",n),n}},Os=async(t,e)=>{try{const n=_n(be,"campaignStories",t),s=(await Ia(n)).data(),i={id:`msg_${Date.now()}`,...e,timestamp:new Date};return await ks(n,{storyMessages:[...s.storyMessages,i],lastUpdated:pt()}),i}catch(n){throw console.error("Error adding story message:",n),n}},XA=async(t,e)=>{try{const n=_n(be,"campaignStories",t),i=(await Ia(n)).data().readyPlayers||[];i.includes(e)||await ks(n,{readyPlayers:[...i,e],lastUpdated:pt()})}catch(n){throw console.error("Error setting player ready:",n),n}},ZA=(t,e)=>{try{const n=_n(be,"campaignStories",t);return Lx(n,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})}catch(n){throw console.error("Error subscribing to campaign story:",n),n}},ad=async(t,e)=>{try{const n=_n(be,"campaignStories",t);await ks(n,{currentSpeaker:e,lastUpdated:pt()})}catch(n){throw console.error("Error setting current speaker:",n),n}},ld=async(t,e)=>{try{const n=_n(be,"campaignStories",t);await ks(n,{currentController:e,lastUpdated:pt()})}catch(n){throw console.error("Error setting current controller:",n),n}},eR=async(t,e)=>{try{const n={partyId:t,status:"active",storyContext:e.storyContext,partyMembers:e.partyMembers,enemies:e.enemies,initiative:e.initiative,currentTurn:0,combatState:"preparation",createdAt:pt(),updatedAt:pt()};return{id:(await Sa(ft(be,"combatSessions"),n)).id,...n}}catch(n){throw console.error("Error creating combat session:",n),n}},tR=async t=>{try{const e=sn(ft(be,"combatSessions"),jt("partyId","==",t),jt("status","==","active")),n=await vn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting combat session:",e),e}},Ls=async(t,e)=>{try{const n=_n(be,"combatSessions",t);await ks(n,{...e,updatedAt:pt()})}catch(n){throw console.error("Error updating combat session:",n),n}},zx=(t,e)=>{try{const n=sn(ft(be,"combatSessions"),jt("partyId","==",t),jt("status","==","active"));return Lx(n,r=>{if(r.empty)e(null);else{const s=r.docs[0];e({id:s.id,...s.data()})}})}catch(n){throw console.error("Error subscribing to combat session:",n),n}},nR=async(t,e,n)=>{try{if(console.log("Starting registration for:",t,n),!await WA(n))return console.log("Username not available:",n),{user:null,error:"Username is already taken. Please choose a different username."};console.log("Username available:",n);const s=await EC(Es,t,e);console.log("User created successfully:",s.user.uid);try{await zA(s.user.uid,{username:n,email:t,displayName:n}),console.log("User profile created successfully")}catch(o){console.error("Error creating user profile:",o)}let i=!1;try{await IC(s.user),console.log("Email verification sent successfully"),i=!0}catch(o){console.error("Error sending email verification:",o)}return await cw(Es),console.log("User signed out after registration"),{user:null,error:null,success:!0}}catch(r){return console.error("Registration error:",r),{user:null,error:r.message}}},rR=async(t,e)=>{try{return{user:(await TC(Es,t,e)).user,error:null}}catch(n){return{user:null,error:n.message}}},sR=async()=>{try{return await cw(Es),{error:null}}catch(t){return{error:t.message}}},Qr=t=>CC(Es,async e=>{t(e)}),iR=async()=>{try{return console.log("Testing Firebase connection..."),console.log("Auth domain:",Es.config.authDomain),console.log("Project ID:",Es.config.projectId),{success:!0,message:"Firebase connection successful"}}catch(t){return console.error("Firebase connection test failed:",t),{success:!1,error:t.message}}};function oR(){const[t,e]=D.useState(null),[n,r]=D.useState(null),[s,i]=D.useState(!1),o=jn();D.useEffect(()=>{const d=Qr(async p=>{if(e(p),p)try{const m=await Sp(p.uid);r(m)}catch(m){console.error("Error loading user profile:",m)}else r(null)});return()=>d()},[]);const l=async()=>{const{error:d}=await sR();d||o("/")},c=(n==null?void 0:n.username)||(t==null?void 0:t.email);return u.jsx("nav",{className:"bg-stone-800 text-white shadow-lg",children:u.jsx("div",{className:"fantasy-container",children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx(os,{to:"/",className:"text-2xl font-bold font-['Cinzel']",children:"DND-V1"}),u.jsx("div",{className:"flex items-center space-x-4",children:t?u.jsxs(u.Fragment,{children:[u.jsx(os,{to:"/dashboard",className:"fantasy-button",children:"Dashboard"}),u.jsx(os,{to:"/party-management",className:"fantasy-button",children:"Parties"}),u.jsxs("div",{className:"relative",children:[u.jsx("button",{onClick:()=>i(!s),className:"fantasy-button bg-stone-700 hover:bg-stone-600",children:c}),s&&u.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-stone-200 z-50",children:u.jsxs("div",{className:"py-2",children:[u.jsxs("div",{className:"px-4 py-2 text-sm text-stone-700 border-b border-stone-200",children:[u.jsx("div",{className:"font-medium",children:c}),u.jsx("div",{className:"text-xs text-stone-500",children:t.email})]}),u.jsx("button",{onClick:l,className:"w-full text-left px-4 py-2 text-sm text-stone-700 hover:bg-stone-100",children:"Logout"})]})})]})]}):u.jsx(os,{to:"/login",className:"fantasy-button",children:"Login"})})]})})})}function aR(){return u.jsxs("div",{className:"relative overflow-hidden",children:[u.jsx("div",{className:"fantasy-container",children:u.jsxs("div",{className:"relative z-10 py-8 sm:py-16 lg:py-24 text-center",children:[u.jsx("h1",{className:"fantasy-title text-5xl sm:text-6xl lg:text-7xl",children:"Manage your D&D world like a real adventurer's tome"}),u.jsx("p",{className:"fantasy-subtitle max-w-2xl mx-auto",children:"Create parties, invite friends, and share story objectives in a beautifully crafted digital environment that feels like a magical grimoire."}),u.jsxs("div",{className:"mt-8 flex justify-center space-x-6",children:[u.jsx(os,{to:"/register",className:"fantasy-button text-lg px-8 py-3",children:"Start Your Journey"}),u.jsx(os,{to:"/login",className:"fantasy-button text-lg px-8 py-3 bg-stone-600 hover:bg-stone-700",children:"Return to Campaign"})]})]})}),u.jsx("div",{className:"absolute inset-0 bg-stone-200/10 pattern-grid-lg"})]})}function lR(){return u.jsxs("div",{children:[u.jsx(aR,{}),u.jsx("div",{className:"fantasy-container py-16",children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[u.jsxs("div",{className:"fantasy-card",children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Create Parties"}),u.jsx("p",{className:"text-stone-600",children:"Form adventuring parties with your friends and manage your campaign together in a shared space."})]}),u.jsxs("div",{className:"fantasy-card",children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Track Objectives"}),u.jsx("p",{className:"text-stone-600",children:"Keep track of your party's quests, storylines, and achievements in an organized magical tome."})]}),u.jsxs("div",{className:"fantasy-card",children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Share Stories"}),u.jsx("p",{className:"text-stone-600",children:"Document your adventures and share them with your fellow party members in an immersive fantasy setting."})]})]})})]})}function cR(){const[t,e]=D.useState(""),[n,r]=D.useState(""),[s,i]=D.useState(!1),[o,l]=D.useState(""),[c,d]=D.useState(""),p=jn(),m=ca();D.useEffect(()=>{var C;(C=m.state)!=null&&C.message&&(d(m.state.message),p(m.pathname,{replace:!0}));const S=Qr(k=>{k&&p("/dashboard")});return()=>S()},[p,m]);const g=async S=>{S.preventDefault(),i(!0),l("");const C=await rR(t,n);C.error&&(C.error.includes("auth/invalid-credential")?l("Invalid email or password. Please check your credentials or register a new account."):C.error.includes("auth/user-not-found")?l("No account found with this email. Please register first."):C.error.includes("auth/wrong-password")?l("Incorrect password. Please try again."):C.error.includes("auth/user-disabled")?l("This account has been disabled. Please contact support."):C.error.includes("auth/too-many-requests")?l("Too many failed login attempts. Please try again later."):l(C.error)),i(!1)};return u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card max-w-md mx-auto",children:[u.jsx("h1",{className:"fantasy-title text-center",children:"Login"}),c&&u.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-4",children:c}),u.jsxs("form",{onSubmit:g,className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Email"}),u.jsx("input",{type:"email",value:t,onChange:S=>e(S.target.value),className:"fantasy-input",required:!0})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Password"}),u.jsx("input",{type:"password",value:n,onChange:S=>r(S.target.value),className:"fantasy-input",required:!0})]}),o&&u.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg",children:o}),u.jsx("button",{type:"submit",disabled:s,className:"fantasy-button w-full",children:s?"Logging in...":"Login"})]}),u.jsx("div",{className:"mt-6 text-center",children:u.jsxs("p",{className:"text-stone-600",children:["Don't have an account?"," ",u.jsx("button",{onClick:()=>p("/register"),className:"text-amber-700 hover:text-amber-800 font-medium",children:"Register here"})]})})]})})}function uR(){const[t,e]=D.useState(""),[n,r]=D.useState(""),[s,i]=D.useState(""),[o,l]=D.useState(""),[c,d]=D.useState(""),[p,m]=D.useState(""),g=jn();D.useEffect(()=>{iR().then(C=>{console.log("Firebase test result:",C)})},[]);const S=async C=>{if(C.preventDefault(),d(""),m(""),s!==o){d("Passwords do not match");return}if(!n.trim()){d("Username is required");return}if(n.length<3){d("Username must be at least 3 characters long");return}if(!/^[a-zA-Z0-9_]+$/.test(n)){d("Username can only contain letters, numbers, and underscores");return}console.log("Submitting registration for:",t,n);const{user:k,error:R,success:I}=await nR(t,s,n);if(console.log("Registration result:",{user:k,error:R,success:I}),R){console.log("Setting error:",R),d(R);return}I?(console.log("Registration successful, redirecting to login"),g("/login",{state:{message:"Registration successful! Please check your email to verify your account before logging in."}})):console.log("No success received from registration")};return u.jsx("div",{className:"fantasy-container min-h-screen flex items-center justify-center",children:u.jsxs("div",{className:"fantasy-card w-full max-w-md",children:[u.jsx("h2",{className:"fantasy-title text-center",children:"Begin Your Adventure"}),c&&u.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:c}),p&&u.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:p}),u.jsxs("form",{onSubmit:S,className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-stone-700",children:"Username"}),u.jsx("input",{id:"username",type:"text",required:!0,value:n,onChange:C=>r(C.target.value),className:"fantasy-input mt-1",placeholder:"Choose a unique username"}),u.jsx("p",{className:"text-xs text-stone-500 mt-1",children:"Letters, numbers, and underscores only. 3+ characters."})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-stone-700",children:"Email"}),u.jsx("input",{id:"email",type:"email",required:!0,value:t,onChange:C=>e(C.target.value),className:"fantasy-input mt-1"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-stone-700",children:"Password"}),u.jsx("input",{id:"password",type:"password",required:!0,value:s,onChange:C=>i(C.target.value),className:"fantasy-input mt-1"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-stone-700",children:"Confirm Password"}),u.jsx("input",{id:"confirmPassword",type:"password",required:!0,value:o,onChange:C=>l(C.target.value),className:"fantasy-input mt-1"})]}),u.jsx("button",{type:"submit",className:"fantasy-button w-full",children:"Register"})]}),u.jsxs("p",{className:"mt-4 text-center text-sm text-stone-600",children:["Already have an account?"," ",u.jsx(os,{to:"/login",className:"text-amber-700 hover:text-amber-800",children:"Return to your campaign"})]})]})})}function dR(){const[t,e]=D.useState(null),[n,r]=D.useState(null),[s,i]=D.useState([]),[o,l]=D.useState({}),[c,d]=D.useState(!0),p=jn();D.useEffect(()=>{const C=Qr(k=>{if(!k){p("/login");return}e(k),m(k.uid)});return()=>C()},[p]);const m=async C=>{try{const[k,R]=await Promise.all([Cp(C),Sp(C)]);i(k),r(R),await g(k)}catch(k){console.error("Error loading user data:",k)}finally{d(!1)}},g=async C=>{try{const k=new Set;if(C.forEach(b=>{b.members&&Array.isArray(b.members)&&b.members.forEach(M=>k.add(M))}),k.size===0)return;const R=await Ux(Array.from(k)),I={};R.forEach(b=>{I[b.userId]=b});const w={};C.forEach(b=>{b.members&&Array.isArray(b.members)&&(w[b.id]=b.members.map(M=>({userId:M,profile:I[M]||null})))}),l(w)}catch(k){console.error("Error loading party member profiles:",k)}};if(!t)return null;if(c)return u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsx("div",{className:"text-center py-8",children:u.jsx("div",{className:"text-stone-600",children:"Loading your parties..."})})})});const S=(n==null?void 0:n.username)||t.email;return u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card",children:[u.jsx("div",{className:"flex justify-between items-center mb-6",children:u.jsxs("h1",{className:"fantasy-title mb-0",children:["Welcome, ",S]})}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-6",children:"Your Parties"}),s.length===0?u.jsxs("div",{className:"text-center py-8 text-stone-600",children:[u.jsx("p",{children:"You haven't joined any parties yet."}),u.jsx("p",{className:"text-sm mt-2",children:"Go to the Parties tab to create or join a party!"}),u.jsx("button",{onClick:()=>p("/party-management"),className:"fantasy-button mt-4",children:"Go to Parties"})]}):u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s.map(C=>{var R;const k=o[C.id]||[];return u.jsxs("div",{className:"fantasy-card bg-amber-50",children:[u.jsx("div",{className:"flex justify-between items-start mb-4",children:u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800",children:C.name}),u.jsx("p",{className:"text-stone-600 mt-1",children:C.description}),u.jsxs("p",{className:"text-sm text-stone-500 mt-2",children:[((R=C.members)==null?void 0:R.length)||1,"/",C.maxPlayers," members"]})]})}),u.jsxs("div",{className:"mb-4",children:[u.jsx("h4",{className:"text-sm font-semibold text-stone-700 mb-2",children:"Party Members:"}),u.jsx("div",{className:"space-y-1",children:k.map((I,w)=>{var O;const b=((O=I.profile)==null?void 0:O.username)||`User ${w+1}`,M=I.userId===C.dmId;return u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("span",{className:"text-stone-600",children:b}),M&&u.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),I.userId===(t==null?void 0:t.uid)&&u.jsx("span",{className:"text-blue-600 text-xs font-medium",children:"(You)"})]},I.userId)})})]}),u.jsx("div",{className:"flex space-x-2",children:u.jsx("button",{onClick:()=>p(`/campaign-story/${C.id}`),className:"fantasy-button flex-1",children:"View Campaign"})})]},C.id)})})]})]})})}function hR(){var de,je,De;const t=jn(),{partyId:e}=Vc(),[n,r]=D.useState(null),[s,i]=D.useState(!1),[o,l]=D.useState(null),[c,d]=D.useState({name:"",race:"",class:"",level:1,background:"",alignment:"",strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10,age:"",height:"",weight:"",eyes:"",skin:"",hair:"",personality:"",ideals:"",bonds:"",flaws:"",backstory:"",equipment:[],spells:[],proficiencies:[],portrait:"/placeholder-character.png"}),[p,m]=D.useState("standard"),[g,S]=D.useState([]),[C,k]=D.useState([]),[R,I]=D.useState({}),[w,b]=D.useState(!1),[M,O]=D.useState({}),[V,_]=D.useState([]);D.useEffect(()=>{const F=Qr(re=>{if(!re){t("/login");return}r(re),e&&y(re.uid,e)});return()=>F()},[t,e]);const y=async(F,re)=>{try{const se=await $x(F,re);l(se)}catch{}},x=["Human","Elf","Dwarf","Halfling","Dragonborn","Tiefling","Half-Elf","Half-Orc","Gnome","Aarakocra","Genasi","Goliath"],E=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"],P=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],N=["Acolyte","Criminal","Folk Hero","Noble","Sage","Soldier"],T=[15,14,13,12,10,8],_e={Fighter:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Paladin:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Barbarian:{"Martial Melee Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"]},Bard:{Weapon:["Rapier","Longsword"]},Druid:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Monk:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Sorcerer:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Warlock:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]}},mt={Wizard:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Sorcerer:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Warlock:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Eldritch Blast",description:"A beam of crackling energy that deals force damage and can hit multiple targets."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Cleric:[{name:"Guidance",description:"Touch a creature to give them +1d4 to their next ability check."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Resistance",description:"Touch a creature to give them +1d4 to their next saving throw."},{name:"Sacred Flame",description:"Flame-like radiance descends on a creature within 60 feet, dealing radiant damage."},{name:"Spare the Dying",description:"Touch a dying creature to stabilize them at 0 hit points."},{name:"Thaumaturgy",description:"Perform minor magical tricks - make your voice boom, cause tremors, or change eye color."}],Druid:[{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Druidcraft",description:"Predict weather, make a flower bloom, or create a harmless sensory effect."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Primal Savagery",description:"Transform your hand into a claw that deals acid damage to a creature you touch."},{name:"Produce Flame",description:"Create a flickering flame in your hand that you can throw for fire damage."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shillelagh",description:"Transform a club or quarterstaff into a magical weapon that uses your spellcasting ability."},{name:"Thorn Whip",description:"Create a vine-like whip that pulls a creature toward you and deals piercing damage."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."}],Bard:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."},{name:"Vicious Mockery",description:"Insult a creature within 60 feet, dealing psychic damage and possibly giving disadvantage."}]},Qe={Wizard:{cantrips:3,spells:6},Sorcerer:{cantrips:4,spells:2},Warlock:{cantrips:2,spells:2},Cleric:{cantrips:3,spells:2},Druid:{cantrips:2,spells:2},Bard:{cantrips:2,spells:4}},Ye=F=>{const se=[...{Fighter:["Chain mail armor","Light crossbow and 20 bolts","Dungeoneer's pack","5 gp"],Wizard:["Arcane focus","Scholar's pack","Component pouch","5 gp"],Cleric:["Chain mail armor","Light crossbow and 20 bolts","Priest's pack","Shield","Holy symbol","5 gp"],Rogue:["Leather armor","Shortbow and 20 arrows","Burglar's pack","Thieves' tools","5 gp"],Ranger:["Scale mail armor","Longbow and 20 arrows","Explorer's pack","5 gp"],Paladin:["Chain mail armor","Javelins (5)","Priest's pack","Holy symbol","5 gp"],Barbarian:["Javelins (4)","Explorer's pack","5 gp"],Bard:["Leather armor","Diplomat's pack OR entertainer's pack","Lute OR any other musical instrument","5 gp"],Druid:["Leather armor","Druidic focus","Explorer's pack","Shield","5 gp"],Monk:["Dungeoneer's pack OR explorer's pack","5 gp"],Sorcerer:["Component pouch OR arcane focus","Dungeoneer's pack","5 gp"],Warlock:["Component pouch OR arcane focus","Scholar's pack","5 gp"]}[F]||["Adventurer's pack","Simple weapon","5 gp"]];return M.weapon&&se.push(M.weapon),M.shield&&se.push(M.shield),V.length>0&&se.push(`Spells: ${V.join(", ")}`),se},G=()=>{const F=[];for(let re=0;re<4;re++)F.push(Math.floor(Math.random()*6)+1);return F.sort((re,se)=>se-re),F.slice(0,3).reduce((re,se)=>re+se,0)},te=()=>{const F=[];for(let re=0;re<6;re++)F.push(G());return F.sort((re,se)=>se-re),S(F),k([...F]),I({}),b(!0),F},A=(F,re)=>{const se=C.filter(ye=>ye!==F);k(se),I(ye=>({...ye,[re]:F})),q(re,F)},H=F=>{const re=R[F];if(re){k(ye=>[...ye,re].sort((U,K)=>K-U));const se={...R};delete se[F],I(se),q(F,10)}},Z=()=>{const F=["strength","dexterity","constitution","intelligence","wisdom","charisma"],re={...c};T.forEach((se,ye)=>{re[F[ye]]=se}),d(re),I({}),k([]),b(!1)},q=(F,re)=>{d(se=>({...se,[F]:re}))},oe=async F=>{if(F.preventDefault(),!n){console.error("You must be logged in to create a character");return}if(!e){console.error("Party ID is missing. Please try again or contact support.");return}const se=["name","race","class"].filter(ye=>!c[ye]);if(se.length>0){console.error(`Please fill in all required fields: ${se.join(", ")}`);return}i(!0);try{const ye={...c,userId:n.uid,partyId:e,equipment:Ye(c.class),weapons:M,spells:V,createdAt:new Date};await HA(n.uid,e,ye),console.log("Character created successfully!"),t(`/campaign-story/${e}`)}catch(ye){console.error("Character creation error:",ye),console.error("Error creating character:",ye.message)}finally{i(!1)}};return n?o?u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card",children:[u.jsx("h1",{className:"fantasy-title text-center",children:"Character Already Created"}),u.jsxs("div",{className:"text-center py-8",children:[u.jsxs("p",{className:"text-stone-600 mb-4",children:["You already have a character in this party: ",u.jsx("strong",{children:o.name})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("button",{onClick:()=>t(`/campaign-story/${e}`),className:"fantasy-button",children:"Go to Campaign"}),u.jsx("button",{onClick:()=>t("/party-management"),className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Back to Parties"})]})]})]})}):u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card",children:[u.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),u.jsx("p",{className:"text-center text-stone-600 mb-6",children:"Create your character to join the campaign. Once created, you'll be automatically ready to start the adventure!"}),u.jsxs("form",{onSubmit:oe,className:"space-y-8",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Character Name"}),u.jsx("input",{type:"text",value:c.name,onChange:F=>q("name",F.target.value),className:"fantasy-input",required:!0})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Race"}),u.jsxs("select",{value:c.race,onChange:F=>q("race",F.target.value),className:"fantasy-input",required:!0,children:[u.jsx("option",{value:"",children:"Select Race"}),x.map(F=>u.jsx("option",{value:F,children:F},F))]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Class"}),u.jsxs("select",{value:c.class,onChange:F=>q("class",F.target.value),className:"fantasy-input",required:!0,children:[u.jsx("option",{value:"",children:"Select Class"}),E.map(F=>u.jsx("option",{value:F,children:F},F))]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Background"}),u.jsxs("select",{value:c.background,onChange:F=>q("background",F.target.value),className:"fantasy-input",required:!0,children:[u.jsx("option",{value:"",children:"Select Background"}),N.map(F=>u.jsx("option",{value:F,children:F},F))]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Alignment"}),u.jsxs("select",{value:c.alignment,onChange:F=>q("alignment",F.target.value),className:"fantasy-input",required:!0,children:[u.jsx("option",{value:"",children:"Select Alignment"}),P.map(F=>u.jsx("option",{value:F,children:F},F))]})]})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Ability Scores"}),u.jsxs("div",{className:"mb-6",children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Ability Score Generation Method"}),u.jsxs("div",{className:"flex space-x-4 mb-4",children:[u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"radio",name:"abilityMethod",value:"standard",checked:p==="standard",onChange:F=>m(F.target.value),className:"mr-2"}),"Standard Array (15, 14, 13, 12, 10, 8)"]}),u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"radio",name:"abilityMethod",value:"roll",checked:p==="roll",onChange:F=>m(F.target.value),className:"mr-2"}),"Roll 4d6, Drop Lowest"]})]}),p==="standard"&&u.jsx("button",{type:"button",onClick:Z,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Apply Standard Array"}),p==="roll"&&u.jsxs("div",{className:"space-y-2",children:[u.jsx("button",{type:"button",onClick:te,disabled:w,className:`fantasy-button ${w?"bg-stone-400 cursor-not-allowed":"bg-stone-600 hover:bg-stone-700"}`,children:w?"Scores Already Rolled":"Roll Ability Scores"}),w&&u.jsx("p",{className:"text-sm text-stone-600",children:"You can only roll once, but you can reassign scores as many times as you like."}),g.length>0&&u.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-semibold text-stone-800 mb-2",children:"Rolled Scores"}),u.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:C.map((F,re)=>u.jsx("span",{className:"bg-amber-100 border border-amber-300 text-amber-800 px-3 py-1 rounded-full text-sm font-medium",children:F},`${F}-${re}`))}),u.jsx("p",{className:"text-sm text-stone-600",children:"Click on an ability score below to assign your rolled scores. You can reassign them as many times as you want."})]})]})]}),u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:["strength","dexterity","constitution","intelligence","wisdom","charisma"].map(F=>{const re=R[F],se=c[F];return u.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2 capitalize",children:F}),re?u.jsxs("div",{className:"space-y-2",children:[u.jsx("div",{className:"text-lg font-bold text-amber-700",children:re}),u.jsx("button",{type:"button",onClick:()=>H(F),className:"text-xs text-red-600 hover:text-red-800",children:"Unassign"})]}):u.jsxs("div",{className:"space-y-2",children:[u.jsx("input",{type:"number",min:"1",max:"20",value:se,onChange:ye=>q(F,parseInt(ye.target.value)),className:"fantasy-input",required:!0}),C.length>0&&u.jsx("div",{className:"flex flex-wrap gap-1",children:C.map((ye,U)=>u.jsx("button",{type:"button",onClick:()=>A(ye,F),className:"bg-amber-100 hover:bg-amber-200 border border-amber-300 text-amber-800 px-2 py-1 rounded text-xs font-medium",children:ye},`${ye}-${U}`))})]}),u.jsxs("div",{className:"text-xs text-stone-500 mt-1",children:["Modifier: ",Math.floor((se-10)/2)]})]},F)})})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Physical Description"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsx("input",{type:"text",placeholder:"Age",value:c.age,onChange:F=>q("age",F.target.value),className:"fantasy-input"}),u.jsx("input",{type:"text",placeholder:"Height",value:c.height,onChange:F=>q("height",F.target.value),className:"fantasy-input"}),u.jsx("input",{type:"text",placeholder:"Weight",value:c.weight,onChange:F=>q("weight",F.target.value),className:"fantasy-input"}),u.jsx("input",{type:"text",placeholder:"Eye Color",value:c.eyes,onChange:F=>q("eyes",F.target.value),className:"fantasy-input"}),u.jsx("input",{type:"text",placeholder:"Skin Color",value:c.skin,onChange:F=>q("skin",F.target.value),className:"fantasy-input"}),u.jsx("input",{type:"text",placeholder:"Hair Color",value:c.hair,onChange:F=>q("hair",F.target.value),className:"fantasy-input"})]})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Personality"}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Personality Traits"}),u.jsx("textarea",{value:c.personality,onChange:F=>q("personality",F.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your character's personality..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Ideals"}),u.jsx("textarea",{value:c.ideals,onChange:F=>q("ideals",F.target.value),className:"fantasy-input",rows:"3",placeholder:"What does your character believe in?"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Bonds"}),u.jsx("textarea",{value:c.bonds,onChange:F=>q("bonds",F.target.value),className:"fantasy-input",rows:"3",placeholder:"What connections does your character have?"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Flaws"}),u.jsx("textarea",{value:c.flaws,onChange:F=>q("flaws",F.target.value),className:"fantasy-input",rows:"3",placeholder:"What are your character's weaknesses?"})]})]})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Backstory"}),u.jsx("textarea",{value:c.backstory,onChange:F=>q("backstory",F.target.value),className:"fantasy-input",rows:"6",placeholder:"Tell the story of your character's life before the adventure..."})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Starting Equipment"}),c.class&&_e[c.class]&&u.jsxs("div",{className:"mb-6",children:[u.jsx("h3",{className:"text-lg font-semibold text-stone-800 mb-3",children:"Choose Your Weapons"}),u.jsx("div",{className:"space-y-4",children:Object.entries(_e[c.class]).map(([F,re])=>u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:F}),u.jsxs("select",{value:M[F.toLowerCase().replace(/\s+/g,"")]||"",onChange:se=>O(ye=>({...ye,[F.toLowerCase().replace(/\s+/g,"")]:se.target.value})),className:"fantasy-input",children:[u.jsxs("option",{value:"",children:["Select ",F]}),re.map(se=>u.jsx("option",{value:se,children:se},se))]})]},F))})]}),c.class&&mt[c.class]&&u.jsxs("div",{className:"mb-6",children:[u.jsx("h3",{className:"text-lg font-semibold text-stone-800 mb-3",children:"Choose Your Cantrips"}),u.jsxs("p",{className:"text-sm text-stone-600 mb-3",children:["Select your starting cantrips (0-level spells). You can choose up to ",((de=Qe[c.class])==null?void 0:de.cantrips)||0," cantrips."]}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto border border-stone-200 rounded-lg p-4",children:mt[c.class].map(F=>{var ye;const re=V.includes(F.name),se=!re&&V.length>=(((ye=Qe[c.class])==null?void 0:ye.cantrips)||0);return u.jsx("div",{className:`border rounded-lg p-3 ${re?"border-amber-500 bg-amber-50":"border-stone-200"} ${se?"opacity-50":"hover:border-stone-300"}`,children:u.jsxs("label",{className:`flex items-start space-x-3 cursor-pointer ${se?"cursor-not-allowed":""}`,children:[u.jsx("input",{type:"checkbox",checked:re,disabled:se,onChange:U=>{U.target.checked?_(K=>[...K,F.name]):_(K=>K.filter(X=>X!==F.name))},className:"rounded mt-1"}),u.jsxs("div",{className:"flex-1",children:[u.jsx("div",{className:"font-medium text-stone-800",children:F.name}),u.jsx("div",{className:"text-sm text-stone-600 mt-1",children:F.description})]})]})},F.name)})}),u.jsxs("div",{className:"flex justify-between items-center mt-3",children:[u.jsxs("p",{className:"text-sm text-stone-500",children:["Selected: ",V.length," / ",((je=Qe[c.class])==null?void 0:je.cantrips)||0," cantrips"]}),V.length>=(((De=Qe[c.class])==null?void 0:De.cantrips)||0)&&u.jsx("p",{className:"text-sm text-green-600 font-medium",children:"✓ Cantrip selection complete"})]})]}),c.class?u.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:[u.jsxs("h3",{className:"font-semibold text-stone-800 mb-3",children:[c.class," Starting Equipment"]}),u.jsx("ul",{className:"space-y-1",children:Ye(c.class).map((F,re)=>u.jsxs("li",{className:"text-stone-700 flex items-start",children:[u.jsx("span",{className:"text-stone-500 mr-2",children:"•"}),F]},re))}),u.jsx("p",{className:"text-sm text-stone-600 mt-3",children:"This equipment will be automatically assigned to your character."})]}):u.jsx("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:u.jsx("p",{className:"text-stone-600",children:"Select a class to see your starting equipment."})})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Character Portrait"}),u.jsxs("div",{className:"flex items-center space-x-4",children:[u.jsx("div",{className:"w-32 h-32 bg-stone-200 rounded-lg flex items-center justify-center",children:u.jsx("span",{className:"text-stone-500",children:"Portrait Placeholder"})}),u.jsx("button",{type:"button",className:"fantasy-button",onClick:()=>{},children:"Upload Image"})]})]}),u.jsxs("div",{className:"flex justify-center space-x-4",children:[u.jsx("button",{type:"button",onClick:()=>t(`/campaign-story/${e}`),className:"fantasy-button bg-stone-600 hover:bg-stone-700",disabled:s,children:"Back to Campaign"}),u.jsx("button",{type:"submit",className:"fantasy-button",disabled:s,children:s?"Creating Character...":"Create Character"})]})]})]})}):null}function fR(){const t=jn(),[e,n]=D.useState(null),[r,s]=D.useState([]),[i,o]=D.useState({}),[l,c]=D.useState(!1),[d,p]=D.useState(!1),[m,g]=D.useState(""),[S,C]=D.useState({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""});D.useEffect(()=>{const O=Qr(V=>{if(!V){t("/login");return}n(V),k(V.uid)});return()=>O()},[t]);const k=async O=>{try{const V=await Cp(O);s(V),await R(V)}catch(V){console.error("Error loading parties:",V.message)}},R=async O=>{try{const V=new Set;if(O.forEach(E=>{E.members&&Array.isArray(E.members)&&E.members.forEach(P=>V.add(P))}),V.size===0)return;const _=await Ux(Array.from(V)),y={};_.forEach(E=>{y[E.userId]=E});const x={};O.forEach(E=>{E.members&&Array.isArray(E.members)&&(x[E.id]=E.members.map(P=>({userId:P,profile:y[P]||null})))}),o(x)}catch(V){console.error("Error loading party member profiles:",V)}},I=async O=>{if(O.preventDefault(),!e){console.error("You must be logged in to create a party");return}c(!0);try{const V={...S,inviteCode:Math.random().toString(36).substr(2,8).toUpperCase()},_=await qA(e.uid,V);p(!1),C({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""}),await k(e.uid),console.log("Party created successfully!")}catch(V){console.error("Error creating party:",V.message)}finally{c(!1)}},w=async()=>{if(!m.trim()){console.error("Please enter an invite code");return}if(!e){console.error("You must be logged in to join a party");return}c(!0);try{const O=await QA(m.toUpperCase());if(!O){console.error("Invalid invite code");return}await GA(O.id,e.uid),g(""),await k(e.uid),console.log("Successfully joined party!")}catch(O){console.error(O.message||"Error joining party. Please try again.")}finally{c(!1)}},b=O=>{navigator.clipboard.writeText(O),console.log("Invite code copied to clipboard!")},M=async(O,V)=>{if(confirm(`Are you sure you want to disband "${V}"? This action cannot be undone and will remove all party members and characters.`)){c(!0);try{await KA(O,e.uid),await k(e.uid),console.log("Party disbanded successfully")}catch(_){console.error("Error disbanding party:",_.message)}finally{c(!1)}}};return e?u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h1",{className:"fantasy-title mb-0",children:"Party Management"}),u.jsx("button",{onClick:()=>p(!0),className:"fantasy-button",disabled:l,children:"Create New Party"})]}),d&&u.jsxs("div",{className:"fantasy-card bg-amber-50 mb-6",children:[u.jsx("h2",{className:"text-xl font-bold text-stone-800 mb-4",children:"Create New Party"}),u.jsxs("form",{onSubmit:I,className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Party Name"}),u.jsx("input",{type:"text",value:S.name,onChange:O=>C(V=>({...V,name:O.target.value})),className:"fantasy-input",required:!0})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Theme"}),u.jsx("textarea",{value:S.description,onChange:O=>C(V=>({...V,description:O.target.value})),className:"fantasy-input",rows:"3",placeholder:"Enter the theme or atmosphere for your campaign..."})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Max Players"}),u.jsx("input",{type:"number",min:"2",max:"10",value:S.maxPlayers,onChange:O=>C(V=>({...V,maxPlayers:parseInt(O.target.value)})),className:"fantasy-input"})]}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",id:"isPublic",checked:S.isPublic,onChange:O=>C(V=>({...V,isPublic:O.target.checked})),className:"mr-2"}),u.jsx("label",{htmlFor:"isPublic",className:"text-sm font-medium text-stone-700",children:"Public Party (visible to all users)"})]})]}),u.jsxs("div",{className:"flex space-x-4",children:[u.jsx("button",{type:"submit",className:"fantasy-button",disabled:l,children:l?"Creating...":"Create Party"}),u.jsx("button",{type:"button",onClick:()=>p(!1),className:"fantasy-button bg-stone-600 hover:bg-stone-700",disabled:l,children:"Cancel"})]})]})]}),u.jsxs("div",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"My Parties"}),r.length===0?u.jsxs("div",{className:"text-center py-8 text-stone-600",children:[u.jsx("p",{children:"You haven't joined any parties yet."}),u.jsx("p",{children:'Click "Create New Party" to get started!'})]}):u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:r.map(O=>{var _;const V=i[O.id]||[];return u.jsxs("div",{className:"fantasy-card bg-amber-50",children:[u.jsxs("div",{className:"flex justify-between items-start mb-4",children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800",children:O.name}),u.jsxs("span",{className:"text-sm text-stone-600",children:[((_=O.members)==null?void 0:_.length)||1,"/",O.maxPlayers," players"]})]}),O.description&&u.jsxs("div",{className:"mb-4",children:[u.jsx("span",{className:"text-sm font-semibold text-stone-700",children:"Theme: "}),u.jsx("span",{className:"text-stone-600",children:O.description})]}),u.jsxs("div",{className:"mb-4",children:[u.jsx("h4",{className:"text-sm font-semibold text-stone-700 mb-2",children:"Party Members:"}),u.jsx("div",{className:"space-y-1",children:V.map((y,x)=>{var N;const E=((N=y.profile)==null?void 0:N.username)||`User ${x+1}`,P=y.userId===O.dmId;return u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("span",{className:"text-stone-600",children:E}),P&&u.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),y.userId===(e==null?void 0:e.uid)&&u.jsx("span",{className:"text-blue-600 text-xs font-medium",children:"(You)"})]},y.userId)})})]}),O.dmId===e.uid&&u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Invite Code"}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("input",{type:"text",value:O.inviteCode,readOnly:!0,className:"fantasy-input bg-stone-100"}),u.jsx("button",{onClick:()=>b(O.inviteCode),className:"fantasy-button text-sm",children:"Copy"})]})]}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsx("button",{onClick:()=>t(`/campaign-story/${O.id}`),className:"fantasy-button",children:"Campaign"}),O.dmId===e.uid&&u.jsx("button",{onClick:()=>M(O.id,O.name),className:"fantasy-button bg-red-600 hover:bg-red-700",disabled:l,children:"Disband"})]})]},O.id)})})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Join a Party"}),u.jsx("div",{className:"fantasy-card bg-amber-50",children:u.jsxs("div",{className:"flex items-center space-x-4",children:[u.jsx("input",{type:"text",placeholder:"Enter invite code",value:m,onChange:O=>g(O.target.value),className:"fantasy-input flex-1",disabled:l}),u.jsx("button",{onClick:w,className:"fantasy-button",disabled:l,children:l?"Joining...":"Join Party"})]})})]})]})}):null}const pR="https://dnd-v1-backend.onrender.com",Yt=async(t,e="gpt-4",n=1e3,r=.8)=>{try{const s=await fetch(`${pR}/api/openai`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t,model:e,max_tokens:n,temperature:r})});if(!s.ok){const o=await s.json();throw new Error(o.error||"Backend API request failed")}return await s.json()}catch(s){throw console.error("Backend API Error:",s),new Error(`Failed to communicate with backend: ${s.message}`)}};class mR{constructor(){this.systemPrompt=`You are an experienced Dungeon Master for Dungeons & Dragons 5th Edition. You excel at:
- Creating engaging storylines and plot hooks
- Developing detailed character descriptions and backstories
- Generating multiple story options and summarizing them
- Providing atmospheric descriptions and immersive storytelling
- Balancing combat encounters and managing game mechanics
- Creating memorable NPCs and villains
- Adapting to player choices and creating dynamic narratives

Always respond in character as a Dungeon Master, providing rich, descriptive content that enhances the gaming experience.`}async generateStoryPlots(e,n="",r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class} (${c.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const o=`As a Dungeon Master, I need you to generate 3 different story plot options for a D&D campaign.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

For each plot option, provide:
1. A compelling title
2. A brief summary (2-3 sentences)
3. The main conflict or challenge
4. Potential story hooks for the party
5. Estimated campaign length (short, medium, or long)

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:o}],"gpt-4",1e3,.8)).choices[0].message.content}catch(s){throw new Error(`Failed to generate story plots: ${s.message}`)}}async generateCharacterDetails(e){try{const n=`As a Dungeon Master, I need you to expand on this character's details and create a rich, detailed description.

Character: ${e.name} - Level ${e.level} ${e.race} ${e.class}
Background: ${e.background}
Alignment: ${e.alignment}
Personality: ${e.personality||"Not specified"}
Ideals: ${e.ideals||"Not specified"}
Bonds: ${e.bonds||"Not specified"}
Flaws: ${e.flaws||"Not specified"}
Backstory: ${e.backstory||"Not specified"}

Please provide:
1. A detailed physical description (appearance, mannerisms, distinctive features)
2. An expanded personality profile with quirks and habits
3. A deeper backstory with key events and relationships
4. Character motivations and goals
5. Potential story hooks and plot threads related to this character
6. How this character might interact with the party and world

Make the character feel alive and three-dimensional, with details that could drive story development.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:n}],"gpt-4",800,.7)).choices[0].message.content}catch(n){throw console.error("Error generating character details:",n),new Error(`Failed to generate character details: ${n.message}`)}}async generateStorySummary(e,n){try{const r=n.map(o=>`${o.name} (${o.race} ${o.class})`).join(", "),s=`As a Dungeon Master, I need you to create a detailed story summary and outline for this campaign plot.

Plot: ${e}
Party: ${r}

Please provide:
1. A detailed campaign overview (3-4 paragraphs)
2. Key story beats and major events
3. Important NPCs and their roles
4. Potential challenges and obstacles
5. Story themes and motifs
6. How each party member might be personally invested
7. Potential branching paths and player choices
8. Climactic moments and resolution possibilities

Make this feel like a professional campaign module with rich storytelling potential.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:s}],"gpt-4",1200,.7)).choices[0].message.content}catch(r){throw console.error("Error generating story summary:",r),new Error(`Failed to generate story summary: ${r.message}`)}}async generateMultipleStoryPlots(e,n="",r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class} (${c.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const o=`As a Dungeon Master, I need you to generate 5 different story plot options for a D&D campaign, each with a detailed summary.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

For each of the 5 plot options, provide:
1. A compelling title
2. A detailed summary (3-4 paragraphs)
3. The main conflict or challenge
4. Key story beats and major events
5. Important NPCs and their roles
6. Potential story hooks for the party
7. Estimated campaign length (short, medium, or long)
8. Themes and motifs
9. How each party member might be personally invested

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options. Number each plot clearly (Plot 1, Plot 2, etc.).`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:o}],"gpt-4",1200,.8)).choices[0].message.content}catch(s){throw console.error("Error generating multiple story plots:",s),new Error(`Failed to generate multiple story plots: ${s.message}`)}}async generateNPC(e,n=""){try{const r=`As a Dungeon Master, I need you to create a detailed NPC for my campaign.

Role: ${e}
Context: ${n||"General campaign use"}

Please provide:
1. Name and basic description
2. Personality and mannerisms
3. Background and motivations
4. Role in the story
5. How they might interact with the party
6. Potential plot hooks or quests they could offer
7. Any secrets or hidden agendas
8. Physical description and distinctive features

Make this NPC memorable and useful for advancing the story.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:r}],"gpt-4",600,.8)).choices[0].message.content}catch(r){throw console.error("Error generating NPC:",r),new Error(`Failed to generate NPC: ${r.message}`)}}async generateCombatEncounter(e,n,r="medium",s=""){try{const i=`As a Dungeon Master, I need you to design a combat encounter for my party.

Party Level: ${e}
Party Size: ${n} players
Difficulty: ${r}
Theme: ${s||"General fantasy"}

Please provide:
1. Encounter description and setup
2. Enemy composition and stats overview
3. Terrain and environmental factors
4. Tactical considerations
5. Potential complications or reinforcements
6. Rewards and loot suggestions
7. Story integration and aftermath
8. Alternative resolution methods (non-combat options)

Make this encounter balanced, engaging, and story-relevant.`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:i}],"gpt-4",800,.7)).choices[0].message.content}catch(i){throw console.error("Error generating combat encounter:",i),new Error(`Failed to generate combat encounter: ${i.message}`)}}async generateStoryContinuation(e,n,r,s="individual",i=null){try{const o=e.map(m=>`${m.name} - Level ${m.level} ${m.race} ${m.class}`).join(", "),l=n.map(m=>({role:m.role,content:m.content}));let c="";i&&(c=`
Party Theme: ${i.description||"No theme provided"}`);const d=`As a Dungeon Master, continue the story based on the player's response.

Party: ${o}${c}
Player Response: "${r}" (Type: ${s})
Response Type Context:
- individual: One character's personal action
- team: Group action or decision
- investigate: Looking for clues or information
- combat: Combat-related action
- social: Social interaction or diplomacy

Previous Story Context:
${l.map(m=>`${m.role==="assistant"?"DM":"Player"}: ${m.content}`).join(`
`)}

Important Guidelines:
- Use the party theme to influence the atmosphere and tone of the story
- Incorporate themes and elements from the party theme to maintain narrative consistency
- Consider how the party's background and composition might influence NPC reactions and story developments
- Focus on the characters and their individual stories
- The story should feel cohesive with the established theme

Please provide a compelling continuation that:
1. Acknowledges the player's action and its consequences
2. Advances the story naturally and creates new opportunities
3. Maintains the campaign's tone and pacing
4. Considers the response type and party composition
5. Ends with a clear situation that invites the next player to respond
6. Encourages character interaction and roleplay
7. Provides multiple possible directions for the party to explore

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.`;return(await Yt([{role:"system",content:this.systemPrompt},...l,{role:"user",content:d}],"gpt-4",800,.8)).choices[0].message.content}catch(o){throw console.error("Error generating story continuation:",o),new Error(`Failed to generate story continuation: ${o.message}`)}}async generatePlotOptions(e,n=null){try{const r=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class}. ${c.personality||""}. ${c.backstory||""}`).join(`
`);let s="";n&&(s=`
Party Theme: ${n.description||"No theme provided"}`);const i="You are a Dungeon Master for D&D 5e. You MUST generate exactly 3 plot options, no more, no less. Follow the exact format provided. Do not use party names in the plots. Keep summaries brief (1-2 sentences maximum). DO NOT repeat plots or generate duplicates.",o=`Generate exactly 3 distinct campaign plot options for this party. 

REQUIRED FORMAT - Follow this exact structure:

Plot 1: [Title]
[Brief summary - 1-2 sentences maximum]

Plot 2: [Title]  
[Brief summary - 1-2 sentences maximum]

Plot 3: [Title]
[Brief summary - 1-2 sentences maximum]

Party: ${r}${s}

CRITICAL REQUIREMENTS:
- Generate EXACTLY 3 plots, no more, no less
- Use the party theme to influence the plot lines and atmosphere
- Do NOT use the party name in the plots - focus on the characters and theme
- Each summary must be 1-2 sentences maximum
- Follow the exact format above with "Plot 1:", "Plot 2:", "Plot 3:" labels
- Do not add any additional text, explanations, or formatting
- Do not repeat or duplicate any plots
- Stop after Plot 3 - do not generate more plots

Make each plot distinct and appealing to different play styles.`;return(await Yt([{role:"system",content:i},{role:"user",content:o}],"gpt-4",600,.8)).choices[0].message.content}catch(r){throw console.error("Error generating plot options:",r),new Error(`Failed to generate plot options: ${r.message}`)}}async generateStoryIntroduction(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}. ${d.personality||""}. ${d.backstory||""}`).join(`
`);let o="";s&&(o=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create an engaging story introduction for the beginning of this campaign.

Party: ${i}${o}
Selected Plot: Plot ${r}
Plot Details: ${n}

Create an introduction that includes:
1. A vivid description of the starting town/settlement where the party begins
2. How each character arrives or is already present in this location
3. The initial situation or hook that draws the party together
4. A sense of atmosphere and setting that matches the chosen plot
5. An opening scene that gives the party their first decision or action to take

Important Guidelines:
- Use the party theme to influence the atmosphere and context
- Incorporate themes and elements from the party theme to create atmosphere and context
- Consider how the party's background and composition might influence the starting situation
- Focus on the characters and their individual stories
- The story should feel cohesive with the established theme

Make this feel like the opening of an epic adventure. Set the tone, establish the setting, and give the party a clear starting point. End with a situation that requires the party to make a choice or take action.

Keep the introduction engaging but concise (3-4 paragraphs maximum).`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",800,.8)).choices[0].message.content}catch(i){throw console.error("Error generating story introduction:",i),new Error(`Failed to generate story introduction: ${i.message}`)}}async generateStructuredStoryResponse(e,n,r,s,i,o=null){try{const l=e.map(S=>`${S.name} - Level ${S.level} ${S.race} ${S.class}`).join(", "),c=n.map(S=>({role:S.role,content:S.content}));let d="";o&&(d=`
Party Theme: ${o.description||"No theme provided"}`);const p=i.length>0?`
Discovered Objectives: ${i.map(S=>S.title).join(", ")}`:"",m=`As a Dungeon Master, continue the story based on the player's response, considering the current story phase and discovered objectives.

Party: ${l}${d}
Current Phase: ${s}
Player Response: "${r}"${p}

Story Phases:
- Investigation: Focus on discovery, clues, and gathering information
- Conflict: Focus on tension, threats, and potential combat
- Resolution: Focus on choices, consequences, and story conclusion

Previous Story Context:
${c.map(S=>`${S.role==="assistant"?"DM":"Player"}: ${S.content}`).join(`
`)}

Guidelines for ${s} Phase:
${s==="Investigation"?`- Encourage exploration and discovery
- Provide subtle clues and hints
- Create opportunities for investigation
- Build mystery and intrigue`:s==="Conflict"?`- Increase tension and stakes
- Present clear threats or challenges
- Create opportunities for combat or diplomacy
- Force difficult choices`:`- Provide clear resolution paths
- Show consequences of previous choices
- Allow for meaningful conclusions
- Tie up loose ends`}

Important Guidelines:
- Use the party theme to influence the atmosphere and tone
- Consider discovered objectives when crafting responses
- Maintain story coherence and logical progression
- Provide multiple possible directions for the party
- End with a situation that invites the next player to respond
- Keep responses engaging but concise (2-3 paragraphs maximum)

Remember that objectives are discovered organically through player actions, not explicitly mentioned.`;return(await Yt([{role:"system",content:this.systemPrompt},...c,{role:"user",content:m}],"gpt-4",800,.8)).choices[0].message.content}catch(l){throw console.error("Error generating structured story response:",l),new Error(`Failed to generate structured story response: ${l.message}`)}}async generatePhaseTransition(e,n,r,s=null){try{const i=e.map(p=>`${p.name} - Level ${p.level} ${p.race} ${p.class}`).join(", ");let o="";s&&(o=`
Party Theme: ${s.description||"No theme provided"}`);const l=n==="Investigation"?"Conflict":"Resolution",c=`As a Dungeon Master, create a natural transition from the ${n} phase to the ${l} phase of the story.

Party: ${i}${o}
Current Phase: ${n}
Next Phase: ${l}
Story Progress: ${r}

Create a transition that:
1. Acknowledges the party's progress and discoveries
2. Naturally escalates or resolves the situation
3. Introduces new challenges or opportunities appropriate to the ${l} phase
4. Maintains the story's momentum and engagement
5. Provides clear direction for the party's next actions

Phase Transition Guidelines:
${l==="Conflict"?`- Escalate the situation with a clear threat or challenge
- Introduce enemies, obstacles, or time pressure
- Create urgency and stakes
- Provide opportunities for combat or diplomacy`:`- Present clear resolution paths based on previous choices
- Show consequences of the party's actions
- Allow for meaningful conclusions
- Provide closure to the current story arc`}

Important Guidelines:
- Use the party theme to influence the transition's tone
- Make the transition feel natural and earned
- Maintain story coherence and logical progression
- Provide multiple possible directions for the party
- Keep the transition engaging but concise (2-3 paragraphs maximum)`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:c}],"gpt-4",600,.8)).choices[0].message.content}catch(i){throw console.error("Error generating phase transition:",i),new Error(`Failed to generate phase transition: ${i.message}`)}}async generateObjectiveCompletion(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let o="";s&&(o=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, acknowledge the completion of an objective and show its impact on the story.

Party: ${i}${o}
Completed Objective: ${n.title}
Objective Type: ${n.type}
Story Context: ${r}

Create a response that:
1. Acknowledges the party's success in completing the objective
2. Shows the immediate consequences and impact
3. Reveals new information or opportunities
4. Maintains story momentum and engagement
5. Provides direction for the party's next actions

Objective Completion Guidelines:
- Show how the completed objective affects the story
- Reveal new information, NPCs, or opportunities
- Maintain the story's tone and atmosphere
- Provide clear next steps for the party
- Keep the response engaging but concise (2-3 paragraphs maximum)

Important Guidelines:
- Use the party theme to influence the completion's tone
- Make the completion feel meaningful and impactful
- Maintain story coherence and logical progression
- Provide multiple possible directions for the party
- Don't explicitly mention "objectives" - make it feel natural`;return(await Yt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",600,.8)).choices[0].message.content}catch(i){throw console.error("Error generating objective completion:",i),new Error(`Failed to generate objective completion: ${i.message}`)}}}const Un=new mR;function gR({partyCharacters:t,onStoryGenerated:e,onCharacterDetailsGenerated:n,partyInfo:r=null}){const[s,i]=D.useState("plots"),[o,l]=D.useState(!1),[c,d]=D.useState(""),[p,m]=D.useState(""),[g,S]=D.useState(""),[C,k]=D.useState(""),[R,I]=D.useState(""),[w,b]=D.useState(""),[M,O]=D.useState({partyLevel:1,partySize:t.length,difficulty:"medium",theme:""}),V=async()=>{if(t.length===0){d("No party characters available. Please create characters first.");return}l(!0),d("");try{const N=await Un.generateStoryPlots(t,g,r);m(N),e&&e(N)}catch{d("Failed to generate story plots. Please check your API key and try again.")}finally{l(!1)}},_=async()=>{if(t.length===0){d("No party characters available. Please create characters first.");return}l(!0),d("");try{const N=await Un.generateMultipleStoryPlots(t,g,r);m(N),e&&e(N)}catch{d("Failed to generate story plots. Please check your API key and try again.")}finally{l(!1)}},y=async()=>{if(!C){d("Please select a character first.");return}const N=t.find(T=>T.id===C);if(!N){d("Selected character not found.");return}l(!0),d("");try{const T=await Un.generateCharacterDetails(N);m(T),n&&n(N.id,T)}catch{d("Failed to generate character details. Please check your API key and try again.")}finally{l(!1)}},x=async()=>{if(!R.trim()){d("Please enter an NPC role.");return}l(!0),d("");try{const N=await Un.generateNPC(R,w);m(N)}catch{d("Failed to generate NPC. Please check your API key and try again.")}finally{l(!1)}},E=async()=>{l(!0),d("");try{const N=await Un.generateCombatEncounter(M.partyLevel,M.partySize,M.difficulty,M.theme);m(N)}catch{d("Failed to generate encounter. Please check your API key and try again.")}finally{l(!1)}},P=[{id:"plots",label:"Story Plots",icon:"📖"},{id:"characters",label:"Character Details",icon:"👤"},{id:"npcs",label:"NPCs",icon:"🏰"},{id:"encounters",label:"Combat Encounters",icon:"⚔️"}];return u.jsxs("div",{className:"fantasy-card",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h2",{className:"fantasy-title mb-0",children:"🤖 AI Dungeon Master"}),u.jsx("div",{className:"text-sm text-stone-600",children:"Powered by ChatGPT"})]}),u.jsx("div",{className:"flex space-x-1 mb-6 bg-stone-100 p-1 rounded-lg",children:P.map(N=>u.jsxs("button",{onClick:()=>i(N.id),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center space-x-2 ${s===N.id?"bg-amber-600 text-white":"text-stone-600 hover:text-stone-800"}`,children:[u.jsx("span",{children:N.icon}),u.jsx("span",{children:N.label})]},N.id))}),c&&u.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:c}),s==="plots"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Setting (Optional)"}),u.jsx("textarea",{value:g,onChange:N=>S(N.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your campaign setting, world, or any specific themes..."})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsx("button",{onClick:V,disabled:o||t.length===0,className:"fantasy-button",children:o?"Generating...":"Generate Basic Plots"}),u.jsx("button",{onClick:_,disabled:o||t.length===0,className:"fantasy-button bg-amber-700 hover:bg-amber-800",children:o?"Generating...":"Generate Detailed Plots"})]}),u.jsxs("div",{className:"text-sm text-stone-600 text-center",children:[u.jsxs("p",{children:[u.jsx("strong",{children:"Basic Plots:"})," 3 plot options with brief summaries"]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Detailed Plots:"})," 5 plot options with full story summaries and character integration"]})]}),t.length===0&&u.jsx("p",{className:"text-sm text-stone-600 text-center",children:"Create party characters first to generate story plots."})]}),s==="characters"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Select Character"}),u.jsxs("select",{value:C,onChange:N=>k(N.target.value),className:"fantasy-input",children:[u.jsx("option",{value:"",children:"Choose a character..."}),t.map(N=>u.jsxs("option",{value:N.id,children:[N.name," - ",N.race," ",N.class]},N.id))]})]}),u.jsx("button",{onClick:y,disabled:o||!C,className:"fantasy-button w-full",children:o?"Generating Details...":"Generate Character Details"})]}),s==="npcs"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"NPC Role"}),u.jsx("input",{type:"text",value:R,onChange:N=>I(N.target.value),className:"fantasy-input",placeholder:"e.g., Town Mayor, Mysterious Wizard, Bandit Leader..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Context (Optional)"}),u.jsx("textarea",{value:w,onChange:N=>b(N.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe the context, location, or situation..."})]}),u.jsx("button",{onClick:x,disabled:o||!R.trim(),className:"fantasy-button w-full",children:o?"Generating NPC...":"Generate NPC"})]}),s==="encounters"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Party Level"}),u.jsx("input",{type:"number",min:"1",max:"20",value:M.partyLevel,onChange:N=>O(T=>({...T,partyLevel:parseInt(N.target.value)})),className:"fantasy-input"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Party Size"}),u.jsx("input",{type:"number",min:"1",max:"10",value:M.partySize,onChange:N=>O(T=>({...T,partySize:parseInt(N.target.value)})),className:"fantasy-input"})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Difficulty"}),u.jsxs("select",{value:M.difficulty,onChange:N=>O(T=>({...T,difficulty:N.target.value})),className:"fantasy-input",children:[u.jsx("option",{value:"easy",children:"Easy"}),u.jsx("option",{value:"medium",children:"Medium"}),u.jsx("option",{value:"hard",children:"Hard"}),u.jsx("option",{value:"deadly",children:"Deadly"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Theme (Optional)"}),u.jsx("input",{type:"text",value:M.theme,onChange:N=>O(T=>({...T,theme:N.target.value})),className:"fantasy-input",placeholder:"e.g., Forest ambush, Dungeon crawl..."})]})]}),u.jsx("button",{onClick:E,disabled:o,className:"fantasy-button w-full",children:o?"Generating Encounter...":"Generate Combat Encounter"})]}),p&&u.jsxs("div",{className:"mt-8",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Generated Content"}),u.jsx("button",{onClick:()=>m(""),className:"text-sm text-stone-600 hover:text-stone-800",children:"Clear"})]}),u.jsx("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:u.jsx("div",{className:"prose prose-sm max-w-none",children:u.jsx("pre",{className:"whitespace-pre-wrap text-stone-800 font-sans text-sm leading-relaxed",children:p})})})]})]})}function yR(){const{partyId:t}=Vc(),e=jn(),[n,r]=D.useState(null),[s,i]=D.useState(null),[o,l]=D.useState([]),[c,d]=D.useState(null),[p,m]=D.useState(!0),[g,S]=D.useState("story"),[C,k]=D.useState({title:"",description:"",chapters:[]}),[R,I]=D.useState({image:"/placeholder-map.png",description:""});D.useEffect(()=>{const _=Qr(y=>{if(!y){e("/login");return}r(y),t&&w(y.uid,t)});return()=>_()},[e,t]);const w=async(_,y)=>{try{m(!0);const[x,E,P]=await Promise.all([$x(_,y),bp(y),Bx(y)]);i(x),l(E),d(P)}catch{}finally{m(!1)}},b=[{id:"story",label:"Story Planning"},{id:"ai-dm",label:"🤖 AI Dungeon Master"},{id:"map",label:"Campaign Map"},{id:"characters",label:"Party Characters"},{id:"enemies",label:"Enemies & NPCs"}],M=()=>{const _={id:Date.now(),title:"",description:"",objectives:[],completed:!1};k(y=>({...y,chapters:[...y.chapters,_]}))},O=(_,y,x)=>{k(E=>({...E,chapters:E.chapters.map(P=>P.id===_?{...P,[y]:x}:P)}))},V=_=>{const y={id:Date.now(),description:"",completed:!1};O(_,"objectives",[...C.chapters.find(x=>x.id===_).objectives,y])};return!n||p?u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsx("div",{className:"text-center py-8",children:u.jsx("p",{className:"text-stone-600",children:"Loading..."})})})}):s?u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h1",{className:"fantasy-title mb-0",children:"Campaign Management"}),u.jsxs("div",{className:"text-sm text-stone-600",children:["Playing as: ",u.jsx("span",{className:"font-medium",children:s.name})]})]}),u.jsx("div",{className:"flex space-x-1 mb-6 bg-stone-100 p-1 rounded-lg",children:b.map(_=>u.jsx("button",{onClick:()=>S(_.id),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${g===_.id?"bg-amber-600 text-white":"text-stone-600 hover:text-stone-800"}`,children:_.label},_.id))}),g==="story"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Title"}),u.jsx("input",{type:"text",value:C.title,onChange:_=>k(y=>({...y,title:_.target.value})),className:"fantasy-input",placeholder:"Enter campaign title..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Description"}),u.jsx("textarea",{value:C.description,onChange:_=>k(y=>({...y,description:_.target.value})),className:"fantasy-input",rows:"4",placeholder:"Describe your campaign's main plot..."})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800",children:"Chapters"}),u.jsx("button",{onClick:M,className:"fantasy-button",children:"Add Chapter"})]}),u.jsx("div",{className:"space-y-4",children:C.chapters.map(_=>u.jsxs("div",{className:"fantasy-card bg-amber-50",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[u.jsx("input",{type:"text",value:_.title,onChange:y=>O(_.id,"title",y.target.value),className:"fantasy-input",placeholder:"Chapter title..."}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:_.completed,onChange:y=>O(_.id,"completed",y.target.checked),className:"mr-2"}),u.jsx("label",{className:"text-sm font-medium text-stone-700",children:"Completed"})]})]}),u.jsx("textarea",{value:_.description,onChange:y=>O(_.id,"description",y.target.value),className:"fantasy-input mb-4",rows:"3",placeholder:"Chapter description..."}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx("h4",{className:"font-medium text-stone-800",children:"Objectives"}),u.jsx("button",{onClick:()=>V(_.id),className:"fantasy-button text-sm",children:"Add Objective"})]}),u.jsx("div",{className:"space-y-2",children:_.objectives.map(y=>u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("input",{type:"checkbox",checked:y.completed,onChange:x=>{const E=_.objectives.map(P=>P.id===y.id?{...P,completed:x.target.checked}:P);O(_.id,"objectives",E)}}),u.jsx("input",{type:"text",value:y.description,onChange:x=>{const E=_.objectives.map(P=>P.id===y.id?{...P,description:x.target.value}:P);O(_.id,"objectives",E)},className:"fantasy-input flex-1",placeholder:"Objective description..."})]},y.id))})]})]},_.id))})]})]}),g==="ai-dm"&&u.jsx(gR,{partyCharacters:o,partyInfo:c,onStoryGenerated:_=>{},onCharacterDetailsGenerated:(_,y)=>{}}),g==="map"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Campaign Map"}),u.jsxs("div",{className:"bg-stone-200 rounded-lg p-8 text-center",children:[u.jsx("div",{className:"w-full h-64 bg-stone-300 rounded-lg flex items-center justify-center mb-4",children:u.jsx("span",{className:"text-stone-500",children:"Map Placeholder"})}),u.jsx("button",{className:"fantasy-button",children:"Upload Map Image"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Map Description"}),u.jsx("textarea",{value:R.description,onChange:_=>I(y=>({...y,description:_.target.value})),className:"fantasy-input",rows:"4",placeholder:"Describe the locations and points of interest on your map..."})]})]}),g==="characters"&&u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Party Characters"}),o.length===0?u.jsx("div",{className:"text-center py-8 text-stone-600",children:u.jsx("p",{children:"No characters have been created yet."})}):u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:o.map(_=>u.jsx("div",{className:"fantasy-card bg-amber-50",children:u.jsxs("div",{className:"flex items-start space-x-4",children:[u.jsx("div",{className:"w-16 h-16 bg-stone-300 rounded-lg flex items-center justify-center",children:u.jsx("span",{className:"text-xs text-stone-600",children:"IMG"})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h4",{className:"font-bold text-stone-800",children:_.name}),u.jsxs("p",{className:"text-sm text-stone-600",children:["Level ",_.level," ",_.race," ",_.class]}),u.jsxs("p",{className:"text-sm text-stone-600 mt-1",children:[_.background," • ",_.alignment]})]})]})},_.id))})]}),g==="enemies"&&u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Enemies & NPCs"}),u.jsx("div",{className:"text-center py-8 text-stone-600",children:u.jsx("p",{children:"Enemy and NPC management will be available here."})})]})]})}):u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card",children:[u.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),u.jsxs("div",{className:"text-center py-8",children:[u.jsx("p",{className:"text-stone-600 mb-6",children:"You need to create a character before you can access the campaign."}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("button",{onClick:()=>e(`/character-creation/${t}`),className:"fantasy-button text-lg px-8 py-3",children:"Create Character"}),u.jsx("button",{onClick:()=>e("/party-management"),className:"fantasy-button text-lg px-8 py-3 bg-stone-600 hover:bg-stone-700",children:"Back to Parties"})]})]})]})})}function vR(){var Ye,G,te;const{partyId:t}=Vc(),e=jn(),[n,r]=D.useState(null),[s,i]=D.useState(null),[o,l]=D.useState(!0),[c,d]=D.useState([]),[p,m]=D.useState(null),[g,S]=D.useState(null),[C,k]=D.useState("");D.useEffect(()=>{const A=Qr(H=>{if(!H){e("/login");return}r(H)});return()=>A()},[e]),D.useEffect(()=>{n&&t&&R()},[n,t]),D.useEffect(()=>{if(t){const A=zx(t,H=>{i(H),l(!1)});return()=>A()}},[t]);const R=async()=>{try{l(!0);const A=await tR(t),H=await bp(t);if(d(H),!A){console.log("No combat session found, navigating to story with partyId:",t);try{e(`/campaign-story/${t}`)}catch(Z){console.error("Navigation error in loadCombatData:",Z),e("/dashboard")}return}if(A.enemies&&A.enemies.length===0){i({...A,status:"no_enemies"});return}i(A)}catch(A){console.error("Error loading combat data:",A)}finally{l(!1)}},I=(A,H)=>{const Z={goblin:{name:"Goblin",hp:12,ac:14,level:1,charisma:8},orc:{name:"Orc",hp:30,ac:16,level:3,charisma:12},troll:{name:"Troll",hp:84,ac:15,level:5,charisma:7},dragon:{name:"Dragon",hp:200,ac:19,level:10,charisma:19},bandit:{name:"Bandit",hp:16,ac:12,level:1,charisma:10},skeleton:{name:"Skeleton",hp:13,ac:13,level:1,charisma:5},zombie:{name:"Zombie",hp:22,ac:8,level:1,charisma:3}},q=A.toLowerCase();let oe="bandit";q.includes("goblin")?oe="goblin":q.includes("orc")?oe="orcs":q.includes("troll")?oe="troll":q.includes("dragon")?oe="dragon":q.includes("undead")||q.includes("skeleton")?oe="skeleton":q.includes("zombie")&&(oe="zombie");const de=Z[oe],je=Math.min(H+1,6),De=[];for(let F=0;F<je;F++)De.push({id:`enemy_${F}`,name:`${de.name} ${F+1}`,type:de.name,hp:de.hp+Math.floor(Math.random()*10),maxHp:de.hp+Math.floor(Math.random()*10),ac:de.ac+Math.floor(Math.random()*3),initiative:Math.floor(Math.random()*20)+1,charisma:de.charisma,portrait:"/placeholder-enemy.png"});return De},w=async()=>{if(!s)return;let A=s.enemies;(!A||A.length===0)&&(A=I(s.storyContext,s.partyMembers.length));const Z=[...s.partyMembers,...A].sort((q,oe)=>oe.initiative-q.initiative);await Ls(s.id,{enemies:A,initiative:Z,currentTurn:0,combatState:"active"})},b=async()=>{if(!s)return;const A=(s.currentTurn+1)%s.initiative.length;await Ls(s.id,{currentTurn:A}),m(null),S(null),k("")},M=async()=>{if(!s)return;const A=(s.currentTurn-1+s.initiative.length)%s.initiative.length;await Ls(s.id,{currentTurn:A}),m(null),S(null),k("")},O=async()=>{if(s){await Ls(s.id,{status:"ended",combatState:"ended"}),await Tn(t,{status:"storytelling",currentCombat:null});try{console.log("Ending combat, navigating to story with partyId:",t),e(`/campaign-story/${t}`)}catch(A){console.error("Navigation error in endCombat:",A),e("/dashboard")}}},V=async(A,H)=>{if(!s)return;const Z=Math.max(0,H);if(A.startsWith("enemy_")){const q=s.enemies.map(oe=>oe.id===A?{...oe,hp:Z}:oe);await Ls(s.id,{enemies:q})}else{const q=s.partyMembers.map(oe=>oe.id===A?{...oe,hp:Z}:oe);await Ls(s.id,{partyMembers:q})}},_=()=>!(s!=null&&s.initiative)||s.currentTurn===void 0?null:s.initiative[s.currentTurn],y=()=>{const A=_();return A&&A.userId===(n==null?void 0:n.uid)},x=()=>c.find(A=>A.userId===(n==null?void 0:n.uid)),E=async(A,H)=>{if(!s||!A||!H)return;const Z=x();if(!Z)return;const q=Math.floor(Math.random()*20)+1,oe=Math.floor((Z.strength-10)/2),de=q+oe;let je=`${Z.name} attacks ${H.name} with ${A}...
`;if(je+=`Attack roll: ${q} + ${oe} = ${de} vs AC ${H.ac}
`,de>=H.ac){const De=Math.floor(Math.random()*8)+1+oe,F=Math.max(0,H.hp-De);je+=`HIT! Deals ${De} damage. ${H.name} HP: ${H.hp} → ${F}`,await V(H.id,F)}else je+="MISS! The attack misses.";k(je),setTimeout(()=>{k(""),b()},3e3)},P=async(A,H)=>{if(!s||!A||!H)return;const Z=x();if(!Z)return;let q=`${Z.name} casts ${A.name} on ${H.name}...
`;q+=`${A.description}
`;const oe=Math.floor(Math.random()*6)+1,de=Math.max(0,H.hp-oe);q+=`Deals ${oe} damage. ${H.name} HP: ${H.hp} → ${de}`,await V(H.id,de),k(q),setTimeout(()=>{k(""),b()},3e3)},N=async A=>{if(!s||!A)return;const H=x();if(!H)return;const Z=Math.floor((H.charisma-10)/2),q=Math.floor(Math.random()*20)+1+Z,oe=A.charisma+10;let de=`${H.name} attempts to persuade ${A.name}...
`;de+=`Charisma modifier: ${Z}
`,de+=`Persuasion roll: ${q} vs DC ${oe}
`,q>=oe?de+=`SUCCESS! ${A.name} is persuaded and may consider peaceful resolution.`:de+=`FAILURE! ${A.name} is not persuaded and remains hostile.`,k(de),setTimeout(()=>{k(""),b()},3e3)},T=async(A,H)=>{if(!s||!A||!H)return;const Z=x();if(!Z)return;let q=`${Z.name} uses ${A} on ${H.name}...
`;if(A.toLowerCase().includes("healing")||A.toLowerCase().includes("potion")){const oe=Math.floor(Math.random()*8)+1,de=Math.min(H.maxHp,H.hp+oe);q+=`Heals ${oe} HP. ${H.name} HP: ${H.hp} → ${de}`,await V(H.id,de)}else q+=`Uses ${A} but it has no combat effect.`;k(q),setTimeout(()=>{k(""),b()},3e3)};if(!n)return null;if(o)return u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsxs("div",{className:"text-center py-8",children:[u.jsx("div",{className:"text-stone-600 mb-4",children:"⚔️ Setting up battle arena..."}),u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-stone-600 mx-auto"})]})})});if(!s)return u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsxs("div",{className:"text-center py-8",children:[u.jsx("div",{className:"text-stone-600",children:"No active combat session found."}),u.jsx("button",{onClick:async()=>{await Tn(t,{status:"storytelling",currentCombat:null});try{console.log("Returning to story from no combat session, partyId:",t),e(`/campaign-story/${t}`)}catch(A){console.error("Navigation error in return to story:",A),e("/dashboard")}},className:"fantasy-button mt-4",children:"Return to Story"})]})})});if(s.status==="no_enemies"||s.enemies&&s.enemies.length===0){const[A,H]=D.useState(!1);return u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsxs("div",{className:"text-center py-8",children:[u.jsx("div",{className:"text-4xl mb-4",children:"🕊️"}),u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"No Enemies to Fight"}),u.jsx("p",{className:"text-stone-600 mb-6",children:"There are no enemies present in this area. Combat cannot begin."}),u.jsx("div",{className:"space-y-3",children:u.jsx("button",{onClick:async()=>{if(!A){H(!0);try{await Tn(t,{status:"storytelling",currentCombat:null}),e(`/campaign-story/${t}`)}catch(Z){console.error("Error returning to story:",Z);try{e(`/campaign-story/${t}`)}catch(q){console.error("Navigation also failed:",q),e("/dashboard")}}finally{H(!1)}}},className:"fantasy-button",disabled:A,children:A?"Returning...":"Return to Story"})})]})})})}const _e=_(),mt=y(),Qe=x();return u.jsx("div",{className:"min-h-screen bg-gradient-to-b from-blue-400 via-blue-500 to-blue-600 p-4",children:u.jsxs("div",{className:"max-w-7xl mx-auto",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h1",{className:"text-3xl font-bold text-white drop-shadow-lg",children:"⚔️ Battle Arena"}),u.jsxs("div",{className:"space-x-2",children:[s.combatState==="preparation"&&u.jsx("button",{onClick:w,className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"🚀 Start Battle"}),s.combatState==="active"&&u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:M,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"⬅️ Previous"}),u.jsx("button",{onClick:b,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"Next ➡️"}),u.jsx("button",{onClick:O,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"🏁 End Battle"})]}),s.storyContext&&u.jsx("button",{onClick:async()=>{await Tn(t,{status:"storytelling",currentCombat:null});try{console.log("Returning to story from combat header, partyId:",t),e(`/campaign-story/${t}`)}catch(A){console.error("Navigation error in return to story:",A),e("/dashboard")}},className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"📖 Return to Story"})]})]}),s.storyContext&&u.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-4 mb-6 shadow-lg",children:[u.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Battle Context"}),u.jsx("p",{className:"text-gray-700 italic",children:s.storyContext})]}),s.combatState==="active"&&u.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-4 mb-6 shadow-lg",children:[u.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-3",children:"🎯 Turn Order"}),u.jsx("div",{className:"flex flex-wrap gap-3",children:s.initiative.map((A,H)=>u.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${H===s.currentTurn?"bg-yellow-400 text-yellow-900 shadow-lg scale-105":"bg-gray-200 text-gray-700"}`,children:[u.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border-2 ${A.userId?"bg-blue-200 border-blue-400":"bg-red-200 border-red-400"}`,children:u.jsx("span",{className:"font-bold text-xs",children:A.name.charAt(0)})}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-bold",children:["#",H+1]}),u.jsx("div",{className:"text-xs",children:A.name})]})]},A.id))})]}),s.combatState==="active"&&_e&&u.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-4 mb-6 shadow-lg",children:[u.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-3",children:mt?"🎮 Your Turn!":"⏳ Waiting..."}),u.jsxs("div",{className:"flex items-center space-x-4",children:[u.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center border-4 ${_e.userId?"bg-blue-200 border-blue-400":"bg-red-200 border-red-400"}`,children:u.jsx("span",{className:"font-bold text-xl",children:_e.name.charAt(0)})}),u.jsxs("div",{children:[u.jsx("div",{className:"font-bold text-xl",children:_e.name}),u.jsx("div",{className:"text-gray-600",children:_e.class||_e.type}),u.jsxs("div",{className:"text-sm text-gray-500",children:["HP: ",_e.hp,"/",_e.maxHp]})]})]})]}),mt&&Qe&&u.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-6 mb-6 shadow-lg",children:[u.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Choose Your Action"}),p?u.jsxs("div",{className:"space-y-4",children:[p==="attack"&&u.jsxs("div",{children:[u.jsx("h4",{className:"font-bold text-gray-800 mb-3",children:"⚔️ Choose Your Attack"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[u.jsxs("div",{children:[u.jsx("h5",{className:"font-semibold text-gray-700 mb-2",children:"Weapons:"}),u.jsx("div",{className:"space-y-2",children:(Ye=Qe.equipment)==null?void 0:Ye.filter(A=>A.toLowerCase().includes("sword")||A.toLowerCase().includes("axe")||A.toLowerCase().includes("bow")||A.toLowerCase().includes("dagger")||A.toLowerCase().includes("mace")||A.toLowerCase().includes("spear")).map(A=>u.jsx("button",{onClick:()=>S({type:"weapon",item:A}),className:"w-full text-left bg-gray-100 hover:bg-gray-200 p-2 rounded transition-colors",children:A},A))})]}),u.jsxs("div",{children:[u.jsx("h5",{className:"font-semibold text-gray-700 mb-2",children:"Spells:"}),u.jsx("div",{className:"space-y-2",children:(G=Qe.spells)==null?void 0:G.map(A=>u.jsx("button",{onClick:()=>S({type:"spell",item:A}),className:"w-full text-left bg-purple-100 hover:bg-purple-200 p-2 rounded transition-colors",children:A.name},A.name))})]})]})]}),p==="inventory"&&u.jsxs("div",{children:[u.jsx("h4",{className:"font-bold text-gray-800 mb-3",children:"🎒 Choose Item to Use"}),u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4",children:(te=Qe.equipment)==null?void 0:te.map(A=>u.jsx("button",{onClick:()=>S({type:"item",item:A}),className:"bg-green-100 hover:bg-green-200 p-3 rounded transition-colors",children:A},A))})]}),p==="persuade"&&u.jsxs("div",{children:[u.jsx("h4",{className:"font-bold text-gray-800 mb-3",children:"💬 Choose Target to Persuade"}),u.jsxs("p",{className:"text-gray-600 mb-4",children:["Your Charisma: ",Qe.charisma," (Modifier: ",Math.floor((Qe.charisma-10)/2),")"]})]}),g&&u.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[u.jsx("h5",{className:"font-semibold text-gray-800 mb-3",children:"Select Target:"}),u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:s.enemies.map(A=>u.jsxs("button",{onClick:()=>{p==="attack"?g.type==="weapon"?E(g.item,A):g.type==="spell"&&P(g.item,A):p==="inventory"?T(g.item,A):p==="persuade"&&N(A)},className:"bg-red-100 hover:bg-red-200 p-3 rounded transition-colors text-left",children:[u.jsx("div",{className:"font-semibold",children:A.name}),u.jsxs("div",{className:"text-sm text-gray-600",children:["HP: ",A.hp,"/",A.maxHp]})]},A.id))})]}),u.jsx("button",{onClick:()=>{m(null),S(null)},className:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg",children:"← Back"})]}):u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[u.jsx("button",{onClick:()=>m("attack"),className:"bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg transition-colors",children:"⚔️ Attack"}),u.jsx("button",{onClick:()=>m("inventory"),className:"bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg transition-colors",children:"🎒 Inventory"}),u.jsx("button",{onClick:()=>m("persuade"),className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg transition-colors",children:"💬 Speak/Persuade"})]})]}),C&&u.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-4 mb-6 shadow-lg",children:[u.jsx("h4",{className:"font-bold text-gray-800 mb-2",children:"Action Result:"}),u.jsx("pre",{className:"whitespace-pre-wrap text-gray-700 bg-gray-100 p-3 rounded",children:C})]}),u.jsx("div",{className:"bg-gradient-to-b from-green-300 via-green-400 to-green-500 rounded-2xl p-6 shadow-2xl border-4 border-green-600",children:u.jsxs("div",{className:"relative h-96 mb-6",children:[u.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-green-200 to-green-300 rounded-xl"}),u.jsx("div",{className:"absolute left-4 bottom-4 w-1/2",children:u.jsx("div",{className:"grid grid-cols-2 gap-4",children:s.partyMembers.map((A,H)=>u.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-3 shadow-lg border-2 border-blue-300",children:u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("div",{className:"w-12 h-12 bg-blue-200 rounded-full flex items-center justify-center border-2 border-blue-400",children:u.jsx("span",{className:"text-blue-800 font-bold text-sm",children:A.name.charAt(0)})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("div",{className:"font-bold text-gray-800 text-sm",children:A.name}),u.jsx("div",{className:"text-xs text-gray-600",children:A.class}),u.jsxs("div",{className:"mt-1",children:[u.jsx("div",{className:"bg-red-200 rounded-full h-2",children:u.jsx("div",{className:"bg-red-500 h-2 rounded-full transition-all duration-300",style:{width:`${A.hp/A.maxHp*100}%`}})}),u.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["HP: ",A.hp,"/",A.maxHp]})]})]})]})},A.id))})}),u.jsx("div",{className:"absolute right-4 top-4 w-1/2",children:u.jsx("div",{className:"grid grid-cols-2 gap-4",children:s.enemies.map((A,H)=>u.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-3 shadow-lg border-2 border-red-300",children:u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("div",{className:"w-12 h-12 bg-red-200 rounded-full flex items-center justify-center border-2 border-red-400",children:u.jsx("span",{className:"text-red-800 font-bold text-sm",children:A.name.charAt(0)})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("div",{className:"font-bold text-gray-800 text-sm",children:A.name}),u.jsx("div",{className:"text-xs text-gray-600",children:A.type}),u.jsxs("div",{className:"mt-1",children:[u.jsx("div",{className:"bg-red-200 rounded-full h-2",children:u.jsx("div",{className:"bg-red-500 h-2 rounded-full transition-all duration-300",style:{width:`${A.hp/A.maxHp*100}%`}})}),u.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["HP: ",A.hp,"/",A.maxHp]})]})]})]})},A.id))})}),u.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:u.jsx("div",{className:"text-4xl text-white drop-shadow-lg font-bold",children:"⚔️ VS ⚔️"})})]})}),u.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[u.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-4 shadow-lg",children:[u.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"👥 Your Party"}),u.jsx("div",{className:"space-y-3",children:s.partyMembers.map(A=>u.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-bold text-gray-800",children:A.name}),u.jsxs("div",{className:"text-sm text-gray-600",children:["Level ",A.level," ",A.class]})]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("span",{className:"text-sm text-gray-700",children:"HP:"}),u.jsx("input",{type:"number",value:A.hp,onChange:H=>V(A.id,parseInt(H.target.value)),className:"w-16 bg-white border border-gray-300 rounded px-2 py-1 text-sm",min:"0",max:A.maxHp}),u.jsxs("span",{className:"text-sm text-gray-600",children:["/ ",A.maxHp]})]}),u.jsxs("div",{className:"text-sm text-gray-600",children:["AC: ",A.ac]})]})]})},A.id))})]}),u.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-4 shadow-lg",children:[u.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"👹 Enemies"}),u.jsx("div",{className:"space-y-3",children:s.enemies.map(A=>u.jsx("div",{className:"bg-red-50 rounded-lg p-3 border border-red-200",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-bold text-gray-800",children:A.name}),u.jsx("div",{className:"text-sm text-gray-600",children:A.type})]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("span",{className:"text-sm text-gray-700",children:"HP:"}),u.jsx("input",{type:"number",value:A.hp,onChange:H=>V(A.id,parseInt(H.target.value)),className:"w-16 bg-white border border-gray-300 rounded px-2 py-1 text-sm",min:"0",max:A.maxHp}),u.jsxs("span",{className:"text-sm text-gray-600",children:["/ ",A.maxHp]})]}),u.jsxs("div",{className:"text-sm text-gray-600",children:["AC: ",A.ac]})]})]})},A.id))})]})]}),s.combatState==="preparation"&&u.jsx("div",{className:"mt-6 text-center py-8",children:u.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-6 shadow-lg",children:[u.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"🎮 Battle Preparation"}),u.jsx("p",{className:"text-gray-600",children:'Your party is ready! Click "Start Battle" to begin the epic confrontation.'})]})}),s.combatState==="ended"&&u.jsx("div",{className:"mt-6 text-center py-8",children:u.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-6 shadow-lg",children:[u.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"🏆 Battle Concluded"}),u.jsx("p",{className:"text-gray-600",children:"The epic battle has ended. Return to your adventure!"})]})})]})})}const Fn={INVESTIGATION:"investigation",COMBAT:"combat",PERSUASION:"persuasion",EXPLORATION:"exploration",SOCIAL:"social"},St={HIDDEN:"hidden",DISCOVERED:"discovered",IN_PROGRESS:"in_progress",COMPLETED:"completed",FAILED:"failed"},nv=t=>{const e=[{id:"investigate_area",type:Fn.INVESTIGATION,title:"Investigate the Area",description:"Search for clues and gather information about the situation",keywords:["search","investigate","examine","look around","check","explore"],state:St.HIDDEN,discoveredAt:null,completedAt:null},{id:"resolve_conflict",type:Fn.COMBAT,title:"Resolve the Conflict",description:"Engage in combat to overcome the threat",keywords:["fight","attack","defend","combat","battle"],state:St.HIDDEN,discoveredAt:null,completedAt:null},{id:"negotiate_peace",type:Fn.PERSUASION,title:"Negotiate Peace",description:"Use diplomacy and persuasion to resolve the situation peacefully",keywords:["talk","negotiate","persuade","convince","diplomacy","peace"],state:St.HIDDEN,discoveredAt:null,completedAt:null}],n=[];return(t.toLowerCase().includes("thief")||t.toLowerCase().includes("stealth"))&&n.push({id:"stealth_approach",type:Fn.EXPLORATION,title:"Stealth Approach",description:"Use stealth to avoid detection and gather information",keywords:["sneak","stealth","hide","silent","unnoticed"],state:St.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("merchant")||t.toLowerCase().includes("trade"))&&n.push({id:"establish_trade",type:Fn.SOCIAL,title:"Establish Trade Relations",description:"Build economic relationships with the locals",keywords:["trade","bargain","deal","commerce","business"],state:St.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("scholar")||t.toLowerCase().includes("knowledge"))&&n.push({id:"gather_knowledge",type:Fn.INVESTIGATION,title:"Gather Ancient Knowledge",description:"Discover and preserve valuable information",keywords:["research","study","learn","knowledge","ancient","lore"],state:St.HIDDEN,discoveredAt:null,completedAt:null}),[...e,...n]},_R=(t,e)=>{const n=[];return e.forEach(r=>{if(r.state===St.HIDDEN){const s=t.toLowerCase();r.keywords.some(o=>s.includes(o.toLowerCase()))&&n.push({...r,state:St.DISCOVERED,discoveredAt:new Date})}}),n},wR=(t,e)=>t.filter(n=>n.state===e),cd=t=>t.filter(e=>e.state===St.DISCOVERED||e.state===St.IN_PROGRESS||e.state===St.COMPLETED),xR=(t,e)=>{const n=wR(t,St.HIDDEN),r=[];return n.forEach(s=>{const i=e.toLowerCase();s.type===Fn.INVESTIGATION&&(i.includes("mystery")||i.includes("unknown"))&&r.push("There might be more to discover here..."),s.type===Fn.PERSUASION&&(i.includes("tension")||i.includes("conflict"))&&r.push("Perhaps words could resolve this..."),s.type===Fn.COMBAT&&(i.includes("threat")||i.includes("danger"))&&r.push("The situation seems dangerous...")}),r};function ER(){var ye;const{partyId:t}=Vc(),e=jn(),[n,r]=D.useState(null),[s,i]=D.useState(null),[o,l]=D.useState(null),[c,d]=D.useState([]),[p,m]=D.useState([]),[g,S]=D.useState({}),[C,k]=D.useState(!0),[R,I]=D.useState(""),[w,b]=D.useState(""),[M,O]=D.useState(!1),[V,_]=D.useState(!1),[y,x]=D.useState(!1),E=D.useRef(!1),[P,N]=D.useState([]),[T,_e]=D.useState("Investigation"),[mt,Qe]=D.useState([]),[Ye,G]=D.useState(!1);D.useEffect(()=>{const U=Qr(K=>{if(!K){e("/login");return}r(K)});return()=>U()},[e]),D.useEffect(()=>{n&&t&&te()},[n,t]),D.useEffect(()=>{if(t)try{const U=zx(t,K=>{K&&K.status==="active"&&(window.location.pathname.includes("/combat/")||e(`/combat/${t}`))});return()=>U()}catch(U){console.error("Error subscribing to combat session:",U)}},[t,e]),D.useEffect(()=>()=>{x(!1)},[]),D.useEffect(()=>{var U;if(n&&c.length>0&&s){const K=c.find(ue=>ue.userId===n.uid),X=(U=s.readyPlayers)==null?void 0:U.includes(n.uid);K&&!X&&s.status==="ready_up"&&A()}},[c,s,n]);const te=async()=>{var U,K;try{k(!0),console.log("Loading story and characters for partyId:",t);const[X,ue,pe]=await Promise.all([JA(t),bp(t),Bx(t)]);if(console.log("Loaded characters:",ue),console.log("Loaded story:",X),console.log("Loaded party:",pe),d(ue),l(pe),ue.length===0&&n)try{const Pe=(await Cp(n.uid)).find(Ee=>Ee.id===t);if(Pe){m(Pe.members||[]),console.log("Loaded party members:",Pe.members);const Ee={};for(const st of Pe.members)try{const on=await Sp(st);Ee[st]=on}catch(on){console.error("Error loading profile for member:",st,on),Ee[st]=null}S(Ee)}}catch(ae){console.error("Error loading party members:",ae)}if(X){if(X.votingSession&&X.status==="voting"&&(await Tn(X.id,{votingSession:null}),X.votingSession=null),X.storyMessages){const ae=X.storyMessages.filter(Pe=>{var Ee,st;return!((Ee=Pe.content)!=null&&Ee.includes("tie"))&&!((st=Pe.content)!=null&&st.includes("vote again"))&&Pe.type!=="tie_break"});ae.length!==X.storyMessages.length&&(await Tn(X.id,{storyMessages:ae}),X.storyMessages=ae)}if(i(X),O(((U=X.readyPlayers)==null?void 0:U.includes(n==null?void 0:n.uid))||!1),X.status==="storytelling"&&pe){const ae=nv(pe.description||"");N(ae);const Pe=((K=X.storyMessages)==null?void 0:K.length)||0;Pe<5?_e("Investigation"):Pe<15?_e("Conflict"):_e("Resolution")}}else{const ae=await YA(t);i(ae)}}catch(X){console.error("Error in loadStoryAndCharacters:",X),I("Failed to load campaign story")}finally{k(!1)}};D.useEffect(()=>{if(s!=null&&s.id&&n){const U=ZA(s.id,K=>{var X,ue,pe;if(K&&(i(K),O(((X=K.readyPlayers)==null?void 0:X.includes(n.uid))||!1),K.status==="voting"&&_(!1),K.status==="storytelling"&&o)){if(P.length===0){const Ee=nv(o.description||"");N(Ee)}const ae=((ue=K.storyMessages)==null?void 0:ue.length)||0;ae<5&&T!=="Investigation"?_e("Investigation"):ae>=5&&ae<15&&T!=="Conflict"?_e("Conflict"):ae>=15&&T!=="Resolution"&&_e("Resolution");const Pe=(pe=K.storyMessages)==null?void 0:pe[K.storyMessages.length-1];if(Pe&&Pe.role==="assistant"){const Ee=xR(P,Pe.content);Qe(Ee)}}});return()=>U()}},[s==null?void 0:s.id,n==null?void 0:n.uid,o,P,T]);const A=async()=>{if(!n)return;if(!c.find(K=>K.userId===n.uid)){e(`/character-creation/${t}`);return}try{await XA(s.id,n.uid),O(!0)}catch{I("Failed to ready up")}},H=async()=>{var K;if(E.current||(s==null?void 0:s.status)==="voting"||(s==null?void 0:s.status)==="storytelling"){console.log("Plot generation already in progress or completed");return}const U=(K=s==null?void 0:s.storyMessages)==null?void 0:K.filter(X=>X.type==="plot_selection");if(U&&U.length>0){console.log("Plots already exist, skipping generation"),(s==null?void 0:s.status)==="ready_up"&&await Tn(s.id,{status:"voting",votingSession:null});return}if(C){console.log("Already loading, skipping request");return}try{if(E.current=!0,_(!0),k(!0),(s==null?void 0:s.status)!=="ready_up"){console.log("Story is no longer in ready_up status");return}const ue=`Generate 3 distinct campaign plot options for this party. For each plot, provide a compelling title and a brief summary (2-3 sentences). Format as:

Plot 1: [Title]
[Summary]

Plot 2: [Title]  
[Summary]

Plot 3: [Title]
[Summary]

Party: ${c.map(ae=>`${ae.name} - Level ${ae.level} ${ae.race} ${ae.class}. ${ae.personality||""}. ${ae.backstory||""}`).join(`
`)}`,pe=await Un.generatePlotOptions(c,o);await Os(s.id,{role:"assistant",content:pe,type:"plot_selection"}),await Tn(s.id,{status:"voting",votingSession:null})}catch(X){I("Failed to start story generation"),console.error(X)}finally{E.current=!1,_(!1),k(!1)}},Z=async U=>{if(!(!n||!o)){if(o.dmId!==n.uid){I("Only the campaign creator can select the plot");return}if((s==null?void 0:s.status)==="storytelling"){console.log("Plot already selected, story in progress");return}try{k(!0);const K=s.storyMessages.find(ue=>ue.type==="plot_selection");await Tn(s.id,{status:"storytelling",currentPlot:U,votingSession:null}),await Os(s.id,{role:"assistant",content:`The Dungeon Master has chosen Plot ${U}! Let the story begin...`,type:"plot_selected"});const X=await Un.generateStoryIntroduction(c,(K==null?void 0:K.content)||"",U,o);await Os(s.id,{role:"assistant",content:X,type:"story_introduction"}),await ld(s.id,o.dmId)}catch(K){I("Failed to select plot"),console.error(K)}finally{k(!1)}}},q=async(U=null)=>{if(!(!w.trim()||!(s!=null&&s.currentSpeaker)))try{await Os(s.id,{role:"user",content:w,playerId:s.currentSpeaker.userId,playerName:s.currentSpeaker.name}),b(""),await ad(s.id,null);const K=_R(w,P);if(K.length>0){const Dn=P.map(et=>K.find(Di=>Di.id===et.id)||et);N(Dn)}let X=w,ue="individual";if(U&&(o==null?void 0:o.dmId)===(n==null?void 0:n.uid))switch(U){case"combat":X=`${w}

[DM NOTE: This response should naturally lead to or initiate combat. Include enemies, threats, or dangerous situations that require immediate action.]`,ue="combat_initiation";break;case"climax":X=`${w}

[DM NOTE: Build dramatic tension and suspense. Create a sense of urgency, danger, or high stakes that raises the emotional intensity.]`,ue="tension_building";break;case"resolution":X=`${w}

[DM NOTE: Provide resolution to current conflicts or challenges. Offer closure, rewards, or peaceful outcomes that satisfy the current story arc.]`,ue="conflict_resolution";break;case"twist":X=`${w}

[DM NOTE: Introduce an unexpected plot twist or revelation. Add new information, betrayals, hidden motives, or surprising developments that change the story direction.]`,ue="plot_twist";break;default:X=w,ue="individual"}const pe=cd(P),ae=await Un.generateStructuredStoryResponse(c,s.storyMessages,X,T,pe,o),Pe=["combat","battle","fight","attack","initiative","roll for initiative"],Ee=["enemy","enemies","monster","monsters","bandit","bandits","goblin","goblins","orc","orcs","dragon","dragons","troll","trolls","zombie","zombies","skeleton","skeletons","assassin","assassins","guard","guards","soldier","soldiers","thief","thieves","brigand","brigands","raider","raiders","cultist","cultists","demon","demons","devil","devils","ghost","ghosts","specter","specters","wraith","wraiths","hobgoblin","hobgoblins","bugbear","bugbears","kobold","kobolds","ogre","ogres","giant","giants","beholder","beholders","lich","liches","vampire","vampires","werewolf","werewolves","hag","hags","witch","witches","necromancer","necromancers"],st=Pe.some(Dn=>ae.toLowerCase().includes(Dn)),on=Ee.some(Dn=>ae.toLowerCase().includes(Dn)),ar=st&&on;if(await Os(s.id,{role:"assistant",content:ae,type:ar?"combat_initiation":"story_continuation"}),await oe(),ar){if(y)return;x(!0);const Dn={storyContext:ae,partyMembers:c.map(et=>({id:et.id,name:et.name,class:et.class,level:et.level,hp:et.hp||10+(et.constitution-10)*2,maxHp:et.hp||10+(et.constitution-10)*2,ac:et.ac||10,initiative:Math.floor(Math.random()*20)+1+Math.floor((et.dexterity-10)/2),userId:et.userId})),enemies:[],initiative:[]};await eR(t,Dn),await Tn(s.id,{status:"paused",currentCombat:{initiated:!0,storyContext:ae,timestamp:new Date}})}}catch(K){I("Failed to send response"),console.error(K)}},oe=async()=>{var pe;if(!s||!o)return;const U=((pe=s.storyMessages)==null?void 0:pe.length)||0,K=cd(P);let X=!1,ue=T;if(T==="Investigation"&&U>=5&&K.length>=1?(ue="Conflict",X=!0):T==="Conflict"&&U>=15&&K.length>=2&&(ue="Resolution",X=!0),X&&ue!==T){_e(ue);const ae=await Un.generatePhaseTransition(c,T,`Story has progressed through ${U} messages with ${K.length} objectives discovered`,o);await Os(s.id,{role:"assistant",content:ae,type:"phase_transition"})}},de=U=>{if(!U)return U;const K=["enemy","enemies","monster","monsters","bandit","bandits","goblin","goblins","orc","orcs","dragon","dragons","troll","trolls","zombie","zombies","skeleton","skeletons","assassin","assassins","guard","guards","soldier","soldiers","thief","thieves","brigand","brigands","raider","raiders","cultist","cultists","demon","demons","devil","devils","ghost","ghosts","specter","specters","wraith","wraiths","hobgoblin","hobgoblins","bugbear","bugbears","kobold","kobolds","ogre","ogres","giant","giants","beholder","beholders","lich","liches","vampire","vampires","werewolf","werewolves","hag","hags","witch","witches","necromancer","necromancers"],X=["search","investigate","examine","look around","check","explore","clue","clues","evidence","footprint","footprints","track","tracks","marking","markings","sign","signs","trace","traces","remains","ruin","ruins","artifact","artifacts","scroll","scrolls","book","books","map","maps","diary","journal","note","notes","door","doors","passage","passages","tunnel","tunnels","chamber","chambers","room","rooms","area","areas","mystery","mysterious","hidden","secret","secrets","concealed","strange","unusual","curious","suspicious","odd","peculiar","trap","traps","pressure plate","pressure plates","lever","levers","button","buttons","switch","switches","key","keys","lock","locks"],ue=["tavern","inn","shop","market","temple","castle","fortress","tower","dungeon","cave","forest","mountain","river","bridge","gate","wall","street","alley","square","plaza","district","village","town","city","settlement","outpost","camp","crypt","tomb","grave","cemetery","shrine","altar","library","archive","guild","hall","mansion","palace","basement","cellar","attic","rooftop","balcony","courtyard","garden","park","field","meadow","swamp","desert","island"],pe=["attack","fight","battle","combat","defend","strike","sword","swords","axe","axes","bow","bows","arrow","arrows","spell","spells","magic","magical","cast","casting","initiative","turn","round","action","movement","charge","retreat","advance","position","formation","shield","armor","helmet","dagger","daggers","mace","maces","fireball","lightning","heal","healing","cure","bless","curse"];let ae=U;return[...K,...X,...ue,...pe].forEach(Ee=>{const st=new RegExp(`\\b${Ee}\\b`,"gi");ae=ae.replace(st,`<strong>${Ee}</strong>`)}),ae},je=()=>{var U;return((U=s==null?void 0:s.readyPlayers)==null?void 0:U.length)||0},De=()=>o&&o.members&&Array.isArray(o.members)?o.members.length:c.length>0?c.length:p.length>0?p.length:1,F=je()===De(),re=()=>{const U=s.storyMessages.filter(K=>K.type==="plot_selection");if(U.length>0){const X=U[U.length-1].content.split(`
`),ue=[];let pe=null;const ae=new Set;return X.forEach(Pe=>{var st;const Ee=Pe.trim();if(Ee.startsWith("Plot 1:")||Ee.startsWith("Plot 2:")||Ee.startsWith("Plot 3:")){pe&&!ae.has(pe.title)&&(ue.push(pe),ae.add(pe.title));const on=(st=Ee.match(/Plot (\d+):/))==null?void 0:st[1],ar=Ee.replace(/Plot \d+:\s*/,"").trim();ae.has(ar)?pe=null:pe={number:parseInt(on),title:ar,summary:""}}else pe&&Ee&&!Ee.startsWith("Party:")&&!Ee.startsWith("CRITICAL")&&!Ee.startsWith("Make each")&&(pe.summary+=(pe.summary?" ":"")+Ee)}),pe&&!ae.has(pe.title)&&ue.push(pe),ue.slice(0,3)}return[{number:1,title:"Plot 1",summary:"No plot data available"},{number:2,title:"Plot 2",summary:"No plot data available"},{number:3,title:"Plot 3",summary:"No plot data available"}]},se=()=>!c.length||!n?c:[...c].sort((U,K)=>U.userId===n.uid?-1:K.userId===n.uid?1:0);return n?C?u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsx("div",{className:"text-center py-8",children:u.jsx("div",{className:"text-stone-600",children:"Loading campaign story..."})})})}):u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h1",{className:"fantasy-title mb-0",children:"Campaign Story"}),u.jsx("button",{onClick:()=>e("/dashboard"),className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Back to Dashboard"})]}),R&&u.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:R}),y&&u.jsx("div",{className:"bg-orange-100 border border-orange-400 text-orange-700 px-4 py-3 rounded-lg mb-6",children:u.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[u.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-orange-600"}),u.jsx("span",{className:"font-semibold",children:"⚔️ Combat is being initiated! Redirecting to battle arena..."})]})}),(s==null?void 0:s.status)==="paused"&&(s==null?void 0:s.currentCombat)&&u.jsx("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded-lg mb-6",children:u.jsx("div",{className:"flex items-center justify-center space-x-2",children:u.jsx("span",{className:"font-semibold",children:"⚔️ Story is paused for combat. Please wait for the battle to conclude."})})}),(s==null?void 0:s.status)==="ready_up"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"text-center",children:[u.jsx("h2",{className:"text-xl font-bold text-stone-800 mb-4",children:"Ready Up"}),u.jsx("p",{className:"text-stone-600 mb-4",children:"All players must ready up before the story begins"}),u.jsxs("div",{className:"mb-6",children:[u.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-2",children:[u.jsxs("div",{className:"text-lg font-semibold text-amber-700",children:[je(),"/",De()," Players Ready"]}),u.jsxs("div",{className:"text-sm text-stone-500",children:["(",Math.round(je()/De()*100),"%)"]})]}),u.jsx("div",{className:"w-full bg-stone-200 rounded-full h-2 max-w-md mx-auto",children:u.jsx("div",{className:"bg-amber-600 h-2 rounded-full transition-all duration-300",style:{width:`${je()/De()*100}%`}})})]}),c.length===0&&u.jsx("div",{className:"bg-blue-100 border border-blue-200 rounded-lg p-4 mb-4",children:u.jsxs("p",{className:"text-blue-800",children:[u.jsx("strong",{children:"No characters created yet!"})," Players should create their characters first. You can still ready up and start the story, but characters will need to be created before the adventure begins."]})})]}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.length>0?se().map(U=>{var ue;const K=(ue=s.readyPlayers)==null?void 0:ue.includes(U.userId),X=U.userId===(n==null?void 0:n.uid);return u.jsx("div",{className:`fantasy-card transition-all duration-200 ${K?"bg-green-50 border-green-200":"bg-amber-50"}`,children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"w-16 h-16 bg-stone-300 rounded-full mx-auto mb-2 flex items-center justify-center",children:u.jsx("span",{className:"text-xs text-stone-600",children:"IMG"})}),u.jsx("h3",{className:"font-bold text-stone-800",children:U.name}),u.jsxs("p",{className:"text-sm text-stone-600",children:["Level ",U.level," ",U.race," ",U.class]}),X&&u.jsx("span",{className:"text-blue-600 text-xs font-medium",children:"(You)"}),u.jsx("div",{className:"mt-2",children:K?u.jsxs("div",{className:"flex items-center justify-center space-x-1 text-green-600 font-semibold",children:[u.jsx("span",{children:"✓"}),u.jsx("span",{children:"Ready"})]}):u.jsxs("div",{className:"flex items-center justify-center space-x-1 text-stone-500",children:[u.jsx("div",{className:"w-3 h-3 border-2 border-stone-300 border-t-stone-600 rounded-full animate-spin"}),u.jsx("span",{children:"Waiting..."})]})})]})},U.id)}):p.map((U,K)=>{var Pe;const X=g[U],ue=(X==null?void 0:X.username)||`Player ${K+1}`,pe=(Pe=s.readyPlayers)==null?void 0:Pe.includes(U),ae=U===(n==null?void 0:n.uid);return u.jsx("div",{className:`fantasy-card transition-all duration-200 ${pe?"bg-green-50 border-green-200":"bg-amber-50"}`,children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"w-16 h-16 bg-stone-300 rounded-full mx-auto mb-2 flex items-center justify-center",children:u.jsx("span",{className:"text-xs text-stone-600",children:"IMG"})}),u.jsx("h3",{className:"font-bold text-stone-800",children:ue}),u.jsx("p",{className:"text-sm text-stone-600",children:"No character created yet"}),ae&&u.jsx("span",{className:"text-blue-600 text-xs font-medium",children:"(You)"}),u.jsx("div",{className:"mt-2",children:pe?u.jsxs("div",{className:"flex items-center justify-center space-x-1 text-green-600 font-semibold",children:[u.jsx("span",{children:"✓"}),u.jsx("span",{children:"Ready"})]}):u.jsxs("div",{className:"flex items-center justify-center space-x-1 text-stone-500",children:[u.jsx("div",{className:"w-3 h-3 border-2 border-stone-300 border-t-stone-600 rounded-full animate-spin"}),u.jsx("span",{children:"Waiting..."})]})})]})},U)})}),u.jsxs("div",{className:"text-center",children:[M?u.jsx("div",{className:"text-green-600 font-semibold",children:"You are ready!"}):u.jsx("button",{onClick:A,className:"fantasy-button",children:c.find(U=>U.userId===(n==null?void 0:n.uid))?"Ready Up":"Create Character & Ready Up"}),F&&u.jsx("button",{onClick:H,disabled:C||V||(s==null?void 0:s.status)==="voting",className:"fantasy-button bg-amber-700 hover:bg-amber-800 ml-4",children:C||V?"Generating Story...":"Start Story Generation"})]})]}),(s==null?void 0:s.status)==="voting"&&u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-xl font-bold text-stone-800",children:"Choose Your Adventure"}),o&&o.dmId===(n==null?void 0:n.uid)?u.jsx("div",{className:"space-y-4",children:u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:re().map(U=>u.jsxs("div",{className:"fantasy-card bg-amber-50",children:[u.jsx("h3",{className:"font-bold text-stone-800 mb-2 text-lg",children:U.title}),u.jsx("p",{className:"text-stone-600 text-sm mb-4",children:U.summary}),u.jsx("button",{onClick:()=>Z(U.number),disabled:C,className:"fantasy-button w-full bg-amber-600 hover:bg-amber-700",children:C?"Selecting...":`Choose Plot ${U.number}`})]},U.number))})}):u.jsxs("div",{className:"bg-blue-100 border border-blue-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-bold text-blue-800 mb-2",children:"⏳ Waiting for Dungeon Master"}),u.jsx("p",{className:"text-blue-700",children:"The campaign creator is choosing which plot to pursue. Please wait while they make their decision."}),u.jsx("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:re().map(U=>u.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-3",children:[u.jsx("h4",{className:"font-bold text-stone-800 mb-2",children:U.title}),u.jsx("p",{className:"text-stone-600 text-sm",children:U.summary})]},U.number))})]})]}),((s==null?void 0:s.status)==="storytelling"||(s==null?void 0:s.status)==="paused")&&u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-xl font-bold text-stone-800",children:"Your Adventure"}),(o==null?void 0:o.dmId)===(n==null?void 0:n.uid)&&u.jsxs("div",{className:"bg-purple-100 border border-purple-200 rounded-lg p-4",children:[u.jsxs("h3",{className:"font-bold text-purple-800 mb-2",children:["📖 Story Phase: ",T]}),u.jsxs("p",{className:"text-purple-700 text-sm",children:[T==="Investigation"&&"Explore, discover clues, and gather information about the situation.",T==="Conflict"&&"Face challenges, threats, and make difficult choices.",T==="Resolution"&&"Conclude the story arc and see the consequences of your actions."]})]}),(o==null?void 0:o.dmId)===(n==null?void 0:n.uid)&&P.length>0&&u.jsxs("div",{className:"bg-emerald-100 border border-emerald-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-bold text-emerald-800 mb-3",children:"🎯 Discovered Objectives"}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:cd(P).map(U=>u.jsxs("div",{className:"bg-white border border-emerald-300 rounded-lg p-3",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("h4",{className:"font-semibold text-emerald-800 text-sm",children:U.title}),u.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${U.state===St.COMPLETED?"bg-green-100 text-green-800":U.state===St.IN_PROGRESS?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:U.state===St.COMPLETED?"✓ Complete":U.state===St.IN_PROGRESS?"⟳ In Progress":"🔍 Discovered"})]}),u.jsx("p",{className:"text-emerald-700 text-xs",children:U.description})]},U.id))}),mt.length>0&&u.jsxs("div",{className:"mt-4 pt-4 border-t border-emerald-300",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("h4",{className:"font-semibold text-emerald-800 text-sm",children:"💡 Subtle Hints"}),u.jsxs("button",{onClick:()=>G(!Ye),className:"text-emerald-600 hover:text-emerald-800 text-xs",children:[Ye?"Hide":"Show"," Hints"]})]}),Ye&&u.jsx("div",{className:"space-y-2",children:mt.map((U,K)=>u.jsx("div",{className:"text-emerald-700 text-xs italic",children:U},K))})]})]}),u.jsxs("div",{className:"bg-blue-100 border border-blue-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-bold text-blue-800 mb-2",children:"🎭 Storytelling Guidelines"}),u.jsxs("p",{className:"text-blue-700 text-sm",children:[u.jsx("strong",{children:"Turn-taking:"})," Respond to the story or let someone else speak. Only one person can respond at a time."]})]}),u.jsx("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4 max-h-96 overflow-y-auto",children:s.storyMessages.filter(U=>U.type!=="plot_selection").map(U=>u.jsx("div",{className:"mb-4",children:U.role==="assistant"?u.jsxs("div",{className:"bg-blue-100 border border-blue-200 rounded-lg p-3",children:[u.jsx("div",{className:"font-semibold text-blue-800 mb-1",children:"Game Master"}),u.jsx("div",{className:"text-blue-900 whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:de(U.content)}})]}):u.jsxs("div",{className:"bg-green-100 border border-green-200 rounded-lg p-3",children:[u.jsx("div",{className:"font-semibold text-green-800 mb-1",children:U.playerName}),u.jsx("div",{className:"text-green-900",dangerouslySetInnerHTML:{__html:de(U.content)}})]})},U.id))}),(s==null?void 0:s.status)==="storytelling"&&(s!=null&&s.currentSpeaker)?u.jsxs("div",{className:"space-y-4",children:[s.currentSpeaker.userId===(n==null?void 0:n.uid)?u.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-bold text-amber-800 mb-3",children:"How will you respond?"}),u.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[u.jsx("div",{className:"w-10 h-10 bg-amber-200 rounded-full flex items-center justify-center",children:u.jsx("span",{className:"text-amber-800 font-bold",children:s.currentSpeaker.name.charAt(0)})}),u.jsxs("div",{children:[u.jsx("div",{className:"font-medium text-amber-800",children:s.currentSpeaker.name}),u.jsxs("div",{className:"text-sm text-amber-700",children:[s.currentSpeaker.race," ",s.currentSpeaker.class]})]})]}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsx("input",{type:"text",value:w,onChange:U=>b(U.target.value),placeholder:`What does ${s.currentSpeaker.name} do?`,className:"fantasy-input flex-1",onKeyPress:U=>U.key==="Enter"&&q()}),u.jsx("button",{onClick:q,disabled:!w.trim(),className:"fantasy-button",children:"Send"})]}),(o==null?void 0:o.dmId)===(n==null?void 0:n.uid)&&u.jsxs("div",{className:"mt-4 pt-4 border-t border-amber-300",children:[u.jsx("h4",{className:"font-bold text-amber-800 mb-3 text-sm",children:"🎲 DM Controls (Hidden from party)"}),u.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.jsx("button",{onClick:()=>q("combat"),disabled:!w.trim(),className:"fantasy-button bg-red-600 hover:bg-red-700 text-sm py-2",children:"⚔️ Advance to Combat"}),u.jsx("button",{onClick:()=>q("climax"),disabled:!w.trim(),className:"fantasy-button bg-purple-600 hover:bg-purple-700 text-sm py-2",children:"🌟 Build Tension"}),u.jsx("button",{onClick:()=>q("resolution"),disabled:!w.trim(),className:"fantasy-button bg-green-600 hover:bg-green-700 text-sm py-2",children:"🔍 Investigate the Area"}),u.jsx("button",{onClick:()=>q("twist"),disabled:!w.trim(),className:"fantasy-button bg-orange-600 hover:bg-orange-700 text-sm py-2",children:"🔄 Add Plot Twist"})]})]})]}):u.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[u.jsxs("h3",{className:"font-bold text-blue-800 mb-3",children:["Waiting for ",s.currentSpeaker.name," to respond"]}),u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("div",{className:"w-10 h-10 bg-blue-200 rounded-full flex items-center justify-center",children:u.jsx("span",{className:"text-blue-800 font-bold",children:s.currentSpeaker.name.charAt(0)})}),u.jsxs("div",{children:[u.jsx("div",{className:"font-medium text-blue-800",children:s.currentSpeaker.name}),u.jsxs("div",{className:"text-sm text-blue-700",children:[s.currentSpeaker.race," ",s.currentSpeaker.class]})]})]}),u.jsxs("p",{className:"text-blue-700 mt-2",children:[s.currentSpeaker.name," is currently speaking. Please wait for their response."]})]}),(((ye=s==null?void 0:s.currentSpeaker)==null?void 0:ye.userId)===(n==null?void 0:n.uid)||(s==null?void 0:s.currentController)===(n==null?void 0:n.uid))&&u.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:[u.jsx("h4",{className:"font-bold text-stone-800 mb-3 text-center",children:"Let someone else speak"}),u.jsx("div",{className:"flex justify-center",children:u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-4xl",children:se().map(U=>{var X,ue;const K=U.userId===(n==null?void 0:n.uid);return u.jsxs("button",{onClick:async()=>{await ad(s.id,U),await ld(s.id,U.userId)},disabled:U.id===((X=s==null?void 0:s.currentSpeaker)==null?void 0:X.id),className:`p-4 rounded-lg border-2 transition-colors text-center ${U.id===((ue=s==null?void 0:s.currentSpeaker)==null?void 0:ue.id)?"border-stone-300 bg-stone-100 text-stone-500 cursor-not-allowed":"border-stone-200 bg-white hover:border-stone-300 text-stone-700"}`,children:[u.jsxs("div",{className:"font-medium mb-1",children:[u.jsx("span",{children:U.name}),K&&u.jsx("span",{className:"text-blue-600 text-xs font-medium ml-1",children:"(you)"})]}),u.jsxs("div",{className:"text-sm opacity-75",children:[U.race," ",U.class]})]},U.id)})})})]})]}):(o==null?void 0:o.dmId)===(n==null?void 0:n.uid)||(s==null?void 0:s.currentController)===(n==null?void 0:n.uid)?u.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-bold text-stone-800 mb-3 text-center",children:"Choose who speaks"}),u.jsx("div",{className:"flex justify-center",children:u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-4xl",children:se().map(U=>{const K=U.userId===(n==null?void 0:n.uid);return u.jsxs("button",{onClick:async()=>{await ad(s.id,U),await ld(s.id,U.userId)},className:"p-4 rounded-lg border-2 border-stone-200 bg-white hover:border-stone-300 text-stone-700 transition-colors text-center",children:[u.jsxs("div",{className:"font-medium mb-1",children:[u.jsx("span",{children:U.name}),K&&u.jsx("span",{className:"text-blue-600 text-xs font-medium ml-1",children:"(you)"})]}),u.jsxs("div",{className:"text-sm opacity-75",children:[U.race," ",U.class]})]},U.id)})})})]}):u.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-bold text-blue-800 mb-3",children:s.storyMessages.length>0?"Waiting for next speaker":"Waiting for the story to begin"}),u.jsx("p",{className:"text-blue-700",children:s.storyMessages.length>0?"The Dungeon Master is choosing who will speak next. Please wait.":"The Dungeon Master is choosing who will speak first. Please wait."})]})]})]})}):u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsx("div",{className:"text-center py-8",children:u.jsx("div",{className:"text-stone-600",children:"Loading..."})})})})}function TR(){return u.jsx($S,{basename:"/DND-V1",children:u.jsxs("div",{className:"min-h-screen flex flex-col",children:[u.jsx(oR,{}),u.jsx("main",{className:"flex-grow",children:u.jsxs(DS,{children:[u.jsx(xn,{path:"/",element:u.jsx(lR,{})}),u.jsx(xn,{path:"/login",element:u.jsx(cR,{})}),u.jsx(xn,{path:"/register",element:u.jsx(uR,{})}),u.jsx(xn,{path:"/dashboard",element:u.jsx(dR,{})}),u.jsx(xn,{path:"/character-creation/:partyId",element:u.jsx(hR,{})}),u.jsx(xn,{path:"/party-management",element:u.jsx(fR,{})}),u.jsx(xn,{path:"/campaign/:partyId",element:u.jsx(yR,{})}),u.jsx(xn,{path:"/campaign-story/:partyId",element:u.jsx(ER,{})}),u.jsx(xn,{path:"/combat/:partyId",element:u.jsx(vR,{})})]})})]})})}ud.createRoot(document.getElementById("root")).render(u.jsx(fv.StrictMode,{children:u.jsx(TR,{})}));
