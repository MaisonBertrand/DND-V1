function wx(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function Ex(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var av={exports:{}},Cc={},lv={exports:{}},de={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fa=Symbol.for("react.element"),xx=Symbol.for("react.portal"),Tx=Symbol.for("react.fragment"),bx=Symbol.for("react.strict_mode"),Ix=Symbol.for("react.profiler"),Sx=Symbol.for("react.provider"),Cx=Symbol.for("react.context"),Px=Symbol.for("react.forward_ref"),Nx=Symbol.for("react.suspense"),kx=Symbol.for("react.memo"),Ax=Symbol.for("react.lazy"),Sm=Symbol.iterator;function Rx(t){return t===null||typeof t!="object"?null:(t=Sm&&t[Sm]||t["@@iterator"],typeof t=="function"?t:null)}var cv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},uv=Object.assign,dv={};function Mi(t,e,n){this.props=t,this.context=e,this.refs=dv,this.updater=n||cv}Mi.prototype.isReactComponent={};Mi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Mi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function hv(){}hv.prototype=Mi.prototype;function Lh(t,e,n){this.props=t,this.context=e,this.refs=dv,this.updater=n||cv}var Vh=Lh.prototype=new hv;Vh.constructor=Lh;uv(Vh,Mi.prototype);Vh.isPureReactComponent=!0;var Cm=Array.isArray,fv=Object.prototype.hasOwnProperty,Uh={current:null},pv={key:!0,ref:!0,__self:!0,__source:!0};function mv(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)fv.call(e,r)&&!pv.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:fa,type:t,key:i,ref:o,props:s,_owner:Uh.current}}function jx(t,e){return{$$typeof:fa,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Fh(t){return typeof t=="object"&&t!==null&&t.$$typeof===fa}function Dx(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Pm=/\/+/g;function Pu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Dx(""+t.key):e.toString(36)}function yl(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case fa:case xx:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Pu(o,0):r,Cm(s)?(n="",t!=null&&(n=t.replace(Pm,"$&/")+"/"),yl(s,e,n,"",function(d){return d})):s!=null&&(Fh(s)&&(s=jx(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Pm,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Cm(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+Pu(i,l);o+=yl(i,e,n,c,s)}else if(c=Rx(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+Pu(i,l++),o+=yl(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Qa(t,e,n){if(t==null)return t;var r=[],s=0;return yl(t,r,"","",function(i){return e.call(n,i,s++)}),r}function Mx(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ot={current:null},vl={transition:null},Ox={ReactCurrentDispatcher:Ot,ReactCurrentBatchConfig:vl,ReactCurrentOwner:Uh};function gv(){throw Error("act(...) is not supported in production builds of React.")}de.Children={map:Qa,forEach:function(t,e,n){Qa(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Qa(t,function(){e++}),e},toArray:function(t){return Qa(t,function(e){return e})||[]},only:function(t){if(!Fh(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};de.Component=Mi;de.Fragment=Tx;de.Profiler=Ix;de.PureComponent=Lh;de.StrictMode=bx;de.Suspense=Nx;de.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ox;de.act=gv;de.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=uv({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Uh.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)fv.call(e,c)&&!pv.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:fa,type:t.type,key:s,ref:i,props:r,_owner:o}};de.createContext=function(t){return t={$$typeof:Cx,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Sx,_context:t},t.Consumer=t};de.createElement=mv;de.createFactory=function(t){var e=mv.bind(null,t);return e.type=t,e};de.createRef=function(){return{current:null}};de.forwardRef=function(t){return{$$typeof:Px,render:t}};de.isValidElement=Fh;de.lazy=function(t){return{$$typeof:Ax,_payload:{_status:-1,_result:t},_init:Mx}};de.memo=function(t,e){return{$$typeof:kx,type:t,compare:e===void 0?null:e}};de.startTransition=function(t){var e=vl.transition;vl.transition={};try{t()}finally{vl.transition=e}};de.unstable_act=gv;de.useCallback=function(t,e){return Ot.current.useCallback(t,e)};de.useContext=function(t){return Ot.current.useContext(t)};de.useDebugValue=function(){};de.useDeferredValue=function(t){return Ot.current.useDeferredValue(t)};de.useEffect=function(t,e){return Ot.current.useEffect(t,e)};de.useId=function(){return Ot.current.useId()};de.useImperativeHandle=function(t,e,n){return Ot.current.useImperativeHandle(t,e,n)};de.useInsertionEffect=function(t,e){return Ot.current.useInsertionEffect(t,e)};de.useLayoutEffect=function(t,e){return Ot.current.useLayoutEffect(t,e)};de.useMemo=function(t,e){return Ot.current.useMemo(t,e)};de.useReducer=function(t,e,n){return Ot.current.useReducer(t,e,n)};de.useRef=function(t){return Ot.current.useRef(t)};de.useState=function(t){return Ot.current.useState(t)};de.useSyncExternalStore=function(t,e,n){return Ot.current.useSyncExternalStore(t,e,n)};de.useTransition=function(){return Ot.current.useTransition()};de.version="18.3.1";lv.exports=de;var D=lv.exports;const yv=Ex(D),Lx=wx({__proto__:null,default:yv},[D]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vx=D,Ux=Symbol.for("react.element"),Fx=Symbol.for("react.fragment"),$x=Object.prototype.hasOwnProperty,Bx=Vx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,zx={key:!0,ref:!0,__self:!0,__source:!0};function vv(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)$x.call(e,r)&&!zx.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:Ux,type:t,key:i,ref:o,props:s,_owner:Bx.current}}Cc.Fragment=Fx;Cc.jsx=vv;Cc.jsxs=vv;av.exports=Cc;var u=av.exports,md={},_v={exports:{}},Jt={},wv={exports:{}},Ev={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(K,se){var ie=K.length;K.push(se);e:for(;0<ie;){var Ee=ie-1>>>1,ye=K[Ee];if(0<s(ye,se))K[Ee]=se,K[ie]=ye,ie=Ee;else break e}}function n(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var se=K[0],ie=K.pop();if(ie!==se){K[0]=ie;e:for(var Ee=0,ye=K.length,Te=ye>>>1;Ee<Te;){var gt=2*(Ee+1)-1,Qe=K[gt],yt=gt+1,ot=K[yt];if(0>s(Qe,ie))yt<ye&&0>s(ot,Qe)?(K[Ee]=ot,K[yt]=ie,Ee=yt):(K[Ee]=Qe,K[gt]=ie,Ee=gt);else if(yt<ye&&0>s(ot,ie))K[Ee]=ot,K[yt]=ie,Ee=yt;else break e}}return se}function s(K,se){var ie=K.sortIndex-se.sortIndex;return ie!==0?ie:K.id-se.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],f=1,m=null,y=3,I=!1,N=!1,j=!1,A=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(K){for(var se=n(d);se!==null;){if(se.callback===null)r(d);else if(se.startTime<=K)r(d),se.sortIndex=se.expirationTime,e(c,se);else break;se=n(d)}}function O(K){if(j=!1,S(K),!N)if(n(c)!==null)N=!0,et(R);else{var se=n(d);se!==null&&Ve(O,se.startTime-K)}}function R(K,se){N=!1,j&&(j=!1,T(g),g=-1),I=!0;var ie=y;try{for(S(se),m=n(c);m!==null&&(!(m.expirationTime>se)||K&&!C());){var Ee=m.callback;if(typeof Ee=="function"){m.callback=null,y=m.priorityLevel;var ye=Ee(m.expirationTime<=se);se=t.unstable_now(),typeof ye=="function"?m.callback=ye:m===n(c)&&r(c),S(se)}else r(c);m=n(c)}if(m!==null)var Te=!0;else{var gt=n(d);gt!==null&&Ve(O,gt.startTime-se),Te=!1}return Te}finally{m=null,y=ie,I=!1}}var V=!1,_=null,g=-1,E=5,x=-1;function C(){return!(t.unstable_now()-x<E)}function P(){if(_!==null){var K=t.unstable_now();x=K;var se=!0;try{se=_(!0,K)}finally{se?b():(V=!1,_=null)}}else V=!1}var b;if(typeof w=="function")b=function(){w(P)};else if(typeof MessageChannel<"u"){var ce=new MessageChannel,$e=ce.port2;ce.port1.onmessage=P,b=function(){$e.postMessage(null)}}else b=function(){A(P,0)};function et(K){_=K,V||(V=!0,b())}function Ve(K,se){g=A(function(){K(t.unstable_now())},se)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(K){K.callback=null},t.unstable_continueExecution=function(){N||I||(N=!0,et(R))},t.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<K?Math.floor(1e3/K):5},t.unstable_getCurrentPriorityLevel=function(){return y},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(K){switch(y){case 1:case 2:case 3:var se=3;break;default:se=y}var ie=y;y=se;try{return K()}finally{y=ie}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(K,se){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var ie=y;y=K;try{return se()}finally{y=ie}},t.unstable_scheduleCallback=function(K,se,ie){var Ee=t.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?Ee+ie:Ee):ie=Ee,K){case 1:var ye=-1;break;case 2:ye=250;break;case 5:ye=1073741823;break;case 4:ye=1e4;break;default:ye=5e3}return ye=ie+ye,K={id:f++,callback:se,priorityLevel:K,startTime:ie,expirationTime:ye,sortIndex:-1},ie>Ee?(K.sortIndex=ie,e(d,K),n(c)===null&&K===n(d)&&(j?(T(g),g=-1):j=!0,Ve(O,ie-Ee))):(K.sortIndex=ye,e(c,K),N||I||(N=!0,et(R))),K},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(K){var se=y;return function(){var ie=y;y=se;try{return K.apply(this,arguments)}finally{y=ie}}}})(Ev);wv.exports=Ev;var Wx=wv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hx=D,Yt=Wx;function q(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var xv=new Set,Vo={};function js(t,e){wi(t,e),wi(t+"Capture",e)}function wi(t,e){for(Vo[t]=e,t=0;t<e.length;t++)xv.add(e[t])}var rr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),gd=Object.prototype.hasOwnProperty,qx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Nm={},km={};function Gx(t){return gd.call(km,t)?!0:gd.call(Nm,t)?!1:qx.test(t)?km[t]=!0:(Nm[t]=!0,!1)}function Kx(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Qx(t,e,n,r){if(e===null||typeof e>"u"||Kx(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Lt(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var ft={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ft[t]=new Lt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ft[e]=new Lt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ft[t]=new Lt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ft[t]=new Lt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ft[t]=new Lt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ft[t]=new Lt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ft[t]=new Lt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ft[t]=new Lt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ft[t]=new Lt(t,5,!1,t.toLowerCase(),null,!1,!1)});var $h=/[\-:]([a-z])/g;function Bh(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace($h,Bh);ft[e]=new Lt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace($h,Bh);ft[e]=new Lt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace($h,Bh);ft[e]=new Lt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ft[t]=new Lt(t,1,!1,t.toLowerCase(),null,!1,!1)});ft.xlinkHref=new Lt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ft[t]=new Lt(t,1,!1,t.toLowerCase(),null,!0,!0)});function zh(t,e,n,r){var s=ft.hasOwnProperty(e)?ft[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Qx(e,n,s,r)&&(n=null),r||s===null?Gx(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var dr=Hx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ya=Symbol.for("react.element"),Xs=Symbol.for("react.portal"),Js=Symbol.for("react.fragment"),Wh=Symbol.for("react.strict_mode"),yd=Symbol.for("react.profiler"),Tv=Symbol.for("react.provider"),bv=Symbol.for("react.context"),Hh=Symbol.for("react.forward_ref"),vd=Symbol.for("react.suspense"),_d=Symbol.for("react.suspense_list"),qh=Symbol.for("react.memo"),xr=Symbol.for("react.lazy"),Iv=Symbol.for("react.offscreen"),Am=Symbol.iterator;function so(t){return t===null||typeof t!="object"?null:(t=Am&&t[Am]||t["@@iterator"],typeof t=="function"?t:null)}var Me=Object.assign,Nu;function po(t){if(Nu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Nu=e&&e[1]||""}return`
`+Nu+t}var ku=!1;function Au(t,e){if(!t||ku)return"";ku=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{ku=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?po(t):""}function Yx(t){switch(t.tag){case 5:return po(t.type);case 16:return po("Lazy");case 13:return po("Suspense");case 19:return po("SuspenseList");case 0:case 2:case 15:return t=Au(t.type,!1),t;case 11:return t=Au(t.type.render,!1),t;case 1:return t=Au(t.type,!0),t;default:return""}}function wd(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Js:return"Fragment";case Xs:return"Portal";case yd:return"Profiler";case Wh:return"StrictMode";case vd:return"Suspense";case _d:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case bv:return(t.displayName||"Context")+".Consumer";case Tv:return(t._context.displayName||"Context")+".Provider";case Hh:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case qh:return e=t.displayName||null,e!==null?e:wd(t.type)||"Memo";case xr:e=t._payload,t=t._init;try{return wd(t(e))}catch{}}return null}function Xx(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return wd(e);case 8:return e===Wh?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Gr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Sv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Jx(t){var e=Sv(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Xa(t){t._valueTracker||(t._valueTracker=Jx(t))}function Cv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Sv(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Vl(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ed(t,e){var n=e.checked;return Me({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Rm(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Gr(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Pv(t,e){e=e.checked,e!=null&&zh(t,"checked",e,!1)}function xd(t,e){Pv(t,e);var n=Gr(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Td(t,e.type,n):e.hasOwnProperty("defaultValue")&&Td(t,e.type,Gr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function jm(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Td(t,e,n){(e!=="number"||Vl(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var mo=Array.isArray;function ui(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Gr(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function bd(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(q(91));return Me({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Dm(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(q(92));if(mo(n)){if(1<n.length)throw Error(q(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Gr(n)}}function Nv(t,e){var n=Gr(e.value),r=Gr(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Mm(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function kv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Id(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?kv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ja,Av=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ja=Ja||document.createElement("div"),Ja.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ja.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Uo(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var bo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Zx=["Webkit","ms","Moz","O"];Object.keys(bo).forEach(function(t){Zx.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),bo[e]=bo[t]})});function Rv(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||bo.hasOwnProperty(t)&&bo[t]?(""+e).trim():e+"px"}function jv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Rv(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var eT=Me({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Sd(t,e){if(e){if(eT[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(q(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(q(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(q(61))}if(e.style!=null&&typeof e.style!="object")throw Error(q(62))}}function Cd(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Pd=null;function Gh(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Nd=null,di=null,hi=null;function Om(t){if(t=ga(t)){if(typeof Nd!="function")throw Error(q(280));var e=t.stateNode;e&&(e=Rc(e),Nd(t.stateNode,t.type,e))}}function Dv(t){di?hi?hi.push(t):hi=[t]:di=t}function Mv(){if(di){var t=di,e=hi;if(hi=di=null,Om(t),e)for(t=0;t<e.length;t++)Om(e[t])}}function Ov(t,e){return t(e)}function Lv(){}var Ru=!1;function Vv(t,e,n){if(Ru)return t(e,n);Ru=!0;try{return Ov(t,e,n)}finally{Ru=!1,(di!==null||hi!==null)&&(Lv(),Mv())}}function Fo(t,e){var n=t.stateNode;if(n===null)return null;var r=Rc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(q(231,e,typeof n));return n}var kd=!1;if(rr)try{var io={};Object.defineProperty(io,"passive",{get:function(){kd=!0}}),window.addEventListener("test",io,io),window.removeEventListener("test",io,io)}catch{kd=!1}function tT(t,e,n,r,s,i,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(f){this.onError(f)}}var Io=!1,Ul=null,Fl=!1,Ad=null,nT={onError:function(t){Io=!0,Ul=t}};function rT(t,e,n,r,s,i,o,l,c){Io=!1,Ul=null,tT.apply(nT,arguments)}function sT(t,e,n,r,s,i,o,l,c){if(rT.apply(this,arguments),Io){if(Io){var d=Ul;Io=!1,Ul=null}else throw Error(q(198));Fl||(Fl=!0,Ad=d)}}function Ds(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Uv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Lm(t){if(Ds(t)!==t)throw Error(q(188))}function iT(t){var e=t.alternate;if(!e){if(e=Ds(t),e===null)throw Error(q(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Lm(s),t;if(i===r)return Lm(s),e;i=i.sibling}throw Error(q(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(q(189))}}if(n.alternate!==r)throw Error(q(190))}if(n.tag!==3)throw Error(q(188));return n.stateNode.current===n?t:e}function Fv(t){return t=iT(t),t!==null?$v(t):null}function $v(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=$v(t);if(e!==null)return e;t=t.sibling}return null}var Bv=Yt.unstable_scheduleCallback,Vm=Yt.unstable_cancelCallback,oT=Yt.unstable_shouldYield,aT=Yt.unstable_requestPaint,ze=Yt.unstable_now,lT=Yt.unstable_getCurrentPriorityLevel,Kh=Yt.unstable_ImmediatePriority,zv=Yt.unstable_UserBlockingPriority,$l=Yt.unstable_NormalPriority,cT=Yt.unstable_LowPriority,Wv=Yt.unstable_IdlePriority,Pc=null,On=null;function uT(t){if(On&&typeof On.onCommitFiberRoot=="function")try{On.onCommitFiberRoot(Pc,t,void 0,(t.current.flags&128)===128)}catch{}}var _n=Math.clz32?Math.clz32:fT,dT=Math.log,hT=Math.LN2;function fT(t){return t>>>=0,t===0?32:31-(dT(t)/hT|0)|0}var Za=64,el=4194304;function go(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Bl(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=go(l):(i&=o,i!==0&&(r=go(i)))}else o=n&~s,o!==0?r=go(o):i!==0&&(r=go(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-_n(e),s=1<<n,r|=t[n],e&=~s;return r}function pT(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mT(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-_n(i),l=1<<o,c=s[o];c===-1?(!(l&n)||l&r)&&(s[o]=pT(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function Rd(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Hv(){var t=Za;return Za<<=1,!(Za&4194240)&&(Za=64),t}function ju(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function pa(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-_n(e),t[e]=n}function gT(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-_n(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Qh(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-_n(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var be=0;function qv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Gv,Yh,Kv,Qv,Yv,jd=!1,tl=[],Dr=null,Mr=null,Or=null,$o=new Map,Bo=new Map,br=[],yT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Um(t,e){switch(t){case"focusin":case"focusout":Dr=null;break;case"dragenter":case"dragleave":Mr=null;break;case"mouseover":case"mouseout":Or=null;break;case"pointerover":case"pointerout":$o.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Bo.delete(e.pointerId)}}function oo(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=ga(e),e!==null&&Yh(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function vT(t,e,n,r,s){switch(e){case"focusin":return Dr=oo(Dr,t,e,n,r,s),!0;case"dragenter":return Mr=oo(Mr,t,e,n,r,s),!0;case"mouseover":return Or=oo(Or,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return $o.set(i,oo($o.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Bo.set(i,oo(Bo.get(i)||null,t,e,n,r,s)),!0}return!1}function Xv(t){var e=fs(t.target);if(e!==null){var n=Ds(e);if(n!==null){if(e=n.tag,e===13){if(e=Uv(n),e!==null){t.blockedOn=e,Yv(t.priority,function(){Kv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function _l(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Dd(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Pd=r,n.target.dispatchEvent(r),Pd=null}else return e=ga(n),e!==null&&Yh(e),t.blockedOn=n,!1;e.shift()}return!0}function Fm(t,e,n){_l(t)&&n.delete(e)}function _T(){jd=!1,Dr!==null&&_l(Dr)&&(Dr=null),Mr!==null&&_l(Mr)&&(Mr=null),Or!==null&&_l(Or)&&(Or=null),$o.forEach(Fm),Bo.forEach(Fm)}function ao(t,e){t.blockedOn===e&&(t.blockedOn=null,jd||(jd=!0,Yt.unstable_scheduleCallback(Yt.unstable_NormalPriority,_T)))}function zo(t){function e(s){return ao(s,t)}if(0<tl.length){ao(tl[0],t);for(var n=1;n<tl.length;n++){var r=tl[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Dr!==null&&ao(Dr,t),Mr!==null&&ao(Mr,t),Or!==null&&ao(Or,t),$o.forEach(e),Bo.forEach(e),n=0;n<br.length;n++)r=br[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<br.length&&(n=br[0],n.blockedOn===null);)Xv(n),n.blockedOn===null&&br.shift()}var fi=dr.ReactCurrentBatchConfig,zl=!0;function wT(t,e,n,r){var s=be,i=fi.transition;fi.transition=null;try{be=1,Xh(t,e,n,r)}finally{be=s,fi.transition=i}}function ET(t,e,n,r){var s=be,i=fi.transition;fi.transition=null;try{be=4,Xh(t,e,n,r)}finally{be=s,fi.transition=i}}function Xh(t,e,n,r){if(zl){var s=Dd(t,e,n,r);if(s===null)zu(t,e,r,Wl,n),Um(t,r);else if(vT(s,t,e,n,r))r.stopPropagation();else if(Um(t,r),e&4&&-1<yT.indexOf(t)){for(;s!==null;){var i=ga(s);if(i!==null&&Gv(i),i=Dd(t,e,n,r),i===null&&zu(t,e,r,Wl,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else zu(t,e,r,null,n)}}var Wl=null;function Dd(t,e,n,r){if(Wl=null,t=Gh(r),t=fs(t),t!==null)if(e=Ds(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Uv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Wl=t,null}function Jv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(lT()){case Kh:return 1;case zv:return 4;case $l:case cT:return 16;case Wv:return 536870912;default:return 16}default:return 16}}var kr=null,Jh=null,wl=null;function Zv(){if(wl)return wl;var t,e=Jh,n=e.length,r,s="value"in kr?kr.value:kr.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return wl=s.slice(t,1<r?1-r:void 0)}function El(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function nl(){return!0}function $m(){return!1}function Zt(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?nl:$m,this.isPropagationStopped=$m,this}return Me(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=nl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=nl)},persist:function(){},isPersistent:nl}),e}var Oi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zh=Zt(Oi),ma=Me({},Oi,{view:0,detail:0}),xT=Zt(ma),Du,Mu,lo,Nc=Me({},ma,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ef,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==lo&&(lo&&t.type==="mousemove"?(Du=t.screenX-lo.screenX,Mu=t.screenY-lo.screenY):Mu=Du=0,lo=t),Du)},movementY:function(t){return"movementY"in t?t.movementY:Mu}}),Bm=Zt(Nc),TT=Me({},Nc,{dataTransfer:0}),bT=Zt(TT),IT=Me({},ma,{relatedTarget:0}),Ou=Zt(IT),ST=Me({},Oi,{animationName:0,elapsedTime:0,pseudoElement:0}),CT=Zt(ST),PT=Me({},Oi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),NT=Zt(PT),kT=Me({},Oi,{data:0}),zm=Zt(kT),AT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DT(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=jT[t])?!!e[t]:!1}function ef(){return DT}var MT=Me({},ma,{key:function(t){if(t.key){var e=AT[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=El(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?RT[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ef,charCode:function(t){return t.type==="keypress"?El(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?El(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),OT=Zt(MT),LT=Me({},Nc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Wm=Zt(LT),VT=Me({},ma,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ef}),UT=Zt(VT),FT=Me({},Oi,{propertyName:0,elapsedTime:0,pseudoElement:0}),$T=Zt(FT),BT=Me({},Nc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),zT=Zt(BT),WT=[9,13,27,32],tf=rr&&"CompositionEvent"in window,So=null;rr&&"documentMode"in document&&(So=document.documentMode);var HT=rr&&"TextEvent"in window&&!So,e0=rr&&(!tf||So&&8<So&&11>=So),Hm=String.fromCharCode(32),qm=!1;function t0(t,e){switch(t){case"keyup":return WT.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function n0(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Zs=!1;function qT(t,e){switch(t){case"compositionend":return n0(e);case"keypress":return e.which!==32?null:(qm=!0,Hm);case"textInput":return t=e.data,t===Hm&&qm?null:t;default:return null}}function GT(t,e){if(Zs)return t==="compositionend"||!tf&&t0(t,e)?(t=Zv(),wl=Jh=kr=null,Zs=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return e0&&e.locale!=="ko"?null:e.data;default:return null}}var KT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!KT[t.type]:e==="textarea"}function r0(t,e,n,r){Dv(r),e=Hl(e,"onChange"),0<e.length&&(n=new Zh("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Co=null,Wo=null;function QT(t){p0(t,0)}function kc(t){var e=ni(t);if(Cv(e))return t}function YT(t,e){if(t==="change")return e}var s0=!1;if(rr){var Lu;if(rr){var Vu="oninput"in document;if(!Vu){var Km=document.createElement("div");Km.setAttribute("oninput","return;"),Vu=typeof Km.oninput=="function"}Lu=Vu}else Lu=!1;s0=Lu&&(!document.documentMode||9<document.documentMode)}function Qm(){Co&&(Co.detachEvent("onpropertychange",i0),Wo=Co=null)}function i0(t){if(t.propertyName==="value"&&kc(Wo)){var e=[];r0(e,Wo,t,Gh(t)),Vv(QT,e)}}function XT(t,e,n){t==="focusin"?(Qm(),Co=e,Wo=n,Co.attachEvent("onpropertychange",i0)):t==="focusout"&&Qm()}function JT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return kc(Wo)}function ZT(t,e){if(t==="click")return kc(e)}function eb(t,e){if(t==="input"||t==="change")return kc(e)}function tb(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var xn=typeof Object.is=="function"?Object.is:tb;function Ho(t,e){if(xn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!gd.call(e,s)||!xn(t[s],e[s]))return!1}return!0}function Ym(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Xm(t,e){var n=Ym(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Ym(n)}}function o0(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?o0(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function a0(){for(var t=window,e=Vl();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Vl(t.document)}return e}function nf(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function nb(t){var e=a0(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&o0(n.ownerDocument.documentElement,n)){if(r!==null&&nf(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Xm(n,i);var o=Xm(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var rb=rr&&"documentMode"in document&&11>=document.documentMode,ei=null,Md=null,Po=null,Od=!1;function Jm(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Od||ei==null||ei!==Vl(r)||(r=ei,"selectionStart"in r&&nf(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Po&&Ho(Po,r)||(Po=r,r=Hl(Md,"onSelect"),0<r.length&&(e=new Zh("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=ei)))}function rl(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ti={animationend:rl("Animation","AnimationEnd"),animationiteration:rl("Animation","AnimationIteration"),animationstart:rl("Animation","AnimationStart"),transitionend:rl("Transition","TransitionEnd")},Uu={},l0={};rr&&(l0=document.createElement("div").style,"AnimationEvent"in window||(delete ti.animationend.animation,delete ti.animationiteration.animation,delete ti.animationstart.animation),"TransitionEvent"in window||delete ti.transitionend.transition);function Ac(t){if(Uu[t])return Uu[t];if(!ti[t])return t;var e=ti[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in l0)return Uu[t]=e[n];return t}var c0=Ac("animationend"),u0=Ac("animationiteration"),d0=Ac("animationstart"),h0=Ac("transitionend"),f0=new Map,Zm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zr(t,e){f0.set(t,e),js(e,[t])}for(var Fu=0;Fu<Zm.length;Fu++){var $u=Zm[Fu],sb=$u.toLowerCase(),ib=$u[0].toUpperCase()+$u.slice(1);Zr(sb,"on"+ib)}Zr(c0,"onAnimationEnd");Zr(u0,"onAnimationIteration");Zr(d0,"onAnimationStart");Zr("dblclick","onDoubleClick");Zr("focusin","onFocus");Zr("focusout","onBlur");Zr(h0,"onTransitionEnd");wi("onMouseEnter",["mouseout","mouseover"]);wi("onMouseLeave",["mouseout","mouseover"]);wi("onPointerEnter",["pointerout","pointerover"]);wi("onPointerLeave",["pointerout","pointerover"]);js("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));js("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));js("onBeforeInput",["compositionend","keypress","textInput","paste"]);js("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));js("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));js("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ob=new Set("cancel close invalid load scroll toggle".split(" ").concat(yo));function eg(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,sT(r,e,void 0,t),t.currentTarget=null}function p0(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;eg(s,l,d),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;eg(s,l,d),i=c}}}if(Fl)throw t=Ad,Fl=!1,Ad=null,t}function Ne(t,e){var n=e[$d];n===void 0&&(n=e[$d]=new Set);var r=t+"__bubble";n.has(r)||(m0(e,t,2,!1),n.add(r))}function Bu(t,e,n){var r=0;e&&(r|=4),m0(n,t,r,e)}var sl="_reactListening"+Math.random().toString(36).slice(2);function qo(t){if(!t[sl]){t[sl]=!0,xv.forEach(function(n){n!=="selectionchange"&&(ob.has(n)||Bu(n,!1,t),Bu(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[sl]||(e[sl]=!0,Bu("selectionchange",!1,e))}}function m0(t,e,n,r){switch(Jv(e)){case 1:var s=wT;break;case 4:s=ET;break;default:s=Xh}n=s.bind(null,e,n,t),s=void 0,!kd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function zu(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=fs(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}Vv(function(){var d=i,f=Gh(n),m=[];e:{var y=f0.get(t);if(y!==void 0){var I=Zh,N=t;switch(t){case"keypress":if(El(n)===0)break e;case"keydown":case"keyup":I=OT;break;case"focusin":N="focus",I=Ou;break;case"focusout":N="blur",I=Ou;break;case"beforeblur":case"afterblur":I=Ou;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":I=Bm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":I=bT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":I=UT;break;case c0:case u0:case d0:I=CT;break;case h0:I=$T;break;case"scroll":I=xT;break;case"wheel":I=zT;break;case"copy":case"cut":case"paste":I=NT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":I=Wm}var j=(e&4)!==0,A=!j&&t==="scroll",T=j?y!==null?y+"Capture":null:y;j=[];for(var w=d,S;w!==null;){S=w;var O=S.stateNode;if(S.tag===5&&O!==null&&(S=O,T!==null&&(O=Fo(w,T),O!=null&&j.push(Go(w,O,S)))),A)break;w=w.return}0<j.length&&(y=new I(y,N,null,n,f),m.push({event:y,listeners:j}))}}if(!(e&7)){e:{if(y=t==="mouseover"||t==="pointerover",I=t==="mouseout"||t==="pointerout",y&&n!==Pd&&(N=n.relatedTarget||n.fromElement)&&(fs(N)||N[sr]))break e;if((I||y)&&(y=f.window===f?f:(y=f.ownerDocument)?y.defaultView||y.parentWindow:window,I?(N=n.relatedTarget||n.toElement,I=d,N=N?fs(N):null,N!==null&&(A=Ds(N),N!==A||N.tag!==5&&N.tag!==6)&&(N=null)):(I=null,N=d),I!==N)){if(j=Bm,O="onMouseLeave",T="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(j=Wm,O="onPointerLeave",T="onPointerEnter",w="pointer"),A=I==null?y:ni(I),S=N==null?y:ni(N),y=new j(O,w+"leave",I,n,f),y.target=A,y.relatedTarget=S,O=null,fs(f)===d&&(j=new j(T,w+"enter",N,n,f),j.target=S,j.relatedTarget=A,O=j),A=O,I&&N)t:{for(j=I,T=N,w=0,S=j;S;S=qs(S))w++;for(S=0,O=T;O;O=qs(O))S++;for(;0<w-S;)j=qs(j),w--;for(;0<S-w;)T=qs(T),S--;for(;w--;){if(j===T||T!==null&&j===T.alternate)break t;j=qs(j),T=qs(T)}j=null}else j=null;I!==null&&tg(m,y,I,j,!1),N!==null&&A!==null&&tg(m,A,N,j,!0)}}e:{if(y=d?ni(d):window,I=y.nodeName&&y.nodeName.toLowerCase(),I==="select"||I==="input"&&y.type==="file")var R=YT;else if(Gm(y))if(s0)R=eb;else{R=JT;var V=XT}else(I=y.nodeName)&&I.toLowerCase()==="input"&&(y.type==="checkbox"||y.type==="radio")&&(R=ZT);if(R&&(R=R(t,d))){r0(m,R,n,f);break e}V&&V(t,y,d),t==="focusout"&&(V=y._wrapperState)&&V.controlled&&y.type==="number"&&Td(y,"number",y.value)}switch(V=d?ni(d):window,t){case"focusin":(Gm(V)||V.contentEditable==="true")&&(ei=V,Md=d,Po=null);break;case"focusout":Po=Md=ei=null;break;case"mousedown":Od=!0;break;case"contextmenu":case"mouseup":case"dragend":Od=!1,Jm(m,n,f);break;case"selectionchange":if(rb)break;case"keydown":case"keyup":Jm(m,n,f)}var _;if(tf)e:{switch(t){case"compositionstart":var g="onCompositionStart";break e;case"compositionend":g="onCompositionEnd";break e;case"compositionupdate":g="onCompositionUpdate";break e}g=void 0}else Zs?t0(t,n)&&(g="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(g="onCompositionStart");g&&(e0&&n.locale!=="ko"&&(Zs||g!=="onCompositionStart"?g==="onCompositionEnd"&&Zs&&(_=Zv()):(kr=f,Jh="value"in kr?kr.value:kr.textContent,Zs=!0)),V=Hl(d,g),0<V.length&&(g=new zm(g,t,null,n,f),m.push({event:g,listeners:V}),_?g.data=_:(_=n0(n),_!==null&&(g.data=_)))),(_=HT?qT(t,n):GT(t,n))&&(d=Hl(d,"onBeforeInput"),0<d.length&&(f=new zm("onBeforeInput","beforeinput",null,n,f),m.push({event:f,listeners:d}),f.data=_))}p0(m,e)})}function Go(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Hl(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Fo(t,n),i!=null&&r.unshift(Go(t,i,s)),i=Fo(t,e),i!=null&&r.push(Go(t,i,s))),t=t.return}return r}function qs(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function tg(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=Fo(n,i),c!=null&&o.unshift(Go(n,c,l))):s||(c=Fo(n,i),c!=null&&o.push(Go(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var ab=/\r\n?/g,lb=/\u0000|\uFFFD/g;function ng(t){return(typeof t=="string"?t:""+t).replace(ab,`
`).replace(lb,"")}function il(t,e,n){if(e=ng(e),ng(t)!==e&&n)throw Error(q(425))}function ql(){}var Ld=null,Vd=null;function Ud(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Fd=typeof setTimeout=="function"?setTimeout:void 0,cb=typeof clearTimeout=="function"?clearTimeout:void 0,rg=typeof Promise=="function"?Promise:void 0,ub=typeof queueMicrotask=="function"?queueMicrotask:typeof rg<"u"?function(t){return rg.resolve(null).then(t).catch(db)}:Fd;function db(t){setTimeout(function(){throw t})}function Wu(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),zo(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);zo(e)}function Lr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function sg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Li=Math.random().toString(36).slice(2),jn="__reactFiber$"+Li,Ko="__reactProps$"+Li,sr="__reactContainer$"+Li,$d="__reactEvents$"+Li,hb="__reactListeners$"+Li,fb="__reactHandles$"+Li;function fs(t){var e=t[jn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[sr]||n[jn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=sg(t);t!==null;){if(n=t[jn])return n;t=sg(t)}return e}t=n,n=t.parentNode}return null}function ga(t){return t=t[jn]||t[sr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ni(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(q(33))}function Rc(t){return t[Ko]||null}var Bd=[],ri=-1;function es(t){return{current:t}}function Ae(t){0>ri||(t.current=Bd[ri],Bd[ri]=null,ri--)}function Ce(t,e){ri++,Bd[ri]=t.current,t.current=e}var Kr={},Pt=es(Kr),$t=es(!1),Es=Kr;function Ei(t,e){var n=t.type.contextTypes;if(!n)return Kr;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Bt(t){return t=t.childContextTypes,t!=null}function Gl(){Ae($t),Ae(Pt)}function ig(t,e,n){if(Pt.current!==Kr)throw Error(q(168));Ce(Pt,e),Ce($t,n)}function g0(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(q(108,Xx(t)||"Unknown",s));return Me({},n,r)}function Kl(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Kr,Es=Pt.current,Ce(Pt,t),Ce($t,$t.current),!0}function og(t,e,n){var r=t.stateNode;if(!r)throw Error(q(169));n?(t=g0(t,e,Es),r.__reactInternalMemoizedMergedChildContext=t,Ae($t),Ae(Pt),Ce(Pt,t)):Ae($t),Ce($t,n)}var Gn=null,jc=!1,Hu=!1;function y0(t){Gn===null?Gn=[t]:Gn.push(t)}function pb(t){jc=!0,y0(t)}function ts(){if(!Hu&&Gn!==null){Hu=!0;var t=0,e=be;try{var n=Gn;for(be=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Gn=null,jc=!1}catch(s){throw Gn!==null&&(Gn=Gn.slice(t+1)),Bv(Kh,ts),s}finally{be=e,Hu=!1}}return null}var si=[],ii=0,Ql=null,Yl=0,en=[],tn=0,xs=null,Qn=1,Yn="";function us(t,e){si[ii++]=Yl,si[ii++]=Ql,Ql=t,Yl=e}function v0(t,e,n){en[tn++]=Qn,en[tn++]=Yn,en[tn++]=xs,xs=t;var r=Qn;t=Yn;var s=32-_n(r)-1;r&=~(1<<s),n+=1;var i=32-_n(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Qn=1<<32-_n(e)+s|n<<s|r,Yn=i+t}else Qn=1<<i|n<<s|r,Yn=t}function rf(t){t.return!==null&&(us(t,1),v0(t,1,0))}function sf(t){for(;t===Ql;)Ql=si[--ii],si[ii]=null,Yl=si[--ii],si[ii]=null;for(;t===xs;)xs=en[--tn],en[tn]=null,Yn=en[--tn],en[tn]=null,Qn=en[--tn],en[tn]=null}var Qt=null,Gt=null,Re=!1,vn=null;function _0(t,e){var n=nn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function ag(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Qt=t,Gt=Lr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Qt=t,Gt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=xs!==null?{id:Qn,overflow:Yn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=nn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Qt=t,Gt=null,!0):!1;default:return!1}}function zd(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Wd(t){if(Re){var e=Gt;if(e){var n=e;if(!ag(t,e)){if(zd(t))throw Error(q(418));e=Lr(n.nextSibling);var r=Qt;e&&ag(t,e)?_0(r,n):(t.flags=t.flags&-4097|2,Re=!1,Qt=t)}}else{if(zd(t))throw Error(q(418));t.flags=t.flags&-4097|2,Re=!1,Qt=t}}}function lg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Qt=t}function ol(t){if(t!==Qt)return!1;if(!Re)return lg(t),Re=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Ud(t.type,t.memoizedProps)),e&&(e=Gt)){if(zd(t))throw w0(),Error(q(418));for(;e;)_0(t,e),e=Lr(e.nextSibling)}if(lg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(q(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Gt=Lr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Gt=null}}else Gt=Qt?Lr(t.stateNode.nextSibling):null;return!0}function w0(){for(var t=Gt;t;)t=Lr(t.nextSibling)}function xi(){Gt=Qt=null,Re=!1}function of(t){vn===null?vn=[t]:vn.push(t)}var mb=dr.ReactCurrentBatchConfig;function co(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(q(309));var r=n.stateNode}if(!r)throw Error(q(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(q(284));if(!n._owner)throw Error(q(290,t))}return t}function al(t,e){throw t=Object.prototype.toString.call(e),Error(q(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function cg(t){var e=t._init;return e(t._payload)}function E0(t){function e(T,w){if(t){var S=T.deletions;S===null?(T.deletions=[w],T.flags|=16):S.push(w)}}function n(T,w){if(!t)return null;for(;w!==null;)e(T,w),w=w.sibling;return null}function r(T,w){for(T=new Map;w!==null;)w.key!==null?T.set(w.key,w):T.set(w.index,w),w=w.sibling;return T}function s(T,w){return T=$r(T,w),T.index=0,T.sibling=null,T}function i(T,w,S){return T.index=S,t?(S=T.alternate,S!==null?(S=S.index,S<w?(T.flags|=2,w):S):(T.flags|=2,w)):(T.flags|=1048576,w)}function o(T){return t&&T.alternate===null&&(T.flags|=2),T}function l(T,w,S,O){return w===null||w.tag!==6?(w=Ju(S,T.mode,O),w.return=T,w):(w=s(w,S),w.return=T,w)}function c(T,w,S,O){var R=S.type;return R===Js?f(T,w,S.props.children,O,S.key):w!==null&&(w.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===xr&&cg(R)===w.type)?(O=s(w,S.props),O.ref=co(T,w,S),O.return=T,O):(O=Pl(S.type,S.key,S.props,null,T.mode,O),O.ref=co(T,w,S),O.return=T,O)}function d(T,w,S,O){return w===null||w.tag!==4||w.stateNode.containerInfo!==S.containerInfo||w.stateNode.implementation!==S.implementation?(w=Zu(S,T.mode,O),w.return=T,w):(w=s(w,S.children||[]),w.return=T,w)}function f(T,w,S,O,R){return w===null||w.tag!==7?(w=_s(S,T.mode,O,R),w.return=T,w):(w=s(w,S),w.return=T,w)}function m(T,w,S){if(typeof w=="string"&&w!==""||typeof w=="number")return w=Ju(""+w,T.mode,S),w.return=T,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Ya:return S=Pl(w.type,w.key,w.props,null,T.mode,S),S.ref=co(T,null,w),S.return=T,S;case Xs:return w=Zu(w,T.mode,S),w.return=T,w;case xr:var O=w._init;return m(T,O(w._payload),S)}if(mo(w)||so(w))return w=_s(w,T.mode,S,null),w.return=T,w;al(T,w)}return null}function y(T,w,S,O){var R=w!==null?w.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return R!==null?null:l(T,w,""+S,O);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Ya:return S.key===R?c(T,w,S,O):null;case Xs:return S.key===R?d(T,w,S,O):null;case xr:return R=S._init,y(T,w,R(S._payload),O)}if(mo(S)||so(S))return R!==null?null:f(T,w,S,O,null);al(T,S)}return null}function I(T,w,S,O,R){if(typeof O=="string"&&O!==""||typeof O=="number")return T=T.get(S)||null,l(w,T,""+O,R);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case Ya:return T=T.get(O.key===null?S:O.key)||null,c(w,T,O,R);case Xs:return T=T.get(O.key===null?S:O.key)||null,d(w,T,O,R);case xr:var V=O._init;return I(T,w,S,V(O._payload),R)}if(mo(O)||so(O))return T=T.get(S)||null,f(w,T,O,R,null);al(w,O)}return null}function N(T,w,S,O){for(var R=null,V=null,_=w,g=w=0,E=null;_!==null&&g<S.length;g++){_.index>g?(E=_,_=null):E=_.sibling;var x=y(T,_,S[g],O);if(x===null){_===null&&(_=E);break}t&&_&&x.alternate===null&&e(T,_),w=i(x,w,g),V===null?R=x:V.sibling=x,V=x,_=E}if(g===S.length)return n(T,_),Re&&us(T,g),R;if(_===null){for(;g<S.length;g++)_=m(T,S[g],O),_!==null&&(w=i(_,w,g),V===null?R=_:V.sibling=_,V=_);return Re&&us(T,g),R}for(_=r(T,_);g<S.length;g++)E=I(_,T,g,S[g],O),E!==null&&(t&&E.alternate!==null&&_.delete(E.key===null?g:E.key),w=i(E,w,g),V===null?R=E:V.sibling=E,V=E);return t&&_.forEach(function(C){return e(T,C)}),Re&&us(T,g),R}function j(T,w,S,O){var R=so(S);if(typeof R!="function")throw Error(q(150));if(S=R.call(S),S==null)throw Error(q(151));for(var V=R=null,_=w,g=w=0,E=null,x=S.next();_!==null&&!x.done;g++,x=S.next()){_.index>g?(E=_,_=null):E=_.sibling;var C=y(T,_,x.value,O);if(C===null){_===null&&(_=E);break}t&&_&&C.alternate===null&&e(T,_),w=i(C,w,g),V===null?R=C:V.sibling=C,V=C,_=E}if(x.done)return n(T,_),Re&&us(T,g),R;if(_===null){for(;!x.done;g++,x=S.next())x=m(T,x.value,O),x!==null&&(w=i(x,w,g),V===null?R=x:V.sibling=x,V=x);return Re&&us(T,g),R}for(_=r(T,_);!x.done;g++,x=S.next())x=I(_,T,g,x.value,O),x!==null&&(t&&x.alternate!==null&&_.delete(x.key===null?g:x.key),w=i(x,w,g),V===null?R=x:V.sibling=x,V=x);return t&&_.forEach(function(P){return e(T,P)}),Re&&us(T,g),R}function A(T,w,S,O){if(typeof S=="object"&&S!==null&&S.type===Js&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case Ya:e:{for(var R=S.key,V=w;V!==null;){if(V.key===R){if(R=S.type,R===Js){if(V.tag===7){n(T,V.sibling),w=s(V,S.props.children),w.return=T,T=w;break e}}else if(V.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===xr&&cg(R)===V.type){n(T,V.sibling),w=s(V,S.props),w.ref=co(T,V,S),w.return=T,T=w;break e}n(T,V);break}else e(T,V);V=V.sibling}S.type===Js?(w=_s(S.props.children,T.mode,O,S.key),w.return=T,T=w):(O=Pl(S.type,S.key,S.props,null,T.mode,O),O.ref=co(T,w,S),O.return=T,T=O)}return o(T);case Xs:e:{for(V=S.key;w!==null;){if(w.key===V)if(w.tag===4&&w.stateNode.containerInfo===S.containerInfo&&w.stateNode.implementation===S.implementation){n(T,w.sibling),w=s(w,S.children||[]),w.return=T,T=w;break e}else{n(T,w);break}else e(T,w);w=w.sibling}w=Zu(S,T.mode,O),w.return=T,T=w}return o(T);case xr:return V=S._init,A(T,w,V(S._payload),O)}if(mo(S))return N(T,w,S,O);if(so(S))return j(T,w,S,O);al(T,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,w!==null&&w.tag===6?(n(T,w.sibling),w=s(w,S),w.return=T,T=w):(n(T,w),w=Ju(S,T.mode,O),w.return=T,T=w),o(T)):n(T,w)}return A}var Ti=E0(!0),x0=E0(!1),Xl=es(null),Jl=null,oi=null,af=null;function lf(){af=oi=Jl=null}function cf(t){var e=Xl.current;Ae(Xl),t._currentValue=e}function Hd(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function pi(t,e){Jl=t,af=oi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ft=!0),t.firstContext=null)}function on(t){var e=t._currentValue;if(af!==t)if(t={context:t,memoizedValue:e,next:null},oi===null){if(Jl===null)throw Error(q(308));oi=t,Jl.dependencies={lanes:0,firstContext:t}}else oi=oi.next=t;return e}var ps=null;function uf(t){ps===null?ps=[t]:ps.push(t)}function T0(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,uf(e)):(n.next=s.next,s.next=n),e.interleaved=n,ir(t,r)}function ir(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Tr=!1;function df(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function b0(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function er(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Vr(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ve&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,ir(t,n)}return s=r.interleaved,s===null?(e.next=e,uf(r)):(e.next=s.next,s.next=e),r.interleaved=e,ir(t,n)}function xl(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Qh(t,n)}}function ug(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Zl(t,e,n,r){var s=t.updateQueue;Tr=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var f=t.alternate;f!==null&&(f=f.updateQueue,l=f.lastBaseUpdate,l!==o&&(l===null?f.firstBaseUpdate=d:l.next=d,f.lastBaseUpdate=c))}if(i!==null){var m=s.baseState;o=0,f=d=c=null,l=i;do{var y=l.lane,I=l.eventTime;if((r&y)===y){f!==null&&(f=f.next={eventTime:I,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var N=t,j=l;switch(y=e,I=n,j.tag){case 1:if(N=j.payload,typeof N=="function"){m=N.call(I,m,y);break e}m=N;break e;case 3:N.flags=N.flags&-65537|128;case 0:if(N=j.payload,y=typeof N=="function"?N.call(I,m,y):N,y==null)break e;m=Me({},m,y);break e;case 2:Tr=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,y=s.effects,y===null?s.effects=[l]:y.push(l))}else I={eventTime:I,lane:y,tag:l.tag,payload:l.payload,callback:l.callback,next:null},f===null?(d=f=I,c=m):f=f.next=I,o|=y;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;y=l,l=y.next,y.next=null,s.lastBaseUpdate=y,s.shared.pending=null}}while(1);if(f===null&&(c=m),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=f,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);bs|=o,t.lanes=o,t.memoizedState=m}}function dg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(q(191,s));s.call(r)}}}var ya={},Ln=es(ya),Qo=es(ya),Yo=es(ya);function ms(t){if(t===ya)throw Error(q(174));return t}function hf(t,e){switch(Ce(Yo,e),Ce(Qo,t),Ce(Ln,ya),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Id(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Id(e,t)}Ae(Ln),Ce(Ln,e)}function bi(){Ae(Ln),Ae(Qo),Ae(Yo)}function I0(t){ms(Yo.current);var e=ms(Ln.current),n=Id(e,t.type);e!==n&&(Ce(Qo,t),Ce(Ln,n))}function ff(t){Qo.current===t&&(Ae(Ln),Ae(Qo))}var je=es(0);function ec(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var qu=[];function pf(){for(var t=0;t<qu.length;t++)qu[t]._workInProgressVersionPrimary=null;qu.length=0}var Tl=dr.ReactCurrentDispatcher,Gu=dr.ReactCurrentBatchConfig,Ts=0,De=null,Xe=null,rt=null,tc=!1,No=!1,Xo=0,gb=0;function Et(){throw Error(q(321))}function mf(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!xn(t[n],e[n]))return!1;return!0}function gf(t,e,n,r,s,i){if(Ts=i,De=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Tl.current=t===null||t.memoizedState===null?wb:Eb,t=n(r,s),No){i=0;do{if(No=!1,Xo=0,25<=i)throw Error(q(301));i+=1,rt=Xe=null,e.updateQueue=null,Tl.current=xb,t=n(r,s)}while(No)}if(Tl.current=nc,e=Xe!==null&&Xe.next!==null,Ts=0,rt=Xe=De=null,tc=!1,e)throw Error(q(300));return t}function yf(){var t=Xo!==0;return Xo=0,t}function An(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rt===null?De.memoizedState=rt=t:rt=rt.next=t,rt}function an(){if(Xe===null){var t=De.alternate;t=t!==null?t.memoizedState:null}else t=Xe.next;var e=rt===null?De.memoizedState:rt.next;if(e!==null)rt=e,Xe=t;else{if(t===null)throw Error(q(310));Xe=t,t={memoizedState:Xe.memoizedState,baseState:Xe.baseState,baseQueue:Xe.baseQueue,queue:Xe.queue,next:null},rt===null?De.memoizedState=rt=t:rt=rt.next=t}return rt}function Jo(t,e){return typeof e=="function"?e(t):e}function Ku(t){var e=an(),n=e.queue;if(n===null)throw Error(q(311));n.lastRenderedReducer=t;var r=Xe,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,c=null,d=i;do{var f=d.lane;if((Ts&f)===f)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var m={lane:f,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=m,o=r):c=c.next=m,De.lanes|=f,bs|=f}d=d.next}while(d!==null&&d!==i);c===null?o=r:c.next=l,xn(r,e.memoizedState)||(Ft=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,De.lanes|=i,bs|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Qu(t){var e=an(),n=e.queue;if(n===null)throw Error(q(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);xn(i,e.memoizedState)||(Ft=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function S0(){}function C0(t,e){var n=De,r=an(),s=e(),i=!xn(r.memoizedState,s);if(i&&(r.memoizedState=s,Ft=!0),r=r.queue,vf(k0.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||rt!==null&&rt.memoizedState.tag&1){if(n.flags|=2048,Zo(9,N0.bind(null,n,r,s,e),void 0,null),st===null)throw Error(q(349));Ts&30||P0(n,e,s)}return s}function P0(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=De.updateQueue,e===null?(e={lastEffect:null,stores:null},De.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function N0(t,e,n,r){e.value=n,e.getSnapshot=r,A0(e)&&R0(t)}function k0(t,e,n){return n(function(){A0(e)&&R0(t)})}function A0(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!xn(t,n)}catch{return!0}}function R0(t){var e=ir(t,1);e!==null&&wn(e,t,1,-1)}function hg(t){var e=An();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Jo,lastRenderedState:t},e.queue=t,t=t.dispatch=_b.bind(null,De,t),[e.memoizedState,t]}function Zo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=De.updateQueue,e===null?(e={lastEffect:null,stores:null},De.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function j0(){return an().memoizedState}function bl(t,e,n,r){var s=An();De.flags|=t,s.memoizedState=Zo(1|e,n,void 0,r===void 0?null:r)}function Dc(t,e,n,r){var s=an();r=r===void 0?null:r;var i=void 0;if(Xe!==null){var o=Xe.memoizedState;if(i=o.destroy,r!==null&&mf(r,o.deps)){s.memoizedState=Zo(e,n,i,r);return}}De.flags|=t,s.memoizedState=Zo(1|e,n,i,r)}function fg(t,e){return bl(8390656,8,t,e)}function vf(t,e){return Dc(2048,8,t,e)}function D0(t,e){return Dc(4,2,t,e)}function M0(t,e){return Dc(4,4,t,e)}function O0(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function L0(t,e,n){return n=n!=null?n.concat([t]):null,Dc(4,4,O0.bind(null,e,t),n)}function _f(){}function V0(t,e){var n=an();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&mf(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function U0(t,e){var n=an();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&mf(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function F0(t,e,n){return Ts&21?(xn(n,e)||(n=Hv(),De.lanes|=n,bs|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ft=!0),t.memoizedState=n)}function yb(t,e){var n=be;be=n!==0&&4>n?n:4,t(!0);var r=Gu.transition;Gu.transition={};try{t(!1),e()}finally{be=n,Gu.transition=r}}function $0(){return an().memoizedState}function vb(t,e,n){var r=Fr(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},B0(t))z0(e,n);else if(n=T0(t,e,n,r),n!==null){var s=Dt();wn(n,t,r,s),W0(n,e,r)}}function _b(t,e,n){var r=Fr(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(B0(t))z0(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,n);if(s.hasEagerState=!0,s.eagerState=l,xn(l,o)){var c=e.interleaved;c===null?(s.next=s,uf(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=T0(t,e,s,r),n!==null&&(s=Dt(),wn(n,t,r,s),W0(n,e,r))}}function B0(t){var e=t.alternate;return t===De||e!==null&&e===De}function z0(t,e){No=tc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function W0(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Qh(t,n)}}var nc={readContext:on,useCallback:Et,useContext:Et,useEffect:Et,useImperativeHandle:Et,useInsertionEffect:Et,useLayoutEffect:Et,useMemo:Et,useReducer:Et,useRef:Et,useState:Et,useDebugValue:Et,useDeferredValue:Et,useTransition:Et,useMutableSource:Et,useSyncExternalStore:Et,useId:Et,unstable_isNewReconciler:!1},wb={readContext:on,useCallback:function(t,e){return An().memoizedState=[t,e===void 0?null:e],t},useContext:on,useEffect:fg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,bl(4194308,4,O0.bind(null,e,t),n)},useLayoutEffect:function(t,e){return bl(4194308,4,t,e)},useInsertionEffect:function(t,e){return bl(4,2,t,e)},useMemo:function(t,e){var n=An();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=An();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=vb.bind(null,De,t),[r.memoizedState,t]},useRef:function(t){var e=An();return t={current:t},e.memoizedState=t},useState:hg,useDebugValue:_f,useDeferredValue:function(t){return An().memoizedState=t},useTransition:function(){var t=hg(!1),e=t[0];return t=yb.bind(null,t[1]),An().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=De,s=An();if(Re){if(n===void 0)throw Error(q(407));n=n()}else{if(n=e(),st===null)throw Error(q(349));Ts&30||P0(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,fg(k0.bind(null,r,i,t),[t]),r.flags|=2048,Zo(9,N0.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=An(),e=st.identifierPrefix;if(Re){var n=Yn,r=Qn;n=(r&~(1<<32-_n(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Xo++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=gb++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Eb={readContext:on,useCallback:V0,useContext:on,useEffect:vf,useImperativeHandle:L0,useInsertionEffect:D0,useLayoutEffect:M0,useMemo:U0,useReducer:Ku,useRef:j0,useState:function(){return Ku(Jo)},useDebugValue:_f,useDeferredValue:function(t){var e=an();return F0(e,Xe.memoizedState,t)},useTransition:function(){var t=Ku(Jo)[0],e=an().memoizedState;return[t,e]},useMutableSource:S0,useSyncExternalStore:C0,useId:$0,unstable_isNewReconciler:!1},xb={readContext:on,useCallback:V0,useContext:on,useEffect:vf,useImperativeHandle:L0,useInsertionEffect:D0,useLayoutEffect:M0,useMemo:U0,useReducer:Qu,useRef:j0,useState:function(){return Qu(Jo)},useDebugValue:_f,useDeferredValue:function(t){var e=an();return Xe===null?e.memoizedState=t:F0(e,Xe.memoizedState,t)},useTransition:function(){var t=Qu(Jo)[0],e=an().memoizedState;return[t,e]},useMutableSource:S0,useSyncExternalStore:C0,useId:$0,unstable_isNewReconciler:!1};function mn(t,e){if(t&&t.defaultProps){e=Me({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function qd(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Me({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Mc={isMounted:function(t){return(t=t._reactInternals)?Ds(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Dt(),s=Fr(t),i=er(r,s);i.payload=e,n!=null&&(i.callback=n),e=Vr(t,i,s),e!==null&&(wn(e,t,s,r),xl(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Dt(),s=Fr(t),i=er(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Vr(t,i,s),e!==null&&(wn(e,t,s,r),xl(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Dt(),r=Fr(t),s=er(n,r);s.tag=2,e!=null&&(s.callback=e),e=Vr(t,s,r),e!==null&&(wn(e,t,r,n),xl(e,t,r))}};function pg(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Ho(n,r)||!Ho(s,i):!0}function H0(t,e,n){var r=!1,s=Kr,i=e.contextType;return typeof i=="object"&&i!==null?i=on(i):(s=Bt(e)?Es:Pt.current,r=e.contextTypes,i=(r=r!=null)?Ei(t,s):Kr),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Mc,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function mg(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Mc.enqueueReplaceState(e,e.state,null)}function Gd(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},df(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=on(i):(i=Bt(e)?Es:Pt.current,s.context=Ei(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(qd(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Mc.enqueueReplaceState(s,s.state,null),Zl(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Ii(t,e){try{var n="",r=e;do n+=Yx(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Yu(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Kd(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Tb=typeof WeakMap=="function"?WeakMap:Map;function q0(t,e,n){n=er(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){sc||(sc=!0,sh=r),Kd(t,e)},n}function G0(t,e,n){n=er(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Kd(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Kd(t,e),typeof r!="function"&&(Ur===null?Ur=new Set([this]):Ur.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function gg(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new Tb;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=Lb.bind(null,t,e,n),e.then(t,t))}function yg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function vg(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=er(-1,1),e.tag=2,Vr(n,e,1))),n.lanes|=1),t)}var bb=dr.ReactCurrentOwner,Ft=!1;function jt(t,e,n,r){e.child=t===null?x0(e,null,n,r):Ti(e,t.child,n,r)}function _g(t,e,n,r,s){n=n.render;var i=e.ref;return pi(e,s),r=gf(t,e,n,r,i,s),n=yf(),t!==null&&!Ft?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,or(t,e,s)):(Re&&n&&rf(e),e.flags|=1,jt(t,e,r,s),e.child)}function wg(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!Cf(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,K0(t,e,i,r,s)):(t=Pl(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Ho,n(o,r)&&t.ref===e.ref)return or(t,e,s)}return e.flags|=1,t=$r(i,r),t.ref=e.ref,t.return=e,e.child=t}function K0(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Ho(i,r)&&t.ref===e.ref)if(Ft=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Ft=!0);else return e.lanes=t.lanes,or(t,e,s)}return Qd(t,e,n,r,s)}function Q0(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ce(li,qt),qt|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ce(li,qt),qt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Ce(li,qt),qt|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Ce(li,qt),qt|=r;return jt(t,e,s,n),e.child}function Y0(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Qd(t,e,n,r,s){var i=Bt(n)?Es:Pt.current;return i=Ei(e,i),pi(e,s),n=gf(t,e,n,r,i,s),r=yf(),t!==null&&!Ft?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,or(t,e,s)):(Re&&r&&rf(e),e.flags|=1,jt(t,e,n,s),e.child)}function Eg(t,e,n,r,s){if(Bt(n)){var i=!0;Kl(e)}else i=!1;if(pi(e,s),e.stateNode===null)Il(t,e),H0(e,n,r),Gd(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=on(d):(d=Bt(n)?Es:Pt.current,d=Ei(e,d));var f=n.getDerivedStateFromProps,m=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function";m||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&mg(e,o,r,d),Tr=!1;var y=e.memoizedState;o.state=y,Zl(e,r,o,s),c=e.memoizedState,l!==r||y!==c||$t.current||Tr?(typeof f=="function"&&(qd(e,n,f,r),c=e.memoizedState),(l=Tr||pg(e,n,l,r,y,c,d))?(m||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,b0(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:mn(e.type,l),o.props=d,m=e.pendingProps,y=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=on(c):(c=Bt(n)?Es:Pt.current,c=Ei(e,c));var I=n.getDerivedStateFromProps;(f=typeof I=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==m||y!==c)&&mg(e,o,r,c),Tr=!1,y=e.memoizedState,o.state=y,Zl(e,r,o,s);var N=e.memoizedState;l!==m||y!==N||$t.current||Tr?(typeof I=="function"&&(qd(e,n,I,r),N=e.memoizedState),(d=Tr||pg(e,n,d,r,y,N,c)||!1)?(f||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,N,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,N,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&y===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&y===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=N),o.props=r,o.state=N,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&y===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&y===t.memoizedState||(e.flags|=1024),r=!1)}return Yd(t,e,n,r,i,s)}function Yd(t,e,n,r,s,i){Y0(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&og(e,n,!1),or(t,e,i);r=e.stateNode,bb.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Ti(e,t.child,null,i),e.child=Ti(e,null,l,i)):jt(t,e,l,i),e.memoizedState=r.state,s&&og(e,n,!0),e.child}function X0(t){var e=t.stateNode;e.pendingContext?ig(t,e.pendingContext,e.pendingContext!==e.context):e.context&&ig(t,e.context,!1),hf(t,e.containerInfo)}function xg(t,e,n,r,s){return xi(),of(s),e.flags|=256,jt(t,e,n,r),e.child}var Xd={dehydrated:null,treeContext:null,retryLane:0};function Jd(t){return{baseLanes:t,cachePool:null,transitions:null}}function J0(t,e,n){var r=e.pendingProps,s=je.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Ce(je,s&1),t===null)return Wd(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Vc(o,r,0,null),t=_s(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Jd(n),e.memoizedState=Xd,t):wf(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return Ib(t,e,o,r,l,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=$r(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=$r(l,i):(i=_s(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Jd(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Xd,r}return i=t.child,t=i.sibling,r=$r(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function wf(t,e){return e=Vc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ll(t,e,n,r){return r!==null&&of(r),Ti(e,t.child,null,n),t=wf(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Ib(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=Yu(Error(q(422))),ll(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Vc({mode:"visible",children:r.children},s,0,null),i=_s(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Ti(e,t.child,null,o),e.child.memoizedState=Jd(o),e.memoizedState=Xd,i);if(!(e.mode&1))return ll(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(q(419)),r=Yu(i,r,void 0),ll(t,e,o,r)}if(l=(o&t.childLanes)!==0,Ft||l){if(r=st,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,ir(t,s),wn(r,t,s,-1))}return Sf(),r=Yu(Error(q(421))),ll(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=Vb.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Gt=Lr(s.nextSibling),Qt=e,Re=!0,vn=null,t!==null&&(en[tn++]=Qn,en[tn++]=Yn,en[tn++]=xs,Qn=t.id,Yn=t.overflow,xs=e),e=wf(e,r.children),e.flags|=4096,e)}function Tg(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Hd(t.return,e,n)}function Xu(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function Z0(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(jt(t,e,r.children,n),r=je.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Tg(t,n,e);else if(t.tag===19)Tg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ce(je,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&ec(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Xu(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&ec(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Xu(e,!0,n,null,i);break;case"together":Xu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Il(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function or(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),bs|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(q(153));if(e.child!==null){for(t=e.child,n=$r(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=$r(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Sb(t,e,n){switch(e.tag){case 3:X0(e),xi();break;case 5:I0(e);break;case 1:Bt(e.type)&&Kl(e);break;case 4:hf(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Ce(Xl,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ce(je,je.current&1),e.flags|=128,null):n&e.child.childLanes?J0(t,e,n):(Ce(je,je.current&1),t=or(t,e,n),t!==null?t.sibling:null);Ce(je,je.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return Z0(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ce(je,je.current),r)break;return null;case 22:case 23:return e.lanes=0,Q0(t,e,n)}return or(t,e,n)}var e_,Zd,t_,n_;e_=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Zd=function(){};t_=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,ms(Ln.current);var i=null;switch(n){case"input":s=Ed(t,s),r=Ed(t,r),i=[];break;case"select":s=Me({},s,{value:void 0}),r=Me({},r,{value:void 0}),i=[];break;case"textarea":s=bd(t,s),r=bd(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=ql)}Sd(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Vo.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Vo.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Ne("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};n_=function(t,e,n,r){n!==r&&(e.flags|=4)};function uo(t,e){if(!Re)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function xt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Cb(t,e,n){var r=e.pendingProps;switch(sf(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xt(e),null;case 1:return Bt(e.type)&&Gl(),xt(e),null;case 3:return r=e.stateNode,bi(),Ae($t),Ae(Pt),pf(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ol(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,vn!==null&&(ah(vn),vn=null))),Zd(t,e),xt(e),null;case 5:ff(e);var s=ms(Yo.current);if(n=e.type,t!==null&&e.stateNode!=null)t_(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(q(166));return xt(e),null}if(t=ms(Ln.current),ol(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[jn]=e,r[Ko]=i,t=(e.mode&1)!==0,n){case"dialog":Ne("cancel",r),Ne("close",r);break;case"iframe":case"object":case"embed":Ne("load",r);break;case"video":case"audio":for(s=0;s<yo.length;s++)Ne(yo[s],r);break;case"source":Ne("error",r);break;case"img":case"image":case"link":Ne("error",r),Ne("load",r);break;case"details":Ne("toggle",r);break;case"input":Rm(r,i),Ne("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Ne("invalid",r);break;case"textarea":Dm(r,i),Ne("invalid",r)}Sd(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&il(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&il(r.textContent,l,t),s=["children",""+l]):Vo.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&Ne("scroll",r)}switch(n){case"input":Xa(r),jm(r,i,!0);break;case"textarea":Xa(r),Mm(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=ql)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=kv(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[jn]=e,t[Ko]=r,e_(t,e,!1,!1),e.stateNode=t;e:{switch(o=Cd(n,r),n){case"dialog":Ne("cancel",t),Ne("close",t),s=r;break;case"iframe":case"object":case"embed":Ne("load",t),s=r;break;case"video":case"audio":for(s=0;s<yo.length;s++)Ne(yo[s],t);s=r;break;case"source":Ne("error",t),s=r;break;case"img":case"image":case"link":Ne("error",t),Ne("load",t),s=r;break;case"details":Ne("toggle",t),s=r;break;case"input":Rm(t,r),s=Ed(t,r),Ne("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Me({},r,{value:void 0}),Ne("invalid",t);break;case"textarea":Dm(t,r),s=bd(t,r),Ne("invalid",t);break;default:s=r}Sd(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?jv(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Av(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Uo(t,c):typeof c=="number"&&Uo(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Vo.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Ne("scroll",t):c!=null&&zh(t,i,c,o))}switch(n){case"input":Xa(t),jm(t,r,!1);break;case"textarea":Xa(t),Mm(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Gr(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?ui(t,!!r.multiple,i,!1):r.defaultValue!=null&&ui(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=ql)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return xt(e),null;case 6:if(t&&e.stateNode!=null)n_(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(q(166));if(n=ms(Yo.current),ms(Ln.current),ol(e)){if(r=e.stateNode,n=e.memoizedProps,r[jn]=e,(i=r.nodeValue!==n)&&(t=Qt,t!==null))switch(t.tag){case 3:il(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&il(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[jn]=e,e.stateNode=r}return xt(e),null;case 13:if(Ae(je),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Re&&Gt!==null&&e.mode&1&&!(e.flags&128))w0(),xi(),e.flags|=98560,i=!1;else if(i=ol(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(q(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(q(317));i[jn]=e}else xi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;xt(e),i=!1}else vn!==null&&(ah(vn),vn=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||je.current&1?Je===0&&(Je=3):Sf())),e.updateQueue!==null&&(e.flags|=4),xt(e),null);case 4:return bi(),Zd(t,e),t===null&&qo(e.stateNode.containerInfo),xt(e),null;case 10:return cf(e.type._context),xt(e),null;case 17:return Bt(e.type)&&Gl(),xt(e),null;case 19:if(Ae(je),i=e.memoizedState,i===null)return xt(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)uo(i,!1);else{if(Je!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=ec(t),o!==null){for(e.flags|=128,uo(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ce(je,je.current&1|2),e.child}t=t.sibling}i.tail!==null&&ze()>Si&&(e.flags|=128,r=!0,uo(i,!1),e.lanes=4194304)}else{if(!r)if(t=ec(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),uo(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Re)return xt(e),null}else 2*ze()-i.renderingStartTime>Si&&n!==1073741824&&(e.flags|=128,r=!0,uo(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=ze(),e.sibling=null,n=je.current,Ce(je,r?n&1|2:n&1),e):(xt(e),null);case 22:case 23:return If(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?qt&1073741824&&(xt(e),e.subtreeFlags&6&&(e.flags|=8192)):xt(e),null;case 24:return null;case 25:return null}throw Error(q(156,e.tag))}function Pb(t,e){switch(sf(e),e.tag){case 1:return Bt(e.type)&&Gl(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return bi(),Ae($t),Ae(Pt),pf(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return ff(e),null;case 13:if(Ae(je),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(q(340));xi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ae(je),null;case 4:return bi(),null;case 10:return cf(e.type._context),null;case 22:case 23:return If(),null;case 24:return null;default:return null}}var cl=!1,It=!1,Nb=typeof WeakSet=="function"?WeakSet:Set,X=null;function ai(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Fe(t,e,r)}else n.current=null}function eh(t,e,n){try{n()}catch(r){Fe(t,e,r)}}var bg=!1;function kb(t,e){if(Ld=zl,t=a0(),nf(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,f=0,m=t,y=null;t:for(;;){for(var I;m!==n||s!==0&&m.nodeType!==3||(l=o+s),m!==i||r!==0&&m.nodeType!==3||(c=o+r),m.nodeType===3&&(o+=m.nodeValue.length),(I=m.firstChild)!==null;)y=m,m=I;for(;;){if(m===t)break t;if(y===n&&++d===s&&(l=o),y===i&&++f===r&&(c=o),(I=m.nextSibling)!==null)break;m=y,y=m.parentNode}m=I}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Vd={focusedElem:t,selectionRange:n},zl=!1,X=e;X!==null;)if(e=X,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,X=t;else for(;X!==null;){e=X;try{var N=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(N!==null){var j=N.memoizedProps,A=N.memoizedState,T=e.stateNode,w=T.getSnapshotBeforeUpdate(e.elementType===e.type?j:mn(e.type,j),A);T.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(q(163))}}catch(O){Fe(e,e.return,O)}if(t=e.sibling,t!==null){t.return=e.return,X=t;break}X=e.return}return N=bg,bg=!1,N}function ko(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&eh(e,n,i)}s=s.next}while(s!==r)}}function Oc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function th(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function r_(t){var e=t.alternate;e!==null&&(t.alternate=null,r_(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[jn],delete e[Ko],delete e[$d],delete e[hb],delete e[fb])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function s_(t){return t.tag===5||t.tag===3||t.tag===4}function Ig(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||s_(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function nh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ql));else if(r!==4&&(t=t.child,t!==null))for(nh(t,e,n),t=t.sibling;t!==null;)nh(t,e,n),t=t.sibling}function rh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(rh(t,e,n),t=t.sibling;t!==null;)rh(t,e,n),t=t.sibling}var lt=null,gn=!1;function wr(t,e,n){for(n=n.child;n!==null;)i_(t,e,n),n=n.sibling}function i_(t,e,n){if(On&&typeof On.onCommitFiberUnmount=="function")try{On.onCommitFiberUnmount(Pc,n)}catch{}switch(n.tag){case 5:It||ai(n,e);case 6:var r=lt,s=gn;lt=null,wr(t,e,n),lt=r,gn=s,lt!==null&&(gn?(t=lt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):lt.removeChild(n.stateNode));break;case 18:lt!==null&&(gn?(t=lt,n=n.stateNode,t.nodeType===8?Wu(t.parentNode,n):t.nodeType===1&&Wu(t,n),zo(t)):Wu(lt,n.stateNode));break;case 4:r=lt,s=gn,lt=n.stateNode.containerInfo,gn=!0,wr(t,e,n),lt=r,gn=s;break;case 0:case 11:case 14:case 15:if(!It&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&eh(n,e,o),s=s.next}while(s!==r)}wr(t,e,n);break;case 1:if(!It&&(ai(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){Fe(n,e,l)}wr(t,e,n);break;case 21:wr(t,e,n);break;case 22:n.mode&1?(It=(r=It)||n.memoizedState!==null,wr(t,e,n),It=r):wr(t,e,n);break;default:wr(t,e,n)}}function Sg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Nb),e.forEach(function(r){var s=Ub.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function pn(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:lt=l.stateNode,gn=!1;break e;case 3:lt=l.stateNode.containerInfo,gn=!0;break e;case 4:lt=l.stateNode.containerInfo,gn=!0;break e}l=l.return}if(lt===null)throw Error(q(160));i_(i,o,s),lt=null,gn=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){Fe(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)o_(e,t),e=e.sibling}function o_(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(pn(e,t),Nn(t),r&4){try{ko(3,t,t.return),Oc(3,t)}catch(j){Fe(t,t.return,j)}try{ko(5,t,t.return)}catch(j){Fe(t,t.return,j)}}break;case 1:pn(e,t),Nn(t),r&512&&n!==null&&ai(n,n.return);break;case 5:if(pn(e,t),Nn(t),r&512&&n!==null&&ai(n,n.return),t.flags&32){var s=t.stateNode;try{Uo(s,"")}catch(j){Fe(t,t.return,j)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Pv(s,i),Cd(l,o);var d=Cd(l,i);for(o=0;o<c.length;o+=2){var f=c[o],m=c[o+1];f==="style"?jv(s,m):f==="dangerouslySetInnerHTML"?Av(s,m):f==="children"?Uo(s,m):zh(s,f,m,d)}switch(l){case"input":xd(s,i);break;case"textarea":Nv(s,i);break;case"select":var y=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var I=i.value;I!=null?ui(s,!!i.multiple,I,!1):y!==!!i.multiple&&(i.defaultValue!=null?ui(s,!!i.multiple,i.defaultValue,!0):ui(s,!!i.multiple,i.multiple?[]:"",!1))}s[Ko]=i}catch(j){Fe(t,t.return,j)}}break;case 6:if(pn(e,t),Nn(t),r&4){if(t.stateNode===null)throw Error(q(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(j){Fe(t,t.return,j)}}break;case 3:if(pn(e,t),Nn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{zo(e.containerInfo)}catch(j){Fe(t,t.return,j)}break;case 4:pn(e,t),Nn(t);break;case 13:pn(e,t),Nn(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Tf=ze())),r&4&&Sg(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(It=(d=It)||f,pn(e,t),It=d):pn(e,t),Nn(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!f&&t.mode&1)for(X=t,f=t.child;f!==null;){for(m=X=f;X!==null;){switch(y=X,I=y.child,y.tag){case 0:case 11:case 14:case 15:ko(4,y,y.return);break;case 1:ai(y,y.return);var N=y.stateNode;if(typeof N.componentWillUnmount=="function"){r=y,n=y.return;try{e=r,N.props=e.memoizedProps,N.state=e.memoizedState,N.componentWillUnmount()}catch(j){Fe(r,n,j)}}break;case 5:ai(y,y.return);break;case 22:if(y.memoizedState!==null){Pg(m);continue}}I!==null?(I.return=y,X=I):Pg(m)}f=f.sibling}e:for(f=null,m=t;;){if(m.tag===5){if(f===null){f=m;try{s=m.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=m.stateNode,c=m.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=Rv("display",o))}catch(j){Fe(t,t.return,j)}}}else if(m.tag===6){if(f===null)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(j){Fe(t,t.return,j)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;f===m&&(f=null),m=m.return}f===m&&(f=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:pn(e,t),Nn(t),r&4&&Sg(t);break;case 21:break;default:pn(e,t),Nn(t)}}function Nn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(s_(n)){var r=n;break e}n=n.return}throw Error(q(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Uo(s,""),r.flags&=-33);var i=Ig(t);rh(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Ig(t);nh(t,l,o);break;default:throw Error(q(161))}}catch(c){Fe(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Ab(t,e,n){X=t,a_(t)}function a_(t,e,n){for(var r=(t.mode&1)!==0;X!==null;){var s=X,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||cl;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||It;l=cl;var d=It;if(cl=o,(It=c)&&!d)for(X=s;X!==null;)o=X,c=o.child,o.tag===22&&o.memoizedState!==null?Ng(s):c!==null?(c.return=o,X=c):Ng(s);for(;i!==null;)X=i,a_(i),i=i.sibling;X=s,cl=l,It=d}Cg(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,X=i):Cg(t)}}function Cg(t){for(;X!==null;){var e=X;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:It||Oc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!It)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:mn(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&dg(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}dg(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var f=d.memoizedState;if(f!==null){var m=f.dehydrated;m!==null&&zo(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(q(163))}It||e.flags&512&&th(e)}catch(y){Fe(e,e.return,y)}}if(e===t){X=null;break}if(n=e.sibling,n!==null){n.return=e.return,X=n;break}X=e.return}}function Pg(t){for(;X!==null;){var e=X;if(e===t){X=null;break}var n=e.sibling;if(n!==null){n.return=e.return,X=n;break}X=e.return}}function Ng(t){for(;X!==null;){var e=X;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Oc(4,e)}catch(c){Fe(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Fe(e,s,c)}}var i=e.return;try{th(e)}catch(c){Fe(e,i,c)}break;case 5:var o=e.return;try{th(e)}catch(c){Fe(e,o,c)}}}catch(c){Fe(e,e.return,c)}if(e===t){X=null;break}var l=e.sibling;if(l!==null){l.return=e.return,X=l;break}X=e.return}}var Rb=Math.ceil,rc=dr.ReactCurrentDispatcher,Ef=dr.ReactCurrentOwner,rn=dr.ReactCurrentBatchConfig,ve=0,st=null,He=null,dt=0,qt=0,li=es(0),Je=0,ea=null,bs=0,Lc=0,xf=0,Ao=null,Vt=null,Tf=0,Si=1/0,qn=null,sc=!1,sh=null,Ur=null,ul=!1,Ar=null,ic=0,Ro=0,ih=null,Sl=-1,Cl=0;function Dt(){return ve&6?ze():Sl!==-1?Sl:Sl=ze()}function Fr(t){return t.mode&1?ve&2&&dt!==0?dt&-dt:mb.transition!==null?(Cl===0&&(Cl=Hv()),Cl):(t=be,t!==0||(t=window.event,t=t===void 0?16:Jv(t.type)),t):1}function wn(t,e,n,r){if(50<Ro)throw Ro=0,ih=null,Error(q(185));pa(t,n,r),(!(ve&2)||t!==st)&&(t===st&&(!(ve&2)&&(Lc|=n),Je===4&&Ir(t,dt)),zt(t,r),n===1&&ve===0&&!(e.mode&1)&&(Si=ze()+500,jc&&ts()))}function zt(t,e){var n=t.callbackNode;mT(t,e);var r=Bl(t,t===st?dt:0);if(r===0)n!==null&&Vm(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Vm(n),e===1)t.tag===0?pb(kg.bind(null,t)):y0(kg.bind(null,t)),ub(function(){!(ve&6)&&ts()}),n=null;else{switch(qv(r)){case 1:n=Kh;break;case 4:n=zv;break;case 16:n=$l;break;case 536870912:n=Wv;break;default:n=$l}n=m_(n,l_.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function l_(t,e){if(Sl=-1,Cl=0,ve&6)throw Error(q(327));var n=t.callbackNode;if(mi()&&t.callbackNode!==n)return null;var r=Bl(t,t===st?dt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=oc(t,r);else{e=r;var s=ve;ve|=2;var i=u_();(st!==t||dt!==e)&&(qn=null,Si=ze()+500,vs(t,e));do try{Mb();break}catch(l){c_(t,l)}while(1);lf(),rc.current=i,ve=s,He!==null?e=0:(st=null,dt=0,e=Je)}if(e!==0){if(e===2&&(s=Rd(t),s!==0&&(r=s,e=oh(t,s))),e===1)throw n=ea,vs(t,0),Ir(t,r),zt(t,ze()),n;if(e===6)Ir(t,r);else{if(s=t.current.alternate,!(r&30)&&!jb(s)&&(e=oc(t,r),e===2&&(i=Rd(t),i!==0&&(r=i,e=oh(t,i))),e===1))throw n=ea,vs(t,0),Ir(t,r),zt(t,ze()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(q(345));case 2:ds(t,Vt,qn);break;case 3:if(Ir(t,r),(r&130023424)===r&&(e=Tf+500-ze(),10<e)){if(Bl(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Dt(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Fd(ds.bind(null,t,Vt,qn),e);break}ds(t,Vt,qn);break;case 4:if(Ir(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-_n(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=ze()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Rb(r/1960))-r,10<r){t.timeoutHandle=Fd(ds.bind(null,t,Vt,qn),r);break}ds(t,Vt,qn);break;case 5:ds(t,Vt,qn);break;default:throw Error(q(329))}}}return zt(t,ze()),t.callbackNode===n?l_.bind(null,t):null}function oh(t,e){var n=Ao;return t.current.memoizedState.isDehydrated&&(vs(t,e).flags|=256),t=oc(t,e),t!==2&&(e=Vt,Vt=n,e!==null&&ah(e)),t}function ah(t){Vt===null?Vt=t:Vt.push.apply(Vt,t)}function jb(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!xn(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ir(t,e){for(e&=~xf,e&=~Lc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-_n(e),r=1<<n;t[n]=-1,e&=~r}}function kg(t){if(ve&6)throw Error(q(327));mi();var e=Bl(t,0);if(!(e&1))return zt(t,ze()),null;var n=oc(t,e);if(t.tag!==0&&n===2){var r=Rd(t);r!==0&&(e=r,n=oh(t,r))}if(n===1)throw n=ea,vs(t,0),Ir(t,e),zt(t,ze()),n;if(n===6)throw Error(q(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ds(t,Vt,qn),zt(t,ze()),null}function bf(t,e){var n=ve;ve|=1;try{return t(e)}finally{ve=n,ve===0&&(Si=ze()+500,jc&&ts())}}function Is(t){Ar!==null&&Ar.tag===0&&!(ve&6)&&mi();var e=ve;ve|=1;var n=rn.transition,r=be;try{if(rn.transition=null,be=1,t)return t()}finally{be=r,rn.transition=n,ve=e,!(ve&6)&&ts()}}function If(){qt=li.current,Ae(li)}function vs(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,cb(n)),He!==null)for(n=He.return;n!==null;){var r=n;switch(sf(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Gl();break;case 3:bi(),Ae($t),Ae(Pt),pf();break;case 5:ff(r);break;case 4:bi();break;case 13:Ae(je);break;case 19:Ae(je);break;case 10:cf(r.type._context);break;case 22:case 23:If()}n=n.return}if(st=t,He=t=$r(t.current,null),dt=qt=e,Je=0,ea=null,xf=Lc=bs=0,Vt=Ao=null,ps!==null){for(e=0;e<ps.length;e++)if(n=ps[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}ps=null}return t}function c_(t,e){do{var n=He;try{if(lf(),Tl.current=nc,tc){for(var r=De.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}tc=!1}if(Ts=0,rt=Xe=De=null,No=!1,Xo=0,Ef.current=null,n===null||n.return===null){Je=1,ea=e,He=null;break}e:{var i=t,o=n.return,l=n,c=e;if(e=dt,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,f=l,m=f.tag;if(!(f.mode&1)&&(m===0||m===11||m===15)){var y=f.alternate;y?(f.updateQueue=y.updateQueue,f.memoizedState=y.memoizedState,f.lanes=y.lanes):(f.updateQueue=null,f.memoizedState=null)}var I=yg(o);if(I!==null){I.flags&=-257,vg(I,o,l,i,e),I.mode&1&&gg(i,d,e),e=I,c=d;var N=e.updateQueue;if(N===null){var j=new Set;j.add(c),e.updateQueue=j}else N.add(c);break e}else{if(!(e&1)){gg(i,d,e),Sf();break e}c=Error(q(426))}}else if(Re&&l.mode&1){var A=yg(o);if(A!==null){!(A.flags&65536)&&(A.flags|=256),vg(A,o,l,i,e),of(Ii(c,l));break e}}i=c=Ii(c,l),Je!==4&&(Je=2),Ao===null?Ao=[i]:Ao.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var T=q0(i,c,e);ug(i,T);break e;case 1:l=c;var w=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof w.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Ur===null||!Ur.has(S)))){i.flags|=65536,e&=-e,i.lanes|=e;var O=G0(i,l,e);ug(i,O);break e}}i=i.return}while(i!==null)}h_(n)}catch(R){e=R,He===n&&n!==null&&(He=n=n.return);continue}break}while(1)}function u_(){var t=rc.current;return rc.current=nc,t===null?nc:t}function Sf(){(Je===0||Je===3||Je===2)&&(Je=4),st===null||!(bs&268435455)&&!(Lc&268435455)||Ir(st,dt)}function oc(t,e){var n=ve;ve|=2;var r=u_();(st!==t||dt!==e)&&(qn=null,vs(t,e));do try{Db();break}catch(s){c_(t,s)}while(1);if(lf(),ve=n,rc.current=r,He!==null)throw Error(q(261));return st=null,dt=0,Je}function Db(){for(;He!==null;)d_(He)}function Mb(){for(;He!==null&&!oT();)d_(He)}function d_(t){var e=p_(t.alternate,t,qt);t.memoizedProps=t.pendingProps,e===null?h_(t):He=e,Ef.current=null}function h_(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Pb(n,e),n!==null){n.flags&=32767,He=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Je=6,He=null;return}}else if(n=Cb(n,e,qt),n!==null){He=n;return}if(e=e.sibling,e!==null){He=e;return}He=e=t}while(e!==null);Je===0&&(Je=5)}function ds(t,e,n){var r=be,s=rn.transition;try{rn.transition=null,be=1,Ob(t,e,n,r)}finally{rn.transition=s,be=r}return null}function Ob(t,e,n,r){do mi();while(Ar!==null);if(ve&6)throw Error(q(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(q(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(gT(t,i),t===st&&(He=st=null,dt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ul||(ul=!0,m_($l,function(){return mi(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=rn.transition,rn.transition=null;var o=be;be=1;var l=ve;ve|=4,Ef.current=null,kb(t,n),o_(n,t),nb(Vd),zl=!!Ld,Vd=Ld=null,t.current=n,Ab(n),aT(),ve=l,be=o,rn.transition=i}else t.current=n;if(ul&&(ul=!1,Ar=t,ic=s),i=t.pendingLanes,i===0&&(Ur=null),uT(n.stateNode),zt(t,ze()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(sc)throw sc=!1,t=sh,sh=null,t;return ic&1&&t.tag!==0&&mi(),i=t.pendingLanes,i&1?t===ih?Ro++:(Ro=0,ih=t):Ro=0,ts(),null}function mi(){if(Ar!==null){var t=qv(ic),e=rn.transition,n=be;try{if(rn.transition=null,be=16>t?16:t,Ar===null)var r=!1;else{if(t=Ar,Ar=null,ic=0,ve&6)throw Error(q(331));var s=ve;for(ve|=4,X=t.current;X!==null;){var i=X,o=i.child;if(X.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(X=d;X!==null;){var f=X;switch(f.tag){case 0:case 11:case 15:ko(8,f,i)}var m=f.child;if(m!==null)m.return=f,X=m;else for(;X!==null;){f=X;var y=f.sibling,I=f.return;if(r_(f),f===d){X=null;break}if(y!==null){y.return=I,X=y;break}X=I}}}var N=i.alternate;if(N!==null){var j=N.child;if(j!==null){N.child=null;do{var A=j.sibling;j.sibling=null,j=A}while(j!==null)}}X=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,X=o;else e:for(;X!==null;){if(i=X,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ko(9,i,i.return)}var T=i.sibling;if(T!==null){T.return=i.return,X=T;break e}X=i.return}}var w=t.current;for(X=w;X!==null;){o=X;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,X=S;else e:for(o=w;X!==null;){if(l=X,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Oc(9,l)}}catch(R){Fe(l,l.return,R)}if(l===o){X=null;break e}var O=l.sibling;if(O!==null){O.return=l.return,X=O;break e}X=l.return}}if(ve=s,ts(),On&&typeof On.onPostCommitFiberRoot=="function")try{On.onPostCommitFiberRoot(Pc,t)}catch{}r=!0}return r}finally{be=n,rn.transition=e}}return!1}function Ag(t,e,n){e=Ii(n,e),e=q0(t,e,1),t=Vr(t,e,1),e=Dt(),t!==null&&(pa(t,1,e),zt(t,e))}function Fe(t,e,n){if(t.tag===3)Ag(t,t,n);else for(;e!==null;){if(e.tag===3){Ag(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ur===null||!Ur.has(r))){t=Ii(n,t),t=G0(e,t,1),e=Vr(e,t,1),t=Dt(),e!==null&&(pa(e,1,t),zt(e,t));break}}e=e.return}}function Lb(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Dt(),t.pingedLanes|=t.suspendedLanes&n,st===t&&(dt&n)===n&&(Je===4||Je===3&&(dt&130023424)===dt&&500>ze()-Tf?vs(t,0):xf|=n),zt(t,e)}function f_(t,e){e===0&&(t.mode&1?(e=el,el<<=1,!(el&130023424)&&(el=4194304)):e=1);var n=Dt();t=ir(t,e),t!==null&&(pa(t,e,n),zt(t,n))}function Vb(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),f_(t,n)}function Ub(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(q(314))}r!==null&&r.delete(e),f_(t,n)}var p_;p_=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||$t.current)Ft=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ft=!1,Sb(t,e,n);Ft=!!(t.flags&131072)}else Ft=!1,Re&&e.flags&1048576&&v0(e,Yl,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Il(t,e),t=e.pendingProps;var s=Ei(e,Pt.current);pi(e,n),s=gf(null,e,r,t,s,n);var i=yf();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Bt(r)?(i=!0,Kl(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,df(e),s.updater=Mc,e.stateNode=s,s._reactInternals=e,Gd(e,r,t,n),e=Yd(null,e,r,!0,i,n)):(e.tag=0,Re&&i&&rf(e),jt(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Il(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=$b(r),t=mn(r,t),s){case 0:e=Qd(null,e,r,t,n);break e;case 1:e=Eg(null,e,r,t,n);break e;case 11:e=_g(null,e,r,t,n);break e;case 14:e=wg(null,e,r,mn(r.type,t),n);break e}throw Error(q(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:mn(r,s),Qd(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:mn(r,s),Eg(t,e,r,s,n);case 3:e:{if(X0(e),t===null)throw Error(q(387));r=e.pendingProps,i=e.memoizedState,s=i.element,b0(t,e),Zl(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Ii(Error(q(423)),e),e=xg(t,e,r,n,s);break e}else if(r!==s){s=Ii(Error(q(424)),e),e=xg(t,e,r,n,s);break e}else for(Gt=Lr(e.stateNode.containerInfo.firstChild),Qt=e,Re=!0,vn=null,n=x0(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(xi(),r===s){e=or(t,e,n);break e}jt(t,e,r,n)}e=e.child}return e;case 5:return I0(e),t===null&&Wd(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,Ud(r,s)?o=null:i!==null&&Ud(r,i)&&(e.flags|=32),Y0(t,e),jt(t,e,o,n),e.child;case 6:return t===null&&Wd(e),null;case 13:return J0(t,e,n);case 4:return hf(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Ti(e,null,r,n):jt(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:mn(r,s),_g(t,e,r,s,n);case 7:return jt(t,e,e.pendingProps,n),e.child;case 8:return jt(t,e,e.pendingProps.children,n),e.child;case 12:return jt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Ce(Xl,r._currentValue),r._currentValue=o,i!==null)if(xn(i.value,o)){if(i.children===s.children&&!$t.current){e=or(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=er(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var f=d.pending;f===null?c.next=c:(c.next=f.next,f.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Hd(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(q(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Hd(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}jt(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,pi(e,n),s=on(s),r=r(s),e.flags|=1,jt(t,e,r,n),e.child;case 14:return r=e.type,s=mn(r,e.pendingProps),s=mn(r.type,s),wg(t,e,r,s,n);case 15:return K0(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:mn(r,s),Il(t,e),e.tag=1,Bt(r)?(t=!0,Kl(e)):t=!1,pi(e,n),H0(e,r,s),Gd(e,r,s,n),Yd(null,e,r,!0,t,n);case 19:return Z0(t,e,n);case 22:return Q0(t,e,n)}throw Error(q(156,e.tag))};function m_(t,e){return Bv(t,e)}function Fb(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nn(t,e,n,r){return new Fb(t,e,n,r)}function Cf(t){return t=t.prototype,!(!t||!t.isReactComponent)}function $b(t){if(typeof t=="function")return Cf(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Hh)return 11;if(t===qh)return 14}return 2}function $r(t,e){var n=t.alternate;return n===null?(n=nn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Pl(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")Cf(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Js:return _s(n.children,s,i,e);case Wh:o=8,s|=8;break;case yd:return t=nn(12,n,e,s|2),t.elementType=yd,t.lanes=i,t;case vd:return t=nn(13,n,e,s),t.elementType=vd,t.lanes=i,t;case _d:return t=nn(19,n,e,s),t.elementType=_d,t.lanes=i,t;case Iv:return Vc(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Tv:o=10;break e;case bv:o=9;break e;case Hh:o=11;break e;case qh:o=14;break e;case xr:o=16,r=null;break e}throw Error(q(130,t==null?t:typeof t,""))}return e=nn(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function _s(t,e,n,r){return t=nn(7,t,r,e),t.lanes=n,t}function Vc(t,e,n,r){return t=nn(22,t,r,e),t.elementType=Iv,t.lanes=n,t.stateNode={isHidden:!1},t}function Ju(t,e,n){return t=nn(6,t,null,e),t.lanes=n,t}function Zu(t,e,n){return e=nn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Bb(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ju(0),this.expirationTimes=ju(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ju(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Pf(t,e,n,r,s,i,o,l,c){return t=new Bb(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=nn(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},df(i),t}function zb(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Xs,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function g_(t){if(!t)return Kr;t=t._reactInternals;e:{if(Ds(t)!==t||t.tag!==1)throw Error(q(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Bt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(q(171))}if(t.tag===1){var n=t.type;if(Bt(n))return g0(t,n,e)}return e}function y_(t,e,n,r,s,i,o,l,c){return t=Pf(n,r,!0,t,s,i,o,l,c),t.context=g_(null),n=t.current,r=Dt(),s=Fr(n),i=er(r,s),i.callback=e??null,Vr(n,i,s),t.current.lanes=s,pa(t,s,r),zt(t,r),t}function Uc(t,e,n,r){var s=e.current,i=Dt(),o=Fr(s);return n=g_(n),e.context===null?e.context=n:e.pendingContext=n,e=er(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Vr(s,e,o),t!==null&&(wn(t,s,o,i),xl(t,s,o)),o}function ac(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Rg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Nf(t,e){Rg(t,e),(t=t.alternate)&&Rg(t,e)}function Wb(){return null}var v_=typeof reportError=="function"?reportError:function(t){console.error(t)};function kf(t){this._internalRoot=t}Fc.prototype.render=kf.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(q(409));Uc(t,e,null,null)};Fc.prototype.unmount=kf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Is(function(){Uc(null,t,null,null)}),e[sr]=null}};function Fc(t){this._internalRoot=t}Fc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Qv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<br.length&&e!==0&&e<br[n].priority;n++);br.splice(n,0,t),n===0&&Xv(t)}};function Af(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function $c(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function jg(){}function Hb(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=ac(o);i.call(d)}}var o=y_(e,r,t,0,null,!1,!1,"",jg);return t._reactRootContainer=o,t[sr]=o.current,qo(t.nodeType===8?t.parentNode:t),Is(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=ac(c);l.call(d)}}var c=Pf(t,0,!1,null,null,!1,!1,"",jg);return t._reactRootContainer=c,t[sr]=c.current,qo(t.nodeType===8?t.parentNode:t),Is(function(){Uc(e,c,n,r)}),c}function Bc(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var c=ac(o);l.call(c)}}Uc(e,o,t,s)}else o=Hb(n,e,t,s,r);return ac(o)}Gv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=go(e.pendingLanes);n!==0&&(Qh(e,n|1),zt(e,ze()),!(ve&6)&&(Si=ze()+500,ts()))}break;case 13:Is(function(){var r=ir(t,1);if(r!==null){var s=Dt();wn(r,t,1,s)}}),Nf(t,1)}};Yh=function(t){if(t.tag===13){var e=ir(t,134217728);if(e!==null){var n=Dt();wn(e,t,134217728,n)}Nf(t,134217728)}};Kv=function(t){if(t.tag===13){var e=Fr(t),n=ir(t,e);if(n!==null){var r=Dt();wn(n,t,e,r)}Nf(t,e)}};Qv=function(){return be};Yv=function(t,e){var n=be;try{return be=t,e()}finally{be=n}};Nd=function(t,e,n){switch(e){case"input":if(xd(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Rc(r);if(!s)throw Error(q(90));Cv(r),xd(r,s)}}}break;case"textarea":Nv(t,n);break;case"select":e=n.value,e!=null&&ui(t,!!n.multiple,e,!1)}};Ov=bf;Lv=Is;var qb={usingClientEntryPoint:!1,Events:[ga,ni,Rc,Dv,Mv,bf]},ho={findFiberByHostInstance:fs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Gb={bundleType:ho.bundleType,version:ho.version,rendererPackageName:ho.rendererPackageName,rendererConfig:ho.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:dr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Fv(t),t===null?null:t.stateNode},findFiberByHostInstance:ho.findFiberByHostInstance||Wb,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dl.isDisabled&&dl.supportsFiber)try{Pc=dl.inject(Gb),On=dl}catch{}}Jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qb;Jt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Af(e))throw Error(q(200));return zb(t,e,null,n)};Jt.createRoot=function(t,e){if(!Af(t))throw Error(q(299));var n=!1,r="",s=v_;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Pf(t,1,!1,null,null,n,!1,r,s),t[sr]=e.current,qo(t.nodeType===8?t.parentNode:t),new kf(e)};Jt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(q(188)):(t=Object.keys(t).join(","),Error(q(268,t)));return t=Fv(e),t=t===null?null:t.stateNode,t};Jt.flushSync=function(t){return Is(t)};Jt.hydrate=function(t,e,n){if(!$c(e))throw Error(q(200));return Bc(null,t,e,!0,n)};Jt.hydrateRoot=function(t,e,n){if(!Af(t))throw Error(q(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=v_;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=y_(e,null,t,1,n??null,s,!1,i,o),t[sr]=e.current,qo(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Fc(e)};Jt.render=function(t,e,n){if(!$c(e))throw Error(q(200));return Bc(null,t,e,!1,n)};Jt.unmountComponentAtNode=function(t){if(!$c(t))throw Error(q(40));return t._reactRootContainer?(Is(function(){Bc(null,null,t,!1,function(){t._reactRootContainer=null,t[sr]=null})}),!0):!1};Jt.unstable_batchedUpdates=bf;Jt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!$c(n))throw Error(q(200));if(t==null||t._reactInternals===void 0)throw Error(q(38));return Bc(t,e,n,!1,r)};Jt.version="18.3.1-next-f1338f8080-20240426";function __(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(__)}catch(t){console.error(t)}}__(),_v.exports=Jt;var Kb=_v.exports,Dg=Kb;md.createRoot=Dg.createRoot,md.hydrateRoot=Dg.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ta(){return ta=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ta.apply(this,arguments)}var Rr;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Rr||(Rr={}));const Mg="popstate";function Qb(t){t===void 0&&(t={});function e(r,s){let{pathname:i,search:o,hash:l}=r.location;return lh("",{pathname:i,search:o,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:lc(s)}return Xb(e,n,null,t)}function Ge(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function w_(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Yb(){return Math.random().toString(36).substr(2,8)}function Og(t,e){return{usr:t.state,key:t.key,idx:e}}function lh(t,e,n,r){return n===void 0&&(n=null),ta({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Vi(e):e,{state:n,key:e&&e.key||r||Yb()})}function lc(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Vi(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function Xb(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,l=Rr.Pop,c=null,d=f();d==null&&(d=0,o.replaceState(ta({},o.state,{idx:d}),""));function f(){return(o.state||{idx:null}).idx}function m(){l=Rr.Pop;let A=f(),T=A==null?null:A-d;d=A,c&&c({action:l,location:j.location,delta:T})}function y(A,T){l=Rr.Push;let w=lh(j.location,A,T);n&&n(w,A),d=f()+1;let S=Og(w,d),O=j.createHref(w);try{o.pushState(S,"",O)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;s.location.assign(O)}i&&c&&c({action:l,location:j.location,delta:1})}function I(A,T){l=Rr.Replace;let w=lh(j.location,A,T);n&&n(w,A),d=f();let S=Og(w,d),O=j.createHref(w);o.replaceState(S,"",O),i&&c&&c({action:l,location:j.location,delta:0})}function N(A){let T=s.location.origin!=="null"?s.location.origin:s.location.href,w=typeof A=="string"?A:lc(A);return w=w.replace(/ $/,"%20"),Ge(T,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,T)}let j={get action(){return l},get location(){return t(s,o)},listen(A){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(Mg,m),c=A,()=>{s.removeEventListener(Mg,m),c=null}},createHref(A){return e(s,A)},createURL:N,encodeLocation(A){let T=N(A);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:y,replace:I,go(A){return o.go(A)}};return j}var Lg;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Lg||(Lg={}));function Jb(t,e,n){return n===void 0&&(n="/"),Zb(t,e,n,!1)}function Zb(t,e,n,r){let s=typeof e=="string"?Vi(e):e,i=Rf(s.pathname||"/",n);if(i==null)return null;let o=E_(t);eI(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let d=dI(i);l=cI(o[c],d,r)}return l}function E_(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(i,o,l)=>{let c={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};c.relativePath.startsWith("/")&&(Ge(c.relativePath.startsWith(r),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(r.length));let d=Br([r,c.relativePath]),f=n.concat(c);i.children&&i.children.length>0&&(Ge(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),E_(i.children,e,f,d)),!(i.path==null&&!i.index)&&e.push({path:d,score:aI(d,i.index),routesMeta:f})};return t.forEach((i,o)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))s(i,o);else for(let c of x_(i.path))s(i,o,c)}),e}function x_(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=x_(r.join("/")),l=[];return l.push(...o.map(c=>c===""?i:[i,c].join("/"))),s&&l.push(...o),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function eI(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:lI(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const tI=/^:[\w-]+$/,nI=3,rI=2,sI=1,iI=10,oI=-2,Vg=t=>t==="*";function aI(t,e){let n=t.split("/"),r=n.length;return n.some(Vg)&&(r+=oI),e&&(r+=rI),n.filter(s=>!Vg(s)).reduce((s,i)=>s+(tI.test(i)?nI:i===""?sI:iI),r)}function lI(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function cI(t,e,n){n===void 0&&(n=!1);let{routesMeta:r}=t,s={},i="/",o=[];for(let l=0;l<r.length;++l){let c=r[l],d=l===r.length-1,f=i==="/"?e:e.slice(i.length)||"/",m=Ug({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},f),y=c.route;if(!m&&d&&n&&!r[r.length-1].route.index&&(m=Ug({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},f)),!m)return null;Object.assign(s,m.params),o.push({params:s,pathname:Br([i,m.pathname]),pathnameBase:mI(Br([i,m.pathnameBase])),route:y}),m.pathnameBase!=="/"&&(i=Br([i,m.pathnameBase]))}return o}function Ug(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=uI(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,f,m)=>{let{paramName:y,isOptional:I}=f;if(y==="*"){let j=l[m]||"";o=i.slice(0,i.length-j.length).replace(/(.)\/+$/,"$1")}const N=l[m];return I&&!N?d[y]=void 0:d[y]=(N||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:o,pattern:t}}function uI(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),w_(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function dI(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return w_(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Rf(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function hI(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Vi(t):t;return{pathname:n?n.startsWith("/")?n:fI(n,e):e,search:gI(r),hash:yI(s)}}function fI(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function ed(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function pI(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function T_(t,e){let n=pI(t);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function b_(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=Vi(t):(s=ta({},t),Ge(!s.pathname||!s.pathname.includes("?"),ed("?","pathname","search",s)),Ge(!s.pathname||!s.pathname.includes("#"),ed("#","pathname","hash",s)),Ge(!s.search||!s.search.includes("#"),ed("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,l;if(o==null)l=n;else{let m=e.length-1;if(!r&&o.startsWith("..")){let y=o.split("/");for(;y[0]==="..";)y.shift(),m-=1;s.pathname=y.join("/")}l=m>=0?e[m]:"/"}let c=hI(s,l),d=o&&o!=="/"&&o.endsWith("/"),f=(i||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||f)&&(c.pathname+="/"),c}const Br=t=>t.join("/").replace(/\/\/+/g,"/"),mI=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),gI=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,yI=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function vI(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const I_=["post","put","patch","delete"];new Set(I_);const _I=["get",...I_];new Set(_I);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function na(){return na=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},na.apply(this,arguments)}const jf=D.createContext(null),wI=D.createContext(null),Ms=D.createContext(null),zc=D.createContext(null),ns=D.createContext({outlet:null,matches:[],isDataRoute:!1}),S_=D.createContext(null);function EI(t,e){let{relative:n}=e===void 0?{}:e;va()||Ge(!1);let{basename:r,navigator:s}=D.useContext(Ms),{hash:i,pathname:o,search:l}=P_(t,{relative:n}),c=o;return r!=="/"&&(c=o==="/"?r:Br([r,o])),s.createHref({pathname:c,search:l,hash:i})}function va(){return D.useContext(zc)!=null}function Ui(){return va()||Ge(!1),D.useContext(zc).location}function C_(t){D.useContext(Ms).static||D.useLayoutEffect(t)}function zn(){let{isDataRoute:t}=D.useContext(ns);return t?DI():xI()}function xI(){va()||Ge(!1);let t=D.useContext(jf),{basename:e,future:n,navigator:r}=D.useContext(Ms),{matches:s}=D.useContext(ns),{pathname:i}=Ui(),o=JSON.stringify(T_(s,n.v7_relativeSplatPath)),l=D.useRef(!1);return C_(()=>{l.current=!0}),D.useCallback(function(d,f){if(f===void 0&&(f={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let m=b_(d,JSON.parse(o),i,f.relative==="path");t==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:Br([e,m.pathname])),(f.replace?r.replace:r.push)(m,f.state,f)},[e,r,o,i,t])}function Wc(){let{matches:t}=D.useContext(ns),e=t[t.length-1];return e?e.params:{}}function P_(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=D.useContext(Ms),{matches:s}=D.useContext(ns),{pathname:i}=Ui(),o=JSON.stringify(T_(s,r.v7_relativeSplatPath));return D.useMemo(()=>b_(t,JSON.parse(o),i,n==="path"),[t,o,i,n])}function TI(t,e){return bI(t,e)}function bI(t,e,n,r){va()||Ge(!1);let{navigator:s}=D.useContext(Ms),{matches:i}=D.useContext(ns),o=i[i.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let d=Ui(),f;if(e){var m;let A=typeof e=="string"?Vi(e):e;c==="/"||(m=A.pathname)!=null&&m.startsWith(c)||Ge(!1),f=A}else f=d;let y=f.pathname||"/",I=y;if(c!=="/"){let A=c.replace(/^\//,"").split("/");I="/"+y.replace(/^\//,"").split("/").slice(A.length).join("/")}let N=Jb(t,{pathname:I}),j=NI(N&&N.map(A=>Object.assign({},A,{params:Object.assign({},l,A.params),pathname:Br([c,s.encodeLocation?s.encodeLocation(A.pathname).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?c:Br([c,s.encodeLocation?s.encodeLocation(A.pathnameBase).pathname:A.pathnameBase])})),i,n,r);return e&&j?D.createElement(zc.Provider,{value:{location:na({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:Rr.Pop}},j):j}function II(){let t=jI(),e=vI(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return D.createElement(D.Fragment,null,D.createElement("h2",null,"Unexpected Application Error!"),D.createElement("h3",{style:{fontStyle:"italic"}},e),n?D.createElement("pre",{style:s},n):null,i)}const SI=D.createElement(II,null);class CI extends D.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?D.createElement(ns.Provider,{value:this.props.routeContext},D.createElement(S_.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function PI(t){let{routeContext:e,match:n,children:r}=t,s=D.useContext(jf);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),D.createElement(ns.Provider,{value:e},r)}function NI(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var i;if(!n)return null;if(n.errors)t=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=(s=n)==null?void 0:s.errors;if(l!=null){let f=o.findIndex(m=>m.route.id&&(l==null?void 0:l[m.route.id])!==void 0);f>=0||Ge(!1),o=o.slice(0,Math.min(o.length,f+1))}let c=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let f=0;f<o.length;f++){let m=o[f];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(d=f),m.route.id){let{loaderData:y,errors:I}=n,N=m.route.loader&&y[m.route.id]===void 0&&(!I||I[m.route.id]===void 0);if(m.route.lazy||N){c=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((f,m,y)=>{let I,N=!1,j=null,A=null;n&&(I=l&&m.route.id?l[m.route.id]:void 0,j=m.route.errorElement||SI,c&&(d<0&&y===0?(MI("route-fallback",!1),N=!0,A=null):d===y&&(N=!0,A=m.route.hydrateFallbackElement||null)));let T=e.concat(o.slice(0,y+1)),w=()=>{let S;return I?S=j:N?S=A:m.route.Component?S=D.createElement(m.route.Component,null):m.route.element?S=m.route.element:S=f,D.createElement(PI,{match:m,routeContext:{outlet:f,matches:T,isDataRoute:n!=null},children:S})};return n&&(m.route.ErrorBoundary||m.route.errorElement||y===0)?D.createElement(CI,{location:n.location,revalidation:n.revalidation,component:j,error:I,children:w(),routeContext:{outlet:null,matches:T,isDataRoute:!0}}):w()},null)}var N_=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(N_||{}),cc=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(cc||{});function kI(t){let e=D.useContext(jf);return e||Ge(!1),e}function AI(t){let e=D.useContext(wI);return e||Ge(!1),e}function RI(t){let e=D.useContext(ns);return e||Ge(!1),e}function k_(t){let e=RI(),n=e.matches[e.matches.length-1];return n.route.id||Ge(!1),n.route.id}function jI(){var t;let e=D.useContext(S_),n=AI(cc.UseRouteError),r=k_(cc.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function DI(){let{router:t}=kI(N_.UseNavigateStable),e=k_(cc.UseNavigateStable),n=D.useRef(!1);return C_(()=>{n.current=!0}),D.useCallback(function(s,i){i===void 0&&(i={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,na({fromRouteId:e},i)))},[t,e])}const Fg={};function MI(t,e,n){!e&&!Fg[t]&&(Fg[t]=!0)}function OI(t,e){t==null||t.v7_startTransition,(t==null?void 0:t.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function kn(t){Ge(!1)}function LI(t){let{basename:e="/",children:n=null,location:r,navigationType:s=Rr.Pop,navigator:i,static:o=!1,future:l}=t;va()&&Ge(!1);let c=e.replace(/^\/*/,"/"),d=D.useMemo(()=>({basename:c,navigator:i,static:o,future:na({v7_relativeSplatPath:!1},l)}),[c,l,i,o]);typeof r=="string"&&(r=Vi(r));let{pathname:f="/",search:m="",hash:y="",state:I=null,key:N="default"}=r,j=D.useMemo(()=>{let A=Rf(f,c);return A==null?null:{location:{pathname:A,search:m,hash:y,state:I,key:N},navigationType:s}},[c,f,m,y,I,N,s]);return j==null?null:D.createElement(Ms.Provider,{value:d},D.createElement(zc.Provider,{children:n,value:j}))}function VI(t){let{children:e,location:n}=t;return TI(ch(e),n)}new Promise(()=>{});function ch(t,e){e===void 0&&(e=[]);let n=[];return D.Children.forEach(t,(r,s)=>{if(!D.isValidElement(r))return;let i=[...e,s];if(r.type===D.Fragment){n.push.apply(n,ch(r.props.children,i));return}r.type!==kn&&Ge(!1),!r.props.index||!r.props.children||Ge(!1);let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=ch(r.props.children,i)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function uh(){return uh=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},uh.apply(this,arguments)}function UI(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function FI(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function $I(t,e){return t.button===0&&(!e||e==="_self")&&!FI(t)}const BI=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],zI="6";try{window.__reactRouterVersion=zI}catch{}const WI="startTransition",$g=Lx[WI];function HI(t){let{basename:e,children:n,future:r,window:s}=t,i=D.useRef();i.current==null&&(i.current=Qb({window:s,v5Compat:!0}));let o=i.current,[l,c]=D.useState({action:o.action,location:o.location}),{v7_startTransition:d}=r||{},f=D.useCallback(m=>{d&&$g?$g(()=>c(m)):c(m)},[c,d]);return D.useLayoutEffect(()=>o.listen(f),[o,f]),D.useEffect(()=>OI(r),[r]),D.createElement(LI,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:o,future:r})}const qI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",GI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,gs=D.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:i,replace:o,state:l,target:c,to:d,preventScrollReset:f,viewTransition:m}=e,y=UI(e,BI),{basename:I}=D.useContext(Ms),N,j=!1;if(typeof d=="string"&&GI.test(d)&&(N=d,qI))try{let S=new URL(window.location.href),O=d.startsWith("//")?new URL(S.protocol+d):new URL(d),R=Rf(O.pathname,I);O.origin===S.origin&&R!=null?d=R+O.search+O.hash:j=!0}catch{}let A=EI(d,{relative:s}),T=KI(d,{replace:o,state:l,target:c,preventScrollReset:f,relative:s,viewTransition:m});function w(S){r&&r(S),S.defaultPrevented||T(S)}return D.createElement("a",uh({},y,{href:N||A,onClick:j||i?r:w,ref:n,target:c}))});var Bg;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Bg||(Bg={}));var zg;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(zg||(zg={}));function KI(t,e){let{target:n,replace:r,state:s,preventScrollReset:i,relative:o,viewTransition:l}=e===void 0?{}:e,c=zn(),d=Ui(),f=P_(t,{relative:o});return D.useCallback(m=>{if($I(m,n)){m.preventDefault();let y=r!==void 0?r:lc(d)===lc(f);c(t,{replace:y,state:s,preventScrollReset:i,relative:o,viewTransition:l})}},[d,c,f,r,s,n,t,i,o,l])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A_=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},QI=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},R_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,l=o?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,f=i>>2,m=(i&3)<<4|l>>4;let y=(l&15)<<2|d>>6,I=d&63;c||(I=64,o||(y=64)),r.push(n[f],n[m],n[y],n[I])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(A_(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):QI(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const m=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||m==null)throw new YI;const y=i<<2|l>>4;if(r.push(y),d!==64){const I=l<<4&240|d>>2;if(r.push(I),m!==64){const N=d<<6&192|m;r.push(N)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class YI extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const XI=function(t){const e=A_(t);return R_.encodeByteArray(e,!0)},uc=function(t){return XI(t).replace(/\./g,"")},j_=function(t){try{return R_.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JI(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZI=()=>JI().__FIREBASE_DEFAULTS__,eS=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},tS=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&j_(t[1]);return e&&JSON.parse(e)},Hc=()=>{try{return ZI()||eS()||tS()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},D_=t=>{var e,n;return(n=(e=Hc())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},nS=t=>{const e=D_(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},M_=()=>{var t;return(t=Hc())===null||t===void 0?void 0:t.config},O_=t=>{var e;return(e=Hc())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rS{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sS(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t),l="";return[uc(JSON.stringify(n)),uc(JSON.stringify(o)),l].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function iS(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Nt())}function oS(){var t;const e=(t=Hc())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function aS(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function lS(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function cS(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function uS(){const t=Nt();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function dS(){return!oS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function hS(){try{return typeof indexedDB=="object"}catch{return!1}}function fS(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pS="FirebaseError";class hr extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=pS,Object.setPrototypeOf(this,hr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_a.prototype.create)}}class _a{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?mS(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new hr(s,l,r)}}function mS(t,e){return t.replace(gS,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const gS=/\{\$([^}]+)}/g;function yS(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function dc(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(Wg(i)&&Wg(o)){if(!dc(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function Wg(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wa(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function vo(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function _o(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function vS(t,e){const n=new _S(t,e);return n.subscribe.bind(n)}class _S{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");wS(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=td),s.error===void 0&&(s.error=td),s.complete===void 0&&(s.complete=td);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function wS(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function td(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ke(t){return t&&t._delegate?t._delegate:t}class Ss{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hs="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ES{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new rS;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(TS(e))try{this.getOrInitializeService({instanceIdentifier:hs})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=hs){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=hs){return this.instances.has(e)}getOptions(e=hs){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,n){var r;const s=this.normalizeInstanceIdentifier(n),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:xS(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=hs){return this.component?this.component.multipleInstances?e:hs:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function xS(t){return t===hs?void 0:t}function TS(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bS{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new ES(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fe;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(fe||(fe={}));const IS={debug:fe.DEBUG,verbose:fe.VERBOSE,info:fe.INFO,warn:fe.WARN,error:fe.ERROR,silent:fe.SILENT},SS=fe.INFO,CS={[fe.DEBUG]:"log",[fe.VERBOSE]:"log",[fe.INFO]:"info",[fe.WARN]:"warn",[fe.ERROR]:"error"},PS=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=CS[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Df{constructor(e){this.name=e,this._logLevel=SS,this._logHandler=PS,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in fe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?IS[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,fe.DEBUG,...e),this._logHandler(this,fe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,fe.VERBOSE,...e),this._logHandler(this,fe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,fe.INFO,...e),this._logHandler(this,fe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,fe.WARN,...e),this._logHandler(this,fe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,fe.ERROR,...e),this._logHandler(this,fe.ERROR,...e)}}const NS=(t,e)=>e.some(n=>t instanceof n);let Hg,qg;function kS(){return Hg||(Hg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function AS(){return qg||(qg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const L_=new WeakMap,dh=new WeakMap,V_=new WeakMap,nd=new WeakMap,Mf=new WeakMap;function RS(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(zr(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&L_.set(n,t)}).catch(()=>{}),Mf.set(e,t),e}function jS(t){if(dh.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});dh.set(t,e)}let hh={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return dh.get(t);if(e==="objectStoreNames")return t.objectStoreNames||V_.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return zr(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function DS(t){hh=t(hh)}function MS(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(rd(this),e,...n);return V_.set(r,e.sort?e.sort():[e]),zr(r)}:AS().includes(t)?function(...e){return t.apply(rd(this),e),zr(L_.get(this))}:function(...e){return zr(t.apply(rd(this),e))}}function OS(t){return typeof t=="function"?MS(t):(t instanceof IDBTransaction&&jS(t),NS(t,kS())?new Proxy(t,hh):t)}function zr(t){if(t instanceof IDBRequest)return RS(t);if(nd.has(t))return nd.get(t);const e=OS(t);return e!==t&&(nd.set(t,e),Mf.set(e,t)),e}const rd=t=>Mf.get(t);function LS(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),l=zr(o);return r&&o.addEventListener("upgradeneeded",c=>{r(zr(o.result),c.oldVersion,c.newVersion,zr(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const VS=["get","getKey","getAll","getAllKeys","count"],US=["put","add","delete","clear"],sd=new Map;function Gg(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(sd.get(e))return sd.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=US.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||VS.includes(n)))return;const i=async function(o,...l){const c=this.transaction(o,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return sd.set(e,i),i}DS(t=>({...t,get:(e,n,r)=>Gg(e,n)||t.get(e,n,r),has:(e,n)=>!!Gg(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if($S(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function $S(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const fh="@firebase/app",Kg="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ar=new Df("@firebase/app"),BS="@firebase/app-compat",zS="@firebase/analytics-compat",WS="@firebase/analytics",HS="@firebase/app-check-compat",qS="@firebase/app-check",GS="@firebase/auth",KS="@firebase/auth-compat",QS="@firebase/database",YS="@firebase/data-connect",XS="@firebase/database-compat",JS="@firebase/functions",ZS="@firebase/functions-compat",eC="@firebase/installations",tC="@firebase/installations-compat",nC="@firebase/messaging",rC="@firebase/messaging-compat",sC="@firebase/performance",iC="@firebase/performance-compat",oC="@firebase/remote-config",aC="@firebase/remote-config-compat",lC="@firebase/storage",cC="@firebase/storage-compat",uC="@firebase/firestore",dC="@firebase/vertexai-preview",hC="@firebase/firestore-compat",fC="firebase",pC="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ph="[DEFAULT]",mC={[fh]:"fire-core",[BS]:"fire-core-compat",[WS]:"fire-analytics",[zS]:"fire-analytics-compat",[qS]:"fire-app-check",[HS]:"fire-app-check-compat",[GS]:"fire-auth",[KS]:"fire-auth-compat",[QS]:"fire-rtdb",[YS]:"fire-data-connect",[XS]:"fire-rtdb-compat",[JS]:"fire-fn",[ZS]:"fire-fn-compat",[eC]:"fire-iid",[tC]:"fire-iid-compat",[nC]:"fire-fcm",[rC]:"fire-fcm-compat",[sC]:"fire-perf",[iC]:"fire-perf-compat",[oC]:"fire-rc",[aC]:"fire-rc-compat",[lC]:"fire-gcs",[cC]:"fire-gcs-compat",[uC]:"fire-fst",[hC]:"fire-fst-compat",[dC]:"fire-vertex","fire-js":"fire-js",[fC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hc=new Map,gC=new Map,mh=new Map;function Qg(t,e){try{t.container.addComponent(e)}catch(n){ar.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Ci(t){const e=t.name;if(mh.has(e))return ar.debug(`There were multiple attempts to register component ${e}.`),!1;mh.set(e,t);for(const n of hc.values())Qg(n,t);for(const n of gC.values())Qg(n,t);return!0}function Of(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Mn(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Wr=new _a("app","Firebase",yC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vC{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ss("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Wr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fi=pC;function U_(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:ph,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Wr.create("bad-app-name",{appName:String(s)});if(n||(n=M_()),!n)throw Wr.create("no-options");const i=hc.get(s);if(i){if(dc(n,i.options)&&dc(r,i.config))return i;throw Wr.create("duplicate-app",{appName:s})}const o=new bS(s);for(const c of mh.values())o.addComponent(c);const l=new vC(n,r,o);return hc.set(s,l),l}function F_(t=ph){const e=hc.get(t);if(!e&&t===ph&&M_())return U_();if(!e)throw Wr.create("no-app",{appName:t});return e}function Hr(t,e,n){var r;let s=(r=mC[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${s}" with version "${e}":`];i&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ar.warn(l.join(" "));return}Ci(new Ss(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _C="firebase-heartbeat-database",wC=1,ra="firebase-heartbeat-store";let id=null;function $_(){return id||(id=LS(_C,wC,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(ra)}catch(n){console.warn(n)}}}}).catch(t=>{throw Wr.create("idb-open",{originalErrorMessage:t.message})})),id}async function EC(t){try{const n=(await $_()).transaction(ra),r=await n.objectStore(ra).get(B_(t));return await n.done,r}catch(e){if(e instanceof hr)ar.warn(e.message);else{const n=Wr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ar.warn(n.message)}}}async function Yg(t,e){try{const r=(await $_()).transaction(ra,"readwrite");await r.objectStore(ra).put(e,B_(t)),await r.done}catch(n){if(n instanceof hr)ar.warn(n.message);else{const r=Wr.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});ar.warn(r.message)}}}function B_(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xC=1024,TC=30*24*60*60*1e3;class bC{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new SC(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Xg();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const l=new Date(o.date).valueOf();return Date.now()-l<=TC}),this._storage.overwrite(this._heartbeatsCache))}catch(r){ar.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Xg(),{heartbeatsToSend:r,unsentEntries:s}=IC(this._heartbeatsCache.heartbeats),i=uc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return ar.warn(n),""}}}function Xg(){return new Date().toISOString().substring(0,10)}function IC(t,e=xC){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Jg(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Jg(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class SC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return hS()?fS().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await EC(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return Yg(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return Yg(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Jg(t){return uc(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CC(t){Ci(new Ss("platform-logger",e=>new FS(e),"PRIVATE")),Ci(new Ss("heartbeat",e=>new bC(e),"PRIVATE")),Hr(fh,Kg,t),Hr(fh,Kg,"esm2017"),Hr("fire-js","")}CC("");function Lf(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function z_(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const PC=z_,W_=new _a("auth","Firebase",z_());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fc=new Df("@firebase/auth");function NC(t,...e){fc.logLevel<=fe.WARN&&fc.warn(`Auth (${Fi}): ${t}`,...e)}function Nl(t,...e){fc.logLevel<=fe.ERROR&&fc.error(`Auth (${Fi}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tn(t,...e){throw Vf(t,...e)}function Vn(t,...e){return Vf(t,...e)}function H_(t,e,n){const r=Object.assign(Object.assign({},PC()),{[e]:n});return new _a("auth","Firebase",r).create(e,{appName:t.name})}function tr(t){return H_(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Vf(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return W_.create(t,...e)}function re(t,e,...n){if(!t)throw Vf(e,...n)}function Xn(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Nl(e),new Error(e)}function lr(t,e){t||Xn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gh(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function kC(){return Zg()==="http:"||Zg()==="https:"}function Zg(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AC(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(kC()||lS()||"connection"in navigator)?navigator.onLine:!0}function RC(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(e,n){this.shortDelay=e,this.longDelay=n,lr(n>e,"Short delay should be less than long delay!"),this.isMobile=iS()||cS()}get(){return AC()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uf(t,e){lr(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q_{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Xn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Xn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Xn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jC={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DC=new Ea(3e4,6e4);function fr(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function pr(t,e,n,r,s={}){return G_(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=wa(Object.assign({key:t.config.apiKey},o)).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d=Object.assign({method:e,headers:c},i);return aS()||(d.referrerPolicy="no-referrer"),q_.fetch()(K_(t,t.config.apiHost,n,l),d)})}async function G_(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},jC),e);try{const s=new OC(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw hl(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw hl(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw hl(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw hl(t,"user-disabled",o);const f=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw H_(t,f,d);Tn(t,f)}}catch(s){if(s instanceof hr)throw s;Tn(t,"network-request-failed",{message:String(s)})}}async function xa(t,e,n,r,s={}){const i=await pr(t,e,n,r,s);return"mfaPendingCredential"in i&&Tn(t,"multi-factor-auth-required",{_serverResponse:i}),i}function K_(t,e,n,r){const s=`${e}${n}?${r}`;return t.config.emulator?Uf(t.config,s):`${t.config.apiScheme}://${s}`}function MC(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class OC{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Vn(this.auth,"network-request-failed")),DC.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function hl(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Vn(t,e,r);return s.customData._tokenResponse=n,s}function ey(t){return t!==void 0&&t.enterprise!==void 0}class LC{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return MC(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function VC(t,e){return pr(t,"GET","/v2/recaptchaConfig",fr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UC(t,e){return pr(t,"POST","/v1/accounts:delete",e)}async function Q_(t,e){return pr(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jo(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function FC(t,e=!1){const n=Ke(t),r=await n.getIdToken(e),s=Ff(r);re(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:jo(od(s.auth_time)),issuedAtTime:jo(od(s.iat)),expirationTime:jo(od(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function od(t){return Number(t)*1e3}function Ff(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Nl("JWT malformed, contained fewer than 3 sections"),null;try{const s=j_(n);return s?JSON.parse(s):(Nl("Failed to decode base64 JWT payload"),null)}catch(s){return Nl("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function ty(t){const e=Ff(t);return re(e,"internal-error"),re(typeof e.exp<"u","internal-error"),re(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sa(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof hr&&$C(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function $C({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yh{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=jo(this.lastLoginAt),this.creationTime=jo(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pc(t){var e;const n=t.auth,r=await t.getIdToken(),s=await sa(t,Q_(n,{idToken:r}));re(s==null?void 0:s.users.length,n,"internal-error");const i=s.users[0];t._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?Y_(i.providerUserInfo):[],l=WC(t.providerData,o),c=t.isAnonymous,d=!(t.email&&i.passwordHash)&&!(l!=null&&l.length),f=c?d:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new yh(i.createdAt,i.lastLoginAt),isAnonymous:f};Object.assign(t,m)}async function zC(t){const e=Ke(t);await pc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function WC(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Y_(t){return t.map(e=>{var{providerId:n}=e,r=Lf(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HC(t,e){const n=await G_(t,{},async()=>{const r=wa({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=K_(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",q_.fetch()(o,{method:"POST",headers:l,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function qC(t,e){return pr(t,"POST","/v2/accounts:revokeToken",fr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){re(e.idToken,"internal-error"),re(typeof e.idToken<"u","internal-error"),re(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ty(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){re(e.length!==0,"internal-error");const n=ty(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(re(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await HC(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new gi;return r&&(re(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(re(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(re(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new gi,this.toJSON())}_performRefresh(){return Xn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Er(t,e){re(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Jn{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,i=Lf(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new BC(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new yh(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await sa(this,this.stsTokenManager.getToken(this.auth,e));return re(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return FC(this,e)}reload(){return zC(this)}_assign(e){this!==e&&(re(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Jn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){re(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await pc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Mn(this.auth.app))return Promise.reject(tr(this.auth));const e=await this.getIdToken();return await sa(this,UC(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,i,o,l,c,d,f;const m=(r=n.displayName)!==null&&r!==void 0?r:void 0,y=(s=n.email)!==null&&s!==void 0?s:void 0,I=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,N=(o=n.photoURL)!==null&&o!==void 0?o:void 0,j=(l=n.tenantId)!==null&&l!==void 0?l:void 0,A=(c=n._redirectEventId)!==null&&c!==void 0?c:void 0,T=(d=n.createdAt)!==null&&d!==void 0?d:void 0,w=(f=n.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:S,emailVerified:O,isAnonymous:R,providerData:V,stsTokenManager:_}=n;re(S&&_,e,"internal-error");const g=gi.fromJSON(this.name,_);re(typeof S=="string",e,"internal-error"),Er(m,e.name),Er(y,e.name),re(typeof O=="boolean",e,"internal-error"),re(typeof R=="boolean",e,"internal-error"),Er(I,e.name),Er(N,e.name),Er(j,e.name),Er(A,e.name),Er(T,e.name),Er(w,e.name);const E=new Jn({uid:S,auth:e,email:y,emailVerified:O,displayName:m,isAnonymous:R,photoURL:N,phoneNumber:I,tenantId:j,stsTokenManager:g,createdAt:T,lastLoginAt:w});return V&&Array.isArray(V)&&(E.providerData=V.map(x=>Object.assign({},x))),A&&(E._redirectEventId=A),E}static async _fromIdTokenResponse(e,n,r=!1){const s=new gi;s.updateFromServerResponse(n);const i=new Jn({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await pc(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];re(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Y_(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new gi;l.updateFromIdToken(r);const c=new Jn({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new yh(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ny=new Map;function Zn(t){lr(t instanceof Function,"Expected a class definition");let e=ny.get(t);return e?(lr(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,ny.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}X_.type="NONE";const ry=X_;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kl(t,e,n){return`firebase:${t}:${e}:${n}`}class yi{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=kl(this.userKey,s.apiKey,i),this.fullPersistenceKey=kl("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Jn._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new yi(Zn(ry),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||Zn(ry);const o=kl(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const f=await d._get(o);if(f){const m=Jn._fromJSON(e,f);d!==i&&(l=m),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new yi(i,e,r):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new yi(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sy(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(tw(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(J_(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(rw(e))return"Blackberry";if(sw(e))return"Webos";if(Z_(e))return"Safari";if((e.includes("chrome/")||ew(e))&&!e.includes("edge/"))return"Chrome";if(nw(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function J_(t=Nt()){return/firefox\//i.test(t)}function Z_(t=Nt()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ew(t=Nt()){return/crios\//i.test(t)}function tw(t=Nt()){return/iemobile/i.test(t)}function nw(t=Nt()){return/android/i.test(t)}function rw(t=Nt()){return/blackberry/i.test(t)}function sw(t=Nt()){return/webos/i.test(t)}function $f(t=Nt()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function GC(t=Nt()){var e;return $f(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function KC(){return uS()&&document.documentMode===10}function iw(t=Nt()){return $f(t)||nw(t)||sw(t)||rw(t)||/windows phone/i.test(t)||tw(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ow(t,e=[]){let n;switch(t){case"Browser":n=sy(Nt());break;case"Worker":n=`${sy(Nt())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Fi}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QC{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YC(t,e={}){return pr(t,"GET","/v2/passwordPolicy",fr(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XC=6;class JC{constructor(e){var n,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:XC,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,s,i,o,l;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(n=c.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(s=c.containsLowercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(i=c.containsUppercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(l=c.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),c}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZC{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new iy(this),this.idTokenSubscription=new iy(this),this.beforeStateQueue=new QC(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=W_,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Zn(n)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await yi.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Q_(this,{idToken:e}),r=await Jn._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(Mn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,l=s==null?void 0:s._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(s=c.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return re(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await pc(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=RC()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Mn(this.app))return Promise.reject(tr(this));const n=e?Ke(e):null;return n&&re(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&re(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Mn(this.app)?Promise.reject(tr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Mn(this.app)?Promise.reject(tr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Zn(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await YC(this),n=new JC(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new _a("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await qC(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Zn(e)||this._popupRedirectResolver;re(n,this,"argument-error"),this.redirectPersistenceManager=await yi.create(this,[Zn(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(re(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return re(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ow(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&NC(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Os(t){return Ke(t)}class iy{constructor(e){this.auth=e,this.observer=null,this.addObserver=vS(n=>this.observer=n)}get next(){return re(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function e1(t){qc=t}function aw(t){return qc.loadJS(t)}function t1(){return qc.recaptchaEnterpriseScript}function n1(){return qc.gapiScript}function r1(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const s1="recaptcha-enterprise",i1="NO_RECAPTCHA";class o1{constructor(e){this.type=s1,this.auth=Os(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,l)=>{VC(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new LC(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,o,l){const c=window.grecaptcha;ey(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o(i1)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(l=>{if(!n&&ey(window.grecaptcha))s(l,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=t1();c.length!==0&&(c+=l),aw(c).then(()=>{s(l,i,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function oy(t,e,n,r=!1){const s=new o1(t);let i;try{i=await s.verify(n)}catch{i=await s.verify(n,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function vh(t,e,n,r){var s;if(!((s=t._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await oy(t,e,n,n==="getOobCode");return r(t,i)}else return r(t,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await oy(t,e,n,n==="getOobCode");return r(t,o)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a1(t,e){const n=Of(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(dc(i,e??{}))return s;Tn(s,"already-initialized")}return n.initialize({options:e})}function l1(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Zn);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function c1(t,e,n){const r=Os(t);re(r._canInitEmulator,r,"emulator-config-failed"),re(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(n!=null&&n.disableWarnings),i=lw(e),{host:o,port:l}=u1(e),c=l===null?"":`:${l}`;r.config.emulator={url:`${i}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||d1()}function lw(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function u1(t){const e=lw(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:ay(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:ay(o)}}}function ay(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function d1(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Xn("not implemented")}_getIdTokenResponse(e){return Xn("not implemented")}_linkToIdToken(e,n){return Xn("not implemented")}_getReauthenticationResolver(e){return Xn("not implemented")}}async function h1(t,e){return pr(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f1(t,e){return xa(t,"POST","/v1/accounts:signInWithPassword",fr(t,e))}async function p1(t,e){return pr(t,"POST","/v1/accounts:sendOobCode",fr(t,e))}async function m1(t,e){return p1(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g1(t,e){return xa(t,"POST","/v1/accounts:signInWithEmailLink",fr(t,e))}async function y1(t,e){return xa(t,"POST","/v1/accounts:signInWithEmailLink",fr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia extends Bf{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new ia(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new ia(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return vh(e,n,"signInWithPassword",f1);case"emailLink":return g1(e,{email:this._email,oobCode:this._password});default:Tn(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return vh(e,r,"signUpPassword",h1);case"emailLink":return y1(e,{idToken:n,email:this._email,oobCode:this._password});default:Tn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vi(t,e){return xa(t,"POST","/v1/accounts:signInWithIdp",fr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v1="http://localhost";class Cs extends Bf{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Cs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Tn("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,i=Lf(n,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Cs(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return vi(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,vi(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,vi(e,n)}buildRequest(){const e={requestUri:v1,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=wa(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _1(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function w1(t){const e=vo(_o(t)).link,n=e?vo(_o(e)).deep_link_id:null,r=vo(_o(t)).deep_link_id;return(r?vo(_o(r)).link:null)||r||n||e||t}class zf{constructor(e){var n,r,s,i,o,l;const c=vo(_o(e)),d=(n=c.apiKey)!==null&&n!==void 0?n:null,f=(r=c.oobCode)!==null&&r!==void 0?r:null,m=_1((s=c.mode)!==null&&s!==void 0?s:null);re(d&&f&&m,"argument-error"),this.apiKey=d,this.operation=m,this.code=f,this.continueUrl=(i=c.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=c.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(l=c.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const n=w1(e);try{return new zf(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(){this.providerId=$i.PROVIDER_ID}static credential(e,n){return ia._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=zf.parseLink(n);return re(r,"argument-error"),ia._fromEmailAndCode(e,r.code,r.tenantId)}}$i.PROVIDER_ID="password";$i.EMAIL_PASSWORD_SIGN_IN_METHOD="password";$i.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta extends cw{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr extends Ta{constructor(){super("facebook.com")}static credential(e){return Cs._fromParams({providerId:Sr.PROVIDER_ID,signInMethod:Sr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Sr.credentialFromTaggedObject(e)}static credentialFromError(e){return Sr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Sr.credential(e.oauthAccessToken)}catch{return null}}}Sr.FACEBOOK_SIGN_IN_METHOD="facebook.com";Sr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr extends Ta{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Cs._fromParams({providerId:Cr.PROVIDER_ID,signInMethod:Cr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Cr.credentialFromTaggedObject(e)}static credentialFromError(e){return Cr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Cr.credential(n,r)}catch{return null}}}Cr.GOOGLE_SIGN_IN_METHOD="google.com";Cr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pr extends Ta{constructor(){super("github.com")}static credential(e){return Cs._fromParams({providerId:Pr.PROVIDER_ID,signInMethod:Pr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Pr.credentialFromTaggedObject(e)}static credentialFromError(e){return Pr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Pr.credential(e.oauthAccessToken)}catch{return null}}}Pr.GITHUB_SIGN_IN_METHOD="github.com";Pr.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr extends Ta{constructor(){super("twitter.com")}static credential(e,n){return Cs._fromParams({providerId:Nr.PROVIDER_ID,signInMethod:Nr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Nr.credentialFromTaggedObject(e)}static credentialFromError(e){return Nr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Nr.credential(n,r)}catch{return null}}}Nr.TWITTER_SIGN_IN_METHOD="twitter.com";Nr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E1(t,e){return xa(t,"POST","/v1/accounts:signUp",fr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await Jn._fromIdTokenResponse(e,r,s),o=ly(r);return new Ps({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=ly(r);return new Ps({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function ly(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc extends hr{constructor(e,n,r,s){var i;super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,mc.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new mc(e,n,r,s)}}function uw(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?mc._fromErrorAndOperation(t,i,e,r):i})}async function x1(t,e,n=!1){const r=await sa(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Ps._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T1(t,e,n=!1){const{auth:r}=t;if(Mn(r.app))return Promise.reject(tr(r));const s="reauthenticate";try{const i=await sa(t,uw(r,s,e,t),n);re(i.idToken,r,"internal-error");const o=Ff(i.idToken);re(o,r,"internal-error");const{sub:l}=o;return re(t.uid===l,r,"user-mismatch"),Ps._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Tn(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dw(t,e,n=!1){if(Mn(t.app))return Promise.reject(tr(t));const r="signIn",s=await uw(t,r,e),i=await Ps._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function b1(t,e){return dw(Os(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I1(t,e,n){var r;re(((r=n.url)===null||r===void 0?void 0:r.length)>0,t,"invalid-continue-uri"),re(typeof n.dynamicLinkDomain>"u"||n.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=n.url,e.dynamicLinkDomain=n.dynamicLinkDomain,e.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(re(n.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=n.iOS.bundleId),n.android&&(re(n.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=n.android.installApp,e.androidMinimumVersionCode=n.android.minimumVersion,e.androidPackageName=n.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hw(t){const e=Os(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function S1(t,e,n){if(Mn(t.app))return Promise.reject(tr(t));const r=Os(t),o=await vh(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",E1).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&hw(t),c}),l=await Ps._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(l.user),l}function C1(t,e,n){return Mn(t.app)?Promise.reject(tr(t)):b1(Ke(t),$i.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&hw(t),r})}async function P1(t,e){const n=Ke(t),s={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()};e&&I1(n.auth,s,e);const{email:i}=await m1(n.auth,s);i!==t.email&&await t.reload()}function N1(t,e,n,r){return Ke(t).onIdTokenChanged(e,n,r)}function k1(t,e,n){return Ke(t).beforeAuthStateChanged(e,n)}function A1(t,e,n,r){return Ke(t).onAuthStateChanged(e,n,r)}function fw(t){return Ke(t).signOut()}const gc="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pw{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(gc,"1"),this.storage.removeItem(gc),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R1=1e3,j1=10;class mw extends pw{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=iw(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);KC()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,j1):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},R1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}mw.type="LOCAL";const D1=mw;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw extends pw{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}gw.type="SESSION";const yw=gw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M1(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new Gc(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async d=>d(n.origin,i)),c=await M1(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Gc.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wf(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O1{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const d=Wf("",20);s.port1.start();const f=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(m){const y=m;if(y.data.eventId===d)switch(y.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(y.data.response);break;default:clearTimeout(f),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Un(){return window}function L1(t){Un().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vw(){return typeof Un().WorkerGlobalScope<"u"&&typeof Un().importScripts=="function"}async function V1(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function U1(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function F1(){return vw()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _w="firebaseLocalStorageDb",$1=1,yc="firebaseLocalStorage",ww="fbase_key";class ba{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Kc(t,e){return t.transaction([yc],e?"readwrite":"readonly").objectStore(yc)}function B1(){const t=indexedDB.deleteDatabase(_w);return new ba(t).toPromise()}function _h(){const t=indexedDB.open(_w,$1);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(yc,{keyPath:ww})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(yc)?e(r):(r.close(),await B1(),e(await _h()))})})}async function cy(t,e,n){const r=Kc(t,!0).put({[ww]:e,value:n});return new ba(r).toPromise()}async function z1(t,e){const n=Kc(t,!1).get(e),r=await new ba(n).toPromise();return r===void 0?null:r.value}function uy(t,e){const n=Kc(t,!0).delete(e);return new ba(n).toPromise()}const W1=800,H1=3;class Ew{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await _h(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>H1)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return vw()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Gc._getInstance(F1()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await V1(),!this.activeServiceWorker)return;this.sender=new O1(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||U1()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await _h();return await cy(e,gc,"1"),await uy(e,gc),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>cy(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>z1(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>uy(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Kc(s,!1).getAll();return new ba(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),W1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Ew.type="LOCAL";const q1=Ew;new Ea(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G1(t,e){return e?Zn(e):(re(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf extends Bf{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return vi(e,this._buildIdpRequest())}_linkToIdToken(e,n){return vi(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return vi(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function K1(t){return dw(t.auth,new Hf(t),t.bypassAuthState)}function Q1(t){const{auth:e,user:n}=t;return re(n,e,"internal-error"),T1(n,new Hf(t),t.bypassAuthState)}async function Y1(t){const{auth:e,user:n}=t;return re(n,e,"internal-error"),x1(n,new Hf(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xw{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return K1;case"linkViaPopup":case"linkViaRedirect":return Y1;case"reauthViaPopup":case"reauthViaRedirect":return Q1;default:Tn(this.auth,"internal-error")}}resolve(e){lr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){lr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X1=new Ea(2e3,1e4);class ci extends xw{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,ci.currentPopupAction&&ci.currentPopupAction.cancel(),ci.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return re(e,this.auth,"internal-error"),e}async onExecution(){lr(this.filter.length===1,"Popup operations only handle one event");const e=Wf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Vn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Vn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ci.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Vn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,X1.get())};e()}}ci.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J1="pendingRedirect",Al=new Map;class Z1 extends xw{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Al.get(this.auth._key());if(!e){try{const r=await eP(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Al.set(this.auth._key(),e)}return this.bypassAuthState||Al.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function eP(t,e){const n=rP(e),r=nP(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function tP(t,e){Al.set(t._key(),e)}function nP(t){return Zn(t._redirectPersistence)}function rP(t){return kl(J1,t.config.apiKey,t.name)}async function sP(t,e,n=!1){if(Mn(t.app))return Promise.reject(tr(t));const r=Os(t),s=G1(r,e),o=await new Z1(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iP=10*60*1e3;class oP{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!aP(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!Tw(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(Vn(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=iP&&this.cachedEventUids.clear(),this.cachedEventUids.has(dy(e))}saveEventToCache(e){this.cachedEventUids.add(dy(e)),this.lastProcessedEventTime=Date.now()}}function dy(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Tw({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function aP(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Tw(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lP(t,e={}){return pr(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cP=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,uP=/^https?/;async function dP(t){if(t.config.emulator)return;const{authorizedDomains:e}=await lP(t);for(const n of e)try{if(hP(n))return}catch{}Tn(t,"unauthorized-domain")}function hP(t){const e=gh(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!uP.test(n))return!1;if(cP.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fP=new Ea(3e4,6e4);function hy(){const t=Un().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function pP(t){return new Promise((e,n)=>{var r,s,i;function o(){hy(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{hy(),n(Vn(t,"network-request-failed"))},timeout:fP.get()})}if(!((s=(r=Un().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Un().gapi)===null||i===void 0)&&i.load)o();else{const l=r1("iframefcb");return Un()[l]=()=>{gapi.load?o():n(Vn(t,"network-request-failed"))},aw(`${n1()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw Rl=null,e})}let Rl=null;function mP(t){return Rl=Rl||pP(t),Rl}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gP=new Ea(5e3,15e3),yP="__/auth/iframe",vP="emulator/auth/iframe",_P={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},wP=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function EP(t){const e=t.config;re(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Uf(e,vP):`https://${t.config.authDomain}/${yP}`,r={apiKey:e.apiKey,appName:t.name,v:Fi},s=wP.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${wa(r).slice(1)}`}async function xP(t){const e=await mP(t),n=Un().gapi;return re(n,t,"internal-error"),e.open({where:document.body,url:EP(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:_P,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Vn(t,"network-request-failed"),l=Un().setTimeout(()=>{i(o)},gP.get());function c(){Un().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TP={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},bP=500,IP=600,SP="_blank",CP="http://localhost";class fy{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function PP(t,e,n,r=bP,s=IP){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c=Object.assign(Object.assign({},TP),{width:r.toString(),height:s.toString(),top:i,left:o}),d=Nt().toLowerCase();n&&(l=ew(d)?SP:n),J_(d)&&(e=e||CP,c.scrollbars="yes");const f=Object.entries(c).reduce((y,[I,N])=>`${y}${I}=${N},`,"");if(GC(d)&&l!=="_self")return NP(e||"",l),new fy(null);const m=window.open(e||"",l,f);re(m,t,"popup-blocked");try{m.focus()}catch{}return new fy(m)}function NP(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kP="__/auth/handler",AP="emulator/auth/handler",RP=encodeURIComponent("fac");async function py(t,e,n,r,s,i){re(t.config.authDomain,t,"auth-domain-config-required"),re(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Fi,eventId:s};if(e instanceof cw){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",yS(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,m]of Object.entries(i||{}))o[f]=m}if(e instanceof Ta){const f=e.getScopes().filter(m=>m!=="");f.length>0&&(o.scopes=f.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const c=await t._getAppCheckToken(),d=c?`#${RP}=${encodeURIComponent(c)}`:"";return`${jP(t)}?${wa(l).slice(1)}${d}`}function jP({config:t}){return t.emulator?Uf(t,AP):`https://${t.authDomain}/${kP}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ad="webStorageSupport";class DP{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=yw,this._completeRedirectFn=sP,this._overrideRedirectResult=tP}async _openPopup(e,n,r,s){var i;lr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await py(e,n,r,gh(),s);return PP(e,o,Wf())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await py(e,n,r,gh(),s);return L1(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(lr(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await xP(e),r=new oP(e);return n.register("authEvent",s=>(re(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(ad,{type:ad},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[ad];o!==void 0&&n(!!o),Tn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=dP(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return iw()||Z_()||$f()}}const MP=DP;var my="@firebase/auth",gy="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OP{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){re(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LP(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function VP(t){Ci(new Ss("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;re(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ow(t)},d=new ZC(r,s,i,c);return l1(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Ci(new Ss("auth-internal",e=>{const n=Os(e.getProvider("auth").getImmediate());return(r=>new OP(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Hr(my,gy,LP(t)),Hr(my,gy,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UP=5*60,FP=O_("authIdTokenMaxAge")||UP;let yy=null;const $P=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>FP)return;const s=n==null?void 0:n.token;yy!==s&&(yy=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function BP(t=F_()){const e=Of(t,"auth");if(e.isInitialized())return e.getImmediate();const n=a1(t,{popupRedirectResolver:MP,persistence:[q1,D1,yw]}),r=O_("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=$P(i.toString());k1(n,o,()=>o(n.currentUser)),N1(n,l=>o(l))}}const s=D_("auth");return s&&c1(n,`http://${s}`),n}function zP(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}e1({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Vn("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",zP().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});VP("Browser");var WP="firebase",HP="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Hr(WP,HP,"app");var vy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ws,bw;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(_,g){function E(){}E.prototype=g.prototype,_.D=g.prototype,_.prototype=new E,_.prototype.constructor=_,_.C=function(x,C,P){for(var b=Array(arguments.length-2),ce=2;ce<arguments.length;ce++)b[ce-2]=arguments[ce];return g.prototype[C].apply(x,b)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(_,g,E){E||(E=0);var x=Array(16);if(typeof g=="string")for(var C=0;16>C;++C)x[C]=g.charCodeAt(E++)|g.charCodeAt(E++)<<8|g.charCodeAt(E++)<<16|g.charCodeAt(E++)<<24;else for(C=0;16>C;++C)x[C]=g[E++]|g[E++]<<8|g[E++]<<16|g[E++]<<24;g=_.g[0],E=_.g[1],C=_.g[2];var P=_.g[3],b=g+(P^E&(C^P))+x[0]+3614090360&4294967295;g=E+(b<<7&4294967295|b>>>25),b=P+(C^g&(E^C))+x[1]+3905402710&4294967295,P=g+(b<<12&4294967295|b>>>20),b=C+(E^P&(g^E))+x[2]+606105819&4294967295,C=P+(b<<17&4294967295|b>>>15),b=E+(g^C&(P^g))+x[3]+3250441966&4294967295,E=C+(b<<22&4294967295|b>>>10),b=g+(P^E&(C^P))+x[4]+4118548399&4294967295,g=E+(b<<7&4294967295|b>>>25),b=P+(C^g&(E^C))+x[5]+1200080426&4294967295,P=g+(b<<12&4294967295|b>>>20),b=C+(E^P&(g^E))+x[6]+2821735955&4294967295,C=P+(b<<17&4294967295|b>>>15),b=E+(g^C&(P^g))+x[7]+4249261313&4294967295,E=C+(b<<22&4294967295|b>>>10),b=g+(P^E&(C^P))+x[8]+1770035416&4294967295,g=E+(b<<7&4294967295|b>>>25),b=P+(C^g&(E^C))+x[9]+2336552879&4294967295,P=g+(b<<12&4294967295|b>>>20),b=C+(E^P&(g^E))+x[10]+4294925233&4294967295,C=P+(b<<17&4294967295|b>>>15),b=E+(g^C&(P^g))+x[11]+2304563134&4294967295,E=C+(b<<22&4294967295|b>>>10),b=g+(P^E&(C^P))+x[12]+1804603682&4294967295,g=E+(b<<7&4294967295|b>>>25),b=P+(C^g&(E^C))+x[13]+4254626195&4294967295,P=g+(b<<12&4294967295|b>>>20),b=C+(E^P&(g^E))+x[14]+2792965006&4294967295,C=P+(b<<17&4294967295|b>>>15),b=E+(g^C&(P^g))+x[15]+1236535329&4294967295,E=C+(b<<22&4294967295|b>>>10),b=g+(C^P&(E^C))+x[1]+4129170786&4294967295,g=E+(b<<5&4294967295|b>>>27),b=P+(E^C&(g^E))+x[6]+3225465664&4294967295,P=g+(b<<9&4294967295|b>>>23),b=C+(g^E&(P^g))+x[11]+643717713&4294967295,C=P+(b<<14&4294967295|b>>>18),b=E+(P^g&(C^P))+x[0]+3921069994&4294967295,E=C+(b<<20&4294967295|b>>>12),b=g+(C^P&(E^C))+x[5]+3593408605&4294967295,g=E+(b<<5&4294967295|b>>>27),b=P+(E^C&(g^E))+x[10]+38016083&4294967295,P=g+(b<<9&4294967295|b>>>23),b=C+(g^E&(P^g))+x[15]+3634488961&4294967295,C=P+(b<<14&4294967295|b>>>18),b=E+(P^g&(C^P))+x[4]+3889429448&4294967295,E=C+(b<<20&4294967295|b>>>12),b=g+(C^P&(E^C))+x[9]+568446438&4294967295,g=E+(b<<5&4294967295|b>>>27),b=P+(E^C&(g^E))+x[14]+3275163606&4294967295,P=g+(b<<9&4294967295|b>>>23),b=C+(g^E&(P^g))+x[3]+4107603335&4294967295,C=P+(b<<14&4294967295|b>>>18),b=E+(P^g&(C^P))+x[8]+1163531501&4294967295,E=C+(b<<20&4294967295|b>>>12),b=g+(C^P&(E^C))+x[13]+2850285829&4294967295,g=E+(b<<5&4294967295|b>>>27),b=P+(E^C&(g^E))+x[2]+4243563512&4294967295,P=g+(b<<9&4294967295|b>>>23),b=C+(g^E&(P^g))+x[7]+1735328473&4294967295,C=P+(b<<14&4294967295|b>>>18),b=E+(P^g&(C^P))+x[12]+2368359562&4294967295,E=C+(b<<20&4294967295|b>>>12),b=g+(E^C^P)+x[5]+4294588738&4294967295,g=E+(b<<4&4294967295|b>>>28),b=P+(g^E^C)+x[8]+2272392833&4294967295,P=g+(b<<11&4294967295|b>>>21),b=C+(P^g^E)+x[11]+1839030562&4294967295,C=P+(b<<16&4294967295|b>>>16),b=E+(C^P^g)+x[14]+4259657740&4294967295,E=C+(b<<23&4294967295|b>>>9),b=g+(E^C^P)+x[1]+2763975236&4294967295,g=E+(b<<4&4294967295|b>>>28),b=P+(g^E^C)+x[4]+1272893353&4294967295,P=g+(b<<11&4294967295|b>>>21),b=C+(P^g^E)+x[7]+4139469664&4294967295,C=P+(b<<16&4294967295|b>>>16),b=E+(C^P^g)+x[10]+3200236656&4294967295,E=C+(b<<23&4294967295|b>>>9),b=g+(E^C^P)+x[13]+681279174&4294967295,g=E+(b<<4&4294967295|b>>>28),b=P+(g^E^C)+x[0]+3936430074&4294967295,P=g+(b<<11&4294967295|b>>>21),b=C+(P^g^E)+x[3]+3572445317&4294967295,C=P+(b<<16&4294967295|b>>>16),b=E+(C^P^g)+x[6]+76029189&4294967295,E=C+(b<<23&4294967295|b>>>9),b=g+(E^C^P)+x[9]+3654602809&4294967295,g=E+(b<<4&4294967295|b>>>28),b=P+(g^E^C)+x[12]+3873151461&4294967295,P=g+(b<<11&4294967295|b>>>21),b=C+(P^g^E)+x[15]+530742520&4294967295,C=P+(b<<16&4294967295|b>>>16),b=E+(C^P^g)+x[2]+3299628645&4294967295,E=C+(b<<23&4294967295|b>>>9),b=g+(C^(E|~P))+x[0]+4096336452&4294967295,g=E+(b<<6&4294967295|b>>>26),b=P+(E^(g|~C))+x[7]+1126891415&4294967295,P=g+(b<<10&4294967295|b>>>22),b=C+(g^(P|~E))+x[14]+2878612391&4294967295,C=P+(b<<15&4294967295|b>>>17),b=E+(P^(C|~g))+x[5]+4237533241&4294967295,E=C+(b<<21&4294967295|b>>>11),b=g+(C^(E|~P))+x[12]+1700485571&4294967295,g=E+(b<<6&4294967295|b>>>26),b=P+(E^(g|~C))+x[3]+2399980690&4294967295,P=g+(b<<10&4294967295|b>>>22),b=C+(g^(P|~E))+x[10]+4293915773&4294967295,C=P+(b<<15&4294967295|b>>>17),b=E+(P^(C|~g))+x[1]+2240044497&4294967295,E=C+(b<<21&4294967295|b>>>11),b=g+(C^(E|~P))+x[8]+1873313359&4294967295,g=E+(b<<6&4294967295|b>>>26),b=P+(E^(g|~C))+x[15]+4264355552&4294967295,P=g+(b<<10&4294967295|b>>>22),b=C+(g^(P|~E))+x[6]+2734768916&4294967295,C=P+(b<<15&4294967295|b>>>17),b=E+(P^(C|~g))+x[13]+1309151649&4294967295,E=C+(b<<21&4294967295|b>>>11),b=g+(C^(E|~P))+x[4]+4149444226&4294967295,g=E+(b<<6&4294967295|b>>>26),b=P+(E^(g|~C))+x[11]+3174756917&4294967295,P=g+(b<<10&4294967295|b>>>22),b=C+(g^(P|~E))+x[2]+718787259&4294967295,C=P+(b<<15&4294967295|b>>>17),b=E+(P^(C|~g))+x[9]+3951481745&4294967295,_.g[0]=_.g[0]+g&4294967295,_.g[1]=_.g[1]+(C+(b<<21&4294967295|b>>>11))&4294967295,_.g[2]=_.g[2]+C&4294967295,_.g[3]=_.g[3]+P&4294967295}r.prototype.u=function(_,g){g===void 0&&(g=_.length);for(var E=g-this.blockSize,x=this.B,C=this.h,P=0;P<g;){if(C==0)for(;P<=E;)s(this,_,P),P+=this.blockSize;if(typeof _=="string"){for(;P<g;)if(x[C++]=_.charCodeAt(P++),C==this.blockSize){s(this,x),C=0;break}}else for(;P<g;)if(x[C++]=_[P++],C==this.blockSize){s(this,x),C=0;break}}this.h=C,this.o+=g},r.prototype.v=function(){var _=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);_[0]=128;for(var g=1;g<_.length-8;++g)_[g]=0;var E=8*this.o;for(g=_.length-8;g<_.length;++g)_[g]=E&255,E/=256;for(this.u(_),_=Array(16),g=E=0;4>g;++g)for(var x=0;32>x;x+=8)_[E++]=this.g[g]>>>x&255;return _};function i(_,g){var E=l;return Object.prototype.hasOwnProperty.call(E,_)?E[_]:E[_]=g(_)}function o(_,g){this.h=g;for(var E=[],x=!0,C=_.length-1;0<=C;C--){var P=_[C]|0;x&&P==g||(E[C]=P,x=!1)}this.g=E}var l={};function c(_){return-128<=_&&128>_?i(_,function(g){return new o([g|0],0>g?-1:0)}):new o([_|0],0>_?-1:0)}function d(_){if(isNaN(_)||!isFinite(_))return m;if(0>_)return A(d(-_));for(var g=[],E=1,x=0;_>=E;x++)g[x]=_/E|0,E*=4294967296;return new o(g,0)}function f(_,g){if(_.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(_.charAt(0)=="-")return A(f(_.substring(1),g));if(0<=_.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=d(Math.pow(g,8)),x=m,C=0;C<_.length;C+=8){var P=Math.min(8,_.length-C),b=parseInt(_.substring(C,C+P),g);8>P?(P=d(Math.pow(g,P)),x=x.j(P).add(d(b))):(x=x.j(E),x=x.add(d(b)))}return x}var m=c(0),y=c(1),I=c(16777216);t=o.prototype,t.m=function(){if(j(this))return-A(this).m();for(var _=0,g=1,E=0;E<this.g.length;E++){var x=this.i(E);_+=(0<=x?x:4294967296+x)*g,g*=4294967296}return _},t.toString=function(_){if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(N(this))return"0";if(j(this))return"-"+A(this).toString(_);for(var g=d(Math.pow(_,6)),E=this,x="";;){var C=O(E,g).g;E=T(E,C.j(g));var P=((0<E.g.length?E.g[0]:E.h)>>>0).toString(_);if(E=C,N(E))return P+x;for(;6>P.length;)P="0"+P;x=P+x}},t.i=function(_){return 0>_?0:_<this.g.length?this.g[_]:this.h};function N(_){if(_.h!=0)return!1;for(var g=0;g<_.g.length;g++)if(_.g[g]!=0)return!1;return!0}function j(_){return _.h==-1}t.l=function(_){return _=T(this,_),j(_)?-1:N(_)?0:1};function A(_){for(var g=_.g.length,E=[],x=0;x<g;x++)E[x]=~_.g[x];return new o(E,~_.h).add(y)}t.abs=function(){return j(this)?A(this):this},t.add=function(_){for(var g=Math.max(this.g.length,_.g.length),E=[],x=0,C=0;C<=g;C++){var P=x+(this.i(C)&65535)+(_.i(C)&65535),b=(P>>>16)+(this.i(C)>>>16)+(_.i(C)>>>16);x=b>>>16,P&=65535,b&=65535,E[C]=b<<16|P}return new o(E,E[E.length-1]&-2147483648?-1:0)};function T(_,g){return _.add(A(g))}t.j=function(_){if(N(this)||N(_))return m;if(j(this))return j(_)?A(this).j(A(_)):A(A(this).j(_));if(j(_))return A(this.j(A(_)));if(0>this.l(I)&&0>_.l(I))return d(this.m()*_.m());for(var g=this.g.length+_.g.length,E=[],x=0;x<2*g;x++)E[x]=0;for(x=0;x<this.g.length;x++)for(var C=0;C<_.g.length;C++){var P=this.i(x)>>>16,b=this.i(x)&65535,ce=_.i(C)>>>16,$e=_.i(C)&65535;E[2*x+2*C]+=b*$e,w(E,2*x+2*C),E[2*x+2*C+1]+=P*$e,w(E,2*x+2*C+1),E[2*x+2*C+1]+=b*ce,w(E,2*x+2*C+1),E[2*x+2*C+2]+=P*ce,w(E,2*x+2*C+2)}for(x=0;x<g;x++)E[x]=E[2*x+1]<<16|E[2*x];for(x=g;x<2*g;x++)E[x]=0;return new o(E,0)};function w(_,g){for(;(_[g]&65535)!=_[g];)_[g+1]+=_[g]>>>16,_[g]&=65535,g++}function S(_,g){this.g=_,this.h=g}function O(_,g){if(N(g))throw Error("division by zero");if(N(_))return new S(m,m);if(j(_))return g=O(A(_),g),new S(A(g.g),A(g.h));if(j(g))return g=O(_,A(g)),new S(A(g.g),g.h);if(30<_.g.length){if(j(_)||j(g))throw Error("slowDivide_ only works with positive integers.");for(var E=y,x=g;0>=x.l(_);)E=R(E),x=R(x);var C=V(E,1),P=V(x,1);for(x=V(x,2),E=V(E,2);!N(x);){var b=P.add(x);0>=b.l(_)&&(C=C.add(E),P=b),x=V(x,1),E=V(E,1)}return g=T(_,C.j(g)),new S(C,g)}for(C=m;0<=_.l(g);){for(E=Math.max(1,Math.floor(_.m()/g.m())),x=Math.ceil(Math.log(E)/Math.LN2),x=48>=x?1:Math.pow(2,x-48),P=d(E),b=P.j(g);j(b)||0<b.l(_);)E-=x,P=d(E),b=P.j(g);N(P)&&(P=y),C=C.add(P),_=T(_,b)}return new S(C,_)}t.A=function(_){return O(this,_).h},t.and=function(_){for(var g=Math.max(this.g.length,_.g.length),E=[],x=0;x<g;x++)E[x]=this.i(x)&_.i(x);return new o(E,this.h&_.h)},t.or=function(_){for(var g=Math.max(this.g.length,_.g.length),E=[],x=0;x<g;x++)E[x]=this.i(x)|_.i(x);return new o(E,this.h|_.h)},t.xor=function(_){for(var g=Math.max(this.g.length,_.g.length),E=[],x=0;x<g;x++)E[x]=this.i(x)^_.i(x);return new o(E,this.h^_.h)};function R(_){for(var g=_.g.length+1,E=[],x=0;x<g;x++)E[x]=_.i(x)<<1|_.i(x-1)>>>31;return new o(E,_.h)}function V(_,g){var E=g>>5;g%=32;for(var x=_.g.length-E,C=[],P=0;P<x;P++)C[P]=0<g?_.i(P+E)>>>g|_.i(P+E+1)<<32-g:_.i(P+E);return new o(C,_.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,bw=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=f,ws=o}).apply(typeof vy<"u"?vy:typeof self<"u"?self:typeof window<"u"?window:{});var fl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Iw,wo,Sw,jl,wh,Cw,Pw,Nw;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,h,p){return a==Array.prototype||a==Object.prototype||(a[h]=p.value),a};function n(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof fl=="object"&&fl];for(var h=0;h<a.length;++h){var p=a[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=n(this);function s(a,h){if(h)e:{var p=r;a=a.split(".");for(var v=0;v<a.length-1;v++){var M=a[v];if(!(M in p))break e;p=p[M]}a=a[a.length-1],v=p[a],h=h(v),h!=v&&h!=null&&e(p,a,{configurable:!0,writable:!0,value:h})}}function i(a,h){a instanceof String&&(a+="");var p=0,v=!1,M={next:function(){if(!v&&p<a.length){var U=p++;return{value:h(U,a[U]),done:!1}}return v=!0,{done:!0,value:void 0}}};return M[Symbol.iterator]=function(){return M},M}s("Array.prototype.values",function(a){return a||function(){return i(this,function(h,p){return p})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function c(a){var h=typeof a;return h=h!="object"?h:a?Array.isArray(a)?"array":h:"null",h=="array"||h=="object"&&typeof a.length=="number"}function d(a){var h=typeof a;return h=="object"&&a!=null||h=="function"}function f(a,h,p){return a.call.apply(a.bind,arguments)}function m(a,h,p){if(!a)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var M=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(M,v),a.apply(h,M)}}return function(){return a.apply(h,arguments)}}function y(a,h,p){return y=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:m,y.apply(null,arguments)}function I(a,h){var p=Array.prototype.slice.call(arguments,1);return function(){var v=p.slice();return v.push.apply(v,arguments),a.apply(this,v)}}function N(a,h){function p(){}p.prototype=h.prototype,a.aa=h.prototype,a.prototype=new p,a.prototype.constructor=a,a.Qb=function(v,M,U){for(var Q=Array(arguments.length-2),Se=2;Se<arguments.length;Se++)Q[Se-2]=arguments[Se];return h.prototype[M].apply(v,Q)}}function j(a){const h=a.length;if(0<h){const p=Array(h);for(let v=0;v<h;v++)p[v]=a[v];return p}return[]}function A(a,h){for(let p=1;p<arguments.length;p++){const v=arguments[p];if(c(v)){const M=a.length||0,U=v.length||0;a.length=M+U;for(let Q=0;Q<U;Q++)a[M+Q]=v[Q]}else a.push(v)}}class T{constructor(h,p){this.i=h,this.j=p,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function w(a){return/^[\s\xa0]*$/.test(a)}function S(){var a=l.navigator;return a&&(a=a.userAgent)?a:""}function O(a){return O[" "](a),a}O[" "]=function(){};var R=S().indexOf("Gecko")!=-1&&!(S().toLowerCase().indexOf("webkit")!=-1&&S().indexOf("Edge")==-1)&&!(S().indexOf("Trident")!=-1||S().indexOf("MSIE")!=-1)&&S().indexOf("Edge")==-1;function V(a,h,p){for(const v in a)h.call(p,a[v],v,a)}function _(a,h){for(const p in a)h.call(void 0,a[p],p,a)}function g(a){const h={};for(const p in a)h[p]=a[p];return h}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function x(a,h){let p,v;for(let M=1;M<arguments.length;M++){v=arguments[M];for(p in v)a[p]=v[p];for(let U=0;U<E.length;U++)p=E[U],Object.prototype.hasOwnProperty.call(v,p)&&(a[p]=v[p])}}function C(a){var h=1;a=a.split(":");const p=[];for(;0<h&&a.length;)p.push(a.shift()),h--;return a.length&&p.push(a.join(":")),p}function P(a){l.setTimeout(()=>{throw a},0)}function b(){var a=se;let h=null;return a.g&&(h=a.g,a.g=a.g.next,a.g||(a.h=null),h.next=null),h}class ce{constructor(){this.h=this.g=null}add(h,p){const v=$e.get();v.set(h,p),this.h?this.h.next=v:this.g=v,this.h=v}}var $e=new T(()=>new et,a=>a.reset());class et{constructor(){this.next=this.g=this.h=null}set(h,p){this.h=h,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let Ve,K=!1,se=new ce,ie=()=>{const a=l.Promise.resolve(void 0);Ve=()=>{a.then(Ee)}};var Ee=()=>{for(var a;a=b();){try{a.h.call(a.g)}catch(p){P(p)}var h=$e;h.j(a),100>h.h&&(h.h++,a.next=h.g,h.g=a)}K=!1};function ye(){this.s=this.s,this.C=this.C}ye.prototype.s=!1,ye.prototype.ma=function(){this.s||(this.s=!0,this.N())},ye.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Te(a,h){this.type=a,this.g=this.target=h,this.defaultPrevented=!1}Te.prototype.h=function(){this.defaultPrevented=!0};var gt=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,h=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const p=()=>{};l.addEventListener("test",p,h),l.removeEventListener("test",p,h)}catch{}return a}();function Qe(a,h){if(Te.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var p=this.type=a.type,v=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=h,h=a.relatedTarget){if(R){e:{try{O(h.nodeName);var M=!0;break e}catch{}M=!1}M||(h=null)}}else p=="mouseover"?h=a.fromElement:p=="mouseout"&&(h=a.toElement);this.relatedTarget=h,v?(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:yt[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Qe.aa.h.call(this)}}N(Qe,Te);var yt={2:"touch",3:"pen",4:"mouse"};Qe.prototype.h=function(){Qe.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var ot="closure_listenable_"+(1e6*Math.random()|0),cn=0;function is(a,h,p,v,M){this.listener=a,this.proxy=null,this.src=h,this.type=p,this.capture=!!v,this.ha=M,this.key=++cn,this.da=this.fa=!1}function Sn(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function un(a){this.src=a,this.g={},this.h=0}un.prototype.add=function(a,h,p,v,M){var U=a.toString();a=this.g[U],a||(a=this.g[U]=[],this.h++);var Q=vt(a,h,v,M);return-1<Q?(h=a[Q],p||(h.fa=!1)):(h=new is(h,this.src,U,!!v,M),h.fa=p,a.push(h)),h};function xe(a,h){var p=h.type;if(p in a.g){var v=a.g[p],M=Array.prototype.indexOf.call(v,h,void 0),U;(U=0<=M)&&Array.prototype.splice.call(v,M,1),U&&(Sn(h),a.g[p].length==0&&(delete a.g[p],a.h--))}}function vt(a,h,p,v){for(var M=0;M<a.length;++M){var U=a[M];if(!U.da&&U.listener==h&&U.capture==!!p&&U.ha==v)return M}return-1}var Cn="closure_lm_"+(1e6*Math.random()|0),Pn={};function Wt(a,h,p,v,M){if(v&&v.once)return L(a,h,p,v,M);if(Array.isArray(h)){for(var U=0;U<h.length;U++)Wt(a,h[U],p,v,M);return null}return p=ne(p),a&&a[ot]?a.K(h,p,d(v)?!!v.capture:!!v,M):z(a,h,p,!1,v,M)}function z(a,h,p,v,M,U){if(!h)throw Error("Invalid event type");var Q=d(M)?!!M.capture:!!M,Se=G(a);if(Se||(a[Cn]=Se=new un(a)),p=Se.add(h,p,v,Q,U),p.proxy)return p;if(v=Y(),p.proxy=v,v.src=a,v.listener=p,a.addEventListener)gt||(M=Q),M===void 0&&(M=!1),a.addEventListener(h.toString(),v,M);else if(a.attachEvent)a.attachEvent(F(h.toString()),v);else if(a.addListener&&a.removeListener)a.addListener(v);else throw Error("addEventListener and attachEvent are unavailable.");return p}function Y(){function a(p){return h.call(a.src,a.listener,p)}const h=H;return a}function L(a,h,p,v,M){if(Array.isArray(h)){for(var U=0;U<h.length;U++)L(a,h[U],p,v,M);return null}return p=ne(p),a&&a[ot]?a.L(h,p,d(v)?!!v.capture:!!v,M):z(a,h,p,!0,v,M)}function W(a,h,p,v,M){if(Array.isArray(h))for(var U=0;U<h.length;U++)W(a,h[U],p,v,M);else v=d(v)?!!v.capture:!!v,p=ne(p),a&&a[ot]?(a=a.i,h=String(h).toString(),h in a.g&&(U=a.g[h],p=vt(U,p,v,M),-1<p&&(Sn(U[p]),Array.prototype.splice.call(U,p,1),U.length==0&&(delete a.g[h],a.h--)))):a&&(a=G(a))&&(h=a.g[h.toString()],a=-1,h&&(a=vt(h,p,v,M)),(p=-1<a?h[a]:null)&&k(p))}function k(a){if(typeof a!="number"&&a&&!a.da){var h=a.src;if(h&&h[ot])xe(h.i,a);else{var p=a.type,v=a.proxy;h.removeEventListener?h.removeEventListener(p,v,a.capture):h.detachEvent?h.detachEvent(F(p),v):h.addListener&&h.removeListener&&h.removeListener(v),(p=G(h))?(xe(p,a),p.h==0&&(p.src=null,h[Cn]=null)):Sn(a)}}}function F(a){return a in Pn?Pn[a]:Pn[a]="on"+a}function H(a,h){if(a.da)a=!0;else{h=new Qe(h,this);var p=a.listener,v=a.ha||a.src;a.fa&&k(a),a=p.call(v,h)}return a}function G(a){return a=a[Cn],a instanceof un?a:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function ne(a){return typeof a=="function"?a:(a[ee]||(a[ee]=function(h){return a.handleEvent(h)}),a[ee])}function ue(){ye.call(this),this.i=new un(this),this.M=this,this.F=null}N(ue,ye),ue.prototype[ot]=!0,ue.prototype.removeEventListener=function(a,h,p,v){W(this,a,h,p,v)};function pe(a,h){var p,v=a.F;if(v)for(p=[];v;v=v.F)p.push(v);if(a=a.M,v=h.type||h,typeof h=="string")h=new Te(h,a);else if(h instanceof Te)h.target=h.target||a;else{var M=h;h=new Te(v,a),x(h,M)}if(M=!0,p)for(var U=p.length-1;0<=U;U--){var Q=h.g=p[U];M=tt(Q,v,!0,h)&&M}if(Q=h.g=a,M=tt(Q,v,!0,h)&&M,M=tt(Q,v,!1,h)&&M,p)for(U=0;U<p.length;U++)Q=h.g=p[U],M=tt(Q,v,!1,h)&&M}ue.prototype.N=function(){if(ue.aa.N.call(this),this.i){var a=this.i,h;for(h in a.g){for(var p=a.g[h],v=0;v<p.length;v++)Sn(p[v]);delete a.g[h],a.h--}}this.F=null},ue.prototype.K=function(a,h,p,v){return this.i.add(String(a),h,!1,p,v)},ue.prototype.L=function(a,h,p,v){return this.i.add(String(a),h,!0,p,v)};function tt(a,h,p,v){if(h=a.i.g[String(h)],!h)return!0;h=h.concat();for(var M=!0,U=0;U<h.length;++U){var Q=h[U];if(Q&&!Q.da&&Q.capture==p){var Se=Q.listener,at=Q.ha||Q.src;Q.fa&&xe(a.i,Q),M=Se.call(at,v)!==!1&&M}}return M&&!v.defaultPrevented}function dn(a,h,p){if(typeof a=="function")p&&(a=y(a,p));else if(a&&typeof a.handleEvent=="function")a=y(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:l.setTimeout(a,h||0)}function hn(a){a.g=dn(()=>{a.g=null,a.i&&(a.i=!1,hn(a))},a.l);const h=a.h;a.h=null,a.m.apply(null,h)}class $s extends ye{constructor(h,p){super(),this.m=h,this.l=p,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:hn(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function mr(a){ye.call(this),this.h=a,this.g={}}N(mr,ye);var gr=[];function Dp(a){V(a.g,function(h,p){this.g.hasOwnProperty(p)&&k(h)},a),a.g={}}mr.prototype.N=function(){mr.aa.N.call(this),Dp(this)},mr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var hu=l.JSON.stringify,QE=l.JSON.parse,YE=class{stringify(a){return l.JSON.stringify(a,void 0)}parse(a){return l.JSON.parse(a,void 0)}};function fu(){}fu.prototype.h=null;function Mp(a){return a.h||(a.h=a.i())}function Op(){}var qi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function pu(){Te.call(this,"d")}N(pu,Te);function mu(){Te.call(this,"c")}N(mu,Te);var os={},Lp=null;function Da(){return Lp=Lp||new ue}os.La="serverreachability";function Vp(a){Te.call(this,os.La,a)}N(Vp,Te);function Gi(a){const h=Da();pe(h,new Vp(h))}os.STAT_EVENT="statevent";function Up(a,h){Te.call(this,os.STAT_EVENT,a),this.stat=h}N(Up,Te);function At(a){const h=Da();pe(h,new Up(h,a))}os.Ma="timingevent";function Fp(a,h){Te.call(this,os.Ma,a),this.size=h}N(Fp,Te);function Ki(a,h){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){a()},h)}function Qi(){this.g=!0}Qi.prototype.xa=function(){this.g=!1};function XE(a,h,p,v,M,U){a.info(function(){if(a.g)if(U)for(var Q="",Se=U.split("&"),at=0;at<Se.length;at++){var _e=Se[at].split("=");if(1<_e.length){var _t=_e[0];_e=_e[1];var wt=_t.split("_");Q=2<=wt.length&&wt[1]=="type"?Q+(_t+"="+_e+"&"):Q+(_t+"=redacted&")}}else Q=null;else Q=U;return"XMLHTTP REQ ("+v+") [attempt "+M+"]: "+h+`
`+p+`
`+Q})}function JE(a,h,p,v,M,U,Q){a.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+M+"]: "+h+`
`+p+`
`+U+" "+Q})}function Bs(a,h,p,v){a.info(function(){return"XMLHTTP TEXT ("+h+"): "+ex(a,p)+(v?" "+v:"")})}function ZE(a,h){a.info(function(){return"TIMEOUT: "+h})}Qi.prototype.info=function(){};function ex(a,h){if(!a.g)return h;if(!h)return null;try{var p=JSON.parse(h);if(p){for(a=0;a<p.length;a++)if(Array.isArray(p[a])){var v=p[a];if(!(2>v.length)){var M=v[1];if(Array.isArray(M)&&!(1>M.length)){var U=M[0];if(U!="noop"&&U!="stop"&&U!="close")for(var Q=1;Q<M.length;Q++)M[Q]=""}}}}return hu(p)}catch{return h}}var Ma={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},$p={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},gu;function Oa(){}N(Oa,fu),Oa.prototype.g=function(){return new XMLHttpRequest},Oa.prototype.i=function(){return{}},gu=new Oa;function yr(a,h,p,v){this.j=a,this.i=h,this.l=p,this.R=v||1,this.U=new mr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Bp}function Bp(){this.i=null,this.g="",this.h=!1}var zp={},yu={};function vu(a,h,p){a.L=1,a.v=Fa(Wn(h)),a.m=p,a.P=!0,Wp(a,null)}function Wp(a,h){a.F=Date.now(),La(a),a.A=Wn(a.v);var p=a.A,v=a.R;Array.isArray(v)||(v=[String(v)]),sm(p.i,"t",v),a.C=0,p=a.j.J,a.h=new Bp,a.g=xm(a.j,p?h:null,!a.m),0<a.O&&(a.M=new $s(y(a.Y,a,a.g),a.O)),h=a.U,p=a.g,v=a.ca;var M="readystatechange";Array.isArray(M)||(M&&(gr[0]=M.toString()),M=gr);for(var U=0;U<M.length;U++){var Q=Wt(p,M[U],v||h.handleEvent,!1,h.h||h);if(!Q)break;h.g[Q.key]=Q}h=a.H?g(a.H):{},a.m?(a.u||(a.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,h)):(a.u="GET",a.g.ea(a.A,a.u,null,h)),Gi(),XE(a.i,a.u,a.A,a.l,a.R,a.m)}yr.prototype.ca=function(a){a=a.target;const h=this.M;h&&Hn(a)==3?h.j():this.Y(a)},yr.prototype.Y=function(a){try{if(a==this.g)e:{const wt=Hn(this.g);var h=this.g.Ba();const Hs=this.g.Z();if(!(3>wt)&&(wt!=3||this.g&&(this.h.h||this.g.oa()||dm(this.g)))){this.J||wt!=4||h==7||(h==8||0>=Hs?Gi(3):Gi(2)),_u(this);var p=this.g.Z();this.X=p;t:if(Hp(this)){var v=dm(this.g);a="";var M=v.length,U=Hn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){as(this),Yi(this);var Q="";break t}this.h.i=new l.TextDecoder}for(h=0;h<M;h++)this.h.h=!0,a+=this.h.i.decode(v[h],{stream:!(U&&h==M-1)});v.length=0,this.h.g+=a,this.C=0,Q=this.h.g}else Q=this.g.oa();if(this.o=p==200,JE(this.i,this.u,this.A,this.l,this.R,wt,p),this.o){if(this.T&&!this.K){t:{if(this.g){var Se,at=this.g;if((Se=at.g?at.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!w(Se)){var _e=Se;break t}}_e=null}if(p=_e)Bs(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,wu(this,p);else{this.o=!1,this.s=3,At(12),as(this),Yi(this);break e}}if(this.P){p=!0;let fn;for(;!this.J&&this.C<Q.length;)if(fn=tx(this,Q),fn==yu){wt==4&&(this.s=4,At(14),p=!1),Bs(this.i,this.l,null,"[Incomplete Response]");break}else if(fn==zp){this.s=4,At(15),Bs(this.i,this.l,Q,"[Invalid Chunk]"),p=!1;break}else Bs(this.i,this.l,fn,null),wu(this,fn);if(Hp(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),wt!=4||Q.length!=0||this.h.h||(this.s=1,At(16),p=!1),this.o=this.o&&p,!p)Bs(this.i,this.l,Q,"[Invalid Chunked Response]"),as(this),Yi(this);else if(0<Q.length&&!this.W){this.W=!0;var _t=this.j;_t.g==this&&_t.ba&&!_t.M&&(_t.j.info("Great, no buffering proxy detected. Bytes received: "+Q.length),Su(_t),_t.M=!0,At(11))}}else Bs(this.i,this.l,Q,null),wu(this,Q);wt==4&&as(this),this.o&&!this.J&&(wt==4?vm(this.j,this):(this.o=!1,La(this)))}else vx(this.g),p==400&&0<Q.indexOf("Unknown SID")?(this.s=3,At(12)):(this.s=0,At(13)),as(this),Yi(this)}}}catch{}finally{}};function Hp(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function tx(a,h){var p=a.C,v=h.indexOf(`
`,p);return v==-1?yu:(p=Number(h.substring(p,v)),isNaN(p)?zp:(v+=1,v+p>h.length?yu:(h=h.slice(v,v+p),a.C=v+p,h)))}yr.prototype.cancel=function(){this.J=!0,as(this)};function La(a){a.S=Date.now()+a.I,qp(a,a.I)}function qp(a,h){if(a.B!=null)throw Error("WatchDog timer not null");a.B=Ki(y(a.ba,a),h)}function _u(a){a.B&&(l.clearTimeout(a.B),a.B=null)}yr.prototype.ba=function(){this.B=null;const a=Date.now();0<=a-this.S?(ZE(this.i,this.A),this.L!=2&&(Gi(),At(17)),as(this),this.s=2,Yi(this)):qp(this,this.S-a)};function Yi(a){a.j.G==0||a.J||vm(a.j,a)}function as(a){_u(a);var h=a.M;h&&typeof h.ma=="function"&&h.ma(),a.M=null,Dp(a.U),a.g&&(h=a.g,a.g=null,h.abort(),h.ma())}function wu(a,h){try{var p=a.j;if(p.G!=0&&(p.g==a||Eu(p.h,a))){if(!a.K&&Eu(p.h,a)&&p.G==3){try{var v=p.Da.g.parse(h)}catch{v=null}if(Array.isArray(v)&&v.length==3){var M=v;if(M[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<a.F)qa(p),Wa(p);else break e;Iu(p),At(18)}}else p.za=M[1],0<p.za-p.T&&37500>M[2]&&p.F&&p.v==0&&!p.C&&(p.C=Ki(y(p.Za,p),6e3));if(1>=Qp(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else cs(p,11)}else if((a.K||p.g==a)&&qa(p),!w(h))for(M=p.Da.g.parse(h),h=0;h<M.length;h++){let _e=M[h];if(p.T=_e[0],_e=_e[1],p.G==2)if(_e[0]=="c"){p.K=_e[1],p.ia=_e[2];const _t=_e[3];_t!=null&&(p.la=_t,p.j.info("VER="+p.la));const wt=_e[4];wt!=null&&(p.Aa=wt,p.j.info("SVER="+p.Aa));const Hs=_e[5];Hs!=null&&typeof Hs=="number"&&0<Hs&&(v=1.5*Hs,p.L=v,p.j.info("backChannelRequestTimeoutMs_="+v)),v=p;const fn=a.g;if(fn){const Ka=fn.g?fn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ka){var U=v.h;U.g||Ka.indexOf("spdy")==-1&&Ka.indexOf("quic")==-1&&Ka.indexOf("h2")==-1||(U.j=U.l,U.g=new Set,U.h&&(xu(U,U.h),U.h=null))}if(v.D){const Cu=fn.g?fn.g.getResponseHeader("X-HTTP-Session-Id"):null;Cu&&(v.ya=Cu,Pe(v.I,v.D,Cu))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-a.F,p.j.info("Handshake RTT: "+p.R+"ms")),v=p;var Q=a;if(v.qa=Em(v,v.J?v.ia:null,v.W),Q.K){Yp(v.h,Q);var Se=Q,at=v.L;at&&(Se.I=at),Se.B&&(_u(Se),La(Se)),v.g=Q}else gm(v);0<p.i.length&&Ha(p)}else _e[0]!="stop"&&_e[0]!="close"||cs(p,7);else p.G==3&&(_e[0]=="stop"||_e[0]=="close"?_e[0]=="stop"?cs(p,7):bu(p):_e[0]!="noop"&&p.l&&p.l.ta(_e),p.v=0)}}Gi(4)}catch{}}var nx=class{constructor(a,h){this.g=a,this.map=h}};function Gp(a){this.l=a||10,l.PerformanceNavigationTiming?(a=l.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Kp(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Qp(a){return a.h?1:a.g?a.g.size:0}function Eu(a,h){return a.h?a.h==h:a.g?a.g.has(h):!1}function xu(a,h){a.g?a.g.add(h):a.h=h}function Yp(a,h){a.h&&a.h==h?a.h=null:a.g&&a.g.has(h)&&a.g.delete(h)}Gp.prototype.cancel=function(){if(this.i=Xp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const a of this.g.values())a.cancel();this.g.clear()}};function Xp(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let h=a.i;for(const p of a.g.values())h=h.concat(p.D);return h}return j(a.i)}function rx(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(c(a)){for(var h=[],p=a.length,v=0;v<p;v++)h.push(a[v]);return h}h=[],p=0;for(v in a)h[p++]=a[v];return h}function sx(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(c(a)||typeof a=="string"){var h=[];a=a.length;for(var p=0;p<a;p++)h.push(p);return h}h=[],p=0;for(const v in a)h[p++]=v;return h}}}function Jp(a,h){if(a.forEach&&typeof a.forEach=="function")a.forEach(h,void 0);else if(c(a)||typeof a=="string")Array.prototype.forEach.call(a,h,void 0);else for(var p=sx(a),v=rx(a),M=v.length,U=0;U<M;U++)h.call(void 0,v[U],p&&p[U],a)}var Zp=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ix(a,h){if(a){a=a.split("&");for(var p=0;p<a.length;p++){var v=a[p].indexOf("="),M=null;if(0<=v){var U=a[p].substring(0,v);M=a[p].substring(v+1)}else U=a[p];h(U,M?decodeURIComponent(M.replace(/\+/g," ")):"")}}}function ls(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof ls){this.h=a.h,Va(this,a.j),this.o=a.o,this.g=a.g,Ua(this,a.s),this.l=a.l;var h=a.i,p=new Zi;p.i=h.i,h.g&&(p.g=new Map(h.g),p.h=h.h),em(this,p),this.m=a.m}else a&&(h=String(a).match(Zp))?(this.h=!1,Va(this,h[1]||"",!0),this.o=Xi(h[2]||""),this.g=Xi(h[3]||"",!0),Ua(this,h[4]),this.l=Xi(h[5]||"",!0),em(this,h[6]||"",!0),this.m=Xi(h[7]||"")):(this.h=!1,this.i=new Zi(null,this.h))}ls.prototype.toString=function(){var a=[],h=this.j;h&&a.push(Ji(h,tm,!0),":");var p=this.g;return(p||h=="file")&&(a.push("//"),(h=this.o)&&a.push(Ji(h,tm,!0),"@"),a.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&a.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&a.push("/"),a.push(Ji(p,p.charAt(0)=="/"?lx:ax,!0))),(p=this.i.toString())&&a.push("?",p),(p=this.m)&&a.push("#",Ji(p,ux)),a.join("")};function Wn(a){return new ls(a)}function Va(a,h,p){a.j=p?Xi(h,!0):h,a.j&&(a.j=a.j.replace(/:$/,""))}function Ua(a,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);a.s=h}else a.s=null}function em(a,h,p){h instanceof Zi?(a.i=h,dx(a.i,a.h)):(p||(h=Ji(h,cx)),a.i=new Zi(h,a.h))}function Pe(a,h,p){a.i.set(h,p)}function Fa(a){return Pe(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Xi(a,h){return a?h?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Ji(a,h,p){return typeof a=="string"?(a=encodeURI(a).replace(h,ox),p&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function ox(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var tm=/[#\/\?@]/g,ax=/[#\?:]/g,lx=/[#\?]/g,cx=/[#\?@]/g,ux=/#/g;function Zi(a,h){this.h=this.g=null,this.i=a||null,this.j=!!h}function vr(a){a.g||(a.g=new Map,a.h=0,a.i&&ix(a.i,function(h,p){a.add(decodeURIComponent(h.replace(/\+/g," ")),p)}))}t=Zi.prototype,t.add=function(a,h){vr(this),this.i=null,a=zs(this,a);var p=this.g.get(a);return p||this.g.set(a,p=[]),p.push(h),this.h+=1,this};function nm(a,h){vr(a),h=zs(a,h),a.g.has(h)&&(a.i=null,a.h-=a.g.get(h).length,a.g.delete(h))}function rm(a,h){return vr(a),h=zs(a,h),a.g.has(h)}t.forEach=function(a,h){vr(this),this.g.forEach(function(p,v){p.forEach(function(M){a.call(h,M,v,this)},this)},this)},t.na=function(){vr(this);const a=Array.from(this.g.values()),h=Array.from(this.g.keys()),p=[];for(let v=0;v<h.length;v++){const M=a[v];for(let U=0;U<M.length;U++)p.push(h[v])}return p},t.V=function(a){vr(this);let h=[];if(typeof a=="string")rm(this,a)&&(h=h.concat(this.g.get(zs(this,a))));else{a=Array.from(this.g.values());for(let p=0;p<a.length;p++)h=h.concat(a[p])}return h},t.set=function(a,h){return vr(this),this.i=null,a=zs(this,a),rm(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[h]),this.h+=1,this},t.get=function(a,h){return a?(a=this.V(a),0<a.length?String(a[0]):h):h};function sm(a,h,p){nm(a,h),0<p.length&&(a.i=null,a.g.set(zs(a,h),j(p)),a.h+=p.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],h=Array.from(this.g.keys());for(var p=0;p<h.length;p++){var v=h[p];const U=encodeURIComponent(String(v)),Q=this.V(v);for(v=0;v<Q.length;v++){var M=U;Q[v]!==""&&(M+="="+encodeURIComponent(String(Q[v]))),a.push(M)}}return this.i=a.join("&")};function zs(a,h){return h=String(h),a.j&&(h=h.toLowerCase()),h}function dx(a,h){h&&!a.j&&(vr(a),a.i=null,a.g.forEach(function(p,v){var M=v.toLowerCase();v!=M&&(nm(this,v),sm(this,M,p))},a)),a.j=h}function hx(a,h){const p=new Qi;if(l.Image){const v=new Image;v.onload=I(_r,p,"TestLoadImage: loaded",!0,h,v),v.onerror=I(_r,p,"TestLoadImage: error",!1,h,v),v.onabort=I(_r,p,"TestLoadImage: abort",!1,h,v),v.ontimeout=I(_r,p,"TestLoadImage: timeout",!1,h,v),l.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=a}else h(!1)}function fx(a,h){const p=new Qi,v=new AbortController,M=setTimeout(()=>{v.abort(),_r(p,"TestPingServer: timeout",!1,h)},1e4);fetch(a,{signal:v.signal}).then(U=>{clearTimeout(M),U.ok?_r(p,"TestPingServer: ok",!0,h):_r(p,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(M),_r(p,"TestPingServer: error",!1,h)})}function _r(a,h,p,v,M){try{M&&(M.onload=null,M.onerror=null,M.onabort=null,M.ontimeout=null),v(p)}catch{}}function px(){this.g=new YE}function mx(a,h,p){const v=p||"";try{Jp(a,function(M,U){let Q=M;d(M)&&(Q=hu(M)),h.push(v+U+"="+encodeURIComponent(Q))})}catch(M){throw h.push(v+"type="+encodeURIComponent("_badmap")),M}}function $a(a){this.l=a.Ub||null,this.j=a.eb||!1}N($a,fu),$a.prototype.g=function(){return new Ba(this.l,this.j)},$a.prototype.i=function(a){return function(){return a}}({});function Ba(a,h){ue.call(this),this.D=a,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}N(Ba,ue),t=Ba.prototype,t.open=function(a,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=h,this.readyState=1,to(this)},t.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(h.body=a),(this.D||l).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,eo(this)),this.readyState=0},t.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,to(this)),this.g&&(this.readyState=3,to(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;im(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function im(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}t.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var h=a.value?a.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!a.done}))&&(this.response=this.responseText+=h)}a.done?eo(this):to(this),this.readyState==3&&im(this)}},t.Ra=function(a){this.g&&(this.response=this.responseText=a,eo(this))},t.Qa=function(a){this.g&&(this.response=a,eo(this))},t.ga=function(){this.g&&eo(this)};function eo(a){a.readyState=4,a.l=null,a.j=null,a.v=null,to(a)}t.setRequestHeader=function(a,h){this.u.append(a,h)},t.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],h=this.h.entries();for(var p=h.next();!p.done;)p=p.value,a.push(p[0]+": "+p[1]),p=h.next();return a.join(`\r
`)};function to(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Ba.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function om(a){let h="";return V(a,function(p,v){h+=v,h+=":",h+=p,h+=`\r
`}),h}function Tu(a,h,p){e:{for(v in p){var v=!1;break e}v=!0}v||(p=om(p),typeof a=="string"?p!=null&&encodeURIComponent(String(p)):Pe(a,h,p))}function Ue(a){ue.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}N(Ue,ue);var gx=/^https?$/i,yx=["POST","PUT"];t=Ue.prototype,t.Ha=function(a){this.J=a},t.ea=function(a,h,p,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);h=h?h.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():gu.g(),this.v=this.o?Mp(this.o):Mp(gu),this.g.onreadystatechange=y(this.Ea,this);try{this.B=!0,this.g.open(h,String(a),!0),this.B=!1}catch(U){am(this,U);return}if(a=p||"",p=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var M in v)p.set(M,v[M]);else if(typeof v.keys=="function"&&typeof v.get=="function")for(const U of v.keys())p.set(U,v.get(U));else throw Error("Unknown input type for opt_headers: "+String(v));v=Array.from(p.keys()).find(U=>U.toLowerCase()=="content-type"),M=l.FormData&&a instanceof l.FormData,!(0<=Array.prototype.indexOf.call(yx,h,void 0))||v||M||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[U,Q]of p)this.g.setRequestHeader(U,Q);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{um(this),this.u=!0,this.g.send(a),this.u=!1}catch(U){am(this,U)}};function am(a,h){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=h,a.m=5,lm(a),za(a)}function lm(a){a.A||(a.A=!0,pe(a,"complete"),pe(a,"error"))}t.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,pe(this,"complete"),pe(this,"abort"),za(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),za(this,!0)),Ue.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?cm(this):this.bb())},t.bb=function(){cm(this)};function cm(a){if(a.h&&typeof o<"u"&&(!a.v[1]||Hn(a)!=4||a.Z()!=2)){if(a.u&&Hn(a)==4)dn(a.Ea,0,a);else if(pe(a,"readystatechange"),Hn(a)==4){a.h=!1;try{const Q=a.Z();e:switch(Q){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var p;if(!(p=h)){var v;if(v=Q===0){var M=String(a.D).match(Zp)[1]||null;!M&&l.self&&l.self.location&&(M=l.self.location.protocol.slice(0,-1)),v=!gx.test(M?M.toLowerCase():"")}p=v}if(p)pe(a,"complete"),pe(a,"success");else{a.m=6;try{var U=2<Hn(a)?a.g.statusText:""}catch{U=""}a.l=U+" ["+a.Z()+"]",lm(a)}}finally{za(a)}}}}function za(a,h){if(a.g){um(a);const p=a.g,v=a.v[0]?()=>{}:null;a.g=null,a.v=null,h||pe(a,"ready");try{p.onreadystatechange=v}catch{}}}function um(a){a.I&&(l.clearTimeout(a.I),a.I=null)}t.isActive=function(){return!!this.g};function Hn(a){return a.g?a.g.readyState:0}t.Z=function(){try{return 2<Hn(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(a){if(this.g){var h=this.g.responseText;return a&&h.indexOf(a)==0&&(h=h.substring(a.length)),QE(h)}};function dm(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function vx(a){const h={};a=(a.g&&2<=Hn(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let v=0;v<a.length;v++){if(w(a[v]))continue;var p=C(a[v]);const M=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();const U=h[M]||[];h[M]=U,U.push(p)}_(h,function(v){return v.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function no(a,h,p){return p&&p.internalChannelParams&&p.internalChannelParams[a]||h}function hm(a){this.Aa=0,this.i=[],this.j=new Qi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=no("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=no("baseRetryDelayMs",5e3,a),this.cb=no("retryDelaySeedMs",1e4,a),this.Wa=no("forwardChannelMaxRetries",2,a),this.wa=no("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new Gp(a&&a.concurrentRequestLimit),this.Da=new px,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=hm.prototype,t.la=8,t.G=1,t.connect=function(a,h,p,v){At(0),this.W=a,this.H=h||{},p&&v!==void 0&&(this.H.OSID=p,this.H.OAID=v),this.F=this.X,this.I=Em(this,null,this.W),Ha(this)};function bu(a){if(fm(a),a.G==3){var h=a.U++,p=Wn(a.I);if(Pe(p,"SID",a.K),Pe(p,"RID",h),Pe(p,"TYPE","terminate"),ro(a,p),h=new yr(a,a.j,h),h.L=2,h.v=Fa(Wn(p)),p=!1,l.navigator&&l.navigator.sendBeacon)try{p=l.navigator.sendBeacon(h.v.toString(),"")}catch{}!p&&l.Image&&(new Image().src=h.v,p=!0),p||(h.g=xm(h.j,null),h.g.ea(h.v)),h.F=Date.now(),La(h)}wm(a)}function Wa(a){a.g&&(Su(a),a.g.cancel(),a.g=null)}function fm(a){Wa(a),a.u&&(l.clearTimeout(a.u),a.u=null),qa(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&l.clearTimeout(a.s),a.s=null)}function Ha(a){if(!Kp(a.h)&&!a.s){a.s=!0;var h=a.Ga;Ve||ie(),K||(Ve(),K=!0),se.add(h,a),a.B=0}}function _x(a,h){return Qp(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=h.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=Ki(y(a.Ga,a,h),_m(a,a.B)),a.B++,!0)}t.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;const M=new yr(this,this.j,a);let U=this.o;if(this.S&&(U?(U=g(U),x(U,this.S)):U=this.S),this.m!==null||this.O||(M.H=U,U=null),this.P)e:{for(var h=0,p=0;p<this.i.length;p++){t:{var v=this.i[p];if("__data__"in v.map&&(v=v.map.__data__,typeof v=="string")){v=v.length;break t}v=void 0}if(v===void 0)break;if(h+=v,4096<h){h=p;break e}if(h===4096||p===this.i.length-1){h=p+1;break e}}h=1e3}else h=1e3;h=mm(this,M,h),p=Wn(this.I),Pe(p,"RID",a),Pe(p,"CVER",22),this.D&&Pe(p,"X-HTTP-Session-Id",this.D),ro(this,p),U&&(this.O?h="headers="+encodeURIComponent(String(om(U)))+"&"+h:this.m&&Tu(p,this.m,U)),xu(this.h,M),this.Ua&&Pe(p,"TYPE","init"),this.P?(Pe(p,"$req",h),Pe(p,"SID","null"),M.T=!0,vu(M,p,null)):vu(M,p,h),this.G=2}}else this.G==3&&(a?pm(this,a):this.i.length==0||Kp(this.h)||pm(this))};function pm(a,h){var p;h?p=h.l:p=a.U++;const v=Wn(a.I);Pe(v,"SID",a.K),Pe(v,"RID",p),Pe(v,"AID",a.T),ro(a,v),a.m&&a.o&&Tu(v,a.m,a.o),p=new yr(a,a.j,p,a.B+1),a.m===null&&(p.H=a.o),h&&(a.i=h.D.concat(a.i)),h=mm(a,p,1e3),p.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),xu(a.h,p),vu(p,v,h)}function ro(a,h){a.H&&V(a.H,function(p,v){Pe(h,v,p)}),a.l&&Jp({},function(p,v){Pe(h,v,p)})}function mm(a,h,p){p=Math.min(a.i.length,p);var v=a.l?y(a.l.Na,a.l,a):null;e:{var M=a.i;let U=-1;for(;;){const Q=["count="+p];U==-1?0<p?(U=M[0].g,Q.push("ofs="+U)):U=0:Q.push("ofs="+U);let Se=!0;for(let at=0;at<p;at++){let _e=M[at].g;const _t=M[at].map;if(_e-=U,0>_e)U=Math.max(0,M[at].g-100),Se=!1;else try{mx(_t,Q,"req"+_e+"_")}catch{v&&v(_t)}}if(Se){v=Q.join("&");break e}}}return a=a.i.splice(0,p),h.D=a,v}function gm(a){if(!a.g&&!a.u){a.Y=1;var h=a.Fa;Ve||ie(),K||(Ve(),K=!0),se.add(h,a),a.v=0}}function Iu(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=Ki(y(a.Fa,a),_m(a,a.v)),a.v++,!0)}t.Fa=function(){if(this.u=null,ym(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Ki(y(this.ab,this),a)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,At(10),Wa(this),ym(this))};function Su(a){a.A!=null&&(l.clearTimeout(a.A),a.A=null)}function ym(a){a.g=new yr(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var h=Wn(a.qa);Pe(h,"RID","rpc"),Pe(h,"SID",a.K),Pe(h,"AID",a.T),Pe(h,"CI",a.F?"0":"1"),!a.F&&a.ja&&Pe(h,"TO",a.ja),Pe(h,"TYPE","xmlhttp"),ro(a,h),a.m&&a.o&&Tu(h,a.m,a.o),a.L&&(a.g.I=a.L);var p=a.g;a=a.ia,p.L=1,p.v=Fa(Wn(h)),p.m=null,p.P=!0,Wp(p,a)}t.Za=function(){this.C!=null&&(this.C=null,Wa(this),Iu(this),At(19))};function qa(a){a.C!=null&&(l.clearTimeout(a.C),a.C=null)}function vm(a,h){var p=null;if(a.g==h){qa(a),Su(a),a.g=null;var v=2}else if(Eu(a.h,h))p=h.D,Yp(a.h,h),v=1;else return;if(a.G!=0){if(h.o)if(v==1){p=h.m?h.m.length:0,h=Date.now()-h.F;var M=a.B;v=Da(),pe(v,new Fp(v,p)),Ha(a)}else gm(a);else if(M=h.s,M==3||M==0&&0<h.X||!(v==1&&_x(a,h)||v==2&&Iu(a)))switch(p&&0<p.length&&(h=a.h,h.i=h.i.concat(p)),M){case 1:cs(a,5);break;case 4:cs(a,10);break;case 3:cs(a,6);break;default:cs(a,2)}}}function _m(a,h){let p=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(p*=2),p*h}function cs(a,h){if(a.j.info("Error code "+h),h==2){var p=y(a.fb,a),v=a.Xa;const M=!v;v=new ls(v||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Va(v,"https"),Fa(v),M?hx(v.toString(),p):fx(v.toString(),p)}else At(2);a.G=0,a.l&&a.l.sa(h),wm(a),fm(a)}t.fb=function(a){a?(this.j.info("Successfully pinged google.com"),At(2)):(this.j.info("Failed to ping google.com"),At(1))};function wm(a){if(a.G=0,a.ka=[],a.l){const h=Xp(a.h);(h.length!=0||a.i.length!=0)&&(A(a.ka,h),A(a.ka,a.i),a.h.i.length=0,j(a.i),a.i.length=0),a.l.ra()}}function Em(a,h,p){var v=p instanceof ls?Wn(p):new ls(p);if(v.g!="")h&&(v.g=h+"."+v.g),Ua(v,v.s);else{var M=l.location;v=M.protocol,h=h?h+"."+M.hostname:M.hostname,M=+M.port;var U=new ls(null);v&&Va(U,v),h&&(U.g=h),M&&Ua(U,M),p&&(U.l=p),v=U}return p=a.D,h=a.ya,p&&h&&Pe(v,p,h),Pe(v,"VER",a.la),ro(a,v),v}function xm(a,h,p){if(h&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=a.Ca&&!a.pa?new Ue(new $a({eb:p})):new Ue(a.pa),h.Ha(a.J),h}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Tm(){}t=Tm.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function Ga(){}Ga.prototype.g=function(a,h){return new Ht(a,h)};function Ht(a,h){ue.call(this),this.g=new hm(h),this.l=a,this.h=h&&h.messageUrlParams||null,a=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(a?a["X-WebChannel-Content-Type"]=h.messageContentType:a={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(a?a["X-WebChannel-Client-Profile"]=h.va:a={"X-WebChannel-Client-Profile":h.va}),this.g.S=a,(a=h&&h.Sb)&&!w(a)&&(this.g.m=a),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!w(h)&&(this.g.D=h,a=this.h,a!==null&&h in a&&(a=this.h,h in a&&delete a[h])),this.j=new Ws(this)}N(Ht,ue),Ht.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ht.prototype.close=function(){bu(this.g)},Ht.prototype.o=function(a){var h=this.g;if(typeof a=="string"){var p={};p.__data__=a,a=p}else this.u&&(p={},p.__data__=hu(a),a=p);h.i.push(new nx(h.Ya++,a)),h.G==3&&Ha(h)},Ht.prototype.N=function(){this.g.l=null,delete this.j,bu(this.g),delete this.g,Ht.aa.N.call(this)};function bm(a){pu.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var h=a.__sm__;if(h){e:{for(const p in h){a=p;break e}a=void 0}(this.i=a)&&(a=this.i,h=h!==null&&a in h?h[a]:void 0),this.data=h}else this.data=a}N(bm,pu);function Im(){mu.call(this),this.status=1}N(Im,mu);function Ws(a){this.g=a}N(Ws,Tm),Ws.prototype.ua=function(){pe(this.g,"a")},Ws.prototype.ta=function(a){pe(this.g,new bm(a))},Ws.prototype.sa=function(a){pe(this.g,new Im)},Ws.prototype.ra=function(){pe(this.g,"b")},Ga.prototype.createWebChannel=Ga.prototype.g,Ht.prototype.send=Ht.prototype.o,Ht.prototype.open=Ht.prototype.m,Ht.prototype.close=Ht.prototype.close,Nw=function(){return new Ga},Pw=function(){return Da()},Cw=os,wh={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ma.NO_ERROR=0,Ma.TIMEOUT=8,Ma.HTTP_ERROR=6,jl=Ma,$p.COMPLETE="complete",Sw=$p,Op.EventType=qi,qi.OPEN="a",qi.CLOSE="b",qi.ERROR="c",qi.MESSAGE="d",ue.prototype.listen=ue.prototype.K,wo=Op,Ue.prototype.listenOnce=Ue.prototype.L,Ue.prototype.getLastError=Ue.prototype.Ka,Ue.prototype.getLastErrorCode=Ue.prototype.Ba,Ue.prototype.getStatus=Ue.prototype.Z,Ue.prototype.getResponseJson=Ue.prototype.Oa,Ue.prototype.getResponseText=Ue.prototype.oa,Ue.prototype.send=Ue.prototype.ea,Ue.prototype.setWithCredentials=Ue.prototype.Ha,Iw=Ue}).apply(typeof fl<"u"?fl:typeof self<"u"?self:typeof window<"u"?window:{});const _y="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}bt.UNAUTHENTICATED=new bt(null),bt.GOOGLE_CREDENTIALS=new bt("google-credentials-uid"),bt.FIRST_PARTY=new bt("first-party-uid"),bt.MOCK_USER=new bt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bi="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ns=new Df("@firebase/firestore");function fo(){return Ns.logLevel}function Z(t,...e){if(Ns.logLevel<=fe.DEBUG){const n=e.map(qf);Ns.debug(`Firestore (${Bi}): ${t}`,...n)}}function cr(t,...e){if(Ns.logLevel<=fe.ERROR){const n=e.map(qf);Ns.error(`Firestore (${Bi}): ${t}`,...n)}}function Pi(t,...e){if(Ns.logLevel<=fe.WARN){const n=e.map(qf);Ns.warn(`Firestore (${Bi}): ${t}`,...n)}}function qf(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oe(t="Unexpected state"){const e=`FIRESTORE (${Bi}) INTERNAL ASSERTION FAILED: `+t;throw cr(e),new Error(e)}function Ie(t,e){t||oe()}function le(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class J extends hr{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kw{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(bt.UNAUTHENTICATED))}shutdown(){}}class GP{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class KP{constructor(e){this.t=e,this.currentUser=bt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Ie(this.o===void 0);let r=this.i;const s=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve();let i=new nr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new nr,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},l=c=>{Z("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(Z("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new nr)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(Z("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ie(typeof r.accessToken=="string"),new kw(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ie(e===null||typeof e=="string"),new bt(e)}}class QP{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=bt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class YP{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new QP(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(bt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class XP{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class JP{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){Ie(this.o===void 0);const r=i=>{i.error!=null&&Z("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,Z("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{Z("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):Z("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Ie(typeof n.token=="string"),this.R=n.token,new XP(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZP(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=ZP(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%e.length))}return r}}function we(t,e){return t<e?-1:t>e?1:0}function Ni(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ze{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new J($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new J($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new J($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new J($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ze.fromMillis(Date.now())}static fromDate(e){return Ze.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new Ze(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?we(this.nanoseconds,e.nanoseconds):we(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ae{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ae(e)}static min(){return new ae(new Ze(0,0))}static max(){return new ae(new Ze(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(e,n,r){n===void 0?n=0:n>e.length&&oe(),r===void 0?r=e.length-n:r>e.length-n&&oe(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return oa.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof oa?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=e.get(s),o=n.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class ke extends oa{construct(e,n,r){return new ke(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new J($.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new ke(n)}static emptyPath(){return new ke([])}}const eN=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ut extends oa{construct(e,n,r){return new ut(e,n,r)}static isValidIdentifier(e){return eN.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ut.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ut(["__name__"])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new J($.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new J($.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new J($.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else l==="`"?(o=!o,s++):l!=="."||o?(r+=l,s++):(i(),s++)}if(i(),o)throw new J($.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ut(n)}static emptyPath(){return new ut([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e){this.path=e}static fromPath(e){return new te(ke.fromString(e))}static fromName(e){return new te(ke.fromString(e).popFirst(5))}static empty(){return new te(ke.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ke.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return ke.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new te(new ke(e.slice()))}}function tN(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=ae.fromTimestamp(r===1e9?new Ze(n+1,0):new Ze(n,r));return new Qr(s,te.empty(),e)}function nN(t){return new Qr(t.readTime,t.key,-1)}class Qr{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Qr(ae.min(),te.empty(),-1)}static max(){return new Qr(ae.max(),te.empty(),-1)}}function rN(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=te.comparator(t.documentKey,e.documentKey),n!==0?n:we(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sN="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class iN{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ia(t){if(t.code!==$.FAILED_PRECONDITION||t.message!==sN)throw t;Z("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&oe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new B((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof B?n:B.resolve(n)}catch(n){return B.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):B.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):B.reject(n)}static resolve(e){return new B((n,r)=>{n(e)})}static reject(e){return new B((n,r)=>{r(e)})}static waitFor(e){return new B((n,r)=>{let s=0,i=0,o=!1;e.forEach(l=>{++s,l.next(()=>{++i,o&&i===s&&n()},c=>r(c))}),o=!0,i===s&&n()})}static or(e){let n=B.resolve(!1);for(const r of e)n=n.next(s=>s?B.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new B((r,s)=>{const i=e.length,o=new Array(i);let l=0;for(let c=0;c<i;c++){const d=c;n(e[d]).next(f=>{o[d]=f,++l,l===i&&r(o)},f=>s(f))}})}static doWhile(e,n){return new B((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}function oN(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Sa(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Gf.oe=-1;function Qc(t){return t==null}function vc(t){return t===0&&1/t==-1/0}function aN(t){return typeof t=="number"&&Number.isInteger(t)&&!vc(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wy(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ls(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Rw(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oe{constructor(e,n){this.comparator=e,this.root=n||ct.EMPTY}insert(e,n){return new Oe(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ct.BLACK,null,null))}remove(e){return new Oe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ct.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new pl(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new pl(this.root,e,this.comparator,!1)}getReverseIterator(){return new pl(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new pl(this.root,e,this.comparator,!0)}}class pl{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ct{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??ct.RED,this.left=s??ct.EMPTY,this.right=i??ct.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new ct(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ct.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return ct.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ct.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ct.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw oe();const e=this.left.check();if(e!==this.right.check())throw oe();return e+(this.isRed()?0:1)}}ct.EMPTY=null,ct.RED=!0,ct.BLACK=!1;ct.EMPTY=new class{constructor(){this.size=0}get key(){throw oe()}get value(){throw oe()}get color(){throw oe()}get left(){throw oe()}get right(){throw oe()}copy(e,n,r,s,i){return this}insert(e,n,r){return new ct(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e){this.comparator=e,this.data=new Oe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Ey(this.data.getIterator())}getIteratorFrom(e){return new Ey(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof ht)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new ht(this.comparator);return n.data=e,n}}class Ey{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e){this.fields=e,e.sort(ut.comparator)}static empty(){return new Kt([])}unionWith(e){let n=new ht(ut.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Kt(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Ni(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new jw("Invalid base64 string: "+i):i}}(e);return new pt(n)}static fromUint8Array(e){const n=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new pt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return we(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}pt.EMPTY_BYTE_STRING=new pt("");const lN=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Yr(t){if(Ie(!!t),typeof t=="string"){let e=0;const n=lN.exec(t);if(Ie(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Be(t.seconds),nanos:Be(t.nanos)}}function Be(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ks(t){return typeof t=="string"?pt.fromBase64String(t):pt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kf(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Qf(t){const e=t.mapValue.fields.__previous_value__;return Kf(e)?Qf(e):e}function aa(t){const e=Yr(t.mapValue.fields.__local_write_time__.timestampValue);return new Ze(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cN{constructor(e,n,r,s,i,o,l,c,d){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=d}}class la{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new la("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof la&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ml={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function As(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Kf(t)?4:dN(t)?9007199254740991:uN(t)?10:11:oe()}function Bn(t,e){if(t===e)return!0;const n=As(t);if(n!==As(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return aa(t).isEqual(aa(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Yr(s.timestampValue),l=Yr(i.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return ks(s.bytesValue).isEqual(ks(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return Be(s.geoPointValue.latitude)===Be(i.geoPointValue.latitude)&&Be(s.geoPointValue.longitude)===Be(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Be(s.integerValue)===Be(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Be(s.doubleValue),l=Be(i.doubleValue);return o===l?vc(o)===vc(l):isNaN(o)&&isNaN(l)}return!1}(t,e);case 9:return Ni(t.arrayValue.values||[],e.arrayValue.values||[],Bn);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},l=i.mapValue.fields||{};if(wy(o)!==wy(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!Bn(o[c],l[c])))return!1;return!0}(t,e);default:return oe()}}function ca(t,e){return(t.values||[]).find(n=>Bn(n,e))!==void 0}function ki(t,e){if(t===e)return 0;const n=As(t),r=As(e);if(n!==r)return we(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return we(t.booleanValue,e.booleanValue);case 2:return function(i,o){const l=Be(i.integerValue||i.doubleValue),c=Be(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(t,e);case 3:return xy(t.timestampValue,e.timestampValue);case 4:return xy(aa(t),aa(e));case 5:return we(t.stringValue,e.stringValue);case 6:return function(i,o){const l=ks(i),c=ks(o);return l.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(i,o){const l=i.split("/"),c=o.split("/");for(let d=0;d<l.length&&d<c.length;d++){const f=we(l[d],c[d]);if(f!==0)return f}return we(l.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,o){const l=we(Be(i.latitude),Be(o.latitude));return l!==0?l:we(Be(i.longitude),Be(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Ty(t.arrayValue,e.arrayValue);case 10:return function(i,o){var l,c,d,f;const m=i.fields||{},y=o.fields||{},I=(l=m.value)===null||l===void 0?void 0:l.arrayValue,N=(c=y.value)===null||c===void 0?void 0:c.arrayValue,j=we(((d=I==null?void 0:I.values)===null||d===void 0?void 0:d.length)||0,((f=N==null?void 0:N.values)===null||f===void 0?void 0:f.length)||0);return j!==0?j:Ty(I,N)}(t.mapValue,e.mapValue);case 11:return function(i,o){if(i===ml.mapValue&&o===ml.mapValue)return 0;if(i===ml.mapValue)return 1;if(o===ml.mapValue)return-1;const l=i.fields||{},c=Object.keys(l),d=o.fields||{},f=Object.keys(d);c.sort(),f.sort();for(let m=0;m<c.length&&m<f.length;++m){const y=we(c[m],f[m]);if(y!==0)return y;const I=ki(l[c[m]],d[f[m]]);if(I!==0)return I}return we(c.length,f.length)}(t.mapValue,e.mapValue);default:throw oe()}}function xy(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return we(t,e);const n=Yr(t),r=Yr(e),s=we(n.seconds,r.seconds);return s!==0?s:we(n.nanos,r.nanos)}function Ty(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=ki(n[s],r[s]);if(i)return i}return we(n.length,r.length)}function Ai(t){return Eh(t)}function Eh(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=Yr(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return ks(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return te.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=Eh(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Eh(n.fields[o])}`;return s+"}"}(t.mapValue):oe()}function by(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function xh(t){return!!t&&"integerValue"in t}function Yf(t){return!!t&&"arrayValue"in t}function Iy(t){return!!t&&"nullValue"in t}function Sy(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Dl(t){return!!t&&"mapValue"in t}function uN(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function Do(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ls(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Do(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Do(t.arrayValue.values[n]);return e}return Object.assign({},t)}function dN(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e){this.value=e}static empty(){return new Ut({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Dl(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Do(n)}setAll(e){let n=ut.emptyPath(),r={},s=[];e.forEach((o,l)=>{if(!n.isImmediateParentOf(l)){const c=this.getFieldsMap(n);this.applyChanges(c,r,s),r={},s=[],n=l.popLast()}o?r[l.lastSegment()]=Do(o):s.push(l.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());Dl(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Bn(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Dl(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Ls(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Ut(Do(this.value))}}function Dw(t){const e=[];return Ls(t.fields,(n,r)=>{const s=new ut([n]);if(Dl(r)){const i=Dw(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Kt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(e,n,r,s,i,o,l){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=l}static newInvalidDocument(e){return new St(e,0,ae.min(),ae.min(),ae.min(),Ut.empty(),0)}static newFoundDocument(e,n,r,s){return new St(e,1,n,ae.min(),r,s,0)}static newNoDocument(e,n){return new St(e,2,n,ae.min(),ae.min(),Ut.empty(),0)}static newUnknownDocument(e,n){return new St(e,3,n,ae.min(),ae.min(),Ut.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(ae.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ut.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ut.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ae.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof St&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new St(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{constructor(e,n){this.position=e,this.inclusive=n}}function Cy(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(i.field.isKeyField()?r=te.comparator(te.fromName(o.referenceValue),n.key):r=ki(o,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Py(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Bn(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(e,n="asc"){this.field=e,this.dir=n}}function hN(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mw{}class qe extends Mw{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new pN(e,n,r):n==="array-contains"?new yN(e,r):n==="in"?new vN(e,r):n==="not-in"?new _N(e,r):n==="array-contains-any"?new wN(e,r):new qe(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new mN(e,r):new gN(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(ki(n,this.value)):n!==null&&As(this.value)===As(n)&&this.matchesComparison(ki(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return oe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class bn extends Mw{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new bn(e,n)}matches(e){return Ow(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ow(t){return t.op==="and"}function Lw(t){return fN(t)&&Ow(t)}function fN(t){for(const e of t.filters)if(e instanceof bn)return!1;return!0}function Th(t){if(t instanceof qe)return t.field.canonicalString()+t.op.toString()+Ai(t.value);if(Lw(t))return t.filters.map(e=>Th(e)).join(",");{const e=t.filters.map(n=>Th(n)).join(",");return`${t.op}(${e})`}}function Vw(t,e){return t instanceof qe?function(r,s){return s instanceof qe&&r.op===s.op&&r.field.isEqual(s.field)&&Bn(r.value,s.value)}(t,e):t instanceof bn?function(r,s){return s instanceof bn&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,l)=>i&&Vw(o,s.filters[l]),!0):!1}(t,e):void oe()}function Uw(t){return t instanceof qe?function(n){return`${n.field.canonicalString()} ${n.op} ${Ai(n.value)}`}(t):t instanceof bn?function(n){return n.op.toString()+" {"+n.getFilters().map(Uw).join(" ,")+"}"}(t):"Filter"}class pN extends qe{constructor(e,n,r){super(e,n,r),this.key=te.fromName(r.referenceValue)}matches(e){const n=te.comparator(e.key,this.key);return this.matchesComparison(n)}}class mN extends qe{constructor(e,n){super(e,"in",n),this.keys=Fw("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class gN extends qe{constructor(e,n){super(e,"not-in",n),this.keys=Fw("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function Fw(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>te.fromName(r.referenceValue))}class yN extends qe{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Yf(n)&&ca(n.arrayValue,this.value)}}class vN extends qe{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&ca(this.value.arrayValue,n)}}class _N extends qe{constructor(e,n){super(e,"not-in",n)}matches(e){if(ca(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!ca(this.value.arrayValue,n)}}class wN extends qe{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Yf(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>ca(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EN{constructor(e,n=null,r=[],s=[],i=null,o=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=l,this.ue=null}}function Ny(t,e=null,n=[],r=[],s=null,i=null,o=null){return new EN(t,e,n,r,s,i,o)}function Xf(t){const e=le(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>Th(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Qc(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Ai(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Ai(r)).join(",")),e.ue=n}return e.ue}function Jf(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!hN(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Vw(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Py(t.startAt,e.startAt)&&Py(t.endAt,e.endAt)}function bh(t){return te.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca{constructor(e,n=null,r=[],s=[],i=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=l,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function xN(t,e,n,r,s,i,o,l){return new Ca(t,e,n,r,s,i,o,l)}function Yc(t){return new Ca(t)}function ky(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function $w(t){return t.collectionGroup!==null}function Mo(t){const e=le(t);if(e.ce===null){e.ce=[];const n=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new ht(ut.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.ce.push(new wc(i,r))}),n.has(ut.keyField().canonicalString())||e.ce.push(new wc(ut.keyField(),r))}return e.ce}function Fn(t){const e=le(t);return e.le||(e.le=TN(e,Mo(t))),e.le}function TN(t,e){if(t.limitType==="F")return Ny(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new wc(s.field,i)});const n=t.endAt?new _c(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new _c(t.startAt.position,t.startAt.inclusive):null;return Ny(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Ih(t,e){const n=t.filters.concat([e]);return new Ca(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Sh(t,e,n){return new Ca(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Xc(t,e){return Jf(Fn(t),Fn(e))&&t.limitType===e.limitType}function Bw(t){return`${Xf(Fn(t))}|lt:${t.limitType}`}function Ks(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>Uw(s)).join(", ")}]`),Qc(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Ai(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Ai(s)).join(",")),`Target(${r})`}(Fn(t))}; limitType=${t.limitType})`}function Jc(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):te.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of Mo(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(o,l,c){const d=Cy(o,l,c);return o.inclusive?d<=0:d<0}(r.startAt,Mo(r),s)||r.endAt&&!function(o,l,c){const d=Cy(o,l,c);return o.inclusive?d>=0:d>0}(r.endAt,Mo(r),s))}(t,e)}function bN(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function zw(t){return(e,n)=>{let r=!1;for(const s of Mo(t)){const i=IN(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function IN(t,e,n){const r=t.field.isKeyField()?te.comparator(e.key,n.key):function(i,o,l){const c=o.data.field(i),d=l.data.field(i);return c!==null&&d!==null?ki(c,d):oe()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return oe()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ls(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Rw(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SN=new Oe(te.comparator);function ur(){return SN}const Ww=new Oe(te.comparator);function Eo(...t){let e=Ww;for(const n of t)e=e.insert(n.key,n);return e}function Hw(t){let e=Ww;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function ys(){return Oo()}function qw(){return Oo()}function Oo(){return new zi(t=>t.toString(),(t,e)=>t.isEqual(e))}const CN=new Oe(te.comparator),PN=new ht(te.comparator);function he(...t){let e=PN;for(const n of t)e=e.add(n);return e}const NN=new ht(we);function kN(){return NN}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zf(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vc(e)?"-0":e}}function Gw(t){return{integerValue:""+t}}function AN(t,e){return aN(e)?Gw(e):Zf(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc{constructor(){this._=void 0}}function RN(t,e,n){return t instanceof ua?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Kf(i)&&(i=Qf(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(n,e):t instanceof da?Qw(t,e):t instanceof ha?Yw(t,e):function(s,i){const o=Kw(s,i),l=Ay(o)+Ay(s.Pe);return xh(o)&&xh(s.Pe)?Gw(l):Zf(s.serializer,l)}(t,e)}function jN(t,e,n){return t instanceof da?Qw(t,e):t instanceof ha?Yw(t,e):n}function Kw(t,e){return t instanceof Ec?function(r){return xh(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class ua extends Zc{}class da extends Zc{constructor(e){super(),this.elements=e}}function Qw(t,e){const n=Xw(e);for(const r of t.elements)n.some(s=>Bn(s,r))||n.push(r);return{arrayValue:{values:n}}}class ha extends Zc{constructor(e){super(),this.elements=e}}function Yw(t,e){let n=Xw(e);for(const r of t.elements)n=n.filter(s=>!Bn(s,r));return{arrayValue:{values:n}}}class Ec extends Zc{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function Ay(t){return Be(t.integerValue||t.doubleValue)}function Xw(t){return Yf(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DN{constructor(e,n){this.field=e,this.transform=n}}function MN(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof da&&s instanceof da||r instanceof ha&&s instanceof ha?Ni(r.elements,s.elements,Bn):r instanceof Ec&&s instanceof Ec?Bn(r.Pe,s.Pe):r instanceof ua&&s instanceof ua}(t.transform,e.transform)}class ON{constructor(e,n){this.version=e,this.transformResults=n}}class En{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new En}static exists(e){return new En(void 0,e)}static updateTime(e){return new En(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ml(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class eu{}function Jw(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new ep(t.key,En.none()):new Pa(t.key,t.data,En.none());{const n=t.data,r=Ut.empty();let s=new ht(ut.comparator);for(let i of e.fields)if(!s.has(i)){let o=n.field(i);o===null&&i.length>1&&(i=i.popLast(),o=n.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new rs(t.key,r,new Kt(s.toArray()),En.none())}}function LN(t,e,n){t instanceof Pa?function(s,i,o){const l=s.value.clone(),c=jy(s.fieldTransforms,i,o.transformResults);l.setAll(c),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):t instanceof rs?function(s,i,o){if(!Ml(s.precondition,i))return void i.convertToUnknownDocument(o.version);const l=jy(s.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(Zw(s)),c.setAll(l),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(t,e,n):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function Lo(t,e,n,r){return t instanceof Pa?function(i,o,l,c){if(!Ml(i.precondition,o))return l;const d=i.value.clone(),f=Dy(i.fieldTransforms,c,o);return d.setAll(f),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof rs?function(i,o,l,c){if(!Ml(i.precondition,o))return l;const d=Dy(i.fieldTransforms,c,o),f=o.data;return f.setAll(Zw(i)),f.setAll(d),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(m=>m.field))}(t,e,n,r):function(i,o,l){return Ml(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(t,e,n)}function VN(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=Kw(r.transform,s||null);i!=null&&(n===null&&(n=Ut.empty()),n.set(r.field,i))}return n||null}function Ry(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ni(r,s,(i,o)=>MN(i,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Pa extends eu{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class rs extends eu{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Zw(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function jy(t,e,n){const r=new Map;Ie(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,l=e.data.field(i.field);r.set(i.field,jN(o,l,n[s]))}return r}function Dy(t,e,n){const r=new Map;for(const s of t){const i=s.transform,o=n.data.field(s.field);r.set(s.field,RN(i,o,e))}return r}class ep extends eu{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class UN extends eu{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FN{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&LN(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Lo(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Lo(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=qw();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let l=this.applyToLocalView(o,i.mutatedFields);l=n.has(s.key)?null:l;const c=Jw(o,l);c!==null&&r.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(ae.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),he())}isEqual(e){return this.batchId===e.batchId&&Ni(this.mutations,e.mutations,(n,r)=>Ry(n,r))&&Ni(this.baseMutations,e.baseMutations,(n,r)=>Ry(n,r))}}class tp{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Ie(e.mutations.length===r.length);let s=function(){return CN}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new tp(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $N{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BN{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var We,me;function zN(t){switch(t){default:return oe();case $.CANCELLED:case $.UNKNOWN:case $.DEADLINE_EXCEEDED:case $.RESOURCE_EXHAUSTED:case $.INTERNAL:case $.UNAVAILABLE:case $.UNAUTHENTICATED:return!1;case $.INVALID_ARGUMENT:case $.NOT_FOUND:case $.ALREADY_EXISTS:case $.PERMISSION_DENIED:case $.FAILED_PRECONDITION:case $.ABORTED:case $.OUT_OF_RANGE:case $.UNIMPLEMENTED:case $.DATA_LOSS:return!0}}function eE(t){if(t===void 0)return cr("GRPC error has no .code"),$.UNKNOWN;switch(t){case We.OK:return $.OK;case We.CANCELLED:return $.CANCELLED;case We.UNKNOWN:return $.UNKNOWN;case We.DEADLINE_EXCEEDED:return $.DEADLINE_EXCEEDED;case We.RESOURCE_EXHAUSTED:return $.RESOURCE_EXHAUSTED;case We.INTERNAL:return $.INTERNAL;case We.UNAVAILABLE:return $.UNAVAILABLE;case We.UNAUTHENTICATED:return $.UNAUTHENTICATED;case We.INVALID_ARGUMENT:return $.INVALID_ARGUMENT;case We.NOT_FOUND:return $.NOT_FOUND;case We.ALREADY_EXISTS:return $.ALREADY_EXISTS;case We.PERMISSION_DENIED:return $.PERMISSION_DENIED;case We.FAILED_PRECONDITION:return $.FAILED_PRECONDITION;case We.ABORTED:return $.ABORTED;case We.OUT_OF_RANGE:return $.OUT_OF_RANGE;case We.UNIMPLEMENTED:return $.UNIMPLEMENTED;case We.DATA_LOSS:return $.DATA_LOSS;default:return oe()}}(me=We||(We={}))[me.OK=0]="OK",me[me.CANCELLED=1]="CANCELLED",me[me.UNKNOWN=2]="UNKNOWN",me[me.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",me[me.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",me[me.NOT_FOUND=5]="NOT_FOUND",me[me.ALREADY_EXISTS=6]="ALREADY_EXISTS",me[me.PERMISSION_DENIED=7]="PERMISSION_DENIED",me[me.UNAUTHENTICATED=16]="UNAUTHENTICATED",me[me.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",me[me.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",me[me.ABORTED=10]="ABORTED",me[me.OUT_OF_RANGE=11]="OUT_OF_RANGE",me[me.UNIMPLEMENTED=12]="UNIMPLEMENTED",me[me.INTERNAL=13]="INTERNAL",me[me.UNAVAILABLE=14]="UNAVAILABLE",me[me.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WN(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HN=new ws([4294967295,4294967295],0);function My(t){const e=WN().encode(t),n=new bw;return n.update(e),new Uint8Array(n.digest())}function Oy(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ws([n,r],0),new ws([s,i],0)]}class np{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new xo(`Invalid padding: ${n}`);if(r<0)throw new xo(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new xo(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new xo(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=ws.fromNumber(this.Ie)}Ee(e,n,r){let s=e.add(n.multiply(ws.fromNumber(r)));return s.compare(HN)===1&&(s=new ws([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const n=My(e),[r,s]=Oy(n);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new np(i,s,n);return r.forEach(l=>o.insert(l)),o}insert(e){if(this.Ie===0)return;const n=My(e),[r,s]=Oy(n);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class xo extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,Na.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new tu(ae.min(),s,new Oe(we),ur(),he())}}class Na{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Na(r,n,he(),he(),he())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(e,n,r,s){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=s}}class tE{constructor(e,n){this.targetId=e,this.me=n}}class nE{constructor(e,n,r=pt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class Ly{constructor(){this.fe=0,this.ge=Uy(),this.pe=pt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=he(),n=he(),r=he();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:oe()}}),new Na(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=Uy()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ie(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class qN{constructor(e){this.Le=e,this.Be=new Map,this.ke=ur(),this.qe=Vy(),this.Qe=new Oe(we)}Ke(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{const r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:oe()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,s)=>{this.ze(s)&&n(s)})}He(e){const n=e.targetId,r=e.me.count,s=this.Je(n);if(s){const i=s.target;if(bh(i))if(r===0){const o=new te(i.path);this.Ue(n,o,St.newNoDocument(o,ae.min()))}else Ie(r===1);else{const o=this.Ye(n);if(o!==r){const l=this.Ze(e),c=l?this.Xe(l,e,o):1;if(c!==0){this.je(n);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,d)}}}}}Ze(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let o,l;try{o=ks(r).toUint8Array()}catch(c){if(c instanceof jw)return Pi("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new np(o,s,i)}catch(c){return Pi(c instanceof xo?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.Ie===0?null:l}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const o=this.Le.tt(),l=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.Ue(n,i,null),s++)}),s}rt(e){const n=new Map;this.Be.forEach((i,o)=>{const l=this.Je(o);if(l){if(i.current&&bh(l.target)){const c=new te(l.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,St.newNoDocument(c,e))}i.be&&(n.set(o,i.ve()),i.Ce())}});let r=he();this.qe.forEach((i,o)=>{let l=!0;o.forEachWhile(c=>{const d=this.Je(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new tu(e,n,this.Qe,this.ke,r);return this.ke=ur(),this.qe=Vy(),this.Qe=new Oe(we),s}$e(e,n){if(!this.ze(e))return;const r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,n)?s.Fe(n,1):s.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const n=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new Ly,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new ht(we),this.qe=this.qe.insert(e,n)),n}ze(e){const n=this.Je(e)!==null;return n||Z("WatchChangeAggregator","Detected inactive target",e),n}Je(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Ly),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function Vy(){return new Oe(te.comparator)}function Uy(){return new Oe(te.comparator)}const GN=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),KN=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),QN=(()=>({and:"AND",or:"OR"}))();class YN{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Ch(t,e){return t.useProto3Json||Qc(e)?e:{value:e}}function xc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function rE(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function XN(t,e){return xc(t,e.toTimestamp())}function $n(t){return Ie(!!t),ae.fromTimestamp(function(n){const r=Yr(n);return new Ze(r.seconds,r.nanos)}(t))}function rp(t,e){return Ph(t,e).canonicalString()}function Ph(t,e){const n=function(s){return new ke(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function sE(t){const e=ke.fromString(t);return Ie(cE(e)),e}function Nh(t,e){return rp(t.databaseId,e.path)}function ld(t,e){const n=sE(e);if(n.get(1)!==t.databaseId.projectId)throw new J($.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new J($.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new te(oE(n))}function iE(t,e){return rp(t.databaseId,e)}function JN(t){const e=sE(t);return e.length===4?ke.emptyPath():oE(e)}function kh(t){return new ke(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function oE(t){return Ie(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Fy(t,e,n){return{name:Nh(t,e),fields:n.value.mapValue.fields}}function ZN(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:oe()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,f){return d.useProto3Json?(Ie(f===void 0||typeof f=="string"),pt.fromBase64String(f||"")):(Ie(f===void 0||f instanceof Buffer||f instanceof Uint8Array),pt.fromUint8Array(f||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(d){const f=d.code===void 0?$.UNKNOWN:eE(d.code);return new J(f,d.message||"")}(o);n=new nE(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=ld(t,r.document.name),i=$n(r.document.updateTime),o=r.document.createTime?$n(r.document.createTime):ae.min(),l=new Ut({mapValue:{fields:r.document.fields}}),c=St.newFoundDocument(s,i,o,l),d=r.targetIds||[],f=r.removedTargetIds||[];n=new Ol(d,f,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=ld(t,r.document),i=r.readTime?$n(r.readTime):ae.min(),o=St.newNoDocument(s,i),l=r.removedTargetIds||[];n=new Ol([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=ld(t,r.document),i=r.removedTargetIds||[];n=new Ol([],i,s,null)}else{if(!("filter"in e))return oe();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new BN(s,i),l=r.targetId;n=new tE(l,o)}}return n}function ek(t,e){let n;if(e instanceof Pa)n={update:Fy(t,e.key,e.value)};else if(e instanceof ep)n={delete:Nh(t,e.key)};else if(e instanceof rs)n={update:Fy(t,e.key,e.data),updateMask:ck(e.fieldMask)};else{if(!(e instanceof UN))return oe();n={verify:Nh(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const l=o.transform;if(l instanceof ua)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof da)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof ha)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ec)return{fieldPath:o.field.canonicalString(),increment:l.Pe};throw oe()}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:XN(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:oe()}(t,e.precondition)),n}function tk(t,e){return t&&t.length>0?(Ie(e!==void 0),t.map(n=>function(s,i){let o=s.updateTime?$n(s.updateTime):$n(i);return o.isEqual(ae.min())&&(o=$n(i)),new ON(o,s.transformResults||[])}(n,e))):[]}function nk(t,e){return{documents:[iE(t,e.path)]}}function rk(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=iE(t,s);const i=function(d){if(d.length!==0)return lE(bn.create(d,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(d){if(d.length!==0)return d.map(f=>function(y){return{field:Qs(y.field),direction:ok(y.dir)}}(f))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const l=Ch(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:n,parent:s}}function sk(t){let e=JN(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Ie(r===1);const f=n.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];n.where&&(i=function(m){const y=aE(m);return y instanceof bn&&Lw(y)?y.getFilters():[y]}(n.where));let o=[];n.orderBy&&(o=function(m){return m.map(y=>function(N){return new wc(Ys(N.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction))}(y))}(n.orderBy));let l=null;n.limit&&(l=function(m){let y;return y=typeof m=="object"?m.value:m,Qc(y)?null:y}(n.limit));let c=null;n.startAt&&(c=function(m){const y=!!m.before,I=m.values||[];return new _c(I,y)}(n.startAt));let d=null;return n.endAt&&(d=function(m){const y=!m.before,I=m.values||[];return new _c(I,y)}(n.endAt)),xN(e,s,o,i,l,"F",c,d)}function ik(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return oe()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function aE(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Ys(n.unaryFilter.field);return qe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ys(n.unaryFilter.field);return qe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ys(n.unaryFilter.field);return qe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ys(n.unaryFilter.field);return qe.create(o,"!=",{nullValue:"NULL_VALUE"});default:return oe()}}(t):t.fieldFilter!==void 0?function(n){return qe.create(Ys(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return oe()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return bn.create(n.compositeFilter.filters.map(r=>aE(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return oe()}}(n.compositeFilter.op))}(t):oe()}function ok(t){return GN[t]}function ak(t){return KN[t]}function lk(t){return QN[t]}function Qs(t){return{fieldPath:t.canonicalString()}}function Ys(t){return ut.fromServerFormat(t.fieldPath)}function lE(t){return t instanceof qe?function(n){if(n.op==="=="){if(Sy(n.value))return{unaryFilter:{field:Qs(n.field),op:"IS_NAN"}};if(Iy(n.value))return{unaryFilter:{field:Qs(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Sy(n.value))return{unaryFilter:{field:Qs(n.field),op:"IS_NOT_NAN"}};if(Iy(n.value))return{unaryFilter:{field:Qs(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Qs(n.field),op:ak(n.op),value:n.value}}}(t):t instanceof bn?function(n){const r=n.getFilters().map(s=>lE(s));return r.length===1?r[0]:{compositeFilter:{op:lk(n.op),filters:r}}}(t):oe()}function ck(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function cE(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(e,n,r,s,i=ae.min(),o=ae.min(),l=pt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new jr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new jr(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new jr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new jr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uk{constructor(e){this.ct=e}}function dk(t){const e=sk({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Sh(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{constructor(){this.un=new fk}addToCollectionParentIndex(e,n){return this.un.add(n),B.resolve()}getCollectionParents(e,n){return B.resolve(this.un.getEntries(n))}addFieldIndex(e,n){return B.resolve()}deleteFieldIndex(e,n){return B.resolve()}deleteAllFieldIndexes(e){return B.resolve()}createTargetIndexes(e,n){return B.resolve()}getDocumentsMatchingTarget(e,n){return B.resolve(null)}getIndexType(e,n){return B.resolve(0)}getFieldIndexes(e,n){return B.resolve([])}getNextCollectionGroupToUpdate(e){return B.resolve(null)}getMinOffset(e,n){return B.resolve(Qr.min())}getMinOffsetFromCollectionGroup(e,n){return B.resolve(Qr.min())}updateCollectionGroup(e,n,r){return B.resolve()}updateIndexEntries(e,n){return B.resolve()}}class fk{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new ht(ke.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ht(ke.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Ri(0)}static kn(){return new Ri(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(){this.changes=new zi(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,St.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?B.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&Lo(r.mutation,s,Kt.empty(),Ze.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,he()).next(()=>r))}getLocalViewOfDocuments(e,n,r=he()){const s=ys();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let o=Eo();return i.forEach((l,c)=>{o=o.insert(l,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=ys();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,he()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,l)=>{n.set(o,l)})})}computeViews(e,n,r,s){let i=ur();const o=Oo(),l=function(){return Oo()}();return n.forEach((c,d)=>{const f=r.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof rs)?i=i.insert(d.key,d):f!==void 0?(o.set(d.key,f.mutation.getFieldMask()),Lo(f.mutation,d,f.mutation.getFieldMask(),Ze.now())):o.set(d.key,Kt.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((d,f)=>o.set(d,f)),n.forEach((d,f)=>{var m;return l.set(d,new mk(f,(m=o.get(d))!==null&&m!==void 0?m:null))}),l))}recalculateAndSaveOverlays(e,n){const r=Oo();let s=new Oe((o,l)=>o-l),i=he();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const l of o)l.keys().forEach(c=>{const d=n.get(c);if(d===null)return;let f=r.get(c)||Kt.empty();f=l.applyToLocalView(d,f),r.set(c,f);const m=(s.get(l.batchId)||he()).add(c);s=s.insert(l.batchId,m)})}).next(()=>{const o=[],l=s.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),d=c.key,f=c.value,m=qw();f.forEach(y=>{if(!i.has(y)){const I=Jw(n.get(y),r.get(y));I!==null&&m.set(y,I),i=i.add(y)}}),o.push(this.documentOverlayCache.saveOverlays(e,d,m))}return B.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(o){return te.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):$w(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):B.resolve(ys());let l=-1,c=i;return o.next(d=>B.forEach(d,(f,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),i.get(f)?B.resolve():this.remoteDocumentCache.getEntry(e,f).next(y=>{c=c.insert(f,y)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,c,d,he())).next(f=>({batchId:l,changes:Hw(f)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new te(n)).next(r=>{let s=Eo();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let o=Eo();return this.indexManager.getCollectionParents(e,i).next(l=>B.forEach(l,c=>{const d=function(m,y){return new Ca(y,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(n,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(f=>{f.forEach((m,y)=>{o=o.insert(m,y)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(o=>{i.forEach((c,d)=>{const f=d.getKey();o.get(f)===null&&(o=o.insert(f,St.newInvalidDocument(f)))});let l=Eo();return o.forEach((c,d)=>{const f=i.get(c);f!==void 0&&Lo(f.mutation,d,Kt.empty(),Ze.now()),Jc(n,d)&&(l=l.insert(c,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,n){return B.resolve(this.hr.get(n))}saveBundleMetadata(e,n){return this.hr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:$n(s.createTime)}}(n)),B.resolve()}getNamedQuery(e,n){return B.resolve(this.Pr.get(n))}saveNamedQuery(e,n){return this.Pr.set(n.name,function(s){return{name:s.name,query:dk(s.bundledQuery),readTime:$n(s.readTime)}}(n)),B.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{constructor(){this.overlays=new Oe(te.comparator),this.Ir=new Map}getOverlay(e,n){return B.resolve(this.overlays.get(n))}getOverlays(e,n){const r=ys();return B.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.ht(e,n,i)}),B.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),B.resolve()}getOverlaysForCollection(e,n,r){const s=ys(),i=n.length+1,o=new te(n.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,d=c.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return B.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new Oe((d,f)=>d-f);const o=this.overlays.getIterator();for(;o.hasNext();){const d=o.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let f=i.get(d.largestBatchId);f===null&&(f=ys(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const l=ys(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,f)=>l.set(d,f)),!(l.size()>=s)););return B.resolve(l)}ht(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new $N(n,r));let i=this.Ir.get(n);i===void 0&&(i=he(),this.Ir.set(n,i)),this.Ir.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(){this.sessionToken=pt.EMPTY_BYTE_STRING}getSessionToken(e){return B.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,B.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sp{constructor(){this.Tr=new ht(nt.Er),this.dr=new ht(nt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,n){const r=new nt(e,n);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Vr(new nt(e,n))}mr(e,n){e.forEach(r=>this.removeReference(r,n))}gr(e){const n=new te(new ke([])),r=new nt(n,e),s=new nt(n,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const n=new te(new ke([])),r=new nt(n,e),s=new nt(n,e+1);let i=he();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const n=new nt(e,0),r=this.Tr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class nt{constructor(e,n){this.key=e,this.wr=n}static Er(e,n){return te.comparator(e.key,n.key)||we(e.wr,n.wr)}static Ar(e,n){return we(e.wr,n.wr)||te.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new ht(nt.Er)}checkEmpty(e){return B.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new FN(i,n,r,s);this.mutationQueue.push(o);for(const l of s)this.br=this.br.add(new nt(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return B.resolve(o)}lookupMutationBatch(e,n){return B.resolve(this.Dr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.vr(r),i=s<0?0:s;return B.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return B.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return B.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new nt(n,0),s=new nt(n,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const l=this.Dr(o.wr);i.push(l)}),B.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new ht(we);return n.forEach(s=>{const i=new nt(s,0),o=new nt(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],l=>{r=r.add(l.wr)})}),B.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;te.isDocumentKey(i)||(i=i.child(""));const o=new nt(new te(i),0);let l=new ht(we);return this.br.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(c.wr)),!0)},o),B.resolve(this.Cr(l))}Cr(e){const n=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){Ie(this.Fr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return B.forEach(n.mutations,s=>{const i=new nt(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,n){const r=new nt(n,0),s=this.br.firstAfterOrEqual(r);return B.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,B.resolve()}Fr(e,n){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const n=this.vr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(e){this.Mr=e,this.docs=function(){return new Oe(te.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return B.resolve(r?r.document.mutableCopy():St.newInvalidDocument(n))}getEntries(e,n){let r=ur();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():St.newInvalidDocument(s))}),B.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=ur();const o=n.path,l=new te(o.child("")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:d,value:{document:f}}=c.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||rN(nN(f),r)<=0||(s.has(f.key)||Jc(n,f))&&(i=i.insert(f.key,f.mutableCopy()))}return B.resolve(i)}getAllFromCollectionGroup(e,n,r,s){oe()}Or(e,n){return B.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new xk(this)}getSize(e){return B.resolve(this.size)}}class xk extends pk{constructor(e){super(),this.cr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),B.waitFor(n)}getFromCache(e,n){return this.cr.getEntry(e,n)}getAllFromCache(e,n){return this.cr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tk{constructor(e){this.persistence=e,this.Nr=new zi(n=>Xf(n),Jf),this.lastRemoteSnapshotVersion=ae.min(),this.highestTargetId=0,this.Lr=0,this.Br=new sp,this.targetCount=0,this.kr=Ri.Bn()}forEachTarget(e,n){return this.Nr.forEach((r,s)=>n(s)),B.resolve()}getLastRemoteSnapshotVersion(e){return B.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return B.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),B.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Lr&&(this.Lr=n),B.resolve()}Kn(e){this.Nr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.kr=new Ri(n),this.highestTargetId=n),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,n){return this.Kn(n),this.targetCount+=1,B.resolve()}updateTargetData(e,n){return this.Kn(n),B.resolve()}removeTargetData(e,n){return this.Nr.delete(n.target),this.Br.gr(n.targetId),this.targetCount-=1,B.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.Nr.forEach((o,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),B.waitFor(i).next(()=>s)}getTargetCount(e){return B.resolve(this.targetCount)}getTargetData(e,n){const r=this.Nr.get(n)||null;return B.resolve(r)}addMatchingKeys(e,n,r){return this.Br.Rr(n,r),B.resolve()}removeMatchingKeys(e,n,r){this.Br.mr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),B.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.Br.gr(n),B.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Br.yr(n);return B.resolve(r)}containsKey(e,n){return B.resolve(this.Br.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bk{constructor(e,n){this.qr={},this.overlays={},this.Qr=new Gf(0),this.Kr=!1,this.Kr=!0,this.$r=new _k,this.referenceDelegate=e(this),this.Ur=new Tk(this),this.indexManager=new hk,this.remoteDocumentCache=function(s){return new Ek(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new uk(n),this.Gr=new yk(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new vk,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.qr[e.toKey()];return r||(r=new wk(n,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,n,r){Z("MemoryPersistence","Starting transaction:",e);const s=new Ik(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,n){return B.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,n)))}}class Ik extends iN{constructor(e){super(),this.currentSequenceNumber=e}}class ip{constructor(e){this.persistence=e,this.Jr=new sp,this.Yr=null}static Zr(e){return new ip(e)}get Xr(){if(this.Yr)return this.Yr;throw oe()}addReference(e,n,r){return this.Jr.addReference(r,n),this.Xr.delete(r.toString()),B.resolve()}removeReference(e,n,r){return this.Jr.removeReference(r,n),this.Xr.add(r.toString()),B.resolve()}markPotentiallyOrphaned(e,n){return this.Xr.add(n.toString()),B.resolve()}removeTarget(e,n){this.Jr.gr(n.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}zr(){this.Yr=new Set}jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return B.forEach(this.Xr,r=>{const s=te.fromPath(r);return this.ei(e,s).next(i=>{i||n.removeEntry(s,ae.min())})}).next(()=>(this.Yr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ei(e,n).next(r=>{r?this.Xr.delete(n.toString()):this.Xr.add(n.toString())})}Wr(e){return 0}ei(e,n){return B.or([()=>B.resolve(this.Jr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Hr(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class op{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.$i=r,this.Ui=s}static Wi(e,n){let r=he(),s=he();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new op(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sk{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return dS()?8:oN(Nt())>0?6:4}()}initialize(e,n){this.Ji=e,this.indexManager=n,this.Gi=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.Yi(e,n).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,n,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Sk;return this.Xi(e,n,o).next(l=>{if(i.result=l,this.zi)return this.es(e,n,o,l.size)})}).next(()=>i.result)}es(e,n,r,s){return r.documentReadCount<this.ji?(fo()<=fe.DEBUG&&Z("QueryEngine","SDK will not create cache indexes for query:",Ks(n),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),B.resolve()):(fo()<=fe.DEBUG&&Z("QueryEngine","Query:",Ks(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(fo()<=fe.DEBUG&&Z("QueryEngine","The SDK decides to create cache indexes for query:",Ks(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Fn(n))):B.resolve())}Yi(e,n){if(ky(n))return B.resolve(null);let r=Fn(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=Sh(n,null,"F"),r=Fn(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=he(...i);return this.Ji.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.ts(n,l);return this.ns(n,d,o,c.readTime)?this.Yi(e,Sh(n,null,"F")):this.rs(e,d,n,c)}))})))}Zi(e,n,r,s){return ky(n)||s.isEqual(ae.min())?B.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(n,i);return this.ns(n,o,r,s)?B.resolve(null):(fo()<=fe.DEBUG&&Z("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ks(n)),this.rs(e,o,n,tN(s,-1)).next(l=>l))})}ts(e,n){let r=new ht(zw(e));return n.forEach((s,i)=>{Jc(e,i)&&(r=r.add(i))}),r}ns(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,n,r){return fo()<=fe.DEBUG&&Z("QueryEngine","Using full collection scan to execute query:",Ks(n)),this.Ji.getDocumentsMatchingQuery(e,n,Qr.min(),r)}rs(e,n,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pk{constructor(e,n,r,s){this.persistence=e,this.ss=n,this.serializer=s,this.os=new Oe(we),this._s=new zi(i=>Xf(i),Jf),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new gk(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.os))}}function Nk(t,e,n,r){return new Pk(t,e,n,r)}async function uE(t,e){const n=le(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.ls(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],l=[];let c=he();for(const d of s){o.push(d.batchId);for(const f of d.mutations)c=c.add(f.key)}for(const d of i){l.push(d.batchId);for(const f of d.mutations)c=c.add(f.key)}return n.localDocuments.getDocuments(r,c).next(d=>({hs:d,removedBatchIds:o,addedBatchIds:l}))})})}function kk(t,e){const n=le(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(l,c,d,f){const m=d.batch,y=m.keys();let I=B.resolve();return y.forEach(N=>{I=I.next(()=>f.getEntry(c,N)).next(j=>{const A=d.docVersions.get(N);Ie(A!==null),j.version.compareTo(A)<0&&(m.applyToRemoteDocument(j,d),j.isValidDocument()&&(j.setReadTime(d.commitVersion),f.addEntry(j)))})}),I.next(()=>l.mutationQueue.removeMutationBatch(c,m))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let c=he();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(c=c.add(l.batch.mutations[d].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function dE(t){const e=le(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ur.getLastRemoteSnapshotVersion(n))}function Ak(t,e){const n=le(t),r=e.snapshotVersion;let s=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=n.cs.newChangeBuffer({trackRemovals:!0});s=n.os;const l=[];e.targetChanges.forEach((f,m)=>{const y=s.get(m);if(!y)return;l.push(n.Ur.removeMatchingKeys(i,f.removedDocuments,m).next(()=>n.Ur.addMatchingKeys(i,f.addedDocuments,m)));let I=y.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?I=I.withResumeToken(pt.EMPTY_BYTE_STRING,ae.min()).withLastLimboFreeSnapshotVersion(ae.min()):f.resumeToken.approximateByteSize()>0&&(I=I.withResumeToken(f.resumeToken,r)),s=s.insert(m,I),function(j,A,T){return j.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-j.snapshotVersion.toMicroseconds()>=3e8?!0:T.addedDocuments.size+T.modifiedDocuments.size+T.removedDocuments.size>0}(y,I,f)&&l.push(n.Ur.updateTargetData(i,I))});let c=ur(),d=he();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(i,f))}),l.push(Rk(i,o,e.documentUpdates).next(f=>{c=f.Ps,d=f.Is})),!r.isEqual(ae.min())){const f=n.Ur.getLastRemoteSnapshotVersion(i).next(m=>n.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(f)}return B.waitFor(l).next(()=>o.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,c,d)).next(()=>c)}).then(i=>(n.os=s,i))}function Rk(t,e,n){let r=he(),s=he();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let o=ur();return n.forEach((l,c)=>{const d=i.get(l);c.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),c.isNoDocument()&&c.version.isEqual(ae.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):Z("LocalStore","Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",c.version)}),{Ps:o,Is:s}})}function jk(t,e){const n=le(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Dk(t,e){const n=le(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Ur.getTargetData(r,e).next(i=>i?(s=i,B.resolve(s)):n.Ur.allocateTargetId(r).next(o=>(s=new jr(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.os=n.os.insert(r.targetId,r),n._s.set(e,r.targetId)),r})}async function Ah(t,e,n){const r=le(t),s=r.os.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Sa(o))throw o;Z("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function $y(t,e,n){const r=le(t);let s=ae.min(),i=he();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,d,f){const m=le(c),y=m._s.get(f);return y!==void 0?B.resolve(m.os.get(y)):m.Ur.getTargetData(d,f)}(r,o,Fn(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,l.targetId).next(c=>{i=c})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,n?s:ae.min(),n?i:he())).next(l=>(Mk(r,bN(e),l),{documents:l,Ts:i})))}function Mk(t,e,n){let r=t.us.get(e)||ae.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.us.set(e,r)}class By{constructor(){this.activeTargetIds=kN()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ok{constructor(){this.so=new By,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,n,r){this.oo[e]=n}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new By,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lk{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zy{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Z("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Z("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gl=null;function cd(){return gl===null?gl=function(){return 268435456+Math.round(2147483648*Math.random())}():gl++,"0x"+gl.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vk={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tt="WebChannelConnection";class Fk extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+n.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(n,r,s,i,o){const l=cd(),c=this.xo(n,r.toUriEncodedString());Z("RestConnection",`Sending RPC '${n}' ${l}:`,c,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,i,o),this.No(n,c,d,s).then(f=>(Z("RestConnection",`Received RPC '${n}' ${l}: `,f),f),f=>{throw Pi("RestConnection",`RPC '${n}' ${l} failed with error: `,f,"url: ",c,"request:",s),f})}Lo(n,r,s,i,o,l){return this.Mo(n,r,s,i,o)}Oo(n,r,s){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Bi}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>n[o]=i),s&&s.headers.forEach((i,o)=>n[o]=i)}xo(n,r){const s=Vk[n];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,n,r,s){const i=cd();return new Promise((o,l)=>{const c=new Iw;c.setWithCredentials(!0),c.listenOnce(Sw.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case jl.NO_ERROR:const f=c.getResponseJson();Z(Tt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(f)),o(f);break;case jl.TIMEOUT:Z(Tt,`RPC '${e}' ${i} timed out`),l(new J($.DEADLINE_EXCEEDED,"Request time out"));break;case jl.HTTP_ERROR:const m=c.getStatus();if(Z(Tt,`RPC '${e}' ${i} failed with status:`,m,"response text:",c.getResponseText()),m>0){let y=c.getResponseJson();Array.isArray(y)&&(y=y[0]);const I=y==null?void 0:y.error;if(I&&I.status&&I.message){const N=function(A){const T=A.toLowerCase().replace(/_/g,"-");return Object.values($).indexOf(T)>=0?T:$.UNKNOWN}(I.status);l(new J(N,I.message))}else l(new J($.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new J($.UNAVAILABLE,"Connection failed."));break;default:oe()}}finally{Z(Tt,`RPC '${e}' ${i} completed.`)}});const d=JSON.stringify(s);Z(Tt,`RPC '${e}' ${i} sending request:`,s),c.send(n,"POST",d,r,15)})}Bo(e,n,r){const s=cd(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Nw(),l=Pw(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;const f=i.join("");Z(Tt,`Creating RPC '${e}' stream ${s}: ${f}`,c);const m=o.createWebChannel(f,c);let y=!1,I=!1;const N=new Uk({Io:A=>{I?Z(Tt,`Not sending because RPC '${e}' stream ${s} is closed:`,A):(y||(Z(Tt,`Opening RPC '${e}' stream ${s} transport.`),m.open(),y=!0),Z(Tt,`RPC '${e}' stream ${s} sending:`,A),m.send(A))},To:()=>m.close()}),j=(A,T,w)=>{A.listen(T,S=>{try{w(S)}catch(O){setTimeout(()=>{throw O},0)}})};return j(m,wo.EventType.OPEN,()=>{I||(Z(Tt,`RPC '${e}' stream ${s} transport opened.`),N.yo())}),j(m,wo.EventType.CLOSE,()=>{I||(I=!0,Z(Tt,`RPC '${e}' stream ${s} transport closed`),N.So())}),j(m,wo.EventType.ERROR,A=>{I||(I=!0,Pi(Tt,`RPC '${e}' stream ${s} transport errored:`,A),N.So(new J($.UNAVAILABLE,"The operation could not be completed")))}),j(m,wo.EventType.MESSAGE,A=>{var T;if(!I){const w=A.data[0];Ie(!!w);const S=w,O=S.error||((T=S[0])===null||T===void 0?void 0:T.error);if(O){Z(Tt,`RPC '${e}' stream ${s} received error:`,O);const R=O.status;let V=function(E){const x=We[E];if(x!==void 0)return eE(x)}(R),_=O.message;V===void 0&&(V=$.INTERNAL,_="Unknown error status: "+R+" with message "+O.message),I=!0,N.So(new J(V,_)),m.close()}else Z(Tt,`RPC '${e}' stream ${s} received:`,w),N.bo(w)}}),j(l,Cw.STAT_EVENT,A=>{A.stat===wh.PROXY?Z(Tt,`RPC '${e}' stream ${s} detected buffering proxy`):A.stat===wh.NOPROXY&&Z(Tt,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{N.wo()},0),N}}function ud(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nu(t){return new YN(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(e,n,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=n,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,n-r);s>0&&Z("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fE{constructor(e,n,r,s,i,o,l,c){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new hE(e,n)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,n){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():n&&n.code===$.RESOURCE_EXHAUSTED?(cr(n.toString()),cr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===$.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(n)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===n&&this.P_(r,s)},r=>{e(()=>{const s=new J($.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,n){const r=this.h_(this.Yo);this.stream=this.T_(e,n),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return Z("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return n=>{this.ui.enqueueAndForget(()=>this.Yo===e?n():(Z("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $k extends fE{constructor(e,n,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}T_(e,n){return this.connection.Bo("Listen",e,n)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const n=ZN(this.serializer,e),r=function(i){if(!("targetChange"in i))return ae.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ae.min():o.readTime?$n(o.readTime):ae.min()}(e);return this.listener.d_(n,r)}A_(e){const n={};n.database=kh(this.serializer),n.addTarget=function(i,o){let l;const c=o.target;if(l=bh(c)?{documents:nk(i,c)}:{query:rk(i,c)._t},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=rE(i,o.resumeToken);const d=Ch(i,o.expectedCount);d!==null&&(l.expectedCount=d)}else if(o.snapshotVersion.compareTo(ae.min())>0){l.readTime=xc(i,o.snapshotVersion.toTimestamp());const d=Ch(i,o.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=ik(this.serializer,e);r&&(n.labels=r),this.a_(n)}R_(e){const n={};n.database=kh(this.serializer),n.removeTarget=e,this.a_(n)}}class Bk extends fE{constructor(e,n,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,n){return this.connection.Bo("Write",e,n)}E_(e){return Ie(!!e.streamToken),this.lastStreamToken=e.streamToken,Ie(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Ie(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const n=tk(e.writeResults,e.commitTime),r=$n(e.commitTime);return this.listener.g_(r,n)}p_(){const e={};e.database=kh(this.serializer),this.a_(e)}m_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>ek(this.serializer,r))};this.a_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zk extends class{}{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new J($.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,n,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Ph(n,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new J($.UNKNOWN,i.toString())})}Lo(e,n,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Lo(e,Ph(n,r),s,o,l,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new J($.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Wk{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(cr(n),this.D_=!1):Z("OnlineStateTracker",n)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Vs(this)&&(Z("RemoteStore","Restarting streams for network reachability change."),await async function(c){const d=le(c);d.L_.add(4),await ka(d),d.q_.set("Unknown"),d.L_.delete(4),await ru(d)}(this))})}),this.q_=new Wk(r,s)}}async function ru(t){if(Vs(t))for(const e of t.B_)await e(!0)}async function ka(t){for(const e of t.B_)await e(!1)}function pE(t,e){const n=le(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),up(n)?cp(n):Wi(n).r_()&&lp(n,e))}function ap(t,e){const n=le(t),r=Wi(n);n.N_.delete(e),r.r_()&&mE(n,e),n.N_.size===0&&(r.r_()?r.o_():Vs(n)&&n.q_.set("Unknown"))}function lp(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ae.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Wi(t).A_(e)}function mE(t,e){t.Q_.xe(e),Wi(t).R_(e)}function cp(t){t.Q_=new qN({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),Wi(t).start(),t.q_.v_()}function up(t){return Vs(t)&&!Wi(t).n_()&&t.N_.size>0}function Vs(t){return le(t).L_.size===0}function gE(t){t.Q_=void 0}async function qk(t){t.q_.set("Online")}async function Gk(t){t.N_.forEach((e,n)=>{lp(t,e)})}async function Kk(t,e){gE(t),up(t)?(t.q_.M_(e),cp(t)):t.q_.set("Unknown")}async function Qk(t,e,n){if(t.q_.set("Online"),e instanceof nE&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const l of i.targetIds)s.N_.has(l)&&(await s.remoteSyncer.rejectListen(l,o),s.N_.delete(l),s.Q_.removeTarget(l))}(t,e)}catch(r){Z("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Tc(t,r)}else if(e instanceof Ol?t.Q_.Ke(e):e instanceof tE?t.Q_.He(e):t.Q_.We(e),!n.isEqual(ae.min()))try{const r=await dE(t.localStore);n.compareTo(r)>=0&&await function(i,o){const l=i.Q_.rt(o);return l.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const f=i.N_.get(d);f&&i.N_.set(d,f.withResumeToken(c.resumeToken,o))}}),l.targetMismatches.forEach((c,d)=>{const f=i.N_.get(c);if(!f)return;i.N_.set(c,f.withResumeToken(pt.EMPTY_BYTE_STRING,f.snapshotVersion)),mE(i,c);const m=new jr(f.target,c,d,f.sequenceNumber);lp(i,m)}),i.remoteSyncer.applyRemoteEvent(l)}(t,n)}catch(r){Z("RemoteStore","Failed to raise snapshot:",r),await Tc(t,r)}}async function Tc(t,e,n){if(!Sa(e))throw e;t.L_.add(1),await ka(t),t.q_.set("Offline"),n||(n=()=>dE(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Z("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await ru(t)})}function yE(t,e){return e().catch(n=>Tc(t,n,e))}async function su(t){const e=le(t),n=Xr(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Yk(e);)try{const s=await jk(e.localStore,r);if(s===null){e.O_.length===0&&n.o_();break}r=s.batchId,Xk(e,s)}catch(s){await Tc(e,s)}vE(e)&&_E(e)}function Yk(t){return Vs(t)&&t.O_.length<10}function Xk(t,e){t.O_.push(e);const n=Xr(t);n.r_()&&n.V_&&n.m_(e.mutations)}function vE(t){return Vs(t)&&!Xr(t).n_()&&t.O_.length>0}function _E(t){Xr(t).start()}async function Jk(t){Xr(t).p_()}async function Zk(t){const e=Xr(t);for(const n of t.O_)e.m_(n.mutations)}async function eA(t,e,n){const r=t.O_.shift(),s=tp.from(r,e,n);await yE(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await su(t)}async function tA(t,e){e&&Xr(t).V_&&await async function(r,s){if(function(o){return zN(o)&&o!==$.ABORTED}(s.code)){const i=r.O_.shift();Xr(r).s_(),await yE(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await su(r)}}(t,e),vE(t)&&_E(t)}async function Wy(t,e){const n=le(t);n.asyncQueue.verifyOperationInProgress(),Z("RemoteStore","RemoteStore received new credentials");const r=Vs(n);n.L_.add(3),await ka(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await ru(n)}async function nA(t,e){const n=le(t);e?(n.L_.delete(2),await ru(n)):e||(n.L_.add(2),await ka(n),n.q_.set("Unknown"))}function Wi(t){return t.K_||(t.K_=function(n,r,s){const i=le(n);return i.w_(),new $k(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:qk.bind(null,t),Ro:Gk.bind(null,t),mo:Kk.bind(null,t),d_:Qk.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),up(t)?cp(t):t.q_.set("Unknown")):(await t.K_.stop(),gE(t))})),t.K_}function Xr(t){return t.U_||(t.U_=function(n,r,s){const i=le(n);return i.w_(),new Bk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Jk.bind(null,t),mo:tA.bind(null,t),f_:Zk.bind(null,t),g_:eA.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await su(t)):(await t.U_.stop(),t.O_.length>0&&(Z("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new nr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const o=Date.now()+r,l=new dp(e,n,o,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new J($.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hp(t,e){if(cr("AsyncQueue",`${e}: ${t}`),Sa(t))return new J($.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e){this.comparator=e?(n,r)=>e(n,r)||te.comparator(n.key,r.key):(n,r)=>te.comparator(n.key,r.key),this.keyedMap=Eo(),this.sortedSet=new Oe(this.comparator)}static emptySet(e){return new _i(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof _i)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new _i;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hy{constructor(){this.W_=new Oe(te.comparator)}track(e){const n=e.doc.key,r=this.W_.get(n);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(n,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(n):e.type===1&&r.type===2?this.W_=this.W_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):oe():this.W_=this.W_.insert(n,e)}G_(){const e=[];return this.W_.inorderTraversal((n,r)=>{e.push(r)}),e}}class ji{constructor(e,n,r,s,i,o,l,c,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,i){const o=[];return n.forEach(l=>{o.push({type:0,doc:l})}),new ji(e,n,_i.emptySet(n),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Xc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rA{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class sA{constructor(){this.queries=qy(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(n,r){const s=le(n),i=s.queries;s.queries=qy(),i.forEach((o,l)=>{for(const c of l.j_)c.onError(r)})})(this,new J($.ABORTED,"Firestore shutting down"))}}function qy(){return new zi(t=>Bw(t),Xc)}async function fp(t,e){const n=le(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new rA,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await n.onListen(s,!0);break;case 1:i.z_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(o){const l=hp(o,`Initialization of query '${Ks(e.query)}' failed`);return void e.onError(l)}n.queries.set(s,i),i.j_.push(e),e.Z_(n.onlineState),i.z_&&e.X_(i.z_)&&mp(n)}async function pp(t,e){const n=le(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function iA(t,e){const n=le(t);let r=!1;for(const s of e){const i=s.query,o=n.queries.get(i);if(o){for(const l of o.j_)l.X_(s)&&(r=!0);o.z_=s}}r&&mp(n)}function oA(t,e,n){const r=le(t),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(n);r.queries.delete(e)}function mp(t){t.Y_.forEach(e=>{e.next()})}var Rh,Gy;(Gy=Rh||(Rh={})).ea="default",Gy.Cache="cache";class gp{constructor(e,n,r){this.query=e,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new ji(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.na?this.ia(e)&&(this.ta.next(e),n=!0):this.sa(e,this.onlineState)&&(this.oa(e),n=!0),this.ra=e,n}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let n=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),n=!0),n}sa(e,n){if(!e.fromCache||!this.J_())return!0;const r=n!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const n=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}oa(e){e=ji.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Rh.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wE{constructor(e){this.key=e}}class EE{constructor(e){this.key=e}}class aA{constructor(e,n){this.query=e,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=he(),this.mutatedKeys=he(),this.Aa=zw(e),this.Ra=new _i(this.Aa)}get Va(){return this.Ta}ma(e,n){const r=n?n.fa:new Hy,s=n?n.Ra:this.Ra;let i=n?n.mutatedKeys:this.mutatedKeys,o=s,l=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((f,m)=>{const y=s.get(f),I=Jc(this.query,m)?m:null,N=!!y&&this.mutatedKeys.has(y.key),j=!!I&&(I.hasLocalMutations||this.mutatedKeys.has(I.key)&&I.hasCommittedMutations);let A=!1;y&&I?y.data.isEqual(I.data)?N!==j&&(r.track({type:3,doc:I}),A=!0):this.ga(y,I)||(r.track({type:2,doc:I}),A=!0,(c&&this.Aa(I,c)>0||d&&this.Aa(I,d)<0)&&(l=!0)):!y&&I?(r.track({type:0,doc:I}),A=!0):y&&!I&&(r.track({type:1,doc:y}),A=!0,(c||d)&&(l=!0)),A&&(I?(o=o.add(I),i=j?i.add(f):i.delete(f)):(o=o.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{Ra:o,fa:r,ns:l,mutatedKeys:i}}ga(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((f,m)=>function(I,N){const j=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return oe()}};return j(I)-j(N)}(f.type,m.type)||this.Aa(f.doc,m.doc)),this.pa(r),s=s!=null&&s;const l=n&&!s?this.ya():[],c=this.da.size===0&&this.current&&!s?1:0,d=c!==this.Ea;return this.Ea=c,o.length!==0||d?{snapshot:new ji(this.query,e.Ra,i,o,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Hy,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(n=>this.Ta=this.Ta.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ta=this.Ta.delete(n)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=he(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const n=[];return e.forEach(r=>{this.da.has(r)||n.push(new EE(r))}),this.da.forEach(r=>{e.has(r)||n.push(new wE(r))}),n}ba(e){this.Ta=e.Ts,this.da=he();const n=this.ma(e.documents);return this.applyChanges(n,!0)}Da(){return ji.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class lA{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class cA{constructor(e){this.key=e,this.va=!1}}class uA{constructor(e,n,r,s,i,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new zi(l=>Bw(l),Xc),this.Ma=new Map,this.xa=new Set,this.Oa=new Oe(te.comparator),this.Na=new Map,this.La=new sp,this.Ba={},this.ka=new Map,this.qa=Ri.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function dA(t,e,n=!0){const r=CE(t);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await xE(r,e,n,!0),s}async function hA(t,e){const n=CE(t);await xE(n,e,!0,!1)}async function xE(t,e,n,r){const s=await Dk(t.localStore,Fn(e)),i=s.targetId,o=t.sharedClientState.addLocalQueryTarget(i,n);let l;return r&&(l=await fA(t,e,i,o==="current",s.resumeToken)),t.isPrimaryClient&&n&&pE(t.remoteStore,s),l}async function fA(t,e,n,r,s){t.Ka=(m,y,I)=>async function(j,A,T,w){let S=A.view.ma(T);S.ns&&(S=await $y(j.localStore,A.query,!1).then(({documents:_})=>A.view.ma(_,S)));const O=w&&w.targetChanges.get(A.targetId),R=w&&w.targetMismatches.get(A.targetId)!=null,V=A.view.applyChanges(S,j.isPrimaryClient,O,R);return Qy(j,A.targetId,V.wa),V.snapshot}(t,m,y,I);const i=await $y(t.localStore,e,!0),o=new aA(e,i.Ts),l=o.ma(i.documents),c=Na.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=o.applyChanges(l,t.isPrimaryClient,c);Qy(t,n,d.wa);const f=new lA(e,n,o);return t.Fa.set(e,f),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),d.snapshot}async function pA(t,e,n){const r=le(t),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Xc(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Ah(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&ap(r.remoteStore,s.targetId),jh(r,s.targetId)}).catch(Ia)):(jh(r,s.targetId),await Ah(r.localStore,s.targetId,!0))}async function mA(t,e){const n=le(t),r=n.Fa.get(e),s=n.Ma.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),ap(n.remoteStore,r.targetId))}async function gA(t,e,n){const r=TA(t);try{const s=await function(o,l){const c=le(o),d=Ze.now(),f=l.reduce((I,N)=>I.add(N.key),he());let m,y;return c.persistence.runTransaction("Locally write mutations","readwrite",I=>{let N=ur(),j=he();return c.cs.getEntries(I,f).next(A=>{N=A,N.forEach((T,w)=>{w.isValidDocument()||(j=j.add(T))})}).next(()=>c.localDocuments.getOverlayedDocuments(I,N)).next(A=>{m=A;const T=[];for(const w of l){const S=VN(w,m.get(w.key).overlayedDocument);S!=null&&T.push(new rs(w.key,S,Dw(S.value.mapValue),En.exists(!0)))}return c.mutationQueue.addMutationBatch(I,d,T,l)}).next(A=>{y=A;const T=A.applyToLocalDocumentSet(m,j);return c.documentOverlayCache.saveOverlays(I,A.batchId,T)})}).then(()=>({batchId:y.batchId,changes:Hw(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,l,c){let d=o.Ba[o.currentUser.toKey()];d||(d=new Oe(we)),d=d.insert(l,c),o.Ba[o.currentUser.toKey()]=d}(r,s.batchId,n),await Aa(r,s.changes),await su(r.remoteStore)}catch(s){const i=hp(s,"Failed to persist write");n.reject(i)}}async function TE(t,e){const n=le(t);try{const r=await Ak(n.localStore,e);e.targetChanges.forEach((s,i)=>{const o=n.Na.get(i);o&&(Ie(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Ie(o.va):s.removedDocuments.size>0&&(Ie(o.va),o.va=!1))}),await Aa(n,r,e)}catch(r){await Ia(r)}}function Ky(t,e,n){const r=le(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Fa.forEach((i,o)=>{const l=o.view.Z_(e);l.snapshot&&s.push(l.snapshot)}),function(o,l){const c=le(o);c.onlineState=l;let d=!1;c.queries.forEach((f,m)=>{for(const y of m.j_)y.Z_(l)&&(d=!0)}),d&&mp(c)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function yA(t,e,n){const r=le(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Oe(te.comparator);o=o.insert(i,St.newNoDocument(i,ae.min()));const l=he().add(i),c=new tu(ae.min(),new Map,new Oe(we),o,l);await TE(r,c),r.Oa=r.Oa.remove(i),r.Na.delete(e),yp(r)}else await Ah(r.localStore,e,!1).then(()=>jh(r,e,n)).catch(Ia)}async function vA(t,e){const n=le(t),r=e.batch.batchId;try{const s=await kk(n.localStore,e);IE(n,r,null),bE(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Aa(n,s)}catch(s){await Ia(s)}}async function _A(t,e,n){const r=le(t);try{const s=await function(o,l){const c=le(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return c.mutationQueue.lookupMutationBatch(d,l).next(m=>(Ie(m!==null),f=m.keys(),c.mutationQueue.removeMutationBatch(d,m))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,f,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>c.localDocuments.getDocuments(d,f))})}(r.localStore,e);IE(r,e,n),bE(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Aa(r,s)}catch(s){await Ia(s)}}function bE(t,e){(t.ka.get(e)||[]).forEach(n=>{n.resolve()}),t.ka.delete(e)}function IE(t,e,n){const r=le(t);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function jh(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||SE(t,r)})}function SE(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);n!==null&&(ap(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),yp(t))}function Qy(t,e,n){for(const r of n)r instanceof wE?(t.La.addReference(r.key,e),wA(t,r)):r instanceof EE?(Z("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||SE(t,r.key)):oe()}function wA(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(Z("SyncEngine","New document in limbo: "+n),t.xa.add(r),yp(t))}function yp(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new te(ke.fromString(e)),r=t.qa.next();t.Na.set(r,new cA(n)),t.Oa=t.Oa.insert(n,r),pE(t.remoteStore,new jr(Fn(Yc(n.path)),r,"TargetPurposeLimboResolution",Gf.oe))}}async function Aa(t,e,n){const r=le(t),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((l,c)=>{o.push(r.Ka(c,e,n).then(d=>{var f;if((d||n)&&r.isPrimaryClient){const m=d?!d.fromCache:(f=n==null?void 0:n.targetChanges.get(c.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(d){s.push(d);const m=op.Wi(c.targetId,d);i.push(m)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(c,d){const f=le(c);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>B.forEach(d,y=>B.forEach(y.$i,I=>f.persistence.referenceDelegate.addReference(m,y.targetId,I)).next(()=>B.forEach(y.Ui,I=>f.persistence.referenceDelegate.removeReference(m,y.targetId,I)))))}catch(m){if(!Sa(m))throw m;Z("LocalStore","Failed to update sequence numbers: "+m)}for(const m of d){const y=m.targetId;if(!m.fromCache){const I=f.os.get(y),N=I.snapshotVersion,j=I.withLastLimboFreeSnapshotVersion(N);f.os=f.os.insert(y,j)}}}(r.localStore,i))}async function EA(t,e){const n=le(t);if(!n.currentUser.isEqual(e)){Z("SyncEngine","User change. New user:",e.toKey());const r=await uE(n.localStore,e);n.currentUser=e,function(i,o){i.ka.forEach(l=>{l.forEach(c=>{c.reject(new J($.CANCELLED,o))})}),i.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Aa(n,r.hs)}}function xA(t,e){const n=le(t),r=n.Na.get(e);if(r&&r.va)return he().add(r.key);{let s=he();const i=n.Ma.get(e);if(!i)return s;for(const o of i){const l=n.Fa.get(o);s=s.unionWith(l.view.Va)}return s}}function CE(t){const e=le(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=TE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xA.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=yA.bind(null,e),e.Ca.d_=iA.bind(null,e.eventManager),e.Ca.$a=oA.bind(null,e.eventManager),e}function TA(t){const e=le(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=vA.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=_A.bind(null,e),e}class bc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=nu(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,n){return null}Ha(e,n){return null}za(e){return Nk(this.persistence,new Ck,e.initialUser,this.serializer)}Ga(e){return new bk(ip.Zr,this.serializer)}Wa(e){return new Ok}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}bc.provider={build:()=>new bc};class Dh{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ky(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=EA.bind(null,this.syncEngine),await nA(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new sA}()}createDatastore(e){const n=nu(e.databaseInfo.databaseId),r=function(i){return new Fk(i)}(e.databaseInfo);return function(i,o,l,c){return new zk(i,o,l,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,o,l){return new Hk(r,s,i,o,l)}(this.localStore,this.datastore,e.asyncQueue,n=>Ky(this.syncEngine,n,0),function(){return zy.D()?new zy:new Lk}())}createSyncEngine(e,n){return function(s,i,o,l,c,d,f){const m=new uA(s,i,o,l,c,d);return f&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=le(s);Z("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await ka(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}Dh.provider={build:()=>new Dh};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):cr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bA{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=bt.UNAUTHENTICATED,this.clientId=Aw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{Z("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(Z("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new nr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=hp(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function dd(t,e){t.asyncQueue.verifyOperationInProgress(),Z("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await uE(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Yy(t,e){t.asyncQueue.verifyOperationInProgress();const n=await IA(t);Z("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>Wy(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>Wy(e.remoteStore,s)),t._onlineComponents=e}async function IA(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Z("FirestoreClient","Using user provided OfflineComponentProvider");try{await dd(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===$.FAILED_PRECONDITION||s.code===$.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;Pi("Error using user provided cache. Falling back to memory cache: "+n),await dd(t,new bc)}}else Z("FirestoreClient","Using default OfflineComponentProvider"),await dd(t,new bc);return t._offlineComponents}async function PE(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Z("FirestoreClient","Using user provided OnlineComponentProvider"),await Yy(t,t._uninitializedComponentsProvider._online)):(Z("FirestoreClient","Using default OnlineComponentProvider"),await Yy(t,new Dh))),t._onlineComponents}function SA(t){return PE(t).then(e=>e.syncEngine)}async function Ic(t){const e=await PE(t),n=e.eventManager;return n.onListen=dA.bind(null,e.syncEngine),n.onUnlisten=pA.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=hA.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=mA.bind(null,e.syncEngine),n}function CA(t,e,n={}){const r=new nr;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,l,c,d){const f=new vp({next:y=>{f.Za(),o.enqueueAndForget(()=>pp(i,m));const I=y.docs.has(l);!I&&y.fromCache?d.reject(new J($.UNAVAILABLE,"Failed to get document because the client is offline.")):I&&y.fromCache&&c&&c.source==="server"?d.reject(new J($.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(y)},error:y=>d.reject(y)}),m=new gp(Yc(l.path),f,{includeMetadataChanges:!0,_a:!0});return fp(i,m)}(await Ic(t),t.asyncQueue,e,n,r)),r.promise}function PA(t,e,n={}){const r=new nr;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,l,c,d){const f=new vp({next:y=>{f.Za(),o.enqueueAndForget(()=>pp(i,m)),y.fromCache&&c.source==="server"?d.reject(new J($.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(y)},error:y=>d.reject(y)}),m=new gp(l,f,{includeMetadataChanges:!0,_a:!0});return fp(i,m)}(await Ic(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NE(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xy=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kE(t,e,n){if(!n)throw new J($.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function NA(t,e,n,r){if(e===!0&&r===!0)throw new J($.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Jy(t){if(!te.isDocumentKey(t))throw new J($.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Zy(t){if(te.isDocumentKey(t))throw new J($.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function iu(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":oe()}function sn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new J($.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=iu(t);throw new J($.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new J($.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new J($.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}NA("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=NE((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new J($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new J($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new J($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ou{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ev({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new J($.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new J($.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ev(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new qP;switch(r.type){case"firstParty":return new YP(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new J($.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=Xy.get(n);r&&(Z("ComponentProvider","Removing Datastore"),Xy.delete(n),r.terminate())}(this),Promise.resolve()}}function kA(t,e,n,r={}){var s;const i=(t=sn(t,ou))._getSettings(),o=`${e}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Pi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let l,c;if(typeof r.mockUserToken=="string")l=r.mockUserToken,c=bt.MOCK_USER;else{l=sS(r.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new J($.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new bt(d)}t._authCredentials=new GP(new kw(l,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Us{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Us(this.firestore,e,this._query)}}class Mt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Mt(this.firestore,e,this._key)}}class qr extends Us{constructor(e,n,r){super(e,n,Yc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Mt(this.firestore,null,new te(e))}withConverter(e){return new qr(this.firestore,e,this._path)}}function it(t,e,...n){if(t=Ke(t),kE("collection","path",e),t instanceof ou){const r=ke.fromString(e,...n);return Zy(r),new qr(t,null,r)}{if(!(t instanceof Mt||t instanceof qr))throw new J($.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ke.fromString(e,...n));return Zy(r),new qr(t.firestore,null,r)}}function mt(t,e,...n){if(t=Ke(t),arguments.length===1&&(e=Aw.newId()),kE("doc","path",e),t instanceof ou){const r=ke.fromString(e,...n);return Jy(r),new Mt(t,null,new te(r))}{if(!(t instanceof Mt||t instanceof qr))throw new J($.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ke.fromString(e,...n));return Jy(r),new Mt(t.firestore,t instanceof qr?t.converter:null,new te(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tv{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new hE(this,"async_queue_retry"),this.Vu=()=>{const r=ud();r&&Z("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const n=ud();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const n=ud();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const n=new nr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Sa(e))throw e;Z("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const n=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let l=o.message||"";return o.stack&&(l=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),l}(r);throw cr("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=n,n}enqueueAfterDelay(e,n,r){this.fu(),this.Ru.indexOf(e)>-1&&(n=0);const s=dp.createAndSchedule(this,e,n,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&oe()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const n of this.Tu)if(n.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Tu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const n=this.Tu.indexOf(e);this.Tu.splice(n,1)}}function nv(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class Jr extends ou{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new tv,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new tv(e),this._firestoreClient=void 0,await e}}}function AA(t,e){const n=typeof t=="object"?t:F_(),r=typeof t=="string"?t:e||"(default)",s=Of(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=nS("firestore");i&&kA(s,...i)}return s}function au(t){if(t._terminated)throw new J($.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||RA(t),t._firestoreClient}function RA(t){var e,n,r;const s=t._freezeSettings(),i=function(l,c,d,f){return new cN(l,c,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,NE(f.experimentalLongPollingOptions),f.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new bA(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Di(pt.fromBase64String(e))}catch(n){throw new J($.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Di(pt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lu{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new J($.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ut(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _p{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new J($.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new J($.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return we(this._lat,e._lat)||we(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wp{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jA=/^__.*__$/;class DA{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new rs(e,this.data,this.fieldMask,n,this.fieldTransforms):new Pa(e,this.data,n,this.fieldTransforms)}}class AE{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new rs(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function RE(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw oe()}}class Ep{constructor(e,n,r,s,i,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Ep(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Sc(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(RE(this.Cu)&&jA.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class MA{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||nu(e)}Qu(e,n,r,s=!1){return new Ep({Cu:e,methodName:n,qu:r,path:ut.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function xp(t){const e=t._freezeSettings(),n=nu(t._databaseId);return new MA(t._databaseId,!!e.ignoreUndefinedProperties,n)}function OA(t,e,n,r,s,i={}){const o=t.Qu(i.merge||i.mergeFields?2:0,e,n,s);bp("Data must be an object, but it was:",o,r);const l=jE(r,o);let c,d;if(i.merge)c=new Kt(o.fieldMask),d=o.fieldTransforms;else if(i.mergeFields){const f=[];for(const m of i.mergeFields){const y=Mh(e,m,n);if(!o.contains(y))throw new J($.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);ME(f,y)||f.push(y)}c=new Kt(f),d=o.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,d=o.fieldTransforms;return new DA(new Ut(l),c,d)}class uu extends cu{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof uu}}class Tp extends cu{_toFieldTransform(e){return new DN(e.path,new ua)}isEqual(e){return e instanceof Tp}}function LA(t,e,n,r){const s=t.Qu(1,e,n);bp("Data must be an object, but it was:",s,r);const i=[],o=Ut.empty();Ls(r,(c,d)=>{const f=Ip(e,c,n);d=Ke(d);const m=s.Nu(f);if(d instanceof uu)i.push(f);else{const y=Ra(d,m);y!=null&&(i.push(f),o.set(f,y))}});const l=new Kt(i);return new AE(o,l,s.fieldTransforms)}function VA(t,e,n,r,s,i){const o=t.Qu(1,e,n),l=[Mh(e,r,n)],c=[s];if(i.length%2!=0)throw new J($.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<i.length;y+=2)l.push(Mh(e,i[y])),c.push(i[y+1]);const d=[],f=Ut.empty();for(let y=l.length-1;y>=0;--y)if(!ME(d,l[y])){const I=l[y];let N=c[y];N=Ke(N);const j=o.Nu(I);if(N instanceof uu)d.push(I);else{const A=Ra(N,j);A!=null&&(d.push(I),f.set(I,A))}}const m=new Kt(d);return new AE(f,m,o.fieldTransforms)}function UA(t,e,n,r=!1){return Ra(n,t.Qu(r?4:3,e))}function Ra(t,e){if(DE(t=Ke(t)))return bp("Unsupported field value:",e,t),jE(t,e);if(t instanceof cu)return function(r,s){if(!RE(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const l of r){let c=Ra(l,s.Lu(o));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=Ke(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return AN(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Ze.fromDate(r);return{timestampValue:xc(s.serializer,i)}}if(r instanceof Ze){const i=new Ze(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:xc(s.serializer,i)}}if(r instanceof _p)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Di)return{bytesValue:rE(s.serializer,r._byteString)};if(r instanceof Mt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:rp(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof wp)return function(o,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw l.Bu("VectorValues must only contain numeric values.");return Zf(l.serializer,c)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${iu(r)}`)}(t,e)}function jE(t,e){const n={};return Rw(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ls(t,(r,s)=>{const i=Ra(s,e.Mu(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function DE(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Ze||t instanceof _p||t instanceof Di||t instanceof Mt||t instanceof cu||t instanceof wp)}function bp(t,e,n){if(!DE(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const r=iu(n);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function Mh(t,e,n){if((e=Ke(e))instanceof lu)return e._internalPath;if(typeof e=="string")return Ip(t,e);throw Sc("Field path arguments must be of type string or ",t,!1,void 0,n)}const FA=new RegExp("[~\\*/\\[\\]]");function Ip(t,e,n){if(e.search(FA)>=0)throw Sc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new lu(...e.split("."))._internalPath}catch{throw Sc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Sc(t,e,n,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new J($.INVALID_ARGUMENT,l+t+c)}function ME(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OE{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Mt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new $A(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Sp("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class $A extends OE{data(){return super.data()}}function Sp(t,e){return typeof e=="string"?Ip(t,e):e instanceof lu?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LE(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new J($.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Cp{}class BA extends Cp{}function Xt(t,e,...n){let r=[];e instanceof Cp&&r.push(e),r=r.concat(n),function(i){const o=i.filter(c=>c instanceof Pp).length,l=i.filter(c=>c instanceof du).length;if(o>1||o>0&&l>0)throw new J($.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class du extends BA{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new du(e,n,r)}_apply(e){const n=this._parse(e);return VE(e._query,n),new Us(e.firestore,e.converter,Ih(e._query,n))}_parse(e){const n=xp(e.firestore);return function(i,o,l,c,d,f,m){let y;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new J($.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){sv(m,f);const I=[];for(const N of m)I.push(rv(c,i,N));y={arrayValue:{values:I}}}else y=rv(c,i,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||sv(m,f),y=UA(l,o,m,f==="in"||f==="not-in");return qe.create(d,f,y)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function kt(t,e,n){const r=e,s=Sp("where",t);return du._create(s,r,n)}class Pp extends Cp{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Pp(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:bn.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let o=s;const l=i.getFlattenedFilters();for(const c of l)VE(o,c),o=Ih(o,c)}(e._query,n),new Us(e.firestore,e.converter,Ih(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function rv(t,e,n){if(typeof(n=Ke(n))=="string"){if(n==="")throw new J($.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!$w(e)&&n.indexOf("/")!==-1)throw new J($.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(ke.fromString(n));if(!te.isDocumentKey(r))throw new J($.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return by(t,new te(r))}if(n instanceof Mt)return by(t,n._key);throw new J($.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${iu(n)}.`)}function sv(t,e){if(!Array.isArray(t)||t.length===0)throw new J($.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function VE(t,e){const n=function(s,i){for(const o of s)for(const l of o.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new J($.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new J($.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class zA{convertValue(e,n="none"){switch(As(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Be(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(ks(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw oe()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Ls(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var n,r,s;const i=(s=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Be(o.doubleValue));return new wp(i)}convertGeoPoint(e){return new _p(Be(e.latitude),Be(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Qf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(aa(e));default:return null}}convertTimestamp(e){const n=Yr(e);return new Ze(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=ke.fromString(e);Ie(cE(r));const s=new la(r.get(1),r.get(3)),i=new te(r.popFirst(5));return s.isEqual(n)||cr(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WA(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class UE extends OE{constructor(e,n,r,s,i,o){super(e,n,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Ll(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Sp("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class Ll extends UE{data(e={}){return super.data(e)}}class FE{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new To(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Ll(this._firestore,this._userDataWriter,r.key,r,new To(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new J($.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(l=>{const c=new Ll(s._firestore,s._userDataWriter,l.doc.key,l.doc,new To(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const c=new Ll(s._firestore,s._userDataWriter,l.doc.key,l.doc,new To(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return l.type!==0&&(d=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),f=o.indexOf(l.doc.key)),{type:HA(l.type),doc:c,oldIndex:d,newIndex:f}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function HA(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return oe()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fs(t){t=sn(t,Mt);const e=sn(t.firestore,Jr);return CA(au(e),t._key).then(n=>$E(e,t,n))}class Np extends zA{constructor(e){super(),this.firestore=e}convertBytes(e){return new Di(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Mt(this.firestore,null,n)}}function In(t){t=sn(t,Us);const e=sn(t.firestore,Jr),n=au(e),r=new Np(e);return LE(t._query),PA(n,t._query).then(s=>new FE(e,r,t,s))}function ln(t,e,n,...r){t=sn(t,Mt);const s=sn(t.firestore,Jr),i=xp(s);let o;return o=typeof(e=Ke(e))=="string"||e instanceof lu?VA(i,"updateDoc",t._key,e,n,r):LA(i,"updateDoc",t._key,e),Ap(s,[o.toMutation(t._key,En.exists(!0))])}function hd(t){return Ap(sn(t.firestore,Jr),[new ep(t._key,En.none())])}function ja(t,e){const n=sn(t.firestore,Jr),r=mt(t),s=WA(t.converter,e);return Ap(n,[OA(xp(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,En.exists(!1))]).then(()=>r)}function kp(t,...e){var n,r,s;t=Ke(t);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||nv(e[o])||(i=e[o],o++);const l={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(nv(e[o])){const m=e[o];e[o]=(n=m.next)===null||n===void 0?void 0:n.bind(m),e[o+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[o+2]=(s=m.complete)===null||s===void 0?void 0:s.bind(m)}let c,d,f;if(t instanceof Mt)d=sn(t.firestore,Jr),f=Yc(t._key.path),c={next:m=>{e[o]&&e[o]($E(d,t,m))},error:e[o+1],complete:e[o+2]};else{const m=sn(t,Us);d=sn(m.firestore,Jr),f=m._query;const y=new Np(d);c={next:I=>{e[o]&&e[o](new FE(d,y,m,I))},error:e[o+1],complete:e[o+2]},LE(t._query)}return function(y,I,N,j){const A=new vp(j),T=new gp(I,A,N);return y.asyncQueue.enqueueAndForget(async()=>fp(await Ic(y),T)),()=>{A.Za(),y.asyncQueue.enqueueAndForget(async()=>pp(await Ic(y),T))}}(au(d),f,l,c)}function Ap(t,e){return function(r,s){const i=new nr;return r.asyncQueue.enqueueAndForget(async()=>gA(await SA(r),s,i)),i.promise}(au(t),e)}function $E(t,e,n){const r=n.docs.get(e._key),s=new Np(t);return new UE(t,s,e._key,r,new To(n.hasPendingWrites,n.fromCache),e.converter)}function Le(){return new Tp("serverTimestamp")}(function(e,n=!0){(function(s){Bi=s})(Fi),Ci(new Ss("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),l=new Jr(new KP(r.getProvider("auth-internal")),new JP(r.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new J($.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new la(d.options.projectId,f)}(o,s),o);return i=Object.assign({useFetchStreams:n},i),l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),Hr(_y,"4.7.3",e),Hr(_y,"4.7.3","esm2017")})();const qA={apiKey:"AIzaSyB_1Dn63ZHRnA-jXytu95WEBWNFQ64Jo_E",authDomain:"dnd-v1-17acc.firebaseapp.com",projectId:"dnd-v1-17acc",storageBucket:"dnd-v1-17acc.firebasestorage.app",messagingSenderId:"976056329393",appId:"1:976056329393:web:7c8170e906162fe4ef2e90"},BE=U_(qA),Rs=BP(BE),ge=AA(BE),GA=async(t,e)=>{try{const n={...e,userId:t,createdAt:Le(),updatedAt:Le()};return{id:(await ja(it(ge,"userProfiles"),n)).id,...n}}catch(n){throw console.error("Error creating user profile:",n),n}},Hi=async t=>{try{const e=Xt(it(ge,"userProfiles"),kt("userId","==",t)),n=await In(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting user profile:",e),e}},zE=async t=>{try{if(!t||t.length===0)return[];const e=[];for(let s=0;s<t.length;s+=10){const i=t.slice(s,s+10),o=Xt(it(ge,"userProfiles"),kt("userId","in",i));e.push(In(o))}const n=await Promise.all(e),r=[];return n.forEach(s=>{s.docs.forEach(i=>{r.push({id:i.id,...i.data()})})}),r}catch(e){throw console.error("Error getting user profiles:",e),e}},KA=async t=>{try{const e=Xt(it(ge,"userProfiles"),kt("username","==",t));return(await In(e)).empty}catch(e){throw console.error("Error checking username availability:",e),e}},QA=async(t,e,n)=>{try{const r={...n,userId:t,partyId:e,createdAt:Le(),updatedAt:Le()};return{id:(await ja(it(ge,"characters"),r)).id,...r}}catch(r){throw console.error("Error saving character:",r),r}},WE=async(t,e)=>{try{const n=Xt(it(ge,"characters"),kt("userId","==",t),kt("partyId","==",e)),r=await In(n);if(r.empty)return null;const s=r.docs[0];return{id:s.id,...s.data()}}catch(n){throw console.error("Error getting character by user and party:",n),n}},Rp=async t=>{try{const e=Xt(it(ge,"characters"),kt("partyId","==",t));return(await In(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){throw console.error("Error getting party characters:",e),e}},YA=async(t,e)=>{try{const n=mt(ge,"characters",t);await ln(n,{...e,updatedAt:Le()})}catch(n){throw console.error("Error updating character:",n),n}},XA=async(t,e)=>{try{const n={...e,dmId:t,members:[t],createdAt:Le(),updatedAt:Le()};return{id:(await ja(it(ge,"parties"),n)).id,...n}}catch(n){throw console.error("Error creating party:",n),n}},jp=async t=>{try{const e=Xt(it(ge,"parties"),kt("members","array-contains",t));return(await In(e)).docs.map(s=>{const i=s.data();return{id:s.id,...i}})}catch(e){throw e}},JA=async(t,e)=>{try{const n=mt(ge,"parties",t),r=await Fs(n);if(!r.exists())throw new Error("Party not found");const s=r.data();if(s.members.includes(e))throw new Error("User already in party");await ln(n,{members:[...s.members,e],updatedAt:Le()})}catch(n){throw console.error("Error joining party:",n),n}},ZA=async(t,e)=>{try{const n=mt(ge,"parties",t),r=await Fs(n);if(!r.exists())throw new Error("Party not found");if(r.data().dmId!==e)throw new Error("Only the party leader can disband the party");await hd(n);const i=Xt(it(ge,"characters"),kt("partyId","==",t)),l=(await In(i)).docs.map(m=>hd(m.ref));await Promise.all(l);const c=Xt(it(ge,"campaignStories"),kt("partyId","==",t)),f=(await In(c)).docs.map(m=>hd(m.ref));await Promise.all(f)}catch(n){throw console.error("Error disbanding party:",n),n}},eR=async t=>{try{const e=Xt(it(ge,"parties"),kt("inviteCode","==",t)),n=await In(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting party by invite code:",e),e}},HE=async t=>{try{const e=mt(ge,"parties",t),n=await Fs(e);return n.exists()?{id:n.id,...n.data()}:null}catch(e){throw console.error("Error getting party by ID:",e),e}},tR=async t=>{try{const e={partyId:t,status:"ready_up",currentPlot:null,storyMessages:[],votingSession:null,readyPlayers:[],lastUpdated:Le(),createdAt:Le()};return{id:(await ja(it(ge,"campaignStories"),e)).id,...e}}catch(e){throw console.error("Error creating campaign story:",e),e}},nR=async t=>{try{const e=Xt(it(ge,"campaignStories"),kt("partyId","==",t)),n=await In(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting campaign story:",e),e}},yn=async(t,e)=>{try{const n=mt(ge,"campaignStories",t);await ln(n,{...e,lastUpdated:Le()})}catch(n){throw console.error("Error updating campaign story:",n),n}},fd=async(t,e)=>{try{const n=mt(ge,"campaignStories",t),s=(await Fs(n)).data(),i={id:`msg_${Date.now()}`,...e,timestamp:new Date};return await ln(n,{storyMessages:[...s.storyMessages,i],lastUpdated:Le()}),i}catch(n){throw console.error("Error adding story message:",n),n}},rR=async(t,e)=>{try{const n=mt(ge,"campaignStories",t),i=(await Fs(n)).data().readyPlayers||[];i.includes(e)||await ln(n,{readyPlayers:[...i,e],lastUpdated:Le()})}catch(n){throw console.error("Error setting player ready:",n),n}},sR=(t,e)=>{try{const n=mt(ge,"campaignStories",t);return kp(n,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})}catch(n){throw console.error("Error subscribing to campaign story:",n),n}},iv=async(t,e)=>{try{const n=mt(ge,"campaignStories",t);await ln(n,{currentSpeaker:e,lastUpdated:Le()})}catch(n){throw console.error("Error setting current speaker:",n),n}},pd=async(t,e)=>{try{const n=mt(ge,"campaignStories",t);await ln(n,{currentController:e,lastUpdated:Le()})}catch(n){throw console.error("Error setting current controller:",n),n}},iR=async(t,e)=>{try{const n={partyId:t,status:"active",storyContext:e.storyContext,partyMembers:e.partyMembers,enemies:e.enemies,initiative:e.initiative,currentTurn:0,combatState:"preparation",createdAt:Le(),updatedAt:Le()};return{id:(await ja(it(ge,"combatSessions"),n)).id,...n}}catch(n){throw console.error("Error creating combat session:",n),n}},qE=async t=>{try{const e=Xt(it(ge,"combatSessions"),kt("partyId","==",t),kt("status","==","active")),n=await In(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){throw console.error("Error getting combat session:",e),e}},oR=async(t,e)=>{try{const n=mt(ge,"combatSessions",t);await ln(n,{...e,updatedAt:Le()})}catch(n){throw console.error("Error updating combat session:",n),n}},GE=(t,e)=>{try{const n=Xt(it(ge,"combatSessions"),kt("partyId","==",t),kt("status","==","active"));return kp(n,r=>{if(r.empty)e(null);else{const s=r.docs[0];e({id:s.id,...s.data()})}})}catch(n){throw console.error("Error subscribing to combat session:",n),n}},aR=async(t,e)=>{try{console.log("saveCharacterPreset called with:",{userId:t,presetData:e});const n=await Hi(t);if(console.log("User profile retrieved:",n),!n)throw console.error("User profile not found for userId:",t),new Error("User profile not found");const r={id:Date.now().toString(),name:e.name,data:e.data,createdAt:new Date};console.log("Created preset object:",r);const s=n.characterPresets||[];console.log("Existing presets:",s);const i=[...s,r];console.log("Updated presets array:",i);const o=mt(ge,"userProfiles",n.id);return console.log("Updating profile with ID:",n.id),await ln(o,{characterPresets:i,updatedAt:Le()}),console.log("Profile updated successfully"),r}catch(n){throw console.error("Error saving character preset:",n),console.error("Error details:",{message:n.message,code:n.code,stack:n.stack}),n}},Oh=async t=>{try{const e=await Hi(t);return e?e.characterPresets||[]:[]}catch(e){throw console.error("Error getting user character presets:",e),e}},KE=async(t,e)=>{try{const n=await Hi(t);if(!n)throw new Error("User profile not found");const s=(n.characterPresets||[]).filter(o=>o.id!==e),i=mt(ge,"userProfiles",n.id);await ln(i,{characterPresets:s,updatedAt:Le()})}catch(n){throw console.error("Error deleting character preset:",n),n}},lR=async t=>{try{const e=mt(ge,"campaignStories",t);return(await Fs(e)).data().storyState||null}catch(e){throw console.error("Error getting story state:",e),e}},cR=async(t,e)=>{try{const n=mt(ge,"campaignStories",t),o={...(await Fs(n)).data().storyState||{},...e,lastUpdated:Le()};return await ln(n,{storyState:o,lastUpdated:Le()}),o}catch(n){throw console.error("Error updating story state:",n),n}},Gs=async(t,e)=>{try{const n=mt(ge,"combatSessions",t);await ln(n,{...e,updatedAt:Le()})}catch(n){throw console.error("Error updating combat session with narrative:",n),n}},uR=async(t,e,n)=>{try{if(console.log("Starting registration for:",t,n),!await KA(n))return console.log("Username not available:",n),{user:null,error:"Username is already taken. Please choose a different username."};console.log("Username available:",n);const s=await S1(Rs,t,e);console.log("User created successfully:",s.user.uid);try{await GA(s.user.uid,{username:n,email:t,displayName:n}),console.log("User profile created successfully")}catch(o){console.error("Error creating user profile:",o)}let i=!1;try{await P1(s.user),console.log("Email verification sent successfully"),i=!0}catch(o){console.error("Error sending email verification:",o)}return await fw(Rs),console.log("User signed out after registration"),{user:null,error:null,success:!0}}catch(r){return console.error("Registration error:",r),{user:null,error:r.message}}},dR=async(t,e)=>{try{return{user:(await C1(Rs,t,e)).user,error:null}}catch(n){return{user:null,error:n.message}}},hR=async()=>{try{return await fw(Rs),{error:null}}catch(t){return{error:t.message}}},ss=t=>A1(Rs,async e=>{t(e)}),fR=async()=>{try{return console.log("Testing Firebase connection..."),console.log("Auth domain:",Rs.config.authDomain),console.log("Project ID:",Rs.config.projectId),{success:!0,message:"Firebase connection successful"}}catch(t){return console.error("Firebase connection test failed:",t),{success:!1,error:t.message}}};function pR(){const[t,e]=D.useState(null),[n,r]=D.useState(null),[s,i]=D.useState(!1),o=zn();D.useEffect(()=>{const d=ss(async f=>{if(e(f),f)try{const m=await Hi(f.uid);r(m)}catch(m){console.error("Error loading user profile:",m)}else r(null)});return()=>d()},[]);const l=async()=>{const{error:d}=await hR();d||o("/")},c=(n==null?void 0:n.username)||(t==null?void 0:t.email);return u.jsx("nav",{className:"bg-stone-800 text-white shadow-lg",children:u.jsx("div",{className:"fantasy-container",children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx(gs,{to:"/",className:"text-2xl font-bold font-['Cinzel']",children:"DND-V1"}),u.jsx("div",{className:"flex items-center space-x-4",children:t?u.jsxs(u.Fragment,{children:[u.jsx(gs,{to:"/dashboard",className:"fantasy-button",children:"Dashboard"}),u.jsx(gs,{to:"/party-management",className:"fantasy-button",children:"Parties"}),u.jsxs("div",{className:"relative",children:[u.jsx("button",{onClick:()=>i(!s),className:"fantasy-button bg-stone-700 hover:bg-stone-600",children:c}),s&&u.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-stone-200 z-50",children:u.jsxs("div",{className:"py-2",children:[u.jsxs("div",{className:"px-4 py-2 text-sm text-stone-700 border-b border-stone-200",children:[u.jsx("div",{className:"font-medium",children:c}),u.jsx("div",{className:"text-xs text-stone-500",children:t.email})]}),u.jsx("button",{onClick:l,className:"w-full text-left px-4 py-2 text-sm text-stone-700 hover:bg-stone-100",children:"Logout"})]})})]})]}):u.jsx(gs,{to:"/login",className:"fantasy-button",children:"Login"})})]})})})}function mR(){return u.jsxs("div",{className:"relative overflow-hidden",children:[u.jsx("div",{className:"fantasy-container",children:u.jsxs("div",{className:"relative z-10 py-8 sm:py-16 lg:py-24 text-center",children:[u.jsx("h1",{className:"fantasy-title text-5xl sm:text-6xl lg:text-7xl",children:"Manage your D&D world like a real adventurer's tome"}),u.jsx("p",{className:"fantasy-subtitle max-w-2xl mx-auto",children:"Create parties, invite friends, and share story objectives in a beautifully crafted digital environment that feels like a magical grimoire."}),u.jsxs("div",{className:"mt-8 flex justify-center space-x-6",children:[u.jsx(gs,{to:"/register",className:"fantasy-button text-lg px-8 py-3",children:"Start Your Journey"}),u.jsx(gs,{to:"/login",className:"fantasy-button text-lg px-8 py-3 bg-stone-600 hover:bg-stone-700",children:"Return to Campaign"})]})]})}),u.jsx("div",{className:"absolute inset-0 bg-stone-200/10 pattern-grid-lg"})]})}function gR(){return u.jsxs("div",{children:[u.jsx(mR,{}),u.jsx("div",{className:"fantasy-container py-16",children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[u.jsxs("div",{className:"fantasy-card",children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Create Parties"}),u.jsx("p",{className:"text-stone-600",children:"Form adventuring parties with your friends and manage your campaign together in a shared space."})]}),u.jsxs("div",{className:"fantasy-card",children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Track Objectives"}),u.jsx("p",{className:"text-stone-600",children:"Keep track of your party's quests, storylines, and achievements in an organized magical tome."})]}),u.jsxs("div",{className:"fantasy-card",children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Share Stories"}),u.jsx("p",{className:"text-stone-600",children:"Document your adventures and share them with your fellow party members in an immersive fantasy setting."})]})]})})]})}function yR(){const[t,e]=D.useState(""),[n,r]=D.useState(""),[s,i]=D.useState(!1),[o,l]=D.useState(""),[c,d]=D.useState(""),f=zn(),m=Ui();D.useEffect(()=>{var N;(N=m.state)!=null&&N.message&&(d(m.state.message),f(m.pathname,{replace:!0}));const I=ss(j=>{j&&f("/dashboard")});return()=>I()},[f,m]);const y=async I=>{I.preventDefault(),i(!0),l("");const N=await dR(t,n);N.error&&(N.error.includes("auth/invalid-credential")?l("Invalid email or password. Please check your credentials or register a new account."):N.error.includes("auth/user-not-found")?l("No account found with this email. Please register first."):N.error.includes("auth/wrong-password")?l("Incorrect password. Please try again."):N.error.includes("auth/user-disabled")?l("This account has been disabled. Please contact support."):N.error.includes("auth/too-many-requests")?l("Too many failed login attempts. Please try again later."):l(N.error)),i(!1)};return u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card max-w-md mx-auto",children:[u.jsx("h1",{className:"fantasy-title text-center",children:"Login"}),c&&u.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-4",children:c}),u.jsxs("form",{onSubmit:y,className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Email"}),u.jsx("input",{type:"email",value:t,onChange:I=>e(I.target.value),className:"fantasy-input",required:!0})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Password"}),u.jsx("input",{type:"password",value:n,onChange:I=>r(I.target.value),className:"fantasy-input",required:!0})]}),o&&u.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg",children:o}),u.jsx("button",{type:"submit",disabled:s,className:"fantasy-button w-full",children:s?"Logging in...":"Login"})]}),u.jsx("div",{className:"mt-6 text-center",children:u.jsxs("p",{className:"text-stone-600",children:["Don't have an account?"," ",u.jsx("button",{onClick:()=>f("/register"),className:"text-amber-700 hover:text-amber-800 font-medium",children:"Register here"})]})})]})})}function vR(){const[t,e]=D.useState(""),[n,r]=D.useState(""),[s,i]=D.useState(""),[o,l]=D.useState(""),[c,d]=D.useState(""),[f,m]=D.useState(""),y=zn();D.useEffect(()=>{fR().then(N=>{console.log("Firebase test result:",N)})},[]);const I=async N=>{if(N.preventDefault(),d(""),m(""),s!==o){d("Passwords do not match");return}if(!n.trim()){d("Username is required");return}if(n.length<3){d("Username must be at least 3 characters long");return}if(!/^[a-zA-Z0-9_]+$/.test(n)){d("Username can only contain letters, numbers, and underscores");return}console.log("Submitting registration for:",t,n);const{user:j,error:A,success:T}=await uR(t,s,n);if(console.log("Registration result:",{user:j,error:A,success:T}),A){console.log("Setting error:",A),d(A);return}T?(console.log("Registration successful, redirecting to login"),y("/login",{state:{message:"Registration successful! Please check your email to verify your account before logging in."}})):console.log("No success received from registration")};return u.jsx("div",{className:"fantasy-container min-h-screen flex items-center justify-center",children:u.jsxs("div",{className:"fantasy-card w-full max-w-md",children:[u.jsx("h2",{className:"fantasy-title text-center",children:"Begin Your Adventure"}),c&&u.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:c}),f&&u.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:f}),u.jsxs("form",{onSubmit:I,className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-stone-700",children:"Username"}),u.jsx("input",{id:"username",type:"text",required:!0,value:n,onChange:N=>r(N.target.value),className:"fantasy-input mt-1",placeholder:"Choose a unique username"}),u.jsx("p",{className:"text-xs text-stone-500 mt-1",children:"Letters, numbers, and underscores only. 3+ characters."})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-stone-700",children:"Email"}),u.jsx("input",{id:"email",type:"email",required:!0,value:t,onChange:N=>e(N.target.value),className:"fantasy-input mt-1"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-stone-700",children:"Password"}),u.jsx("input",{id:"password",type:"password",required:!0,value:s,onChange:N=>i(N.target.value),className:"fantasy-input mt-1"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-stone-700",children:"Confirm Password"}),u.jsx("input",{id:"confirmPassword",type:"password",required:!0,value:o,onChange:N=>l(N.target.value),className:"fantasy-input mt-1"})]}),u.jsx("button",{type:"submit",className:"fantasy-button w-full",children:"Register"})]}),u.jsxs("p",{className:"mt-4 text-center text-sm text-stone-600",children:["Already have an account?"," ",u.jsx(gs,{to:"/login",className:"text-amber-700 hover:text-amber-800",children:"Return to your campaign"})]})]})})}class _R{constructor(){this.actionTypes={attack:{name:"Attack",cooldown:0,priority:"normal",description:"A basic physical attack",narrativeTemplate:"{character} {action} with {weapon}!"},spell:{name:"Cast Spell",cooldown:1,priority:"normal",description:"Cast a magical spell",narrativeTemplate:"{character} channels arcane energy into {spell}!"},special:{name:"Special Ability",cooldown:2,priority:"high",description:"Use a special class ability",narrativeTemplate:"{character} unleashes their {ability}!"},item:{name:"Use Item",cooldown:0,priority:"low",description:"Use an item or consumable",narrativeTemplate:"{character} uses {item}!"},defend:{name:"Defend",cooldown:0,priority:"high",description:"Take a defensive stance",narrativeTemplate:"{character} takes a defensive stance!"},environmental:{name:"Environmental Action",cooldown:1,priority:"normal",description:"Use the environment to your advantage",narrativeTemplate:"{character} uses the {environment} to their advantage!"},teamUp:{name:"Team Up",cooldown:3,priority:"high",description:"Coordinate with another party member",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}},this.statusEffects={poisoned:{name:"Poisoned",duration:3,effect:"lose 1 HP per turn",narrative:"is suffering from poison"},burned:{name:"Burned",duration:2,effect:"lose 2 HP per turn",narrative:"is burning with magical flames"},frozen:{name:"Frozen",duration:1,effect:"skip next turn",narrative:"is frozen solid"},paralyzed:{name:"Paralyzed",duration:2,effect:"50% chance to skip turn",narrative:"is paralyzed and can barely move"},confused:{name:"Confused",duration:2,effect:"may attack randomly",narrative:"is confused and disoriented"},blessed:{name:"Blessed",duration:3,effect:"+2 to attack rolls",narrative:"is blessed with divine favor"},hasted:{name:"Hasted",duration:2,effect:"extra action per turn",narrative:"is moving with supernatural speed"}},this.classAbilities={fighter:{name:"Second Wind",description:"Recover some HP",effect:"heal 1d6+2 HP",cooldown:3},wizard:{name:"Arcane Surge",description:"Enhance next spell",effect:"+2 to spell damage",cooldown:2},rogue:{name:"Sneak Attack",description:"Deal extra damage from stealth",effect:"+1d6 damage if target is unaware",cooldown:1},cleric:{name:"Divine Favor",description:"Bless an ally",effect:"target gets +1 to all rolls",cooldown:2}}}initializeCombat(e,n,r){return{combatants:[...e,...n].map(o=>({...o,initiative:this.calculateInitiative(o),statusEffects:[],cooldowns:{},lastAction:null,turnCount:0})).sort((o,l)=>l.initiative-o.initiative),currentTurn:0,round:1,phase:"preparation",storyContext:r,environmentalFeatures:this.extractEnvironmentalFeatures(r),teamUpOpportunities:this.identifyTeamUpOpportunities(e),narrativeElements:this.extractNarrativeElements(r)}}calculateInitiative(e){var s,i,o;let n=Math.floor(Math.random()*20)+1;return n+={rogue:3,monk:2,ranger:1,fighter:0,cleric:0,wizard:-1,paladin:-1}[(s=e.class)==null?void 0:s.toLowerCase()]||0,(i=e.statusEffects)!=null&&i.includes("hasted")&&(n+=5),(o=e.statusEffects)!=null&&o.includes("paralyzed")&&(n-=3),n}extractEnvironmentalFeatures(e){const n=[],r={forest:["trees","cover","difficult terrain"],cave:["darkness","echoes","tight spaces"],tavern:["furniture","crowds","flammable materials"],castle:["stone walls","narrow corridors","defensive positions"],dungeon:["traps","darkness","confined spaces"],outdoors:["weather","open space","natural cover"]},s=e.toLowerCase();return Object.entries(r).forEach(([i,o])=>{s.includes(i)&&n.push(...o)}),n}identifyTeamUpOpportunities(e){const n=[];return[{classes:["fighter","rogue"],description:"Fighter distracts while Rogue sneaks in for a backstab"},{classes:["wizard","cleric"],description:"Wizard casts area spell while Cleric protects the party"},{classes:["fighter","cleric"],description:"Fighter tanks while Cleric provides healing support"},{classes:["rogue","wizard"],description:"Rogue scouts while Wizard provides magical backup"}].forEach(s=>{s.classes.every(o=>e.some(l=>{var c;return((c=l.class)==null?void 0:c.toLowerCase())===o}))&&n.push(s)}),n}extractNarrativeElements(e){return{mood:this.determineCombatMood(e),stakes:this.determineStakes(e),environmentalHazards:this.identifyHazards(e),npcInvolvement:this.extractNPCs(e)}}determineCombatMood(e){const n=e.toLowerCase();return n.includes("desperate")||n.includes("last stand")?"desperate":n.includes("training")||n.includes("practice")?"casual":n.includes("revenge")||n.includes("vengeance")?"vengeful":n.includes("defense")||n.includes("protect")?"defensive":"standard"}determineStakes(e){const n=e.toLowerCase();return n.includes("life")||n.includes("death")||n.includes("kill")?"life_or_death":n.includes("escape")||n.includes("flee")?"escape":n.includes("capture")||n.includes("arrest")?"capture":n.includes("treasure")||n.includes("loot")?"treasure":"standard"}identifyHazards(e){const n=[],r=e.toLowerCase();return(r.includes("fire")||r.includes("flame"))&&n.push("fire"),(r.includes("water")||r.includes("river")||r.includes("lake"))&&n.push("water"),(r.includes("height")||r.includes("cliff")||r.includes("fall"))&&n.push("height"),(r.includes("trap")||r.includes("pit"))&&n.push("traps"),n}extractNPCs(e){const n=[];return[/(\w+)\s+(?:the\s+)?(?:guard|merchant|wizard|knight|rogue|priest)/gi,/(?:named|called)\s+(\w+)/gi].forEach(s=>{[...e.matchAll(s)].forEach(o=>{n.push(o[1])})}),n}async executeAction(e,n,r,s,i={}){const o=e.combatants.find(m=>m.id===n),l=e.combatants.find(m=>m.id===s);if(!o||!l)throw new Error("Invalid combatant or target");if(o.cooldowns[r]>0)return{success:!1,message:`${o.name} cannot use ${r} yet (cooldown: ${o.cooldowns[r]} turns)`};const c=this.generateActionNarrative(o,r,l,i),d=this.calculateActionResults(o,r,l,i);this.applyActionEffects(e,o,l,d),this.updateCooldowns(e,o,r);const f=this.checkStatusEffectApplication(o,r,l,d);return{success:!0,narrative:c,results:d,statusEffects:f,environmentalImpact:this.calculateEnvironmentalImpact(e,r,d)}}generateActionNarrative(e,n,r,s){let o=this.actionTypes[n].narrativeTemplate;o=o.replace("{character}",e.name),o=o.replace("{action}",this.getActionVerb(n,e.class)),o=o.replace("{weapon}",s.weapon||"their weapon"),o=o.replace("{spell}",s.spell||"a spell"),o=o.replace("{ability}",s.ability||"special ability"),o=o.replace("{item}",s.item||"an item"),o=o.replace("{environment}",s.environment||"surroundings"),o=o.replace("{ally}",s.ally||"ally");const l=this.getClassFlavor(e.class,n);return l&&(o+=` ${l}`),o}getActionVerb(e,n){var s;return((s={fighter:{attack:"charges forward with a mighty swing",defend:"raises their shield defensively",special:"unleashes their combat expertise"},wizard:{attack:"casts a magical bolt",spell:"weaves arcane energy",special:"channels pure magical power"},rogue:{attack:"strikes from the shadows",defend:"dodges and weaves",special:"executes a perfect sneak attack"},cleric:{attack:"calls upon divine power",spell:"prays for divine intervention",special:"channels holy energy"}}[n==null?void 0:n.toLowerCase()])==null?void 0:s[e])||"performs an action"}getClassFlavor(e,n){var s;return((s={fighter:{attack:"The force of the blow echoes through the battlefield.",defend:"Their stance is unbreakable.",special:"Years of training show in their precision."},wizard:{attack:"Arcane energy crackles in the air.",spell:"The very fabric of reality seems to bend.",special:"Ancient knowledge flows through their mind."},rogue:{attack:"The strike is almost too fast to see.",defend:"They seem to flow around the attack.",special:"Perfect timing and deadly precision."},cleric:{attack:"Divine light illuminates the area.",spell:"The gods themselves seem to answer.",special:"Holy power radiates from their form."}}[e==null?void 0:e.toLowerCase()])==null?void 0:s[n])||""}calculateActionResults(e,n,r,s){const i={damage:0,healing:0,statusEffects:[],environmentalEffects:[],narrative:""};switch(n){case"attack":i.damage=this.calculateAttackDamage(e,r,s);break;case"spell":i.damage=this.calculateSpellDamage(e,r,s);break;case"special":i.damage=this.calculateSpecialDamage(e,r,s);break;case"item":i.healing=this.calculateItemEffect(e,r,s);break;case"defend":i.statusEffects.push({type:"defensive",duration:1});break;case"environmental":i.environmentalEffects=this.calculateEnvironmentalEffects(e,r,s);break;case"teamUp":i.damage=this.calculateTeamUpDamage(e,r,s);break}return i}calculateAttackDamage(e,n,r){const s=Math.floor(Math.random()*8)+1,i=Math.floor((e.strength-10)/2),o=r.weaponBonus||0;let l=1;if(e.id.startsWith("enemy_")){l=1+(e.level-1)*.3;const c=this.getEnemyPrimaryAttribute(e.class),d=Math.floor((e[c]-10)/2),f=this.calculateEnemyItemBonus(e);let m=(s+i+o+d+f)*l;return Math.floor(Math.random()*20)+1===20&&(m*=2),console.log(`Enemy damage calculation for ${e.name}:`,{baseDamage:s,strengthMod:i,weaponBonus:o,attributeMod:d,itemBonus:f,levelScaling:l,totalDamage:Math.max(1,Math.floor(m))}),Math.max(1,Math.floor(m))}else{const c=Math.floor((e.dexterity-10)/2),d=Math.floor((e.level-1)*.5);let f=s+i+c+o+d;return Math.floor(Math.random()*20)+1===20&&(f*=2),console.log(`Player damage calculation for ${e.name}:`,{baseDamage:s,strengthMod:i,dexterityMod:c,weaponBonus:o,levelBonus:d,totalDamage:Math.max(1,f)}),Math.max(1,f)}}getEnemyPrimaryAttribute(e){return{Warrior:"strength",Archer:"dexterity",Mage:"intelligence",Cleric:"wisdom",Rogue:"dexterity",Paladin:"strength",Ranger:"dexterity",Wizard:"intelligence",Fighter:"strength"}[e]||"strength"}calculateEnemyItemBonus(e){let n=0;return e.equipment&&(e.equipment.weapon&&(n+=e.equipment.weapon.damageBonus||0),e.equipment.armor&&(n+=e.equipment.armor.defenseBonus||0),e.equipment.accessory&&(n+=e.equipment.accessory.bonus||0)),e.level>3&&(n+=Math.floor((e.level-3)/2)),n}calculateSpellDamage(e,n,r){const s=Math.floor(Math.random()*6)+1,i=Math.floor((e.intelligence-10)/2),o=r.spellLevel||1;if(e.id.startsWith("enemy_")){const l=1+(e.level-1)*.4,c=Math.floor((e.wisdom-10)/2),d=this.calculateEnemyItemBonus(e);let f=(s+i+c+o+d)*l;return Math.floor(Math.random()*20)+1>=19&&(f*=1.5),Math.max(1,Math.floor(f))}else return Math.max(1,s+i+o)}calculateSpecialDamage(e,n,r){var l;if(!this.classAbilities[(l=e.class)==null?void 0:l.toLowerCase()])return 0;const i=Math.floor(Math.random()*10)+2,o=Math.floor((e.level||1)/2);return Math.max(1,i+o)}calculateItemEffect(e,n,r){switch(r.itemType||"potion"){case"healing":return Math.floor(Math.random()*8)+2;case"antidote":return 0;case"blessing":return 0;default:return Math.floor(Math.random()*4)+1}}calculateTeamUpDamage(e,n,r){const s=Math.floor(Math.random()*12)+3;return Math.max(1,s+2)}applyActionEffects(e,n,r,s){s.damage>0&&(r.hp=Math.max(0,r.hp-s.damage)),s.healing>0&&(r.hp=Math.min(r.maxHp,r.hp+s.healing)),s.statusEffects.forEach(i=>{r.statusEffects.includes(i.type)||r.statusEffects.push({type:i.type,duration:i.duration,appliedBy:n.id})})}updateCooldowns(e,n,r){const s=this.actionTypes[r];n.cooldowns[r]=s.cooldown,Object.keys(n.cooldowns).forEach(i=>{i!==r&&n.cooldowns[i]>0&&n.cooldowns[i]--})}checkStatusEffectApplication(e,n,r,s){const i=[];if(s.damage>10){const o=["stunned","bleeding"],l=o[Math.floor(Math.random()*o.length)];r.statusEffects.some(c=>c.type===l)||i.push({type:l,duration:1,appliedBy:e.id})}return i}calculateEnvironmentalImpact(e,n,r){const s=[];return n==="spell"&&r.damage>8&&s.push("The magical energy disturbs the environment"),n==="environmental"&&s.push("The environment responds to the action"),s}processStatusEffects(e,n){const r=[];return n.statusEffects.forEach((s,i)=>{switch(s.duration--,s.type){case"poisoned":n.hp=Math.max(0,n.hp-1),r.push(`${n.name} takes 1 poison damage`);break;case"burned":n.hp=Math.max(0,n.hp-2),r.push(`${n.name} takes 2 burn damage`);break;case"frozen":r.push(`${n.name} is frozen and cannot act`);break;case"paralyzed":Math.random()<.5&&r.push(`${n.name} is paralyzed and cannot act`);break;case"blessed":r.push(`${n.name} is blessed with divine favor`);break;case"hasted":r.push(`${n.name} moves with supernatural speed`);break}s.duration<=0&&(n.statusEffects.splice(i,1),r.push(`${n.name} is no longer ${s.type}`))}),r}checkCombatEnd(e){const n=e.combatants.filter(o=>!o.id.startsWith("enemy_")),r=e.combatants.filter(o=>o.id.startsWith("enemy_")),s=n.some(o=>o.hp>0),i=r.some(o=>o.hp>0);return s?i?{ended:!1}:{ended:!0,result:"victory",narrative:"The enemies have been defeated!"}:{ended:!0,result:"defeat",narrative:"The party has been defeated..."}}generateCombatSummary(e,n){return{result:n,duration:e.round,participants:e.combatants.map(s=>({name:s.name,finalHp:s.hp,actions:s.turnCount,statusEffects:s.statusEffects.length})),narrative:this.generateCombatNarrative(e,n)}}generateCombatNarrative(e,n){const r=e.combatants.filter(s=>!s.id.startsWith("enemy_"));return e.combatants.filter(s=>s.id.startsWith("enemy_")),n==="victory"?`The party emerges victorious from the battle. ${r.map(s=>s.name).join(", ")} stand triumphant over their fallen foes.`:n==="defeat"?"The battle ends in defeat. The party has been overwhelmed by their enemies.":"The battle ends in a draw, with both sides withdrawing to regroup."}chooseEnemyAction(e,n){const r=this.getEnemyAvailableActions(e,n),s=this.getEnemyValidTargets(e,n);return r.length===0||s.length===0?{action:"defend",target:null}:this.makeEnemyDecision(e,r,s,n)}getEnemyAvailableActions(e,n){const r=[],s=e.cooldowns||{};return Object.entries(this.actionTypes).forEach(([i,o])=>{(s[i]===0||s[i]===void 0)&&r.push(i)}),e.class&&this.classAbilities[e.class.toLowerCase()]&&(s.special===0||s.special===void 0)&&r.push("special"),r}getEnemyValidTargets(e,n){return n.combatants.filter(r=>!r.id.startsWith("enemy_")&&r.hp>0)}makeEnemyDecision(e,n,r,s){const i=r[Math.floor(Math.random()*r.length)];if(e.hp/e.maxHp<.3){if(n.includes("item"))return{action:"item",target:e.id,itemType:"healing"};if(n.includes("defend"))return{action:"defend",target:null}}return s.combatants.filter(d=>d.id.startsWith("enemy_")&&d.hp/d.maxHp<.5).length>1&&n.includes("spell")?{action:"spell",target:i.id,spellType:"area"}:n.includes("attack")?{action:"attack",target:i.id}:{action:n[Math.floor(Math.random()*n.length)],target:i.id}}async executeEnemyTurn(e,n){const r=this.chooseEnemyAction(n,e);return r.target?await this.executeAction(e,n.id,r.action,r.target,{itemType:r.itemType,spellType:r.spellType}):await this.executeAction(e,n.id,"defend",n.id)}}const Rn=new _R;function wR(){const[t,e]=D.useState(null),[n,r]=D.useState(null),[s,i]=D.useState([]),[o,l]=D.useState({}),[c,d]=D.useState([]),[f,m]=D.useState(!0),[y,I]=D.useState(!1),N=zn();D.useEffect(()=>{const R=ss(V=>{if(!V){N("/login");return}e(V),j(V.uid)});return()=>R()},[N]);const j=async R=>{try{const[V,_,g]=await Promise.all([jp(R),Hi(R),Oh(R)]);i(V),r(_),d(g),await A(V)}catch(V){console.error("Error loading user data:",V)}finally{m(!1)}},A=async R=>{try{const V=new Set;if(R.forEach(x=>{x.members&&Array.isArray(x.members)&&x.members.forEach(C=>V.add(C))}),V.size===0)return;const _=await zE(Array.from(V)),g={};_.forEach(x=>{g[x.userId]=x});const E={};R.forEach(x=>{x.members&&Array.isArray(x.members)&&(E[x.id]=x.members.map(C=>({userId:C,profile:g[C]||null})))}),l(E)}catch(V){console.error("Error loading party member profiles:",V)}},T=async R=>{if(confirm("Are you sure you want to delete this character preset? This action cannot be undone."))try{await KE(t.uid,R);const V=await Oh(t.uid);d(V),alert("Character preset deleted successfully!")}catch(V){console.error("Error deleting preset:",V),alert("Failed to delete preset. Please try again.")}},w=async()=>{try{const R=await qE("test-combat-party");R&&await oR(R.id,{status:"ended",combatState:"ended"})}catch{console.log("No existing test combat session to clean up")}},S=async()=>{if(t){I(!0);try{await w();const R=[{id:"test-warrior-"+Date.now(),name:"Test Warrior",class:"Fighter",race:"Human",level:3,hp:28,maxHp:28,armorClass:16,strength:16,dexterity:14,constitution:15,intelligence:10,wisdom:12,charisma:8,userId:t.uid,statusEffects:[],cooldowns:{},turnCount:0,lastAction:null},{id:"test-wizard-"+Date.now(),name:"Test Wizard",class:"Wizard",race:"Elf",level:3,hp:18,maxHp:18,armorClass:12,strength:8,dexterity:14,constitution:12,intelligence:16,wisdom:14,charisma:10,userId:t.uid,statusEffects:[],cooldowns:{},turnCount:0,lastAction:null}],V=[{id:"enemy_goblin1",name:"Goblin Warrior",class:"Warrior",level:3,hp:18,maxHp:18,armorClass:15,strength:14,dexterity:12,constitution:13,intelligence:8,wisdom:10,charisma:6,statusEffects:[],cooldowns:{},turnCount:0,lastAction:null,equipment:{weapon:{name:"Rusty Sword",damageBonus:2},armor:{name:"Leather Armor",defenseBonus:1},accessory:{name:"Lucky Charm",bonus:1}}},{id:"enemy_goblin2",name:"Goblin Archer",class:"Archer",level:2,hp:12,maxHp:12,armorClass:13,strength:10,dexterity:16,constitution:9,intelligence:8,wisdom:12,charisma:6,statusEffects:[],cooldowns:{},turnCount:0,lastAction:null,equipment:{weapon:{name:"Short Bow",damageBonus:1},armor:{name:"Hide Armor",defenseBonus:0},accessory:{name:"Sharp Arrow",bonus:1}}},{id:"enemy_goblin3",name:"Goblin Shaman",class:"Mage",level:4,hp:16,maxHp:16,armorClass:11,strength:8,dexterity:10,constitution:11,intelligence:15,wisdom:14,charisma:8,statusEffects:[],cooldowns:{},turnCount:0,lastAction:null,equipment:{weapon:{name:"Ritual Staff",damageBonus:1},armor:{name:"Robe",defenseBonus:0},accessory:{name:"Magic Crystal",bonus:2}}}],_="The party encounters a group of goblins in a dark forest clearing. The goblins have set up an ambush, using the dense underbrush and fallen logs for cover. The air is thick with tension as both sides prepare for battle.",g=Rn.initializeCombat(R,V,_);console.log("Initialized combat data:",g);const E=await iR("test-combat-party",{storyContext:_,partyMembers:g.combatants.filter(x=>!x.id.startsWith("enemy_")),enemies:g.combatants.filter(x=>x.id.startsWith("enemy_")),initiative:g.combatants,environmentalFeatures:g.environmentalFeatures||[],teamUpOpportunities:g.teamUpOpportunities||[],narrativeElements:g.narrativeElements||[],combatState:"active",currentTurn:0,round:1,phase:"active"});console.log("Test combat session created:",E),N("/combat/test-combat-party")}catch(R){console.error("Error starting test combat:",R),alert("Failed to start test combat. Please try again.")}finally{I(!1)}}};if(!t)return null;if(f)return u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsx("div",{className:"text-center py-8",children:u.jsx("div",{className:"text-stone-600",children:"Loading your parties..."})})})});const O=(n==null?void 0:n.username)||t.email;return u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card",children:[u.jsx("div",{className:"flex justify-between items-center mb-6",children:u.jsxs("h1",{className:"fantasy-title mb-0",children:["Welcome, ",O]})}),u.jsxs("div",{className:"mb-8 p-6 bg-red-50 border border-red-200 rounded-lg",children:[u.jsx("h2",{className:"text-xl font-bold text-stone-800 mb-4",children:"⚔️ Combat Testing"}),u.jsx("p",{className:"text-stone-600 mb-4",children:"Test the new Pokemon-style combat system with pre-made characters and goblin enemies."}),u.jsx("button",{onClick:S,disabled:y,className:"fantasy-button bg-red-600 hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:y?"Starting Combat...":"Start Test Combat"})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-6",children:"Your Parties"}),s.length===0?u.jsxs("div",{className:"text-center py-8 text-stone-600",children:[u.jsx("p",{children:"You haven't joined any parties yet."}),u.jsx("p",{className:"text-sm mt-2",children:"Go to the Parties tab to create or join a party!"}),u.jsx("button",{onClick:()=>N("/party-management"),className:"fantasy-button mt-4",children:"Go to Parties"})]}):u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s.map(R=>{var _;const V=o[R.id]||[];return u.jsxs("div",{className:"fantasy-card bg-amber-50",children:[u.jsx("div",{className:"flex justify-between items-start mb-4",children:u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800",children:R.name}),u.jsx("p",{className:"text-stone-600 mt-1",children:R.description}),u.jsxs("p",{className:"text-sm text-stone-500 mt-2",children:[((_=R.members)==null?void 0:_.length)||1,"/",R.maxPlayers," members"]})]})}),u.jsxs("div",{className:"mb-4",children:[u.jsx("h4",{className:"text-sm font-semibold text-stone-700 mb-2",children:"Party Members:"}),u.jsx("div",{className:"space-y-1",children:V.map((g,E)=>{var P;const x=((P=g.profile)==null?void 0:P.username)||`User ${E+1}`,C=g.userId===R.dmId;return u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("span",{className:"text-stone-600",children:x}),C&&u.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),g.userId===(t==null?void 0:t.uid)&&u.jsx("span",{className:"text-blue-600 text-xs font-medium",children:"(You)"})]},g.userId)})})]}),u.jsx("div",{className:"flex space-x-2",children:u.jsx("button",{onClick:()=>N(`/campaign-story/${R.id}`),className:"fantasy-button flex-1",children:"View Campaign"})})]},R.id)})})]}),u.jsxs("div",{className:"mt-12",children:[u.jsxs("h2",{className:"text-2xl font-bold text-stone-800 mb-6",children:["Your Characters (",c.length,")"]}),c.length===0?u.jsxs("div",{className:"text-center py-8 text-stone-600",children:[u.jsx("p",{children:"You haven't created any character presets yet."}),u.jsx("p",{className:"text-sm mt-2",children:"Create a character in any party to save it as a preset!"}),u.jsx("button",{onClick:()=>N("/party-management"),className:"fantasy-button mt-4",children:"Go to Parties"})]}):u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(R=>u.jsxs("div",{className:"fantasy-card bg-emerald-50 border border-emerald-200",children:[u.jsxs("div",{className:"flex justify-between items-start mb-4",children:[u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800",children:R.name}),u.jsxs("p",{className:"text-stone-600 mt-1",children:[R.data.race," ",R.data.class]}),u.jsxs("p",{className:"text-sm text-stone-500 mt-1",children:["Level ",R.data.level," • ",R.data.background||"No background"]}),R.data.alignment&&u.jsx("p",{className:"text-sm text-stone-500",children:R.data.alignment}),R.createdAt&&u.jsxs("p",{className:"text-xs text-stone-400 mt-2",children:["Created: ",new Date(R.createdAt.toDate()).toLocaleDateString()]})]}),u.jsx("button",{onClick:()=>T(R.id),className:"text-red-600 hover:text-red-800 text-sm ml-2",title:"Delete preset",children:"🗑️"})]}),u.jsxs("div",{className:"mb-4",children:[u.jsx("h4",{className:"text-sm font-semibold text-stone-700 mb-2",children:"Ability Scores:"}),u.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"font-semibold",children:"STR"}),u.jsx("div",{className:"text-stone-600",children:R.data.strength})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"font-semibold",children:"DEX"}),u.jsx("div",{className:"text-stone-600",children:R.data.dexterity})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"font-semibold",children:"CON"}),u.jsx("div",{className:"text-stone-600",children:R.data.constitution})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"font-semibold",children:"INT"}),u.jsx("div",{className:"text-stone-600",children:R.data.intelligence})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"font-semibold",children:"WIS"}),u.jsx("div",{className:"text-stone-600",children:R.data.wisdom})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"font-semibold",children:"CHA"}),u.jsx("div",{className:"text-stone-600",children:R.data.charisma})]})]})]}),R.data.personality&&u.jsxs("div",{className:"mb-4",children:[u.jsx("h4",{className:"text-sm font-semibold text-stone-700 mb-1",children:"Personality:"}),u.jsx("p",{className:"text-sm text-stone-600 line-clamp-2",children:R.data.personality})]}),u.jsx("div",{className:"flex space-x-2",children:u.jsx("button",{onClick:()=>{alert(`To use "${R.name}" in a party:

1. Go to the Parties tab
2. Join or create a party
3. When creating your character, click "📋 Load Preset"
4. Select "${R.name}" from the list
5. Modify the character name and submit!`),N("/party-management")},className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 flex-1",children:"Use in Party"})})]},R.id))})]})]})})}function ER(){var Y,L,W;const t=zn(),{partyId:e}=Wc(),[n,r]=D.useState(null),[s,i]=D.useState(!1),[o,l]=D.useState(null),[c,d]=D.useState([]),[f,m]=D.useState(!1),[y,I]=D.useState(""),[N,j]=D.useState(!1),[A,T]=D.useState({name:"",race:"",class:"",level:1,background:"",alignment:"",strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10,age:"",height:"",weight:"",eyes:"",skin:"",hair:"",personality:"",ideals:"",bonds:"",flaws:"",backstory:"",equipment:[],spells:[],proficiencies:[],portrait:"/placeholder-character.png"}),[w,S]=D.useState("standard"),[O,R]=D.useState([]),[V,_]=D.useState([]),[g,E]=D.useState({}),[x,C]=D.useState(!1),[P,b]=D.useState({}),[ce,$e]=D.useState([]);D.useEffect(()=>{const k=ss(F=>{if(!F){t("/login");return}r(F),e&&et(F.uid,e),Ve(F.uid)});return()=>k()},[t,e]),D.useEffect(()=>{o&&(T({...o}),o.weaponChoices&&b(o.weaponChoices),o.spellChoices&&$e(o.spellChoices),o.abilityScoreMethod&&S(o.abilityScoreMethod),o.rolledScores&&R(o.rolledScores),o.assignedScores&&E(o.assignedScores),o.rolledScores&&C(o.rolledScores.length>0))},[o]);const et=async(k,F)=>{try{const H=await WE(k,F);l(H)}catch{}},Ve=async k=>{try{const F=await Oh(k);d(F)}catch(F){console.error("Error loading character presets:",F)}},K=["Human","Elf","Dwarf","Halfling","Dragonborn","Tiefling","Half-Elf","Half-Orc","Gnome","Aarakocra","Genasi","Goliath"],se=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"],ie=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],Ee=["Acolyte","Criminal","Folk Hero","Noble","Sage","Soldier"],ye=[15,14,13,12,10,8],Te={Fighter:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Paladin:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Barbarian:{"Martial Melee Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"]},Bard:{Weapon:["Rapier","Longsword"]},Druid:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Monk:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Sorcerer:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Warlock:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]}},gt={Wizard:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Sorcerer:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Warlock:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Eldritch Blast",description:"A beam of crackling energy that deals force damage and can hit multiple targets."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Cleric:[{name:"Guidance",description:"Touch a creature to give them +1d4 to their next ability check."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Resistance",description:"Touch a creature to give them +1d4 to their next saving throw."},{name:"Sacred Flame",description:"Flame-like radiance descends on a creature within 60 feet, dealing radiant damage."},{name:"Spare the Dying",description:"Touch a dying creature to stabilize them at 0 hit points."},{name:"Thaumaturgy",description:"Perform minor magical tricks - make your voice boom, cause tremors, or change eye color."}],Druid:[{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Druidcraft",description:"Predict weather, make a flower bloom, or create a harmless sensory effect."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Primal Savagery",description:"Transform your hand into a claw that deals acid damage to a creature you touch."},{name:"Produce Flame",description:"Create a flickering flame in your hand that you can throw for fire damage."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shillelagh",description:"Transform a club or quarterstaff into a magical weapon that uses your spellcasting ability."},{name:"Thorn Whip",description:"Create a vine-like whip that pulls a creature toward you and deals piercing damage."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."}],Bard:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."},{name:"Vicious Mockery",description:"Insult a creature within 60 feet, dealing psychic damage and possibly giving disadvantage."}]},Qe={Wizard:{cantrips:3,spells:6},Sorcerer:{cantrips:4,spells:2},Warlock:{cantrips:2,spells:2},Cleric:{cantrips:3,spells:2},Druid:{cantrips:2,spells:2},Bard:{cantrips:2,spells:4}},yt=k=>{const H=[...{Fighter:["Chain mail armor","Light crossbow and 20 bolts","Dungeoneer's pack","5 gp"],Wizard:["Arcane focus","Scholar's pack","Component pouch","5 gp"],Cleric:["Chain mail armor","Light crossbow and 20 bolts","Priest's pack","Shield","Holy symbol","5 gp"],Rogue:["Leather armor","Shortbow and 20 arrows","Burglar's pack","Thieves' tools","5 gp"],Ranger:["Scale mail armor","Longbow and 20 arrows","Explorer's pack","5 gp"],Paladin:["Chain mail armor","Javelins (5)","Priest's pack","Holy symbol","5 gp"],Barbarian:["Javelins (4)","Explorer's pack","5 gp"],Bard:["Leather armor","Diplomat's pack OR entertainer's pack","Lute OR any other musical instrument","5 gp"],Druid:["Leather armor","Druidic focus","Explorer's pack","Shield","5 gp"],Monk:["Dungeoneer's pack OR explorer's pack","5 gp"],Sorcerer:["Component pouch OR arcane focus","Dungeoneer's pack","5 gp"],Warlock:["Component pouch OR arcane focus","Scholar's pack","5 gp"]}[k]||["Adventurer's pack","Simple weapon","5 gp"]];return P.weapon&&H.push(P.weapon),P.shield&&H.push(P.shield),ce.length>0&&H.push(`Spells: ${ce.join(", ")}`),H},ot=()=>{const k=[];for(let F=0;F<4;F++)k.push(Math.floor(Math.random()*6)+1);return k.sort((F,H)=>H-F),k.slice(0,3).reduce((F,H)=>F+H,0)},cn=()=>{const k=[];for(let F=0;F<6;F++)k.push(ot());return k.sort((F,H)=>H-F),R(k),_([...k]),E({}),C(!0),k},is=(k,F)=>{const H=V.filter(G=>G!==k);_(H),E(G=>({...G,[F]:k})),xe(F,k)},Sn=k=>{const F=g[k];if(F){_(G=>[...G,F].sort((ee,ne)=>ne-ee));const H={...g};delete H[k],E(H),xe(k,10)}},un=()=>{const k=["strength","dexterity","constitution","intelligence","wisdom","charisma"],F={...A};ye.forEach((H,G)=>{F[k[G]]=H}),T(F),E({}),_([]),C(!1)},xe=(k,F)=>{T(H=>({...H,[k]:F}))},vt=async k=>{if(k.preventDefault(),!n){console.error("You must be logged in to create a character");return}if(!e){console.error("Party ID is missing. Please try again or contact support.");return}const H=["name","race","class"].filter(G=>!A[G]);if(H.length>0){console.error(`Please fill in all required fields: ${H.join(", ")}`);return}i(!0);try{const G={...A,userId:n.uid,partyId:e,equipment:yt(A.class),weapons:P,spells:ce,createdAt:o?o.createdAt:new Date,updatedAt:new Date};o?(await YA(o.id,G),console.log("Character updated successfully!")):(await QA(n.uid,e,G),console.log("Character created successfully!")),t(`/campaign-story/${e}`)}catch(G){console.error("Character creation/update error:",G),console.error("Error creating/updating character:",G.message)}finally{i(!1)}},Cn=async()=>{if(!y.trim()){alert("Please enter a name for your preset");return}if(!A.name||!A.race||!A.class){alert("Please fill in at least the basic character information (name, race, class) before saving as preset");return}try{console.log("Saving preset with data:",{userId:n.uid,presetName:y,characterData:A,weaponChoices:P,spellChoices:ce});const k={name:y,data:{...A,weaponChoices:P,spellChoices:ce,abilityScoreMethod:w,rolledScores:O,assignedScores:g}};console.log("Calling saveCharacterPreset with:",k);const F=await aR(n.uid,k);console.log("Preset saved successfully:",F),I(""),m(!1),await Ve(n.uid),alert("Character preset saved successfully!")}catch(k){console.error("Error saving preset:",k),console.error("Error details:",{message:k.message,code:k.code,stack:k.stack}),k.message.includes("User profile not found")?alert("User profile not found. Please try logging out and back in."):k.message.includes("permission")?alert("Permission denied. Please check your account status."):alert(`Failed to save preset: ${k.message}`)}},Pn=k=>{k.key==="Enter"&&y.trim()&&Cn()},Wt=k=>{const F=k.data;T({...F,name:F.name+" (Copy)",equipment:[],spells:F.spells||[],proficiencies:F.proficiencies||[]}),F.weaponChoices&&b(F.weaponChoices),F.spellChoices&&$e(F.spellChoices),F.abilityScoreMethod&&S(F.abilityScoreMethod),F.rolledScores&&(R(F.rolledScores),E(F.assignedScores||{}),C(F.rolledScores.length>0)),j(!1)},z=async k=>{if(confirm("Are you sure you want to delete this preset? This action cannot be undone."))try{await KE(n.uid,k),await Ve(n.uid),alert("Preset deleted successfully!")}catch(F){console.error("Error deleting preset:",F),alert("Failed to delete preset. Please try again.")}};return n?u.jsxs("div",{className:"fantasy-container py-8",children:[u.jsxs("div",{className:"fantasy-card",children:[u.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),u.jsx("p",{className:"text-center text-stone-600 mb-6",children:"Create your character to join the campaign. Once created, you'll be automatically ready to start the adventure!"}),u.jsxs("div",{className:"mb-8 p-4 bg-stone-50 rounded-lg border border-stone-200",children:[u.jsx("h3",{className:"text-lg font-semibold text-stone-800 mb-4",children:"Character Presets"}),u.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[u.jsxs("button",{type:"button",onClick:()=>j(!0),className:"fantasy-button bg-amber-600 hover:bg-amber-700",disabled:c.length===0,children:["📋 Load Preset (",c.length,")"]}),u.jsx("button",{type:"button",onClick:()=>m(!0),className:"fantasy-button bg-emerald-600 hover:bg-emerald-700",children:"💾 Save as Preset"})]}),c.length>0&&u.jsx("p",{className:"text-sm text-stone-600",children:"Save your current character configuration as a preset to easily recreate it for other parties."})]}),u.jsxs("form",{onSubmit:vt,className:"space-y-8",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Character Name"}),u.jsx("input",{type:"text",value:A.name,onChange:k=>xe("name",k.target.value),className:"fantasy-input",required:!0})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Race"}),u.jsxs("select",{value:A.race,onChange:k=>xe("race",k.target.value),className:"fantasy-input",required:!0,children:[u.jsx("option",{value:"",children:"Select Race"}),K.map(k=>u.jsx("option",{value:k,children:k},k))]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Class"}),u.jsxs("select",{value:A.class,onChange:k=>xe("class",k.target.value),className:"fantasy-input",required:!0,children:[u.jsx("option",{value:"",children:"Select Class"}),se.map(k=>u.jsx("option",{value:k,children:k},k))]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Background"}),u.jsxs("select",{value:A.background,onChange:k=>xe("background",k.target.value),className:"fantasy-input",required:!0,children:[u.jsx("option",{value:"",children:"Select Background"}),Ee.map(k=>u.jsx("option",{value:k,children:k},k))]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Alignment"}),u.jsxs("select",{value:A.alignment,onChange:k=>xe("alignment",k.target.value),className:"fantasy-input",required:!0,children:[u.jsx("option",{value:"",children:"Select Alignment"}),ie.map(k=>u.jsx("option",{value:k,children:k},k))]})]})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Ability Scores"}),u.jsxs("div",{className:"mb-6",children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Ability Score Generation Method"}),u.jsxs("div",{className:"flex space-x-4 mb-4",children:[u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"radio",name:"abilityMethod",value:"standard",checked:w==="standard",onChange:k=>S(k.target.value),className:"mr-2"}),"Standard Array (15, 14, 13, 12, 10, 8)"]}),u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"radio",name:"abilityMethod",value:"roll",checked:w==="roll",onChange:k=>S(k.target.value),className:"mr-2"}),"Roll 4d6, Drop Lowest"]})]}),w==="standard"&&u.jsx("button",{type:"button",onClick:un,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Apply Standard Array"}),w==="roll"&&u.jsxs("div",{className:"space-y-2",children:[u.jsx("button",{type:"button",onClick:cn,disabled:x,className:`fantasy-button ${x?"bg-stone-400 cursor-not-allowed":"bg-stone-600 hover:bg-stone-700"}`,children:x?"Scores Already Rolled":"Roll Ability Scores"}),x&&u.jsx("p",{className:"text-sm text-stone-600",children:"You can only roll once, but you can reassign scores as many times as you like."}),O.length>0&&u.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-semibold text-stone-800 mb-2",children:"Rolled Scores"}),u.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:V.map((k,F)=>u.jsx("span",{className:"bg-amber-100 border border-amber-300 text-amber-800 px-3 py-1 rounded-full text-sm font-medium",children:k},`${k}-${F}`))}),u.jsx("p",{className:"text-sm text-stone-600",children:"Click on an ability score below to assign your rolled scores. You can reassign them as many times as you want."})]})]})]}),u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:["strength","dexterity","constitution","intelligence","wisdom","charisma"].map(k=>{const F=g[k],H=A[k];return u.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2 capitalize",children:k}),F?u.jsxs("div",{className:"space-y-2",children:[u.jsx("div",{className:"text-lg font-bold text-amber-700",children:F}),u.jsx("button",{type:"button",onClick:()=>Sn(k),className:"text-xs text-red-600 hover:text-red-800",children:"Unassign"})]}):u.jsxs("div",{className:"space-y-2",children:[u.jsx("input",{type:"number",min:"1",max:"20",value:H,onChange:G=>xe(k,parseInt(G.target.value)),className:"fantasy-input",required:!0}),V.length>0&&u.jsx("div",{className:"flex flex-wrap gap-1",children:V.map((G,ee)=>u.jsx("button",{type:"button",onClick:()=>is(G,k),className:"bg-amber-100 hover:bg-amber-200 border border-amber-300 text-amber-800 px-2 py-1 rounded text-xs font-medium",children:G},`${G}-${ee}`))})]}),u.jsxs("div",{className:"text-xs text-stone-500 mt-1",children:["Modifier: ",Math.floor((H-10)/2)]})]},k)})})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Physical Description"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsx("input",{type:"text",placeholder:"Age",value:A.age,onChange:k=>xe("age",k.target.value),className:"fantasy-input"}),u.jsx("input",{type:"text",placeholder:"Height",value:A.height,onChange:k=>xe("height",k.target.value),className:"fantasy-input"}),u.jsx("input",{type:"text",placeholder:"Weight",value:A.weight,onChange:k=>xe("weight",k.target.value),className:"fantasy-input"}),u.jsx("input",{type:"text",placeholder:"Eye Color",value:A.eyes,onChange:k=>xe("eyes",k.target.value),className:"fantasy-input"}),u.jsx("input",{type:"text",placeholder:"Skin Color",value:A.skin,onChange:k=>xe("skin",k.target.value),className:"fantasy-input"}),u.jsx("input",{type:"text",placeholder:"Hair Color",value:A.hair,onChange:k=>xe("hair",k.target.value),className:"fantasy-input"})]})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Personality"}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Personality Traits"}),u.jsx("textarea",{value:A.personality,onChange:k=>xe("personality",k.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your character's personality..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Ideals"}),u.jsx("textarea",{value:A.ideals,onChange:k=>xe("ideals",k.target.value),className:"fantasy-input",rows:"3",placeholder:"What does your character believe in?"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Bonds"}),u.jsx("textarea",{value:A.bonds,onChange:k=>xe("bonds",k.target.value),className:"fantasy-input",rows:"3",placeholder:"What connections does your character have?"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Flaws"}),u.jsx("textarea",{value:A.flaws,onChange:k=>xe("flaws",k.target.value),className:"fantasy-input",rows:"3",placeholder:"What are your character's weaknesses?"})]})]})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Backstory"}),u.jsx("textarea",{value:A.backstory,onChange:k=>xe("backstory",k.target.value),className:"fantasy-input",rows:"6",placeholder:"Tell the story of your character's life before the adventure..."})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Starting Equipment"}),A.class&&Te[A.class]&&u.jsxs("div",{className:"mb-6",children:[u.jsx("h3",{className:"text-lg font-semibold text-stone-800 mb-3",children:"Choose Your Weapons"}),u.jsx("div",{className:"space-y-4",children:Object.entries(Te[A.class]).map(([k,F])=>u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:k}),u.jsxs("select",{value:P[k.toLowerCase().replace(/\s+/g,"")]||"",onChange:H=>b(G=>({...G,[k.toLowerCase().replace(/\s+/g,"")]:H.target.value})),className:"fantasy-input",children:[u.jsxs("option",{value:"",children:["Select ",k]}),F.map(H=>u.jsx("option",{value:H,children:H},H))]})]},k))})]}),A.class&&gt[A.class]&&u.jsxs("div",{className:"mb-6",children:[u.jsx("h3",{className:"text-lg font-semibold text-stone-800 mb-3",children:"Choose Your Cantrips"}),u.jsxs("p",{className:"text-sm text-stone-600 mb-3",children:["Select your starting cantrips (0-level spells). You can choose up to ",((Y=Qe[A.class])==null?void 0:Y.cantrips)||0," cantrips."]}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto border border-stone-200 rounded-lg p-4",children:gt[A.class].map(k=>{var G;const F=ce.includes(k.name),H=!F&&ce.length>=(((G=Qe[A.class])==null?void 0:G.cantrips)||0);return u.jsx("div",{className:`border rounded-lg p-3 ${F?"border-amber-500 bg-amber-50":"border-stone-200"} ${H?"opacity-50":"hover:border-stone-300"}`,children:u.jsxs("label",{className:`flex items-start space-x-3 cursor-pointer ${H?"cursor-not-allowed":""}`,children:[u.jsx("input",{type:"checkbox",checked:F,disabled:H,onChange:ee=>{ee.target.checked?$e(ne=>[...ne,k.name]):$e(ne=>ne.filter(ue=>ue!==k.name))},className:"rounded mt-1"}),u.jsxs("div",{className:"flex-1",children:[u.jsx("div",{className:"font-medium text-stone-800",children:k.name}),u.jsx("div",{className:"text-sm text-stone-600 mt-1",children:k.description})]})]})},k.name)})}),u.jsxs("div",{className:"flex justify-between items-center mt-3",children:[u.jsxs("p",{className:"text-sm text-stone-500",children:["Selected: ",ce.length," / ",((L=Qe[A.class])==null?void 0:L.cantrips)||0," cantrips"]}),ce.length>=(((W=Qe[A.class])==null?void 0:W.cantrips)||0)&&u.jsx("p",{className:"text-sm text-green-600 font-medium",children:"✓ Cantrip selection complete"})]})]}),A.class?u.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:[u.jsxs("h3",{className:"font-semibold text-stone-800 mb-3",children:[A.class," Starting Equipment"]}),u.jsx("ul",{className:"space-y-1",children:yt(A.class).map((k,F)=>u.jsxs("li",{className:"text-stone-700 flex items-start",children:[u.jsx("span",{className:"text-stone-500 mr-2",children:"•"}),k]},F))}),u.jsx("p",{className:"text-sm text-stone-600 mt-3",children:"This equipment will be automatically assigned to your character."})]}):u.jsx("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:u.jsx("p",{className:"text-stone-600",children:"Select a class to see your starting equipment."})})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Character Portrait"}),u.jsxs("div",{className:"flex items-center space-x-4",children:[u.jsx("div",{className:"w-32 h-32 bg-stone-200 rounded-lg flex items-center justify-center",children:u.jsx("span",{className:"text-stone-500",children:"Portrait Placeholder"})}),u.jsx("button",{type:"button",className:"fantasy-button",onClick:()=>{},children:"Upload Image"})]})]}),u.jsxs("div",{className:"flex justify-center space-x-4",children:[u.jsx("button",{type:"button",onClick:()=>t(`/campaign-story/${e}`),className:"fantasy-button bg-stone-600 hover:bg-stone-700",disabled:s,children:"Back to Campaign"}),u.jsx("button",{type:"submit",className:"fantasy-button",disabled:s,children:s?"Creating Character...":"Create Character"})]})]})]}),f&&u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"fantasy-card max-w-md w-full mx-4",children:[u.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Save Character Preset"}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Preset Name"}),u.jsx("input",{type:"text",value:y,onChange:k=>I(k.target.value),onKeyPress:Pn,className:"fantasy-input",placeholder:"Enter a name for your preset",autoFocus:!0})]}),u.jsxs("div",{className:"flex space-x-3",children:[u.jsx("button",{type:"button",onClick:()=>{m(!1),I("")},className:"fantasy-button bg-stone-600 hover:bg-stone-700 flex-1",children:"Cancel"}),u.jsx("button",{type:"button",onClick:Cn,className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 flex-1",children:"Save Preset"})]})]})]})}),N&&u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"fantasy-card max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[u.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Load Character Preset"}),c.length===0?u.jsxs("div",{className:"text-center py-8",children:[u.jsx("p",{className:"text-stone-600 mb-4",children:"No character presets found."}),u.jsx("p",{className:"text-sm text-stone-500",children:"Create a character and save it as a preset to see it here."}),u.jsx("button",{type:"button",onClick:()=>j(!1),className:"fantasy-button mt-4",children:"Close"})]}):u.jsxs("div",{className:"space-y-4",children:[u.jsx("div",{className:"grid gap-4",children:c.map(k=>u.jsxs("div",{className:"border border-stone-200 rounded-lg p-4 hover:border-stone-300",children:[u.jsxs("div",{className:"flex justify-between items-start mb-3",children:[u.jsxs("div",{children:[u.jsx("h4",{className:"font-semibold text-stone-800",children:k.name}),u.jsxs("p",{className:"text-sm text-stone-600",children:[k.data.race," ",k.data.class," • Level ",k.data.level]}),k.data.background&&u.jsx("p",{className:"text-sm text-stone-500",children:k.data.background}),k.createdAt&&u.jsxs("p",{className:"text-xs text-stone-400 mt-1",children:["Created: ",new Date(k.createdAt.toDate()).toLocaleDateString()]})]}),u.jsx("button",{type:"button",onClick:()=>z(k.id),className:"text-red-600 hover:text-red-800 text-sm",title:"Delete preset",children:"🗑️"})]}),u.jsx("div",{className:"flex space-x-2",children:u.jsx("button",{type:"button",onClick:()=>Wt(k),className:"fantasy-button bg-amber-600 hover:bg-amber-700 flex-1",children:"Load Preset"})})]},k.id))}),u.jsx("div",{className:"flex justify-center",children:u.jsx("button",{type:"button",onClick:()=>j(!1),className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Cancel"})})]})]})})]}):null}function xR(){const t=zn(),[e,n]=D.useState(null),[r,s]=D.useState([]),[i,o]=D.useState({}),[l,c]=D.useState(!1),[d,f]=D.useState(!1),[m,y]=D.useState(""),[I,N]=D.useState({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""});D.useEffect(()=>{const R=ss(V=>{if(!V){t("/login");return}n(V),j(V.uid)});return()=>R()},[t]);const j=async R=>{try{const V=await jp(R);s(V),await A(V)}catch(V){console.error("Error loading parties:",V.message)}},A=async R=>{try{const V=new Set;if(R.forEach(x=>{x.members&&Array.isArray(x.members)&&x.members.forEach(C=>V.add(C))}),V.size===0)return;const _=await zE(Array.from(V)),g={};_.forEach(x=>{g[x.userId]=x});const E={};R.forEach(x=>{x.members&&Array.isArray(x.members)&&(E[x.id]=x.members.map(C=>({userId:C,profile:g[C]||null})))}),o(E)}catch(V){console.error("Error loading party member profiles:",V)}},T=async R=>{if(R.preventDefault(),!e){console.error("You must be logged in to create a party");return}c(!0);try{const V={...I,inviteCode:Math.random().toString(36).substr(2,8).toUpperCase()},_=await XA(e.uid,V);f(!1),N({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""}),await j(e.uid),console.log("Party created successfully!")}catch(V){console.error("Error creating party:",V.message)}finally{c(!1)}},w=async()=>{if(!m.trim()){console.error("Please enter an invite code");return}if(!e){console.error("You must be logged in to join a party");return}c(!0);try{const R=await eR(m.toUpperCase());if(!R){console.error("Invalid invite code");return}await JA(R.id,e.uid),y(""),await j(e.uid),console.log("Successfully joined party!")}catch(R){console.error(R.message||"Error joining party. Please try again.")}finally{c(!1)}},S=R=>{navigator.clipboard.writeText(R),console.log("Invite code copied to clipboard!")},O=async(R,V)=>{if(confirm(`Are you sure you want to disband "${V}"? This action cannot be undone and will remove all party members and characters.`)){c(!0);try{await ZA(R,e.uid),await j(e.uid),console.log("Party disbanded successfully")}catch(_){console.error("Error disbanding party:",_.message)}finally{c(!1)}}};return e?u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h1",{className:"fantasy-title mb-0",children:"Party Management"}),u.jsx("button",{onClick:()=>f(!0),className:"fantasy-button",disabled:l,children:"Create New Party"})]}),d&&u.jsxs("div",{className:"fantasy-card bg-amber-50 mb-6",children:[u.jsx("h2",{className:"text-xl font-bold text-stone-800 mb-4",children:"Create New Party"}),u.jsxs("form",{onSubmit:T,className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Party Name"}),u.jsx("input",{type:"text",value:I.name,onChange:R=>N(V=>({...V,name:R.target.value})),className:"fantasy-input",required:!0})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Theme"}),u.jsx("textarea",{value:I.description,onChange:R=>N(V=>({...V,description:R.target.value})),className:"fantasy-input",rows:"3",placeholder:"Enter the theme or atmosphere for your campaign..."})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Max Players"}),u.jsx("input",{type:"number",min:"2",max:"10",value:I.maxPlayers,onChange:R=>N(V=>({...V,maxPlayers:parseInt(R.target.value)})),className:"fantasy-input"})]}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",id:"isPublic",checked:I.isPublic,onChange:R=>N(V=>({...V,isPublic:R.target.checked})),className:"mr-2"}),u.jsx("label",{htmlFor:"isPublic",className:"text-sm font-medium text-stone-700",children:"Public Party (visible to all users)"})]})]}),u.jsxs("div",{className:"flex space-x-4",children:[u.jsx("button",{type:"submit",className:"fantasy-button",disabled:l,children:l?"Creating...":"Create Party"}),u.jsx("button",{type:"button",onClick:()=>f(!1),className:"fantasy-button bg-stone-600 hover:bg-stone-700",disabled:l,children:"Cancel"})]})]})]}),u.jsxs("div",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"My Parties"}),r.length===0?u.jsxs("div",{className:"text-center py-8 text-stone-600",children:[u.jsx("p",{children:"You haven't joined any parties yet."}),u.jsx("p",{children:'Click "Create New Party" to get started!'})]}):u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:r.map(R=>{var _;const V=i[R.id]||[];return u.jsxs("div",{className:"fantasy-card bg-amber-50",children:[u.jsxs("div",{className:"flex justify-between items-start mb-4",children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800",children:R.name}),u.jsxs("span",{className:"text-sm text-stone-600",children:[((_=R.members)==null?void 0:_.length)||1,"/",R.maxPlayers," players"]})]}),R.description&&u.jsxs("div",{className:"mb-4",children:[u.jsx("span",{className:"text-sm font-semibold text-stone-700",children:"Theme: "}),u.jsx("span",{className:"text-stone-600",children:R.description})]}),u.jsxs("div",{className:"mb-4",children:[u.jsx("h4",{className:"text-sm font-semibold text-stone-700 mb-2",children:"Party Members:"}),u.jsx("div",{className:"space-y-1",children:V.map((g,E)=>{var P;const x=((P=g.profile)==null?void 0:P.username)||`User ${E+1}`,C=g.userId===R.dmId;return u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("span",{className:"text-stone-600",children:x}),C&&u.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),g.userId===(e==null?void 0:e.uid)&&u.jsx("span",{className:"text-blue-600 text-xs font-medium",children:"(You)"})]},g.userId)})})]}),R.dmId===e.uid&&u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Invite Code"}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("input",{type:"text",value:R.inviteCode,readOnly:!0,className:"fantasy-input bg-stone-100"}),u.jsx("button",{onClick:()=>S(R.inviteCode),className:"fantasy-button text-sm",children:"Copy"})]})]}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsx("button",{onClick:()=>t(`/campaign-story/${R.id}`),className:"fantasy-button",children:"Campaign"}),R.dmId===e.uid&&u.jsx("button",{onClick:()=>O(R.id,R.name),className:"fantasy-button bg-red-600 hover:bg-red-700",disabled:l,children:"Disband"})]})]},R.id)})})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"Join a Party"}),u.jsx("div",{className:"fantasy-card bg-amber-50",children:u.jsxs("div",{className:"flex items-center space-x-4",children:[u.jsx("input",{type:"text",placeholder:"Enter invite code",value:m,onChange:R=>y(R.target.value),className:"fantasy-input flex-1",disabled:l}),u.jsx("button",{onClick:w,className:"fantasy-button",disabled:l,children:l?"Joining...":"Join Party"})]})})]})]})}):null}const TR="https://dnd-v1-backend.onrender.com",Rt=async(t,e="gpt-4",n=1e3,r=.8)=>{try{const s=await fetch(`${TR}/api/openai`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t,model:e,max_tokens:n,temperature:r})});if(!s.ok){const o=await s.json();throw new Error(o.error||"Backend API request failed")}return await s.json()}catch(s){throw console.error("Backend API Error:",s),new Error(`Failed to communicate with backend: ${s.message}`)}};class bR{constructor(){this.systemPrompt=`You are an experienced Dungeon Master for Dungeons & Dragons 5th Edition. You excel at:
- Creating engaging storylines and plot hooks
- Developing detailed character descriptions and backstories
- Generating multiple story options and summarizing them
- Providing atmospheric descriptions and immersive storytelling
- Balancing combat encounters and managing game mechanics
- Creating memorable NPCs and villains
- Adapting to player choices and creating dynamic narratives
- Maintaining story consistency and character development
- Building upon established relationships and plot threads

Always respond in character as a Dungeon Master, providing rich, descriptive content that enhances the gaming experience. Maintain consistency with previous story elements, character relationships, and established plot threads.`}async generateStoryPlots(e,n="",r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class} (${c.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const o=`As a Dungeon Master, I need you to generate 3 different story plot options for a D&D campaign.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

For each plot option, provide:
1. A compelling title
2. A brief summary (2-3 sentences)
3. The main conflict or challenge
4. Potential story hooks for the party
5. Estimated campaign length (short, medium, or long)

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options.`;return(await Rt([{role:"system",content:this.systemPrompt},{role:"user",content:o}],"gpt-4",1e3,.8)).choices[0].message.content}catch(s){throw new Error(`Failed to generate story plots: ${s.message}`)}}async generateCharacterDetails(e){try{const n=`As a Dungeon Master, I need you to expand on this character's details and create a rich, detailed description.

Character: ${e.name} - Level ${e.level} ${e.race} ${e.class}
Background: ${e.background}
Alignment: ${e.alignment}
Personality: ${e.personality||"Not specified"}
Ideals: ${e.ideals||"Not specified"}
Bonds: ${e.bonds||"Not specified"}
Flaws: ${e.flaws||"Not specified"}
Backstory: ${e.backstory||"Not specified"}

Please provide:
1. A detailed physical description (appearance, mannerisms, distinctive features)
2. An expanded personality profile with quirks and habits
3. A deeper backstory with key events and relationships
4. Character motivations and goals
5. Potential story hooks and plot threads related to this character
6. How this character might interact with the party and world

Make the character feel alive and three-dimensional, with details that could drive story development.`;return(await Rt([{role:"system",content:this.systemPrompt},{role:"user",content:n}],"gpt-4",800,.7)).choices[0].message.content}catch(n){throw console.error("Error generating character details:",n),new Error(`Failed to generate character details: ${n.message}`)}}async generateStorySummary(e,n){try{const r=n.map(o=>`${o.name} (${o.race} ${o.class})`).join(", "),s=`As a Dungeon Master, I need you to create a detailed story summary and outline for this campaign plot.

Plot: ${e}
Party: ${r}

Please provide:
1. A detailed campaign overview (3-4 paragraphs)
2. Key story beats and major events
3. Important NPCs and their roles
4. Potential challenges and obstacles
5. Story themes and motifs
6. How each party member might be personally invested
7. Potential branching paths and player choices
8. Climactic moments and resolution possibilities

Make this feel like a professional campaign module with rich storytelling potential.`;return(await Rt([{role:"system",content:this.systemPrompt},{role:"user",content:s}],"gpt-4",1200,.7)).choices[0].message.content}catch(r){throw console.error("Error generating story summary:",r),new Error(`Failed to generate story summary: ${r.message}`)}}async generateMultipleStoryPlots(e,n="",r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class} (${c.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const o=`As a Dungeon Master, I need you to generate 5 different story plot options for a D&D campaign, each with a detailed summary.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

For each of the 5 plot options, provide:
1. A compelling title
2. A detailed summary (3-4 paragraphs)
3. The main conflict or challenge
4. Key story beats and major events
5. Important NPCs and their roles
6. Potential story hooks for the party
7. Estimated campaign length (short, medium, or long)
8. Themes and motifs
9. How each party member might be personally invested

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options. Number each plot clearly (Plot 1, Plot 2, etc.).`;return(await Rt([{role:"system",content:this.systemPrompt},{role:"user",content:o}],"gpt-4",1500,.8)).choices[0].message.content}catch(s){throw console.error("Error generating multiple story plots:",s),new Error(`Failed to generate multiple story plots: ${s.message}`)}}async generateNPC(e,n=""){try{const r=`As a Dungeon Master, I need you to create a detailed NPC for this role and context.

NPC Role: ${e}
Context: ${n||"General campaign context"}

Please provide:
1. A detailed physical description
2. Personality traits and mannerisms
3. Background and motivations
4. Current situation and goals
5. How they might interact with the party
6. Potential story hooks or plot threads they could introduce
7. Their relationship to the world and other NPCs
8. Any secrets or hidden aspects of their character

Make this NPC feel like a real person with depth and complexity.`;return(await Rt([{role:"system",content:this.systemPrompt},{role:"user",content:r}],"gpt-4",800,.7)).choices[0].message.content}catch(r){throw console.error("Error generating NPC:",r),new Error(`Failed to generate NPC: ${r.message}`)}}async generateCombatEncounter(e,n,r="medium",s=""){try{const i=`As a Dungeon Master, I need you to create a detailed combat encounter.

Party Level: ${e}
Party Size: ${n}
Difficulty: ${r}
Theme: ${s||"General fantasy"}

Please provide:
1. A detailed description of the encounter location
2. Enemy types and their motivations
3. Tactical considerations and terrain features
4. Potential story elements or plot hooks
5. Non-combat resolution options
6. Consequences of victory or defeat
7. Environmental hazards or advantages
8. How this encounter fits into the larger story

Make this encounter feel meaningful and story-driven, not just a random fight.`;return(await Rt([{role:"system",content:this.systemPrompt},{role:"user",content:i}],"gpt-4",800,.7)).choices[0].message.content}catch(i){throw console.error("Error generating combat encounter:",i),new Error(`Failed to generate combat encounter: ${i.message}`)}}async generateStoryContinuation(e,n,r,s=null,i="individual",o=null){var l,c,d,f,m;try{const y=e.map(w=>`${w.name} - Level ${w.level} ${w.race} ${w.class}`).join(", "),I=n.map(w=>({role:w.role,content:w.content}));let N="";o&&(N=`
Party Theme: ${o.description||"No theme provided"}`);let j="";s&&(j=`
STORY STATE CONTEXT:
Current Location: ${((l=s.currentLocation)==null?void 0:l.name)||"Unknown"} - ${((c=s.currentLocation)==null?void 0:c.description)||""}
Active NPCs: ${Object.keys(s.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((d=s.activePlotThreads)==null?void 0:d.map(w=>`${w.title} (${Math.round(w.progress*100)}%)`).join(", "))||"None"}
Recent Events: ${((m=(f=s.worldState)==null?void 0:f.recentEvents)==null?void 0:m.slice(-3).map(w=>w.event).join(", "))||"None"}

CHARACTER RELATIONSHIPS:
${e.map(w=>{var R;const S=((R=s.characterArcs)==null?void 0:R[w.id])||{},O=Object.entries(S.relationships||{}).map(([V,_])=>`${V} (${_})`).join(", ");return`${w.name}: ${O||"No established relationships"}`}).join(`
`)}

NPC CONTEXT:
${Object.entries(s.activeNPCs||{}).map(([w,S])=>{var O;return`${w}: ${S.disposition} disposition, knowledge: ${((O=S.knowledge)==null?void 0:O.join(", "))||"none"}, goal: ${S.currentGoal||"unknown"}`}).join(`
`)}`);const A=`As a Dungeon Master, continue the story based on the player's response.

Party: ${y}${N}
Player Response: "${r}" (Type: ${i})
Response Type Context:
- individual: One character's personal action
- team: Group action or decision
- investigate: Looking for clues or information
- combat: Combat-related action
- social: Social interaction or diplomacy${j}

Previous Story Context:
${I.map(w=>`${w.role==="assistant"?"DM":"Player"}: ${w.content}`).join(`
`)}

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

Please provide a compelling continuation that:
1. Acknowledges the player's action in context of the current situation and location
2. References relevant NPCs and their established relationships with the party
3. Continues or advances active plot threads appropriately
4. Updates character relationships based on the action
5. Maintains location and atmosphere consistency
6. Ends with a clear situation that invites the next player to respond
7. Encourages character interaction and roleplay
8. Provides multiple possible directions for the party to explore
9. Builds upon the established story state and character development

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.`;return(await Rt([{role:"system",content:this.systemPrompt},...I,{role:"user",content:A}],"gpt-4",800,.8)).choices[0].message.content}catch(y){throw console.error("Error generating story continuation:",y),new Error(`Failed to generate story continuation: ${y.message}`)}}async generatePlotOptions(e,n=null){try{const r=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class}. ${c.personality||""}. ${c.backstory||""}`).join(`
`);let s="";n&&(s=`
Party Theme: ${n.description||"No theme provided"}`);const i="You are a Dungeon Master for D&D 5e. You MUST generate exactly 3 plot options, no more, no less. Follow the exact format provided. Do not use party names in the plots. Keep summaries brief (1-2 sentences maximum). DO NOT repeat plots or generate duplicates.",o=`Generate exactly 3 distinct campaign plot options for this party. 

REQUIRED FORMAT - Follow this exact structure:

Plot 1: [Title]
[Brief summary - 1-2 sentences maximum]

Plot 2: [Title]  
[Brief summary - 1-2 sentences maximum]

Plot 3: [Title]
[Brief summary - 1-2 sentences maximum]

Party: ${r}${s}

CRITICAL REQUIREMENTS:
- Generate EXACTLY 3 plots, no more, no less
- Use the party theme to influence the plot lines and atmosphere
- Do NOT use the party name in the plots - focus on the characters and theme
- Each summary must be 1-2 sentences maximum
- Follow the exact format above with "Plot 1:", "Plot 2:", "Plot 3:" labels
- Do not add any additional text, explanations, or formatting
- Do not repeat or duplicate any plots
- Stop after Plot 3 - do not generate more plots

Make each plot distinct and appealing to different play styles.`;return(await Rt([{role:"system",content:i},{role:"user",content:o}],"gpt-4",600,.8)).choices[0].message.content}catch(r){throw console.error("Error generating plot options:",r),new Error(`Failed to generate plot options: ${r.message}`)}}async generateStoryIntroduction(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}. ${d.personality||""}. ${d.backstory||""}`).join(`
`);let o="";s&&(o=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create an engaging story introduction for the beginning of this campaign.

Party: ${i}${o}
Selected Plot: Plot ${r}
Plot Details: ${n}

Create an introduction that includes:
1. A vivid description of the starting town/settlement where the party begins
2. How each character arrives or is already present in this location
3. The initial situation or hook that draws the party together
4. A sense of atmosphere and setting that matches the chosen plot
5. An opening scene that gives the party their first decision or action to take

Important Guidelines:
- Use the party theme to influence the atmosphere and context
- Incorporate themes and elements from the party theme to create atmosphere and context
- Consider how the party's background and composition might influence the starting situation
- Focus on the characters and their individual stories
- The story should feel cohesive with the established theme

Make this feel like the opening of an epic adventure. Set the tone, establish the setting, and give the party a clear starting point. End with a situation that requires the party to make a choice or take action.

Keep the introduction engaging but concise (3-4 paragraphs maximum).`;return(await Rt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",800,.8)).choices[0].message.content}catch(i){throw console.error("Error generating story introduction:",i),new Error(`Failed to generate story introduction: ${i.message}`)}}async generateStructuredStoryResponse(e,n,r,s,i,o=null,l=null){var c,d,f;try{const m=e.map(w=>`${w.name} - Level ${w.level} ${w.race} ${w.class}`).join(", "),y=n.map(w=>({role:w.role,content:w.content}));let I="";l&&(I=`
Party Theme: ${l.description||"No theme provided"}`);const N=i.length>0?`
Discovered Objectives: ${i.map(w=>w.title).join(", ")}`:"";let j="";o&&(j=`
STORY STATE CONTEXT:
Current Location: ${((c=o.currentLocation)==null?void 0:c.name)||"Unknown"} - ${((d=o.currentLocation)==null?void 0:d.description)||""}
Active NPCs: ${Object.keys(o.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((f=o.activePlotThreads)==null?void 0:f.map(w=>`${w.title} (${Math.round(w.progress*100)}%)`).join(", "))||"None"}
Character Relationships: ${Object.entries(o.characterArcs||{}).map(([w,S])=>{const O=e.find(R=>R.id===w);return`${O==null?void 0:O.name}: ${Object.entries(S.relationships||{}).map(([R,V])=>`${R} (${V})`).join(", ")||"No relationships"}`}).join("; ")}`);const A=`As a Dungeon Master, continue the story based on the player's response, considering the current story phase and discovered objectives.

Party: ${m}${I}
Current Phase: ${s}
Player Response: "${r}"${N}${j}

Story Phases:
- Investigation: Focus on discovery, clues, and gathering information
- Conflict: Focus on tension, threats, and potential combat
- Resolution: Focus on choices, consequences, and story conclusion

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

Please provide a compelling continuation that:
1. Acknowledges the player's action in context of the current situation and location
2. References relevant NPCs and their established relationships with the party
3. Continues or advances active plot threads appropriately
4. Updates character relationships based on the action
5. Maintains location and atmosphere consistency
6. Ends with a clear situation that invites the next player to respond
7. Encourages character interaction and roleplay
8. Provides multiple possible directions for the party to explore
9. Builds upon the established story state and character development

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.`;return(await Rt([{role:"system",content:this.systemPrompt},...y,{role:"user",content:A}],"gpt-4",800,.8)).choices[0].message.content}catch(m){throw console.error("Error generating structured story response:",m),new Error(`Failed to generate structured story response: ${m.message}`)}}async generatePhaseTransition(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let o="";s&&(o=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create a phase transition message for the story.

Party: ${i}${o}
Current Phase: ${n}
Story Progress: ${r}

Create a transition that:
1. Acknowledges the progress made so far
2. Signals the shift to the new phase
3. Sets up the new challenges and opportunities
4. Maintains the established tone and atmosphere
5. Gives the party clear direction for the next phase

Make this feel like a natural progression in the story.`;return(await Rt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating phase transition:",i),new Error(`Failed to generate phase transition: ${i.message}`)}}async generateObjectiveCompletion(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let o="";s&&(o=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create a completion message for an objective.

Party: ${i}${o}
Completed Objective: ${n.title}
Story Context: ${r}

Create a completion message that:
1. Celebrates the achievement
2. Provides closure for this objective
3. Sets up the next challenge or objective
4. Maintains story momentum
5. Acknowledges the party's efforts

Make this feel rewarding and meaningful.`;return(await Rt([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating objective completion:",i),new Error(`Failed to generate objective completion: ${i.message}`)}}async generateCampaignContinuation(e,n,r,s,i=null){try{const o=e.map(m=>`${m.name} - Level ${m.level} ${m.race} ${m.class}`).join(", "),l=r.map(m=>({role:m.role,content:m.content}));let c="";i&&(c=`
Party Theme: ${i.description||"No theme provided"}`);const d=`As a Dungeon Master, continue the ongoing campaign story.

Party: ${o}${c}
Campaign Goal: ${n.mainGoal||"No specific goal"}
Campaign Progress: ${n.campaignProgress||"Beginning"}
Player Response: "${s}"

Previous Story Context:
${l.map(m=>`${m.role==="assistant"?"DM":"Player"}: ${m.content}`).join(`
`)}

Continue the story while:
1. Building toward the main campaign goal
2. Maintaining consistency with previous events
3. Developing character relationships and arcs
4. Creating meaningful choices and consequences
5. Advancing the overall plot

Keep your response engaging but concise (2-3 paragraphs maximum).`;return(await Rt([{role:"system",content:this.systemPrompt},...l,{role:"user",content:d}],"gpt-4",800,.8)).choices[0].message.content}catch(o){throw console.error("Error generating campaign continuation:",o),new Error(`Failed to generate campaign continuation: ${o.message}`)}}async generateCampaignGoal(e,n,r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class}`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const o=`As a Dungeon Master, create a clear campaign goal based on the selected plot.

Party: ${s}${i}
Plot Content: ${n}

Create a campaign goal that:
1. Is clear and achievable
2. Provides direction for the entire campaign
3. Involves all party members
4. Has multiple possible paths to completion
5. Creates meaningful stakes and consequences

Make this goal compelling and motivating for the party.`;return(await Rt([{role:"system",content:this.systemPrompt},{role:"user",content:o}],"gpt-4",600,.7)).choices[0].message.content}catch(s){throw console.error("Error generating campaign goal:",s),new Error(`Failed to generate campaign goal: ${s.message}`)}}async generateSessionSummary(e,n,r,s,i=null){try{const o=s.map(f=>`${f.name} - Level ${f.level} ${f.race} ${f.class}`).join(", ");let l="";i&&(l=`
Party Theme: ${i.description||"No theme provided"}`);const c=`As a Dungeon Master, create a session summary for this campaign session.

Party: ${o}${l}
Campaign Goal: ${e.mainGoal||"No specific goal"}
Objectives: ${r.map(f=>f.title).join(", ")}
Story Messages: ${n.length} total messages

Create a summary that:
1. Recaps the major events of the session
2. Highlights character development and relationships
3. Notes progress toward objectives
4. Sets up expectations for the next session
5. Maintains the established tone and atmosphere

Make this summary engaging and informative.`;return(await Rt([{role:"system",content:this.systemPrompt},{role:"user",content:c}],"gpt-4",800,.7)).choices[0].message.content}catch(o){throw console.error("Error generating session summary:",o),new Error(`Failed to generate session summary: ${o.message}`)}}}const Dn=new bR;function IR({partyCharacters:t,onStoryGenerated:e,onCharacterDetailsGenerated:n,partyInfo:r=null}){const[s,i]=D.useState("plots"),[o,l]=D.useState(!1),[c,d]=D.useState(""),[f,m]=D.useState(""),[y,I]=D.useState(""),[N,j]=D.useState(""),[A,T]=D.useState(""),[w,S]=D.useState(""),[O,R]=D.useState({partyLevel:1,partySize:t.length,difficulty:"medium",theme:""}),V=async()=>{if(t.length===0){d("No party characters available. Please create characters first.");return}l(!0),d("");try{const P=await Dn.generateStoryPlots(t,y,r);m(P),e&&e(P)}catch{d("Failed to generate story plots. Please check your API key and try again.")}finally{l(!1)}},_=async()=>{if(t.length===0){d("No party characters available. Please create characters first.");return}l(!0),d("");try{const P=await Dn.generateMultipleStoryPlots(t,y,r);m(P),e&&e(P)}catch{d("Failed to generate story plots. Please check your API key and try again.")}finally{l(!1)}},g=async()=>{if(!N){d("Please select a character first.");return}const P=t.find(b=>b.id===N);if(!P){d("Selected character not found.");return}l(!0),d("");try{const b=await Dn.generateCharacterDetails(P);m(b),n&&n(P.id,b)}catch{d("Failed to generate character details. Please check your API key and try again.")}finally{l(!1)}},E=async()=>{if(!A.trim()){d("Please enter an NPC role.");return}l(!0),d("");try{const P=await Dn.generateNPC(A,w);m(P)}catch{d("Failed to generate NPC. Please check your API key and try again.")}finally{l(!1)}},x=async()=>{l(!0),d("");try{const P=await Dn.generateCombatEncounter(O.partyLevel,O.partySize,O.difficulty,O.theme);m(P)}catch{d("Failed to generate encounter. Please check your API key and try again.")}finally{l(!1)}},C=[{id:"plots",label:"Story Plots",icon:"📖"},{id:"characters",label:"Character Details",icon:"👤"},{id:"npcs",label:"NPCs",icon:"🏰"},{id:"encounters",label:"Combat Encounters",icon:"⚔️"}];return u.jsxs("div",{className:"fantasy-card",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h2",{className:"fantasy-title mb-0",children:"🤖 AI Dungeon Master"}),u.jsx("div",{className:"text-sm text-stone-600",children:"Powered by ChatGPT"})]}),u.jsx("div",{className:"flex space-x-1 mb-6 bg-stone-100 p-1 rounded-lg",children:C.map(P=>u.jsxs("button",{onClick:()=>i(P.id),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center space-x-2 ${s===P.id?"bg-amber-600 text-white":"text-stone-600 hover:text-stone-800"}`,children:[u.jsx("span",{children:P.icon}),u.jsx("span",{children:P.label})]},P.id))}),c&&u.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:c}),s==="plots"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Setting (Optional)"}),u.jsx("textarea",{value:y,onChange:P=>I(P.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your campaign setting, world, or any specific themes..."})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsx("button",{onClick:V,disabled:o||t.length===0,className:"fantasy-button",children:o?"Generating...":"Generate Basic Plots"}),u.jsx("button",{onClick:_,disabled:o||t.length===0,className:"fantasy-button bg-amber-700 hover:bg-amber-800",children:o?"Generating...":"Generate Detailed Plots"})]}),u.jsxs("div",{className:"text-sm text-stone-600 text-center",children:[u.jsxs("p",{children:[u.jsx("strong",{children:"Basic Plots:"})," 3 plot options with brief summaries"]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Detailed Plots:"})," 5 plot options with full story summaries and character integration"]})]}),t.length===0&&u.jsx("p",{className:"text-sm text-stone-600 text-center",children:"Create party characters first to generate story plots."})]}),s==="characters"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Select Character"}),u.jsxs("select",{value:N,onChange:P=>j(P.target.value),className:"fantasy-input",children:[u.jsx("option",{value:"",children:"Choose a character..."}),t.map(P=>u.jsxs("option",{value:P.id,children:[P.name," - ",P.race," ",P.class]},P.id))]})]}),u.jsx("button",{onClick:g,disabled:o||!N,className:"fantasy-button w-full",children:o?"Generating Details...":"Generate Character Details"})]}),s==="npcs"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"NPC Role"}),u.jsx("input",{type:"text",value:A,onChange:P=>T(P.target.value),className:"fantasy-input",placeholder:"e.g., Town Mayor, Mysterious Wizard, Bandit Leader..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Context (Optional)"}),u.jsx("textarea",{value:w,onChange:P=>S(P.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe the context, location, or situation..."})]}),u.jsx("button",{onClick:E,disabled:o||!A.trim(),className:"fantasy-button w-full",children:o?"Generating NPC...":"Generate NPC"})]}),s==="encounters"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Party Level"}),u.jsx("input",{type:"number",min:"1",max:"20",value:O.partyLevel,onChange:P=>R(b=>({...b,partyLevel:parseInt(P.target.value)})),className:"fantasy-input"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Party Size"}),u.jsx("input",{type:"number",min:"1",max:"10",value:O.partySize,onChange:P=>R(b=>({...b,partySize:parseInt(P.target.value)})),className:"fantasy-input"})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Difficulty"}),u.jsxs("select",{value:O.difficulty,onChange:P=>R(b=>({...b,difficulty:P.target.value})),className:"fantasy-input",children:[u.jsx("option",{value:"easy",children:"Easy"}),u.jsx("option",{value:"medium",children:"Medium"}),u.jsx("option",{value:"hard",children:"Hard"}),u.jsx("option",{value:"deadly",children:"Deadly"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Theme (Optional)"}),u.jsx("input",{type:"text",value:O.theme,onChange:P=>R(b=>({...b,theme:P.target.value})),className:"fantasy-input",placeholder:"e.g., Forest ambush, Dungeon crawl..."})]})]}),u.jsx("button",{onClick:x,disabled:o,className:"fantasy-button w-full",children:o?"Generating Encounter...":"Generate Combat Encounter"})]}),f&&u.jsxs("div",{className:"mt-8",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Generated Content"}),u.jsx("button",{onClick:()=>m(""),className:"text-sm text-stone-600 hover:text-stone-800",children:"Clear"})]}),u.jsx("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:u.jsx("div",{className:"prose prose-sm max-w-none",children:u.jsx("pre",{className:"whitespace-pre-wrap text-stone-800 font-sans text-sm leading-relaxed",children:f})})})]})]})}function SR(){const{partyId:t}=Wc(),e=zn(),[n,r]=D.useState(null),[s,i]=D.useState(null),[o,l]=D.useState([]),[c,d]=D.useState(null),[f,m]=D.useState(!0),[y,I]=D.useState("story"),[N,j]=D.useState({title:"",description:"",chapters:[]}),[A,T]=D.useState({image:"/placeholder-map.png",description:""});D.useEffect(()=>{const _=ss(g=>{if(!g){e("/login");return}r(g),t&&w(g.uid,t)});return()=>_()},[e,t]);const w=async(_,g)=>{try{m(!0);const[E,x,C]=await Promise.all([WE(_,g),Rp(g),HE(g)]);i(E),l(x),d(C)}catch{}finally{m(!1)}},S=[{id:"story",label:"Story Planning"},{id:"ai-dm",label:"🤖 AI Dungeon Master"},{id:"map",label:"Campaign Map"},{id:"characters",label:"Party Characters"},{id:"enemies",label:"Enemies & NPCs"}],O=()=>{const _={id:Date.now(),title:"",description:"",objectives:[],completed:!1};j(g=>({...g,chapters:[...g.chapters,_]}))},R=(_,g,E)=>{j(x=>({...x,chapters:x.chapters.map(C=>C.id===_?{...C,[g]:E}:C)}))},V=_=>{const g={id:Date.now(),description:"",completed:!1};R(_,"objectives",[...N.chapters.find(E=>E.id===_).objectives,g])};return!n||f?u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsx("div",{className:"text-center py-8",children:u.jsx("p",{className:"text-stone-600",children:"Loading..."})})})}):s?u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h1",{className:"fantasy-title mb-0",children:"Campaign Management"}),u.jsxs("div",{className:"text-sm text-stone-600",children:["Playing as: ",u.jsx("span",{className:"font-medium",children:s.name})]})]}),u.jsx("div",{className:"flex space-x-1 mb-6 bg-stone-100 p-1 rounded-lg",children:S.map(_=>u.jsx("button",{onClick:()=>I(_.id),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${y===_.id?"bg-amber-600 text-white":"text-stone-600 hover:text-stone-800"}`,children:_.label},_.id))}),y==="story"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Title"}),u.jsx("input",{type:"text",value:N.title,onChange:_=>j(g=>({...g,title:_.target.value})),className:"fantasy-input",placeholder:"Enter campaign title..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Description"}),u.jsx("textarea",{value:N.description,onChange:_=>j(g=>({...g,description:_.target.value})),className:"fantasy-input",rows:"4",placeholder:"Describe your campaign's main plot..."})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800",children:"Chapters"}),u.jsx("button",{onClick:O,className:"fantasy-button",children:"Add Chapter"})]}),u.jsx("div",{className:"space-y-4",children:N.chapters.map(_=>u.jsxs("div",{className:"fantasy-card bg-amber-50",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[u.jsx("input",{type:"text",value:_.title,onChange:g=>R(_.id,"title",g.target.value),className:"fantasy-input",placeholder:"Chapter title..."}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:_.completed,onChange:g=>R(_.id,"completed",g.target.checked),className:"mr-2"}),u.jsx("label",{className:"text-sm font-medium text-stone-700",children:"Completed"})]})]}),u.jsx("textarea",{value:_.description,onChange:g=>R(_.id,"description",g.target.value),className:"fantasy-input mb-4",rows:"3",placeholder:"Chapter description..."}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx("h4",{className:"font-medium text-stone-800",children:"Objectives"}),u.jsx("button",{onClick:()=>V(_.id),className:"fantasy-button text-sm",children:"Add Objective"})]}),u.jsx("div",{className:"space-y-2",children:_.objectives.map(g=>u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("input",{type:"checkbox",checked:g.completed,onChange:E=>{const x=_.objectives.map(C=>C.id===g.id?{...C,completed:E.target.checked}:C);R(_.id,"objectives",x)}}),u.jsx("input",{type:"text",value:g.description,onChange:E=>{const x=_.objectives.map(C=>C.id===g.id?{...C,description:E.target.value}:C);R(_.id,"objectives",x)},className:"fantasy-input flex-1",placeholder:"Objective description..."})]},g.id))})]})]},_.id))})]})]}),y==="ai-dm"&&u.jsx(IR,{partyCharacters:o,partyInfo:c,onStoryGenerated:_=>{},onCharacterDetailsGenerated:(_,g)=>{}}),y==="map"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Campaign Map"}),u.jsxs("div",{className:"bg-stone-200 rounded-lg p-8 text-center",children:[u.jsx("div",{className:"w-full h-64 bg-stone-300 rounded-lg flex items-center justify-center mb-4",children:u.jsx("span",{className:"text-stone-500",children:"Map Placeholder"})}),u.jsx("button",{className:"fantasy-button",children:"Upload Map Image"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Map Description"}),u.jsx("textarea",{value:A.description,onChange:_=>T(g=>({...g,description:_.target.value})),className:"fantasy-input",rows:"4",placeholder:"Describe the locations and points of interest on your map..."})]})]}),y==="characters"&&u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Party Characters"}),o.length===0?u.jsx("div",{className:"text-center py-8 text-stone-600",children:u.jsx("p",{children:"No characters have been created yet."})}):u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:o.map(_=>u.jsx("div",{className:"fantasy-card bg-amber-50",children:u.jsxs("div",{className:"flex items-start space-x-4",children:[u.jsx("div",{className:"w-16 h-16 bg-stone-300 rounded-lg flex items-center justify-center",children:u.jsx("span",{className:"text-xs text-stone-600",children:"IMG"})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h4",{className:"font-bold text-stone-800",children:_.name}),u.jsxs("p",{className:"text-sm text-stone-600",children:["Level ",_.level," ",_.race," ",_.class]}),u.jsxs("p",{className:"text-sm text-stone-600 mt-1",children:[_.background," • ",_.alignment]})]})]})},_.id))})]}),y==="enemies"&&u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-4",children:"Enemies & NPCs"}),u.jsx("div",{className:"text-center py-8 text-stone-600",children:u.jsx("p",{children:"Enemy and NPC management will be available here."})})]})]})}):u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card",children:[u.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),u.jsxs("div",{className:"text-center py-8",children:[u.jsx("p",{className:"text-stone-600 mb-6",children:"You need to create a character before you can access the campaign."}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("button",{onClick:()=>e(`/character-creation/${t}`),className:"fantasy-button text-lg px-8 py-3",children:"Create Character"}),u.jsx("button",{onClick:()=>e("/party-management"),className:"fantasy-button text-lg px-8 py-3 bg-stone-600 hover:bg-stone-700",children:"Back to Parties"})]})]})]})})}function CR(){const{partyId:t}=Wc(),e=zn(),[n,r]=D.useState(null),[s,i]=D.useState(null),[o,l]=D.useState(!0),[c,d]=D.useState([]),[f,m]=D.useState(null),[y,I]=D.useState(null),[N,j]=D.useState(""),[A,T]=D.useState(""),[w,S]=D.useState([]),[O,R]=D.useState([]),[V,_]=D.useState([]),[g,E]=D.useState(!1),[x,C]=D.useState(""),[P,b]=D.useState(""),[ce,$e]=D.useState(!1),[et,Ve]=D.useState(!1),[K,se]=D.useState(null),[ie,Ee]=D.useState(-1);D.useEffect(()=>{const z=ss(Y=>{if(!Y){e("/login");return}r(Y)});return()=>z()},[e]),D.useEffect(()=>{n&&t&&ye()},[n,t]),D.useEffect(()=>{if(t){const z=GE(t,Y=>{var L;if(i(Y),l(!1),Y){Te(Y),R(Y.environmentalFeatures||[]),_(Y.teamUpOpportunities||[]),Cn();const W=(L=Y.initiative)==null?void 0:L[Y.currentTurn];W&&W.id.startsWith("enemy_")&&Y.combatState==="active"&&Y.currentTurn!==ie&&!ce&&!g&&(console.log("Auto-processing enemy turn for:",W.name,"turn:",Y.currentTurn),Ee(Y.currentTurn),setTimeout(()=>{xe()},1e3))}});return()=>z()}},[t,ie,ce,g]);const ye=async()=>{try{l(!0);const z=await qE(t),Y=t==="test-combat-party";if(!z){if(Y)console.log("No test combat session found, redirecting to dashboard"),e("/dashboard");else{console.log("No combat session found, navigating to story with partyId:",t);try{e(`/campaign-story/${t}`)}catch(L){console.error("Navigation error in loadCombatData:",L),e("/dashboard")}}return}if(Y)d(z.partyMembers||[]);else{const L=await Rp(t);d(L)}if(z.enemies&&z.enemies.length===0){i({...z,status:"no_enemies"});return}i(z),Te(z),R(z.environmentalFeatures||[]),_(z.teamUpOpportunities||[])}catch(z){console.error("Error loading combat data:",z)}finally{l(!1)}},Te=z=>{var F;const Y=cn(z);if(!Y)return;const L=[],W=Y.cooldowns||{};Object.entries(Rn.actionTypes).forEach(([H,G])=>{(W[H]===0||W[H]===void 0)&&L.push({type:H,name:G.name,description:G.description,priority:G.priority,narrativeTemplate:G.narrativeTemplate})});const k=Rn.classAbilities[(F=Y.class)==null?void 0:F.toLowerCase()];k&&(W.special===0||W.special===void 0)&&L.push({type:"special",name:k.name,description:k.description,priority:"high",narrativeTemplate:"{character} uses their {ability}!"}),O.length>0&&L.push({type:"environmental",name:"Use Environment",description:"Use the environment to your advantage",priority:"normal",narrativeTemplate:"{character} uses the {environment} to their advantage!"}),V.length>0&&L.push({type:"teamUp",name:"Team Up",description:"Coordinate with another party member",priority:"high",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}),S(L)},gt=async()=>{if(!s)return;const z=Rn.initializeCombat(s.partyMembers,s.enemies,s.storyContext);await Gs(s.id,{...z,combatState:"active"})},Qe=async()=>{await vt()},yt=async()=>{if(!s)return;const z=(s.currentTurn-1+s.initiative.length)%s.initiative.length;await Gs(s.id,{currentTurn:z}),m(null),I(null),j(""),T("")},ot=async()=>{if(!s)return;const z=t==="test-combat-party",Y=Rn.generateCombatSummary(s,"victory");if(await Gs(s.id,{status:"ended",combatState:"ended",summary:Y}),z)console.log("Ending test combat, navigating to dashboard"),e("/dashboard");else{await yn(t,{status:"storytelling",currentCombat:null});try{console.log("Ending combat, navigating to story with partyId:",t),e(`/campaign-story/${t}`)}catch(L){console.error("Navigation error in endCombat:",L),e("/dashboard")}}},cn=(z=s)=>!(z!=null&&z.initiative)||z.currentTurn===void 0?null:z.initiative[z.currentTurn],is=()=>{const z=cn();return z&&z.userId===(n==null?void 0:n.uid)},Sn=()=>c.find(z=>z.userId===(n==null?void 0:n.uid)),un=async(z,Y,L={})=>{if(!s||!z||!Y||ce)return;const W=Sn();if(W)try{$e(!0);const k=await Rn.executeAction(s,W.id,z,Y,L);if(k.success){const F=s.initiative.filter(ee=>!ee.id.startsWith("enemy_")),H=s.initiative.filter(ee=>ee.id.startsWith("enemy_"));if(await Gs(s.id,{initiative:s.initiative,partyMembers:F,enemies:H}),i(ee=>({...ee,initiative:s.initiative,partyMembers:F,enemies:H})),j(k.results.damage>0?`Dealt ${k.results.damage} damage!`:k.results.healing>0?`Healed ${k.results.healing} HP!`:"Action completed!"),T(k.narrative),k.statusEffects.length>0){const ee=k.statusEffects.map(ne=>`${ne.type} applied to target!`).join(", ");j(ne=>ne+" "+ee)}k.environmentalImpact.length>0&&j(ee=>ee+" "+k.environmentalImpact.join(", "));const G=H.find(ee=>ee.id===Y);G&&G.hp<=0&&j(ee=>ee+` ${G.name} has been defeated!`),setTimeout(()=>{vt()},3e3)}else j(k.message)}catch(k){console.error("Error executing action:",k),j("Failed to execute action")}finally{$e(!1)}},xe=async()=>{if(!s||g||ce){console.log("Enemy turn blocked - already processing or enemy turn active");return}const z=cn();if(!z||!z.id.startsWith("enemy_")){console.log("Enemy turn blocked - not an enemy turn");return}if(ie===s.currentTurn){console.log("Enemy turn blocked - already processed turn:",s.currentTurn);return}console.log("Starting enemy turn for:",z.name),E(!0),$e(!0),Ee(s.currentTurn);try{C(`${z.name} is thinking...`),b(""),await new Promise(L=>setTimeout(L,1500));const Y=await Rn.executeEnemyTurn(s,z);if(Y.success){const L=s.initiative.filter(F=>!F.id.startsWith("enemy_")),W=s.initiative.filter(F=>F.id.startsWith("enemy_"));if(await Gs(s.id,{initiative:s.initiative,partyMembers:L,enemies:W}),i(F=>({...F,initiative:s.initiative,partyMembers:L,enemies:W})),C(Y.results.damage>0?`${z.name} deals ${Y.results.damage} damage!`:Y.results.healing>0?`${z.name} heals ${Y.results.healing} HP!`:`${z.name} takes action!`),b(Y.narrative),Y.statusEffects.length>0){const F=Y.statusEffects.map(H=>`${H.type} applied!`).join(", ");C(H=>H+" "+F)}Y.environmentalImpact.length>0&&C(F=>F+" "+Y.environmentalImpact.join(", "));const k=L.find(F=>F.id===Y.targetId);k&&k.hp<=0&&C(F=>F+` ${k.name} has fallen!`),await new Promise(F=>setTimeout(F,2500)),await vt()}else C(Y.message),await new Promise(L=>setTimeout(L,2e3)),await vt()}catch(Y){console.error("Error processing enemy turn:",Y),C("Enemy turn failed"),await new Promise(L=>setTimeout(L,2e3)),await vt()}finally{E(!1),$e(!1),C(""),b("")}},vt=async()=>{if(!s||ce)return;const z=(s.currentTurn+1)%s.initiative.length,Y=s.initiative[z];console.log("Advancing turn:",{currentTurn:s.currentTurn,newTurn:z,nextCombatant:Y==null?void 0:Y.name,isEnemy:Y==null?void 0:Y.id.startsWith("enemy_"),totalCombatants:s.initiative.length}),await Gs(s.id,{currentTurn:z}),i(W=>({...W,currentTurn:z})),Ee(-1),m(null),I(null),j(""),T("");const L=Rn.checkCombatEnd(s);if(L.ended){console.log("Combat ended:",L),j(L.narrative),setTimeout(()=>{ot()},3e3);return}Y&&Y.id.startsWith("enemy_")?(console.log("Next turn is enemy turn, scheduling processEnemyTurn"),setTimeout(()=>{xe()},1e3)):console.log("Next turn is player turn")},Cn=()=>{if(!s||!n)return;const z=s.partyMembers.find(Y=>Y.userId===n.uid);z&&z.hp<=0&&(Ve(!0),se(z))},Pn=()=>{e(t==="test-combat-party"?"/dashboard":`/character-creation/${t}`)};if(!n)return null;if(o)return u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsxs("div",{className:"text-center py-8",children:[u.jsx("div",{className:"text-stone-600 mb-4",children:"⚔️ Setting up battle arena..."}),u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-stone-600 mx-auto"})]})})});if(!s)return u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsxs("div",{className:"text-center py-8",children:[u.jsx("div",{className:"text-stone-600",children:"No active combat session found."}),u.jsx("button",{onClick:async()=>{await yn(t,{status:"storytelling",currentCombat:null});try{console.log("Returning to story from no combat session, partyId:",t),e(`/campaign-story/${t}`)}catch(z){console.error("Navigation error in return to story:",z),e("/dashboard")}},className:"fantasy-button mt-4",children:"Return to Story"})]})})});if(s.status==="no_enemies"||s.enemies&&s.enemies.length===0)return u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsxs("div",{className:"text-center py-8",children:[u.jsx("div",{className:"text-4xl mb-4",children:"🕊️"}),u.jsx("h2",{className:"text-2xl font-bold text-stone-800 mb-4",children:"No Enemies to Fight"}),u.jsx("p",{className:"text-stone-600 mb-6",children:"There are no enemies present in this area. Combat cannot begin."}),u.jsx("button",{onClick:async()=>{await yn(t,{status:"storytelling",currentCombat:null});try{console.log("Returning to story from no enemies, partyId:",t),e(`/campaign-story/${t}`)}catch(z){console.error("Navigation error in return to story:",z),e("/dashboard")}},className:"fantasy-button",children:"Return to Story"})]})})});const Wt=cn();return et&&K?u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card bg-red-50 border-red-200",children:u.jsxs("div",{className:"text-center py-8",children:[u.jsx("div",{className:"text-6xl mb-4",children:"💀"}),u.jsx("h1",{className:"text-3xl font-bold text-red-800 mb-4",children:"Character Death"}),u.jsxs("div",{className:"text-xl text-red-700 mb-6",children:[K.name," has fallen in battle..."]}),u.jsxs("div",{className:"bg-white p-6 rounded-lg border border-red-300 mb-6",children:[u.jsx("h2",{className:"text-lg font-semibold text-stone-800 mb-2",children:"Fallen Hero"}),u.jsxs("p",{className:"text-stone-600 mb-2",children:[u.jsx("strong",{children:"Name:"})," ",K.name]}),u.jsxs("p",{className:"text-stone-600 mb-2",children:[u.jsx("strong",{children:"Class:"})," ",K.class]}),u.jsxs("p",{className:"text-stone-600 mb-2",children:[u.jsx("strong",{children:"Level:"})," ",K.level]}),u.jsxs("p",{className:"text-stone-600",children:[u.jsx("strong",{children:"Final HP:"})," ",K.hp,"/",K.maxHp]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("p",{className:"text-stone-600",children:"Your character has been defeated. You must create a new character to continue."}),u.jsx("button",{onClick:Pn,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})}):u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h1",{className:"fantasy-title mb-0",children:"⚔️ Combat Arena"}),u.jsxs("div",{className:"flex space-x-2",children:[s.combatState==="preparation"&&u.jsx("button",{onClick:gt,className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"Start Combat"}),s.combatState==="active"&&u.jsxs("div",{className:"flex space-x-2",children:[u.jsx("button",{onClick:yt,className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"← Previous"}),u.jsx("button",{onClick:Qe,className:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"Next →"}),u.jsx("button",{onClick:ot,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg",children:"End Combat"})]})]})]}),s.storyContext&&u.jsxs("div",{className:"mb-6 p-4 bg-stone-50 border border-stone-200 rounded-lg",children:[u.jsx("h3",{className:"font-bold text-stone-800 mb-2",children:"Story Context"}),u.jsx("p",{className:"text-stone-700 italic",children:s.storyContext}),u.jsx("button",{onClick:async()=>{await yn(t,{status:"storytelling",currentCombat:null});try{console.log("Returning to story from combat header, partyId:",t),e(`/campaign-story/${t}`)}catch(z){console.error("Navigation error in return to story:",z),e("/dashboard")}},className:"text-sm text-stone-600 hover:text-stone-800 mt-2",children:"← Return to Story"})]}),O.length>0&&u.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[u.jsx("h3",{className:"font-bold text-blue-800 mb-2",children:"🌍 Environmental Features"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:O.map((z,Y)=>u.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:z},Y))})]}),s.combatState==="active"&&u.jsxs("div",{className:"mb-6",children:[u.jsx("h3",{className:"font-bold text-stone-800 mb-3",children:"🎯 Turn Order"}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:s.initiative.map((z,Y)=>u.jsx("div",{className:`p-3 rounded-lg border-2 transition-colors ${Y===s.currentTurn?"border-amber-500 bg-amber-50":"border-stone-200 bg-white"}`,children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-medium text-stone-800",children:[z.name,Y===s.currentTurn&&u.jsx("span",{className:"ml-2 text-amber-600",children:"← Current Turn"})]}),u.jsxs("div",{className:"text-sm text-stone-600",children:["HP: ",z.hp,"/",z.maxHp," | AC: ",z.ac]}),z.statusEffects&&z.statusEffects.length>0&&u.jsx("div",{className:"text-xs text-red-600 mt-1",children:z.statusEffects.map(L=>L.type).join(", ")})]}),u.jsxs("div",{className:"text-sm text-stone-500",children:["Initiative: ",z.initiative]})]})},z.id))})]}),s.combatState==="active"&&Wt&&u.jsxs("div",{className:"mb-6",children:[u.jsxs("h3",{className:"font-bold text-stone-800 mb-3",children:["🎲 ",Wt.name,"'s Turn"]}),is()?u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"Available Actions:"}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:w.map((z,Y)=>u.jsxs("button",{onClick:()=>m(z),className:`p-3 rounded-lg border-2 transition-colors text-left ${(f==null?void 0:f.type)===z.type?"border-amber-500 bg-amber-50":"border-stone-200 bg-white hover:border-stone-300"}`,children:[u.jsx("div",{className:"font-medium text-stone-800",children:z.name}),u.jsx("div",{className:"text-sm text-stone-600",children:z.description}),u.jsxs("div",{className:"text-xs text-stone-500 mt-1",children:["Priority: ",z.priority]})]},Y))})]}),f&&u.jsxs("div",{children:[u.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"Select Target:"}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.enemies.map(z=>u.jsxs("button",{onClick:()=>I(z),className:`p-3 rounded-lg border-2 transition-colors ${(y==null?void 0:y.id)===z.id?"border-red-500 bg-red-50":"border-stone-200 bg-white hover:border-stone-300"}`,children:[u.jsx("div",{className:"font-medium text-stone-800",children:z.name}),u.jsxs("div",{className:"text-sm text-stone-600",children:["HP: ",z.hp,"/",z.maxHp," | AC: ",z.ac]})]},z.id))})]}),f&&y&&u.jsx("div",{className:"text-center",children:u.jsx("button",{onClick:()=>un(f.type,y.id),disabled:ce,className:"fantasy-button bg-amber-600 hover:bg-amber-700",children:ce?"Executing...":`Execute ${f.name}`})})]}):u.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[u.jsxs("h4",{className:"font-bold text-blue-800 mb-2",children:["Waiting for ",Wt.name," to act"]}),u.jsx("p",{className:"text-blue-700",children:Wt.userId===(n==null?void 0:n.uid)?"It's your turn! Please select an action.":"Please wait for the current player to make their move."})]})]}),N&&u.jsxs("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:[u.jsx("h4",{className:"font-bold text-green-800 mb-2",children:"Action Result"}),u.jsx("p",{className:"text-green-700",children:N}),A&&u.jsx("div",{className:"mt-2 p-3 bg-white border border-green-300 rounded",children:u.jsx("p",{className:"text-stone-700 italic",children:A})})]}),g&&u.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg animate-pulse",children:[u.jsx("h4",{className:"font-bold text-red-800 mb-2",children:"🦹 Enemy Turn"}),x&&u.jsx("div",{className:"text-red-700 font-medium mb-2",children:x}),P&&u.jsx("div",{className:"mt-2 p-3 bg-white border border-red-300 rounded",children:u.jsx("p",{className:"text-stone-700 italic",children:P})}),u.jsxs("div",{className:"mt-3 flex items-center justify-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-red-600"}),u.jsx("span",{className:"ml-2 text-red-600 text-sm",children:"Enemy is acting..."})]})]}),ce&&!g&&u.jsx("div",{className:"mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:u.jsxs("div",{className:"flex items-center justify-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-amber-600"}),u.jsx("span",{className:"ml-2 text-amber-600 font-medium",children:"Processing turn..."})]})}),V.length>0&&u.jsxs("div",{className:"mb-6 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[u.jsx("h3",{className:"font-bold text-purple-800 mb-2",children:"🤝 Team Up Opportunities"}),u.jsx("div",{className:"space-y-2",children:V.map((z,Y)=>u.jsxs("div",{className:"text-purple-700",children:[u.jsxs("strong",{children:[z.classes.join(" + "),":"]})," ",z.description]},Y))})]})]})})}const Kn={INVESTIGATION:"investigation",COMBAT:"combat",PERSUASION:"persuasion",EXPLORATION:"exploration",SOCIAL:"social"},Ct={HIDDEN:"hidden",DISCOVERED:"discovered",IN_PROGRESS:"in_progress",COMPLETED:"completed",FAILED:"failed"},ov=t=>{const e=[{id:"investigate_area",type:Kn.INVESTIGATION,title:"Investigate the Area",description:"Search for clues and gather information about the situation",keywords:["search","investigate","examine","look around","check","explore"],state:Ct.HIDDEN,discoveredAt:null,completedAt:null},{id:"resolve_conflict",type:Kn.COMBAT,title:"Resolve the Conflict",description:"Engage in combat to overcome the threat",keywords:["fight","attack","defend","combat","battle"],state:Ct.HIDDEN,discoveredAt:null,completedAt:null},{id:"negotiate_peace",type:Kn.PERSUASION,title:"Negotiate Peace",description:"Use diplomacy and persuasion to resolve the situation peacefully",keywords:["talk","negotiate","persuade","convince","diplomacy","peace"],state:Ct.HIDDEN,discoveredAt:null,completedAt:null}],n=[];return(t.toLowerCase().includes("thief")||t.toLowerCase().includes("stealth"))&&n.push({id:"stealth_approach",type:Kn.EXPLORATION,title:"Stealth Approach",description:"Use stealth to avoid detection and gather information",keywords:["sneak","stealth","hide","silent","unnoticed"],state:Ct.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("merchant")||t.toLowerCase().includes("trade"))&&n.push({id:"establish_trade",type:Kn.SOCIAL,title:"Establish Trade Relations",description:"Build economic relationships with the locals",keywords:["trade","bargain","deal","commerce","business"],state:Ct.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("scholar")||t.toLowerCase().includes("knowledge"))&&n.push({id:"gather_knowledge",type:Kn.INVESTIGATION,title:"Gather Ancient Knowledge",description:"Discover and preserve valuable information",keywords:["research","study","learn","knowledge","ancient","lore"],state:Ct.HIDDEN,discoveredAt:null,completedAt:null}),[...e,...n]},PR=(t,e)=>{const n=[];return e.forEach(r=>{if(r.state===Ct.HIDDEN){const s=t.toLowerCase();r.keywords.some(o=>s.includes(o.toLowerCase()))&&n.push({...r,state:Ct.DISCOVERED,discoveredAt:new Date})}}),n},NR=(t,e)=>t.filter(n=>n.state===e),kR=t=>t.filter(e=>e.state===Ct.DISCOVERED||e.state===Ct.IN_PROGRESS||e.state===Ct.COMPLETED),AR=(t,e)=>{const n=NR(t,Ct.HIDDEN),r=[];return n.forEach(s=>{const i=e.toLowerCase();s.type===Kn.INVESTIGATION&&(i.includes("mystery")||i.includes("unknown"))&&r.push("There might be more to discover here..."),s.type===Kn.PERSUASION&&(i.includes("tension")||i.includes("conflict"))&&r.push("Perhaps words could resolve this..."),s.type===Kn.COMBAT&&(i.includes("threat")||i.includes("danger"))&&r.push("The situation seems dangerous...")}),r},Ye={SETUP:"setup",INTRODUCTION:"introduction",RISING_ACTION:"rising_action",CLIMAX:"climax",RESOLUTION:"resolution",COMPLETED:"completed"},RR=(t,e)=>{const n={importantNPCs:[],keyLocations:[],majorEvents:[],partyDecisions:[],currentSituation:null,activeThreats:[],availableResources:[]};if(t.slice(-10).forEach(s=>{if(s.role==="assistant"){const i=s.content.toLowerCase(),o=i.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:the\s+)?([a-z\s]+)/g);o&&o.forEach(d=>{n.importantNPCs.find(f=>f.name===d)||n.importantNPCs.push({name:d,firstMentioned:s.timestamp,role:"unknown"})}),["town","city","village","castle","temple","dungeon","forest","mountain"].forEach(d=>{if(i.includes(d)){const f=i.match(new RegExp(`([A-Z][a-z]+(?:s+[A-Z][a-z]+)*\\s+${d})`,"i"));f&&!n.keyLocations.find(m=>m.name===f[1])&&n.keyLocations.push({name:f[1],type:d,firstMentioned:s.timestamp})}}),["danger","threat","enemy","monster","evil","dark","cursed"].forEach(d=>{i.includes(d)&&n.activeThreats.push({type:d,mentioned:s.timestamp,description:i.substring(Math.max(0,i.indexOf(d)-50),i.indexOf(d)+50)})})}}),t.length>0){const s=t[t.length-1];s.role==="assistant"&&(n.currentSituation=s.content)}return n},jR=(t,e,n)=>{var i,o;t||(console.warn("Campaign metadata is undefined, using fallback values"),t={campaignPhase:Ye.SETUP,mainGoal:null,activeObjectives:[],completedObjectives:[],importantNPCs:[],keyLocations:[],partyDecisions:[],storyContext:{currentSituation:null,worldState:{}},sessionNumber:1,campaignProgress:0}),t.storyContext||(t.storyContext={currentSituation:null,worldState:{}});const r={campaignPhase:t.campaignPhase||Ye.SETUP,mainGoal:t.mainGoal||null,activeObjectives:t.activeObjectives||[],completedObjectives:t.completedObjectives||[],importantNPCs:t.importantNPCs||[],keyLocations:t.keyLocations||[],currentSituation:((i=t.storyContext)==null?void 0:i.currentSituation)||null,partyDecisions:t.partyDecisions||[],worldState:((o=t.storyContext)==null?void 0:o.worldState)||{},sessionNumber:t.sessionNumber||1,campaignProgress:t.campaignProgress||0},s=RR(e);return{...r,recentNPCs:s.importantNPCs,recentLocations:s.keyLocations,recentThreats:s.activeThreats,currentSituation:s.currentSituation||r.currentSituation}},DR=(t,e,n)=>{let r=0;const s={[Ye.SETUP]:0,[Ye.INTRODUCTION]:10,[Ye.RISING_ACTION]:30,[Ye.CLIMAX]:70,[Ye.RESOLUTION]:90,[Ye.COMPLETED]:100};r+=s[t.campaignPhase]||0;const o=n.filter(d=>d.state==="completed").length/Math.max(n.length,1)*30;r+=o;const l=e.length,c=Math.min(l/50*20,20);return r+=c,Math.min(Math.round(r),100)},MR=(t,e,n)=>{const r=e.length,s=n.filter(o=>o.state==="completed");let i=t.campaignPhase;return t.campaignPhase===Ye.SETUP&&r>0?i=Ye.INTRODUCTION:t.campaignPhase===Ye.INTRODUCTION&&r>=5?i=Ye.RISING_ACTION:t.campaignPhase===Ye.RISING_ACTION&&(r>=15||s.length>=2)?i=Ye.CLIMAX:t.campaignPhase===Ye.CLIMAX&&(r>=25||s.length>=3)?i=Ye.RESOLUTION:t.campaignPhase===Ye.RESOLUTION&&(r>=30||s.length>=4)&&(i=Ye.COMPLETED),i!==t.campaignPhase?i:null};class OR{constructor(){this.defaultState={currentLocation:{name:"",description:"",npcs:[],features:[],atmosphere:"",exits:[]},activeNPCs:{},activePlotThreads:[],characterArcs:{},worldState:{timeOfDay:"day",weather:"clear",recentEvents:[],factionRelations:{},discoveredLocations:[],completedObjectives:[]},storyMetadata:{sessionStartTime:null,totalMessages:0,currentPhase:"introduction",campaignMood:"neutral",tensionLevel:0}}}initializeStoryState(e,n,r=null){const s={...this.defaultState};return e.forEach(i=>{s.characterArcs[i.id]={relationships:{},discoveries:[],motivations:[i.ideals||"adventure"],characterGrowth:[],currentGoals:[],personalityTraits:i.personality?i.personality.split(",").map(o=>o.trim()):[],backstoryElements:i.backstory?this.extractBackstoryElements(i.backstory):[]}}),s.currentLocation=this.extractInitialLocation(n),r&&r.description&&(s.storyMetadata.campaignMood=this.determineMoodFromTheme(r.description)),s}extractStoryElements(e){const n={npcInteractions:[],plotAdvancement:null,locationChanges:null,newDiscoveries:[],characterDevelopment:{},worldStateUpdates:{}};return[/(\w+)\s+(?:becomes?|grows?|seems?)\s+(friendly|hostile|neutral|suspicious|trusting)/gi,/(\w+)\s+(?:reacts?|responds?)\s+(?:with|in)\s+(joy|anger|fear|surprise|curiosity)/gi,/(\w+)\s+(?:shows?|displays?)\s+(gratitude|distrust|interest|concern)/gi].forEach(o=>{[...e.matchAll(o)].forEach(c=>{n.npcInteractions.push({npc:c[1],newDisposition:c[2],context:c[0]})})}),[/(?:discovers?|finds?|learns?)\s+(?:that\s+)?(.+?)(?:\.|!)/gi,/(?:new\s+)?(?:clue|evidence|information)\s+(?:about|regarding)\s+(.+?)(?:\.|!)/gi,/(?:progress|advance)\s+(?:in|on)\s+(.+?)(?:\.|!)/gi].forEach(o=>{const l=[...e.matchAll(o)];l.length>0&&(n.plotAdvancement={discovery:l[0][1],progress:.1})}),[/(?:moves?|goes?|travels?)\s+(?:to|towards?)\s+(.+?)(?:\.|!)/gi,/(?:enters?|approaches?)\s+(.+?)(?:\.|!)/gi,/(?:arrives?|reaches?)\s+(?:at|in)\s+(.+?)(?:\.|!)/gi].forEach(o=>{const l=[...e.matchAll(o)];l.length>0&&(n.locationChanges={newLocation:l[0][1],transition:l[0][0]})}),n}updateStoryState(e,n,r,s){const i={...e},o=this.extractStoryElements(n);if(o.npcInteractions.length>0&&o.npcInteractions.forEach(l=>{i.activeNPCs[l.npc]||(i.activeNPCs[l.npc]={disposition:"neutral",knowledge:[],relationships:{},currentGoal:"",firstAppearance:new Date().toISOString()}),i.activeNPCs[l.npc].disposition=l.newDisposition,i.activeNPCs[l.npc].lastInteraction=new Date().toISOString()}),o.plotAdvancement){const l=i.activePlotThreads.find(c=>c.id===this.generateThreadId(o.plotAdvancement.discovery));l?(l.progress=Math.min(1,l.progress+o.plotAdvancement.progress),l.lastUpdated=new Date().toISOString()):i.activePlotThreads.push({id:this.generateThreadId(o.plotAdvancement.discovery),title:o.plotAdvancement.discovery,status:"active",progress:o.plotAdvancement.progress,discoveredAt:new Date().toISOString(),lastUpdated:new Date().toISOString(),involvedNPCs:[],clues:[]})}if(s&&i.characterArcs[s]){const l=i.characterArcs[s],c=this.extractCharacterDevelopment(r,n);c.relationships&&(l.relationships={...l.relationships,...c.relationships}),c.discoveries&&(l.discoveries=[...new Set([...l.discoveries,...c.discoveries])]),c.motivations&&(l.motivations=[...new Set([...l.motivations,...c.motivations])]),c.growth&&(l.characterGrowth=[...new Set([...l.characterGrowth,...c.growth])])}return o.locationChanges&&(i.currentLocation={...i.currentLocation,name:o.locationChanges.newLocation,description:this.generateLocationDescription(o.locationChanges.newLocation),lastUpdated:new Date().toISOString()}),i.worldState.recentEvents=[...i.worldState.recentEvents.slice(-4),{event:r.substring(0,100)+"...",timestamp:new Date().toISOString(),characterId:s}],i.storyMetadata.totalMessages+=1,i.storyMetadata.lastUpdated=new Date().toISOString(),i}extractCharacterDevelopment(e,n){const r={relationships:{},discoveries:[],motivations:[],growth:[]};return[/(?:trusts?|likes?|respects?)\s+(\w+)/gi,/(?:distrusts?|dislikes?|fears?)\s+(\w+)/gi,/(?:befriends?|allies?\s+with)\s+(\w+)/gi].forEach(l=>{[...e.matchAll(l)].forEach(d=>{const f=d[1],m=d[0].toLowerCase();m.includes("trust")||m.includes("like")||m.includes("respect")?r.relationships[f]="positive":m.includes("distrust")||m.includes("dislike")||m.includes("fear")?r.relationships[f]="negative":(m.includes("friend")||m.includes("ally"))&&(r.relationships[f]="allied")})}),[/(?:discovers?|finds?|learns?)\s+(.+?)(?:\.|!)/gi,/(?:realizes?|understands?)\s+(.+?)(?:\.|!)/gi].forEach(l=>{[...e.matchAll(l)].forEach(d=>{r.discoveries.push(d[1].trim())})}),[/(?:wants?|desires?|seeks?)\s+(?:to\s+)?(.+?)(?:\.|!)/gi,/(?:motivated\s+by|driven\s+by)\s+(.+?)(?:\.|!)/gi].forEach(l=>{[...e.matchAll(l)].forEach(d=>{r.motivations.push(d[1].trim())})}),r}generateContextPrompt(e,n,r,s){const i={currentLocation:e.currentLocation,activeNPCs:e.activeNPCs,activePlotThreads:e.activePlotThreads,characterArcs:e.characterArcs,worldState:e.worldState,storyMetadata:e.storyMetadata};return`
STORY STATE SUMMARY:
Current Location: ${i.currentLocation.name} - ${i.currentLocation.description}
Atmosphere: ${i.currentLocation.atmosphere}
Active NPCs: ${Object.keys(i.activeNPCs).join(", ")||"None"}
Active Plot Threads: ${i.activePlotThreads.map(l=>`${l.title} (${Math.round(l.progress*100)}%)`).join(", ")||"None"}
Recent Events: ${i.worldState.recentEvents.slice(-3).map(l=>l.event).join(", ")||"None"}

CHARACTER CONTEXT:
${n.map(l=>{const c=i.characterArcs[l.id]||{},d=Object.entries(c.relationships||{}).map(([m,y])=>`${m} (${y})`).join(", "),f=c.discoveries?c.discoveries.slice(-3).join(", "):"";return`${l.name}: Relationships: ${d||"None"}. Recent discoveries: ${f||"None"}`}).join(`
`)}

NPC RELATIONSHIPS:
${Object.entries(i.activeNPCs).map(([l,c])=>`${l}: ${c.disposition} disposition, ${c.knowledge.length} pieces of knowledge, goal: ${c.currentGoal||"unknown"}`).join(`
`)}

STORY HISTORY (Last 5 messages):
${r.slice(-5).map(l=>`${l.role}: ${l.content}`).join(`
`)}

PLAYER RESPONSE: "${s}"

CRITICAL CONSISTENCY RULES:
1. Maintain all established NPC relationships and dispositions
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

RESPONSE REQUIREMENTS:
- Acknowledge the player's action in context of the current situation and location
- Reference relevant NPCs and their established relationships with the party
- Continue or advance active plot threads appropriately
- Update character relationships based on the action
- Maintain location and atmosphere consistency
- End with a clear situation that invites the next player response
- Keep the story flowing naturally without jarring transitions
`}extractInitialLocation(e){const n=[/(?:in|at|near)\s+(.+?)(?:\.|,|!)/gi,/(?:town|city|village|castle|tower|dungeon|forest|mountain)\s+(?:of|in|near)\s+(.+?)(?:\.|,|!)/gi];for(const r of n){const s=[...e.matchAll(r)];if(s.length>0)return{name:s[0][1].trim(),description:"A location mentioned in the plot",npcs:[],features:[],atmosphere:"mysterious",exits:[]}}return{name:"Starting Location",description:"Where the adventure begins",npcs:[],features:[],atmosphere:"neutral",exits:[]}}extractBackstoryElements(e){const n=[];return[/(?:family|parents?|siblings?)\s+(.+?)(?:\.|,)/gi,/(?:trained|learned|studied)\s+(.+?)(?:\.|,)/gi,/(?:worked|served|lived)\s+(?:as|in)\s+(.+?)(?:\.|,)/gi].forEach(s=>{[...e.matchAll(s)].forEach(o=>{n.push(o[1].trim())})}),n}determineMoodFromTheme(e){const n=e.toLowerCase();return n.includes("dark")||n.includes("gothic")||n.includes("horror")?"dark":n.includes("light")||n.includes("happy")||n.includes("cheerful")?"light":n.includes("mysterious")||n.includes("enigmatic")?"mysterious":n.includes("epic")||n.includes("grand")?"epic":"neutral"}generateThreadId(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"_").substring(0,20)}generateLocationDescription(e){const n=["A place of mystery and adventure","An area with its own unique character","A location that holds many secrets","A place where stories unfold","An area rich with history and possibility"];return n[Math.floor(Math.random()*n.length)]}}const LR=new OR;function VR(){var Y;const{partyId:t}=Wc(),e=zn(),r=Ui().pathname,[s,i]=D.useState(null),[o,l]=D.useState(null),[c,d]=D.useState(null),[f,m]=D.useState([]),[y,I]=D.useState([]),[N,j]=D.useState({}),[A,T]=D.useState(!0),[w,S]=D.useState(""),[O,R]=D.useState(""),[V,_]=D.useState(!1),[g,E]=D.useState(!1),[x,C]=D.useState(!1),P=D.useRef(!1),b=D.useRef(!1),[ce,$e]=D.useState([]),[et,Ve]=D.useState("Investigation"),[K,se]=D.useState([]),[ie,Ee]=D.useState(!1),[ye,Te]=D.useState(null);D.useEffect(()=>{const L=ss(W=>{if(!W){e("/login");return}i(W)});return()=>L()},[e]),D.useEffect(()=>{s&&t&&gt()},[s,t]),D.useEffect(()=>{if(t)try{const L=GE(t,W=>{W&&W.status==="active"&&(r.includes("/combat/")||e(`/combat/${t}`))});return()=>L()}catch(L){console.error("Error subscribing to combat session:",L)}},[t,e,r]),D.useEffect(()=>{if(t)try{const L=kp(Xt(it(ge,"characters"),kt("partyId","==",t)),W=>{const k=W.docs.map(F=>({id:F.id,...F.data()}));console.log("Characters updated in real-time:",k),m(k)},W=>{console.error("Error subscribing to character updates:",W)});return()=>L()}catch(L){console.error("Error setting up character subscription:",L)}},[t]),D.useEffect(()=>()=>{C(!1)},[]),D.useEffect(()=>{(o==null?void 0:o.status)==="ready_up"&&(b.current=!1,P.current=!1)},[o==null?void 0:o.status]),D.useEffect(()=>{var L;if(s&&f.length>0&&o){const W=f.find(F=>F.userId===s.uid),k=(L=o.readyPlayers)==null?void 0:L.includes(s.uid);W&&!k&&o.status==="ready_up"&&Qe()}},[f,o,s]);const gt=async()=>{var L,W;try{T(!0),console.log("Loading story and characters for partyId:",t);const[k,F,H]=await Promise.all([nR(t),Rp(t),HE(t)]);if(console.log("Loaded characters:",F),console.log("Loaded story:",k),console.log("Loaded party:",H),m(F),d(H),F.length===0&&s)try{const ee=(await jp(s.uid)).find(ne=>ne.id===t);if(ee){I(ee.members||[]),console.log("Loaded party members:",ee.members);const ne={};for(const ue of ee.members)try{const pe=await Hi(ue);ne[ue]=pe}catch(pe){console.error("Error loading profile for member:",ue,pe),ne[ue]=null}j(ne)}}catch(G){console.error("Error loading party members:",G)}if(k){if(k.votingSession&&k.status==="voting"&&(await yn(k.id,{votingSession:null}),k.votingSession=null),k.storyMessages){const G=k.storyMessages.filter(ee=>{var ne,ue;return!((ne=ee.content)!=null&&ne.includes("tie"))&&!((ue=ee.content)!=null&&ue.includes("vote again"))&&ee.type!=="tie_break"});G.length!==k.storyMessages.length&&(await yn(k.id,{storyMessages:G}),k.storyMessages=G)}if(l(k),_(((L=k.readyPlayers)==null?void 0:L.includes(s==null?void 0:s.uid))||!1),k.status==="storytelling"&&H){const G=ov(H.description||"");$e(G);const ee=((W=k.storyMessages)==null?void 0:W.length)||0;ee<5?Ve("Investigation"):ee<15?Ve("Conflict"):Ve("Resolution")}}else{const G=await tR(t);l(G)}}catch(k){console.error("Error in loadStoryAndCharacters:",k),S("Failed to load campaign story")}finally{T(!1)}};D.useEffect(()=>{if(o!=null&&o.id&&s){const L=sR(o.id,W=>{var k,F,H;if(W&&(l(W),_(((k=W.readyPlayers)==null?void 0:k.includes(s.uid))||!1),W.status==="voting"&&(E(!1),b.current=!1),W.status==="storytelling"&&c)){if(ce.length===0){const ne=ov(c.description||"");$e(ne)}const G=((F=W.storyMessages)==null?void 0:F.length)||0;G<5&&et!=="Investigation"?Ve("Investigation"):G>=5&&G<15&&et!=="Conflict"?Ve("Conflict"):G>=15&&et!=="Resolution"&&Ve("Resolution");const ee=(H=W.storyMessages)==null?void 0:H[W.storyMessages.length-1];if(ee&&ee.role==="assistant"){const ne=AR(ce,ee.content);se(ne)}}});return()=>L()}},[o==null?void 0:o.id,s==null?void 0:s.uid,c,ce,et]);const Qe=async()=>{if(!s)return;if(!f.find(W=>W.userId===s.uid)){e(`/character-creation/${t}`);return}try{await rR(o.id,s.uid),_(!0)}catch{S("Failed to ready up")}},yt=async()=>{var W;if(P.current||b.current||(o==null?void 0:o.status)==="voting"||(o==null?void 0:o.status)==="storytelling"){console.log("Plot generation already in progress or completed");return}const L=(W=o==null?void 0:o.storyMessages)==null?void 0:W.filter(k=>k.type==="plot_selection");if(L&&L.length>0){console.log("Plots already exist, skipping generation"),(o==null?void 0:o.status)==="ready_up"&&await yn(o.id,{status:"voting",votingSession:null});return}if(A){console.log("Already loading, skipping request");return}try{if(P.current=!0,b.current=!0,E(!0),T(!0),(o==null?void 0:o.status)!=="ready_up"){console.log("Story is no longer in ready_up status");return}const F=`Generate 3 distinct campaign plot options for this party. For each plot, provide a compelling title and a brief summary (2-3 sentences). Format as:

Plot 1: [Title]
[Summary]

Plot 2: [Title]  
[Summary]

Plot 3: [Title]
[Summary]

Party: ${f.map(G=>`${G.name} - Level ${G.level} ${G.race} ${G.class}. ${G.personality||""}. ${G.backstory||""}`).join(`
`)}`,H=await Dn.generatePlotOptions(f,c);await fd(o.id,{role:"assistant",content:H,type:"plot_selection"}),await yn(o.id,{status:"voting",votingSession:null})}catch(k){S("Failed to start story generation"),console.error(k)}finally{P.current=!1,E(!1),T(!1)}},ot=async L=>{if(!(!s||!c)){if(c.dmId!==s.uid){S("Only the campaign creator can select the plot");return}if((o==null?void 0:o.status)==="storytelling"){console.log("Plot already selected, story in progress");return}try{T(!0);const W=o.storyMessages.find(H=>H.type==="plot_selection"),k=await Dn.generateCampaignGoal(f,(W==null?void 0:W.content)||"",c);await yn(o.id,{status:"storytelling",currentPlot:L,votingSession:null,campaignMetadata:{...o.campaignMetadata,mainGoal:k,campaignPhase:Ye.INTRODUCTION,plotDetails:(W==null?void 0:W.content)||""}}),await fd(o.id,{role:"assistant",content:`The Dungeon Master has chosen Plot ${L}! Let the story begin...`,type:"plot_selected"});const F=await Dn.generateStoryIntroduction(f,(W==null?void 0:W.content)||"",L,c);await fd(o.id,{role:"assistant",content:F,type:"story_introduction"}),await pd(o.id,c.dmId)}catch(W){S("Failed to select plot"),console.error(W)}finally{T(!1)}}},cn=async()=>{var L,W,k;if(!(!O.trim()||!s||!o))try{T(!0);const F=ye||await lR(o.id),H=await addStoryMessageWithMetadata(o.id,{role:"user",content:O,userId:s.uid,characterName:((L=f.find(pe=>pe.userId===s.uid))==null?void 0:L.name)||"Unknown"},F),G=PR(O,ce);G.length>0&&$e(pe=>{const tt=[...pe];return G.forEach(dn=>{const hn=tt.findIndex($s=>$s.id===dn.id);hn!==-1&&(tt[hn]=dn)}),tt});let ee;o.campaignMetadata&&o.campaignMetadata.mainGoal?ee=await Dn.generateCampaignContinuation(f,o.campaignMetadata,o.storyMessages,O,c):ee=await Dn.generateStoryContinuation(f,o.storyMessages,O,F,"individual",c);const ne=LR.updateStoryState(F,ee,O,(W=f.find(pe=>pe.userId===s.uid))==null?void 0:W.id);if(await cR(o.id,ne),Te(ne),await addStoryMessageWithMetadata(o.id,{role:"assistant",content:ee,type:"story_continuation"},ne),o.campaignMetadata){const pe=jR(o.campaignMetadata,o.storyMessages,f),tt=DR(o.campaignMetadata,o.storyMessages,ce),dn=MR(o.campaignMetadata,o.storyMessages,ce),hn={"campaignMetadata.storyContext":{...o.campaignMetadata.storyContext,...pe},"campaignMetadata.campaignProgress":tt};dn&&(hn["campaignMetadata.campaignPhase"]=dn),await yn(o.id,hn)}else console.warn("No campaign metadata found, skipping campaign updates");if(R(""),is(ee,ne,O).shouldInitiate){C(!0);const pe={storyContext:ee,partyMembers:f,enemies:Sn(ee,f.length),environmentalFeatures:((k=ne.currentLocation)==null?void 0:k.features)||[],teamUpOpportunities:Rn.identifyTeamUpOpportunities(f),narrativeElements:Rn.extractNarrativeElements(ee)},tt=await createEnhancedCombatSession(t,pe);await yn(o.id,{status:"paused",currentCombat:tt.id}),setTimeout(()=>{e(`/combat/${t}`)},2e3)}}catch(F){S("Failed to send response"),console.error(F)}finally{T(!1)}},is=(L,W,k)=>{var pe,tt,dn,hn,$s,mr;const F=["combat","battle","fight","attack","enemy","monster"],H=["tension","threat","danger","hostile","aggressive"],G=F.some(gr=>L.toLowerCase().includes(gr)),ee=H.some(gr=>L.toLowerCase().includes(gr)),ne=((tt=(pe=W==null?void 0:W.currentLocation)==null?void 0:pe.atmosphere)==null?void 0:tt.includes("dangerous"))||((hn=(dn=W==null?void 0:W.currentLocation)==null?void 0:dn.atmosphere)==null?void 0:hn.includes("hostile"))||((mr=($s=W==null?void 0:W.currentLocation)==null?void 0:$s.atmosphere)==null?void 0:mr.includes("threatening")),ue=F.some(gr=>k.toLowerCase().includes(gr));return{shouldInitiate:G||ee&&ne||ue,reason:G?"explicit_combat":ee&&ne?"escalating_tension":ue?"player_intent":"none"}},Sn=(L,W)=>{const k={goblin:{name:"Goblin",hp:12,ac:14,level:1,charisma:8},orc:{name:"Orc",hp:30,ac:16,level:3,charisma:12},troll:{name:"Troll",hp:84,ac:15,level:5,charisma:7},dragon:{name:"Dragon",hp:200,ac:19,level:10,charisma:19},bandit:{name:"Bandit",hp:16,ac:12,level:1,charisma:10},skeleton:{name:"Skeleton",hp:13,ac:13,level:1,charisma:5},zombie:{name:"Zombie",hp:22,ac:8,level:1,charisma:3}},F=L.toLowerCase();let H="bandit";F.includes("goblin")?H="goblin":F.includes("orc")?H="orcs":F.includes("troll")?H="troll":F.includes("dragon")?H="dragon":F.includes("undead")||F.includes("skeleton")?H="skeleton":F.includes("zombie")&&(H="zombie");const G=k[H],ee=Math.min(W+1,6),ne=[];for(let ue=0;ue<ee;ue++)ne.push({id:`enemy_${ue}`,name:`${G.name} ${ue+1}`,type:G.name,hp:G.hp+Math.floor(Math.random()*10),maxHp:G.hp+Math.floor(Math.random()*10),ac:G.ac+Math.floor(Math.random()*3),initiative:Math.floor(Math.random()*20)+1,charisma:G.charisma,portrait:"/placeholder-enemy.png"});return ne},un=L=>{if(!L)return L;const W=["enemy","enemies","monster","monsters","bandit","bandits","goblin","goblins","orc","orcs","dragon","dragons","troll","trolls","zombie","zombies","skeleton","skeletons","assassin","assassins","guard","guards","soldier","soldiers","thief","thieves","brigand","brigands","raider","raiders","cultist","cultists","demon","demons","devil","devils","ghost","ghosts","specter","specters","wraith","wraiths","hobgoblin","hobgoblins","bugbear","bugbears","kobold","kobolds","ogre","ogres","giant","giants","beholder","beholders","lich","liches","vampire","vampires","werewolf","werewolves","hag","hags","witch","witches","necromancer","necromancers"],k=["search","investigate","examine","look around","check","explore","clue","clues","evidence","footprint","footprints","track","tracks","marking","markings","sign","signs","trace","traces","remains","ruin","ruins","artifact","artifacts","scroll","scrolls","book","books","map","maps","diary","journal","note","notes","door","doors","passage","passages","tunnel","tunnels","chamber","chambers","room","rooms","area","areas","mystery","mysterious","hidden","secret","secrets","concealed","strange","unusual","curious","suspicious","odd","peculiar","trap","traps","pressure plate","pressure plates","lever","levers","button","buttons","switch","switches","key","keys","lock","locks"],F=["tavern","inn","shop","market","temple","castle","fortress","tower","dungeon","cave","forest","mountain","river","bridge","gate","wall","street","alley","square","plaza","district","village","town","city","settlement","outpost","camp","crypt","tomb","grave","cemetery","shrine","altar","library","archive","guild","hall","mansion","palace","basement","cellar","attic","rooftop","balcony","courtyard","garden","park","field","meadow","swamp","desert","island"],H=["attack","fight","battle","combat","defend","strike","sword","swords","axe","axes","bow","bows","arrow","arrows","spell","spells","magic","magical","cast","casting","initiative","turn","round","action","movement","charge","retreat","advance","position","formation","shield","armor","helmet","dagger","daggers","mace","maces","fireball","lightning","heal","healing","cure","bless","curse"];let G=L;return[...W,...k,...F,...H].forEach(ne=>{const ue=new RegExp(`\\b${ne}\\b`,"gi");G=G.replace(ue,`<strong>${ne}</strong>`)}),G},xe=()=>{var L;return((L=o==null?void 0:o.readyPlayers)==null?void 0:L.length)||0},vt=()=>c&&c.members&&Array.isArray(c.members)?c.members.length:f.length>0?f.length:y.length>0?y.length:1,Cn=xe()===vt(),Pn=()=>{const L=o.storyMessages.filter(W=>W.type==="plot_selection");if(L.length>0){const k=L[L.length-1].content.split(`
`),F=[];let H=null;const G=new Set;return k.forEach(ee=>{var ue;const ne=ee.trim();if(ne.startsWith("Plot 1:")||ne.startsWith("Plot 2:")||ne.startsWith("Plot 3:")){H&&!G.has(H.title)&&(F.push(H),G.add(H.title));const pe=(ue=ne.match(/Plot (\d+):/))==null?void 0:ue[1],tt=ne.replace(/Plot \d+:\s*/,"").trim();G.has(tt)?H=null:H={number:parseInt(pe),title:tt,summary:""}}else H&&ne&&!ne.startsWith("Party:")&&!ne.startsWith("CRITICAL")&&!ne.startsWith("Make each")&&(H.summary+=(H.summary?" ":"")+ne)}),H&&!G.has(H.title)&&F.push(H),F.slice(0,3)}return[{number:1,title:"Plot 1",summary:"No plot data available"},{number:2,title:"Plot 2",summary:"No plot data available"},{number:3,title:"Plot 3",summary:"No plot data available"}]},Wt=()=>!f.length||!s?f:[...f].sort((L,W)=>L.userId===s.uid?-1:W.userId===s.uid?1:0),z=()=>{if(!(o!=null&&o.campaignMetadata))return null;const L=o.campaignMetadata;return u.jsxs("div",{className:"bg-purple-100 border border-purple-200 rounded-lg p-4 mb-6",children:[u.jsx("h3",{className:"font-bold text-purple-800 mb-2",children:"📖 Campaign Progress"}),u.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[u.jsxs("div",{children:[u.jsx("span",{className:"font-semibold",children:"Session:"})," ",L.sessionNumber]}),u.jsxs("div",{children:[u.jsx("span",{className:"font-semibold",children:"Phase:"})," ",L.campaignPhase.replace("_"," ")]}),u.jsxs("div",{children:[u.jsx("span",{className:"font-semibold",children:"Progress:"})," ",L.campaignProgress,"%"]}),u.jsxs("div",{children:[u.jsx("span",{className:"font-semibold",children:"Goal:"})," ",L.mainGoal?"Set":"Pending"]})]}),L.mainGoal&&u.jsxs("div",{className:"mt-2 text-purple-700",children:[u.jsx("span",{className:"font-semibold",children:"Main Goal:"})," ",L.mainGoal]})]})};return s?A?u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsx("div",{className:"text-center py-8",children:u.jsx("div",{className:"text-stone-600",children:"Loading campaign story..."})})})}):u.jsx("div",{className:"fantasy-container py-8",children:u.jsxs("div",{className:"fantasy-card",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h1",{className:"fantasy-title mb-0",children:"Campaign Story"}),u.jsx("button",{onClick:()=>e("/dashboard"),className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Back to Dashboard"})]}),w&&u.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:w}),x&&u.jsx("div",{className:"bg-orange-100 border border-orange-400 text-orange-700 px-4 py-3 rounded-lg mb-6",children:u.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[u.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-orange-600"}),u.jsx("span",{className:"font-semibold",children:"⚔️ Combat is being initiated! Redirecting to battle arena..."})]})}),(o==null?void 0:o.status)==="paused"&&(o==null?void 0:o.currentCombat)&&u.jsx("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded-lg mb-6",children:u.jsx("div",{className:"flex items-center justify-center space-x-2",children:u.jsx("span",{className:"font-semibold",children:"⚔️ Story is paused for combat. Please wait for the battle to conclude."})})}),(o==null?void 0:o.status)==="ready_up"&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"text-center",children:[u.jsx("h2",{className:"text-xl font-bold text-stone-800 mb-4",children:"Ready Up"}),u.jsx("p",{className:"text-stone-600 mb-4",children:"All players must ready up before the story begins"}),u.jsxs("div",{className:"mb-6",children:[u.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-2",children:[u.jsxs("div",{className:"text-lg font-semibold text-amber-700",children:[xe(),"/",vt()," Players Ready"]}),u.jsxs("div",{className:"text-sm text-stone-500",children:["(",Math.round(xe()/vt()*100),"%)"]})]}),u.jsx("div",{className:"w-full bg-stone-200 rounded-full h-2 max-w-md mx-auto",children:u.jsx("div",{className:"bg-amber-600 h-2 rounded-full transition-all duration-300",style:{width:`${xe()/vt()*100}%`}})})]}),f.length===0&&u.jsx("div",{className:"bg-blue-100 border border-blue-200 rounded-lg p-4 mb-4",children:u.jsxs("p",{className:"text-blue-800",children:[u.jsx("strong",{children:"No characters created yet!"})," Players should create their characters first. You can still ready up and start the story, but characters will need to be created before the adventure begins."]})})]}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.length>0?Wt().map(L=>{var F;const W=(F=o.readyPlayers)==null?void 0:F.includes(L.userId),k=L.userId===(s==null?void 0:s.uid);return u.jsx("div",{className:`fantasy-card transition-all duration-200 ${W?"bg-green-50 border-green-200":"bg-amber-50"}`,children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"w-16 h-16 bg-stone-300 rounded-full mx-auto mb-2 flex items-center justify-center",children:u.jsx("span",{className:"text-xs text-stone-600",children:"IMG"})}),u.jsx("h3",{className:"font-bold text-stone-800",children:L.name}),u.jsxs("p",{className:"text-sm text-stone-600",children:["Level ",L.level," ",L.race," ",L.class]}),k&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"text-blue-600 text-xs font-medium",children:"(You)"}),u.jsx("div",{className:"mt-2",children:u.jsx("button",{className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 text-xs px-3 py-1 mt-2",onClick:()=>e(`/character-creation/${t}`),children:"Edit Character"})})]}),u.jsx("div",{className:"mt-2",children:W?u.jsxs("div",{className:"flex items-center justify-center space-x-1 text-green-600 font-semibold",children:[u.jsx("span",{children:"✓"}),u.jsx("span",{children:"Ready"})]}):u.jsxs("div",{className:"flex items-center justify-center space-x-1 text-stone-500",children:[u.jsx("div",{className:"w-3 h-3 border-2 border-stone-300 border-t-stone-600 rounded-full animate-spin"}),u.jsx("span",{children:"Waiting..."})]})})]})},L.id)}):y.map((L,W)=>{var ee;const k=N[L],F=(k==null?void 0:k.username)||`Player ${W+1}`,H=(ee=o.readyPlayers)==null?void 0:ee.includes(L),G=L===(s==null?void 0:s.uid);return u.jsx("div",{className:`fantasy-card transition-all duration-200 ${H?"bg-green-50 border-green-200":"bg-amber-50"}`,children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"w-16 h-16 bg-stone-300 rounded-full mx-auto mb-2 flex items-center justify-center",children:u.jsx("span",{className:"text-xs text-stone-600",children:"IMG"})}),u.jsx("h3",{className:"font-bold text-stone-800",children:F}),u.jsx("p",{className:"text-sm text-stone-600",children:"No character created yet"}),G&&u.jsx("span",{className:"text-blue-600 text-xs font-medium",children:"(You)"}),u.jsx("div",{className:"mt-2",children:H?u.jsxs("div",{className:"flex items-center justify-center space-x-1 text-green-600 font-semibold",children:[u.jsx("span",{children:"✓"}),u.jsx("span",{children:"Ready"})]}):u.jsxs("div",{className:"flex items-center justify-center space-x-1 text-stone-500",children:[u.jsx("div",{className:"w-3 h-3 border-2 border-stone-300 border-t-stone-600 rounded-full animate-spin"}),u.jsx("span",{children:"Waiting..."})]})})]})},L)})}),u.jsxs("div",{className:"text-center",children:[V?u.jsx("div",{className:"text-green-600 font-semibold",children:"You are ready!"}):u.jsx("button",{onClick:Qe,className:"fantasy-button",children:f.find(L=>L.userId===(s==null?void 0:s.uid))?"Ready Up":"Create Character & Ready Up"}),Cn&&u.jsx("button",{onClick:yt,disabled:A||g||(o==null?void 0:o.status)==="voting",className:"fantasy-button bg-amber-700 hover:bg-amber-800 ml-4",children:A||g?"Generating Story...":"Start Story Generation"})]})]}),(o==null?void 0:o.status)==="voting"&&u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-xl font-bold text-stone-800",children:"Choose Your Adventure"}),c&&c.dmId===(s==null?void 0:s.uid)?u.jsx("div",{className:"space-y-4",children:u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Pn().map(L=>u.jsxs("div",{className:"fantasy-card bg-amber-50",children:[u.jsx("h3",{className:"font-bold text-stone-800 mb-2 text-lg",children:L.title}),u.jsx("p",{className:"text-stone-600 text-sm mb-4",children:L.summary}),u.jsx("button",{onClick:()=>ot(L.number),disabled:A,className:"fantasy-button w-full bg-amber-600 hover:bg-amber-700",children:A?"Selecting...":`Choose Plot ${L.number}`})]},L.number))})}):u.jsxs("div",{className:"bg-blue-100 border border-blue-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-bold text-blue-800 mb-2",children:"⏳ Waiting for Dungeon Master"}),u.jsx("p",{className:"text-blue-700",children:"The campaign creator is choosing which plot to pursue. Please wait while they make their decision."}),u.jsx("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:Pn().map(L=>u.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-3",children:[u.jsx("h4",{className:"font-bold text-stone-800 mb-2",children:L.title}),u.jsx("p",{className:"text-stone-600 text-sm",children:L.summary})]},L.number))})]})]}),((o==null?void 0:o.status)==="storytelling"||(o==null?void 0:o.status)==="paused")&&u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-xl font-bold text-stone-800",children:"Your Adventure"}),(c==null?void 0:c.dmId)===(s==null?void 0:s.uid)&&u.jsxs("div",{className:"bg-purple-100 border border-purple-200 rounded-lg p-4",children:[u.jsxs("h3",{className:"font-bold text-purple-800 mb-2",children:["📖 Story Phase: ",et]}),u.jsxs("p",{className:"text-purple-700 text-sm",children:[et==="Investigation"&&"Explore, discover clues, and gather information about the situation.",et==="Conflict"&&"Face challenges, threats, and make difficult choices.",et==="Resolution"&&"Conclude the story arc and see the consequences of your actions."]})]}),(c==null?void 0:c.dmId)===(s==null?void 0:s.uid)&&ce.length>0&&u.jsxs("div",{className:"bg-emerald-100 border border-emerald-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-bold text-emerald-800 mb-3",children:"🎯 Discovered Objectives"}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:kR(ce).map(L=>u.jsxs("div",{className:"bg-white border border-emerald-300 rounded-lg p-3",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("h4",{className:"font-semibold text-emerald-800 text-sm",children:L.title}),u.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${L.state===Ct.COMPLETED?"bg-green-100 text-green-800":L.state===Ct.IN_PROGRESS?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:L.state===Ct.COMPLETED?"✓ Complete":L.state===Ct.IN_PROGRESS?"⟳ In Progress":"🔍 Discovered"})]}),u.jsx("p",{className:"text-emerald-700 text-xs",children:L.description})]},L.id))}),K.length>0&&u.jsxs("div",{className:"mt-4 pt-4 border-t border-emerald-300",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("h4",{className:"font-semibold text-emerald-800 text-sm",children:"💡 Subtle Hints"}),u.jsxs("button",{onClick:()=>Ee(!ie),className:"text-emerald-600 hover:text-emerald-800 text-xs",children:[ie?"Hide":"Show"," Hints"]})]}),ie&&u.jsx("div",{className:"space-y-2",children:K.map((L,W)=>u.jsx("div",{className:"text-emerald-700 text-xs italic",children:L},W))})]})]}),u.jsxs("div",{className:"bg-blue-100 border border-blue-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-bold text-blue-800 mb-2",children:"🎭 Storytelling Guidelines"}),u.jsxs("p",{className:"text-blue-700 text-sm",children:[u.jsx("strong",{children:"Turn-taking:"})," Respond to the story or let someone else speak. Only one person can respond at a time."]})]}),u.jsx("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4 max-h-96 overflow-y-auto",children:o.storyMessages.filter(L=>L.type!=="plot_selection").map(L=>u.jsx("div",{className:"mb-4",children:L.role==="assistant"?u.jsxs("div",{className:"bg-blue-100 border border-blue-200 rounded-lg p-3",children:[u.jsx("div",{className:"font-semibold text-blue-800 mb-1",children:"Game Master"}),u.jsx("div",{className:"text-blue-900 whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:un(L.content)}})]}):u.jsxs("div",{className:"bg-green-100 border border-green-200 rounded-lg p-3",children:[u.jsx("div",{className:"font-semibold text-green-800 mb-1",children:L.playerName}),u.jsx("div",{className:"text-green-900",dangerouslySetInnerHTML:{__html:un(L.content)}})]})},L.id))}),(o==null?void 0:o.status)==="storytelling"&&(o!=null&&o.currentSpeaker)?u.jsxs("div",{className:"space-y-4",children:[o.currentSpeaker.userId===(s==null?void 0:s.uid)?u.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-bold text-amber-800 mb-3",children:"How will you respond?"}),u.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[u.jsx("div",{className:"w-10 h-10 bg-amber-200 rounded-full flex items-center justify-center",children:u.jsx("span",{className:"text-amber-800 font-bold",children:o.currentSpeaker.name.charAt(0)})}),u.jsxs("div",{children:[u.jsx("div",{className:"font-medium text-amber-800",children:o.currentSpeaker.name}),u.jsxs("div",{className:"text-sm text-amber-700",children:[o.currentSpeaker.race," ",o.currentSpeaker.class]})]})]}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsx("input",{type:"text",value:O,onChange:L=>R(L.target.value),placeholder:`What does ${o.currentSpeaker.name} do?`,className:"fantasy-input flex-1",onKeyPress:L=>L.key==="Enter"&&cn()}),u.jsx("button",{onClick:cn,disabled:!O.trim(),className:"fantasy-button",children:"Send"})]})]}):u.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[u.jsxs("h3",{className:"font-bold text-blue-800 mb-3",children:["Waiting for ",o.currentSpeaker.name," to respond"]}),u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("div",{className:"w-10 h-10 bg-blue-200 rounded-full flex items-center justify-center",children:u.jsx("span",{className:"text-blue-800 font-bold",children:o.currentSpeaker.name.charAt(0)})}),u.jsxs("div",{children:[u.jsx("div",{className:"font-medium text-blue-800",children:o.currentSpeaker.name}),u.jsxs("div",{className:"text-sm text-blue-700",children:[o.currentSpeaker.race," ",o.currentSpeaker.class]})]})]}),u.jsxs("p",{className:"text-blue-700 mt-2",children:[o.currentSpeaker.name," is currently speaking. Please wait for their response."]})]}),(((Y=o==null?void 0:o.currentSpeaker)==null?void 0:Y.userId)===(s==null?void 0:s.uid)||(o==null?void 0:o.currentController)===(s==null?void 0:s.uid))&&u.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:[u.jsx("h4",{className:"font-bold text-stone-800 mb-3 text-center",children:"Let someone else speak"}),u.jsx("div",{className:"flex justify-center",children:u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-4xl",children:Wt().map(L=>{var k,F;const W=L.userId===(s==null?void 0:s.uid);return u.jsxs("button",{onClick:async()=>{await iv(o.id,L),await pd(o.id,L.userId)},disabled:L.id===((k=o==null?void 0:o.currentSpeaker)==null?void 0:k.id),className:`p-4 rounded-lg border-2 transition-colors text-center ${L.id===((F=o==null?void 0:o.currentSpeaker)==null?void 0:F.id)?"border-stone-300 bg-stone-100 text-stone-500 cursor-not-allowed":"border-stone-200 bg-white hover:border-stone-300 text-stone-700"}`,children:[u.jsxs("div",{className:"font-medium mb-1",children:[u.jsx("span",{children:L.name}),W&&u.jsx("span",{className:"text-blue-600 text-xs font-medium ml-1",children:"(you)"})]}),u.jsxs("div",{className:"text-sm opacity-75",children:[L.race," ",L.class]})]},L.id)})})})]})]}):(c==null?void 0:c.dmId)===(s==null?void 0:s.uid)||(o==null?void 0:o.currentController)===(s==null?void 0:s.uid)?u.jsxs("div",{className:"bg-stone-50 border border-stone-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-bold text-stone-800 mb-3 text-center",children:"Choose who speaks"}),u.jsx("div",{className:"flex justify-center",children:u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-4xl",children:Wt().map(L=>{const W=L.userId===(s==null?void 0:s.uid);return u.jsxs("button",{onClick:async()=>{await iv(o.id,L),await pd(o.id,L.userId)},className:"p-4 rounded-lg border-2 border-stone-200 bg-white hover:border-stone-300 text-stone-700 transition-colors text-center",children:[u.jsxs("div",{className:"font-medium mb-1",children:[u.jsx("span",{children:L.name}),W&&u.jsx("span",{className:"text-blue-600 text-xs font-medium ml-1",children:"(you)"})]}),u.jsxs("div",{className:"text-sm opacity-75",children:[L.race," ",L.class]})]},L.id)})})})]}):u.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[u.jsx("h3",{className:"font-bold text-blue-800 mb-3",children:o.storyMessages.length>0?"Waiting for next speaker":"Waiting for the story to begin"}),u.jsx("p",{className:"text-blue-700",children:o.storyMessages.length>0?"The Dungeon Master is choosing who will speak next. Please wait.":"The Dungeon Master is choosing who will speak first. Please wait."})]}),(o==null?void 0:o.status)==="storytelling"&&z()]})]})}):u.jsx("div",{className:"fantasy-container py-8",children:u.jsx("div",{className:"fantasy-card",children:u.jsx("div",{className:"text-center py-8",children:u.jsx("div",{className:"text-stone-600",children:"Loading..."})})})})}function UR(){return u.jsx(HI,{basename:"/DND-V1",children:u.jsxs("div",{className:"min-h-screen flex flex-col",children:[u.jsx(pR,{}),u.jsx("main",{className:"flex-grow",children:u.jsxs(VI,{children:[u.jsx(kn,{path:"/",element:u.jsx(gR,{})}),u.jsx(kn,{path:"/login",element:u.jsx(yR,{})}),u.jsx(kn,{path:"/register",element:u.jsx(vR,{})}),u.jsx(kn,{path:"/dashboard",element:u.jsx(wR,{})}),u.jsx(kn,{path:"/character-creation/:partyId",element:u.jsx(ER,{})}),u.jsx(kn,{path:"/party-management",element:u.jsx(xR,{})}),u.jsx(kn,{path:"/campaign/:partyId",element:u.jsx(SR,{})}),u.jsx(kn,{path:"/campaign-story/:partyId",element:u.jsx(VR,{})}),u.jsx(kn,{path:"/combat/:partyId",element:u.jsx(CR,{})})]})})]})})}md.createRoot(document.getElementById("root")).render(u.jsx(yv.StrictMode,{children:u.jsx(UR,{})}));
