import{r,j as e,w as ve,q as Ve,u as Be,o as Ie,G as P,J as Ye}from"./index-c208d5f4.js";import{l as J,g as Ge,f as je,a as fe,b as Ue,d as Xe,D as Qe,c as ee,e as _e}from"./DMCombatView-ac5ce6fc.js";import{a as _}from"./manualCombat-33808f22.js";function Je({character:s,isOpen:o,onClose:c}){const[p,C]=r.useState("overview");if(!o||!s)return null;const v=[{id:"overview",name:"📊 Overview",icon:"📊"},{id:"equipment",name:"🎒 Equipment",icon:"🎒"},{id:"details",name:"📝 Details",icon:"📝"}];s.spells&&s.spells.length>0&&v.push({id:"spells",name:"✨ Spells",icon:"✨"});const $=s.xp||0,k=s.level||1,A=J.calculateXPForNextLevel(k),y=J.calculateXPProgress($,k);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-6 shadow-lg backdrop-blur-sm max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-400",children:s.name}),e.jsx("button",{onClick:c,className:"text-slate-400 hover:text-slate-200 text-2xl font-bold",children:"×"})]}),e.jsx("div",{className:"flex border-b border-slate-600 mb-6",children:v.map(u=>e.jsxs("button",{onClick:()=>C(u.id),className:`px-4 py-2 font-medium transition-colors ${p===u.id?"text-amber-400 border-b-2 border-amber-400":"text-slate-400 hover:text-slate-300"}`,children:[e.jsx("span",{className:"mr-2",children:u.icon}),u.name]},u.id))}),e.jsxs("div",{className:"space-y-6",children:[p==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Basic Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Race:"}),e.jsx("span",{className:"text-slate-200",children:s.race})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Class:"}),e.jsx("span",{className:"text-slate-200",children:s.class})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Level:"}),e.jsx("span",{className:"text-slate-200",children:s.level})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Background:"}),e.jsx("span",{className:"text-slate-200",children:s.background})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Alignment:"}),e.jsx("span",{className:"text-slate-200",children:s.alignment})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Ability Scores"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{name:"Strength",score:s.strength},{name:"Dexterity",score:s.dexterity},{name:"Constitution",score:s.constitution},{name:"Intelligence",score:s.intelligence},{name:"Wisdom",score:s.wisdom},{name:"Charisma",score:s.charisma}].map(u=>e.jsxs("div",{className:"bg-slate-700/30 rounded p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:u.name}),e.jsx("div",{className:`text-lg font-bold ${Ge(u.score)}`,children:u.score}),e.jsx("div",{className:"text-sm text-slate-300",children:je(fe(u.score))})]},u.name))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Combat Stats"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Hit Points:"}),e.jsxs("span",{className:"text-slate-200",children:[s.hp,"/",s.maxHp]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Armor Class:"}),e.jsx("span",{className:"text-slate-200",children:s.ac})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Initiative:"}),e.jsx("span",{className:"text-slate-200",children:je(fe(s.dexterity))})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Experience"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Current XP:"}),e.jsx("span",{className:"text-slate-200",children:$})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Next Level:"}),e.jsx("span",{className:"text-slate-200",children:A||"Max Level"})]}),e.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-amber-400 to-orange-400 h-2 rounded-full transition-all duration-300",style:{width:`${y}%`}})}),e.jsx("div",{className:"text-xs text-slate-400 text-center",children:A?`${Math.round(y)}% to next level`:"Maximum level reached"})]})]})]}),p==="equipment"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Equipment"}),s.equipment&&s.equipment.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.equipment.map((u,M)=>e.jsxs("div",{className:"bg-slate-700/30 rounded p-3",children:[e.jsx("div",{className:"font-medium text-slate-200",children:u.name}),e.jsxs("div",{className:"text-sm text-slate-400",children:[u.type," • ",e.jsx("span",{className:Ue(u.rarity),children:u.rarity})]}),u.description&&e.jsx("div",{className:"text-sm text-slate-300 mt-2",children:u.description})]},M))}):e.jsx("p",{className:"text-slate-400",children:"No equipment found."})]}),p==="details"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Physical Description"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[s.age&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Age:"}),e.jsx("div",{className:"text-slate-200",children:s.age})]}),s.height&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Height:"}),e.jsx("div",{className:"text-slate-200",children:s.height})]}),s.weight&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Weight:"}),e.jsx("div",{className:"text-slate-200",children:s.weight})]}),s.eyes&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Eyes:"}),e.jsx("div",{className:"text-slate-200",children:s.eyes})]}),s.skin&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Skin:"}),e.jsx("div",{className:"text-slate-200",children:s.skin})]}),s.hair&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Hair:"}),e.jsx("div",{className:"text-slate-200",children:s.hair})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Personality"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[s.personality&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400 font-medium",children:"Personality:"}),e.jsx("div",{className:"text-slate-200 mt-1",children:s.personality})]}),s.ideals&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400 font-medium",children:"Ideals:"}),e.jsx("div",{className:"text-slate-200 mt-1",children:s.ideals})]}),s.bonds&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400 font-medium",children:"Bonds:"}),e.jsx("div",{className:"text-slate-200 mt-1",children:s.bonds})]}),s.flaws&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400 font-medium",children:"Flaws:"}),e.jsx("div",{className:"text-slate-200 mt-1",children:s.flaws})]})]})]}),s.backstory&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Backstory"}),e.jsx("div",{className:"text-sm text-slate-200 bg-slate-700/30 rounded p-4",children:s.backstory})]})]}),p==="spells"&&s.spells&&s.spells.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Spells"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.spells.map((u,M)=>e.jsxs("div",{className:"bg-slate-700/30 rounded p-3",children:[e.jsx("div",{className:"font-medium text-slate-200",children:u.name}),e.jsxs("div",{className:"text-sm text-slate-400",children:["Level ",u.level," • ",u.school]}),u.description&&e.jsx("div",{className:"text-sm text-slate-300 mt-2",children:u.description})]},M))})]})]})]})})}function Ke({character:s,isOpen:o,onClose:c,onUpdate:p,availableSpellSlots:C={}}){const[v,$]=r.useState([]),[k,A]=r.useState(""),[y,u]=r.useState("all"),[M,w]=r.useState({}),[T,z]=r.useState(!1);r.useEffect(()=>{if(o){const a=Xe.initializeSpells();$(a),w({}),A(""),u("all")}},[o]);const h=(()=>!s||!s.class?[]:["Wizard","Sorcerer","Warlock","Cleric","Druid","Bard","Paladin","Ranger"].includes(s.class)?v.filter(f=>s.class==="Wizard"?["Evocation","Conjuration","Transmutation","Illusion","Abjuration","Divination","Enchantment","Necromancy"].includes(f.school):s.class==="Cleric"?["Evocation","Abjuration","Divination","Enchantment"].includes(f.school):s.class==="Druid"?["Conjuration","Transmutation","Evocation","Abjuration","Divination"].includes(f.school):s.class==="Bard"?["Enchantment","Illusion","Divination","Transmutation"].includes(f.school):s.class==="Sorcerer"?["Evocation","Conjuration","Transmutation","Illusion","Abjuration","Divination","Enchantment","Necromancy"].includes(f.school):s.class==="Warlock"?["Conjuration","Evocation","Enchantment","Illusion","Abjuration","Divination","Transmutation","Necromancy"].includes(f.school):s.class==="Paladin"?["Abjuration","Conjuration","Divination","Enchantment","Evocation","Illusion","Necromancy","Transmutation"].includes(f.school):s.class==="Ranger"?["Conjuration","Divination","Enchantment","Evocation","Illusion","Transmutation"].includes(f.school):!0):[])().filter(a=>(y==="all"||a.level.toString()===y)&&(a.name.toLowerCase().includes(k.toLowerCase())||a.school.toLowerCase().includes(k.toLowerCase())||a.description.toLowerCase().includes(k.toLowerCase()))),R=a=>{w(S=>{const f={...S},L=a.level;return f[L]&&f[L].find(q=>q.id===a.id)?(f[L]=f[L].filter(q=>q.id!==a.id),f[L].length===0&&delete f[L]):(f[L]||(f[L]=[]),f[L].push(a)),f})},U=async()=>{if(!s||!s.id){alert("Character data is missing. Please try again.");return}z(!0);try{const S=[...s.spells||[]];Object.values(M).forEach(L=>{L.forEach(q=>{S.includes(q.name)||S.push(q.name)})}),await ve(s.id,{spells:S}),p&&p();const f=Object.values(M).flat().length;alert(`Successfully learned ${f} new spell(s)!`),c()}catch(a){console.error("Error learning spells:",a),alert("Failed to learn spells. Please try again.")}finally{z(!1)}},d=a=>M[a]?M[a].length:0,j=a=>C[a]||0,V=a=>d(a)<j(a),W=()=>Object.values(M).flat().length,X=()=>Object.values(C).reduce((a,S)=>a+S,0);return!o||!s?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 p-6 rounded-lg max-w-6xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-100",children:"✨ Learn New Spells"}),e.jsxs("p",{className:"text-slate-400 text-sm",children:[(s==null?void 0:s.name)||"Unknown"," • ",(s==null?void 0:s.class)||"Unknown"," • Level ",(s==null?void 0:s.level)||1]})]}),e.jsx("button",{onClick:c,className:"text-slate-400 hover:text-slate-300 text-2xl",children:"✕"})]}),e.jsxs("div",{className:"mb-6 p-4 bg-slate-700/50 rounded-lg flex-shrink-0",children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Available Spell Slots"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Object.entries(C).map(([a,S])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-purple-400 font-medium",children:[a==="0"?"Cantrips":`Level ${a}`,":"]}),e.jsxs("span",{className:`text-sm px-2 py-1 rounded ${d(parseInt(a))>=S?"bg-green-600/30 text-green-300":"bg-slate-600/30 text-slate-300"}`,children:[d(parseInt(a)),"/",S]})]},a))}),e.jsxs("div",{className:"mt-3 text-sm text-slate-400",children:["Total: ",W(),"/",X()," spells selected"]})]}),e.jsxs("div",{className:"mb-4 space-y-2 flex-shrink-0",children:[e.jsx("input",{type:"text",value:k,onChange:a=>A(a.target.value),placeholder:"Search spells by name, school, or description...",className:"w-full bg-slate-700 border border-slate-600 text-slate-100 px-3 py-2 rounded focus:border-slate-500 focus:outline-none"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{onClick:()=>u("all"),className:`px-3 py-1 rounded text-sm font-medium transition-colors ${y==="all"?"bg-purple-600 text-white":"bg-slate-600 text-slate-300 hover:bg-slate-500"}`,children:"All Levels"}),Object.keys(C).map(a=>e.jsx("button",{onClick:()=>u(a),className:`px-3 py-1 rounded text-sm font-medium transition-colors ${y===a?"bg-purple-600 text-white":"bg-slate-600 text-slate-300 hover:bg-slate-500"}`,children:a==="0"?"Cantrips":`Level ${a}`},a))]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(a=>{const S=M[a.level]&&M[a.level].find(L=>L.id===a.id),f=V(a.level);return e.jsxs("div",{onClick:()=>f&&R(a),className:`p-4 rounded-lg border transition-colors cursor-pointer ${S?"bg-purple-600/30 border-purple-500/50":f?"bg-slate-700/50 border-slate-600/50 hover:bg-slate-600/50":"bg-slate-800/30 border-slate-700/50 opacity-50 cursor-not-allowed"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"✨"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-200 font-medium",children:a.name}),e.jsxs("div",{className:"text-slate-400 text-sm",children:["Level ",a.level," • ",a.school]})]})]}),e.jsx("div",{className:"text-slate-400 text-sm",children:S?"✓":f?"○":"✗"})]}),a.description&&e.jsx("p",{className:"text-slate-300 text-sm mb-2",children:a.description}),(a.damage||a.healing||a.save)&&e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs mb-2",children:[a.damage&&e.jsxs("span",{className:"text-red-400 bg-red-900/30 px-2 py-1 rounded",children:["Damage: ",a.damage]}),a.healing&&e.jsxs("span",{className:"text-green-400 bg-green-900/30 px-2 py-1 rounded",children:["Healing: ",a.healing]}),a.save&&e.jsxs("span",{className:"text-blue-400 bg-blue-900/30 px-2 py-1 rounded",children:["Save: ",a.save]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-slate-500",children:[a.castingTime&&e.jsxs("span",{children:["Casting: ",a.castingTime]}),a.range&&e.jsxs("span",{children:["Range: ",a.range]}),a.duration&&e.jsxs("span",{children:["Duration: ",a.duration]})]})]},a.id)})}),h.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"✨"}),e.jsx("p",{className:"text-slate-400",children:"No spells found matching your criteria"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-slate-600 flex-shrink-0",children:[e.jsx("button",{onClick:c,className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 text-slate-200 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:U,disabled:T||W()===0,className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:T?"Learning...":`Learn ${W()} Spell(s)`})]})]})})}function Ze({character:s,isVisible:o,onClose:c,onLevelUpComplete:p}){const[C,v]=r.useState(null),[$,k]=r.useState(!1);return r.useEffect(()=>{if(o&&s){const A=J.getLevelUpInfo(s);v(A)}},[o,s]),!o||!C?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-4 right-4 z-50 animate-bounce",children:e.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 text-white p-4 rounded-lg shadow-lg border-2 border-amber-300 max-w-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:"🎉"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg mb-1",children:"Level Up!"}),e.jsxs("p",{className:"text-sm opacity-90",children:[s.name," reached level ",C.newLevel,"!"]}),C.hasAbilityScoreImprovement&&e.jsxs("p",{className:"text-xs opacity-75 mt-1",children:["+",C.abilityScorePoints," ability score points available"]}),C.canLearnSpells&&e.jsx("p",{className:"text-xs opacity-75",children:"New spells available"})]}),e.jsx("button",{onClick:()=>k(!0),className:"bg-white text-amber-600 px-3 py-1 rounded text-sm font-semibold hover:bg-amber-50 transition-colors",children:"Level Up"}),e.jsx("button",{onClick:c,className:"text-white/70 hover:text-white text-lg",children:"×"})]})})}),$&&e.jsx(De,{character:s,levelUpInfo:C,isOpen:$,onClose:()=>k(!1),onComplete:A=>{k(!1),p(A)}})]})}function De({character:s,levelUpInfo:o,isOpen:c,onClose:p,onComplete:C}){const[v,$]=r.useState({}),[k,A]=r.useState([]),[y,u]=r.useState(1),[M,w]=r.useState(!1),T=[{key:"strength",name:"Strength",current:s.strength},{key:"dexterity",name:"Dexterity",current:s.dexterity},{key:"constitution",name:"Constitution",current:s.constitution},{key:"intelligence",name:"Intelligence",current:s.intelligence},{key:"wisdom",name:"Wisdom",current:s.wisdom},{key:"charisma",name:"Charisma",current:s.charisma}],z=J.getAvailableSpells(s.class,o.newLevel),F=o.abilityScorePoints-Object.values(v).reduce((d,j)=>d+j,0),O=(d,j)=>{j>0&&F<j||j<0&&!v[d]||$(V=>({...V,[d]:(V[d]||0)+j}))},h=d=>{A(j=>j.find(W=>W.name===d.name)?j.filter(W=>W.name!==d.name):[...j,d])},R=async()=>{w(!0);try{const d=J.applyLevelUp(s,o,v,k);C(d)}catch(d){console.error("Error completing level up:",d)}finally{w(!1)}},U=()=>y===1&&o.hasAbilityScoreImprovement?F===0:!0;return c?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-6 shadow-lg backdrop-blur-sm max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-400",children:["Level Up - ",s.name]}),e.jsx("button",{onClick:p,className:"text-slate-400 hover:text-slate-200 text-2xl font-bold",children:"×"})]}),e.jsxs("div",{className:"flex mb-6",children:[e.jsxs("div",{className:`flex-1 text-center ${y>=1?"text-amber-400":"text-slate-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full mx-auto mb-2 flex items-center justify-center ${y>=1?"bg-amber-500":"bg-slate-600"}`,children:"1"}),e.jsx("span",{className:"text-sm",children:"Ability Scores"})]}),o.canLearnSpells&&e.jsxs("div",{className:`flex-1 text-center ${y>=2?"text-amber-400":"text-slate-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full mx-auto mb-2 flex items-center justify-center ${y>=2?"bg-amber-500":"bg-slate-600"}`,children:"2"}),e.jsx("span",{className:"text-sm",children:"Spells"})]}),e.jsxs("div",{className:`flex-1 text-center ${y>=(o.canLearnSpells?3:2)?"text-amber-400":"text-slate-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full mx-auto mb-2 flex items-center justify-center ${y>=(o.canLearnSpells?3:2)?"bg-amber-500":"bg-slate-600"}`,children:o.canLearnSpells?"3":"2"}),e.jsx("span",{className:"text-sm",children:"Complete"})]})]}),y===1&&o.hasAbilityScoreImprovement&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-100 mb-2",children:"Ability Score Improvements"}),e.jsxs("p",{className:"text-slate-300",children:["You have ",o.abilityScorePoints," points to spend.",F>0&&e.jsxs("span",{className:"text-amber-400",children:[" ",F," remaining"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:T.map(d=>e.jsxs("div",{className:"bg-slate-700/30 rounded p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h4",{className:"font-semibold text-slate-200",children:d.name}),e.jsx("div",{className:"text-lg font-bold text-slate-100",children:d.current+(v[d.key]||0)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>O(d.key,1),disabled:F<1||d.current+(v[d.key]||0)>=20,className:"flex-1 bg-amber-600 hover:bg-amber-700 disabled:bg-slate-600 disabled:text-slate-400 text-white py-2 rounded text-sm font-medium transition-colors",children:"+1"}),e.jsx("button",{onClick:()=>O(d.key,2),disabled:F<2||d.current+(v[d.key]||0)>=19,className:"flex-1 bg-amber-600 hover:bg-amber-700 disabled:bg-slate-600 disabled:text-slate-400 text-white py-2 rounded text-sm font-medium transition-colors",children:"+2"}),(v[d.key]||0)>0&&e.jsx("button",{onClick:()=>O(d.key,-1),className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-2 rounded text-sm font-medium transition-colors",children:"Undo"})]})]},d.key))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:p,className:"bg-slate-600 hover:bg-slate-700 text-white px-6 py-2 rounded font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>u(o.canLearnSpells?2:3),disabled:!U(),className:"bg-amber-600 hover:bg-amber-700 disabled:bg-slate-600 disabled:text-slate-400 text-white px-6 py-2 rounded font-medium transition-colors",children:o.canLearnSpells?"Next: Spells":"Complete Level Up"})]})]}),y===2&&o.canLearnSpells&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-100 mb-2",children:"Learn New Spells"}),e.jsx("p",{className:"text-slate-300",children:"Choose spells to add to your spellbook"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto",children:z.map(d=>e.jsxs("div",{onClick:()=>h(d),className:`bg-slate-700/30 rounded p-4 cursor-pointer transition-colors ${k.find(j=>j.name===d.name)?"ring-2 ring-amber-400 bg-amber-900/20":"hover:bg-slate-700/50"}`,children:[e.jsx("div",{className:"font-semibold text-slate-200",children:d.name}),e.jsxs("div",{className:"text-sm text-slate-400",children:["Level ",d.level," • ",d.school]})]},d.name))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:()=>u(1),className:"bg-slate-600 hover:bg-slate-700 text-white px-6 py-2 rounded font-medium transition-colors",children:"Back"}),e.jsx("button",{onClick:()=>u(3),className:"bg-amber-600 hover:bg-amber-700 text-white px-6 py-2 rounded font-medium transition-colors",children:"Next: Complete"})]})]}),y===(o.canLearnSpells?3:2)&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-100 mb-2",children:"Level Up Summary"}),e.jsxs("p",{className:"text-slate-300",children:[s.name," is now level ",o.newLevel,"!"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-slate-700/30 rounded p-4",children:[e.jsx("h4",{className:"font-semibold text-slate-200 mb-3",children:"Level Changes"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Old Level:"}),e.jsx("span",{className:"text-slate-200",children:o.oldLevel})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"New Level:"}),e.jsx("span",{className:"text-amber-400 font-semibold",children:o.newLevel})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"HP Increase:"}),e.jsxs("span",{className:"text-slate-200",children:["+",o.newLevel-o.oldLevel," max HP"]})]})]})]}),o.hasAbilityScoreImprovement&&Object.keys(v).length>0&&e.jsxs("div",{className:"bg-slate-700/30 rounded p-4",children:[e.jsx("h4",{className:"font-semibold text-slate-200 mb-3",children:"Ability Score Changes"}),e.jsx("div",{className:"space-y-2 text-sm",children:Object.entries(v).map(([d,j])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-slate-400 capitalize",children:[d,":"]}),e.jsxs("span",{className:"text-green-400",children:["+",j]})]},d))})]}),o.canLearnSpells&&k.length>0&&e.jsxs("div",{className:"bg-slate-700/30 rounded p-4 md:col-span-2",children:[e.jsx("h4",{className:"font-semibold text-slate-200 mb-3",children:"New Spells"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:k.map(d=>e.jsxs("div",{className:"text-sm text-slate-300",children:["• ",d.name," (Level ",d.level,")"]},d.name))})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:()=>u(o.canLearnSpells?2:1),className:"bg-slate-600 hover:bg-slate-700 text-white px-6 py-2 rounded font-medium transition-colors",children:"Back"}),e.jsx("button",{onClick:R,disabled:M,className:"bg-green-600 hover:bg-green-700 disabled:bg-slate-600 disabled:text-slate-400 text-white px-6 py-2 rounded font-medium transition-colors",children:M?"Completing...":"Complete Level Up"})]})]})]})}):null}function es({combatData:s,currentUserId:o,partyId:c}){var L,q,K,Q,ae;const[p,C]=r.useState(null),[v,$]=r.useState(null),[k,A]=r.useState([]),[y,u]=r.useState([]),[M,w]=r.useState(!1),[T,z]=r.useState(null),[F,O]=r.useState(!1),[h,R]=r.useState(null);r.useEffect(()=>{var x;if(!s)return;const n=(x=s==null?void 0:s.initiativeOrder)==null?void 0:x[s==null?void 0:s.currentTurn];(n==null?void 0:n.id)===o&&n&&a()},[s==null?void 0:s.currentTurn,s==null?void 0:s.initiativeOrder,o,s]);const U=async n=>{var m,x;if(h)try{w(!0);const g=!h.action.name.includes("Move");let E=null;if(g){E={attack:n.total};const Z=h.target.ac||10;if(n.total>=Z){R(D=>({...D,attackRoll:n.total,isHit:!0})),O(!1);return}}const B=(m=s==null?void 0:s.initiativeOrder)==null?void 0:m[s==null?void 0:s.currentTurn],I=((x=h.combatant)==null?void 0:x.id)||(B==null?void 0:B.id),ne=await _.performAction(c,I,h.target.id,h.action.name,E);z(ne),C(null),$(null),R(null)}catch(g){console.error("Error performing action:",g),alert("Failed to perform action")}finally{w(!1)}},d=async n=>{var m,x;if(h)try{w(!0);const g={attack:h.attackRoll,damage:n.total},E=(m=s==null?void 0:s.initiativeOrder)==null?void 0:m[s==null?void 0:s.currentTurn],B=((x=h.combatant)==null?void 0:x.id)||(E==null?void 0:E.id),I=await _.performAction(c,B,h.target.id,h.action.name,g);z(I),C(null),$(null),R(null)}catch(g){console.error("Error performing action:",g),alert("Failed to perform action")}finally{w(!1)}};if(!s)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚔️"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-2",children:"No Combat Data"}),e.jsx("p",{className:"text-slate-400",children:"Waiting for combat to begin..."})]});if(s.setup&&!s.active)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-200",children:"⚔️ Combat Setup"}),e.jsx("span",{className:"text-amber-400 font-bold",children:"Setup Phase"})]}),e.jsx("p",{className:"text-slate-300 mb-4",children:"The Dungeon Master is setting up the combat encounter. You'll see the combat grid and initiative order once combat begins."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-3",children:"🗺️ Combat Grid"}),e.jsx("div",{className:"bg-slate-900 border border-slate-600 rounded-lg p-4 overflow-auto",children:e.jsx("div",{className:"inline-block",children:Array.from({length:8},(n,m)=>e.jsx("div",{className:"flex",children:Array.from({length:12},(x,g)=>{var B;const E=(B=s.initiativeOrder)==null?void 0:B.find(I=>I.position&&I.position.x===g&&I.position.y===m);return e.jsx("div",{className:`w-12 h-12 border border-slate-600 flex items-center justify-center text-sm ${E?E.type==="player"?"bg-blue-600/50 border-blue-500":"bg-red-600/50 border-red-500":"bg-slate-800"} ${(E==null?void 0:E.id)===o?"ring-2 ring-blue-400":""}`,title:`${g}, ${m}${E?` - ${E.name}`:""}`,children:E?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg",children:E.type==="player"?"👤":"👹"}),e.jsx("div",{className:"text-xs text-slate-300",children:E.name.substring(0,3)}),E.id===o&&e.jsx("div",{className:"text-xs text-blue-400",children:"(You)"})]}):e.jsx("span",{className:"text-slate-500",children:"·"})},`${g}-${m}`)})},m))})}),e.jsxs("div",{className:"mt-3 flex items-center justify-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600/50 border border-blue-500 rounded"}),e.jsx("span",{className:"text-slate-300",children:"Players"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-600/50 border border-red-500 rounded"}),e.jsx("span",{className:"text-slate-300",children:"Enemies"})]})]})]}),s.initiativeOrder&&s.initiativeOrder.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-3",children:"📋 Combatants"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-64 overflow-y-auto",children:s.initiativeOrder.map(n=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded transition-colors ${n.id===o?"ring-2 ring-blue-500 bg-slate-700":"bg-slate-700 hover:bg-slate-600"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium ${n.type==="player"?"text-blue-400":"text-red-400"}`,children:n.name}),n.id===o&&e.jsx("span",{className:"text-blue-400 text-xs",children:"(You)"}),e.jsxs("span",{className:"text-xs text-slate-400",children:["(",n.type,")"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-xs text-slate-400",children:["HP: ",n.hp,"/",n.maxHp]})})]},n.id))})]}),e.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-2",children:"⏳ Setup in Progress"}),e.jsx("p",{className:"text-slate-300",children:"The Dungeon Master is positioning combatants and preparing the encounter. Combat will begin once initiative is rolled."})]})]});if(!s.active)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚔️"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-2",children:"Combat Ended"}),e.jsx("p",{className:"text-slate-400",children:"The combat has concluded."})]});const j=(L=s.initiativeOrder)==null?void 0:L[s.currentTurn],V=(j==null?void 0:j.id)===o,X=(()=>{const n=[];for(let m=0;m<8;m++){const x=[];for(let g=0;g<12;g++)x.push(null);n.push(x)}return s.initiativeOrder&&s.initiativeOrder.forEach(m=>{if(m.position){const{x,y:g}=m.position;x>=0&&x<12&&g>=0&&g<8&&(n[g][x]=m)}}),n})(),a=async()=>{var n;try{const m=(n=s==null?void 0:s.initiativeOrder)==null?void 0:n[s==null?void 0:s.currentTurn];if(!m){console.warn("No current participant found for combat options");return}const[x,g]=await Promise.all([_.getAvailableActions(c,m.id),_.getValidTargets(c,m.id,p==null?void 0:p.name)]);A(x),u(g)}catch(m){console.error("Error updating combat options:",m)}},S=async n=>{var x;C(n),$(null);const m=(x=s==null?void 0:s.initiativeOrder)==null?void 0:x[s==null?void 0:s.currentTurn];if(m)try{const g=await _.getValidTargets(c,m.id,n.name);u(g)}catch(g){console.error("Error getting targets for action:",g)}},f=async()=>{var m;if(!p||!v){alert("Please select both an action and a target.");return}const n=(m=s==null?void 0:s.initiativeOrder)==null?void 0:m[s==null?void 0:s.currentTurn];if(p.name==="Move"){try{w(!0);const x=await _.performAction(c,n.id,v.id,p.name,null);z(x),C(null),$(null)}catch(x){console.error("Error performing movement:",x),alert("Failed to perform movement")}finally{w(!1)}return}R({action:p,target:v,combatant:n}),O(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-300",children:"Round: "}),e.jsx("span",{className:"text-amber-400 font-bold",children:s.round})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-300",children:"Turn: "}),e.jsx("span",{className:"text-amber-400 font-bold",children:s.currentTurn+1}),e.jsxs("span",{className:"text-slate-400",children:[" / ",((q=s.initiativeOrder)==null?void 0:q.length)||0]})]})]}),j&&e.jsx("div",{className:`p-3 rounded border-2 ${V?"bg-amber-600/30 border-amber-500":"bg-slate-600 border-slate-500"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-300",children:"Current: "}),e.jsx("span",{className:`font-bold ${j.type==="player"?"text-blue-400":"text-red-400"}`,children:j.name}),e.jsxs("span",{className:"text-slate-400 ml-2",children:["(Initiative: ",j.initiative,")"]})]}),V&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-amber-400 text-lg",children:"👑"}),e.jsx("span",{className:"text-amber-400 font-semibold",children:"Your Turn!"})]})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-3",children:"🗺️ Combat Grid"}),e.jsx("div",{className:"bg-slate-900 border border-slate-600 rounded-lg p-4 overflow-auto",children:e.jsx("div",{className:"inline-block",children:X.map((n,m)=>e.jsx("div",{className:"flex",children:n.map((x,g)=>e.jsx("div",{className:`w-12 h-12 border border-slate-600 flex items-center justify-center text-sm ${x?x.type==="player"?"bg-blue-600/50 border-blue-500":"bg-red-600/50 border-red-500":"bg-slate-800"} ${(x==null?void 0:x.id)===o?"ring-2 ring-blue-400":""} ${(x==null?void 0:x.id)===(j==null?void 0:j.id)?"ring-2 ring-amber-400":""}`,title:`${g}, ${m}${x?` - ${x.name}`:""}`,children:x?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg",children:x.type==="player"?"👤":"👹"}),e.jsx("div",{className:"text-xs text-slate-300",children:x.name.substring(0,3)}),x.id===o&&e.jsx("div",{className:"text-xs text-blue-400",children:"(You)"})]}):e.jsx("span",{className:"text-slate-500",children:"·"})},`${g}-${m}`))},m))})}),e.jsxs("div",{className:"mt-3 flex items-center justify-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600/50 border border-blue-500 rounded"}),e.jsx("span",{className:"text-slate-300",children:"Players"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-600/50 border border-red-500 rounded"}),e.jsx("span",{className:"text-slate-300",children:"Enemies"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 ring-2 ring-amber-400 bg-transparent rounded"}),e.jsx("span",{className:"text-slate-300",children:"Current Turn"})]})]})]}),s.initiativeOrder&&s.initiativeOrder.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-3",children:"📋 Initiative Order:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-64 overflow-y-auto",children:s.initiativeOrder.map((n,m)=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded transition-colors ${m===s.currentTurn?"bg-amber-600/30 border border-amber-500":"bg-slate-700 hover:bg-slate-600"} ${n.id===o?"ring-2 ring-blue-500":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium ${n.type==="player"?"text-blue-400":"text-red-400"}`,children:n.name}),n.id===o&&e.jsx("span",{className:"text-blue-400 text-xs",children:"(You)"}),e.jsxs("span",{className:"text-xs text-slate-400",children:["(",n.type,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-slate-400",children:["HP: ",n.hp,"/",n.maxHp]}),m===s.currentTurn&&e.jsx("span",{className:"text-amber-400 text-sm",children:"👑"})]})]},n.id))})]}),V&&e.jsxs("div",{className:"bg-blue-600/20 border border-blue-500/30 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-blue-300 mb-4",children:"🎯 Your Turn!"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-semibold text-blue-200 mb-2",children:"Select Action:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:k.map(n=>e.jsx("button",{onClick:()=>S(n),className:`p-2 rounded text-sm transition-colors ${(p==null?void 0:p.name)===n.name?"bg-blue-500 text-white":"bg-slate-600 hover:bg-slate-500 text-slate-200"}`,children:n.name},n.name))})]}),p&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-semibold text-blue-200 mb-2",children:p.name==="Move"?"Select Position:":"Select Target:"}),y.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:y.map(n=>e.jsxs("button",{onClick:()=>$(n),className:`p-2 rounded text-sm transition-colors ${(v==null?void 0:v.id)===n.id?"bg-green-500 text-white":"bg-slate-600 hover:bg-slate-500 text-slate-200"}`,children:[e.jsx("div",{className:"font-medium",children:n.name}),n.type==="position"&&e.jsxs("div",{className:"text-xs text-slate-400",children:["(",n.x,", ",n.y,")"]})]},n.id))}):e.jsx("div",{className:"p-3 bg-red-600/20 border border-red-500/30 rounded-lg",children:e.jsx("p",{className:"text-red-300 text-sm",children:p.name==="Basic Attack"?"No enemies within melee range (1 square). Move closer to attack.":p.name==="Ranged Attack"?"No enemies within ranged attack range (3 squares). Move closer to attack.":"No valid targets available."})})]}),p&&v&&e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:f,disabled:M,className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 disabled:opacity-50",children:M?"Performing Action...":`Perform ${p.name}`})}),p&&!p.name.includes("Move")&&e.jsx("div",{className:"mt-3 p-2 bg-slate-700/50 rounded border border-slate-600/50",children:e.jsxs("div",{className:"text-xs text-slate-300",children:[e.jsx("span",{className:"font-semibold",children:"Range:"})," ",p.name==="Basic Attack"?"Melee (1 square)":p.name==="Ranged Attack"?"Ranged (3 squares)":p.range||"Melee (1 square)"]})}),T&&e.jsxs("div",{className:"mt-4 p-3 bg-slate-700 rounded border border-slate-600",children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-200 mb-2",children:"Combat Result:"}),e.jsxs("div",{className:"text-sm text-slate-300 space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Action:"})," ",T.action]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Target:"})," ",T.target]}),T.attackRoll&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Attack Roll:"})," ",T.attackRoll]}),T.damage&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Damage:"})," ",T.damage]}),T.targetNewHp!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Target HP:"})," ",T.targetNewHp]})]})]})]}),!V&&j&&e.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-2",children:"⏳ Waiting..."}),e.jsx("p",{className:"text-slate-300",children:j.type==="player"?`Waiting for ${j.name} to take their turn...`:`The ${j.name} is taking their turn...`})]}),e.jsx(Qe,{isOpen:F,onClose:()=>{O(!1),R(null)},onRollComplete:h!=null&&h.isHit?d:U,diceNotation:h!=null&&h.isHit?h.action.damage||"1d6":"1d20",rollType:h!=null&&h.isHit?"Damage Roll":h!=null&&h.action.name.includes("Move")?"Movement":"Attack Roll",modifier:h!=null&&h.isHit||h!=null&&h.action.name.includes("Move")?0:Math.floor(((((ae=(Q=(K=s==null?void 0:s.initiativeOrder)==null?void 0:K[s==null?void 0:s.currentTurn])==null?void 0:Q.character)==null?void 0:ae.dexterity)||10)-10)/2)})]})}function as(){var ge;const{partyId:s}=Ve(),o=Be(),[c,p]=r.useState(null),[C,v]=r.useState(!0),[$,k]=r.useState([]),[A,y]=r.useState(null),[u,M]=r.useState(!1),[w,T]=r.useState([]),[z,F]=r.useState("Campaign Map"),[O,h]=r.useState({width:15,height:10}),[R,U]=r.useState("grass"),[d,j]=r.useState("draw"),[V,W]=r.useState(!1),[X,a]=r.useState({x:0,y:0}),[S,f]=r.useState({}),[L,q]=r.useState(null),[K,Q]=r.useState(!1),[ae,n]=r.useState({x:0,y:0}),[m,x]=r.useState("hidden"),[g,E]=r.useState(!1),[B,I]=r.useState(!0),[ne,Z]=r.useState(!1),[ce,D]=r.useState(null),[Ne,ye]=r.useState(!1),[ie,we]=r.useState(null),[Se,se]=r.useState(!1),[Ce,te]=r.useState(null),[Me,le]=r.useState(!1),[oe,re]=r.useState(null);r.useEffect(()=>{const t=Ie(l=>{if(!l){o("/login");return}p(l)});return()=>t()},[o]),r.useEffect(()=>{c&&s&&(de(),ke())},[c,s]),r.useEffect(()=>{if(!c||!s||g)return;const t=ee.listenToPlayerView(s,l=>{x(l),I(!1)});return()=>{t&&t()}},[c,s,g]),r.useEffect(()=>{if(!c||!s)return;const t=ee.listenToCampaignStory(s,l=>{if(l&&(y(l),l.campaignMap)){const i=P.convertMapFromFirestore(l.campaignMap);i&&(F(i.title),T(i.content),f(i.subMaps),h(i.size))}});return()=>{t&&t()}},[c,s]),r.useEffect(()=>{if(!c||!s||g)return;const t=ee.listenToPartyCharacters(s,l=>{if(l){k(l);const i=l.find(b=>b.userId===c.uid);i&&J.shouldLevelUp(i)&&(te(i),se(!0))}});return()=>{t&&t()}},[c,s,g]),r.useEffect(()=>{if(!c||!s)return;let t=null;return(async()=>{try{t=await _.listenToCombatState(s,i=>{i&&(i.active?re(i):i.setup&&re({...i,active:!1,setup:!0,initiativeOrder:i.setup.combatants||[]}))})}catch(i){console.error("Error setting up combat listener:",i)}})(),()=>{t&&t()}},[c,s]),r.useEffect(()=>{const t=()=>{Q(!1)};return document.addEventListener("mouseup",t),()=>{document.removeEventListener("mouseup",t)}},[]);const ke=async()=>{try{const t=await P.loadMapFromDatabase(s);F(t.title),T(t.content),f(t.subMaps),h(t.size)}catch(t){console.error("Error loading map:",t);const l=P.loadMap(s);F(l.title),T(l.content),f(l.subMaps),h(l.size)}},H=P.getTileTypes(),xe=()=>P.initializeMap(O),Te=async()=>{try{await P.saveMapToDatabase(s,{title:z,content:w,size:O,subMaps:S}),M(!1)}catch(t){console.error("Error saving map:",t)}},me=async(t,l)=>{let i;d==="draw"?i=P.updateMapTile(w,t,l,R):d==="erase"&&(i=P.updateMapTile(w,t,l,"empty")),T(i);try{await P.saveMapToDatabase(s,{title:z,content:i,size:O,subMaps:S})}catch(b){console.error("Error saving map to database:",b)}},Le=(t,l)=>{Q(!0),n({x:t,y:l}),me(t,l)},$e=(t,l)=>{K&&me(t,l)},he=()=>{Q(!1)},Ee=async()=>{const t=xe();T(t);try{await P.saveMapToDatabase(s,{title:z,content:t,size:O,subMaps:S})}catch(l){console.error("Error saving cleared map to database:",l)}},ue=async()=>{const t=xe();T(t);try{await P.saveMapToDatabase(s,{title:z,content:t,size:O,subMaps:S})}catch(l){console.error("Error saving resized map to database:",l)}},Pe=(t,l,i)=>{i.preventDefault(),a({x:t,y:l}),q(S[`${t}-${l}`]||P.initializeSubMap()),W(!0)},Ae=()=>P.initializeSubMap(),be=async(t,l)=>{let i;d==="draw"?i=P.updateSubMapTile(L,t,l,R):d==="erase"&&(i=P.updateSubMapTile(L,t,l,"empty")),q(i)},Oe=(t,l)=>{Q(!0),n({x:t,y:l}),be(t,l)},ze=(t,l)=>{K&&be(t,l)},Re=async()=>{const t=P.saveSubMap(S,X.x,X.y,L);f(t),W(!1);try{await P.saveMapToDatabase(s,{title:z,content:w,size:O,subMaps:t})}catch(l){console.error("Error saving sub-map to database:",l)}},He=()=>{q(Ae())},pe=(t,l)=>P.getTileHasSubMap(S,t,l),de=async()=>{try{v(!0);const t=await Ye(s);if(k(t),!g&&c){const b=t.find(N=>N.userId===c.uid);b&&J.shouldLevelUp(b)&&(te(b),se(!0))}const l=await P.loadCampaignData(s);y(l);const i=await P.getPartyData(s);if(E((i==null?void 0:i.dmId)===(c==null?void 0:c.uid)),(i==null?void 0:i.dmId)!==(c==null?void 0:c.uid)){const b=await ee.getPlayerView(s);x(b),I(!1)}else I(!1)}catch(t){console.error("Error loading campaign data:",t)}finally{v(!1)}},Fe=t=>{if(!t||!t.class)return{};if(!["Wizard","Sorcerer","Warlock","Cleric","Druid","Bard","Paladin","Ranger"].includes(t.class))return{};const b=t.level||1,N={};return b>=1&&(N[1]=2),b>=2&&(N[2]=1),b>=3&&(N[3]=1),b>=4&&(N[4]=1),b>=5&&(N[5]=1),b>=6&&(N[6]=1),b>=7&&(N[7]=1),b>=8&&(N[8]=1),b>=9&&(N[9]=1),N[0]=3,N},We=async t=>{try{await ve(t.id,t),await de(),se(!1),te(null)}catch(l){console.error("Error completing level up:",l)}};return C?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-amber-400 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-slate-300 text-lg font-medium",children:"Loading manual campaign..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:e.jsxs("div",{className:"fantasy-container",children:[!g&&B&&e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"fantasy-card max-w-md mx-auto text-center",children:[e.jsxs("div",{className:"animate-pulse mb-6",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🎲"}),e.jsx("div",{className:"text-4xl mb-2",children:"⚔️"}),e.jsx("div",{className:"text-2xl",children:"🗺️"})]}),e.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-4",children:"Campaign Starting..."}),e.jsx("p",{className:"text-slate-300 mb-6",children:"Please wait while the Dungeon Master sets up your game."}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-amber-400 border-t-transparent"}),e.jsx("span",{className:"text-slate-400 text-sm",children:"Waiting for DM..."})]})]})}),(!B||g)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-400 mb-2",children:"Manual Campaign"}),e.jsx("p",{className:"text-slate-400",children:"Traditional D&D experience - full control over your story"})]})})}),!g&&e.jsxs("div",{className:"fantasy-card mb-8",children:[(()=>{const t=$.find(l=>l.userId===(c==null?void 0:c.uid));return t?e.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-600/20 to-purple-600/20 border border-blue-500/30 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-1",children:"My Character"}),e.jsxs("p",{className:"text-sm text-slate-300",children:[t.name," • Level ",t.level," • ",t.class]})]}),e.jsxs("button",{onClick:()=>{D(t),Z(!0)},className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-2",children:[e.jsx("span",{children:"👤"}),"View Character Sheet"]})]})}):null})(),m==="scene"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:"🎭 Current Scene"}),e.jsx("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-6",children:(()=>{if(A&&A.currentScene){const t=A.currentScene;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-2",children:t.title}),e.jsx("p",{className:"text-slate-300 leading-relaxed",children:t.description})]}),t.objectives&&t.objectives.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-md font-semibold text-slate-200 mb-2",children:"🎯 Objectives"}),e.jsx("ul",{className:"space-y-1",children:t.objectives.map((l,i)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${l.completed?"bg-green-500":"bg-amber-500"}`}),e.jsx("span",{className:`${l.completed?"text-slate-400 line-through":"text-slate-300"}`,children:l.text})]},l.id||i))})]}),t.problems&&t.problems.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-md font-semibold text-slate-200 mb-2",children:"⚠️ Problems"}),e.jsx("ul",{className:"space-y-1",children:t.problems.map((l,i)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${l.solved?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:`${l.solved?"text-slate-400 line-through":"text-slate-300"}`,children:l.text})]},l.id||i))})]})]})}else return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"🎭"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-2",children:"No Active Scene"}),e.jsx("p",{className:"text-slate-400",children:"The Dungeon Master hasn't set up a scene yet."})]})})()})]}),m==="map"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:"🗺️ Campaign Map"}),e.jsx("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-6",children:w&&w.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"inline-block",children:w.map((t,l)=>e.jsx("div",{className:"flex",children:t.map((i,b)=>{var N,Y,G;return e.jsx("div",{className:`w-8 h-8 border border-slate-600 flex items-center justify-center text-xs ${((N=H[i])==null?void 0:N.color)||"bg-slate-700"}`,title:`${b}, ${l}: ${((Y=H[i])==null?void 0:Y.name)||"Unknown"}`,children:((G=H[i])==null?void 0:G.symbol)||"⬜"},`${b}-${l}`)})},l))})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"🗺️"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-2",children:"No Map Available"}),e.jsx("p",{className:"text-slate-400",children:"The Dungeon Master hasn't created a map yet."})]})})]}),m==="combat"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:"⚔️ Combat View"}),e.jsx("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-6",children:oe?e.jsx(es,{combatData:oe,currentUserId:c==null?void 0:c.uid,partyId:s}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚔️"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-2",children:"Combat in Progress"}),e.jsx("p",{className:"text-slate-300 mb-4",children:"The Dungeon Master is managing the combat. You'll see your turn when it comes up."}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"animate-pulse w-2 h-2 bg-red-500 rounded-full"}),e.jsx("span",{className:"text-slate-400 text-sm",children:"Waiting for your turn..."})]})]})})]}),m==="hidden"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:"🎭 DM is Setting Up"}),e.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-6 animate-pulse",children:"🎭"}),e.jsx("h3",{className:"text-2xl font-bold text-slate-200 mb-4",children:"Please Wait"}),e.jsx("p",{className:"text-slate-300 mb-4 text-lg",children:"The Dungeon Master is preparing something special for you..."}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-amber-400 border-t-transparent"}),e.jsx("span",{className:"text-slate-400",children:"Setting up the scene"})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:"This screen will automatically update when the DM reveals the content."})]})]})]}),g&&e.jsxs("div",{className:"fantasy-card mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:"Campaign Map"}),w&&w.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4 overflow-x-auto",children:e.jsx("div",{className:"inline-block",children:w.map((t,l)=>e.jsx("div",{className:"flex",children:t.map((i,b)=>{var N,Y,G;return e.jsx("div",{className:`w-8 h-8 border border-slate-600 flex items-center justify-center text-xs ${((N=H[i])==null?void 0:N.color)||"bg-slate-700"}`,title:`${b}, ${l}: ${((Y=H[i])==null?void 0:Y.name)||"Unknown"}`,children:((G=H[i])==null?void 0:G.symbol)||"⬜"},`${b}-${l}`)})},l))})}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{onClick:()=>M(!0),className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"Edit Map"}),e.jsx("button",{onClick:()=>le(!0),className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"⚔️ Combat Setup"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-slate-400 mb-4",children:"No map created yet."}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:()=>M(!0),className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300",children:"Create Map"}),e.jsx("button",{onClick:()=>le(!0),className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300",children:"⚔️ Combat Setup"})]})]})]}),e.jsxs("div",{className:"fantasy-card",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:"Party Members"}),e.jsxs("div",{className:"space-y-3",children:[$.filter(t=>t.userId!==(c==null?void 0:c.uid)).map(t=>e.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-100",children:t.name}),e.jsxs("p",{className:"text-sm text-slate-400",children:[t.class," • Level ",t.level]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-slate-300",children:["HP: ",t.hp,"/",t.maxHp]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["AC: ",t.ac]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>{D(t),Z(!0)},className:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white text-xs font-medium px-3 py-1 rounded-lg transition-all duration-300",children:"View"})})]})]})},t.id)),$.filter(t=>t.userId!==(c==null?void 0:c.uid)).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-slate-400 mb-2",children:"No other party members yet."}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Other players will appear here when they join the campaign."})]})]})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"fantasy-card max-w-6xl w-full max-h-[95vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Grid-Based Map Editor"}),e.jsx("button",{onClick:()=>M(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:"×"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Map Title"}),e.jsx("input",{type:"text",value:z,onChange:t=>F(t.target.value),className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50",placeholder:"Enter map title..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Map Size"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Width"}),e.jsx("input",{type:"number",min:"5",max:"30",value:O.width,onChange:t=>{h(l=>({...l,width:parseInt(t.target.value)})),ue()},className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Height"}),e.jsx("input",{type:"number",min:"5",max:"20",value:O.height,onChange:t=>{h(l=>({...l,height:parseInt(t.target.value)})),ue()},className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Tools"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>j("draw"),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${d==="draw"?"bg-amber-500/20 text-amber-300 border border-amber-500/30":"bg-slate-700/30 text-slate-300 hover:bg-slate-700/50"}`,children:"✏️ Draw"}),e.jsx("button",{onClick:()=>j("erase"),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${d==="erase"?"bg-red-500/20 text-red-300 border border-red-500/30":"bg-slate-700/30 text-slate-300 hover:bg-slate-700/50"}`,children:"🗑️ Erase"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Tiles"}),e.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-96 overflow-y-auto",children:Object.entries(H).map(([t,l])=>e.jsxs("button",{onClick:()=>U(t),className:`p-2 rounded-lg border transition-colors ${R===t?"border-amber-500 bg-amber-500/20":"border-slate-600 bg-slate-700/30 hover:border-slate-500"}`,children:[e.jsx("div",{className:`w-6 h-6 ${l.color} rounded flex items-center justify-center text-xs mx-auto mb-1`,children:l.symbol}),e.jsx("div",{className:"text-xs text-slate-300 truncate",children:l.name})]},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:Ee,className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"Clear Map"}),e.jsx("button",{onClick:Te,className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"Save Map"})]})]}),e.jsxs("div",{className:"lg:col-span-3",children:[e.jsx("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4 overflow-auto map-editor",children:e.jsx("div",{className:"inline-block",children:w.map((t,l)=>e.jsx("div",{className:"flex",children:t.map((i,b)=>{var N,Y,G;return e.jsxs("button",{onMouseDown:()=>Le(b,l),onMouseEnter:()=>$e(b,l),onMouseUp:he,onContextMenu:qe=>Pe(b,l,qe),className:`w-10 h-10 border border-slate-600 flex items-center justify-center text-sm transition-colors hover:border-amber-400 relative ${((N=H[i])==null?void 0:N.color)||"bg-slate-700"}`,title:`${b}, ${l}: ${((Y=H[i])==null?void 0:Y.name)||"Unknown"}${pe(b,l)?" (Right-click for sub-map)":" (Right-click to create sub-map)"}`,children:[((G=H[i])==null?void 0:G.symbol)||"⬜",pe(b,l)&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-purple-500 rounded-full flex items-center justify-center text-[10px] text-white",children:"📍"})]},`${b}-${l}`)})},l))})}),e.jsxs("div",{className:"mt-2 text-xs text-slate-400 text-center",children:["Click or drag to place/remove tiles. Current tool: ",d==="draw"?"Draw":"Erase"," | Selected tile: ",(ge=H[R])==null?void 0:ge.name]})]})]})]})}),e.jsx(Je,{character:ce,isOpen:ne,onClose:()=>{Z(!1),D(null)}}),V&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"fantasy-card max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-100",children:["Sub-Map Editor - Tile (",X.x,", ",X.y,")"]}),e.jsx("button",{onClick:()=>W(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:"×"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4 map-editor",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Sub-Map (8x8)"}),e.jsx("button",{onClick:He,className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm",children:"Clear"})]}),e.jsx("div",{className:"grid grid-cols-8 gap-1 mb-4",children:L.map((t,l)=>t.map((i,b)=>{var N,Y,G;return e.jsx("button",{onMouseDown:()=>Oe(b,l),onMouseEnter:()=>ze(b,l),onMouseUp:he,className:`w-12 h-12 border border-slate-600 flex items-center justify-center text-lg transition-colors hover:border-amber-400 ${((N=H[i])==null?void 0:N.color)||"bg-slate-700"}`,title:`${b}, ${l}: ${((Y=H[i])==null?void 0:Y.name)||"Empty"}`,children:((G=H[i])==null?void 0:G.symbol)||"⬜"},`sub-${b}-${l}`)}))})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tools"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>j("draw"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${d==="draw"?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:"✏️ Draw"}),e.jsx("button",{onClick:()=>j("erase"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${d==="erase"?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:"🗑️ Erase"})]})]}),e.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tile Types"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-80 overflow-y-auto",children:Object.entries(H).map(([t,l])=>e.jsxs("button",{onClick:()=>U(t),className:`p-2 rounded text-sm font-medium transition-colors flex items-center gap-2 ${R===t?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[e.jsx("span",{className:"text-lg",children:l.symbol}),e.jsx("span",{className:"truncate",children:l.name})]},t))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Re,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded font-medium",children:"Save Sub-Map"}),e.jsx("button",{onClick:()=>W(!1),className:"px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded font-medium",children:"Cancel"})]})]})]})]})}),ie&&e.jsx(Ke,{character:ie,isOpen:Ne,onClose:()=>{ye(!1),we(null)},onUpdate:()=>{de()},availableSpellSlots:Fe(ie)}),e.jsx(Ze,{character:Ce,isVisible:Se,onClose:()=>{se(!1),te(null)},onLevelUpComplete:We}),Me&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"fantasy-card max-w-7xl w-full max-h-[95vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"⚔️ Combat Management"}),e.jsx("button",{onClick:()=>le(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:"×"})]}),e.jsx(_e,{partyId:s,partyCharacters:$,onCombatStart:t=>{re(t),ee.setPlayerView(s,"combat"),le(!1)}})]})})]})]})})}export{as as default};
