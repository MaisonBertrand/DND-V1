function I_(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function A_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var C0={exports:{}},gu={},N0={exports:{}},Fe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rl=Symbol.for("react.element"),P_=Symbol.for("react.portal"),R_=Symbol.for("react.fragment"),j_=Symbol.for("react.strict_mode"),D_=Symbol.for("react.profiler"),M_=Symbol.for("react.provider"),L_=Symbol.for("react.context"),O_=Symbol.for("react.forward_ref"),V_=Symbol.for("react.suspense"),$_=Symbol.for("react.memo"),F_=Symbol.for("react.lazy"),zp=Symbol.iterator;function U_(t){return t===null||typeof t!="object"?null:(t=zp&&t[zp]||t["@@iterator"],typeof t=="function"?t:null)}var S0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},k0=Object.assign,I0={};function Sa(t,e,n){this.props=t,this.context=e,this.refs=I0,this.updater=n||S0}Sa.prototype.isReactComponent={};Sa.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Sa.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function A0(){}A0.prototype=Sa.prototype;function pm(t,e,n){this.props=t,this.context=e,this.refs=I0,this.updater=n||S0}var gm=pm.prototype=new A0;gm.constructor=pm;k0(gm,Sa.prototype);gm.isPureReactComponent=!0;var Hp=Array.isArray,P0=Object.prototype.hasOwnProperty,ym={current:null},R0={key:!0,ref:!0,__self:!0,__source:!0};function j0(t,e,n){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)P0.call(e,r)&&!R0.hasOwnProperty(r)&&(s[r]=e[r]);var c=arguments.length-2;if(c===1)s.children=n;else if(1<c){for(var u=Array(c),d=0;d<c;d++)u[d]=arguments[d+2];s.children=u}if(t&&t.defaultProps)for(r in c=t.defaultProps,c)s[r]===void 0&&(s[r]=c[r]);return{$$typeof:rl,type:t,key:i,ref:a,props:s,_owner:ym.current}}function B_(t,e){return{$$typeof:rl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function vm(t){return typeof t=="object"&&t!==null&&t.$$typeof===rl}function z_(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Wp=/\/+/g;function ld(t,e){return typeof t=="object"&&t!==null&&t.key!=null?z_(""+t.key):e.toString(36)}function rc(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case rl:case P_:a=!0}}if(a)return a=t,s=s(a),t=r===""?"."+ld(a,0):r,Hp(s)?(n="",t!=null&&(n=t.replace(Wp,"$&/")+"/"),rc(s,e,n,"",function(d){return d})):s!=null&&(vm(s)&&(s=B_(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(Wp,"$&/")+"/")+t)),e.push(s)),1;if(a=0,r=r===""?".":r+":",Hp(t))for(var c=0;c<t.length;c++){i=t[c];var u=r+ld(i,c);a+=rc(i,e,n,u,s)}else if(u=U_(t),typeof u=="function")for(t=u.call(t),c=0;!(i=t.next()).done;)i=i.value,u=r+ld(i,c++),a+=rc(i,e,n,u,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Dl(t,e,n){if(t==null)return t;var r=[],s=0;return rc(t,r,"","",function(i){return e.call(n,i,s++)}),r}function H_(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var bn={current:null},sc={transition:null},W_={ReactCurrentDispatcher:bn,ReactCurrentBatchConfig:sc,ReactCurrentOwner:ym};function D0(){throw Error("act(...) is not supported in production builds of React.")}Fe.Children={map:Dl,forEach:function(t,e,n){Dl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Dl(t,function(){e++}),e},toArray:function(t){return Dl(t,function(e){return e})||[]},only:function(t){if(!vm(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Fe.Component=Sa;Fe.Fragment=R_;Fe.Profiler=D_;Fe.PureComponent=pm;Fe.StrictMode=j_;Fe.Suspense=V_;Fe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W_;Fe.act=D0;Fe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=k0({},t.props),s=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=ym.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(u in e)P0.call(e,u)&&!R0.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&c!==void 0?c[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];r.children=c}return{$$typeof:rl,type:t.type,key:s,ref:i,props:r,_owner:a}};Fe.createContext=function(t){return t={$$typeof:L_,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:M_,_context:t},t.Consumer=t};Fe.createElement=j0;Fe.createFactory=function(t){var e=j0.bind(null,t);return e.type=t,e};Fe.createRef=function(){return{current:null}};Fe.forwardRef=function(t){return{$$typeof:O_,render:t}};Fe.isValidElement=vm;Fe.lazy=function(t){return{$$typeof:F_,_payload:{_status:-1,_result:t},_init:H_}};Fe.memo=function(t,e){return{$$typeof:$_,type:t,compare:e===void 0?null:e}};Fe.startTransition=function(t){var e=sc.transition;sc.transition={};try{t()}finally{sc.transition=e}};Fe.unstable_act=D0;Fe.useCallback=function(t,e){return bn.current.useCallback(t,e)};Fe.useContext=function(t){return bn.current.useContext(t)};Fe.useDebugValue=function(){};Fe.useDeferredValue=function(t){return bn.current.useDeferredValue(t)};Fe.useEffect=function(t,e){return bn.current.useEffect(t,e)};Fe.useId=function(){return bn.current.useId()};Fe.useImperativeHandle=function(t,e,n){return bn.current.useImperativeHandle(t,e,n)};Fe.useInsertionEffect=function(t,e){return bn.current.useInsertionEffect(t,e)};Fe.useLayoutEffect=function(t,e){return bn.current.useLayoutEffect(t,e)};Fe.useMemo=function(t,e){return bn.current.useMemo(t,e)};Fe.useReducer=function(t,e,n){return bn.current.useReducer(t,e,n)};Fe.useRef=function(t){return bn.current.useRef(t)};Fe.useState=function(t){return bn.current.useState(t)};Fe.useSyncExternalStore=function(t,e,n){return bn.current.useSyncExternalStore(t,e,n)};Fe.useTransition=function(){return bn.current.useTransition()};Fe.version="18.3.1";N0.exports=Fe;var P=N0.exports;const M0=A_(P),q_=I_({__proto__:null,default:M0},[P]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G_=P,K_=Symbol.for("react.element"),Q_=Symbol.for("react.fragment"),Y_=Object.prototype.hasOwnProperty,J_=G_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,X_={key:!0,ref:!0,__self:!0,__source:!0};function L0(t,e,n){var r,s={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)Y_.call(e,r)&&!X_.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:K_,type:t,key:i,ref:a,props:s,_owner:J_.current}}gu.Fragment=Q_;gu.jsx=L0;gu.jsxs=L0;C0.exports=gu;var o=C0.exports,Kd={},O0={exports:{}},Un={},V0={exports:{}},$0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(G,ie){var ve=G.length;G.push(ie);e:for(;0<ve;){var ee=ve-1>>>1,W=G[ee];if(0<s(W,ie))G[ee]=ie,G[ve]=W,ve=ee;else break e}}function n(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var ie=G[0],ve=G.pop();if(ve!==ie){G[0]=ve;e:for(var ee=0,W=G.length,te=W>>>1;ee<te;){var de=2*(ee+1)-1,Oe=G[de],he=de+1,ue=G[he];if(0>s(Oe,ve))he<W&&0>s(ue,Oe)?(G[ee]=ue,G[he]=ve,ee=he):(G[ee]=Oe,G[de]=ve,ee=de);else if(he<W&&0>s(ue,ve))G[ee]=ue,G[he]=ve,ee=he;else break e}}return ie}function s(G,ie){var ve=G.sortIndex-ie.sortIndex;return ve!==0?ve:G.id-ie.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,c=a.now();t.unstable_now=function(){return a.now()-c}}var u=[],d=[],h=1,f=null,g=3,x=!1,C=!1,y=!1,k=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function I(G){for(var ie=n(d);ie!==null;){if(ie.callback===null)r(d);else if(ie.startTime<=G)r(d),ie.sortIndex=ie.expirationTime,e(u,ie);else break;ie=n(d)}}function j(G){if(y=!1,I(G),!C)if(n(u)!==null)C=!0,Le(F);else{var ie=n(d);ie!==null&&Ne(j,ie.startTime-G)}}function F(G,ie){C=!1,y&&(y=!1,w(_),_=-1),x=!0;var ve=g;try{for(I(ie),f=n(u);f!==null&&(!(f.expirationTime>ie)||G&&!D());){var ee=f.callback;if(typeof ee=="function"){f.callback=null,g=f.priorityLevel;var W=ee(f.expirationTime<=ie);ie=t.unstable_now(),typeof W=="function"?f.callback=W:f===n(u)&&r(u),I(ie)}else r(u);f=n(u)}if(f!==null)var te=!0;else{var de=n(d);de!==null&&Ne(j,de.startTime-ie),te=!1}return te}finally{f=null,g=ve,x=!1}}var q=!1,E=null,_=-1,N=5,A=-1;function D(){return!(t.unstable_now()-A<N)}function S(){if(E!==null){var G=t.unstable_now();A=G;var ie=!0;try{ie=E(!0,G)}finally{ie?T():(q=!1,E=null)}}else q=!1}var T;if(typeof b=="function")T=function(){b(S)};else if(typeof MessageChannel<"u"){var Ve=new MessageChannel,Me=Ve.port2;Ve.port1.onmessage=S,T=function(){Me.postMessage(null)}}else T=function(){k(S,0)};function Le(G){E=G,q||(q=!0,T())}function Ne(G,ie){_=k(function(){G(t.unstable_now())},ie)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(G){G.callback=null},t.unstable_continueExecution=function(){C||x||(C=!0,Le(F))},t.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<G?Math.floor(1e3/G):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(G){switch(g){case 1:case 2:case 3:var ie=3;break;default:ie=g}var ve=g;g=ie;try{return G()}finally{g=ve}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(G,ie){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var ve=g;g=G;try{return ie()}finally{g=ve}},t.unstable_scheduleCallback=function(G,ie,ve){var ee=t.unstable_now();switch(typeof ve=="object"&&ve!==null?(ve=ve.delay,ve=typeof ve=="number"&&0<ve?ee+ve:ee):ve=ee,G){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=ve+W,G={id:h++,callback:ie,priorityLevel:G,startTime:ve,expirationTime:W,sortIndex:-1},ve>ee?(G.sortIndex=ve,e(d,G),n(u)===null&&G===n(d)&&(y?(w(_),_=-1):y=!0,Ne(j,ve-ee))):(G.sortIndex=W,e(u,G),C||x||(C=!0,Le(F))),G},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(G){var ie=g;return function(){var ve=g;g=ie;try{return G.apply(this,arguments)}finally{g=ve}}}})($0);V0.exports=$0;var Z_=V0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eE=P,Fn=Z_;function Z(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var F0=new Set,So={};function ki(t,e){ha(t,e),ha(t+"Capture",e)}function ha(t,e){for(So[t]=e,t=0;t<e.length;t++)F0.add(e[t])}var Jr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qd=Object.prototype.hasOwnProperty,tE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qp={},Gp={};function nE(t){return Qd.call(Gp,t)?!0:Qd.call(qp,t)?!1:tE.test(t)?Gp[t]=!0:(qp[t]=!0,!1)}function rE(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function sE(t,e,n,r){if(e===null||typeof e>"u"||rE(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function _n(t,e,n,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var Jt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Jt[t]=new _n(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Jt[e]=new _n(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Jt[t]=new _n(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Jt[t]=new _n(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Jt[t]=new _n(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Jt[t]=new _n(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Jt[t]=new _n(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Jt[t]=new _n(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Jt[t]=new _n(t,5,!1,t.toLowerCase(),null,!1,!1)});var xm=/[\-:]([a-z])/g;function wm(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(xm,wm);Jt[e]=new _n(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(xm,wm);Jt[e]=new _n(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(xm,wm);Jt[e]=new _n(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Jt[t]=new _n(t,1,!1,t.toLowerCase(),null,!1,!1)});Jt.xlinkHref=new _n("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Jt[t]=new _n(t,1,!1,t.toLowerCase(),null,!0,!0)});function bm(t,e,n,r){var s=Jt.hasOwnProperty(e)?Jt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(sE(e,n,s,r)&&(n=null),r||s===null?nE(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var as=eE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ml=Symbol.for("react.element"),zi=Symbol.for("react.portal"),Hi=Symbol.for("react.fragment"),_m=Symbol.for("react.strict_mode"),Yd=Symbol.for("react.profiler"),U0=Symbol.for("react.provider"),B0=Symbol.for("react.context"),Em=Symbol.for("react.forward_ref"),Jd=Symbol.for("react.suspense"),Xd=Symbol.for("react.suspense_list"),Tm=Symbol.for("react.memo"),vs=Symbol.for("react.lazy"),z0=Symbol.for("react.offscreen"),Kp=Symbol.iterator;function Ga(t){return t===null||typeof t!="object"?null:(t=Kp&&t[Kp]||t["@@iterator"],typeof t=="function"?t:null)}var vt=Object.assign,cd;function no(t){if(cd===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);cd=e&&e[1]||""}return`
`+cd+t}var ud=!1;function dd(t,e){if(!t||ud)return"";ud=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,c=i.length-1;1<=a&&0<=c&&s[a]!==i[c];)c--;for(;1<=a&&0<=c;a--,c--)if(s[a]!==i[c]){if(a!==1||c!==1)do if(a--,c--,0>c||s[a]!==i[c]){var u=`
`+s[a].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=a&&0<=c);break}}}finally{ud=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?no(t):""}function iE(t){switch(t.tag){case 5:return no(t.type);case 16:return no("Lazy");case 13:return no("Suspense");case 19:return no("SuspenseList");case 0:case 2:case 15:return t=dd(t.type,!1),t;case 11:return t=dd(t.type.render,!1),t;case 1:return t=dd(t.type,!0),t;default:return""}}function Zd(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Hi:return"Fragment";case zi:return"Portal";case Yd:return"Profiler";case _m:return"StrictMode";case Jd:return"Suspense";case Xd:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case B0:return(t.displayName||"Context")+".Consumer";case U0:return(t._context.displayName||"Context")+".Provider";case Em:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Tm:return e=t.displayName||null,e!==null?e:Zd(t.type)||"Memo";case vs:e=t._payload,t=t._init;try{return Zd(t(e))}catch{}}return null}function aE(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Zd(e);case 8:return e===_m?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Hs(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function H0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function oE(t){var e=H0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Ll(t){t._valueTracker||(t._valueTracker=oE(t))}function W0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=H0(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Nc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function eh(t,e){var n=e.checked;return vt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Qp(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Hs(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function q0(t,e){e=e.checked,e!=null&&bm(t,"checked",e,!1)}function th(t,e){q0(t,e);var n=Hs(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?nh(t,e.type,n):e.hasOwnProperty("defaultValue")&&nh(t,e.type,Hs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Yp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function nh(t,e,n){(e!=="number"||Nc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ro=Array.isArray;function na(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Hs(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function rh(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Z(91));return vt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Jp(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Z(92));if(ro(n)){if(1<n.length)throw Error(Z(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Hs(n)}}function G0(t,e){var n=Hs(e.value),r=Hs(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Xp(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function K0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function sh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?K0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ol,Q0=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ol=Ol||document.createElement("div"),Ol.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ol.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ko(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var mo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},lE=["Webkit","ms","Moz","O"];Object.keys(mo).forEach(function(t){lE.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),mo[e]=mo[t]})});function Y0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||mo.hasOwnProperty(t)&&mo[t]?(""+e).trim():e+"px"}function J0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Y0(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var cE=vt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ih(t,e){if(e){if(cE[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Z(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Z(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Z(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Z(62))}}function ah(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oh=null;function Cm(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var lh=null,ra=null,sa=null;function Zp(t){if(t=al(t)){if(typeof lh!="function")throw Error(Z(280));var e=t.stateNode;e&&(e=bu(e),lh(t.stateNode,t.type,e))}}function X0(t){ra?sa?sa.push(t):sa=[t]:ra=t}function Z0(){if(ra){var t=ra,e=sa;if(sa=ra=null,Zp(t),e)for(t=0;t<e.length;t++)Zp(e[t])}}function ev(t,e){return t(e)}function tv(){}var hd=!1;function nv(t,e,n){if(hd)return t(e,n);hd=!0;try{return ev(t,e,n)}finally{hd=!1,(ra!==null||sa!==null)&&(tv(),Z0())}}function Io(t,e){var n=t.stateNode;if(n===null)return null;var r=bu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Z(231,e,typeof n));return n}var ch=!1;if(Jr)try{var Ka={};Object.defineProperty(Ka,"passive",{get:function(){ch=!0}}),window.addEventListener("test",Ka,Ka),window.removeEventListener("test",Ka,Ka)}catch{ch=!1}function uE(t,e,n,r,s,i,a,c,u){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(h){this.onError(h)}}var fo=!1,Sc=null,kc=!1,uh=null,dE={onError:function(t){fo=!0,Sc=t}};function hE(t,e,n,r,s,i,a,c,u){fo=!1,Sc=null,uE.apply(dE,arguments)}function mE(t,e,n,r,s,i,a,c,u){if(hE.apply(this,arguments),fo){if(fo){var d=Sc;fo=!1,Sc=null}else throw Error(Z(198));kc||(kc=!0,uh=d)}}function Ii(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function rv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function eg(t){if(Ii(t)!==t)throw Error(Z(188))}function fE(t){var e=t.alternate;if(!e){if(e=Ii(t),e===null)throw Error(Z(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return eg(s),t;if(i===r)return eg(s),e;i=i.sibling}throw Error(Z(188))}if(n.return!==r.return)n=s,r=i;else{for(var a=!1,c=s.child;c;){if(c===n){a=!0,n=s,r=i;break}if(c===r){a=!0,r=s,n=i;break}c=c.sibling}if(!a){for(c=i.child;c;){if(c===n){a=!0,n=i,r=s;break}if(c===r){a=!0,r=i,n=s;break}c=c.sibling}if(!a)throw Error(Z(189))}}if(n.alternate!==r)throw Error(Z(190))}if(n.tag!==3)throw Error(Z(188));return n.stateNode.current===n?t:e}function sv(t){return t=fE(t),t!==null?iv(t):null}function iv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=iv(t);if(e!==null)return e;t=t.sibling}return null}var av=Fn.unstable_scheduleCallback,tg=Fn.unstable_cancelCallback,pE=Fn.unstable_shouldYield,gE=Fn.unstable_requestPaint,Nt=Fn.unstable_now,yE=Fn.unstable_getCurrentPriorityLevel,Nm=Fn.unstable_ImmediatePriority,ov=Fn.unstable_UserBlockingPriority,Ic=Fn.unstable_NormalPriority,vE=Fn.unstable_LowPriority,lv=Fn.unstable_IdlePriority,yu=null,Nr=null;function xE(t){if(Nr&&typeof Nr.onCommitFiberRoot=="function")try{Nr.onCommitFiberRoot(yu,t,void 0,(t.current.flags&128)===128)}catch{}}var lr=Math.clz32?Math.clz32:_E,wE=Math.log,bE=Math.LN2;function _E(t){return t>>>=0,t===0?32:31-(wE(t)/bE|0)|0}var Vl=64,$l=4194304;function so(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ac(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var c=a&~s;c!==0?r=so(c):(i&=a,i!==0&&(r=so(i)))}else a=n&~s,a!==0?r=so(a):i!==0&&(r=so(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-lr(e),s=1<<n,r|=t[n],e&=~s;return r}function EE(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function TE(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-lr(i),c=1<<a,u=s[a];u===-1?(!(c&n)||c&r)&&(s[a]=EE(c,e)):u<=e&&(t.expiredLanes|=c),i&=~c}}function dh(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function cv(){var t=Vl;return Vl<<=1,!(Vl&4194240)&&(Vl=64),t}function md(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function sl(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-lr(e),t[e]=n}function CE(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-lr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Sm(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-lr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Xe=0;function uv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var dv,km,hv,mv,fv,hh=!1,Fl=[],Ps=null,Rs=null,js=null,Ao=new Map,Po=new Map,bs=[],NE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ng(t,e){switch(t){case"focusin":case"focusout":Ps=null;break;case"dragenter":case"dragleave":Rs=null;break;case"mouseover":case"mouseout":js=null;break;case"pointerover":case"pointerout":Ao.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Po.delete(e.pointerId)}}function Qa(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=al(e),e!==null&&km(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function SE(t,e,n,r,s){switch(e){case"focusin":return Ps=Qa(Ps,t,e,n,r,s),!0;case"dragenter":return Rs=Qa(Rs,t,e,n,r,s),!0;case"mouseover":return js=Qa(js,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Ao.set(i,Qa(Ao.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Po.set(i,Qa(Po.get(i)||null,t,e,n,r,s)),!0}return!1}function pv(t){var e=ui(t.target);if(e!==null){var n=Ii(e);if(n!==null){if(e=n.tag,e===13){if(e=rv(n),e!==null){t.blockedOn=e,fv(t.priority,function(){hv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ic(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=mh(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);oh=r,n.target.dispatchEvent(r),oh=null}else return e=al(n),e!==null&&km(e),t.blockedOn=n,!1;e.shift()}return!0}function rg(t,e,n){ic(t)&&n.delete(e)}function kE(){hh=!1,Ps!==null&&ic(Ps)&&(Ps=null),Rs!==null&&ic(Rs)&&(Rs=null),js!==null&&ic(js)&&(js=null),Ao.forEach(rg),Po.forEach(rg)}function Ya(t,e){t.blockedOn===e&&(t.blockedOn=null,hh||(hh=!0,Fn.unstable_scheduleCallback(Fn.unstable_NormalPriority,kE)))}function Ro(t){function e(s){return Ya(s,t)}if(0<Fl.length){Ya(Fl[0],t);for(var n=1;n<Fl.length;n++){var r=Fl[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Ps!==null&&Ya(Ps,t),Rs!==null&&Ya(Rs,t),js!==null&&Ya(js,t),Ao.forEach(e),Po.forEach(e),n=0;n<bs.length;n++)r=bs[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<bs.length&&(n=bs[0],n.blockedOn===null);)pv(n),n.blockedOn===null&&bs.shift()}var ia=as.ReactCurrentBatchConfig,Pc=!0;function IE(t,e,n,r){var s=Xe,i=ia.transition;ia.transition=null;try{Xe=1,Im(t,e,n,r)}finally{Xe=s,ia.transition=i}}function AE(t,e,n,r){var s=Xe,i=ia.transition;ia.transition=null;try{Xe=4,Im(t,e,n,r)}finally{Xe=s,ia.transition=i}}function Im(t,e,n,r){if(Pc){var s=mh(t,e,n,r);if(s===null)Ed(t,e,r,Rc,n),ng(t,r);else if(SE(s,t,e,n,r))r.stopPropagation();else if(ng(t,r),e&4&&-1<NE.indexOf(t)){for(;s!==null;){var i=al(s);if(i!==null&&dv(i),i=mh(t,e,n,r),i===null&&Ed(t,e,r,Rc,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else Ed(t,e,r,null,n)}}var Rc=null;function mh(t,e,n,r){if(Rc=null,t=Cm(r),t=ui(t),t!==null)if(e=Ii(t),e===null)t=null;else if(n=e.tag,n===13){if(t=rv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Rc=t,null}function gv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(yE()){case Nm:return 1;case ov:return 4;case Ic:case vE:return 16;case lv:return 536870912;default:return 16}default:return 16}}var Ss=null,Am=null,ac=null;function yv(){if(ac)return ac;var t,e=Am,n=e.length,r,s="value"in Ss?Ss.value:Ss.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===s[i-r];r++);return ac=s.slice(t,1<r?1-r:void 0)}function oc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ul(){return!0}function sg(){return!1}function Bn(t){function e(n,r,s,i,a){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var c in t)t.hasOwnProperty(c)&&(n=t[c],this[c]=n?n(i):i[c]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ul:sg,this.isPropagationStopped=sg,this}return vt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ul)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ul)},persist:function(){},isPersistent:Ul}),e}var ka={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Pm=Bn(ka),il=vt({},ka,{view:0,detail:0}),PE=Bn(il),fd,pd,Ja,vu=vt({},il,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Rm,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ja&&(Ja&&t.type==="mousemove"?(fd=t.screenX-Ja.screenX,pd=t.screenY-Ja.screenY):pd=fd=0,Ja=t),fd)},movementY:function(t){return"movementY"in t?t.movementY:pd}}),ig=Bn(vu),RE=vt({},vu,{dataTransfer:0}),jE=Bn(RE),DE=vt({},il,{relatedTarget:0}),gd=Bn(DE),ME=vt({},ka,{animationName:0,elapsedTime:0,pseudoElement:0}),LE=Bn(ME),OE=vt({},ka,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),VE=Bn(OE),$E=vt({},ka,{data:0}),ag=Bn($E),FE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},UE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},BE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zE(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=BE[t])?!!e[t]:!1}function Rm(){return zE}var HE=vt({},il,{key:function(t){if(t.key){var e=FE[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=oc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?UE[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Rm,charCode:function(t){return t.type==="keypress"?oc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?oc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),WE=Bn(HE),qE=vt({},vu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),og=Bn(qE),GE=vt({},il,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Rm}),KE=Bn(GE),QE=vt({},ka,{propertyName:0,elapsedTime:0,pseudoElement:0}),YE=Bn(QE),JE=vt({},vu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),XE=Bn(JE),ZE=[9,13,27,32],jm=Jr&&"CompositionEvent"in window,po=null;Jr&&"documentMode"in document&&(po=document.documentMode);var eT=Jr&&"TextEvent"in window&&!po,vv=Jr&&(!jm||po&&8<po&&11>=po),lg=String.fromCharCode(32),cg=!1;function xv(t,e){switch(t){case"keyup":return ZE.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Wi=!1;function tT(t,e){switch(t){case"compositionend":return wv(e);case"keypress":return e.which!==32?null:(cg=!0,lg);case"textInput":return t=e.data,t===lg&&cg?null:t;default:return null}}function nT(t,e){if(Wi)return t==="compositionend"||!jm&&xv(t,e)?(t=yv(),ac=Am=Ss=null,Wi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return vv&&e.locale!=="ko"?null:e.data;default:return null}}var rT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ug(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!rT[t.type]:e==="textarea"}function bv(t,e,n,r){X0(r),e=jc(e,"onChange"),0<e.length&&(n=new Pm("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var go=null,jo=null;function sT(t){Rv(t,0)}function xu(t){var e=Ki(t);if(W0(e))return t}function iT(t,e){if(t==="change")return e}var _v=!1;if(Jr){var yd;if(Jr){var vd="oninput"in document;if(!vd){var dg=document.createElement("div");dg.setAttribute("oninput","return;"),vd=typeof dg.oninput=="function"}yd=vd}else yd=!1;_v=yd&&(!document.documentMode||9<document.documentMode)}function hg(){go&&(go.detachEvent("onpropertychange",Ev),jo=go=null)}function Ev(t){if(t.propertyName==="value"&&xu(jo)){var e=[];bv(e,jo,t,Cm(t)),nv(sT,e)}}function aT(t,e,n){t==="focusin"?(hg(),go=e,jo=n,go.attachEvent("onpropertychange",Ev)):t==="focusout"&&hg()}function oT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return xu(jo)}function lT(t,e){if(t==="click")return xu(e)}function cT(t,e){if(t==="input"||t==="change")return xu(e)}function uT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var dr=typeof Object.is=="function"?Object.is:uT;function Do(t,e){if(dr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Qd.call(e,s)||!dr(t[s],e[s]))return!1}return!0}function mg(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function fg(t,e){var n=mg(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=mg(n)}}function Tv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Tv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Cv(){for(var t=window,e=Nc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Nc(t.document)}return e}function Dm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function dT(t){var e=Cv(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Tv(n.ownerDocument.documentElement,n)){if(r!==null&&Dm(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=fg(n,i);var a=fg(n,r);s&&a&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var hT=Jr&&"documentMode"in document&&11>=document.documentMode,qi=null,fh=null,yo=null,ph=!1;function pg(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ph||qi==null||qi!==Nc(r)||(r=qi,"selectionStart"in r&&Dm(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),yo&&Do(yo,r)||(yo=r,r=jc(fh,"onSelect"),0<r.length&&(e=new Pm("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=qi)))}function Bl(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Gi={animationend:Bl("Animation","AnimationEnd"),animationiteration:Bl("Animation","AnimationIteration"),animationstart:Bl("Animation","AnimationStart"),transitionend:Bl("Transition","TransitionEnd")},xd={},Nv={};Jr&&(Nv=document.createElement("div").style,"AnimationEvent"in window||(delete Gi.animationend.animation,delete Gi.animationiteration.animation,delete Gi.animationstart.animation),"TransitionEvent"in window||delete Gi.transitionend.transition);function wu(t){if(xd[t])return xd[t];if(!Gi[t])return t;var e=Gi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Nv)return xd[t]=e[n];return t}var Sv=wu("animationend"),kv=wu("animationiteration"),Iv=wu("animationstart"),Av=wu("transitionend"),Pv=new Map,gg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ys(t,e){Pv.set(t,e),ki(e,[t])}for(var wd=0;wd<gg.length;wd++){var bd=gg[wd],mT=bd.toLowerCase(),fT=bd[0].toUpperCase()+bd.slice(1);Ys(mT,"on"+fT)}Ys(Sv,"onAnimationEnd");Ys(kv,"onAnimationIteration");Ys(Iv,"onAnimationStart");Ys("dblclick","onDoubleClick");Ys("focusin","onFocus");Ys("focusout","onBlur");Ys(Av,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);ki("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ki("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ki("onBeforeInput",["compositionend","keypress","textInput","paste"]);ki("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ki("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ki("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var io="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pT=new Set("cancel close invalid load scroll toggle".split(" ").concat(io));function yg(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,mE(r,e,void 0,t),t.currentTarget=null}function Rv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var c=r[a],u=c.instance,d=c.currentTarget;if(c=c.listener,u!==i&&s.isPropagationStopped())break e;yg(s,c,d),i=u}else for(a=0;a<r.length;a++){if(c=r[a],u=c.instance,d=c.currentTarget,c=c.listener,u!==i&&s.isPropagationStopped())break e;yg(s,c,d),i=u}}}if(kc)throw t=uh,kc=!1,uh=null,t}function at(t,e){var n=e[wh];n===void 0&&(n=e[wh]=new Set);var r=t+"__bubble";n.has(r)||(jv(e,t,2,!1),n.add(r))}function _d(t,e,n){var r=0;e&&(r|=4),jv(n,t,r,e)}var zl="_reactListening"+Math.random().toString(36).slice(2);function Mo(t){if(!t[zl]){t[zl]=!0,F0.forEach(function(n){n!=="selectionchange"&&(pT.has(n)||_d(n,!1,t),_d(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[zl]||(e[zl]=!0,_d("selectionchange",!1,e))}}function jv(t,e,n,r){switch(gv(e)){case 1:var s=IE;break;case 4:s=AE;break;default:s=Im}n=s.bind(null,e,n,t),s=void 0,!ch||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Ed(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var c=r.stateNode.containerInfo;if(c===s||c.nodeType===8&&c.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===s||u.nodeType===8&&u.parentNode===s))return;a=a.return}for(;c!==null;){if(a=ui(c),a===null)return;if(u=a.tag,u===5||u===6){r=i=a;continue e}c=c.parentNode}}r=r.return}nv(function(){var d=i,h=Cm(n),f=[];e:{var g=Pv.get(t);if(g!==void 0){var x=Pm,C=t;switch(t){case"keypress":if(oc(n)===0)break e;case"keydown":case"keyup":x=WE;break;case"focusin":C="focus",x=gd;break;case"focusout":C="blur",x=gd;break;case"beforeblur":case"afterblur":x=gd;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=ig;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=jE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=KE;break;case Sv:case kv:case Iv:x=LE;break;case Av:x=YE;break;case"scroll":x=PE;break;case"wheel":x=XE;break;case"copy":case"cut":case"paste":x=VE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=og}var y=(e&4)!==0,k=!y&&t==="scroll",w=y?g!==null?g+"Capture":null:g;y=[];for(var b=d,I;b!==null;){I=b;var j=I.stateNode;if(I.tag===5&&j!==null&&(I=j,w!==null&&(j=Io(b,w),j!=null&&y.push(Lo(b,j,I)))),k)break;b=b.return}0<y.length&&(g=new x(g,C,null,n,h),f.push({event:g,listeners:y}))}}if(!(e&7)){e:{if(g=t==="mouseover"||t==="pointerover",x=t==="mouseout"||t==="pointerout",g&&n!==oh&&(C=n.relatedTarget||n.fromElement)&&(ui(C)||C[Xr]))break e;if((x||g)&&(g=h.window===h?h:(g=h.ownerDocument)?g.defaultView||g.parentWindow:window,x?(C=n.relatedTarget||n.toElement,x=d,C=C?ui(C):null,C!==null&&(k=Ii(C),C!==k||C.tag!==5&&C.tag!==6)&&(C=null)):(x=null,C=d),x!==C)){if(y=ig,j="onMouseLeave",w="onMouseEnter",b="mouse",(t==="pointerout"||t==="pointerover")&&(y=og,j="onPointerLeave",w="onPointerEnter",b="pointer"),k=x==null?g:Ki(x),I=C==null?g:Ki(C),g=new y(j,b+"leave",x,n,h),g.target=k,g.relatedTarget=I,j=null,ui(h)===d&&(y=new y(w,b+"enter",C,n,h),y.target=I,y.relatedTarget=k,j=y),k=j,x&&C)t:{for(y=x,w=C,b=0,I=y;I;I=Vi(I))b++;for(I=0,j=w;j;j=Vi(j))I++;for(;0<b-I;)y=Vi(y),b--;for(;0<I-b;)w=Vi(w),I--;for(;b--;){if(y===w||w!==null&&y===w.alternate)break t;y=Vi(y),w=Vi(w)}y=null}else y=null;x!==null&&vg(f,g,x,y,!1),C!==null&&k!==null&&vg(f,k,C,y,!0)}}e:{if(g=d?Ki(d):window,x=g.nodeName&&g.nodeName.toLowerCase(),x==="select"||x==="input"&&g.type==="file")var F=iT;else if(ug(g))if(_v)F=cT;else{F=oT;var q=aT}else(x=g.nodeName)&&x.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(F=lT);if(F&&(F=F(t,d))){bv(f,F,n,h);break e}q&&q(t,g,d),t==="focusout"&&(q=g._wrapperState)&&q.controlled&&g.type==="number"&&nh(g,"number",g.value)}switch(q=d?Ki(d):window,t){case"focusin":(ug(q)||q.contentEditable==="true")&&(qi=q,fh=d,yo=null);break;case"focusout":yo=fh=qi=null;break;case"mousedown":ph=!0;break;case"contextmenu":case"mouseup":case"dragend":ph=!1,pg(f,n,h);break;case"selectionchange":if(hT)break;case"keydown":case"keyup":pg(f,n,h)}var E;if(jm)e:{switch(t){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Wi?xv(t,n)&&(_="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(_="onCompositionStart");_&&(vv&&n.locale!=="ko"&&(Wi||_!=="onCompositionStart"?_==="onCompositionEnd"&&Wi&&(E=yv()):(Ss=h,Am="value"in Ss?Ss.value:Ss.textContent,Wi=!0)),q=jc(d,_),0<q.length&&(_=new ag(_,t,null,n,h),f.push({event:_,listeners:q}),E?_.data=E:(E=wv(n),E!==null&&(_.data=E)))),(E=eT?tT(t,n):nT(t,n))&&(d=jc(d,"onBeforeInput"),0<d.length&&(h=new ag("onBeforeInput","beforeinput",null,n,h),f.push({event:h,listeners:d}),h.data=E))}Rv(f,e)})}function Lo(t,e,n){return{instance:t,listener:e,currentTarget:n}}function jc(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Io(t,n),i!=null&&r.unshift(Lo(t,i,s)),i=Io(t,e),i!=null&&r.push(Lo(t,i,s))),t=t.return}return r}function Vi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function vg(t,e,n,r,s){for(var i=e._reactName,a=[];n!==null&&n!==r;){var c=n,u=c.alternate,d=c.stateNode;if(u!==null&&u===r)break;c.tag===5&&d!==null&&(c=d,s?(u=Io(n,i),u!=null&&a.unshift(Lo(n,u,c))):s||(u=Io(n,i),u!=null&&a.push(Lo(n,u,c)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var gT=/\r\n?/g,yT=/\u0000|\uFFFD/g;function xg(t){return(typeof t=="string"?t:""+t).replace(gT,`
`).replace(yT,"")}function Hl(t,e,n){if(e=xg(e),xg(t)!==e&&n)throw Error(Z(425))}function Dc(){}var gh=null,yh=null;function vh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xh=typeof setTimeout=="function"?setTimeout:void 0,vT=typeof clearTimeout=="function"?clearTimeout:void 0,wg=typeof Promise=="function"?Promise:void 0,xT=typeof queueMicrotask=="function"?queueMicrotask:typeof wg<"u"?function(t){return wg.resolve(null).then(t).catch(wT)}:xh;function wT(t){setTimeout(function(){throw t})}function Td(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Ro(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Ro(e)}function Ds(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function bg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ia=Math.random().toString(36).slice(2),Tr="__reactFiber$"+Ia,Oo="__reactProps$"+Ia,Xr="__reactContainer$"+Ia,wh="__reactEvents$"+Ia,bT="__reactListeners$"+Ia,_T="__reactHandles$"+Ia;function ui(t){var e=t[Tr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Xr]||n[Tr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=bg(t);t!==null;){if(n=t[Tr])return n;t=bg(t)}return e}t=n,n=t.parentNode}return null}function al(t){return t=t[Tr]||t[Xr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ki(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Z(33))}function bu(t){return t[Oo]||null}var bh=[],Qi=-1;function Js(t){return{current:t}}function lt(t){0>Qi||(t.current=bh[Qi],bh[Qi]=null,Qi--)}function rt(t,e){Qi++,bh[Qi]=t.current,t.current=e}var Ws={},hn=Js(Ws),Nn=Js(!1),yi=Ws;function ma(t,e){var n=t.type.contextTypes;if(!n)return Ws;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Sn(t){return t=t.childContextTypes,t!=null}function Mc(){lt(Nn),lt(hn)}function _g(t,e,n){if(hn.current!==Ws)throw Error(Z(168));rt(hn,e),rt(Nn,n)}function Dv(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Z(108,aE(t)||"Unknown",s));return vt({},n,r)}function Lc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ws,yi=hn.current,rt(hn,t),rt(Nn,Nn.current),!0}function Eg(t,e,n){var r=t.stateNode;if(!r)throw Error(Z(169));n?(t=Dv(t,e,yi),r.__reactInternalMemoizedMergedChildContext=t,lt(Nn),lt(hn),rt(hn,t)):lt(Nn),rt(Nn,n)}var Ur=null,_u=!1,Cd=!1;function Mv(t){Ur===null?Ur=[t]:Ur.push(t)}function ET(t){_u=!0,Mv(t)}function Xs(){if(!Cd&&Ur!==null){Cd=!0;var t=0,e=Xe;try{var n=Ur;for(Xe=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Ur=null,_u=!1}catch(s){throw Ur!==null&&(Ur=Ur.slice(t+1)),av(Nm,Xs),s}finally{Xe=e,Cd=!1}}return null}var Yi=[],Ji=0,Oc=null,Vc=0,Gn=[],Kn=0,vi=null,zr=1,Hr="";function oi(t,e){Yi[Ji++]=Vc,Yi[Ji++]=Oc,Oc=t,Vc=e}function Lv(t,e,n){Gn[Kn++]=zr,Gn[Kn++]=Hr,Gn[Kn++]=vi,vi=t;var r=zr;t=Hr;var s=32-lr(r)-1;r&=~(1<<s),n+=1;var i=32-lr(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,zr=1<<32-lr(e)+s|n<<s|r,Hr=i+t}else zr=1<<i|n<<s|r,Hr=t}function Mm(t){t.return!==null&&(oi(t,1),Lv(t,1,0))}function Lm(t){for(;t===Oc;)Oc=Yi[--Ji],Yi[Ji]=null,Vc=Yi[--Ji],Yi[Ji]=null;for(;t===vi;)vi=Gn[--Kn],Gn[Kn]=null,Hr=Gn[--Kn],Gn[Kn]=null,zr=Gn[--Kn],Gn[Kn]=null}var $n=null,On=null,ft=!1,or=null;function Ov(t,e){var n=Qn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Tg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,$n=t,On=Ds(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,$n=t,On=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=vi!==null?{id:zr,overflow:Hr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Qn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,$n=t,On=null,!0):!1;default:return!1}}function _h(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Eh(t){if(ft){var e=On;if(e){var n=e;if(!Tg(t,e)){if(_h(t))throw Error(Z(418));e=Ds(n.nextSibling);var r=$n;e&&Tg(t,e)?Ov(r,n):(t.flags=t.flags&-4097|2,ft=!1,$n=t)}}else{if(_h(t))throw Error(Z(418));t.flags=t.flags&-4097|2,ft=!1,$n=t}}}function Cg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;$n=t}function Wl(t){if(t!==$n)return!1;if(!ft)return Cg(t),ft=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!vh(t.type,t.memoizedProps)),e&&(e=On)){if(_h(t))throw Vv(),Error(Z(418));for(;e;)Ov(t,e),e=Ds(e.nextSibling)}if(Cg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Z(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){On=Ds(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}On=null}}else On=$n?Ds(t.stateNode.nextSibling):null;return!0}function Vv(){for(var t=On;t;)t=Ds(t.nextSibling)}function fa(){On=$n=null,ft=!1}function Om(t){or===null?or=[t]:or.push(t)}var TT=as.ReactCurrentBatchConfig;function Xa(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Z(309));var r=n.stateNode}if(!r)throw Error(Z(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var c=s.refs;a===null?delete c[i]:c[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(Z(284));if(!n._owner)throw Error(Z(290,t))}return t}function ql(t,e){throw t=Object.prototype.toString.call(e),Error(Z(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Ng(t){var e=t._init;return e(t._payload)}function $v(t){function e(w,b){if(t){var I=w.deletions;I===null?(w.deletions=[b],w.flags|=16):I.push(b)}}function n(w,b){if(!t)return null;for(;b!==null;)e(w,b),b=b.sibling;return null}function r(w,b){for(w=new Map;b!==null;)b.key!==null?w.set(b.key,b):w.set(b.index,b),b=b.sibling;return w}function s(w,b){return w=Vs(w,b),w.index=0,w.sibling=null,w}function i(w,b,I){return w.index=I,t?(I=w.alternate,I!==null?(I=I.index,I<b?(w.flags|=2,b):I):(w.flags|=2,b)):(w.flags|=1048576,b)}function a(w){return t&&w.alternate===null&&(w.flags|=2),w}function c(w,b,I,j){return b===null||b.tag!==6?(b=Rd(I,w.mode,j),b.return=w,b):(b=s(b,I),b.return=w,b)}function u(w,b,I,j){var F=I.type;return F===Hi?h(w,b,I.props.children,j,I.key):b!==null&&(b.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===vs&&Ng(F)===b.type)?(j=s(b,I.props),j.ref=Xa(w,b,I),j.return=w,j):(j=fc(I.type,I.key,I.props,null,w.mode,j),j.ref=Xa(w,b,I),j.return=w,j)}function d(w,b,I,j){return b===null||b.tag!==4||b.stateNode.containerInfo!==I.containerInfo||b.stateNode.implementation!==I.implementation?(b=jd(I,w.mode,j),b.return=w,b):(b=s(b,I.children||[]),b.return=w,b)}function h(w,b,I,j,F){return b===null||b.tag!==7?(b=pi(I,w.mode,j,F),b.return=w,b):(b=s(b,I),b.return=w,b)}function f(w,b,I){if(typeof b=="string"&&b!==""||typeof b=="number")return b=Rd(""+b,w.mode,I),b.return=w,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Ml:return I=fc(b.type,b.key,b.props,null,w.mode,I),I.ref=Xa(w,null,b),I.return=w,I;case zi:return b=jd(b,w.mode,I),b.return=w,b;case vs:var j=b._init;return f(w,j(b._payload),I)}if(ro(b)||Ga(b))return b=pi(b,w.mode,I,null),b.return=w,b;ql(w,b)}return null}function g(w,b,I,j){var F=b!==null?b.key:null;if(typeof I=="string"&&I!==""||typeof I=="number")return F!==null?null:c(w,b,""+I,j);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Ml:return I.key===F?u(w,b,I,j):null;case zi:return I.key===F?d(w,b,I,j):null;case vs:return F=I._init,g(w,b,F(I._payload),j)}if(ro(I)||Ga(I))return F!==null?null:h(w,b,I,j,null);ql(w,I)}return null}function x(w,b,I,j,F){if(typeof j=="string"&&j!==""||typeof j=="number")return w=w.get(I)||null,c(b,w,""+j,F);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Ml:return w=w.get(j.key===null?I:j.key)||null,u(b,w,j,F);case zi:return w=w.get(j.key===null?I:j.key)||null,d(b,w,j,F);case vs:var q=j._init;return x(w,b,I,q(j._payload),F)}if(ro(j)||Ga(j))return w=w.get(I)||null,h(b,w,j,F,null);ql(b,j)}return null}function C(w,b,I,j){for(var F=null,q=null,E=b,_=b=0,N=null;E!==null&&_<I.length;_++){E.index>_?(N=E,E=null):N=E.sibling;var A=g(w,E,I[_],j);if(A===null){E===null&&(E=N);break}t&&E&&A.alternate===null&&e(w,E),b=i(A,b,_),q===null?F=A:q.sibling=A,q=A,E=N}if(_===I.length)return n(w,E),ft&&oi(w,_),F;if(E===null){for(;_<I.length;_++)E=f(w,I[_],j),E!==null&&(b=i(E,b,_),q===null?F=E:q.sibling=E,q=E);return ft&&oi(w,_),F}for(E=r(w,E);_<I.length;_++)N=x(E,w,_,I[_],j),N!==null&&(t&&N.alternate!==null&&E.delete(N.key===null?_:N.key),b=i(N,b,_),q===null?F=N:q.sibling=N,q=N);return t&&E.forEach(function(D){return e(w,D)}),ft&&oi(w,_),F}function y(w,b,I,j){var F=Ga(I);if(typeof F!="function")throw Error(Z(150));if(I=F.call(I),I==null)throw Error(Z(151));for(var q=F=null,E=b,_=b=0,N=null,A=I.next();E!==null&&!A.done;_++,A=I.next()){E.index>_?(N=E,E=null):N=E.sibling;var D=g(w,E,A.value,j);if(D===null){E===null&&(E=N);break}t&&E&&D.alternate===null&&e(w,E),b=i(D,b,_),q===null?F=D:q.sibling=D,q=D,E=N}if(A.done)return n(w,E),ft&&oi(w,_),F;if(E===null){for(;!A.done;_++,A=I.next())A=f(w,A.value,j),A!==null&&(b=i(A,b,_),q===null?F=A:q.sibling=A,q=A);return ft&&oi(w,_),F}for(E=r(w,E);!A.done;_++,A=I.next())A=x(E,w,_,A.value,j),A!==null&&(t&&A.alternate!==null&&E.delete(A.key===null?_:A.key),b=i(A,b,_),q===null?F=A:q.sibling=A,q=A);return t&&E.forEach(function(S){return e(w,S)}),ft&&oi(w,_),F}function k(w,b,I,j){if(typeof I=="object"&&I!==null&&I.type===Hi&&I.key===null&&(I=I.props.children),typeof I=="object"&&I!==null){switch(I.$$typeof){case Ml:e:{for(var F=I.key,q=b;q!==null;){if(q.key===F){if(F=I.type,F===Hi){if(q.tag===7){n(w,q.sibling),b=s(q,I.props.children),b.return=w,w=b;break e}}else if(q.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===vs&&Ng(F)===q.type){n(w,q.sibling),b=s(q,I.props),b.ref=Xa(w,q,I),b.return=w,w=b;break e}n(w,q);break}else e(w,q);q=q.sibling}I.type===Hi?(b=pi(I.props.children,w.mode,j,I.key),b.return=w,w=b):(j=fc(I.type,I.key,I.props,null,w.mode,j),j.ref=Xa(w,b,I),j.return=w,w=j)}return a(w);case zi:e:{for(q=I.key;b!==null;){if(b.key===q)if(b.tag===4&&b.stateNode.containerInfo===I.containerInfo&&b.stateNode.implementation===I.implementation){n(w,b.sibling),b=s(b,I.children||[]),b.return=w,w=b;break e}else{n(w,b);break}else e(w,b);b=b.sibling}b=jd(I,w.mode,j),b.return=w,w=b}return a(w);case vs:return q=I._init,k(w,b,q(I._payload),j)}if(ro(I))return C(w,b,I,j);if(Ga(I))return y(w,b,I,j);ql(w,I)}return typeof I=="string"&&I!==""||typeof I=="number"?(I=""+I,b!==null&&b.tag===6?(n(w,b.sibling),b=s(b,I),b.return=w,w=b):(n(w,b),b=Rd(I,w.mode,j),b.return=w,w=b),a(w)):n(w,b)}return k}var pa=$v(!0),Fv=$v(!1),$c=Js(null),Fc=null,Xi=null,Vm=null;function $m(){Vm=Xi=Fc=null}function Fm(t){var e=$c.current;lt($c),t._currentValue=e}function Th(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function aa(t,e){Fc=t,Vm=Xi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Cn=!0),t.firstContext=null)}function Xn(t){var e=t._currentValue;if(Vm!==t)if(t={context:t,memoizedValue:e,next:null},Xi===null){if(Fc===null)throw Error(Z(308));Xi=t,Fc.dependencies={lanes:0,firstContext:t}}else Xi=Xi.next=t;return e}var di=null;function Um(t){di===null?di=[t]:di.push(t)}function Uv(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Um(e)):(n.next=s.next,s.next=n),e.interleaved=n,Zr(t,r)}function Zr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var xs=!1;function Bm(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Bv(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Kr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ms(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,qe&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Zr(t,n)}return s=r.interleaved,s===null?(e.next=e,Um(r)):(e.next=s.next,s.next=e),r.interleaved=e,Zr(t,n)}function lc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Sm(t,n)}}function Sg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Uc(t,e,n,r){var s=t.updateQueue;xs=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,c=s.shared.pending;if(c!==null){s.shared.pending=null;var u=c,d=u.next;u.next=null,a===null?i=d:a.next=d,a=u;var h=t.alternate;h!==null&&(h=h.updateQueue,c=h.lastBaseUpdate,c!==a&&(c===null?h.firstBaseUpdate=d:c.next=d,h.lastBaseUpdate=u))}if(i!==null){var f=s.baseState;a=0,h=d=u=null,c=i;do{var g=c.lane,x=c.eventTime;if((r&g)===g){h!==null&&(h=h.next={eventTime:x,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var C=t,y=c;switch(g=e,x=n,y.tag){case 1:if(C=y.payload,typeof C=="function"){f=C.call(x,f,g);break e}f=C;break e;case 3:C.flags=C.flags&-65537|128;case 0:if(C=y.payload,g=typeof C=="function"?C.call(x,f,g):C,g==null)break e;f=vt({},f,g);break e;case 2:xs=!0}}c.callback!==null&&c.lane!==0&&(t.flags|=64,g=s.effects,g===null?s.effects=[c]:g.push(c))}else x={eventTime:x,lane:g,tag:c.tag,payload:c.payload,callback:c.callback,next:null},h===null?(d=h=x,u=f):h=h.next=x,a|=g;if(c=c.next,c===null){if(c=s.shared.pending,c===null)break;g=c,c=g.next,g.next=null,s.lastBaseUpdate=g,s.shared.pending=null}}while(1);if(h===null&&(u=f),s.baseState=u,s.firstBaseUpdate=d,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);wi|=a,t.lanes=a,t.memoizedState=f}}function kg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Z(191,s));s.call(r)}}}var ol={},Sr=Js(ol),Vo=Js(ol),$o=Js(ol);function hi(t){if(t===ol)throw Error(Z(174));return t}function zm(t,e){switch(rt($o,e),rt(Vo,t),rt(Sr,ol),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:sh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=sh(e,t)}lt(Sr),rt(Sr,e)}function ga(){lt(Sr),lt(Vo),lt($o)}function zv(t){hi($o.current);var e=hi(Sr.current),n=sh(e,t.type);e!==n&&(rt(Vo,t),rt(Sr,n))}function Hm(t){Vo.current===t&&(lt(Sr),lt(Vo))}var gt=Js(0);function Bc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Nd=[];function Wm(){for(var t=0;t<Nd.length;t++)Nd[t]._workInProgressVersionPrimary=null;Nd.length=0}var cc=as.ReactCurrentDispatcher,Sd=as.ReactCurrentBatchConfig,xi=0,yt=null,Rt=null,Ft=null,zc=!1,vo=!1,Fo=0,CT=0;function an(){throw Error(Z(321))}function qm(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!dr(t[n],e[n]))return!1;return!0}function Gm(t,e,n,r,s,i){if(xi=i,yt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,cc.current=t===null||t.memoizedState===null?IT:AT,t=n(r,s),vo){i=0;do{if(vo=!1,Fo=0,25<=i)throw Error(Z(301));i+=1,Ft=Rt=null,e.updateQueue=null,cc.current=PT,t=n(r,s)}while(vo)}if(cc.current=Hc,e=Rt!==null&&Rt.next!==null,xi=0,Ft=Rt=yt=null,zc=!1,e)throw Error(Z(300));return t}function Km(){var t=Fo!==0;return Fo=0,t}function _r(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ft===null?yt.memoizedState=Ft=t:Ft=Ft.next=t,Ft}function Zn(){if(Rt===null){var t=yt.alternate;t=t!==null?t.memoizedState:null}else t=Rt.next;var e=Ft===null?yt.memoizedState:Ft.next;if(e!==null)Ft=e,Rt=t;else{if(t===null)throw Error(Z(310));Rt=t,t={memoizedState:Rt.memoizedState,baseState:Rt.baseState,baseQueue:Rt.baseQueue,queue:Rt.queue,next:null},Ft===null?yt.memoizedState=Ft=t:Ft=Ft.next=t}return Ft}function Uo(t,e){return typeof e=="function"?e(t):e}function kd(t){var e=Zn(),n=e.queue;if(n===null)throw Error(Z(311));n.lastRenderedReducer=t;var r=Rt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var c=a=null,u=null,d=i;do{var h=d.lane;if((xi&h)===h)u!==null&&(u=u.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var f={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};u===null?(c=u=f,a=r):u=u.next=f,yt.lanes|=h,wi|=h}d=d.next}while(d!==null&&d!==i);u===null?a=r:u.next=c,dr(r,e.memoizedState)||(Cn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,yt.lanes|=i,wi|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Id(t){var e=Zn(),n=e.queue;if(n===null)throw Error(Z(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do i=t(i,a.action),a=a.next;while(a!==s);dr(i,e.memoizedState)||(Cn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function Hv(){}function Wv(t,e){var n=yt,r=Zn(),s=e(),i=!dr(r.memoizedState,s);if(i&&(r.memoizedState=s,Cn=!0),r=r.queue,Qm(Kv.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Ft!==null&&Ft.memoizedState.tag&1){if(n.flags|=2048,Bo(9,Gv.bind(null,n,r,s,e),void 0,null),Ut===null)throw Error(Z(349));xi&30||qv(n,e,s)}return s}function qv(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=yt.updateQueue,e===null?(e={lastEffect:null,stores:null},yt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Gv(t,e,n,r){e.value=n,e.getSnapshot=r,Qv(e)&&Yv(t)}function Kv(t,e,n){return n(function(){Qv(e)&&Yv(t)})}function Qv(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!dr(t,n)}catch{return!0}}function Yv(t){var e=Zr(t,1);e!==null&&cr(e,t,1,-1)}function Ig(t){var e=_r();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Uo,lastRenderedState:t},e.queue=t,t=t.dispatch=kT.bind(null,yt,t),[e.memoizedState,t]}function Bo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=yt.updateQueue,e===null?(e={lastEffect:null,stores:null},yt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Jv(){return Zn().memoizedState}function uc(t,e,n,r){var s=_r();yt.flags|=t,s.memoizedState=Bo(1|e,n,void 0,r===void 0?null:r)}function Eu(t,e,n,r){var s=Zn();r=r===void 0?null:r;var i=void 0;if(Rt!==null){var a=Rt.memoizedState;if(i=a.destroy,r!==null&&qm(r,a.deps)){s.memoizedState=Bo(e,n,i,r);return}}yt.flags|=t,s.memoizedState=Bo(1|e,n,i,r)}function Ag(t,e){return uc(8390656,8,t,e)}function Qm(t,e){return Eu(2048,8,t,e)}function Xv(t,e){return Eu(4,2,t,e)}function Zv(t,e){return Eu(4,4,t,e)}function ex(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function tx(t,e,n){return n=n!=null?n.concat([t]):null,Eu(4,4,ex.bind(null,e,t),n)}function Ym(){}function nx(t,e){var n=Zn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&qm(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function rx(t,e){var n=Zn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&qm(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function sx(t,e,n){return xi&21?(dr(n,e)||(n=cv(),yt.lanes|=n,wi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Cn=!0),t.memoizedState=n)}function NT(t,e){var n=Xe;Xe=n!==0&&4>n?n:4,t(!0);var r=Sd.transition;Sd.transition={};try{t(!1),e()}finally{Xe=n,Sd.transition=r}}function ix(){return Zn().memoizedState}function ST(t,e,n){var r=Os(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ax(t))ox(e,n);else if(n=Uv(t,e,n,r),n!==null){var s=vn();cr(n,t,r,s),lx(n,e,r)}}function kT(t,e,n){var r=Os(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ax(t))ox(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,c=i(a,n);if(s.hasEagerState=!0,s.eagerState=c,dr(c,a)){var u=e.interleaved;u===null?(s.next=s,Um(e)):(s.next=u.next,u.next=s),e.interleaved=s;return}}catch{}finally{}n=Uv(t,e,s,r),n!==null&&(s=vn(),cr(n,t,r,s),lx(n,e,r))}}function ax(t){var e=t.alternate;return t===yt||e!==null&&e===yt}function ox(t,e){vo=zc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function lx(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Sm(t,n)}}var Hc={readContext:Xn,useCallback:an,useContext:an,useEffect:an,useImperativeHandle:an,useInsertionEffect:an,useLayoutEffect:an,useMemo:an,useReducer:an,useRef:an,useState:an,useDebugValue:an,useDeferredValue:an,useTransition:an,useMutableSource:an,useSyncExternalStore:an,useId:an,unstable_isNewReconciler:!1},IT={readContext:Xn,useCallback:function(t,e){return _r().memoizedState=[t,e===void 0?null:e],t},useContext:Xn,useEffect:Ag,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,uc(4194308,4,ex.bind(null,e,t),n)},useLayoutEffect:function(t,e){return uc(4194308,4,t,e)},useInsertionEffect:function(t,e){return uc(4,2,t,e)},useMemo:function(t,e){var n=_r();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=_r();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=ST.bind(null,yt,t),[r.memoizedState,t]},useRef:function(t){var e=_r();return t={current:t},e.memoizedState=t},useState:Ig,useDebugValue:Ym,useDeferredValue:function(t){return _r().memoizedState=t},useTransition:function(){var t=Ig(!1),e=t[0];return t=NT.bind(null,t[1]),_r().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=yt,s=_r();if(ft){if(n===void 0)throw Error(Z(407));n=n()}else{if(n=e(),Ut===null)throw Error(Z(349));xi&30||qv(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Ag(Kv.bind(null,r,i,t),[t]),r.flags|=2048,Bo(9,Gv.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=_r(),e=Ut.identifierPrefix;if(ft){var n=Hr,r=zr;n=(r&~(1<<32-lr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Fo++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=CT++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},AT={readContext:Xn,useCallback:nx,useContext:Xn,useEffect:Qm,useImperativeHandle:tx,useInsertionEffect:Xv,useLayoutEffect:Zv,useMemo:rx,useReducer:kd,useRef:Jv,useState:function(){return kd(Uo)},useDebugValue:Ym,useDeferredValue:function(t){var e=Zn();return sx(e,Rt.memoizedState,t)},useTransition:function(){var t=kd(Uo)[0],e=Zn().memoizedState;return[t,e]},useMutableSource:Hv,useSyncExternalStore:Wv,useId:ix,unstable_isNewReconciler:!1},PT={readContext:Xn,useCallback:nx,useContext:Xn,useEffect:Qm,useImperativeHandle:tx,useInsertionEffect:Xv,useLayoutEffect:Zv,useMemo:rx,useReducer:Id,useRef:Jv,useState:function(){return Id(Uo)},useDebugValue:Ym,useDeferredValue:function(t){var e=Zn();return Rt===null?e.memoizedState=t:sx(e,Rt.memoizedState,t)},useTransition:function(){var t=Id(Uo)[0],e=Zn().memoizedState;return[t,e]},useMutableSource:Hv,useSyncExternalStore:Wv,useId:ix,unstable_isNewReconciler:!1};function ir(t,e){if(t&&t.defaultProps){e=vt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Ch(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:vt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Tu={isMounted:function(t){return(t=t._reactInternals)?Ii(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=vn(),s=Os(t),i=Kr(r,s);i.payload=e,n!=null&&(i.callback=n),e=Ms(t,i,s),e!==null&&(cr(e,t,s,r),lc(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=vn(),s=Os(t),i=Kr(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Ms(t,i,s),e!==null&&(cr(e,t,s,r),lc(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=vn(),r=Os(t),s=Kr(n,r);s.tag=2,e!=null&&(s.callback=e),e=Ms(t,s,r),e!==null&&(cr(e,t,r,n),lc(e,t,r))}};function Pg(t,e,n,r,s,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!Do(n,r)||!Do(s,i):!0}function cx(t,e,n){var r=!1,s=Ws,i=e.contextType;return typeof i=="object"&&i!==null?i=Xn(i):(s=Sn(e)?yi:hn.current,r=e.contextTypes,i=(r=r!=null)?ma(t,s):Ws),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Tu,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Rg(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Tu.enqueueReplaceState(e,e.state,null)}function Nh(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Bm(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Xn(i):(i=Sn(e)?yi:hn.current,s.context=ma(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Ch(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Tu.enqueueReplaceState(s,s.state,null),Uc(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function ya(t,e){try{var n="",r=e;do n+=iE(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Ad(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Sh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var RT=typeof WeakMap=="function"?WeakMap:Map;function ux(t,e,n){n=Kr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){qc||(qc=!0,Oh=r),Sh(t,e)},n}function dx(t,e,n){n=Kr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Sh(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Sh(t,e),typeof r!="function"&&(Ls===null?Ls=new Set([this]):Ls.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function jg(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new RT;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=qT.bind(null,t,e,n),e.then(t,t))}function Dg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Mg(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Kr(-1,1),e.tag=2,Ms(n,e,1))),n.lanes|=1),t)}var jT=as.ReactCurrentOwner,Cn=!1;function yn(t,e,n,r){e.child=t===null?Fv(e,null,n,r):pa(e,t.child,n,r)}function Lg(t,e,n,r,s){n=n.render;var i=e.ref;return aa(e,s),r=Gm(t,e,n,r,i,s),n=Km(),t!==null&&!Cn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,es(t,e,s)):(ft&&n&&Mm(e),e.flags|=1,yn(t,e,r,s),e.child)}function Og(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!sf(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,hx(t,e,i,r,s)):(t=fc(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:Do,n(a,r)&&t.ref===e.ref)return es(t,e,s)}return e.flags|=1,t=Vs(i,r),t.ref=e.ref,t.return=e,e.child=t}function hx(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Do(i,r)&&t.ref===e.ref)if(Cn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Cn=!0);else return e.lanes=t.lanes,es(t,e,s)}return kh(t,e,n,r,s)}function mx(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},rt(ea,Ln),Ln|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,rt(ea,Ln),Ln|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,rt(ea,Ln),Ln|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,rt(ea,Ln),Ln|=r;return yn(t,e,s,n),e.child}function fx(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function kh(t,e,n,r,s){var i=Sn(n)?yi:hn.current;return i=ma(e,i),aa(e,s),n=Gm(t,e,n,r,i,s),r=Km(),t!==null&&!Cn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,es(t,e,s)):(ft&&r&&Mm(e),e.flags|=1,yn(t,e,n,s),e.child)}function Vg(t,e,n,r,s){if(Sn(n)){var i=!0;Lc(e)}else i=!1;if(aa(e,s),e.stateNode===null)dc(t,e),cx(e,n,r),Nh(e,n,r,s),r=!0;else if(t===null){var a=e.stateNode,c=e.memoizedProps;a.props=c;var u=a.context,d=n.contextType;typeof d=="object"&&d!==null?d=Xn(d):(d=Sn(n)?yi:hn.current,d=ma(e,d));var h=n.getDerivedStateFromProps,f=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";f||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(c!==r||u!==d)&&Rg(e,a,r,d),xs=!1;var g=e.memoizedState;a.state=g,Uc(e,r,a,s),u=e.memoizedState,c!==r||g!==u||Nn.current||xs?(typeof h=="function"&&(Ch(e,n,h,r),u=e.memoizedState),(c=xs||Pg(e,n,c,r,g,u,d))?(f||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),a.props=r,a.state=u,a.context=d,r=c):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,Bv(t,e),c=e.memoizedProps,d=e.type===e.elementType?c:ir(e.type,c),a.props=d,f=e.pendingProps,g=a.context,u=n.contextType,typeof u=="object"&&u!==null?u=Xn(u):(u=Sn(n)?yi:hn.current,u=ma(e,u));var x=n.getDerivedStateFromProps;(h=typeof x=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(c!==f||g!==u)&&Rg(e,a,r,u),xs=!1,g=e.memoizedState,a.state=g,Uc(e,r,a,s);var C=e.memoizedState;c!==f||g!==C||Nn.current||xs?(typeof x=="function"&&(Ch(e,n,x,r),C=e.memoizedState),(d=xs||Pg(e,n,d,r,g,C,u)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,C,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,C,u)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=C),a.props=r,a.state=C,a.context=u,r=d):(typeof a.componentDidUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),r=!1)}return Ih(t,e,n,r,i,s)}function Ih(t,e,n,r,s,i){fx(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&Eg(e,n,!1),es(t,e,i);r=e.stateNode,jT.current=e;var c=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=pa(e,t.child,null,i),e.child=pa(e,null,c,i)):yn(t,e,c,i),e.memoizedState=r.state,s&&Eg(e,n,!0),e.child}function px(t){var e=t.stateNode;e.pendingContext?_g(t,e.pendingContext,e.pendingContext!==e.context):e.context&&_g(t,e.context,!1),zm(t,e.containerInfo)}function $g(t,e,n,r,s){return fa(),Om(s),e.flags|=256,yn(t,e,n,r),e.child}var Ah={dehydrated:null,treeContext:null,retryLane:0};function Ph(t){return{baseLanes:t,cachePool:null,transitions:null}}function gx(t,e,n){var r=e.pendingProps,s=gt.current,i=!1,a=(e.flags&128)!==0,c;if((c=a)||(c=t!==null&&t.memoizedState===null?!1:(s&2)!==0),c?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),rt(gt,s&1),t===null)return Eh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Su(a,r,0,null),t=pi(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Ph(n),e.memoizedState=Ah,t):Jm(e,a));if(s=t.memoizedState,s!==null&&(c=s.dehydrated,c!==null))return DT(t,e,a,r,c,s,n);if(i){i=r.fallback,a=e.mode,s=t.child,c=s.sibling;var u={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=Vs(s,u),r.subtreeFlags=s.subtreeFlags&14680064),c!==null?i=Vs(c,i):(i=pi(i,a,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=t.child.memoizedState,a=a===null?Ph(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=Ah,r}return i=t.child,t=i.sibling,r=Vs(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Jm(t,e){return e=Su({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Gl(t,e,n,r){return r!==null&&Om(r),pa(e,t.child,null,n),t=Jm(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function DT(t,e,n,r,s,i,a){if(n)return e.flags&256?(e.flags&=-257,r=Ad(Error(Z(422))),Gl(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Su({mode:"visible",children:r.children},s,0,null),i=pi(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&pa(e,t.child,null,a),e.child.memoizedState=Ph(a),e.memoizedState=Ah,i);if(!(e.mode&1))return Gl(t,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var c=r.dgst;return r=c,i=Error(Z(419)),r=Ad(i,r,void 0),Gl(t,e,a,r)}if(c=(a&t.childLanes)!==0,Cn||c){if(r=Ut,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Zr(t,s),cr(r,t,s,-1))}return rf(),r=Ad(Error(Z(421))),Gl(t,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=GT.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,On=Ds(s.nextSibling),$n=e,ft=!0,or=null,t!==null&&(Gn[Kn++]=zr,Gn[Kn++]=Hr,Gn[Kn++]=vi,zr=t.id,Hr=t.overflow,vi=e),e=Jm(e,r.children),e.flags|=4096,e)}function Fg(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Th(t.return,e,n)}function Pd(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function yx(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(yn(t,e,r.children,n),r=gt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Fg(t,n,e);else if(t.tag===19)Fg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(rt(gt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Bc(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Pd(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Bc(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Pd(e,!0,n,null,i);break;case"together":Pd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function dc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function es(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),wi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Z(153));if(e.child!==null){for(t=e.child,n=Vs(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Vs(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function MT(t,e,n){switch(e.tag){case 3:px(e),fa();break;case 5:zv(e);break;case 1:Sn(e.type)&&Lc(e);break;case 4:zm(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;rt($c,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(rt(gt,gt.current&1),e.flags|=128,null):n&e.child.childLanes?gx(t,e,n):(rt(gt,gt.current&1),t=es(t,e,n),t!==null?t.sibling:null);rt(gt,gt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return yx(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),rt(gt,gt.current),r)break;return null;case 22:case 23:return e.lanes=0,mx(t,e,n)}return es(t,e,n)}var vx,Rh,xx,wx;vx=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Rh=function(){};xx=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,hi(Sr.current);var i=null;switch(n){case"input":s=eh(t,s),r=eh(t,r),i=[];break;case"select":s=vt({},s,{value:void 0}),r=vt({},r,{value:void 0}),i=[];break;case"textarea":s=rh(t,s),r=rh(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Dc)}ih(n,r);var a;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var c=s[d];for(a in c)c.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(So.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var u=r[d];if(c=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&u!==c&&(u!=null||c!=null))if(d==="style")if(c){for(a in c)!c.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in u)u.hasOwnProperty(a)&&c[a]!==u[a]&&(n||(n={}),n[a]=u[a])}else n||(i||(i=[]),i.push(d,n)),n=u;else d==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,c=c?c.__html:void 0,u!=null&&c!==u&&(i=i||[]).push(d,u)):d==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(d,""+u):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(So.hasOwnProperty(d)?(u!=null&&d==="onScroll"&&at("scroll",t),i||c===u||(i=[])):(i=i||[]).push(d,u))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};wx=function(t,e,n,r){n!==r&&(e.flags|=4)};function Za(t,e){if(!ft)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function on(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function LT(t,e,n){var r=e.pendingProps;switch(Lm(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return on(e),null;case 1:return Sn(e.type)&&Mc(),on(e),null;case 3:return r=e.stateNode,ga(),lt(Nn),lt(hn),Wm(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Wl(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,or!==null&&(Fh(or),or=null))),Rh(t,e),on(e),null;case 5:Hm(e);var s=hi($o.current);if(n=e.type,t!==null&&e.stateNode!=null)xx(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Z(166));return on(e),null}if(t=hi(Sr.current),Wl(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Tr]=e,r[Oo]=i,t=(e.mode&1)!==0,n){case"dialog":at("cancel",r),at("close",r);break;case"iframe":case"object":case"embed":at("load",r);break;case"video":case"audio":for(s=0;s<io.length;s++)at(io[s],r);break;case"source":at("error",r);break;case"img":case"image":case"link":at("error",r),at("load",r);break;case"details":at("toggle",r);break;case"input":Qp(r,i),at("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},at("invalid",r);break;case"textarea":Jp(r,i),at("invalid",r)}ih(n,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var c=i[a];a==="children"?typeof c=="string"?r.textContent!==c&&(i.suppressHydrationWarning!==!0&&Hl(r.textContent,c,t),s=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(i.suppressHydrationWarning!==!0&&Hl(r.textContent,c,t),s=["children",""+c]):So.hasOwnProperty(a)&&c!=null&&a==="onScroll"&&at("scroll",r)}switch(n){case"input":Ll(r),Yp(r,i,!0);break;case"textarea":Ll(r),Xp(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Dc)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=K0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[Tr]=e,t[Oo]=r,vx(t,e,!1,!1),e.stateNode=t;e:{switch(a=ah(n,r),n){case"dialog":at("cancel",t),at("close",t),s=r;break;case"iframe":case"object":case"embed":at("load",t),s=r;break;case"video":case"audio":for(s=0;s<io.length;s++)at(io[s],t);s=r;break;case"source":at("error",t),s=r;break;case"img":case"image":case"link":at("error",t),at("load",t),s=r;break;case"details":at("toggle",t),s=r;break;case"input":Qp(t,r),s=eh(t,r),at("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=vt({},r,{value:void 0}),at("invalid",t);break;case"textarea":Jp(t,r),s=rh(t,r),at("invalid",t);break;default:s=r}ih(n,s),c=s;for(i in c)if(c.hasOwnProperty(i)){var u=c[i];i==="style"?J0(t,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&Q0(t,u)):i==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&ko(t,u):typeof u=="number"&&ko(t,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(So.hasOwnProperty(i)?u!=null&&i==="onScroll"&&at("scroll",t):u!=null&&bm(t,i,u,a))}switch(n){case"input":Ll(t),Yp(t,r,!1);break;case"textarea":Ll(t),Xp(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Hs(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?na(t,!!r.multiple,i,!1):r.defaultValue!=null&&na(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Dc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return on(e),null;case 6:if(t&&e.stateNode!=null)wx(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Z(166));if(n=hi($o.current),hi(Sr.current),Wl(e)){if(r=e.stateNode,n=e.memoizedProps,r[Tr]=e,(i=r.nodeValue!==n)&&(t=$n,t!==null))switch(t.tag){case 3:Hl(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Hl(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Tr]=e,e.stateNode=r}return on(e),null;case 13:if(lt(gt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ft&&On!==null&&e.mode&1&&!(e.flags&128))Vv(),fa(),e.flags|=98560,i=!1;else if(i=Wl(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(Z(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Z(317));i[Tr]=e}else fa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;on(e),i=!1}else or!==null&&(Fh(or),or=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||gt.current&1?jt===0&&(jt=3):rf())),e.updateQueue!==null&&(e.flags|=4),on(e),null);case 4:return ga(),Rh(t,e),t===null&&Mo(e.stateNode.containerInfo),on(e),null;case 10:return Fm(e.type._context),on(e),null;case 17:return Sn(e.type)&&Mc(),on(e),null;case 19:if(lt(gt),i=e.memoizedState,i===null)return on(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)Za(i,!1);else{if(jt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=Bc(t),a!==null){for(e.flags|=128,Za(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return rt(gt,gt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Nt()>va&&(e.flags|=128,r=!0,Za(i,!1),e.lanes=4194304)}else{if(!r)if(t=Bc(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Za(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!ft)return on(e),null}else 2*Nt()-i.renderingStartTime>va&&n!==1073741824&&(e.flags|=128,r=!0,Za(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Nt(),e.sibling=null,n=gt.current,rt(gt,r?n&1|2:n&1),e):(on(e),null);case 22:case 23:return nf(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Ln&1073741824&&(on(e),e.subtreeFlags&6&&(e.flags|=8192)):on(e),null;case 24:return null;case 25:return null}throw Error(Z(156,e.tag))}function OT(t,e){switch(Lm(e),e.tag){case 1:return Sn(e.type)&&Mc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ga(),lt(Nn),lt(hn),Wm(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Hm(e),null;case 13:if(lt(gt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Z(340));fa()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return lt(gt),null;case 4:return ga(),null;case 10:return Fm(e.type._context),null;case 22:case 23:return nf(),null;case 24:return null;default:return null}}var Kl=!1,un=!1,VT=typeof WeakSet=="function"?WeakSet:Set,ce=null;function Zi(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Et(t,e,r)}else n.current=null}function jh(t,e,n){try{n()}catch(r){Et(t,e,r)}}var Ug=!1;function $T(t,e){if(gh=Pc,t=Cv(),Dm(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,c=-1,u=-1,d=0,h=0,f=t,g=null;t:for(;;){for(var x;f!==n||s!==0&&f.nodeType!==3||(c=a+s),f!==i||r!==0&&f.nodeType!==3||(u=a+r),f.nodeType===3&&(a+=f.nodeValue.length),(x=f.firstChild)!==null;)g=f,f=x;for(;;){if(f===t)break t;if(g===n&&++d===s&&(c=a),g===i&&++h===r&&(u=a),(x=f.nextSibling)!==null)break;f=g,g=f.parentNode}f=x}n=c===-1||u===-1?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(yh={focusedElem:t,selectionRange:n},Pc=!1,ce=e;ce!==null;)if(e=ce,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ce=t;else for(;ce!==null;){e=ce;try{var C=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(C!==null){var y=C.memoizedProps,k=C.memoizedState,w=e.stateNode,b=w.getSnapshotBeforeUpdate(e.elementType===e.type?y:ir(e.type,y),k);w.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var I=e.stateNode.containerInfo;I.nodeType===1?I.textContent="":I.nodeType===9&&I.documentElement&&I.removeChild(I.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Z(163))}}catch(j){Et(e,e.return,j)}if(t=e.sibling,t!==null){t.return=e.return,ce=t;break}ce=e.return}return C=Ug,Ug=!1,C}function xo(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&jh(e,n,i)}s=s.next}while(s!==r)}}function Cu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Dh(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function bx(t){var e=t.alternate;e!==null&&(t.alternate=null,bx(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Tr],delete e[Oo],delete e[wh],delete e[bT],delete e[_T])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function _x(t){return t.tag===5||t.tag===3||t.tag===4}function Bg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||_x(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Mh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Dc));else if(r!==4&&(t=t.child,t!==null))for(Mh(t,e,n),t=t.sibling;t!==null;)Mh(t,e,n),t=t.sibling}function Lh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Lh(t,e,n),t=t.sibling;t!==null;)Lh(t,e,n),t=t.sibling}var qt=null,ar=!1;function gs(t,e,n){for(n=n.child;n!==null;)Ex(t,e,n),n=n.sibling}function Ex(t,e,n){if(Nr&&typeof Nr.onCommitFiberUnmount=="function")try{Nr.onCommitFiberUnmount(yu,n)}catch{}switch(n.tag){case 5:un||Zi(n,e);case 6:var r=qt,s=ar;qt=null,gs(t,e,n),qt=r,ar=s,qt!==null&&(ar?(t=qt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):qt.removeChild(n.stateNode));break;case 18:qt!==null&&(ar?(t=qt,n=n.stateNode,t.nodeType===8?Td(t.parentNode,n):t.nodeType===1&&Td(t,n),Ro(t)):Td(qt,n.stateNode));break;case 4:r=qt,s=ar,qt=n.stateNode.containerInfo,ar=!0,gs(t,e,n),qt=r,ar=s;break;case 0:case 11:case 14:case 15:if(!un&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&jh(n,e,a),s=s.next}while(s!==r)}gs(t,e,n);break;case 1:if(!un&&(Zi(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(c){Et(n,e,c)}gs(t,e,n);break;case 21:gs(t,e,n);break;case 22:n.mode&1?(un=(r=un)||n.memoizedState!==null,gs(t,e,n),un=r):gs(t,e,n);break;default:gs(t,e,n)}}function zg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new VT),e.forEach(function(r){var s=KT.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function sr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,a=e,c=a;e:for(;c!==null;){switch(c.tag){case 5:qt=c.stateNode,ar=!1;break e;case 3:qt=c.stateNode.containerInfo,ar=!0;break e;case 4:qt=c.stateNode.containerInfo,ar=!0;break e}c=c.return}if(qt===null)throw Error(Z(160));Ex(i,a,s),qt=null,ar=!1;var u=s.alternate;u!==null&&(u.return=null),s.return=null}catch(d){Et(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Tx(e,t),e=e.sibling}function Tx(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(sr(e,t),br(t),r&4){try{xo(3,t,t.return),Cu(3,t)}catch(y){Et(t,t.return,y)}try{xo(5,t,t.return)}catch(y){Et(t,t.return,y)}}break;case 1:sr(e,t),br(t),r&512&&n!==null&&Zi(n,n.return);break;case 5:if(sr(e,t),br(t),r&512&&n!==null&&Zi(n,n.return),t.flags&32){var s=t.stateNode;try{ko(s,"")}catch(y){Et(t,t.return,y)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,c=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{c==="input"&&i.type==="radio"&&i.name!=null&&q0(s,i),ah(c,a);var d=ah(c,i);for(a=0;a<u.length;a+=2){var h=u[a],f=u[a+1];h==="style"?J0(s,f):h==="dangerouslySetInnerHTML"?Q0(s,f):h==="children"?ko(s,f):bm(s,h,f,d)}switch(c){case"input":th(s,i);break;case"textarea":G0(s,i);break;case"select":var g=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var x=i.value;x!=null?na(s,!!i.multiple,x,!1):g!==!!i.multiple&&(i.defaultValue!=null?na(s,!!i.multiple,i.defaultValue,!0):na(s,!!i.multiple,i.multiple?[]:"",!1))}s[Oo]=i}catch(y){Et(t,t.return,y)}}break;case 6:if(sr(e,t),br(t),r&4){if(t.stateNode===null)throw Error(Z(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(y){Et(t,t.return,y)}}break;case 3:if(sr(e,t),br(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ro(e.containerInfo)}catch(y){Et(t,t.return,y)}break;case 4:sr(e,t),br(t);break;case 13:sr(e,t),br(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(ef=Nt())),r&4&&zg(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(un=(d=un)||h,sr(e,t),un=d):sr(e,t),br(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!h&&t.mode&1)for(ce=t,h=t.child;h!==null;){for(f=ce=h;ce!==null;){switch(g=ce,x=g.child,g.tag){case 0:case 11:case 14:case 15:xo(4,g,g.return);break;case 1:Zi(g,g.return);var C=g.stateNode;if(typeof C.componentWillUnmount=="function"){r=g,n=g.return;try{e=r,C.props=e.memoizedProps,C.state=e.memoizedState,C.componentWillUnmount()}catch(y){Et(r,n,y)}}break;case 5:Zi(g,g.return);break;case 22:if(g.memoizedState!==null){Wg(f);continue}}x!==null?(x.return=g,ce=x):Wg(f)}h=h.sibling}e:for(h=null,f=t;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(c=f.stateNode,u=f.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,c.style.display=Y0("display",a))}catch(y){Et(t,t.return,y)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(y){Et(t,t.return,y)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:sr(e,t),br(t),r&4&&zg(t);break;case 21:break;default:sr(e,t),br(t)}}function br(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(_x(n)){var r=n;break e}n=n.return}throw Error(Z(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(ko(s,""),r.flags&=-33);var i=Bg(t);Lh(t,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,c=Bg(t);Mh(t,c,a);break;default:throw Error(Z(161))}}catch(u){Et(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function FT(t,e,n){ce=t,Cx(t)}function Cx(t,e,n){for(var r=(t.mode&1)!==0;ce!==null;){var s=ce,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||Kl;if(!a){var c=s.alternate,u=c!==null&&c.memoizedState!==null||un;c=Kl;var d=un;if(Kl=a,(un=u)&&!d)for(ce=s;ce!==null;)a=ce,u=a.child,a.tag===22&&a.memoizedState!==null?qg(s):u!==null?(u.return=a,ce=u):qg(s);for(;i!==null;)ce=i,Cx(i),i=i.sibling;ce=s,Kl=c,un=d}Hg(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ce=i):Hg(t)}}function Hg(t){for(;ce!==null;){var e=ce;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:un||Cu(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!un)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:ir(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&kg(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}kg(e,a,n)}break;case 5:var c=e.stateNode;if(n===null&&e.flags&4){n=c;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&Ro(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Z(163))}un||e.flags&512&&Dh(e)}catch(g){Et(e,e.return,g)}}if(e===t){ce=null;break}if(n=e.sibling,n!==null){n.return=e.return,ce=n;break}ce=e.return}}function Wg(t){for(;ce!==null;){var e=ce;if(e===t){ce=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ce=n;break}ce=e.return}}function qg(t){for(;ce!==null;){var e=ce;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Cu(4,e)}catch(u){Et(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(u){Et(e,s,u)}}var i=e.return;try{Dh(e)}catch(u){Et(e,i,u)}break;case 5:var a=e.return;try{Dh(e)}catch(u){Et(e,a,u)}}}catch(u){Et(e,e.return,u)}if(e===t){ce=null;break}var c=e.sibling;if(c!==null){c.return=e.return,ce=c;break}ce=e.return}}var UT=Math.ceil,Wc=as.ReactCurrentDispatcher,Xm=as.ReactCurrentOwner,Yn=as.ReactCurrentBatchConfig,qe=0,Ut=null,It=null,Qt=0,Ln=0,ea=Js(0),jt=0,zo=null,wi=0,Nu=0,Zm=0,wo=null,En=null,ef=0,va=1/0,Fr=null,qc=!1,Oh=null,Ls=null,Ql=!1,ks=null,Gc=0,bo=0,Vh=null,hc=-1,mc=0;function vn(){return qe&6?Nt():hc!==-1?hc:hc=Nt()}function Os(t){return t.mode&1?qe&2&&Qt!==0?Qt&-Qt:TT.transition!==null?(mc===0&&(mc=cv()),mc):(t=Xe,t!==0||(t=window.event,t=t===void 0?16:gv(t.type)),t):1}function cr(t,e,n,r){if(50<bo)throw bo=0,Vh=null,Error(Z(185));sl(t,n,r),(!(qe&2)||t!==Ut)&&(t===Ut&&(!(qe&2)&&(Nu|=n),jt===4&&_s(t,Qt)),kn(t,r),n===1&&qe===0&&!(e.mode&1)&&(va=Nt()+500,_u&&Xs()))}function kn(t,e){var n=t.callbackNode;TE(t,e);var r=Ac(t,t===Ut?Qt:0);if(r===0)n!==null&&tg(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&tg(n),e===1)t.tag===0?ET(Gg.bind(null,t)):Mv(Gg.bind(null,t)),xT(function(){!(qe&6)&&Xs()}),n=null;else{switch(uv(r)){case 1:n=Nm;break;case 4:n=ov;break;case 16:n=Ic;break;case 536870912:n=lv;break;default:n=Ic}n=jx(n,Nx.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Nx(t,e){if(hc=-1,mc=0,qe&6)throw Error(Z(327));var n=t.callbackNode;if(oa()&&t.callbackNode!==n)return null;var r=Ac(t,t===Ut?Qt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Kc(t,r);else{e=r;var s=qe;qe|=2;var i=kx();(Ut!==t||Qt!==e)&&(Fr=null,va=Nt()+500,fi(t,e));do try{HT();break}catch(c){Sx(t,c)}while(1);$m(),Wc.current=i,qe=s,It!==null?e=0:(Ut=null,Qt=0,e=jt)}if(e!==0){if(e===2&&(s=dh(t),s!==0&&(r=s,e=$h(t,s))),e===1)throw n=zo,fi(t,0),_s(t,r),kn(t,Nt()),n;if(e===6)_s(t,r);else{if(s=t.current.alternate,!(r&30)&&!BT(s)&&(e=Kc(t,r),e===2&&(i=dh(t),i!==0&&(r=i,e=$h(t,i))),e===1))throw n=zo,fi(t,0),_s(t,r),kn(t,Nt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(Z(345));case 2:li(t,En,Fr);break;case 3:if(_s(t,r),(r&130023424)===r&&(e=ef+500-Nt(),10<e)){if(Ac(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){vn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=xh(li.bind(null,t,En,Fr),e);break}li(t,En,Fr);break;case 4:if(_s(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var a=31-lr(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=Nt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*UT(r/1960))-r,10<r){t.timeoutHandle=xh(li.bind(null,t,En,Fr),r);break}li(t,En,Fr);break;case 5:li(t,En,Fr);break;default:throw Error(Z(329))}}}return kn(t,Nt()),t.callbackNode===n?Nx.bind(null,t):null}function $h(t,e){var n=wo;return t.current.memoizedState.isDehydrated&&(fi(t,e).flags|=256),t=Kc(t,e),t!==2&&(e=En,En=n,e!==null&&Fh(e)),t}function Fh(t){En===null?En=t:En.push.apply(En,t)}function BT(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!dr(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function _s(t,e){for(e&=~Zm,e&=~Nu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-lr(e),r=1<<n;t[n]=-1,e&=~r}}function Gg(t){if(qe&6)throw Error(Z(327));oa();var e=Ac(t,0);if(!(e&1))return kn(t,Nt()),null;var n=Kc(t,e);if(t.tag!==0&&n===2){var r=dh(t);r!==0&&(e=r,n=$h(t,r))}if(n===1)throw n=zo,fi(t,0),_s(t,e),kn(t,Nt()),n;if(n===6)throw Error(Z(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,li(t,En,Fr),kn(t,Nt()),null}function tf(t,e){var n=qe;qe|=1;try{return t(e)}finally{qe=n,qe===0&&(va=Nt()+500,_u&&Xs())}}function bi(t){ks!==null&&ks.tag===0&&!(qe&6)&&oa();var e=qe;qe|=1;var n=Yn.transition,r=Xe;try{if(Yn.transition=null,Xe=1,t)return t()}finally{Xe=r,Yn.transition=n,qe=e,!(qe&6)&&Xs()}}function nf(){Ln=ea.current,lt(ea)}function fi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,vT(n)),It!==null)for(n=It.return;n!==null;){var r=n;switch(Lm(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Mc();break;case 3:ga(),lt(Nn),lt(hn),Wm();break;case 5:Hm(r);break;case 4:ga();break;case 13:lt(gt);break;case 19:lt(gt);break;case 10:Fm(r.type._context);break;case 22:case 23:nf()}n=n.return}if(Ut=t,It=t=Vs(t.current,null),Qt=Ln=e,jt=0,zo=null,Zm=Nu=wi=0,En=wo=null,di!==null){for(e=0;e<di.length;e++)if(n=di[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}n.pending=r}di=null}return t}function Sx(t,e){do{var n=It;try{if($m(),cc.current=Hc,zc){for(var r=yt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}zc=!1}if(xi=0,Ft=Rt=yt=null,vo=!1,Fo=0,Xm.current=null,n===null||n.return===null){jt=1,zo=e,It=null;break}e:{var i=t,a=n.return,c=n,u=e;if(e=Qt,c.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var d=u,h=c,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var g=h.alternate;g?(h.updateQueue=g.updateQueue,h.memoizedState=g.memoizedState,h.lanes=g.lanes):(h.updateQueue=null,h.memoizedState=null)}var x=Dg(a);if(x!==null){x.flags&=-257,Mg(x,a,c,i,e),x.mode&1&&jg(i,d,e),e=x,u=d;var C=e.updateQueue;if(C===null){var y=new Set;y.add(u),e.updateQueue=y}else C.add(u);break e}else{if(!(e&1)){jg(i,d,e),rf();break e}u=Error(Z(426))}}else if(ft&&c.mode&1){var k=Dg(a);if(k!==null){!(k.flags&65536)&&(k.flags|=256),Mg(k,a,c,i,e),Om(ya(u,c));break e}}i=u=ya(u,c),jt!==4&&(jt=2),wo===null?wo=[i]:wo.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var w=ux(i,u,e);Sg(i,w);break e;case 1:c=u;var b=i.type,I=i.stateNode;if(!(i.flags&128)&&(typeof b.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(Ls===null||!Ls.has(I)))){i.flags|=65536,e&=-e,i.lanes|=e;var j=dx(i,c,e);Sg(i,j);break e}}i=i.return}while(i!==null)}Ax(n)}catch(F){e=F,It===n&&n!==null&&(It=n=n.return);continue}break}while(1)}function kx(){var t=Wc.current;return Wc.current=Hc,t===null?Hc:t}function rf(){(jt===0||jt===3||jt===2)&&(jt=4),Ut===null||!(wi&268435455)&&!(Nu&268435455)||_s(Ut,Qt)}function Kc(t,e){var n=qe;qe|=2;var r=kx();(Ut!==t||Qt!==e)&&(Fr=null,fi(t,e));do try{zT();break}catch(s){Sx(t,s)}while(1);if($m(),qe=n,Wc.current=r,It!==null)throw Error(Z(261));return Ut=null,Qt=0,jt}function zT(){for(;It!==null;)Ix(It)}function HT(){for(;It!==null&&!pE();)Ix(It)}function Ix(t){var e=Rx(t.alternate,t,Ln);t.memoizedProps=t.pendingProps,e===null?Ax(t):It=e,Xm.current=null}function Ax(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=OT(n,e),n!==null){n.flags&=32767,It=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{jt=6,It=null;return}}else if(n=LT(n,e,Ln),n!==null){It=n;return}if(e=e.sibling,e!==null){It=e;return}It=e=t}while(e!==null);jt===0&&(jt=5)}function li(t,e,n){var r=Xe,s=Yn.transition;try{Yn.transition=null,Xe=1,WT(t,e,n,r)}finally{Yn.transition=s,Xe=r}return null}function WT(t,e,n,r){do oa();while(ks!==null);if(qe&6)throw Error(Z(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Z(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(CE(t,i),t===Ut&&(It=Ut=null,Qt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ql||(Ql=!0,jx(Ic,function(){return oa(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Yn.transition,Yn.transition=null;var a=Xe;Xe=1;var c=qe;qe|=4,Xm.current=null,$T(t,n),Tx(n,t),dT(yh),Pc=!!gh,yh=gh=null,t.current=n,FT(n),gE(),qe=c,Xe=a,Yn.transition=i}else t.current=n;if(Ql&&(Ql=!1,ks=t,Gc=s),i=t.pendingLanes,i===0&&(Ls=null),xE(n.stateNode),kn(t,Nt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(qc)throw qc=!1,t=Oh,Oh=null,t;return Gc&1&&t.tag!==0&&oa(),i=t.pendingLanes,i&1?t===Vh?bo++:(bo=0,Vh=t):bo=0,Xs(),null}function oa(){if(ks!==null){var t=uv(Gc),e=Yn.transition,n=Xe;try{if(Yn.transition=null,Xe=16>t?16:t,ks===null)var r=!1;else{if(t=ks,ks=null,Gc=0,qe&6)throw Error(Z(331));var s=qe;for(qe|=4,ce=t.current;ce!==null;){var i=ce,a=i.child;if(ce.flags&16){var c=i.deletions;if(c!==null){for(var u=0;u<c.length;u++){var d=c[u];for(ce=d;ce!==null;){var h=ce;switch(h.tag){case 0:case 11:case 15:xo(8,h,i)}var f=h.child;if(f!==null)f.return=h,ce=f;else for(;ce!==null;){h=ce;var g=h.sibling,x=h.return;if(bx(h),h===d){ce=null;break}if(g!==null){g.return=x,ce=g;break}ce=x}}}var C=i.alternate;if(C!==null){var y=C.child;if(y!==null){C.child=null;do{var k=y.sibling;y.sibling=null,y=k}while(y!==null)}}ce=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,ce=a;else e:for(;ce!==null;){if(i=ce,i.flags&2048)switch(i.tag){case 0:case 11:case 15:xo(9,i,i.return)}var w=i.sibling;if(w!==null){w.return=i.return,ce=w;break e}ce=i.return}}var b=t.current;for(ce=b;ce!==null;){a=ce;var I=a.child;if(a.subtreeFlags&2064&&I!==null)I.return=a,ce=I;else e:for(a=b;ce!==null;){if(c=ce,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Cu(9,c)}}catch(F){Et(c,c.return,F)}if(c===a){ce=null;break e}var j=c.sibling;if(j!==null){j.return=c.return,ce=j;break e}ce=c.return}}if(qe=s,Xs(),Nr&&typeof Nr.onPostCommitFiberRoot=="function")try{Nr.onPostCommitFiberRoot(yu,t)}catch{}r=!0}return r}finally{Xe=n,Yn.transition=e}}return!1}function Kg(t,e,n){e=ya(n,e),e=ux(t,e,1),t=Ms(t,e,1),e=vn(),t!==null&&(sl(t,1,e),kn(t,e))}function Et(t,e,n){if(t.tag===3)Kg(t,t,n);else for(;e!==null;){if(e.tag===3){Kg(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ls===null||!Ls.has(r))){t=ya(n,t),t=dx(e,t,1),e=Ms(e,t,1),t=vn(),e!==null&&(sl(e,1,t),kn(e,t));break}}e=e.return}}function qT(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=vn(),t.pingedLanes|=t.suspendedLanes&n,Ut===t&&(Qt&n)===n&&(jt===4||jt===3&&(Qt&130023424)===Qt&&500>Nt()-ef?fi(t,0):Zm|=n),kn(t,e)}function Px(t,e){e===0&&(t.mode&1?(e=$l,$l<<=1,!($l&130023424)&&($l=4194304)):e=1);var n=vn();t=Zr(t,e),t!==null&&(sl(t,e,n),kn(t,n))}function GT(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Px(t,n)}function KT(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Z(314))}r!==null&&r.delete(e),Px(t,n)}var Rx;Rx=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Nn.current)Cn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Cn=!1,MT(t,e,n);Cn=!!(t.flags&131072)}else Cn=!1,ft&&e.flags&1048576&&Lv(e,Vc,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;dc(t,e),t=e.pendingProps;var s=ma(e,hn.current);aa(e,n),s=Gm(null,e,r,t,s,n);var i=Km();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Sn(r)?(i=!0,Lc(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Bm(e),s.updater=Tu,e.stateNode=s,s._reactInternals=e,Nh(e,r,t,n),e=Ih(null,e,r,!0,i,n)):(e.tag=0,ft&&i&&Mm(e),yn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(dc(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=YT(r),t=ir(r,t),s){case 0:e=kh(null,e,r,t,n);break e;case 1:e=Vg(null,e,r,t,n);break e;case 11:e=Lg(null,e,r,t,n);break e;case 14:e=Og(null,e,r,ir(r.type,t),n);break e}throw Error(Z(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ir(r,s),kh(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ir(r,s),Vg(t,e,r,s,n);case 3:e:{if(px(e),t===null)throw Error(Z(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Bv(t,e),Uc(e,r,null,n);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=ya(Error(Z(423)),e),e=$g(t,e,r,n,s);break e}else if(r!==s){s=ya(Error(Z(424)),e),e=$g(t,e,r,n,s);break e}else for(On=Ds(e.stateNode.containerInfo.firstChild),$n=e,ft=!0,or=null,n=Fv(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(fa(),r===s){e=es(t,e,n);break e}yn(t,e,r,n)}e=e.child}return e;case 5:return zv(e),t===null&&Eh(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,a=s.children,vh(r,s)?a=null:i!==null&&vh(r,i)&&(e.flags|=32),fx(t,e),yn(t,e,a,n),e.child;case 6:return t===null&&Eh(e),null;case 13:return gx(t,e,n);case 4:return zm(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=pa(e,null,r,n):yn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ir(r,s),Lg(t,e,r,s,n);case 7:return yn(t,e,e.pendingProps,n),e.child;case 8:return yn(t,e,e.pendingProps.children,n),e.child;case 12:return yn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,rt($c,r._currentValue),r._currentValue=a,i!==null)if(dr(i.value,a)){if(i.children===s.children&&!Nn.current){e=es(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var c=i.dependencies;if(c!==null){a=i.child;for(var u=c.firstContext;u!==null;){if(u.context===r){if(i.tag===1){u=Kr(-1,n&-n),u.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?u.next=u:(u.next=h.next,h.next=u),d.pending=u}}i.lanes|=n,u=i.alternate,u!==null&&(u.lanes|=n),Th(i.return,n,e),c.lanes|=n;break}u=u.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(Z(341));a.lanes|=n,c=a.alternate,c!==null&&(c.lanes|=n),Th(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}yn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,aa(e,n),s=Xn(s),r=r(s),e.flags|=1,yn(t,e,r,n),e.child;case 14:return r=e.type,s=ir(r,e.pendingProps),s=ir(r.type,s),Og(t,e,r,s,n);case 15:return hx(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ir(r,s),dc(t,e),e.tag=1,Sn(r)?(t=!0,Lc(e)):t=!1,aa(e,n),cx(e,r,s),Nh(e,r,s,n),Ih(null,e,r,!0,t,n);case 19:return yx(t,e,n);case 22:return mx(t,e,n)}throw Error(Z(156,e.tag))};function jx(t,e){return av(t,e)}function QT(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qn(t,e,n,r){return new QT(t,e,n,r)}function sf(t){return t=t.prototype,!(!t||!t.isReactComponent)}function YT(t){if(typeof t=="function")return sf(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Em)return 11;if(t===Tm)return 14}return 2}function Vs(t,e){var n=t.alternate;return n===null?(n=Qn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function fc(t,e,n,r,s,i){var a=2;if(r=t,typeof t=="function")sf(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case Hi:return pi(n.children,s,i,e);case _m:a=8,s|=8;break;case Yd:return t=Qn(12,n,e,s|2),t.elementType=Yd,t.lanes=i,t;case Jd:return t=Qn(13,n,e,s),t.elementType=Jd,t.lanes=i,t;case Xd:return t=Qn(19,n,e,s),t.elementType=Xd,t.lanes=i,t;case z0:return Su(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case U0:a=10;break e;case B0:a=9;break e;case Em:a=11;break e;case Tm:a=14;break e;case vs:a=16,r=null;break e}throw Error(Z(130,t==null?t:typeof t,""))}return e=Qn(a,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function pi(t,e,n,r){return t=Qn(7,t,r,e),t.lanes=n,t}function Su(t,e,n,r){return t=Qn(22,t,r,e),t.elementType=z0,t.lanes=n,t.stateNode={isHidden:!1},t}function Rd(t,e,n){return t=Qn(6,t,null,e),t.lanes=n,t}function jd(t,e,n){return e=Qn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function JT(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=md(0),this.expirationTimes=md(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=md(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function af(t,e,n,r,s,i,a,c,u){return t=new JT(t,e,n,c,u),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Qn(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bm(i),t}function XT(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:zi,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Dx(t){if(!t)return Ws;t=t._reactInternals;e:{if(Ii(t)!==t||t.tag!==1)throw Error(Z(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Sn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Z(171))}if(t.tag===1){var n=t.type;if(Sn(n))return Dv(t,n,e)}return e}function Mx(t,e,n,r,s,i,a,c,u){return t=af(n,r,!0,t,s,i,a,c,u),t.context=Dx(null),n=t.current,r=vn(),s=Os(n),i=Kr(r,s),i.callback=e??null,Ms(n,i,s),t.current.lanes=s,sl(t,s,r),kn(t,r),t}function ku(t,e,n,r){var s=e.current,i=vn(),a=Os(s);return n=Dx(n),e.context===null?e.context=n:e.pendingContext=n,e=Kr(i,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Ms(s,e,a),t!==null&&(cr(t,s,a,i),lc(t,s,a)),a}function Qc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Qg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function of(t,e){Qg(t,e),(t=t.alternate)&&Qg(t,e)}function ZT(){return null}var Lx=typeof reportError=="function"?reportError:function(t){console.error(t)};function lf(t){this._internalRoot=t}Iu.prototype.render=lf.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Z(409));ku(t,e,null,null)};Iu.prototype.unmount=lf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;bi(function(){ku(null,t,null,null)}),e[Xr]=null}};function Iu(t){this._internalRoot=t}Iu.prototype.unstable_scheduleHydration=function(t){if(t){var e=mv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<bs.length&&e!==0&&e<bs[n].priority;n++);bs.splice(n,0,t),n===0&&pv(t)}};function cf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Au(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Yg(){}function eC(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=Qc(a);i.call(d)}}var a=Mx(e,r,t,0,null,!1,!1,"",Yg);return t._reactRootContainer=a,t[Xr]=a.current,Mo(t.nodeType===8?t.parentNode:t),bi(),a}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var c=r;r=function(){var d=Qc(u);c.call(d)}}var u=af(t,0,!1,null,null,!1,!1,"",Yg);return t._reactRootContainer=u,t[Xr]=u.current,Mo(t.nodeType===8?t.parentNode:t),bi(function(){ku(e,u,n,r)}),u}function Pu(t,e,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var c=s;s=function(){var u=Qc(a);c.call(u)}}ku(e,a,t,s)}else a=eC(n,e,t,s,r);return Qc(a)}dv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=so(e.pendingLanes);n!==0&&(Sm(e,n|1),kn(e,Nt()),!(qe&6)&&(va=Nt()+500,Xs()))}break;case 13:bi(function(){var r=Zr(t,1);if(r!==null){var s=vn();cr(r,t,1,s)}}),of(t,1)}};km=function(t){if(t.tag===13){var e=Zr(t,134217728);if(e!==null){var n=vn();cr(e,t,134217728,n)}of(t,134217728)}};hv=function(t){if(t.tag===13){var e=Os(t),n=Zr(t,e);if(n!==null){var r=vn();cr(n,t,e,r)}of(t,e)}};mv=function(){return Xe};fv=function(t,e){var n=Xe;try{return Xe=t,e()}finally{Xe=n}};lh=function(t,e,n){switch(e){case"input":if(th(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=bu(r);if(!s)throw Error(Z(90));W0(r),th(r,s)}}}break;case"textarea":G0(t,n);break;case"select":e=n.value,e!=null&&na(t,!!n.multiple,e,!1)}};ev=tf;tv=bi;var tC={usingClientEntryPoint:!1,Events:[al,Ki,bu,X0,Z0,tf]},eo={findFiberByHostInstance:ui,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nC={bundleType:eo.bundleType,version:eo.version,rendererPackageName:eo.rendererPackageName,rendererConfig:eo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:as.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=sv(t),t===null?null:t.stateNode},findFiberByHostInstance:eo.findFiberByHostInstance||ZT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yl.isDisabled&&Yl.supportsFiber)try{yu=Yl.inject(nC),Nr=Yl}catch{}}Un.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tC;Un.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!cf(e))throw Error(Z(200));return XT(t,e,null,n)};Un.createRoot=function(t,e){if(!cf(t))throw Error(Z(299));var n=!1,r="",s=Lx;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=af(t,1,!1,null,null,n,!1,r,s),t[Xr]=e.current,Mo(t.nodeType===8?t.parentNode:t),new lf(e)};Un.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Z(188)):(t=Object.keys(t).join(","),Error(Z(268,t)));return t=sv(e),t=t===null?null:t.stateNode,t};Un.flushSync=function(t){return bi(t)};Un.hydrate=function(t,e,n){if(!Au(e))throw Error(Z(200));return Pu(null,t,e,!0,n)};Un.hydrateRoot=function(t,e,n){if(!cf(t))throw Error(Z(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",a=Lx;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=Mx(e,null,t,1,n??null,s,!1,i,a),t[Xr]=e.current,Mo(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Iu(e)};Un.render=function(t,e,n){if(!Au(e))throw Error(Z(200));return Pu(null,t,e,!1,n)};Un.unmountComponentAtNode=function(t){if(!Au(t))throw Error(Z(40));return t._reactRootContainer?(bi(function(){Pu(null,null,t,!1,function(){t._reactRootContainer=null,t[Xr]=null})}),!0):!1};Un.unstable_batchedUpdates=tf;Un.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Au(n))throw Error(Z(200));if(t==null||t._reactInternals===void 0)throw Error(Z(38));return Pu(t,e,n,!1,r)};Un.version="18.3.1-next-f1338f8080-20240426";function Ox(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Ox)}catch(t){console.error(t)}}Ox(),O0.exports=Un;var rC=O0.exports,Jg=rC;Kd.createRoot=Jg.createRoot,Kd.hydrateRoot=Jg.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ho(){return Ho=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Ho.apply(this,arguments)}var Is;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Is||(Is={}));const Xg="popstate";function sC(t){t===void 0&&(t={});function e(r,s){let{pathname:i,search:a,hash:c}=r.location;return Uh("",{pathname:i,search:a,hash:c},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:Yc(s)}return aC(e,n,null,t)}function St(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Vx(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function iC(){return Math.random().toString(36).substr(2,8)}function Zg(t,e){return{usr:t.state,key:t.key,idx:e}}function Uh(t,e,n,r){return n===void 0&&(n=null),Ho({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Aa(e):e,{state:n,key:e&&e.key||r||iC()})}function Yc(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Aa(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function aC(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,c=Is.Pop,u=null,d=h();d==null&&(d=0,a.replaceState(Ho({},a.state,{idx:d}),""));function h(){return(a.state||{idx:null}).idx}function f(){c=Is.Pop;let k=h(),w=k==null?null:k-d;d=k,u&&u({action:c,location:y.location,delta:w})}function g(k,w){c=Is.Push;let b=Uh(y.location,k,w);n&&n(b,k),d=h()+1;let I=Zg(b,d),j=y.createHref(b);try{a.pushState(I,"",j)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;s.location.assign(j)}i&&u&&u({action:c,location:y.location,delta:1})}function x(k,w){c=Is.Replace;let b=Uh(y.location,k,w);n&&n(b,k),d=h();let I=Zg(b,d),j=y.createHref(b);a.replaceState(I,"",j),i&&u&&u({action:c,location:y.location,delta:0})}function C(k){let w=s.location.origin!=="null"?s.location.origin:s.location.href,b=typeof k=="string"?k:Yc(k);return b=b.replace(/ $/,"%20"),St(w,"No window.location.(origin|href) available to create URL for href: "+b),new URL(b,w)}let y={get action(){return c},get location(){return t(s,a)},listen(k){if(u)throw new Error("A history only accepts one active listener");return s.addEventListener(Xg,f),u=k,()=>{s.removeEventListener(Xg,f),u=null}},createHref(k){return e(s,k)},createURL:C,encodeLocation(k){let w=C(k);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:g,replace:x,go(k){return a.go(k)}};return y}var ey;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(ey||(ey={}));function oC(t,e,n){return n===void 0&&(n="/"),lC(t,e,n,!1)}function lC(t,e,n,r){let s=typeof e=="string"?Aa(e):e,i=uf(s.pathname||"/",n);if(i==null)return null;let a=$x(t);cC(a);let c=null;for(let u=0;c==null&&u<a.length;++u){let d=wC(i);c=vC(a[u],d,r)}return c}function $x(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(i,a,c)=>{let u={relativePath:c===void 0?i.path||"":c,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};u.relativePath.startsWith("/")&&(St(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=$s([r,u.relativePath]),h=n.concat(u);i.children&&i.children.length>0&&(St(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),$x(i.children,e,h,d)),!(i.path==null&&!i.index)&&e.push({path:d,score:gC(d,i.index),routesMeta:h})};return t.forEach((i,a)=>{var c;if(i.path===""||!((c=i.path)!=null&&c.includes("?")))s(i,a);else for(let u of Fx(i.path))s(i,a,u)}),e}function Fx(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let a=Fx(r.join("/")),c=[];return c.push(...a.map(u=>u===""?i:[i,u].join("/"))),s&&c.push(...a),c.map(u=>t.startsWith("/")&&u===""?"/":u)}function cC(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:yC(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const uC=/^:[\w-]+$/,dC=3,hC=2,mC=1,fC=10,pC=-2,ty=t=>t==="*";function gC(t,e){let n=t.split("/"),r=n.length;return n.some(ty)&&(r+=pC),e&&(r+=hC),n.filter(s=>!ty(s)).reduce((s,i)=>s+(uC.test(i)?dC:i===""?mC:fC),r)}function yC(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function vC(t,e,n){n===void 0&&(n=!1);let{routesMeta:r}=t,s={},i="/",a=[];for(let c=0;c<r.length;++c){let u=r[c],d=c===r.length-1,h=i==="/"?e:e.slice(i.length)||"/",f=ny({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},h),g=u.route;if(!f&&d&&n&&!r[r.length-1].route.index&&(f=ny({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},h)),!f)return null;Object.assign(s,f.params),a.push({params:s,pathname:$s([i,f.pathname]),pathnameBase:TC($s([i,f.pathnameBase])),route:g}),f.pathnameBase!=="/"&&(i=$s([i,f.pathnameBase]))}return a}function ny(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=xC(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),c=s.slice(1);return{params:r.reduce((d,h,f)=>{let{paramName:g,isOptional:x}=h;if(g==="*"){let y=c[f]||"";a=i.slice(0,i.length-y.length).replace(/(.)\/+$/,"$1")}const C=c[f];return x&&!C?d[g]=void 0:d[g]=(C||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:a,pattern:t}}function xC(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Vx(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,c,u)=>(r.push({paramName:c,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function wC(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Vx(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function uf(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function bC(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Aa(t):t;return{pathname:n?n.startsWith("/")?n:_C(n,e):e,search:CC(r),hash:NC(s)}}function _C(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function Dd(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function EC(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function df(t,e){let n=EC(t);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function hf(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=Aa(t):(s=Ho({},t),St(!s.pathname||!s.pathname.includes("?"),Dd("?","pathname","search",s)),St(!s.pathname||!s.pathname.includes("#"),Dd("#","pathname","hash",s)),St(!s.search||!s.search.includes("#"),Dd("#","search","hash",s)));let i=t===""||s.pathname==="",a=i?"/":s.pathname,c;if(a==null)c=n;else{let f=e.length-1;if(!r&&a.startsWith("..")){let g=a.split("/");for(;g[0]==="..";)g.shift(),f-=1;s.pathname=g.join("/")}c=f>=0?e[f]:"/"}let u=bC(s,c),d=a&&a!=="/"&&a.endsWith("/"),h=(i||a===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(d||h)&&(u.pathname+="/"),u}const $s=t=>t.join("/").replace(/\/\/+/g,"/"),TC=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),CC=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,NC=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function SC(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Ux=["post","put","patch","delete"];new Set(Ux);const kC=["get",...Ux];new Set(kC);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wo(){return Wo=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Wo.apply(this,arguments)}const mf=P.createContext(null),IC=P.createContext(null),Zs=P.createContext(null),Ru=P.createContext(null),os=P.createContext({outlet:null,matches:[],isDataRoute:!1}),Bx=P.createContext(null);function AC(t,e){let{relative:n}=e===void 0?{}:e;Pa()||St(!1);let{basename:r,navigator:s}=P.useContext(Zs),{hash:i,pathname:a,search:c}=Hx(t,{relative:n}),u=a;return r!=="/"&&(u=a==="/"?r:$s([r,a])),s.createHref({pathname:u,search:c,hash:i})}function Pa(){return P.useContext(Ru)!=null}function ei(){return Pa()||St(!1),P.useContext(Ru).location}function zx(t){P.useContext(Zs).static||P.useLayoutEffect(t)}function er(){let{isDataRoute:t}=P.useContext(os);return t?zC():PC()}function PC(){Pa()||St(!1);let t=P.useContext(mf),{basename:e,future:n,navigator:r}=P.useContext(Zs),{matches:s}=P.useContext(os),{pathname:i}=ei(),a=JSON.stringify(df(s,n.v7_relativeSplatPath)),c=P.useRef(!1);return zx(()=>{c.current=!0}),P.useCallback(function(d,h){if(h===void 0&&(h={}),!c.current)return;if(typeof d=="number"){r.go(d);return}let f=hf(d,JSON.parse(a),i,h.relative==="path");t==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:$s([e,f.pathname])),(h.replace?r.replace:r.push)(f,h.state,h)},[e,r,a,i,t])}function ff(){let{matches:t}=P.useContext(os),e=t[t.length-1];return e?e.params:{}}function Hx(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=P.useContext(Zs),{matches:s}=P.useContext(os),{pathname:i}=ei(),a=JSON.stringify(df(s,r.v7_relativeSplatPath));return P.useMemo(()=>hf(t,JSON.parse(a),i,n==="path"),[t,a,i,n])}function RC(t,e){return jC(t,e)}function jC(t,e,n,r){Pa()||St(!1);let{navigator:s}=P.useContext(Zs),{matches:i}=P.useContext(os),a=i[i.length-1],c=a?a.params:{};a&&a.pathname;let u=a?a.pathnameBase:"/";a&&a.route;let d=ei(),h;if(e){var f;let k=typeof e=="string"?Aa(e):e;u==="/"||(f=k.pathname)!=null&&f.startsWith(u)||St(!1),h=k}else h=d;let g=h.pathname||"/",x=g;if(u!=="/"){let k=u.replace(/^\//,"").split("/");x="/"+g.replace(/^\//,"").split("/").slice(k.length).join("/")}let C=oC(t,{pathname:x}),y=VC(C&&C.map(k=>Object.assign({},k,{params:Object.assign({},c,k.params),pathname:$s([u,s.encodeLocation?s.encodeLocation(k.pathname).pathname:k.pathname]),pathnameBase:k.pathnameBase==="/"?u:$s([u,s.encodeLocation?s.encodeLocation(k.pathnameBase).pathname:k.pathnameBase])})),i,n,r);return e&&y?P.createElement(Ru.Provider,{value:{location:Wo({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Is.Pop}},y):y}function DC(){let t=BC(),e=SC(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return P.createElement(P.Fragment,null,P.createElement("h2",null,"Unexpected Application Error!"),P.createElement("h3",{style:{fontStyle:"italic"}},e),n?P.createElement("pre",{style:s},n):null,i)}const MC=P.createElement(DC,null);class LC extends P.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?P.createElement(os.Provider,{value:this.props.routeContext},P.createElement(Bx.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function OC(t){let{routeContext:e,match:n,children:r}=t,s=P.useContext(mf);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),P.createElement(os.Provider,{value:e},r)}function VC(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var i;if(!n)return null;if(n.errors)t=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let a=t,c=(s=n)==null?void 0:s.errors;if(c!=null){let h=a.findIndex(f=>f.route.id&&(c==null?void 0:c[f.route.id])!==void 0);h>=0||St(!1),a=a.slice(0,Math.min(a.length,h+1))}let u=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let h=0;h<a.length;h++){let f=a[h];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(d=h),f.route.id){let{loaderData:g,errors:x}=n,C=f.route.loader&&g[f.route.id]===void 0&&(!x||x[f.route.id]===void 0);if(f.route.lazy||C){u=!0,d>=0?a=a.slice(0,d+1):a=[a[0]];break}}}return a.reduceRight((h,f,g)=>{let x,C=!1,y=null,k=null;n&&(x=c&&f.route.id?c[f.route.id]:void 0,y=f.route.errorElement||MC,u&&(d<0&&g===0?(HC("route-fallback",!1),C=!0,k=null):d===g&&(C=!0,k=f.route.hydrateFallbackElement||null)));let w=e.concat(a.slice(0,g+1)),b=()=>{let I;return x?I=y:C?I=k:f.route.Component?I=P.createElement(f.route.Component,null):f.route.element?I=f.route.element:I=h,P.createElement(OC,{match:f,routeContext:{outlet:h,matches:w,isDataRoute:n!=null},children:I})};return n&&(f.route.ErrorBoundary||f.route.errorElement||g===0)?P.createElement(LC,{location:n.location,revalidation:n.revalidation,component:y,error:x,children:b(),routeContext:{outlet:null,matches:w,isDataRoute:!0}}):b()},null)}var Wx=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Wx||{}),Jc=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Jc||{});function $C(t){let e=P.useContext(mf);return e||St(!1),e}function FC(t){let e=P.useContext(IC);return e||St(!1),e}function UC(t){let e=P.useContext(os);return e||St(!1),e}function qx(t){let e=UC(),n=e.matches[e.matches.length-1];return n.route.id||St(!1),n.route.id}function BC(){var t;let e=P.useContext(Bx),n=FC(Jc.UseRouteError),r=qx(Jc.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function zC(){let{router:t}=$C(Wx.UseNavigateStable),e=qx(Jc.UseNavigateStable),n=P.useRef(!1);return zx(()=>{n.current=!0}),P.useCallback(function(s,i){i===void 0&&(i={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,Wo({fromRouteId:e},i)))},[t,e])}const ry={};function HC(t,e,n){!e&&!ry[t]&&(ry[t]=!0)}function WC(t,e){t==null||t.v7_startTransition,(t==null?void 0:t.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function Gx(t){let{to:e,replace:n,state:r,relative:s}=t;Pa()||St(!1);let{future:i,static:a}=P.useContext(Zs),{matches:c}=P.useContext(os),{pathname:u}=ei(),d=er(),h=hf(e,df(c,i.v7_relativeSplatPath),u,s==="path"),f=JSON.stringify(h);return P.useEffect(()=>d(JSON.parse(f),{replace:n,state:r,relative:s}),[d,f,s,n,r]),null}function Mn(t){St(!1)}function qC(t){let{basename:e="/",children:n=null,location:r,navigationType:s=Is.Pop,navigator:i,static:a=!1,future:c}=t;Pa()&&St(!1);let u=e.replace(/^\/*/,"/"),d=P.useMemo(()=>({basename:u,navigator:i,static:a,future:Wo({v7_relativeSplatPath:!1},c)}),[u,c,i,a]);typeof r=="string"&&(r=Aa(r));let{pathname:h="/",search:f="",hash:g="",state:x=null,key:C="default"}=r,y=P.useMemo(()=>{let k=uf(h,u);return k==null?null:{location:{pathname:k,search:f,hash:g,state:x,key:C},navigationType:s}},[u,h,f,g,x,C,s]);return y==null?null:P.createElement(Zs.Provider,{value:d},P.createElement(Ru.Provider,{children:n,value:y}))}function GC(t){let{children:e,location:n}=t;return RC(Bh(e),n)}new Promise(()=>{});function Bh(t,e){e===void 0&&(e=[]);let n=[];return P.Children.forEach(t,(r,s)=>{if(!P.isValidElement(r))return;let i=[...e,s];if(r.type===P.Fragment){n.push.apply(n,Bh(r.props.children,i));return}r.type!==Mn&&St(!1),!r.props.index||!r.props.children||St(!1);let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Bh(r.props.children,i)),n.push(a)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function zh(){return zh=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},zh.apply(this,arguments)}function KC(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function QC(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function YC(t,e){return t.button===0&&(!e||e==="_self")&&!QC(t)}const JC=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],XC="6";try{window.__reactRouterVersion=XC}catch{}const ZC="startTransition",sy=q_[ZC];function e1(t){let{basename:e,children:n,future:r,window:s}=t,i=P.useRef();i.current==null&&(i.current=sC({window:s,v5Compat:!0}));let a=i.current,[c,u]=P.useState({action:a.action,location:a.location}),{v7_startTransition:d}=r||{},h=P.useCallback(f=>{d&&sy?sy(()=>u(f)):u(f)},[u,d]);return P.useLayoutEffect(()=>a.listen(h),[a,h]),P.useEffect(()=>WC(r),[r]),P.createElement(qC,{basename:e,children:n,location:c.location,navigationType:c.action,navigator:a,future:r})}const t1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",n1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Er=P.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:i,replace:a,state:c,target:u,to:d,preventScrollReset:h,viewTransition:f}=e,g=KC(e,JC),{basename:x}=P.useContext(Zs),C,y=!1;if(typeof d=="string"&&n1.test(d)&&(C=d,t1))try{let I=new URL(window.location.href),j=d.startsWith("//")?new URL(I.protocol+d):new URL(d),F=uf(j.pathname,x);j.origin===I.origin&&F!=null?d=F+j.search+j.hash:y=!0}catch{}let k=AC(d,{relative:s}),w=r1(d,{replace:a,state:c,target:u,preventScrollReset:h,relative:s,viewTransition:f});function b(I){r&&r(I),I.defaultPrevented||w(I)}return P.createElement("a",zh({},g,{href:C||k,onClick:y||i?r:b,ref:n,target:u}))});var iy;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(iy||(iy={}));var ay;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(ay||(ay={}));function r1(t,e){let{target:n,replace:r,state:s,preventScrollReset:i,relative:a,viewTransition:c}=e===void 0?{}:e,u=er(),d=ei(),h=Hx(t,{relative:a});return P.useCallback(f=>{if(YC(f,n)){f.preventDefault();let g=r!==void 0?r:Yc(d)===Yc(h);u(t,{replace:g,state:s,preventScrollReset:i,relative:a,viewTransition:c})}},[d,u,h,r,s,n,t,i,a,c])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kx=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},s1=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],a=t[n++],c=t[n++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=t[n++],a=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},Qx={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],a=s+1<t.length,c=a?t[s+1]:0,u=s+2<t.length,d=u?t[s+2]:0,h=i>>2,f=(i&3)<<4|c>>4;let g=(c&15)<<2|d>>6,x=d&63;u||(x=64,a||(g=64)),r.push(n[h],n[f],n[g],n[x])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Kx(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):s1(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],c=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const f=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||c==null||d==null||f==null)throw new i1;const g=i<<2|c>>4;if(r.push(g),d!==64){const x=c<<4&240|d>>2;if(r.push(x),f!==64){const C=d<<6&192|f;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class i1 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a1=function(t){const e=Kx(t);return Qx.encodeByteArray(e,!0)},Xc=function(t){return a1(t).replace(/\./g,"")},Yx=function(t){try{return Qx.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o1(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l1=()=>o1().__FIREBASE_DEFAULTS__,c1=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},u1=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Yx(t[1]);return e&&JSON.parse(e)},ju=()=>{try{return l1()||c1()||u1()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Jx=t=>{var e,n;return(n=(e=ju())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},d1=t=>{const e=Jx(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Xx=()=>{var t;return(t=ju())===null||t===void 0?void 0:t.config},Zx=t=>{var e;return(e=ju())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h1{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m1(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t),c="";return[Xc(JSON.stringify(n)),Xc(JSON.stringify(a)),c].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function f1(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(mn())}function p1(){var t;const e=(t=ju())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function g1(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function y1(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function v1(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function x1(){const t=mn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function w1(){return!p1()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function b1(){try{return typeof indexedDB=="object"}catch{return!1}}function _1(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E1="FirebaseError";class ls extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=E1,Object.setPrototypeOf(this,ls.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ll.prototype.create)}}class ll{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?T1(i,r):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new ls(s,c,r)}}function T1(t,e){return t.replace(C1,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const C1=/\{\$([^}]+)}/g;function N1(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Zc(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],a=e[s];if(oy(i)&&oy(a)){if(!Zc(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function oy(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cl(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function ao(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function oo(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function S1(t,e){const n=new k1(t,e);return n.subscribe.bind(n)}class k1{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");I1(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Md),s.error===void 0&&(s.error=Md),s.complete===void 0&&(s.complete=Md);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function I1(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Md(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pt(t){return t&&t._delegate?t._delegate:t}class _i{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ci="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A1{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new h1;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(R1(e))try{this.getOrInitializeService({instanceIdentifier:ci})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ci){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ci){return this.instances.has(e)}getOptions(e=ci){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);r===c&&a.resolve(s)}return s}onInit(e,n){var r;const s=this.normalizeInstanceIdentifier(n),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const a=this.instances.get(s);return a&&e(a,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:P1(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ci){return this.component?this.component.multipleInstances?e:ci:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function P1(t){return t===ci?void 0:t}function R1(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j1{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new A1(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ze;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(ze||(ze={}));const D1={debug:ze.DEBUG,verbose:ze.VERBOSE,info:ze.INFO,warn:ze.WARN,error:ze.ERROR,silent:ze.SILENT},M1=ze.INFO,L1={[ze.DEBUG]:"log",[ze.VERBOSE]:"log",[ze.INFO]:"info",[ze.WARN]:"warn",[ze.ERROR]:"error"},O1=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=L1[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class pf{constructor(e){this.name=e,this._logLevel=M1,this._logHandler=O1,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ze))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?D1[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ze.DEBUG,...e),this._logHandler(this,ze.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ze.VERBOSE,...e),this._logHandler(this,ze.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ze.INFO,...e),this._logHandler(this,ze.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ze.WARN,...e),this._logHandler(this,ze.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ze.ERROR,...e),this._logHandler(this,ze.ERROR,...e)}}const V1=(t,e)=>e.some(n=>t instanceof n);let ly,cy;function $1(){return ly||(ly=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function F1(){return cy||(cy=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ew=new WeakMap,Hh=new WeakMap,tw=new WeakMap,Ld=new WeakMap,gf=new WeakMap;function U1(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",a)},i=()=>{n(Fs(t.result)),s()},a=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",a)});return e.then(n=>{n instanceof IDBCursor&&ew.set(n,t)}).catch(()=>{}),gf.set(e,t),e}function B1(t){if(Hh.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",a),t.removeEventListener("abort",a)},i=()=>{n(),s()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",a),t.addEventListener("abort",a)});Hh.set(t,e)}let Wh={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Hh.get(t);if(e==="objectStoreNames")return t.objectStoreNames||tw.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Fs(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function z1(t){Wh=t(Wh)}function H1(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Od(this),e,...n);return tw.set(r,e.sort?e.sort():[e]),Fs(r)}:F1().includes(t)?function(...e){return t.apply(Od(this),e),Fs(ew.get(this))}:function(...e){return Fs(t.apply(Od(this),e))}}function W1(t){return typeof t=="function"?H1(t):(t instanceof IDBTransaction&&B1(t),V1(t,$1())?new Proxy(t,Wh):t)}function Fs(t){if(t instanceof IDBRequest)return U1(t);if(Ld.has(t))return Ld.get(t);const e=W1(t);return e!==t&&(Ld.set(t,e),gf.set(e,t)),e}const Od=t=>gf.get(t);function q1(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(t,e),c=Fs(a);return r&&a.addEventListener("upgradeneeded",u=>{r(Fs(a.result),u.oldVersion,u.newVersion,Fs(a.transaction),u)}),n&&a.addEventListener("blocked",u=>n(u.oldVersion,u.newVersion,u)),c.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const G1=["get","getKey","getAll","getAllKeys","count"],K1=["put","add","delete","clear"],Vd=new Map;function uy(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Vd.get(e))return Vd.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=K1.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||G1.includes(n)))return;const i=async function(a,...c){const u=this.transaction(a,s?"readwrite":"readonly");let d=u.store;return r&&(d=d.index(c.shift())),(await Promise.all([d[n](...c),s&&u.done]))[0]};return Vd.set(e,i),i}z1(t=>({...t,get:(e,n,r)=>uy(e,n)||t.get(e,n,r),has:(e,n)=>!!uy(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q1{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Y1(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function Y1(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const qh="@firebase/app",dy="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ts=new pf("@firebase/app"),J1="@firebase/app-compat",X1="@firebase/analytics-compat",Z1="@firebase/analytics",eN="@firebase/app-check-compat",tN="@firebase/app-check",nN="@firebase/auth",rN="@firebase/auth-compat",sN="@firebase/database",iN="@firebase/data-connect",aN="@firebase/database-compat",oN="@firebase/functions",lN="@firebase/functions-compat",cN="@firebase/installations",uN="@firebase/installations-compat",dN="@firebase/messaging",hN="@firebase/messaging-compat",mN="@firebase/performance",fN="@firebase/performance-compat",pN="@firebase/remote-config",gN="@firebase/remote-config-compat",yN="@firebase/storage",vN="@firebase/storage-compat",xN="@firebase/firestore",wN="@firebase/vertexai-preview",bN="@firebase/firestore-compat",_N="firebase",EN="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gh="[DEFAULT]",TN={[qh]:"fire-core",[J1]:"fire-core-compat",[Z1]:"fire-analytics",[X1]:"fire-analytics-compat",[tN]:"fire-app-check",[eN]:"fire-app-check-compat",[nN]:"fire-auth",[rN]:"fire-auth-compat",[sN]:"fire-rtdb",[iN]:"fire-data-connect",[aN]:"fire-rtdb-compat",[oN]:"fire-fn",[lN]:"fire-fn-compat",[cN]:"fire-iid",[uN]:"fire-iid-compat",[dN]:"fire-fcm",[hN]:"fire-fcm-compat",[mN]:"fire-perf",[fN]:"fire-perf-compat",[pN]:"fire-rc",[gN]:"fire-rc-compat",[yN]:"fire-gcs",[vN]:"fire-gcs-compat",[xN]:"fire-fst",[bN]:"fire-fst-compat",[wN]:"fire-vertex","fire-js":"fire-js",[_N]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eu=new Map,CN=new Map,Kh=new Map;function hy(t,e){try{t.container.addComponent(e)}catch(n){ts.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function xa(t){const e=t.name;if(Kh.has(e))return ts.debug(`There were multiple attempts to register component ${e}.`),!1;Kh.set(e,t);for(const n of eu.values())hy(n,t);for(const n of CN.values())hy(n,t);return!0}function yf(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Cr(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NN={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Us=new ll("app","Firebase",NN);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SN{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new _i("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Us.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ra=EN;function nw(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Gh,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Us.create("bad-app-name",{appName:String(s)});if(n||(n=Xx()),!n)throw Us.create("no-options");const i=eu.get(s);if(i){if(Zc(n,i.options)&&Zc(r,i.config))return i;throw Us.create("duplicate-app",{appName:s})}const a=new j1(s);for(const u of Kh.values())a.addComponent(u);const c=new SN(n,r,a);return eu.set(s,c),c}function rw(t=Gh){const e=eu.get(t);if(!e&&t===Gh&&Xx())return nw();if(!e)throw Us.create("no-app",{appName:t});return e}function Bs(t,e,n){var r;let s=(r=TN[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const c=[`Unable to register library "${s}" with version "${e}":`];i&&c.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&a&&c.push("and"),a&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ts.warn(c.join(" "));return}xa(new _i(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kN="firebase-heartbeat-database",IN=1,qo="firebase-heartbeat-store";let $d=null;function sw(){return $d||($d=q1(kN,IN,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(qo)}catch(n){console.warn(n)}}}}).catch(t=>{throw Us.create("idb-open",{originalErrorMessage:t.message})})),$d}async function AN(t){try{const n=(await sw()).transaction(qo),r=await n.objectStore(qo).get(iw(t));return await n.done,r}catch(e){if(e instanceof ls)ts.warn(e.message);else{const n=Us.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ts.warn(n.message)}}}async function my(t,e){try{const r=(await sw()).transaction(qo,"readwrite");await r.objectStore(qo).put(e,iw(t)),await r.done}catch(n){if(n instanceof ls)ts.warn(n.message);else{const r=Us.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});ts.warn(r.message)}}}function iw(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PN=1024,RN=30*24*60*60*1e3;class jN{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new MN(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=fy();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const c=new Date(a.date).valueOf();return Date.now()-c<=RN}),this._storage.overwrite(this._heartbeatsCache))}catch(r){ts.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=fy(),{heartbeatsToSend:r,unsentEntries:s}=DN(this._heartbeatsCache.heartbeats),i=Xc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return ts.warn(n),""}}}function fy(){return new Date().toISOString().substring(0,10)}function DN(t,e=PN){const n=[];let r=t.slice();for(const s of t){const i=n.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),py(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),py(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class MN{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return b1()?_1().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await AN(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return my(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return my(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function py(t){return Xc(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LN(t){xa(new _i("platform-logger",e=>new Q1(e),"PRIVATE")),xa(new _i("heartbeat",e=>new jN(e),"PRIVATE")),Bs(qh,dy,t),Bs(qh,dy,"esm2017"),Bs("fire-js","")}LN("");function vf(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function aw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ON=aw,ow=new ll("auth","Firebase",aw());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tu=new pf("@firebase/auth");function VN(t,...e){tu.logLevel<=ze.WARN&&tu.warn(`Auth (${Ra}): ${t}`,...e)}function pc(t,...e){tu.logLevel<=ze.ERROR&&tu.error(`Auth (${Ra}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hr(t,...e){throw xf(t,...e)}function kr(t,...e){return xf(t,...e)}function lw(t,e,n){const r=Object.assign(Object.assign({},ON()),{[e]:n});return new ll("auth","Firebase",r).create(e,{appName:t.name})}function Qr(t){return lw(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function xf(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return ow.create(t,...e)}function Ce(t,e,...n){if(!t)throw xf(e,...n)}function Wr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw pc(e),new Error(e)}function ns(t,e){t||Wr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qh(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function $N(){return gy()==="http:"||gy()==="https:"}function gy(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FN(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&($N()||y1()||"connection"in navigator)?navigator.onLine:!0}function UN(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ul{constructor(e,n){this.shortDelay=e,this.longDelay=n,ns(n>e,"Short delay should be less than long delay!"),this.isMobile=f1()||v1()}get(){return FN()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wf(t,e){ns(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Wr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Wr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Wr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BN={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zN=new ul(3e4,6e4);function cs(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function us(t,e,n,r,s={}){return uw(t,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const c=cl(Object.assign({key:t.config.apiKey},a)).slice(1),u=await t._getAdditionalHeaders();u["Content-Type"]="application/json",t.languageCode&&(u["X-Firebase-Locale"]=t.languageCode);const d=Object.assign({method:e,headers:u},i);return g1()||(d.referrerPolicy="no-referrer"),cw.fetch()(dw(t,t.config.apiHost,n,c),d)})}async function uw(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},BN),e);try{const s=new WN(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Jl(t,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const c=i.ok?a.errorMessage:a.error.message,[u,d]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Jl(t,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw Jl(t,"email-already-in-use",a);if(u==="USER_DISABLED")throw Jl(t,"user-disabled",a);const h=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw lw(t,h,d);hr(t,h)}}catch(s){if(s instanceof ls)throw s;hr(t,"network-request-failed",{message:String(s)})}}async function dl(t,e,n,r,s={}){const i=await us(t,e,n,r,s);return"mfaPendingCredential"in i&&hr(t,"multi-factor-auth-required",{_serverResponse:i}),i}function dw(t,e,n,r){const s=`${e}${n}?${r}`;return t.config.emulator?wf(t.config,s):`${t.config.apiScheme}://${s}`}function HN(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class WN{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(kr(this.auth,"network-request-failed")),zN.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Jl(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=kr(t,e,r);return s.customData._tokenResponse=n,s}function yy(t){return t!==void 0&&t.enterprise!==void 0}class qN{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return HN(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function GN(t,e){return us(t,"GET","/v2/recaptchaConfig",cs(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KN(t,e){return us(t,"POST","/v1/accounts:delete",e)}async function hw(t,e){return us(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _o(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function QN(t,e=!1){const n=Pt(t),r=await n.getIdToken(e),s=bf(r);Ce(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:_o(Fd(s.auth_time)),issuedAtTime:_o(Fd(s.iat)),expirationTime:_o(Fd(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Fd(t){return Number(t)*1e3}function bf(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return pc("JWT malformed, contained fewer than 3 sections"),null;try{const s=Yx(n);return s?JSON.parse(s):(pc("Failed to decode base64 JWT payload"),null)}catch(s){return pc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function vy(t){const e=bf(t);return Ce(e,"internal-error"),Ce(typeof e.exp<"u","internal-error"),Ce(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Go(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof ls&&YN(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function YN({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JN{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yh{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=_o(this.lastLoginAt),this.creationTime=_o(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nu(t){var e;const n=t.auth,r=await t.getIdToken(),s=await Go(t,hw(n,{idToken:r}));Ce(s==null?void 0:s.users.length,n,"internal-error");const i=s.users[0];t._notifyReloadListener(i);const a=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?mw(i.providerUserInfo):[],c=ZN(t.providerData,a),u=t.isAnonymous,d=!(t.email&&i.passwordHash)&&!(c!=null&&c.length),h=u?d:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new Yh(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(t,f)}async function XN(t){const e=Pt(t);await nu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function ZN(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function mw(t){return t.map(e=>{var{providerId:n}=e,r=vf(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eS(t,e){const n=await uw(t,{},async()=>{const r=cl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,a=dw(t,s,"/v1/token",`key=${i}`),c=await t._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",cw.fetch()(a,{method:"POST",headers:c,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function tS(t,e){return us(t,"POST","/v2/accounts:revokeToken",cs(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ce(e.idToken,"internal-error"),Ce(typeof e.idToken<"u","internal-error"),Ce(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):vy(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ce(e.length!==0,"internal-error");const n=vy(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ce(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await eS(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,a=new la;return r&&(Ce(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(Ce(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(Ce(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new la,this.toJSON())}_performRefresh(){return Wr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ys(t,e){Ce(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class qr{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,i=vf(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new JN(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Yh(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Go(this,this.stsTokenManager.getToken(this.auth,e));return Ce(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return QN(this,e)}reload(){return XN(this)}_assign(e){this!==e&&(Ce(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new qr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){Ce(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await nu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Cr(this.auth.app))return Promise.reject(Qr(this.auth));const e=await this.getIdToken();return await Go(this,KN(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,i,a,c,u,d,h;const f=(r=n.displayName)!==null&&r!==void 0?r:void 0,g=(s=n.email)!==null&&s!==void 0?s:void 0,x=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,C=(a=n.photoURL)!==null&&a!==void 0?a:void 0,y=(c=n.tenantId)!==null&&c!==void 0?c:void 0,k=(u=n._redirectEventId)!==null&&u!==void 0?u:void 0,w=(d=n.createdAt)!==null&&d!==void 0?d:void 0,b=(h=n.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:I,emailVerified:j,isAnonymous:F,providerData:q,stsTokenManager:E}=n;Ce(I&&E,e,"internal-error");const _=la.fromJSON(this.name,E);Ce(typeof I=="string",e,"internal-error"),ys(f,e.name),ys(g,e.name),Ce(typeof j=="boolean",e,"internal-error"),Ce(typeof F=="boolean",e,"internal-error"),ys(x,e.name),ys(C,e.name),ys(y,e.name),ys(k,e.name),ys(w,e.name),ys(b,e.name);const N=new qr({uid:I,auth:e,email:g,emailVerified:j,displayName:f,isAnonymous:F,photoURL:C,phoneNumber:x,tenantId:y,stsTokenManager:_,createdAt:w,lastLoginAt:b});return q&&Array.isArray(q)&&(N.providerData=q.map(A=>Object.assign({},A))),k&&(N._redirectEventId=k),N}static async _fromIdTokenResponse(e,n,r=!1){const s=new la;s.updateFromServerResponse(n);const i=new qr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await nu(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Ce(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?mw(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),c=new la;c.updateFromIdToken(r);const u=new qr({uid:s.localId,auth:e,stsTokenManager:c,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Yh(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(u,d),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xy=new Map;function Gr(t){ns(t instanceof Function,"Expected a class definition");let e=xy.get(t);return e?(ns(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,xy.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}fw.type="NONE";const wy=fw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gc(t,e,n){return`firebase:${t}:${e}:${n}`}class ca{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=gc(this.userKey,s.apiKey,i),this.fullPersistenceKey=gc("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?qr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new ca(Gr(wy),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||Gr(wy);const a=gc(r,e.config.apiKey,e.name);let c=null;for(const d of n)try{const h=await d._get(a);if(h){const f=qr._fromJSON(e,h);d!==i&&(c=f),i=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new ca(i,e,r):(i=u[0],c&&await i._set(a,c.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new ca(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function by(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(vw(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(pw(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(ww(e))return"Blackberry";if(bw(e))return"Webos";if(gw(e))return"Safari";if((e.includes("chrome/")||yw(e))&&!e.includes("edge/"))return"Chrome";if(xw(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function pw(t=mn()){return/firefox\//i.test(t)}function gw(t=mn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function yw(t=mn()){return/crios\//i.test(t)}function vw(t=mn()){return/iemobile/i.test(t)}function xw(t=mn()){return/android/i.test(t)}function ww(t=mn()){return/blackberry/i.test(t)}function bw(t=mn()){return/webos/i.test(t)}function _f(t=mn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function nS(t=mn()){var e;return _f(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function rS(){return x1()&&document.documentMode===10}function _w(t=mn()){return _f(t)||xw(t)||bw(t)||ww(t)||/windows phone/i.test(t)||vw(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ew(t,e=[]){let n;switch(t){case"Browser":n=by(mn());break;case"Worker":n=`${by(mn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ra}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sS{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((a,c)=>{try{const u=e(i);a(u)}catch(u){c(u)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iS(t,e={}){return us(t,"GET","/v2/passwordPolicy",cs(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aS=6;class oS{constructor(e){var n,r,s,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=a.minPasswordLength)!==null&&n!==void 0?n:aS,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,s,i,a,c;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(n=u.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(s=u.containsLowercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(i=u.containsUppercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(a=u.containsNumericCharacter)!==null&&a!==void 0?a:!0),u.isValid&&(u.isValid=(c=u.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),u}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lS{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new _y(this),this.idTokenSubscription=new _y(this),this.beforeStateQueue=new sS(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ow,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Gr(n)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await ca.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await hw(this,{idToken:e}),r=await qr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(Cr(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(c,c))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,c=s==null?void 0:s._redirectEventId,u=await this.tryRedirectSignIn(e);(!a||a===c)&&(u!=null&&u.user)&&(s=u.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ce(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await nu(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=UN()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Cr(this.app))return Promise.reject(Qr(this));const n=e?Pt(e):null;return n&&Ce(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ce(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Cr(this.app)?Promise.reject(Qr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Cr(this.app)?Promise.reject(Qr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Gr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await iS(this),n=new oS(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ll("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await tS(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Gr(e)||this._popupRedirectResolver;Ce(n,this,"argument-error"),this.redirectPersistenceManager=await ca.create(this,[Gr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let a=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ce(c,this,"internal-error"),c.then(()=>{a||i(this.currentUser)}),typeof n=="function"){const u=e.addObserver(n,r,s);return()=>{a=!0,u()}}else{const u=e.addObserver(n);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ce(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ew(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&VN(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Ai(t){return Pt(t)}class _y{constructor(e){this.auth=e,this.observer=null,this.addObserver=S1(n=>this.observer=n)}get next(){return Ce(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Du={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function cS(t){Du=t}function Tw(t){return Du.loadJS(t)}function uS(){return Du.recaptchaEnterpriseScript}function dS(){return Du.gapiScript}function hS(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const mS="recaptcha-enterprise",fS="NO_RECAPTCHA";class pS{constructor(e){this.type=mS,this.auth=Ai(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,c)=>{GN(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const d=new qN(u);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(u=>{c(u)})})}function s(i,a,c){const u=window.grecaptcha;yy(u)?u.enterprise.ready(()=>{u.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(fS)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,a)=>{r(this.auth).then(c=>{if(!n&&yy(window.grecaptcha))s(c,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=uS();u.length!==0&&(u+=c),Tw(u).then(()=>{s(c,i,a)}).catch(d=>{a(d)})}}).catch(c=>{a(c)})})}}async function Ey(t,e,n,r=!1){const s=new pS(t);let i;try{i=await s.verify(n)}catch{i=await s.verify(n,!0)}const a=Object.assign({},e);return r?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Jh(t,e,n,r){var s;if(!((s=t._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Ey(t,e,n,n==="getOobCode");return r(t,i)}else return r(t,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await Ey(t,e,n,n==="getOobCode");return r(t,a)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gS(t,e){const n=yf(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Zc(i,e??{}))return s;hr(s,"already-initialized")}return n.initialize({options:e})}function yS(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Gr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function vS(t,e,n){const r=Ai(t);Ce(r._canInitEmulator,r,"emulator-config-failed"),Ce(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(n!=null&&n.disableWarnings),i=Cw(e),{host:a,port:c}=xS(e),u=c===null?"":`:${c}`;r.config.emulator={url:`${i}//${a}${u}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||wS()}function Cw(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function xS(t){const e=Cw(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Ty(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:Ty(a)}}}function Ty(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function wS(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ef{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Wr("not implemented")}_getIdTokenResponse(e){return Wr("not implemented")}_linkToIdToken(e,n){return Wr("not implemented")}_getReauthenticationResolver(e){return Wr("not implemented")}}async function bS(t,e){return us(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _S(t,e){return dl(t,"POST","/v1/accounts:signInWithPassword",cs(t,e))}async function ES(t,e){return us(t,"POST","/v1/accounts:sendOobCode",cs(t,e))}async function TS(t,e){return ES(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CS(t,e){return dl(t,"POST","/v1/accounts:signInWithEmailLink",cs(t,e))}async function NS(t,e){return dl(t,"POST","/v1/accounts:signInWithEmailLink",cs(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko extends Ef{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Ko(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Ko(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Jh(e,n,"signInWithPassword",_S);case"emailLink":return CS(e,{email:this._email,oobCode:this._password});default:hr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Jh(e,r,"signUpPassword",bS);case"emailLink":return NS(e,{idToken:n,email:this._email,oobCode:this._password});default:hr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ua(t,e){return dl(t,"POST","/v1/accounts:signInWithIdp",cs(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SS="http://localhost";class Ei extends Ef{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Ei(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):hr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,i=vf(n,["providerId","signInMethod"]);if(!r||!s)return null;const a=new Ei(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const n=this.buildRequest();return ua(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,ua(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,ua(e,n)}buildRequest(){const e={requestUri:SS,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=cl(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kS(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function IS(t){const e=ao(oo(t)).link,n=e?ao(oo(e)).deep_link_id:null,r=ao(oo(t)).deep_link_id;return(r?ao(oo(r)).link:null)||r||n||e||t}class Tf{constructor(e){var n,r,s,i,a,c;const u=ao(oo(e)),d=(n=u.apiKey)!==null&&n!==void 0?n:null,h=(r=u.oobCode)!==null&&r!==void 0?r:null,f=kS((s=u.mode)!==null&&s!==void 0?s:null);Ce(d&&h&&f,"argument-error"),this.apiKey=d,this.operation=f,this.code=h,this.continueUrl=(i=u.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(a=u.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(c=u.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){const n=IS(e);try{return new Tf(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja{constructor(){this.providerId=ja.PROVIDER_ID}static credential(e,n){return Ko._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Tf.parseLink(n);return Ce(r,"argument-error"),Ko._fromEmailAndCode(e,r.code,r.tenantId)}}ja.PROVIDER_ID="password";ja.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ja.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nw{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl extends Nw{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es extends hl{constructor(){super("facebook.com")}static credential(e){return Ei._fromParams({providerId:Es.PROVIDER_ID,signInMethod:Es.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Es.credentialFromTaggedObject(e)}static credentialFromError(e){return Es.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Es.credential(e.oauthAccessToken)}catch{return null}}}Es.FACEBOOK_SIGN_IN_METHOD="facebook.com";Es.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts extends hl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Ei._fromParams({providerId:Ts.PROVIDER_ID,signInMethod:Ts.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Ts.credentialFromTaggedObject(e)}static credentialFromError(e){return Ts.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Ts.credential(n,r)}catch{return null}}}Ts.GOOGLE_SIGN_IN_METHOD="google.com";Ts.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs extends hl{constructor(){super("github.com")}static credential(e){return Ei._fromParams({providerId:Cs.PROVIDER_ID,signInMethod:Cs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cs.credentialFromTaggedObject(e)}static credentialFromError(e){return Cs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Cs.credential(e.oauthAccessToken)}catch{return null}}}Cs.GITHUB_SIGN_IN_METHOD="github.com";Cs.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns extends hl{constructor(){super("twitter.com")}static credential(e,n){return Ei._fromParams({providerId:Ns.PROVIDER_ID,signInMethod:Ns.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Ns.credentialFromTaggedObject(e)}static credentialFromError(e){return Ns.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Ns.credential(n,r)}catch{return null}}}Ns.TWITTER_SIGN_IN_METHOD="twitter.com";Ns.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AS(t,e){return dl(t,"POST","/v1/accounts:signUp",cs(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ti{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await qr._fromIdTokenResponse(e,r,s),a=Cy(r);return new Ti({user:i,providerId:a,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=Cy(r);return new Ti({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function Cy(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru extends ls{constructor(e,n,r,s){var i;super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,ru.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new ru(e,n,r,s)}}function Sw(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ru._fromErrorAndOperation(t,i,e,r):i})}async function PS(t,e,n=!1){const r=await Go(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Ti._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RS(t,e,n=!1){const{auth:r}=t;if(Cr(r.app))return Promise.reject(Qr(r));const s="reauthenticate";try{const i=await Go(t,Sw(r,s,e,t),n);Ce(i.idToken,r,"internal-error");const a=bf(i.idToken);Ce(a,r,"internal-error");const{sub:c}=a;return Ce(t.uid===c,r,"user-mismatch"),Ti._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&hr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kw(t,e,n=!1){if(Cr(t.app))return Promise.reject(Qr(t));const r="signIn",s=await Sw(t,r,e),i=await Ti._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function jS(t,e){return kw(Ai(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DS(t,e,n){var r;Ce(((r=n.url)===null||r===void 0?void 0:r.length)>0,t,"invalid-continue-uri"),Ce(typeof n.dynamicLinkDomain>"u"||n.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=n.url,e.dynamicLinkDomain=n.dynamicLinkDomain,e.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(Ce(n.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=n.iOS.bundleId),n.android&&(Ce(n.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=n.android.installApp,e.androidMinimumVersionCode=n.android.minimumVersion,e.androidPackageName=n.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Iw(t){const e=Ai(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function MS(t,e,n){if(Cr(t.app))return Promise.reject(Qr(t));const r=Ai(t),a=await Jh(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",AS).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&Iw(t),u}),c=await Ti._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(c.user),c}function LS(t,e,n){return Cr(t.app)?Promise.reject(Qr(t)):jS(Pt(t),ja.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Iw(t),r})}async function OS(t,e){const n=Pt(t),s={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()};e&&DS(n.auth,s,e);const{email:i}=await TS(n.auth,s);i!==t.email&&await t.reload()}function VS(t,e,n,r){return Pt(t).onIdTokenChanged(e,n,r)}function $S(t,e,n){return Pt(t).beforeAuthStateChanged(e,n)}function Aw(t,e,n,r){return Pt(t).onAuthStateChanged(e,n,r)}function Pw(t){return Pt(t).signOut()}const su="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(su,"1"),this.storage.removeItem(su),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FS=1e3,US=10;class jw extends Rw{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_w(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((a,c,u)=>{this.notifyListeners(a,u)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!n&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);rS()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,US):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},FS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}jw.type="LOCAL";const BS=jw;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dw extends Rw{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}Dw.type="SESSION";const Mw=Dw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zS(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mu{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new Mu(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const c=Array.from(a).map(async d=>d(n.origin,i)),u=await zS(c);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Mu.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cf(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HS{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((c,u)=>{const d=Cf("",20);s.port1.start();const h=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===d)switch(g.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(g.data.response);break;default:clearTimeout(h),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ir(){return window}function WS(t){Ir().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lw(){return typeof Ir().WorkerGlobalScope<"u"&&typeof Ir().importScripts=="function"}async function qS(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function GS(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function KS(){return Lw()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ow="firebaseLocalStorageDb",QS=1,iu="firebaseLocalStorage",Vw="fbase_key";class ml{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Lu(t,e){return t.transaction([iu],e?"readwrite":"readonly").objectStore(iu)}function YS(){const t=indexedDB.deleteDatabase(Ow);return new ml(t).toPromise()}function Xh(){const t=indexedDB.open(Ow,QS);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(iu,{keyPath:Vw})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(iu)?e(r):(r.close(),await YS(),e(await Xh()))})})}async function Ny(t,e,n){const r=Lu(t,!0).put({[Vw]:e,value:n});return new ml(r).toPromise()}async function JS(t,e){const n=Lu(t,!1).get(e),r=await new ml(n).toPromise();return r===void 0?null:r.value}function Sy(t,e){const n=Lu(t,!0).delete(e);return new ml(n).toPromise()}const XS=800,ZS=3;class $w{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Xh(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>ZS)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Lw()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Mu._getInstance(KS()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await qS(),!this.activeServiceWorker)return;this.sender=new HS(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||GS()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Xh();return await Ny(e,su,"1"),await Sy(e,su),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Ny(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>JS(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Sy(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Lu(s,!1).getAll();return new ml(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),XS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}$w.type="LOCAL";const ek=$w;new ul(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tk(t,e){return e?Gr(e):(Ce(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nf extends Ef{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ua(e,this._buildIdpRequest())}_linkToIdToken(e,n){return ua(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return ua(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function nk(t){return kw(t.auth,new Nf(t),t.bypassAuthState)}function rk(t){const{auth:e,user:n}=t;return Ce(n,e,"internal-error"),RS(n,new Nf(t),t.bypassAuthState)}async function sk(t){const{auth:e,user:n}=t;return Ce(n,e,"internal-error"),PS(n,new Nf(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:a,type:c}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return nk;case"linkViaPopup":case"linkViaRedirect":return sk;case"reauthViaPopup":case"reauthViaRedirect":return rk;default:hr(this.auth,"internal-error")}}resolve(e){ns(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ns(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ik=new ul(2e3,1e4);class ta extends Fw{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,ta.currentPopupAction&&ta.currentPopupAction.cancel(),ta.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ce(e,this.auth,"internal-error"),e}async onExecution(){ns(this.filter.length===1,"Popup operations only handle one event");const e=Cf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(kr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(kr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ta.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(kr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,ik.get())};e()}}ta.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ak="pendingRedirect",yc=new Map;class ok extends Fw{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=yc.get(this.auth._key());if(!e){try{const r=await lk(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}yc.set(this.auth._key(),e)}return this.bypassAuthState||yc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function lk(t,e){const n=dk(e),r=uk(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function ck(t,e){yc.set(t._key(),e)}function uk(t){return Gr(t._redirectPersistence)}function dk(t){return gc(ak,t.config.apiKey,t.name)}async function hk(t,e,n=!1){if(Cr(t.app))return Promise.reject(Qr(t));const r=Ai(t),s=tk(r,e),a=await new ok(r,s,n).execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mk=10*60*1e3;class fk{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!pk(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!Uw(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(kr(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=mk&&this.cachedEventUids.clear(),this.cachedEventUids.has(ky(e))}saveEventToCache(e){this.cachedEventUids.add(ky(e)),this.lastProcessedEventTime=Date.now()}}function ky(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Uw({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function pk(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Uw(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gk(t,e={}){return us(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yk=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,vk=/^https?/;async function xk(t){if(t.config.emulator)return;const{authorizedDomains:e}=await gk(t);for(const n of e)try{if(wk(n))return}catch{}hr(t,"unauthorized-domain")}function wk(t){const e=Qh(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&a.hostname===r}if(!vk.test(n))return!1;if(yk.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bk=new ul(3e4,6e4);function Iy(){const t=Ir().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function _k(t){return new Promise((e,n)=>{var r,s,i;function a(){Iy(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Iy(),n(kr(t,"network-request-failed"))},timeout:bk.get()})}if(!((s=(r=Ir().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Ir().gapi)===null||i===void 0)&&i.load)a();else{const c=hS("iframefcb");return Ir()[c]=()=>{gapi.load?a():n(kr(t,"network-request-failed"))},Tw(`${dS()}?onload=${c}`).catch(u=>n(u))}}).catch(e=>{throw vc=null,e})}let vc=null;function Ek(t){return vc=vc||_k(t),vc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tk=new ul(5e3,15e3),Ck="__/auth/iframe",Nk="emulator/auth/iframe",Sk={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},kk=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ik(t){const e=t.config;Ce(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?wf(e,Nk):`https://${t.config.authDomain}/${Ck}`,r={apiKey:e.apiKey,appName:t.name,v:Ra},s=kk.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${cl(r).slice(1)}`}async function Ak(t){const e=await Ek(t),n=Ir().gapi;return Ce(n,t,"internal-error"),e.open({where:document.body,url:Ik(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Sk,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=kr(t,"network-request-failed"),c=Ir().setTimeout(()=>{i(a)},Tk.get());function u(){Ir().clearTimeout(c),s(r)}r.ping(u).then(u,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pk={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Rk=500,jk=600,Dk="_blank",Mk="http://localhost";class Ay{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Lk(t,e,n,r=Rk,s=jk){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},Pk),{width:r.toString(),height:s.toString(),top:i,left:a}),d=mn().toLowerCase();n&&(c=yw(d)?Dk:n),pw(d)&&(e=e||Mk,u.scrollbars="yes");const h=Object.entries(u).reduce((g,[x,C])=>`${g}${x}=${C},`,"");if(nS(d)&&c!=="_self")return Ok(e||"",c),new Ay(null);const f=window.open(e||"",c,h);Ce(f,t,"popup-blocked");try{f.focus()}catch{}return new Ay(f)}function Ok(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vk="__/auth/handler",$k="emulator/auth/handler",Fk=encodeURIComponent("fac");async function Py(t,e,n,r,s,i){Ce(t.config.authDomain,t,"auth-domain-config-required"),Ce(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Ra,eventId:s};if(e instanceof Nw){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",N1(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))a[h]=f}if(e instanceof hl){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(a.scopes=h.join(","))}t.tenantId&&(a.tid=t.tenantId);const c=a;for(const h of Object.keys(c))c[h]===void 0&&delete c[h];const u=await t._getAppCheckToken(),d=u?`#${Fk}=${encodeURIComponent(u)}`:"";return`${Uk(t)}?${cl(c).slice(1)}${d}`}function Uk({config:t}){return t.emulator?wf(t,$k):`https://${t.authDomain}/${Vk}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ud="webStorageSupport";class Bk{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Mw,this._completeRedirectFn=hk,this._overrideRedirectResult=ck}async _openPopup(e,n,r,s){var i;ns((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await Py(e,n,r,Qh(),s);return Lk(e,a,Cf())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await Py(e,n,r,Qh(),s);return WS(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(ns(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await Ak(e),r=new fk(e);return n.register("authEvent",s=>(Ce(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Ud,{type:Ud},s=>{var i;const a=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Ud];a!==void 0&&n(!!a),hr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=xk(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return _w()||gw()||_f()}}const zk=Bk;var Ry="@firebase/auth",jy="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ce(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wk(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function qk(t){xa(new _i("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=r.options;Ce(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:c,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ew(t)},d=new lS(r,s,i,u);return yS(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),xa(new _i("auth-internal",e=>{const n=Ai(e.getProvider("auth").getImmediate());return(r=>new Hk(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Bs(Ry,jy,Wk(t)),Bs(Ry,jy,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gk=5*60,Kk=Zx("authIdTokenMaxAge")||Gk;let Dy=null;const Qk=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>Kk)return;const s=n==null?void 0:n.token;Dy!==s&&(Dy=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Yk(t=rw()){const e=yf(t,"auth");if(e.isInitialized())return e.getImmediate();const n=gS(t,{popupRedirectResolver:zk,persistence:[ek,BS,Mw]}),r=Zx("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=Qk(i.toString());$S(n,a,()=>a(n.currentUser)),VS(n,c=>a(c))}}const s=Jx("auth");return s&&vS(n,`http://${s}`),n}function Jk(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}cS({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=kr("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",Jk().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});qk("Browser");var Xk="firebase",Zk="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bs(Xk,Zk,"app");var My=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var gi,Bw;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(E,_){function N(){}N.prototype=_.prototype,E.D=_.prototype,E.prototype=new N,E.prototype.constructor=E,E.C=function(A,D,S){for(var T=Array(arguments.length-2),Ve=2;Ve<arguments.length;Ve++)T[Ve-2]=arguments[Ve];return _.prototype[D].apply(A,T)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,_,N){N||(N=0);var A=Array(16);if(typeof _=="string")for(var D=0;16>D;++D)A[D]=_.charCodeAt(N++)|_.charCodeAt(N++)<<8|_.charCodeAt(N++)<<16|_.charCodeAt(N++)<<24;else for(D=0;16>D;++D)A[D]=_[N++]|_[N++]<<8|_[N++]<<16|_[N++]<<24;_=E.g[0],N=E.g[1],D=E.g[2];var S=E.g[3],T=_+(S^N&(D^S))+A[0]+3614090360&4294967295;_=N+(T<<7&4294967295|T>>>25),T=S+(D^_&(N^D))+A[1]+3905402710&4294967295,S=_+(T<<12&4294967295|T>>>20),T=D+(N^S&(_^N))+A[2]+606105819&4294967295,D=S+(T<<17&4294967295|T>>>15),T=N+(_^D&(S^_))+A[3]+3250441966&4294967295,N=D+(T<<22&4294967295|T>>>10),T=_+(S^N&(D^S))+A[4]+4118548399&4294967295,_=N+(T<<7&4294967295|T>>>25),T=S+(D^_&(N^D))+A[5]+1200080426&4294967295,S=_+(T<<12&4294967295|T>>>20),T=D+(N^S&(_^N))+A[6]+2821735955&4294967295,D=S+(T<<17&4294967295|T>>>15),T=N+(_^D&(S^_))+A[7]+4249261313&4294967295,N=D+(T<<22&4294967295|T>>>10),T=_+(S^N&(D^S))+A[8]+1770035416&4294967295,_=N+(T<<7&4294967295|T>>>25),T=S+(D^_&(N^D))+A[9]+2336552879&4294967295,S=_+(T<<12&4294967295|T>>>20),T=D+(N^S&(_^N))+A[10]+4294925233&4294967295,D=S+(T<<17&4294967295|T>>>15),T=N+(_^D&(S^_))+A[11]+2304563134&4294967295,N=D+(T<<22&4294967295|T>>>10),T=_+(S^N&(D^S))+A[12]+1804603682&4294967295,_=N+(T<<7&4294967295|T>>>25),T=S+(D^_&(N^D))+A[13]+4254626195&4294967295,S=_+(T<<12&4294967295|T>>>20),T=D+(N^S&(_^N))+A[14]+2792965006&4294967295,D=S+(T<<17&4294967295|T>>>15),T=N+(_^D&(S^_))+A[15]+1236535329&4294967295,N=D+(T<<22&4294967295|T>>>10),T=_+(D^S&(N^D))+A[1]+4129170786&4294967295,_=N+(T<<5&4294967295|T>>>27),T=S+(N^D&(_^N))+A[6]+3225465664&4294967295,S=_+(T<<9&4294967295|T>>>23),T=D+(_^N&(S^_))+A[11]+643717713&4294967295,D=S+(T<<14&4294967295|T>>>18),T=N+(S^_&(D^S))+A[0]+3921069994&4294967295,N=D+(T<<20&4294967295|T>>>12),T=_+(D^S&(N^D))+A[5]+3593408605&4294967295,_=N+(T<<5&4294967295|T>>>27),T=S+(N^D&(_^N))+A[10]+38016083&4294967295,S=_+(T<<9&4294967295|T>>>23),T=D+(_^N&(S^_))+A[15]+3634488961&4294967295,D=S+(T<<14&4294967295|T>>>18),T=N+(S^_&(D^S))+A[4]+3889429448&4294967295,N=D+(T<<20&4294967295|T>>>12),T=_+(D^S&(N^D))+A[9]+568446438&4294967295,_=N+(T<<5&4294967295|T>>>27),T=S+(N^D&(_^N))+A[14]+3275163606&4294967295,S=_+(T<<9&4294967295|T>>>23),T=D+(_^N&(S^_))+A[3]+4107603335&4294967295,D=S+(T<<14&4294967295|T>>>18),T=N+(S^_&(D^S))+A[8]+1163531501&4294967295,N=D+(T<<20&4294967295|T>>>12),T=_+(D^S&(N^D))+A[13]+2850285829&4294967295,_=N+(T<<5&4294967295|T>>>27),T=S+(N^D&(_^N))+A[2]+4243563512&4294967295,S=_+(T<<9&4294967295|T>>>23),T=D+(_^N&(S^_))+A[7]+1735328473&4294967295,D=S+(T<<14&4294967295|T>>>18),T=N+(S^_&(D^S))+A[12]+2368359562&4294967295,N=D+(T<<20&4294967295|T>>>12),T=_+(N^D^S)+A[5]+4294588738&4294967295,_=N+(T<<4&4294967295|T>>>28),T=S+(_^N^D)+A[8]+2272392833&4294967295,S=_+(T<<11&4294967295|T>>>21),T=D+(S^_^N)+A[11]+1839030562&4294967295,D=S+(T<<16&4294967295|T>>>16),T=N+(D^S^_)+A[14]+4259657740&4294967295,N=D+(T<<23&4294967295|T>>>9),T=_+(N^D^S)+A[1]+2763975236&4294967295,_=N+(T<<4&4294967295|T>>>28),T=S+(_^N^D)+A[4]+1272893353&4294967295,S=_+(T<<11&4294967295|T>>>21),T=D+(S^_^N)+A[7]+4139469664&4294967295,D=S+(T<<16&4294967295|T>>>16),T=N+(D^S^_)+A[10]+3200236656&4294967295,N=D+(T<<23&4294967295|T>>>9),T=_+(N^D^S)+A[13]+681279174&4294967295,_=N+(T<<4&4294967295|T>>>28),T=S+(_^N^D)+A[0]+3936430074&4294967295,S=_+(T<<11&4294967295|T>>>21),T=D+(S^_^N)+A[3]+3572445317&4294967295,D=S+(T<<16&4294967295|T>>>16),T=N+(D^S^_)+A[6]+76029189&4294967295,N=D+(T<<23&4294967295|T>>>9),T=_+(N^D^S)+A[9]+3654602809&4294967295,_=N+(T<<4&4294967295|T>>>28),T=S+(_^N^D)+A[12]+3873151461&4294967295,S=_+(T<<11&4294967295|T>>>21),T=D+(S^_^N)+A[15]+530742520&4294967295,D=S+(T<<16&4294967295|T>>>16),T=N+(D^S^_)+A[2]+3299628645&4294967295,N=D+(T<<23&4294967295|T>>>9),T=_+(D^(N|~S))+A[0]+4096336452&4294967295,_=N+(T<<6&4294967295|T>>>26),T=S+(N^(_|~D))+A[7]+1126891415&4294967295,S=_+(T<<10&4294967295|T>>>22),T=D+(_^(S|~N))+A[14]+2878612391&4294967295,D=S+(T<<15&4294967295|T>>>17),T=N+(S^(D|~_))+A[5]+4237533241&4294967295,N=D+(T<<21&4294967295|T>>>11),T=_+(D^(N|~S))+A[12]+1700485571&4294967295,_=N+(T<<6&4294967295|T>>>26),T=S+(N^(_|~D))+A[3]+2399980690&4294967295,S=_+(T<<10&4294967295|T>>>22),T=D+(_^(S|~N))+A[10]+4293915773&4294967295,D=S+(T<<15&4294967295|T>>>17),T=N+(S^(D|~_))+A[1]+2240044497&4294967295,N=D+(T<<21&4294967295|T>>>11),T=_+(D^(N|~S))+A[8]+1873313359&4294967295,_=N+(T<<6&4294967295|T>>>26),T=S+(N^(_|~D))+A[15]+4264355552&4294967295,S=_+(T<<10&4294967295|T>>>22),T=D+(_^(S|~N))+A[6]+2734768916&4294967295,D=S+(T<<15&4294967295|T>>>17),T=N+(S^(D|~_))+A[13]+1309151649&4294967295,N=D+(T<<21&4294967295|T>>>11),T=_+(D^(N|~S))+A[4]+4149444226&4294967295,_=N+(T<<6&4294967295|T>>>26),T=S+(N^(_|~D))+A[11]+3174756917&4294967295,S=_+(T<<10&4294967295|T>>>22),T=D+(_^(S|~N))+A[2]+718787259&4294967295,D=S+(T<<15&4294967295|T>>>17),T=N+(S^(D|~_))+A[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(D+(T<<21&4294967295|T>>>11))&4294967295,E.g[2]=E.g[2]+D&4294967295,E.g[3]=E.g[3]+S&4294967295}r.prototype.u=function(E,_){_===void 0&&(_=E.length);for(var N=_-this.blockSize,A=this.B,D=this.h,S=0;S<_;){if(D==0)for(;S<=N;)s(this,E,S),S+=this.blockSize;if(typeof E=="string"){for(;S<_;)if(A[D++]=E.charCodeAt(S++),D==this.blockSize){s(this,A),D=0;break}}else for(;S<_;)if(A[D++]=E[S++],D==this.blockSize){s(this,A),D=0;break}}this.h=D,this.o+=_},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;var N=8*this.o;for(_=E.length-8;_<E.length;++_)E[_]=N&255,N/=256;for(this.u(E),E=Array(16),_=N=0;4>_;++_)for(var A=0;32>A;A+=8)E[N++]=this.g[_]>>>A&255;return E};function i(E,_){var N=c;return Object.prototype.hasOwnProperty.call(N,E)?N[E]:N[E]=_(E)}function a(E,_){this.h=_;for(var N=[],A=!0,D=E.length-1;0<=D;D--){var S=E[D]|0;A&&S==_||(N[D]=S,A=!1)}this.g=N}var c={};function u(E){return-128<=E&&128>E?i(E,function(_){return new a([_|0],0>_?-1:0)}):new a([E|0],0>E?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return f;if(0>E)return k(d(-E));for(var _=[],N=1,A=0;E>=N;A++)_[A]=E/N|0,N*=4294967296;return new a(_,0)}function h(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return k(h(E.substring(1),_));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var N=d(Math.pow(_,8)),A=f,D=0;D<E.length;D+=8){var S=Math.min(8,E.length-D),T=parseInt(E.substring(D,D+S),_);8>S?(S=d(Math.pow(_,S)),A=A.j(S).add(d(T))):(A=A.j(N),A=A.add(d(T)))}return A}var f=u(0),g=u(1),x=u(16777216);t=a.prototype,t.m=function(){if(y(this))return-k(this).m();for(var E=0,_=1,N=0;N<this.g.length;N++){var A=this.i(N);E+=(0<=A?A:4294967296+A)*_,_*=4294967296}return E},t.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(C(this))return"0";if(y(this))return"-"+k(this).toString(E);for(var _=d(Math.pow(E,6)),N=this,A="";;){var D=j(N,_).g;N=w(N,D.j(_));var S=((0<N.g.length?N.g[0]:N.h)>>>0).toString(E);if(N=D,C(N))return S+A;for(;6>S.length;)S="0"+S;A=S+A}},t.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function C(E){if(E.h!=0)return!1;for(var _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function y(E){return E.h==-1}t.l=function(E){return E=w(this,E),y(E)?-1:C(E)?0:1};function k(E){for(var _=E.g.length,N=[],A=0;A<_;A++)N[A]=~E.g[A];return new a(N,~E.h).add(g)}t.abs=function(){return y(this)?k(this):this},t.add=function(E){for(var _=Math.max(this.g.length,E.g.length),N=[],A=0,D=0;D<=_;D++){var S=A+(this.i(D)&65535)+(E.i(D)&65535),T=(S>>>16)+(this.i(D)>>>16)+(E.i(D)>>>16);A=T>>>16,S&=65535,T&=65535,N[D]=T<<16|S}return new a(N,N[N.length-1]&-2147483648?-1:0)};function w(E,_){return E.add(k(_))}t.j=function(E){if(C(this)||C(E))return f;if(y(this))return y(E)?k(this).j(k(E)):k(k(this).j(E));if(y(E))return k(this.j(k(E)));if(0>this.l(x)&&0>E.l(x))return d(this.m()*E.m());for(var _=this.g.length+E.g.length,N=[],A=0;A<2*_;A++)N[A]=0;for(A=0;A<this.g.length;A++)for(var D=0;D<E.g.length;D++){var S=this.i(A)>>>16,T=this.i(A)&65535,Ve=E.i(D)>>>16,Me=E.i(D)&65535;N[2*A+2*D]+=T*Me,b(N,2*A+2*D),N[2*A+2*D+1]+=S*Me,b(N,2*A+2*D+1),N[2*A+2*D+1]+=T*Ve,b(N,2*A+2*D+1),N[2*A+2*D+2]+=S*Ve,b(N,2*A+2*D+2)}for(A=0;A<_;A++)N[A]=N[2*A+1]<<16|N[2*A];for(A=_;A<2*_;A++)N[A]=0;return new a(N,0)};function b(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function I(E,_){this.g=E,this.h=_}function j(E,_){if(C(_))throw Error("division by zero");if(C(E))return new I(f,f);if(y(E))return _=j(k(E),_),new I(k(_.g),k(_.h));if(y(_))return _=j(E,k(_)),new I(k(_.g),_.h);if(30<E.g.length){if(y(E)||y(_))throw Error("slowDivide_ only works with positive integers.");for(var N=g,A=_;0>=A.l(E);)N=F(N),A=F(A);var D=q(N,1),S=q(A,1);for(A=q(A,2),N=q(N,2);!C(A);){var T=S.add(A);0>=T.l(E)&&(D=D.add(N),S=T),A=q(A,1),N=q(N,1)}return _=w(E,D.j(_)),new I(D,_)}for(D=f;0<=E.l(_);){for(N=Math.max(1,Math.floor(E.m()/_.m())),A=Math.ceil(Math.log(N)/Math.LN2),A=48>=A?1:Math.pow(2,A-48),S=d(N),T=S.j(_);y(T)||0<T.l(E);)N-=A,S=d(N),T=S.j(_);C(S)&&(S=g),D=D.add(S),E=w(E,T)}return new I(D,E)}t.A=function(E){return j(this,E).h},t.and=function(E){for(var _=Math.max(this.g.length,E.g.length),N=[],A=0;A<_;A++)N[A]=this.i(A)&E.i(A);return new a(N,this.h&E.h)},t.or=function(E){for(var _=Math.max(this.g.length,E.g.length),N=[],A=0;A<_;A++)N[A]=this.i(A)|E.i(A);return new a(N,this.h|E.h)},t.xor=function(E){for(var _=Math.max(this.g.length,E.g.length),N=[],A=0;A<_;A++)N[A]=this.i(A)^E.i(A);return new a(N,this.h^E.h)};function F(E){for(var _=E.g.length+1,N=[],A=0;A<_;A++)N[A]=E.i(A)<<1|E.i(A-1)>>>31;return new a(N,E.h)}function q(E,_){var N=_>>5;_%=32;for(var A=E.g.length-N,D=[],S=0;S<A;S++)D[S]=0<_?E.i(S+N)>>>_|E.i(S+N+1)<<32-_:E.i(S+N);return new a(D,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Bw=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=h,gi=a}).apply(typeof My<"u"?My:typeof self<"u"?self:typeof window<"u"?window:{});var Xl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var zw,lo,Hw,xc,Zh,Ww,qw,Gw;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,m,p){return l==Array.prototype||l==Object.prototype||(l[m]=p.value),l};function n(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Xl=="object"&&Xl];for(var m=0;m<l.length;++m){var p=l[m];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=n(this);function s(l,m){if(m)e:{var p=r;l=l.split(".");for(var v=0;v<l.length-1;v++){var O=l[v];if(!(O in p))break e;p=p[O]}l=l[l.length-1],v=p[l],m=m(v),m!=v&&m!=null&&e(p,l,{configurable:!0,writable:!0,value:m})}}function i(l,m){l instanceof String&&(l+="");var p=0,v=!1,O={next:function(){if(!v&&p<l.length){var $=p++;return{value:m($,l[$]),done:!1}}return v=!0,{done:!0,value:void 0}}};return O[Symbol.iterator]=function(){return O},O}s("Array.prototype.values",function(l){return l||function(){return i(this,function(m,p){return p})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},c=this||self;function u(l){var m=typeof l;return m=m!="object"?m:l?Array.isArray(l)?"array":m:"null",m=="array"||m=="object"&&typeof l.length=="number"}function d(l){var m=typeof l;return m=="object"&&l!=null||m=="function"}function h(l,m,p){return l.call.apply(l.bind,arguments)}function f(l,m,p){if(!l)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var O=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(O,v),l.apply(m,O)}}return function(){return l.apply(m,arguments)}}function g(l,m,p){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,g.apply(null,arguments)}function x(l,m){var p=Array.prototype.slice.call(arguments,1);return function(){var v=p.slice();return v.push.apply(v,arguments),l.apply(this,v)}}function C(l,m){function p(){}p.prototype=m.prototype,l.aa=m.prototype,l.prototype=new p,l.prototype.constructor=l,l.Qb=function(v,O,$){for(var re=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)re[nt-2]=arguments[nt];return m.prototype[O].apply(v,re)}}function y(l){const m=l.length;if(0<m){const p=Array(m);for(let v=0;v<m;v++)p[v]=l[v];return p}return[]}function k(l,m){for(let p=1;p<arguments.length;p++){const v=arguments[p];if(u(v)){const O=l.length||0,$=v.length||0;l.length=O+$;for(let re=0;re<$;re++)l[O+re]=v[re]}else l.push(v)}}class w{constructor(m,p){this.i=m,this.j=p,this.h=0,this.g=null}get(){let m;return 0<this.h?(this.h--,m=this.g,this.g=m.next,m.next=null):m=this.i(),m}}function b(l){return/^[\s\xa0]*$/.test(l)}function I(){var l=c.navigator;return l&&(l=l.userAgent)?l:""}function j(l){return j[" "](l),l}j[" "]=function(){};var F=I().indexOf("Gecko")!=-1&&!(I().toLowerCase().indexOf("webkit")!=-1&&I().indexOf("Edge")==-1)&&!(I().indexOf("Trident")!=-1||I().indexOf("MSIE")!=-1)&&I().indexOf("Edge")==-1;function q(l,m,p){for(const v in l)m.call(p,l[v],v,l)}function E(l,m){for(const p in l)m.call(void 0,l[p],p,l)}function _(l){const m={};for(const p in l)m[p]=l[p];return m}const N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function A(l,m){let p,v;for(let O=1;O<arguments.length;O++){v=arguments[O];for(p in v)l[p]=v[p];for(let $=0;$<N.length;$++)p=N[$],Object.prototype.hasOwnProperty.call(v,p)&&(l[p]=v[p])}}function D(l){var m=1;l=l.split(":");const p=[];for(;0<m&&l.length;)p.push(l.shift()),m--;return l.length&&p.push(l.join(":")),p}function S(l){c.setTimeout(()=>{throw l},0)}function T(){var l=ie;let m=null;return l.g&&(m=l.g,l.g=l.g.next,l.g||(l.h=null),m.next=null),m}class Ve{constructor(){this.h=this.g=null}add(m,p){const v=Me.get();v.set(m,p),this.h?this.h.next=v:this.g=v,this.h=v}}var Me=new w(()=>new Le,l=>l.reset());class Le{constructor(){this.next=this.g=this.h=null}set(m,p){this.h=m,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let Ne,G=!1,ie=new Ve,ve=()=>{const l=c.Promise.resolve(void 0);Ne=()=>{l.then(ee)}};var ee=()=>{for(var l;l=T();){try{l.h.call(l.g)}catch(p){S(p)}var m=Me;m.j(l),100>m.h&&(m.h++,l.next=m.g,m.g=l)}G=!1};function W(){this.s=this.s,this.C=this.C}W.prototype.s=!1,W.prototype.ma=function(){this.s||(this.s=!0,this.N())},W.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function te(l,m){this.type=l,this.g=this.target=m,this.defaultPrevented=!1}te.prototype.h=function(){this.defaultPrevented=!0};var de=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var l=!1,m=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const p=()=>{};c.addEventListener("test",p,m),c.removeEventListener("test",p,m)}catch{}return l}();function Oe(l,m){if(te.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var p=this.type=l.type,v=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=m,m=l.relatedTarget){if(F){e:{try{j(m.nodeName);var O=!0;break e}catch{}O=!1}O||(m=null)}}else p=="mouseover"?m=l.fromElement:p=="mouseout"&&(m=l.toElement);this.relatedTarget=m,v?(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:he[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&Oe.aa.h.call(this)}}C(Oe,te);var he={2:"touch",3:"pen",4:"mouse"};Oe.prototype.h=function(){Oe.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var ue="closure_listenable_"+(1e6*Math.random()|0),Q=0;function Ie(l,m,p,v,O){this.listener=l,this.proxy=null,this.src=m,this.type=p,this.capture=!!v,this.ha=O,this.key=++Q,this.da=this.fa=!1}function we(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Be(l){this.src=l,this.g={},this.h=0}Be.prototype.add=function(l,m,p,v,O){var $=l.toString();l=this.g[$],l||(l=this.g[$]=[],this.h++);var re=ut(l,m,v,O);return-1<re?(m=l[re],p||(m.fa=!1)):(m=new Ie(m,this.src,$,!!v,O),m.fa=p,l.push(m)),m};function B(l,m){var p=m.type;if(p in l.g){var v=l.g[p],O=Array.prototype.indexOf.call(v,m,void 0),$;($=0<=O)&&Array.prototype.splice.call(v,O,1),$&&(we(m),l.g[p].length==0&&(delete l.g[p],l.h--))}}function ut(l,m,p,v){for(var O=0;O<l.length;++O){var $=l[O];if(!$.da&&$.listener==m&&$.capture==!!p&&$.ha==v)return O}return-1}var dt="closure_lm_"+(1e6*Math.random()|0),_e={};function Tt(l,m,p,v,O){if(v&&v.once)return wt(l,m,p,v,O);if(Array.isArray(m)){for(var $=0;$<m.length;$++)Tt(l,m[$],p,v,O);return null}return p=Lt(p),l&&l[ue]?l.K(m,p,d(v)?!!v.capture:!!v,O):fr(l,m,p,!1,v,O)}function fr(l,m,p,v,O,$){if(!m)throw Error("Invalid event type");var re=d(O)?!!O.capture:!!O,nt=tn(l);if(nt||(l[dt]=nt=new Be(l)),p=nt.add(m,p,v,re,$),p.proxy)return p;if(v=et(),p.proxy=v,v.src=l,v.listener=p,l.addEventListener)de||(O=re),O===void 0&&(O=!1),l.addEventListener(m.toString(),v,O);else if(l.attachEvent)l.attachEvent(hs(m.toString()),v);else if(l.addListener&&l.removeListener)l.addListener(v);else throw Error("addEventListener and attachEvent are unavailable.");return p}function et(){function l(p){return m.call(l.src,l.listener,p)}const m=pt;return l}function wt(l,m,p,v,O){if(Array.isArray(m)){for(var $=0;$<m.length;$++)wt(l,m[$],p,v,O);return null}return p=Lt(p),l&&l[ue]?l.L(m,p,d(v)?!!v.capture:!!v,O):fr(l,m,p,!0,v,O)}function Ye(l,m,p,v,O){if(Array.isArray(m))for(var $=0;$<m.length;$++)Ye(l,m[$],p,v,O);else v=d(v)?!!v.capture:!!v,p=Lt(p),l&&l[ue]?(l=l.i,m=String(m).toString(),m in l.g&&($=l.g[m],p=ut($,p,v,O),-1<p&&(we($[p]),Array.prototype.splice.call($,p,1),$.length==0&&(delete l.g[m],l.h--)))):l&&(l=tn(l))&&(m=l.g[m.toString()],l=-1,m&&(l=ut(m,p,v,O)),(p=-1<l?m[l]:null)&&en(p))}function en(l){if(typeof l!="number"&&l&&!l.da){var m=l.src;if(m&&m[ue])B(m.i,l);else{var p=l.type,v=l.proxy;m.removeEventListener?m.removeEventListener(p,v,l.capture):m.detachEvent?m.detachEvent(hs(p),v):m.addListener&&m.removeListener&&m.removeListener(v),(p=tn(m))?(B(p,l),p.h==0&&(p.src=null,m[dt]=null)):we(l)}}}function hs(l){return l in _e?_e[l]:_e[l]="on"+l}function pt(l,m){if(l.da)l=!0;else{m=new Oe(m,this);var p=l.listener,v=l.ha||l.src;l.fa&&en(l),l=p.call(v,m)}return l}function tn(l){return l=l[dt],l instanceof Be?l:null}var ht="__closure_events_fn_"+(1e9*Math.random()>>>0);function Lt(l){return typeof l=="function"?l:(l[ht]||(l[ht]=function(m){return l.handleEvent(m)}),l[ht])}function L(){W.call(this),this.i=new Be(this),this.M=this,this.F=null}C(L,W),L.prototype[ue]=!0,L.prototype.removeEventListener=function(l,m,p,v){Ye(this,l,m,p,v)};function U(l,m){var p,v=l.F;if(v)for(p=[];v;v=v.F)p.push(v);if(l=l.M,v=m.type||m,typeof m=="string")m=new te(m,l);else if(m instanceof te)m.target=m.target||l;else{var O=m;m=new te(v,l),A(m,O)}if(O=!0,p)for(var $=p.length-1;0<=$;$--){var re=m.g=p[$];O=be(re,v,!0,m)&&O}if(re=m.g=l,O=be(re,v,!0,m)&&O,O=be(re,v,!1,m)&&O,p)for($=0;$<p.length;$++)re=m.g=p[$],O=be(re,v,!1,m)&&O}L.prototype.N=function(){if(L.aa.N.call(this),this.i){var l=this.i,m;for(m in l.g){for(var p=l.g[m],v=0;v<p.length;v++)we(p[v]);delete l.g[m],l.h--}}this.F=null},L.prototype.K=function(l,m,p,v){return this.i.add(String(l),m,!1,p,v)},L.prototype.L=function(l,m,p,v){return this.i.add(String(l),m,!0,p,v)};function be(l,m,p,v){if(m=l.i.g[String(m)],!m)return!0;m=m.concat();for(var O=!0,$=0;$<m.length;++$){var re=m[$];if(re&&!re.da&&re.capture==p){var nt=re.listener,Wt=re.ha||re.src;re.fa&&B(l.i,re),O=nt.call(Wt,v)!==!1&&O}}return O&&!v.defaultPrevented}function Ae(l,m,p){if(typeof l=="function")p&&(l=g(l,p));else if(l&&typeof l.handleEvent=="function")l=g(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(m)?-1:c.setTimeout(l,m||0)}function Bt(l){l.g=Ae(()=>{l.g=null,l.i&&(l.i=!1,Bt(l))},l.l);const m=l.h;l.h=null,l.m.apply(null,m)}class zt extends W{constructor(m,p){super(),this.m=m,this.l=p,this.h=null,this.i=!1,this.g=null}j(m){this.h=arguments,this.g?this.i=!0:Bt(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function mt(l){W.call(this),this.h=l,this.g={}}C(mt,W);var jr=[];function Dr(l){q(l.g,function(m,p){this.g.hasOwnProperty(p)&&en(m)},l),l.g={}}mt.prototype.N=function(){mt.aa.N.call(this),Dr(this)},mt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var tt=c.JSON.stringify,pr=c.JSON.parse,tr=class{stringify(l){return c.JSON.stringify(l,void 0)}parse(l){return c.JSON.parse(l,void 0)}};function zn(){}zn.prototype.h=null;function ms(l){return l.h||(l.h=l.i())}function Ot(){}var Rn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function R(){te.call(this,"d")}C(R,te);function ne(){te.call(this,"c")}C(ne,te);var xe={},Te=null;function me(){return Te=Te||new L}xe.La="serverreachability";function fe(l){te.call(this,xe.La,l)}C(fe,te);function ge(l){const m=me();U(m,new fe(m))}xe.STAT_EVENT="statevent";function De(l,m){te.call(this,xe.STAT_EVENT,l),this.stat=m}C(De,te);function $e(l){const m=me();U(m,new De(m,l))}xe.Ma="timingevent";function Mr(l,m){te.call(this,xe.Ma,l),this.size=m}C(Mr,te);function nn(l,m){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){l()},m)}function gr(){this.g=!0}gr.prototype.xa=function(){this.g=!1};function ri(l,m,p,v,O,$){l.info(function(){if(l.g)if($)for(var re="",nt=$.split("&"),Wt=0;Wt<nt.length;Wt++){var Ke=nt[Wt].split("=");if(1<Ke.length){var rn=Ke[0];Ke=Ke[1];var sn=rn.split("_");re=2<=sn.length&&sn[1]=="type"?re+(rn+"="+Ke+"&"):re+(rn+"=redacted&")}}else re=null;else re=$;return"XMLHTTP REQ ("+v+") [attempt "+O+"]: "+m+`
`+p+`
`+re})}function ji(l,m,p,v,O,$,re){l.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+O+"]: "+m+`
`+p+`
`+$+" "+re})}function nr(l,m,p,v){l.info(function(){return"XMLHTTP TEXT ("+m+"): "+Di(l,p)+(v?" "+v:"")})}function $a(l,m){l.info(function(){return"TIMEOUT: "+m})}gr.prototype.info=function(){};function Di(l,m){if(!l.g)return m;if(!m)return null;try{var p=JSON.parse(m);if(p){for(l=0;l<p.length;l++)if(Array.isArray(p[l])){var v=p[l];if(!(2>v.length)){var O=v[1];if(Array.isArray(O)&&!(1>O.length)){var $=O[0];if($!="noop"&&$!="stop"&&$!="close")for(var re=1;re<O.length;re++)O[re]=""}}}}return tt(p)}catch{return m}}var M={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},V={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},se;function J(){}C(J,zn),J.prototype.g=function(){return new XMLHttpRequest},J.prototype.i=function(){return{}},se=new J;function Y(l,m,p,v){this.j=l,this.i=m,this.l=p,this.R=v||1,this.U=new mt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ye}function ye(){this.i=null,this.g="",this.h=!1}var z={},oe={};function Pe(l,m,p){l.L=1,l.v=Cl(Or(m)),l.m=p,l.P=!0,ae(l,null)}function ae(l,m){l.F=Date.now(),st(l),l.A=Or(l.v);var p=l.A,v=l.R;Array.isArray(v)||(v=[String(v)]),bp(p.i,"t",v),l.C=0,p=l.j.J,l.h=new ye,l.g=$p(l.j,p?m:null,!l.m),0<l.O&&(l.M=new zt(g(l.Y,l,l.g),l.O)),m=l.U,p=l.g,v=l.ca;var O="readystatechange";Array.isArray(O)||(O&&(jr[0]=O.toString()),O=jr);for(var $=0;$<O.length;$++){var re=Tt(p,O[$],v||m.handleEvent,!1,m.h||m);if(!re)break;m.g[re.key]=re}m=l.H?_(l.H):{},l.m?(l.u||(l.u="POST"),m["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,m)):(l.u="GET",l.g.ea(l.A,l.u,null,m)),ge(),ri(l.i,l.u,l.A,l.l,l.R,l.m)}Y.prototype.ca=function(l){l=l.target;const m=this.M;m&&Vr(l)==3?m.j():this.Y(l)},Y.prototype.Y=function(l){try{if(l==this.g)e:{const sn=Vr(this.g);var m=this.g.Ba();const Oi=this.g.Z();if(!(3>sn)&&(sn!=3||this.g&&(this.h.h||this.g.oa()||kp(this.g)))){this.J||sn!=4||m==7||(m==8||0>=Oi?ge(3):ge(2)),Ht(this);var p=this.g.Z();this.X=p;t:if(X(this)){var v=kp(this.g);l="";var O=v.length,$=Vr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){fn(this),bt(this);var re="";break t}this.h.i=new c.TextDecoder}for(m=0;m<O;m++)this.h.h=!0,l+=this.h.i.decode(v[m],{stream:!($&&m==O-1)});v.length=0,this.h.g+=l,this.C=0,re=this.h.g}else re=this.g.oa();if(this.o=p==200,ji(this.i,this.u,this.A,this.l,this.R,sn,p),this.o){if(this.T&&!this.K){t:{if(this.g){var nt,Wt=this.g;if((nt=Wt.g?Wt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!b(nt)){var Ke=nt;break t}}Ke=null}if(p=Ke)nr(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,yr(this,p);else{this.o=!1,this.s=3,$e(12),fn(this),bt(this);break e}}if(this.P){p=!0;let rr;for(;!this.J&&this.C<re.length;)if(rr=Se(this,re),rr==oe){sn==4&&(this.s=4,$e(14),p=!1),nr(this.i,this.l,null,"[Incomplete Response]");break}else if(rr==z){this.s=4,$e(15),nr(this.i,this.l,re,"[Invalid Chunk]"),p=!1;break}else nr(this.i,this.l,rr,null),yr(this,rr);if(X(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),sn!=4||re.length!=0||this.h.h||(this.s=1,$e(16),p=!1),this.o=this.o&&p,!p)nr(this.i,this.l,re,"[Invalid Chunked Response]"),fn(this),bt(this);else if(0<re.length&&!this.W){this.W=!0;var rn=this.j;rn.g==this&&rn.ba&&!rn.M&&(rn.j.info("Great, no buffering proxy detected. Bytes received: "+re.length),ad(rn),rn.M=!0,$e(11))}}else nr(this.i,this.l,re,null),yr(this,re);sn==4&&fn(this),this.o&&!this.J&&(sn==4?Mp(this.j,this):(this.o=!1,st(this)))}else S_(this.g),p==400&&0<re.indexOf("Unknown SID")?(this.s=3,$e(12)):(this.s=0,$e(13)),fn(this),bt(this)}}}catch{}finally{}};function X(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function Se(l,m){var p=l.C,v=m.indexOf(`
`,p);return v==-1?oe:(p=Number(m.substring(p,v)),isNaN(p)?z:(v+=1,v+p>m.length?oe:(m=m.slice(v,v+p),l.C=v+p,m)))}Y.prototype.cancel=function(){this.J=!0,fn(this)};function st(l){l.S=Date.now()+l.I,Ge(l,l.I)}function Ge(l,m){if(l.B!=null)throw Error("WatchDog timer not null");l.B=nn(g(l.ba,l),m)}function Ht(l){l.B&&(c.clearTimeout(l.B),l.B=null)}Y.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?($a(this.i,this.A),this.L!=2&&(ge(),$e(17)),fn(this),this.s=2,bt(this)):Ge(this,this.S-l)};function bt(l){l.j.G==0||l.J||Mp(l.j,l)}function fn(l){Ht(l);var m=l.M;m&&typeof m.ma=="function"&&m.ma(),l.M=null,Dr(l.U),l.g&&(m=l.g,l.g=null,m.abort(),m.ma())}function yr(l,m){try{var p=l.j;if(p.G!=0&&(p.g==l||Hn(p.h,l))){if(!l.K&&Hn(p.h,l)&&p.G==3){try{var v=p.Da.g.parse(m)}catch{v=null}if(Array.isArray(v)&&v.length==3){var O=v;if(O[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<l.F)Pl(p),Il(p);else break e;id(p),$e(18)}}else p.za=O[1],0<p.za-p.T&&37500>O[2]&&p.F&&p.v==0&&!p.C&&(p.C=nn(g(p.Za,p),6e3));if(1>=xr(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else ai(p,11)}else if((l.K||p.g==l)&&Pl(p),!b(m))for(O=p.Da.g.parse(m),m=0;m<O.length;m++){let Ke=O[m];if(p.T=Ke[0],Ke=Ke[1],p.G==2)if(Ke[0]=="c"){p.K=Ke[1],p.ia=Ke[2];const rn=Ke[3];rn!=null&&(p.la=rn,p.j.info("VER="+p.la));const sn=Ke[4];sn!=null&&(p.Aa=sn,p.j.info("SVER="+p.Aa));const Oi=Ke[5];Oi!=null&&typeof Oi=="number"&&0<Oi&&(v=1.5*Oi,p.L=v,p.j.info("backChannelRequestTimeoutMs_="+v)),v=p;const rr=l.g;if(rr){const jl=rr.g?rr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(jl){var $=v.h;$.g||jl.indexOf("spdy")==-1&&jl.indexOf("quic")==-1&&jl.indexOf("h2")==-1||($.j=$.l,$.g=new Set,$.h&&(Wn($,$.h),$.h=null))}if(v.D){const od=rr.g?rr.g.getResponseHeader("X-HTTP-Session-Id"):null;od&&(v.ya=od,it(v.I,v.D,od))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-l.F,p.j.info("Handshake RTT: "+p.R+"ms")),v=p;var re=l;if(v.qa=Vp(v,v.J?v.ia:null,v.W),re.K){si(v.h,re);var nt=re,Wt=v.L;Wt&&(nt.I=Wt),nt.B&&(Ht(nt),st(nt)),v.g=re}else jp(v);0<p.i.length&&Al(p)}else Ke[0]!="stop"&&Ke[0]!="close"||ai(p,7);else p.G==3&&(Ke[0]=="stop"||Ke[0]=="close"?Ke[0]=="stop"?ai(p,7):sd(p):Ke[0]!="noop"&&p.l&&p.l.ta(Ke),p.v=0)}}ge(4)}catch{}}var Lr=class{constructor(l,m){this.g=l,this.map=m}};function vr(l){this.l=l||10,c.PerformanceNavigationTiming?(l=c.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Vt(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function xr(l){return l.h?1:l.g?l.g.size:0}function Hn(l,m){return l.h?l.h==m:l.g?l.g.has(m):!1}function Wn(l,m){l.g?l.g.add(m):l.h=m}function si(l,m){l.h&&l.h==m?l.h=null:l.g&&l.g.has(m)&&l.g.delete(m)}vr.prototype.cancel=function(){if(this.i=qn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function qn(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let m=l.i;for(const p of l.g.values())m=m.concat(p.D);return m}return y(l.i)}function td(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var m=[],p=l.length,v=0;v<p;v++)m.push(l[v]);return m}m=[],p=0;for(v in l)m[p++]=l[v];return m}function Je(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||typeof l=="string"){var m=[];l=l.length;for(var p=0;p<l;p++)m.push(p);return m}m=[],p=0;for(const v in l)m[p++]=v;return m}}}function ii(l,m){if(l.forEach&&typeof l.forEach=="function")l.forEach(m,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,m,void 0);else for(var p=Je(l),v=td(l),O=v.length,$=0;$<O;$++)m.call(void 0,v[$],p&&p[$],l)}var nd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function jn(l,m){if(l){l=l.split("&");for(var p=0;p<l.length;p++){var v=l[p].indexOf("="),O=null;if(0<=v){var $=l[p].substring(0,v);O=l[p].substring(v+1)}else $=l[p];m($,O?decodeURIComponent(O.replace(/\+/g," ")):"")}}}function wr(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof wr){this.h=l.h,El(this,l.j),this.o=l.o,this.g=l.g,Tl(this,l.s),this.l=l.l;var m=l.i,p=new Ba;p.i=m.i,m.g&&(p.g=new Map(m.g),p.h=m.h),yp(this,p),this.m=l.m}else l&&(m=String(l).match(nd))?(this.h=!1,El(this,m[1]||"",!0),this.o=Fa(m[2]||""),this.g=Fa(m[3]||"",!0),Tl(this,m[4]),this.l=Fa(m[5]||"",!0),yp(this,m[6]||"",!0),this.m=Fa(m[7]||"")):(this.h=!1,this.i=new Ba(null,this.h))}wr.prototype.toString=function(){var l=[],m=this.j;m&&l.push(Ua(m,vp,!0),":");var p=this.g;return(p||m=="file")&&(l.push("//"),(m=this.o)&&l.push(Ua(m,vp,!0),"@"),l.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&l.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&l.push("/"),l.push(Ua(p,p.charAt(0)=="/"?y_:g_,!0))),(p=this.i.toString())&&l.push("?",p),(p=this.m)&&l.push("#",Ua(p,x_)),l.join("")};function Or(l){return new wr(l)}function El(l,m,p){l.j=p?Fa(m,!0):m,l.j&&(l.j=l.j.replace(/:$/,""))}function Tl(l,m){if(m){if(m=Number(m),isNaN(m)||0>m)throw Error("Bad port number "+m);l.s=m}else l.s=null}function yp(l,m,p){m instanceof Ba?(l.i=m,w_(l.i,l.h)):(p||(m=Ua(m,v_)),l.i=new Ba(m,l.h))}function it(l,m,p){l.i.set(m,p)}function Cl(l){return it(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Fa(l,m){return l?m?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Ua(l,m,p){return typeof l=="string"?(l=encodeURI(l).replace(m,p_),p&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function p_(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var vp=/[#\/\?@]/g,g_=/[#\?:]/g,y_=/[#\?]/g,v_=/[#\?@]/g,x_=/#/g;function Ba(l,m){this.h=this.g=null,this.i=l||null,this.j=!!m}function fs(l){l.g||(l.g=new Map,l.h=0,l.i&&jn(l.i,function(m,p){l.add(decodeURIComponent(m.replace(/\+/g," ")),p)}))}t=Ba.prototype,t.add=function(l,m){fs(this),this.i=null,l=Mi(this,l);var p=this.g.get(l);return p||this.g.set(l,p=[]),p.push(m),this.h+=1,this};function xp(l,m){fs(l),m=Mi(l,m),l.g.has(m)&&(l.i=null,l.h-=l.g.get(m).length,l.g.delete(m))}function wp(l,m){return fs(l),m=Mi(l,m),l.g.has(m)}t.forEach=function(l,m){fs(this),this.g.forEach(function(p,v){p.forEach(function(O){l.call(m,O,v,this)},this)},this)},t.na=function(){fs(this);const l=Array.from(this.g.values()),m=Array.from(this.g.keys()),p=[];for(let v=0;v<m.length;v++){const O=l[v];for(let $=0;$<O.length;$++)p.push(m[v])}return p},t.V=function(l){fs(this);let m=[];if(typeof l=="string")wp(this,l)&&(m=m.concat(this.g.get(Mi(this,l))));else{l=Array.from(this.g.values());for(let p=0;p<l.length;p++)m=m.concat(l[p])}return m},t.set=function(l,m){return fs(this),this.i=null,l=Mi(this,l),wp(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[m]),this.h+=1,this},t.get=function(l,m){return l?(l=this.V(l),0<l.length?String(l[0]):m):m};function bp(l,m,p){xp(l,m),0<p.length&&(l.i=null,l.g.set(Mi(l,m),y(p)),l.h+=p.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],m=Array.from(this.g.keys());for(var p=0;p<m.length;p++){var v=m[p];const $=encodeURIComponent(String(v)),re=this.V(v);for(v=0;v<re.length;v++){var O=$;re[v]!==""&&(O+="="+encodeURIComponent(String(re[v]))),l.push(O)}}return this.i=l.join("&")};function Mi(l,m){return m=String(m),l.j&&(m=m.toLowerCase()),m}function w_(l,m){m&&!l.j&&(fs(l),l.i=null,l.g.forEach(function(p,v){var O=v.toLowerCase();v!=O&&(xp(this,v),bp(this,O,p))},l)),l.j=m}function b_(l,m){const p=new gr;if(c.Image){const v=new Image;v.onload=x(ps,p,"TestLoadImage: loaded",!0,m,v),v.onerror=x(ps,p,"TestLoadImage: error",!1,m,v),v.onabort=x(ps,p,"TestLoadImage: abort",!1,m,v),v.ontimeout=x(ps,p,"TestLoadImage: timeout",!1,m,v),c.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=l}else m(!1)}function __(l,m){const p=new gr,v=new AbortController,O=setTimeout(()=>{v.abort(),ps(p,"TestPingServer: timeout",!1,m)},1e4);fetch(l,{signal:v.signal}).then($=>{clearTimeout(O),$.ok?ps(p,"TestPingServer: ok",!0,m):ps(p,"TestPingServer: server error",!1,m)}).catch(()=>{clearTimeout(O),ps(p,"TestPingServer: error",!1,m)})}function ps(l,m,p,v,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),v(p)}catch{}}function E_(){this.g=new tr}function T_(l,m,p){const v=p||"";try{ii(l,function(O,$){let re=O;d(O)&&(re=tt(O)),m.push(v+$+"="+encodeURIComponent(re))})}catch(O){throw m.push(v+"type="+encodeURIComponent("_badmap")),O}}function Nl(l){this.l=l.Ub||null,this.j=l.eb||!1}C(Nl,zn),Nl.prototype.g=function(){return new Sl(this.l,this.j)},Nl.prototype.i=function(l){return function(){return l}}({});function Sl(l,m){L.call(this),this.D=l,this.o=m,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(Sl,L),t=Sl.prototype,t.open=function(l,m){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=m,this.readyState=1,Ha(this)},t.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const m={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(m.body=l),(this.D||c).fetch(new Request(this.A,m)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,za(this)),this.readyState=0},t.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Ha(this)),this.g&&(this.readyState=3,Ha(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;_p(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function _p(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}t.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var m=l.value?l.value:new Uint8Array(0);(m=this.v.decode(m,{stream:!l.done}))&&(this.response=this.responseText+=m)}l.done?za(this):Ha(this),this.readyState==3&&_p(this)}},t.Ra=function(l){this.g&&(this.response=this.responseText=l,za(this))},t.Qa=function(l){this.g&&(this.response=l,za(this))},t.ga=function(){this.g&&za(this)};function za(l){l.readyState=4,l.l=null,l.j=null,l.v=null,Ha(l)}t.setRequestHeader=function(l,m){this.u.append(l,m)},t.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],m=this.h.entries();for(var p=m.next();!p.done;)p=p.value,l.push(p[0]+": "+p[1]),p=m.next();return l.join(`\r
`)};function Ha(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Sl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function Ep(l){let m="";return q(l,function(p,v){m+=v,m+=":",m+=p,m+=`\r
`}),m}function rd(l,m,p){e:{for(v in p){var v=!1;break e}v=!0}v||(p=Ep(p),typeof l=="string"?p!=null&&encodeURIComponent(String(p)):it(l,m,p))}function _t(l){L.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(_t,L);var C_=/^https?$/i,N_=["POST","PUT"];t=_t.prototype,t.Ha=function(l){this.J=l},t.ea=function(l,m,p,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);m=m?m.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():se.g(),this.v=this.o?ms(this.o):ms(se),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(m,String(l),!0),this.B=!1}catch($){Tp(this,$);return}if(l=p||"",p=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var O in v)p.set(O,v[O]);else if(typeof v.keys=="function"&&typeof v.get=="function")for(const $ of v.keys())p.set($,v.get($));else throw Error("Unknown input type for opt_headers: "+String(v));v=Array.from(p.keys()).find($=>$.toLowerCase()=="content-type"),O=c.FormData&&l instanceof c.FormData,!(0<=Array.prototype.indexOf.call(N_,m,void 0))||v||O||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[$,re]of p)this.g.setRequestHeader($,re);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Sp(this),this.u=!0,this.g.send(l),this.u=!1}catch($){Tp(this,$)}};function Tp(l,m){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=m,l.m=5,Cp(l),kl(l)}function Cp(l){l.A||(l.A=!0,U(l,"complete"),U(l,"error"))}t.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,U(this,"complete"),U(this,"abort"),kl(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),kl(this,!0)),_t.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Np(this):this.bb())},t.bb=function(){Np(this)};function Np(l){if(l.h&&typeof a<"u"&&(!l.v[1]||Vr(l)!=4||l.Z()!=2)){if(l.u&&Vr(l)==4)Ae(l.Ea,0,l);else if(U(l,"readystatechange"),Vr(l)==4){l.h=!1;try{const re=l.Z();e:switch(re){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var m=!0;break e;default:m=!1}var p;if(!(p=m)){var v;if(v=re===0){var O=String(l.D).match(nd)[1]||null;!O&&c.self&&c.self.location&&(O=c.self.location.protocol.slice(0,-1)),v=!C_.test(O?O.toLowerCase():"")}p=v}if(p)U(l,"complete"),U(l,"success");else{l.m=6;try{var $=2<Vr(l)?l.g.statusText:""}catch{$=""}l.l=$+" ["+l.Z()+"]",Cp(l)}}finally{kl(l)}}}}function kl(l,m){if(l.g){Sp(l);const p=l.g,v=l.v[0]?()=>{}:null;l.g=null,l.v=null,m||U(l,"ready");try{p.onreadystatechange=v}catch{}}}function Sp(l){l.I&&(c.clearTimeout(l.I),l.I=null)}t.isActive=function(){return!!this.g};function Vr(l){return l.g?l.g.readyState:0}t.Z=function(){try{return 2<Vr(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(l){if(this.g){var m=this.g.responseText;return l&&m.indexOf(l)==0&&(m=m.substring(l.length)),pr(m)}};function kp(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function S_(l){const m={};l=(l.g&&2<=Vr(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let v=0;v<l.length;v++){if(b(l[v]))continue;var p=D(l[v]);const O=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();const $=m[O]||[];m[O]=$,$.push(p)}E(m,function(v){return v.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Wa(l,m,p){return p&&p.internalChannelParams&&p.internalChannelParams[l]||m}function Ip(l){this.Aa=0,this.i=[],this.j=new gr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Wa("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Wa("baseRetryDelayMs",5e3,l),this.cb=Wa("retryDelaySeedMs",1e4,l),this.Wa=Wa("forwardChannelMaxRetries",2,l),this.wa=Wa("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new vr(l&&l.concurrentRequestLimit),this.Da=new E_,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=Ip.prototype,t.la=8,t.G=1,t.connect=function(l,m,p,v){$e(0),this.W=l,this.H=m||{},p&&v!==void 0&&(this.H.OSID=p,this.H.OAID=v),this.F=this.X,this.I=Vp(this,null,this.W),Al(this)};function sd(l){if(Ap(l),l.G==3){var m=l.U++,p=Or(l.I);if(it(p,"SID",l.K),it(p,"RID",m),it(p,"TYPE","terminate"),qa(l,p),m=new Y(l,l.j,m),m.L=2,m.v=Cl(Or(p)),p=!1,c.navigator&&c.navigator.sendBeacon)try{p=c.navigator.sendBeacon(m.v.toString(),"")}catch{}!p&&c.Image&&(new Image().src=m.v,p=!0),p||(m.g=$p(m.j,null),m.g.ea(m.v)),m.F=Date.now(),st(m)}Op(l)}function Il(l){l.g&&(ad(l),l.g.cancel(),l.g=null)}function Ap(l){Il(l),l.u&&(c.clearTimeout(l.u),l.u=null),Pl(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&c.clearTimeout(l.s),l.s=null)}function Al(l){if(!Vt(l.h)&&!l.s){l.s=!0;var m=l.Ga;Ne||ve(),G||(Ne(),G=!0),ie.add(m,l),l.B=0}}function k_(l,m){return xr(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=m.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=nn(g(l.Ga,l,m),Lp(l,l.B)),l.B++,!0)}t.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const O=new Y(this,this.j,l);let $=this.o;if(this.S&&($?($=_($),A($,this.S)):$=this.S),this.m!==null||this.O||(O.H=$,$=null),this.P)e:{for(var m=0,p=0;p<this.i.length;p++){t:{var v=this.i[p];if("__data__"in v.map&&(v=v.map.__data__,typeof v=="string")){v=v.length;break t}v=void 0}if(v===void 0)break;if(m+=v,4096<m){m=p;break e}if(m===4096||p===this.i.length-1){m=p+1;break e}}m=1e3}else m=1e3;m=Rp(this,O,m),p=Or(this.I),it(p,"RID",l),it(p,"CVER",22),this.D&&it(p,"X-HTTP-Session-Id",this.D),qa(this,p),$&&(this.O?m="headers="+encodeURIComponent(String(Ep($)))+"&"+m:this.m&&rd(p,this.m,$)),Wn(this.h,O),this.Ua&&it(p,"TYPE","init"),this.P?(it(p,"$req",m),it(p,"SID","null"),O.T=!0,Pe(O,p,null)):Pe(O,p,m),this.G=2}}else this.G==3&&(l?Pp(this,l):this.i.length==0||Vt(this.h)||Pp(this))};function Pp(l,m){var p;m?p=m.l:p=l.U++;const v=Or(l.I);it(v,"SID",l.K),it(v,"RID",p),it(v,"AID",l.T),qa(l,v),l.m&&l.o&&rd(v,l.m,l.o),p=new Y(l,l.j,p,l.B+1),l.m===null&&(p.H=l.o),m&&(l.i=m.D.concat(l.i)),m=Rp(l,p,1e3),p.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Wn(l.h,p),Pe(p,v,m)}function qa(l,m){l.H&&q(l.H,function(p,v){it(m,v,p)}),l.l&&ii({},function(p,v){it(m,v,p)})}function Rp(l,m,p){p=Math.min(l.i.length,p);var v=l.l?g(l.l.Na,l.l,l):null;e:{var O=l.i;let $=-1;for(;;){const re=["count="+p];$==-1?0<p?($=O[0].g,re.push("ofs="+$)):$=0:re.push("ofs="+$);let nt=!0;for(let Wt=0;Wt<p;Wt++){let Ke=O[Wt].g;const rn=O[Wt].map;if(Ke-=$,0>Ke)$=Math.max(0,O[Wt].g-100),nt=!1;else try{T_(rn,re,"req"+Ke+"_")}catch{v&&v(rn)}}if(nt){v=re.join("&");break e}}}return l=l.i.splice(0,p),m.D=l,v}function jp(l){if(!l.g&&!l.u){l.Y=1;var m=l.Fa;Ne||ve(),G||(Ne(),G=!0),ie.add(m,l),l.v=0}}function id(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=nn(g(l.Fa,l),Lp(l,l.v)),l.v++,!0)}t.Fa=function(){if(this.u=null,Dp(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=nn(g(this.ab,this),l)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,$e(10),Il(this),Dp(this))};function ad(l){l.A!=null&&(c.clearTimeout(l.A),l.A=null)}function Dp(l){l.g=new Y(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var m=Or(l.qa);it(m,"RID","rpc"),it(m,"SID",l.K),it(m,"AID",l.T),it(m,"CI",l.F?"0":"1"),!l.F&&l.ja&&it(m,"TO",l.ja),it(m,"TYPE","xmlhttp"),qa(l,m),l.m&&l.o&&rd(m,l.m,l.o),l.L&&(l.g.I=l.L);var p=l.g;l=l.ia,p.L=1,p.v=Cl(Or(m)),p.m=null,p.P=!0,ae(p,l)}t.Za=function(){this.C!=null&&(this.C=null,Il(this),id(this),$e(19))};function Pl(l){l.C!=null&&(c.clearTimeout(l.C),l.C=null)}function Mp(l,m){var p=null;if(l.g==m){Pl(l),ad(l),l.g=null;var v=2}else if(Hn(l.h,m))p=m.D,si(l.h,m),v=1;else return;if(l.G!=0){if(m.o)if(v==1){p=m.m?m.m.length:0,m=Date.now()-m.F;var O=l.B;v=me(),U(v,new Mr(v,p)),Al(l)}else jp(l);else if(O=m.s,O==3||O==0&&0<m.X||!(v==1&&k_(l,m)||v==2&&id(l)))switch(p&&0<p.length&&(m=l.h,m.i=m.i.concat(p)),O){case 1:ai(l,5);break;case 4:ai(l,10);break;case 3:ai(l,6);break;default:ai(l,2)}}}function Lp(l,m){let p=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(p*=2),p*m}function ai(l,m){if(l.j.info("Error code "+m),m==2){var p=g(l.fb,l),v=l.Xa;const O=!v;v=new wr(v||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||El(v,"https"),Cl(v),O?b_(v.toString(),p):__(v.toString(),p)}else $e(2);l.G=0,l.l&&l.l.sa(m),Op(l),Ap(l)}t.fb=function(l){l?(this.j.info("Successfully pinged google.com"),$e(2)):(this.j.info("Failed to ping google.com"),$e(1))};function Op(l){if(l.G=0,l.ka=[],l.l){const m=qn(l.h);(m.length!=0||l.i.length!=0)&&(k(l.ka,m),k(l.ka,l.i),l.h.i.length=0,y(l.i),l.i.length=0),l.l.ra()}}function Vp(l,m,p){var v=p instanceof wr?Or(p):new wr(p);if(v.g!="")m&&(v.g=m+"."+v.g),Tl(v,v.s);else{var O=c.location;v=O.protocol,m=m?m+"."+O.hostname:O.hostname,O=+O.port;var $=new wr(null);v&&El($,v),m&&($.g=m),O&&Tl($,O),p&&($.l=p),v=$}return p=l.D,m=l.ya,p&&m&&it(v,p,m),it(v,"VER",l.la),qa(l,v),v}function $p(l,m,p){if(m&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return m=l.Ca&&!l.pa?new _t(new Nl({eb:p})):new _t(l.pa),m.Ha(l.J),m}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Fp(){}t=Fp.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function Rl(){}Rl.prototype.g=function(l,m){return new Dn(l,m)};function Dn(l,m){L.call(this),this.g=new Ip(m),this.l=l,this.h=m&&m.messageUrlParams||null,l=m&&m.messageHeaders||null,m&&m.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=m&&m.initMessageHeaders||null,m&&m.messageContentType&&(l?l["X-WebChannel-Content-Type"]=m.messageContentType:l={"X-WebChannel-Content-Type":m.messageContentType}),m&&m.va&&(l?l["X-WebChannel-Client-Profile"]=m.va:l={"X-WebChannel-Client-Profile":m.va}),this.g.S=l,(l=m&&m.Sb)&&!b(l)&&(this.g.m=l),this.v=m&&m.supportsCrossDomainXhr||!1,this.u=m&&m.sendRawJson||!1,(m=m&&m.httpSessionIdParam)&&!b(m)&&(this.g.D=m,l=this.h,l!==null&&m in l&&(l=this.h,m in l&&delete l[m])),this.j=new Li(this)}C(Dn,L),Dn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Dn.prototype.close=function(){sd(this.g)},Dn.prototype.o=function(l){var m=this.g;if(typeof l=="string"){var p={};p.__data__=l,l=p}else this.u&&(p={},p.__data__=tt(l),l=p);m.i.push(new Lr(m.Ya++,l)),m.G==3&&Al(m)},Dn.prototype.N=function(){this.g.l=null,delete this.j,sd(this.g),delete this.g,Dn.aa.N.call(this)};function Up(l){R.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var m=l.__sm__;if(m){e:{for(const p in m){l=p;break e}l=void 0}(this.i=l)&&(l=this.i,m=m!==null&&l in m?m[l]:void 0),this.data=m}else this.data=l}C(Up,R);function Bp(){ne.call(this),this.status=1}C(Bp,ne);function Li(l){this.g=l}C(Li,Fp),Li.prototype.ua=function(){U(this.g,"a")},Li.prototype.ta=function(l){U(this.g,new Up(l))},Li.prototype.sa=function(l){U(this.g,new Bp)},Li.prototype.ra=function(){U(this.g,"b")},Rl.prototype.createWebChannel=Rl.prototype.g,Dn.prototype.send=Dn.prototype.o,Dn.prototype.open=Dn.prototype.m,Dn.prototype.close=Dn.prototype.close,Gw=function(){return new Rl},qw=function(){return me()},Ww=xe,Zh={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},M.NO_ERROR=0,M.TIMEOUT=8,M.HTTP_ERROR=6,xc=M,V.COMPLETE="complete",Hw=V,Ot.EventType=Rn,Rn.OPEN="a",Rn.CLOSE="b",Rn.ERROR="c",Rn.MESSAGE="d",L.prototype.listen=L.prototype.K,lo=Ot,_t.prototype.listenOnce=_t.prototype.L,_t.prototype.getLastError=_t.prototype.Ka,_t.prototype.getLastErrorCode=_t.prototype.Ba,_t.prototype.getStatus=_t.prototype.Z,_t.prototype.getResponseJson=_t.prototype.Oa,_t.prototype.getResponseText=_t.prototype.oa,_t.prototype.send=_t.prototype.ea,_t.prototype.setWithCredentials=_t.prototype.Ha,zw=_t}).apply(typeof Xl<"u"?Xl:typeof self<"u"?self:typeof window<"u"?window:{});const Ly="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}cn.UNAUTHENTICATED=new cn(null),cn.GOOGLE_CREDENTIALS=new cn("google-credentials-uid"),cn.FIRST_PARTY=new cn("first-party-uid"),cn.MOCK_USER=new cn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Da="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ci=new pf("@firebase/firestore");function to(){return Ci.logLevel}function pe(t,...e){if(Ci.logLevel<=ze.DEBUG){const n=e.map(Sf);Ci.debug(`Firestore (${Da}): ${t}`,...n)}}function rs(t,...e){if(Ci.logLevel<=ze.ERROR){const n=e.map(Sf);Ci.error(`Firestore (${Da}): ${t}`,...n)}}function wa(t,...e){if(Ci.logLevel<=ze.WARN){const n=e.map(Sf);Ci.warn(`Firestore (${Da}): ${t}`,...n)}}function Sf(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ke(t="Unexpected state"){const e=`FIRESTORE (${Da}) INTERNAL ASSERTION FAILED: `+t;throw rs(e),new Error(e)}function Ze(t,e){t||ke()}function je(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class le extends ls{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class eI{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(cn.UNAUTHENTICATED))}shutdown(){}}class tI{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class nI{constructor(e){this.t=e,this.currentUser=cn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Ze(this.o===void 0);let r=this.i;const s=u=>this.i!==r?(r=this.i,n(u)):Promise.resolve();let i=new Yr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Yr,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const u=i;e.enqueueRetryable(async()=>{await u.promise,await s(this.currentUser)})},c=u=>{pe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?c(u):(pe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Yr)}},0),a()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(pe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ze(typeof r.accessToken=="string"),new Kw(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ze(e===null||typeof e=="string"),new cn(e)}}class rI{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=cn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class sI{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new rI(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(cn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class iI{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class aI{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){Ze(this.o===void 0);const r=i=>{i.error!=null&&pe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.R;return this.R=i.token,pe("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{pe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):pe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Ze(typeof n.token=="string"),this.R=n.token,new iI(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oI(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=oI(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%e.length))}return r}}function Qe(t,e){return t<e?-1:t>e?1:0}function ba(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new le(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new le(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new le(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new le(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Dt.fromMillis(Date.now())}static fromDate(e){return Dt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new Dt(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Qe(this.nanoseconds,e.nanoseconds):Qe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Re(e)}static min(){return new Re(new Dt(0,0))}static max(){return new Re(new Dt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(e,n,r){n===void 0?n=0:n>e.length&&ke(),r===void 0?r=e.length-n:r>e.length-n&&ke(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Qo.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Qo?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=e.get(s),a=n.get(s);if(i<a)return-1;if(i>a)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class ot extends Qo{construct(e,n,r){return new ot(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new le(H.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new ot(n)}static emptyPath(){return new ot([])}}const lI=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Kt extends Qo{construct(e,n,r){return new Kt(e,n,r)}static isValidIdentifier(e){return lI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Kt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Kt(["__name__"])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new le(H.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let a=!1;for(;s<e.length;){const c=e[s];if(c==="\\"){if(s+1===e.length)throw new le(H.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new le(H.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(r+=c,s++):(i(),s++)}if(i(),a)throw new le(H.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Kt(n)}static emptyPath(){return new Kt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ee{constructor(e){this.path=e}static fromPath(e){return new Ee(ot.fromString(e))}static fromName(e){return new Ee(ot.fromString(e).popFirst(5))}static empty(){return new Ee(ot.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ot.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return ot.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ee(new ot(e.slice()))}}function cI(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=Re.fromTimestamp(r===1e9?new Dt(n+1,0):new Dt(n,r));return new qs(s,Ee.empty(),e)}function uI(t){return new qs(t.readTime,t.key,-1)}class qs{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new qs(Re.min(),Ee.empty(),-1)}static max(){return new qs(Re.max(),Ee.empty(),-1)}}function dI(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Ee.comparator(t.documentKey,e.documentKey),n!==0?n:Qe(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class mI{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fl(t){if(t.code!==H.FAILED_PRECONDITION||t.message!==hI)throw t;pe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ke(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new K((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof K?n:K.resolve(n)}catch(n){return K.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):K.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):K.reject(n)}static resolve(e){return new K((n,r)=>{n(e)})}static reject(e){return new K((n,r)=>{r(e)})}static waitFor(e){return new K((n,r)=>{let s=0,i=0,a=!1;e.forEach(c=>{++s,c.next(()=>{++i,a&&i===s&&n()},u=>r(u))}),a=!0,i===s&&n()})}static or(e){let n=K.resolve(!1);for(const r of e)n=n.next(s=>s?K.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new K((r,s)=>{const i=e.length,a=new Array(i);let c=0;for(let u=0;u<i;u++){const d=u;n(e[d]).next(h=>{a[d]=h,++c,c===i&&r(a)},h=>s(h))}})}static doWhile(e,n){return new K((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}function fI(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function pl(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}kf.oe=-1;function Ou(t){return t==null}function au(t){return t===0&&1/t==-1/0}function pI(t){return typeof t=="number"&&Number.isInteger(t)&&!au(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oy(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Pi(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Yw(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e,n){this.comparator=e,this.root=n||Gt.EMPTY}insert(e,n){return new xt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Gt.BLACK,null,null))}remove(e){return new xt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Gt.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Zl(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Zl(this.root,e,this.comparator,!1)}getReverseIterator(){return new Zl(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Zl(this.root,e,this.comparator,!0)}}class Zl{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Gt{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??Gt.RED,this.left=s??Gt.EMPTY,this.right=i??Gt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new Gt(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Gt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return Gt.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Gt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Gt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ke();const e=this.left.check();if(e!==this.right.check())throw ke();return e+(this.isRed()?0:1)}}Gt.EMPTY=null,Gt.RED=!0,Gt.BLACK=!1;Gt.EMPTY=new class{constructor(){this.size=0}get key(){throw ke()}get value(){throw ke()}get color(){throw ke()}get left(){throw ke()}get right(){throw ke()}copy(e,n,r,s,i){return this}insert(e,n,r){return new Gt(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e){this.comparator=e,this.data=new xt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Vy(this.data.getIterator())}getIteratorFrom(e){return new Vy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof Yt)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Yt(this.comparator);return n.data=e,n}}class Vy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(e){this.fields=e,e.sort(Kt.comparator)}static empty(){return new Vn([])}unionWith(e){let n=new Yt(Kt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Vn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return ba(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Jw("Invalid base64 string: "+i):i}}(e);return new Xt(n)}static fromUint8Array(e){const n=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new Xt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Qe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Xt.EMPTY_BYTE_STRING=new Xt("");const gI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Gs(t){if(Ze(!!t),typeof t=="string"){let e=0;const n=gI.exec(t);if(Ze(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ct(t.seconds),nanos:Ct(t.nanos)}}function Ct(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ni(t){return typeof t=="string"?Xt.fromBase64String(t):Xt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function If(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Af(t){const e=t.mapValue.fields.__previous_value__;return If(e)?Af(e):e}function Yo(t){const e=Gs(t.mapValue.fields.__local_write_time__.timestampValue);return new Dt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yI{constructor(e,n,r,s,i,a,c,u,d){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=d}}class Jo{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new Jo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Jo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ec={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Si(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?If(t)?4:xI(t)?9007199254740991:vI(t)?10:11:ke()}function Rr(t,e){if(t===e)return!0;const n=Si(t);if(n!==Si(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Yo(t).isEqual(Yo(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=Gs(s.timestampValue),c=Gs(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return Ni(s.bytesValue).isEqual(Ni(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return Ct(s.geoPointValue.latitude)===Ct(i.geoPointValue.latitude)&&Ct(s.geoPointValue.longitude)===Ct(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Ct(s.integerValue)===Ct(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=Ct(s.doubleValue),c=Ct(i.doubleValue);return a===c?au(a)===au(c):isNaN(a)&&isNaN(c)}return!1}(t,e);case 9:return ba(t.arrayValue.values||[],e.arrayValue.values||[],Rr);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},c=i.mapValue.fields||{};if(Oy(a)!==Oy(c))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(c[u]===void 0||!Rr(a[u],c[u])))return!1;return!0}(t,e);default:return ke()}}function Xo(t,e){return(t.values||[]).find(n=>Rr(n,e))!==void 0}function _a(t,e){if(t===e)return 0;const n=Si(t),r=Si(e);if(n!==r)return Qe(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Qe(t.booleanValue,e.booleanValue);case 2:return function(i,a){const c=Ct(i.integerValue||i.doubleValue),u=Ct(a.integerValue||a.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(t,e);case 3:return $y(t.timestampValue,e.timestampValue);case 4:return $y(Yo(t),Yo(e));case 5:return Qe(t.stringValue,e.stringValue);case 6:return function(i,a){const c=Ni(i),u=Ni(a);return c.compareTo(u)}(t.bytesValue,e.bytesValue);case 7:return function(i,a){const c=i.split("/"),u=a.split("/");for(let d=0;d<c.length&&d<u.length;d++){const h=Qe(c[d],u[d]);if(h!==0)return h}return Qe(c.length,u.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,a){const c=Qe(Ct(i.latitude),Ct(a.latitude));return c!==0?c:Qe(Ct(i.longitude),Ct(a.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Fy(t.arrayValue,e.arrayValue);case 10:return function(i,a){var c,u,d,h;const f=i.fields||{},g=a.fields||{},x=(c=f.value)===null||c===void 0?void 0:c.arrayValue,C=(u=g.value)===null||u===void 0?void 0:u.arrayValue,y=Qe(((d=x==null?void 0:x.values)===null||d===void 0?void 0:d.length)||0,((h=C==null?void 0:C.values)===null||h===void 0?void 0:h.length)||0);return y!==0?y:Fy(x,C)}(t.mapValue,e.mapValue);case 11:return function(i,a){if(i===ec.mapValue&&a===ec.mapValue)return 0;if(i===ec.mapValue)return 1;if(a===ec.mapValue)return-1;const c=i.fields||{},u=Object.keys(c),d=a.fields||{},h=Object.keys(d);u.sort(),h.sort();for(let f=0;f<u.length&&f<h.length;++f){const g=Qe(u[f],h[f]);if(g!==0)return g;const x=_a(c[u[f]],d[h[f]]);if(x!==0)return x}return Qe(u.length,h.length)}(t.mapValue,e.mapValue);default:throw ke()}}function $y(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Qe(t,e);const n=Gs(t),r=Gs(e),s=Qe(n.seconds,r.seconds);return s!==0?s:Qe(n.nanos,r.nanos)}function Fy(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=_a(n[s],r[s]);if(i)return i}return Qe(n.length,r.length)}function Ea(t){return em(t)}function em(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=Gs(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Ni(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return Ee.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=em(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${em(n.fields[a])}`;return s+"}"}(t.mapValue):ke()}function Uy(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function tm(t){return!!t&&"integerValue"in t}function Pf(t){return!!t&&"arrayValue"in t}function By(t){return!!t&&"nullValue"in t}function zy(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function wc(t){return!!t&&"mapValue"in t}function vI(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function Eo(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Pi(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Eo(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Eo(t.arrayValue.values[n]);return e}return Object.assign({},t)}function xI(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{constructor(e){this.value=e}static empty(){return new Tn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!wc(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Eo(n)}setAll(e){let n=Kt.emptyPath(),r={},s=[];e.forEach((a,c)=>{if(!n.isImmediateParentOf(c)){const u=this.getFieldsMap(n);this.applyChanges(u,r,s),r={},s=[],n=c.popLast()}a?r[c.lastSegment()]=Eo(a):s.push(c.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());wc(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Rr(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];wc(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Pi(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Tn(Eo(this.value))}}function Xw(t){const e=[];return Pi(t.fields,(n,r)=>{const s=new Kt([n]);if(wc(r)){const i=Xw(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new Vn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e,n,r,s,i,a,c){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(e){return new dn(e,0,Re.min(),Re.min(),Re.min(),Tn.empty(),0)}static newFoundDocument(e,n,r,s){return new dn(e,1,n,Re.min(),r,s,0)}static newNoDocument(e,n){return new dn(e,2,n,Re.min(),Re.min(),Tn.empty(),0)}static newUnknownDocument(e,n){return new dn(e,3,n,Re.min(),Re.min(),Tn.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Re.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Tn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Tn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Re.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof dn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new dn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ou{constructor(e,n){this.position=e,this.inclusive=n}}function Hy(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],a=t.position[s];if(i.field.isKeyField()?r=Ee.comparator(Ee.fromName(a.referenceValue),n.key):r=_a(a,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Wy(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Rr(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lu{constructor(e,n="asc"){this.field=e,this.dir=n}}function wI(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zw{}class At extends Zw{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new _I(e,n,r):n==="array-contains"?new CI(e,r):n==="in"?new NI(e,r):n==="not-in"?new SI(e,r):n==="array-contains-any"?new kI(e,r):new At(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new EI(e,r):new TI(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(_a(n,this.value)):n!==null&&Si(this.value)===Si(n)&&this.matchesComparison(_a(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ke()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class mr extends Zw{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new mr(e,n)}matches(e){return eb(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function eb(t){return t.op==="and"}function tb(t){return bI(t)&&eb(t)}function bI(t){for(const e of t.filters)if(e instanceof mr)return!1;return!0}function nm(t){if(t instanceof At)return t.field.canonicalString()+t.op.toString()+Ea(t.value);if(tb(t))return t.filters.map(e=>nm(e)).join(",");{const e=t.filters.map(n=>nm(n)).join(",");return`${t.op}(${e})`}}function nb(t,e){return t instanceof At?function(r,s){return s instanceof At&&r.op===s.op&&r.field.isEqual(s.field)&&Rr(r.value,s.value)}(t,e):t instanceof mr?function(r,s){return s instanceof mr&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,c)=>i&&nb(a,s.filters[c]),!0):!1}(t,e):void ke()}function rb(t){return t instanceof At?function(n){return`${n.field.canonicalString()} ${n.op} ${Ea(n.value)}`}(t):t instanceof mr?function(n){return n.op.toString()+" {"+n.getFilters().map(rb).join(" ,")+"}"}(t):"Filter"}class _I extends At{constructor(e,n,r){super(e,n,r),this.key=Ee.fromName(r.referenceValue)}matches(e){const n=Ee.comparator(e.key,this.key);return this.matchesComparison(n)}}class EI extends At{constructor(e,n){super(e,"in",n),this.keys=sb("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class TI extends At{constructor(e,n){super(e,"not-in",n),this.keys=sb("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function sb(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>Ee.fromName(r.referenceValue))}class CI extends At{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Pf(n)&&Xo(n.arrayValue,this.value)}}class NI extends At{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Xo(this.value.arrayValue,n)}}class SI extends At{constructor(e,n){super(e,"not-in",n)}matches(e){if(Xo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!Xo(this.value.arrayValue,n)}}class kI extends At{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Pf(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Xo(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class II{constructor(e,n=null,r=[],s=[],i=null,a=null,c=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=c,this.ue=null}}function qy(t,e=null,n=[],r=[],s=null,i=null,a=null){return new II(t,e,n,r,s,i,a)}function Rf(t){const e=je(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>nm(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Ou(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Ea(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Ea(r)).join(",")),e.ue=n}return e.ue}function jf(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!wI(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!nb(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Wy(t.startAt,e.startAt)&&Wy(t.endAt,e.endAt)}function rm(t){return Ee.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gl{constructor(e,n=null,r=[],s=[],i=null,a="F",c=null,u=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function AI(t,e,n,r,s,i,a,c){return new gl(t,e,n,r,s,i,a,c)}function Vu(t){return new gl(t)}function Gy(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function ib(t){return t.collectionGroup!==null}function To(t){const e=je(t);if(e.ce===null){e.ce=[];const n=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new Yt(Kt.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(d=>{d.isInequality()&&(c=c.add(d.field))})}),c})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.ce.push(new lu(i,r))}),n.has(Kt.keyField().canonicalString())||e.ce.push(new lu(Kt.keyField(),r))}return e.ce}function Ar(t){const e=je(t);return e.le||(e.le=PI(e,To(t))),e.le}function PI(t,e){if(t.limitType==="F")return qy(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new lu(s.field,i)});const n=t.endAt?new ou(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new ou(t.startAt.position,t.startAt.inclusive):null;return qy(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function sm(t,e){const n=t.filters.concat([e]);return new gl(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function cu(t,e,n){return new gl(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function $u(t,e){return jf(Ar(t),Ar(e))&&t.limitType===e.limitType}function ab(t){return`${Rf(Ar(t))}|lt:${t.limitType}`}function Fi(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>rb(s)).join(", ")}]`),Ou(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Ea(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Ea(s)).join(",")),`Target(${r})`}(Ar(t))}; limitType=${t.limitType})`}function Fu(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Ee.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of To(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(a,c,u){const d=Hy(a,c,u);return a.inclusive?d<=0:d<0}(r.startAt,To(r),s)||r.endAt&&!function(a,c,u){const d=Hy(a,c,u);return a.inclusive?d>=0:d>0}(r.endAt,To(r),s))}(t,e)}function RI(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function ob(t){return(e,n)=>{let r=!1;for(const s of To(t)){const i=jI(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function jI(t,e,n){const r=t.field.isKeyField()?Ee.comparator(e.key,n.key):function(i,a,c){const u=a.data.field(i),d=c.data.field(i);return u!==null&&d!==null?_a(u,d):ke()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ke()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Pi(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Yw(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DI=new xt(Ee.comparator);function ss(){return DI}const lb=new xt(Ee.comparator);function co(...t){let e=lb;for(const n of t)e=e.insert(n.key,n);return e}function cb(t){let e=lb;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function mi(){return Co()}function ub(){return Co()}function Co(){return new Ma(t=>t.toString(),(t,e)=>t.isEqual(e))}const MI=new xt(Ee.comparator),LI=new Yt(Ee.comparator);function Ue(...t){let e=LI;for(const n of t)e=e.add(n);return e}const OI=new Yt(Qe);function VI(){return OI}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Df(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:au(e)?"-0":e}}function db(t){return{integerValue:""+t}}function $I(t,e){return pI(e)?db(e):Df(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(){this._=void 0}}function FI(t,e,n){return t instanceof Zo?function(s,i){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&If(i)&&(i=Af(i)),i&&(a.fields.__previous_value__=i),{mapValue:a}}(n,e):t instanceof el?mb(t,e):t instanceof tl?fb(t,e):function(s,i){const a=hb(s,i),c=Ky(a)+Ky(s.Pe);return tm(a)&&tm(s.Pe)?db(c):Df(s.serializer,c)}(t,e)}function UI(t,e,n){return t instanceof el?mb(t,e):t instanceof tl?fb(t,e):n}function hb(t,e){return t instanceof uu?function(r){return tm(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Zo extends Uu{}class el extends Uu{constructor(e){super(),this.elements=e}}function mb(t,e){const n=pb(e);for(const r of t.elements)n.some(s=>Rr(s,r))||n.push(r);return{arrayValue:{values:n}}}class tl extends Uu{constructor(e){super(),this.elements=e}}function fb(t,e){let n=pb(e);for(const r of t.elements)n=n.filter(s=>!Rr(s,r));return{arrayValue:{values:n}}}class uu extends Uu{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function Ky(t){return Ct(t.integerValue||t.doubleValue)}function pb(t){return Pf(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BI{constructor(e,n){this.field=e,this.transform=n}}function zI(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof el&&s instanceof el||r instanceof tl&&s instanceof tl?ba(r.elements,s.elements,Rr):r instanceof uu&&s instanceof uu?Rr(r.Pe,s.Pe):r instanceof Zo&&s instanceof Zo}(t.transform,e.transform)}class HI{constructor(e,n){this.version=e,this.transformResults=n}}class ur{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new ur}static exists(e){return new ur(void 0,e)}static updateTime(e){return new ur(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function bc(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Bu{}function gb(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Mf(t.key,ur.none()):new yl(t.key,t.data,ur.none());{const n=t.data,r=Tn.empty();let s=new Yt(Kt.comparator);for(let i of e.fields)if(!s.has(i)){let a=n.field(i);a===null&&i.length>1&&(i=i.popLast(),a=n.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new ti(t.key,r,new Vn(s.toArray()),ur.none())}}function WI(t,e,n){t instanceof yl?function(s,i,a){const c=s.value.clone(),u=Yy(s.fieldTransforms,i,a.transformResults);c.setAll(u),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(t,e,n):t instanceof ti?function(s,i,a){if(!bc(s.precondition,i))return void i.convertToUnknownDocument(a.version);const c=Yy(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(yb(s)),u.setAll(c),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(t,e,n):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,n)}function No(t,e,n,r){return t instanceof yl?function(i,a,c,u){if(!bc(i.precondition,a))return c;const d=i.value.clone(),h=Jy(i.fieldTransforms,u,a);return d.setAll(h),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof ti?function(i,a,c,u){if(!bc(i.precondition,a))return c;const d=Jy(i.fieldTransforms,u,a),h=a.data;return h.setAll(yb(i)),h.setAll(d),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(t,e,n,r):function(i,a,c){return bc(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c}(t,e,n)}function qI(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=hb(r.transform,s||null);i!=null&&(n===null&&(n=Tn.empty()),n.set(r.field,i))}return n||null}function Qy(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ba(r,s,(i,a)=>zI(i,a))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class yl extends Bu{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ti extends Bu{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function yb(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function Yy(t,e,n){const r=new Map;Ze(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],a=i.transform,c=e.data.field(i.field);r.set(i.field,UI(a,c,n[s]))}return r}function Jy(t,e,n){const r=new Map;for(const s of t){const i=s.transform,a=n.data.field(s.field);r.set(s.field,FI(i,a,e))}return r}class Mf extends Bu{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class GI extends Bu{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KI{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&WI(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=No(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=No(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=ub();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let c=this.applyToLocalView(a,i.mutatedFields);c=n.has(s.key)?null:c;const u=gb(a,c);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(Re.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ue())}isEqual(e){return this.batchId===e.batchId&&ba(this.mutations,e.mutations,(n,r)=>Qy(n,r))&&ba(this.baseMutations,e.baseMutations,(n,r)=>Qy(n,r))}}class Lf{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Ze(e.mutations.length===r.length);let s=function(){return MI}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new Lf(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QI{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YI{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kt,We;function JI(t){switch(t){default:return ke();case H.CANCELLED:case H.UNKNOWN:case H.DEADLINE_EXCEEDED:case H.RESOURCE_EXHAUSTED:case H.INTERNAL:case H.UNAVAILABLE:case H.UNAUTHENTICATED:return!1;case H.INVALID_ARGUMENT:case H.NOT_FOUND:case H.ALREADY_EXISTS:case H.PERMISSION_DENIED:case H.FAILED_PRECONDITION:case H.ABORTED:case H.OUT_OF_RANGE:case H.UNIMPLEMENTED:case H.DATA_LOSS:return!0}}function vb(t){if(t===void 0)return rs("GRPC error has no .code"),H.UNKNOWN;switch(t){case kt.OK:return H.OK;case kt.CANCELLED:return H.CANCELLED;case kt.UNKNOWN:return H.UNKNOWN;case kt.DEADLINE_EXCEEDED:return H.DEADLINE_EXCEEDED;case kt.RESOURCE_EXHAUSTED:return H.RESOURCE_EXHAUSTED;case kt.INTERNAL:return H.INTERNAL;case kt.UNAVAILABLE:return H.UNAVAILABLE;case kt.UNAUTHENTICATED:return H.UNAUTHENTICATED;case kt.INVALID_ARGUMENT:return H.INVALID_ARGUMENT;case kt.NOT_FOUND:return H.NOT_FOUND;case kt.ALREADY_EXISTS:return H.ALREADY_EXISTS;case kt.PERMISSION_DENIED:return H.PERMISSION_DENIED;case kt.FAILED_PRECONDITION:return H.FAILED_PRECONDITION;case kt.ABORTED:return H.ABORTED;case kt.OUT_OF_RANGE:return H.OUT_OF_RANGE;case kt.UNIMPLEMENTED:return H.UNIMPLEMENTED;case kt.DATA_LOSS:return H.DATA_LOSS;default:return ke()}}(We=kt||(kt={}))[We.OK=0]="OK",We[We.CANCELLED=1]="CANCELLED",We[We.UNKNOWN=2]="UNKNOWN",We[We.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",We[We.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",We[We.NOT_FOUND=5]="NOT_FOUND",We[We.ALREADY_EXISTS=6]="ALREADY_EXISTS",We[We.PERMISSION_DENIED=7]="PERMISSION_DENIED",We[We.UNAUTHENTICATED=16]="UNAUTHENTICATED",We[We.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",We[We.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",We[We.ABORTED=10]="ABORTED",We[We.OUT_OF_RANGE=11]="OUT_OF_RANGE",We[We.UNIMPLEMENTED=12]="UNIMPLEMENTED",We[We.INTERNAL=13]="INTERNAL",We[We.UNAVAILABLE=14]="UNAVAILABLE",We[We.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XI(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZI=new gi([4294967295,4294967295],0);function Xy(t){const e=XI().encode(t),n=new Bw;return n.update(e),new Uint8Array(n.digest())}function Zy(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new gi([n,r],0),new gi([s,i],0)]}class Of{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new uo(`Invalid padding: ${n}`);if(r<0)throw new uo(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new uo(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new uo(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=gi.fromNumber(this.Ie)}Ee(e,n,r){let s=e.add(n.multiply(gi.fromNumber(r)));return s.compare(ZI)===1&&(s=new gi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const n=Xy(e),[r,s]=Zy(n);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);if(!this.de(a))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Of(i,s,n);return r.forEach(c=>a.insert(c)),a}insert(e){if(this.Ie===0)return;const n=Xy(e),[r,s]=Zy(n);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);this.Ae(a)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class uo extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zu{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,vl.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new zu(Re.min(),s,new xt(Qe),ss(),Ue())}}class vl{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new vl(r,n,Ue(),Ue(),Ue())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{constructor(e,n,r,s){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=s}}class xb{constructor(e,n){this.targetId=e,this.me=n}}class wb{constructor(e,n,r=Xt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class e0{constructor(){this.fe=0,this.ge=n0(),this.pe=Xt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ue(),n=Ue(),r=Ue();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:ke()}}),new vl(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=n0()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ze(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class eA{constructor(e){this.Le=e,this.Be=new Map,this.ke=ss(),this.qe=t0(),this.Qe=new xt(Qe)}Ke(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{const r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:ke()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,s)=>{this.ze(s)&&n(s)})}He(e){const n=e.targetId,r=e.me.count,s=this.Je(n);if(s){const i=s.target;if(rm(i))if(r===0){const a=new Ee(i.path);this.Ue(n,a,dn.newNoDocument(a,Re.min()))}else Ze(r===1);else{const a=this.Ye(n);if(a!==r){const c=this.Ze(e),u=c?this.Xe(c,e,a):1;if(u!==0){this.je(n);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,d)}}}}}Ze(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let a,c;try{a=Ni(r).toUint8Array()}catch(u){if(u instanceof Jw)return wa("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Of(a,s,i)}catch(u){return wa(u instanceof uo?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.Ie===0?null:c}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const a=this.Le.tt(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.Ue(n,i,null),s++)}),s}rt(e){const n=new Map;this.Be.forEach((i,a)=>{const c=this.Je(a);if(c){if(i.current&&rm(c.target)){const u=new Ee(c.target.path);this.ke.get(u)!==null||this.it(a,u)||this.Ue(a,u,dn.newNoDocument(u,e))}i.be&&(n.set(a,i.ve()),i.Ce())}});let r=Ue();this.qe.forEach((i,a)=>{let c=!0;a.forEachWhile(u=>{const d=this.Je(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(i))}),this.ke.forEach((i,a)=>a.setReadTime(e));const s=new zu(e,n,this.Qe,this.ke,r);return this.ke=ss(),this.qe=t0(),this.Qe=new xt(Qe),s}$e(e,n){if(!this.ze(e))return;const r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,n)?s.Fe(n,1):s.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const n=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new e0,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new Yt(Qe),this.qe=this.qe.insert(e,n)),n}ze(e){const n=this.Je(e)!==null;return n||pe("WatchChangeAggregator","Detected inactive target",e),n}Je(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new e0),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function t0(){return new xt(Ee.comparator)}function n0(){return new xt(Ee.comparator)}const tA=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),nA=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),rA=(()=>({and:"AND",or:"OR"}))();class sA{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function im(t,e){return t.useProto3Json||Ou(e)?e:{value:e}}function du(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function bb(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function iA(t,e){return du(t,e.toTimestamp())}function Pr(t){return Ze(!!t),Re.fromTimestamp(function(n){const r=Gs(n);return new Dt(r.seconds,r.nanos)}(t))}function Vf(t,e){return am(t,e).canonicalString()}function am(t,e){const n=function(s){return new ot(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function _b(t){const e=ot.fromString(t);return Ze(Sb(e)),e}function om(t,e){return Vf(t.databaseId,e.path)}function Bd(t,e){const n=_b(e);if(n.get(1)!==t.databaseId.projectId)throw new le(H.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new le(H.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ee(Tb(n))}function Eb(t,e){return Vf(t.databaseId,e)}function aA(t){const e=_b(t);return e.length===4?ot.emptyPath():Tb(e)}function lm(t){return new ot(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Tb(t){return Ze(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function r0(t,e,n){return{name:om(t,e),fields:n.value.mapValue.fields}}function oA(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:ke()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,h){return d.useProto3Json?(Ze(h===void 0||typeof h=="string"),Xt.fromBase64String(h||"")):(Ze(h===void 0||h instanceof Buffer||h instanceof Uint8Array),Xt.fromUint8Array(h||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&function(d){const h=d.code===void 0?H.UNKNOWN:vb(d.code);return new le(h,d.message||"")}(a);n=new wb(r,s,i,c||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Bd(t,r.document.name),i=Pr(r.document.updateTime),a=r.document.createTime?Pr(r.document.createTime):Re.min(),c=new Tn({mapValue:{fields:r.document.fields}}),u=dn.newFoundDocument(s,i,a,c),d=r.targetIds||[],h=r.removedTargetIds||[];n=new _c(d,h,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Bd(t,r.document),i=r.readTime?Pr(r.readTime):Re.min(),a=dn.newNoDocument(s,i),c=r.removedTargetIds||[];n=new _c([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Bd(t,r.document),i=r.removedTargetIds||[];n=new _c([],i,s,null)}else{if(!("filter"in e))return ke();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new YI(s,i),c=r.targetId;n=new xb(c,a)}}return n}function lA(t,e){let n;if(e instanceof yl)n={update:r0(t,e.key,e.value)};else if(e instanceof Mf)n={delete:om(t,e.key)};else if(e instanceof ti)n={update:r0(t,e.key,e.data),updateMask:yA(e.fieldMask)};else{if(!(e instanceof GI))return ke();n={verify:om(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,a){const c=a.transform;if(c instanceof Zo)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof el)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof tl)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof uu)return{fieldPath:a.field.canonicalString(),increment:c.Pe};throw ke()}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:iA(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ke()}(t,e.precondition)),n}function cA(t,e){return t&&t.length>0?(Ze(e!==void 0),t.map(n=>function(s,i){let a=s.updateTime?Pr(s.updateTime):Pr(i);return a.isEqual(Re.min())&&(a=Pr(i)),new HI(a,s.transformResults||[])}(n,e))):[]}function uA(t,e){return{documents:[Eb(t,e.path)]}}function dA(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Eb(t,s);const i=function(d){if(d.length!==0)return Nb(mr.create(d,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const a=function(d){if(d.length!==0)return d.map(h=>function(g){return{field:Ui(g.field),direction:fA(g.dir)}}(h))}(e.orderBy);a&&(n.structuredQuery.orderBy=a);const c=im(t,e.limit);return c!==null&&(n.structuredQuery.limit=c),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:n,parent:s}}function hA(t){let e=aA(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Ze(r===1);const h=n.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];n.where&&(i=function(f){const g=Cb(f);return g instanceof mr&&tb(g)?g.getFilters():[g]}(n.where));let a=[];n.orderBy&&(a=function(f){return f.map(g=>function(C){return new lu(Bi(C.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(g))}(n.orderBy));let c=null;n.limit&&(c=function(f){let g;return g=typeof f=="object"?f.value:f,Ou(g)?null:g}(n.limit));let u=null;n.startAt&&(u=function(f){const g=!!f.before,x=f.values||[];return new ou(x,g)}(n.startAt));let d=null;return n.endAt&&(d=function(f){const g=!f.before,x=f.values||[];return new ou(x,g)}(n.endAt)),AI(e,s,a,i,c,"F",u,d)}function mA(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ke()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function Cb(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Bi(n.unaryFilter.field);return At.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Bi(n.unaryFilter.field);return At.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Bi(n.unaryFilter.field);return At.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Bi(n.unaryFilter.field);return At.create(a,"!=",{nullValue:"NULL_VALUE"});default:return ke()}}(t):t.fieldFilter!==void 0?function(n){return At.create(Bi(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ke()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return mr.create(n.compositeFilter.filters.map(r=>Cb(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ke()}}(n.compositeFilter.op))}(t):ke()}function fA(t){return tA[t]}function pA(t){return nA[t]}function gA(t){return rA[t]}function Ui(t){return{fieldPath:t.canonicalString()}}function Bi(t){return Kt.fromServerFormat(t.fieldPath)}function Nb(t){return t instanceof At?function(n){if(n.op==="=="){if(zy(n.value))return{unaryFilter:{field:Ui(n.field),op:"IS_NAN"}};if(By(n.value))return{unaryFilter:{field:Ui(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(zy(n.value))return{unaryFilter:{field:Ui(n.field),op:"IS_NOT_NAN"}};if(By(n.value))return{unaryFilter:{field:Ui(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ui(n.field),op:pA(n.op),value:n.value}}}(t):t instanceof mr?function(n){const r=n.getFilters().map(s=>Nb(s));return r.length===1?r[0]:{compositeFilter:{op:gA(n.op),filters:r}}}(t):ke()}function yA(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function Sb(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As{constructor(e,n,r,s,i=Re.min(),a=Re.min(),c=Xt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new As(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new As(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new As(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new As(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vA{constructor(e){this.ct=e}}function xA(t){const e=hA({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?cu(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wA{constructor(){this.un=new bA}addToCollectionParentIndex(e,n){return this.un.add(n),K.resolve()}getCollectionParents(e,n){return K.resolve(this.un.getEntries(n))}addFieldIndex(e,n){return K.resolve()}deleteFieldIndex(e,n){return K.resolve()}deleteAllFieldIndexes(e){return K.resolve()}createTargetIndexes(e,n){return K.resolve()}getDocumentsMatchingTarget(e,n){return K.resolve(null)}getIndexType(e,n){return K.resolve(0)}getFieldIndexes(e,n){return K.resolve([])}getNextCollectionGroupToUpdate(e){return K.resolve(null)}getMinOffset(e,n){return K.resolve(qs.min())}getMinOffsetFromCollectionGroup(e,n){return K.resolve(qs.min())}updateCollectionGroup(e,n,r){return K.resolve()}updateIndexEntries(e,n){return K.resolve()}}class bA{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new Yt(ot.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Yt(ot.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Ta(0)}static kn(){return new Ta(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _A{constructor(){this.changes=new Ma(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,dn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?K.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EA{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TA{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&No(r.mutation,s,Vn.empty(),Dt.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Ue()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Ue()){const s=mi();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let a=co();return i.forEach((c,u)=>{a=a.insert(c,u.overlayedDocument)}),a}))}getOverlayedDocuments(e,n){const r=mi();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Ue()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,c)=>{n.set(a,c)})})}computeViews(e,n,r,s){let i=ss();const a=Co(),c=function(){return Co()}();return n.forEach((u,d)=>{const h=r.get(d.key);s.has(d.key)&&(h===void 0||h.mutation instanceof ti)?i=i.insert(d.key,d):h!==void 0?(a.set(d.key,h.mutation.getFieldMask()),No(h.mutation,d,h.mutation.getFieldMask(),Dt.now())):a.set(d.key,Vn.empty())}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((d,h)=>a.set(d,h)),n.forEach((d,h)=>{var f;return c.set(d,new EA(h,(f=a.get(d))!==null&&f!==void 0?f:null))}),c))}recalculateAndSaveOverlays(e,n){const r=Co();let s=new xt((a,c)=>a-c),i=Ue();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(a=>{for(const c of a)c.keys().forEach(u=>{const d=n.get(u);if(d===null)return;let h=r.get(u)||Vn.empty();h=c.applyToLocalView(d,h),r.set(u,h);const f=(s.get(c.batchId)||Ue()).add(u);s=s.insert(c.batchId,f)})}).next(()=>{const a=[],c=s.getReverseIterator();for(;c.hasNext();){const u=c.getNext(),d=u.key,h=u.value,f=ub();h.forEach(g=>{if(!i.has(g)){const x=gb(n.get(g),r.get(g));x!==null&&f.set(g,x),i=i.add(g)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,f))}return K.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(a){return Ee.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):ib(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):K.resolve(mi());let c=-1,u=i;return a.next(d=>K.forEach(d,(h,f)=>(c<f.largestBatchId&&(c=f.largestBatchId),i.get(h)?K.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{u=u.insert(h,g)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,u,d,Ue())).next(h=>({batchId:c,changes:cb(h)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Ee(n)).next(r=>{let s=co();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let a=co();return this.indexManager.getCollectionParents(e,i).next(c=>K.forEach(c,u=>{const d=function(f,g){return new gl(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(n,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(h=>{h.forEach((f,g)=>{a=a.insert(f,g)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(a=>{i.forEach((u,d)=>{const h=d.getKey();a.get(h)===null&&(a=a.insert(h,dn.newInvalidDocument(h)))});let c=co();return a.forEach((u,d)=>{const h=i.get(u);h!==void 0&&No(h.mutation,d,Vn.empty(),Dt.now()),Fu(n,d)&&(c=c.insert(u,d))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CA{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,n){return K.resolve(this.hr.get(n))}saveBundleMetadata(e,n){return this.hr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:Pr(s.createTime)}}(n)),K.resolve()}getNamedQuery(e,n){return K.resolve(this.Pr.get(n))}saveNamedQuery(e,n){return this.Pr.set(n.name,function(s){return{name:s.name,query:xA(s.bundledQuery),readTime:Pr(s.readTime)}}(n)),K.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NA{constructor(){this.overlays=new xt(Ee.comparator),this.Ir=new Map}getOverlay(e,n){return K.resolve(this.overlays.get(n))}getOverlays(e,n){const r=mi();return K.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.ht(e,n,i)}),K.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),K.resolve()}getOverlaysForCollection(e,n,r){const s=mi(),i=n.length+1,a=new Ee(n.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const u=c.getNext().value,d=u.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return K.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new xt((d,h)=>d-h);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let h=i.get(d.largestBatchId);h===null&&(h=mi(),i=i.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const c=mi(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((d,h)=>c.set(d,h)),!(c.size()>=s)););return K.resolve(c)}ht(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new QI(n,r));let i=this.Ir.get(n);i===void 0&&(i=Ue(),this.Ir.set(n,i)),this.Ir.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SA{constructor(){this.sessionToken=Xt.EMPTY_BYTE_STRING}getSessionToken(e){return K.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,K.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $f{constructor(){this.Tr=new Yt($t.Er),this.dr=new Yt($t.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,n){const r=new $t(e,n);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Vr(new $t(e,n))}mr(e,n){e.forEach(r=>this.removeReference(r,n))}gr(e){const n=new Ee(new ot([])),r=new $t(n,e),s=new $t(n,e+1),i=[];return this.dr.forEachInRange([r,s],a=>{this.Vr(a),i.push(a.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const n=new Ee(new ot([])),r=new $t(n,e),s=new $t(n,e+1);let i=Ue();return this.dr.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){const n=new $t(e,0),r=this.Tr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class $t{constructor(e,n){this.key=e,this.wr=n}static Er(e,n){return Ee.comparator(e.key,n.key)||Qe(e.wr,n.wr)}static Ar(e,n){return Qe(e.wr,n.wr)||Ee.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kA{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new Yt($t.Er)}checkEmpty(e){return K.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new KI(i,n,r,s);this.mutationQueue.push(a);for(const c of s)this.br=this.br.add(new $t(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return K.resolve(a)}lookupMutationBatch(e,n){return K.resolve(this.Dr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.vr(r),i=s<0?0:s;return K.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return K.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return K.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new $t(n,0),s=new $t(n,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],a=>{const c=this.Dr(a.wr);i.push(c)}),K.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Yt(Qe);return n.forEach(s=>{const i=new $t(s,0),a=new $t(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,a],c=>{r=r.add(c.wr)})}),K.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;Ee.isDocumentKey(i)||(i=i.child(""));const a=new $t(new Ee(i),0);let c=new Yt(Qe);return this.br.forEachWhile(u=>{const d=u.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(c=c.add(u.wr)),!0)},a),K.resolve(this.Cr(c))}Cr(e){const n=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){Ze(this.Fr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return K.forEach(n.mutations,s=>{const i=new $t(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,n){const r=new $t(n,0),s=this.br.firstAfterOrEqual(r);return K.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,K.resolve()}Fr(e,n){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const n=this.vr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IA{constructor(e){this.Mr=e,this.docs=function(){return new xt(Ee.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,a=this.Mr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return K.resolve(r?r.document.mutableCopy():dn.newInvalidDocument(n))}getEntries(e,n){let r=ss();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():dn.newInvalidDocument(s))}),K.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=ss();const a=n.path,c=new Ee(a.child("")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){const{key:d,value:{document:h}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||dI(uI(h),r)<=0||(s.has(h.key)||Fu(n,h))&&(i=i.insert(h.key,h.mutableCopy()))}return K.resolve(i)}getAllFromCollectionGroup(e,n,r,s){ke()}Or(e,n){return K.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new AA(this)}getSize(e){return K.resolve(this.size)}}class AA extends _A{constructor(e){super(),this.cr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),K.waitFor(n)}getFromCache(e,n){return this.cr.getEntry(e,n)}getAllFromCache(e,n){return this.cr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PA{constructor(e){this.persistence=e,this.Nr=new Ma(n=>Rf(n),jf),this.lastRemoteSnapshotVersion=Re.min(),this.highestTargetId=0,this.Lr=0,this.Br=new $f,this.targetCount=0,this.kr=Ta.Bn()}forEachTarget(e,n){return this.Nr.forEach((r,s)=>n(s)),K.resolve()}getLastRemoteSnapshotVersion(e){return K.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return K.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),K.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Lr&&(this.Lr=n),K.resolve()}Kn(e){this.Nr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.kr=new Ta(n),this.highestTargetId=n),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,n){return this.Kn(n),this.targetCount+=1,K.resolve()}updateTargetData(e,n){return this.Kn(n),K.resolve()}removeTargetData(e,n){return this.Nr.delete(n.target),this.Br.gr(n.targetId),this.targetCount-=1,K.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.Nr.forEach((a,c)=>{c.sequenceNumber<=n&&r.get(c.targetId)===null&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),s++)}),K.waitFor(i).next(()=>s)}getTargetCount(e){return K.resolve(this.targetCount)}getTargetData(e,n){const r=this.Nr.get(n)||null;return K.resolve(r)}addMatchingKeys(e,n,r){return this.Br.Rr(n,r),K.resolve()}removeMatchingKeys(e,n,r){this.Br.mr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),K.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.Br.gr(n),K.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Br.yr(n);return K.resolve(r)}containsKey(e,n){return K.resolve(this.Br.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RA{constructor(e,n){this.qr={},this.overlays={},this.Qr=new kf(0),this.Kr=!1,this.Kr=!0,this.$r=new SA,this.referenceDelegate=e(this),this.Ur=new PA(this),this.indexManager=new wA,this.remoteDocumentCache=function(s){return new IA(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new vA(n),this.Gr=new CA(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new NA,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.qr[e.toKey()];return r||(r=new kA(n,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,n,r){pe("MemoryPersistence","Starting transaction:",e);const s=new jA(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,n){return K.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,n)))}}class jA extends mI{constructor(e){super(),this.currentSequenceNumber=e}}class Ff{constructor(e){this.persistence=e,this.Jr=new $f,this.Yr=null}static Zr(e){return new Ff(e)}get Xr(){if(this.Yr)return this.Yr;throw ke()}addReference(e,n,r){return this.Jr.addReference(r,n),this.Xr.delete(r.toString()),K.resolve()}removeReference(e,n,r){return this.Jr.removeReference(r,n),this.Xr.add(r.toString()),K.resolve()}markPotentiallyOrphaned(e,n){return this.Xr.add(n.toString()),K.resolve()}removeTarget(e,n){this.Jr.gr(n.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}zr(){this.Yr=new Set}jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return K.forEach(this.Xr,r=>{const s=Ee.fromPath(r);return this.ei(e,s).next(i=>{i||n.removeEntry(s,Re.min())})}).next(()=>(this.Yr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ei(e,n).next(r=>{r?this.Xr.delete(n.toString()):this.Xr.add(n.toString())})}Wr(e){return 0}ei(e,n){return K.or([()=>K.resolve(this.Jr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Hr(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uf{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.$i=r,this.Ui=s}static Wi(e,n){let r=Ue(),s=Ue();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Uf(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DA{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MA{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return w1()?8:fI(mn())>0?6:4}()}initialize(e,n){this.Ji=e,this.indexManager=n,this.Gi=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.Yi(e,n).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.Zi(e,n,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new DA;return this.Xi(e,n,a).next(c=>{if(i.result=c,this.zi)return this.es(e,n,a,c.size)})}).next(()=>i.result)}es(e,n,r,s){return r.documentReadCount<this.ji?(to()<=ze.DEBUG&&pe("QueryEngine","SDK will not create cache indexes for query:",Fi(n),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),K.resolve()):(to()<=ze.DEBUG&&pe("QueryEngine","Query:",Fi(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(to()<=ze.DEBUG&&pe("QueryEngine","The SDK decides to create cache indexes for query:",Fi(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ar(n))):K.resolve())}Yi(e,n){if(Gy(n))return K.resolve(null);let r=Ar(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=cu(n,null,"F"),r=Ar(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const a=Ue(...i);return this.Ji.getDocuments(e,a).next(c=>this.indexManager.getMinOffset(e,r).next(u=>{const d=this.ts(n,c);return this.ns(n,d,a,u.readTime)?this.Yi(e,cu(n,null,"F")):this.rs(e,d,n,u)}))})))}Zi(e,n,r,s){return Gy(n)||s.isEqual(Re.min())?K.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const a=this.ts(n,i);return this.ns(n,a,r,s)?K.resolve(null):(to()<=ze.DEBUG&&pe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Fi(n)),this.rs(e,a,n,cI(s,-1)).next(c=>c))})}ts(e,n){let r=new Yt(ob(e));return n.forEach((s,i)=>{Fu(e,i)&&(r=r.add(i))}),r}ns(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,n,r){return to()<=ze.DEBUG&&pe("QueryEngine","Using full collection scan to execute query:",Fi(n)),this.Ji.getDocumentsMatchingQuery(e,n,qs.min(),r)}rs(e,n,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LA{constructor(e,n,r,s){this.persistence=e,this.ss=n,this.serializer=s,this.os=new xt(Qe),this._s=new Ma(i=>Rf(i),jf),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new TA(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.os))}}function OA(t,e,n,r){return new LA(t,e,n,r)}async function kb(t,e){const n=je(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.ls(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const a=[],c=[];let u=Ue();for(const d of s){a.push(d.batchId);for(const h of d.mutations)u=u.add(h.key)}for(const d of i){c.push(d.batchId);for(const h of d.mutations)u=u.add(h.key)}return n.localDocuments.getDocuments(r,u).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:c}))})})}function VA(t,e){const n=je(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(c,u,d,h){const f=d.batch,g=f.keys();let x=K.resolve();return g.forEach(C=>{x=x.next(()=>h.getEntry(u,C)).next(y=>{const k=d.docVersions.get(C);Ze(k!==null),y.version.compareTo(k)<0&&(f.applyToRemoteDocument(y,d),y.isValidDocument()&&(y.setReadTime(d.commitVersion),h.addEntry(y)))})}),x.next(()=>c.mutationQueue.removeMutationBatch(u,f))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(c){let u=Ue();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(u=u.add(c.batch.mutations[d].key));return u}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function Ib(t){const e=je(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ur.getLastRemoteSnapshotVersion(n))}function $A(t,e){const n=je(t),r=e.snapshotVersion;let s=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=n.cs.newChangeBuffer({trackRemovals:!0});s=n.os;const c=[];e.targetChanges.forEach((h,f)=>{const g=s.get(f);if(!g)return;c.push(n.Ur.removeMatchingKeys(i,h.removedDocuments,f).next(()=>n.Ur.addMatchingKeys(i,h.addedDocuments,f)));let x=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?x=x.withResumeToken(Xt.EMPTY_BYTE_STRING,Re.min()).withLastLimboFreeSnapshotVersion(Re.min()):h.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(h.resumeToken,r)),s=s.insert(f,x),function(y,k,w){return y.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=3e8?!0:w.addedDocuments.size+w.modifiedDocuments.size+w.removedDocuments.size>0}(g,x,h)&&c.push(n.Ur.updateTargetData(i,x))});let u=ss(),d=Ue();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&c.push(n.persistence.referenceDelegate.updateLimboDocument(i,h))}),c.push(FA(i,a,e.documentUpdates).next(h=>{u=h.Ps,d=h.Is})),!r.isEqual(Re.min())){const h=n.Ur.getLastRemoteSnapshotVersion(i).next(f=>n.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));c.push(h)}return K.waitFor(c).next(()=>a.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,u,d)).next(()=>u)}).then(i=>(n.os=s,i))}function FA(t,e,n){let r=Ue(),s=Ue();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let a=ss();return n.forEach((c,u)=>{const d=i.get(c);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(c)),u.isNoDocument()&&u.version.isEqual(Re.min())?(e.removeEntry(c,u.readTime),a=a.insert(c,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),a=a.insert(c,u)):pe("LocalStore","Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",u.version)}),{Ps:a,Is:s}})}function UA(t,e){const n=je(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function BA(t,e){const n=je(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Ur.getTargetData(r,e).next(i=>i?(s=i,K.resolve(s)):n.Ur.allocateTargetId(r).next(a=>(s=new As(e,a,"TargetPurposeListen",r.currentSequenceNumber),n.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.os=n.os.insert(r.targetId,r),n._s.set(e,r.targetId)),r})}async function cm(t,e,n){const r=je(t),s=r.os.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!pl(a))throw a;pe("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function s0(t,e,n){const r=je(t);let s=Re.min(),i=Ue();return r.persistence.runTransaction("Execute query","readwrite",a=>function(u,d,h){const f=je(u),g=f._s.get(h);return g!==void 0?K.resolve(f.os.get(g)):f.Ur.getTargetData(d,h)}(r,a,Ar(e)).next(c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,c.targetId).next(u=>{i=u})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,n?s:Re.min(),n?i:Ue())).next(c=>(zA(r,RI(e),c),{documents:c,Ts:i})))}function zA(t,e,n){let r=t.us.get(e)||Re.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.us.set(e,r)}class i0{constructor(){this.activeTargetIds=VI()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class HA{constructor(){this.so=new i0,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,n,r){this.oo[e]=n}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new i0,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WA{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a0{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){pe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){pe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tc=null;function zd(){return tc===null?tc=function(){return 268435456+Math.round(2147483648*Math.random())}():tc++,"0x"+tc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qA={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GA{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ln="WebChannelConnection";class KA extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+n.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(n,r,s,i,a){const c=zd(),u=this.xo(n,r.toUriEncodedString());pe("RestConnection",`Sending RPC '${n}' ${c}:`,u,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,i,a),this.No(n,u,d,s).then(h=>(pe("RestConnection",`Received RPC '${n}' ${c}: `,h),h),h=>{throw wa("RestConnection",`RPC '${n}' ${c} failed with error: `,h,"url: ",u,"request:",s),h})}Lo(n,r,s,i,a,c){return this.Mo(n,r,s,i,a)}Oo(n,r,s){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Da}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,a)=>n[a]=i),s&&s.headers.forEach((i,a)=>n[a]=i)}xo(n,r){const s=qA[n];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,n,r,s){const i=zd();return new Promise((a,c)=>{const u=new zw;u.setWithCredentials(!0),u.listenOnce(Hw.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case xc.NO_ERROR:const h=u.getResponseJson();pe(ln,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),a(h);break;case xc.TIMEOUT:pe(ln,`RPC '${e}' ${i} timed out`),c(new le(H.DEADLINE_EXCEEDED,"Request time out"));break;case xc.HTTP_ERROR:const f=u.getStatus();if(pe(ln,`RPC '${e}' ${i} failed with status:`,f,"response text:",u.getResponseText()),f>0){let g=u.getResponseJson();Array.isArray(g)&&(g=g[0]);const x=g==null?void 0:g.error;if(x&&x.status&&x.message){const C=function(k){const w=k.toLowerCase().replace(/_/g,"-");return Object.values(H).indexOf(w)>=0?w:H.UNKNOWN}(x.status);c(new le(C,x.message))}else c(new le(H.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new le(H.UNAVAILABLE,"Connection failed."));break;default:ke()}}finally{pe(ln,`RPC '${e}' ${i} completed.`)}});const d=JSON.stringify(s);pe(ln,`RPC '${e}' ${i} sending request:`,s),u.send(n,"POST",d,r,15)})}Bo(e,n,r){const s=zd(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Gw(),c=qw(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,n,r),u.encodeInitMessageHeaders=!0;const h=i.join("");pe(ln,`Creating RPC '${e}' stream ${s}: ${h}`,u);const f=a.createWebChannel(h,u);let g=!1,x=!1;const C=new GA({Io:k=>{x?pe(ln,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(g||(pe(ln,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),pe(ln,`RPC '${e}' stream ${s} sending:`,k),f.send(k))},To:()=>f.close()}),y=(k,w,b)=>{k.listen(w,I=>{try{b(I)}catch(j){setTimeout(()=>{throw j},0)}})};return y(f,lo.EventType.OPEN,()=>{x||(pe(ln,`RPC '${e}' stream ${s} transport opened.`),C.yo())}),y(f,lo.EventType.CLOSE,()=>{x||(x=!0,pe(ln,`RPC '${e}' stream ${s} transport closed`),C.So())}),y(f,lo.EventType.ERROR,k=>{x||(x=!0,wa(ln,`RPC '${e}' stream ${s} transport errored:`,k),C.So(new le(H.UNAVAILABLE,"The operation could not be completed")))}),y(f,lo.EventType.MESSAGE,k=>{var w;if(!x){const b=k.data[0];Ze(!!b);const I=b,j=I.error||((w=I[0])===null||w===void 0?void 0:w.error);if(j){pe(ln,`RPC '${e}' stream ${s} received error:`,j);const F=j.status;let q=function(N){const A=kt[N];if(A!==void 0)return vb(A)}(F),E=j.message;q===void 0&&(q=H.INTERNAL,E="Unknown error status: "+F+" with message "+j.message),x=!0,C.So(new le(q,E)),f.close()}else pe(ln,`RPC '${e}' stream ${s} received:`,b),C.bo(b)}}),y(c,Ww.STAT_EVENT,k=>{k.stat===Zh.PROXY?pe(ln,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===Zh.NOPROXY&&pe(ln,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.wo()},0),C}}function Hd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hu(t){return new sA(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ab{constructor(e,n,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=n,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,n-r);s>0&&pe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pb{constructor(e,n,r,s,i,a,c,u){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Ab(e,n)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,n){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():n&&n.code===H.RESOURCE_EXHAUSTED?(rs(n.toString()),rs("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===H.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(n)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===n&&this.P_(r,s)},r=>{e(()=>{const s=new le(H.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,n){const r=this.h_(this.Yo);this.stream=this.T_(e,n),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return pe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return n=>{this.ui.enqueueAndForget(()=>this.Yo===e?n():(pe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class QA extends Pb{constructor(e,n,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}T_(e,n){return this.connection.Bo("Listen",e,n)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const n=oA(this.serializer,e),r=function(i){if(!("targetChange"in i))return Re.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?Re.min():a.readTime?Pr(a.readTime):Re.min()}(e);return this.listener.d_(n,r)}A_(e){const n={};n.database=lm(this.serializer),n.addTarget=function(i,a){let c;const u=a.target;if(c=rm(u)?{documents:uA(i,u)}:{query:dA(i,u)._t},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=bb(i,a.resumeToken);const d=im(i,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo(Re.min())>0){c.readTime=du(i,a.snapshotVersion.toTimestamp());const d=im(i,a.expectedCount);d!==null&&(c.expectedCount=d)}return c}(this.serializer,e);const r=mA(this.serializer,e);r&&(n.labels=r),this.a_(n)}R_(e){const n={};n.database=lm(this.serializer),n.removeTarget=e,this.a_(n)}}class YA extends Pb{constructor(e,n,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,n){return this.connection.Bo("Write",e,n)}E_(e){return Ze(!!e.streamToken),this.lastStreamToken=e.streamToken,Ze(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Ze(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const n=cA(e.writeResults,e.commitTime),r=Pr(e.commitTime);return this.listener.g_(r,n)}p_(){const e={};e.database=lm(this.serializer),this.a_(e)}m_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>lA(this.serializer,r))};this.a_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JA extends class{}{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new le(H.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,n,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Mo(e,am(n,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===H.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new le(H.UNKNOWN,i.toString())})}Lo(e,n,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Lo(e,am(n,r),s,a,c,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===H.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new le(H.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class XA{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(rs(n),this.D_=!1):pe("OnlineStateTracker",n)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZA{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(a=>{r.enqueueAndForget(async()=>{Ri(this)&&(pe("RemoteStore","Restarting streams for network reachability change."),await async function(u){const d=je(u);d.L_.add(4),await xl(d),d.q_.set("Unknown"),d.L_.delete(4),await Wu(d)}(this))})}),this.q_=new XA(r,s)}}async function Wu(t){if(Ri(t))for(const e of t.B_)await e(!0)}async function xl(t){for(const e of t.B_)await e(!1)}function Rb(t,e){const n=je(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),Wf(n)?Hf(n):La(n).r_()&&zf(n,e))}function Bf(t,e){const n=je(t),r=La(n);n.N_.delete(e),r.r_()&&jb(n,e),n.N_.size===0&&(r.r_()?r.o_():Ri(n)&&n.q_.set("Unknown"))}function zf(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Re.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}La(t).A_(e)}function jb(t,e){t.Q_.xe(e),La(t).R_(e)}function Hf(t){t.Q_=new eA({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),La(t).start(),t.q_.v_()}function Wf(t){return Ri(t)&&!La(t).n_()&&t.N_.size>0}function Ri(t){return je(t).L_.size===0}function Db(t){t.Q_=void 0}async function eP(t){t.q_.set("Online")}async function tP(t){t.N_.forEach((e,n)=>{zf(t,e)})}async function nP(t,e){Db(t),Wf(t)?(t.q_.M_(e),Hf(t)):t.q_.set("Unknown")}async function rP(t,e,n){if(t.q_.set("Online"),e instanceof wb&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const c of i.targetIds)s.N_.has(c)&&(await s.remoteSyncer.rejectListen(c,a),s.N_.delete(c),s.Q_.removeTarget(c))}(t,e)}catch(r){pe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await hu(t,r)}else if(e instanceof _c?t.Q_.Ke(e):e instanceof xb?t.Q_.He(e):t.Q_.We(e),!n.isEqual(Re.min()))try{const r=await Ib(t.localStore);n.compareTo(r)>=0&&await function(i,a){const c=i.Q_.rt(a);return c.targetChanges.forEach((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const h=i.N_.get(d);h&&i.N_.set(d,h.withResumeToken(u.resumeToken,a))}}),c.targetMismatches.forEach((u,d)=>{const h=i.N_.get(u);if(!h)return;i.N_.set(u,h.withResumeToken(Xt.EMPTY_BYTE_STRING,h.snapshotVersion)),jb(i,u);const f=new As(h.target,u,d,h.sequenceNumber);zf(i,f)}),i.remoteSyncer.applyRemoteEvent(c)}(t,n)}catch(r){pe("RemoteStore","Failed to raise snapshot:",r),await hu(t,r)}}async function hu(t,e,n){if(!pl(e))throw e;t.L_.add(1),await xl(t),t.q_.set("Offline"),n||(n=()=>Ib(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{pe("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await Wu(t)})}function Mb(t,e){return e().catch(n=>hu(t,n,e))}async function qu(t){const e=je(t),n=Ks(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;sP(e);)try{const s=await UA(e.localStore,r);if(s===null){e.O_.length===0&&n.o_();break}r=s.batchId,iP(e,s)}catch(s){await hu(e,s)}Lb(e)&&Ob(e)}function sP(t){return Ri(t)&&t.O_.length<10}function iP(t,e){t.O_.push(e);const n=Ks(t);n.r_()&&n.V_&&n.m_(e.mutations)}function Lb(t){return Ri(t)&&!Ks(t).n_()&&t.O_.length>0}function Ob(t){Ks(t).start()}async function aP(t){Ks(t).p_()}async function oP(t){const e=Ks(t);for(const n of t.O_)e.m_(n.mutations)}async function lP(t,e,n){const r=t.O_.shift(),s=Lf.from(r,e,n);await Mb(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await qu(t)}async function cP(t,e){e&&Ks(t).V_&&await async function(r,s){if(function(a){return JI(a)&&a!==H.ABORTED}(s.code)){const i=r.O_.shift();Ks(r).s_(),await Mb(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await qu(r)}}(t,e),Lb(t)&&Ob(t)}async function o0(t,e){const n=je(t);n.asyncQueue.verifyOperationInProgress(),pe("RemoteStore","RemoteStore received new credentials");const r=Ri(n);n.L_.add(3),await xl(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await Wu(n)}async function uP(t,e){const n=je(t);e?(n.L_.delete(2),await Wu(n)):e||(n.L_.add(2),await xl(n),n.q_.set("Unknown"))}function La(t){return t.K_||(t.K_=function(n,r,s){const i=je(n);return i.w_(),new QA(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:eP.bind(null,t),Ro:tP.bind(null,t),mo:nP.bind(null,t),d_:rP.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),Wf(t)?Hf(t):t.q_.set("Unknown")):(await t.K_.stop(),Db(t))})),t.K_}function Ks(t){return t.U_||(t.U_=function(n,r,s){const i=je(n);return i.w_(),new YA(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:aP.bind(null,t),mo:cP.bind(null,t),f_:oP.bind(null,t),g_:lP.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await qu(t)):(await t.U_.stop(),t.O_.length>0&&(pe("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qf{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Yr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const a=Date.now()+r,c=new qf(e,n,a,s,i);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new le(H.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Gf(t,e){if(rs("AsyncQueue",`${e}: ${t}`),pl(t))return new le(H.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e){this.comparator=e?(n,r)=>e(n,r)||Ee.comparator(n.key,r.key):(n,r)=>Ee.comparator(n.key,r.key),this.keyedMap=co(),this.sortedSet=new xt(this.comparator)}static emptySet(e){return new da(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof da)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new da;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l0{constructor(){this.W_=new xt(Ee.comparator)}track(e){const n=e.doc.key,r=this.W_.get(n);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(n,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(n):e.type===1&&r.type===2?this.W_=this.W_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):ke():this.W_=this.W_.insert(n,e)}G_(){const e=[];return this.W_.inorderTraversal((n,r)=>{e.push(r)}),e}}class Ca{constructor(e,n,r,s,i,a,c,u,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,i){const a=[];return n.forEach(c=>{a.push({type:0,doc:c})}),new Ca(e,n,da.emptySet(n),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&$u(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dP{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class hP{constructor(){this.queries=c0(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(n,r){const s=je(n),i=s.queries;s.queries=c0(),i.forEach((a,c)=>{for(const u of c.j_)u.onError(r)})})(this,new le(H.ABORTED,"Firestore shutting down"))}}function c0(){return new Ma(t=>ab(t),$u)}async function Kf(t,e){const n=je(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new dP,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await n.onListen(s,!0);break;case 1:i.z_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(a){const c=Gf(a,`Initialization of query '${Fi(e.query)}' failed`);return void e.onError(c)}n.queries.set(s,i),i.j_.push(e),e.Z_(n.onlineState),i.z_&&e.X_(i.z_)&&Yf(n)}async function Qf(t,e){const n=je(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const a=i.j_.indexOf(e);a>=0&&(i.j_.splice(a,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function mP(t,e){const n=je(t);let r=!1;for(const s of e){const i=s.query,a=n.queries.get(i);if(a){for(const c of a.j_)c.X_(s)&&(r=!0);a.z_=s}}r&&Yf(n)}function fP(t,e,n){const r=je(t),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(n);r.queries.delete(e)}function Yf(t){t.Y_.forEach(e=>{e.next()})}var um,u0;(u0=um||(um={})).ea="default",u0.Cache="cache";class Jf{constructor(e,n,r){this.query=e,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ca(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.na?this.ia(e)&&(this.ta.next(e),n=!0):this.sa(e,this.onlineState)&&(this.oa(e),n=!0),this.ra=e,n}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let n=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),n=!0),n}sa(e,n){if(!e.fromCache||!this.J_())return!0;const r=n!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const n=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}oa(e){e=Ca.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==um.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vb{constructor(e){this.key=e}}class $b{constructor(e){this.key=e}}class pP{constructor(e,n){this.query=e,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ue(),this.mutatedKeys=Ue(),this.Aa=ob(e),this.Ra=new da(this.Aa)}get Va(){return this.Ta}ma(e,n){const r=n?n.fa:new l0,s=n?n.Ra:this.Ra;let i=n?n.mutatedKeys:this.mutatedKeys,a=s,c=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const g=s.get(h),x=Fu(this.query,f)?f:null,C=!!g&&this.mutatedKeys.has(g.key),y=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let k=!1;g&&x?g.data.isEqual(x.data)?C!==y&&(r.track({type:3,doc:x}),k=!0):this.ga(g,x)||(r.track({type:2,doc:x}),k=!0,(u&&this.Aa(x,u)>0||d&&this.Aa(x,d)<0)&&(c=!0)):!g&&x?(r.track({type:0,doc:x}),k=!0):g&&!x&&(r.track({type:1,doc:g}),k=!0,(u||d)&&(c=!0)),k&&(x?(a=a.add(x),i=y?i.add(h):i.delete(h)):(a=a.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:a,fa:r,ns:c,mutatedKeys:i}}ga(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((h,f)=>function(x,C){const y=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ke()}};return y(x)-y(C)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),s=s!=null&&s;const c=n&&!s?this.ya():[],u=this.da.size===0&&this.current&&!s?1:0,d=u!==this.Ea;return this.Ea=u,a.length!==0||d?{snapshot:new Ca(this.query,e.Ra,i,a,e.mutatedKeys,u===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new l0,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(n=>this.Ta=this.Ta.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ta=this.Ta.delete(n)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Ue(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const n=[];return e.forEach(r=>{this.da.has(r)||n.push(new $b(r))}),this.da.forEach(r=>{e.has(r)||n.push(new Vb(r))}),n}ba(e){this.Ta=e.Ts,this.da=Ue();const n=this.ma(e.documents);return this.applyChanges(n,!0)}Da(){return Ca.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class gP{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class yP{constructor(e){this.key=e,this.va=!1}}class vP{constructor(e,n,r,s,i,a){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new Ma(c=>ab(c),$u),this.Ma=new Map,this.xa=new Set,this.Oa=new xt(Ee.comparator),this.Na=new Map,this.La=new $f,this.Ba={},this.ka=new Map,this.qa=Ta.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function xP(t,e,n=!0){const r=Wb(t);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await Fb(r,e,n,!0),s}async function wP(t,e){const n=Wb(t);await Fb(n,e,!0,!1)}async function Fb(t,e,n,r){const s=await BA(t.localStore,Ar(e)),i=s.targetId,a=t.sharedClientState.addLocalQueryTarget(i,n);let c;return r&&(c=await bP(t,e,i,a==="current",s.resumeToken)),t.isPrimaryClient&&n&&Rb(t.remoteStore,s),c}async function bP(t,e,n,r,s){t.Ka=(f,g,x)=>async function(y,k,w,b){let I=k.view.ma(w);I.ns&&(I=await s0(y.localStore,k.query,!1).then(({documents:E})=>k.view.ma(E,I)));const j=b&&b.targetChanges.get(k.targetId),F=b&&b.targetMismatches.get(k.targetId)!=null,q=k.view.applyChanges(I,y.isPrimaryClient,j,F);return h0(y,k.targetId,q.wa),q.snapshot}(t,f,g,x);const i=await s0(t.localStore,e,!0),a=new pP(e,i.Ts),c=a.ma(i.documents),u=vl.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=a.applyChanges(c,t.isPrimaryClient,u);h0(t,n,d.wa);const h=new gP(e,n,a);return t.Fa.set(e,h),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),d.snapshot}async function _P(t,e,n){const r=je(t),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(a=>!$u(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await cm(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&Bf(r.remoteStore,s.targetId),dm(r,s.targetId)}).catch(fl)):(dm(r,s.targetId),await cm(r.localStore,s.targetId,!0))}async function EP(t,e){const n=je(t),r=n.Fa.get(e),s=n.Ma.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Bf(n.remoteStore,r.targetId))}async function TP(t,e,n){const r=PP(t);try{const s=await function(a,c){const u=je(a),d=Dt.now(),h=c.reduce((x,C)=>x.add(C.key),Ue());let f,g;return u.persistence.runTransaction("Locally write mutations","readwrite",x=>{let C=ss(),y=Ue();return u.cs.getEntries(x,h).next(k=>{C=k,C.forEach((w,b)=>{b.isValidDocument()||(y=y.add(w))})}).next(()=>u.localDocuments.getOverlayedDocuments(x,C)).next(k=>{f=k;const w=[];for(const b of c){const I=qI(b,f.get(b.key).overlayedDocument);I!=null&&w.push(new ti(b.key,I,Xw(I.value.mapValue),ur.exists(!0)))}return u.mutationQueue.addMutationBatch(x,d,w,c)}).next(k=>{g=k;const w=k.applyToLocalDocumentSet(f,y);return u.documentOverlayCache.saveOverlays(x,k.batchId,w)})}).then(()=>({batchId:g.batchId,changes:cb(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,c,u){let d=a.Ba[a.currentUser.toKey()];d||(d=new xt(Qe)),d=d.insert(c,u),a.Ba[a.currentUser.toKey()]=d}(r,s.batchId,n),await wl(r,s.changes),await qu(r.remoteStore)}catch(s){const i=Gf(s,"Failed to persist write");n.reject(i)}}async function Ub(t,e){const n=je(t);try{const r=await $A(n.localStore,e);e.targetChanges.forEach((s,i)=>{const a=n.Na.get(i);a&&(Ze(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.va=!0:s.modifiedDocuments.size>0?Ze(a.va):s.removedDocuments.size>0&&(Ze(a.va),a.va=!1))}),await wl(n,r,e)}catch(r){await fl(r)}}function d0(t,e,n){const r=je(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Fa.forEach((i,a)=>{const c=a.view.Z_(e);c.snapshot&&s.push(c.snapshot)}),function(a,c){const u=je(a);u.onlineState=c;let d=!1;u.queries.forEach((h,f)=>{for(const g of f.j_)g.Z_(c)&&(d=!0)}),d&&Yf(u)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function CP(t,e,n){const r=je(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Na.get(e),i=s&&s.key;if(i){let a=new xt(Ee.comparator);a=a.insert(i,dn.newNoDocument(i,Re.min()));const c=Ue().add(i),u=new zu(Re.min(),new Map,new xt(Qe),a,c);await Ub(r,u),r.Oa=r.Oa.remove(i),r.Na.delete(e),Xf(r)}else await cm(r.localStore,e,!1).then(()=>dm(r,e,n)).catch(fl)}async function NP(t,e){const n=je(t),r=e.batch.batchId;try{const s=await VA(n.localStore,e);zb(n,r,null),Bb(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await wl(n,s)}catch(s){await fl(s)}}async function SP(t,e,n){const r=je(t);try{const s=await function(a,c){const u=je(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let h;return u.mutationQueue.lookupMutationBatch(d,c).next(f=>(Ze(f!==null),h=f.keys(),u.mutationQueue.removeMutationBatch(d,f))).next(()=>u.mutationQueue.performConsistencyCheck(d)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(d,h,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h)).next(()=>u.localDocuments.getDocuments(d,h))})}(r.localStore,e);zb(r,e,n),Bb(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await wl(r,s)}catch(s){await fl(s)}}function Bb(t,e){(t.ka.get(e)||[]).forEach(n=>{n.resolve()}),t.ka.delete(e)}function zb(t,e,n){const r=je(t);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function dm(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||Hb(t,r)})}function Hb(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);n!==null&&(Bf(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),Xf(t))}function h0(t,e,n){for(const r of n)r instanceof Vb?(t.La.addReference(r.key,e),kP(t,r)):r instanceof $b?(pe("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||Hb(t,r.key)):ke()}function kP(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(pe("SyncEngine","New document in limbo: "+n),t.xa.add(r),Xf(t))}function Xf(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new Ee(ot.fromString(e)),r=t.qa.next();t.Na.set(r,new yP(n)),t.Oa=t.Oa.insert(n,r),Rb(t.remoteStore,new As(Ar(Vu(n.path)),r,"TargetPurposeLimboResolution",kf.oe))}}async function wl(t,e,n){const r=je(t),s=[],i=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((c,u)=>{a.push(r.Ka(u,e,n).then(d=>{var h;if((d||n)&&r.isPrimaryClient){const f=d?!d.fromCache:(h=n==null?void 0:n.targetChanges.get(u.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(d){s.push(d);const f=Uf.Wi(u.targetId,d);i.push(f)}}))}),await Promise.all(a),r.Ca.d_(s),await async function(u,d){const h=je(u);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>K.forEach(d,g=>K.forEach(g.$i,x=>h.persistence.referenceDelegate.addReference(f,g.targetId,x)).next(()=>K.forEach(g.Ui,x=>h.persistence.referenceDelegate.removeReference(f,g.targetId,x)))))}catch(f){if(!pl(f))throw f;pe("LocalStore","Failed to update sequence numbers: "+f)}for(const f of d){const g=f.targetId;if(!f.fromCache){const x=h.os.get(g),C=x.snapshotVersion,y=x.withLastLimboFreeSnapshotVersion(C);h.os=h.os.insert(g,y)}}}(r.localStore,i))}async function IP(t,e){const n=je(t);if(!n.currentUser.isEqual(e)){pe("SyncEngine","User change. New user:",e.toKey());const r=await kb(n.localStore,e);n.currentUser=e,function(i,a){i.ka.forEach(c=>{c.forEach(u=>{u.reject(new le(H.CANCELLED,a))})}),i.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await wl(n,r.hs)}}function AP(t,e){const n=je(t),r=n.Na.get(e);if(r&&r.va)return Ue().add(r.key);{let s=Ue();const i=n.Ma.get(e);if(!i)return s;for(const a of i){const c=n.Fa.get(a);s=s.unionWith(c.view.Va)}return s}}function Wb(t){const e=je(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ub.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=AP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=CP.bind(null,e),e.Ca.d_=mP.bind(null,e.eventManager),e.Ca.$a=fP.bind(null,e.eventManager),e}function PP(t){const e=je(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=NP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=SP.bind(null,e),e}class mu{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Hu(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,n){return null}Ha(e,n){return null}za(e){return OA(this.persistence,new MA,e.initialUser,this.serializer)}Ga(e){return new RA(Ff.Zr,this.serializer)}Wa(e){return new HA}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}mu.provider={build:()=>new mu};class hm{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>d0(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=IP.bind(null,this.syncEngine),await uP(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new hP}()}createDatastore(e){const n=Hu(e.databaseInfo.databaseId),r=function(i){return new KA(i)}(e.databaseInfo);return function(i,a,c,u){return new JA(i,a,c,u)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,a,c){return new ZA(r,s,i,a,c)}(this.localStore,this.datastore,e.asyncQueue,n=>d0(this.syncEngine,n,0),function(){return a0.D()?new a0:new WA}())}createSyncEngine(e,n){return function(s,i,a,c,u,d,h){const f=new vP(s,i,a,c,u,d);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=je(s);pe("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await xl(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}hm.provider={build:()=>new hm};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):rs("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RP{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=cn.UNAUTHENTICATED,this.clientId=Qw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{pe("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(pe("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Yr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Gf(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Wd(t,e){t.asyncQueue.verifyOperationInProgress(),pe("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await kb(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function m0(t,e){t.asyncQueue.verifyOperationInProgress();const n=await jP(t);pe("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>o0(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>o0(e.remoteStore,s)),t._onlineComponents=e}async function jP(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){pe("FirestoreClient","Using user provided OfflineComponentProvider");try{await Wd(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===H.FAILED_PRECONDITION||s.code===H.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;wa("Error using user provided cache. Falling back to memory cache: "+n),await Wd(t,new mu)}}else pe("FirestoreClient","Using default OfflineComponentProvider"),await Wd(t,new mu);return t._offlineComponents}async function qb(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(pe("FirestoreClient","Using user provided OnlineComponentProvider"),await m0(t,t._uninitializedComponentsProvider._online)):(pe("FirestoreClient","Using default OnlineComponentProvider"),await m0(t,new hm))),t._onlineComponents}function DP(t){return qb(t).then(e=>e.syncEngine)}async function fu(t){const e=await qb(t),n=e.eventManager;return n.onListen=xP.bind(null,e.syncEngine),n.onUnlisten=_P.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=wP.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=EP.bind(null,e.syncEngine),n}function MP(t,e,n={}){const r=new Yr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,c,u,d){const h=new Zf({next:g=>{h.Za(),a.enqueueAndForget(()=>Qf(i,f));const x=g.docs.has(c);!x&&g.fromCache?d.reject(new le(H.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&g.fromCache&&u&&u.source==="server"?d.reject(new le(H.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(g)},error:g=>d.reject(g)}),f=new Jf(Vu(c.path),h,{includeMetadataChanges:!0,_a:!0});return Kf(i,f)}(await fu(t),t.asyncQueue,e,n,r)),r.promise}function LP(t,e,n={}){const r=new Yr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,c,u,d){const h=new Zf({next:g=>{h.Za(),a.enqueueAndForget(()=>Qf(i,f)),g.fromCache&&u.source==="server"?d.reject(new le(H.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(g)},error:g=>d.reject(g)}),f=new Jf(c,h,{includeMetadataChanges:!0,_a:!0});return Kf(i,f)}(await fu(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gb(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f0=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kb(t,e,n){if(!n)throw new le(H.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function OP(t,e,n,r){if(e===!0&&r===!0)throw new le(H.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function p0(t){if(!Ee.isDocumentKey(t))throw new le(H.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function g0(t){if(Ee.isDocumentKey(t))throw new le(H.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Gu(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ke()}function Jn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new le(H.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Gu(t);throw new le(H.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function VP(t,e){if(e<=0)throw new le(H.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new le(H.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new le(H.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}OP("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Gb((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new le(H.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new le(H.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new le(H.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ku{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new y0({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new le(H.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new le(H.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new y0(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new eI;switch(r.type){case"firstParty":return new sI(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new le(H.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=f0.get(n);r&&(pe("ComponentProvider","Removing Datastore"),f0.delete(n),r.terminate())}(this),Promise.resolve()}}function $P(t,e,n,r={}){var s;const i=(t=Jn(t,Ku))._getSettings(),a=`${e}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==a&&wa("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:a,ssl:!1})),r.mockUserToken){let c,u;if(typeof r.mockUserToken=="string")c=r.mockUserToken,u=cn.MOCK_USER;else{c=m1(r.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new le(H.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new cn(d)}t._authCredentials=new tI(new Kw(c,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ni(this.firestore,e,this._query)}}class xn{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new zs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new xn(this.firestore,e,this._key)}}class zs extends ni{constructor(e,n,r){super(e,n,Vu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new xn(this.firestore,null,new Ee(e))}withConverter(e){return new zs(this.firestore,e,this._path)}}function Mt(t,e,...n){if(t=Pt(t),Kb("collection","path",e),t instanceof Ku){const r=ot.fromString(e,...n);return g0(r),new zs(t,null,r)}{if(!(t instanceof xn||t instanceof zs))throw new le(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ot.fromString(e,...n));return g0(r),new zs(t.firestore,null,r)}}function Zt(t,e,...n){if(t=Pt(t),arguments.length===1&&(e=Qw.newId()),Kb("doc","path",e),t instanceof Ku){const r=ot.fromString(e,...n);return p0(r),new xn(t,null,new Ee(r))}{if(!(t instanceof xn||t instanceof zs))throw new le(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ot.fromString(e,...n));return p0(r),new xn(t.firestore,t instanceof zs?t.converter:null,new Ee(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v0{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Ab(this,"async_queue_retry"),this.Vu=()=>{const r=Hd();r&&pe("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const n=Hd();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const n=Hd();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const n=new Yr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!pl(e))throw e;pe("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const n=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(a){let c=a.message||"";return a.stack&&(c=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),c}(r);throw rs("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=n,n}enqueueAfterDelay(e,n,r){this.fu(),this.Ru.indexOf(e)>-1&&(n=0);const s=qf.createAndSchedule(this,e,n,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&ke()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const n of this.Tu)if(n.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Tu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const n=this.Tu.indexOf(e);this.Tu.splice(n,1)}}function x0(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class Qs extends Ku{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new v0,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new v0(e),this._firestoreClient=void 0,await e}}}function FP(t,e){const n=typeof t=="object"?t:rw(),r=typeof t=="string"?t:e||"(default)",s=yf(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=d1("firestore");i&&$P(s,...i)}return s}function Qu(t){if(t._terminated)throw new le(H.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||UP(t),t._firestoreClient}function UP(t){var e,n,r;const s=t._freezeSettings(),i=function(c,u,d,h){return new yI(c,u,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,Gb(h.experimentalLongPollingOptions),h.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new RP(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(c){const u=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(u),_online:u}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Na{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Na(Xt.fromBase64String(e))}catch(n){throw new le(H.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Na(Xt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new le(H.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Kt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ju{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new le(H.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new le(H.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Qe(this._lat,e._lat)||Qe(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tp{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BP=/^__.*__$/;class zP{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new ti(e,this.data,this.fieldMask,n,this.fieldTransforms):new yl(e,this.data,n,this.fieldTransforms)}}class Qb{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new ti(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function Yb(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ke()}}class np{constructor(e,n,r,s,i,a){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new np(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return pu(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Yb(this.Cu)&&BP.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class HP{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||Hu(e)}Qu(e,n,r,s=!1){return new np({Cu:e,methodName:n,qu:r,path:Kt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function rp(t){const e=t._freezeSettings(),n=Hu(t._databaseId);return new HP(t._databaseId,!!e.ignoreUndefinedProperties,n)}function WP(t,e,n,r,s,i={}){const a=t.Qu(i.merge||i.mergeFields?2:0,e,n,s);ip("Data must be an object, but it was:",a,r);const c=Jb(r,a);let u,d;if(i.merge)u=new Vn(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const g=mm(e,f,n);if(!a.contains(g))throw new le(H.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);Zb(h,g)||h.push(g)}u=new Vn(h),d=a.fieldTransforms.filter(f=>u.covers(f.field))}else u=null,d=a.fieldTransforms;return new zP(new Tn(c),u,d)}class Xu extends Ju{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Xu}}class sp extends Ju{_toFieldTransform(e){return new BI(e.path,new Zo)}isEqual(e){return e instanceof sp}}function qP(t,e,n,r){const s=t.Qu(1,e,n);ip("Data must be an object, but it was:",s,r);const i=[],a=Tn.empty();Pi(r,(u,d)=>{const h=ap(e,u,n);d=Pt(d);const f=s.Nu(h);if(d instanceof Xu)i.push(h);else{const g=bl(d,f);g!=null&&(i.push(h),a.set(h,g))}});const c=new Vn(i);return new Qb(a,c,s.fieldTransforms)}function GP(t,e,n,r,s,i){const a=t.Qu(1,e,n),c=[mm(e,r,n)],u=[s];if(i.length%2!=0)throw new le(H.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)c.push(mm(e,i[g])),u.push(i[g+1]);const d=[],h=Tn.empty();for(let g=c.length-1;g>=0;--g)if(!Zb(d,c[g])){const x=c[g];let C=u[g];C=Pt(C);const y=a.Nu(x);if(C instanceof Xu)d.push(x);else{const k=bl(C,y);k!=null&&(d.push(x),h.set(x,k))}}const f=new Vn(d);return new Qb(h,f,a.fieldTransforms)}function KP(t,e,n,r=!1){return bl(n,t.Qu(r?4:3,e))}function bl(t,e){if(Xb(t=Pt(t)))return ip("Unsupported field value:",e,t),Jb(t,e);if(t instanceof Ju)return function(r,s){if(!Yb(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let a=0;for(const c of r){let u=bl(c,s.Lu(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=Pt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return $I(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Dt.fromDate(r);return{timestampValue:du(s.serializer,i)}}if(r instanceof Dt){const i=new Dt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:du(s.serializer,i)}}if(r instanceof ep)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Na)return{bytesValue:bb(s.serializer,r._byteString)};if(r instanceof xn){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Vf(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof tp)return function(a,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(u=>{if(typeof u!="number")throw c.Bu("VectorValues must only contain numeric values.");return Df(c.serializer,u)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Gu(r)}`)}(t,e)}function Jb(t,e){const n={};return Yw(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Pi(t,(r,s)=>{const i=bl(s,e.Mu(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function Xb(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Dt||t instanceof ep||t instanceof Na||t instanceof xn||t instanceof Ju||t instanceof tp)}function ip(t,e,n){if(!Xb(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const r=Gu(n);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function mm(t,e,n){if((e=Pt(e))instanceof Yu)return e._internalPath;if(typeof e=="string")return ap(t,e);throw pu("Field path arguments must be of type string or ",t,!1,void 0,n)}const QP=new RegExp("[~\\*/\\[\\]]");function ap(t,e,n){if(e.search(QP)>=0)throw pu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Yu(...e.split("."))._internalPath}catch{throw pu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function pu(t,e,n,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let c=`Function ${e}() called with invalid data`;n&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new le(H.INVALID_ARGUMENT,c+t+u)}function Zb(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e_{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new xn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new YP(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(op("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class YP extends e_{data(){return super.data()}}function op(t,e){return typeof e=="string"?ap(t,e):e instanceof Yu?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t_(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new le(H.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class lp{}class n_ extends lp{}function In(t,e,...n){let r=[];e instanceof lp&&r.push(e),r=r.concat(n),function(i){const a=i.filter(u=>u instanceof cp).length,c=i.filter(u=>u instanceof Zu).length;if(a>1||a>0&&c>0)throw new le(H.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Zu extends n_{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Zu(e,n,r)}_apply(e){const n=this._parse(e);return r_(e._query,n),new ni(e.firestore,e.converter,sm(e._query,n))}_parse(e){const n=rp(e.firestore);return function(i,a,c,u,d,h,f){let g;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new le(H.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){b0(f,h);const x=[];for(const C of f)x.push(w0(u,i,C));g={arrayValue:{values:x}}}else g=w0(u,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||b0(f,h),g=KP(c,a,f,h==="in"||h==="not-in");return At.create(d,h,g)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function An(t,e,n){const r=e,s=op("where",t);return Zu._create(s,r,n)}class cp extends lp{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new cp(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:mr.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let a=s;const c=i.getFlattenedFilters();for(const u of c)r_(a,u),a=sm(a,u)}(e._query,n),new ni(e.firestore,e.converter,sm(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class up extends n_{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new up(e,n,r)}_apply(e){return new ni(e.firestore,e.converter,cu(e._query,this._limit,this._limitType))}}function JP(t){return VP("limit",t),up._create("limit",t,"F")}function w0(t,e,n){if(typeof(n=Pt(n))=="string"){if(n==="")throw new le(H.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ib(e)&&n.indexOf("/")!==-1)throw new le(H.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(ot.fromString(n));if(!Ee.isDocumentKey(r))throw new le(H.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Uy(t,new Ee(r))}if(n instanceof xn)return Uy(t,n._key);throw new le(H.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Gu(n)}.`)}function b0(t,e){if(!Array.isArray(t)||t.length===0)throw new le(H.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function r_(t,e){const n=function(s,i){for(const a of s)for(const c of a.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new le(H.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new le(H.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class XP{convertValue(e,n="none"){switch(Si(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ct(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ni(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw ke()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Pi(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var n,r,s;const i=(s=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(a=>Ct(a.doubleValue));return new tp(i)}convertGeoPoint(e){return new ep(Ct(e.latitude),Ct(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Af(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Yo(e));default:return null}}convertTimestamp(e){const n=Gs(e);return new Dt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=ot.fromString(e);Ze(Sb(r));const s=new Jo(r.get(1),r.get(3)),i=new Ee(r.popFirst(5));return s.isEqual(n)||rs(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZP(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class s_ extends e_{constructor(e,n,r,s,i,a){super(e,n,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Ec(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(op("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class Ec extends s_{data(e={}){return super.data(e)}}class i_{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new ho(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Ec(this._firestore,this._userDataWriter,r.key,r,new ho(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new le(H.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(c=>{const u=new Ec(s._firestore,s._userDataWriter,c.doc.key,c.doc,new ho(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{const u=new Ec(s._firestore,s._userDataWriter,c.doc.key,c.doc,new ho(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,h=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),h=a.indexOf(c.doc.key)),{type:eR(c.type),doc:u,oldIndex:d,newIndex:h}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function eR(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ke()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oa(t){t=Jn(t,xn);const e=Jn(t.firestore,Qs);return MP(Qu(e),t._key).then(n=>a_(e,t,n))}class dp extends XP{constructor(e){super(),this.firestore=e}convertBytes(e){return new Na(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new xn(this.firestore,null,n)}}function Pn(t){t=Jn(t,ni);const e=Jn(t.firestore,Qs),n=Qu(e),r=new dp(e);return t_(t._query),LP(n,t._query).then(s=>new i_(e,r,t,s))}function ds(t,e,n,...r){t=Jn(t,xn);const s=Jn(t.firestore,Qs),i=rp(s);let a;return a=typeof(e=Pt(e))=="string"||e instanceof Yu?GP(i,"updateDoc",t._key,e,n,r):qP(i,"updateDoc",t._key,e),mp(s,[a.toMutation(t._key,ur.exists(!0))])}function Tc(t){return mp(Jn(t.firestore,Qs),[new Mf(t._key,ur.none())])}function _l(t,e){const n=Jn(t.firestore,Qs),r=Zt(t),s=ZP(t.converter,e);return mp(n,[WP(rp(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,ur.exists(!1))]).then(()=>r)}function hp(t,...e){var n,r,s;t=Pt(t);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||x0(e[a])||(i=e[a],a++);const c={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(x0(e[a])){const f=e[a];e[a]=(n=f.next)===null||n===void 0?void 0:n.bind(f),e[a+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[a+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let u,d,h;if(t instanceof xn)d=Jn(t.firestore,Qs),h=Vu(t._key.path),u={next:f=>{e[a]&&e[a](a_(d,t,f))},error:e[a+1],complete:e[a+2]};else{const f=Jn(t,ni);d=Jn(f.firestore,Qs),h=f._query;const g=new dp(d);u={next:x=>{e[a]&&e[a](new i_(d,g,f,x))},error:e[a+1],complete:e[a+2]},t_(t._query)}return function(g,x,C,y){const k=new Zf(y),w=new Jf(x,k,C);return g.asyncQueue.enqueueAndForget(async()=>Kf(await fu(g),w)),()=>{k.Za(),g.asyncQueue.enqueueAndForget(async()=>Qf(await fu(g),w))}}(Qu(d),h,c,u)}function mp(t,e){return function(r,s){const i=new Yr;return r.asyncQueue.enqueueAndForget(async()=>TP(await DP(r),s,i)),i.promise}(Qu(t),e)}function a_(t,e,n){const r=n.docs.get(e._key),s=new dp(t);return new s_(t,s,e._key,r,new ho(n.hasPendingWrites,n.fromCache),e.converter)}function wn(){return new sp("serverTimestamp")}(function(e,n=!0){(function(s){Da=s})(Ra),xa(new _i("firestore",(r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),c=new Qs(new nI(r.getProvider("auth-internal")),new aI(r.getProvider("app-check-internal")),function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new le(H.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Jo(d.options.projectId,h)}(a,s),a);return i=Object.assign({useFetchStreams:n},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),Bs(Ly,"4.7.3",e),Bs(Ly,"4.7.3","esm2017")})();const tR={apiKey:"AIzaSyB_1Dn63ZHRnA-jXytu95WEBWNFQ64Jo_E",authDomain:"dnd-v1-17acc.firebaseapp.com",projectId:"dnd-v1-17acc",storageBucket:"dnd-v1-17acc.firebasestorage.app",messagingSenderId:"976056329393",appId:"1:976056329393:web:7c8170e906162fe4ef2e90"},o_=nw(tR),is=Yk(o_),He=FP(o_),nR=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),ct=(t,e)=>{throw console.error(`Error in ${e}:`,t),t.code==="unavailable"||t.code==="deadline-exceeded"?new Error("Network connection issue. Please check your internet connection and try again."):t.code==="permission-denied"?new Error("Access denied. Please check your permissions."):t.code==="not-found"?new Error("The requested data was not found."):new Error(`Database error: ${t.message}`)},rR=async(t,e)=>{try{const n={...e,userId:t,createdAt:wn(),updatedAt:wn()};return{id:(await _l(Mt(He,"userProfiles"),n)).id,...n}}catch(n){ct(n,"createUserProfile")}},ed=async t=>{try{const e=In(Mt(He,"userProfiles"),An("userId","==",t)),n=await Pn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){ct(e,"getUserProfile")}},_0=async t=>{try{if(!t||t.length===0)return[];const e=[];for(let s=0;s<t.length;s+=10){const i=t.slice(s,s+10),a=In(Mt(He,"userProfiles"),An("userId","in",i));e.push(Pn(a))}const n=await Promise.all(e),r=[];return n.forEach(s=>{s.docs.forEach(i=>{r.push({id:i.id,...i.data()})})}),r}catch(e){ct(e,"getUserProfiles")}},sR=async t=>{try{const e=In(Mt(He,"userProfiles"),An("username","==",t));return(await Pn(e)).empty}catch(e){ct(e,"checkUsernameAvailability")}},l_=t=>{const{class:e,level:n,constitution:r,dexterity:s,strength:i}=t,c={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[e]||8,u=Math.floor((r-10)/2),d=Math.max(1,(c+u)*n),h=10,f=Math.floor((s-10)/2),x={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[e]||0,C=h+f+x;return{hp:Math.max(1,d),maxHp:Math.max(1,d),ac:Math.max(10,C)}},iR=async(t,e,n)=>{try{const r=Mt(He,"characters"),s=l_(n),i={...n,...s,userId:t,partyId:e,createdAt:new Date,updatedAt:new Date};return{id:(await _l(r,i)).id,...i}}catch(r){throw new Error(`Failed to save character: ${r.message}`)}},Cc=async t=>{try{const e=Mt(He,"characters"),n=In(e,An("userId","==",t));return(await Pn(n)).docs.map(i=>({id:i.id,...i.data()}))}catch(e){throw new Error(`Failed to get user characters: ${e.message}`)}},aR=async(t,e)=>{try{const n=Mt(He,"characters"),r=In(n,An("userId","==",t),An("partyId","==",e)),s=await Pn(r);if(s.empty)return null;const i=s.docs[0];return{id:i.id,...i.data()}}catch(n){throw new Error(`Failed to get character: ${n.message}`)}},nl=async t=>{try{const e=In(Mt(He,"characters"),An("partyId","==",t));return(await Pn(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){ct(e,"getPartyCharacters")}},fm=async t=>{try{const e=Zt(He,"characters",t);return await Tc(e),!0}catch(e){throw new Error(`Failed to delete character: ${e.message}`)}},oR=async t=>{try{console.log("Debugging characters for user:",t);const e=In(Mt(He,"characters"),An("userId","==",t)),r=(await Pn(e)).docs.map(a=>({id:a.id,...a.data()}));console.log("All characters for user:",r);const s=r.filter(a=>!a.partyId);s.length>0&&console.warn("Found characters without partyId:",s);const i={};return r.forEach(a=>{a.partyId&&(i[a.partyId]||(i[a.partyId]=[]),i[a.partyId].push(a))}),Object.entries(i).forEach(([a,c])=>{c.length>1&&console.warn(`Multiple characters found for party ${a}:`,c)}),{totalCharacters:r.length,orphanedCharacters:s.length,partyGroups:i}}catch(e){throw console.error("Error debugging characters:",e),e}},lR=async t=>{try{const n=(await Cc(t)).filter(s=>!s.partyId);if(n.length===0)return{deleted:0};const r=n.map(s=>fm(s.id));return await Promise.all(r),{deleted:n.length}}catch(e){throw new Error(`Failed to cleanup orphaned characters: ${e.message}`)}},c_=async(t,e)=>{try{const n={...e,dmId:t,members:[t],createdAt:wn(),updatedAt:wn()};return{id:(await _l(Mt(He,"parties"),n)).id,...n}}catch(n){ct(n,"createParty")}},u_=async t=>{try{const e=In(Mt(He,"parties"),An("members","array-contains",t));return(await Pn(e)).docs.map(s=>{const i=s.data();return{id:s.id,...i}})}catch(e){ct(e,"getUserParties")}},cR=async()=>{try{const t=In(Mt(He,"parties"),An("isPublic","==",!0));return(await Pn(t)).docs.map(r=>{const s=r.data();return{id:r.id,...s}}).sort((r,s)=>{var c,u,d,h;const i=((u=(c=r.createdAt)==null?void 0:c.toDate)==null?void 0:u.call(c))||r.createdAt||new Date(0);return(((h=(d=s.createdAt)==null?void 0:d.toDate)==null?void 0:h.call(d))||s.createdAt||new Date(0))-i})}catch(t){ct(t,"getPublicParties")}},E0=async(t,e)=>{try{const n=Zt(He,"parties",t),r=await Oa(n);if(!r.exists())throw new Error("Party not found");const s=r.data();if(s.members.includes(e))throw new Error("User already in party");await ds(n,{members:[...s.members,e],updatedAt:wn()})}catch(n){ct(n,"joinParty")}},d_=async(t,e)=>{try{const n=Zt(He,"parties",t),r=await Oa(n);if(!r.exists())throw new Error("Party not found");if(r.data().dmId!==e)throw new Error("Only the party leader can disband the party");await Tc(n);const i=In(Mt(He,"characters"),An("partyId","==",t)),c=(await Pn(i)).docs.map(f=>Tc(f.ref));await Promise.all(c);const u=In(Mt(He,"campaignStories"),An("partyId","==",t)),h=(await Pn(u)).docs.map(f=>Tc(f.ref));await Promise.all(h)}catch(n){ct(n,"disbandParty")}},uR=async t=>{try{const e=In(Mt(He,"parties"),An("inviteCode","==",t)),n=await Pn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){ct(e,"getPartyByInviteCode")}},dR=async t=>{try{const e=Zt(He,"parties",t),n=await Oa(e);return n.exists()?{id:n.id,...n.data()}:null}catch(e){ct(e,"getPartyById")}},hR=(t,e)=>{const n=Zt(He,"parties",t);return hp(n,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})},mR=async t=>{try{const e={partyId:t,status:"ready_up",currentPlot:null,storyMessages:[],votingSession:null,readyPlayers:[],lastUpdated:wn(),createdAt:wn()};return{id:(await _l(Mt(He,"campaignStories"),e)).id,...e}}catch(e){ct(e,"createCampaignStory")}},fR=async t=>{try{const e=In(Mt(He,"campaignStories"),An("partyId","==",t)),n=await Pn(e);if(n.empty)return null;const r=n.docs[0];return{id:r.id,...r.data()}}catch(e){ct(e,"getCampaignStory")}},gn=async(t,e)=>{try{const n=Zt(He,"campaignStories",t);await ds(n,{...e,lastUpdated:wn()})}catch(n){ct(n,"updateCampaignStory")}},pR=async(t,e)=>{try{const n=Zt(He,"campaignStories",t),i=(await Oa(n)).data().readyPlayers||[];i.includes(e)||await ds(n,{readyPlayers:[...i,e],lastUpdated:wn()})}catch(n){ct(n,"setPlayerReady")}},gR=(t,e)=>{try{const n=Zt(He,"campaignStories",t);return hp(n,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})}catch(n){ct(n,"subscribeToCampaignStory")}},yR=async(t,e)=>{try{const n=Zt(He,"campaignStories",t);await ds(n,{currentSpeaker:e,lastUpdated:wn()})}catch(n){ct(n,"setCurrentSpeaker")}},qd=async(t,e)=>{try{const n={partyId:t,status:"active",storyContext:e.storyContext,partyMembers:e.partyMembers,enemies:e.enemies,initiative:e.initiative,currentTurn:e.currentTurn||0,round:e.round||1,combatState:e.combatState||"active",environmentalFeatures:e.environmentalFeatures,teamUpOpportunities:e.teamUpOpportunities,narrativeElements:e.narrativeElements,createdAt:wn(),updatedAt:wn()};return{id:(await _l(Mt(He,"combatSessions"),n)).id,...n}}catch(n){ct(n,"createCombatSession")}},vR=async t=>{try{const e=Zt(He,"combatSessions",t),n=await Oa(e);return n.exists()?{id:n.id,...n.data()}:null}catch(e){ct(e,"getCombatSession")}},ws=async(t,e)=>{try{console.log(" updateCombatSession called with:",{combatId:t,updates:e});const n=Zt(He,"combatSessions",t);await ds(n,{...e,lastUpdated:wn()}),console.log(" updateCombatSession completed successfully")}catch(n){console.error(" Error in updateCombatSession:",n),ct(n,"updateCombatSession")}},h_=(t,e)=>{try{console.log(" Setting up combat session subscription for:",t);const n=Zt(He,"combatSessions",t);return hp(n,s=>{if(console.log(" Combat session subscription update received:",s.exists()?"Document exists":"Document does not exist"),s.exists()){const i={id:s.id,...s.data()};console.log(" Combat session data from subscription:",i),e(i)}else console.log(" Combat session document does not exist"),e(null)})}catch(n){console.error(" Error in subscribeToCombatSession:",n),ct(n,"subscribeToCombatSession")}},xR=async(t,e)=>{try{const n=await ed(t);if(!n)throw new Error("User profile not found");const r={id:nR(),...e,createdAt:new Date},i=[...n.characterPresets||[],r];return await ds(Zt(He,"userProfiles",n.id),{characterPresets:i}),r}catch(n){throw new Error(`Failed to save character preset: ${n.message}`)}},wR=async t=>{try{const e=await ed(t);return e?e.characterPresets||[]:[]}catch(e){ct(e,"getUserCharacterPresets")}},bR=async(t,e)=>{try{const n=await ed(t);if(!n)throw new Error("User profile not found");const s=(n.characterPresets||[]).filter(a=>a.id!==e),i=Zt(He,"userProfiles",n.id);await ds(i,{characterPresets:s,updatedAt:wn()})}catch(n){ct(n,"deleteCharacterPreset")}},_R=async(t,e)=>{try{const n=Zt(He,"combatSessions",t);await ds(n,{...e,updatedAt:wn()})}catch(n){ct(n,"updateCombatSessionWithNarrative")}},ER=async t=>{try{const e=Zt(He,"characters",t),n=await Oa(e);if(!n.exists())throw new Error(`Character document with ID ${t} does not exist`);const r=n.data(),s=l_(r);return await ds(e,{...s,updatedAt:new Date}),{id:t,...r,...s}}catch(e){throw new Error(`Failed to recalculate character stats: ${e.message}`)}},TR=async t=>{try{const n=(await nl(t)).filter(s=>!s.hp||!s.maxHp||!s.ac).map(s=>ER(s.id));return await Promise.all(n)}catch(e){throw new Error(`Failed to update party character stats: ${e.message}`)}},CR=()=>{const[t,e]=P.useState(null),[n,r]=P.useState(!0);return P.useEffect(()=>Aw(is,i=>{e(i),r(!1)}),[]),{user:t,loading:n}},NR=async(t,e,n)=>{try{if(console.log("Starting registration for:",t,n),!await sR(n))return console.log("Username not available:",n),{user:null,error:"Username is already taken. Please choose a different username."};console.log("Username available:",n);const s=await MS(is,t,e);console.log("User created successfully:",s.user.uid);try{await rR(s.user.uid,{username:n,email:t,displayName:n}),console.log("User profile created successfully")}catch(a){console.error("Error creating user profile:",a)}let i=!1;try{await OS(s.user),console.log("Email verification sent successfully"),i=!0}catch(a){console.error("Error sending email verification:",a)}return await Pw(is),console.log("User signed out after registration"),{user:null,error:null,success:!0}}catch(r){return console.error("Registration error:",r),{user:null,error:r.message}}},SR=async(t,e)=>{try{return{user:(await LS(is,t,e)).user,error:null}}catch(n){return{user:null,error:n.message}}},kR=async()=>{try{return await Pw(is),{error:null}}catch(t){return{error:t.message}}},Va=t=>Aw(is,async e=>{t(e)}),IR=async()=>{try{return console.log("Testing Firebase connection..."),console.log("Auth domain:",is.config.authDomain),console.log("Project ID:",is.config.projectId),{success:!0,message:"Firebase connection successful"}}catch(t){return console.error("Firebase connection test failed:",t),{success:!1,error:t.message}}};function AR(){const[t,e]=P.useState(null),[n,r]=P.useState(null),[s,i]=P.useState(!1),[a,c]=P.useState(!1),[u,d]=P.useState("connected"),h=er();P.useEffect(()=>{const x=Va(async C=>{if(e(C),C)try{const y=await ed(C.uid);r(y)}catch(y){console.error("Error loading user profile:",y)}else r(null)});return()=>x()},[h]),P.useEffect(()=>{const x=async()=>{try{const y=In(Mt(He,"_test"),JP(1));await Pn(y),d("connected")}catch(y){console.warn("Firestore connection issue detected:",y),d("disconnected"),setTimeout(()=>{d("reconnecting"),x()},5e3)}};x();const C=setInterval(x,3e4);return()=>clearInterval(C)},[]);const f=async()=>{const{error:x}=await kR();x||(h("/"),c(!1),i(!1))},g=(n==null?void 0:n.username)||(t==null?void 0:t.email);return o.jsx("nav",{className:"bg-gray-900 text-gray-100 shadow-lg border-b border-gray-700",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx(Er,{to:"/",className:"text-xl sm:text-2xl font-bold font-['Cinzel'] text-amber-400",children:"DND-V1"}),o.jsx("div",{className:"hidden md:flex items-center space-x-4",children:t?o.jsxs(o.Fragment,{children:[o.jsx(Er,{to:"/dashboard",className:"fantasy-button",children:"Dashboard"}),o.jsx(Er,{to:"/party-management",className:"fantasy-button",children:"Parties"}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{onClick:()=>i(!s),className:"fantasy-button bg-gray-700 hover:bg-gray-600",children:g}),s&&o.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-600 z-50",children:o.jsxs("div",{className:"py-2",children:[o.jsxs("div",{className:"px-4 py-2 text-sm text-gray-200 border-b border-gray-600",children:[o.jsx("div",{className:"font-medium",children:g}),o.jsx("div",{className:"text-xs text-gray-400",children:t.email})]}),o.jsx("button",{onClick:f,className:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-700",children:"Logout"})]})})]})]}):o.jsx(Er,{to:"/login",className:"fantasy-button",children:"Login"})}),o.jsx("div",{className:"md:hidden",children:o.jsx("button",{onClick:()=>c(!a),className:"fantasy-button bg-gray-700 hover:bg-gray-600 p-2",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a?o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})})]}),a&&o.jsx("div",{className:"md:hidden mt-4 pb-4 border-t border-gray-700",children:t?o.jsxs("div",{className:"pt-4 space-y-3",children:[o.jsx(Er,{to:"/dashboard",className:"fantasy-button block w-full text-center",onClick:()=>c(!1),children:"Dashboard"}),o.jsx(Er,{to:"/party-management",className:"fantasy-button block w-full text-center",onClick:()=>c(!1),children:"Parties"}),o.jsxs("div",{className:"pt-3 border-t border-gray-700",children:[o.jsxs("div",{className:"px-4 py-2 text-sm text-gray-200",children:[o.jsx("div",{className:"font-medium",children:g}),o.jsx("div",{className:"text-xs text-gray-400",children:t.email})]}),o.jsx("button",{onClick:f,className:"w-full text-left px-4 py-3 text-sm text-gray-200 hover:bg-gray-700 rounded-lg mt-2",children:"Logout"})]})]}):o.jsx("div",{className:"pt-4",children:o.jsx(Er,{to:"/login",className:"fantasy-button block w-full text-center",onClick:()=>c(!1),children:"Login"})})})]})})}const PR="3.1.3";function RR(){return o.jsxs("div",{className:"text-xs text-gray-400 text-center mt-2",children:["Version ",PR]})}function jR(){return o.jsxs("div",{className:"relative overflow-hidden",children:[o.jsx("div",{className:"fantasy-container",children:o.jsxs("div",{className:"relative z-10 py-8 sm:py-16 lg:py-24 text-center",children:[o.jsx("h1",{className:"fantasy-title text-5xl sm:text-6xl lg:text-7xl",children:"Manage your D&D world like a real adventurer's tome"}),o.jsx("p",{className:"fantasy-subtitle max-w-2xl mx-auto",children:"Create parties, invite friends, and share story objectives in a beautifully crafted digital environment that feels like a magical grimoire."}),o.jsxs("div",{className:"mt-8 flex justify-center space-x-6",children:[o.jsx(Er,{to:"/register",className:"fantasy-button text-lg px-8 py-3",children:"Start Your Journey"}),o.jsx(Er,{to:"/login",className:"fantasy-button text-lg px-8 py-3 bg-gray-600 hover:bg-gray-700",children:"Return to Campaign"})]})]})}),o.jsx("div",{className:"absolute inset-0 bg-gray-700/10 pattern-grid-lg"})]})}function DR(){return o.jsxs("div",{children:[o.jsx(jR,{}),o.jsx("div",{className:"fantasy-container py-16",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Create Parties"}),o.jsx("p",{className:"text-gray-300",children:"Form adventuring parties with your friends and manage your campaign together in a shared space."})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Track Objectives"}),o.jsx("p",{className:"text-gray-300",children:"Keep track of your party's quests, storylines, and achievements in an organized magical tome."})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Share Stories"}),o.jsx("p",{className:"text-gray-300",children:"Document your adventures and share them with your fellow party members in an immersive fantasy setting."})]})]})})]})}function MR(){const[t,e]=P.useState(""),[n,r]=P.useState(""),[s,i]=P.useState(!1),[a,c]=P.useState(""),[u,d]=P.useState(""),h=er(),f=ei();P.useEffect(()=>{var C;(C=f.state)!=null&&C.message&&(d(f.state.message),h(f.pathname,{replace:!0}));const x=Va(y=>{y&&h("/dashboard")});return()=>x()},[h,f]);const g=async x=>{x.preventDefault(),i(!0),c("");const C=await SR(t,n);C.error&&(C.error.includes("auth/invalid-credential")?c("Invalid email or password. Please check your credentials or register a new account."):C.error.includes("auth/user-not-found")?c("No account found with this email. Please register first."):C.error.includes("auth/wrong-password")?c("Incorrect password. Please try again."):C.error.includes("auth/user-disabled")?c("This account has been disabled. Please contact support."):C.error.includes("auth/too-many-requests")?c("Too many failed login attempts. Please try again later."):c(C.error)),i(!1)};return o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card max-w-md mx-auto",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Login"}),u&&o.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded-lg mb-4",children:u}),o.jsxs("form",{onSubmit:g,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-200 mb-2",children:"Email"}),o.jsx("input",{id:"email",type:"email",value:t,onChange:x=>e(x.target.value),className:"fantasy-input",autoComplete:"email",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-200 mb-2",children:"Password"}),o.jsx("input",{id:"password",type:"password",value:n,onChange:x=>r(x.target.value),className:"fantasy-input",autoComplete:"current-password",required:!0})]}),a&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded-lg",children:a}),o.jsx("button",{type:"submit",disabled:s,className:"fantasy-button w-full",children:s?"Logging in...":"Login"})]}),o.jsx("div",{className:"mt-6 text-center",children:o.jsxs("p",{className:"text-gray-300",children:["Don't have an account?"," ",o.jsx("button",{onClick:()=>h("/register"),className:"text-amber-400 hover:text-amber-300 font-medium",children:"Register here"})]})})]})})}function LR(){const[t,e]=P.useState(""),[n,r]=P.useState(""),[s,i]=P.useState(""),[a,c]=P.useState(""),[u,d]=P.useState(""),[h,f]=P.useState(""),g=er();P.useEffect(()=>{IR().then(C=>{console.log("Firebase test result:",C)})},[]);const x=async C=>{if(C.preventDefault(),d(""),f(""),s!==a){d("Passwords do not match");return}if(!n.trim()){d("Username is required");return}if(n.length<3){d("Username must be at least 3 characters long");return}if(!/^[a-zA-Z0-9_]+$/.test(n)){d("Username can only contain letters, numbers, and underscores");return}console.log("Submitting registration for:",t,n);const{user:y,error:k,success:w}=await NR(t,s,n);if(console.log("Registration result:",{user:y,error:k,success:w}),k){console.log("Setting error:",k),d(k);return}w?(console.log("Registration successful, redirecting to login"),g("/login",{state:{message:"Registration successful! Please check your email to verify your account before logging in."}})):console.log("No success received from registration")};return o.jsx("div",{className:"fantasy-container min-h-screen flex items-center justify-center",children:o.jsxs("div",{className:"fantasy-card w-full max-w-md",children:[o.jsx("h2",{className:"fantasy-title text-center",children:"Begin Your Adventure"}),u&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded mb-4",children:u}),h&&o.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded mb-4",children:h}),o.jsxs("form",{onSubmit:x,className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-200",children:"Username"}),o.jsx("input",{id:"username",type:"text",required:!0,value:n,onChange:C=>r(C.target.value),className:"fantasy-input mt-1",placeholder:"Choose a unique username"}),o.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Letters, numbers, and underscores only. 3+ characters."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-200",children:"Email"}),o.jsx("input",{id:"email",type:"email",required:!0,value:t,onChange:C=>e(C.target.value),className:"fantasy-input mt-1"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-200",children:"Password"}),o.jsx("input",{id:"password",type:"password",required:!0,value:s,onChange:C=>i(C.target.value),className:"fantasy-input mt-1"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-200",children:"Confirm Password"}),o.jsx("input",{id:"confirmPassword",type:"password",required:!0,value:a,onChange:C=>c(C.target.value),className:"fantasy-input mt-1"})]}),o.jsx("button",{type:"submit",className:"fantasy-button w-full",children:"Register"})]}),o.jsxs("p",{className:"mt-4 text-center text-sm text-gray-300",children:["Already have an account?"," ",o.jsx(Er,{to:"/login",className:"text-amber-400 hover:text-amber-300",children:"Return to your campaign"})]})]})})}function m_({validation:t,onClose:e,onProceed:n,onRevise:r}){const[s,i]=P.useState(!1),[a,c]=P.useState(!1),[u,d]=P.useState(null);if(P.useEffect(()=>{if(t!=null&&t.diceResult){i(!0),c(!0);const g=setTimeout(()=>{c(!1),d(t.diceResult)},2e3);return()=>clearTimeout(g)}},[t]),!t)return null;const h=(g,x)=>x==="critical success"?"text-green-800 bg-green-200 border-green-400":x==="great success"?"text-green-700 bg-green-100 border-green-300":x==="success"?"text-green-600 bg-green-50 border-green-200":x==="failure"?"text-red-600 bg-red-50 border-red-200":x==="great failure"?"text-red-700 bg-red-100 border-red-300":x==="critical failure"?"text-red-800 bg-red-200 border-red-400":g?"text-green-600 bg-green-100 border-green-300":"text-red-600 bg-red-100 border-red-300",f=()=>t.diceResult?o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-gradient-to-br from-amber-900 to-amber-800 rounded-2xl p-8 max-w-2xl w-full mx-4 border-4 border-amber-600 shadow-2xl",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"text-amber-200 text-lg font-bold mb-2",children:" THE DICE HAVE BEEN CAST "}),o.jsx("div",{className:"text-amber-300 text-sm",children:"The fate of your party hangs in the balance..."})]}),o.jsxs("div",{className:"bg-amber-950/50 rounded-lg p-4 mb-6 border border-amber-500",children:[o.jsx("div",{className:"text-amber-200 font-bold text-lg mb-2",children:"Your Action"}),o.jsx("div",{className:"text-amber-100 text-sm",children:t.diceResult.actions?t.diceResult.actions.map((g,x)=>o.jsxs("div",{className:"mb-2",children:[o.jsx("span",{className:"font-semibold capitalize",children:g.action}),o.jsxs("span",{className:"text-amber-300",children:[": ",g.description]})]},x)).join(""):"Rolling the dice..."})]}),a?o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"text-6xl mb-4 animate-bounce",children:""}),o.jsx("div",{className:"text-amber-200 text-xl font-bold mb-2",children:"Rolling..."}),o.jsx("div",{className:"text-amber-300 text-sm",children:"The dice tumble across the table"})]}):o.jsxs("div",{className:"space-y-4",children:[t.diceResult.actions?t.diceResult.actions.map((g,x)=>o.jsxs("div",{className:`rounded-lg p-4 border-2 ${h(g.check.isSuccess,g.check.degree)}`,children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("div",{className:"text-lg font-bold capitalize",children:g.action}),o.jsx("div",{className:"text-2xl font-bold",children:g.check.degree?g.check.degree.replace("_"," ").toUpperCase():g.check.isSuccess?"SUCCESS":"FAILURE"})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center mb-3",children:[o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"ROLL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:g.check.roll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"TOTAL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:g.check.totalRoll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"DC"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:g.check.dc})]})]}),o.jsx("div",{className:"text-sm text-amber-200",children:g.description})]},x)):o.jsxs("div",{className:`rounded-lg p-6 border-2 text-center ${h(t.diceResult.isSuccess)}`,children:[o.jsx("div",{className:"text-2xl font-bold mb-4",children:t.diceResult.isSuccess?"SUCCESS!":"FAILURE!"}),o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"ROLL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:t.diceResult.roll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"TOTAL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:t.diceResult.totalRoll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"DC"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:t.diceResult.dc})]})]})]}),t.diceResult.overallSuccess!==void 0&&o.jsxs("div",{className:`rounded-lg p-4 border-2 text-center ${t.diceResult.overallSuccess?"border-green-400 bg-green-900/50":"border-red-400 bg-red-900/50"}`,children:[o.jsx("div",{className:"text-xl font-bold mb-2",children:t.diceResult.overallSuccess?" MISSION ACCOMPLISHED! ":" THE DICE HAVE SPOKEN... "}),o.jsx("div",{className:"text-sm",children:t.diceResult.overallSuccess?"Your party's combined efforts have succeeded!":"The challenge has proven too great this time..."})]})]}),!a&&o.jsxs("div",{className:"bg-amber-950/50 rounded-lg p-4 mt-6 border border-amber-500",children:[o.jsx("div",{className:"text-amber-200 font-bold mb-2",children:" Dungeon Master's Commentary"}),o.jsx("div",{className:"text-amber-100 text-sm italic",children:typeof t.response=="string"?t.response:t.response.story})]}),!a&&o.jsxs("div",{className:"mt-6 flex justify-center space-x-4",children:[t.type==="valid"?o.jsx("button",{onClick:n,className:"fantasy-button bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:" PROCEED WITH FATE"}):o.jsx("button",{onClick:r,className:"fantasy-button bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:" TRY AGAIN"}),o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:" CANCEL"})]})]})}):null;return s?f():o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-gradient-to-br from-stone-800 to-stone-900 rounded-lg p-6 max-w-2xl w-full mx-4 border-2 border-stone-600 shadow-xl",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-stone-200",children:" Action Validation"}),o.jsx("button",{onClick:e,className:"text-stone-400 hover:text-stone-200 text-xl",children:""})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"p-4 bg-stone-700 rounded-lg border border-stone-600",children:[o.jsx("h4",{className:"font-semibold text-stone-200 mb-2",children:" Dungeon Master's Response"}),o.jsx("div",{className:"text-stone-300 italic leading-relaxed",children:typeof t.response=="string"?t.response:t.response.story})]}),t.suggestion&&o.jsxs("div",{className:"p-4 bg-blue-900/50 rounded-lg border border-blue-600",children:[o.jsx("h4",{className:"font-semibold text-blue-200 mb-2",children:" Suggestion"}),o.jsx("p",{className:"text-blue-100",children:t.suggestion})]}),t.type!=="valid"&&o.jsxs("div",{className:"p-4 bg-purple-900/50 rounded-lg border border-purple-600",children:[o.jsx("h4",{className:"font-semibold text-purple-200 mb-2",children:" Alternative Approaches"}),o.jsxs("ul",{className:"text-purple-100 text-sm space-y-1",children:[o.jsx("li",{children:" Try a more focused, single action"}),o.jsx("li",{children:" Consider your character's abilities and limitations"}),o.jsx("li",{children:" Think about what would be realistic in this situation"}),o.jsx("li",{children:" Ask for clarification about what you're trying to achieve"})]})]})]}),o.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[t.type==="valid"?o.jsx("button",{onClick:n,className:"fantasy-button bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold",children:"Proceed with Action"}):o.jsx("button",{onClick:r,className:"fantasy-button bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-bold",children:"Revise Action"}),o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700 text-white px-4 py-2 rounded font-bold",children:"Cancel"})]})]})})}function f_({diceResult:t,onClose:e}){if(!t)return null;const n=s=>{switch(s){case"critical success":return"text-green-600 bg-green-100";case"great success":return"text-green-700 bg-green-50";case"success":return"text-blue-600 bg-blue-100";case"failure":return"text-yellow-600 bg-yellow-100";case"great failure":return"text-orange-600 bg-orange-100";case"critical failure":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},r=s=>{switch(s){case"critical success":return"";case"great success":return"";case"success":return"";case"failure":return"";case"great failure":return"";case"critical failure":return"";default:return""}};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Dice Roll Results"}),o.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:""})]}),t.actions?o.jsxs("div",{className:"space-y-4",children:[t.actions.map((s,i)=>o.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:s.action}),o.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${n(s.check.degree)}`,children:[r(s.check.degree)," ",s.check.degree]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Roll:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.roll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Total:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.totalRoll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"DC:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.dc})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Margin:"}),o.jsxs("span",{className:`font-mono ml-1 ${s.check.margin>=0?"text-green-600":"text-red-600"}`,children:[s.check.margin>=0?"+":"",s.check.margin]})]})]}),s.check.circumstanceBonus!==0&&o.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:["Circumstance bonus: ",s.check.circumstanceBonus>=0?"+":"",s.check.circumstanceBonus]})]},i)),o.jsxs("div",{className:"mt-4 p-3 bg-stone-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"Overall Result"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${t.overallSuccess?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:t.overallSuccess?" Success":" Partial Failure"}),t.hasCriticalFailures&&o.jsx("span",{className:"text-red-600 text-sm",children:" Critical failures occurred"})]})]})]}):o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:t.actionType}),o.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${n(t.degree)}`,children:[r(t.degree)," ",t.degree]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Roll:"}),o.jsx("span",{className:"font-mono ml-1",children:t.roll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Total:"}),o.jsx("span",{className:"font-mono ml-1",children:t.totalRoll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"DC:"}),o.jsx("span",{className:"font-mono ml-1",children:t.dc})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Margin:"}),o.jsxs("span",{className:`font-mono ml-1 ${t.margin>=0?"text-green-600":"text-red-600"}`,children:[t.margin>=0?"+":"",t.margin]})]})]}),o.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:[o.jsxs("div",{children:["Primary Mod: ",t.primaryMod>=0?"+":"",t.primaryMod]}),o.jsxs("div",{children:["Proficiency: ",t.proficiencyMod>=0?"+":"",t.proficiencyMod]}),t.circumstanceBonus!==0&&o.jsxs("div",{children:["Circumstance: ",t.circumstanceBonus>=0?"+":"",t.circumstanceBonus]})]})]})}),o.jsx("div",{className:"mt-4 flex justify-end",children:o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Close"})})]})})}function OR({multipleResults:t,onClose:e}){const[n,r]=P.useState(!1),[s,i]=P.useState(null);if(!t)return null;const{actionType:a,numberOfAttempts:c,results:u,statistics:d}=t,h=y=>y.adjustedSuccess&&y.adjustedMargin>=10?"bg-green-500":y.adjustedSuccess?"bg-green-400":!y.adjustedSuccess&&y.adjustedMargin<=-10?"bg-red-500":"bg-red-400",f=y=>y.adjustedSuccess&&y.adjustedMargin>=10?"":y.adjustedSuccess?"":!y.adjustedSuccess&&y.adjustedMargin<=-10?"":"",g=y=>{const k=`Attempt ${y.attemptNumber}: ${y.roll} + ${y.primaryMod} + ${y.proficiencyMod}`,w=y.fatiguePenalty>0?` - ${y.fatiguePenalty} (fatigue)`:"",b=` = ${y.adjustedTotalRoll} vs DC ${y.dc}`,I=y.adjustedSuccess?" (Success)":" (Failure)";return k+w+b+I},C=((y,k=50)=>{const w=[];for(let b=0;b<y.length;b+=k)w.push(y.slice(b,b+k));return w})(u);return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsxs("h3",{className:"text-lg font-bold text-stone-800",children:["Multiple Attempts: ",a," (",c," attempts)"]}),o.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:""})]}),o.jsxs("div",{className:"mb-6 p-4 bg-stone-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-stone-700 mb-3",children:"Overall Statistics"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.successfulAttempts}),o.jsx("div",{className:"text-sm text-stone-600",children:"Successful"})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[d.successRate.toFixed(1),"%"]}),o.jsx("div",{className:"text-sm text-stone-600",children:"Success Rate"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-amber-600",children:d.criticalSuccesses}),o.jsx("div",{className:"text-sm text-stone-600",children:"Critical Successes"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-red-600",children:d.criticalFailures}),o.jsx("div",{className:"text-sm text-stone-600",children:"Critical Failures"})]})]}),o.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Average Roll:"})," ",d.averageRoll.toFixed(1)]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Best Roll:"})," ",d.bestRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Worst Roll:"})," ",d.worstRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Average Total:"})," ",d.averageTotalRoll.toFixed(1)]})]})]}),o.jsxs("div",{className:"mb-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700",children:"Individual Attempts"}),o.jsx("button",{onClick:()=>r(!n),className:"text-sm text-blue-600 hover:text-blue-800",children:n?"Hide Details":"Show Details"})]}),o.jsx("div",{className:"space-y-2",children:C.map((y,k)=>o.jsxs("div",{className:"flex flex-wrap gap-1",children:[y.map(w=>o.jsx("div",{className:`w-6 h-6 rounded text-xs flex items-center justify-center cursor-pointer transition-colors ${h(w)} text-white font-bold`,title:g(w),onClick:()=>i(w),children:f(w)},w.attemptNumber)),k<C.length-1&&o.jsx("div",{className:"w-full h-px bg-stone-300 my-2"})]},k))})]}),o.jsxs("div",{className:"mb-4 p-3 bg-stone-50 rounded-lg",children:[o.jsx("h5",{className:"font-semibold text-stone-700 mb-2",children:"Legend"}),o.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-green-500 rounded text-white text-xs flex items-center justify-center",children:""}),o.jsx("span",{children:"Critical Success"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-green-400 rounded text-white text-xs flex items-center justify-center",children:""}),o.jsx("span",{children:"Success"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-red-400 rounded text-white text-xs flex items-center justify-center",children:""}),o.jsx("span",{children:"Failure"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-4 h-4 bg-red-500 rounded text-white text-xs flex items-center justify-center",children:""}),o.jsx("span",{children:"Critical Failure"})]})]})]}),s&&o.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[o.jsxs("h5",{className:"font-semibold text-blue-700 mb-2",children:["Attempt ",s.attemptNumber," Details"]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Roll:"})," ",s.roll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Primary Mod:"})," ",s.primaryMod>=0?"+":"",s.primaryMod]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Proficiency:"})," ",s.proficiencyMod>=0?"+":"",s.proficiencyMod]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Fatigue Penalty:"})," -",s.fatiguePenalty]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Total:"})," ",s.adjustedTotalRoll]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"DC:"})," ",s.dc]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Margin:"})," ",s.adjustedMargin>=0?"+":"",s.adjustedMargin]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-semibold",children:"Result:"}),o.jsx("span",{className:`ml-1 px-2 py-1 rounded text-xs font-medium ${s.adjustedSuccess?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.adjustedSuccess?"Success":"Failure"})]})]}),o.jsx("button",{onClick:()=>i(null),className:"mt-2 text-sm text-blue-600 hover:text-blue-800",children:"Close Details"})]}),n&&o.jsxs("div",{className:"mb-4",children:[o.jsx("h5",{className:"font-semibold text-stone-700 mb-2",children:"Detailed Results"}),o.jsx("div",{className:"max-h-64 overflow-y-auto",children:o.jsxs("table",{className:"w-full text-sm",children:[o.jsx("thead",{className:"bg-stone-100",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-2 py-1 text-left",children:"#"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Roll"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Total"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"DC"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Fatigue"}),o.jsx("th",{className:"px-2 py-1 text-left",children:"Result"})]})}),o.jsx("tbody",{children:u.map(y=>o.jsxs("tr",{className:"border-b border-stone-200",children:[o.jsx("td",{className:"px-2 py-1",children:y.attemptNumber}),o.jsx("td",{className:"px-2 py-1",children:y.roll}),o.jsx("td",{className:"px-2 py-1",children:y.adjustedTotalRoll}),o.jsx("td",{className:"px-2 py-1",children:y.dc}),o.jsxs("td",{className:"px-2 py-1",children:["-",y.fatiguePenalty]}),o.jsx("td",{className:"px-2 py-1",children:o.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${y.adjustedSuccess?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:y.adjustedSuccess?"Success":"Failure"})})]},y.attemptNumber))})]})})]}),o.jsx("div",{className:"flex justify-end",children:o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Close"})})]})})}function VR(){const t=er(),[e,n]=P.useState(null),[r,s]=P.useState([]),[i,a]=P.useState(!0);P.useState(""),P.useState(""),P.useState(null),P.useState(!1),P.useState(!1),P.useState(!1),P.useState(null),P.useState(null),P.useState(null),P.useEffect(()=>{const y=is.onAuthStateChanged(async k=>{k?(n(k),await c(k.uid)):t("/login")});return()=>y()},[t]);const c=async y=>{try{const k=await u_(y);await u(k),s(k)}catch(k){console.error("Error loading user data:",k)}finally{a(!1)}},u=async y=>{for(const k of y)if(k.members)for(const w of k.members)w.profileId},d=async y=>{try{await d_(y,e.uid),s(k=>k.filter(w=>w.id!==y))}catch(k){console.error("Error deleting party:",k)}},h=async y=>{try{if(console.log("=== CONTINUE CAMPAIGN DEBUG ==="),console.log("handleContinueCampaign called with partyId:",y),console.log("Current user:",e==null?void 0:e.uid),console.log("User object:",e),!(e!=null&&e.uid)){console.error("No user ID found!"),alert("User not authenticated. Please log in again.");return}if(!y){console.error("No party ID provided!"),alert("Invalid party information.");return}console.log("Calling getCharacterByUserAndParty...");const k=await aR(e.uid,y);console.log("Character check result:",k),k?(console.log("User has character, navigating to campaign:",k.name),console.log("Navigation URL will be:",`/campaign/${y}`),t(`/campaign/${y}`)):(console.log("No character found, navigating to character creation"),console.log("Navigation URL will be:",`/character-creation/${y}`),t(`/character-creation/${y}`))}catch(k){console.error("Error in handleContinueCampaign:",k),console.error("Error details:",{message:k.message,stack:k.stack}),console.log("Error occurred, defaulting to character creation"),t(`/character-creation/${y}`)}},f=()=>{t("/test-environment")},g=async()=>{if(e)try{console.log("=== DEBUGGING CHARACTERS ===");const y=await oR(e.uid);console.log("Debug info:",y),alert(`Debug complete! Check console for details.
Total characters: ${y.totalCharacters}
Orphaned: ${y.orphanedCharacters}`)}catch(y){console.error("Debug error:",y),alert("Debug failed: "+y.message)}},x=()=>{if(r.length>0){const y=r[0];console.log("Testing direct navigation to character creation for party:",y.id),t(`/character-creation/${y.id}`)}else alert("No parties available for testing")},C=async()=>{if(e)try{console.log("=== CLEANING UP ORPHANED CHARACTERS ===");const y=await lR(e.uid);console.log("Cleanup result:",y),alert(`Cleanup complete! Deleted ${y.deleted} orphaned characters.`),window.location.reload()}catch(y){console.error("Cleanup error:",y),alert("Cleanup failed: "+y.message)}};return i?o.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto"}),o.jsx("p",{className:"mt-4 text-gray-300",children:"Loading..."})]})}):o.jsx("div",{className:"min-h-screen bg-gray-900",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"mb-6 sm:mb-8",children:[o.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-100",children:"Dashboard"}),o.jsxs("p",{className:"text-gray-300 mt-2 text-sm sm:text-base",children:["Welcome back, ",(e==null?void 0:e.displayName)||(e==null?void 0:e.email),"! Manage your campaigns and test the system."]})]}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Test Environment"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Test action validation, dice rolling, and combat detection in a controlled environment."}),o.jsx("button",{onClick:f,className:"w-full fantasy-button bg-green-600 hover:bg-green-700",children:"Open Test Environment"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Create New Campaign"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Start a new campaign with your party."}),o.jsx("button",{onClick:()=>t("/campaign-management"),className:"w-full fantasy-button bg-blue-600 hover:bg-blue-700",children:"Create Campaign"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Party Management"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Join existing parties or manage your party memberships."}),o.jsx("button",{onClick:()=>t("/party-management"),className:"w-full fantasy-button bg-purple-600 hover:bg-purple-700",children:"Manage Parties"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Debug Characters"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Debug character issues and check for orphaned characters."}),o.jsx("button",{onClick:g,className:"w-full fantasy-button bg-red-600 hover:bg-red-700",children:"Debug Characters"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Test Character Creation"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Test direct navigation to character creation (bypasses character check)."}),o.jsx("button",{onClick:x,className:"w-full fantasy-button bg-orange-600 hover:bg-orange-700",children:"Test Character Creation"})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Cleanup Characters"}),o.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"Remove orphaned characters that don't have a party ID."}),o.jsx("button",{onClick:C,className:"w-full fantasy-button bg-yellow-600 hover:bg-yellow-700",children:"Cleanup Characters"})]})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("div",{className:"border-b border-gray-700 pb-4 mb-4",children:o.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:"Your Campaigns"})}),r.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-gray-300 mb-4",children:"You haven't created any campaigns yet."}),o.jsx("button",{onClick:()=>t("/campaign-management"),className:"fantasy-button bg-blue-600 hover:bg-blue-700",children:"Create Your First Campaign"})]}):o.jsx("div",{className:"space-y-4",children:r.map(y=>{var k;return o.jsx("div",{className:"border border-gray-600 rounded-lg p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100",children:y.name}),o.jsx("p",{className:"text-gray-300 mt-1 text-sm",children:y.description}),o.jsxs("div",{className:"flex flex-wrap items-center mt-2 gap-2 text-xs sm:text-sm text-gray-400",children:[o.jsxs("span",{children:[((k=y.members)==null?void 0:k.length)||0," members"]}),o.jsx("span",{children:""}),o.jsxs("span",{children:["Theme: ",y.theme]}),o.jsx("span",{children:""}),o.jsxs("span",{children:["Created: ",new Date(y.createdAt).toLocaleDateString()]})]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[o.jsx("button",{onClick:()=>h(y.id),className:"fantasy-button bg-blue-600 hover:bg-blue-700 flex-1",children:"Continue"}),o.jsx("button",{onClick:()=>d(y.id),className:"fantasy-button bg-red-600 hover:bg-red-700 flex-1",children:"Delete"})]})]})},y.id)})})]})]})})}class fp{constructor(){this.diceTypes={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20,d100:100},this.difficultyClasses={veryEasy:5,easy:10,medium:15,hard:20,veryHard:25,nearlyImpossible:30},this.actionTypes={attack:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:10,description:"Physical attack roll"},spell:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:12,description:"Spell casting check"},dodge:{primaryAbility:"dexterity",secondaryAbility:"wisdom",baseDC:15,description:"Dodge incoming attacks"},parry:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:18,description:"Parry with weapon"},backflip:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:20,description:"Perform a backflip"},somersault:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:18,description:"Perform a somersault"},cartwheel:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:16,description:"Perform a cartwheel"},wallRun:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:22,description:"Run up a wall"},jump:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:12,description:"Jump over obstacles"},climb:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:15,description:"Climb surfaces"},swim:{primaryAbility:"strength",secondaryAbility:"constitution",baseDC:14,description:"Swim through water"},fly:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:30,description:"Fly through the air"},persuade:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:15,description:"Persuade someone"},intimidate:{primaryAbility:"charisma",secondaryAbility:"strength",baseDC:16,description:"Intimidate someone"},deceive:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:18,description:"Deceive someone"},spot:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:12,description:"Spot hidden objects or creatures"},listen:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:10,description:"Listen for sounds"},search:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:14,description:"Search for hidden items"},pickLock:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:20,description:"Pick a lock"},disarmTrap:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:22,description:"Disarm a trap"},heal:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:16,description:"Provide medical aid"},craft:{primaryAbility:"intelligence",secondaryAbility:"dexterity",baseDC:18,description:"Craft an item"}},this.impossibleActionPatterns=[/\b(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,/\b(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,/\b(?:jump|leap)\s+(?:to|over|across)\s+(?:the\s+)?(?:moon|sky|clouds?)\b/gi,/\b(?:teleport|blink|phase)\s+(?:to|through)\b/gi,/\b(?:time\s+travel|rewind|fast\s+forward)\b/gi,/\b(?:summon|create)\s+(?:a\s+)?(?:dragon|god|demon)\b/gi,/\b(?:become|turn\s+into)\s+(?:invisible|invincible|immortal)\b/gi,/\b(?:kill|destroy|eliminate)\s+(?:the\s+)?(?:dm|dungeon\s+master|narrator)\b/gi,/\b(?:break|destroy)\s+(?:the\s+)?(?:fourth\s+wall|game|story)\b/gi,/\b(?:skip|ignore)\s+(?:the\s+)?(?:quest|mission|story)\b/gi,/\b(?:teleport|go)\s+(?:to\s+)?(?:the\s+)?(?:end|final\s+boss|treasure)\b/gi,/\b(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,/\b(?:open|unlock)\s+(?:the\s+)?(?:door|chest)\s+(?:without\s+)?(?:key|lockpick)\b/gi,/\b(?:find|locate)\s+(?:the\s+)?(?:hidden\s+)?(?:passage|door)\s+(?:without\s+)?(?:searching)\b/gi],this.circumstanceModifiers={"in darkness":-2,"in bright light":1,"in difficult terrain":-2,"on slippery surface":-3,"in water":-2,"in tight space":-1,"with cover":2,"with high ground":1,"with low ground":-1,"with proper tools":2,"with improvised tools":-1,"without tools":-3,"with magical item":1,"with masterwork item":2,"while injured":-2,"while exhausted":-3,"while hasted":2,"while blessed":1,"while cursed":-2,"while poisoned":-1,"under time pressure":-2,"with preparation":1,"with careful planning":2,"in a hurry":-2,"with authority":1,"with evidence":2,"with witnesses":-1,"in private":1,"in public":-1}}rollDie(e){return Math.floor(Math.random()*e)+1}rollDice(e,n){const r=[];for(let s=0;s<e;s++)r.push(this.rollDie(n));return r}rollWithAdvantage(){const e=this.rollDie(20),n=this.rollDie(20);return{result:Math.max(e,n),rolls:[e,n],advantage:!0}}rollWithDisadvantage(){const e=this.rollDie(20),n=this.rollDie(20);return{result:Math.min(e,n),rolls:[e,n],disadvantage:!0}}getAbilityModifier(e){return Math.floor((e-10)/2)}getProficiencyBonus(e){return Math.floor((e-1)/4)+2}performSkillCheck(e,n,r=[],s=null){const i=this.actionTypes[n];if(!i)throw new Error(`Unknown action type: ${n}`);let a=s||i.baseDC,c=0;r.forEach(b=>{this.circumstanceModifiers[b]&&(c+=this.circumstanceModifiers[b])});const u=this.getAbilityModifier(e[i.primaryAbility]||10),d=this.getAbilityModifier(e[i.secondaryAbility]||10),h=this.getProficiencyBonus(e.level||1),g=this.checkProficiency(e,n)?h:0,x=this.rollDie(20),C=x+u+g+c,y=C>=a,k=C-a;let w="failure";return y?k>=10?w="critical success":k>=5?w="great success":w="success":k<=-10?w="critical failure":k<=-5?w="great failure":w="failure",{actionType:n,roll:x,totalRoll:C,dc:a,primaryMod:u,secondaryMod:d,proficiencyMod:g,circumstanceBonus:c,isSuccess:y,degree:w,margin:k,circumstances:r,character:{name:e.name,level:e.level,[i.primaryAbility]:e[i.primaryAbility],[i.secondaryAbility]:e[i.secondaryAbility]}}}checkProficiency(e,n){const r=e.proficiencies||[],i={Fighter:["attack","dodge","parry"],Rogue:["dodge","pickLock","disarmTrap","spot","listen"],Wizard:["spell","search","craft"],Cleric:["heal","persuade","spot"],Ranger:["spot","listen","climb","swim"],Paladin:["attack","parry","persuade"],Monk:["attack","dodge","backflip","somersault","cartwheel"],Bard:["persuade","deceive","intimidate"],Druid:["heal","spot","listen"],Sorcerer:["spell","persuade"],Warlock:["spell","intimidate"],Barbarian:["attack","intimidate","jump","climb"]}[e.class]||[];return r.includes(n)||i.includes(n)}validateAction(e,n,r={}){const s=e.toLowerCase();for(const y of this.impossibleActionPatterns)if(y.test(s))return{possible:!1,reason:"This action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};let i=this.extractActionsFromDescription(s);if(i=i.filter(y=>y.type!==void 0),i.length===0)return{possible:!0,reason:"No valid action detected. Action appears to be narrative or unsupported.",suggestion:"Try a different action or rephrase your input.",actions:[],overallSuccess:!0,hasCriticalFailures:!1,criticalFailures:[]};const a=r.customContext;let c=[],u=[],d=[];a&&(a.environmentalFeatures&&(u=a.environmentalFeatures,c.push(`Environmental features: ${u.join(", ")}`)),a.npcs&&(d=a.npcs,c.push(`NPCs present: ${d.map(y=>y.name).join(", ")}`)),a.circumstances&&c.push(`Circumstances: ${a.circumstances.join(", ")}`));const h=i.map((y,k)=>{const w=Math.max(0,k*2),b=Array.isArray(y.circumstances)?[...y.circumstances]:[];w>0&&b.push(`while fatigued (action ${k+1} of ${i.length})`),u.forEach(j=>{b.includes(j)||b.push(j)}),a&&a.circumstances&&a.circumstances.forEach(j=>{b.includes(j)||b.push(j)});const I=this.performSkillCheck(n,y.type,b);return{action:y.type,description:y.description,check:I,difficulty:this.getDifficultyDescription(I.dc),position:y.position||k+1,totalInSequence:y.totalInSequence||i.length,quantity:y.quantity||1,keyword:y.keyword,isSequence:y.isSequence||!1,fatiguePenalty:w,contextModifiers:c.length>0?c:null}}),f=h.every(y=>y.check.isSuccess),g=h.filter(y=>y.check.degree==="critical failure"),x=h.filter(y=>!y.check.isSuccess);let C="";if(i.length===1)C=`Single action detected: ${h[0].description}`;else{const y=[...new Set(h.map(w=>w.action))];C=`Multiple actions detected: ${h.reduce((w,b)=>w+b.quantity,0)} total actions across ${y.length} different types`}return a&&(C+=` | Context: ${a.description.substring(0,50)}${a.description.length>50?"...":""}`),{possible:!0,actions:h,overallSuccess:f,hasCriticalFailures:g.length>0,criticalFailures:g,failures:x,totalActions:i.length,summary:C,contextInfo:a?{description:a.description,environmentalFeatures:u,npcs:d,circumstances:a.circumstances||[]}:null,suggestion:this.generateActionSuggestion(h,n)}}extractActionsFromDescription(e){var u,d;const n=[],r=e.toLowerCase(),s=[/\b(\d+)\s+(backflips?|somersaults?|cartwheels?|jumps?|leaps?|hops?)\b/gi,/\b(\d+)\s+(punches?|kicks?|strikes?|attacks?|swings?|slashes?)\b/gi,/\b(\d+)\s+(spells?|casts?|magic\s+spells?)\b/gi,/\b(\d+)\s+(dodges?|evades?|parries?|blocks?)\b/gi,/\b(\d+)\s+(climbs?|scales?|swims?)\b/gi,/\b(\d+)\s+(searches?|looks?|examines?)\b/gi,/\b(\d+)\s+(persuades?|intimidates?|deceives?)\b/gi];s.forEach(h=>{var g;let f;for(;(f=h.exec(r))!==null;){const x=parseInt(f[1]),C=f[2],y=this.mapKeywordToActionType(C);if(y)for(let k=0;k<x;k++){const w=this.extractCircumstances(e);n.push({type:y,description:((g=this.actionTypes[y])==null?void 0:g.description)||`${y} action`,circumstances:w,keyword:C,quantity:x,position:k+1,totalInSequence:x})}}}),Object.entries(this.actionTypes).forEach(([h,f])=>{this.getActionKeywords(h).forEach(x=>{if(!n.some(y=>y.type===h)&&r.includes(x)&&!s.some(k=>new RegExp(k.source.replace(/\\d\+/,"\\d+"),"gi").test(r))){const k=this.extractCircumstances(e);n.push({type:h,description:f.description,circumstances:k,keyword:x,quantity:1,position:1,totalInSequence:1})}})}),[/\b(backflip|somersault|cartwheel|jump|leap|hop)\s+(?:and\s+then\s+)?(punch|kick|strike|attack|swing|slash)\b/gi,/\b(punch|kick|strike|attack|swing|slash)\s+(?:and\s+then\s+)?(backflip|somersault|cartwheel|jump|leap|hop)\b/gi,/\b(dodge|evade|parry|block)\s+(?:and\s+then\s+)?(attack|strike|punch|kick)\b/gi,/\b(attack|strike|punch|kick)\s+(?:and\s+then\s+)?(dodge|evade|parry|block)\b/gi].forEach(h=>{var g,x;let f;for(;(f=h.exec(r))!==null;){const C=this.mapKeywordToActionType(f[1]),y=this.mapKeywordToActionType(f[2]);if(C&&y){const k=this.extractCircumstances(e);n.some(w=>w.type===C&&w.keyword===f[1])||n.push({type:C,description:((g=this.actionTypes[C])==null?void 0:g.description)||`${C} action`,circumstances:k,keyword:f[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),n.some(w=>w.type===y&&w.keyword===f[2])||n.push({type:y,description:((x=this.actionTypes[y])==null?void 0:x.description)||`${y} action`,circumstances:k,keyword:f[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}});const a=/\b(\w+)\s+and\s+(\w+)\b/gi;let c;for(;(c=a.exec(r))!==null;){const h=this.mapKeywordToActionType(c[1]),f=this.mapKeywordToActionType(c[2]);if(h&&f){const g=this.extractCircumstances(e);n.some(x=>x.type===h&&x.keyword===c[1])||n.push({type:h,description:((u=this.actionTypes[h])==null?void 0:u.description)||`${h} action`,circumstances:g,keyword:c[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),n.some(x=>x.type===f&&x.keyword===c[2])||n.push({type:f,description:((d=this.actionTypes[f])==null?void 0:d.description)||`${f} action`,circumstances:g,keyword:c[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}return n}mapKeywordToActionType(e){return{punch:"attack",punches:"attack",kick:"attack",kicks:"attack",strike:"attack",strikes:"attack",attack:"attack",attacks:"attack",swing:"attack",swings:"attack",slash:"attack",slashes:"attack",thrust:"attack",thrusts:"attack",backflip:"backflip",backflips:"backflip",somersault:"somersault",somersaults:"somersault",cartwheel:"cartwheel",cartwheels:"cartwheel",jump:"jump",jumps:"jump",leap:"jump",leaps:"jump",hop:"jump",hops:"jump",climb:"climb",climbs:"climb",scale:"climb",scales:"climb",swim:"swim",swims:"swim",dodge:"dodge",dodges:"dodge",evade:"dodge",evades:"dodge",parry:"parry",parries:"parry",block:"parry",blocks:"parry",spell:"spell",spells:"spell",cast:"spell",casts:"spell","magic spell":"spell","magic spells":"spell",persuade:"persuade",persuades:"persuade",intimidate:"intimidate",intimidates:"intimidate",deceive:"deceive",deceives:"deceive",search:"search",searches:"search",look:"search",looks:"search",examine:"search",examines:"search"}[e.toLowerCase()]}getActionKeywords(e){return{attack:["attack","strike","hit","swing","slash","thrust","punch","kick"],spell:["cast","spell","magic","enchant","charm"],dodge:["dodge","evade","avoid","sidestep"],parry:["parry","block","deflect"],backflip:["backflip","back flip"],somersault:["somersault","forward roll"],cartwheel:["cartwheel"],wallRun:["wall run","run up wall"],jump:["jump","leap","hop"],climb:["climb","scale"],swim:["swim"],fly:["fly","levitate","float"],persuade:["persuade","convince","talk into"],intimidate:["intimidate","threaten","scare"],deceive:["deceive","lie","trick"],spot:["spot","see","notice","observe"],listen:["listen","hear"],search:["search","look for","find"],pickLock:["pick lock","lockpick"],disarmTrap:["disarm","trap"],heal:["heal","cure","treat"],craft:["craft","make","create","build"]}[e]||[]}extractCircumstances(e){const n=[];return Object.keys(this.circumstanceModifiers).forEach(r=>{e.includes(r)&&n.push(r)}),n}getDifficultyDescription(e){return e<=5?"Very Easy":e<=10?"Easy":e<=15?"Medium":e<=20?"Hard":e<=25?"Very Hard":"Nearly Impossible"}generateActionSuggestion(e,n){const r=e.filter(i=>!i.check.isSuccess);return r.length===0?"All actions are within your capabilities. Proceed with confidence!":r.map(i=>{const a=i.action;return i.check.degree==="critical failure"?`The ${a} is extremely difficult for you. Consider an alternative approach or ask for help.`:`The ${a} is challenging. You might want to take your time or use better equipment.`}).join(" ")}performActionSequence(e,n,r={}){const s=[];let i=0;for(let u=0;u<n.length;u++){const d=n[u],h=Array.isArray(d.circumstances)?[...d.circumstances]:[];i>0?h.push("with momentum"):i<0&&h.push("while fatigued");const f=this.performSkillCheck(e,d.type,h);s.push({action:d.type,check:f,sequencePosition:u+1}),f.isSuccess?i+=1:i-=2}const a=s.every(u=>u.check.isSuccess),c=s.filter(u=>u.check.degree==="critical failure");return{actions:s,overallSuccess:a,hasCriticalFailures:c.length>0,criticalFailures:c,sequenceLength:n.length,finalModifier:i}}generateActionNarrative(e,n){const{actionType:r,check:s,degree:i}=e;this.actionTypes[r];const a={attack:{"critical success":`${n.name} executes a perfect ${r}, striking with incredible precision!`,"great success":`${n.name} performs an excellent ${r}, hitting the target solidly.`,success:`${n.name} successfully ${r}s the target.`,failure:`${n.name} attempts to ${r} but misses the mark.`,"great failure":`${n.name} completely fails to ${r}, leaving themselves open.`,"critical failure":`${n.name} botches the ${r} spectacularly, potentially harming themselves!`},backflip:{"critical success":`${n.name} performs a flawless backflip, landing gracefully with perfect form!`,"great success":`${n.name} executes a smooth backflip, impressing onlookers.`,success:`${n.name} manages to complete the backflip successfully.`,failure:`${n.name} attempts a backflip but loses balance and stumbles.`,"great failure":`${n.name} fails the backflip badly, landing awkwardly.`,"critical failure":`${n.name} completely fails the backflip, potentially injuring themselves!`},fly:{"critical success":`${n.name} somehow defies gravity and soars through the air with supernatural grace!`,"great success":`${n.name} manages to achieve brief flight through incredible effort!`,success:`${n.name} makes a valiant attempt at flight, achieving a brief hover.`,failure:`${n.name} tries to fly but only manages an awkward hop.`,"great failure":`${n.name} attempts flight but falls flat on their face.`,"critical failure":`${n.name} tries to fly and crashes spectacularly, looking quite foolish!`}},c=a[r]||a.attack;return c[i]||c.failure}performMultipleSkillChecks(e,n,r,s=[],i=null){var x,C,y,k;const a=[];let c=0;const u=1;for(let w=1;w<=r;w++){const b=c*u,I=[...s];c>0&&I.push(`while fatigued (attempt ${w})`);const j=this.performSkillCheck(e,n,I,i),F={...j,attemptNumber:w,fatigueLevel:c,fatiguePenalty:b,adjustedTotalRoll:j.totalRoll-b,adjustedMargin:j.totalRoll-b-j.dc,adjustedSuccess:j.totalRoll-b>=j.dc};a.push(F),c++}const d=a.filter(w=>w.adjustedSuccess).length,h=a.filter(w=>w.adjustedSuccess&&w.adjustedMargin>=10).length,f=a.filter(w=>!w.adjustedSuccess&&w.adjustedMargin<=-10).length,g=d/r*100;return{actionType:n,numberOfAttempts:r,results:a,statistics:{successfulAttempts:d,criticalSuccesses:h,criticalFailures:f,successRate:g,averageRoll:a.reduce((w,b)=>w+b.roll,0)/r,averageTotalRoll:a.reduce((w,b)=>w+b.adjustedTotalRoll,0)/r,bestRoll:Math.max(...a.map(w=>w.adjustedTotalRoll)),worstRoll:Math.min(...a.map(w=>w.adjustedTotalRoll))},character:{name:e.name,level:e.level,[(x=this.actionTypes[n])==null?void 0:x.primaryAbility]:e[(C=this.actionTypes[n])==null?void 0:C.primaryAbility],[(y=this.actionTypes[n])==null?void 0:y.secondaryAbility]:e[(k=this.actionTypes[n])==null?void 0:k.secondaryAbility]}}}performMultipleDiceRolls(e,n,r="standard"){const s=[];for(let d=1;d<=e;d++){let h;switch(r){case"advantage":h=this.rollWithAdvantage();break;case"disadvantage":h=this.rollWithDisadvantage();break;default:h={result:this.rollDie(n),rolls:[this.rollDie(n)],advantage:!1,disadvantage:!1}}s.push({...h,rollNumber:d,sides:n})}const i=s.map(d=>d.result),a=i.reduce((d,h)=>d+h,0)/e,c=Math.max(...i),u=Math.min(...i);return{numberOfRolls:e,sides:n,rollType:r,results:s,statistics:{average:a,max:c,min:u,total:i.reduce((d,h)=>d+h,0),natural20s:i.filter(d=>d===20).length,natural1s:i.filter(d=>d===1).length}}}generateMultipleAttemptsNarrative(e,n){const{actionType:r,numberOfAttempts:s,statistics:i}=e,a=this.actionTypes[r];if(!a)return`${n.name} attempts ${r} ${s} times.`;const c=i.successRate,u=i.criticalSuccesses,d=i.criticalFailures;let h=`${n.name} attempts to ${a.description} ${s} times. `;return c>=80?h+=`They perform exceptionally well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:c>=60?h+=`They perform well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:c>=40?h+=`They have mixed results, succeeding ${i.successfulAttempts} out of ${s} attempts.`:c>=20?h+=`They struggle, only succeeding ${i.successfulAttempts} out of ${s} attempts.`:h+=`They perform poorly, only succeeding ${i.successfulAttempts} out of ${s} attempts.`,u>0&&(h+=` They achieve ${u} spectacular successes!`),d>0&&(h+=` They suffer ${d} embarrassing failures.`),s>10&&(h+=" The repeated attempts take their toll, and fatigue begins to set in."),h}}class pp{constructor(){this.diceService=new fp,this.storyRules={redirectPatterns:[{pattern:/\b(?:i\s+)?(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,response:"While impressive acrobatics are possible, let's focus on actions that advance the story. What's your main goal here?",suggestion:"Try describing a more focused action that helps with the current situation."},{pattern:/\b(?:i\s+)?(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,response:"Flight isn't currently possible in this situation. What are you trying to achieve?",suggestion:"Consider climbing, jumping, or finding another way to reach your destination."},{pattern:/\b(?:i\s+)?(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,response:"The quest item isn't just lying around. You'll need to find it through exploration and investigation.",suggestion:"Try searching the area, asking NPCs, or following clues to locate the item."},{pattern:/\b(?:i\s+)?(?:attack|kill|destroy)\s+(?:everyone|all|each)\s+(?:enemy|person|creature)\b/gi,response:"While combat is possible, attacking everyone at once isn't practical. Let's focus on the immediate threat.",suggestion:"Choose a specific target or describe a more strategic approach."}],expandPatterns:[{pattern:/\b(?:i\s+)?(?:search|look|examine)\b/gi,response:"What specifically are you searching for or looking at?",suggestion:"Be more specific about what you're searching for or examining."},{pattern:/\b(?:i\s+)?(?:talk|speak|ask)\b/gi,response:"Who would you like to talk to, and what would you like to discuss?",suggestion:"Specify the person and topic of conversation."},{pattern:/\b(?:i\s+)?(?:go|move|walk)\b/gi,response:"Where would you like to go?",suggestion:"Specify your destination or direction."}],encouragePatterns:[{pattern:/\b(?:i\s+)?(?:investigate|explore|examine)\b/gi,response:"Great! Investigation and exploration are key to advancing the story.",suggestion:"What specific aspect would you like to investigate?"},{pattern:/\b(?:i\s+)?(?:help|assist|aid)\b/gi,response:"Helping others is always a noble choice. Who would you like to help?",suggestion:"Specify who needs help and how you can assist them."},{pattern:/\b(?:i\s+)?(?:negotiate|diplomacy|peace)\b/gi,response:"Diplomacy can often achieve more than violence. Good thinking!",suggestion:"How would you like to approach the negotiation?"}]},this.contextResponses={combat:{impossible:"That action isn't possible in combat. Focus on your available combat options.",difficult:"That's a challenging action in combat. Are you sure you want to attempt it?",strategic:"That's a good strategic choice. How do you want to execute it?"},exploration:{impossible:"That action doesn't make sense in this environment. What are you trying to achieve?",difficult:"That will be challenging given the current circumstances.",strategic:"That's a good approach to exploration. Let's see how it goes."},social:{impossible:"That action isn't appropriate in this social situation.",difficult:"That's a bold social move. Are you prepared for the consequences?",strategic:"That's a good approach to the situation. How do you want to proceed?"}}}validatePlayerAction(e,n,r={}){const s=e.toLowerCase(),i=this.checkImpossibleActions(s);if(!i.possible)return{valid:!1,type:"impossible",response:i.response,suggestion:i.suggestion,diceResult:null};const a=this.checkRedirectPatterns(s);if(a.needsRedirect)return{valid:!1,type:"redirect",response:a.response,suggestion:a.suggestion,diceResult:null};const c=this.checkExpandPatterns(s);if(c.needsExpansion)return{valid:!1,type:"expand",response:c.response,suggestion:c.suggestion,diceResult:null};const u=this.diceService.validateAction(e,n,r);return{valid:!0,type:"valid",response:this.generateValidationResponse(u,n,r),suggestion:u.suggestion,diceResult:u}}checkImpossibleActions(e){for(const n of this.diceService.impossibleActionPatterns)if(n.test(e))return{possible:!1,response:"That action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};return{possible:!0}}checkRedirectPatterns(e){for(const n of this.storyRules.redirectPatterns)if(n.pattern.test(e))return{needsRedirect:!0,response:n.response,suggestion:n.suggestion};return{needsRedirect:!1}}checkExpandPatterns(e){for(const n of this.storyRules.expandPatterns)if(n.pattern.test(e))return{needsExpansion:!0,response:n.response,suggestion:n.suggestion};return{needsExpansion:!1}}generateValidationResponse(e,n,r){if(!e.overallSuccess)return e.actions.filter(u=>!u.check.isSuccess).filter(u=>u.check.degree==="critical failure").length>0?`The actions you described are beyond your current capabilities. ${e.suggestion}`:`The actions you described are challenging but possible. ${e.suggestion}`;const s=this.generateAtmosphericResponse(e,n,r),i=this.extractEntities(s,r);return{story:s,entities:i}}generateAtmosphericResponse(e,n,r){const{actions:s,overallSuccess:i,hasCriticalFailures:a}=e,c=r==null?void 0:r.customContext;let u=this.getAtmosphericElements(c),d=this.calculateTensionLevel(s,a),h="";return s.length===1?h=this.generateSingleActionResponse(s[0],n,u,d):h=this.generateMultiActionResponse(s,n,u,d),c&&c.environmentalFeatures&&(h+=this.addEnvironmentalDetails(c.environmentalFeatures,d)),c&&c.npcs&&(h+=this.addNPCReactions(c.npcs,s,i)),h+=this.addStoryProgressionHook(s,d,c),h}getAtmosphericElements(e){const n={lighting:"dim",weather:"calm",mood:"neutral",tension:"low"};if(!e)return n;const r=e.description.toLowerCase();return(r.includes("dark")||r.includes("shadow"))&&(n.lighting="dark"),(r.includes("bright")||r.includes("sunlight"))&&(n.lighting="bright"),(r.includes("dim")||r.includes("flickering"))&&(n.lighting="dim"),(r.includes("storm")||r.includes("rain"))&&(n.weather="stormy"),(r.includes("fog")||r.includes("mist"))&&(n.weather="foggy"),r.includes("wind")&&(n.weather="windy"),(r.includes("tension")||r.includes("danger"))&&(n.mood="tense"),(r.includes("peaceful")||r.includes("calm"))&&(n.mood="peaceful"),(r.includes("eerie")||r.includes("creepy"))&&(n.mood="eerie"),n}calculateTensionLevel(e,n){let r="low";const s=e.filter(i=>["attack","spell","dodge","parry"].includes(i.action));return s.length>0&&(r="medium"),s.length>2&&(r="high"),n&&(r="critical"),r}generateSingleActionResponse(e,n,r,s){const{action:i,check:a,keyword:c}=e,u=a.isSuccess;a.degree;const d={attack:{success:{low:`${n.name} strikes true, the blow landing with satisfying impact.`,medium:`${n.name}'s weapon finds its mark, the strike ringing out in the ${r.lighting} light.`,high:`${n.name} delivers a devastating blow, the force of the attack echoing through the ${r.weather} air.`,critical:`${n.name} executes a perfect strike, the precision of the attack leaving no room for error.`},failure:{low:`${n.name} swings wide, the attack missing its intended target.`,medium:`${n.name}'s strike goes awry, the weapon clattering against stone or wood.`,high:`${n.name} completely misses, the failed attack leaving them momentarily vulnerable.`,critical:`${n.name} stumbles in their attack, the botched strike nearly causing them to fall.`}},backflip:{success:{low:`${n.name} executes a graceful backflip, landing softly on their feet.`,medium:`${n.name} performs an impressive backflip, the acrobatic feat drawing attention.`,high:`${n.name} completes a spectacular backflip, the display of agility leaving onlookers amazed.`,critical:`${n.name} achieves a flawless backflip, the perfect form and landing drawing gasps of admiration.`},failure:{low:`${n.name} attempts a backflip but loses balance, stumbling slightly.`,medium:`${n.name} fails the backflip, landing awkwardly and looking embarrassed.`,high:`${n.name} completely botches the backflip, falling hard to the ground.`,critical:`${n.name} crashes spectacularly during the backflip, potentially injuring themselves.`}},search:{success:{low:`${n.name} searches carefully, their trained eyes picking up subtle details.`,medium:`${n.name} conducts a thorough search, methodically examining every corner.`,high:`${n.name} performs an exhaustive search, their attention to detail revealing hidden secrets.`,critical:`${n.name} discovers something extraordinary, their keen observation uncovering a crucial clue.`},failure:{low:`${n.name} looks around but finds nothing of interest.`,medium:`${n.name} searches but misses several obvious details.`,high:`${n.name} fails to notice important clues, their search proving fruitless.`,critical:`${n.name} overlooks critical information, their poor search skills costing them dearly.`}},persuade:{success:{low:`${n.name} makes a reasonable argument, their words carrying some weight.`,medium:`${n.name} presents a compelling case, their charisma swaying the listener.`,high:`${n.name} delivers a masterful persuasion, their words impossible to ignore.`,critical:`${n.name} achieves the impossible, their silver tongue turning enemies into allies.`},failure:{low:`${n.name} tries to persuade but fails to make a convincing argument.`,medium:`${n.name}'s attempt at persuasion falls flat, their words lacking impact.`,high:`${n.name} completely fails to persuade, their poor communication skills evident.`,critical:`${n.name} not only fails to persuade but manages to offend the listener.`}}},h=d[i]||d.attack,f=u?"success":"failure",g=s==="critical"?"high":s;return h[f][g]}generateMultiActionResponse(e,n,r,s){const i=e.length,a=e.filter(u=>u.check.isSuccess).length,c=i-a;return a===i?`${n.name} executes a flawless sequence of actions, each movement flowing seamlessly into the next. The display of skill and coordination is impressive to behold.`:a>c?`${n.name} performs admirably, with most actions succeeding despite the challenging circumstances. A few missteps don't diminish the overall effectiveness.`:c>a?`${n.name} struggles with the complex sequence, many actions failing to achieve their intended results. The difficulty of the task proves overwhelming.`:`${n.name} has mixed results, with some actions succeeding while others fail. The outcome remains uncertain.`}addEnvironmentalDetails(e,n){if(e.length===0)return"";const r={dark:{low:" The darkness seems to swallow sound, making every movement feel more significant.",medium:" Shadows dance in the darkness, creating an atmosphere of uncertainty.",high:" The oppressive darkness makes every action feel more dangerous and urgent.",critical:" The pitch-black environment amplifies every sound, every movement potentially deadly."},stormy:{low:" Rain patters against surfaces, adding a rhythmic backdrop to the scene.",medium:" The storm intensifies, wind and rain making movement more challenging.",high:" The raging storm creates a chaotic environment where every action is a gamble.",critical:" The violent storm threatens to overwhelm all but the most determined efforts."},foggy:{low:" Mist swirls gently, obscuring distant details.",medium:" The fog thickens, reducing visibility and creating an eerie atmosphere.",high:" Dense fog makes navigation difficult and every shadow a potential threat.",critical:" The impenetrable fog isolates you completely, each step into the unknown."}};let s="";return e.forEach(i=>{r[i]&&(s+=r[i][n]||"")}),s}addNPCReactions(e,n,r){if(e.length===0)return"";const s=e.map(i=>i.name).join(" and ");return r?` ${s} watch with growing interest, clearly impressed by your actions.`:` ${s} exchange concerned glances, their confidence in your abilities wavering.`}addStoryProgressionHook(e,n,r){const s=e.some(c=>["attack","spell","dodge","parry"].includes(c.action)),i=e.some(c=>["search","climb","jump"].includes(c.action)),a=e.some(c=>["persuade","intimidate","deceive"].includes(c.action));return s&&n==="high"?" The tension in the air is palpable. Something is about to happen...":i?" Your investigation reveals new possibilities. What will you discover next?":a?" The social dynamics shift with your words. How will others respond?":" The situation continues to unfold. What will you do next?"}generateStoryResponse(e,n,r={}){const s=this.validatePlayerAction(e,n,r);if(!s.valid)return{response:s.response,suggestion:s.suggestion,shouldProceed:!1,diceResult:null};const i=[];return s.diceResult.actions&&s.diceResult.actions.forEach(a=>{const c=this.diceService.generateActionNarrative(a.check,n);i.push(c)}),{response:i.join(" "),suggestion:s.suggestion,shouldProceed:!0,diceResult:s.diceResult}}handleComplexAction(e,n,r={}){const s=this.diceService.extractActionsFromDescription(e.toLowerCase());if(s.length===0)return{response:"I understand your intent. Let's see how this plays out in the story.",shouldProceed:!0,type:"narrative"};if(s.length===1)return this.generateStoryResponse(e,n,r);const i=this.diceService.performActionSequence(n,s,r);return i.overallSuccess?{response:i.actions.map(c=>this.diceService.generateActionNarrative(c.check,n)).join(" "),shouldProceed:!0,type:"sequence",diceResult:i}:i.actions.filter(u=>!u.check.isSuccess).filter(u=>u.check.degree==="critical failure").length>0?{response:"The sequence of actions you described is too complex for your current abilities. Try breaking it down into simpler steps.",shouldProceed:!1,type:"sequence_failure",diceResult:i}:{response:"Some parts of your action sequence are challenging. You might want to simplify your approach.",shouldProceed:!1,type:"sequence_partial",diceResult:i}}provideAlternatives(e,n,r={}){const s=e.toLowerCase(),i=[];return(s.includes("backflip")||s.includes("somersault"))&&i.push({action:"dodge",description:"Try dodging or evading instead of acrobatics",difficulty:"easier"}),(s.includes("fly")||s.includes("levitate"))&&i.push({action:"climb",description:"Try climbing or finding another way up",difficulty:"realistic"}),s.includes("attack everyone")&&i.push({action:"focus",description:"Focus on one target at a time for better effectiveness",difficulty:"strategic"}),s.includes("grab quest item")&&i.push({action:"search",description:"Search the area thoroughly to find the item",difficulty:"appropriate"}),i}maintainStoryCoherence(e,n,r){const s={storyPhase:this.checkStoryPhase(e,n),establishedFacts:this.checkEstablishedFacts(e,n),plotAdvancement:this.checkPlotAdvancement(e,n),characterDevelopment:this.checkCharacterDevelopment(e,r)},i=Object.entries(s).filter(([a,c])=>!c.valid).map(([a,c])=>c.issue);return{coherent:i.length===0,issues:i,suggestions:this.generateCoherenceSuggestions(i,n)}}checkStoryPhase(e,n){const r=n.phase||"exploration",s=e.toLowerCase(),c=({introduction:["attack","kill","destroy"],exploration:["end quest","skip to boss"],combat:["negotiate peace","run away"],resolution:["start new quest","begin adventure"]}[r]||[]).some(u=>s.includes(u));return{valid:!c,issue:c?`This action doesn't fit the current story phase (${r})`:null}}checkEstablishedFacts(e,n){const r=n.establishedFacts||[],s=e.toLowerCase();for(const i of r)if(i.contradicts&&i.contradicts.some(a=>s.includes(a.toLowerCase())))return{valid:!1,issue:`This action contradicts established story facts: ${i.description}`};return{valid:!0}}checkPlotAdvancement(e,n){const r=n.plotPoints||[],s=e.toLowerCase(),i=r.find(a=>a.active);return i&&i.keywords&&!i.keywords.some(c=>s.includes(c.toLowerCase()))?{valid:!1,issue:"This action doesn't address the current plot point"}:{valid:!0}}checkCharacterDevelopment(e,n){const r=n.alignment||"Neutral",s=e.toLowerCase(),c=({"Lawful Good":["steal","deceive","harm innocent"],"Chaotic Evil":["help others","follow rules","show mercy"],"Neutral Good":["harm innocent","betray allies"],"Lawful Evil":["break laws","show mercy","help weak"],"Chaotic Good":["follow strict rules","harm innocent"],"True Neutral":["take extreme actions","show strong emotions"],"Lawful Neutral":["break laws","show mercy","act chaotically"],"Neutral Evil":["help others","follow laws","show mercy"],"Chaotic Neutral":["follow strict rules","show strong loyalty"]}[r]||[]).some(u=>s.includes(u));return{valid:!c,issue:c?`This action doesn't align with your character's alignment (${r})`:null}}generateCoherenceSuggestions(e,n){const r=[];return e.forEach(s=>{s.includes("story phase")?r.push("Consider actions that fit the current phase of the story."):s.includes("established facts")?r.push("Remember what has already been established in the story."):s.includes("plot point")?r.push("Focus on actions that advance the current plot."):s.includes("alignment")&&r.push("Consider actions that align with your character's moral compass.")}),r}extractEntities(e,n={}){const r={enemies:[],items:[],locations:[],statusEffects:[],questHooks:[],npcs:[]};return e.toLowerCase(),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:the\s+)?(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster|boss|mini-boss)/gi,/\b(goblin|orc|troll|dragon|bandit|skeleton|zombie|ghost|spirit|demon|devil|fiend|beast|creature|monster)\b/gi,/(?:mini-boss|boss)\s*[-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/\[Combat\s+Trigger[^]]*[-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\]/gi].forEach(h=>{let f;for(;(f=h.exec(e))!==null;){const g=f[1]||f[0];g&&!r.enemies.some(x=>x.name.toLowerCase()===g.toLowerCase())&&r.enemies.push({name:g,type:"enemy",subtype:this.determineEnemySubtype(g,e),status:this.determineEnemyStatus(g,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:of\s+[A-Z][a-z]+)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:sword|dagger|staff|wand|scroll|potion|ring|amulet|crown|robe|armor|shield)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cursed|forbidden|ancient|legendary)/gi].forEach(h=>{let f;for(;(f=h.exec(e))!==null;){const g=f[1]||f[0];g&&!r.items.some(x=>x.name.toLowerCase()===g.toLowerCase())&&r.items.push({name:g,type:"item",subtype:this.determineItemSubtype(g,e),status:this.determineItemStatus(g,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:shrine|temple|castle|tower|dungeon|cave|tunnel|chamber|room|hall|garden|forest|mountain|river|lake|ocean|tavern|inn)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cliffs|beach|island|valley|peak|summit|depths|heights)/gi].forEach(h=>{let f;for(;(f=h.exec(e))!==null;){const g=f[1]||f[0];g&&!r.locations.some(x=>x.name.toLowerCase()===g.toLowerCase())&&r.locations.push({name:g,type:"location",subtype:this.determineLocationSubtype(g,e),tags:this.determineLocationTags(g,e)})}}),[/(?:cursed|blessed|enchanted|poisoned|paralyzed|charmed|frightened|invisible|ethereal|ethereal|flying|levitating)/gi,/(?:in\s+darkness|in\s+bright\s+light|under\s+pressure|in\s+a\s+hurry|carefully|stealthily|aggressively|defensively)/gi].forEach(h=>{let f;for(;(f=h.exec(e))!==null;){const g=f[0];g&&!r.statusEffects.some(x=>x.name.toLowerCase()===g.toLowerCase())&&r.statusEffects.push({name:g,type:"status_effect",effect:this.determineStatusEffect(g,e)})}}),[/(?:break|destroy|find|retrieve|defeat|save|protect|escort|investigate|explore)\s+(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/(?:quest|mission|objective|goal|task|duty|responsibility)/gi].forEach(h=>{let f;for(;(f=h.exec(e))!==null;){const g=f[1]||f[0];g&&!r.questHooks.some(x=>x.name.toLowerCase()===g.toLowerCase())&&r.questHooks.push({name:g,type:"quest_hook",objective:this.determineQuestObjective(g,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:merchant|trader|noble|lord|lady|king|queen|prince|princess|mayor|priest|shaman|hunter|fisherman|farmer)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:quest\s+giver|guide|mentor|teacher|master)/gi].forEach(h=>{let f;for(;(f=h.exec(e))!==null;){const g=f[1]||f[0];g&&!r.npcs.some(x=>x.name.toLowerCase()===g.toLowerCase())&&r.npcs.push({name:g,type:"npc",role:this.determineNPCRole(g,e),disposition:"friendly"})}}),r}determineEnemySubtype(e,n){n.toLowerCase();const r=e.toLowerCase();return r.includes("boss")||r.includes("mini-boss")?"boss":r.includes("priest")||r.includes("cleric")?"priest":r.includes("wizard")||r.includes("mage")?"wizard":r.includes("dragon")?"dragon":r.includes("undead")||r.includes("skeleton")||r.includes("zombie")?"undead":r.includes("goblin")||r.includes("orc")||r.includes("troll")?"monster":"enemy"}determineEnemyStatus(e,n){const r=n.toLowerCase();return r.includes("snarls")||r.includes("aggressive")?"hostile":r.includes("defensive")||r.includes("cautious")?"defensive":r.includes("chanting")||r.includes("casting")?"casting":"active"}determineItemSubtype(e,n){const r=e.toLowerCase();return r.includes("sword")||r.includes("dagger")||r.includes("staff")?"weapon":r.includes("potion")||r.includes("scroll")?"consumable":r.includes("ring")||r.includes("amulet")||r.includes("crown")?"accessory":r.includes("armor")||r.includes("robe")||r.includes("shield")?"armor":"item"}determineItemStatus(e,n){const r=n.toLowerCase(),s=e.toLowerCase();return s.includes("cursed")||r.includes("cursed")?"cursed":s.includes("forbidden")||r.includes("forbidden")?"forbidden":s.includes("ancient")||r.includes("ancient")?"ancient":s.includes("legendary")||r.includes("legendary")?"legendary":r.includes("magical")||r.includes("enchanted")?"magical":"normal"}determineLocationSubtype(e,n){const r=e.toLowerCase();return r.includes("shrine")||r.includes("temple")?"religious":r.includes("castle")||r.includes("tower")?"fortification":r.includes("cave")||r.includes("tunnel")?"underground":r.includes("forest")||r.includes("garden")?"natural":r.includes("tavern")||r.includes("inn")?"settlement":"location"}determineLocationTags(e,n){const r=[],s=n.toLowerCase();return(s.includes("ancient")||s.includes("old"))&&r.push("ancient"),(s.includes("dangerous")||s.includes("hostile"))&&r.push("dangerous"),(s.includes("sacred")||s.includes("holy"))&&r.push("sacred"),(s.includes("cursed")||s.includes("evil"))&&r.push("cursed"),(s.includes("coastal")||s.includes("ocean"))&&r.push("coastal"),(s.includes("mountain")||s.includes("high"))&&r.push("mountainous"),r}determineStatusEffect(e,n){const r=e.toLowerCase();return r.includes("cursed")?"disables healing":r.includes("poisoned")?"damage over time":r.includes("paralyzed")?"prevents movement":r.includes("charmed")?"mind control":r.includes("invisible")?"stealth bonus":r.includes("flying")?"flight ability":"unknown effect"}determineQuestObjective(e,n){const r=e.toLowerCase();return r.includes("break")||r.includes("destroy")?"destruction":r.includes("find")||r.includes("retrieve")?"retrieval":r.includes("defeat")||r.includes("kill")?"combat":r.includes("save")||r.includes("protect")?"protection":r.includes("escort")?"escort":r.includes("investigate")||r.includes("explore")?"exploration":"objective"}determineNPCRole(e,n){const r=e.toLowerCase();return r.includes("merchant")||r.includes("trader")?"merchant":r.includes("noble")||r.includes("lord")||r.includes("lady")?"noble":r.includes("king")||r.includes("queen")?"royalty":r.includes("priest")||r.includes("shaman")?"religious":r.includes("quest giver")||r.includes("guide")?"quest_giver":"npc"}}const $R=new pp,Gd=new fp;function FR(){const t=er(),[e,n]=P.useState(""),[r,s]=P.useState(""),[i,a]=P.useState(null),[c,u]=P.useState(!1),[d,h]=P.useState(!1),[f,g]=P.useState(!1),[x,C]=P.useState(null),[y,k]=P.useState(null),[w,b]=P.useState(null),[I,j]=P.useState("Fighter"),F=[{name:"Drowned Priest Boss Fight",storyContext:"In a dark, misty swamp, a Drowned Priest emerges from the murky water, chanting dark spells. The air is thick with malevolence as undead minions rise from the depths. The water bubbles with dark energy, and the priest's glowing eyes pierce through the fog.",suggestedAction:"I charge forward and attack the Drowned Priest with my sword"},{name:"Forest Ambush",storyContext:"The party is traveling through a dense forest when suddenly, goblin archers emerge from the trees above. The forest floor is covered in fallen leaves that crunch underfoot, and the canopy blocks most of the sunlight. The goblins are well-hidden in the branches, their green skin blending with the foliage.",suggestedAction:"I take cover behind a large tree and cast a fireball at the goblin archers"},{name:"Tavern Brawl",storyContext:"A rowdy group of bandits has taken over the local tavern, threatening the patrons. The tavern is filled with overturned tables, broken chairs, and spilled ale. The bandit leader, a scarred warrior with a wicked grin, stands on the bar counter brandishing his sword.",suggestedAction:"I leap over a table and tackle the bandit leader to the ground"}],E={Fighter:{id:"test_fighter_1",name:"Test Fighter",level:5,class:"Fighter",strength:18,dexterity:14,constitution:16,intelligence:10,wisdom:10,charisma:12,hp:45,maxHp:45,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Longsword",damageBonus:2},armor:{name:"Chain Mail",defenseBonus:4},shield:{name:"Shield",defenseBonus:2}}},Wizard:{id:"test_wizard_1",name:"Test Wizard",level:5,class:"Wizard",strength:8,dexterity:14,constitution:12,intelligence:18,wisdom:12,charisma:10,hp:32,maxHp:32,ac:14,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["spell","attack","defend"],equipment:{weapon:{name:"Staff",damageBonus:0},armor:{name:"Robe",defenseBonus:2},focus:{name:"Arcane Focus",spellBonus:1}}},Rogue:{id:"test_rogue_1",name:"Test Rogue",level:5,class:"Rogue",strength:12,dexterity:18,constitution:14,intelligence:12,wisdom:10,charisma:14,hp:38,maxHp:38,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Daggers",damageBonus:1},armor:{name:"Leather Armor",defenseBonus:2},tools:{name:"Thieves Tools",utilityBonus:2}}},Cleric:{id:"test_cleric_1",name:"Test Cleric",level:5,class:"Cleric",strength:14,dexterity:10,constitution:16,intelligence:12,wisdom:18,charisma:12,hp:42,maxHp:42,ac:16,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["spell","attack","defend"],equipment:{weapon:{name:"Mace",damageBonus:1},armor:{name:"Scale Mail",defenseBonus:3},holySymbol:{name:"Holy Symbol",spellBonus:1}}},Ranger:{id:"test_ranger_1",name:"Test Ranger",level:5,class:"Ranger",strength:14,dexterity:16,constitution:14,intelligence:12,wisdom:16,charisma:10,hp:40,maxHp:40,ac:15,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","dodge","parry","defend"],equipment:{weapon:{name:"Longbow",damageBonus:1},armor:{name:"Studded Leather",defenseBonus:2},companion:{name:"Wolf Companion",utilityBonus:1}}},Paladin:{id:"test_paladin_1",name:"Test Paladin",level:5,class:"Paladin",strength:16,dexterity:10,constitution:16,intelligence:10,wisdom:12,charisma:16,hp:44,maxHp:44,ac:17,userId:"test_user",initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","defend"],equipment:{weapon:{name:"Greatsword",damageBonus:2},armor:{name:"Plate Mail",defenseBonus:5},holySymbol:{name:"Holy Symbol",spellBonus:1}}}}[I],_=ee=>{s(ee.storyContext),n(ee.suggestedAction)},N=async()=>{if(e.trim())try{const ee={environmentalFeatures:T(r),npcs:Ve(r),circumstances:Me(r)},W=$R.validatePlayerAction(e,E,ee);C(W);const te=A(e,r,W);if(te.shouldInitiate){const de=D(te.enemyType,te.specificEnemyName);if(console.log("Combat detected, generated enemies:",de),a({type:"combat",message:` Combat Detected! ${te.reason==="action_triggered_combat"?"Your action has triggered combat with the enemies in the area.":"The situation has escalated to combat."}`,context:ee,enemyType:te.enemyType,enemies:de,storyContext:r}),W.valid&&W.diceResult){const Oe=(W.diceResult.actions||[]).filter(he=>he.type!==void 0);if(Oe.length>0){const he=Gd.performActionSequence(E,Oe,ee);k(he),h(!0)}}}else if(W.valid){if(W.diceResult){const Oe=(W.diceResult.actions||[]).filter(he=>he.type!==void 0);if(Oe.length>0){const he=Gd.performActionSequence(E,Oe,ee);k(he),h(!0)}else a({type:"invalid",message:"No valid actions detected. Try a different action or rephrase your input.",context:ee})}else a({type:"simple",message:`The ${E.name} performs the action successfully.`,context:ee});const de=S(W,E,ee);a(Oe=>({...Oe,message:de}))}else{const de=S(W,E,ee);a({type:"invalid",message:de,context:ee})}u(!0)}catch(ee){console.error("Error processing test message:",ee),a({type:"error",message:"An error occurred while processing your action."})}},A=(ee,W,te)=>{var ut,dt;const de=["attack","fight","battle","combat","strike","slash","stab","shoot","cast spell","fire spell","magic"],Oe=["enemy","monster","goblin","orc","troll","dragon","bandit","skeleton","zombie","priest","boss","creature","beast","fiend","demon","devil","ghost","spirit","undead","abomination","horror","terror","nightmare","phantom","specter","wraith","lich","vampire","werewolf","shapeshifter","elemental","construct"],he=de.some(_e=>ee.toLowerCase().includes(_e)),ue=W.toLowerCase(),Q=Oe.some(_e=>ue.includes(_e))||ue.includes("hostile")||ue.includes("aggressive")||ue.includes("snarls")||ue.includes("chanting")||ue.includes("combat trigger")||ue.includes("mini-boss")||ue.includes("boss")||/\b(?:the\s+)?(\w+)\s+(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster)\b/i.test(W)||ue.includes("raises")&&ue.includes("staff")||ue.includes("emerges")&&ue.includes("mist")||ue.includes("glowing")&&ue.includes("eyes"),Ie=(dt=(ut=te==null?void 0:te.diceResult)==null?void 0:ut.actions)==null?void 0:dt.some(_e=>["attack","spell","dodge","parry","cast"].includes(_e.action));let we="bandit",Be=null;const B=W.match(/\b(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster|boss)\b/i);return B&&(Be=B[1]),ue.includes("drowned priest")&&(Be="Drowned Priest",we="priest"),ue.includes("goblin")?we="goblin":ue.includes("orc")?we="orc":ue.includes("troll")?we="troll":ue.includes("dragon")?we="dragon":ue.includes("undead")||ue.includes("skeleton")||ue.includes("zombie")?we="skeleton":ue.includes("priest")||ue.includes("cleric")||ue.includes("paladin")?we="priest":ue.includes("wizard")||ue.includes("mage")||ue.includes("sorcerer")?we="wizard":ue.includes("dragon")||ue.includes("wyrm")||ue.includes("wyvern")?we="dragon":(ue.includes("boss")||ue.includes("mini-boss"))&&(we="boss"),Be&&we==="bandit"&&(we="boss"),{shouldInitiate:he&&Q||Ie&&Q,reason:he?"action_triggered_combat":"context_triggered_combat",enemyType:we,specificEnemyName:Be}},D=(ee="bandit",W=null)=>{const te={goblin:{name:"Goblin",hp:12,ac:14,level:1,strength:8,dexterity:14,constitution:10,intelligence:10,wisdom:8,charisma:8},orc:{name:"Orc",hp:30,ac:16,level:3,strength:16,dexterity:12,constitution:16,intelligence:7,wisdom:11,charisma:10},troll:{name:"Troll",hp:84,ac:15,level:5,strength:18,dexterity:13,constitution:20,intelligence:7,wisdom:9,charisma:7},dragon:{name:"Dragon",hp:200,ac:19,level:10,strength:27,dexterity:14,constitution:25,intelligence:16,wisdom:13,charisma:15},bandit:{name:"Bandit",hp:16,ac:12,level:1,strength:12,dexterity:12,constitution:12,intelligence:10,wisdom:10,charisma:10},skeleton:{name:"Skeleton",hp:13,ac:13,level:1,strength:10,dexterity:14,constitution:15,intelligence:6,wisdom:8,charisma:5},zombie:{name:"Zombie",hp:22,ac:8,level:1,strength:13,dexterity:6,constitution:16,intelligence:3,wisdom:6,charisma:5},priest:{name:"Priest",hp:45,ac:16,level:5,strength:12,dexterity:10,constitution:14,intelligence:12,wisdom:16,charisma:14},wizard:{name:"Wizard",hp:40,ac:15,level:5,strength:9,dexterity:14,constitution:12,intelligence:16,wisdom:12,charisma:10},boss:{name:"Boss",hp:120,ac:18,level:8,strength:18,dexterity:16,constitution:18,intelligence:14,wisdom:16,charisma:16},undead:{name:"Undead",hp:15,ac:12,level:1,strength:12,dexterity:10,constitution:14,intelligence:6,wisdom:8,charisma:5}},de=te[ee]||te.bandit;let Oe=1,he=!1;W||ee==="boss"?(he=!0,Oe=1):Oe=Math.min(3,4);const ue=[];for(let Q=0;Q<Oe;Q++){let Ie,we=de.hp,Be=de.ac,B=de.level,ut=ee;W?(Ie=W,we=Math.max(de.hp*2,80),Be=de.ac+2,B=Math.max(de.level+2,7),ut="boss"):he?(Ie="Drowned Priest",we=Math.max(de.hp*2,80),Be=de.ac+2,B=Math.max(de.level+2,7),ut="boss"):(Ie=`${de.name} ${Q+1}`,we=de.hp+Math.floor(Math.random()*10),Be=de.ac+Math.floor(Math.random()*3)),ue.push({id:`enemy_${Q}`,name:Ie,type:de.name,class:ut,hp:we,maxHp:we,ac:Be,level:B,strength:de.strength,dexterity:de.dexterity,constitution:de.constitution,intelligence:de.intelligence,wisdom:de.wisdom,charisma:de.charisma,initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","special","defend"]})}if(W==="Drowned Priest"||he&&ee==="priest")for(let Ie=0;Ie<2;Ie++){const we=15+Math.floor(Math.random()*8);ue.push({id:`enemy_minion_${Ie}`,name:`Undead Minion ${Ie+1}`,type:"Skeleton",class:"undead",hp:we,maxHp:we,ac:12+Math.floor(Math.random()*3),level:1,strength:12,dexterity:10,constitution:14,intelligence:6,wisdom:8,charisma:5,initiative:Math.floor(Math.random()*20)+1,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,proficiencies:["attack","spell","defend"]})}return ue},S=(ee,W,te)=>{const{environmentalFeatures:de,npcs:Oe,circumstances:he}=te,ue=Oe.some(Ie=>Ie.role==="enemy")||de.some(Ie=>["dangerous","hostile","threatening","eerie","creepy"].includes(Ie));let Q="";if(ee.valid)if(ee.diceResult){const Ie=ee.diceResult.actions||[],we=Ie.length;if(ue){if(Q=`The ${W.name} ${Ie.map(B=>B.action).join(" and ")} with determination. `,de.length>0){const B=de.filter(ut=>["dark","fog","mist","eerie","creepy","dangerous"].includes(ut));B.length>0&&(Q+=`The ${B.join(" and ")} ${B.length===1?"adds":"add"} to the tension. `)}const Be=Oe.filter(B=>B.role==="enemy");if(Be.length>0){const B=Be.map(ut=>ut.name).join(", ");Q+=`${B} ${Be.length===1?"reacts":"react"} with ${["hostility","anger","defiance","malice"].sort(()=>.5-Math.random())[0]}. `}we>1&&(Q+="Multiple actions detected - this complex maneuver will require precise timing and coordination. "),Q+=`

The outcome hangs in the balance. Roll the dice to determine your fate.`}else{if(Q=`The ${W.name} prepares to ${Ie.map(Be=>Be.action).join(" and ")}. `,we>1&&(Q+="Multiple actions detected - this will require careful coordination and may incur fatigue penalties. "),de.length>0&&(Q+=`The ${de.join(" and ")} ${de.length===1?"affects":"affect"} the situation. `),Oe.length>0){const Be=Oe.map(B=>B.name).join(", ");Q+=`${Be} ${Oe.length===1?"watches":"watch"} with interest. `}he.length>0&&(Q+=`The circumstances (${he.join(", ")}) ${he.length===1?"adds":"add"} complexity to the action. `),Q+=`

Roll the dice to determine the outcome of this challenging action.`}}else if(ue){Q=`${W.name}'s action is straightforward but the situation remains tense. `;const Ie=Oe.filter(we=>we.role==="enemy");if(Ie.length>0){const we=Ie.map(Be=>Be.name).join(", ");Q+=`${we} ${Ie.length===1?"maintains":"maintain"} a defensive stance. `}Q+=`

The action proceeds, but danger still lurks nearby.`}else{if(Q=`${W.name}'s action is straightforward and doesn't require a skill check. `,de.length>0&&(Q+=`The ${de.join(" and ")} ${de.length===1?"provides":"provide"} a suitable backdrop. `),Oe.length>0){const Ie=Oe.map(we=>we.name).join(", ");Q+=`${Ie} ${Oe.length===1?"responds":"respond"} appropriately to the action. `}Q+=`

The action proceeds smoothly.`}else ue?(Q="The proposed action doesn't seem feasible in this dangerous situation. ",ee.reason&&(Q+=`${ee.reason} `),Q+=`

In combat, every action must be precise and deliberate. Consider a different approach.`):(Q="The proposed action doesn't seem feasible. ",ee.reason&&(Q+=`${ee.reason} `),Q+=`

Try a different approach or rephrase your action.`);return Q},T=ee=>{if(!ee)return[];const W=ee.toLowerCase(),te=[];return(W.includes("dark")||W.includes("shadow"))&&te.push("darkness"),(W.includes("fog")||W.includes("mist"))&&te.push("fog"),(W.includes("forest")||W.includes("tree"))&&te.push("forest"),(W.includes("cave")||W.includes("cavern"))&&te.push("cave"),(W.includes("tavern")||W.includes("inn"))&&te.push("tavern"),(W.includes("castle")||W.includes("fortress"))&&te.push("castle"),(W.includes("dungeon")||W.includes("underground"))&&te.push("dungeon"),(W.includes("water")||W.includes("swamp"))&&te.push("water"),(W.includes("fire")||W.includes("flame"))&&te.push("fire"),(W.includes("ice")||W.includes("cold"))&&te.push("ice"),(W.includes("wind")||W.includes("storm"))&&te.push("wind"),(W.includes("eerie")||W.includes("creepy"))&&te.push("eerie"),(W.includes("dangerous")||W.includes("hostile"))&&te.push("dangerous"),te},Ve=ee=>{if(!ee)return[];const W=[],te=ee.toLowerCase();return te.includes("drowned priest")&&W.push({name:"Drowned Priest",role:"enemy",type:"boss"}),te.includes("goblin")&&W.push({name:"Goblin Archers",role:"enemy",type:"goblin"}),te.includes("bandit")&&W.push({name:"Bandit Leader",role:"enemy",type:"bandit"}),(te.includes("undead")||te.includes("skeleton")||te.includes("zombie"))&&W.push({name:"Undead Minions",role:"enemy",type:"undead"}),(te.includes("patron")||te.includes("customer"))&&W.push({name:"Tavern Patrons",role:"friendly",type:"civilian"}),(te.includes("party")||te.includes("companion"))&&W.push({name:"Party Members",role:"ally",type:"adventurer"}),W},Me=ee=>{if(!ee)return[];const W=[],te=ee.toLowerCase();return(te.includes("dark")||te.includes("night"))&&W.push("low visibility"),(te.includes("wet")||te.includes("slippery"))&&W.push("difficult footing"),(te.includes("crowded")||te.includes("tight"))&&W.push("confined space"),(te.includes("noisy")||te.includes("loud"))&&W.push("distracting environment"),(te.includes("hurry")||te.includes("rush"))&&W.push("time pressure"),(te.includes("stealth")||te.includes("sneak"))&&W.push("stealth required"),W},Le=()=>{u(!1)},Ne=()=>{h(!1)},G=async()=>{var ee,W;if((i==null?void 0:i.type)==="combat")console.log("Combat detected, preparing to navigate with data:",{partyMembers:[E],enemies:i.enemies,storyContext:i.storyContext,enemyCount:(ee=i.enemies)==null?void 0:ee.length}),t("/combat",{state:{isTestCombat:!0,partyMembers:[E],enemies:i.enemies,storyContext:i.storyContext}});else if(y&&y.actions&&y.actions.length>1){const te=Gd.performMultipleSkillChecks(E,"attack",3,((W=i==null?void 0:i.context)==null?void 0:W.circumstances)||[]);b(te),g(!0)}h(!1)},ie=()=>{u(!1),h(!1),a(null)},ve=()=>{t("/dashboard")};return o.jsx("div",{className:"min-h-screen bg-gray-900",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"mb-6 sm:mb-8",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[o.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-100",children:"Test Environment"}),o.jsx("button",{onClick:ve,className:"fantasy-button bg-blue-600 hover:bg-blue-700",children:"Back to Dashboard"})]}),o.jsx("p",{className:"text-gray-300 mt-2 text-sm sm:text-base",children:"Test action validation, dice rolling, and combat detection in a controlled environment."})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8",children:[o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-class",className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Class"}),o.jsxs("select",{id:"character-class",value:I,onChange:ee=>j(ee.target.value),className:"fantasy-input",children:[o.jsx("option",{value:"Fighter",children:" Fighter"}),o.jsx("option",{value:"Wizard",children:" Wizard"}),o.jsx("option",{value:"Rogue",children:" Rogue"}),o.jsx("option",{value:"Cleric",children:" Cleric"}),o.jsx("option",{value:"Ranger",children:" Ranger"}),o.jsx("option",{value:"Paladin",children:" Paladin"})]}),o.jsxs("div",{className:"mt-3 p-3 bg-gray-700 border border-gray-600 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-gray-100 mb-2",children:E.name}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"HP:"})," ",o.jsxs("span",{className:"text-gray-300",children:[E.hp,"/",E.maxHp]})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"AC:"})," ",o.jsx("span",{className:"text-gray-300",children:E.ac})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"STR:"})," ",o.jsx("span",{className:"text-gray-300",children:E.strength})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"DEX:"})," ",o.jsx("span",{className:"text-gray-300",children:E.dexterity})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"CON:"})," ",o.jsx("span",{className:"text-gray-300",children:E.constitution})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"INT:"})," ",o.jsx("span",{className:"text-gray-300",children:E.intelligence})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"WIS:"})," ",o.jsx("span",{className:"text-gray-300",children:E.wisdom})]}),o.jsxs("div",{children:[o.jsx("strong",{className:"text-gray-200",children:"CHA:"})," ",o.jsx("span",{className:"text-gray-300",children:E.charisma})]})]}),o.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:[o.jsx("strong",{children:"Equipment:"})," ",E.equipment.weapon.name,", ",E.equipment.armor.name]})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"test-scenarios",className:"block text-sm font-medium text-gray-200 mb-2",children:"Quick Test Scenarios"}),o.jsx("div",{id:"test-scenarios",className:"space-y-2",children:F.map((ee,W)=>o.jsxs("button",{onClick:()=>_(ee),className:"w-full p-3 text-left bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 transition-colors",children:[o.jsx("div",{className:"font-medium text-gray-100",children:ee.name}),o.jsxs("div",{className:"text-sm text-gray-300 mt-1",children:[ee.storyContext.substring(0,80),"..."]})]},W))})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"story-context",className:"block text-sm font-medium text-gray-200 mb-2",children:"Story Context"}),o.jsx("textarea",{id:"story-context",value:r,onChange:ee=>s(ee.target.value),placeholder:"Describe the environment, NPCs, and circumstances. For example: 'In a dark, misty swamp, a Drowned Priest emerges from the water, chanting dark spells. The air is thick with malevolence.'",className:"fantasy-input h-32 resize-none"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-action",className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Action"}),o.jsx("textarea",{id:"character-action",value:e,onChange:ee=>n(ee.target.value),placeholder:"Describe any action your character would take. The system will analyze it for skill checks, combat actions, or story interactions.",className:"fantasy-input h-24 resize-none"})]}),o.jsx("button",{onClick:N,disabled:!e.trim(),className:"w-full fantasy-button bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed",children:"Test Action"})]}),o.jsx("div",{className:"space-y-6",children:i&&o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[i.type==="combat"&&o.jsx("span",{className:"text-2xl mr-2",children:""}),o.jsx("h3",{className:"text-lg font-semibold text-gray-100",children:i.type==="combat"?"Combat Detected":i.type==="story"?"Story Response":i.type==="invalid"?"Invalid Action":"Test Result"})]}),o.jsxs("div",{className:"prose max-w-none",children:[o.jsx("p",{className:"text-gray-300 mb-4",children:i.message}),i.type==="combat"&&o.jsxs("div",{className:"bg-red-900/20 border border-red-600 rounded-lg p-4",children:[o.jsx("h4",{className:"text-lg font-bold text-red-400",children:"Combat Initiated!"}),o.jsxs("p",{className:"text-red-300 mb-2",children:["Enemy Type: ",i.enemyType]}),o.jsx("div",{className:"space-y-2",children:i.enemies.map((ee,W)=>o.jsxs("div",{className:"flex justify-between items-center bg-gray-700 p-2 rounded",children:[o.jsx("span",{className:"font-medium text-gray-100",children:ee.name}),o.jsxs("span",{className:"text-sm text-gray-300",children:["HP: ",ee.hp," | AC: ",ee.ac," | Level: ",ee.level]})]},W))}),o.jsx("button",{onClick:()=>t("/combat",{state:{isTestCombat:!0,partyMembers:[E],enemies:i.enemies,storyContext:i.storyContext}}),className:"mt-3 fantasy-button bg-red-600 hover:bg-red-700",children:"Enter Combat"})]}),i.context&&o.jsxs("div",{className:"mt-4 space-y-2",children:[o.jsx("h5",{className:"font-semibold text-gray-100",children:"Context Analysis:"}),i.context.environmentalFeatures.length>0&&o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"Environment:"})," ",i.context.environmentalFeatures.join(", ")]}),i.context.npcs.length>0&&o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"NPCs:"})," ",i.context.npcs.map(ee=>`${ee.name} (${ee.role})`).join(", ")]})]})]})]})})]}),c&&x&&o.jsx(m_,{result:x,onClose:Le,onProceed:G,onRevise:ie}),d&&y&&o.jsx(f_,{result:y,onClose:Ne,onProceed:G,onRevise:ie}),f&&w&&o.jsx(OR,{result:w,onClose:()=>g(!1)})]})})}class gp{constructor(){this.actionTypes={attack:{name:"Attack",cooldown:0,priority:"normal",description:"A basic physical attack",narrativeTemplate:"{character} {action} with {weapon}!"},spell:{name:"Cast Spell",cooldown:1,priority:"normal",description:"Cast a magical spell",narrativeTemplate:"{character} channels arcane energy into {spell}!"},special:{name:"Special Ability",cooldown:2,priority:"high",description:"Use a special class ability",narrativeTemplate:"{character} unleashes their {ability}!"},item:{name:"Use Item",cooldown:0,priority:"low",description:"Use an item or consumable",narrativeTemplate:"{character} uses {item}!"},defend:{name:"Defend",cooldown:0,priority:"high",description:"Take a defensive stance",narrativeTemplate:"{character} takes a defensive stance!"},environmental:{name:"Environmental Action",cooldown:1,priority:"normal",description:"Use the environment to your advantage",narrativeTemplate:"{character} uses the {environment} to their advantage!"},teamUp:{name:"Team Up",cooldown:3,priority:"high",description:"Coordinate with another party member",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}},this.statusEffects={poisoned:{name:"Poisoned",duration:3,effect:"lose 1 HP per turn",narrative:"is suffering from poison"},burned:{name:"Burned",duration:2,effect:"lose 2 HP per turn",narrative:"is burning with magical flames"},frozen:{name:"Frozen",duration:1,effect:"skip next turn",narrative:"is frozen solid"},paralyzed:{name:"Paralyzed",duration:2,effect:"50% chance to skip turn",narrative:"is paralyzed and can barely move"},confused:{name:"Confused",duration:2,effect:"may attack randomly",narrative:"is confused and disoriented"},blessed:{name:"Blessed",duration:3,effect:"+2 to attack rolls",narrative:"is blessed with divine favor"},hasted:{name:"Hasted",duration:2,effect:"extra action per turn",narrative:"is moving with supernatural speed"}},this.classAbilities={fighter:{name:"Second Wind",description:"Recover some HP",effect:"heal 1d6+2 HP",cooldown:3},wizard:{name:"Arcane Surge",description:"Enhance next spell",effect:"+2 to spell damage",cooldown:2},rogue:{name:"Sneak Attack",description:"Deal extra damage from stealth",effect:"+1d6 damage if target is unaware",cooldown:1},cleric:{name:"Divine Favor",description:"Bless an ally",effect:"target gets +1 to all rolls",cooldown:2}}}initializeCombat(e,n,r){return{combatants:[...e,...n].map(a=>({...a,initiative:this.calculateInitiative(a),statusEffects:[],cooldowns:{},lastAction:null,turnCount:0})).sort((a,c)=>c.initiative-a.initiative),currentTurn:0,round:1,combatState:"active",storyContext:r,environmentalFeatures:this.extractEnvironmentalFeatures(r),teamUpOpportunities:this.identifyTeamUpOpportunities(e),narrativeElements:this.extractNarrativeElements(r)}}calculateInitiative(e){var s,i,a;let n=Math.floor(Math.random()*20)+1;return n+={rogue:3,monk:2,ranger:1,fighter:0,cleric:0,wizard:-1,paladin:-1}[(s=e.class)==null?void 0:s.toLowerCase()]||0,(i=e.statusEffects)!=null&&i.includes("hasted")&&(n+=5),(a=e.statusEffects)!=null&&a.includes("paralyzed")&&(n-=3),n}extractEnvironmentalFeatures(e){const n=[],r={forest:["trees","cover","difficult terrain"],cave:["darkness","echoes","tight spaces"],tavern:["furniture","crowds","flammable materials"],castle:["stone walls","narrow corridors","defensive positions"],dungeon:["traps","darkness","confined spaces"],outdoors:["weather","open space","natural cover"]},s=e.toLowerCase();return Object.entries(r).forEach(([i,a])=>{s.includes(i)&&n.push(...a)}),n}identifyTeamUpOpportunities(e){const n=[];return[{classes:["fighter","rogue"],description:"Fighter distracts while Rogue sneaks in for a backstab"},{classes:["wizard","cleric"],description:"Wizard casts area spell while Cleric protects the party"},{classes:["fighter","cleric"],description:"Fighter tanks while Cleric provides healing support"},{classes:["rogue","wizard"],description:"Rogue scouts while Wizard provides magical backup"}].forEach(s=>{s.classes.every(a=>e.some(c=>{var u;return((u=c.class)==null?void 0:u.toLowerCase())===a}))&&n.push(s)}),n}extractNarrativeElements(e){return{mood:this.determineCombatMood(e),stakes:this.determineStakes(e),environmentalHazards:this.identifyHazards(e),npcInvolvement:this.extractNPCs(e)}}determineCombatMood(e){const n=e.toLowerCase();return n.includes("desperate")||n.includes("last stand")?"desperate":n.includes("training")||n.includes("practice")?"casual":n.includes("revenge")||n.includes("vengeance")?"vengeful":n.includes("defense")||n.includes("protect")?"defensive":"standard"}determineStakes(e){const n=e.toLowerCase();return n.includes("life")||n.includes("death")||n.includes("kill")?"life_or_death":n.includes("escape")||n.includes("flee")?"escape":n.includes("capture")||n.includes("arrest")?"capture":n.includes("treasure")||n.includes("loot")?"treasure":"standard"}identifyHazards(e){const n=[],r=e.toLowerCase();return(r.includes("fire")||r.includes("flame"))&&n.push("fire"),(r.includes("water")||r.includes("river")||r.includes("lake"))&&n.push("water"),(r.includes("height")||r.includes("cliff")||r.includes("fall"))&&n.push("height"),(r.includes("trap")||r.includes("pit"))&&n.push("traps"),n}extractNPCs(e){const n=[];return[/(\w+)\s+(?:the\s+)?(?:guard|merchant|wizard|knight|rogue|priest)/gi,/(?:named|called)\s+(\w+)/gi].forEach(s=>{[...e.matchAll(s)].forEach(a=>{n.push(a[1])})}),n}async executeAction(e,n,r,s,i={}){var y,k;console.log(" executeAction called with:",{combatantId:n,actionType:r,targetId:s,additionalData:i});const a=e.combatants.find(w=>w.id===n),c=e.combatants.find(w=>w.id===s);if(console.log(" Found combatant and target:",{combatant:a?{name:a.name,hp:a.hp,maxHp:a.maxHp}:null,target:c?{name:c.name,hp:c.hp,maxHp:c.maxHp}:null}),!a||!c)throw new Error("Invalid combatant or target");if(a.cooldowns&&a.cooldowns[r]>0)return{success:!1,message:`${a.name} cannot use ${r} yet (cooldown: ${a.cooldowns[r]} turns)`};const u=this.generateActionNarrative(a,r,c,i),d=this.calculateActionResults(a,r,c,i);console.log(" Action results calculated:",d),this.applyActionEffects(e,a,c,d),this.updateCooldowns(e,a,r);const h=this.checkStatusEffectApplication(a,r,c,d);let f=(e.currentTurn+1)%e.combatants.length,g=0;const x=e.combatants.length;for(;g<x;){const w=e.combatants[f];if(w&&w.hp>0)break;f=(f+1)%e.combatants.length,g++}g>=x&&(console.log(" No alive combatants found, keeping current turn"),f=e.currentTurn);const C={...e,currentTurn:f};return f===0&&(C.round=C.round+1),console.log(" Turn progression in executeAction:",{currentTurn:e.currentTurn,nextTurnIndex:f,totalCombatants:e.combatants.length,nextCombatant:(y=e.combatants[f])==null?void 0:y.name,nextCombatantHp:(k=e.combatants[f])==null?void 0:k.hp,round:C.round,attempts:g}),console.log(" executeAction returning result with damage:",d.damage),console.log(" Target HP after executeAction:",c.hp),console.log(" Updated session currentTurn:",C.currentTurn),{success:!0,narrative:u,results:d,statusEffects:h,environmentalImpact:this.calculateEnvironmentalImpact(e,r,d),targetId:s,updatedSession:C,damage:d.damage,healing:d.healing}}generateActionNarrative(e,n,r,s){let a=this.actionTypes[n].narrativeTemplate;a=a.replace("{character}",e.name),a=a.replace("{action}",this.getActionVerb(n,e.class)),a=a.replace("{weapon}",s.weapon||"their weapon"),a=a.replace("{spell}",s.spell||"a spell"),a=a.replace("{ability}",s.ability||"special ability"),a=a.replace("{item}",s.item||"an item"),a=a.replace("{environment}",s.environment||"surroundings"),a=a.replace("{ally}",s.ally||"ally"),s.specialAttack&&s.specialAttack!=="Standard Action"&&(a=`${e.name} uses ${s.specialAttack}! `+a),s.damageType&&s.damageType!=="physical"&&(a+=` The attack deals ${s.damageType} damage.`);const c=this.getClassFlavor(e.class,n);return c&&(a+=` ${c}`),a}getActionVerb(e,n){var s;return((s={fighter:{attack:"charges forward with a mighty swing",defend:"raises their shield defensively",special:"unleashes their combat expertise"},wizard:{attack:"casts a magical bolt",spell:"weaves arcane energy",special:"channels pure magical power"},rogue:{attack:"strikes from the shadows",defend:"dodges and weaves",special:"executes a perfect sneak attack"},cleric:{attack:"calls upon divine power",spell:"prays for divine intervention",special:"channels holy energy"}}[n==null?void 0:n.toLowerCase()])==null?void 0:s[e])||"performs an action"}getClassFlavor(e,n){var s;return((s={priest:{attack:"Divine energy crackles around their weapon.",spell:"Holy light emanates from their hands.",heal:"A warm, healing glow surrounds them."},wizard:{attack:"Arcane energy flows through their weapon.",spell:"Mystical runes appear in the air.",special:"Ancient magic surges through them."},warrior:{attack:"Their combat training shows in every move.",special:"Years of battle experience guide their strike.",defend:"They adopt a defensive stance with practiced ease."},rogue:{attack:"They move with deadly precision.",special:"Shadow and stealth enhance their attack.",defend:"They dodge and weave with acrobatic grace."},boss:{attack:"Their overwhelming presence fills the battlefield.",special:"Ancient power courses through their veins.",spell:"Reality itself seems to bend to their will."},undead:{attack:"Necrotic energy pulses from their form.",spell:"Death magic swirls around them.",special:"The very air grows cold with their presence."}}[e==null?void 0:e.toLowerCase()])==null?void 0:s[n])||""}calculateActionResults(e,n,r,s){const i={damage:0,healing:0,statusEffects:[],environmentalEffects:[],narrative:"",specialAttack:s.specialAttack||"Standard Action",damageType:s.damageType||"physical",attribute:s.attribute||"strength"};switch(n){case"attack":i.damage=this.calculateAttackDamage(e,r,s);break;case"spell":i.damage=this.calculateSpellDamage(e,r,s);break;case"special":i.damage=this.calculateSpecialDamage(e,r,s);break;case"item":i.healing=this.calculateItemEffect(e,r,s);break;case"defend":i.statusEffects.push({type:"defensive",duration:1});break;case"environmental":i.environmentalEffects=this.calculateEnvironmentalEffects(e,r,s);break;case"teamUp":i.damage=this.calculateTeamUpDamage(e,r,s);break}return i}calculateAttackDamage(e,n,r){console.log(" calculateAttackDamage called for:",{combatant:e.name,target:n.name,combatantClass:e.class,additionalData:r});const s=Math.floor(Math.random()*8)+1,i=Math.floor(((e.strength||10)-10)/2),a=r.weaponBonus||0;console.log(" Base damage calculation:",{baseDamage:s,strengthMod:i,weaponBonus:a,combatantStrength:e.strength||10});let c=1,u=0;if(e.id.startsWith("enemy_")){c=1+(e.level-1)*.3;const d=r.attribute||"strength";u=Math.floor(((e[d]||10)-10)/2);const h=this.calculateEnemyItemBonus(e);let f=0;r.specialAttack&&r.specialAttack!=="Standard Attack"&&(f=Math.floor(Math.random()*4)+2),r.isBossAttack&&(f+=5);let g=(s+i+a+u+h+f)*c;Math.floor(Math.random()*20)+1===20&&(g*=2),console.log(`Enhanced enemy damage calculation for ${e.name}:`,{baseDamage:s,strengthMod:i,weaponBonus:a,attributeMod:u,itemBonus:h,specialBonus:f,levelScaling:c,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,totalDamage:Math.max(1,Math.floor(g))});const x=Math.max(1,Math.floor(g));return console.log(` Enemy ${e.name} final damage: ${x}`),x}else{const d=Math.floor(((e.dexterity||10)-10)/2),h=Math.floor((e.level-1)*.5);let f=s+i+d+a+h;Math.floor(Math.random()*20)+1===20&&(f*=2);const g=Math.max(1,Math.floor(f));return console.log(` Player ${e.name} damage calculation:`,{baseDamage:s,strengthMod:i,dexterityMod:d,weaponBonus:a,levelBonus:h,totalDamage:g}),g}}getEnemyPrimaryAttribute(e){return{Warrior:"strength",Archer:"dexterity",Mage:"intelligence",Cleric:"wisdom",Rogue:"dexterity",Paladin:"strength",Ranger:"dexterity",Wizard:"intelligence",Fighter:"strength"}[e]||"strength"}calculateEnemyItemBonus(e){let n=0;return e.equipment&&(e.equipment.weapon&&(n+=e.equipment.weapon.damageBonus||0),e.equipment.armor&&(n+=e.equipment.armor.defenseBonus||0),e.equipment.accessory&&(n+=e.equipment.accessory.bonus||0)),e.level>3&&(n+=Math.floor((e.level-3)/2)),n}calculateSpellDamage(e,n,r){const s=Math.floor(Math.random()*6)+1,i=Math.floor((e.intelligence-10)/2),a=r.spellLevel||1;if(e.id.startsWith("enemy_")){const c=1+(e.level-1)*.4,u=Math.floor((e.wisdom-10)/2),d=this.calculateEnemyItemBonus(e);let h=(s+i+u+a+d)*c;return Math.floor(Math.random()*20)+1>=19&&(h*=1.5),Math.max(1,Math.floor(h))}else return Math.max(1,s+i+a)}calculateSpecialDamage(e,n,r){var c;if(!this.classAbilities[(c=e.class)==null?void 0:c.toLowerCase()])return 0;const i=Math.floor(Math.random()*10)+2,a=Math.floor((e.level||1)/2);return Math.max(1,i+a)}calculateItemEffect(e,n,r){switch(r.itemType||"potion"){case"healing":return Math.floor(Math.random()*8)+2;case"antidote":return 0;case"blessing":return 0;default:return Math.floor(Math.random()*4)+1}}calculateTeamUpDamage(e,n,r){const s=Math.floor(Math.random()*12)+3;return Math.max(1,s+2)}applyActionEffects(e,n,r,s){if(console.log(" applyActionEffects called with:",{combatant:n.name,target:r.name,results:s,targetHpBefore:r.hp}),s.damage>0){const i=r.hp;r.hp=Math.max(0,r.hp-s.damage),console.log(` Damage applied in applyActionEffects: ${n.name} deals ${s.damage} damage to ${r.name}. HP: ${i}  ${r.hp}`)}if(s.healing>0){const i=r.hp;r.hp=Math.min(r.maxHp,r.hp+s.healing),console.log(` Healing applied in applyActionEffects: ${n.name} heals ${r.name} for ${s.healing} HP. HP: ${i}  ${r.hp}`)}r.statusEffects||(r.statusEffects=[]),s.statusEffects.forEach(i=>{r.statusEffects.some(a=>a.type===i.type)||(r.statusEffects.push({type:i.type,duration:i.duration,appliedBy:n.id}),console.log(` Status effect applied: ${i.type} to ${r.name}`))}),console.log(` Final target HP after applyActionEffects: ${r.name} = ${r.hp}`)}updateCooldowns(e,n,r){const s=this.actionTypes[r];n.cooldowns||(n.cooldowns={}),n.cooldowns[r]=s.cooldown,Object.keys(n.cooldowns).forEach(i=>{i!==r&&n.cooldowns[i]>0&&n.cooldowns[i]--})}checkStatusEffectApplication(e,n,r,s){const i=[];if(r.statusEffects||(r.statusEffects=[]),s.damage>10){const a=["stunned","bleeding"],c=a[Math.floor(Math.random()*a.length)];r.statusEffects.some(u=>u.type===c)||i.push({type:c,duration:1,appliedBy:e.id})}return i}calculateEnvironmentalImpact(e,n,r){const s=[];return n==="spell"&&r.damage>8&&s.push("The magical energy disturbs the environment"),n==="environmental"&&s.push("The environment responds to the action"),s}processStatusEffects(e,n){const r=[];return n.statusEffects&&n.statusEffects.forEach((s,i)=>{switch(s.duration--,s.type){case"poisoned":n.hp=Math.max(0,n.hp-1),r.push(`${n.name} takes 1 poison damage`);break;case"burned":n.hp=Math.max(0,n.hp-2),r.push(`${n.name} takes 2 burn damage`);break;case"frozen":r.push(`${n.name} is frozen and cannot act`);break;case"paralyzed":Math.random()<.5&&r.push(`${n.name} is paralyzed and cannot act`);break;case"blessed":r.push(`${n.name} is blessed with divine favor`);break;case"hasted":r.push(`${n.name} moves with supernatural speed`);break}s.duration<=0&&(n.statusEffects.splice(i,1),r.push(`${n.name} is no longer ${s.type}`))}),r}checkCombatEnd(e){const n=e.combatants.filter(a=>!a.id.startsWith("enemy_")),r=e.combatants.filter(a=>a.id.startsWith("enemy_")),s=n.some(a=>a.hp>0),i=r.some(a=>a.hp>0);return s?i?{ended:!1}:{ended:!0,result:"victory",narrative:"The enemies have been defeated!"}:{ended:!0,result:"defeat",narrative:"The party has been defeated..."}}generateCombatSummary(e,n){return{result:n,duration:e.round,participants:e.combatants.map(s=>({name:s.name,finalHp:s.hp,actions:s.turnCount,statusEffects:s.statusEffects.length})),narrative:this.generateCombatNarrative(e,n)}}generateCombatNarrative(e,n){const r=e.combatants.filter(s=>!s.id.startsWith("enemy_"));return e.combatants.filter(s=>s.id.startsWith("enemy_")),n==="victory"?`The party emerges victorious from the battle. ${r.map(s=>s.name).join(", ")} stand triumphant over their fallen foes.`:n==="defeat"?"The battle ends in defeat. The party has been overwhelmed by their enemies.":"The battle ends in a draw, with both sides withdrawing to regroup."}chooseEnemyAction(e,n){const r=this.getAvailableActions(e),s=this.getValidTargets(e,"attack",n);return console.log(`Enemy ${e.name} available actions:`,r),console.log(`Enemy ${e.name} valid targets:`,s.map(i=>i.name)),s.length===0?(console.log(`No valid targets for ${e.name}, defaulting to defend`),{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}):this.makeEnemyDecision(e,r,s,n)}getAvailableActions(e){var s;const n=[],r=e.cooldowns||{};return console.log("Getting enemy available actions for:",e.name,{cooldowns:r,class:e.class,hasClassAbility:!!this.classAbilities[(s=e.class)==null?void 0:s.toLowerCase()]}),Object.entries(this.actionTypes).forEach(([i,a])=>{(!r.hasOwnProperty(i)||r[i]<=0)&&n.push(i)}),e.class&&this.classAbilities[e.class.toLowerCase()]&&(!r.hasOwnProperty("special")||r.special<=0)&&n.push("special"),console.log("Available actions for enemy:",e.name,n),n}getValidTargets(e,n,r){const s=[],i=r.combatants.filter(a=>a.hp>0);if(i.length===0)return console.log("No alive combatants found"),[];switch(n){case"attack":case"spell":case"special":e.id.startsWith("enemy_")?s.push(...i.filter(a=>!a.id.startsWith("enemy_"))):s.push(...i.filter(a=>a.id.startsWith("enemy_")));break;case"heal":case"item":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_"))):s.push(...i.filter(a=>!a.id.startsWith("enemy_")));break;case"defend":case"environmental":s.push(e);break;case"teamUp":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_")&&a.id!==e.id)):s.push(...i.filter(a=>!a.id.startsWith("enemy_")&&a.id!==e.id));break;default:s.push(...i)}return console.log(`Valid targets for ${e.name} (${n}):`,s.map(a=>a.name)),s}makeEnemyDecision(e,n,r,s){var h;if(n.length===0)return console.log("No available actions for enemy, defaulting to defend"),{action:"defend",targetId:e.id,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"};if(r.length===0)return console.log("No valid targets for enemy, defaulting to defend"),{action:"defend",targetId:e.id,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"};const i=r[Math.floor(Math.random()*r.length)],a=e.hp/e.maxHp,c=(h=e.class)==null?void 0:h.toLowerCase();if(e.level,c==="priest"||c==="cleric"){if(a<.4&&n.includes("spell"))return{action:"spell",targetId:e.id,spellType:"healing",specialAttack:"Divine Healing",damageType:"healing",attribute:"wisdom"};if(n.includes("spell"))return{action:"spell",targetId:i.id,spellType:"divine",specialAttack:"Divine Smite",damageType:"radiant",attribute:"wisdom"}}if((c==="wizard"||c==="mage"||c==="sorcerer")&&n.includes("spell")){const f=["fireball","lightning","ice","arcane"],g=f[Math.floor(Math.random()*f.length)];return{action:"spell",targetId:i.id,spellType:g,specialAttack:`${g.charAt(0).toUpperCase()+g.slice(1)} Spell`,damageType:g==="fireball"?"fire":g==="lightning"?"lightning":g==="ice"?"cold":"arcane",attribute:"intelligence"}}if((c==="boss"||c==="dragon")&&n.includes("special"))return{action:"special",targetId:i.id,specialAttack:"Devastating Strike",damageType:"physical",attribute:"strength",isBossAttack:!0};if((c==="undead"||c==="skeleton"||c==="zombie")&&n.includes("spell"))return{action:"spell",targetId:i.id,spellType:"necrotic",specialAttack:"Death Touch",damageType:"necrotic",attribute:"constitution"};if(a<.3){if(n.includes("item"))return{action:"item",targetId:e.id,itemType:"healing",specialAttack:"Use Healing Potion",damageType:"healing",attribute:"constitution"};if(n.includes("defend"))return{action:"defend",targetId:e.id,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}}return s.combatants.filter(f=>f.id.startsWith("enemy_")&&f.hp/f.maxHp<.5).length>1&&n.includes("spell")?{action:"spell",targetId:i.id,spellType:"area",specialAttack:"Area Attack",damageType:"mixed",attribute:"intelligence"}:n.includes("attack")?{action:"attack",targetId:i.id,specialAttack:"Standard Attack",damageType:"physical",attribute:"strength"}:{action:n[Math.floor(Math.random()*n.length)],targetId:i.id,specialAttack:"Basic Action",damageType:"physical",attribute:"strength"}}async executeEnemyTurn(e,n){const r=this.chooseEnemyAction(n,e);return console.log("Enemy decision details:",{enemy:n.name,decision:r,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute}),r.targetId?await this.executeAction(e,n.id,r.action,r.targetId,{itemType:r.itemType,spellType:r.spellType,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,isBossAttack:r.isBossAttack}):await this.executeAction(e,n.id,"defend",n.id,{specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute})}}const $r=new gp,UR="https://dnd-v1-backend.onrender.com",pn=async(t,e="gpt-4",n=1e3,r=.8)=>{try{const s=t.filter(c=>!c||typeof c!="object"?(console.warn("Invalid message object:",c),!1):!c.role||!c.content?(console.warn("Message missing role or content:",c),!1):!0);if(s.length===0)throw new Error("No valid messages to send to API");const i=await fetch(`${UR}/api/openai`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:s,model:e,max_tokens:n,temperature:r})});if(!i.ok){let c="Backend API request failed";try{c=(await i.json()).error||c}catch{c=`${i.status}: ${i.statusText}`}throw i.status===500?c=`AI service error: ${c}. This might be due to missing API key, rate limiting, or network issues.`:i.status===404?c="AI service endpoint not found. Please check the backend configuration.":i.status===503&&(c="AI service temporarily unavailable. Please try again later."),new Error(c)}return await i.json()}catch(s){throw console.error("Backend API Error:",s),new Error(`Failed to communicate with backend: ${s.message}`)}};class BR{constructor(){this.systemPrompt=`You are an experienced Dungeon Master for Dungeons & Dragons 5th Edition. You excel at:
- Creating engaging storylines and plot hooks
- Developing detailed character descriptions and backstories
- Generating multiple story options when specifically requested
- Providing atmospheric descriptions and immersive storytelling
- Balancing combat encounters and managing game mechanics
- Creating memorable NPCs and villains
- Adapting to player choices and creating dynamic narratives
- Maintaining story consistency and character development
- Building upon established relationships and plot threads

IMPORTANT: Only generate multiple options when explicitly requested. When asked to generate a single story introduction, campaign goal, or other content, provide ONLY ONE response.

Always respond in character as a Dungeon Master, providing rich, descriptive content that enhances the gaming experience. Maintain consistency with previous story elements, character relationships, and established plot threads.`,this.diceService=new fp,this.actionValidationService=new pp,this.combatService=new gp}async generateStoryPlots(e,n="",r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class} (${u.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 3 different story plot options for a D&D campaign.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

IMPORTANT: You MUST format your response EXACTLY as follows for each plot option:

**Plot Option 1:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

**Plot Option 2:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

**Plot Option 3:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

Guidelines for the plots:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

CRITICAL: Do not deviate from this exact format. Each plot must start with "**Plot Option X:**" and use the numbered format exactly as shown above.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1e3,.8)).choices[0].message.content}catch(s){throw new Error(`Failed to generate story plots: ${s.message}`)}}async generateCharacterDetails(e){try{const n=`As a Dungeon Master, I need you to expand on this character's details and create a rich, detailed description.

Character: ${e.name} - Level ${e.level} ${e.race} ${e.class}
Background: ${e.background}
Alignment: ${e.alignment}
Personality: ${e.personality||"Not specified"}
Ideals: ${e.ideals||"Not specified"}
Bonds: ${e.bonds||"Not specified"}
Flaws: ${e.flaws||"Not specified"}
Backstory: ${e.backstory||"Not specified"}

Please provide:
1. A detailed physical description (appearance, mannerisms, distinctive features)
2. An expanded personality profile with quirks and habits
3. A deeper backstory with key events and relationships
4. Character motivations and goals
5. Potential story hooks and plot threads related to this character
6. How this character might interact with the party and world

Make the character feel alive and three-dimensional, with details that could drive story development.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:n}],"gpt-4",800,.7)).choices[0].message.content}catch(n){throw console.error("Error generating character details:",n),new Error(`Failed to generate character details: ${n.message}`)}}async generateStorySummary(e,n){try{const r=n.map(a=>`${a.name} (${a.race} ${a.class})`).join(", "),s=`As a Dungeon Master, I need you to create a detailed story summary and outline for this campaign plot.

Plot: ${e}
Party: ${r}

Please provide:
1. A detailed campaign overview (3-4 paragraphs)
2. Key story beats and major events
3. Important NPCs and their roles
4. Potential challenges and obstacles
5. Story themes and motifs
6. How each party member might be personally invested
7. Potential branching paths and player choices
8. Climactic moments and resolution possibilities

Make this feel like a professional campaign module with rich storytelling potential.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:s}],"gpt-4",1200,.7)).choices[0].message.content}catch(r){throw console.error("Error generating story summary:",r),new Error(`Failed to generate story summary: ${r.message}`)}}async generateMultipleStoryPlots(e,n="",r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class} (${u.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 5 different story plot options for a D&D campaign, each with a detailed summary.

Party Composition: ${s}${i}
Campaign Setting: ${n||"Generic fantasy world"}

For each of the 5 plot options, provide:
1. A compelling title
2. A detailed summary (3-4 paragraphs)
3. The main conflict or challenge
4. Key story beats and major events
5. Important NPCs and their roles
6. Potential story hooks for the party
7. Estimated campaign length (short, medium, or long)
8. Themes and motifs
9. How each party member might be personally invested

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options. Number each plot clearly (Plot 1, Plot 2, etc.).`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1500,.8)).choices[0].message.content}catch(s){throw console.error("Error generating multiple story plots:",s),new Error(`Failed to generate multiple story plots: ${s.message}`)}}async generateNPC(e,n=""){try{const r=`As a Dungeon Master, I need you to create a detailed NPC for this role and context.

NPC Role: ${e}
Context: ${n||"General campaign context"}

Please provide:
1. A detailed physical description
2. Personality traits and mannerisms
3. Background and motivations
4. Current situation and goals
5. How they might interact with the party
6. Potential story hooks or plot threads they could introduce
7. Their relationship to the world and other NPCs
8. Any secrets or hidden aspects of their character

Make this NPC feel like a real person with depth and complexity.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:r}],"gpt-4",800,.7)).choices[0].message.content}catch(r){throw console.error("Error generating NPC:",r),new Error(`Failed to generate NPC: ${r.message}`)}}async generateCombatEncounter(e,n,r="medium",s=""){try{const i=`As a Dungeon Master, I need you to create a detailed combat encounter.

Party Level: ${e}
Party Size: ${n}
Difficulty: ${r}
Theme: ${s||"General fantasy"}

Please provide:
1. A detailed description of the encounter location
2. Enemy types and their motivations
3. Tactical considerations and terrain features
4. Potential story elements or plot hooks
5. Non-combat resolution options
6. Consequences of victory or defeat
7. Environmental hazards or advantages
8. How this encounter fits into the larger story

Make this encounter feel meaningful and story-driven, not just a random fight.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:i}],"gpt-4",800,.7)).choices[0].message.content}catch(i){throw console.error("Error generating combat encounter:",i),new Error(`Failed to generate combat encounter: ${i.message}`)}}async generateStoryContinuation(e,n,r,s=null,i="individual",a=null){var c,u,d,h,f;try{const g=e.map(F=>`${F.name} - Level ${F.level} ${F.race} ${F.class}`).join(", ");let x=null,C=null,y="";if(i==="individual"){const F=e[e.length-1];if(F)if(x=this.actionValidationService.validatePlayerAction(r,F,{context:"story",storyState:s}),x.valid&&x.diceResult){if(C=x.diceResult,C.overallSuccess){if(y=`

ACTION VALIDATION: The action is within your character's capabilities.`,C.actions){const q=C.actions.map(E=>`${E.action}: ${E.check.isSuccess?"Success":"Failure"} (Roll: ${E.check.roll}, DC: ${E.check.dc})`).join(", ");y+=`
Dice Results: ${q}`}}else if(y=`

ACTION VALIDATION: Some aspects of this action are challenging for your character.`,C.actions){const E=C.actions.filter(_=>!_.check.isSuccess).map(_=>`${_.action}: Failure (Roll: ${_.check.roll}, DC: ${_.check.dc})`).join(", ");y+=`
Failed Actions: ${E}`}}else x.valid||(y=`

ACTION VALIDATION: ${x.response}`,x.suggestion&&(y+=`
Suggestion: ${x.suggestion}`))}const k=n.map(F=>({role:F.role,content:F.content}));let w="";a&&(w=`
Party Theme: ${a.description||"No theme provided"}`);let b="";s&&(b=`
STORY STATE CONTEXT:
Current Location: ${((c=s.currentLocation)==null?void 0:c.name)||"Unknown"} - ${((u=s.currentLocation)==null?void 0:u.description)||""}
Active NPCs: ${Object.keys(s.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((d=s.activePlotThreads)==null?void 0:d.map(F=>`${F.title} (${Math.round(F.progress*100)}%)`).join(", "))||"None"}
Recent Events: ${((f=(h=s.worldState)==null?void 0:h.recentEvents)==null?void 0:f.slice(-3).map(F=>F.event).join(", "))||"None"}

CHARACTER RELATIONSHIPS:
${e.map(F=>{var _;const q=((_=s.characterArcs)==null?void 0:_[F.id])||{},E=Object.entries(q.relationships||{}).map(([N,A])=>`${N} (${A})`).join(", ");return`${F.name}: ${E||"No established relationships"}`}).join(`
`)}

NPC CONTEXT:
${Object.entries(s.activeNPCs||{}).map(([F,q])=>{var E;return`${F}: ${q.disposition} disposition, knowledge: ${((E=q.knowledge)==null?void 0:E.join(", "))||"none"}, goal: ${q.currentGoal||"unknown"}`}).join(`
`)}`);const I=`As a Dungeon Master, continue the story based on the player's response.

Party: ${g}${w}
Player Response: "${r}" (Type: ${i})
Response Type Context:
- individual: One character's personal action
- team: Group action or decision
- investigate: Looking for clues or information
- combat: Combat-related action
- social: Social interaction or diplomacy${b}

Previous Story Context:
${k.map(F=>`${F.role==="assistant"?"DM":"Player"}: ${F.content}`).join(`
`)}

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

ACTION VALIDATION GUIDELINES:
- If the action validation shows the action is impossible, gently redirect the player while maintaining story flow
- If the action validation shows the action is challenging, incorporate the difficulty into the narrative
- If the action validation shows the action is successful, proceed with the action as described
- Always maintain story coherence and character consistency
- Use the validation results to inform how the action plays out in the story

Please provide a compelling continuation that:
1. Acknowledges the player's action in context of the current situation and location
2. References relevant NPCs and their established relationships with the party
3. Continues or advances active plot threads appropriately
4. Updates character relationships based on the action
5. Maintains location and atmosphere consistency
6. Ends with a clear situation that invites the next player to respond
7. Encourages character interaction and roleplay
8. Provides multiple possible directions for the party to explore
9. Builds upon the established story state and character development
10. Incorporates action validation results naturally into the narrative

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.${y}`;return{content:(await pn([{role:"system",content:this.systemPrompt},...k,{role:"user",content:I}],"gpt-4",800,.8)).choices[0].message.content,actionValidation:x,diceResult:C}}catch(g){throw console.error("Error generating story continuation:",g),new Error(`Failed to generate story continuation: ${g.message}`)}}async generatePlotOptions(e,n=null){try{const r=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class}. ${u.personality||""}. ${u.backstory||""}`).join(`
`);let s="";n&&(s=`
Party Theme: ${n.description||"No theme provided"}`);const i="You are a Dungeon Master for D&D 5e. You MUST generate exactly 3 plot options, no more, no less. Follow the exact format provided. Do not use party names in the plots. Keep summaries brief (1-2 sentences maximum). DO NOT repeat plots or generate duplicates.",a=`Generate exactly 3 distinct campaign plot options for this party. 

REQUIRED FORMAT - Follow this exact structure:

Plot 1: [Title]
[Brief summary - 1-2 sentences maximum]

Plot 2: [Title]  
[Brief summary - 1-2 sentences maximum]

Plot 3: [Title]
[Brief summary - 1-2 sentences maximum]

Party: ${r}${s}

CRITICAL REQUIREMENTS:
- Generate EXACTLY 3 plots, no more, no less
- Use the party theme to influence the plot lines and atmosphere
- Do NOT use the party name in the plots - focus on the characters and theme
- Each summary must be 1-2 sentences maximum
- Follow the exact format above with "Plot 1:", "Plot 2:", "Plot 3:" labels
- Do not add any additional text, explanations, or formatting
- Do not repeat or duplicate any plots
- Stop after Plot 3 - do not generate more plots

Make each plot distinct and appealing to different play styles.`;return(await pn([{role:"system",content:i},{role:"user",content:a}],"gpt-4",600,.8)).choices[0].message.content}catch(r){throw console.error("Error generating plot options:",r),new Error(`Failed to generate plot options: ${r.message}`)}}async generateStoryIntroduction(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}. ${d.personality||""}. ${d.backstory||""}`).join(`
`);let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const c=`As a Dungeon Master, create an engaging story introduction for the beginning of this campaign.

Party: ${i}${a}
Selected Plot: ${n}
Plot Number: ${r}

IMPORTANT: Generate ONLY ONE story introduction for the selected plot above. Do NOT generate introductions for multiple plots or options.

Create an introduction that includes:
1. A vivid description of the starting town/settlement where the party begins
2. How each character arrives or is already present in this location
3. The initial situation or hook that draws the party together
4. A sense of atmosphere and setting that matches the chosen plot
5. An opening scene that gives the party their first decision or action to take

Important Guidelines:
- Use the party theme to influence the atmosphere and context
- Incorporate themes and elements from the party theme to create atmosphere and context
- Consider how the party's background and composition might influence the starting situation
- Focus on the characters and their individual stories
- The story should feel cohesive with the established theme
- Generate ONLY ONE introduction for the selected plot

Make this feel like the opening of an epic adventure. Set the tone, establish the setting, and give the party a clear starting point. End with a situation that requires the party to make a choice or take action.

Keep the introduction engaging but concise (3-4 paragraphs maximum).`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:c}],"gpt-4",800,.8)).choices[0].message.content}catch(i){throw console.error("Error generating story introduction:",i),new Error(`Failed to generate story introduction: ${i.message}`)}}async generateStructuredStoryResponse(e,n,r,s,i,a=null,c=null){var u,d,h;try{const f=e.map(b=>`${b.name} - Level ${b.level} ${b.race} ${b.class}`).join(", "),g=n.filter(b=>b&&typeof b=="object"&&b.role&&b.content).map(b=>({role:b.role,content:b.content}));let x="";c&&(x=`
Party Theme: ${c.description||"No theme provided"}`);const C=i.length>0?`
Discovered Objectives: ${i.map(b=>b.title).join(", ")}`:"";let y="";a&&(y=`
STORY STATE CONTEXT:
Current Location: ${((u=a.currentLocation)==null?void 0:u.name)||"Unknown"} - ${((d=a.currentLocation)==null?void 0:d.description)||""}
Active NPCs: ${Object.keys(a.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((h=a.activePlotThreads)==null?void 0:h.map(b=>`${b.title} (${Math.round(b.progress*100)}%)`).join(", "))||"None"}
Character Relationships: ${Object.entries(a.characterArcs||{}).map(([b,I])=>{const j=e.find(F=>F.id===b);return`${j==null?void 0:j.name}: ${Object.entries(I.relationships||{}).map(([F,q])=>`${F} (${q})`).join(", ")||"No relationships"}`}).join("; ")}`);const k=`As a Dungeon Master, continue the story based on the player's response, considering the current story phase and discovered objectives.

Party: ${f}${x}
Current Phase: ${s}
Player Response: "${r}"${C}${y}

Story Phases:
- Investigation: Focus on discovery, clues, and gathering information
- Conflict: Focus on tension, threats, and potential combat
- Resolution: Focus on choices, consequences, and story conclusion

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

ENEMY INFORMATION REQUIREMENTS (when in Conflict phase):
If the story involves combat or enemies, provide detailed enemy information in the following format:

**ENEMY_DETAILS:**
[For each enemy present, provide:]
Name: [Enemy name if humanoid, or descriptive name like "Alpha Wolf"]
Type: [Enemy type: humanoid, beast, undead, etc.]
Level: [Enemy level relative to party]
HP: [Hit points]
AC: [Armor class]
Basic Attack: [Description of basic attack and damage]
Special Ability: [Description of special ability or attack]
Stats: [Brief description of key stats like "Strong and aggressive" or "Quick and stealthy"]

IMPORTANT: You MUST format your response EXACTLY as follows:

**STORY_CONTENT:**
[Your main story continuation here - 2-3 paragraphs that acknowledge the player's action, continue the plot, and set up the next situation]

**CURRENT_LOCATION:**
[Updated location description or "No change" if location remains the same]

**ACTIVE_NPCS:**
[List of NPCs currently present or relevant to the scene, separated by commas]

**PLOT_DEVELOPMENTS:**
[Key plot developments or revelations from this response]

**CHARACTER_REACTIONS:**
[How NPCs react to the player's action, if applicable]

**NEXT_ACTIONS:**
[2-3 clear options or directions the party can take next]

**STORY_TONE:**
[The current mood/atmosphere: tense, mysterious, hopeful, dangerous, etc.]

**PHASE_STATUS:**
[Current story phase: investigation, conflict, or resolution]

**ENEMY_DETAILS:** (only include if enemies are present)
[Detailed enemy information as specified above]

Keep your response engaging but concise. Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.`;return(await pn([{role:"system",content:this.systemPrompt},...g,{role:"user",content:k}],"gpt-4",1e3,.8)).choices[0].message.content}catch(f){throw console.error("Error generating structured story response:",f),new Error(`Failed to generate structured story response: ${f.message}`)}}async generatePhaseTransition(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const c=`As a Dungeon Master, create a phase transition message for the story.

Party: ${i}${a}
Current Phase: ${n}
Story Progress: ${r}

Create a transition that:
1. Acknowledges the progress made so far
2. Signals the shift to the new phase
3. Sets up the new challenges and opportunities
4. Maintains the established tone and atmosphere
5. Gives the party clear direction for the next phase

Make this feel like a natural progression in the story.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:c}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating phase transition:",i),new Error(`Failed to generate phase transition: ${i.message}`)}}async generateObjectiveCompletion(e,n,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const c=`As a Dungeon Master, create a completion message for an objective.

Party: ${i}${a}
Completed Objective: ${n.title}
Story Context: ${r}

Create a completion message that:
1. Celebrates the achievement
2. Provides closure for this objective
3. Sets up the next challenge or objective
4. Maintains story momentum
5. Acknowledges the party's efforts

Make this feel rewarding and meaningful.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:c}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating objective completion:",i),new Error(`Failed to generate objective completion: ${i.message}`)}}async generateCampaignContinuation(e,n,r,s,i=null){try{const a=e.map(f=>`${f.name} - Level ${f.level} ${f.race} ${f.class}`).join(", "),c=r.filter(f=>f&&typeof f=="object"&&f.role&&f.content).map(f=>({role:f.role,content:f.content}));let u="";i&&(u=`
Party Theme: ${i.description||"No theme provided"}`);const d=`As a Dungeon Master, continue the ongoing campaign story.

Party: ${a}${u}
Campaign Goal: ${n.mainGoal||"No specific goal"}
Campaign Progress: ${n.campaignProgress||"Beginning"}
Player Response: "${s}"

Previous Story Context:
${c.map(f=>`${f.role==="assistant"?"DM":"Player"}: ${f.content}`).join(`
`)}

Continue the story while:
1. Building toward the main campaign goal
2. Maintaining consistency with previous events
3. Developing character relationships and arcs
4. Creating meaningful choices and consequences
5. Advancing the overall plot

Keep your response engaging but concise (2-3 paragraphs maximum).`;return(await pn([{role:"system",content:this.systemPrompt},...c,{role:"user",content:d}],"gpt-4",800,.8)).choices[0].message.content}catch(a){throw console.error("Error generating campaign continuation:",a),new Error(`Failed to generate campaign continuation: ${a.message}`)}}async generateCampaignGoal(e,n,r=null){try{const s=e.map(u=>`${u.name} - Level ${u.level} ${u.race} ${u.class}`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, create a clear campaign goal based on the selected plot.

Party: ${s}${i}
Selected Plot: ${n}

IMPORTANT: Generate ONLY ONE campaign goal for the selected plot above. Do NOT generate multiple goals or options.

Create a campaign goal that:
1. Is clear and achievable
2. Provides direction for the entire campaign
3. Involves all party members
4. Has multiple possible paths to completion
5. Creates meaningful stakes and consequences
6. Is specific to the selected plot only

Make this goal compelling and motivating for the party. Generate ONLY ONE goal.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",600,.7)).choices[0].message.content}catch(s){throw console.error("Error generating campaign goal:",s),new Error(`Failed to generate campaign goal: ${s.message}`)}}async generateSessionSummary(e,n,r,s,i=null){try{const a=s.map(h=>`${h.name} - Level ${h.level} ${h.race} ${h.class}`).join(", ");let c="";i&&(c=`
Party Theme: ${i.description||"No theme provided"}`);const u=`As a Dungeon Master, create a session summary for this campaign session.

Party: ${a}${c}
Campaign Goal: ${e.mainGoal||"No specific goal"}
Objectives: ${r.map(h=>h.title).join(", ")}
Story Messages: ${n.length} total messages

Create a summary that:
1. Recaps the major events of the session
2. Highlights character development and relationships
3. Notes progress toward objectives
4. Sets up expectations for the next session
5. Maintains the established tone and atmosphere

Make this summary engaging and informative.`;return(await pn([{role:"system",content:this.systemPrompt},{role:"user",content:u}],"gpt-4",800,.7)).choices[0].message.content}catch(a){throw console.error("Error generating session summary:",a),new Error(`Failed to generate session summary: ${a.message}`)}}}const nc=new BR;function zR(){const t=er(),[e,n]=P.useState(null),[r,s]=P.useState(!1),[i,a]=P.useState({name:"",description:"",theme:"Fantasy",maxPlayers:6,isPublic:!0});P.useEffect(()=>{const d=Va(h=>{if(!h){t("/login");return}n(h)});return()=>d()},[t]);const c=(d,h)=>{a(f=>({...f,[d]:h}))},u=async()=>{try{s(!0),await c_(e.uid,i),t("/party-management")}catch{}finally{s(!1)}};return!e||r?o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-stone-600",children:"Loading..."})})})}):o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:"Campaign Management"}),o.jsxs("div",{className:"text-sm text-stone-600",children:["Playing as: ",o.jsx("span",{className:"font-medium",children:e.displayName})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"campaign-name",className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Name"}),o.jsx("input",{id:"campaign-name",type:"text",value:i.name,onChange:d=>c("name",d.target.value),className:"fantasy-input",placeholder:"Enter campaign name..."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"campaign-description",className:"block text-sm font-medium text-stone-700 mb-2",children:"Campaign Description"}),o.jsx("textarea",{id:"campaign-description",value:i.description,onChange:d=>c("description",d.target.value),className:"fantasy-input",rows:"4",placeholder:"Describe your campaign..."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"campaign-theme",className:"block text-sm font-medium text-stone-700 mb-2",children:"Theme"}),o.jsx("input",{id:"campaign-theme",type:"text",value:i.theme,onChange:d=>c("theme",d.target.value),className:"fantasy-input",placeholder:"Enter campaign theme..."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"max-players",className:"block text-sm font-medium text-stone-700 mb-2",children:"Maximum Players"}),o.jsx("input",{id:"max-players",type:"number",value:i.maxPlayers,onChange:d=>c("maxPlayers",Number(d.target.value)),className:"fantasy-input",placeholder:"Enter maximum number of players..."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"public-campaign",className:"block text-sm font-medium text-stone-700 mb-2",children:"Public Campaign"}),o.jsx("input",{id:"public-campaign",type:"checkbox",checked:i.isPublic,onChange:d=>c("isPublic",d.target.checked),className:"mr-2"})]}),o.jsx("div",{className:"text-center py-8",children:o.jsx("button",{onClick:u,className:"fantasy-button text-lg px-8 py-3",disabled:r,children:r?"Creating...":"Create Campaign"})})]})]})})}function HR(){var tn,ht,Lt;const t=er(),{partyId:e}=ff(),[n,r]=P.useState(null),[s,i]=P.useState(!1),[a,c]=P.useState(""),[u,d]=P.useState("");P.useState(!1);const[h,f]=P.useState(null),[g,x]=P.useState([]),[C,y]=P.useState(!1),[k,w]=P.useState(""),[b,I]=P.useState(!1),[j,F]=P.useState({name:"",race:"",class:"",level:1,background:"",alignment:"",strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10,age:"",height:"",weight:"",eyes:"",skin:"",hair:"",personality:"",ideals:"",bonds:"",flaws:"",backstory:"",equipment:[],spells:[],proficiencies:[],portrait:"/placeholder-character.png"}),[q,E]=P.useState("standard"),[_,N]=P.useState([]),[A,D]=P.useState([]),[S,T]=P.useState({}),[Ve,Me]=P.useState(!1),[Le,Ne]=P.useState({}),[G,ie]=P.useState([]);P.useEffect(()=>{const L=Va(U=>{if(!U){t("/login");return}r(U),e&&ve(U.uid,e).catch(be=>{}),te(U.uid).catch(be=>{})});return()=>L()},[t,e]),P.useEffect(()=>{h&&(F({name:h.name||"",race:h.race||"",class:h.class||"",level:h.level||1,background:h.background||"",alignment:h.alignment||"",strength:h.strength||10,dexterity:h.dexterity||10,constitution:h.constitution||10,intelligence:h.intelligence||10,wisdom:h.wisdom||10,charisma:h.charisma||10,age:h.age||"",height:h.height||"",weight:h.weight||"",eyes:h.eyes||"",skin:h.skin||"",hair:h.hair||"",personality:h.personality||"",ideals:h.ideals||"",bonds:h.bonds||"",flaws:h.flaws||"",backstory:h.backstory||"",equipment:h.equipment||[],spells:h.spells||[],proficiencies:h.proficiencies||[],portrait:h.portrait||"/placeholder-character.png"}),h.weaponChoices&&Ne(h.weaponChoices),h.spellChoices&&ie(h.spellChoices),h.abilityScoreMethod&&E(h.abilityScoreMethod),h.rolledScores&&(N(h.rolledScores),T(h.assignedScores||{}),Me(h.rolledScores.length>0)))},[h]),P.useEffect(()=>{n&&e&&(async()=>{try{(await Cc(n.uid)).filter(Ae=>Ae.partyId===e).length>1&&(await W(),await ve(n.uid,e))}catch{}})()},[n,e]);const ve=async(L,U)=>{try{const Ae=(await Cc(L)).filter(zt=>zt.partyId===U);if(Ae.length===0){f(null);return}if(Ae.length===1){f(Ae[0]);return}const Bt=Ae.sort((zt,mt)=>{var tt,pr,tr,zn;const jr=((pr=(tt=zt.updatedAt)==null?void 0:tt.toDate)==null?void 0:pr.call(tt))||zt.updatedAt||new Date(0);return(((zn=(tr=mt.updatedAt)==null?void 0:tr.toDate)==null?void 0:zn.call(tr))||mt.updatedAt||new Date(0))-jr})[0];f(Bt),await ee(Ae,Bt.id)}catch{}},ee=async(L,U)=>{try{const be=L.filter(Ae=>Ae.id!==U).map(Ae=>fm(Ae.id));await Promise.all(be)}catch{}},W=async()=>{try{const U=(await Cc(n.uid)).filter(be=>be.partyId===e);if(U.length>0){const be=U.map(async Ae=>{try{return await fm(Ae.id),{success:!0,id:Ae.id}}catch(Bt){return{success:!1,id:Ae.id,error:Bt}}});await Promise.all(be),await new Promise(Ae=>setTimeout(Ae,1e3))}}catch{}},te=async L=>{try{const U=await wR(L);x(U)}catch{}},de=["Human","Elf","Dwarf","Halfling","Dragonborn","Tiefling","Half-Elf","Half-Orc","Gnome","Aarakocra","Genasi","Goliath"],Oe=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"],he=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],ue=["Acolyte","Criminal","Folk Hero","Noble","Sage","Soldier"],Q=[15,14,13,12,10,8],Ie={Fighter:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Paladin:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Barbarian:{"Martial Melee Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"]},Bard:{Weapon:["Rapier","Longsword"]},Druid:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Monk:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Sorcerer:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Warlock:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]}},we={Wizard:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Sorcerer:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Warlock:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Eldritch Blast",description:"A beam of crackling energy that deals force damage and can hit multiple targets."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Cleric:[{name:"Guidance",description:"Touch a creature to give them +1d4 to their next ability check."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Resistance",description:"Touch a creature to give them +1d4 to their next saving throw."},{name:"Sacred Flame",description:"Flame-like radiance descends on a creature within 60 feet, dealing radiant damage."},{name:"Spare the Dying",description:"Touch a dying creature to stabilize them at 0 hit points."},{name:"Thaumaturgy",description:"Perform minor magical tricks - make your voice boom, cause tremors, or change eye color."}],Druid:[{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Druidcraft",description:"Predict weather, make a flower bloom, or create a harmless sensory effect."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Primal Savagery",description:"Transform your hand into a claw that deals acid damage to a creature you touch."},{name:"Produce Flame",description:"Create a flickering flame in your hand that you can throw for fire damage."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shillelagh",description:"Transform a club or quarterstaff into a magical weapon that uses your spellcasting ability."},{name:"Thorn Whip",description:"Create a vine-like whip that pulls a creature toward you and deals piercing damage."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."}],Bard:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."},{name:"Vicious Mockery",description:"Insult a creature within 60 feet, dealing psychic damage and possibly giving disadvantage."}]},Be={Wizard:{cantrips:3,spells:6},Sorcerer:{cantrips:4,spells:2},Warlock:{cantrips:2,spells:2},Cleric:{cantrips:3,spells:2},Druid:{cantrips:2,spells:2},Bard:{cantrips:2,spells:4}},B=L=>{const be=[...{Fighter:["Chain mail armor","Light crossbow and 20 bolts","Dungeoneer's pack","5 gp"],Wizard:["Arcane focus","Scholar's pack","Component pouch","5 gp"],Cleric:["Chain mail armor","Light crossbow and 20 bolts","Priest's pack","Shield","Holy symbol","5 gp"],Rogue:["Leather armor","Shortbow and 20 arrows","Burglar's pack","Thieves' tools","5 gp"],Ranger:["Scale mail armor","Longbow and 20 arrows","Explorer's pack","5 gp"],Paladin:["Chain mail armor","Javelins (5)","Priest's pack","Holy symbol","5 gp"],Barbarian:["Javelins (4)","Explorer's pack","5 gp"],Bard:["Leather armor","Diplomat's pack OR entertainer's pack","Lute OR any other musical instrument","5 gp"],Druid:["Leather armor","Druidic focus","Explorer's pack","Shield","5 gp"],Monk:["Dungeoneer's pack OR explorer's pack","5 gp"],Sorcerer:["Component pouch OR arcane focus","Dungeoneer's pack","5 gp"],Warlock:["Component pouch OR arcane focus","Scholar's pack","5 gp"]}[L]||["Adventurer's pack","Simple weapon","5 gp"]];return Le.weapon&&be.push(Le.weapon),Le.shield&&be.push(Le.shield),G.length>0&&be.push(`Spells: ${G.join(", ")}`),be},ut=()=>{const L=[];for(let U=0;U<4;U++)L.push(Math.floor(Math.random()*6)+1);return L.sort((U,be)=>be-U),L.slice(0,3).reduce((U,be)=>U+be,0)},dt=()=>{const L=[];for(let U=0;U<6;U++)L.push(ut());return L.sort((U,be)=>be-U),N(L),D([...L]),T({}),Me(!0),L},_e=(L,U)=>{const be=A.filter(Ae=>Ae!==L);D(be),T(Ae=>({...Ae,[U]:L})),et(U,L)},Tt=L=>{const U=S[L];if(U){D(Ae=>[...Ae,U].sort((Bt,zt)=>zt-Bt));const be={...S};delete be[L],T(be),et(L,10)}},fr=()=>{const L=["strength","dexterity","constitution","intelligence","wisdom","charisma"],U={...j};Q.forEach((be,Ae)=>{U[L[Ae]]=be}),F(U),T({}),D([]),Me(!1)},et=(L,U)=>{F(be=>({...be,[L]:U||""}))},wt=async L=>{L.preventDefault(),i(!0),c("");try{const U={name:j.name,race:j.race,class:j.class,level:j.level,userId:n.uid,partyId:e,weaponChoices:Le,spellChoices:G,abilityScoreMethod:q,rolledScores:_,assignedScores:S,createdAt:new Date,updatedAt:new Date};await W();const be=await iR(n.uid,e,U);F(be),d("Character saved successfully!"),setTimeout(()=>{t(`/campaign/${e}`)},1e3)}catch{c("Failed to save character")}finally{i(!1)}},Ye=async()=>{if(!k.trim()){alert("Please enter a name for your preset");return}if(!j.name||!j.race||!j.class){alert("Please fill in at least the basic character information (name, race, class) before saving as preset");return}try{const L={name:k,data:{...j,weaponChoices:Le,spellChoices:G,abilityScoreMethod:q,rolledScores:_,assignedScores:S}},U=await xR(n.uid,L);w(""),y(!1),await te(n.uid),alert("Character preset saved successfully!")}catch(L){L.message.includes("User profile not found")?alert("User profile not found. Please try logging out and back in."):L.message.includes("permission")?alert("Permission denied. Please check your account status."):alert(`Failed to save preset: ${L.message}`)}},en=L=>{L.key==="Enter"&&k.trim()&&Ye()},hs=L=>{const U=L.data;F({name:(U.name||"")+" (Copy)",race:U.race||"",class:U.class||"",level:U.level||1,background:U.background||"",alignment:U.alignment||"",strength:U.strength||10,dexterity:U.dexterity||10,constitution:U.constitution||10,intelligence:U.intelligence||10,wisdom:U.wisdom||10,charisma:U.charisma||10,age:U.age||"",height:U.height||"",weight:U.weight||"",eyes:U.eyes||"",skin:U.skin||"",hair:U.hair||"",personality:U.personality||"",ideals:U.ideals||"",bonds:U.bonds||"",flaws:U.flaws||"",backstory:U.backstory||"",equipment:[],spells:U.spells||[],proficiencies:U.proficiencies||[],portrait:U.portrait||"/placeholder-character.png"}),U.weaponChoices&&Ne(U.weaponChoices),U.spellChoices&&ie(U.spellChoices),U.abilityScoreMethod&&E(U.abilityScoreMethod),U.rolledScores&&(N(U.rolledScores),T(U.assignedScores||{}),Me(U.rolledScores.length>0)),I(!1)},pt=async L=>{if(confirm("Are you sure you want to delete this preset? This action cannot be undone."))try{await bR(n.uid,L),await te(n.uid),alert("Preset deleted successfully!")}catch{alert("Failed to delete preset. Please try again.")}};if(!n)return null;if(!e)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-300",children:"Loading character creation..."}),o.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"No party ID found"})]})})});try{return o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),o.jsx("p",{className:"text-center text-gray-300 mb-6",children:h?"Edit your character below. When you're ready, click 'Ready Up & Join Campaign' at the bottom!":"Create your character to join the campaign. Once created, you'll be able to ready up and join the adventure!"}),h&&o.jsx("div",{className:"mb-6 flex justify-center",children:o.jsx("button",{type:"button",className:"fantasy-button bg-blue-600 hover:bg-blue-700",onClick:()=>t(`/campaign/${e}`),children:" Back to Campaign"})}),o.jsxs("div",{className:"mb-8 p-4 bg-gray-700 rounded-lg border border-gray-600",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-4",children:"Character Presets"}),o.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[o.jsxs("button",{type:"button",onClick:()=>I(!0),className:"fantasy-button bg-amber-600 hover:bg-amber-700",disabled:g.length===0,children:[" Load Preset (",g.length,")"]}),o.jsx("button",{type:"button",onClick:()=>y(!0),className:"fantasy-button bg-emerald-600 hover:bg-emerald-700",children:" Save as Preset"})]}),g.length>0&&o.jsx("p",{className:"text-sm text-gray-300",children:"Save your current character configuration as a preset to easily recreate it for other parties."})]}),o.jsxs("form",{onSubmit:L=>{wt(L)},className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-name",className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Name"}),o.jsx("input",{id:"character-name",name:"character-name",type:"text",value:j.name,onChange:L=>et("name",L.target.value),className:"fantasy-input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-race",className:"block text-sm font-medium text-gray-200 mb-2",children:"Race"}),o.jsxs("select",{id:"character-race",name:"character-race",value:j.race,onChange:L=>et("race",L.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Race"}),de.map(L=>o.jsx("option",{value:L,children:L},L))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-class",className:"block text-sm font-medium text-gray-200 mb-2",children:"Class"}),o.jsxs("select",{id:"character-class",name:"character-class",value:j.class,onChange:L=>et("class",L.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Class"}),Oe.map(L=>o.jsx("option",{value:L,children:L},L))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-background",className:"block text-sm font-medium text-gray-200 mb-2",children:"Background"}),o.jsxs("select",{id:"character-background",name:"character-background",value:j.background,onChange:L=>et("background",L.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Background"}),ue.map(L=>o.jsx("option",{value:L,children:L},L))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-alignment",className:"block text-sm font-medium text-gray-200 mb-2",children:"Alignment"}),o.jsxs("select",{id:"character-alignment",name:"character-alignment",value:j.alignment,onChange:L=>et("alignment",L.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Alignment"}),he.map(L=>o.jsx("option",{value:L,children:L},L))]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Ability Scores"}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{htmlFor:"ability-method-standard",className:"block text-sm font-medium text-gray-200 mb-2",children:"Ability Score Generation Method"}),o.jsxs("div",{className:"flex space-x-4 mb-4",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{id:"ability-method-standard",type:"radio",name:"abilityMethod",value:"standard",checked:q==="standard",onChange:L=>E(L.target.value),className:"mr-2"}),o.jsx("span",{className:"text-gray-200",children:"Standard Array (15, 14, 13, 12, 10, 8)"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{id:"ability-method-roll",type:"radio",name:"abilityMethod",value:"roll",checked:q==="roll",onChange:L=>E(L.target.value),className:"mr-2"}),o.jsx("span",{className:"text-gray-200",children:"Roll 4d6, Drop Lowest"})]})]}),q==="standard"&&o.jsx("button",{type:"button",onClick:fr,className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Apply Standard Array"}),q==="roll"&&o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{type:"button",onClick:dt,disabled:Ve,className:`fantasy-button ${Ve?"bg-gray-500 cursor-not-allowed":"bg-gray-600 hover:bg-gray-700"}`,children:Ve?"Scores Already Rolled":"Roll Ability Scores"}),Ve&&o.jsx("p",{className:"text-sm text-gray-300",children:"You can only roll once, but you can reassign scores as many times as you like."}),_.length>0&&o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-semibold text-gray-100 mb-2",children:"Rolled Scores"}),o.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:A.map((L,U)=>o.jsx("span",{className:"bg-amber-900 text-amber-200 border border-amber-600 px-3 py-1 rounded-full text-sm font-medium",children:L},`${L}-${U}`))}),o.jsx("p",{className:"text-sm text-gray-300",children:"Click on an ability score below to assign your rolled scores. You can reassign them as many times as you want."})]})]})]}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:["strength","dexterity","constitution","intelligence","wisdom","charisma"].map(L=>{const U=S[L],be=j[L]||10;return o.jsxs("div",{className:"border border-gray-600 rounded-lg p-4",children:[o.jsx("label",{htmlFor:`ability-${L}`,className:"block text-sm font-medium text-gray-200 mb-2 capitalize",children:L}),U?o.jsxs("div",{className:"space-y-2",children:[o.jsx("div",{className:"text-lg font-bold text-amber-400",children:U}),o.jsx("button",{type:"button",onClick:()=>Tt(L),className:"text-xs text-red-400 hover:text-red-300",children:"Unassign"})]}):o.jsxs("div",{className:"space-y-2",children:[o.jsx("input",{id:`ability-${L}`,name:`ability-${L}`,type:"number",min:"1",max:"20",value:be,onChange:Ae=>et(L,parseInt(Ae.target.value)),className:"fantasy-input",required:!0}),A.length>0&&o.jsx("div",{className:"flex flex-wrap gap-1",children:A.map((Ae,Bt)=>o.jsx("button",{type:"button",onClick:()=>_e(Ae,L),className:"bg-amber-900 hover:bg-amber-800 border border-amber-600 text-amber-200 px-2 py-1 rounded text-xs font-medium",children:Ae},`${Ae}-${Bt}`))})]}),o.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Modifier: ",Math.floor((be-10)/2)]})]},L)})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Physical Description"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-age",className:"block text-sm font-medium text-gray-200 mb-2",children:"Age"}),o.jsx("input",{id:"character-age",name:"character-age",type:"text",placeholder:"Age",value:j.age,onChange:L=>et("age",L.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-height",className:"block text-sm font-medium text-gray-200 mb-2",children:"Height"}),o.jsx("input",{id:"character-height",name:"character-height",type:"text",placeholder:"Height",value:j.height,onChange:L=>et("height",L.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-weight",className:"block text-sm font-medium text-gray-200 mb-2",children:"Weight"}),o.jsx("input",{id:"character-weight",name:"character-weight",type:"text",placeholder:"Weight",value:j.weight,onChange:L=>et("weight",L.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-eyes",className:"block text-sm font-medium text-gray-200 mb-2",children:"Eye Color"}),o.jsx("input",{id:"character-eyes",name:"character-eyes",type:"text",placeholder:"Eye Color",value:j.eyes,onChange:L=>et("eyes",L.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-skin",className:"block text-sm font-medium text-gray-200 mb-2",children:"Skin Color"}),o.jsx("input",{id:"character-skin",name:"character-skin",type:"text",placeholder:"Skin Color",value:j.skin,onChange:L=>et("skin",L.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-hair",className:"block text-sm font-medium text-gray-200 mb-2",children:"Hair Color"}),o.jsx("input",{id:"character-hair",name:"character-hair",type:"text",placeholder:"Hair Color",value:j.hair,onChange:L=>et("hair",L.target.value),className:"fantasy-input"})]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Personality"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-personality",className:"block text-sm font-medium text-gray-200 mb-2",children:"Personality Traits"}),o.jsx("textarea",{id:"character-personality",name:"character-personality",value:j.personality,onChange:L=>et("personality",L.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your character's personality..."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-ideals",className:"block text-sm font-medium text-gray-200 mb-2",children:"Ideals"}),o.jsx("textarea",{id:"character-ideals",name:"character-ideals",value:j.ideals,onChange:L=>et("ideals",L.target.value),className:"fantasy-input",rows:"3",placeholder:"What does your character believe in?"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-bonds",className:"block text-sm font-medium text-gray-200 mb-2",children:"Bonds"}),o.jsx("textarea",{id:"character-bonds",name:"character-bonds",value:j.bonds,onChange:L=>et("bonds",L.target.value),className:"fantasy-input",rows:"3",placeholder:"What connections does your character have?"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-flaws",className:"block text-sm font-medium text-gray-200 mb-2",children:"Flaws"}),o.jsx("textarea",{id:"character-flaws",name:"character-flaws",value:j.flaws,onChange:L=>et("flaws",L.target.value),className:"fantasy-input",rows:"3",placeholder:"What are your character's weaknesses?"})]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Backstory"}),o.jsx("textarea",{id:"character-backstory",name:"character-backstory",value:j.backstory,onChange:L=>et("backstory",L.target.value),className:"fantasy-input",rows:"6",placeholder:"Tell the story of your character's life before the adventure..."})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Starting Equipment"}),j.class&&Ie[j.class]&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Weapons"}),o.jsx("div",{className:"space-y-4",children:Object.entries(Ie[j.class]).map(([L,U])=>o.jsxs("div",{children:[o.jsx("label",{htmlFor:`weapon-${L.toLowerCase().replace(/\s+/g,"")}`,className:"block text-sm font-medium text-gray-200 mb-2",children:L}),o.jsxs("select",{id:`weapon-${L.toLowerCase().replace(/\s+/g,"")}`,name:`weapon-${L.toLowerCase().replace(/\s+/g,"")}`,value:Le[L.toLowerCase().replace(/\s+/g,"")]||"",onChange:be=>Ne(Ae=>({...Ae,[L.toLowerCase().replace(/\s+/g,"")]:be.target.value})),className:"fantasy-input",children:[o.jsxs("option",{value:"",children:["Select ",L]}),U.map(be=>o.jsx("option",{value:be,children:be},be))]})]},L))})]}),j.class&&we[j.class]&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Cantrips"}),o.jsxs("p",{className:"text-sm text-gray-300 mb-3",children:["Select your starting cantrips (0-level spells). You can choose up to ",((tn=Be[j.class])==null?void 0:tn.cantrips)||0," cantrips."]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto border border-gray-600 rounded-lg p-4",children:we[j.class].map(L=>{var Ae;const U=G.includes(L.name),be=!U&&G.length>=(((Ae=Be[j.class])==null?void 0:Ae.cantrips)||0);return o.jsx("div",{className:`border rounded-lg p-3 ${U?"border-amber-500 bg-amber-900/20":"border-gray-600"} ${be?"opacity-50":"hover:border-gray-500"}`,children:o.jsxs("label",{className:`flex items-start space-x-3 cursor-pointer ${be?"cursor-not-allowed":""}`,children:[o.jsx("input",{id:`spell-${L.name.toLowerCase().replace(/\s+/g,"-")}`,name:`spell-${L.name.toLowerCase().replace(/\s+/g,"-")}`,type:"checkbox",checked:U,disabled:be,onChange:Bt=>{Bt.target.checked?ie(zt=>[...zt,L.name]):ie(zt=>zt.filter(mt=>mt!==L.name))},className:"rounded mt-1"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-medium text-gray-100",children:L.name}),o.jsx("div",{className:"text-sm text-gray-300 mt-1",children:L.description})]})]})},L.name)})}),o.jsxs("div",{className:"flex justify-between items-center mt-3",children:[o.jsxs("p",{className:"text-sm text-gray-400",children:["Selected: ",G.length," / ",((ht=Be[j.class])==null?void 0:ht.cantrips)||0," cantrips"]}),G.length>=(((Lt=Be[j.class])==null?void 0:Lt.cantrips)||0)&&o.jsx("p",{className:"text-sm text-green-400 font-medium",children:" Cantrip selection complete"})]})]}),j.class?o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsxs("h3",{className:"font-semibold text-gray-100 mb-3",children:[j.class," Starting Equipment"]}),o.jsx("ul",{className:"space-y-1",children:B(j.class).map((L,U)=>o.jsxs("li",{className:"text-gray-200 flex items-start",children:[o.jsx("span",{className:"text-gray-400 mr-2",children:""}),L]},U))}),o.jsx("p",{className:"text-sm text-gray-300 mt-3",children:"This equipment will be automatically assigned to your character."})]}):o.jsx("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:o.jsx("p",{className:"text-gray-300",children:"Select a class to see your starting equipment."})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Character Portrait"}),o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("div",{className:"w-32 h-32 bg-gray-600 rounded-lg flex items-center justify-center",children:o.jsx("span",{className:"text-gray-400",children:"Portrait Placeholder"})}),o.jsx("button",{type:"button",className:"fantasy-button",onClick:()=>{},children:"Upload Image"})]})]}),o.jsx("div",{className:"flex justify-center",children:h?o.jsx("button",{type:"submit",className:"fantasy-button bg-blue-600 hover:bg-blue-700",disabled:s,children:s?"Updating Character...":"Update Character"}):o.jsx("button",{type:"submit",className:"fantasy-button",disabled:s,children:s?"Saving Character...":"Save Character"})})]}),C&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"fantasy-card max-w-md w-full mx-4",children:[o.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Save Character Preset"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"preset-name",className:"block text-sm font-medium text-gray-200 mb-2",children:"Preset Name"}),o.jsx("input",{id:"preset-name",name:"preset-name",type:"text",value:k,onChange:L=>w(L.target.value),onKeyPress:en,className:"fantasy-input",placeholder:"Enter a name for your preset",autoFocus:!0})]}),o.jsxs("div",{className:"flex space-x-3",children:[o.jsx("button",{type:"button",onClick:()=>{y(!1),w("")},className:"fantasy-button bg-gray-600 hover:bg-gray-700 flex-1",children:"Cancel"}),o.jsx("button",{type:"button",onClick:Ye,className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 flex-1",children:"Save Preset"})]})]})]})}),b&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"fantasy-card max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Load Character Preset"}),g.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-gray-300 mb-4",children:"No character presets found."}),o.jsx("p",{className:"text-sm text-gray-400",children:"Create a character and save it as a preset to see it here."}),o.jsx("button",{type:"button",onClick:()=>I(!1),className:"fantasy-button mt-4",children:"Close"})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"grid gap-4",children:g.map(L=>o.jsxs("div",{className:"border border-gray-600 rounded-lg p-4 hover:border-gray-500",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-100",children:L.name}),o.jsxs("p",{className:"text-sm text-gray-300",children:[L.data.race," ",L.data.class,"  Level ",L.data.level]}),L.data.background&&o.jsx("p",{className:"text-sm text-gray-400",children:L.data.background}),L.createdAt&&o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Created: ",new Date(L.createdAt.toDate()).toLocaleDateString()]})]}),o.jsx("button",{type:"button",onClick:()=>pt(L.id),className:"text-red-400 hover:text-red-300 text-sm",title:"Delete preset",children:""})]}),o.jsx("div",{className:"flex space-x-2",children:o.jsx("button",{type:"button",onClick:()=>hs(L),className:"fantasy-button bg-amber-600 hover:bg-amber-700 flex-1",children:"Load Preset"})})]},L.id))}),o.jsx("div",{className:"flex justify-center",children:o.jsx("button",{type:"button",onClick:()=>I(!1),className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Cancel"})})]})]})})]})})}catch(L){return console.error("Error rendering CharacterCreation:",L),o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-red-400 text-sm",children:"An error occurred while rendering the component."}),o.jsx("p",{className:"text-gray-300",children:"Please try again later."})]})})})}}const $i={INVESTIGATION:"investigation",COMBAT:"combat",PERSUASION:"persuasion",EXPLORATION:"exploration",SOCIAL:"social"},Br={HIDDEN:"hidden",DISCOVERED:"discovered",IN_PROGRESS:"in_progress",COMPLETED:"completed",FAILED:"failed"},WR=t=>{const e=[{id:"investigate_area",type:$i.INVESTIGATION,title:"Investigate the Area",description:"Search for clues and gather information about the situation",keywords:["search","investigate","examine","look around","check","explore"],state:Br.HIDDEN,discoveredAt:null,completedAt:null},{id:"resolve_conflict",type:$i.COMBAT,title:"Resolve the Conflict",description:"Engage in combat to overcome the threat",keywords:["fight","attack","defend","combat","battle"],state:Br.HIDDEN,discoveredAt:null,completedAt:null},{id:"negotiate_peace",type:$i.PERSUASION,title:"Negotiate Peace",description:"Use diplomacy and persuasion to resolve the situation peacefully",keywords:["talk","negotiate","persuade","convince","diplomacy","peace"],state:Br.HIDDEN,discoveredAt:null,completedAt:null}],n=[];return(t.toLowerCase().includes("thief")||t.toLowerCase().includes("stealth"))&&n.push({id:"stealth_approach",type:$i.EXPLORATION,title:"Stealth Approach",description:"Use stealth to avoid detection and gather information",keywords:["sneak","stealth","hide","silent","unnoticed"],state:Br.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("merchant")||t.toLowerCase().includes("trade"))&&n.push({id:"establish_trade",type:$i.SOCIAL,title:"Establish Trade Relations",description:"Build economic relationships with the locals",keywords:["trade","bargain","deal","commerce","business"],state:Br.HIDDEN,discoveredAt:null,completedAt:null}),(t.toLowerCase().includes("scholar")||t.toLowerCase().includes("knowledge"))&&n.push({id:"gather_knowledge",type:$i.INVESTIGATION,title:"Gather Ancient Knowledge",description:"Discover and preserve valuable information",keywords:["research","study","learn","knowledge","ancient","lore"],state:Br.HIDDEN,discoveredAt:null,completedAt:null}),[...e,...n]},T0=t=>t.filter(e=>e.state===Br.DISCOVERED||e.state===Br.IN_PROGRESS||e.state===Br.COMPLETED);function qR(){var R,ne,xe,Te,me,fe,ge,De,$e,Mr,nn,gr,ri,ji,nr,$a,Di;const{user:t,loading:e}=CR(),{partyId:n}=ff(),r=er(),[s,i]=P.useState(null),[a,c]=P.useState(null),[u,d]=P.useState([]),[h,f]=P.useState([]),[g,x]=P.useState(!0),[C,y]=P.useState(""),[k,w]=P.useState(""),[b,I]=P.useState("storytelling"),[j,F]=P.useState([]),[q,E]=P.useState(null),[_,N]=P.useState(!1),[A,D]=P.useState(null),[S,T]=P.useState(!1),[Ve,Me]=P.useState(null),[Le,Ne]=P.useState(null),[G,ie]=P.useState(!1),[ve,ee]=P.useState(!1),[W,te]=P.useState(!1),[de,Oe]=P.useState(!1),[he,ue]=P.useState("inactive"),[Q,Ie]=P.useState(null),[we,Be]=P.useState(null),[B,ut]=P.useState(null),[dt,_e]=P.useState(!1),[Tt,fr]=P.useState([]),[et,wt]=P.useState(!1),[Ye,en]=P.useState(!1),hs=new pp,pt=new gp,tn=()=>{var M;return((M=s==null?void 0:s.readyPlayers)==null?void 0:M.length)||0},ht=()=>u.length,Lt=()=>h.sort((M,V)=>M.name.localeCompare(V.name)),L=M=>M?M.replace(/\*\*(.*?)\*\*/g,'<strong class="text-yellow-400 font-bold">$1</strong>').replace(/\*(.*?)\*/g,'<em class="text-blue-400 italic">$1</em>').replace(/`(.*?)`/g,'<code class="bg-slate-700 px-2 py-1 rounded text-slate-200 font-mono text-sm">$1</code>').replace(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*):/g,'<span class="text-green-400 font-semibold">$1:</span>').replace(/\b(weapon|sword|shield|armor|magic|spell|dragon|monster|treasure|gold|silver|quest|adventure|hero|villain)\b/gi,'<span class="text-orange-400 font-medium">$1</span>').replace(/\b([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\b/g,V=>V.includes("<")||["The","A","An","And","Or","But","In","On","At","To","For","Of","With","By"].includes(V)?V:`<span class="text-purple-400 font-medium">${V}</span>`).replace(/\n/g,"<br>"):"";P.useEffect(()=>{!t&&!e&&r("/login")},[t,e,r]),P.useEffect(()=>{n&&t&&!e&&U()},[n,t,e]),P.useEffect(()=>{if(s!=null&&s.id){console.log(" Setting up real-time subscription for story:",s.id);const M=gR(s.id,V=>{var se,J,Y,ye,z,oe,Pe,ae,X,Se,st,Ge;if(V){console.log(" Story update received:",V),i(V);const Ht=V.currentContent||"",bt=V.storyMetadata||{},fn=bt.phaseStatus||(Ht.toLowerCase().includes("phase_status:")?(J=(se=Ht.toLowerCase().split("phase_status:")[1])==null?void 0:se.split(`
`)[0])==null?void 0:J.trim():null)||(Ht.toLowerCase().includes("conflict")?"conflict":null),Lr=["attack","battle","combat","fight","enemy","enemies","monster","creature","ghoul","bandit","goblin","troll"].some(Vt=>Ht.toLowerCase().includes(Vt));if(console.log(" Phase detection debug:",{storyMetadataPhase:bt.phaseStatus,contentPhase:Ht.toLowerCase().includes("phase_status:")?(ye=(Y=Ht.toLowerCase().split("phase_status:")[1])==null?void 0:Y.split(`
`)[0])==null?void 0:ye.trim():"not found",conflictKeywords:Ht.toLowerCase().includes("conflict"),combatKeywords:Lr,finalPhaseStatus:fn}),V.storyMetadata&&String(V.storyMetadata.phaseStatus).toLowerCase()==="conflict"&&!et&&!Ye){en(!0);const Vt=(a==null?void 0:a.members)||[];if(((z=V.readyPlayers)==null?void 0:z.length)===Vt.length&&Vt.length>0){const Hn=h.length===Vt.length;if(console.log("Combat session creation check:",{readyPlayers:(oe=V.readyPlayers)==null?void 0:oe.length,totalMembers:Vt.length,partyCharactersLoaded:h.length,allCharactersLoaded:Hn,partyCharacters:h.map(Je=>({id:Je.id,name:Je.name,userId:Je.userId}))}),!Hn){console.log("Waiting for character data to load...");return}const si=(h.length>0?h:u).map((Je,ii)=>typeof Je=="string"?{id:`member_${ii}`,name:`Player ${ii+1}`,userId:Je,race:"Unknown",class:"Unknown",level:1,initiative:Math.floor(Math.random()*20)+1,hp:10,maxHp:10,ac:10}:{id:Je.id||`member_${ii}`,name:Je.name||`Unknown Member ${ii}`,userId:Je.userId||null,race:Je.race||"Unknown",class:Je.class||"Unknown",level:Je.level||1,initiative:Je.initiative||Math.floor(Math.random()*20)+1,hp:Je.hp||Je.maxHp||10,maxHp:Je.maxHp||Je.hp||10,ac:Je.ac||10,...Object.fromEntries(Object.entries(Je).filter(([jn,wr])=>wr!=null&&jn!=="id"&&jn!=="name"&&jn!=="userId"&&jn!=="race"&&jn!=="class"&&jn!=="level"&&jn!=="initiative"&&jn!=="hp"&&jn!=="maxHp"&&jn!=="ac"))});if(si.length!==Vt.length){console.warn("Party member count mismatch:",si.length,"vs",Vt.length);return}let qn=[];if((Pe=V.storyMetadata)!=null&&Pe.enemyDetails&&V.storyMetadata.enemyDetails.length>0&&(qn=ms(V.storyMetadata.enemyDetails)),qn.length===0&&V.currentContent){const Je=zn(V.currentContent);Je.enemyDetails&&Je.enemyDetails.length>0&&(qn=ms(Je.enemyDetails))}qn.length===0&&(qn=[{id:"enemy_0",name:"Dire Wolf",hp:15,maxHp:15,ac:14,level:1,class:"beast",race:"wolf",initiative:Math.floor(Math.random()*20)+1,strength:16,dexterity:14,constitution:13,intelligence:3,wisdom:12,charisma:6,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,basicAttack:"Bite (1d6 + 3 piercing damage)",specialAbility:"Pack Tactics (The wolf has advantage on attack rolls against a creature if at least one of the wolf's allies is within 5 feet of the creature and the ally isn't incapacitated.)"}]);const td={partyId:n,partyMembers:si,enemies:qn,storyContext:V.currentContent||"Combat encounter",combatState:"initialized",currentTurn:0,round:1,initiative:[],environmentalFeatures:((ae=V.storyMetadata)==null?void 0:ae.environmentalFeatures)||[],teamUpOpportunities:((X=V.storyMetadata)==null?void 0:X.teamUpOpportunities)||[],narrativeElements:((Se=V.storyMetadata)==null?void 0:Se.narrativeElements)||[]};qd(n,td).then(Je=>{en(!1),wt(!0),r(`/combat/${Je.id}`)}).catch(Je=>{console.error("Failed to create combat session:",Je),en(!1),wt(!1)}),setTimeout(()=>{Ye&&(en(!1),wt(!1))},5e3)}}else V.storyMetadata&&String(V.storyMetadata.phaseStatus).toLowerCase()!=="conflict"&&(wt(!1),en(!1));(st=V.readyPlayers)!=null&&st.includes(t==null?void 0:t.uid)&&ie(!0);const vr=(a==null?void 0:a.members)||[];((Ge=V.readyPlayers)==null?void 0:Ge.length)===vr.length&&vr.length>0?ee(!0):ee(!1)}});return Ne(()=>M),()=>M()}},[s==null?void 0:s.id,t==null?void 0:t.uid,a==null?void 0:a.members,h,he,r,et]),P.useEffect(()=>{if(we){console.log(" Setting up real-time subscription for combat session:",we);const M=h_(we,V=>{if(V){if(console.log(" Combat session update received from database:",V),console.log(" Current local combat session state:",Q),console.log(" Combat session state:",V.combatState),console.log(" Combat session ID:",V.id),Q){const J=Q.combatants.filter(oe=>oe.id.startsWith("enemy_")),Y=V.enemies||[];console.log(" Comparing local vs database enemy HP:");let ye=!1,z=!1;if(J.forEach(oe=>{const Pe=Y.find(ae=>ae.id===oe.id);Pe&&oe.hp!==Pe.hp&&(console.log(` HP mismatch for ${oe.name}: Local=${oe.hp}, DB=${Pe.hp}`),oe.hp<Pe.hp&&(ye=!0,console.log(` Preserving local damage for ${oe.name}`)))}),Q.currentTurn!==V.currentTurn&&(console.log(` Turn mismatch: Local=${Q.currentTurn}, DB=${V.currentTurn}`),z=!0),ye||z){console.log(" Skipping database update to preserve local changes");return}}const se={combatants:[...V.partyMembers,...V.enemies],currentTurn:V.currentTurn,round:V.round,combatState:V.combatState,storyContext:V.storyContext,environmentalFeatures:V.environmentalFeatures,teamUpOpportunities:V.teamUpOpportunities,narrativeElements:V.narrativeElements};console.log(" Reconstructed session from database:",se),console.log(" Reconstructed session combatants:",se.combatants.map(J=>`${J.name}: ${J.hp}/${J.maxHp}`)),Ie(se),ut(se.combatants[V.currentTurn]),ue(V.combatState)}else console.log(" Combat session ended or not found"),console.log(" Clearing combat state..."),Ie(null),Be(null),ue("inactive"),ut(null)});return()=>M()}},[we]),P.useEffect(()=>{B&&Q&&(console.log(" Turn changed to:",B.name,"at index:",Q.currentTurn),console.log(" Full turn order:",Q.combatants.map((M,V)=>`${V}: ${M.name} (${M.initiative})`)))},[B,Q]),P.useEffect(()=>{if(he==="active"&&B&&B.id.startsWith("enemy_")&&!dt){console.log(" Auto-processing enemy turn for:",B.name),console.log(" Current turn order:",Q==null?void 0:Q.combatants.map((V,se)=>`${se}: ${V.name} (${V.initiative})`)),console.log(" Current turn index:",Q==null?void 0:Q.currentTurn);const M=setTimeout(async()=>{var V;try{_e(!0);const se=pt.getAvailableActions(B);console.log(" Available actions for enemy:",se);const J=pt.getValidTargets(B,"attack",Q);console.log(" Valid targets for enemy:",J.map(z=>z.name));const Y=pt.makeEnemyDecision(B,se,J,Q);console.log(" Enemy decision:",Y);const ye=await pt.executeAction(Q,B.id,Y.action,Y.targetId);if(ye.success){console.log(" Enemy action result:",ye),console.log(" Action details:",{enemy:B.name,action:Y.action,target:Y.targetId,specialAttack:Y.specialAttack,damageType:Y.damageType});const z=ye.combatSession;if(ye.results&&ye.results.damage>0){const ae=z.combatants.find(X=>X.id===Y.targetId);if(ae){const X=ae.hp;ae.hp=Math.max(0,ae.hp-ye.results.damage),console.log(` Enemy applied ${ye.results.damage} damage to ${ae.name}. HP: ${X}  ${ae.hp}`),Ot({type:"damage",attacker:B.name,target:ae.name,damage:ye.results.damage,targetHp:ae.hp,action:Y.action,message:`${B.name} deals ${ye.results.damage} damage to ${ae.name} (${ae.hp} HP remaining)`})}}else if(ye.results&&ye.results.healing>0){const ae=z.combatants.find(X=>X.id===Y.targetId);ae&&Ot({type:"healing",healer:B.name,target:ae.name,healing:ye.results.healing,action:Y.action,message:`${B.name} heals ${ae.name} for ${ye.results.healing} HP`})}else Ot({type:"action",actor:B.name,action:Y.action,target:((V=z.combatants.find(ae=>ae.id===Y.targetId))==null?void 0:V.name)||"None",message:`${B.name} uses ${Y.action}`});console.log(" Updated combat session:",z),console.log(" Combatants after enemy action:",z.combatants.map(ae=>`${ae.name}: ${ae.hp}/${ae.maxHp}`)),Ie(z),console.log(" Combat session state updated in UI:",{combatants:z.combatants.map(ae=>({name:ae.name,hp:ae.hp,maxHp:ae.maxHp,isEnemy:ae.id.startsWith("enemy_")}))}),we?(console.log(" Updating combat session in database:",{combatSessionId:we,currentTurn:z.currentTurn,round:z.round,partyMembers:z.combatants.filter(ae=>!ae.id.startsWith("enemy_")).map(ae=>({name:ae.name,hp:ae.hp})),enemies:z.combatants.filter(ae=>ae.id.startsWith("enemy_")).map(ae=>({name:ae.name,hp:ae.hp}))}),setTimeout(async()=>{try{await ws(we,{currentTurn:z.currentTurn,round:z.round,combatState:z.combatState,partyMembers:z.combatants.filter(ae=>!ae.id.startsWith("enemy_")),enemies:z.combatants.filter(ae=>ae.id.startsWith("enemy_"))}),console.log(" Combat session updated in database successfully")}catch(ae){console.error(" Error updating combat session in database:",ae)}},100)):console.log(" No combatSessionId available for database update");const oe=z.combatants[z.currentTurn];ut(oe);const Pe=pt.checkCombatEnd(z);if(Pe.isComplete){console.log(" Combat ended:",Pe),ue("complete"),Ot({type:"combat_end",result:Pe.result,message:Pe.result==="victory"?" Victory! All enemies have been defeated!":Pe.result==="defeat"?" Defeat! The party has been overwhelmed!":" Combat ends in a draw."}),setTimeout(()=>{fr([])},5e3);const ae=pt.generateCombatSummary(z,Pe),X=pt.generateCombatNarrative(z,Pe);await gn(s.id,{currentContent:X,storyMetadata:{...s.storyMetadata,phaseStatus:"Storytelling",combatResult:Pe}})}else z.combatants.filter(X=>X.id.startsWith("enemy_")&&X.hp<=0&&X.maxHp>0).forEach(X=>{X.maxHp=0,Ot({type:"enemy_death",enemy:X.name,message:` ${X.name} has been defeated!`})})}_e(!1)}catch(se){console.error(" Error processing enemy turn:",se),_e(!1)}},2e3);return()=>clearTimeout(M)}},[B,he,Q,s==null?void 0:s.id,s==null?void 0:s.storyMetadata,pt,dt,we]),P.useEffect(()=>{if(n){console.log(" Setting up real-time subscription for characters:",n);const M=hR(n,async V=>{if(V){console.log(" Party update received:",V),c(V),d(V.members||[]);try{const se=await nl(n);console.log(" Characters reloaded:",se),console.log(" Character count:",se.length),console.log(" Character details:",se.map(J=>({id:J.id,name:J.name,userId:J.userId,partyId:J.partyId}))),f(se)}catch(se){console.error(" Error reloading characters:",se)}}});return()=>M()}},[n]),P.useEffect(()=>()=>{Le&&Le()},[Le]);const U=P.useCallback(async()=>{if(n)try{console.log(" Starting loadStoryAndCharacters..."),x(!0);const M=await dR(n);console.log(" Party data loaded:",M),c(M);const V=(M==null?void 0:M.members)||[];d(V);let se=await fR(n);console.log(" Story data loaded:",se),se||(console.log(" Creating new campaign story..."),se=await mR(n),console.log(" New story created:",se)),i(se);const J=await nl(n);console.log(" Characters loaded:",J),console.log(" Character count:",J.length),console.log(" Character details:",J.map(ye=>({id:ye.id,name:ye.name,userId:ye.userId,partyId:ye.partyId}))),f(J);const Y=WR((M==null?void 0:M.description)||"adventure");F(Y),console.log(" loadStoryAndCharacters completed successfully")}catch(M){console.error(" Error loading story and characters:",M),y("Failed to load campaign data")}finally{x(!1)}},[n]),be=P.useCallback(async()=>{if(!(!t||!s))try{console.log(" User readying up..."),x(!0),await pR(s.id,t.uid),console.log(" Player ready status set")}catch(M){console.error(" Error readying up:",M),y("Failed to ready up")}finally{x(!1)}},[t,s]),Ae=P.useCallback(async()=>{if(!(!t||!s))try{console.log(" Starting story generation..."),x(!0),te(!0),await gn(s.id,{status:"generating"}),console.log(" Status set to generating");try{const M=await nc.generateStoryPlots(h,(a==null?void 0:a.description)||"An epic adventure awaits!",j);console.log(" Generated plots response:",M);const V=tr(M);console.log(" Parsed plots array:",V),await gn(s.id,{status:"voting",availablePlots:V}),console.log(" Moved to voting phase")}catch(M){console.warn("AI service unavailable, using fallback plots:",M);const V=[{title:"The Lost Artifact",description:"A powerful artifact has been stolen and the party must track it down through dangerous territory.",summary:"An ancient artifact of great power has been stolen from the local temple. The party must follow the trail of the thieves through dangerous wilderness and hostile territory.",campaignLength:"medium"},{title:"The Dark Forest",description:"A mysterious forest has appeared overnight, and strange creatures are emerging from its depths.",summary:"A dark forest has mysteriously appeared on the outskirts of town. Strange creatures and magical phenomena are emerging, and the party must investigate the source.",campaignLength:"short"},{title:"The Dragon's Lair",description:"A dragon has been terrorizing the countryside, and the party must find a way to stop it.",summary:"A fearsome dragon has been attacking villages and stealing livestock. The party must find the dragon's lair and either defeat it or negotiate a peaceful solution.",campaignLength:"long"}];await gn(s.id,{status:"voting",availablePlots:V}),console.log(" Moved to voting phase with fallback plots"),y("AI service temporarily unavailable. Using predefined plot options.")}}catch(M){console.error(" Error starting story:",M),y("Failed to start story generation"),await gn(s.id,{status:"ready_up"})}finally{x(!1),te(!1)}},[t,s,h,a==null?void 0:a.description,j]),Bt=P.useCallback(async M=>{var V;try{console.log(" Selecting plot:",M),x(!0);const se=((V=s==null?void 0:s.availablePlots)==null?void 0:V.filter(Y=>Y.title&&!Y.title.startsWith("Plot ")))||[],J=se[M];if(console.log(" Available plots:",s==null?void 0:s.availablePlots),console.log(" Valid plots:",se),console.log(" Selected plot:",J),!J){console.error(" Selected plot not found"),y("Selected plot not found");return}await gn(s.id,{status:"generating_story",selectedPlot:M,selectedPlotData:J,currentContent:`Generating story content for: ${J.title}...`}),console.log(" Status set to generating_story");try{const Y=await nc.generateStoryIntroduction(h,J.description,J.title,a);console.log(" Generated story content:",Y),await gn(s.id,{status:"storytelling",currentContent:Y||`The adventure begins with ${J.title}!`,currentSpeaker:{userId:a.dmId,name:"Dungeon Master",id:"dm",race:"DM",class:"Dungeon Master"}}),console.log(" Plot selected and story generated successfully")}catch(Y){console.warn("AI service unavailable, using fallback story:",Y);const ye=`The adventure begins with ${J.title}!

${J.summary}

The party finds themselves at the beginning of this epic journey. The path ahead is uncertain, but the promise of adventure and glory awaits those brave enough to take the first step.

What would you like to do?`;await gn(s.id,{status:"storytelling",currentContent:ye,currentSpeaker:{userId:a.dmId,name:"Dungeon Master",id:"dm",race:"DM",class:"Dungeon Master"}}),console.log(" Plot selected with fallback story content"),y("AI service temporarily unavailable. Using simplified story introduction.")}}catch(se){console.error(" Error selecting plot:",se),y("Failed to select plot"),await gn(s.id,{status:"voting"})}finally{x(!1)}},[s,h,a]),zt=P.useCallback(async()=>{var M,V;if(k.trim())try{x(!0),y("");const se=h.find(J=>J.userId===(t==null?void 0:t.uid));if(!se){y("You need a character to participate in the story");return}try{const J=await hs.validatePlayerAction(k,se,{storyState:s,currentContent:(s==null?void 0:s.currentContent)||"",party:a});E(J),J.diceResult&&(N(!0),D(J))}catch(J){console.warn("Action validation unavailable:",J)}try{const J=await nc.generateStructuredStoryResponse(h,(s==null?void 0:s.storyMessages)||[],k,b,T0(j),null,a),Y=zn(J),ye={speaker:((M=s==null?void 0:s.currentSpeaker)==null?void 0:M.name)||se.name,content:k,timestamp:new Date};await gn(s.id,{currentContent:Y.storyContent||`${(s==null?void 0:s.currentContent)||""}

${se.name}: "${k}"`,currentSpeaker:null,storyMessages:[...(s==null?void 0:s.storyMessages)||[],ye],storyMetadata:{currentLocation:Y.currentLocation,activeNPCs:Y.activeNPCs,plotDevelopments:Y.plotDevelopments,characterReactions:Y.characterReactions,nextActions:Y.nextActions,storyTone:Y.storyTone,phaseStatus:Y.phaseStatus,enemyDetails:Y.enemyDetails||[]}})}catch(J){console.warn("AI service unavailable, continuing story manually:",J);const Y={speaker:((V=s==null?void 0:s.currentSpeaker)==null?void 0:V.name)||se.name,content:k,timestamp:new Date};await gn(s.id,{currentContent:`${(s==null?void 0:s.currentContent)||""}

${se.name}: "${k}"`,currentSpeaker:null,storyMessages:[...(s==null?void 0:s.storyMessages)||[],Y]}),y("AI service temporarily unavailable. Story continued manually.")}w(""),E(null),await U()}catch(se){console.error("Error sending response:",se),y("Failed to send response")}finally{x(!1)}},[k,h,t==null?void 0:t.uid,s,a,b,j,U]),mt=P.useCallback(()=>{N(!1),D(null)},[]),jr=P.useCallback(()=>{T(!1),Me(null)},[]),Dr=P.useCallback(async()=>{N(!1)},[]),tt=P.useCallback(()=>{N(!1),D(null)},[]),pr=P.useCallback(async M=>{try{console.log(" Setting speaker:",M),console.log(" Character data:",JSON.stringify(M)),console.log(" Story ID:",s==null?void 0:s.id),x(!0),M?await yR(s.id,M):await gn(s.id,{currentSpeaker:null}),console.log(" Speaker set")}catch(V){console.error(" Error setting speaker:",V),y("Failed to set speaker")}finally{x(!1)}},[s==null?void 0:s.id]);P.useCallback(async()=>{try{console.log(" Continuing story..."),x(!0);const M=await nc.generateStoryContinuation(h,(s==null?void 0:s.storyMessages)||[],"The story continues...",b,T0(j),null,a);await gn(s.id,{currentContent:M||"The story continues...",currentSpeaker:null}),console.log(" Story continued")}catch(M){console.error(" Error continuing story:",M),y("Failed to continue story")}finally{x(!1)}},[h,s,b,j,a]);const tr=M=>{try{console.log(" Parsing plots from response...");const V=M.split(/\*\*Plot Option \d+:\*\*/).filter(J=>J.trim());console.log(" Found plot sections:",V.length);const se=V.map((J,Y)=>{const ye=J.trim().split(`
`).filter(X=>X.trim());let z=`Plot ${Y+1}`,oe="",Pe="",ae="";for(let X=0;X<ye.length;X++){const Se=ye[X].trim();if(Se.startsWith("1. Title:")){const st=Se.match(/1\.\s*Title:\s*"([^"]+)"/);st&&(z=st[1])}if(Se.startsWith("2. Summary:")){let st=Se.replace("2. Summary:","").trim(),Ge=X+1;for(;Ge<ye.length&&!ye[Ge].trim().startsWith("3.");)st+=" "+ye[Ge].trim(),Ge++;Pe=st.trim(),X=Ge-1}if(Se.startsWith("3. Main Conflict:")){let st=Se.replace("3. Main Conflict:","").trim(),Ge=X+1;for(;Ge<ye.length&&!ye[Ge].trim().startsWith("4.");)st+=" "+ye[Ge].trim(),Ge++;oe=st.trim(),X=Ge-1}if(Se.startsWith("5. Estimated Campaign Length:")){const st=Se.match(/5\.\s*Estimated Campaign Length:\s*(short|medium|long)/i);st&&(ae=st[1].toLowerCase())}}return!oe&&Pe&&(oe=Pe),console.log(` Plot ${Y+1} parsed:`,{title:z,description:oe,summary:Pe,campaignLength:ae}),{id:Y,title:z,description:oe||Pe||`Plot ${Y+1} description`,summary:Pe,campaignLength:ae,index:Y}});return console.log(" Parsed plots:",se),se}catch(V){return console.error(" Error parsing plots:",V),[{id:0,title:"Plot 1",description:"Adventure awaits!",index:0},{id:1,title:"Plot 2",description:"Another exciting journey!",index:1},{id:2,title:"Plot 3",description:"A mysterious quest!",index:2}]}},zn=M=>{try{console.log(" Parsing structured response:",M);const V={storyContent:"",currentLocation:"",activeNPCs:[],plotDevelopments:"",characterReactions:"",nextActions:[],storyTone:"",phaseStatus:"",enemyDetails:[]},se=M.match(/\*\*STORY_CONTENT:\*\*\s*([\s\S]*?)(?=\*\*|$)/);se&&(V.storyContent=se[1].trim());const J=M.match(/\*\*CURRENT_LOCATION:\*\*\s*([\s\S]*?)(?=\*\*|$)/);J&&(V.currentLocation=J[1].trim());const Y=M.match(/\*\*ACTIVE_NPCS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);Y&&(V.activeNPCs=Y[1].trim().split(",").map(Se=>Se.trim()).filter(Se=>Se));const ye=M.match(/\*\*PLOT_DEVELOPMENTS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);ye&&(V.plotDevelopments=ye[1].trim());const z=M.match(/\*\*CHARACTER_REACTIONS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);z&&(V.characterReactions=z[1].trim());const oe=M.match(/\*\*NEXT_ACTIONS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);oe&&(V.nextActions=oe[1].trim().split(",").map(Se=>Se.trim()).filter(Se=>Se));const Pe=M.match(/\*\*STORY_TONE:\*\*\s*([\s\S]*?)(?=\*\*|$)/);Pe&&(V.storyTone=Pe[1].trim());const ae=M.match(/\*\*PHASE_STATUS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);ae&&(V.phaseStatus=ae[1].trim());const X=M.match(/\*\*ENEMY_DETAILS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);if(X){const Se=X[1].trim();console.log(" Raw enemy details text:",Se);const st=Se.split(/(?=Name:)/).filter(Ge=>Ge.trim());console.log(" Enemy blocks found:",st.length),V.enemyDetails=st.map((Ge,Ht)=>{console.log(` Parsing enemy block ${Ht}:`,Ge);const bt={},fn=Ge.match(/Name:\s*([^\n]+)/);fn&&(bt.name=fn[1].trim());const yr=Ge.match(/Type:\s*([^\n]+)/);yr&&(bt.type=yr[1].trim());const Lr=Ge.match(/Level:\s*([^\n]+)/);Lr&&(bt.level=parseInt(Lr[1].trim())||1);const vr=Ge.match(/HP:\s*([^\n]+)/);if(vr){const qn=vr[1].trim().match(/(\d+)/);bt.hp=qn?parseInt(qn[1]):20}const Vt=Ge.match(/AC:\s*([^\n]+)/);Vt&&(bt.ac=parseInt(Vt[1].trim())||12);const xr=Ge.match(/Basic Attack:\s*([^\n]+)/);xr&&(bt.basicAttack=xr[1].trim());const Hn=Ge.match(/Special Ability:\s*([^\n]+)/);Hn&&(bt.specialAbility=Hn[1].trim());const Wn=Ge.match(/Stats:\s*([^\n]+)/);return Wn&&(bt.stats=Wn[1].trim()),console.log(` Parsed enemy ${Ht}:`,bt),bt})}return console.log(" Parsed structured response:",V),V}catch(V){return console.error(" Error parsing structured response:",V),{storyContent:M,currentLocation:"",activeNPCs:[],plotDevelopments:"",characterReactions:"",nextActions:[],storyTone:"",phaseStatus:"",enemyDetails:[]}}},ms=M=>!Array.isArray(M)||M.length===0?(console.log(" No enemy details provided, returning empty array"),[]):(console.log(" Converting enemy details to combat-ready enemies:",M),M.map((V,se)=>{var ye,z;const Y={id:`enemy_${se}`,name:V.name||`Enemy ${se+1}`,hp:V.hp||20,maxHp:V.hp||20,ac:V.ac||12,level:V.level||1,class:((ye=V.type)==null?void 0:ye.toLowerCase())||"enemy",race:((z=V.type)==null?void 0:z.toLowerCase())||"unknown",initiative:Math.floor(Math.random()*20)+1,strength:12,dexterity:10,constitution:12,intelligence:8,wisdom:8,charisma:6,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,basicAttack:V.basicAttack||"Basic attack (1d6 damage)",specialAbility:V.specialAbility||"None",type:V.type||"humanoid",stats:V.stats||"Standard enemy stats"};return console.log(` Converted enemy ${se}:`,Y),Y})),Ot=P.useCallback(M=>{const V=new Date().toLocaleTimeString(),se={id:Date.now(),timestamp:V,...M};fr(J=>[...J,se]),console.log(" Battle Log Entry:",se)},[]);P.useCallback(async M=>{var V;try{console.log(" Initializing combat...");let se=[];Array.isArray((V=M.storyMetadata)==null?void 0:V.enemies)&&M.storyMetadata.enemies.length>0?se=[...M.storyMetadata.enemies]:(se=[{id:"enemy_0",name:"Gnoll Pack",hp:20,maxHp:20,ac:12,level:1,class:"enemy",race:"unknown",initiative:Math.floor(Math.random()*20)+1,strength:12,dexterity:10,constitution:12,intelligence:8,wisdom:8,charisma:6},{id:"enemy_1",name:"Gnoll Pack-Leader",hp:25,maxHp:25,ac:14,level:2,class:"enemy",race:"unknown",initiative:Math.floor(Math.random()*20)+1,strength:14,dexterity:12,constitution:14,intelligence:10,wisdom:10,charisma:8}],console.log(" Using fallback enemy details:",se)),setEnemies(se),Ot({type:"combat_start",message:`Combat begins! ${se.length} enemies appear.`,enemies:se.map(z=>z.name)});const J=h.map(z=>{var Se,st,Ge,Ht,bt,fn,yr,Lr;let oe=z.hp,Pe=z.maxHp;if(!oe||!Pe){const Vt={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[z.class]||8,xr=((Se=z.assignedScores)==null?void 0:Se.constitution)||10,Hn=Math.floor((xr-10)/2),Wn=Math.max(1,(Vt+Hn)*(z.level||1));oe=Wn,Pe=Wn}let ae=z.ac;if(!ae){const Vt=((st=z.assignedScores)==null?void 0:st.dexterity)||10,xr=Math.floor((Vt-10)/2),Wn={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[z.class]||0;ae=Math.max(10,10+xr+Wn)}const X={...z,hp:oe,maxHp:Pe,ac:ae,initiative:Math.floor(Math.random()*20)+1,strength:((Ge=z.assignedScores)==null?void 0:Ge.strength)||10,dexterity:((Ht=z.assignedScores)==null?void 0:Ht.dexterity)||10,constitution:((bt=z.assignedScores)==null?void 0:bt.constitution)||10,intelligence:((fn=z.assignedScores)==null?void 0:fn.intelligence)||10,wisdom:((yr=z.assignedScores)==null?void 0:yr.wisdom)||10,charisma:((Lr=z.assignedScores)==null?void 0:Lr.charisma)||10,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0};return console.log(" Prepared character for combat:",{name:X.name,class:X.class,strength:X.strength,dexterity:X.dexterity,constitution:X.constitution,hp:X.hp,maxHp:X.maxHp,ac:X.ac}),X});console.log(" Prepared party characters:",J);const Y=pt.initializeCombat(J,se,M.currentContent||"Combat encounter");console.log(" Combat initialized with turn order:",Y.combatants.map((z,oe)=>`${oe}: ${z.name} (initiative: ${z.initiative})`));const ye=await qd(n,{storyContext:Y.storyContext,partyMembers:Y.combatants.filter(z=>!z.id.startsWith("enemy_")),enemies:Y.combatants.filter(z=>z.id.startsWith("enemy_")),initiative:Y.combatants.map(z=>({id:z.id,name:z.name,initiative:z.initiative})),currentTurn:Y.currentTurn,round:Y.round,combatState:Y.combatState,environmentalFeatures:Y.environmentalFeatures,teamUpOpportunities:Y.teamUpOpportunities,narrativeElements:Y.narrativeElements});console.log(" Combat session stored in database:",ye),Ie(Y),Be(ye.id),ue("active"),ut(Y.combatants[0]),console.log(" Combat initialized:",Y)}catch(se){console.error(" Error initializing combat:",se)}},[h,pt,Ot,n]);const Rn=P.useCallback(async(M,V)=>{var se,J,Y,ye;try{if(dt){console.log(" Combat action already processing, skipping...");return}if(console.log(" Executing combat action:",M,"on target:",V),console.log(" Current combatant:",B?{name:B.name,id:B.id}:null),console.log(" Combat session state:",Q?{currentTurn:Q.currentTurn,combatants:Q.combatants.map(X=>({name:X.name,id:X.id,hp:X.hp,maxHp:X.maxHp}))}:null),_e(!0),!Q||!B){console.error(" No active combat session or current combatant"),_e(!1);return}const z=await pt.executeAction(Q,B.id,M,V);if(!z.success){console.error(" Combat action failed:",z.message),_e(!1);return}console.log(" Combat action result:",z),console.log(" Result damage value:",(se=z.results)==null?void 0:se.damage),console.log(" Result healing value:",(J=z.results)==null?void 0:J.healing);const oe=z.updatedSession;if(z.results&&z.results.damage>0){const X=oe.combatants.find(Se=>Se.id===V);if(X){const Se=X.hp;X.hp=Math.max(0,X.hp-z.results.damage),console.log(` Applied ${z.results.damage} damage to ${X.name}. HP: ${Se}  ${X.hp}`),console.log(" Target details after damage:",{name:X.name,id:X.id,hp:X.hp,maxHp:X.maxHp,isEnemy:X.id.startsWith("enemy_")}),Ot({type:"damage",attacker:B.name,target:X.name,damage:z.results.damage,targetHp:X.hp,action:M,message:`${B.name} deals ${z.results.damage} damage to ${X.name} (${X.hp} HP remaining)`})}else console.error(" Target not found in updated session:",V),console.log(" Available combatants:",oe.combatants.map(Se=>({id:Se.id,name:Se.name})))}else if(z.results&&z.results.healing>0){const X=oe.combatants.find(Se=>Se.id===V);X&&Ot({type:"healing",healer:B.name,target:X.name,healing:z.results.healing,action:M,message:`${B.name} heals ${X.name} for ${z.results.healing} HP`})}else Ot({type:"action",actor:B.name,action:M,target:((Y=oe.combatants.find(X=>X.id===V))==null?void 0:Y.name)||"None",message:`${B.name} uses ${M}`});console.log(" Updated combat session:",oe),console.log(" Combatants after action:",oe.combatants.map(X=>`${X.name}: ${X.hp}/${X.maxHp}`)),console.log(" Next turn index:",oe.currentTurn),console.log(" Next combatant:",(ye=oe.combatants[oe.currentTurn])==null?void 0:ye.name),Ie(oe);const Pe=oe.combatants[oe.currentTurn];ut(Pe),console.log(" Turn advanced to:",Pe==null?void 0:Pe.name),we?(console.log(" Updating combat session in database:",{combatSessionId:we,currentTurn:oe.currentTurn,round:oe.round,partyMembers:oe.combatants.filter(X=>!X.id.startsWith("enemy_")).map(X=>({name:X.name,hp:X.hp})),enemies:oe.combatants.filter(X=>X.id.startsWith("enemy_")).map(X=>({name:X.name,hp:X.hp}))}),setTimeout(async()=>{try{await ws(we,{currentTurn:oe.currentTurn,round:oe.round,combatState:oe.combatState,partyMembers:oe.combatants.filter(X=>!X.id.startsWith("enemy_")),enemies:oe.combatants.filter(X=>X.id.startsWith("enemy_"))}),console.log(" Combat session updated in database successfully")}catch(X){console.error(" Error updating combat session in database:",X)}},100)):console.log(" No combatSessionId available for database update"),setSelectedAction(null);const ae=pt.checkCombatEnd(oe);if(ae.isComplete){console.log(" Combat ended:",ae),ue("complete"),Ot({type:"combat_end",result:ae.result,message:ae.result==="victory"?" Victory! All enemies have been defeated!":ae.result==="defeat"?" Defeat! The party has been overwhelmed!":" Combat ends in a draw."}),setTimeout(()=>{fr([])},5e3);const X=pt.generateCombatSummary(oe,ae),Se=pt.generateCombatNarrative(oe,ae);await gn(s.id,{currentContent:Se,storyMetadata:{...s.storyMetadata,phaseStatus:"Storytelling",combatResult:ae}})}else oe.combatants.filter(Se=>Se.id.startsWith("enemy_")&&Se.hp<=0&&Se.maxHp>0).forEach(Se=>{Se.maxHp=0,Ot({type:"enemy_death",enemy:Se.name,message:` ${Se.name} has been defeated!`})});_e(!1)}catch(z){console.error(" Error executing combat action:",z),_e(!1)}},[Q,B,s==null?void 0:s.id,s==null?void 0:s.storyMetadata,pt,dt,we]);return e?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),o.jsx("p",{className:"text-slate-300",children:"Loading campaign..."})]})}):C?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-red-400 mb-4",children:C}),o.jsxs("div",{className:"space-x-4",children:[o.jsx("button",{onClick:()=>{y(""),U()},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Retry"}),o.jsx("button",{onClick:()=>r("/dashboard"),className:"bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg transition-colors",children:"Back to Dashboard"})]})]})}):s?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:o.jsxs("div",{className:"container mx-auto px-4 py-6",children:[o.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-lg p-6 mb-6",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-3xl font-bold text-slate-200 mb-2",children:(a==null?void 0:a.name)||"Campaign Story"}),o.jsx("p",{className:"text-slate-300",children:(a==null?void 0:a.description)||"Adventure awaits!"})]}),o.jsx("div",{className:"text-right",children:o.jsxs("div",{className:"text-slate-300 text-sm",children:["Status: ",o.jsx("span",{className:"font-semibold text-slate-200",children:(s==null?void 0:s.status)||"unknown"})]})})]})}),(s==null?void 0:s.status)==="ready_up"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-3",children:"Campaign Lobby"}),o.jsx("p",{className:"text-slate-300 text-lg",children:"Waiting for all players to ready up"}),o.jsxs("div",{className:"mt-8 mb-8",children:[o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-4",children:[o.jsxs("div",{className:"text-2xl font-semibold text-slate-300",children:[tn(),"/",ht()," Players Ready"]}),o.jsxs("div",{className:"text-lg text-slate-400",children:["(",Math.round(tn()/ht()*100),"%)"]})]}),o.jsx("div",{className:"w-full bg-slate-700 rounded-full h-4 max-w-lg mx-auto",children:o.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-400 h-4 rounded-full transition-all duration-500",style:{width:`${tn()/ht()*100}%`}})})]})]}),o.jsxs("div",{className:"text-center",children:[G?o.jsx("div",{className:"text-green-400 font-semibold text-xl bg-green-900/30 px-6 py-3 rounded-xl",children:"You are ready!"}):o.jsx("div",{className:"space-y-4",children:h.find(M=>M.userId===(t==null?void 0:t.uid))?o.jsx("button",{onClick:be,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Ready Up"}):o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-slate-300",children:"You need to create a character first"}),o.jsx("button",{onClick:()=>r(`/character-creation/${n}`),className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Create Character"})]})}),ve&&(a==null?void 0:a.dmId)===(t==null?void 0:t.uid)&&o.jsx("div",{className:"mt-6",children:o.jsx("button",{onClick:Ae,disabled:g||W,className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:g||W?"Generating Story...":"Start Story Generation"})}),ve&&(a==null?void 0:a.dmId)!==(t==null?void 0:t.uid)&&o.jsx("div",{className:"mt-6",children:o.jsx("div",{className:"text-blue-400 font-semibold text-lg bg-blue-900/30 px-6 py-3 rounded-xl",children:"Waiting for Dungeon Master to start the story..."})})]})]}),(s==null?void 0:s.status)==="generating"&&o.jsx("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-4",children:"Generating Your Adventure"}),o.jsx("p",{className:"text-slate-300 text-lg mb-8",children:"The Dungeon Master is crafting your story. This may take a moment..."}),o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-400"}),o.jsx("div",{className:"text-slate-300 font-semibold text-lg",children:"Creating Story Plots..."})]})]})}),(s==null?void 0:s.status)==="generating_story"&&o.jsx("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-4",children:"Crafting Your Story"}),o.jsx("p",{className:"text-slate-300 text-lg mb-8",children:"The Dungeon Master is weaving the tale of your adventure..."}),o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-400"}),o.jsx("div",{className:"text-slate-300 font-semibold text-lg",children:"Generating Story Content..."})]}),(s==null?void 0:s.selectedPlotData)&&o.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 max-w-2xl mx-auto",children:[o.jsxs("h3",{className:"text-slate-200 font-semibold mb-2",children:["Selected Plot: ",s.selectedPlotData.title]}),o.jsx("p",{className:"text-slate-300 text-sm",children:s.selectedPlotData.description})]})]})}),(s==null?void 0:s.status)==="voting"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-6 text-center",children:"Choose Your Adventure"}),o.jsx("div",{className:"mb-4 flex justify-center",children:o.jsx("button",{onClick:()=>Oe(!de),className:"bg-slate-700 hover:bg-slate-600 text-slate-300 px-4 py-2 rounded-lg text-sm transition-colors",children:de?"Hide Debug":"Show Debug"})}),de&&o.jsxs("div",{className:"mb-4 p-4 bg-slate-700/50 rounded-lg",children:[o.jsxs("p",{className:"text-slate-300 text-sm",children:["Debug: Available plots count: ",((R=s==null?void 0:s.availablePlots)==null?void 0:R.length)||0]}),o.jsxs("p",{className:"text-slate-300 text-sm",children:["Debug: Raw plots: ",JSON.stringify((ne=s==null?void 0:s.availablePlots)==null?void 0:ne.slice(0,2))]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Array.isArray(s==null?void 0:s.availablePlots)&&s.availablePlots.length>0?s.availablePlots.map((M,V)=>o.jsxs("div",{className:"bg-slate-800/70 border-2 border-slate-600 rounded-xl p-6 hover:border-slate-500 transition-all duration-300",children:[o.jsx("h3",{className:"font-bold text-slate-200 text-xl mb-3",children:M.title}),o.jsx("p",{className:"text-slate-300 mb-4",children:M.description||"Adventure description here..."}),M.campaignLength&&o.jsxs("div",{className:"mb-4",children:[o.jsx("span",{className:"text-slate-400 text-sm",children:"Length: "}),o.jsx("span",{className:"text-slate-200 font-semibold capitalize",children:M.campaignLength})]}),(a==null?void 0:a.dmId)===(t==null?void 0:t.uid)?o.jsx("button",{onClick:()=>Bt(V),disabled:g,className:"w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Selecting...":"Choose This Plot"}):o.jsx("div",{className:"text-center py-3",children:o.jsx("span",{className:"text-slate-400 text-sm",children:"Waiting for DM to choose..."})})]},V)):o.jsxs("div",{className:"col-span-3 text-center",children:[o.jsx("p",{className:"text-slate-300",children:"No plots available. Please try generating the story again."}),(a==null?void 0:a.dmId)===(t==null?void 0:t.uid)&&o.jsx("button",{onClick:Ae,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors",children:"Regenerate Plots"})]})}),(a==null?void 0:a.dmId)!==(t==null?void 0:t.uid)&&o.jsx("div",{className:"text-center mt-6",children:o.jsx("p",{className:"text-slate-300 text-lg",children:"Waiting for the Dungeon Master to select a plot..."})})]}),(s==null?void 0:s.status)==="storytelling"&&o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[o.jsx("div",{className:"lg:col-span-1",children:o.jsxs("div",{className:"flex flex-col gap-y-6 lg:sticky lg:top-6",children:[o.jsxs("div",{className:"hidden lg:block bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsx("h3",{className:"font-bold text-slate-200",children:"Party Members"}),o.jsx("button",{onClick:()=>Oe(!de),className:"text-xs bg-slate-600 hover:bg-slate-500 px-2 py-1 rounded text-slate-200",children:de?"Hide Debug":"Show Debug"})]}),de&&o.jsxs("div",{className:"mb-2 p-2 bg-slate-700/50 rounded text-xs",children:[o.jsxs("p",{className:"text-slate-300",children:["Debug: Characters loaded: ",h.length]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Party members: ",u.length]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Characters: ",JSON.stringify(h.map(M=>({name:M.name,userId:M.userId})))]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Current Speaker: ",JSON.stringify(s==null?void 0:s.currentSpeaker)]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: User UID: ",t==null?void 0:t.uid]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Party DM ID: ",a==null?void 0:a.dmId]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Is DM speaking: ",((xe=s==null?void 0:s.currentSpeaker)==null?void 0:xe.id)==="dm"?"Yes":"No"]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Is user DM: ",(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)?"Yes":"No"]})]}),o.jsx("div",{className:"space-y-2",children:Lt().map(M=>{var Y,ye,z,oe,Pe;const V=((Y=s==null?void 0:s.currentSpeaker)==null?void 0:Y.userId)===M.userId;t==null||t.uid,M.userId;const se=he==="active"&&((z=(ye=Q==null?void 0:Q.combatants)==null?void 0:ye[Q.currentTurn])==null?void 0:z.userId)===M.userId,J=he!=="active"&&(((oe=s==null?void 0:s.currentSpeaker)==null?void 0:oe.userId)===(t==null?void 0:t.uid)||((Pe=s==null?void 0:s.currentSpeaker)==null?void 0:Pe.id)==="dm"&&(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)||!(s!=null&&s.currentSpeaker)&&(t==null?void 0:t.uid)===(a==null?void 0:a.dmId))&&!V;return o.jsxs("div",{className:`p-2 rounded transition-colors ${V?"bg-blue-600/30 border border-blue-500":J?"bg-slate-700/50 hover:bg-slate-600/50 cursor-pointer":"bg-slate-700/30 opacity-60 cursor-not-allowed"}`,onClick:J?()=>pr(M):void 0,children:[o.jsx("div",{className:"font-semibold text-slate-200 text-xs",children:M.name}),o.jsxs("div",{className:"text-slate-400 text-xs",children:[M.race," ",M.class]}),he==="active"?se?o.jsx("div",{className:"text-yellow-400 text-xs mt-1",children:" Current Turn"}):o.jsx("div",{className:"text-red-400 text-xs mt-1",children:" Combat Active"}):V&&o.jsx("div",{className:"text-blue-400 text-xs mt-1",children:"Currently Speaking"}),!J&&!V&&he!=="active"&&o.jsx("div",{className:"text-slate-500 text-xs mt-1",children:"Waiting for turn..."}),J&&!V&&o.jsx("div",{className:"text-green-400 text-xs mt-1",children:"Click to select"})]},M.id)})})]}),(s==null?void 0:s.campaignMetadata)&&he!=="active"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Campaign Progress"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Session:"}),o.jsx("span",{className:"text-slate-200 font-semibold",children:s.campaignMetadata.sessionNumber})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Progress:"}),o.jsxs("span",{className:"text-slate-200 font-semibold",children:[s.campaignMetadata.campaignProgress,"%"]})]})]})]}),j.length>0&&he!=="active"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Objectives"}),o.jsx("div",{className:"space-y-2",children:j.map((M,V)=>o.jsxs("div",{className:"text-sm",children:[o.jsx("div",{className:"text-slate-300",children:M.title}),o.jsx("div",{className:"text-slate-400 text-xs",children:M.description})]},V))})]})]})}),o.jsxs("div",{className:"lg:col-span-3",children:[(s==null?void 0:s.currentContent)&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 mb-8 shadow-lg",children:[o.jsx("div",{className:"mb-6",children:o.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2 border-b border-slate-600 pb-3",children:" Current Story"})}),o.jsx("div",{className:"text-slate-200 leading-8 text-lg max-w-none prose prose-invert prose-lg prose-slate",style:{lineHeight:"1.8",fontSize:"1.125rem",letterSpacing:"0.025em"},dangerouslySetInnerHTML:{__html:L(s.currentContent)}}),(s==null?void 0:s.storyMetadata)&&o.jsxs("div",{className:"mt-6 p-4 bg-slate-700/30 rounded-lg border border-slate-600",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.storyMetadata.currentLocation&&o.jsxs("div",{children:[o.jsx("span",{className:"text-blue-400 font-semibold",children:" Location:"}),o.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.currentLocation})]}),s.storyMetadata.storyTone&&o.jsxs("div",{children:[o.jsx("span",{className:"text-purple-400 font-semibold",children:" Tone:"}),o.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.storyTone})]}),s.storyMetadata.activeNPCs&&s.storyMetadata.activeNPCs.length>0&&o.jsxs("div",{children:[o.jsx("span",{className:"text-green-400 font-semibold",children:" Active NPCs:"}),o.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.activeNPCs.join(", ")})]}),s.storyMetadata.phaseStatus&&o.jsxs("div",{children:[o.jsx("span",{className:"text-orange-400 font-semibold",children:" Phase:"}),o.jsx("span",{className:"text-slate-300 ml-2 capitalize",children:s.storyMetadata.phaseStatus})]})]}),s.storyMetadata.nextActions&&s.storyMetadata.nextActions.length>0&&o.jsxs("div",{className:"mt-4",children:[o.jsx("span",{className:"text-yellow-400 font-semibold",children:" Possible Actions:"}),o.jsx("ul",{className:"mt-2 space-y-1",children:s.storyMetadata.nextActions.map((M,V)=>o.jsxs("li",{className:"text-slate-300 text-sm",children:[" ",M]},V))})]})]})]}),Ye&&o.jsx("div",{className:"bg-gradient-to-br from-blue-800/50 to-blue-700/50 border border-blue-600 rounded-lg p-6 mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-blue-200 text-lg font-semibold mb-2",children:" Combat is Loading..."}),o.jsx("div",{className:"text-blue-300 text-sm",children:"Preparing combat encounter..."}),!ve&&o.jsxs("div",{className:"mt-6",children:[o.jsx("div",{className:"text-blue-200 text-lg font-semibold mb-3",children:"Ready Up for Combat"}),o.jsxs("div",{className:"mb-4 p-3 bg-blue-900/30 rounded-lg text-xs",children:[o.jsx("div",{className:"text-blue-300 mb-2",children:"Debug Info:"}),o.jsxs("div",{className:"text-blue-400 space-y-1",children:[o.jsxs("div",{children:["Party Members: ",u.length]}),o.jsxs("div",{children:["Characters Loaded: ",h.length]}),o.jsxs("div",{children:["Ready Players: ",((Te=s==null?void 0:s.readyPlayers)==null?void 0:Te.length)||0]}),o.jsxs("div",{children:["Current User Has Character: ",h.find(M=>M.userId===(t==null?void 0:t.uid))?"Yes":"No"]}),o.jsxs("div",{children:["Current User Ready: ",G?"Yes":"No"]})]})]}),o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-4",children:[o.jsxs("div",{className:"text-2xl font-semibold text-blue-300",children:[tn(),"/",ht()," Players Ready"]}),o.jsxs("div",{className:"text-lg text-blue-400",children:["(",Math.round(tn()/ht()*100),"%)"]})]}),o.jsx("div",{className:"w-full bg-blue-700 rounded-full h-4 max-w-lg mx-auto mb-4",children:o.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-400 h-4 rounded-full transition-all duration-500",style:{width:`${tn()/ht()*100}%`}})}),o.jsx("div",{className:"text-center",children:h.find(M=>M.userId===(t==null?void 0:t.uid))?G?o.jsx("div",{className:"text-green-400 font-semibold text-xl bg-green-900/30 px-6 py-3 rounded-xl",children:"You are ready for combat!"}):o.jsx("button",{onClick:be,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-8 py-3 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Ready Up for Combat"}):o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-blue-300",children:"You need to create a character first"}),o.jsx("button",{onClick:()=>r(`/character-creation/${n}`),className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-8 py-3 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Create Character"})]})})]}),o.jsx("div",{className:"mt-3 text-blue-400 text-xs",children:ve?"All players ready! Starting combat...":"Waiting for all players to be ready..."})]})}),he==="active"&&Q&&o.jsxs("div",{className:"bg-gradient-to-br from-red-800/50 to-red-700/50 border border-red-600 rounded-lg p-6 mb-6",children:[o.jsxs("div",{className:"mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-red-100 mb-2 border-b border-red-600 pb-2",children:" Combat Encounter"}),o.jsxs("div",{className:"text-red-200 text-sm",children:["Round: ",Q.round," | Turn: ",Q.currentTurn+1]}),o.jsxs("div",{className:"mt-3 p-3 bg-slate-800/30 rounded-lg",children:[o.jsx("h5",{className:"text-slate-300 font-medium mb-2",children:"Turn Order (Initiative):"}),o.jsx("div",{className:"flex flex-wrap gap-1",children:Q.combatants.map((M,V)=>o.jsxs("div",{className:`px-2 py-1 rounded text-xs font-medium ${V===Q.currentTurn?"bg-yellow-600 text-yellow-100 border border-yellow-500":"bg-slate-700 text-slate-300"}`,children:[V+1,". ",M.name," (",M.initiative,")"]},M.id))})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-green-400 font-semibold mb-2",children:"Party Members"}),o.jsx("div",{className:"space-y-2",children:(me=Q.combatants)==null?void 0:me.filter(M=>!M.id.startsWith("enemy_")).map(M=>o.jsxs("div",{className:`p-2 rounded ${M.id===(B==null?void 0:B.id)?"bg-green-600/30 border border-green-500":"bg-slate-700/30"}`,children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-slate-200 font-medium",children:M.name}),o.jsxs("span",{className:"text-slate-300 text-sm",children:["HP: ",M.hp||0,"/",M.maxHp||0]})]}),M.id===(B==null?void 0:B.id)&&o.jsx("div",{className:"text-green-400 text-xs mt-1",children:"Current Turn"})]},M.id))})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-red-400 font-semibold mb-2",children:"Enemies"}),o.jsx("div",{className:"space-y-2",children:(fe=Q.combatants)==null?void 0:fe.filter(M=>M.id.startsWith("enemy_")).map(M=>o.jsxs("div",{className:`p-2 rounded ${M.id===(B==null?void 0:B.id)?"bg-red-600/30 border border-red-500":"bg-slate-700/30"}`,children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-slate-200 font-medium",children:M.name}),o.jsxs("span",{className:"text-slate-300 text-sm",children:["HP: ",M.hp||0,"/",M.maxHp||0]})]}),M.id===(B==null?void 0:B.id)&&o.jsx("div",{className:"text-red-400 text-xs mt-1",children:"Current Turn"})]},M.id))})]})]}),B&&!B.id.startsWith("enemy_")&&(B.userId===(t==null?void 0:t.uid)||!B.userId)&&o.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[o.jsxs("h4",{className:"text-blue-400 font-semibold mb-3",children:["Actions for ",B.name]}),dt&&o.jsx("div",{className:"mb-3 p-2 bg-blue-600/30 border border-blue-500 rounded text-blue-200 text-sm",children:" Processing combat action..."}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:Object.entries(pt.actionTypes).map(([M,V])=>o.jsx("button",{onClick:()=>setSelectedAction(M),disabled:dt,className:`p-2 rounded text-sm transition-colors ${selectedAction===M?"bg-blue-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-200"} disabled:opacity-50 disabled:cursor-not-allowed`,children:V.name},M))}),selectedAction&&o.jsxs("div",{className:"mt-4",children:[o.jsx("h5",{className:"text-slate-300 font-medium mb-2",children:"Select Target:"}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:(ge=Q.combatants)==null?void 0:ge.filter(M=>M.id!==B.id).map(M=>o.jsx("button",{onClick:()=>Rn(selectedAction,M.id),disabled:dt,className:"p-2 rounded bg-slate-700 hover:bg-slate-600 text-slate-200 text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:dt?"Processing...":M.name},M.id))})]})]}),he==="active"&&B&&!B.id.startsWith("enemy_")&&B.userId!==(t==null?void 0:t.uid)&&B.userId&&o.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[o.jsxs("h4",{className:"text-orange-400 font-semibold mb-3",children:[" Fallback Actions for ",B.name]}),o.jsx("p",{className:"text-slate-300 text-sm mb-3",children:"User ID mismatch detected. Showing actions anyway."}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:Object.entries(pt.actionTypes).map(([M,V])=>o.jsx("button",{onClick:()=>setSelectedAction(M),disabled:dt,className:`p-2 rounded text-sm transition-colors ${selectedAction===M?"bg-orange-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-200"} disabled:opacity-50 disabled:cursor-not-allowed`,children:V.name},M))}),selectedAction&&o.jsxs("div",{className:"mt-4",children:[o.jsx("h5",{className:"text-slate-300 font-medium mb-2",children:"Select Target:"}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:(De=Q.combatants)==null?void 0:De.filter(M=>M.id!==B.id).map(M=>o.jsx("button",{onClick:()=>Rn(selectedAction,M.id),disabled:dt,className:"p-2 rounded bg-slate-700 hover:bg-slate-600 text-slate-200 text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:dt?"Processing...":M.name},M.id))})]})]}),he==="active"&&o.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 mt-4",children:[o.jsx("h4",{className:"text-yellow-400 font-semibold mb-3",children:" Combat Debug Info"}),o.jsxs("div",{className:"text-xs text-slate-300 space-y-1",children:[o.jsxs("div",{children:["Combat State: ",he]}),o.jsxs("div",{children:["Current Combatant: ",(B==null?void 0:B.name)||"None"," (ID: ",(B==null?void 0:B.id)||"None",")"]}),o.jsxs("div",{children:["Current User: ",(t==null?void 0:t.uid)||"None"]}),o.jsxs("div",{children:["Combatant User ID: ",(B==null?void 0:B.userId)||"None"]}),o.jsxs("div",{children:["Is Enemy: ",($e=B==null?void 0:B.id)!=null&&$e.startsWith("enemy_")?"Yes":"No"]}),o.jsxs("div",{children:["User Match: ",(B==null?void 0:B.userId)===(t==null?void 0:t.uid)?"Yes":"No"]}),o.jsxs("div",{children:["Should Show Actions: ",B&&!B.id.startsWith("enemy_")&&B.userId===(t==null?void 0:t.uid)?"Yes":"No"]}),o.jsxs("div",{children:["Combat Session: ",Q?"Active":"None"]}),o.jsxs("div",{children:["Current Turn: ",(Q==null?void 0:Q.currentTurn)||"None"]}),o.jsxs("div",{children:["Total Combatants: ",((Mr=Q==null?void 0:Q.combatants)==null?void 0:Mr.length)||0]})]}),B&&!B.id.startsWith("enemy_")&&o.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-700",children:[o.jsx("h5",{className:"text-yellow-400 font-medium mb-2",children:"Manual Action Trigger"}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsx("button",{onClick:()=>{const M=Q.combatants.filter(V=>V.id.startsWith("enemy_"));M.length>0&&Rn("attack",M[0].id)},disabled:dt,className:"p-2 rounded bg-red-700 hover:bg-red-600 text-white text-xs transition-colors disabled:opacity-50",children:"Attack First Enemy"}),o.jsx("button",{onClick:()=>{const M=Q.combatants.filter(V=>!V.id.startsWith("enemy_")&&V.id!==B.id);M.length>0&&Rn("defend",M[0].id)},disabled:dt,className:"p-2 rounded bg-blue-700 hover:bg-blue-600 text-white text-xs transition-colors disabled:opacity-50",children:"Defend Ally"})]})]})]}),B&&!B.id.startsWith("enemy_")&&B.userId!==(t==null?void 0:t.uid)&&o.jsxs("div",{className:"bg-blue-800/30 rounded-lg p-4 text-center",children:[o.jsxs("div",{className:"text-blue-300 font-medium",children:["Player Turn: ",B.name]}),o.jsxs("div",{className:"text-blue-400 text-sm mt-1",children:["Waiting for ",B.name," to take their action..."]})]}),B&&B.id.startsWith("enemy_")&&o.jsxs("div",{className:"bg-red-800/30 rounded-lg p-4 text-center",children:[o.jsxs("div",{className:"text-red-300 font-medium",children:["Enemy Turn: ",B.name]}),o.jsx("div",{className:"text-red-400 text-sm mt-1",children:"Processing enemy action..."})]}),Tt.length>0&&o.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 mt-4",children:[o.jsx("h4",{className:"text-yellow-400 font-semibold mb-3",children:" Battle Log"}),o.jsx("div",{className:"max-h-40 overflow-y-auto space-y-2",children:Tt.slice(-10).map(M=>o.jsx("div",{className:`text-sm p-2 rounded ${M.type==="damage"?"bg-red-800/30 border-l-4 border-red-500":M.type==="healing"?"bg-green-800/30 border-l-4 border-green-500":M.type==="combat_start"?"bg-blue-800/30 border-l-4 border-blue-500":M.type==="enemy_death"?"bg-purple-800/30 border-l-4 border-purple-500":M.type==="combat_end"?"bg-yellow-800/30 border-l-4 border-yellow-500":"bg-slate-800/30 border-l-4 border-slate-500"}`,children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsx("span",{className:"text-slate-200",children:M.message}),o.jsx("span",{className:"text-slate-400 text-xs ml-2",children:M.timestamp})]})},M.id))})]})]}),s!=null&&s.currentSpeaker&&he!=="active"?o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mb-6",children:[o.jsxs("h3",{className:"font-bold text-slate-200 mb-4",children:["Current Speaker: ",s.currentSpeaker.name]}),((nn=s==null?void 0:s.currentSpeaker)==null?void 0:nn.userId)===(t==null?void 0:t.uid)||((gr=s==null?void 0:s.currentSpeaker)==null?void 0:gr.id)==="dm"&&(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)?o.jsxs("div",{className:"space-y-4",children:[o.jsx("textarea",{value:k,onChange:M=>w(M.target.value),placeholder:((ri=s==null?void 0:s.currentSpeaker)==null?void 0:ri.id)==="dm"?"Continue the story or describe what happens next...":`What does ${s.currentSpeaker.name} do?`,className:"w-full bg-slate-800/50 border border-slate-600 text-slate-100 px-4 py-3 rounded-lg focus:border-slate-500 focus:outline-none transition-colors min-h-[120px] resize-none",rows:4}),o.jsx("div",{className:"flex space-x-3",children:o.jsx("button",{onClick:zt,disabled:!k.trim()||g,className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Processing...":((ji=s==null?void 0:s.currentSpeaker)==null?void 0:ji.id)==="dm"?"Continue Story":"Send Response"})})]}):o.jsxs("p",{className:"text-slate-300",children:["Waiting for ",s.currentSpeaker.name," to respond..."]})]}):he!=="active"&&(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mb-6",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-4",children:"Dungeon Master Response"}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("textarea",{value:k,onChange:M=>w(M.target.value),placeholder:"Continue the story or describe what happens next...",className:"w-full bg-slate-800/50 border border-slate-600 text-slate-100 px-4 py-3 rounded-lg focus:border-slate-500 focus:outline-none transition-colors min-h-[120px] resize-none",rows:4}),o.jsx("div",{className:"flex space-x-3",children:o.jsx("button",{onClick:zt,disabled:!k.trim()||g,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Processing...":"Continue Story"})})]})]}),o.jsxs("div",{className:"lg:hidden bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4 mb-6",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Party Members"}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:Lt().map(M=>{var Y,ye,z,oe,Pe;const V=((Y=s==null?void 0:s.currentSpeaker)==null?void 0:Y.userId)===M.userId;t==null||t.uid,M.userId;const se=he==="active"&&((z=(ye=Q==null?void 0:Q.combatants)==null?void 0:ye[Q.currentTurn])==null?void 0:z.userId)===M.userId,J=he!=="active"&&(((oe=s==null?void 0:s.currentSpeaker)==null?void 0:oe.userId)===(t==null?void 0:t.uid)||((Pe=s==null?void 0:s.currentSpeaker)==null?void 0:Pe.id)==="dm"&&(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)||!(s!=null&&s.currentSpeaker)&&(t==null?void 0:t.uid)===(a==null?void 0:a.dmId))&&!V;return o.jsxs("div",{className:`p-2 rounded transition-colors ${V?"bg-blue-600/30 border border-blue-500":J?"bg-slate-700/50 hover:bg-slate-600/50 cursor-pointer":"bg-slate-700/30 opacity-60 cursor-not-allowed"}`,onClick:J?()=>pr(M):void 0,children:[o.jsx("div",{className:"font-semibold text-slate-200 text-xs",children:M.name}),o.jsxs("div",{className:"text-slate-400 text-xs",children:[M.race," ",M.class]}),he==="active"?se?o.jsx("div",{className:"text-yellow-400 text-xs mt-1",children:" Current Turn"}):o.jsx("div",{className:"text-red-400 text-xs mt-1",children:" Combat Active"}):V&&o.jsx("div",{className:"text-blue-400 text-xs mt-1",children:"Currently Speaking"}),!J&&!V&&he!=="active"&&o.jsx("div",{className:"text-slate-500 text-xs mt-1",children:"Waiting for turn..."}),J&&!V&&o.jsx("div",{className:"text-green-400 text-xs mt-1",children:"Click to select"})]},M.id)})})]}),(s==null?void 0:s.storyMessages)&&s.storyMessages.length>0&&he!=="active"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mt-8 shadow-lg",children:[o.jsx("div",{className:"mb-6",children:o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-2 border-b border-slate-600 pb-3",children:" Story History"})}),o.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:s.storyMessages.map((M,V)=>o.jsxs("div",{className:"border-l-4 border-slate-500 pl-4 py-2 bg-slate-800/30 rounded-r-lg",children:[o.jsxs("div",{className:"text-slate-300 text-sm font-semibold mb-2 flex items-center",children:[o.jsx("span",{className:"mr-2",children:""}),M.speaker||"Narrator"]}),o.jsx("div",{className:"text-slate-400 text-sm leading-6 pl-6 border-l border-slate-600",dangerouslySetInnerHTML:{__html:L(M.content)}})]},V))})]}),C&&o.jsx("div",{className:"bg-gradient-to-r from-red-900/50 to-red-800/50 border border-red-600 rounded-lg p-4 mb-6",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"text-red-400 text-xl",children:""}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-red-200 mb-2",children:"Notice"}),o.jsx("p",{className:"text-red-100 text-sm mb-3",children:C}),C.includes("AI service")&&o.jsxs("div",{className:"bg-red-800/30 border border-red-600 rounded p-3",children:[o.jsxs("p",{className:"text-red-200 text-xs mb-2",children:[o.jsx("strong",{children:"What this means:"})," The AI storytelling service is temporarily unavailable."]}),o.jsx("p",{className:"text-red-200 text-xs mb-2",children:o.jsx("strong",{children:"You can still:"})}),o.jsxs("ul",{className:"text-red-200 text-xs list-disc list-inside space-y-1",children:[o.jsx("li",{children:"Continue the story manually by typing your responses"}),o.jsx("li",{children:"Use the predefined plot options if available"}),o.jsx("li",{children:"Wait a few minutes and try again"})]})]})]}),o.jsx("button",{onClick:()=>y(""),className:"text-red-400 hover:text-red-200 transition-colors",children:""})]})}),de&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-900/50 to-slate-800/50 border border-slate-600 rounded-lg p-6 mb-6",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-4",children:" Debug Information"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:"Story State"}),o.jsxs("div",{className:"space-y-1 text-slate-400",children:[o.jsxs("div",{children:["Story ID: ",(s==null?void 0:s.id)||"None"]}),o.jsxs("div",{children:["Status: ",(s==null?void 0:s.status)||"None"]}),o.jsxs("div",{children:["Phase: ",((nr=s==null?void 0:s.storyMetadata)==null?void 0:nr.phaseStatus)||"None"]}),o.jsxs("div",{children:["Ready Players: ",(($a=s==null?void 0:s.readyPlayers)==null?void 0:$a.length)||0,"/",u.length]}),o.jsxs("div",{children:["Current Speaker: ",((Di=s==null?void 0:s.currentSpeaker)==null?void 0:Di.name)||"None"]})]})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:"User State"}),o.jsxs("div",{className:"space-y-1 text-slate-400",children:[o.jsxs("div",{children:["User ID: ",(t==null?void 0:t.uid)||"None"]}),o.jsxs("div",{children:["Is DM: ",(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)?"Yes":"No"]}),o.jsxs("div",{children:["Is Ready: ",G?"Yes":"No"]}),o.jsxs("div",{children:["All Ready: ",ve?"Yes":"No"]}),o.jsxs("div",{children:["Combat State: ",he]}),o.jsxs("div",{children:["Combat Loading: ",Ye?"Yes":"No"]}),o.jsxs("div",{children:["Has Navigated: ",et?"Yes":"No"]})]})]})]}),(t==null?void 0:t.uid)===(a==null?void 0:a.dmId)&&o.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-600",children:[o.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:" Manual Combat Controls"}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>{console.log(" DM manually triggering combat..."),wt(!0),en(!0),console.log(" Debugging party members for manual combat:",u),console.log(" Debugging party characters for manual combat:",h);const V=(h.length>0?h:u).map((J,Y)=>{if(console.log(` Validating member ${Y} for manual combat:`,J),typeof J=="string"){console.log(` Member ${Y} is a user ID string, creating basic character object for manual combat`);const z={id:`member_${Y}`,name:`Player ${Y+1}`,userId:J,race:"Unknown",class:"Unknown",level:1,initiative:Math.floor(Math.random()*20)+1,hp:10,maxHp:10,ac:10};return console.log(" Created basic character for user ID in manual combat:",z),z}const ye={id:J.id||`member_${Y}`,name:J.name||`Unknown Member ${Y}`,userId:J.userId||null,race:J.race||"Unknown",class:J.class||"Unknown",level:J.level||1,initiative:J.initiative||Math.floor(Math.random()*20)+1,hp:J.hp||J.maxHp||10,maxHp:J.maxHp||J.hp||10,ac:J.ac||10,...Object.fromEntries(Object.entries(J).filter(([z,oe])=>oe!=null&&z!=="id"&&z!=="name"&&z!=="userId"&&z!=="race"&&z!=="class"&&z!=="level"&&z!=="initiative"&&z!=="hp"&&z!=="maxHp"&&z!=="ac"))};return console.log(` Cleaned member ${Y} for manual combat:`,ye),ye});console.log(" Final validated party members for manual combat:",V);const se={partyId:n,partyMembers:V,enemies:[],storyContext:(s==null?void 0:s.currentContent)||"Manual combat encounter",combatState:"initialized",currentTurn:0,round:1,environmentalFeatures:[],teamUpOpportunities:[],narrativeElements:[]};console.log(" Final combat session object for manual combat:",se),qd(n,se).then(()=>{console.log(" Manual combat session created, navigating..."),r(`/combat/${n}`)}).catch(J=>{console.error(" Failed to create manual combat session:",J),en(!1),wt(!1)})},disabled:Ye||et,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:Ye?"Loading...":"Trigger Combat"}),o.jsx("button",{onClick:()=>{wt(!1),en(!1),console.log(" Reset combat navigation state")},className:"bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors",children:"Reset State"})]})]})]})]})]}),_&&o.jsx(m_,{validation:A,onClose:mt,onProceed:Dr,onRevise:tt}),S&&o.jsx(f_,{diceResult:Ve,onClose:jr})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-slate-300",children:"Story not found"}),o.jsx("button",{onClick:()=>r("/dashboard"),className:"mt-4 bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg transition-colors",children:"Back to Dashboard"})]})})}function GR(){var pr,tr,zn,ms,Ot,Rn;const{sessionId:t}=ff(),e=er(),n=ei(),[r,s]=P.useState(null),[i,a]=P.useState(null),[c,u]=P.useState(!0),[d,h]=P.useState([]),[f,g]=P.useState(null),[x,C]=P.useState(null),[y,k]=P.useState(""),[w,b]=P.useState(""),[I,j]=P.useState([]),[F,q]=P.useState([]),[E,_]=P.useState([]),[N,A]=P.useState(!1),[D,S]=P.useState(""),[T,Ve]=P.useState(""),[Me,Le]=P.useState(!1),[Ne,G]=P.useState(!1),[ie,ve]=P.useState(null),[ee,W]=P.useState(-1),[te,de]=P.useState(null),[Oe,he]=P.useState(!1),[ue,Q]=P.useState(!1),[Ie,we]=P.useState(new Set),[Be,B]=P.useState([]),[ut,dt]=P.useState(!1),_e=(pr=n.state)==null?void 0:pr.isTestCombat,Tt=n.state;P.useEffect(()=>{const R=Va(ne=>{if(!ne){e("/login");return}s(ne)});return()=>R()},[e]),P.useEffect(()=>{_e&&Tt?fr():t&&et()},[_e,Tt,t]),P.useEffect(()=>{if(t&&!_e){const R=h_(t,ne=>{var xe;if(a(ne),u(!1),ne){wt(ne),q(ne.environmentalFeatures||[]),_(ne.teamUpOpportunities||[]),be();const Te=(xe=ne.combatants)==null?void 0:xe[ne.currentTurn];Te&&Te.id.startsWith("enemy_")&&ne.combatState==="active"&&ne.currentTurn!==ee&&!Me&&!N&&setTimeout(()=>{tn()},1e3)}});return()=>{R()}}},[t,ee,Me,N,_e]),P.useEffect(()=>{if(_e&&i&&i.combatState==="active"){const R=L();if(R&&R.id.startsWith("enemy_")){const ne=setTimeout(()=>{tn()},2e3);return()=>clearTimeout(ne)}}},[i==null?void 0:i.currentTurn,_e]),P.useEffect(()=>{i&&ue&&zt()&&setTimeout(()=>{Q(!1),we(new Set),ht()},1e3)},[ue,Ie.size,(tr=i==null?void 0:i.partyMembers)==null?void 0:tr.length]),P.useEffect(()=>{i&&wt(i)},[i==null?void 0:i.currentTurn,i==null?void 0:i.combatState]),P.useEffect(()=>{if(i&&i.combatState==="active"){const R=i.combatants.filter(me=>!me.id.startsWith("enemy_")),ne=i.combatants.filter(me=>me.id.startsWith("enemy_")),xe=R.some(me=>me.hp>0),Te=ne.some(me=>me.hp>0);xe?Te||(_e?e("/test-environment",{state:{...Tt,combatResult:"victory"}}):Lt("victory")):_e?e("/test-environment",{state:{...Tt,combatResult:"defeat"}}):Lt("defeat")}},[i==null?void 0:i.combatants,i==null?void 0:i.combatState]);const fr=async()=>{try{u(!0);const ne={id:"test_combat_session",partyMembers:Tt.partyMembers.map(me=>{if(!me.hp||!me.maxHp||!me.ac){const{class:fe,level:ge,constitution:De,dexterity:$e}=me,nn={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[fe]||8,gr=Math.floor((De-10)/2),ri=Math.max(1,(nn+gr)*ge),ji=10,nr=Math.floor(($e-10)/2),Di={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[fe]||0,M=Math.max(10,ji+nr+Di);return{...me,hp:ri,maxHp:ri,ac:M}}return me})||[],enemies:Tt.enemies||[],storyContext:Tt.storyContext||"Test combat environment",combatState:"initialized",currentTurn:0,combatants:[],round:1};if(!ne.enemies||ne.enemies.length===0){a({...ne,status:"no_enemies",combatState:"ended"}),u(!1);return}const xe=$r.initializeCombat(ne.partyMembers,ne.enemies,ne.storyContext),Te={...ne,...xe,currentTurn:0,combatState:"active"};a(Te),u(!1),wt(Te),q(Te.environmentalFeatures||[]),_(Te.teamUpOpportunities||[])}catch(R){console.error("Error initializing test combat:",R),u(!1)}},et=async()=>{if(t)try{u(!0);const R=await vR(t);if(!R){console.error("No combat session found with ID:",t),e("/dashboard");return}const ne=R.partyId,xe=await nl(ne);try{await TR(ne);const Te=await nl(ne);h(Te)}catch(Te){console.warn("Failed to update character stats:",Te),h(xe)}if(R.enemies&&R.enemies.length===0&&!_e){a({...R,status:"no_enemies"});return}if(R.combatState==="initialized"){let Te=R.combatants||[];if(Te.length===0){const fe=(R.partyMembers||[]).map(De=>({...De,isEnemy:!1,userId:De.userId,cooldowns:De.cooldowns||{},statusEffects:De.statusEffects||[],hp:De.hp??De.maxHp??10,maxHp:De.maxHp??De.hp??10})),ge=(R.enemies||[]).map(De=>({...De,isEnemy:!0,userId:null,cooldowns:De.cooldowns||{},statusEffects:De.statusEffects||[],hp:De.hp??De.maxHp??10,maxHp:De.maxHp??De.hp??10}));Te=[...fe,...ge]}const me={...R,combatants:Te,combatState:"active",currentTurn:0,round:1};await ws(t,me),a(me),wt(me),q(me.environmentalFeatures||[]),_(me.teamUpOpportunities||[])}else a(R),wt(R),q(R.environmentalFeatures||[]),_(R.teamUpOpportunities||[])}catch(R){console.error("Error loading combat data:",R)}finally{u(!1)}},wt=R=>{var fe;const ne=L(R);if(!ne)return;const xe=[],Te=ne.cooldowns||{};Object.entries($r.actionTypes).forEach(([ge,De])=>{(Te[ge]===0||Te[ge]===void 0)&&xe.push({type:ge,name:De.name,description:De.description,priority:De.priority,narrativeTemplate:De.narrativeTemplate})});const me=$r.classAbilities[(fe=ne.class)==null?void 0:fe.toLowerCase()];me&&(Te.special===0||Te.special===void 0)&&xe.push({type:"special",name:me.name,description:me.description,priority:"high",narrativeTemplate:"{character} uses their {ability}!"}),F.length>0&&xe.push({type:"environmental",name:"Use Environment",description:"Use the environment to your advantage",priority:"normal",narrativeTemplate:"{character} uses the {environment} to their advantage!"}),E.length>0&&xe.push({type:"teamUp",name:"Team Up",description:"Coordinate with another party member",priority:"high",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}),j(xe)},Ye=R=>{const ne=new Date().toLocaleTimeString(),xe={id:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:ne,round:(i==null?void 0:i.round)||1,turn:(i==null?void 0:i.currentTurn)||0,...R};B(Te=>[...Te,xe])},en=async()=>{if(i)try{Le(!0),B([]);const R={...i,combatState:"ready",currentTurn:0,round:1};_e?(a(R),wt(R)):await ws(t,R),Ye({type:"combat_start",description:"Combat is ready to begin!"})}catch(R){console.error("Error starting combat:",R)}finally{Le(!1)}},hs=async()=>{if(i)try{Le(!0);const R={...i,combatState:"active"};_e?(a(R),wt(R)):await ws(t,R),Ye({type:"combat_begin",description:"Fight!"}),dt(!0)}catch(R){console.error("Error beginning combat:",R)}finally{Le(!1)}},pt=async(R,ne,xe={})=>{if(!(!i||!U()))try{Le(!0),B([]);const Te={...i,combatState:"ready",currentTurn:0,round:1};_e?(a(Te),wt(Te)):await ws(t,Te),Ye({type:"combat_start",description:"Combat begins!"}),Ye({type:"combat_begin",description:"The battle is joined!"});const me=L(),fe=i.combatants.find(Mr=>Mr.id===ne),ge=await $r.executeAction(i,me.id,R,ne,xe),De={...i,currentTurn:ge.updatedSession.currentTurn,round:ge.updatedSession.round,combatants:ge.updatedSession.combatants};_e?a(De):await ws(t,De),Ye({type:ge.success?"action":"action_failed",description:ge.narrative}),ge.damage>0&&fe&&Ye({type:"damage",description:`${fe.name} takes ${ge.damage} damage!`}),ge.healing>0&&fe&&Ye({type:"healing",description:`${fe.name} is healed for ${ge.healing} HP!`}),k(ge.narrative),ge.description&&b(ge.description);const $e=$r.checkCombatEnd(De);if($e.ended){_e?e("/test-environment",{state:{...Tt,combatResult:$e.result}}):await Lt($e.result);return}me.id.startsWith("enemy_")?(Q(!0),S(ge.narrative),Ve(ge.description)):ht(),ge.damage>0&&fe&&(de({targetId:fe.id,damage:ge.damage,type:"damage"}),he(!0),setTimeout(()=>he(!1),2e3)),ge.healing>0&&fe&&(de({targetId:fe.id,healing:ge.healing,type:"healing"}),he(!0),setTimeout(()=>he(!1),2e3)),g(null),C(null)}catch(Te){console.error("Error executing action:",Te),Ye({type:"error",description:"An error occurred while executing the action."})}finally{Le(!1)}},tn=async()=>{var ne;if(!i||i.combatState!=="active")return;const R=L();if(!(!R||!R.id.startsWith("enemy_")))try{Le(!0),A(!0),Ye({type:"turn_start",actor:R.name,description:`${R.name}'s turn begins`});const xe=$r.chooseEnemyAction(R,i);if(!xe){setTimeout(()=>{ht()},1e3);return}const Te=xe.action,me=xe.target;if(!Te){setTimeout(()=>{ht()},1e3);return}const fe=i.combatants.find(De=>De.id===me);if(!fe&&Te!=="defend"){setTimeout(()=>{ht()},1e3);return}Ye({type:"action",actor:R.name,action:Te,target:(fe==null?void 0:fe.name)||"self",description:`${R.name} uses ${Te}${fe?` on ${fe.name}`:""}`});const ge=await $r.executeAction(i,R.id,Te,me,xe);if(ge.success){const De={...i,...ge.updatedSession||{},currentTurn:((ne=ge.updatedSession)==null?void 0:ne.currentTurn)!==void 0?ge.updatedSession.currentTurn:i.currentTurn};ge.damage&&Ye({type:"damage",actor:R.name,target:(fe==null?void 0:fe.name)||"self",damage:ge.damage,description:`${R.name} deals ${ge.damage} damage to ${(fe==null?void 0:fe.name)||"self"}`}),ge.healing&&Ye({type:"healing",actor:R.name,target:(fe==null?void 0:fe.name)||"self",healing:ge.healing,description:`${R.name} heals ${(fe==null?void 0:fe.name)||"self"} for ${ge.healing} HP`}),ge.statusEffects&&ge.statusEffects.length>0&&ge.statusEffects.forEach(nn=>{Ye({type:"status_effect",actor:R.name,target:(fe==null?void 0:fe.name)||"self",effect:nn.type,description:`${(fe==null?void 0:fe.name)||"self"} is affected by ${nn.type}`})}),ge.targetDied&&Ye({type:"death",actor:R.name,target:(fe==null?void 0:fe.name)||"self",description:`${(fe==null?void 0:fe.name)||"self"} has been defeated!`}),a(De),ge.damage&&fe&&(de({targetId:fe.id,damage:ge.damage,type:"damage"}),he(!0),setTimeout(()=>he(!1),2e3)),ge.healing&&fe&&(de({targetId:fe.id,damage:ge.healing,type:"healing"}),he(!0),setTimeout(()=>he(!1),2e3));const $e=$r.generateActionNarrative(R,Te,fe,xe);if(S(`${R.name} uses ${Te}!`),Ve($e),ge.combatEnded){console.log("Combat ended"),_e?e("/test-environment",{state:{...Tt,combatResult:ge.combatResult}}):await Lt(ge.combatResult);return}if(De.combatants.filter(nn=>!nn.id.startsWith("enemy_")&&nn.hp>0).length===0){console.log("All players dead, ending combat"),_e?e("/test-environment",{state:{...Tt,combatResult:"defeat"}}):await Lt("defeat");return}setTimeout(()=>{ht()},1e3)}else console.error("Enemy action execution failed:",ge.error),Ye({type:"action_failed",actor:R.name,action:Te,description:`${R.name}'s ${Te} failed`}),setTimeout(()=>{ht()},1e3)}catch(xe){console.error("Error processing enemy turn:",xe),Ye({type:"error",actor:R.name,description:`Error during ${R.name}'s turn`}),setTimeout(()=>{ht()},1e3)}finally{Le(!1),A(!1)}},ht=async()=>{if(!i||i.combatState!=="active")return;const R=i.combatants.filter($e=>!$e.id.startsWith("enemy_")),ne=i.combatants.filter($e=>$e.id.startsWith("enemy_")),xe=R.some($e=>$e.hp>0),Te=ne.some($e=>$e.hp>0);if(!xe){_e?e("/test-environment",{state:{...Tt,combatResult:"defeat"}}):await Lt("defeat");return}if(!Te){_e?e("/test-environment",{state:{...Tt,combatResult:"victory"}}):await Lt("victory");return}let me=(i.currentTurn+1)%i.combatants.length,fe=0;const ge=i.combatants.length;for(;fe<ge;){const $e=i.combatants[me];if($e&&$e.hp>0)break;me=(me+1)%i.combatants.length,fe++}if(fe>=ge){_e?e("/test-environment",{state:{...Tt,combatResult:"draw"}}):await Lt("draw");return}const De={...i,currentTurn:me};me===0&&(De.round=i.round+1),_e?a(De):await ws(t,De),wt(De)},Lt=async(R="victory")=>{if(!i)return;const ne=$r.generateCombatSummary(i,R);_e?(a(xe=>({...xe,status:"ended",combatState:"ended",summary:ne})),e("/test-environment")):(await _R(t,{status:"ended",combatState:"ended",summary:ne}),await gn(t,{status:"storytelling",currentCombat:null}),e(`/campaign/${t}`))},L=(R=i)=>{if(!R)return null;const ne=R.combatants||[],xe=R.currentTurn||0;return ne.length===0||xe>=ne.length?null:ne[xe]},U=()=>{const R=L();return R?_e?!R.isEnemy:R.userId===(r==null?void 0:r.uid):!1},be=()=>{if(i){if(_e){const R=i.combatants.find(ne=>!ne.isEnemy);R&&R.hp<=0&&(G(!0),ve(R))}else if(r){const R=i.partyMembers.find(ne=>ne.userId===r.uid)||i.combatants.find(ne=>ne.userId===r.uid&&!ne.isEnemy);R&&R.hp<=0&&(G(!0),ve(R))}}},Ae=()=>{if(_e)e("/dashboard");else{const R=i==null?void 0:i.partyId;e(`/character-creation/${R}`)}},Bt=()=>{if(_e)Q(!1),we(new Set),ht();else{const R=r==null?void 0:r.uid;R&&we(ne=>new Set([...ne,R]))}},zt=()=>{if(_e)return!0;if(!(i!=null&&i.partyMembers))return!1;const R=i.partyMembers.filter(xe=>xe.hp>0);return Ie.size>=R.length},mt=Array.isArray(i==null?void 0:i.combatants)?i.combatants:Array.isArray(i==null?void 0:i.partyMembers)&&Array.isArray(i==null?void 0:i.enemies)?[...i.partyMembers.map(R=>({...R,isEnemy:!1,userId:R.userId,cooldowns:R.cooldowns||{},statusEffects:R.statusEffects||[],hp:R.hp??R.maxHp??1,maxHp:R.maxHp??R.hp??1})),...i.enemies.map(R=>({...R,isEnemy:!0,userId:null,cooldowns:R.cooldowns||{},statusEffects:R.statusEffects||[],hp:R.hp??R.maxHp??1,maxHp:R.maxHp??R.hp??1}))]:[],jr=R=>{if(!R||!mt.length)return[];const ne=mt.filter(me=>me.hp>0),xe=L();if(!xe)return[];const Te=!xe.id.startsWith("enemy_");switch(R){case"attack":case"spell":case"special":return Te?ne.filter(me=>me.id.startsWith("enemy_")):ne.filter(me=>!me.id.startsWith("enemy_"));case"heal":case"item":return Te?ne.filter(me=>!me.id.startsWith("enemy_")&&me.id!==xe.id):ne.filter(me=>me.id.startsWith("enemy_")&&me.id!==xe.id);case"defend":case"environmental":return[xe];case"teamUp":return Te?ne.filter(me=>!me.id.startsWith("enemy_")&&me.id!==xe.id):ne.filter(me=>me.id.startsWith("enemy_")&&me.id!==xe.id);default:return ne}},Dr=Array.isArray(i==null?void 0:i.enemies)?i.enemies:[];if(!r)return null;if(c)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Loading Combat..."}),o.jsx("p",{className:"text-gray-300 mb-6",children:"Preparing the battlefield and gathering combatants..."}),o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto"})]})})});if(!i)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("div",{className:"text-gray-400",children:"No active combat session found."})})})});if((i.status==="no_enemies"||Dr.length===0)&&!_e)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"No Enemies to Fight"}),o.jsx("p",{className:"text-gray-300 mb-6",children:"There are no enemies present in this area. Combat cannot begin."}),o.jsx("p",{className:"text-gray-400 text-sm",children:"The combat session will end automatically."})]})})});const tt=L();return Ne&&ie?o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card bg-red-50 border-red-200",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h1",{className:"text-3xl font-bold text-red-800 mb-4",children:"Character Death"}),o.jsxs("div",{className:"text-xl text-red-700 mb-6",children:[ie.name," has fallen in battle..."]}),o.jsxs("div",{className:"bg-white p-6 rounded-lg border border-red-300 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-stone-800 mb-2",children:"Fallen Hero"}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Name:"})," ",ie.name]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Class:"})," ",ie.class]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Level:"})," ",ie.level]}),o.jsxs("p",{className:"text-stone-600",children:[o.jsx("strong",{children:"Final HP:"})," ",ie.hp,"/",ie.maxHp]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-stone-600",children:"Your character has been defeated. You must create a new character to continue."}),o.jsx("button",{onClick:Ae,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})}):o.jsx("div",{className:"min-h-screen bg-gray-900 text-gray-100 p-4",children:o.jsxs("div",{className:"fantasy-container py-4",children:[o.jsx("div",{className:"flex justify-between items-center mb-6",children:o.jsx("h1",{className:"fantasy-title mb-0",children:" Combat Arena"})}),i.storyContext&&o.jsxs("div",{className:"fantasy-card mb-6",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-2",children:"Story Context"}),o.jsx("p",{className:"text-gray-300 italic text-sm",children:i.storyContext})]}),o.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6",children:[o.jsxs("div",{className:"xl:col-span-1 space-y-6",children:[o.jsxs("div",{className:"fantasy-card h-96",children:[o.jsx("h3",{className:"text-lg font-semibold mb-4 text-yellow-400",children:"Battle Log"}),o.jsx("div",{className:"space-y-2 h-80 overflow-y-auto",children:Be.length===0?o.jsx("p",{className:"text-gray-400 text-sm",children:"No actions recorded yet..."}):Be.map(R=>o.jsxs("div",{className:"text-sm border-l-2 border-gray-600 pl-3 py-1",children:[o.jsxs("div",{className:"flex justify-between items-start mb-1",children:[o.jsx("span",{className:"text-gray-400 text-xs",children:R.timestamp}),o.jsxs("span",{className:"text-blue-400 text-xs",children:["R",R.round," T",R.turn]})]}),o.jsx("div",{className:`${R.type==="damage"?"text-red-400":R.type==="healing"?"text-green-400":R.type==="death"?"text-red-500 font-semibold":R.type==="status_effect"?"text-purple-400":R.type==="action_failed"?"text-orange-400":R.type==="error"?"text-red-500":"text-gray-200"}`,children:R.description})]},R.id))})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3",children:"Combat Status"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-blue-300 mb-2",children:"Party Members"}),o.jsx("div",{className:"space-y-2",children:mt.filter(R=>!R.id.startsWith("enemy_")).map(R=>o.jsxs("div",{className:`p-2 rounded border ${R.hp<=0?"bg-red-900/20 border-red-600":R.hp<R.maxHp*.5?"bg-yellow-900/20 border-yellow-600":"bg-blue-900/20 border-blue-600"} ${(tt==null?void 0:tt.id)===R.id?"ring-2 ring-amber-400":""}`,children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("span",{className:"font-medium text-gray-100",children:[R.name,(tt==null?void 0:tt.id)===R.id&&o.jsx("span",{className:"ml-2 text-amber-400",children:""})]}),o.jsxs("span",{className:`text-sm ${R.hp<=0?"text-red-400":R.hp<R.maxHp*.5?"text-yellow-400":"text-green-400"}`,children:[R.hp,"/",R.maxHp," HP"]})]}),R.hp<=0&&o.jsx("div",{className:"text-xs text-red-400 mt-1",children:" Defeated"})]},R.id))})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-red-300 mb-2",children:"Enemies"}),o.jsx("div",{className:"space-y-2",children:mt.filter(R=>R.id.startsWith("enemy_")).map(R=>o.jsxs("div",{className:`p-2 rounded border ${R.hp<=0?"bg-red-900/20 border-red-600":R.hp<R.maxHp*.5?"bg-yellow-900/20 border-yellow-600":"bg-red-900/20 border-red-600"} ${(tt==null?void 0:tt.id)===R.id?"ring-2 ring-amber-400":""}`,children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("span",{className:"font-medium text-gray-100",children:[R.name,(tt==null?void 0:tt.id)===R.id&&o.jsx("span",{className:"ml-2 text-amber-400",children:""})]}),o.jsxs("span",{className:`text-sm ${R.hp<=0?"text-red-400":R.hp<R.maxHp*.5?"text-yellow-400":"text-red-400"}`,children:[R.hp,"/",R.maxHp," HP"]})]}),R.hp<=0&&o.jsx("div",{className:"text-xs text-red-400 mt-1",children:" Defeated"})]},R.id))})]})]})]}),F.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-blue-300 mb-2",children:" Environmental Features"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:F.map((R,ne)=>o.jsx("span",{className:"px-3 py-1 bg-blue-900 text-blue-200 rounded-full text-sm",children:R},ne))})]}),E.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-purple-300 mb-2",children:" Team Up Opportunities"}),o.jsx("div",{className:"space-y-2",children:E.map((R,ne)=>o.jsxs("div",{className:"text-purple-200 text-sm",children:[o.jsxs("strong",{children:[R.classes.join(" + "),":"]})," ",R.description]},ne))})]})]}),o.jsxs("div",{className:"xl:col-span-2 space-y-6",children:[(()=>tt&&mt.length>0)()&&o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("h3",{className:"font-bold text-gray-100 mb-3",children:[" ",tt.name,"'s Turn"]}),U()?o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-200 mb-2",children:"Available Actions:"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:I.map((R,ne)=>o.jsxs("button",{onClick:()=>g(R),className:`p-3 rounded-lg border-2 transition-colors text-left ${(f==null?void 0:f.type)===R.type?"border-amber-500 bg-amber-900/20":"border-gray-600 bg-gray-700 hover:border-gray-500"}`,children:[o.jsx("div",{className:"font-medium text-gray-100",children:R.name}),o.jsx("div",{className:"text-sm text-gray-300",children:R.description}),o.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Priority: ",R.priority]})]},ne))})]}),f&&o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-200 mb-2",children:"Select Target:"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:jr(f.type).map(R=>o.jsxs("button",{onClick:()=>C(R),className:`p-3 rounded-lg border-2 transition-colors ${(x==null?void 0:x.id)===R.id?"border-red-500 bg-red-900/20":"border-gray-600 bg-gray-700 hover:border-gray-500"}`,children:[o.jsx("div",{className:"font-medium text-gray-100",children:R.name}),o.jsxs("div",{className:"text-sm text-gray-300",children:["HP: ",R.hp,"/",R.maxHp," | AC: ",R.ac]}),o.jsx("div",{className:"text-xs text-gray-400",children:R.id.startsWith("enemy_")?"Enemy":"Ally"})]},R.id))}),jr(f.type).length===0&&o.jsx("div",{className:"text-center p-4 bg-gray-700 border border-gray-600 rounded",children:o.jsx("p",{className:"text-gray-300",children:"No valid targets for this action."})})]}),f&&x&&o.jsx("div",{className:"text-center",children:o.jsx("button",{onClick:()=>pt(f.type,x.id),disabled:Me,className:"fantasy-button bg-amber-600 hover:bg-amber-700",children:Me?"Executing...":`Execute ${f.name}`})})]}):o.jsxs("div",{className:"bg-blue-900/20 border border-blue-700 rounded-lg p-4",children:[o.jsxs("h4",{className:"font-bold text-blue-300 mb-2",children:["Waiting for ",tt.name," to act"]}),o.jsx("p",{className:"text-blue-200",children:tt.userId===(r==null?void 0:r.uid)?"It's your turn! Please select an action.":"Please wait for the current player to make their move."})]})]}),(!mt.length||!Dr.length)&&o.jsxs("div",{className:"fantasy-card bg-gray-800 border-gray-600",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3",children:"Combat Status"}),o.jsxs("div",{className:"text-gray-300 space-y-2",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Combat State:"})," ",i.combatState]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Combatants:"})," ",mt.length]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Enemies:"})," ",Dr.length]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Current Turn:"})," ",i.currentTurn]}),i.combatState==="preparation"&&o.jsx("button",{onClick:en,className:"fantasy-button bg-yellow-600 hover:bg-yellow-700 mt-4",children:"Start Combat"})]})]}),y&&o.jsxs("div",{className:"fantasy-card bg-green-900/20 border-green-700",children:[o.jsx("h4",{className:"font-bold text-green-300 mb-2",children:"Action Result"}),o.jsx("p",{className:"text-green-200",children:y}),w&&o.jsx("div",{className:"mt-2 p-3 bg-gray-700 border border-green-600 rounded",children:o.jsx("p",{className:"text-gray-200 italic",children:w})})]}),N&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700 animate-pulse",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-red-300 mb-3 text-xl",children:" Enemy Turn"}),D&&o.jsx("div",{className:"text-red-200 font-bold text-lg mb-3 bg-gray-700 p-3 rounded border border-red-600",children:D}),T&&o.jsx("div",{className:"mt-3 p-4 bg-gray-700 border border-red-600 rounded",children:o.jsx("p",{className:"text-gray-200 italic",children:T})}),o.jsxs("div",{className:"mt-4 flex items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"}),o.jsx("span",{className:"ml-3 text-red-300 font-medium",children:"Enemy is acting..."})]})]})}),ue&&o.jsx("div",{className:"fantasy-card bg-blue-900/20 border-blue-700",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-blue-300 mb-3 text-xl",children:" Enemy Turn Complete"}),o.jsx("p",{className:"text-blue-200 mb-4",children:_e?"The enemy has finished their turn. Click 'Confirm' to proceed to the next turn.":"The enemy has finished their turn. All party members must click 'Confirm' to proceed."}),!_e&&o.jsxs("div",{className:"mb-4 p-3 bg-gray-700 border border-blue-600 rounded",children:[o.jsxs("p",{className:"text-sm text-blue-200",children:[o.jsx("strong",{children:"Ready to continue:"})," ",Ie.size," / ",((zn=i==null?void 0:i.partyMembers)==null?void 0:zn.filter(R=>R.hp>0).length)||0," party members"]}),Ie.size>0&&o.jsxs("div",{className:"mt-2 text-xs text-blue-300",children:["Waiting for: ",((Rn=(Ot=(ms=i==null?void 0:i.partyMembers)==null?void 0:ms.filter(R=>R.hp>0&&!Ie.has(R.userId)))==null?void 0:Ot.map(R=>R.name))==null?void 0:Rn.join(", "))||"None"]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center items-center",children:[o.jsx("button",{onClick:Bt,disabled:!_e&&Ie.has(r==null?void 0:r.uid),className:`fantasy-button px-8 py-3 text-lg font-semibold ${!_e&&Ie.has(r==null?void 0:r.uid)?"bg-green-700 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 shadow-lg"}`,children:!_e&&Ie.has(r==null?void 0:r.uid)?" Ready":"Confirm"}),_e&&o.jsx("button",{onClick:()=>{Q(!1),we(new Set),ht()},className:"fantasy-button px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white",children:"Skip Confirmation"})]}),o.jsx("div",{className:"mt-4 p-3 bg-yellow-900/20 border border-yellow-600 rounded",children:o.jsxs("p",{className:"text-sm text-yellow-200",children:[o.jsx("strong",{children:"Note:"})," Review the battle log and enemy actions before continuing to the next turn."]})})]})}),Me&&!N&&o.jsx("div",{className:"fantasy-card bg-amber-900/20 border-amber-700",children:o.jsxs("div",{className:"flex items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-amber-500"}),o.jsx("span",{className:"ml-2 text-amber-300 font-medium",children:"Processing turn..."})]})}),(i==null?void 0:i.combatState)==="ready"&&!ut&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-red-300 mb-4 text-2xl",children:" Combat Ready!"}),o.jsx("p",{className:"text-red-200 mb-6 text-lg",children:"All combatants are in position. Click 'Fight!' to begin the battle."}),o.jsx("button",{onClick:hs,disabled:Me,className:"fantasy-button px-12 py-4 text-xl font-bold bg-red-600 hover:bg-red-700 shadow-lg",children:Me?"Preparing...":"Fight!"})]})})]}),o.jsxs("div",{className:"xl:col-span-1 space-y-6",children:[mt.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3",children:" Turn Order"}),o.jsx("div",{className:"space-y-2",children:mt.map(R=>{var ne,xe;return o.jsx("div",{className:`p-3 rounded-lg border-2 transition-colors ${R.id===((ne=mt[i.currentTurn])==null?void 0:ne.id)?"border-amber-500 bg-amber-900/20":R.hp<=0?"border-red-600 bg-red-900/20 opacity-50":"border-gray-600 bg-gray-700"}`,children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"font-medium text-gray-100",children:[R.name,R.id===((xe=mt[i.currentTurn])==null?void 0:xe.id)&&o.jsx("span",{className:"ml-2 text-amber-400",children:" Current Turn"}),R.hp<=0&&o.jsx("span",{className:"ml-2 text-red-400",children:" Defeated"})]}),o.jsxs("div",{className:"text-sm text-gray-400",children:["Initiative: ",R.initiative||"N/A"]})]}),o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:`text-sm font-medium ${R.hp<=0?"text-red-400":R.hp<R.maxHp*.5?"text-yellow-400":"text-green-400"}`,children:[R.hp,"/",R.maxHp," HP"]}),o.jsxs("div",{className:"text-xs text-gray-500",children:["AC: ",R.ac||"N/A"]})]})]})},R.id)})})]}),Oe&&te&&o.jsx("div",{className:"fixed inset-0 pointer-events-none z-50 flex items-center justify-center",children:o.jsxs("div",{className:`text-6xl font-bold animate-bounce px-6 py-4 rounded-lg shadow-lg ${te.type==="damage"?"text-red-400 bg-red-900/80":"text-green-400 bg-green-900/80"}`,children:[te.type==="damage"?"-":"+",te.damage]})}),Ne&&ie&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h1",{className:"text-3xl font-bold text-red-300 mb-4",children:"Character Death"}),o.jsxs("div",{className:"text-xl text-red-200 mb-6",children:[ie.name," has fallen in battle..."]}),o.jsxs("div",{className:"bg-gray-700 p-6 rounded-lg border border-red-600 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Fallen Hero"}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Name:"})," ",ie.name]}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Class:"})," ",ie.class]}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Level:"})," ",ie.level]}),o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"Final HP:"})," ",ie.hp,"/",ie.maxHp]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-gray-300",children:"Your character has been defeated. You must create a new character to continue."}),o.jsx("button",{onClick:Ae,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})]})]})]})})}function KR(){const t=er(),[e,n]=P.useState(null),[r,s]=P.useState([]),[i,a]=P.useState([]),[c,u]=P.useState({}),[d,h]=P.useState({}),[f,g]=P.useState(!1),[x,C]=P.useState(!1),[y,k]=P.useState(""),[w,b]=P.useState({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""});P.useEffect(()=>{const S=Va(T=>{if(!T){t("/login");return}n(T),I(T.uid),j()});return()=>S()},[t]);const I=async S=>{try{const T=await u_(S);s(T),await F(T)}catch(T){console.error("Error loading parties:",T.message)}},j=async()=>{try{const T=(await cR()).filter(Ve=>{var Me;return!((Me=Ve.members)!=null&&Me.includes(e==null?void 0:e.uid))});a(T),await q(T)}catch(S){console.error("Error loading public parties:",S.message)}},F=async S=>{try{const T=new Set;if(S.forEach(Ne=>{Ne.members&&Array.isArray(Ne.members)&&Ne.members.forEach(G=>T.add(G))}),T.size===0)return;const Ve=await _0(Array.from(T)),Me={};Ve.forEach(Ne=>{Me[Ne.userId]=Ne});const Le={};S.forEach(Ne=>{Ne.members&&Array.isArray(Ne.members)&&(Le[Ne.id]=Ne.members.map(G=>({userId:G,profile:Me[G]||null})))}),u(Le)}catch(T){console.error("Error loading party member profiles:",T)}},q=async S=>{try{const T=new Set;if(S.forEach(Ne=>{Ne.members&&Array.isArray(Ne.members)&&Ne.members.forEach(G=>T.add(G))}),T.size===0)return;const Ve=await _0(Array.from(T)),Me={};Ve.forEach(Ne=>{Me[Ne.userId]=Ne});const Le={};S.forEach(Ne=>{Ne.members&&Array.isArray(Ne.members)&&(Le[Ne.id]=Ne.members.map(G=>({userId:G,profile:Me[G]||null})))}),h(Le)}catch(T){console.error("Error loading public party member profiles:",T)}},E=async S=>{if(S.preventDefault(),!e){console.error("You must be logged in to create a party");return}g(!0);try{const T={...w,inviteCode:Math.random().toString(36).substr(2,8).toUpperCase()},Ve=await c_(e.uid,T);C(!1),b({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:""}),await I(e.uid),await j(),console.log("Party created successfully!")}catch(T){console.error("Error creating party:",T.message)}finally{g(!1)}},_=async()=>{if(!y.trim()){console.error("Please enter an invite code");return}if(!e){console.error("You must be logged in to join a party");return}g(!0);try{const S=await uR(y.toUpperCase());if(!S){console.error("Invalid invite code");return}await E0(S.id,e.uid),k(""),await I(e.uid),await j(),console.log("Successfully joined party!")}catch(S){console.error(S.message||"Error joining party. Please try again.")}finally{g(!1)}},N=async S=>{if(!e){console.error("You must be logged in to join a party");return}g(!0);try{await E0(S,e.uid),await I(e.uid),await j(),console.log("Successfully joined public party!")}catch(T){console.error(T.message||"Error joining party. Please try again.")}finally{g(!1)}},A=S=>{navigator.clipboard.writeText(S),console.log("Invite code copied to clipboard!")},D=async(S,T)=>{if(confirm(`Are you sure you want to disband "${T}"? This action cannot be undone and will remove all party members and characters.`)){g(!0);try{await d_(S,e.uid),await I(e.uid),await j(),console.log("Party disbanded successfully")}catch(Ve){console.error("Error disbanding party:",Ve.message)}finally{g(!1)}}};return e?o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:"Party Management"}),o.jsx("button",{onClick:()=>C(!0),className:"fantasy-button",disabled:f,children:"Create New Party"})]}),x&&o.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600 mb-6",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-100 mb-4",children:"Create New Party"}),o.jsxs("form",{onSubmit:E,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"party-name",className:"block text-sm font-medium text-gray-200 mb-2",children:"Party Name"}),o.jsx("input",{id:"party-name",type:"text",value:w.name,onChange:S=>b(T=>({...T,name:S.target.value})),className:"fantasy-input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"party-theme",className:"block text-sm font-medium text-gray-200 mb-2",children:"Theme"}),o.jsx("textarea",{id:"party-theme",value:w.description,onChange:S=>b(T=>({...T,description:S.target.value})),className:"fantasy-input",rows:"3",placeholder:"Enter the theme or atmosphere for your campaign..."})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"max-players",className:"block text-sm font-medium text-gray-200 mb-2",children:"Max Players"}),o.jsx("input",{id:"max-players",type:"number",min:"2",max:"10",value:w.maxPlayers,onChange:S=>b(T=>({...T,maxPlayers:parseInt(S.target.value)})),className:"fantasy-input"})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"isPublic",checked:w.isPublic,onChange:S=>b(T=>({...T,isPublic:S.target.checked})),className:"mr-2"}),o.jsx("label",{htmlFor:"isPublic",className:"text-sm font-medium text-gray-200",children:"Public Party (visible to all users)"})]})]}),o.jsxs("div",{className:"flex space-x-4",children:[o.jsx("button",{type:"submit",className:"fantasy-button",disabled:f,children:f?"Creating...":"Create Party"}),o.jsx("button",{type:"button",onClick:()=>C(!1),className:"fantasy-button bg-gray-600 hover:bg-gray-700",disabled:f,children:"Cancel"})]})]})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"My Parties"}),r.length===0?o.jsxs("div",{className:"text-center py-8 text-gray-300",children:[o.jsx("p",{children:"You haven't joined any parties yet."}),o.jsx("p",{children:'Click "Create New Party" to get started!'})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:r.map(S=>{var Ve,Me;const T=c[S.id]||[];return o.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100",children:S.name}),o.jsxs("span",{className:"text-sm text-gray-300",children:[((Ve=S.members)==null?void 0:Ve.length)||1,"/",S.maxPlayers," players"]})]}),S.description&&o.jsxs("div",{className:"mb-4",children:[o.jsx("span",{className:"text-sm font-semibold text-gray-200",children:"Theme: "}),o.jsx("span",{className:"text-gray-300",children:S.description})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-200 mb-2",children:"Party Members:"}),o.jsx("div",{className:"space-y-1",children:T.map((Le,Ne)=>{var ve;const G=((ve=Le.profile)==null?void 0:ve.username)||`User ${Ne+1}`,ie=Le.userId===S.dmId;return o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-gray-300",children:G}),ie&&o.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),Le.userId===(e==null?void 0:e.uid)&&o.jsx("span",{className:"text-blue-400 text-xs font-medium",children:"(You)"})]},Le.userId)})})]}),S.dmId===e.uid&&o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{htmlFor:`invite-code-${S.id}`,className:"block text-sm font-medium text-gray-200 mb-2",children:"Invite Code"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{id:`invite-code-${S.id}`,type:"text",value:S.inviteCode,readOnly:!0,className:"fantasy-input bg-gray-700"}),o.jsx("button",{onClick:()=>A(S.inviteCode),className:"fantasy-button text-sm",children:"Copy"})]})]}),o.jsx("div",{className:"flex space-x-2",children:(Me=S.members)!=null&&Me.includes(e==null?void 0:e.uid)?o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>t(`/campaign/${S.id}`),className:"fantasy-button",children:"Campaign"}),S.dmId===e.uid&&o.jsx("button",{onClick:()=>D(S.id,S.name),className:"fantasy-button bg-red-600 hover:bg-red-700",disabled:f,children:"Disband"})]}):o.jsx("button",{onClick:()=>N(S.id),className:"fantasy-button bg-green-600 hover:bg-green-700",disabled:f,children:"Join Party"})})]},S.id)})})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Public Parties"}),i.length===0?o.jsx("div",{className:"text-center py-8 text-gray-300",children:o.jsx("p",{children:"No public parties available."})}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:i.map(S=>{var Ve;const T=d[S.id]||[];return o.jsxs("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100",children:S.name}),o.jsxs("span",{className:"text-sm text-gray-300",children:[((Ve=S.members)==null?void 0:Ve.length)||1,"/",S.maxPlayers," players"]})]}),S.description&&o.jsxs("div",{className:"mb-4",children:[o.jsx("span",{className:"text-sm font-semibold text-gray-200",children:"Theme: "}),o.jsx("span",{className:"text-gray-300",children:S.description})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-200 mb-2",children:"Party Members:"}),o.jsx("div",{className:"space-y-1",children:T.map((Me,Le)=>{var ie;const Ne=((ie=Me.profile)==null?void 0:ie.username)||`User ${Le+1}`,G=Me.userId===S.dmId;return o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-gray-300",children:Ne}),G&&o.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]}),Me.userId===(e==null?void 0:e.uid)&&o.jsx("span",{className:"text-blue-400 text-xs font-medium",children:"(You)"})]},Me.userId)})})]}),S.dmId===e.uid&&o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{htmlFor:`invite-code-${S.id}`,className:"block text-sm font-medium text-gray-200 mb-2",children:"Invite Code"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{id:`invite-code-${S.id}`,type:"text",value:S.inviteCode,readOnly:!0,className:"fantasy-input bg-gray-700"}),o.jsx("button",{onClick:()=>A(S.inviteCode),className:"fantasy-button text-sm",children:"Copy"})]})]}),o.jsx("div",{className:"flex space-x-2",children:o.jsx("button",{onClick:()=>N(S.id),className:"fantasy-button bg-green-600 hover:bg-green-700",disabled:f,children:"Join Party"})})]},S.id)})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Join a Party"}),o.jsx("div",{className:"fantasy-card bg-amber-900/20 border-amber-600",children:o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("input",{id:"join-code",type:"text",placeholder:"Enter invite code",value:y,onChange:S=>k(S.target.value),className:"fantasy-input flex-1",disabled:f}),o.jsx("button",{onClick:_,className:"fantasy-button",disabled:f,children:f?"Joining...":"Join Party"})]})})]})]})}):null}function QR(){const t=ei(),e=t.pathname.split("/campaign-story/")[1];return console.log("Old route detected:",t.pathname),console.log("PartyId extracted:",e),console.log("Redirecting to:",`/campaign/${e}`),o.jsx(Gx,{to:`/campaign/${e}`,replace:!0})}function YR(){return o.jsx(e1,{basename:"/DND-V1",future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:o.jsxs("div",{className:"min-h-screen flex flex-col",children:[o.jsx(AR,{}),o.jsx("main",{className:"flex-grow",children:o.jsxs(GC,{children:[o.jsx(Mn,{path:"/",element:o.jsx(DR,{})}),o.jsx(Mn,{path:"/login",element:o.jsx(MR,{})}),o.jsx(Mn,{path:"/register",element:o.jsx(LR,{})}),o.jsx(Mn,{path:"/dashboard",element:o.jsx(VR,{})}),o.jsx(Mn,{path:"/test-environment",element:o.jsx(FR,{})}),o.jsx(Mn,{path:"/campaign-management",element:o.jsx(zR,{})}),o.jsx(Mn,{path:"/character-creation/:partyId",element:o.jsx(HR,{})}),o.jsx(Mn,{path:"/campaign/:partyId",element:o.jsx(qR,{})}),o.jsx(Mn,{path:"/combat/:sessionId",element:o.jsx(GR,{})}),o.jsx(Mn,{path:"/party-management",element:o.jsx(KR,{})}),o.jsx(Mn,{path:"/campaign-story/:partyId",element:o.jsx(QR,{})}),o.jsx(Mn,{path:"*",element:o.jsx(Gx,{to:"/dashboard",replace:!0})})]})}),o.jsx(RR,{})]})})}Kd.createRoot(document.getElementById("root")).render(o.jsx(M0.StrictMode,{children:o.jsx(YR,{})}));
