function BI(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function zI(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var mb={exports:{}},th={},fb={exports:{}},Ue={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wc=Symbol.for("react.element"),qI=Symbol.for("react.portal"),WI=Symbol.for("react.fragment"),HI=Symbol.for("react.strict_mode"),GI=Symbol.for("react.profiler"),KI=Symbol.for("react.provider"),QI=Symbol.for("react.context"),YI=Symbol.for("react.forward_ref"),JI=Symbol.for("react.suspense"),XI=Symbol.for("react.memo"),ZI=Symbol.for("react.lazy"),ay=Symbol.iterator;function eN(n){return n===null||typeof n!="object"?null:(n=ay&&n[ay]||n["@@iterator"],typeof n=="function"?n:null)}var pb={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},gb=Object.assign,yb={};function ko(n,e,t){this.props=n,this.context=e,this.refs=yb,this.updater=t||pb}ko.prototype.isReactComponent={};ko.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};ko.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function vb(){}vb.prototype=ko.prototype;function gp(n,e,t){this.props=n,this.context=e,this.refs=yb,this.updater=t||pb}var yp=gp.prototype=new vb;yp.constructor=gp;gb(yp,ko.prototype);yp.isPureReactComponent=!0;var oy=Array.isArray,xb=Object.prototype.hasOwnProperty,vp={current:null},bb={key:!0,ref:!0,__self:!0,__source:!0};function wb(n,e,t){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)xb.call(e,r)&&!bb.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=t;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(n&&n.defaultProps)for(r in l=n.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:wc,type:n,key:i,ref:a,props:s,_owner:vp.current}}function tN(n,e){return{$$typeof:wc,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function xp(n){return typeof n=="object"&&n!==null&&n.$$typeof===wc}function nN(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var ly=/\/+/g;function tm(n,e){return typeof n=="object"&&n!==null&&n.key!=null?nN(""+n.key):e.toString(36)}function Du(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case wc:case qI:a=!0}}if(a)return a=n,s=s(a),n=r===""?"."+tm(a,0):r,oy(s)?(t="",n!=null&&(t=n.replace(ly,"$&/")+"/"),Du(s,e,t,"",function(d){return d})):s!=null&&(xp(s)&&(s=tN(s,t+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(ly,"$&/")+"/")+n)),e.push(s)),1;if(a=0,r=r===""?".":r+":",oy(n))for(var l=0;l<n.length;l++){i=n[l];var c=r+tm(i,l);a+=Du(i,e,t,c,s)}else if(c=eN(n),typeof c=="function")for(n=c.call(n),l=0;!(i=n.next()).done;)i=i.value,c=r+tm(i,l++),a+=Du(i,e,t,c,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function ou(n,e,t){if(n==null)return n;var r=[],s=0;return Du(n,r,"","",function(i){return e.call(t,i,s++)}),r}function rN(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Hn={current:null},Mu={transition:null},sN={ReactCurrentDispatcher:Hn,ReactCurrentBatchConfig:Mu,ReactCurrentOwner:vp};function _b(){throw Error("act(...) is not supported in production builds of React.")}Ue.Children={map:ou,forEach:function(n,e,t){ou(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return ou(n,function(){e++}),e},toArray:function(n){return ou(n,function(e){return e})||[]},only:function(n){if(!xp(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Ue.Component=ko;Ue.Fragment=WI;Ue.Profiler=GI;Ue.PureComponent=gp;Ue.StrictMode=HI;Ue.Suspense=JI;Ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sN;Ue.act=_b;Ue.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=gb({},n.props),s=n.key,i=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=vp.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var l=n.type.defaultProps;for(c in e)xb.call(e,c)&&!bb.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=t;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:wc,type:n.type,key:s,ref:i,props:r,_owner:a}};Ue.createContext=function(n){return n={$$typeof:QI,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:KI,_context:n},n.Consumer=n};Ue.createElement=wb;Ue.createFactory=function(n){var e=wb.bind(null,n);return e.type=n,e};Ue.createRef=function(){return{current:null}};Ue.forwardRef=function(n){return{$$typeof:YI,render:n}};Ue.isValidElement=xp;Ue.lazy=function(n){return{$$typeof:ZI,_payload:{_status:-1,_result:n},_init:rN}};Ue.memo=function(n,e){return{$$typeof:XI,type:n,compare:e===void 0?null:e}};Ue.startTransition=function(n){var e=Mu.transition;Mu.transition={};try{n()}finally{Mu.transition=e}};Ue.unstable_act=_b;Ue.useCallback=function(n,e){return Hn.current.useCallback(n,e)};Ue.useContext=function(n){return Hn.current.useContext(n)};Ue.useDebugValue=function(){};Ue.useDeferredValue=function(n){return Hn.current.useDeferredValue(n)};Ue.useEffect=function(n,e){return Hn.current.useEffect(n,e)};Ue.useId=function(){return Hn.current.useId()};Ue.useImperativeHandle=function(n,e,t){return Hn.current.useImperativeHandle(n,e,t)};Ue.useInsertionEffect=function(n,e){return Hn.current.useInsertionEffect(n,e)};Ue.useLayoutEffect=function(n,e){return Hn.current.useLayoutEffect(n,e)};Ue.useMemo=function(n,e){return Hn.current.useMemo(n,e)};Ue.useReducer=function(n,e,t){return Hn.current.useReducer(n,e,t)};Ue.useRef=function(n){return Hn.current.useRef(n)};Ue.useState=function(n){return Hn.current.useState(n)};Ue.useSyncExternalStore=function(n,e,t){return Hn.current.useSyncExternalStore(n,e,t)};Ue.useTransition=function(){return Hn.current.useTransition()};Ue.version="18.3.1";fb.exports=Ue;var I=fb.exports;const Eb=zI(I),iN=BI({__proto__:null,default:Eb},[I]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aN=I,oN=Symbol.for("react.element"),lN=Symbol.for("react.fragment"),cN=Object.prototype.hasOwnProperty,uN=aN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,dN={key:!0,ref:!0,__self:!0,__source:!0};function Tb(n,e,t){var r,s={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)cN.call(e,r)&&!dN.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:oN,type:n,key:i,ref:a,props:s,_owner:uN.current}}th.Fragment=lN;th.jsx=Tb;th.jsxs=Tb;mb.exports=th;var o=mb.exports,Bm={},Sb={exports:{}},ur={},Ib={exports:{}},Nb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(V,K){var Y=V.length;V.push(K);e:for(;0<Y;){var fe=Y-1>>>1,ae=V[fe];if(0<s(ae,K))V[fe]=K,V[Y]=ae,Y=fe;else break e}}function t(V){return V.length===0?null:V[0]}function r(V){if(V.length===0)return null;var K=V[0],Y=V.pop();if(Y!==K){V[0]=Y;e:for(var fe=0,ae=V.length,te=ae>>>1;fe<te;){var U=2*(fe+1)-1,me=V[U],Ae=U+1,Qe=V[Ae];if(0>s(me,Y))Ae<ae&&0>s(Qe,me)?(V[fe]=Qe,V[Ae]=Y,fe=Ae):(V[fe]=me,V[U]=Y,fe=U);else if(Ae<ae&&0>s(Qe,Y))V[fe]=Qe,V[Ae]=Y,fe=Ae;else break e}}return K}function s(V,K){var Y=V.sortIndex-K.sortIndex;return Y!==0?Y:V.id-K.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();n.unstable_now=function(){return a.now()-l}}var c=[],d=[],h=1,m=null,p=3,y=!1,v=!1,S=!1,E=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(V){for(var K=t(d);K!==null;){if(K.callback===null)r(d);else if(K.startTime<=V)r(d),K.sortIndex=K.expirationTime,e(c,K);else break;K=t(d)}}function k(V){if(S=!1,C(V),!v)if(t(c)!==null)v=!0,Fe(M);else{var K=t(d);K!==null&&et(k,K.startTime-V)}}function M(V,K){v=!1,S&&(S=!1,_(b),b=-1),y=!0;var Y=p;try{for(C(K),m=t(c);m!==null&&(!(m.expirationTime>K)||V&&!j());){var fe=m.callback;if(typeof fe=="function"){m.callback=null,p=m.priorityLevel;var ae=fe(m.expirationTime<=K);K=n.unstable_now(),typeof ae=="function"?m.callback=ae:m===t(c)&&r(c),C(K)}else r(c);m=t(c)}if(m!==null)var te=!0;else{var U=t(d);U!==null&&et(k,U.startTime-K),te=!1}return te}finally{m=null,p=Y,y=!1}}var F=!1,w=null,b=-1,N=5,A=-1;function j(){return!(n.unstable_now()-A<N)}function D(){if(w!==null){var V=n.unstable_now();A=V;var K=!0;try{K=w(!0,V)}finally{K?P():(F=!1,w=null)}}else F=!1}var P;if(typeof x=="function")P=function(){x(D)};else if(typeof MessageChannel<"u"){var Ve=new MessageChannel,je=Ve.port2;Ve.port1.onmessage=D,P=function(){je.postMessage(null)}}else P=function(){E(D,0)};function Fe(V){w=V,F||(F=!0,P())}function et(V,K){b=E(function(){V(n.unstable_now())},K)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(V){V.callback=null},n.unstable_continueExecution=function(){v||y||(v=!0,Fe(M))},n.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<V?Math.floor(1e3/V):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(V){switch(p){case 1:case 2:case 3:var K=3;break;default:K=p}var Y=p;p=K;try{return V()}finally{p=Y}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(V,K){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var Y=p;p=V;try{return K()}finally{p=Y}},n.unstable_scheduleCallback=function(V,K,Y){var fe=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?fe+Y:fe):Y=fe,V){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=Y+ae,V={id:h++,callback:K,priorityLevel:V,startTime:Y,expirationTime:ae,sortIndex:-1},Y>fe?(V.sortIndex=Y,e(d,V),t(c)===null&&V===t(d)&&(S?(_(b),b=-1):S=!0,et(k,Y-fe))):(V.sortIndex=ae,e(c,V),v||y||(v=!0,Fe(M))),V},n.unstable_shouldYield=j,n.unstable_wrapCallback=function(V){var K=p;return function(){var Y=p;p=K;try{return V.apply(this,arguments)}finally{p=Y}}}})(Nb);Ib.exports=Nb;var hN=Ib.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mN=I,lr=hN;function se(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Cb=new Set,Bl={};function da(n,e){io(n,e),io(n+"Capture",e)}function io(n,e){for(Bl[n]=e,n=0;n<e.length;n++)Cb.add(e[n])}var rs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),zm=Object.prototype.hasOwnProperty,fN=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,cy={},uy={};function pN(n){return zm.call(uy,n)?!0:zm.call(cy,n)?!1:fN.test(n)?uy[n]=!0:(cy[n]=!0,!1)}function gN(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function yN(n,e,t,r){if(e===null||typeof e>"u"||gN(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Gn(n,e,t,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var _n={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){_n[n]=new Gn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];_n[e]=new Gn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){_n[n]=new Gn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){_n[n]=new Gn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){_n[n]=new Gn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){_n[n]=new Gn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){_n[n]=new Gn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){_n[n]=new Gn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){_n[n]=new Gn(n,5,!1,n.toLowerCase(),null,!1,!1)});var bp=/[\-:]([a-z])/g;function wp(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(bp,wp);_n[e]=new Gn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(bp,wp);_n[e]=new Gn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(bp,wp);_n[e]=new Gn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){_n[n]=new Gn(n,1,!1,n.toLowerCase(),null,!1,!1)});_n.xlinkHref=new Gn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){_n[n]=new Gn(n,1,!1,n.toLowerCase(),null,!0,!0)});function _p(n,e,t,r){var s=_n.hasOwnProperty(e)?_n[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(yN(e,t,s,r)&&(t=null),r||s===null?pN(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var ms=mN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,lu=Symbol.for("react.element"),Ma=Symbol.for("react.portal"),Va=Symbol.for("react.fragment"),Ep=Symbol.for("react.strict_mode"),qm=Symbol.for("react.profiler"),Ab=Symbol.for("react.provider"),kb=Symbol.for("react.context"),Tp=Symbol.for("react.forward_ref"),Wm=Symbol.for("react.suspense"),Hm=Symbol.for("react.suspense_list"),Sp=Symbol.for("react.memo"),js=Symbol.for("react.lazy"),Pb=Symbol.for("react.offscreen"),dy=Symbol.iterator;function rl(n){return n===null||typeof n!="object"?null:(n=dy&&n[dy]||n["@@iterator"],typeof n=="function"?n:null)}var Lt=Object.assign,nm;function gl(n){if(nm===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);nm=e&&e[1]||""}return`
`+nm+n}var rm=!1;function sm(n,e){if(!n||rm)return"";rm=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(n,[],e)}else{try{e.call()}catch(d){r=d}n.call(e.prototype)}else{try{throw Error()}catch(d){r=d}n()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,l=i.length-1;1<=a&&0<=l&&s[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(s[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||s[a]!==i[l]){var c=`
`+s[a].replace(" at new "," at ");return n.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",n.displayName)),c}while(1<=a&&0<=l);break}}}finally{rm=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?gl(n):""}function vN(n){switch(n.tag){case 5:return gl(n.type);case 16:return gl("Lazy");case 13:return gl("Suspense");case 19:return gl("SuspenseList");case 0:case 2:case 15:return n=sm(n.type,!1),n;case 11:return n=sm(n.type.render,!1),n;case 1:return n=sm(n.type,!0),n;default:return""}}function Gm(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Va:return"Fragment";case Ma:return"Portal";case qm:return"Profiler";case Ep:return"StrictMode";case Wm:return"Suspense";case Hm:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case kb:return(n.displayName||"Context")+".Consumer";case Ab:return(n._context.displayName||"Context")+".Provider";case Tp:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Sp:return e=n.displayName||null,e!==null?e:Gm(n.type)||"Memo";case js:e=n._payload,n=n._init;try{return Gm(n(e))}catch{}}return null}function xN(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Gm(e);case 8:return e===Ep?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ai(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function jb(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function bN(n){var e=jb(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function cu(n){n._valueTracker||(n._valueTracker=bN(n))}function Rb(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=jb(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function ad(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Km(n,e){var t=e.checked;return Lt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function hy(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=ai(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Db(n,e){e=e.checked,e!=null&&_p(n,"checked",e,!1)}function Qm(n,e){Db(n,e);var t=ai(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Ym(n,e.type,t):e.hasOwnProperty("defaultValue")&&Ym(n,e.type,ai(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function my(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Ym(n,e,t){(e!=="number"||ad(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var yl=Array.isArray;function Ka(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+ai(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function Jm(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(se(91));return Lt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function fy(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(se(92));if(yl(t)){if(1<t.length)throw Error(se(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:ai(t)}}function Mb(n,e){var t=ai(e.value),r=ai(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function py(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function Vb(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Xm(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?Vb(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var uu,Lb=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(uu=uu||document.createElement("div"),uu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=uu.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function zl(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Il={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},wN=["Webkit","ms","Moz","O"];Object.keys(Il).forEach(function(n){wN.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Il[e]=Il[n]})});function Ob(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Il.hasOwnProperty(n)&&Il[n]?(""+e).trim():e+"px"}function Fb(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=Ob(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var _N=Lt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Zm(n,e){if(e){if(_N[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(se(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(se(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(se(61))}if(e.style!=null&&typeof e.style!="object")throw Error(se(62))}}function ef(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var tf=null;function Ip(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var nf=null,Qa=null,Ya=null;function gy(n){if(n=Tc(n)){if(typeof nf!="function")throw Error(se(280));var e=n.stateNode;e&&(e=ah(e),nf(n.stateNode,n.type,e))}}function $b(n){Qa?Ya?Ya.push(n):Ya=[n]:Qa=n}function Ub(){if(Qa){var n=Qa,e=Ya;if(Ya=Qa=null,gy(n),e)for(n=0;n<e.length;n++)gy(e[n])}}function Bb(n,e){return n(e)}function zb(){}var im=!1;function qb(n,e,t){if(im)return n(e,t);im=!0;try{return Bb(n,e,t)}finally{im=!1,(Qa!==null||Ya!==null)&&(zb(),Ub())}}function ql(n,e){var t=n.stateNode;if(t===null)return null;var r=ah(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(se(231,e,typeof t));return t}var rf=!1;if(rs)try{var sl={};Object.defineProperty(sl,"passive",{get:function(){rf=!0}}),window.addEventListener("test",sl,sl),window.removeEventListener("test",sl,sl)}catch{rf=!1}function EN(n,e,t,r,s,i,a,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(t,d)}catch(h){this.onError(h)}}var Nl=!1,od=null,ld=!1,sf=null,TN={onError:function(n){Nl=!0,od=n}};function SN(n,e,t,r,s,i,a,l,c){Nl=!1,od=null,EN.apply(TN,arguments)}function IN(n,e,t,r,s,i,a,l,c){if(SN.apply(this,arguments),Nl){if(Nl){var d=od;Nl=!1,od=null}else throw Error(se(198));ld||(ld=!0,sf=d)}}function ha(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Wb(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function yy(n){if(ha(n)!==n)throw Error(se(188))}function NN(n){var e=n.alternate;if(!e){if(e=ha(n),e===null)throw Error(se(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return yy(s),n;if(i===r)return yy(s),e;i=i.sibling}throw Error(se(188))}if(t.return!==r.return)t=s,r=i;else{for(var a=!1,l=s.child;l;){if(l===t){a=!0,t=s,r=i;break}if(l===r){a=!0,r=s,t=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===t){a=!0,t=i,r=s;break}if(l===r){a=!0,r=i,t=s;break}l=l.sibling}if(!a)throw Error(se(189))}}if(t.alternate!==r)throw Error(se(190))}if(t.tag!==3)throw Error(se(188));return t.stateNode.current===t?n:e}function Hb(n){return n=NN(n),n!==null?Gb(n):null}function Gb(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Gb(n);if(e!==null)return e;n=n.sibling}return null}var Kb=lr.unstable_scheduleCallback,vy=lr.unstable_cancelCallback,CN=lr.unstable_shouldYield,AN=lr.unstable_requestPaint,Ht=lr.unstable_now,kN=lr.unstable_getCurrentPriorityLevel,Np=lr.unstable_ImmediatePriority,Qb=lr.unstable_UserBlockingPriority,cd=lr.unstable_NormalPriority,PN=lr.unstable_LowPriority,Yb=lr.unstable_IdlePriority,nh=null,Vr=null;function jN(n){if(Vr&&typeof Vr.onCommitFiberRoot=="function")try{Vr.onCommitFiberRoot(nh,n,void 0,(n.current.flags&128)===128)}catch{}}var Ir=Math.clz32?Math.clz32:MN,RN=Math.log,DN=Math.LN2;function MN(n){return n>>>=0,n===0?32:31-(RN(n)/DN|0)|0}var du=64,hu=4194304;function vl(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ud(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,a=t&268435455;if(a!==0){var l=a&~s;l!==0?r=vl(l):(i&=a,i!==0&&(r=vl(i)))}else a=t&~s,a!==0?r=vl(a):i!==0&&(r=vl(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Ir(e),s=1<<t,r|=n[t],e&=~s;return r}function VN(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function LN(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var a=31-Ir(i),l=1<<a,c=s[a];c===-1?(!(l&t)||l&r)&&(s[a]=VN(l,e)):c<=e&&(n.expiredLanes|=l),i&=~l}}function af(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Jb(){var n=du;return du<<=1,!(du&4194240)&&(du=64),n}function am(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function _c(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Ir(e),n[e]=t}function ON(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-Ir(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function Cp(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Ir(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var ut=0;function Xb(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Zb,Ap,ew,tw,nw,of=!1,mu=[],Ks=null,Qs=null,Ys=null,Wl=new Map,Hl=new Map,Ds=[],FN="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function xy(n,e){switch(n){case"focusin":case"focusout":Ks=null;break;case"dragenter":case"dragleave":Qs=null;break;case"mouseover":case"mouseout":Ys=null;break;case"pointerover":case"pointerout":Wl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hl.delete(e.pointerId)}}function il(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Tc(e),e!==null&&Ap(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function $N(n,e,t,r,s){switch(e){case"focusin":return Ks=il(Ks,n,e,t,r,s),!0;case"dragenter":return Qs=il(Qs,n,e,t,r,s),!0;case"mouseover":return Ys=il(Ys,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return Wl.set(i,il(Wl.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Hl.set(i,il(Hl.get(i)||null,n,e,t,r,s)),!0}return!1}function rw(n){var e=Fi(n.target);if(e!==null){var t=ha(e);if(t!==null){if(e=t.tag,e===13){if(e=Wb(t),e!==null){n.blockedOn=e,nw(n.priority,function(){ew(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Vu(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=lf(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);tf=r,t.target.dispatchEvent(r),tf=null}else return e=Tc(t),e!==null&&Ap(e),n.blockedOn=t,!1;e.shift()}return!0}function by(n,e,t){Vu(n)&&t.delete(e)}function UN(){of=!1,Ks!==null&&Vu(Ks)&&(Ks=null),Qs!==null&&Vu(Qs)&&(Qs=null),Ys!==null&&Vu(Ys)&&(Ys=null),Wl.forEach(by),Hl.forEach(by)}function al(n,e){n.blockedOn===e&&(n.blockedOn=null,of||(of=!0,lr.unstable_scheduleCallback(lr.unstable_NormalPriority,UN)))}function Gl(n){function e(s){return al(s,n)}if(0<mu.length){al(mu[0],n);for(var t=1;t<mu.length;t++){var r=mu[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Ks!==null&&al(Ks,n),Qs!==null&&al(Qs,n),Ys!==null&&al(Ys,n),Wl.forEach(e),Hl.forEach(e),t=0;t<Ds.length;t++)r=Ds[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Ds.length&&(t=Ds[0],t.blockedOn===null);)rw(t),t.blockedOn===null&&Ds.shift()}var Ja=ms.ReactCurrentBatchConfig,dd=!0;function BN(n,e,t,r){var s=ut,i=Ja.transition;Ja.transition=null;try{ut=1,kp(n,e,t,r)}finally{ut=s,Ja.transition=i}}function zN(n,e,t,r){var s=ut,i=Ja.transition;Ja.transition=null;try{ut=4,kp(n,e,t,r)}finally{ut=s,Ja.transition=i}}function kp(n,e,t,r){if(dd){var s=lf(n,e,t,r);if(s===null)gm(n,e,r,hd,t),xy(n,r);else if($N(s,n,e,t,r))r.stopPropagation();else if(xy(n,r),e&4&&-1<FN.indexOf(n)){for(;s!==null;){var i=Tc(s);if(i!==null&&Zb(i),i=lf(n,e,t,r),i===null&&gm(n,e,r,hd,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else gm(n,e,r,null,t)}}var hd=null;function lf(n,e,t,r){if(hd=null,n=Ip(r),n=Fi(n),n!==null)if(e=ha(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Wb(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return hd=n,null}function sw(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(kN()){case Np:return 1;case Qb:return 4;case cd:case PN:return 16;case Yb:return 536870912;default:return 16}default:return 16}}var qs=null,Pp=null,Lu=null;function iw(){if(Lu)return Lu;var n,e=Pp,t=e.length,r,s="value"in qs?qs.value:qs.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var a=t-n;for(r=1;r<=a&&e[t-r]===s[i-r];r++);return Lu=s.slice(n,1<r?1-r:void 0)}function Ou(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function fu(){return!0}function wy(){return!1}function dr(n){function e(t,r,s,i,a){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in n)n.hasOwnProperty(l)&&(t=n[l],this[l]=t?t(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?fu:wy,this.isPropagationStopped=wy,this}return Lt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=fu)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=fu)},persist:function(){},isPersistent:fu}),e}var Po={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jp=dr(Po),Ec=Lt({},Po,{view:0,detail:0}),qN=dr(Ec),om,lm,ol,rh=Lt({},Ec,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Rp,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ol&&(ol&&n.type==="mousemove"?(om=n.screenX-ol.screenX,lm=n.screenY-ol.screenY):lm=om=0,ol=n),om)},movementY:function(n){return"movementY"in n?n.movementY:lm}}),_y=dr(rh),WN=Lt({},rh,{dataTransfer:0}),HN=dr(WN),GN=Lt({},Ec,{relatedTarget:0}),cm=dr(GN),KN=Lt({},Po,{animationName:0,elapsedTime:0,pseudoElement:0}),QN=dr(KN),YN=Lt({},Po,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),JN=dr(YN),XN=Lt({},Po,{data:0}),Ey=dr(XN),ZN={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},e1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},t1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function n1(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=t1[n])?!!e[n]:!1}function Rp(){return n1}var r1=Lt({},Ec,{key:function(n){if(n.key){var e=ZN[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Ou(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?e1[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Rp,charCode:function(n){return n.type==="keypress"?Ou(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Ou(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),s1=dr(r1),i1=Lt({},rh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ty=dr(i1),a1=Lt({},Ec,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Rp}),o1=dr(a1),l1=Lt({},Po,{propertyName:0,elapsedTime:0,pseudoElement:0}),c1=dr(l1),u1=Lt({},rh,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),d1=dr(u1),h1=[9,13,27,32],Dp=rs&&"CompositionEvent"in window,Cl=null;rs&&"documentMode"in document&&(Cl=document.documentMode);var m1=rs&&"TextEvent"in window&&!Cl,aw=rs&&(!Dp||Cl&&8<Cl&&11>=Cl),Sy=String.fromCharCode(32),Iy=!1;function ow(n,e){switch(n){case"keyup":return h1.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function lw(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var La=!1;function f1(n,e){switch(n){case"compositionend":return lw(e);case"keypress":return e.which!==32?null:(Iy=!0,Sy);case"textInput":return n=e.data,n===Sy&&Iy?null:n;default:return null}}function p1(n,e){if(La)return n==="compositionend"||!Dp&&ow(n,e)?(n=iw(),Lu=Pp=qs=null,La=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return aw&&e.locale!=="ko"?null:e.data;default:return null}}var g1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ny(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!g1[n.type]:e==="textarea"}function cw(n,e,t,r){$b(r),e=md(e,"onChange"),0<e.length&&(t=new jp("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Al=null,Kl=null;function y1(n){bw(n,0)}function sh(n){var e=$a(n);if(Rb(e))return n}function v1(n,e){if(n==="change")return e}var uw=!1;if(rs){var um;if(rs){var dm="oninput"in document;if(!dm){var Cy=document.createElement("div");Cy.setAttribute("oninput","return;"),dm=typeof Cy.oninput=="function"}um=dm}else um=!1;uw=um&&(!document.documentMode||9<document.documentMode)}function Ay(){Al&&(Al.detachEvent("onpropertychange",dw),Kl=Al=null)}function dw(n){if(n.propertyName==="value"&&sh(Kl)){var e=[];cw(e,Kl,n,Ip(n)),qb(y1,e)}}function x1(n,e,t){n==="focusin"?(Ay(),Al=e,Kl=t,Al.attachEvent("onpropertychange",dw)):n==="focusout"&&Ay()}function b1(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return sh(Kl)}function w1(n,e){if(n==="click")return sh(e)}function _1(n,e){if(n==="input"||n==="change")return sh(e)}function E1(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Cr=typeof Object.is=="function"?Object.is:E1;function Ql(n,e){if(Cr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!zm.call(e,s)||!Cr(n[s],e[s]))return!1}return!0}function ky(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Py(n,e){var t=ky(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=ky(t)}}function hw(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?hw(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function mw(){for(var n=window,e=ad();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ad(n.document)}return e}function Mp(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function T1(n){var e=mw(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&hw(t.ownerDocument.documentElement,t)){if(r!==null&&Mp(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=Py(t,i);var a=Py(t,r);s&&a&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var S1=rs&&"documentMode"in document&&11>=document.documentMode,Oa=null,cf=null,kl=null,uf=!1;function jy(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;uf||Oa==null||Oa!==ad(r)||(r=Oa,"selectionStart"in r&&Mp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),kl&&Ql(kl,r)||(kl=r,r=md(cf,"onSelect"),0<r.length&&(e=new jp("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Oa)))}function pu(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Fa={animationend:pu("Animation","AnimationEnd"),animationiteration:pu("Animation","AnimationIteration"),animationstart:pu("Animation","AnimationStart"),transitionend:pu("Transition","TransitionEnd")},hm={},fw={};rs&&(fw=document.createElement("div").style,"AnimationEvent"in window||(delete Fa.animationend.animation,delete Fa.animationiteration.animation,delete Fa.animationstart.animation),"TransitionEvent"in window||delete Fa.transitionend.transition);function ih(n){if(hm[n])return hm[n];if(!Fa[n])return n;var e=Fa[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in fw)return hm[n]=e[t];return n}var pw=ih("animationend"),gw=ih("animationiteration"),yw=ih("animationstart"),vw=ih("transitionend"),xw=new Map,Ry="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function gi(n,e){xw.set(n,e),da(e,[n])}for(var mm=0;mm<Ry.length;mm++){var fm=Ry[mm],I1=fm.toLowerCase(),N1=fm[0].toUpperCase()+fm.slice(1);gi(I1,"on"+N1)}gi(pw,"onAnimationEnd");gi(gw,"onAnimationIteration");gi(yw,"onAnimationStart");gi("dblclick","onDoubleClick");gi("focusin","onFocus");gi("focusout","onBlur");gi(vw,"onTransitionEnd");io("onMouseEnter",["mouseout","mouseover"]);io("onMouseLeave",["mouseout","mouseover"]);io("onPointerEnter",["pointerout","pointerover"]);io("onPointerLeave",["pointerout","pointerover"]);da("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));da("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));da("onBeforeInput",["compositionend","keypress","textInput","paste"]);da("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));da("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));da("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),C1=new Set("cancel close invalid load scroll toggle".split(" ").concat(xl));function Dy(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,IN(r,e,void 0,n),n.currentTarget=null}function bw(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var l=r[a],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;Dy(s,l,d),i=c}else for(a=0;a<r.length;a++){if(l=r[a],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;Dy(s,l,d),i=c}}}if(ld)throw n=sf,ld=!1,sf=null,n}function Tt(n,e){var t=e[pf];t===void 0&&(t=e[pf]=new Set);var r=n+"__bubble";t.has(r)||(ww(e,n,2,!1),t.add(r))}function pm(n,e,t){var r=0;e&&(r|=4),ww(t,n,r,e)}var gu="_reactListening"+Math.random().toString(36).slice(2);function Yl(n){if(!n[gu]){n[gu]=!0,Cb.forEach(function(t){t!=="selectionchange"&&(C1.has(t)||pm(t,!1,n),pm(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[gu]||(e[gu]=!0,pm("selectionchange",!1,e))}}function ww(n,e,t,r){switch(sw(e)){case 1:var s=BN;break;case 4:s=zN;break;default:s=kp}t=s.bind(null,e,t,n),s=void 0,!rf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function gm(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;a=a.return}for(;l!==null;){if(a=Fi(l),a===null)return;if(c=a.tag,c===5||c===6){r=i=a;continue e}l=l.parentNode}}r=r.return}qb(function(){var d=i,h=Ip(t),m=[];e:{var p=xw.get(n);if(p!==void 0){var y=jp,v=n;switch(n){case"keypress":if(Ou(t)===0)break e;case"keydown":case"keyup":y=s1;break;case"focusin":v="focus",y=cm;break;case"focusout":v="blur",y=cm;break;case"beforeblur":case"afterblur":y=cm;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=_y;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=HN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=o1;break;case pw:case gw:case yw:y=QN;break;case vw:y=c1;break;case"scroll":y=qN;break;case"wheel":y=d1;break;case"copy":case"cut":case"paste":y=JN;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=Ty}var S=(e&4)!==0,E=!S&&n==="scroll",_=S?p!==null?p+"Capture":null:p;S=[];for(var x=d,C;x!==null;){C=x;var k=C.stateNode;if(C.tag===5&&k!==null&&(C=k,_!==null&&(k=ql(x,_),k!=null&&S.push(Jl(x,k,C)))),E)break;x=x.return}0<S.length&&(p=new y(p,v,null,t,h),m.push({event:p,listeners:S}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",p&&t!==tf&&(v=t.relatedTarget||t.fromElement)&&(Fi(v)||v[ss]))break e;if((y||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,y?(v=t.relatedTarget||t.toElement,y=d,v=v?Fi(v):null,v!==null&&(E=ha(v),v!==E||v.tag!==5&&v.tag!==6)&&(v=null)):(y=null,v=d),y!==v)){if(S=_y,k="onMouseLeave",_="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(S=Ty,k="onPointerLeave",_="onPointerEnter",x="pointer"),E=y==null?p:$a(y),C=v==null?p:$a(v),p=new S(k,x+"leave",y,t,h),p.target=E,p.relatedTarget=C,k=null,Fi(h)===d&&(S=new S(_,x+"enter",v,t,h),S.target=C,S.relatedTarget=E,k=S),E=k,y&&v)t:{for(S=y,_=v,x=0,C=S;C;C=Sa(C))x++;for(C=0,k=_;k;k=Sa(k))C++;for(;0<x-C;)S=Sa(S),x--;for(;0<C-x;)_=Sa(_),C--;for(;x--;){if(S===_||_!==null&&S===_.alternate)break t;S=Sa(S),_=Sa(_)}S=null}else S=null;y!==null&&My(m,p,y,S,!1),v!==null&&E!==null&&My(m,E,v,S,!0)}}e:{if(p=d?$a(d):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var M=v1;else if(Ny(p))if(uw)M=_1;else{M=b1;var F=x1}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(M=w1);if(M&&(M=M(n,d))){cw(m,M,t,h);break e}F&&F(n,p,d),n==="focusout"&&(F=p._wrapperState)&&F.controlled&&p.type==="number"&&Ym(p,"number",p.value)}switch(F=d?$a(d):window,n){case"focusin":(Ny(F)||F.contentEditable==="true")&&(Oa=F,cf=d,kl=null);break;case"focusout":kl=cf=Oa=null;break;case"mousedown":uf=!0;break;case"contextmenu":case"mouseup":case"dragend":uf=!1,jy(m,t,h);break;case"selectionchange":if(S1)break;case"keydown":case"keyup":jy(m,t,h)}var w;if(Dp)e:{switch(n){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else La?ow(n,t)&&(b="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(b="onCompositionStart");b&&(aw&&t.locale!=="ko"&&(La||b!=="onCompositionStart"?b==="onCompositionEnd"&&La&&(w=iw()):(qs=h,Pp="value"in qs?qs.value:qs.textContent,La=!0)),F=md(d,b),0<F.length&&(b=new Ey(b,n,null,t,h),m.push({event:b,listeners:F}),w?b.data=w:(w=lw(t),w!==null&&(b.data=w)))),(w=m1?f1(n,t):p1(n,t))&&(d=md(d,"onBeforeInput"),0<d.length&&(h=new Ey("onBeforeInput","beforeinput",null,t,h),m.push({event:h,listeners:d}),h.data=w))}bw(m,e)})}function Jl(n,e,t){return{instance:n,listener:e,currentTarget:t}}function md(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=ql(n,t),i!=null&&r.unshift(Jl(n,i,s)),i=ql(n,e),i!=null&&r.push(Jl(n,i,s))),n=n.return}return r}function Sa(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function My(n,e,t,r,s){for(var i=e._reactName,a=[];t!==null&&t!==r;){var l=t,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=ql(t,i),c!=null&&a.unshift(Jl(t,c,l))):s||(c=ql(t,i),c!=null&&a.push(Jl(t,c,l)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var A1=/\r\n?/g,k1=/\u0000|\uFFFD/g;function Vy(n){return(typeof n=="string"?n:""+n).replace(A1,`
`).replace(k1,"")}function yu(n,e,t){if(e=Vy(e),Vy(n)!==e&&t)throw Error(se(425))}function fd(){}var df=null,hf=null;function mf(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var ff=typeof setTimeout=="function"?setTimeout:void 0,P1=typeof clearTimeout=="function"?clearTimeout:void 0,Ly=typeof Promise=="function"?Promise:void 0,j1=typeof queueMicrotask=="function"?queueMicrotask:typeof Ly<"u"?function(n){return Ly.resolve(null).then(n).catch(R1)}:ff;function R1(n){setTimeout(function(){throw n})}function ym(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Gl(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Gl(e)}function Js(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function Oy(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var jo=Math.random().toString(36).slice(2),jr="__reactFiber$"+jo,Xl="__reactProps$"+jo,ss="__reactContainer$"+jo,pf="__reactEvents$"+jo,D1="__reactListeners$"+jo,M1="__reactHandles$"+jo;function Fi(n){var e=n[jr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[ss]||t[jr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=Oy(n);n!==null;){if(t=n[jr])return t;n=Oy(n)}return e}n=t,t=n.parentNode}return null}function Tc(n){return n=n[jr]||n[ss],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function $a(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(se(33))}function ah(n){return n[Xl]||null}var gf=[],Ua=-1;function yi(n){return{current:n}}function It(n){0>Ua||(n.current=gf[Ua],gf[Ua]=null,Ua--)}function bt(n,e){Ua++,gf[Ua]=n.current,n.current=e}var oi={},Ln=yi(oi),er=yi(!1),Gi=oi;function ao(n,e){var t=n.type.contextTypes;if(!t)return oi;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function tr(n){return n=n.childContextTypes,n!=null}function pd(){It(er),It(Ln)}function Fy(n,e,t){if(Ln.current!==oi)throw Error(se(168));bt(Ln,e),bt(er,t)}function _w(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(se(108,xN(n)||"Unknown",s));return Lt({},t,r)}function gd(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||oi,Gi=Ln.current,bt(Ln,n),bt(er,er.current),!0}function $y(n,e,t){var r=n.stateNode;if(!r)throw Error(se(169));t?(n=_w(n,e,Gi),r.__reactInternalMemoizedMergedChildContext=n,It(er),It(Ln),bt(Ln,n)):It(er),bt(er,t)}var Gr=null,oh=!1,vm=!1;function Ew(n){Gr===null?Gr=[n]:Gr.push(n)}function V1(n){oh=!0,Ew(n)}function vi(){if(!vm&&Gr!==null){vm=!0;var n=0,e=ut;try{var t=Gr;for(ut=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Gr=null,oh=!1}catch(s){throw Gr!==null&&(Gr=Gr.slice(n+1)),Kb(Np,vi),s}finally{ut=e,vm=!1}}return null}var Ba=[],za=0,yd=null,vd=0,mr=[],fr=0,Ki=null,Qr=1,Yr="";function ki(n,e){Ba[za++]=vd,Ba[za++]=yd,yd=n,vd=e}function Tw(n,e,t){mr[fr++]=Qr,mr[fr++]=Yr,mr[fr++]=Ki,Ki=n;var r=Qr;n=Yr;var s=32-Ir(r)-1;r&=~(1<<s),t+=1;var i=32-Ir(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,Qr=1<<32-Ir(e)+s|t<<s|r,Yr=i+n}else Qr=1<<i|t<<s|r,Yr=n}function Vp(n){n.return!==null&&(ki(n,1),Tw(n,1,0))}function Lp(n){for(;n===yd;)yd=Ba[--za],Ba[za]=null,vd=Ba[--za],Ba[za]=null;for(;n===Ki;)Ki=mr[--fr],mr[fr]=null,Yr=mr[--fr],mr[fr]=null,Qr=mr[--fr],mr[fr]=null}var or=null,ar=null,At=!1,Sr=null;function Sw(n,e){var t=pr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Uy(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,or=n,ar=Js(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,or=n,ar=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ki!==null?{id:Qr,overflow:Yr}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=pr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,or=n,ar=null,!0):!1;default:return!1}}function yf(n){return(n.mode&1)!==0&&(n.flags&128)===0}function vf(n){if(At){var e=ar;if(e){var t=e;if(!Uy(n,e)){if(yf(n))throw Error(se(418));e=Js(t.nextSibling);var r=or;e&&Uy(n,e)?Sw(r,t):(n.flags=n.flags&-4097|2,At=!1,or=n)}}else{if(yf(n))throw Error(se(418));n.flags=n.flags&-4097|2,At=!1,or=n}}}function By(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;or=n}function vu(n){if(n!==or)return!1;if(!At)return By(n),At=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!mf(n.type,n.memoizedProps)),e&&(e=ar)){if(yf(n))throw Iw(),Error(se(418));for(;e;)Sw(n,e),e=Js(e.nextSibling)}if(By(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(se(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){ar=Js(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}ar=null}}else ar=or?Js(n.stateNode.nextSibling):null;return!0}function Iw(){for(var n=ar;n;)n=Js(n.nextSibling)}function oo(){ar=or=null,At=!1}function Op(n){Sr===null?Sr=[n]:Sr.push(n)}var L1=ms.ReactCurrentBatchConfig;function ll(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(se(309));var r=t.stateNode}if(!r)throw Error(se(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var l=s.refs;a===null?delete l[i]:l[i]=a},e._stringRef=i,e)}if(typeof n!="string")throw Error(se(284));if(!t._owner)throw Error(se(290,n))}return n}function xu(n,e){throw n=Object.prototype.toString.call(e),Error(se(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function zy(n){var e=n._init;return e(n._payload)}function Nw(n){function e(_,x){if(n){var C=_.deletions;C===null?(_.deletions=[x],_.flags|=16):C.push(x)}}function t(_,x){if(!n)return null;for(;x!==null;)e(_,x),x=x.sibling;return null}function r(_,x){for(_=new Map;x!==null;)x.key!==null?_.set(x.key,x):_.set(x.index,x),x=x.sibling;return _}function s(_,x){return _=ti(_,x),_.index=0,_.sibling=null,_}function i(_,x,C){return _.index=C,n?(C=_.alternate,C!==null?(C=C.index,C<x?(_.flags|=2,x):C):(_.flags|=2,x)):(_.flags|=1048576,x)}function a(_){return n&&_.alternate===null&&(_.flags|=2),_}function l(_,x,C,k){return x===null||x.tag!==6?(x=Sm(C,_.mode,k),x.return=_,x):(x=s(x,C),x.return=_,x)}function c(_,x,C,k){var M=C.type;return M===Va?h(_,x,C.props.children,k,C.key):x!==null&&(x.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===js&&zy(M)===x.type)?(k=s(x,C.props),k.ref=ll(_,x,C),k.return=_,k):(k=Wu(C.type,C.key,C.props,null,_.mode,k),k.ref=ll(_,x,C),k.return=_,k)}function d(_,x,C,k){return x===null||x.tag!==4||x.stateNode.containerInfo!==C.containerInfo||x.stateNode.implementation!==C.implementation?(x=Im(C,_.mode,k),x.return=_,x):(x=s(x,C.children||[]),x.return=_,x)}function h(_,x,C,k,M){return x===null||x.tag!==7?(x=qi(C,_.mode,k,M),x.return=_,x):(x=s(x,C),x.return=_,x)}function m(_,x,C){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Sm(""+x,_.mode,C),x.return=_,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case lu:return C=Wu(x.type,x.key,x.props,null,_.mode,C),C.ref=ll(_,null,x),C.return=_,C;case Ma:return x=Im(x,_.mode,C),x.return=_,x;case js:var k=x._init;return m(_,k(x._payload),C)}if(yl(x)||rl(x))return x=qi(x,_.mode,C,null),x.return=_,x;xu(_,x)}return null}function p(_,x,C,k){var M=x!==null?x.key:null;if(typeof C=="string"&&C!==""||typeof C=="number")return M!==null?null:l(_,x,""+C,k);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case lu:return C.key===M?c(_,x,C,k):null;case Ma:return C.key===M?d(_,x,C,k):null;case js:return M=C._init,p(_,x,M(C._payload),k)}if(yl(C)||rl(C))return M!==null?null:h(_,x,C,k,null);xu(_,C)}return null}function y(_,x,C,k,M){if(typeof k=="string"&&k!==""||typeof k=="number")return _=_.get(C)||null,l(x,_,""+k,M);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case lu:return _=_.get(k.key===null?C:k.key)||null,c(x,_,k,M);case Ma:return _=_.get(k.key===null?C:k.key)||null,d(x,_,k,M);case js:var F=k._init;return y(_,x,C,F(k._payload),M)}if(yl(k)||rl(k))return _=_.get(C)||null,h(x,_,k,M,null);xu(x,k)}return null}function v(_,x,C,k){for(var M=null,F=null,w=x,b=x=0,N=null;w!==null&&b<C.length;b++){w.index>b?(N=w,w=null):N=w.sibling;var A=p(_,w,C[b],k);if(A===null){w===null&&(w=N);break}n&&w&&A.alternate===null&&e(_,w),x=i(A,x,b),F===null?M=A:F.sibling=A,F=A,w=N}if(b===C.length)return t(_,w),At&&ki(_,b),M;if(w===null){for(;b<C.length;b++)w=m(_,C[b],k),w!==null&&(x=i(w,x,b),F===null?M=w:F.sibling=w,F=w);return At&&ki(_,b),M}for(w=r(_,w);b<C.length;b++)N=y(w,_,b,C[b],k),N!==null&&(n&&N.alternate!==null&&w.delete(N.key===null?b:N.key),x=i(N,x,b),F===null?M=N:F.sibling=N,F=N);return n&&w.forEach(function(j){return e(_,j)}),At&&ki(_,b),M}function S(_,x,C,k){var M=rl(C);if(typeof M!="function")throw Error(se(150));if(C=M.call(C),C==null)throw Error(se(151));for(var F=M=null,w=x,b=x=0,N=null,A=C.next();w!==null&&!A.done;b++,A=C.next()){w.index>b?(N=w,w=null):N=w.sibling;var j=p(_,w,A.value,k);if(j===null){w===null&&(w=N);break}n&&w&&j.alternate===null&&e(_,w),x=i(j,x,b),F===null?M=j:F.sibling=j,F=j,w=N}if(A.done)return t(_,w),At&&ki(_,b),M;if(w===null){for(;!A.done;b++,A=C.next())A=m(_,A.value,k),A!==null&&(x=i(A,x,b),F===null?M=A:F.sibling=A,F=A);return At&&ki(_,b),M}for(w=r(_,w);!A.done;b++,A=C.next())A=y(w,_,b,A.value,k),A!==null&&(n&&A.alternate!==null&&w.delete(A.key===null?b:A.key),x=i(A,x,b),F===null?M=A:F.sibling=A,F=A);return n&&w.forEach(function(D){return e(_,D)}),At&&ki(_,b),M}function E(_,x,C,k){if(typeof C=="object"&&C!==null&&C.type===Va&&C.key===null&&(C=C.props.children),typeof C=="object"&&C!==null){switch(C.$$typeof){case lu:e:{for(var M=C.key,F=x;F!==null;){if(F.key===M){if(M=C.type,M===Va){if(F.tag===7){t(_,F.sibling),x=s(F,C.props.children),x.return=_,_=x;break e}}else if(F.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===js&&zy(M)===F.type){t(_,F.sibling),x=s(F,C.props),x.ref=ll(_,F,C),x.return=_,_=x;break e}t(_,F);break}else e(_,F);F=F.sibling}C.type===Va?(x=qi(C.props.children,_.mode,k,C.key),x.return=_,_=x):(k=Wu(C.type,C.key,C.props,null,_.mode,k),k.ref=ll(_,x,C),k.return=_,_=k)}return a(_);case Ma:e:{for(F=C.key;x!==null;){if(x.key===F)if(x.tag===4&&x.stateNode.containerInfo===C.containerInfo&&x.stateNode.implementation===C.implementation){t(_,x.sibling),x=s(x,C.children||[]),x.return=_,_=x;break e}else{t(_,x);break}else e(_,x);x=x.sibling}x=Im(C,_.mode,k),x.return=_,_=x}return a(_);case js:return F=C._init,E(_,x,F(C._payload),k)}if(yl(C))return v(_,x,C,k);if(rl(C))return S(_,x,C,k);xu(_,C)}return typeof C=="string"&&C!==""||typeof C=="number"?(C=""+C,x!==null&&x.tag===6?(t(_,x.sibling),x=s(x,C),x.return=_,_=x):(t(_,x),x=Sm(C,_.mode,k),x.return=_,_=x),a(_)):t(_,x)}return E}var lo=Nw(!0),Cw=Nw(!1),xd=yi(null),bd=null,qa=null,Fp=null;function $p(){Fp=qa=bd=null}function Up(n){var e=xd.current;It(xd),n._currentValue=e}function xf(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Xa(n,e){bd=n,Fp=qa=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Yn=!0),n.firstContext=null)}function yr(n){var e=n._currentValue;if(Fp!==n)if(n={context:n,memoizedValue:e,next:null},qa===null){if(bd===null)throw Error(se(308));qa=n,bd.dependencies={lanes:0,firstContext:n}}else qa=qa.next=n;return e}var $i=null;function Bp(n){$i===null?$i=[n]:$i.push(n)}function Aw(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,Bp(e)):(t.next=s.next,s.next=t),e.interleaved=t,is(n,r)}function is(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Rs=!1;function zp(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kw(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ts(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Xs(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Xe&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,is(n,t)}return s=r.interleaved,s===null?(e.next=e,Bp(r)):(e.next=s.next,s.next=e),r.interleaved=e,is(n,t)}function Fu(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Cp(n,t)}}function qy(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=a:i=i.next=a,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function wd(n,e,t,r){var s=n.updateQueue;Rs=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,a===null?i=d:a.next=d,a=c;var h=n.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==a&&(l===null?h.firstBaseUpdate=d:l.next=d,h.lastBaseUpdate=c))}if(i!==null){var m=s.baseState;a=0,h=d=c=null,l=i;do{var p=l.lane,y=l.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:y,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var v=n,S=l;switch(p=e,y=t,S.tag){case 1:if(v=S.payload,typeof v=="function"){m=v.call(y,m,p);break e}m=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=S.payload,p=typeof v=="function"?v.call(y,m,p):v,p==null)break e;m=Lt({},m,p);break e;case 2:Rs=!0}}l.callback!==null&&l.lane!==0&&(n.flags|=64,p=s.effects,p===null?s.effects=[l]:p.push(l))}else y={eventTime:y,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(d=h=y,c=m):h=h.next=y,a|=p;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;p=l,l=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(1);if(h===null&&(c=m),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Yi|=a,n.lanes=a,n.memoizedState=m}}function Wy(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(se(191,s));s.call(r)}}}var Sc={},Lr=yi(Sc),Zl=yi(Sc),ec=yi(Sc);function Ui(n){if(n===Sc)throw Error(se(174));return n}function qp(n,e){switch(bt(ec,e),bt(Zl,n),bt(Lr,Sc),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Xm(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Xm(e,n)}It(Lr),bt(Lr,e)}function co(){It(Lr),It(Zl),It(ec)}function Pw(n){Ui(ec.current);var e=Ui(Lr.current),t=Xm(e,n.type);e!==t&&(bt(Zl,n),bt(Lr,t))}function Wp(n){Zl.current===n&&(It(Lr),It(Zl))}var Dt=yi(0);function _d(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var xm=[];function Hp(){for(var n=0;n<xm.length;n++)xm[n]._workInProgressVersionPrimary=null;xm.length=0}var $u=ms.ReactCurrentDispatcher,bm=ms.ReactCurrentBatchConfig,Qi=0,Mt=null,sn=null,hn=null,Ed=!1,Pl=!1,tc=0,O1=0;function kn(){throw Error(se(321))}function Gp(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Cr(n[t],e[t]))return!1;return!0}function Kp(n,e,t,r,s,i){if(Qi=i,Mt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,$u.current=n===null||n.memoizedState===null?B1:z1,n=t(r,s),Pl){i=0;do{if(Pl=!1,tc=0,25<=i)throw Error(se(301));i+=1,hn=sn=null,e.updateQueue=null,$u.current=q1,n=t(r,s)}while(Pl)}if($u.current=Td,e=sn!==null&&sn.next!==null,Qi=0,hn=sn=Mt=null,Ed=!1,e)throw Error(se(300));return n}function Qp(){var n=tc!==0;return tc=0,n}function Pr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return hn===null?Mt.memoizedState=hn=n:hn=hn.next=n,hn}function vr(){if(sn===null){var n=Mt.alternate;n=n!==null?n.memoizedState:null}else n=sn.next;var e=hn===null?Mt.memoizedState:hn.next;if(e!==null)hn=e,sn=n;else{if(n===null)throw Error(se(310));sn=n,n={memoizedState:sn.memoizedState,baseState:sn.baseState,baseQueue:sn.baseQueue,queue:sn.queue,next:null},hn===null?Mt.memoizedState=hn=n:hn=hn.next=n}return hn}function nc(n,e){return typeof e=="function"?e(n):e}function wm(n){var e=vr(),t=e.queue;if(t===null)throw Error(se(311));t.lastRenderedReducer=n;var r=sn,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=a=null,c=null,d=i;do{var h=d.lane;if((Qi&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:n(r,d.action);else{var m={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=m,a=r):c=c.next=m,Mt.lanes|=h,Yi|=h}d=d.next}while(d!==null&&d!==i);c===null?a=r:c.next=l,Cr(r,e.memoizedState)||(Yn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=c,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,Mt.lanes|=i,Yi|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function _m(n){var e=vr(),t=e.queue;if(t===null)throw Error(se(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var a=s=s.next;do i=n(i,a.action),a=a.next;while(a!==s);Cr(i,e.memoizedState)||(Yn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function jw(){}function Rw(n,e){var t=Mt,r=vr(),s=e(),i=!Cr(r.memoizedState,s);if(i&&(r.memoizedState=s,Yn=!0),r=r.queue,Yp(Vw.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||hn!==null&&hn.memoizedState.tag&1){if(t.flags|=2048,rc(9,Mw.bind(null,t,r,s,e),void 0,null),fn===null)throw Error(se(349));Qi&30||Dw(t,e,s)}return s}function Dw(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Mt.updateQueue,e===null?(e={lastEffect:null,stores:null},Mt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Mw(n,e,t,r){e.value=t,e.getSnapshot=r,Lw(e)&&Ow(n)}function Vw(n,e,t){return t(function(){Lw(e)&&Ow(n)})}function Lw(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Cr(n,t)}catch{return!0}}function Ow(n){var e=is(n,1);e!==null&&Nr(e,n,1,-1)}function Hy(n){var e=Pr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:nc,lastRenderedState:n},e.queue=n,n=n.dispatch=U1.bind(null,Mt,n),[e.memoizedState,n]}function rc(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Mt.updateQueue,e===null?(e={lastEffect:null,stores:null},Mt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Fw(){return vr().memoizedState}function Uu(n,e,t,r){var s=Pr();Mt.flags|=n,s.memoizedState=rc(1|e,t,void 0,r===void 0?null:r)}function lh(n,e,t,r){var s=vr();r=r===void 0?null:r;var i=void 0;if(sn!==null){var a=sn.memoizedState;if(i=a.destroy,r!==null&&Gp(r,a.deps)){s.memoizedState=rc(e,t,i,r);return}}Mt.flags|=n,s.memoizedState=rc(1|e,t,i,r)}function Gy(n,e){return Uu(8390656,8,n,e)}function Yp(n,e){return lh(2048,8,n,e)}function $w(n,e){return lh(4,2,n,e)}function Uw(n,e){return lh(4,4,n,e)}function Bw(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function zw(n,e,t){return t=t!=null?t.concat([n]):null,lh(4,4,Bw.bind(null,e,n),t)}function Jp(){}function qw(n,e){var t=vr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Gp(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Ww(n,e){var t=vr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Gp(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Hw(n,e,t){return Qi&21?(Cr(t,e)||(t=Jb(),Mt.lanes|=t,Yi|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Yn=!0),n.memoizedState=t)}function F1(n,e){var t=ut;ut=t!==0&&4>t?t:4,n(!0);var r=bm.transition;bm.transition={};try{n(!1),e()}finally{ut=t,bm.transition=r}}function Gw(){return vr().memoizedState}function $1(n,e,t){var r=ei(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Kw(n))Qw(e,t);else if(t=Aw(n,e,t,r),t!==null){var s=qn();Nr(t,n,r,s),Yw(t,e,r)}}function U1(n,e,t){var r=ei(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Kw(n))Qw(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,l=i(a,t);if(s.hasEagerState=!0,s.eagerState=l,Cr(l,a)){var c=e.interleaved;c===null?(s.next=s,Bp(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}t=Aw(n,e,s,r),t!==null&&(s=qn(),Nr(t,n,r,s),Yw(t,e,r))}}function Kw(n){var e=n.alternate;return n===Mt||e!==null&&e===Mt}function Qw(n,e){Pl=Ed=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Yw(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Cp(n,t)}}var Td={readContext:yr,useCallback:kn,useContext:kn,useEffect:kn,useImperativeHandle:kn,useInsertionEffect:kn,useLayoutEffect:kn,useMemo:kn,useReducer:kn,useRef:kn,useState:kn,useDebugValue:kn,useDeferredValue:kn,useTransition:kn,useMutableSource:kn,useSyncExternalStore:kn,useId:kn,unstable_isNewReconciler:!1},B1={readContext:yr,useCallback:function(n,e){return Pr().memoizedState=[n,e===void 0?null:e],n},useContext:yr,useEffect:Gy,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Uu(4194308,4,Bw.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Uu(4194308,4,n,e)},useInsertionEffect:function(n,e){return Uu(4,2,n,e)},useMemo:function(n,e){var t=Pr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Pr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=$1.bind(null,Mt,n),[r.memoizedState,n]},useRef:function(n){var e=Pr();return n={current:n},e.memoizedState=n},useState:Hy,useDebugValue:Jp,useDeferredValue:function(n){return Pr().memoizedState=n},useTransition:function(){var n=Hy(!1),e=n[0];return n=F1.bind(null,n[1]),Pr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Mt,s=Pr();if(At){if(t===void 0)throw Error(se(407));t=t()}else{if(t=e(),fn===null)throw Error(se(349));Qi&30||Dw(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,Gy(Vw.bind(null,r,i,n),[n]),r.flags|=2048,rc(9,Mw.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Pr(),e=fn.identifierPrefix;if(At){var t=Yr,r=Qr;t=(r&~(1<<32-Ir(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=tc++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=O1++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},z1={readContext:yr,useCallback:qw,useContext:yr,useEffect:Yp,useImperativeHandle:zw,useInsertionEffect:$w,useLayoutEffect:Uw,useMemo:Ww,useReducer:wm,useRef:Fw,useState:function(){return wm(nc)},useDebugValue:Jp,useDeferredValue:function(n){var e=vr();return Hw(e,sn.memoizedState,n)},useTransition:function(){var n=wm(nc)[0],e=vr().memoizedState;return[n,e]},useMutableSource:jw,useSyncExternalStore:Rw,useId:Gw,unstable_isNewReconciler:!1},q1={readContext:yr,useCallback:qw,useContext:yr,useEffect:Yp,useImperativeHandle:zw,useInsertionEffect:$w,useLayoutEffect:Uw,useMemo:Ww,useReducer:_m,useRef:Fw,useState:function(){return _m(nc)},useDebugValue:Jp,useDeferredValue:function(n){var e=vr();return sn===null?e.memoizedState=n:Hw(e,sn.memoizedState,n)},useTransition:function(){var n=_m(nc)[0],e=vr().memoizedState;return[n,e]},useMutableSource:jw,useSyncExternalStore:Rw,useId:Gw,unstable_isNewReconciler:!1};function _r(n,e){if(n&&n.defaultProps){e=Lt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function bf(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Lt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var ch={isMounted:function(n){return(n=n._reactInternals)?ha(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=qn(),s=ei(n),i=ts(r,s);i.payload=e,t!=null&&(i.callback=t),e=Xs(n,i,s),e!==null&&(Nr(e,n,s,r),Fu(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=qn(),s=ei(n),i=ts(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Xs(n,i,s),e!==null&&(Nr(e,n,s,r),Fu(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=qn(),r=ei(n),s=ts(t,r);s.tag=2,e!=null&&(s.callback=e),e=Xs(n,s,r),e!==null&&(Nr(e,n,r,t),Fu(e,n,r))}};function Ky(n,e,t,r,s,i,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!Ql(t,r)||!Ql(s,i):!0}function Jw(n,e,t){var r=!1,s=oi,i=e.contextType;return typeof i=="object"&&i!==null?i=yr(i):(s=tr(e)?Gi:Ln.current,r=e.contextTypes,i=(r=r!=null)?ao(n,s):oi),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ch,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function Qy(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&ch.enqueueReplaceState(e,e.state,null)}function wf(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},zp(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=yr(i):(i=tr(e)?Gi:Ln.current,s.context=ao(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(bf(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&ch.enqueueReplaceState(s,s.state,null),wd(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function uo(n,e){try{var t="",r=e;do t+=vN(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function Em(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function _f(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var W1=typeof WeakMap=="function"?WeakMap:Map;function Xw(n,e,t){t=ts(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Id||(Id=!0,jf=r),_f(n,e)},t}function Zw(n,e,t){t=ts(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){_f(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){_f(n,e),typeof r!="function"&&(Zs===null?Zs=new Set([this]):Zs.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function Yy(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new W1;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=iC.bind(null,n,e,t),e.then(n,n))}function Jy(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Xy(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ts(-1,1),e.tag=2,Xs(t,e,1))),t.lanes|=1),n)}var H1=ms.ReactCurrentOwner,Yn=!1;function zn(n,e,t,r){e.child=n===null?Cw(e,null,t,r):lo(e,n.child,t,r)}function Zy(n,e,t,r,s){t=t.render;var i=e.ref;return Xa(e,s),r=Kp(n,e,t,r,i,s),t=Qp(),n!==null&&!Yn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,as(n,e,s)):(At&&t&&Vp(e),e.flags|=1,zn(n,e,r,s),e.child)}function ev(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!ig(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,e_(n,e,i,r,s)):(n=Wu(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var a=i.memoizedProps;if(t=t.compare,t=t!==null?t:Ql,t(a,r)&&n.ref===e.ref)return as(n,e,s)}return e.flags|=1,n=ti(i,r),n.ref=e.ref,n.return=e,e.child=n}function e_(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(Ql(i,r)&&n.ref===e.ref)if(Yn=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(Yn=!0);else return e.lanes=n.lanes,as(n,e,s)}return Ef(n,e,t,r,s)}function t_(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},bt(Ha,ir),ir|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,bt(Ha,ir),ir|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,bt(Ha,ir),ir|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,bt(Ha,ir),ir|=r;return zn(n,e,s,t),e.child}function n_(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Ef(n,e,t,r,s){var i=tr(t)?Gi:Ln.current;return i=ao(e,i),Xa(e,s),t=Kp(n,e,t,r,i,s),r=Qp(),n!==null&&!Yn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,as(n,e,s)):(At&&r&&Vp(e),e.flags|=1,zn(n,e,t,s),e.child)}function tv(n,e,t,r,s){if(tr(t)){var i=!0;gd(e)}else i=!1;if(Xa(e,s),e.stateNode===null)Bu(n,e),Jw(e,t,r),wf(e,t,r,s),r=!0;else if(n===null){var a=e.stateNode,l=e.memoizedProps;a.props=l;var c=a.context,d=t.contextType;typeof d=="object"&&d!==null?d=yr(d):(d=tr(t)?Gi:Ln.current,d=ao(e,d));var h=t.getDerivedStateFromProps,m=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";m||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Qy(e,a,r,d),Rs=!1;var p=e.memoizedState;a.state=p,wd(e,r,a,s),c=e.memoizedState,l!==r||p!==c||er.current||Rs?(typeof h=="function"&&(bf(e,t,h,r),c=e.memoizedState),(l=Rs||Ky(e,t,l,r,p,c,d))?(m||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),a.props=r,a.state=c,a.context=d,r=l):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,kw(n,e),l=e.memoizedProps,d=e.type===e.elementType?l:_r(e.type,l),a.props=d,m=e.pendingProps,p=a.context,c=t.contextType,typeof c=="object"&&c!==null?c=yr(c):(c=tr(t)?Gi:Ln.current,c=ao(e,c));var y=t.getDerivedStateFromProps;(h=typeof y=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==m||p!==c)&&Qy(e,a,r,c),Rs=!1,p=e.memoizedState,a.state=p,wd(e,r,a,s);var v=e.memoizedState;l!==m||p!==v||er.current||Rs?(typeof y=="function"&&(bf(e,t,y,r),v=e.memoizedState),(d=Rs||Ky(e,t,d,r,p,v,c)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,v,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,v,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=v),a.props=r,a.state=v,a.context=c,r=d):(typeof a.componentDidUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),r=!1)}return Tf(n,e,t,r,i,s)}function Tf(n,e,t,r,s,i){n_(n,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&$y(e,t,!1),as(n,e,i);r=e.stateNode,H1.current=e;var l=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&a?(e.child=lo(e,n.child,null,i),e.child=lo(e,null,l,i)):zn(n,e,l,i),e.memoizedState=r.state,s&&$y(e,t,!0),e.child}function r_(n){var e=n.stateNode;e.pendingContext?Fy(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Fy(n,e.context,!1),qp(n,e.containerInfo)}function nv(n,e,t,r,s){return oo(),Op(s),e.flags|=256,zn(n,e,t,r),e.child}var Sf={dehydrated:null,treeContext:null,retryLane:0};function If(n){return{baseLanes:n,cachePool:null,transitions:null}}function s_(n,e,t){var r=e.pendingProps,s=Dt.current,i=!1,a=(e.flags&128)!==0,l;if((l=a)||(l=n!==null&&n.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),bt(Dt,s&1),n===null)return vf(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,n=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=hh(a,r,0,null),n=qi(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=If(t),e.memoizedState=Sf,n):Xp(e,a));if(s=n.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return G1(n,e,a,r,l,s,t);if(i){i=r.fallback,a=e.mode,s=n.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=ti(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=ti(l,i):(i=qi(i,a,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=n.child.memoizedState,a=a===null?If(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=n.childLanes&~t,e.memoizedState=Sf,r}return i=n.child,n=i.sibling,r=ti(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Xp(n,e){return e=hh({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function bu(n,e,t,r){return r!==null&&Op(r),lo(e,n.child,null,t),n=Xp(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function G1(n,e,t,r,s,i,a){if(t)return e.flags&256?(e.flags&=-257,r=Em(Error(se(422))),bu(n,e,a,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=hh({mode:"visible",children:r.children},s,0,null),i=qi(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&lo(e,n.child,null,a),e.child.memoizedState=If(a),e.memoizedState=Sf,i);if(!(e.mode&1))return bu(n,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(se(419)),r=Em(i,r,void 0),bu(n,e,a,r)}if(l=(a&n.childLanes)!==0,Yn||l){if(r=fn,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,is(n,s),Nr(r,n,s,-1))}return sg(),r=Em(Error(se(421))),bu(n,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=aC.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,ar=Js(s.nextSibling),or=e,At=!0,Sr=null,n!==null&&(mr[fr++]=Qr,mr[fr++]=Yr,mr[fr++]=Ki,Qr=n.id,Yr=n.overflow,Ki=e),e=Xp(e,r.children),e.flags|=4096,e)}function rv(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),xf(n.return,e,t)}function Tm(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function i_(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(zn(n,e,r.children,t),r=Dt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&rv(n,t,e);else if(n.tag===19)rv(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(bt(Dt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&_d(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Tm(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&_d(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}Tm(e,!0,t,null,i);break;case"together":Tm(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Bu(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function as(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Yi|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(se(153));if(e.child!==null){for(n=e.child,t=ti(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=ti(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function K1(n,e,t){switch(e.tag){case 3:r_(e),oo();break;case 5:Pw(e);break;case 1:tr(e.type)&&gd(e);break;case 4:qp(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;bt(xd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(bt(Dt,Dt.current&1),e.flags|=128,null):t&e.child.childLanes?s_(n,e,t):(bt(Dt,Dt.current&1),n=as(n,e,t),n!==null?n.sibling:null);bt(Dt,Dt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return i_(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),bt(Dt,Dt.current),r)break;return null;case 22:case 23:return e.lanes=0,t_(n,e,t)}return as(n,e,t)}var a_,Nf,o_,l_;a_=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Nf=function(){};o_=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,Ui(Lr.current);var i=null;switch(t){case"input":s=Km(n,s),r=Km(n,r),i=[];break;case"select":s=Lt({},s,{value:void 0}),r=Lt({},r,{value:void 0}),i=[];break;case"textarea":s=Jm(n,s),r=Jm(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=fd)}Zm(t,r);var a;t=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(a in l)l.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Bl.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(t||(t={}),t[a]=c[a])}else t||(i||(i=[]),i.push(d,t)),t=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Bl.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Tt("scroll",n),i||l===c||(i=[])):(i=i||[]).push(d,c))}t&&(i=i||[]).push("style",t);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};l_=function(n,e,t,r){t!==r&&(e.flags|=4)};function cl(n,e){if(!At)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Pn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function Q1(n,e,t){var r=e.pendingProps;switch(Lp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pn(e),null;case 1:return tr(e.type)&&pd(),Pn(e),null;case 3:return r=e.stateNode,co(),It(er),It(Ln),Hp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(vu(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Sr!==null&&(Mf(Sr),Sr=null))),Nf(n,e),Pn(e),null;case 5:Wp(e);var s=Ui(ec.current);if(t=e.type,n!==null&&e.stateNode!=null)o_(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(se(166));return Pn(e),null}if(n=Ui(Lr.current),vu(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[jr]=e,r[Xl]=i,n=(e.mode&1)!==0,t){case"dialog":Tt("cancel",r),Tt("close",r);break;case"iframe":case"object":case"embed":Tt("load",r);break;case"video":case"audio":for(s=0;s<xl.length;s++)Tt(xl[s],r);break;case"source":Tt("error",r);break;case"img":case"image":case"link":Tt("error",r),Tt("load",r);break;case"details":Tt("toggle",r);break;case"input":hy(r,i),Tt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Tt("invalid",r);break;case"textarea":fy(r,i),Tt("invalid",r)}Zm(t,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&yu(r.textContent,l,n),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&yu(r.textContent,l,n),s=["children",""+l]):Bl.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&Tt("scroll",r)}switch(t){case"input":cu(r),my(r,i,!0);break;case"textarea":cu(r),py(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=fd)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Vb(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=a.createElement(t,{is:r.is}):(n=a.createElement(t),t==="select"&&(a=n,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):n=a.createElementNS(n,t),n[jr]=e,n[Xl]=r,a_(n,e,!1,!1),e.stateNode=n;e:{switch(a=ef(t,r),t){case"dialog":Tt("cancel",n),Tt("close",n),s=r;break;case"iframe":case"object":case"embed":Tt("load",n),s=r;break;case"video":case"audio":for(s=0;s<xl.length;s++)Tt(xl[s],n);s=r;break;case"source":Tt("error",n),s=r;break;case"img":case"image":case"link":Tt("error",n),Tt("load",n),s=r;break;case"details":Tt("toggle",n),s=r;break;case"input":hy(n,r),s=Km(n,r),Tt("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=Lt({},r,{value:void 0}),Tt("invalid",n);break;case"textarea":fy(n,r),s=Jm(n,r),Tt("invalid",n);break;default:s=r}Zm(t,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?Fb(n,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Lb(n,c)):i==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&zl(n,c):typeof c=="number"&&zl(n,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Bl.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Tt("scroll",n):c!=null&&_p(n,i,c,a))}switch(t){case"input":cu(n),my(n,r,!1);break;case"textarea":cu(n),py(n);break;case"option":r.value!=null&&n.setAttribute("value",""+ai(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Ka(n,!!r.multiple,i,!1):r.defaultValue!=null&&Ka(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=fd)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Pn(e),null;case 6:if(n&&e.stateNode!=null)l_(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(se(166));if(t=Ui(ec.current),Ui(Lr.current),vu(e)){if(r=e.stateNode,t=e.memoizedProps,r[jr]=e,(i=r.nodeValue!==t)&&(n=or,n!==null))switch(n.tag){case 3:yu(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&yu(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[jr]=e,e.stateNode=r}return Pn(e),null;case 13:if(It(Dt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(At&&ar!==null&&e.mode&1&&!(e.flags&128))Iw(),oo(),e.flags|=98560,i=!1;else if(i=vu(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(se(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(se(317));i[jr]=e}else oo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Pn(e),i=!1}else Sr!==null&&(Mf(Sr),Sr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Dt.current&1?an===0&&(an=3):sg())),e.updateQueue!==null&&(e.flags|=4),Pn(e),null);case 4:return co(),Nf(n,e),n===null&&Yl(e.stateNode.containerInfo),Pn(e),null;case 10:return Up(e.type._context),Pn(e),null;case 17:return tr(e.type)&&pd(),Pn(e),null;case 19:if(It(Dt),i=e.memoizedState,i===null)return Pn(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)cl(i,!1);else{if(an!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=_d(n),a!==null){for(e.flags|=128,cl(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,n=a.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return bt(Dt,Dt.current&1|2),e.child}n=n.sibling}i.tail!==null&&Ht()>ho&&(e.flags|=128,r=!0,cl(i,!1),e.lanes=4194304)}else{if(!r)if(n=_d(a),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),cl(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!At)return Pn(e),null}else 2*Ht()-i.renderingStartTime>ho&&t!==1073741824&&(e.flags|=128,r=!0,cl(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(t=i.last,t!==null?t.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Ht(),e.sibling=null,t=Dt.current,bt(Dt,r?t&1|2:t&1),e):(Pn(e),null);case 22:case 23:return rg(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ir&1073741824&&(Pn(e),e.subtreeFlags&6&&(e.flags|=8192)):Pn(e),null;case 24:return null;case 25:return null}throw Error(se(156,e.tag))}function Y1(n,e){switch(Lp(e),e.tag){case 1:return tr(e.type)&&pd(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return co(),It(er),It(Ln),Hp(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Wp(e),null;case 13:if(It(Dt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(se(340));oo()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return It(Dt),null;case 4:return co(),null;case 10:return Up(e.type._context),null;case 22:case 23:return rg(),null;case 24:return null;default:return null}}var wu=!1,Dn=!1,J1=typeof WeakSet=="function"?WeakSet:Set,ge=null;function Wa(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Ut(n,e,r)}else t.current=null}function Cf(n,e,t){try{t()}catch(r){Ut(n,e,r)}}var sv=!1;function X1(n,e){if(df=dd,n=mw(),Mp(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var a=0,l=-1,c=-1,d=0,h=0,m=n,p=null;t:for(;;){for(var y;m!==t||s!==0&&m.nodeType!==3||(l=a+s),m!==i||r!==0&&m.nodeType!==3||(c=a+r),m.nodeType===3&&(a+=m.nodeValue.length),(y=m.firstChild)!==null;)p=m,m=y;for(;;){if(m===n)break t;if(p===t&&++d===s&&(l=a),p===i&&++h===r&&(c=a),(y=m.nextSibling)!==null)break;m=p,p=m.parentNode}m=y}t=l===-1||c===-1?null:{start:l,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(hf={focusedElem:n,selectionRange:t},dd=!1,ge=e;ge!==null;)if(e=ge,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ge=n;else for(;ge!==null;){e=ge;try{var v=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var S=v.memoizedProps,E=v.memoizedState,_=e.stateNode,x=_.getSnapshotBeforeUpdate(e.elementType===e.type?S:_r(e.type,S),E);_.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var C=e.stateNode.containerInfo;C.nodeType===1?C.textContent="":C.nodeType===9&&C.documentElement&&C.removeChild(C.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(se(163))}}catch(k){Ut(e,e.return,k)}if(n=e.sibling,n!==null){n.return=e.return,ge=n;break}ge=e.return}return v=sv,sv=!1,v}function jl(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&Cf(e,t,i)}s=s.next}while(s!==r)}}function uh(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Af(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function c_(n){var e=n.alternate;e!==null&&(n.alternate=null,c_(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[jr],delete e[Xl],delete e[pf],delete e[D1],delete e[M1])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function u_(n){return n.tag===5||n.tag===3||n.tag===4}function iv(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||u_(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function kf(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=fd));else if(r!==4&&(n=n.child,n!==null))for(kf(n,e,t),n=n.sibling;n!==null;)kf(n,e,t),n=n.sibling}function Pf(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Pf(n,e,t),n=n.sibling;n!==null;)Pf(n,e,t),n=n.sibling}var vn=null,Tr=!1;function Ns(n,e,t){for(t=t.child;t!==null;)d_(n,e,t),t=t.sibling}function d_(n,e,t){if(Vr&&typeof Vr.onCommitFiberUnmount=="function")try{Vr.onCommitFiberUnmount(nh,t)}catch{}switch(t.tag){case 5:Dn||Wa(t,e);case 6:var r=vn,s=Tr;vn=null,Ns(n,e,t),vn=r,Tr=s,vn!==null&&(Tr?(n=vn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):vn.removeChild(t.stateNode));break;case 18:vn!==null&&(Tr?(n=vn,t=t.stateNode,n.nodeType===8?ym(n.parentNode,t):n.nodeType===1&&ym(n,t),Gl(n)):ym(vn,t.stateNode));break;case 4:r=vn,s=Tr,vn=t.stateNode.containerInfo,Tr=!0,Ns(n,e,t),vn=r,Tr=s;break;case 0:case 11:case 14:case 15:if(!Dn&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&Cf(t,e,a),s=s.next}while(s!==r)}Ns(n,e,t);break;case 1:if(!Dn&&(Wa(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(l){Ut(t,e,l)}Ns(n,e,t);break;case 21:Ns(n,e,t);break;case 22:t.mode&1?(Dn=(r=Dn)||t.memoizedState!==null,Ns(n,e,t),Dn=r):Ns(n,e,t);break;default:Ns(n,e,t)}}function av(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new J1),e.forEach(function(r){var s=oC.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function wr(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 5:vn=l.stateNode,Tr=!1;break e;case 3:vn=l.stateNode.containerInfo,Tr=!0;break e;case 4:vn=l.stateNode.containerInfo,Tr=!0;break e}l=l.return}if(vn===null)throw Error(se(160));d_(i,a,s),vn=null,Tr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){Ut(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)h_(e,n),e=e.sibling}function h_(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(wr(e,n),kr(n),r&4){try{jl(3,n,n.return),uh(3,n)}catch(S){Ut(n,n.return,S)}try{jl(5,n,n.return)}catch(S){Ut(n,n.return,S)}}break;case 1:wr(e,n),kr(n),r&512&&t!==null&&Wa(t,t.return);break;case 5:if(wr(e,n),kr(n),r&512&&t!==null&&Wa(t,t.return),n.flags&32){var s=n.stateNode;try{zl(s,"")}catch(S){Ut(n,n.return,S)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,a=t!==null?t.memoizedProps:i,l=n.type,c=n.updateQueue;if(n.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Db(s,i),ef(l,a);var d=ef(l,i);for(a=0;a<c.length;a+=2){var h=c[a],m=c[a+1];h==="style"?Fb(s,m):h==="dangerouslySetInnerHTML"?Lb(s,m):h==="children"?zl(s,m):_p(s,h,m,d)}switch(l){case"input":Qm(s,i);break;case"textarea":Mb(s,i);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?Ka(s,!!i.multiple,y,!1):p!==!!i.multiple&&(i.defaultValue!=null?Ka(s,!!i.multiple,i.defaultValue,!0):Ka(s,!!i.multiple,i.multiple?[]:"",!1))}s[Xl]=i}catch(S){Ut(n,n.return,S)}}break;case 6:if(wr(e,n),kr(n),r&4){if(n.stateNode===null)throw Error(se(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(S){Ut(n,n.return,S)}}break;case 3:if(wr(e,n),kr(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Gl(e.containerInfo)}catch(S){Ut(n,n.return,S)}break;case 4:wr(e,n),kr(n);break;case 13:wr(e,n),kr(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(tg=Ht())),r&4&&av(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(Dn=(d=Dn)||h,wr(e,n),Dn=d):wr(e,n),kr(n),r&8192){if(d=n.memoizedState!==null,(n.stateNode.isHidden=d)&&!h&&n.mode&1)for(ge=n,h=n.child;h!==null;){for(m=ge=h;ge!==null;){switch(p=ge,y=p.child,p.tag){case 0:case 11:case 14:case 15:jl(4,p,p.return);break;case 1:Wa(p,p.return);var v=p.stateNode;if(typeof v.componentWillUnmount=="function"){r=p,t=p.return;try{e=r,v.props=e.memoizedProps,v.state=e.memoizedState,v.componentWillUnmount()}catch(S){Ut(r,t,S)}}break;case 5:Wa(p,p.return);break;case 22:if(p.memoizedState!==null){lv(m);continue}}y!==null?(y.return=p,ge=y):lv(m)}h=h.sibling}e:for(h=null,m=n;;){if(m.tag===5){if(h===null){h=m;try{s=m.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=m.stateNode,c=m.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=Ob("display",a))}catch(S){Ut(n,n.return,S)}}}else if(m.tag===6){if(h===null)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(S){Ut(n,n.return,S)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===n)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===n)break e;for(;m.sibling===null;){if(m.return===null||m.return===n)break e;h===m&&(h=null),m=m.return}h===m&&(h=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:wr(e,n),kr(n),r&4&&av(n);break;case 21:break;default:wr(e,n),kr(n)}}function kr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(u_(t)){var r=t;break e}t=t.return}throw Error(se(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(zl(s,""),r.flags&=-33);var i=iv(n);Pf(n,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,l=iv(n);kf(n,l,a);break;default:throw Error(se(161))}}catch(c){Ut(n,n.return,c)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function Z1(n,e,t){ge=n,m_(n)}function m_(n,e,t){for(var r=(n.mode&1)!==0;ge!==null;){var s=ge,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||wu;if(!a){var l=s.alternate,c=l!==null&&l.memoizedState!==null||Dn;l=wu;var d=Dn;if(wu=a,(Dn=c)&&!d)for(ge=s;ge!==null;)a=ge,c=a.child,a.tag===22&&a.memoizedState!==null?cv(s):c!==null?(c.return=a,ge=c):cv(s);for(;i!==null;)ge=i,m_(i),i=i.sibling;ge=s,wu=l,Dn=d}ov(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ge=i):ov(n)}}function ov(n){for(;ge!==null;){var e=ge;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Dn||uh(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Dn)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:_r(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Wy(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Wy(e,a,t)}break;case 5:var l=e.stateNode;if(t===null&&e.flags&4){t=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var m=h.dehydrated;m!==null&&Gl(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(se(163))}Dn||e.flags&512&&Af(e)}catch(p){Ut(e,e.return,p)}}if(e===n){ge=null;break}if(t=e.sibling,t!==null){t.return=e.return,ge=t;break}ge=e.return}}function lv(n){for(;ge!==null;){var e=ge;if(e===n){ge=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ge=t;break}ge=e.return}}function cv(n){for(;ge!==null;){var e=ge;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{uh(4,e)}catch(c){Ut(e,t,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Ut(e,s,c)}}var i=e.return;try{Af(e)}catch(c){Ut(e,i,c)}break;case 5:var a=e.return;try{Af(e)}catch(c){Ut(e,a,c)}}}catch(c){Ut(e,e.return,c)}if(e===n){ge=null;break}var l=e.sibling;if(l!==null){l.return=e.return,ge=l;break}ge=e.return}}var eC=Math.ceil,Sd=ms.ReactCurrentDispatcher,Zp=ms.ReactCurrentOwner,gr=ms.ReactCurrentBatchConfig,Xe=0,fn=null,nn=null,wn=0,ir=0,Ha=yi(0),an=0,sc=null,Yi=0,dh=0,eg=0,Rl=null,Qn=null,tg=0,ho=1/0,Hr=null,Id=!1,jf=null,Zs=null,_u=!1,Ws=null,Nd=0,Dl=0,Rf=null,zu=-1,qu=0;function qn(){return Xe&6?Ht():zu!==-1?zu:zu=Ht()}function ei(n){return n.mode&1?Xe&2&&wn!==0?wn&-wn:L1.transition!==null?(qu===0&&(qu=Jb()),qu):(n=ut,n!==0||(n=window.event,n=n===void 0?16:sw(n.type)),n):1}function Nr(n,e,t,r){if(50<Dl)throw Dl=0,Rf=null,Error(se(185));_c(n,t,r),(!(Xe&2)||n!==fn)&&(n===fn&&(!(Xe&2)&&(dh|=t),an===4&&Ms(n,wn)),nr(n,r),t===1&&Xe===0&&!(e.mode&1)&&(ho=Ht()+500,oh&&vi()))}function nr(n,e){var t=n.callbackNode;LN(n,e);var r=ud(n,n===fn?wn:0);if(r===0)t!==null&&vy(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&vy(t),e===1)n.tag===0?V1(uv.bind(null,n)):Ew(uv.bind(null,n)),j1(function(){!(Xe&6)&&vi()}),t=null;else{switch(Xb(r)){case 1:t=Np;break;case 4:t=Qb;break;case 16:t=cd;break;case 536870912:t=Yb;break;default:t=cd}t=w_(t,f_.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function f_(n,e){if(zu=-1,qu=0,Xe&6)throw Error(se(327));var t=n.callbackNode;if(Za()&&n.callbackNode!==t)return null;var r=ud(n,n===fn?wn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Cd(n,r);else{e=r;var s=Xe;Xe|=2;var i=g_();(fn!==n||wn!==e)&&(Hr=null,ho=Ht()+500,zi(n,e));do try{rC();break}catch(l){p_(n,l)}while(1);$p(),Sd.current=i,Xe=s,nn!==null?e=0:(fn=null,wn=0,e=an)}if(e!==0){if(e===2&&(s=af(n),s!==0&&(r=s,e=Df(n,s))),e===1)throw t=sc,zi(n,0),Ms(n,r),nr(n,Ht()),t;if(e===6)Ms(n,r);else{if(s=n.current.alternate,!(r&30)&&!tC(s)&&(e=Cd(n,r),e===2&&(i=af(n),i!==0&&(r=i,e=Df(n,i))),e===1))throw t=sc,zi(n,0),Ms(n,r),nr(n,Ht()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(se(345));case 2:Pi(n,Qn,Hr);break;case 3:if(Ms(n,r),(r&130023424)===r&&(e=tg+500-Ht(),10<e)){if(ud(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){qn(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=ff(Pi.bind(null,n,Qn,Hr),e);break}Pi(n,Qn,Hr);break;case 4:if(Ms(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var a=31-Ir(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=Ht()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*eC(r/1960))-r,10<r){n.timeoutHandle=ff(Pi.bind(null,n,Qn,Hr),r);break}Pi(n,Qn,Hr);break;case 5:Pi(n,Qn,Hr);break;default:throw Error(se(329))}}}return nr(n,Ht()),n.callbackNode===t?f_.bind(null,n):null}function Df(n,e){var t=Rl;return n.current.memoizedState.isDehydrated&&(zi(n,e).flags|=256),n=Cd(n,e),n!==2&&(e=Qn,Qn=t,e!==null&&Mf(e)),n}function Mf(n){Qn===null?Qn=n:Qn.push.apply(Qn,n)}function tC(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!Cr(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ms(n,e){for(e&=~eg,e&=~dh,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Ir(e),r=1<<t;n[t]=-1,e&=~r}}function uv(n){if(Xe&6)throw Error(se(327));Za();var e=ud(n,0);if(!(e&1))return nr(n,Ht()),null;var t=Cd(n,e);if(n.tag!==0&&t===2){var r=af(n);r!==0&&(e=r,t=Df(n,r))}if(t===1)throw t=sc,zi(n,0),Ms(n,e),nr(n,Ht()),t;if(t===6)throw Error(se(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Pi(n,Qn,Hr),nr(n,Ht()),null}function ng(n,e){var t=Xe;Xe|=1;try{return n(e)}finally{Xe=t,Xe===0&&(ho=Ht()+500,oh&&vi())}}function Ji(n){Ws!==null&&Ws.tag===0&&!(Xe&6)&&Za();var e=Xe;Xe|=1;var t=gr.transition,r=ut;try{if(gr.transition=null,ut=1,n)return n()}finally{ut=r,gr.transition=t,Xe=e,!(Xe&6)&&vi()}}function rg(){ir=Ha.current,It(Ha)}function zi(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,P1(t)),nn!==null)for(t=nn.return;t!==null;){var r=t;switch(Lp(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&pd();break;case 3:co(),It(er),It(Ln),Hp();break;case 5:Wp(r);break;case 4:co();break;case 13:It(Dt);break;case 19:It(Dt);break;case 10:Up(r.type._context);break;case 22:case 23:rg()}t=t.return}if(fn=n,nn=n=ti(n.current,null),wn=ir=e,an=0,sc=null,eg=dh=Yi=0,Qn=Rl=null,$i!==null){for(e=0;e<$i.length;e++)if(t=$i[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}t.pending=r}$i=null}return n}function p_(n,e){do{var t=nn;try{if($p(),$u.current=Td,Ed){for(var r=Mt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Ed=!1}if(Qi=0,hn=sn=Mt=null,Pl=!1,tc=0,Zp.current=null,t===null||t.return===null){an=1,sc=e,nn=null;break}e:{var i=n,a=t.return,l=t,c=e;if(e=wn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=l,m=h.tag;if(!(h.mode&1)&&(m===0||m===11||m===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=Jy(a);if(y!==null){y.flags&=-257,Xy(y,a,l,i,e),y.mode&1&&Yy(i,d,e),e=y,c=d;var v=e.updateQueue;if(v===null){var S=new Set;S.add(c),e.updateQueue=S}else v.add(c);break e}else{if(!(e&1)){Yy(i,d,e),sg();break e}c=Error(se(426))}}else if(At&&l.mode&1){var E=Jy(a);if(E!==null){!(E.flags&65536)&&(E.flags|=256),Xy(E,a,l,i,e),Op(uo(c,l));break e}}i=c=uo(c,l),an!==4&&(an=2),Rl===null?Rl=[i]:Rl.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var _=Xw(i,c,e);qy(i,_);break e;case 1:l=c;var x=i.type,C=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(Zs===null||!Zs.has(C)))){i.flags|=65536,e&=-e,i.lanes|=e;var k=Zw(i,l,e);qy(i,k);break e}}i=i.return}while(i!==null)}v_(t)}catch(M){e=M,nn===t&&t!==null&&(nn=t=t.return);continue}break}while(1)}function g_(){var n=Sd.current;return Sd.current=Td,n===null?Td:n}function sg(){(an===0||an===3||an===2)&&(an=4),fn===null||!(Yi&268435455)&&!(dh&268435455)||Ms(fn,wn)}function Cd(n,e){var t=Xe;Xe|=2;var r=g_();(fn!==n||wn!==e)&&(Hr=null,zi(n,e));do try{nC();break}catch(s){p_(n,s)}while(1);if($p(),Xe=t,Sd.current=r,nn!==null)throw Error(se(261));return fn=null,wn=0,an}function nC(){for(;nn!==null;)y_(nn)}function rC(){for(;nn!==null&&!CN();)y_(nn)}function y_(n){var e=b_(n.alternate,n,ir);n.memoizedProps=n.pendingProps,e===null?v_(n):nn=e,Zp.current=null}function v_(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=Y1(t,e),t!==null){t.flags&=32767,nn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{an=6,nn=null;return}}else if(t=Q1(t,e,ir),t!==null){nn=t;return}if(e=e.sibling,e!==null){nn=e;return}nn=e=n}while(e!==null);an===0&&(an=5)}function Pi(n,e,t){var r=ut,s=gr.transition;try{gr.transition=null,ut=1,sC(n,e,t,r)}finally{gr.transition=s,ut=r}return null}function sC(n,e,t,r){do Za();while(Ws!==null);if(Xe&6)throw Error(se(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(se(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(ON(n,i),n===fn&&(nn=fn=null,wn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||_u||(_u=!0,w_(cd,function(){return Za(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=gr.transition,gr.transition=null;var a=ut;ut=1;var l=Xe;Xe|=4,Zp.current=null,X1(n,t),h_(t,n),T1(hf),dd=!!df,hf=df=null,n.current=t,Z1(t),AN(),Xe=l,ut=a,gr.transition=i}else n.current=t;if(_u&&(_u=!1,Ws=n,Nd=s),i=n.pendingLanes,i===0&&(Zs=null),jN(t.stateNode),nr(n,Ht()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Id)throw Id=!1,n=jf,jf=null,n;return Nd&1&&n.tag!==0&&Za(),i=n.pendingLanes,i&1?n===Rf?Dl++:(Dl=0,Rf=n):Dl=0,vi(),null}function Za(){if(Ws!==null){var n=Xb(Nd),e=gr.transition,t=ut;try{if(gr.transition=null,ut=16>n?16:n,Ws===null)var r=!1;else{if(n=Ws,Ws=null,Nd=0,Xe&6)throw Error(se(331));var s=Xe;for(Xe|=4,ge=n.current;ge!==null;){var i=ge,a=i.child;if(ge.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(ge=d;ge!==null;){var h=ge;switch(h.tag){case 0:case 11:case 15:jl(8,h,i)}var m=h.child;if(m!==null)m.return=h,ge=m;else for(;ge!==null;){h=ge;var p=h.sibling,y=h.return;if(c_(h),h===d){ge=null;break}if(p!==null){p.return=y,ge=p;break}ge=y}}}var v=i.alternate;if(v!==null){var S=v.child;if(S!==null){v.child=null;do{var E=S.sibling;S.sibling=null,S=E}while(S!==null)}}ge=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,ge=a;else e:for(;ge!==null;){if(i=ge,i.flags&2048)switch(i.tag){case 0:case 11:case 15:jl(9,i,i.return)}var _=i.sibling;if(_!==null){_.return=i.return,ge=_;break e}ge=i.return}}var x=n.current;for(ge=x;ge!==null;){a=ge;var C=a.child;if(a.subtreeFlags&2064&&C!==null)C.return=a,ge=C;else e:for(a=x;ge!==null;){if(l=ge,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:uh(9,l)}}catch(M){Ut(l,l.return,M)}if(l===a){ge=null;break e}var k=l.sibling;if(k!==null){k.return=l.return,ge=k;break e}ge=l.return}}if(Xe=s,vi(),Vr&&typeof Vr.onPostCommitFiberRoot=="function")try{Vr.onPostCommitFiberRoot(nh,n)}catch{}r=!0}return r}finally{ut=t,gr.transition=e}}return!1}function dv(n,e,t){e=uo(t,e),e=Xw(n,e,1),n=Xs(n,e,1),e=qn(),n!==null&&(_c(n,1,e),nr(n,e))}function Ut(n,e,t){if(n.tag===3)dv(n,n,t);else for(;e!==null;){if(e.tag===3){dv(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Zs===null||!Zs.has(r))){n=uo(t,n),n=Zw(e,n,1),e=Xs(e,n,1),n=qn(),e!==null&&(_c(e,1,n),nr(e,n));break}}e=e.return}}function iC(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=qn(),n.pingedLanes|=n.suspendedLanes&t,fn===n&&(wn&t)===t&&(an===4||an===3&&(wn&130023424)===wn&&500>Ht()-tg?zi(n,0):eg|=t),nr(n,e)}function x_(n,e){e===0&&(n.mode&1?(e=hu,hu<<=1,!(hu&130023424)&&(hu=4194304)):e=1);var t=qn();n=is(n,e),n!==null&&(_c(n,e,t),nr(n,t))}function aC(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),x_(n,t)}function oC(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(se(314))}r!==null&&r.delete(e),x_(n,t)}var b_;b_=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||er.current)Yn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Yn=!1,K1(n,e,t);Yn=!!(n.flags&131072)}else Yn=!1,At&&e.flags&1048576&&Tw(e,vd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Bu(n,e),n=e.pendingProps;var s=ao(e,Ln.current);Xa(e,t),s=Kp(null,e,r,n,s,t);var i=Qp();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,tr(r)?(i=!0,gd(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,zp(e),s.updater=ch,e.stateNode=s,s._reactInternals=e,wf(e,r,n,t),e=Tf(null,e,r,!0,i,t)):(e.tag=0,At&&i&&Vp(e),zn(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Bu(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=cC(r),n=_r(r,n),s){case 0:e=Ef(null,e,r,n,t);break e;case 1:e=tv(null,e,r,n,t);break e;case 11:e=Zy(null,e,r,n,t);break e;case 14:e=ev(null,e,r,_r(r.type,n),t);break e}throw Error(se(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:_r(r,s),Ef(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:_r(r,s),tv(n,e,r,s,t);case 3:e:{if(r_(e),n===null)throw Error(se(387));r=e.pendingProps,i=e.memoizedState,s=i.element,kw(n,e),wd(e,r,null,t);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=uo(Error(se(423)),e),e=nv(n,e,r,t,s);break e}else if(r!==s){s=uo(Error(se(424)),e),e=nv(n,e,r,t,s);break e}else for(ar=Js(e.stateNode.containerInfo.firstChild),or=e,At=!0,Sr=null,t=Cw(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(oo(),r===s){e=as(n,e,t);break e}zn(n,e,r,t)}e=e.child}return e;case 5:return Pw(e),n===null&&vf(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,a=s.children,mf(r,s)?a=null:i!==null&&mf(r,i)&&(e.flags|=32),n_(n,e),zn(n,e,a,t),e.child;case 6:return n===null&&vf(e),null;case 13:return s_(n,e,t);case 4:return qp(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=lo(e,null,r,t):zn(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:_r(r,s),Zy(n,e,r,s,t);case 7:return zn(n,e,e.pendingProps,t),e.child;case 8:return zn(n,e,e.pendingProps.children,t),e.child;case 12:return zn(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,bt(xd,r._currentValue),r._currentValue=a,i!==null)if(Cr(i.value,a)){if(i.children===s.children&&!er.current){e=as(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=ts(-1,t&-t),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}i.lanes|=t,c=i.alternate,c!==null&&(c.lanes|=t),xf(i.return,t,e),l.lanes|=t;break}c=c.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(se(341));a.lanes|=t,l=a.alternate,l!==null&&(l.lanes|=t),xf(a,t,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}zn(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Xa(e,t),s=yr(s),r=r(s),e.flags|=1,zn(n,e,r,t),e.child;case 14:return r=e.type,s=_r(r,e.pendingProps),s=_r(r.type,s),ev(n,e,r,s,t);case 15:return e_(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:_r(r,s),Bu(n,e),e.tag=1,tr(r)?(n=!0,gd(e)):n=!1,Xa(e,t),Jw(e,r,s),wf(e,r,s,t),Tf(null,e,r,!0,n,t);case 19:return i_(n,e,t);case 22:return t_(n,e,t)}throw Error(se(156,e.tag))};function w_(n,e){return Kb(n,e)}function lC(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pr(n,e,t,r){return new lC(n,e,t,r)}function ig(n){return n=n.prototype,!(!n||!n.isReactComponent)}function cC(n){if(typeof n=="function")return ig(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Tp)return 11;if(n===Sp)return 14}return 2}function ti(n,e){var t=n.alternate;return t===null?(t=pr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Wu(n,e,t,r,s,i){var a=2;if(r=n,typeof n=="function")ig(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case Va:return qi(t.children,s,i,e);case Ep:a=8,s|=8;break;case qm:return n=pr(12,t,e,s|2),n.elementType=qm,n.lanes=i,n;case Wm:return n=pr(13,t,e,s),n.elementType=Wm,n.lanes=i,n;case Hm:return n=pr(19,t,e,s),n.elementType=Hm,n.lanes=i,n;case Pb:return hh(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Ab:a=10;break e;case kb:a=9;break e;case Tp:a=11;break e;case Sp:a=14;break e;case js:a=16,r=null;break e}throw Error(se(130,n==null?n:typeof n,""))}return e=pr(a,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function qi(n,e,t,r){return n=pr(7,n,r,e),n.lanes=t,n}function hh(n,e,t,r){return n=pr(22,n,r,e),n.elementType=Pb,n.lanes=t,n.stateNode={isHidden:!1},n}function Sm(n,e,t){return n=pr(6,n,null,e),n.lanes=t,n}function Im(n,e,t){return e=pr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function uC(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=am(0),this.expirationTimes=am(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=am(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function ag(n,e,t,r,s,i,a,l,c){return n=new uC(n,e,t,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=pr(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},zp(i),n}function dC(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ma,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function __(n){if(!n)return oi;n=n._reactInternals;e:{if(ha(n)!==n||n.tag!==1)throw Error(se(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(tr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(se(171))}if(n.tag===1){var t=n.type;if(tr(t))return _w(n,t,e)}return e}function E_(n,e,t,r,s,i,a,l,c){return n=ag(t,r,!0,n,s,i,a,l,c),n.context=__(null),t=n.current,r=qn(),s=ei(t),i=ts(r,s),i.callback=e??null,Xs(t,i,s),n.current.lanes=s,_c(n,s,r),nr(n,r),n}function mh(n,e,t,r){var s=e.current,i=qn(),a=ei(s);return t=__(t),e.context===null?e.context=t:e.pendingContext=t,e=ts(i,a),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Xs(s,e,a),n!==null&&(Nr(n,s,a,i),Fu(n,s,a)),a}function Ad(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function hv(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function og(n,e){hv(n,e),(n=n.alternate)&&hv(n,e)}function hC(){return null}var T_=typeof reportError=="function"?reportError:function(n){console.error(n)};function lg(n){this._internalRoot=n}fh.prototype.render=lg.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(se(409));mh(n,e,null,null)};fh.prototype.unmount=lg.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Ji(function(){mh(null,n,null,null)}),e[ss]=null}};function fh(n){this._internalRoot=n}fh.prototype.unstable_scheduleHydration=function(n){if(n){var e=tw();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Ds.length&&e!==0&&e<Ds[t].priority;t++);Ds.splice(t,0,n),t===0&&rw(n)}};function cg(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function ph(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function mv(){}function mC(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=Ad(a);i.call(d)}}var a=E_(e,r,n,0,null,!1,!1,"",mv);return n._reactRootContainer=a,n[ss]=a.current,Yl(n.nodeType===8?n.parentNode:n),Ji(),a}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=Ad(c);l.call(d)}}var c=ag(n,0,!1,null,null,!1,!1,"",mv);return n._reactRootContainer=c,n[ss]=c.current,Yl(n.nodeType===8?n.parentNode:n),Ji(function(){mh(e,c,t,r)}),c}function gh(n,e,t,r,s){var i=t._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var l=s;s=function(){var c=Ad(a);l.call(c)}}mh(e,a,n,s)}else a=mC(t,e,n,s,r);return Ad(a)}Zb=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=vl(e.pendingLanes);t!==0&&(Cp(e,t|1),nr(e,Ht()),!(Xe&6)&&(ho=Ht()+500,vi()))}break;case 13:Ji(function(){var r=is(n,1);if(r!==null){var s=qn();Nr(r,n,1,s)}}),og(n,1)}};Ap=function(n){if(n.tag===13){var e=is(n,134217728);if(e!==null){var t=qn();Nr(e,n,134217728,t)}og(n,134217728)}};ew=function(n){if(n.tag===13){var e=ei(n),t=is(n,e);if(t!==null){var r=qn();Nr(t,n,e,r)}og(n,e)}};tw=function(){return ut};nw=function(n,e){var t=ut;try{return ut=n,e()}finally{ut=t}};nf=function(n,e,t){switch(e){case"input":if(Qm(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=ah(r);if(!s)throw Error(se(90));Rb(r),Qm(r,s)}}}break;case"textarea":Mb(n,t);break;case"select":e=t.value,e!=null&&Ka(n,!!t.multiple,e,!1)}};Bb=ng;zb=Ji;var fC={usingClientEntryPoint:!1,Events:[Tc,$a,ah,$b,Ub,ng]},ul={findFiberByHostInstance:Fi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},pC={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ms.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Hb(n),n===null?null:n.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||hC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Eu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Eu.isDisabled&&Eu.supportsFiber)try{nh=Eu.inject(pC),Vr=Eu}catch{}}ur.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fC;ur.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!cg(e))throw Error(se(200));return dC(n,e,null,t)};ur.createRoot=function(n,e){if(!cg(n))throw Error(se(299));var t=!1,r="",s=T_;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=ag(n,1,!1,null,null,t,!1,r,s),n[ss]=e.current,Yl(n.nodeType===8?n.parentNode:n),new lg(e)};ur.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(se(188)):(n=Object.keys(n).join(","),Error(se(268,n)));return n=Hb(e),n=n===null?null:n.stateNode,n};ur.flushSync=function(n){return Ji(n)};ur.hydrate=function(n,e,t){if(!ph(e))throw Error(se(200));return gh(null,n,e,!0,t)};ur.hydrateRoot=function(n,e,t){if(!cg(n))throw Error(se(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",a=T_;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=E_(e,null,n,1,t??null,s,!1,i,a),n[ss]=e.current,Yl(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new fh(e)};ur.render=function(n,e,t){if(!ph(e))throw Error(se(200));return gh(null,n,e,!1,t)};ur.unmountComponentAtNode=function(n){if(!ph(n))throw Error(se(40));return n._reactRootContainer?(Ji(function(){gh(null,null,n,!1,function(){n._reactRootContainer=null,n[ss]=null})}),!0):!1};ur.unstable_batchedUpdates=ng;ur.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!ph(t))throw Error(se(200));if(n==null||n._reactInternals===void 0)throw Error(se(38));return gh(n,e,t,!1,r)};ur.version="18.3.1-next-f1338f8080-20240426";function S_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(S_)}catch(n){console.error(n)}}S_(),Sb.exports=ur;var gC=Sb.exports,fv=gC;Bm.createRoot=fv.createRoot,Bm.hydrateRoot=fv.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ic(){return ic=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ic.apply(this,arguments)}var Hs;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Hs||(Hs={}));const pv="popstate";function yC(n){n===void 0&&(n={});function e(r,s){let{pathname:i,search:a,hash:l}=r.location;return Vf("",{pathname:i,search:a,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:kd(s)}return xC(e,t,null,n)}function Kt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function I_(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function vC(){return Math.random().toString(36).substr(2,8)}function gv(n,e){return{usr:n.state,key:n.key,idx:e}}function Vf(n,e,t,r){return t===void 0&&(t=null),ic({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Ro(e):e,{state:t,key:e&&e.key||r||vC()})}function kd(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Ro(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function xC(n,e,t,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,l=Hs.Pop,c=null,d=h();d==null&&(d=0,a.replaceState(ic({},a.state,{idx:d}),""));function h(){return(a.state||{idx:null}).idx}function m(){l=Hs.Pop;let E=h(),_=E==null?null:E-d;d=E,c&&c({action:l,location:S.location,delta:_})}function p(E,_){l=Hs.Push;let x=Vf(S.location,E,_);t&&t(x,E),d=h()+1;let C=gv(x,d),k=S.createHref(x);try{a.pushState(C,"",k)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;s.location.assign(k)}i&&c&&c({action:l,location:S.location,delta:1})}function y(E,_){l=Hs.Replace;let x=Vf(S.location,E,_);t&&t(x,E),d=h();let C=gv(x,d),k=S.createHref(x);a.replaceState(C,"",k),i&&c&&c({action:l,location:S.location,delta:0})}function v(E){let _=s.location.origin!=="null"?s.location.origin:s.location.href,x=typeof E=="string"?E:kd(E);return x=x.replace(/ $/,"%20"),Kt(_,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,_)}let S={get action(){return l},get location(){return n(s,a)},listen(E){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(pv,m),c=E,()=>{s.removeEventListener(pv,m),c=null}},createHref(E){return e(s,E)},createURL:v,encodeLocation(E){let _=v(E);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:p,replace:y,go(E){return a.go(E)}};return S}var yv;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(yv||(yv={}));function bC(n,e,t){return t===void 0&&(t="/"),wC(n,e,t,!1)}function wC(n,e,t,r){let s=typeof e=="string"?Ro(e):e,i=ug(s.pathname||"/",t);if(i==null)return null;let a=N_(n);_C(a);let l=null;for(let c=0;l==null&&c<a.length;++c){let d=RC(i);l=PC(a[c],d,r)}return l}function N_(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let s=(i,a,l)=>{let c={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};c.relativePath.startsWith("/")&&(Kt(c.relativePath.startsWith(r),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(r.length));let d=ni([r,c.relativePath]),h=t.concat(c);i.children&&i.children.length>0&&(Kt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),N_(i.children,e,h,d)),!(i.path==null&&!i.index)&&e.push({path:d,score:AC(d,i.index),routesMeta:h})};return n.forEach((i,a)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))s(i,a);else for(let c of C_(i.path))s(i,a,c)}),e}function C_(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let a=C_(r.join("/")),l=[];return l.push(...a.map(c=>c===""?i:[i,c].join("/"))),s&&l.push(...a),l.map(c=>n.startsWith("/")&&c===""?"/":c)}function _C(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:kC(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const EC=/^:[\w-]+$/,TC=3,SC=2,IC=1,NC=10,CC=-2,vv=n=>n==="*";function AC(n,e){let t=n.split("/"),r=t.length;return t.some(vv)&&(r+=CC),e&&(r+=SC),t.filter(s=>!vv(s)).reduce((s,i)=>s+(EC.test(i)?TC:i===""?IC:NC),r)}function kC(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function PC(n,e,t){t===void 0&&(t=!1);let{routesMeta:r}=n,s={},i="/",a=[];for(let l=0;l<r.length;++l){let c=r[l],d=l===r.length-1,h=i==="/"?e:e.slice(i.length)||"/",m=xv({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},h),p=c.route;if(!m&&d&&t&&!r[r.length-1].route.index&&(m=xv({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},h)),!m)return null;Object.assign(s,m.params),a.push({params:s,pathname:ni([i,m.pathname]),pathnameBase:LC(ni([i,m.pathnameBase])),route:p}),m.pathnameBase!=="/"&&(i=ni([i,m.pathnameBase]))}return a}function xv(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=jC(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,h,m)=>{let{paramName:p,isOptional:y}=h;if(p==="*"){let S=l[m]||"";a=i.slice(0,i.length-S.length).replace(/(.)\/+$/,"$1")}const v=l[m];return y&&!v?d[p]=void 0:d[p]=(v||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:a,pattern:n}}function jC(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),I_(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function RC(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return I_(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function ug(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function DC(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?Ro(n):n;return{pathname:t?t.startsWith("/")?t:MC(t,e):e,search:OC(r),hash:FC(s)}}function MC(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function Nm(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function VC(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function dg(n,e){let t=VC(n);return e?t.map((r,s)=>s===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function hg(n,e,t,r){r===void 0&&(r=!1);let s;typeof n=="string"?s=Ro(n):(s=ic({},n),Kt(!s.pathname||!s.pathname.includes("?"),Nm("?","pathname","search",s)),Kt(!s.pathname||!s.pathname.includes("#"),Nm("#","pathname","hash",s)),Kt(!s.search||!s.search.includes("#"),Nm("#","search","hash",s)));let i=n===""||s.pathname==="",a=i?"/":s.pathname,l;if(a==null)l=t;else{let m=e.length-1;if(!r&&a.startsWith("..")){let p=a.split("/");for(;p[0]==="..";)p.shift(),m-=1;s.pathname=p.join("/")}l=m>=0?e[m]:"/"}let c=DC(s,l),d=a&&a!=="/"&&a.endsWith("/"),h=(i||a===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(d||h)&&(c.pathname+="/"),c}const ni=n=>n.join("/").replace(/\/\/+/g,"/"),LC=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),OC=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,FC=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function $C(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const A_=["post","put","patch","delete"];new Set(A_);const UC=["get",...A_];new Set(UC);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ac(){return ac=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ac.apply(this,arguments)}const mg=I.createContext(null),BC=I.createContext(null),xi=I.createContext(null),yh=I.createContext(null),fs=I.createContext({outlet:null,matches:[],isDataRoute:!1}),k_=I.createContext(null);function zC(n,e){let{relative:t}=e===void 0?{}:e;Do()||Kt(!1);let{basename:r,navigator:s}=I.useContext(xi),{hash:i,pathname:a,search:l}=j_(n,{relative:t}),c=a;return r!=="/"&&(c=a==="/"?r:ni([r,a])),s.createHref({pathname:c,search:l,hash:i})}function Do(){return I.useContext(yh)!=null}function ps(){return Do()||Kt(!1),I.useContext(yh).location}function P_(n){I.useContext(xi).static||I.useLayoutEffect(n)}function hr(){let{isDataRoute:n}=I.useContext(fs);return n?nA():qC()}function qC(){Do()||Kt(!1);let n=I.useContext(mg),{basename:e,future:t,navigator:r}=I.useContext(xi),{matches:s}=I.useContext(fs),{pathname:i}=ps(),a=JSON.stringify(dg(s,t.v7_relativeSplatPath)),l=I.useRef(!1);return P_(()=>{l.current=!0}),I.useCallback(function(d,h){if(h===void 0&&(h={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let m=hg(d,JSON.parse(a),i,h.relative==="path");n==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:ni([e,m.pathname])),(h.replace?r.replace:r.push)(m,h.state,h)},[e,r,a,i,n])}function Mo(){let{matches:n}=I.useContext(fs),e=n[n.length-1];return e?e.params:{}}function j_(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=I.useContext(xi),{matches:s}=I.useContext(fs),{pathname:i}=ps(),a=JSON.stringify(dg(s,r.v7_relativeSplatPath));return I.useMemo(()=>hg(n,JSON.parse(a),i,t==="path"),[n,a,i,t])}function WC(n,e){return HC(n,e)}function HC(n,e,t,r){Do()||Kt(!1);let{navigator:s}=I.useContext(xi),{matches:i}=I.useContext(fs),a=i[i.length-1],l=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let d=ps(),h;if(e){var m;let E=typeof e=="string"?Ro(e):e;c==="/"||(m=E.pathname)!=null&&m.startsWith(c)||Kt(!1),h=E}else h=d;let p=h.pathname||"/",y=p;if(c!=="/"){let E=c.replace(/^\//,"").split("/");y="/"+p.replace(/^\//,"").split("/").slice(E.length).join("/")}let v=bC(n,{pathname:y}),S=JC(v&&v.map(E=>Object.assign({},E,{params:Object.assign({},l,E.params),pathname:ni([c,s.encodeLocation?s.encodeLocation(E.pathname).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?c:ni([c,s.encodeLocation?s.encodeLocation(E.pathnameBase).pathname:E.pathnameBase])})),i,t,r);return e&&S?I.createElement(yh.Provider,{value:{location:ac({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Hs.Pop}},S):S}function GC(){let n=tA(),e=$C(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return I.createElement(I.Fragment,null,I.createElement("h2",null,"Unexpected Application Error!"),I.createElement("h3",{style:{fontStyle:"italic"}},e),t?I.createElement("pre",{style:s},t):null,i)}const KC=I.createElement(GC,null);class QC extends I.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?I.createElement(fs.Provider,{value:this.props.routeContext},I.createElement(k_.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function YC(n){let{routeContext:e,match:t,children:r}=n,s=I.useContext(mg);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),I.createElement(fs.Provider,{value:e},r)}function JC(n,e,t,r){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var i;if(!t)return null;if(t.errors)n=t.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let a=n,l=(s=t)==null?void 0:s.errors;if(l!=null){let h=a.findIndex(m=>m.route.id&&(l==null?void 0:l[m.route.id])!==void 0);h>=0||Kt(!1),a=a.slice(0,Math.min(a.length,h+1))}let c=!1,d=-1;if(t&&r&&r.v7_partialHydration)for(let h=0;h<a.length;h++){let m=a[h];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(d=h),m.route.id){let{loaderData:p,errors:y}=t,v=m.route.loader&&p[m.route.id]===void 0&&(!y||y[m.route.id]===void 0);if(m.route.lazy||v){c=!0,d>=0?a=a.slice(0,d+1):a=[a[0]];break}}}return a.reduceRight((h,m,p)=>{let y,v=!1,S=null,E=null;t&&(y=l&&m.route.id?l[m.route.id]:void 0,S=m.route.errorElement||KC,c&&(d<0&&p===0?(rA("route-fallback",!1),v=!0,E=null):d===p&&(v=!0,E=m.route.hydrateFallbackElement||null)));let _=e.concat(a.slice(0,p+1)),x=()=>{let C;return y?C=S:v?C=E:m.route.Component?C=I.createElement(m.route.Component,null):m.route.element?C=m.route.element:C=h,I.createElement(YC,{match:m,routeContext:{outlet:h,matches:_,isDataRoute:t!=null},children:C})};return t&&(m.route.ErrorBoundary||m.route.errorElement||p===0)?I.createElement(QC,{location:t.location,revalidation:t.revalidation,component:S,error:y,children:x(),routeContext:{outlet:null,matches:_,isDataRoute:!0}}):x()},null)}var R_=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(R_||{}),Pd=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(Pd||{});function XC(n){let e=I.useContext(mg);return e||Kt(!1),e}function ZC(n){let e=I.useContext(BC);return e||Kt(!1),e}function eA(n){let e=I.useContext(fs);return e||Kt(!1),e}function D_(n){let e=eA(),t=e.matches[e.matches.length-1];return t.route.id||Kt(!1),t.route.id}function tA(){var n;let e=I.useContext(k_),t=ZC(Pd.UseRouteError),r=D_(Pd.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function nA(){let{router:n}=XC(R_.UseNavigateStable),e=D_(Pd.UseNavigateStable),t=I.useRef(!1);return P_(()=>{t.current=!0}),I.useCallback(function(s,i){i===void 0&&(i={}),t.current&&(typeof s=="number"?n.navigate(s):n.navigate(s,ac({fromRouteId:e},i)))},[n,e])}const bv={};function rA(n,e,t){!e&&!bv[n]&&(bv[n]=!0)}function sA(n,e){n==null||n.v7_startTransition,(n==null?void 0:n.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function M_(n){let{to:e,replace:t,state:r,relative:s}=n;Do()||Kt(!1);let{future:i,static:a}=I.useContext(xi),{matches:l}=I.useContext(fs),{pathname:c}=ps(),d=hr(),h=hg(e,dg(l,i.v7_relativeSplatPath),c,s==="path"),m=JSON.stringify(h);return I.useEffect(()=>d(JSON.parse(m),{replace:t,state:r,relative:s}),[d,m,s,t,r]),null}function sr(n){Kt(!1)}function iA(n){let{basename:e="/",children:t=null,location:r,navigationType:s=Hs.Pop,navigator:i,static:a=!1,future:l}=n;Do()&&Kt(!1);let c=e.replace(/^\/*/,"/"),d=I.useMemo(()=>({basename:c,navigator:i,static:a,future:ac({v7_relativeSplatPath:!1},l)}),[c,l,i,a]);typeof r=="string"&&(r=Ro(r));let{pathname:h="/",search:m="",hash:p="",state:y=null,key:v="default"}=r,S=I.useMemo(()=>{let E=ug(h,c);return E==null?null:{location:{pathname:E,search:m,hash:p,state:y,key:v},navigationType:s}},[c,h,m,p,y,v,s]);return S==null?null:I.createElement(xi.Provider,{value:d},I.createElement(yh.Provider,{children:t,value:S}))}function aA(n){let{children:e,location:t}=n;return WC(Lf(e),t)}new Promise(()=>{});function Lf(n,e){e===void 0&&(e=[]);let t=[];return I.Children.forEach(n,(r,s)=>{if(!I.isValidElement(r))return;let i=[...e,s];if(r.type===I.Fragment){t.push.apply(t,Lf(r.props.children,i));return}r.type!==sr&&Kt(!1),!r.props.index||!r.props.children||Kt(!1);let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Lf(r.props.children,i)),t.push(a)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Of(){return Of=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Of.apply(this,arguments)}function oA(n,e){if(n==null)return{};var t={},r=Object.keys(n),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function lA(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function cA(n,e){return n.button===0&&(!e||e==="_self")&&!lA(n)}const uA=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],dA="6";try{window.__reactRouterVersion=dA}catch{}const hA="startTransition",wv=iN[hA];function mA(n){let{basename:e,children:t,future:r,window:s}=n,i=I.useRef();i.current==null&&(i.current=yC({window:s,v5Compat:!0}));let a=i.current,[l,c]=I.useState({action:a.action,location:a.location}),{v7_startTransition:d}=r||{},h=I.useCallback(m=>{d&&wv?wv(()=>c(m)):c(m)},[c,d]);return I.useLayoutEffect(()=>a.listen(h),[a,h]),I.useEffect(()=>sA(r),[r]),I.createElement(iA,{basename:e,children:t,location:l.location,navigationType:l.action,navigator:a,future:r})}const fA=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",pA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Vs=I.forwardRef(function(e,t){let{onClick:r,relative:s,reloadDocument:i,replace:a,state:l,target:c,to:d,preventScrollReset:h,viewTransition:m}=e,p=oA(e,uA),{basename:y}=I.useContext(xi),v,S=!1;if(typeof d=="string"&&pA.test(d)&&(v=d,fA))try{let C=new URL(window.location.href),k=d.startsWith("//")?new URL(C.protocol+d):new URL(d),M=ug(k.pathname,y);k.origin===C.origin&&M!=null?d=M+k.search+k.hash:S=!0}catch{}let E=zC(d,{relative:s}),_=gA(d,{replace:a,state:l,target:c,preventScrollReset:h,relative:s,viewTransition:m});function x(C){r&&r(C),C.defaultPrevented||_(C)}return I.createElement("a",Of({},p,{href:v||E,onClick:S||i?r:x,ref:t,target:c}))});var _v;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(_v||(_v={}));var Ev;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(Ev||(Ev={}));function gA(n,e){let{target:t,replace:r,state:s,preventScrollReset:i,relative:a,viewTransition:l}=e===void 0?{}:e,c=hr(),d=ps(),h=j_(n,{relative:a});return I.useCallback(m=>{if(cA(m,t)){m.preventDefault();let p=r!==void 0?r:kd(d)===kd(h);c(n,{replace:p,state:s,preventScrollReset:i,relative:a,viewTransition:l})}},[d,c,h,r,s,t,n,i,a,l])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V_=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},yA=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],l=n[t++],c=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},L_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,l=a?n[s+1]:0,c=s+2<n.length,d=c?n[s+2]:0,h=i>>2,m=(i&3)<<4|l>>4;let p=(l&15)<<2|d>>6,y=d&63;c||(y=64,a||(p=64)),r.push(t[h],t[m],t[p],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(V_(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):yA(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const m=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||l==null||d==null||m==null)throw new vA;const p=i<<2|l>>4;if(r.push(p),d!==64){const y=l<<4&240|d>>2;if(r.push(y),m!==64){const v=d<<6&192|m;r.push(v)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class vA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const xA=function(n){const e=V_(n);return L_.encodeByteArray(e,!0)},jd=function(n){return xA(n).replace(/\./g,"")},O_=function(n){try{return L_.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wA=()=>bA().__FIREBASE_DEFAULTS__,_A=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},EA=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&O_(n[1]);return e&&JSON.parse(e)},vh=()=>{try{return wA()||_A()||EA()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},F_=n=>{var e,t;return(t=(e=vh())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},TA=n=>{const e=F_(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},$_=()=>{var n;return(n=vh())===null||n===void 0?void 0:n.config},U_=n=>{var e;return(e=vh())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SA{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IA(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),l="";return[jd(JSON.stringify(t)),jd(JSON.stringify(a)),l].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function on(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function NA(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(on())}function CA(){var n;const e=(n=vh())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function AA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function kA(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function PA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function jA(){const n=on();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function B_(){return!CA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function z_(){try{return typeof indexedDB=="object"}catch{return!1}}function RA(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DA="FirebaseError";class gs extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=DA,Object.setPrototypeOf(this,gs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ic.prototype.create)}}class Ic{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?MA(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new gs(s,l,r)}}function MA(n,e){return n.replace(VA,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const VA=/\{\$([^}]+)}/g;function LA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function li(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(Tv(i)&&Tv(a)){if(!li(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Tv(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nc(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function bl(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function wl(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function OA(n,e){const t=new FA(n,e);return t.subscribe.bind(t)}class FA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");$A(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Cm),s.error===void 0&&(s.error=Cm),s.complete===void 0&&(s.complete=Cm);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function $A(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Cm(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mt(n){return n&&n._delegate?n._delegate:n}class Xi{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ji="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new SA;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(zA(e))try{this.getOrInitializeService({instanceIdentifier:ji})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ji){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ji){return this.instances.has(e)}getOptions(e=ji){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const a=this.instances.get(s);return a&&e(a,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:BA(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ji){return this.component?this.component.multipleInstances?e:ji:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function BA(n){return n===ji?void 0:n}function zA(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new UA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Be;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Be||(Be={}));const WA={debug:Be.DEBUG,verbose:Be.VERBOSE,info:Be.INFO,warn:Be.WARN,error:Be.ERROR,silent:Be.SILENT},HA=Be.INFO,GA={[Be.DEBUG]:"log",[Be.VERBOSE]:"log",[Be.INFO]:"info",[Be.WARN]:"warn",[Be.ERROR]:"error"},KA=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=GA[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class fg{constructor(e){this.name=e,this._logLevel=HA,this._logHandler=KA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Be))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?WA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Be.DEBUG,...e),this._logHandler(this,Be.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Be.VERBOSE,...e),this._logHandler(this,Be.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Be.INFO,...e),this._logHandler(this,Be.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Be.WARN,...e),this._logHandler(this,Be.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Be.ERROR,...e),this._logHandler(this,Be.ERROR,...e)}}const QA=(n,e)=>e.some(t=>n instanceof t);let Sv,Iv;function YA(){return Sv||(Sv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function JA(){return Iv||(Iv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const q_=new WeakMap,Ff=new WeakMap,W_=new WeakMap,Am=new WeakMap,pg=new WeakMap;function XA(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(ri(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&q_.set(t,n)}).catch(()=>{}),pg.set(e,n),e}function ZA(n){if(Ff.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});Ff.set(n,e)}let $f={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Ff.get(n);if(e==="objectStoreNames")return n.objectStoreNames||W_.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ri(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function ek(n){$f=n($f)}function tk(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(km(this),e,...t);return W_.set(r,e.sort?e.sort():[e]),ri(r)}:JA().includes(n)?function(...e){return n.apply(km(this),e),ri(q_.get(this))}:function(...e){return ri(n.apply(km(this),e))}}function nk(n){return typeof n=="function"?tk(n):(n instanceof IDBTransaction&&ZA(n),QA(n,YA())?new Proxy(n,$f):n)}function ri(n){if(n instanceof IDBRequest)return XA(n);if(Am.has(n))return Am.get(n);const e=nk(n);return e!==n&&(Am.set(n,e),pg.set(e,n)),e}const km=n=>pg.get(n);function rk(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),l=ri(a);return r&&a.addEventListener("upgradeneeded",c=>{r(ri(a.result),c.oldVersion,c.newVersion,ri(a.transaction),c)}),t&&a.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const sk=["get","getKey","getAll","getAllKeys","count"],ik=["put","add","delete","clear"],Pm=new Map;function Nv(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Pm.get(e))return Pm.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=ik.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||sk.includes(t)))return;const i=async function(a,...l){const c=this.transaction(a,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),s&&c.done]))[0]};return Pm.set(e,i),i}ek(n=>({...n,get:(e,t,r)=>Nv(e,t)||n.get(e,t,r),has:(e,t)=>!!Nv(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(ok(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function ok(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Uf="@firebase/app",Cv="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const os=new fg("@firebase/app"),lk="@firebase/app-compat",ck="@firebase/analytics-compat",uk="@firebase/analytics",dk="@firebase/app-check-compat",hk="@firebase/app-check",mk="@firebase/auth",fk="@firebase/auth-compat",pk="@firebase/database",gk="@firebase/data-connect",yk="@firebase/database-compat",vk="@firebase/functions",xk="@firebase/functions-compat",bk="@firebase/installations",wk="@firebase/installations-compat",_k="@firebase/messaging",Ek="@firebase/messaging-compat",Tk="@firebase/performance",Sk="@firebase/performance-compat",Ik="@firebase/remote-config",Nk="@firebase/remote-config-compat",Ck="@firebase/storage",Ak="@firebase/storage-compat",kk="@firebase/firestore",Pk="@firebase/vertexai-preview",jk="@firebase/firestore-compat",Rk="firebase",Dk="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rd="[DEFAULT]",Mk={[Uf]:"fire-core",[lk]:"fire-core-compat",[uk]:"fire-analytics",[ck]:"fire-analytics-compat",[hk]:"fire-app-check",[dk]:"fire-app-check-compat",[mk]:"fire-auth",[fk]:"fire-auth-compat",[pk]:"fire-rtdb",[gk]:"fire-data-connect",[yk]:"fire-rtdb-compat",[vk]:"fire-fn",[xk]:"fire-fn-compat",[bk]:"fire-iid",[wk]:"fire-iid-compat",[_k]:"fire-fcm",[Ek]:"fire-fcm-compat",[Tk]:"fire-perf",[Sk]:"fire-perf-compat",[Ik]:"fire-rc",[Nk]:"fire-rc-compat",[Ck]:"fire-gcs",[Ak]:"fire-gcs-compat",[kk]:"fire-fst",[jk]:"fire-fst-compat",[Pk]:"fire-vertex","fire-js":"fire-js",[Rk]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dd=new Map,Vk=new Map,Bf=new Map;function Av(n,e){try{n.container.addComponent(e)}catch(t){os.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function mo(n){const e=n.name;if(Bf.has(e))return os.debug(`There were multiple attempts to register component ${e}.`),!1;Bf.set(e,n);for(const t of Dd.values())Av(t,n);for(const t of Vk.values())Av(t,n);return!0}function Cc(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Lk(n,e,t=Rd){Cc(n,e).clearInstance(t)}function Rr(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ok={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},si=new Ic("app","Firebase",Ok);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Xi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw si.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vo=Dk;function H_(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Rd,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw si.create("bad-app-name",{appName:String(s)});if(t||(t=$_()),!t)throw si.create("no-options");const i=Dd.get(s);if(i){if(li(t,i.options)&&li(r,i.config))return i;throw si.create("duplicate-app",{appName:s})}const a=new qA(s);for(const c of Bf.values())a.addComponent(c);const l=new Fk(t,r,a);return Dd.set(s,l),l}function G_(n=Rd){const e=Dd.get(n);if(!e&&n===Rd&&$_())return H_();if(!e)throw si.create("no-app",{appName:n});return e}function ii(n,e,t){var r;let s=(r=Mk[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const l=[`Unable to register library "${s}" with version "${e}":`];i&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),os.warn(l.join(" "));return}mo(new Xi(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $k="firebase-heartbeat-database",Uk=1,oc="firebase-heartbeat-store";let jm=null;function K_(){return jm||(jm=rk($k,Uk,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(oc)}catch(t){console.warn(t)}}}}).catch(n=>{throw si.create("idb-open",{originalErrorMessage:n.message})})),jm}async function Bk(n){try{const t=(await K_()).transaction(oc),r=await t.objectStore(oc).get(Q_(n));return await t.done,r}catch(e){if(e instanceof gs)os.warn(e.message);else{const t=si.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});os.warn(t.message)}}}async function kv(n,e){try{const r=(await K_()).transaction(oc,"readwrite");await r.objectStore(oc).put(e,Q_(n)),await r.done}catch(t){if(t instanceof gs)os.warn(t.message);else{const r=si.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});os.warn(r.message)}}}function Q_(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zk=1024,qk=30*24*60*60*1e3;class Wk{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Gk(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Pv();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const l=new Date(a.date).valueOf();return Date.now()-l<=qk}),this._storage.overwrite(this._heartbeatsCache))}catch(r){os.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Pv(),{heartbeatsToSend:r,unsentEntries:s}=Hk(this._heartbeatsCache.heartbeats),i=jd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return os.warn(t),""}}}function Pv(){return new Date().toISOString().substring(0,10)}function Hk(n,e=zk){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),jv(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),jv(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Gk{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return z_()?RA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Bk(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return kv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return kv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function jv(n){return jd(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kk(n){mo(new Xi("platform-logger",e=>new ak(e),"PRIVATE")),mo(new Xi("heartbeat",e=>new Wk(e),"PRIVATE")),ii(Uf,Cv,n),ii(Uf,Cv,"esm2017"),ii("fire-js","")}Kk("");function gg(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function Y_(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Qk=Y_,J_=new Ic("auth","Firebase",Y_());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Md=new fg("@firebase/auth");function Yk(n,...e){Md.logLevel<=Be.WARN&&Md.warn(`Auth (${Vo}): ${n}`,...e)}function Hu(n,...e){Md.logLevel<=Be.ERROR&&Md.error(`Auth (${Vo}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ar(n,...e){throw yg(n,...e)}function Or(n,...e){return yg(n,...e)}function X_(n,e,t){const r=Object.assign(Object.assign({},Qk()),{[e]:t});return new Ic("auth","Firebase",r).create(e,{appName:n.name})}function ns(n){return X_(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function yg(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return J_.create(n,...e)}function Ne(n,e,...t){if(!n)throw yg(e,...t)}function Jr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Hu(e),new Error(e)}function ls(n,e){n||Jr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zf(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Jk(){return Rv()==="http:"||Rv()==="https:"}function Rv(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xk(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Jk()||kA()||"connection"in navigator)?navigator.onLine:!0}function Zk(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac{constructor(e,t){this.shortDelay=e,this.longDelay=t,ls(t>e,"Short delay should be less than long delay!"),this.isMobile=NA()||PA()}get(){return Xk()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vg(n,e){ls(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z_{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Jr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Jr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Jr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tP=new Ac(3e4,6e4);function ys(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function vs(n,e,t,r,s={}){return eE(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=Nc(Object.assign({key:n.config.apiKey},a)).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const d=Object.assign({method:e,headers:c},i);return AA()||(d.referrerPolicy="no-referrer"),Z_.fetch()(tE(n,n.config.apiHost,t,l),d)})}async function eE(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},eP),e);try{const s=new rP(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Tu(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Tu(n,"credential-already-in-use",a);if(c==="EMAIL_EXISTS")throw Tu(n,"email-already-in-use",a);if(c==="USER_DISABLED")throw Tu(n,"user-disabled",a);const h=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw X_(n,h,d);Ar(n,h)}}catch(s){if(s instanceof gs)throw s;Ar(n,"network-request-failed",{message:String(s)})}}async function kc(n,e,t,r,s={}){const i=await vs(n,e,t,r,s);return"mfaPendingCredential"in i&&Ar(n,"multi-factor-auth-required",{_serverResponse:i}),i}function tE(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?vg(n.config,s):`${n.config.apiScheme}://${s}`}function nP(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class rP{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Or(this.auth,"network-request-failed")),tP.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Tu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Or(n,e,r);return s.customData._tokenResponse=t,s}function Dv(n){return n!==void 0&&n.enterprise!==void 0}class sP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return nP(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function iP(n,e){return vs(n,"GET","/v2/recaptchaConfig",ys(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aP(n,e){return vs(n,"POST","/v1/accounts:delete",e)}async function nE(n,e){return vs(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ml(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function oP(n,e=!1){const t=mt(n),r=await t.getIdToken(e),s=xg(r);Ne(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Ml(Rm(s.auth_time)),issuedAtTime:Ml(Rm(s.iat)),expirationTime:Ml(Rm(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Rm(n){return Number(n)*1e3}function xg(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Hu("JWT malformed, contained fewer than 3 sections"),null;try{const s=O_(t);return s?JSON.parse(s):(Hu("Failed to decode base64 JWT payload"),null)}catch(s){return Hu("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Mv(n){const e=xg(n);return Ne(e,"internal-error"),Ne(typeof e.exp<"u","internal-error"),Ne(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lc(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof gs&&lP(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function lP({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cP{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ml(this.lastLoginAt),this.creationTime=Ml(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vd(n){var e;const t=n.auth,r=await n.getIdToken(),s=await lc(n,nE(t,{idToken:r}));Ne(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const a=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?rE(i.providerUserInfo):[],l=dP(n.providerData,a),c=n.isAnonymous,d=!(n.email&&i.passwordHash)&&!(l!=null&&l.length),h=c?d:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new qf(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,m)}async function uP(n){const e=mt(n);await Vd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function dP(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function rE(n){return n.map(e=>{var{providerId:t}=e,r=gg(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hP(n,e){const t=await eE(n,{},async()=>{const r=Nc({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=tE(n,s,"/v1/token",`key=${i}`),l=await n._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",Z_.fetch()(a,{method:"POST",headers:l,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function mP(n,e){return vs(n,"POST","/v2/accounts:revokeToken",ys(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ne(e.idToken,"internal-error"),Ne(typeof e.idToken<"u","internal-error"),Ne(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Mv(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ne(e.length!==0,"internal-error");const t=Mv(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ne(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await hP(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new eo;return r&&(Ne(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(Ne(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(Ne(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new eo,this.toJSON())}_performRefresh(){return Jr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cs(n,e){Ne(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Xr{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=gg(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new cP(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new qf(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await lc(this,this.stsTokenManager.getToken(this.auth,e));return Ne(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return oP(this,e)}reload(){return uP(this)}_assign(e){this!==e&&(Ne(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Xr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ne(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Vd(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Rr(this.auth.app))return Promise.reject(ns(this.auth));const e=await this.getIdToken();return await lc(this,aP(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,a,l,c,d,h;const m=(r=t.displayName)!==null&&r!==void 0?r:void 0,p=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,v=(a=t.photoURL)!==null&&a!==void 0?a:void 0,S=(l=t.tenantId)!==null&&l!==void 0?l:void 0,E=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,_=(d=t.createdAt)!==null&&d!==void 0?d:void 0,x=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:C,emailVerified:k,isAnonymous:M,providerData:F,stsTokenManager:w}=t;Ne(C&&w,e,"internal-error");const b=eo.fromJSON(this.name,w);Ne(typeof C=="string",e,"internal-error"),Cs(m,e.name),Cs(p,e.name),Ne(typeof k=="boolean",e,"internal-error"),Ne(typeof M=="boolean",e,"internal-error"),Cs(y,e.name),Cs(v,e.name),Cs(S,e.name),Cs(E,e.name),Cs(_,e.name),Cs(x,e.name);const N=new Xr({uid:C,auth:e,email:p,emailVerified:k,displayName:m,isAnonymous:M,photoURL:v,phoneNumber:y,tenantId:S,stsTokenManager:b,createdAt:_,lastLoginAt:x});return F&&Array.isArray(F)&&(N.providerData=F.map(A=>Object.assign({},A))),E&&(N._redirectEventId=E),N}static async _fromIdTokenResponse(e,t,r=!1){const s=new eo;s.updateFromServerResponse(t);const i=new Xr({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Vd(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];Ne(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?rE(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new eo;l.updateFromIdToken(r);const c=new Xr({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new qf(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vv=new Map;function Zr(n){ls(n instanceof Function,"Expected a class definition");let e=Vv.get(n);return e?(ls(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Vv.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}sE.type="NONE";const Lv=sE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gu(n,e,t){return`firebase:${n}:${e}:${t}`}class to{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Gu(this.userKey,s.apiKey,i),this.fullPersistenceKey=Gu("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Xr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new to(Zr(Lv),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||Zr(Lv);const a=Gu(r,e.config.apiKey,e.name);let l=null;for(const d of t)try{const h=await d._get(a);if(h){const m=Xr._fromJSON(e,h);d!==i&&(l=m),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new to(i,e,r):(i=c[0],l&&await i._set(a,l.toJSON()),await Promise.all(t.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new to(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ov(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(lE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(iE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(uE(e))return"Blackberry";if(dE(e))return"Webos";if(aE(e))return"Safari";if((e.includes("chrome/")||oE(e))&&!e.includes("edge/"))return"Chrome";if(cE(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function iE(n=on()){return/firefox\//i.test(n)}function aE(n=on()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function oE(n=on()){return/crios\//i.test(n)}function lE(n=on()){return/iemobile/i.test(n)}function cE(n=on()){return/android/i.test(n)}function uE(n=on()){return/blackberry/i.test(n)}function dE(n=on()){return/webos/i.test(n)}function bg(n=on()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function fP(n=on()){var e;return bg(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function pP(){return jA()&&document.documentMode===10}function hE(n=on()){return bg(n)||cE(n)||dE(n)||uE(n)||/windows phone/i.test(n)||lE(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mE(n,e=[]){let t;switch(n){case"Browser":t=Ov(on());break;case"Worker":t=`${Ov(on())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Vo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,l)=>{try{const c=e(i);a(c)}catch(c){l(c)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yP(n,e={}){return vs(n,"GET","/v2/passwordPolicy",ys(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vP=6;class xP{constructor(e){var t,r,s,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:vP,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,a,l;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(s=c.containsLowercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(i=c.containsUppercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(a=c.containsNumericCharacter)!==null&&a!==void 0?a:!0),c.isValid&&(c.isValid=(l=c.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),c}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bP{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Fv(this),this.idTokenSubscription=new Fv(this),this.beforeStateQueue=new gP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=J_,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Zr(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await to.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await nE(this,{idToken:e}),r=await Xr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Rr(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(l,l))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,l=s==null?void 0:s._redirectEventId,c=await this.tryRedirectSignIn(e);(!a||a===l)&&(c!=null&&c.user)&&(s=c.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ne(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Vd(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Zk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Rr(this.app))return Promise.reject(ns(this));const t=e?mt(e):null;return t&&Ne(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ne(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Rr(this.app)?Promise.reject(ns(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Rr(this.app)?Promise.reject(ns(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Zr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await yP(this),t=new xP(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ic("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await mP(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Zr(e)||this._popupRedirectResolver;Ne(t,this,"argument-error"),this.redirectPersistenceManager=await to.create(this,[Zr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ne(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,r,s);return()=>{a=!0,c()}}else{const c=e.addObserver(t);return()=>{a=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ne(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=mE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&Yk(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function ma(n){return mt(n)}class Fv{constructor(e){this.auth=e,this.observer=null,this.addObserver=OA(t=>this.observer=t)}get next(){return Ne(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function wP(n){xh=n}function fE(n){return xh.loadJS(n)}function _P(){return xh.recaptchaEnterpriseScript}function EP(){return xh.gapiScript}function TP(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const SP="recaptcha-enterprise",IP="NO_RECAPTCHA";class NP{constructor(e){this.type=SP,this.auth=ma(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,l)=>{iP(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new sP(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,a,l){const c=window.grecaptcha;Dv(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(IP)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,a)=>{r(this.auth).then(l=>{if(!t&&Dv(window.grecaptcha))s(l,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let c=_P();c.length!==0&&(c+=l),fE(c).then(()=>{s(l,i,a)}).catch(d=>{a(d)})}}).catch(l=>{a(l)})})}}async function $v(n,e,t,r=!1){const s=new NP(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const a=Object.assign({},e);return r?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Wf(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await $v(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await $v(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CP(n,e){const t=Cc(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(li(i,e??{}))return s;Ar(s,"already-initialized")}return t.initialize({options:e})}function AP(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Zr);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function kP(n,e,t){const r=ma(n);Ne(r._canInitEmulator,r,"emulator-config-failed"),Ne(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=pE(e),{host:a,port:l}=PP(e),c=l===null?"":`:${l}`;r.config.emulator={url:`${i}//${a}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||jP()}function pE(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function PP(n){const e=pE(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Uv(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:Uv(a)}}}function Uv(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function jP(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Jr("not implemented")}_getIdTokenResponse(e){return Jr("not implemented")}_linkToIdToken(e,t){return Jr("not implemented")}_getReauthenticationResolver(e){return Jr("not implemented")}}async function RP(n,e){return vs(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DP(n,e){return kc(n,"POST","/v1/accounts:signInWithPassword",ys(n,e))}async function MP(n,e){return vs(n,"POST","/v1/accounts:sendOobCode",ys(n,e))}async function VP(n,e){return MP(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LP(n,e){return kc(n,"POST","/v1/accounts:signInWithEmailLink",ys(n,e))}async function OP(n,e){return kc(n,"POST","/v1/accounts:signInWithEmailLink",ys(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc extends wg{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new cc(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new cc(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Wf(e,t,"signInWithPassword",DP);case"emailLink":return LP(e,{email:this._email,oobCode:this._password});default:Ar(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Wf(e,r,"signUpPassword",RP);case"emailLink":return OP(e,{idToken:t,email:this._email,oobCode:this._password});default:Ar(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function no(n,e){return kc(n,"POST","/v1/accounts:signInWithIdp",ys(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FP="http://localhost";class Zi extends wg{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Zi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ar("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=gg(t,["providerId","signInMethod"]);if(!r||!s)return null;const a=new Zi(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return no(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,no(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,no(e,t)}buildRequest(){const e={requestUri:FP,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Nc(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $P(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function UP(n){const e=bl(wl(n)).link,t=e?bl(wl(e)).deep_link_id:null,r=bl(wl(n)).deep_link_id;return(r?bl(wl(r)).link:null)||r||t||e||n}class _g{constructor(e){var t,r,s,i,a,l;const c=bl(wl(e)),d=(t=c.apiKey)!==null&&t!==void 0?t:null,h=(r=c.oobCode)!==null&&r!==void 0?r:null,m=$P((s=c.mode)!==null&&s!==void 0?s:null);Ne(d&&h&&m,"argument-error"),this.apiKey=d,this.operation=m,this.code=h,this.continueUrl=(i=c.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(a=c.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(l=c.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const t=UP(e);try{return new _g(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo{constructor(){this.providerId=Lo.PROVIDER_ID}static credential(e,t){return cc._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=_g.parseLink(t);return Ne(r,"argument-error"),cc._fromEmailAndCode(e,r.code,r.tenantId)}}Lo.PROVIDER_ID="password";Lo.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Lo.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc extends gE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls extends Pc{constructor(){super("facebook.com")}static credential(e){return Zi._fromParams({providerId:Ls.PROVIDER_ID,signInMethod:Ls.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ls.credentialFromTaggedObject(e)}static credentialFromError(e){return Ls.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ls.credential(e.oauthAccessToken)}catch{return null}}}Ls.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ls.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os extends Pc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Zi._fromParams({providerId:Os.PROVIDER_ID,signInMethod:Os.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Os.credentialFromTaggedObject(e)}static credentialFromError(e){return Os.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Os.credential(t,r)}catch{return null}}}Os.GOOGLE_SIGN_IN_METHOD="google.com";Os.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs extends Pc{constructor(){super("github.com")}static credential(e){return Zi._fromParams({providerId:Fs.PROVIDER_ID,signInMethod:Fs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Fs.credentialFromTaggedObject(e)}static credentialFromError(e){return Fs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Fs.credential(e.oauthAccessToken)}catch{return null}}}Fs.GITHUB_SIGN_IN_METHOD="github.com";Fs.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s extends Pc{constructor(){super("twitter.com")}static credential(e,t){return Zi._fromParams({providerId:$s.PROVIDER_ID,signInMethod:$s.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return $s.credentialFromTaggedObject(e)}static credentialFromError(e){return $s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return $s.credential(t,r)}catch{return null}}}$s.TWITTER_SIGN_IN_METHOD="twitter.com";$s.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BP(n,e){return kc(n,"POST","/v1/accounts:signUp",ys(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Xr._fromIdTokenResponse(e,r,s),a=Bv(r);return new ea({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Bv(r);return new ea({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Bv(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ld extends gs{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Ld.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Ld(e,t,r,s)}}function yE(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Ld._fromErrorAndOperation(n,i,e,r):i})}async function zP(n,e,t=!1){const r=await lc(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ea._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qP(n,e,t=!1){const{auth:r}=n;if(Rr(r.app))return Promise.reject(ns(r));const s="reauthenticate";try{const i=await lc(n,yE(r,s,e,n),t);Ne(i.idToken,r,"internal-error");const a=xg(i.idToken);Ne(a,r,"internal-error");const{sub:l}=a;return Ne(n.uid===l,r,"user-mismatch"),ea._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Ar(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vE(n,e,t=!1){if(Rr(n.app))return Promise.reject(ns(n));const r="signIn",s=await yE(n,r,e),i=await ea._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function WP(n,e){return vE(ma(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HP(n,e,t){var r;Ne(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),Ne(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(Ne(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(Ne(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xE(n){const e=ma(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function GP(n,e,t){if(Rr(n.app))return Promise.reject(ns(n));const r=ma(n),a=await Wf(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",BP).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&xE(n),c}),l=await ea._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function KP(n,e,t){return Rr(n.app)?Promise.reject(ns(n)):WP(mt(n),Lo.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&xE(n),r})}async function QP(n,e){const t=mt(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&HP(t.auth,s,e);const{email:i}=await VP(t.auth,s);i!==n.email&&await n.reload()}function YP(n,e,t,r){return mt(n).onIdTokenChanged(e,t,r)}function JP(n,e,t){return mt(n).beforeAuthStateChanged(e,t)}function bE(n,e,t,r){return mt(n).onAuthStateChanged(e,t,r)}function wE(n){return mt(n).signOut()}const Od="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _E{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Od,"1"),this.storage.removeItem(Od),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XP=1e3,ZP=10;class EE extends _E{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=hE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,c)=>{this.notifyListeners(a,c)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);pP()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,ZP):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},XP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}EE.type="LOCAL";const ej=EE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TE extends _E{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}TE.type="SESSION";const SE=TE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tj(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new bh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(t.origin,i)),c=await tj(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}bh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eg(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nj{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,c)=>{const d=Eg("",20);s.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(m){const p=m;if(p.data.eventId===d)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(p.data.response);break;default:clearTimeout(h),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fr(){return window}function rj(n){Fr().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IE(){return typeof Fr().WorkerGlobalScope<"u"&&typeof Fr().importScripts=="function"}async function sj(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function ij(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function aj(){return IE()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NE="firebaseLocalStorageDb",oj=1,Fd="firebaseLocalStorage",CE="fbase_key";class jc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function wh(n,e){return n.transaction([Fd],e?"readwrite":"readonly").objectStore(Fd)}function lj(){const n=indexedDB.deleteDatabase(NE);return new jc(n).toPromise()}function Hf(){const n=indexedDB.open(NE,oj);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Fd,{keyPath:CE})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Fd)?e(r):(r.close(),await lj(),e(await Hf()))})})}async function zv(n,e,t){const r=wh(n,!0).put({[CE]:e,value:t});return new jc(r).toPromise()}async function cj(n,e){const t=wh(n,!1).get(e),r=await new jc(t).toPromise();return r===void 0?null:r.value}function qv(n,e){const t=wh(n,!0).delete(e);return new jc(t).toPromise()}const uj=800,dj=3;class AE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Hf(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>dj)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return IE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=bh._getInstance(aj()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await sj(),!this.activeServiceWorker)return;this.sender=new nj(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||ij()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Hf();return await zv(e,Od,"1"),await qv(e,Od),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>zv(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>cj(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>qv(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=wh(s,!1).getAll();return new jc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),uj)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}AE.type="LOCAL";const hj=AE;new Ac(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mj(n,e){return e?Zr(e):(Ne(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg extends wg{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return no(e,this._buildIdpRequest())}_linkToIdToken(e,t){return no(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return no(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function fj(n){return vE(n.auth,new Tg(n),n.bypassAuthState)}function pj(n){const{auth:e,user:t}=n;return Ne(t,e,"internal-error"),qP(t,new Tg(n),n.bypassAuthState)}async function gj(n){const{auth:e,user:t}=n;return Ne(t,e,"internal-error"),zP(t,new Tg(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kE{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const c={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return fj;case"linkViaPopup":case"linkViaRedirect":return gj;case"reauthViaPopup":case"reauthViaRedirect":return pj;default:Ar(this.auth,"internal-error")}}resolve(e){ls(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ls(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yj=new Ac(2e3,1e4);class Ga extends kE{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Ga.currentPopupAction&&Ga.currentPopupAction.cancel(),Ga.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ne(e,this.auth,"internal-error"),e}async onExecution(){ls(this.filter.length===1,"Popup operations only handle one event");const e=Eg();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Or(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Or(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ga.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Or(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,yj.get())};e()}}Ga.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vj="pendingRedirect",Ku=new Map;class xj extends kE{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Ku.get(this.auth._key());if(!e){try{const r=await bj(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Ku.set(this.auth._key(),e)}return this.bypassAuthState||Ku.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function bj(n,e){const t=Ej(e),r=_j(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function wj(n,e){Ku.set(n._key(),e)}function _j(n){return Zr(n._redirectPersistence)}function Ej(n){return Gu(vj,n.config.apiKey,n.name)}async function Tj(n,e,t=!1){if(Rr(n.app))return Promise.reject(ns(n));const r=ma(n),s=mj(r,e),a=await new xj(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sj=10*60*1e3;class Ij{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Nj(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!PE(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Or(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Sj&&this.cachedEventUids.clear(),this.cachedEventUids.has(Wv(e))}saveEventToCache(e){this.cachedEventUids.add(Wv(e)),this.lastProcessedEventTime=Date.now()}}function Wv(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function PE({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Nj(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return PE(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cj(n,e={}){return vs(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aj=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,kj=/^https?/;async function Pj(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Cj(n);for(const t of e)try{if(jj(t))return}catch{}Ar(n,"unauthorized-domain")}function jj(n){const e=zf(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!kj.test(t))return!1;if(Aj.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rj=new Ac(3e4,6e4);function Hv(){const n=Fr().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Dj(n){return new Promise((e,t)=>{var r,s,i;function a(){Hv(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Hv(),t(Or(n,"network-request-failed"))},timeout:Rj.get()})}if(!((s=(r=Fr().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Fr().gapi)===null||i===void 0)&&i.load)a();else{const l=TP("iframefcb");return Fr()[l]=()=>{gapi.load?a():t(Or(n,"network-request-failed"))},fE(`${EP()}?onload=${l}`).catch(c=>t(c))}}).catch(e=>{throw Qu=null,e})}let Qu=null;function Mj(n){return Qu=Qu||Dj(n),Qu}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vj=new Ac(5e3,15e3),Lj="__/auth/iframe",Oj="emulator/auth/iframe",Fj={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},$j=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Uj(n){const e=n.config;Ne(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?vg(e,Oj):`https://${n.config.authDomain}/${Lj}`,r={apiKey:e.apiKey,appName:n.name,v:Vo},s=$j.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Nc(r).slice(1)}`}async function Bj(n){const e=await Mj(n),t=Fr().gapi;return Ne(t,n,"internal-error"),e.open({where:document.body,url:Uj(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Fj,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=Or(n,"network-request-failed"),l=Fr().setTimeout(()=>{i(a)},Vj.get());function c(){Fr().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zj={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},qj=500,Wj=600,Hj="_blank",Gj="http://localhost";class Gv{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Kj(n,e,t,r=qj,s=Wj){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c=Object.assign(Object.assign({},zj),{width:r.toString(),height:s.toString(),top:i,left:a}),d=on().toLowerCase();t&&(l=oE(d)?Hj:t),iE(d)&&(e=e||Gj,c.scrollbars="yes");const h=Object.entries(c).reduce((p,[y,v])=>`${p}${y}=${v},`,"");if(fP(d)&&l!=="_self")return Qj(e||"",l),new Gv(null);const m=window.open(e||"",l,h);Ne(m,n,"popup-blocked");try{m.focus()}catch{}return new Gv(m)}function Qj(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yj="__/auth/handler",Jj="emulator/auth/handler",Xj=encodeURIComponent("fac");async function Kv(n,e,t,r,s,i){Ne(n.config.authDomain,n,"auth-domain-config-required"),Ne(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Vo,eventId:s};if(e instanceof gE){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",LA(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,m]of Object.entries(i||{}))a[h]=m}if(e instanceof Pc){const h=e.getScopes().filter(m=>m!=="");h.length>0&&(a.scopes=h.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const h of Object.keys(l))l[h]===void 0&&delete l[h];const c=await n._getAppCheckToken(),d=c?`#${Xj}=${encodeURIComponent(c)}`:"";return`${Zj(n)}?${Nc(l).slice(1)}${d}`}function Zj({config:n}){return n.emulator?vg(n,Jj):`https://${n.authDomain}/${Yj}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dm="webStorageSupport";class eR{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=SE,this._completeRedirectFn=Tj,this._overrideRedirectResult=wj}async _openPopup(e,t,r,s){var i;ls((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await Kv(e,t,r,zf(),s);return Kj(e,a,Eg())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Kv(e,t,r,zf(),s);return rj(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(ls(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await Bj(e),r=new Ij(e);return t.register("authEvent",s=>(Ne(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Dm,{type:Dm},s=>{var i;const a=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Dm];a!==void 0&&t(!!a),Ar(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Pj(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return hE()||aE()||bg()}}const tR=eR;var Qv="@firebase/auth",Yv="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nR{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ne(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rR(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function sR(n){mo(new Xi("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;Ne(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:mE(n)},d=new bP(r,s,i,c);return AP(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),mo(new Xi("auth-internal",e=>{const t=ma(e.getProvider("auth").getImmediate());return(r=>new nR(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ii(Qv,Yv,rR(n)),ii(Qv,Yv,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iR=5*60,aR=U_("authIdTokenMaxAge")||iR;let Jv=null;const oR=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>aR)return;const s=t==null?void 0:t.token;Jv!==s&&(Jv=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function lR(n=G_()){const e=Cc(n,"auth");if(e.isInitialized())return e.getImmediate();const t=CP(n,{popupRedirectResolver:tR,persistence:[hj,ej,SE]}),r=U_("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=oR(i.toString());JP(t,a,()=>a(t.currentUser)),YP(t,l=>a(l))}}const s=F_("auth");return s&&kP(t,`http://${s}`),t}function cR(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}wP({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Or("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",cR().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});sR("Browser");var uR="firebase",dR="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ii(uR,dR,"app");var Xv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Wi,jE;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(w,b){function N(){}N.prototype=b.prototype,w.D=b.prototype,w.prototype=new N,w.prototype.constructor=w,w.C=function(A,j,D){for(var P=Array(arguments.length-2),Ve=2;Ve<arguments.length;Ve++)P[Ve-2]=arguments[Ve];return b.prototype[j].apply(A,P)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(w,b,N){N||(N=0);var A=Array(16);if(typeof b=="string")for(var j=0;16>j;++j)A[j]=b.charCodeAt(N++)|b.charCodeAt(N++)<<8|b.charCodeAt(N++)<<16|b.charCodeAt(N++)<<24;else for(j=0;16>j;++j)A[j]=b[N++]|b[N++]<<8|b[N++]<<16|b[N++]<<24;b=w.g[0],N=w.g[1],j=w.g[2];var D=w.g[3],P=b+(D^N&(j^D))+A[0]+3614090360&4294967295;b=N+(P<<7&4294967295|P>>>25),P=D+(j^b&(N^j))+A[1]+3905402710&4294967295,D=b+(P<<12&4294967295|P>>>20),P=j+(N^D&(b^N))+A[2]+606105819&4294967295,j=D+(P<<17&4294967295|P>>>15),P=N+(b^j&(D^b))+A[3]+3250441966&4294967295,N=j+(P<<22&4294967295|P>>>10),P=b+(D^N&(j^D))+A[4]+4118548399&4294967295,b=N+(P<<7&4294967295|P>>>25),P=D+(j^b&(N^j))+A[5]+1200080426&4294967295,D=b+(P<<12&4294967295|P>>>20),P=j+(N^D&(b^N))+A[6]+2821735955&4294967295,j=D+(P<<17&4294967295|P>>>15),P=N+(b^j&(D^b))+A[7]+4249261313&4294967295,N=j+(P<<22&4294967295|P>>>10),P=b+(D^N&(j^D))+A[8]+1770035416&4294967295,b=N+(P<<7&4294967295|P>>>25),P=D+(j^b&(N^j))+A[9]+2336552879&4294967295,D=b+(P<<12&4294967295|P>>>20),P=j+(N^D&(b^N))+A[10]+4294925233&4294967295,j=D+(P<<17&4294967295|P>>>15),P=N+(b^j&(D^b))+A[11]+2304563134&4294967295,N=j+(P<<22&4294967295|P>>>10),P=b+(D^N&(j^D))+A[12]+1804603682&4294967295,b=N+(P<<7&4294967295|P>>>25),P=D+(j^b&(N^j))+A[13]+4254626195&4294967295,D=b+(P<<12&4294967295|P>>>20),P=j+(N^D&(b^N))+A[14]+2792965006&4294967295,j=D+(P<<17&4294967295|P>>>15),P=N+(b^j&(D^b))+A[15]+1236535329&4294967295,N=j+(P<<22&4294967295|P>>>10),P=b+(j^D&(N^j))+A[1]+4129170786&4294967295,b=N+(P<<5&4294967295|P>>>27),P=D+(N^j&(b^N))+A[6]+3225465664&4294967295,D=b+(P<<9&4294967295|P>>>23),P=j+(b^N&(D^b))+A[11]+643717713&4294967295,j=D+(P<<14&4294967295|P>>>18),P=N+(D^b&(j^D))+A[0]+3921069994&4294967295,N=j+(P<<20&4294967295|P>>>12),P=b+(j^D&(N^j))+A[5]+3593408605&4294967295,b=N+(P<<5&4294967295|P>>>27),P=D+(N^j&(b^N))+A[10]+38016083&4294967295,D=b+(P<<9&4294967295|P>>>23),P=j+(b^N&(D^b))+A[15]+3634488961&4294967295,j=D+(P<<14&4294967295|P>>>18),P=N+(D^b&(j^D))+A[4]+3889429448&4294967295,N=j+(P<<20&4294967295|P>>>12),P=b+(j^D&(N^j))+A[9]+568446438&4294967295,b=N+(P<<5&4294967295|P>>>27),P=D+(N^j&(b^N))+A[14]+3275163606&4294967295,D=b+(P<<9&4294967295|P>>>23),P=j+(b^N&(D^b))+A[3]+4107603335&4294967295,j=D+(P<<14&4294967295|P>>>18),P=N+(D^b&(j^D))+A[8]+1163531501&4294967295,N=j+(P<<20&4294967295|P>>>12),P=b+(j^D&(N^j))+A[13]+2850285829&4294967295,b=N+(P<<5&4294967295|P>>>27),P=D+(N^j&(b^N))+A[2]+4243563512&4294967295,D=b+(P<<9&4294967295|P>>>23),P=j+(b^N&(D^b))+A[7]+1735328473&4294967295,j=D+(P<<14&4294967295|P>>>18),P=N+(D^b&(j^D))+A[12]+2368359562&4294967295,N=j+(P<<20&4294967295|P>>>12),P=b+(N^j^D)+A[5]+4294588738&4294967295,b=N+(P<<4&4294967295|P>>>28),P=D+(b^N^j)+A[8]+2272392833&4294967295,D=b+(P<<11&4294967295|P>>>21),P=j+(D^b^N)+A[11]+1839030562&4294967295,j=D+(P<<16&4294967295|P>>>16),P=N+(j^D^b)+A[14]+4259657740&4294967295,N=j+(P<<23&4294967295|P>>>9),P=b+(N^j^D)+A[1]+2763975236&4294967295,b=N+(P<<4&4294967295|P>>>28),P=D+(b^N^j)+A[4]+1272893353&4294967295,D=b+(P<<11&4294967295|P>>>21),P=j+(D^b^N)+A[7]+4139469664&4294967295,j=D+(P<<16&4294967295|P>>>16),P=N+(j^D^b)+A[10]+3200236656&4294967295,N=j+(P<<23&4294967295|P>>>9),P=b+(N^j^D)+A[13]+681279174&4294967295,b=N+(P<<4&4294967295|P>>>28),P=D+(b^N^j)+A[0]+3936430074&4294967295,D=b+(P<<11&4294967295|P>>>21),P=j+(D^b^N)+A[3]+3572445317&4294967295,j=D+(P<<16&4294967295|P>>>16),P=N+(j^D^b)+A[6]+76029189&4294967295,N=j+(P<<23&4294967295|P>>>9),P=b+(N^j^D)+A[9]+3654602809&4294967295,b=N+(P<<4&4294967295|P>>>28),P=D+(b^N^j)+A[12]+3873151461&4294967295,D=b+(P<<11&4294967295|P>>>21),P=j+(D^b^N)+A[15]+530742520&4294967295,j=D+(P<<16&4294967295|P>>>16),P=N+(j^D^b)+A[2]+3299628645&4294967295,N=j+(P<<23&4294967295|P>>>9),P=b+(j^(N|~D))+A[0]+4096336452&4294967295,b=N+(P<<6&4294967295|P>>>26),P=D+(N^(b|~j))+A[7]+1126891415&4294967295,D=b+(P<<10&4294967295|P>>>22),P=j+(b^(D|~N))+A[14]+2878612391&4294967295,j=D+(P<<15&4294967295|P>>>17),P=N+(D^(j|~b))+A[5]+4237533241&4294967295,N=j+(P<<21&4294967295|P>>>11),P=b+(j^(N|~D))+A[12]+1700485571&4294967295,b=N+(P<<6&4294967295|P>>>26),P=D+(N^(b|~j))+A[3]+2399980690&4294967295,D=b+(P<<10&4294967295|P>>>22),P=j+(b^(D|~N))+A[10]+4293915773&4294967295,j=D+(P<<15&4294967295|P>>>17),P=N+(D^(j|~b))+A[1]+2240044497&4294967295,N=j+(P<<21&4294967295|P>>>11),P=b+(j^(N|~D))+A[8]+1873313359&4294967295,b=N+(P<<6&4294967295|P>>>26),P=D+(N^(b|~j))+A[15]+4264355552&4294967295,D=b+(P<<10&4294967295|P>>>22),P=j+(b^(D|~N))+A[6]+2734768916&4294967295,j=D+(P<<15&4294967295|P>>>17),P=N+(D^(j|~b))+A[13]+1309151649&4294967295,N=j+(P<<21&4294967295|P>>>11),P=b+(j^(N|~D))+A[4]+4149444226&4294967295,b=N+(P<<6&4294967295|P>>>26),P=D+(N^(b|~j))+A[11]+3174756917&4294967295,D=b+(P<<10&4294967295|P>>>22),P=j+(b^(D|~N))+A[2]+718787259&4294967295,j=D+(P<<15&4294967295|P>>>17),P=N+(D^(j|~b))+A[9]+3951481745&4294967295,w.g[0]=w.g[0]+b&4294967295,w.g[1]=w.g[1]+(j+(P<<21&4294967295|P>>>11))&4294967295,w.g[2]=w.g[2]+j&4294967295,w.g[3]=w.g[3]+D&4294967295}r.prototype.u=function(w,b){b===void 0&&(b=w.length);for(var N=b-this.blockSize,A=this.B,j=this.h,D=0;D<b;){if(j==0)for(;D<=N;)s(this,w,D),D+=this.blockSize;if(typeof w=="string"){for(;D<b;)if(A[j++]=w.charCodeAt(D++),j==this.blockSize){s(this,A),j=0;break}}else for(;D<b;)if(A[j++]=w[D++],j==this.blockSize){s(this,A),j=0;break}}this.h=j,this.o+=b},r.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var b=1;b<w.length-8;++b)w[b]=0;var N=8*this.o;for(b=w.length-8;b<w.length;++b)w[b]=N&255,N/=256;for(this.u(w),w=Array(16),b=N=0;4>b;++b)for(var A=0;32>A;A+=8)w[N++]=this.g[b]>>>A&255;return w};function i(w,b){var N=l;return Object.prototype.hasOwnProperty.call(N,w)?N[w]:N[w]=b(w)}function a(w,b){this.h=b;for(var N=[],A=!0,j=w.length-1;0<=j;j--){var D=w[j]|0;A&&D==b||(N[j]=D,A=!1)}this.g=N}var l={};function c(w){return-128<=w&&128>w?i(w,function(b){return new a([b|0],0>b?-1:0)}):new a([w|0],0>w?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return m;if(0>w)return E(d(-w));for(var b=[],N=1,A=0;w>=N;A++)b[A]=w/N|0,N*=4294967296;return new a(b,0)}function h(w,b){if(w.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(w.charAt(0)=="-")return E(h(w.substring(1),b));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var N=d(Math.pow(b,8)),A=m,j=0;j<w.length;j+=8){var D=Math.min(8,w.length-j),P=parseInt(w.substring(j,j+D),b);8>D?(D=d(Math.pow(b,D)),A=A.j(D).add(d(P))):(A=A.j(N),A=A.add(d(P)))}return A}var m=c(0),p=c(1),y=c(16777216);n=a.prototype,n.m=function(){if(S(this))return-E(this).m();for(var w=0,b=1,N=0;N<this.g.length;N++){var A=this.i(N);w+=(0<=A?A:4294967296+A)*b,b*=4294967296}return w},n.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(v(this))return"0";if(S(this))return"-"+E(this).toString(w);for(var b=d(Math.pow(w,6)),N=this,A="";;){var j=k(N,b).g;N=_(N,j.j(b));var D=((0<N.g.length?N.g[0]:N.h)>>>0).toString(w);if(N=j,v(N))return D+A;for(;6>D.length;)D="0"+D;A=D+A}},n.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function v(w){if(w.h!=0)return!1;for(var b=0;b<w.g.length;b++)if(w.g[b]!=0)return!1;return!0}function S(w){return w.h==-1}n.l=function(w){return w=_(this,w),S(w)?-1:v(w)?0:1};function E(w){for(var b=w.g.length,N=[],A=0;A<b;A++)N[A]=~w.g[A];return new a(N,~w.h).add(p)}n.abs=function(){return S(this)?E(this):this},n.add=function(w){for(var b=Math.max(this.g.length,w.g.length),N=[],A=0,j=0;j<=b;j++){var D=A+(this.i(j)&65535)+(w.i(j)&65535),P=(D>>>16)+(this.i(j)>>>16)+(w.i(j)>>>16);A=P>>>16,D&=65535,P&=65535,N[j]=P<<16|D}return new a(N,N[N.length-1]&-2147483648?-1:0)};function _(w,b){return w.add(E(b))}n.j=function(w){if(v(this)||v(w))return m;if(S(this))return S(w)?E(this).j(E(w)):E(E(this).j(w));if(S(w))return E(this.j(E(w)));if(0>this.l(y)&&0>w.l(y))return d(this.m()*w.m());for(var b=this.g.length+w.g.length,N=[],A=0;A<2*b;A++)N[A]=0;for(A=0;A<this.g.length;A++)for(var j=0;j<w.g.length;j++){var D=this.i(A)>>>16,P=this.i(A)&65535,Ve=w.i(j)>>>16,je=w.i(j)&65535;N[2*A+2*j]+=P*je,x(N,2*A+2*j),N[2*A+2*j+1]+=D*je,x(N,2*A+2*j+1),N[2*A+2*j+1]+=P*Ve,x(N,2*A+2*j+1),N[2*A+2*j+2]+=D*Ve,x(N,2*A+2*j+2)}for(A=0;A<b;A++)N[A]=N[2*A+1]<<16|N[2*A];for(A=b;A<2*b;A++)N[A]=0;return new a(N,0)};function x(w,b){for(;(w[b]&65535)!=w[b];)w[b+1]+=w[b]>>>16,w[b]&=65535,b++}function C(w,b){this.g=w,this.h=b}function k(w,b){if(v(b))throw Error("division by zero");if(v(w))return new C(m,m);if(S(w))return b=k(E(w),b),new C(E(b.g),E(b.h));if(S(b))return b=k(w,E(b)),new C(E(b.g),b.h);if(30<w.g.length){if(S(w)||S(b))throw Error("slowDivide_ only works with positive integers.");for(var N=p,A=b;0>=A.l(w);)N=M(N),A=M(A);var j=F(N,1),D=F(A,1);for(A=F(A,2),N=F(N,2);!v(A);){var P=D.add(A);0>=P.l(w)&&(j=j.add(N),D=P),A=F(A,1),N=F(N,1)}return b=_(w,j.j(b)),new C(j,b)}for(j=m;0<=w.l(b);){for(N=Math.max(1,Math.floor(w.m()/b.m())),A=Math.ceil(Math.log(N)/Math.LN2),A=48>=A?1:Math.pow(2,A-48),D=d(N),P=D.j(b);S(P)||0<P.l(w);)N-=A,D=d(N),P=D.j(b);v(D)&&(D=p),j=j.add(D),w=_(w,P)}return new C(j,w)}n.A=function(w){return k(this,w).h},n.and=function(w){for(var b=Math.max(this.g.length,w.g.length),N=[],A=0;A<b;A++)N[A]=this.i(A)&w.i(A);return new a(N,this.h&w.h)},n.or=function(w){for(var b=Math.max(this.g.length,w.g.length),N=[],A=0;A<b;A++)N[A]=this.i(A)|w.i(A);return new a(N,this.h|w.h)},n.xor=function(w){for(var b=Math.max(this.g.length,w.g.length),N=[],A=0;A<b;A++)N[A]=this.i(A)^w.i(A);return new a(N,this.h^w.h)};function M(w){for(var b=w.g.length+1,N=[],A=0;A<b;A++)N[A]=w.i(A)<<1|w.i(A-1)>>>31;return new a(N,w.h)}function F(w,b){var N=b>>5;b%=32;for(var A=w.g.length-N,j=[],D=0;D<A;D++)j[D]=0<b?w.i(D+N)>>>b|w.i(D+N+1)<<32-b:w.i(D+N);return new a(j,w.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,jE=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=h,Wi=a}).apply(typeof Xv<"u"?Xv:typeof self<"u"?self:typeof window<"u"?window:{});var Su=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var RE,_l,DE,Yu,Gf,ME,VE,LE;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,f,g){return u==Array.prototype||u==Object.prototype||(u[f]=g.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Su=="object"&&Su];for(var f=0;f<u.length;++f){var g=u[f];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=t(this);function s(u,f){if(f)e:{var g=r;u=u.split(".");for(var T=0;T<u.length-1;T++){var L=u[T];if(!(L in g))break e;g=g[L]}u=u[u.length-1],T=g[u],f=f(T),f!=T&&f!=null&&e(g,u,{configurable:!0,writable:!0,value:f})}}function i(u,f){u instanceof String&&(u+="");var g=0,T=!1,L={next:function(){if(!T&&g<u.length){var W=g++;return{value:f(W,u[W]),done:!1}}return T=!0,{done:!0,value:void 0}}};return L[Symbol.iterator]=function(){return L},L}s("Array.prototype.values",function(u){return u||function(){return i(this,function(f,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},l=this||self;function c(u){var f=typeof u;return f=f!="object"?f:u?Array.isArray(u)?"array":f:"null",f=="array"||f=="object"&&typeof u.length=="number"}function d(u){var f=typeof u;return f=="object"&&u!=null||f=="function"}function h(u,f,g){return u.call.apply(u.bind,arguments)}function m(u,f,g){if(!u)throw Error();if(2<arguments.length){var T=Array.prototype.slice.call(arguments,2);return function(){var L=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(L,T),u.apply(f,L)}}return function(){return u.apply(f,arguments)}}function p(u,f,g){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:m,p.apply(null,arguments)}function y(u,f){var g=Array.prototype.slice.call(arguments,1);return function(){var T=g.slice();return T.push.apply(T,arguments),u.apply(this,T)}}function v(u,f){function g(){}g.prototype=f.prototype,u.aa=f.prototype,u.prototype=new g,u.prototype.constructor=u,u.Qb=function(T,L,W){for(var le=Array(arguments.length-2),yt=2;yt<arguments.length;yt++)le[yt-2]=arguments[yt];return f.prototype[L].apply(T,le)}}function S(u){const f=u.length;if(0<f){const g=Array(f);for(let T=0;T<f;T++)g[T]=u[T];return g}return[]}function E(u,f){for(let g=1;g<arguments.length;g++){const T=arguments[g];if(c(T)){const L=u.length||0,W=T.length||0;u.length=L+W;for(let le=0;le<W;le++)u[L+le]=T[le]}else u.push(T)}}class _{constructor(f,g){this.i=f,this.j=g,this.h=0,this.g=null}get(){let f;return 0<this.h?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function x(u){return/^[\s\xa0]*$/.test(u)}function C(){var u=l.navigator;return u&&(u=u.userAgent)?u:""}function k(u){return k[" "](u),u}k[" "]=function(){};var M=C().indexOf("Gecko")!=-1&&!(C().toLowerCase().indexOf("webkit")!=-1&&C().indexOf("Edge")==-1)&&!(C().indexOf("Trident")!=-1||C().indexOf("MSIE")!=-1)&&C().indexOf("Edge")==-1;function F(u,f,g){for(const T in u)f.call(g,u[T],T,u)}function w(u,f){for(const g in u)f.call(void 0,u[g],g,u)}function b(u){const f={};for(const g in u)f[g]=u[g];return f}const N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function A(u,f){let g,T;for(let L=1;L<arguments.length;L++){T=arguments[L];for(g in T)u[g]=T[g];for(let W=0;W<N.length;W++)g=N[W],Object.prototype.hasOwnProperty.call(T,g)&&(u[g]=T[g])}}function j(u){var f=1;u=u.split(":");const g=[];for(;0<f&&u.length;)g.push(u.shift()),f--;return u.length&&g.push(u.join(":")),g}function D(u){l.setTimeout(()=>{throw u},0)}function P(){var u=K;let f=null;return u.g&&(f=u.g,u.g=u.g.next,u.g||(u.h=null),f.next=null),f}class Ve{constructor(){this.h=this.g=null}add(f,g){const T=je.get();T.set(f,g),this.h?this.h.next=T:this.g=T,this.h=T}}var je=new _(()=>new Fe,u=>u.reset());class Fe{constructor(){this.next=this.g=this.h=null}set(f,g){this.h=f,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let et,V=!1,K=new Ve,Y=()=>{const u=l.Promise.resolve(void 0);et=()=>{u.then(fe)}};var fe=()=>{for(var u;u=P();){try{u.h.call(u.g)}catch(g){D(g)}var f=je;f.j(u),100>f.h&&(f.h++,u.next=f.g,f.g=u)}V=!1};function ae(){this.s=this.s,this.C=this.C}ae.prototype.s=!1,ae.prototype.ma=function(){this.s||(this.s=!0,this.N())},ae.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function te(u,f){this.type=u,this.g=this.target=f,this.defaultPrevented=!1}te.prototype.h=function(){this.defaultPrevented=!0};var U=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var u=!1,f=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const g=()=>{};l.addEventListener("test",g,f),l.removeEventListener("test",g,f)}catch{}return u}();function me(u,f){if(te.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var g=this.type=u.type,T=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=f,f=u.relatedTarget){if(M){e:{try{k(f.nodeName);var L=!0;break e}catch{}L=!1}L||(f=null)}}else g=="mouseover"?f=u.fromElement:g=="mouseout"&&(f=u.toElement);this.relatedTarget=f,T?(this.clientX=T.clientX!==void 0?T.clientX:T.pageX,this.clientY=T.clientY!==void 0?T.clientY:T.pageY,this.screenX=T.screenX||0,this.screenY=T.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:Ae[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&me.aa.h.call(this)}}v(me,te);var Ae={2:"touch",3:"pen",4:"mouse"};me.prototype.h=function(){me.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var Qe="closure_listenable_"+(1e6*Math.random()|0),Fn=0;function $n(u,f,g,T,L){this.listener=u,this.proxy=null,this.src=f,this.type=g,this.capture=!!T,this.ha=L,this.key=++Fn,this.da=this.fa=!1}function jt(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function tt(u){this.src=u,this.g={},this.h=0}tt.prototype.add=function(u,f,g,T,L){var W=u.toString();u=this.g[W],u||(u=this.g[W]=[],this.h++);var le=We(u,f,T,L);return-1<le?(f=u[le],g||(f.fa=!1)):(f=new $n(f,this.src,W,!!T,L),f.fa=g,u.push(f)),f};function rn(u,f){var g=f.type;if(g in u.g){var T=u.g[g],L=Array.prototype.indexOf.call(T,f,void 0),W;(W=0<=L)&&Array.prototype.splice.call(T,L,1),W&&(jt(f),u.g[g].length==0&&(delete u.g[g],u.h--))}}function We(u,f,g,T){for(var L=0;L<u.length;++L){var W=u[L];if(!W.da&&W.listener==f&&W.capture==!!g&&W.ha==T)return L}return-1}var qt="closure_lm_"+(1e6*Math.random()|0),Tn={};function _t(u,f,g,T,L){if(T&&T.once)return Jt(u,f,g,T,L);if(Array.isArray(f)){for(var W=0;W<f.length;W++)_t(u,f[W],g,T,L);return null}return g=ie(g),u&&u[Qe]?u.K(f,g,d(T)?!!T.capture:!!T,L):Un(u,f,g,!1,T,L)}function Un(u,f,g,T,L,W){if(!f)throw Error("Invalid event type");var le=d(L)?!!L.capture:!!L,yt=ne(u);if(yt||(u[qt]=yt=new tt(u)),g=yt.add(f,g,T,le,W),g.proxy)return g;if(T=gn(),g.proxy=T,T.src=u,T.listener=g,u.addEventListener)U||(L=le),L===void 0&&(L=!1),u.addEventListener(f.toString(),T,L);else if(u.attachEvent)u.attachEvent(Nn(f.toString()),T);else if(u.addListener&&u.removeListener)u.addListener(T);else throw Error("addEventListener and attachEvent are unavailable.");return g}function gn(){function u(g){return f.call(u.src,u.listener,g)}const f=rt;return u}function Jt(u,f,g,T,L){if(Array.isArray(f)){for(var W=0;W<f.length;W++)Jt(u,f[W],g,T,L);return null}return g=ie(g),u&&u[Qe]?u.L(f,g,d(T)?!!T.capture:!!T,L):Un(u,f,g,!0,T,L)}function Sn(u,f,g,T,L){if(Array.isArray(f))for(var W=0;W<f.length;W++)Sn(u,f[W],g,T,L);else T=d(T)?!!T.capture:!!T,g=ie(g),u&&u[Qe]?(u=u.i,f=String(f).toString(),f in u.g&&(W=u.g[f],g=We(W,g,T,L),-1<g&&(jt(W[g]),Array.prototype.splice.call(W,g,1),W.length==0&&(delete u.g[f],u.h--)))):u&&(u=ne(u))&&(f=u.g[f.toString()],u=-1,f&&(u=We(f,g,T,L)),(g=-1<u?f[u]:null)&&In(g))}function In(u){if(typeof u!="number"&&u&&!u.da){var f=u.src;if(f&&f[Qe])rn(f.i,u);else{var g=u.type,T=u.proxy;f.removeEventListener?f.removeEventListener(g,T,u.capture):f.detachEvent?f.detachEvent(Nn(g),T):f.addListener&&f.removeListener&&f.removeListener(T),(g=ne(f))?(rn(g,u),g.h==0&&(g.src=null,f[qt]=null)):jt(u)}}}function Nn(u){return u in Tn?Tn[u]:Tn[u]="on"+u}function rt(u,f){if(u.da)u=!0;else{f=new me(f,this);var g=u.listener,T=u.ha||u.src;u.fa&&In(u),u=g.call(T,f)}return u}function ne(u){return u=u[qt],u instanceof tt?u:null}var re="__closure_events_fn_"+(1e9*Math.random()>>>0);function ie(u){return typeof u=="function"?u:(u[re]||(u[re]=function(f){return u.handleEvent(f)}),u[re])}function we(){ae.call(this),this.i=new tt(this),this.M=this,this.F=null}v(we,ae),we.prototype[Qe]=!0,we.prototype.removeEventListener=function(u,f,g,T){Sn(this,u,f,g,T)};function He(u,f){var g,T=u.F;if(T)for(g=[];T;T=T.F)g.push(T);if(u=u.M,T=f.type||f,typeof f=="string")f=new te(f,u);else if(f instanceof te)f.target=f.target||u;else{var L=f;f=new te(T,u),A(f,L)}if(L=!0,g)for(var W=g.length-1;0<=W;W--){var le=f.g=g[W];L=it(le,T,!0,f)&&L}if(le=f.g=u,L=it(le,T,!0,f)&&L,L=it(le,T,!1,f)&&L,g)for(W=0;W<g.length;W++)le=f.g=g[W],L=it(le,T,!1,f)&&L}we.prototype.N=function(){if(we.aa.N.call(this),this.i){var u=this.i,f;for(f in u.g){for(var g=u.g[f],T=0;T<g.length;T++)jt(g[T]);delete u.g[f],u.h--}}this.F=null},we.prototype.K=function(u,f,g,T){return this.i.add(String(u),f,!1,g,T)},we.prototype.L=function(u,f,g,T){return this.i.add(String(u),f,!0,g,T)};function it(u,f,g,T){if(f=u.i.g[String(f)],!f)return!0;f=f.concat();for(var L=!0,W=0;W<f.length;++W){var le=f[W];if(le&&!le.da&&le.capture==g){var yt=le.listener,yn=le.ha||le.src;le.fa&&rn(u.i,le),L=yt.call(yn,T)!==!1&&L}}return L&&!T.defaultPrevented}function Ye(u,f,g){if(typeof u=="function")g&&(u=p(u,g));else if(u&&typeof u.handleEvent=="function")u=p(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(f)?-1:l.setTimeout(u,f||0)}function pt(u){u.g=Ye(()=>{u.g=null,u.i&&(u.i=!1,pt(u))},u.l);const f=u.h;u.h=null,u.m.apply(null,f)}class $ extends ae{constructor(f,g){super(),this.m=f,this.l=g,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:pt(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Q(u){ae.call(this),this.h=u,this.g={}}v(Q,ae);var ye=[];function Ce(u){F(u.g,function(f,g){this.g.hasOwnProperty(g)&&In(f)},u),u.g={}}Q.prototype.N=function(){Q.aa.N.call(this),Ce(this)},Q.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var at=l.JSON.stringify,Xt=l.JSON.parse,Zt=class{stringify(u){return l.JSON.stringify(u,void 0)}parse(u){return l.JSON.parse(u,void 0)}};function H(){}H.prototype.h=null;function ee(u){return u.h||(u.h=u.i())}function Ee(){}var B={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function G(){te.call(this,"d")}v(G,te);function de(){te.call(this,"c")}v(de,te);var ce={},xe=null;function Re(){return xe=xe||new we}ce.La="serverreachability";function en(u){te.call(this,ce.La,u)}v(en,te);function De(u){const f=Re();He(f,new en(f))}ce.STAT_EVENT="statevent";function xt(u,f){te.call(this,ce.STAT_EVENT,u),this.stat=f}v(xt,te);function lt(u){const f=Re();He(f,new xt(f,u))}ce.Ma="timingevent";function Ge(u,f){te.call(this,ce.Ma,u),this.size=f}v(Ge,te);function gt(u,f){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){u()},f)}function Rt(){this.g=!0}Rt.prototype.xa=function(){this.g=!1};function ot(u,f,g,T,L,W){u.info(function(){if(u.g)if(W)for(var le="",yt=W.split("&"),yn=0;yn<yt.length;yn++){var nt=yt[yn].split("=");if(1<nt.length){var Cn=nt[0];nt=nt[1];var An=Cn.split("_");le=2<=An.length&&An[1]=="type"?le+(Cn+"="+nt+"&"):le+(Cn+"=redacted&")}}else le=null;else le=W;return"XMLHTTP REQ ("+T+") [attempt "+L+"]: "+f+`
`+g+`
`+le})}function R(u,f,g,T,L,W,le){u.info(function(){return"XMLHTTP RESP ("+T+") [ attempt "+L+"]: "+f+`
`+g+`
`+W+" "+le})}function z(u,f,g,T){u.info(function(){return"XMLHTTP TEXT ("+f+"): "+Ie(u,g)+(T?" "+T:"")})}function pe(u,f){u.info(function(){return"TIMEOUT: "+f})}Rt.prototype.info=function(){};function Ie(u,f){if(!u.g)return f;if(!f)return null;try{var g=JSON.parse(f);if(g){for(u=0;u<g.length;u++)if(Array.isArray(g[u])){var T=g[u];if(!(2>T.length)){var L=T[1];if(Array.isArray(L)&&!(1>L.length)){var W=L[0];if(W!="noop"&&W!="stop"&&W!="close")for(var le=1;le<L.length;le++)L[le]=""}}}}return at(g)}catch{return f}}var J={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Se={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},_e;function dt(){}v(dt,H),dt.prototype.g=function(){return new XMLHttpRequest},dt.prototype.i=function(){return{}},_e=new dt;function Oe(u,f,g,T){this.j=u,this.i=f,this.l=g,this.R=T||1,this.U=new Q(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Wt}function Wt(){this.i=null,this.g="",this.h=!1}var un={},Ts={};function ba(u,f,g){u.L=1,u.v=Xc(qr(f)),u.m=g,u.P=!0,Gc(u,null)}function Gc(u,f){u.F=Date.now(),wa(u),u.A=qr(u.v);var g=u.A,T=u.R;Array.isArray(T)||(T=[String(T)]),O0(g.i,"t",T),u.C=0,g=u.j.J,u.h=new Wt,u.g=ny(u.j,g?f:null,!u.m),0<u.O&&(u.M=new $(p(u.Y,u,u.g),u.O)),f=u.U,g=u.g,T=u.ca;var L="readystatechange";Array.isArray(L)||(L&&(ye[0]=L.toString()),L=ye);for(var W=0;W<L.length;W++){var le=_t(g,L[W],T||f.handleEvent,!1,f.h||f);if(!le)break;f.g[le.key]=le}f=u.H?b(u.H):{},u.m?(u.u||(u.u="POST"),f["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,f)):(u.u="GET",u.g.ea(u.A,u.u,null,f)),De(),ot(u.i,u.u,u.A,u.l,u.R,u.m)}Oe.prototype.ca=function(u){u=u.target;const f=this.M;f&&Wr(u)==3?f.j():this.Y(u)},Oe.prototype.Y=function(u){try{if(u==this.g)e:{const An=Wr(this.g);var f=this.g.Ba();const Ta=this.g.Z();if(!(3>An)&&(An!=3||this.g&&(this.h.h||this.g.oa()||W0(this.g)))){this.J||An!=4||f==7||(f==8||0>=Ta?De(3):De(2)),Hh(this);var g=this.g.Z();this.X=g;t:if(Kc(this)){var T=W0(this.g);u="";var L=T.length,W=Wr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Si(this),Qo(this);var le="";break t}this.h.i=new l.TextDecoder}for(f=0;f<L;f++)this.h.h=!0,u+=this.h.i.decode(T[f],{stream:!(W&&f==L-1)});T.length=0,this.h.g+=u,this.C=0,le=this.h.g}else le=this.g.oa();if(this.o=g==200,R(this.i,this.u,this.A,this.l,this.R,An,g),this.o){if(this.T&&!this.K){t:{if(this.g){var yt,yn=this.g;if((yt=yn.g?yn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(yt)){var nt=yt;break t}}nt=null}if(g=nt)z(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Gh(this,g);else{this.o=!1,this.s=3,lt(12),Si(this),Qo(this);break e}}if(this.P){g=!0;let br;for(;!this.J&&this.C<le.length;)if(br=I0(this,le),br==Ts){An==4&&(this.s=4,lt(14),g=!1),z(this.i,this.l,null,"[Incomplete Response]");break}else if(br==un){this.s=4,lt(15),z(this.i,this.l,le,"[Invalid Chunk]"),g=!1;break}else z(this.i,this.l,br,null),Gh(this,br);if(Kc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),An!=4||le.length!=0||this.h.h||(this.s=1,lt(16),g=!1),this.o=this.o&&g,!g)z(this.i,this.l,le,"[Invalid Chunked Response]"),Si(this),Qo(this);else if(0<le.length&&!this.W){this.W=!0;var Cn=this.j;Cn.g==this&&Cn.ba&&!Cn.M&&(Cn.j.info("Great, no buffering proxy detected. Bytes received: "+le.length),Zh(Cn),Cn.M=!0,lt(11))}}else z(this.i,this.l,le,null),Gh(this,le);An==4&&Si(this),this.o&&!this.J&&(An==4?X0(this.j,this):(this.o=!1,wa(this)))}else $I(this.g),g==400&&0<le.indexOf("Unknown SID")?(this.s=3,lt(12)):(this.s=0,lt(13)),Si(this),Qo(this)}}}catch{}finally{}};function Kc(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function I0(u,f){var g=u.C,T=f.indexOf(`
`,g);return T==-1?Ts:(g=Number(f.substring(g,T)),isNaN(g)?un:(T+=1,T+g>f.length?Ts:(f=f.slice(T,T+g),u.C=T+g,f)))}Oe.prototype.cancel=function(){this.J=!0,Si(this)};function wa(u){u.S=Date.now()+u.I,Qc(u,u.I)}function Qc(u,f){if(u.B!=null)throw Error("WatchDog timer not null");u.B=gt(p(u.ba,u),f)}function Hh(u){u.B&&(l.clearTimeout(u.B),u.B=null)}Oe.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(pe(this.i,this.A),this.L!=2&&(De(),lt(17)),Si(this),this.s=2,Qo(this)):Qc(this,this.S-u)};function Qo(u){u.j.G==0||u.J||X0(u.j,u)}function Si(u){Hh(u);var f=u.M;f&&typeof f.ma=="function"&&f.ma(),u.M=null,Ce(u.U),u.g&&(f=u.g,u.g=null,f.abort(),f.ma())}function Gh(u,f){try{var g=u.j;if(g.G!=0&&(g.g==u||Kh(g.h,u))){if(!u.K&&Kh(g.h,u)&&g.G==3){try{var T=g.Da.g.parse(f)}catch{T=null}if(Array.isArray(T)&&T.length==3){var L=T;if(L[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<u.F)su(g),nu(g);else break e;Xh(g),lt(18)}}else g.za=L[1],0<g.za-g.T&&37500>L[2]&&g.F&&g.v==0&&!g.C&&(g.C=gt(p(g.Za,g),6e3));if(1>=A0(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else Ni(g,11)}else if((u.K||g.g==u)&&su(g),!x(f))for(L=g.Da.g.parse(f),f=0;f<L.length;f++){let nt=L[f];if(g.T=nt[0],nt=nt[1],g.G==2)if(nt[0]=="c"){g.K=nt[1],g.ia=nt[2];const Cn=nt[3];Cn!=null&&(g.la=Cn,g.j.info("VER="+g.la));const An=nt[4];An!=null&&(g.Aa=An,g.j.info("SVER="+g.Aa));const Ta=nt[5];Ta!=null&&typeof Ta=="number"&&0<Ta&&(T=1.5*Ta,g.L=T,g.j.info("backChannelRequestTimeoutMs_="+T)),T=g;const br=u.g;if(br){const au=br.g?br.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(au){var W=T.h;W.g||au.indexOf("spdy")==-1&&au.indexOf("quic")==-1&&au.indexOf("h2")==-1||(W.j=W.l,W.g=new Set,W.h&&(Qh(W,W.h),W.h=null))}if(T.D){const em=br.g?br.g.getResponseHeader("X-HTTP-Session-Id"):null;em&&(T.ya=em,Et(T.I,T.D,em))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-u.F,g.j.info("Handshake RTT: "+g.R+"ms")),T=g;var le=u;if(T.qa=ty(T,T.J?T.ia:null,T.W),le.K){k0(T.h,le);var yt=le,yn=T.L;yn&&(yt.I=yn),yt.B&&(Hh(yt),wa(yt)),T.g=le}else Y0(T);0<g.i.length&&ru(g)}else nt[0]!="stop"&&nt[0]!="close"||Ni(g,7);else g.G==3&&(nt[0]=="stop"||nt[0]=="close"?nt[0]=="stop"?Ni(g,7):Jh(g):nt[0]!="noop"&&g.l&&g.l.ta(nt),g.v=0)}}De(4)}catch{}}var TI=class{constructor(u,f){this.g=u,this.map=f}};function N0(u){this.l=u||10,l.PerformanceNavigationTiming?(u=l.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function C0(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function A0(u){return u.h?1:u.g?u.g.size:0}function Kh(u,f){return u.h?u.h==f:u.g?u.g.has(f):!1}function Qh(u,f){u.g?u.g.add(f):u.h=f}function k0(u,f){u.h&&u.h==f?u.h=null:u.g&&u.g.has(f)&&u.g.delete(f)}N0.prototype.cancel=function(){if(this.i=P0(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function P0(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let f=u.i;for(const g of u.g.values())f=f.concat(g.D);return f}return S(u.i)}function SI(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(c(u)){for(var f=[],g=u.length,T=0;T<g;T++)f.push(u[T]);return f}f=[],g=0;for(T in u)f[g++]=u[T];return f}function II(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(c(u)||typeof u=="string"){var f=[];u=u.length;for(var g=0;g<u;g++)f.push(g);return f}f=[],g=0;for(const T in u)f[g++]=T;return f}}}function j0(u,f){if(u.forEach&&typeof u.forEach=="function")u.forEach(f,void 0);else if(c(u)||typeof u=="string")Array.prototype.forEach.call(u,f,void 0);else for(var g=II(u),T=SI(u),L=T.length,W=0;W<L;W++)f.call(void 0,T[W],g&&g[W],u)}var R0=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function NI(u,f){if(u){u=u.split("&");for(var g=0;g<u.length;g++){var T=u[g].indexOf("="),L=null;if(0<=T){var W=u[g].substring(0,T);L=u[g].substring(T+1)}else W=u[g];f(W,L?decodeURIComponent(L.replace(/\+/g," ")):"")}}}function Ii(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Ii){this.h=u.h,Yc(this,u.j),this.o=u.o,this.g=u.g,Jc(this,u.s),this.l=u.l;var f=u.i,g=new Xo;g.i=f.i,f.g&&(g.g=new Map(f.g),g.h=f.h),D0(this,g),this.m=u.m}else u&&(f=String(u).match(R0))?(this.h=!1,Yc(this,f[1]||"",!0),this.o=Yo(f[2]||""),this.g=Yo(f[3]||"",!0),Jc(this,f[4]),this.l=Yo(f[5]||"",!0),D0(this,f[6]||"",!0),this.m=Yo(f[7]||"")):(this.h=!1,this.i=new Xo(null,this.h))}Ii.prototype.toString=function(){var u=[],f=this.j;f&&u.push(Jo(f,M0,!0),":");var g=this.g;return(g||f=="file")&&(u.push("//"),(f=this.o)&&u.push(Jo(f,M0,!0),"@"),u.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&u.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&u.push("/"),u.push(Jo(g,g.charAt(0)=="/"?kI:AI,!0))),(g=this.i.toString())&&u.push("?",g),(g=this.m)&&u.push("#",Jo(g,jI)),u.join("")};function qr(u){return new Ii(u)}function Yc(u,f,g){u.j=g?Yo(f,!0):f,u.j&&(u.j=u.j.replace(/:$/,""))}function Jc(u,f){if(f){if(f=Number(f),isNaN(f)||0>f)throw Error("Bad port number "+f);u.s=f}else u.s=null}function D0(u,f,g){f instanceof Xo?(u.i=f,RI(u.i,u.h)):(g||(f=Jo(f,PI)),u.i=new Xo(f,u.h))}function Et(u,f,g){u.i.set(f,g)}function Xc(u){return Et(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Yo(u,f){return u?f?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Jo(u,f,g){return typeof u=="string"?(u=encodeURI(u).replace(f,CI),g&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function CI(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var M0=/[#\/\?@]/g,AI=/[#\?:]/g,kI=/[#\?]/g,PI=/[#\?@]/g,jI=/#/g;function Xo(u,f){this.h=this.g=null,this.i=u||null,this.j=!!f}function Ss(u){u.g||(u.g=new Map,u.h=0,u.i&&NI(u.i,function(f,g){u.add(decodeURIComponent(f.replace(/\+/g," ")),g)}))}n=Xo.prototype,n.add=function(u,f){Ss(this),this.i=null,u=_a(this,u);var g=this.g.get(u);return g||this.g.set(u,g=[]),g.push(f),this.h+=1,this};function V0(u,f){Ss(u),f=_a(u,f),u.g.has(f)&&(u.i=null,u.h-=u.g.get(f).length,u.g.delete(f))}function L0(u,f){return Ss(u),f=_a(u,f),u.g.has(f)}n.forEach=function(u,f){Ss(this),this.g.forEach(function(g,T){g.forEach(function(L){u.call(f,L,T,this)},this)},this)},n.na=function(){Ss(this);const u=Array.from(this.g.values()),f=Array.from(this.g.keys()),g=[];for(let T=0;T<f.length;T++){const L=u[T];for(let W=0;W<L.length;W++)g.push(f[T])}return g},n.V=function(u){Ss(this);let f=[];if(typeof u=="string")L0(this,u)&&(f=f.concat(this.g.get(_a(this,u))));else{u=Array.from(this.g.values());for(let g=0;g<u.length;g++)f=f.concat(u[g])}return f},n.set=function(u,f){return Ss(this),this.i=null,u=_a(this,u),L0(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[f]),this.h+=1,this},n.get=function(u,f){return u?(u=this.V(u),0<u.length?String(u[0]):f):f};function O0(u,f,g){V0(u,f),0<g.length&&(u.i=null,u.g.set(_a(u,f),S(g)),u.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],f=Array.from(this.g.keys());for(var g=0;g<f.length;g++){var T=f[g];const W=encodeURIComponent(String(T)),le=this.V(T);for(T=0;T<le.length;T++){var L=W;le[T]!==""&&(L+="="+encodeURIComponent(String(le[T]))),u.push(L)}}return this.i=u.join("&")};function _a(u,f){return f=String(f),u.j&&(f=f.toLowerCase()),f}function RI(u,f){f&&!u.j&&(Ss(u),u.i=null,u.g.forEach(function(g,T){var L=T.toLowerCase();T!=L&&(V0(this,T),O0(this,L,g))},u)),u.j=f}function DI(u,f){const g=new Rt;if(l.Image){const T=new Image;T.onload=y(Is,g,"TestLoadImage: loaded",!0,f,T),T.onerror=y(Is,g,"TestLoadImage: error",!1,f,T),T.onabort=y(Is,g,"TestLoadImage: abort",!1,f,T),T.ontimeout=y(Is,g,"TestLoadImage: timeout",!1,f,T),l.setTimeout(function(){T.ontimeout&&T.ontimeout()},1e4),T.src=u}else f(!1)}function MI(u,f){const g=new Rt,T=new AbortController,L=setTimeout(()=>{T.abort(),Is(g,"TestPingServer: timeout",!1,f)},1e4);fetch(u,{signal:T.signal}).then(W=>{clearTimeout(L),W.ok?Is(g,"TestPingServer: ok",!0,f):Is(g,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(L),Is(g,"TestPingServer: error",!1,f)})}function Is(u,f,g,T,L){try{L&&(L.onload=null,L.onerror=null,L.onabort=null,L.ontimeout=null),T(g)}catch{}}function VI(){this.g=new Zt}function LI(u,f,g){const T=g||"";try{j0(u,function(L,W){let le=L;d(L)&&(le=at(L)),f.push(T+W+"="+encodeURIComponent(le))})}catch(L){throw f.push(T+"type="+encodeURIComponent("_badmap")),L}}function Zc(u){this.l=u.Ub||null,this.j=u.eb||!1}v(Zc,H),Zc.prototype.g=function(){return new eu(this.l,this.j)},Zc.prototype.i=function(u){return function(){return u}}({});function eu(u,f){we.call(this),this.D=u,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}v(eu,we),n=eu.prototype,n.open=function(u,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=f,this.readyState=1,el(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const f={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(f.body=u),(this.D||l).fetch(new Request(this.A,f)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Zo(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,el(this)),this.g&&(this.readyState=3,el(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;F0(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function F0(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var f=u.value?u.value:new Uint8Array(0);(f=this.v.decode(f,{stream:!u.done}))&&(this.response=this.responseText+=f)}u.done?Zo(this):el(this),this.readyState==3&&F0(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,Zo(this))},n.Qa=function(u){this.g&&(this.response=u,Zo(this))},n.ga=function(){this.g&&Zo(this)};function Zo(u){u.readyState=4,u.l=null,u.j=null,u.v=null,el(u)}n.setRequestHeader=function(u,f){this.u.append(u,f)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],f=this.h.entries();for(var g=f.next();!g.done;)g=g.value,u.push(g[0]+": "+g[1]),g=f.next();return u.join(`\r
`)};function el(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(eu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function $0(u){let f="";return F(u,function(g,T){f+=T,f+=":",f+=g,f+=`\r
`}),f}function Yh(u,f,g){e:{for(T in g){var T=!1;break e}T=!0}T||(g=$0(g),typeof u=="string"?g!=null&&encodeURIComponent(String(g)):Et(u,f,g))}function $t(u){we.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}v($t,we);var OI=/^https?$/i,FI=["POST","PUT"];n=$t.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,f,g,T){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);f=f?f.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():_e.g(),this.v=this.o?ee(this.o):ee(_e),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(f,String(u),!0),this.B=!1}catch(W){U0(this,W);return}if(u=g||"",g=new Map(this.headers),T)if(Object.getPrototypeOf(T)===Object.prototype)for(var L in T)g.set(L,T[L]);else if(typeof T.keys=="function"&&typeof T.get=="function")for(const W of T.keys())g.set(W,T.get(W));else throw Error("Unknown input type for opt_headers: "+String(T));T=Array.from(g.keys()).find(W=>W.toLowerCase()=="content-type"),L=l.FormData&&u instanceof l.FormData,!(0<=Array.prototype.indexOf.call(FI,f,void 0))||T||L||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[W,le]of g)this.g.setRequestHeader(W,le);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{q0(this),this.u=!0,this.g.send(u),this.u=!1}catch(W){U0(this,W)}};function U0(u,f){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=f,u.m=5,B0(u),tu(u)}function B0(u){u.A||(u.A=!0,He(u,"complete"),He(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,He(this,"complete"),He(this,"abort"),tu(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tu(this,!0)),$t.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?z0(this):this.bb())},n.bb=function(){z0(this)};function z0(u){if(u.h&&typeof a<"u"&&(!u.v[1]||Wr(u)!=4||u.Z()!=2)){if(u.u&&Wr(u)==4)Ye(u.Ea,0,u);else if(He(u,"readystatechange"),Wr(u)==4){u.h=!1;try{const le=u.Z();e:switch(le){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break e;default:f=!1}var g;if(!(g=f)){var T;if(T=le===0){var L=String(u.D).match(R0)[1]||null;!L&&l.self&&l.self.location&&(L=l.self.location.protocol.slice(0,-1)),T=!OI.test(L?L.toLowerCase():"")}g=T}if(g)He(u,"complete"),He(u,"success");else{u.m=6;try{var W=2<Wr(u)?u.g.statusText:""}catch{W=""}u.l=W+" ["+u.Z()+"]",B0(u)}}finally{tu(u)}}}}function tu(u,f){if(u.g){q0(u);const g=u.g,T=u.v[0]?()=>{}:null;u.g=null,u.v=null,f||He(u,"ready");try{g.onreadystatechange=T}catch{}}}function q0(u){u.I&&(l.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function Wr(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<Wr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var f=this.g.responseText;return u&&f.indexOf(u)==0&&(f=f.substring(u.length)),Xt(f)}};function W0(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function $I(u){const f={};u=(u.g&&2<=Wr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let T=0;T<u.length;T++){if(x(u[T]))continue;var g=j(u[T]);const L=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const W=f[L]||[];f[L]=W,W.push(g)}w(f,function(T){return T.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function tl(u,f,g){return g&&g.internalChannelParams&&g.internalChannelParams[u]||f}function H0(u){this.Aa=0,this.i=[],this.j=new Rt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tl("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tl("baseRetryDelayMs",5e3,u),this.cb=tl("retryDelaySeedMs",1e4,u),this.Wa=tl("forwardChannelMaxRetries",2,u),this.wa=tl("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new N0(u&&u.concurrentRequestLimit),this.Da=new VI,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=H0.prototype,n.la=8,n.G=1,n.connect=function(u,f,g,T){lt(0),this.W=u,this.H=f||{},g&&T!==void 0&&(this.H.OSID=g,this.H.OAID=T),this.F=this.X,this.I=ty(this,null,this.W),ru(this)};function Jh(u){if(G0(u),u.G==3){var f=u.U++,g=qr(u.I);if(Et(g,"SID",u.K),Et(g,"RID",f),Et(g,"TYPE","terminate"),nl(u,g),f=new Oe(u,u.j,f),f.L=2,f.v=Xc(qr(g)),g=!1,l.navigator&&l.navigator.sendBeacon)try{g=l.navigator.sendBeacon(f.v.toString(),"")}catch{}!g&&l.Image&&(new Image().src=f.v,g=!0),g||(f.g=ny(f.j,null),f.g.ea(f.v)),f.F=Date.now(),wa(f)}ey(u)}function nu(u){u.g&&(Zh(u),u.g.cancel(),u.g=null)}function G0(u){nu(u),u.u&&(l.clearTimeout(u.u),u.u=null),su(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&l.clearTimeout(u.s),u.s=null)}function ru(u){if(!C0(u.h)&&!u.s){u.s=!0;var f=u.Ga;et||Y(),V||(et(),V=!0),K.add(f,u),u.B=0}}function UI(u,f){return A0(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=f.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=gt(p(u.Ga,u,f),Z0(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const L=new Oe(this,this.j,u);let W=this.o;if(this.S&&(W?(W=b(W),A(W,this.S)):W=this.S),this.m!==null||this.O||(L.H=W,W=null),this.P)e:{for(var f=0,g=0;g<this.i.length;g++){t:{var T=this.i[g];if("__data__"in T.map&&(T=T.map.__data__,typeof T=="string")){T=T.length;break t}T=void 0}if(T===void 0)break;if(f+=T,4096<f){f=g;break e}if(f===4096||g===this.i.length-1){f=g+1;break e}}f=1e3}else f=1e3;f=Q0(this,L,f),g=qr(this.I),Et(g,"RID",u),Et(g,"CVER",22),this.D&&Et(g,"X-HTTP-Session-Id",this.D),nl(this,g),W&&(this.O?f="headers="+encodeURIComponent(String($0(W)))+"&"+f:this.m&&Yh(g,this.m,W)),Qh(this.h,L),this.Ua&&Et(g,"TYPE","init"),this.P?(Et(g,"$req",f),Et(g,"SID","null"),L.T=!0,ba(L,g,null)):ba(L,g,f),this.G=2}}else this.G==3&&(u?K0(this,u):this.i.length==0||C0(this.h)||K0(this))};function K0(u,f){var g;f?g=f.l:g=u.U++;const T=qr(u.I);Et(T,"SID",u.K),Et(T,"RID",g),Et(T,"AID",u.T),nl(u,T),u.m&&u.o&&Yh(T,u.m,u.o),g=new Oe(u,u.j,g,u.B+1),u.m===null&&(g.H=u.o),f&&(u.i=f.D.concat(u.i)),f=Q0(u,g,1e3),g.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Qh(u.h,g),ba(g,T,f)}function nl(u,f){u.H&&F(u.H,function(g,T){Et(f,T,g)}),u.l&&j0({},function(g,T){Et(f,T,g)})}function Q0(u,f,g){g=Math.min(u.i.length,g);var T=u.l?p(u.l.Na,u.l,u):null;e:{var L=u.i;let W=-1;for(;;){const le=["count="+g];W==-1?0<g?(W=L[0].g,le.push("ofs="+W)):W=0:le.push("ofs="+W);let yt=!0;for(let yn=0;yn<g;yn++){let nt=L[yn].g;const Cn=L[yn].map;if(nt-=W,0>nt)W=Math.max(0,L[yn].g-100),yt=!1;else try{LI(Cn,le,"req"+nt+"_")}catch{T&&T(Cn)}}if(yt){T=le.join("&");break e}}}return u=u.i.splice(0,g),f.D=u,T}function Y0(u){if(!u.g&&!u.u){u.Y=1;var f=u.Fa;et||Y(),V||(et(),V=!0),K.add(f,u),u.v=0}}function Xh(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=gt(p(u.Fa,u),Z0(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,J0(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=gt(p(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,lt(10),nu(this),J0(this))};function Zh(u){u.A!=null&&(l.clearTimeout(u.A),u.A=null)}function J0(u){u.g=new Oe(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var f=qr(u.qa);Et(f,"RID","rpc"),Et(f,"SID",u.K),Et(f,"AID",u.T),Et(f,"CI",u.F?"0":"1"),!u.F&&u.ja&&Et(f,"TO",u.ja),Et(f,"TYPE","xmlhttp"),nl(u,f),u.m&&u.o&&Yh(f,u.m,u.o),u.L&&(u.g.I=u.L);var g=u.g;u=u.ia,g.L=1,g.v=Xc(qr(f)),g.m=null,g.P=!0,Gc(g,u)}n.Za=function(){this.C!=null&&(this.C=null,nu(this),Xh(this),lt(19))};function su(u){u.C!=null&&(l.clearTimeout(u.C),u.C=null)}function X0(u,f){var g=null;if(u.g==f){su(u),Zh(u),u.g=null;var T=2}else if(Kh(u.h,f))g=f.D,k0(u.h,f),T=1;else return;if(u.G!=0){if(f.o)if(T==1){g=f.m?f.m.length:0,f=Date.now()-f.F;var L=u.B;T=Re(),He(T,new Ge(T,g)),ru(u)}else Y0(u);else if(L=f.s,L==3||L==0&&0<f.X||!(T==1&&UI(u,f)||T==2&&Xh(u)))switch(g&&0<g.length&&(f=u.h,f.i=f.i.concat(g)),L){case 1:Ni(u,5);break;case 4:Ni(u,10);break;case 3:Ni(u,6);break;default:Ni(u,2)}}}function Z0(u,f){let g=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(g*=2),g*f}function Ni(u,f){if(u.j.info("Error code "+f),f==2){var g=p(u.fb,u),T=u.Xa;const L=!T;T=new Ii(T||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Yc(T,"https"),Xc(T),L?DI(T.toString(),g):MI(T.toString(),g)}else lt(2);u.G=0,u.l&&u.l.sa(f),ey(u),G0(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),lt(2)):(this.j.info("Failed to ping google.com"),lt(1))};function ey(u){if(u.G=0,u.ka=[],u.l){const f=P0(u.h);(f.length!=0||u.i.length!=0)&&(E(u.ka,f),E(u.ka,u.i),u.h.i.length=0,S(u.i),u.i.length=0),u.l.ra()}}function ty(u,f,g){var T=g instanceof Ii?qr(g):new Ii(g);if(T.g!="")f&&(T.g=f+"."+T.g),Jc(T,T.s);else{var L=l.location;T=L.protocol,f=f?f+"."+L.hostname:L.hostname,L=+L.port;var W=new Ii(null);T&&Yc(W,T),f&&(W.g=f),L&&Jc(W,L),g&&(W.l=g),T=W}return g=u.D,f=u.ya,g&&f&&Et(T,g,f),Et(T,"VER",u.la),nl(u,T),T}function ny(u,f,g){if(f&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return f=u.Ca&&!u.pa?new $t(new Zc({eb:g})):new $t(u.pa),f.Ha(u.J),f}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ry(){}n=ry.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function iu(){}iu.prototype.g=function(u,f){return new rr(u,f)};function rr(u,f){we.call(this),this.g=new H0(f),this.l=u,this.h=f&&f.messageUrlParams||null,u=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(u?u["X-WebChannel-Content-Type"]=f.messageContentType:u={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.va&&(u?u["X-WebChannel-Client-Profile"]=f.va:u={"X-WebChannel-Client-Profile":f.va}),this.g.S=u,(u=f&&f.Sb)&&!x(u)&&(this.g.m=u),this.v=f&&f.supportsCrossDomainXhr||!1,this.u=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!x(f)&&(this.g.D=f,u=this.h,u!==null&&f in u&&(u=this.h,f in u&&delete u[f])),this.j=new Ea(this)}v(rr,we),rr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},rr.prototype.close=function(){Jh(this.g)},rr.prototype.o=function(u){var f=this.g;if(typeof u=="string"){var g={};g.__data__=u,u=g}else this.u&&(g={},g.__data__=at(u),u=g);f.i.push(new TI(f.Ya++,u)),f.G==3&&ru(f)},rr.prototype.N=function(){this.g.l=null,delete this.j,Jh(this.g),delete this.g,rr.aa.N.call(this)};function sy(u){G.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var f=u.__sm__;if(f){e:{for(const g in f){u=g;break e}u=void 0}(this.i=u)&&(u=this.i,f=f!==null&&u in f?f[u]:void 0),this.data=f}else this.data=u}v(sy,G);function iy(){de.call(this),this.status=1}v(iy,de);function Ea(u){this.g=u}v(Ea,ry),Ea.prototype.ua=function(){He(this.g,"a")},Ea.prototype.ta=function(u){He(this.g,new sy(u))},Ea.prototype.sa=function(u){He(this.g,new iy)},Ea.prototype.ra=function(){He(this.g,"b")},iu.prototype.createWebChannel=iu.prototype.g,rr.prototype.send=rr.prototype.o,rr.prototype.open=rr.prototype.m,rr.prototype.close=rr.prototype.close,LE=function(){return new iu},VE=function(){return Re()},ME=ce,Gf={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},J.NO_ERROR=0,J.TIMEOUT=8,J.HTTP_ERROR=6,Yu=J,Se.COMPLETE="complete",DE=Se,Ee.EventType=B,B.OPEN="a",B.CLOSE="b",B.ERROR="c",B.MESSAGE="d",we.prototype.listen=we.prototype.K,_l=Ee,$t.prototype.listenOnce=$t.prototype.L,$t.prototype.getLastError=$t.prototype.Ka,$t.prototype.getLastErrorCode=$t.prototype.Ba,$t.prototype.getStatus=$t.prototype.Z,$t.prototype.getResponseJson=$t.prototype.Oa,$t.prototype.getResponseText=$t.prototype.oa,$t.prototype.send=$t.prototype.ea,$t.prototype.setWithCredentials=$t.prototype.Ha,RE=$t}).apply(typeof Su<"u"?Su:typeof self<"u"?self:typeof window<"u"?window:{});const Zv="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}mn.UNAUTHENTICATED=new mn(null),mn.GOOGLE_CREDENTIALS=new mn("google-credentials-uid"),mn.FIRST_PARTY=new mn("first-party-uid"),mn.MOCK_USER=new mn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Oo="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ci=new fg("@firebase/firestore");function Pa(){return ci.logLevel}function nV(n){ci.setLogLevel(n)}function X(n,...e){if(ci.logLevel<=Be.DEBUG){const t=e.map(Sg);ci.debug(`Firestore (${Oo}): ${n}`,...t)}}function Gt(n,...e){if(ci.logLevel<=Be.ERROR){const t=e.map(Sg);ci.error(`Firestore (${Oo}): ${n}`,...t)}}function xr(n,...e){if(ci.logLevel<=Be.WARN){const t=e.map(Sg);ci.warn(`Firestore (${Oo}): ${n}`,...t)}}function Sg(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function he(n="Unexpected state"){const e=`FIRESTORE (${Oo}) INTERNAL ASSERTION FAILED: `+n;throw Gt(e),new Error(e)}function ve(n,e){n||he()}function rV(n,e){n||he()}function oe(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Z extends gs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OE{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class hR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(mn.UNAUTHENTICATED))}shutdown(){}}class mR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class fR{constructor(e){this.t=e,this.currentUser=mn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ve(this.o===void 0);let r=this.i;const s=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let i=new pn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new pn,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},l=c=>{X("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(X("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new pn)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(X("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ve(typeof r.accessToken=="string"),new OE(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ve(e===null||typeof e=="string"),new mn(e)}}class pR{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=mn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class gR{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new pR(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(mn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class FE{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class yR{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){ve(this.o===void 0);const r=i=>{i.error!=null&&X("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.R;return this.R=i.token,X("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{X("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):X("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ve(typeof t.token=="string"),this.R=t.token,new FE(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class sV{getToken(){return Promise.resolve(new FE(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vR(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $E{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=vR(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function ke(n,e){return n<e?-1:n>e?1:0}function fo(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function UE(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Z(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Z(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Z(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Z(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Vt.fromMillis(Date.now())}static fromDate(e){return Vt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Vt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ke(this.nanoseconds,e.nanoseconds):ke(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Te{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Te(e)}static min(){return new Te(new Vt(0,0))}static max(){return new Te(new Vt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uc{constructor(e,t,r){t===void 0?t=0:t>e.length&&he(),r===void 0?r=e.length-t:r>e.length-t&&he(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return uc.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof uc?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),a=t.get(s);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ze extends uc{construct(e,t,r){return new ze(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Z(q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new ze(t)}static emptyPath(){return new ze([])}}const xR=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class kt extends uc{construct(e,t,r){return new kt(e,t,r)}static isValidIdentifier(e){return xR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),kt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new kt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Z(q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new Z(q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new Z(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new Z(q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new kt(t)}static emptyPath(){return new kt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{constructor(e){this.path=e}static fromPath(e){return new ue(ze.fromString(e))}static fromName(e){return new ue(ze.fromString(e).popFirst(5))}static empty(){return new ue(ze.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ze.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ze.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ue(new ze(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Kf(n){return n.fields.find(e=>e.kind===2)}function Ri(n){return n.fields.filter(e=>e.kind!==2)}function bR(n,e){let t=ke(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=wR(n.fields[r],e.fields[r]),t!==0)return t;return ke(n.fields.length,e.fields.length)}po.UNKNOWN_ID=-1;class Hi{constructor(e,t){this.fieldPath=e,this.kind=t}}function wR(n,e){const t=kt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:ke(n.kind,e.kind)}class go{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new go(0,cr.min())}}function BE(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Te.fromTimestamp(r===1e9?new Vt(t+1,0):new Vt(t,r));return new cr(s,ue.empty(),e)}function zE(n){return new cr(n.readTime,n.key,-1)}class cr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new cr(Te.min(),ue.empty(),-1)}static max(){return new cr(Te.max(),ue.empty(),-1)}}function Ig(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ue.comparator(n.documentKey,e.documentKey),t!==0?t:ke(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class WE{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bi(n){if(n.code!==q.FAILED_PRECONDITION||n.message!==qE)throw n;X("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&he(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new O((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof O?t:O.resolve(t)}catch(t){return O.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):O.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):O.reject(t)}static resolve(e){return new O((t,r)=>{t(e)})}static reject(e){return new O((t,r)=>{r(e)})}static waitFor(e){return new O((t,r)=>{let s=0,i=0,a=!1;e.forEach(l=>{++s,l.next(()=>{++i,a&&i===s&&t()},c=>r(c))}),a=!0,i===s&&t()})}static or(e){let t=O.resolve(!1);for(const r of e)t=t.next(s=>s?O.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new O((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let c=0;c<i;c++){const d=c;t(e[d]).next(h=>{a[d]=h,++l,l===i&&r(a)},h=>s(h))}})}static doWhile(e,t){return new O((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _h{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new pn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Vl(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Ng(r.target.error);this.V.reject(new Vl(e,s))}}static open(e,t,r,s){try{return new _h(t,e.transaction(s,r))}catch(i){throw new Vl(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(X("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new ER(t)}}class $r{constructor(e,t,r){this.name=e,this.version=t,this.p=r,$r.S(on())===12.2&&Gt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return X("SimpleDb","Removing database:",e),Mi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!z_())return!1;if($r.v())return!0;const e=on(),t=$r.S(e),r=0<t&&t<10,s=HE(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(X("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;t(a)},s.onblocked=()=>{r(new Vl(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?r(new Z(q.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new Z(q.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new Vl(e,a))},s.onupgradeneeded=i=>{X("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;this.p.O(a,s.transaction,i.oldVersion,this.version).next(()=>{X("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let a=0;for(;;){++a;try{this.db=await this.M(e);const l=_h.open(this.db,e,i?"readonly":"readwrite",r),c=s(l).next(d=>(l.g(),d)).catch(d=>(l.abort(d),O.reject(d))).toPromise();return c.catch(()=>{}),await l.m,c}catch(l){const c=l,d=c.name!=="FirebaseError"&&a<3;if(X("SimpleDb","Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function HE(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class _R{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Mi(this.B.delete())}}class Vl extends Z{constructor(e,t){super(q.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function wi(n){return n.name==="IndexedDbTransactionError"}class ER{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(X("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(X("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Mi(r)}add(e){return X("SimpleDb","ADD",this.store.name,e,e),Mi(this.store.add(e))}get(e){return Mi(this.store.get(e)).next(t=>(t===void 0&&(t=null),X("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return X("SimpleDb","DELETE",this.store.name,e),Mi(this.store.delete(e))}count(){return X("SimpleDb","COUNT",this.store.name),Mi(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new O((a,l)=>{i.onerror=c=>{l(c.target.error)},i.onsuccess=c=>{a(c.target.result)}})}{const i=this.cursor(r),a=[];return this.W(i,(l,c)=>{a.push(c)}).next(()=>a)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new O((s,i)=>{r.onerror=a=>{i(a.target.error)},r.onsuccess=a=>{s(a.target.result)}})}j(e,t){X("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,a,l)=>l.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new O((r,s)=>{t.onerror=i=>{const a=Ng(i.target.error);s(a)},t.onsuccess=i=>{const a=i.target.result;a?e(a.primaryKey,a.value).next(l=>{l?a.continue():r()}):r()}})}W(e,t){const r=[];return new O((s,i)=>{e.onerror=a=>{i(a.target.error)},e.onsuccess=a=>{const l=a.target.result;if(!l)return void s();const c=new _R(l),d=t(l.primaryKey,l.value,c);if(d instanceof O){const h=d.catch(m=>(c.done(),O.reject(m)));r.push(h)}c.isDone?s():c.K===null?l.continue():l.continue(c.K)}}).next(()=>O.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Mi(n){return new O((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Ng(r.target.error);t(s)}})}let ex=!1;function Ng(n){const e=$r.S(on());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new Z("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ex||(ex=!0,setTimeout(()=>{throw r},0)),r}}return n}class TR{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){X("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{X("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){wi(t)?X("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await bi(t)}await this.X(6e4)})}}class SR{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return O.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!r.has(a))return X("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,s).next(l=>{s-=l,r.add(a)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(s,i)).next(l=>(X("IndexBackfiller",`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,t,l))).next(()=>a.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const a=zE(i);Ig(a,r)>0&&(r=a)}),new cr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Jn.oe=-1;function Rc(n){return n==null}function dc(n){return n===0&&1/n==-1/0}function GE(n){return typeof n=="number"&&Number.isInteger(n)&&!dc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=tx(e)),e=IR(n.get(t),e);return tx(e)}function IR(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function tx(n){return n+""}function Dr(n){const e=n.length;if(ve(e>=2),e===2)return ve(n.charAt(0)===""&&n.charAt(1)===""),ze.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const a=n.indexOf("",i);switch((a<0||a>t)&&he(),n.charAt(a+1)){case"":const l=n.substring(i,a);let c;s.length===0?c=l:(s+=l,c=s,s=""),r.push(c);break;case"":s+=n.substring(i,a),s+="\0";break;case"":s+=n.substring(i,a+1);break;default:he()}i=a+2}return new ze(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nx=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ju(n,e){return[n,Mn(e)]}function KE(n,e,t){return[n,Mn(e),t]}const NR={},CR=["prefixPath","collectionGroup","readTime","documentId"],AR=["prefixPath","collectionGroup","documentId"],kR=["collectionGroup","readTime","prefixPath","documentId"],PR=["canonicalId","targetId"],jR=["targetId","path"],RR=["path","targetId"],DR=["collectionId","parent"],MR=["indexId","uid"],VR=["uid","sequenceNumber"],LR=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],OR=["indexId","uid","orderedDocumentKey"],FR=["userId","collectionPath","documentId"],$R=["userId","collectionPath","largestBatchId"],UR=["userId","collectionGroup","largestBatchId"],QE=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],BR=[...QE,"documentOverlays"],YE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],JE=YE,Cg=[...JE,"indexConfiguration","indexState","indexEntries"],zR=Cg,qR=[...Cg,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf extends WE{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function cn(n,e){const t=oe(n);return $r.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rx(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function _i(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function XE(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function ZE(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,t){this.comparator=e,this.root=t||xn.EMPTY}insert(e,t){return new wt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,xn.BLACK,null,null))}remove(e){return new wt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Iu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Iu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Iu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Iu(this.root,e,this.comparator,!0)}}class Iu{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class xn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??xn.RED,this.left=s??xn.EMPTY,this.right=i??xn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new xn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return xn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return xn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,xn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,xn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw he();const e=this.left.check();if(e!==this.right.check())throw he();return e+(this.isRed()?0:1)}}xn.EMPTY=null,xn.RED=!0,xn.BLACK=!1;xn.EMPTY=new class{constructor(){this.size=0}get key(){throw he()}get value(){throw he()}get color(){throw he()}get left(){throw he()}get right(){throw he()}copy(e,t,r,s,i){return this}insert(e,t,r){return new xn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e){this.comparator=e,this.data=new wt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new sx(this.data.getIterator())}getIteratorFrom(e){return new sx(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ht)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ht(this.comparator);return t.data=e,t}}class sx{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ia(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xn{constructor(e){this.fields=e,e.sort(kt.comparator)}static empty(){return new Xn([])}unionWith(e){let t=new ht(kt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Xn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return fo(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eT extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aV(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new eT("Invalid base64 string: "+i):i}}(e);return new Bt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new Bt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ke(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Bt.EMPTY_BYTE_STRING=new Bt("");const WR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function cs(n){if(ve(!!n),typeof n=="string"){let e=0;const t=WR.exec(n);if(ve(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ct(n.seconds),nanos:Ct(n.nanos)}}function Ct(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function us(n){return typeof n=="string"?Bt.fromBase64String(n):Bt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Th(n){const e=n.mapValue.fields.__previous_value__;return Eh(e)?Th(e):e}function hc(n){const e=cs(n.mapValue.fields.__local_write_time__.timestampValue);return new Vt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HR{constructor(e,t,r,s,i,a,l,c,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=d}}class ta{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ta("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ta&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gs={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Xu={nullValue:"NULL_VALUE"};function ui(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Eh(n)?4:tT(n)?9007199254740991:Sh(n)?10:11:he()}function zr(n,e){if(n===e)return!0;const t=ui(n);if(t!==ui(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return hc(n).isEqual(hc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=cs(s.timestampValue),l=cs(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return us(s.bytesValue).isEqual(us(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Ct(s.geoPointValue.latitude)===Ct(i.geoPointValue.latitude)&&Ct(s.geoPointValue.longitude)===Ct(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Ct(s.integerValue)===Ct(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=Ct(s.doubleValue),l=Ct(i.doubleValue);return a===l?dc(a)===dc(l):isNaN(a)&&isNaN(l)}return!1}(n,e);case 9:return fo(n.arrayValue.values||[],e.arrayValue.values||[],zr);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(rx(a)!==rx(l))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(l[c]===void 0||!zr(a[c],l[c])))return!1;return!0}(n,e);default:return he()}}function mc(n,e){return(n.values||[]).find(t=>zr(t,e))!==void 0}function di(n,e){if(n===e)return 0;const t=ui(n),r=ui(e);if(t!==r)return ke(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ke(n.booleanValue,e.booleanValue);case 2:return function(i,a){const l=Ct(i.integerValue||i.doubleValue),c=Ct(a.integerValue||a.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(n,e);case 3:return ix(n.timestampValue,e.timestampValue);case 4:return ix(hc(n),hc(e));case 5:return ke(n.stringValue,e.stringValue);case 6:return function(i,a){const l=us(i),c=us(a);return l.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(i,a){const l=i.split("/"),c=a.split("/");for(let d=0;d<l.length&&d<c.length;d++){const h=ke(l[d],c[d]);if(h!==0)return h}return ke(l.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,a){const l=ke(Ct(i.latitude),Ct(a.latitude));return l!==0?l:ke(Ct(i.longitude),Ct(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return ax(n.arrayValue,e.arrayValue);case 10:return function(i,a){var l,c,d,h;const m=i.fields||{},p=a.fields||{},y=(l=m.value)===null||l===void 0?void 0:l.arrayValue,v=(c=p.value)===null||c===void 0?void 0:c.arrayValue,S=ke(((d=y==null?void 0:y.values)===null||d===void 0?void 0:d.length)||0,((h=v==null?void 0:v.values)===null||h===void 0?void 0:h.length)||0);return S!==0?S:ax(y,v)}(n.mapValue,e.mapValue);case 11:return function(i,a){if(i===Gs.mapValue&&a===Gs.mapValue)return 0;if(i===Gs.mapValue)return 1;if(a===Gs.mapValue)return-1;const l=i.fields||{},c=Object.keys(l),d=a.fields||{},h=Object.keys(d);c.sort(),h.sort();for(let m=0;m<c.length&&m<h.length;++m){const p=ke(c[m],h[m]);if(p!==0)return p;const y=di(l[c[m]],d[h[m]]);if(y!==0)return y}return ke(c.length,h.length)}(n.mapValue,e.mapValue);default:throw he()}}function ix(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ke(n,e);const t=cs(n),r=cs(e),s=ke(t.seconds,r.seconds);return s!==0?s:ke(t.nanos,r.nanos)}function ax(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=di(t[s],r[s]);if(i)return i}return ke(t.length,r.length)}function yo(n){return Yf(n)}function Yf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=cs(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return us(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return ue.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Yf(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${Yf(t.fields[a])}`;return s+"}"}(n.mapValue):he()}function Zu(n){switch(ui(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Th(n);return e?16+Zu(e):16;case 5:return 2*n.stringValue.length;case 6:return us(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Zu(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return _i(r.fields,(i,a)=>{s+=i.length+Zu(a)}),s}(n.mapValue);default:throw he()}}function na(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Jf(n){return!!n&&"integerValue"in n}function fc(n){return!!n&&"arrayValue"in n}function ox(n){return!!n&&"nullValue"in n}function lx(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ed(n){return!!n&&"mapValue"in n}function Sh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Ll(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return _i(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ll(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ll(n.arrayValue.values[t]);return e}return Object.assign({},n)}function tT(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const nT={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function GR(n){return"nullValue"in n?Xu:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?na(ta.empty(),ue.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Sh(n)?nT:{mapValue:{}}:he()}function KR(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?na(ta.empty(),ue.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?nT:"mapValue"in n?Sh(n)?{mapValue:{}}:Gs:he()}function cx(n,e){const t=di(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function ux(n,e){const t=di(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(e){this.value=e}static empty(){return new bn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ed(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ll(t)}setAll(e){let t=kt.emptyPath(),r={},s=[];e.forEach((a,l)=>{if(!t.isImmediateParentOf(l)){const c=this.getFieldsMap(t);this.applyChanges(c,r,s),r={},s=[],t=l.popLast()}a?r[l.lastSegment()]=Ll(a):s.push(l.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());ed(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return zr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];ed(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){_i(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new bn(Ll(this.value))}}function rT(n){const e=[];return _i(n.fields,(t,r)=>{const s=new kt([t]);if(ed(r)){const i=rT(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new Xn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(e,t,r,s,i,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new St(e,0,Te.min(),Te.min(),Te.min(),bn.empty(),0)}static newFoundDocument(e,t,r,s){return new St(e,1,t,Te.min(),r,s,0)}static newNoDocument(e,t){return new St(e,2,t,Te.min(),Te.min(),bn.empty(),0)}static newUnknownDocument(e,t){return new St(e,3,t,Te.min(),Te.min(),bn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Te.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=bn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=bn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Te.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof St&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new St(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi{constructor(e,t){this.position=e,this.inclusive=t}}function dx(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=ue.comparator(ue.fromName(a.referenceValue),t.key):r=di(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function hx(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!zr(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(e,t="asc"){this.field=e,this.dir=t}}function QR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sT{}class qe extends sT{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new YR(e,t,r):t==="array-contains"?new ZR(e,r):t==="in"?new uT(e,r):t==="not-in"?new e2(e,r):t==="array-contains-any"?new t2(e,r):new qe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new JR(e,r):new XR(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(di(t,this.value)):t!==null&&ui(this.value)===ui(t)&&this.matchesComparison(di(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return he()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ct extends sT{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new ct(e,t)}matches(e){return vo(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function vo(n){return n.op==="and"}function Xf(n){return n.op==="or"}function Ag(n){return iT(n)&&vo(n)}function iT(n){for(const e of n.filters)if(e instanceof ct)return!1;return!0}function Zf(n){if(n instanceof qe)return n.field.canonicalString()+n.op.toString()+yo(n.value);if(Ag(n))return n.filters.map(e=>Zf(e)).join(",");{const e=n.filters.map(t=>Zf(t)).join(",");return`${n.op}(${e})`}}function aT(n,e){return n instanceof qe?function(r,s){return s instanceof qe&&r.op===s.op&&r.field.isEqual(s.field)&&zr(r.value,s.value)}(n,e):n instanceof ct?function(r,s){return s instanceof ct&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,l)=>i&&aT(a,s.filters[l]),!0):!1}(n,e):void he()}function oT(n,e){const t=n.filters.concat(e);return ct.create(t,n.op)}function lT(n){return n instanceof qe?function(t){return`${t.field.canonicalString()} ${t.op} ${yo(t.value)}`}(n):n instanceof ct?function(t){return t.op.toString()+" {"+t.getFilters().map(lT).join(" ,")+"}"}(n):"Filter"}class YR extends qe{constructor(e,t,r){super(e,t,r),this.key=ue.fromName(r.referenceValue)}matches(e){const t=ue.comparator(e.key,this.key);return this.matchesComparison(t)}}class JR extends qe{constructor(e,t){super(e,"in",t),this.keys=cT("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class XR extends qe{constructor(e,t){super(e,"not-in",t),this.keys=cT("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function cT(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>ue.fromName(r.referenceValue))}class ZR extends qe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return fc(t)&&mc(t.arrayValue,this.value)}}class uT extends qe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&mc(this.value.arrayValue,t)}}class e2 extends qe{constructor(e,t){super(e,"not-in",t)}matches(e){if(mc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!mc(this.value.arrayValue,t)}}class t2 extends qe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!fc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>mc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n2{constructor(e,t=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.ue=null}}function ep(n,e=null,t=[],r=[],s=null,i=null,a=null){return new n2(n,e,t,r,s,i,a)}function ra(n){const e=oe(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Zf(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Rc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>yo(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>yo(r)).join(",")),e.ue=t}return e.ue}function Dc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!QR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!aT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!hx(n.startAt,e.startAt)&&hx(n.endAt,e.endAt)}function $d(n){return ue.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Ud(n,e){return n.filters.filter(t=>t instanceof qe&&t.field.isEqual(e))}function mx(n,e,t){let r=Xu,s=!0;for(const i of Ud(n,e)){let a=Xu,l=!0;switch(i.op){case"<":case"<=":a=GR(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,l=!1;break;case"!=":case"not-in":a=Xu}cx({value:r,inclusive:s},{value:a,inclusive:l})<0&&(r=a,s=l)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const a=t.position[i];cx({value:r,inclusive:s},{value:a,inclusive:t.inclusive})<0&&(r=a,s=t.inclusive);break}}return{value:r,inclusive:s}}function fx(n,e,t){let r=Gs,s=!0;for(const i of Ud(n,e)){let a=Gs,l=!0;switch(i.op){case">=":case">":a=KR(i.value),l=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,l=!1;break;case"!=":case"not-in":a=Gs}ux({value:r,inclusive:s},{value:a,inclusive:l})>0&&(r=a,s=l)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const a=t.position[i];ux({value:r,inclusive:s},{value:a,inclusive:t.inclusive})>0&&(r=a,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{constructor(e,t=null,r=[],s=[],i=null,a="F",l=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function dT(n,e,t,r,s,i,a,l){return new xs(n,e,t,r,s,i,a,l)}function Fo(n){return new xs(n)}function px(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function kg(n){return n.collectionGroup!==null}function ro(n){const e=oe(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new ht(kt.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new pc(i,r))}),t.has(kt.keyField().canonicalString())||e.ce.push(new pc(kt.keyField(),r))}return e.ce}function Vn(n){const e=oe(n);return e.le||(e.le=mT(e,ro(n))),e.le}function hT(n){const e=oe(n);return e.he||(e.he=mT(e,n.explicitOrderBy)),e.he}function mT(n,e){if(n.limitType==="F")return ep(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new pc(s.field,i)});const t=n.endAt?new hi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new hi(n.startAt.position,n.startAt.inclusive):null;return ep(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function tp(n,e){const t=n.filters.concat([e]);return new xs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Bd(n,e,t){return new xs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Mc(n,e){return Dc(Vn(n),Vn(e))&&n.limitType===e.limitType}function fT(n){return`${ra(Vn(n))}|lt:${n.limitType}`}function ja(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>lT(s)).join(", ")}]`),Rc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>yo(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>yo(s)).join(",")),`Target(${r})`}(Vn(n))}; limitType=${n.limitType})`}function Vc(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ue.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of ro(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(a,l,c){const d=dx(a,l,c);return a.inclusive?d<=0:d<0}(r.startAt,ro(r),s)||r.endAt&&!function(a,l,c){const d=dx(a,l,c);return a.inclusive?d>=0:d>0}(r.endAt,ro(r),s))}(n,e)}function pT(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function gT(n){return(e,t)=>{let r=!1;for(const s of ro(n)){const i=r2(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function r2(n,e,t){const r=n.field.isKeyField()?ue.comparator(e.key,t.key):function(i,a,l){const c=a.data.field(i),d=l.data.field(i);return c!==null&&d!==null?di(c,d):he()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return he()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){_i(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return ZE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s2=new wt(ue.comparator);function Zn(){return s2}const yT=new wt(ue.comparator);function El(...n){let e=yT;for(const t of n)e=e.insert(t.key,t);return e}function vT(n){let e=yT;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Mr(){return Ol()}function xT(){return Ol()}function Ol(){return new bs(n=>n.toString(),(n,e)=>n.isEqual(e))}const i2=new wt(ue.comparator),a2=new ht(ue.comparator);function Me(...n){let e=a2;for(const t of n)e=e.add(t);return e}const o2=new ht(ke);function Pg(){return o2}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jg(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:dc(e)?"-0":e}}function bT(n){return{integerValue:""+n}}function wT(n,e){return GE(e)?bT(e):jg(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ih{constructor(){this._=void 0}}function l2(n,e,t){return n instanceof xo?function(s,i){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Eh(i)&&(i=Th(i)),i&&(a.fields.__previous_value__=i),{mapValue:a}}(t,e):n instanceof sa?ET(n,e):n instanceof ia?TT(n,e):function(s,i){const a=_T(s,i),l=gx(a)+gx(s.Pe);return Jf(a)&&Jf(s.Pe)?bT(l):jg(s.serializer,l)}(n,e)}function c2(n,e,t){return n instanceof sa?ET(n,e):n instanceof ia?TT(n,e):t}function _T(n,e){return n instanceof bo?function(r){return Jf(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class xo extends Ih{}class sa extends Ih{constructor(e){super(),this.elements=e}}function ET(n,e){const t=ST(e);for(const r of n.elements)t.some(s=>zr(s,r))||t.push(r);return{arrayValue:{values:t}}}class ia extends Ih{constructor(e){super(),this.elements=e}}function TT(n,e){let t=ST(e);for(const r of n.elements)t=t.filter(s=>!zr(s,r));return{arrayValue:{values:t}}}class bo extends Ih{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function gx(n){return Ct(n.integerValue||n.doubleValue)}function ST(n){return fc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(e,t){this.field=e,this.transform=t}}function u2(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof sa&&s instanceof sa||r instanceof ia&&s instanceof ia?fo(r.elements,s.elements,zr):r instanceof bo&&s instanceof bo?zr(r.Pe,s.Pe):r instanceof xo&&s instanceof xo}(n.transform,e.transform)}class d2{constructor(e,t){this.version=e,this.transformResults=t}}class Pt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Pt}static exists(e){return new Pt(void 0,e)}static updateTime(e){return new Pt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function td(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Nh{}function IT(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Uo(n.key,Pt.none()):new $o(n.key,n.data,Pt.none());{const t=n.data,r=bn.empty();let s=new ht(kt.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new ws(n.key,r,new Xn(s.toArray()),Pt.none())}}function h2(n,e,t){n instanceof $o?function(s,i,a){const l=s.value.clone(),c=vx(s.fieldTransforms,i,a.transformResults);l.setAll(c),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):n instanceof ws?function(s,i,a){if(!td(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=vx(s.fieldTransforms,i,a.transformResults),c=i.data;c.setAll(NT(s)),c.setAll(l),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(n,e,t):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Fl(n,e,t,r){return n instanceof $o?function(i,a,l,c){if(!td(i.precondition,a))return l;const d=i.value.clone(),h=xx(i.fieldTransforms,c,a);return d.setAll(h),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof ws?function(i,a,l,c){if(!td(i.precondition,a))return l;const d=xx(i.fieldTransforms,c,a),h=a.data;return h.setAll(NT(i)),h.setAll(d),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(m=>m.field))}(n,e,t,r):function(i,a,l){return td(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(n,e,t)}function m2(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=_T(r.transform,s||null);i!=null&&(t===null&&(t=bn.empty()),t.set(r.field,i))}return t||null}function yx(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&fo(r,s,(i,a)=>u2(i,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class $o extends Nh{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ws extends Nh{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function NT(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function vx(n,e,t){const r=new Map;ve(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,c2(a,l,t[s]))}return r}function xx(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,l2(i,a,e))}return r}class Uo extends Nh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Rg extends Nh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&h2(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Fl(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Fl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=xT();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=t.has(s.key)?null:l;const c=IT(a,l);c!==null&&r.set(s.key,c),a.isValidDocument()||a.convertToNoDocument(Te.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Me())}isEqual(e){return this.batchId===e.batchId&&fo(this.mutations,e.mutations,(t,r)=>yx(t,r))&&fo(this.baseMutations,e.baseMutations,(t,r)=>yx(t,r))}}class Mg{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){ve(e.mutations.length===r.length);let s=function(){return i2}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new Mg(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CT{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f2{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tn,Ke;function AT(n){switch(n){default:return he();case q.CANCELLED:case q.UNKNOWN:case q.DEADLINE_EXCEEDED:case q.RESOURCE_EXHAUSTED:case q.INTERNAL:case q.UNAVAILABLE:case q.UNAUTHENTICATED:return!1;case q.INVALID_ARGUMENT:case q.NOT_FOUND:case q.ALREADY_EXISTS:case q.PERMISSION_DENIED:case q.FAILED_PRECONDITION:case q.ABORTED:case q.OUT_OF_RANGE:case q.UNIMPLEMENTED:case q.DATA_LOSS:return!0}}function kT(n){if(n===void 0)return Gt("GRPC error has no .code"),q.UNKNOWN;switch(n){case tn.OK:return q.OK;case tn.CANCELLED:return q.CANCELLED;case tn.UNKNOWN:return q.UNKNOWN;case tn.DEADLINE_EXCEEDED:return q.DEADLINE_EXCEEDED;case tn.RESOURCE_EXHAUSTED:return q.RESOURCE_EXHAUSTED;case tn.INTERNAL:return q.INTERNAL;case tn.UNAVAILABLE:return q.UNAVAILABLE;case tn.UNAUTHENTICATED:return q.UNAUTHENTICATED;case tn.INVALID_ARGUMENT:return q.INVALID_ARGUMENT;case tn.NOT_FOUND:return q.NOT_FOUND;case tn.ALREADY_EXISTS:return q.ALREADY_EXISTS;case tn.PERMISSION_DENIED:return q.PERMISSION_DENIED;case tn.FAILED_PRECONDITION:return q.FAILED_PRECONDITION;case tn.ABORTED:return q.ABORTED;case tn.OUT_OF_RANGE:return q.OUT_OF_RANGE;case tn.UNIMPLEMENTED:return q.UNIMPLEMENTED;case tn.DATA_LOSS:return q.DATA_LOSS;default:return he()}}(Ke=tn||(tn={}))[Ke.OK=0]="OK",Ke[Ke.CANCELLED=1]="CANCELLED",Ke[Ke.UNKNOWN=2]="UNKNOWN",Ke[Ke.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ke[Ke.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ke[Ke.NOT_FOUND=5]="NOT_FOUND",Ke[Ke.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ke[Ke.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ke[Ke.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ke[Ke.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ke[Ke.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ke[Ke.ABORTED=10]="ABORTED",Ke[Ke.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ke[Ke.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ke[Ke.INTERNAL=13]="INTERNAL",Ke[Ke.UNAVAILABLE=14]="UNAVAILABLE",Ke[Ke.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PT(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p2=new Wi([4294967295,4294967295],0);function bx(n){const e=PT().encode(n),t=new jE;return t.update(e),new Uint8Array(t.digest())}function wx(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Wi([t,r],0),new Wi([s,i],0)]}class Lg{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Tl(`Invalid padding: ${t}`);if(r<0)throw new Tl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Tl(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Tl(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Wi.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Wi.fromNumber(r)));return s.compare(p2)===1&&(s=new Wi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=bx(e),[r,s]=wx(t);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);if(!this.de(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Lg(i,s,t);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.Ie===0)return;const t=bx(e),[r,s]=wx(t);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);this.Ae(a)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Tl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Fc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Oc(Te.min(),s,new wt(ke),Zn(),Me())}}class Fc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Fc(r,t,Me(),Me(),Me())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nd{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class jT{constructor(e,t){this.targetId=e,this.me=t}}class RT{constructor(e,t,r=Bt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class _x{constructor(){this.fe=0,this.ge=Tx(),this.pe=Bt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Me(),t=Me(),r=Me();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:he()}}),new Fc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Tx()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ve(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class g2{constructor(e){this.Le=e,this.Be=new Map,this.ke=Zn(),this.qe=Ex(),this.Qe=new wt(ke)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:he()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if($d(i))if(r===0){const a=new ue(i.path);this.Ue(t,a,St.newNoDocument(a,Te.min()))}else ve(r===1);else{const a=this.Ye(t);if(a!==r){const l=this.Ze(e),c=l?this.Xe(l,e,a):1;if(c!==0){this.je(t);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,d)}zd==null||zd.et(function(h,m,p,y,v){var S,E,_,x,C,k;const M={localCacheCount:h,existenceFilterCount:m.count,databaseId:p.database,projectId:p.projectId},F=m.unchangedNames;return F&&(M.bloomFilter={applied:v===0,hashCount:(S=F==null?void 0:F.hashCount)!==null&&S!==void 0?S:0,bitmapLength:(x=(_=(E=F==null?void 0:F.bits)===null||E===void 0?void 0:E.bitmap)===null||_===void 0?void 0:_.length)!==null&&x!==void 0?x:0,padding:(k=(C=F==null?void 0:F.bits)===null||C===void 0?void 0:C.padding)!==null&&k!==void 0?k:0,mightContain:w=>{var b;return(b=y==null?void 0:y.mightContain(w))!==null&&b!==void 0&&b}}),M}(a,e.me,this.Le.tt(),l,c))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,l;try{a=us(r).toUint8Array()}catch(c){if(c instanceof eT)return xr("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new Lg(a,s,i)}catch(c){return xr(c instanceof Tl?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.Ie===0?null:l}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const a=this.Le.tt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,a)=>{const l=this.Je(a);if(l){if(i.current&&$d(l.target)){const c=new ue(l.target.path);this.ke.get(c)!==null||this.it(a,c)||this.Ue(a,c,St.newNoDocument(c,e))}i.be&&(t.set(a,i.ve()),i.Ce())}});let r=Me();this.qe.forEach((i,a)=>{let l=!0;a.forEachWhile(c=>{const d=this.Je(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.ke.forEach((i,a)=>a.setReadTime(e));const s=new Oc(e,t,this.Qe,this.ke,r);return this.ke=Zn(),this.qe=Ex(),this.Qe=new wt(ke),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new _x,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ht(ke),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||X("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new _x),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Ex(){return new wt(ue.comparator)}function Tx(){return new wt(ue.comparator)}const y2=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),v2=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),x2=(()=>({and:"AND",or:"OR"}))();class b2{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function np(n,e){return n.useProto3Json||Rc(e)?e:{value:e}}function wo(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function DT(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function w2(n,e){return wo(n,e.toTimestamp())}function Qt(n){return ve(!!n),Te.fromTimestamp(function(t){const r=cs(t);return new Vt(r.seconds,r.nanos)}(n))}function Og(n,e){return rp(n,e).canonicalString()}function rp(n,e){const t=function(s){return new ze(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function MT(n){const e=ze.fromString(n);return ve(WT(e)),e}function gc(n,e){return Og(n.databaseId,e.path)}function Ur(n,e){const t=MT(e);if(t.get(1)!==n.databaseId.projectId)throw new Z(q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Z(q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ue(OT(t))}function VT(n,e){return Og(n.databaseId,e)}function LT(n){const e=MT(n);return e.length===4?ze.emptyPath():OT(e)}function sp(n){return new ze(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function OT(n){return ve(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Sx(n,e,t){return{name:gc(n,e),fields:t.value.mapValue.fields}}function FT(n,e,t){const r=Ur(n,e.name),s=Qt(e.updateTime),i=e.createTime?Qt(e.createTime):Te.min(),a=new bn({mapValue:{fields:e.fields}}),l=St.newFoundDocument(r,s,i,a);return t&&l.setHasCommittedMutations(),t?l.setHasCommittedMutations():l}function _2(n,e){return"found"in e?function(r,s){ve(!!s.found),s.found.name,s.found.updateTime;const i=Ur(r,s.found.name),a=Qt(s.found.updateTime),l=s.found.createTime?Qt(s.found.createTime):Te.min(),c=new bn({mapValue:{fields:s.found.fields}});return St.newFoundDocument(i,a,l,c)}(n,e):"missing"in e?function(r,s){ve(!!s.missing),ve(!!s.readTime);const i=Ur(r,s.missing),a=Qt(s.readTime);return St.newNoDocument(i,a)}(n,e):he()}function E2(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:he()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,h){return d.useProto3Json?(ve(h===void 0||typeof h=="string"),Bt.fromBase64String(h||"")):(ve(h===void 0||h instanceof Buffer||h instanceof Uint8Array),Bt.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(d){const h=d.code===void 0?q.UNKNOWN:kT(d.code);return new Z(h,d.message||"")}(a);t=new RT(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ur(n,r.document.name),i=Qt(r.document.updateTime),a=r.document.createTime?Qt(r.document.createTime):Te.min(),l=new bn({mapValue:{fields:r.document.fields}}),c=St.newFoundDocument(s,i,a,l),d=r.targetIds||[],h=r.removedTargetIds||[];t=new nd(d,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ur(n,r.document),i=r.readTime?Qt(r.readTime):Te.min(),a=St.newNoDocument(s,i),l=r.removedTargetIds||[];t=new nd([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ur(n,r.document),i=r.removedTargetIds||[];t=new nd([],i,s,null)}else{if(!("filter"in e))return he();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new f2(s,i),l=r.targetId;t=new jT(l,a)}}return t}function yc(n,e){let t;if(e instanceof $o)t={update:Sx(n,e.key,e.value)};else if(e instanceof Uo)t={delete:gc(n,e.key)};else if(e instanceof ws)t={update:Sx(n,e.key,e.data),updateMask:A2(e.fieldMask)};else{if(!(e instanceof Rg))return he();t={verify:gc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,a){const l=a.transform;if(l instanceof xo)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof sa)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof ia)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof bo)return{fieldPath:a.field.canonicalString(),increment:l.Pe};throw he()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:w2(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:he()}(n,e.precondition)),t}function ip(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Pt.updateTime(Qt(i.updateTime)):i.exists!==void 0?Pt.exists(i.exists):Pt.none()}(e.currentDocument):Pt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(a,l){let c=null;if("setToServerValue"in l)ve(l.setToServerValue==="REQUEST_TIME"),c=new xo;else if("appendMissingElements"in l){const h=l.appendMissingElements.values||[];c=new sa(h)}else if("removeAllFromArray"in l){const h=l.removeAllFromArray.values||[];c=new ia(h)}else"increment"in l?c=new bo(a,l.increment):he();const d=kt.fromServerFormat(l.fieldPath);return new Lc(d,c)}(n,s)):[];if(e.update){e.update.name;const s=Ur(n,e.update.name),i=new bn({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=function(c){const d=c.fieldPaths||[];return new Xn(d.map(h=>kt.fromServerFormat(h)))}(e.updateMask);return new ws(s,i,a,t,r)}return new $o(s,i,t,r)}if(e.delete){const s=Ur(n,e.delete);return new Uo(s,t)}if(e.verify){const s=Ur(n,e.verify);return new Rg(s,t)}return he()}function T2(n,e){return n&&n.length>0?(ve(e!==void 0),n.map(t=>function(s,i){let a=s.updateTime?Qt(s.updateTime):Qt(i);return a.isEqual(Te.min())&&(a=Qt(i)),new d2(a,s.transformResults||[])}(t,e))):[]}function $T(n,e){return{documents:[VT(n,e.path)]}}function Ch(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=VT(n,s);const i=function(d){if(d.length!==0)return qT(ct.create(d,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const a=function(d){if(d.length!==0)return d.map(h=>function(p){return{field:Us(p.field),direction:I2(p.dir)}}(h))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=np(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:t,parent:s}}function UT(n,e,t,r){const{_t:s,parent:i}=Ch(n,e),a={},l=[];let c=0;return t.forEach(d=>{const h=r?d.alias:"aggregate_"+c++;a[h]=d.alias,d.aggregateType==="count"?l.push({alias:h,count:{}}):d.aggregateType==="avg"?l.push({alias:h,avg:{field:Us(d.fieldPath)}}):d.aggregateType==="sum"&&l.push({alias:h,sum:{field:Us(d.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:l,structuredQuery:s.structuredQuery},parent:s.parent},ut:a,parent:i}}function BT(n){let e=LT(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){ve(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(m){const p=zT(m);return p instanceof ct&&Ag(p)?p.getFilters():[p]}(t.where));let a=[];t.orderBy&&(a=function(m){return m.map(p=>function(v){return new pc(Ra(v.field),function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(p))}(t.orderBy));let l=null;t.limit&&(l=function(m){let p;return p=typeof m=="object"?m.value:m,Rc(p)?null:p}(t.limit));let c=null;t.startAt&&(c=function(m){const p=!!m.before,y=m.values||[];return new hi(y,p)}(t.startAt));let d=null;return t.endAt&&(d=function(m){const p=!m.before,y=m.values||[];return new hi(y,p)}(t.endAt)),dT(e,s,a,i,l,"F",c,d)}function S2(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return he()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function zT(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Ra(t.unaryFilter.field);return qe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ra(t.unaryFilter.field);return qe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ra(t.unaryFilter.field);return qe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Ra(t.unaryFilter.field);return qe.create(a,"!=",{nullValue:"NULL_VALUE"});default:return he()}}(n):n.fieldFilter!==void 0?function(t){return qe.create(Ra(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return he()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ct.create(t.compositeFilter.filters.map(r=>zT(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return he()}}(t.compositeFilter.op))}(n):he()}function I2(n){return y2[n]}function N2(n){return v2[n]}function C2(n){return x2[n]}function Us(n){return{fieldPath:n.canonicalString()}}function Ra(n){return kt.fromServerFormat(n.fieldPath)}function qT(n){return n instanceof qe?function(t){if(t.op==="=="){if(lx(t.value))return{unaryFilter:{field:Us(t.field),op:"IS_NAN"}};if(ox(t.value))return{unaryFilter:{field:Us(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(lx(t.value))return{unaryFilter:{field:Us(t.field),op:"IS_NOT_NAN"}};if(ox(t.value))return{unaryFilter:{field:Us(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Us(t.field),op:N2(t.op),value:t.value}}}(n):n instanceof ct?function(t){const r=t.getFilters().map(s=>qT(s));return r.length===1?r[0]:{compositeFilter:{op:C2(t.op),filters:r}}}(n):he()}function A2(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function WT(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es{constructor(e,t,r,s,i=Te.min(),a=Te.min(),l=Bt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new es(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new es(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new es(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new es(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HT{constructor(e){this.ct=e}}function k2(n,e){let t;if(e.document)t=FT(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=ue.fromSegments(e.noDocument.path),s=oa(e.noDocument.readTime);t=St.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return he();{const r=ue.fromSegments(e.unknownDocument.path),s=oa(e.unknownDocument.version);t=St.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Vt(s[0],s[1]);return Te.fromTimestamp(i)}(e.readTime)),t}function Ix(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:qd(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,a){return{name:gc(i,a.key),fields:a.data.value.mapValue.fields,updateTime:wo(i,a.version.toTimestamp()),createTime:wo(i,a.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:aa(e.version)};else{if(!e.isUnknownDocument())return he();r.unknownDocument={path:t.path.toArray(),version:aa(e.version)}}return r}function qd(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function aa(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function oa(n){const e=new Vt(n.seconds,n.nanoseconds);return Te.fromTimestamp(e)}function Vi(n,e){const t=(e.baseMutations||[]).map(i=>ip(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const a=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const l=e.mutations[i+1];a.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>ip(n.ct,i)),s=Vt.fromMillis(e.localWriteTimeMs);return new Dg(e.batchId,s,t,r)}function Sl(n){const e=oa(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?oa(n.lastLimboFreeSnapshotVersion):Te.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return ve(i.documents.length===1),Vn(Fo(LT(i.documents[0])))}(n.query):function(i){return Vn(BT(i))}(n.query),new es(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Bt.fromBase64String(n.resumeToken))}function GT(n,e){const t=aa(e.snapshotVersion),r=aa(e.lastLimboFreeSnapshotVersion);let s;s=$d(e.target)?$T(n.ct,e.target):Ch(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ra(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Fg(n){const e=BT({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Bd(e,e.limit,"L"):e}function Mm(n,e){return new Vg(e.largestBatchId,ip(n.ct,e.overlayMutation))}function Nx(n,e){const t=e.path.lastSegment();return[n,Mn(e.path.popLast()),t]}function Cx(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:aa(r.readTime),documentKey:Mn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P2{getBundleMetadata(e,t){return Ax(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:oa(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Ax(e).put(function(s){return{bundleId:s.id,createTime:aa(Qt(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return kx(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Fg(i.bundledQuery),readTime:oa(i.readTime)}}(r)})}saveNamedQuery(e,t){return kx(e).put(function(s){return{name:s.name,readTime:aa(Qt(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Ax(n){return cn(n,"bundles")}function kx(n){return cn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Ah(e,r)}getOverlay(e,t){return dl(e).get(Nx(this.userId,t)).next(r=>r?Mm(this.serializer,r):null)}getOverlays(e,t){const r=Mr();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,a)=>{const l=new Vg(t,a);s.push(this.ht(e,l))}),O.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(a=>s.add(Mn(a.getCollectionPath())));const i=[];return s.forEach(a=>{const l=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);i.push(dl(e).j("collectionPathOverlayIndex",l))}),O.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Mr(),i=Mn(t),a=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return dl(e).U("collectionPathOverlayIndex",a).next(l=>{for(const c of l){const d=Mm(this.serializer,c);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Mr();let a;const l=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return dl(e).J({index:"collectionGroupOverlayIndex",range:l},(c,d,h)=>{const m=Mm(this.serializer,d);i.size()<s||m.largestBatchId===a?(i.set(m.getKey(),m),a=m.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return dl(e).put(function(s,i,a){const[l,c,d]=Nx(i,a.mutation.key);return{userId:i,collectionPath:c,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:yc(s.ct,a.mutation)}}(this.serializer,this.userId,t))}}function dl(n){return cn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j2{Pt(e){return cn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Bt.fromUint8Array(r):Bt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Li{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Ct(e.integerValue));else if("doubleValue"in e){const r=Ct(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),dc(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=cs(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(us(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?tT(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Sh(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):he()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const a="value",l=((s=(r=i[a].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(Ct(l)),this.Vt(a,t),this.Tt(i[a],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),ue.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Li.vt=new Li;function R2(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Px(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const a=R2(255&r[i]);if(s+=a,a!==8)break}return s}(n);return Math.ceil(e/8)}class D2{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=Px(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=Px(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class M2{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class V2{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class hl{constructor(){this.jt=new D2,this.Ht=new M2(this.jt),this.Jt=new V2(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Oi(this.indexId,this.documentKey,this.arrayValue,r)}}function As(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=jx(n.arrayValue,e.arrayValue),t!==0?t:(t=jx(n.directionalValue,e.directionalValue),t!==0?t:ue.comparator(n.documentKey,e.documentKey)))}function jx(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rx{constructor(e){this.Xt=new ht((t,r)=>kt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(ve(e.collectionGroup===this.collectionId),this.nn)return!1;const t=Kf(e);if(t!==void 0&&!this.sn(t))return!1;const r=Ri(e);let s=new Set,i=0,a=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const l=this.Xt.getIterator().getNext();if(!s.has(l.field.canonicalString())){const c=r[i];if(!this.on(l,c)||!this._n(this.en[a++],c))return!1}++i}for(;i<r.length;++i){const l=r[i];if(a>=this.en.length||!this._n(this.en[a++],l))return!1}return!0}an(){if(this.nn)return null;let e=new ht(kt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Hi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Hi(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Hi(r.field,r.dir==="asc"?0:1)));return new po(po.UNKNOWN_ID,this.collectionId,t,go.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KT(n){var e,t;if(ve(n instanceof qe||n instanceof ct),n instanceof qe){if(n instanceof uT){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>qe.create(n.field,"==",i)))||[];return ct.create(s,"or")}return n}const r=n.filters.map(s=>KT(s));return ct.create(r,n.op)}function L2(n){if(n.getFilters().length===0)return[];const e=lp(KT(n));return ve(QT(e)),ap(e)||op(e)?[e]:e.getFilters()}function ap(n){return n instanceof qe}function op(n){return n instanceof ct&&Ag(n)}function QT(n){return ap(n)||op(n)||function(t){if(t instanceof ct&&Xf(t)){for(const r of t.getFilters())if(!ap(r)&&!op(r))return!1;return!0}return!1}(n)}function lp(n){if(ve(n instanceof qe||n instanceof ct),n instanceof qe)return n;if(n.filters.length===1)return lp(n.filters[0]);const e=n.filters.map(r=>lp(r));let t=ct.create(e,n.op);return t=Wd(t),QT(t)?t:(ve(t instanceof ct),ve(vo(t)),ve(t.filters.length>1),t.filters.reduce((r,s)=>$g(r,s)))}function $g(n,e){let t;return ve(n instanceof qe||n instanceof ct),ve(e instanceof qe||e instanceof ct),t=n instanceof qe?e instanceof qe?function(s,i){return ct.create([s,i],"and")}(n,e):Dx(n,e):e instanceof qe?Dx(e,n):function(s,i){if(ve(s.filters.length>0&&i.filters.length>0),vo(s)&&vo(i))return oT(s,i.getFilters());const a=Xf(s)?s:i,l=Xf(s)?i:s,c=a.filters.map(d=>$g(d,l));return ct.create(c,"or")}(n,e),Wd(t)}function Dx(n,e){if(vo(e))return oT(e,n.getFilters());{const t=e.filters.map(r=>$g(n,r));return ct.create(t,"or")}}function Wd(n){if(ve(n instanceof qe||n instanceof ct),n instanceof qe)return n;const e=n.getFilters();if(e.length===1)return Wd(e[0]);if(iT(n))return n;const t=e.map(s=>Wd(s)),r=[];return t.forEach(s=>{s instanceof qe?r.push(s):s instanceof ct&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:ct.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O2{constructor(){this.un=new Ug}addToCollectionParentIndex(e,t){return this.un.add(t),O.resolve()}getCollectionParents(e,t){return O.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return O.resolve()}deleteFieldIndex(e,t){return O.resolve()}deleteAllFieldIndexes(e){return O.resolve()}createTargetIndexes(e,t){return O.resolve()}getDocumentsMatchingTarget(e,t){return O.resolve(null)}getIndexType(e,t){return O.resolve(0)}getFieldIndexes(e,t){return O.resolve([])}getNextCollectionGroupToUpdate(e){return O.resolve(null)}getMinOffset(e,t){return O.resolve(cr.min())}getMinOffsetFromCollectionGroup(e,t){return O.resolve(cr.min())}updateCollectionGroup(e,t,r){return O.resolve()}updateIndexEntries(e,t){return O.resolve()}}class Ug{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new ht(ze.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ht(ze.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nu=new Uint8Array(0);class F2{constructor(e,t){this.databaseId=t,this.cn=new Ug,this.ln=new bs(r=>ra(r),(r,s)=>Dc(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Mn(s)};return Mx(e).put(i)}return O.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[UE(t),""],!1,!0);return Mx(e).U(s).next(i=>{for(const a of i){if(a.collectionId!==t)break;r.push(Dr(a.parent))}return r})}addFieldIndex(e,t){const r=ml(e),s=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const a=Ca(e);return i.next(l=>{a.put(Cx(l,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=ml(e),s=Ca(e),i=Na(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=ml(e),r=Na(e),s=Ca(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return O.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Rx(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Na(e);let s=!0;const i=new Map;return O.forEach(this.hn(t),a=>this.Pn(e,a).next(l=>{s&&(s=!!l),i.set(a,l)})).next(()=>{if(s){let a=Me();const l=[];return O.forEach(i,(c,d)=>{X("IndexedDbIndexManager",`Using index ${function(C){return`id=${C.indexId}|cg=${C.collectionGroup}|f=${C.fields.map(k=>`${k.fieldPath}:${k.kind}`).join(",")}`}(c)} to execute ${ra(t)}`);const h=function(C,k){const M=Kf(k);if(M===void 0)return null;for(const F of Ud(C,M.fieldPath))switch(F.op){case"array-contains-any":return F.value.arrayValue.values||[];case"array-contains":return[F.value]}return null}(d,c),m=function(C,k){const M=new Map;for(const F of Ri(k))for(const w of Ud(C,F.fieldPath))switch(w.op){case"==":case"in":M.set(F.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return M.set(F.fieldPath.canonicalString(),w.value),Array.from(M.values())}return null}(d,c),p=function(C,k){const M=[];let F=!0;for(const w of Ri(k)){const b=w.kind===0?mx(C,w.fieldPath,C.startAt):fx(C,w.fieldPath,C.startAt);M.push(b.value),F&&(F=b.inclusive)}return new hi(M,F)}(d,c),y=function(C,k){const M=[];let F=!0;for(const w of Ri(k)){const b=w.kind===0?fx(C,w.fieldPath,C.endAt):mx(C,w.fieldPath,C.endAt);M.push(b.value),F&&(F=b.inclusive)}return new hi(M,F)}(d,c),v=this.In(c,d,p),S=this.In(c,d,y),E=this.Tn(c,d,m),_=this.En(c.indexId,h,v,p.inclusive,S,y.inclusive,E);return O.forEach(_,x=>r.G(x,t.limit).next(C=>{C.forEach(k=>{const M=ue.fromSegments(k.documentKey);a.has(M)||(a=a.add(M),l.push(M))})}))}).next(()=>l)}return O.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=L2(ct.create(e.filters,"and")).map(r=>ep(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,a,l){const c=(t!=null?t.length:1)*Math.max(r.length,i.length),d=c/(t!=null?t.length:1),h=[];for(let m=0;m<c;++m){const p=t?this.dn(t[m/d]):Nu,y=this.An(e,p,r[m%d],s),v=this.Rn(e,p,i[m%d],a),S=l.map(E=>this.An(e,p,E,!0));h.push(...this.createRange(y,v,S))}return h}An(e,t,r,s){const i=new Oi(e,ue.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Oi(e,ue.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new Rx(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let a=null;for(const l of i)r.rn(l)&&(!a||l.fields.length>a.fields.length)&&(a=l);return a})}getIndexType(e,t){let r=2;const s=this.hn(t);return O.forEach(s,i=>this.Pn(e,i).next(a=>{a?r!==0&&a.fields.length<function(c){let d=new ht(kt.comparator),h=!1;for(const m of c.filters)for(const p of m.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?h=!0:d=d.add(p.field));for(const m of c.orderBy)m.field.isKeyField()||(d=d.add(m.field));return d.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(a){return a.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new hl;for(const s of Ri(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const a=r.Yt(s.kind);Li.vt.It(i,a)}return r.zt()}dn(e){const t=new hl;return Li.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new hl;return Li.vt.It(na(this.databaseId,t),r.Yt(function(i){const a=Ri(i);return a.length===0?0:a[a.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new hl);let i=0;for(const a of Ri(e)){const l=r[i++];for(const c of s)if(this.fn(t,a.fieldPath)&&fc(l))s=this.gn(s,a,l);else{const d=c.Yt(a.kind);Li.vt.It(l,d)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const a of r.arrayValue.values||[])for(const l of s){const c=new hl;c.seed(l.zt()),Li.vt.It(a,c.Yt(t.kind)),i.push(c)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof qe&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=ml(e),s=Ca(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const a=[];return O.forEach(i,l=>s.get([l.indexId,this.uid]).next(c=>{a.push(function(h,m){const p=m?new go(m.sequenceNumber,new cr(oa(m.readTime),new ue(Dr(m.documentKey)),m.largestBatchId)):go.empty(),y=h.fields.map(([v,S])=>new Hi(kt.fromServerFormat(v),S));return new po(h.indexId,h.collectionGroup,y,p)}(l,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:ke(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=ml(e),i=Ca(e);return this.yn(e).next(a=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(l=>O.forEach(l,c=>i.put(Cx(c.indexId,this.uid,a,r)))))}updateIndexEntries(e,t){const r=new Map;return O.forEach(t,(s,i)=>{const a=r.get(s.collectionGroup);return(a?O.resolve(a):this.getFieldIndexes(e,s.collectionGroup)).next(l=>(r.set(s.collectionGroup,l),O.forEach(l,c=>this.wn(e,s,c).next(d=>{const h=this.Sn(i,c);return d.isEqual(h)?O.resolve():this.bn(e,i,c,d,h)}))))})}Dn(e,t,r,s){return Na(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Na(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Na(e);let i=new ht(As);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(a,l)=>{i=i.add(new Oi(r.indexId,t,l.arrayValue,l.directionalValue))}).next(()=>i)}Sn(e,t){let r=new ht(As);const s=this.Vn(t,e);if(s==null)return r;const i=Kf(t);if(i!=null){const a=e.data.field(i.fieldPath);if(fc(a))for(const l of a.arrayValue.values||[])r=r.add(new Oi(t.indexId,e.key,this.dn(l),s))}else r=r.add(new Oi(t.indexId,e.key,Nu,s));return r}bn(e,t,r,s,i){X("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(c,d,h,m,p){const y=c.getIterator(),v=d.getIterator();let S=Ia(y),E=Ia(v);for(;S||E;){let _=!1,x=!1;if(S&&E){const C=h(S,E);C<0?x=!0:C>0&&(_=!0)}else S!=null?x=!0:_=!0;_?(m(E),E=Ia(v)):x?(p(S),S=Ia(y)):(S=Ia(y),E=Ia(v))}}(s,i,As,l=>{a.push(this.Dn(e,t,r,l))},l=>{a.push(this.vn(e,t,r,l))}),O.waitFor(a)}yn(e){let t=1;return Ca(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((a,l)=>As(a,l)).filter((a,l,c)=>!l||As(a,c[l-1])!==0);const s=[];s.push(e);for(const a of r){const l=As(a,e),c=As(a,t);if(l===0)s[0]=e.Zt();else if(l>0&&c<0)s.push(a),s.push(a.Zt());else if(c>0)break}s.push(t);const i=[];for(let a=0;a<s.length;a+=2){if(this.Cn(s[a],s[a+1]))return[];const l=[s[a].indexId,this.uid,s[a].arrayValue,s[a].directionalValue,Nu,[]],c=[s[a+1].indexId,this.uid,s[a+1].arrayValue,s[a+1].directionalValue,Nu,[]];i.push(IDBKeyRange.bound(l,c))}return i}Cn(e,t){return As(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Vx)}getMinOffset(e,t){return O.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||he())).next(Vx)}}function Mx(n){return cn(n,"collectionParents")}function Na(n){return cn(n,"indexEntries")}function ml(n){return cn(n,"indexConfiguration")}function Ca(n){return cn(n,"indexState")}function Vx(n){ve(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Ig(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new cr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lx={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Rn{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Rn(e,Rn.DEFAULT_COLLECTION_PERCENTILE,Rn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YT(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],a=IDBKeyRange.only(t.batchId);let l=0;const c=r.J({range:a},(h,m,p)=>(l++,p.delete()));i.push(c.next(()=>{ve(l===1)}));const d=[];for(const h of t.mutations){const m=KE(e,h.key.path,t.batchId);i.push(s.delete(m)),d.push(h.key)}return O.waitFor(i).next(()=>d)}function Hd(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw he();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Rn.DEFAULT_COLLECTION_PERCENTILE=10,Rn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Rn.DEFAULT=new Rn(41943040,Rn.DEFAULT_COLLECTION_PERCENTILE,Rn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Rn.DISABLED=new Rn(-1,0,0);class kh{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){ve(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new kh(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ks(e).J({index:"userMutationsIndex",range:r},(s,i,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Da(e),a=ks(e);return a.add({}).next(l=>{ve(typeof l=="number");const c=new Dg(l,t,r,s),d=function(y,v,S){const E=S.baseMutations.map(x=>yc(y.ct,x)),_=S.mutations.map(x=>yc(y.ct,x));return{userId:v,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:E,mutations:_}}(this.serializer,this.userId,c),h=[];let m=new ht((p,y)=>ke(p.canonicalString(),y.canonicalString()));for(const p of s){const y=KE(this.userId,p.key.path,l);m=m.add(p.key.path.popLast()),h.push(a.put(d)),h.push(i.put(y,NR))}return m.forEach(p=>{h.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Fn[l]=c.keys()}),O.waitFor(h).next(()=>c)})}lookupMutationBatch(e,t){return ks(e).get(t).next(r=>r?(ve(r.userId===this.userId),Vi(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?O.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ks(e).J({index:"userMutationsIndex",range:s},(a,l,c)=>{l.userId===this.userId&&(ve(l.batchId>=r),i=Vi(this.serializer,l)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ks(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,a)=>{r=i.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ks(e).U("userMutationsIndex",t).next(r=>r.map(s=>Vi(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Ju(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Da(e).J({range:s},(a,l,c)=>{const[d,h,m]=a,p=Dr(h);if(d===this.userId&&t.path.isEqual(p))return ks(e).get(m).next(y=>{if(!y)throw he();ve(y.userId===this.userId),i.push(Vi(this.serializer,y))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ht(ke);const s=[];return t.forEach(i=>{const a=Ju(this.userId,i.path),l=IDBKeyRange.lowerBound(a),c=Da(e).J({range:l},(d,h,m)=>{const[p,y,v]=d,S=Dr(y);p===this.userId&&i.path.isEqual(S)?r=r.add(v):m.done()});s.push(c)}),O.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Ju(this.userId,r),a=IDBKeyRange.lowerBound(i);let l=new ht(ke);return Da(e).J({range:a},(c,d,h)=>{const[m,p,y]=c,v=Dr(p);m===this.userId&&r.isPrefixOf(v)?v.length===s&&(l=l.add(y)):h.done()}).next(()=>this.xn(e,l))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ks(e).get(i).next(a=>{if(a===null)throw he();ve(a.userId===this.userId),r.push(Vi(this.serializer,a))}))}),O.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return YT(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),O.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return O.resolve();const r=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return Da(e).J({range:r},(i,a,l)=>{if(i[0]===this.userId){const c=Dr(i[1]);s.push(c)}else l.done()}).next(()=>{ve(s.length===0)})})}containsKey(e,t){return JT(e,this.userId,t)}Nn(e){return XT(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function JT(n,e,t){const r=Ju(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let a=!1;return Da(n).J({range:i,H:!0},(l,c,d)=>{const[h,m,p]=l;h===e&&m===s&&(a=!0),d.done()}).next(()=>a)}function ks(n){return cn(n,"mutations")}function Da(n){return cn(n,"documentMutations")}function XT(n){return cn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new la(0)}static kn(){return new la(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $2{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new la(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Te.fromTimestamp(new Vt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Aa(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(ve(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Aa(e).J((a,l)=>{const c=Sl(l);c.sequenceNumber<=t&&r.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>O.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Aa(e).J((r,s)=>{const i=Sl(s);t(i)})}qn(e){return Ox(e).get("targetGlobalKey").next(t=>(ve(t!==null),t))}Qn(e,t){return Ox(e).put("targetGlobalKey",t)}Kn(e,t){return Aa(e).put(GT(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=ra(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Aa(e).J({range:s,index:"queryTargetsIndex"},(a,l,c)=>{const d=Sl(l);Dc(t,d.target)&&(i=d,c.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Bs(e);return t.forEach(a=>{const l=Mn(a.path);s.push(i.put({targetId:r,path:l})),s.push(this.referenceDelegate.addReference(e,r,a))}),O.waitFor(s)}removeMatchingKeys(e,t,r){const s=Bs(e);return O.forEach(t,i=>{const a=Mn(i.path);return O.waitFor([s.delete([r,a]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Bs(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Bs(e);let i=Me();return s.J({range:r,H:!0},(a,l,c)=>{const d=Dr(a[1]),h=new ue(d);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=Mn(t.path),s=IDBKeyRange.bound([r],[UE(r)],!1,!0);let i=0;return Bs(e).J({index:"documentTargetsIndex",H:!0,range:s},([a,l],c,d)=>{a!==0&&(i++,d.done())}).next(()=>i>0)}ot(e,t){return Aa(e).get(t).next(r=>r?Sl(r):null)}}function Aa(n){return cn(n,"targets")}function Ox(n){return cn(n,"targetGlobal")}function Bs(n){return cn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fx([n,e],[t,r]){const s=ke(n,t);return s===0?ke(e,r):s}class U2{constructor(e){this.Un=e,this.buffer=new ht(Fx),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Fx(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ZT{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){X("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){wi(t)?X("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await bi(t)}await this.Hn(3e5)})}}class B2{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return O.resolve(Jn.oe);const r=new U2(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(X("LruGarbageCollector","Garbage collection skipped; disabled"),O.resolve(Lx)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(X("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Lx):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,a,l,c,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(X("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,a=Date.now(),this.nthSequenceNumber(e,s))).next(m=>(r=m,l=Date.now(),this.removeTargets(e,r,t))).next(m=>(i=m,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>(d=Date.now(),Pa()<=Be.DEBUG&&X("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${i} targets in `+(c-l)+`ms
	Removed ${m} documents in `+(d-c)+`ms
Total Duration: ${d-h}ms`),O.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:m})))}}function eS(n,e){return new B2(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z2{constructor(e,t){this.db=e,this.garbageCollector=eS(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Cu(e,r)}removeReference(e,t,r){return Cu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Cu(e,t)}nr(e,t){return function(s,i){let a=!1;return XT(s).Y(l=>JT(s,l,i).next(c=>(c&&(a=!0),O.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(a,l)=>{if(l<=t){const c=this.nr(e,a).next(d=>{if(!d)return i++,r.getEntry(e,a).next(()=>(r.removeEntry(a,Te.min()),Bs(e).delete(function(m){return[0,Mn(m.path)]}(a))))});s.push(c)}}).next(()=>O.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Cu(e,t)}tr(e,t){const r=Bs(e);let s,i=Jn.oe;return r.J({index:"documentTargetsIndex"},([a,l],{path:c,sequenceNumber:d})=>{a===0?(i!==Jn.oe&&t(new ue(Dr(s)),i),i=d,s=c):i=Jn.oe}).next(()=>{i!==Jn.oe&&t(new ue(Dr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Cu(n,e){return Bs(n).put(function(r,s){return{targetId:0,path:Mn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tS{constructor(){this.changes=new bs(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,St.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?O.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q2{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ci(e).put(r)}removeEntry(e,t,r){return Ci(e).delete(function(i,a){const l=i.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],qd(a),l[l.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=St.newInvalidDocument(t);return Ci(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(fl(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:St.newInvalidDocument(t)};return Ci(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(fl(t))},(s,i)=>{r={document:this.ir(t,i),size:Hd(i)}}).next(()=>r)}getEntries(e,t){let r=Zn();return this._r(e,t,(s,i)=>{const a=this.ir(s,i);r=r.insert(s,a)}).next(()=>r)}ar(e,t){let r=Zn(),s=new wt(ue.comparator);return this._r(e,t,(i,a)=>{const l=this.ir(i,a);r=r.insert(i,l),s=s.insert(i,Hd(a))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return O.resolve();let s=new ht(Bx);t.forEach(c=>s=s.add(c));const i=IDBKeyRange.bound(fl(s.first()),fl(s.last())),a=s.getIterator();let l=a.getNext();return Ci(e).J({index:"documentKeyIndex",range:i},(c,d,h)=>{const m=ue.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;l&&Bx(l,m)<0;)r(l,null),l=a.getNext();l&&l.isEqual(m)&&(r(l,d),l=a.hasNext()?a.getNext():null),l?h.$(fl(l)):h.done()}).next(()=>{for(;l;)r(l,null),l=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const a=t.path,l=[a.popLast().toArray(),a.lastSegment(),qd(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ci(e).U(IDBKeyRange.bound(l,c,!0)).next(d=>{i==null||i.incrementDocumentReadCount(d.length);let h=Zn();for(const m of d){const p=this.ir(ue.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);p.isFoundDocument()&&(Vc(t,p)||s.has(p.key))&&(h=h.insert(p.key,p))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=Zn();const a=Ux(t,r),l=Ux(t,cr.max());return Ci(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,l,!0)},(c,d,h)=>{const m=this.ir(ue.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(m.key,m),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new W2(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return $x(e).get("remoteDocumentGlobalKey").next(t=>(ve(!!t),t))}rr(e,t){return $x(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=k2(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Te.min())))return r}return St.newInvalidDocument(e)}}function nS(n){return new q2(n)}class W2 extends tS{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new bs(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new ht((i,a)=>ke(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{const l=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,l.readTime)),a.isValidDocument()){const c=Ix(this.cr.serializer,a);s=s.add(i.path.popLast());const d=Hd(c);r+=d-l.size,t.push(this.cr.addEntry(e,i,c))}else if(r-=l.size,this.trackRemovals){const c=Ix(this.cr.serializer,a.convertToNoDocument(Te.min()));t.push(this.cr.addEntry(e,i,c))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),O.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,a)=>{this.lr.set(i,{size:a,readTime:r.get(i).readTime})}),r))}}function $x(n){return cn(n,"remoteDocumentGlobal")}function Ci(n){return cn(n,"remoteDocumentsV14")}function fl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Ux(n,e){const t=e.documentKey.path.toArray();return[n,qd(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Bx(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=ke(t[i],r[i]),s)return s;return s=ke(t.length,r.length),s||(s=ke(t[t.length-2],r[r.length-2]),s||ke(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H2{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rS{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Fl(r.mutation,s,Xn.empty(),Vt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Me()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Me()){const s=Mr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let a=El();return i.forEach((l,c)=>{a=a.insert(l,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=Mr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Me()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,l)=>{t.set(a,l)})})}computeViews(e,t,r,s){let i=Zn();const a=Ol(),l=function(){return Ol()}();return t.forEach((c,d)=>{const h=r.get(d.key);s.has(d.key)&&(h===void 0||h.mutation instanceof ws)?i=i.insert(d.key,d):h!==void 0?(a.set(d.key,h.mutation.getFieldMask()),Fl(h.mutation,d,h.mutation.getFieldMask(),Vt.now())):a.set(d.key,Xn.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((d,h)=>a.set(d,h)),t.forEach((d,h)=>{var m;return l.set(d,new H2(h,(m=a.get(d))!==null&&m!==void 0?m:null))}),l))}recalculateAndSaveOverlays(e,t){const r=Ol();let s=new wt((a,l)=>a-l),i=Me();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const l of a)l.keys().forEach(c=>{const d=t.get(c);if(d===null)return;let h=r.get(c)||Xn.empty();h=l.applyToLocalView(d,h),r.set(c,h);const m=(s.get(l.batchId)||Me()).add(c);s=s.insert(l.batchId,m)})}).next(()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),d=c.key,h=c.value,m=xT();h.forEach(p=>{if(!i.has(p)){const y=IT(t.get(p),r.get(p));y!==null&&m.set(p,y),i=i.add(p)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,m))}return O.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(a){return ue.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):kg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):O.resolve(Mr());let l=-1,c=i;return a.next(d=>O.forEach(d,(h,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),i.get(h)?O.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{c=c.insert(h,p)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,c,d,Me())).next(h=>({batchId:l,changes:vT(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ue(t)).next(r=>{let s=El();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=El();return this.indexManager.getCollectionParents(e,i).next(l=>O.forEach(l,c=>{const d=function(m,p){return new xs(p,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(h=>{h.forEach((m,p)=>{a=a.insert(m,p)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(a=>{i.forEach((c,d)=>{const h=d.getKey();a.get(h)===null&&(a=a.insert(h,St.newInvalidDocument(h)))});let l=El();return a.forEach((c,d)=>{const h=i.get(c);h!==void 0&&Fl(h.mutation,d,Xn.empty(),Vt.now()),Vc(t,d)&&(l=l.insert(c,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G2{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return O.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Qt(s.createTime)}}(t)),O.resolve()}getNamedQuery(e,t){return O.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Fg(s.bundledQuery),readTime:Qt(s.readTime)}}(t)),O.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K2{constructor(){this.overlays=new wt(ue.comparator),this.Ir=new Map}getOverlay(e,t){return O.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Mr();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),O.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),O.resolve()}getOverlaysForCollection(e,t,r){const s=Mr(),i=t.length+1,a=new ue(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const c=l.getNext().value,d=c.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return O.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new wt((d,h)=>d-h);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let h=i.get(d.largestBatchId);h===null&&(h=Mr(),i=i.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const l=Mr(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,h)=>l.set(d,h)),!(l.size()>=s)););return O.resolve(l)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Vg(t,r));let i=this.Ir.get(t);i===void 0&&(i=Me(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q2{constructor(){this.sessionToken=Bt.EMPTY_BYTE_STRING}getSessionToken(e){return O.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,O.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{constructor(){this.Tr=new ht(dn.Er),this.dr=new ht(dn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new dn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new dn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new ue(new ze([])),r=new dn(t,e),s=new dn(t,e+1),i=[];return this.dr.forEachInRange([r,s],a=>{this.Vr(a),i.push(a.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new ue(new ze([])),r=new dn(t,e),s=new dn(t,e+1);let i=Me();return this.dr.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){const t=new dn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class dn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return ue.comparator(e.key,t.key)||ke(e.wr,t.wr)}static Ar(e,t){return ke(e.wr,t.wr)||ue.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y2{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new ht(dn.Er)}checkEmpty(e){return O.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Dg(i,t,r,s);this.mutationQueue.push(a);for(const l of s)this.br=this.br.add(new dn(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return O.resolve(a)}lookupMutationBatch(e,t){return O.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return O.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return O.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return O.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new dn(t,0),s=new dn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],a=>{const l=this.Dr(a.wr);i.push(l)}),O.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ht(ke);return t.forEach(s=>{const i=new dn(s,0),a=new dn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,a],l=>{r=r.add(l.wr)})}),O.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;ue.isDocumentKey(i)||(i=i.child(""));const a=new dn(new ue(i),0);let l=new ht(ke);return this.br.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(c.wr)),!0)},a),O.resolve(this.Cr(l))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){ve(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return O.forEach(t.mutations,s=>{const i=new dn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new dn(t,0),s=this.br.firstAfterOrEqual(r);return O.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,O.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J2{constructor(e){this.Mr=e,this.docs=function(){return new wt(ue.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return O.resolve(r?r.document.mutableCopy():St.newInvalidDocument(t))}getEntries(e,t){let r=Zn();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():St.newInvalidDocument(s))}),O.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Zn();const a=t.path,l=new ue(a.child("")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:d,value:{document:h}}=c.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Ig(zE(h),r)<=0||(s.has(h.key)||Vc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return O.resolve(i)}getAllFromCollectionGroup(e,t,r,s){he()}Or(e,t){return O.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new X2(this)}getSize(e){return O.resolve(this.size)}}class X2 extends tS{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),O.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z2{constructor(e){this.persistence=e,this.Nr=new bs(t=>ra(t),Dc),this.lastRemoteSnapshotVersion=Te.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Bg,this.targetCount=0,this.kr=la.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),O.resolve()}getLastRemoteSnapshotVersion(e){return O.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return O.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),O.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),O.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new la(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,O.resolve()}updateTargetData(e,t){return this.Kn(t),O.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,O.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),O.waitFor(i).next(()=>s)}getTargetCount(e){return O.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return O.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),O.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),O.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),O.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return O.resolve(r)}containsKey(e,t){return O.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Jn(0),this.Kr=!1,this.Kr=!0,this.$r=new Q2,this.referenceDelegate=e(this),this.Ur=new Z2(this),this.indexManager=new O2,this.remoteDocumentCache=function(s){return new J2(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new HT(t),this.Gr=new G2(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new K2,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new Y2(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){X("MemoryPersistence","Starting transaction:",e);const s=new eD(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return O.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class eD extends WE{constructor(e){super(),this.currentSequenceNumber=e}}class Ph{constructor(e){this.persistence=e,this.Jr=new Bg,this.Yr=null}static Zr(e){return new Ph(e)}get Xr(){if(this.Yr)return this.Yr;throw he()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),O.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),O.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),O.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.Xr,r=>{const s=ue.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Te.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return O.or([()=>O.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Gd{constructor(e,t){this.persistence=e,this.ti=new bs(r=>Mn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=eS(this,t)}static Zr(e,t){return new Gd(e,t)}zr(){}jr(e){return O.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return O.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?O.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,a=>this.nr(e,a,t).next(l=>{l||(r++,i.removeEntry(a,Te.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),O.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),O.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),O.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),O.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Zu(e.data.value)),t}nr(e,t,r){return O.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return O.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tD{constructor(e){this.serializer=e}O(e,t,r,s){const i=new _h("createOrUpgrade",t);r<1&&s>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",nx,{unique:!0}),c.createObjectStore("documentMutations")}(e),zx(e),function(c){c.createObjectStore("remoteDocuments")}(e));let a=O.resolve();return r<3&&s>=3&&(r!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),zx(e)),a=a.next(()=>function(c){const d=c.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Te.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",h)}(i))),r<4&&s>=4&&(r!==0&&(a=a.next(()=>function(c,d){return d.store("mutations").U().next(h=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",nx,{unique:!0});const m=d.store("mutations"),p=h.map(y=>m.put(y));return O.waitFor(p)})}(e,i))),a=a.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(a=a.next(()=>this.ni(i))),r<6&&s>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(a=a.next(()=>this.ii(i))),r<8&&s>=8&&(a=a.next(()=>this.si(e,i))),r<9&&s>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(a=a.next(()=>this.oi(i))),r<11&&s>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(a=a.next(()=>{(function(c){const d=c.createObjectStore("documentOverlays",{keyPath:FR});d.createIndex("collectionPathOverlayIndex",$R,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",UR,{unique:!1})})(e)})),r<13&&s>=13&&(a=a.next(()=>function(c){const d=c.createObjectStore("remoteDocumentsV14",{keyPath:CR});d.createIndex("documentKeyIndex",AR),d.createIndex("collectionGroupIndex",kR)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(a=a.next(()=>this.ai(e,i))),r<15&&s>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:MR}).createIndex("sequenceNumberIndex",VR,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:LR}).createIndex("documentKeyIndex",OR,{unique:!1})}(e))),r<16&&s>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(a=a.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),a}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Hd(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>O.forEach(s,i=>{const a=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",a).next(l=>O.forEach(l,c=>{ve(c.userId===i.userId);const d=Vi(this.serializer,c);return YT(e,i.userId,d).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((a,l)=>{const c=new ze(a),d=function(m){return[0,Mn(m)]}(c);i.push(t.get(d).next(h=>h?O.resolve():(m=>t.put({targetId:0,path:Mn(m),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>O.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:DR});const r=t.store("collectionParents"),s=new Ug,i=a=>{if(s.add(a)){const l=a.lastSegment(),c=a.popLast();return r.put({collectionId:l,parent:Mn(c)})}};return t.store("remoteDocuments").J({H:!0},(a,l)=>{const c=new ze(a);return i(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,l,c],d)=>{const h=Dr(l);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=Sl(s),a=GT(this.serializer,i);return t.put(a)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,a)=>{const l=t.store("remoteDocumentsV14"),c=function(m){return m.document?new ue(ze.fromString(m.document.name).popFirst(5)):m.noDocument?ue.fromSegments(m.noDocument.path):m.unknownDocument?ue.fromSegments(m.unknownDocument.path):he()}(a).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(l.put(d))}).next(()=>O.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=nS(this.serializer),i=new zg(Ph.Zr,this.serializer.ct);return r.U().next(a=>{const l=new Map;return a.forEach(c=>{var d;let h=(d=l.get(c.userId))!==null&&d!==void 0?d:Me();Vi(this.serializer,c).keys().forEach(m=>h=h.add(m)),l.set(c.userId,h)}),O.forEach(l,(c,d)=>{const h=new mn(d),m=Ah.lt(this.serializer,h),p=i.getIndexManager(h),y=kh.lt(h,this.serializer,p,i.referenceDelegate);return new rS(s,y,m,p).recalculateAndSaveOverlaysForDocumentKeys(new Qf(t,Jn.oe),c).next()})})}}function zx(n){n.createObjectStore("targetDocuments",{keyPath:jR}).createIndex("documentTargetsIndex",RR,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",PR,{unique:!0}),n.createObjectStore("targetGlobal")}const Vm="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class qg{constructor(e,t,r,s,i,a,l,c,d,h,m=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=a,this.document=l,this.ci=d,this.li=h,this.hi=m,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=p=>Promise.resolve(),!qg.D())throw new Z(q.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new z2(this,s),this.Ai=t+"main",this.serializer=new HT(c),this.Ri=new $r(this.Ai,this.hi,new tD(this.serializer)),this.$r=new j2,this.Ur=new $2(this.referenceDelegate,this.serializer),this.remoteDocumentCache=nS(this.serializer),this.Gr=new P2,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&Gt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Z(q.FAILED_PRECONDITION,Vm);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Jn(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Au(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(wi(e))return X("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return X("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return pl(e).get("owner").next(t=>O.resolve(this.vi(t)))}Ci(e){return Au(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=cn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),a=s.filter(l=>i.indexOf(l)===-1);return O.forEach(a,l=>r.delete(l.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?O.resolve(!0):pl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new Z(q.FAILED_PRECONDITION,Vm);return!1}}return!(!this.networkEnabled||!this.inForeground)||Au(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,l=this.networkEnabled===s.networkEnabled;if(i||a&&l)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&X("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Qf(e,Jn.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Au(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return kh.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new F2(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Ah.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){X("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(c){return c===17?qR:c===16?zR:c===15?Cg:c===14?JE:c===13?YE:c===12?BR:c===11?QE:void he()}(this.hi);let a;return this.Ri.runTransaction(e,s,i,l=>(a=new Qf(l,this.Qr?this.Qr.next():Jn.oe),t==="readwrite-primary"?this.wi(a).next(c=>!!c||this.Si(a)).next(c=>{if(!c)throw Gt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new Z(q.FAILED_PRECONDITION,qE);return r(a)}).next(c=>this.Di(a).next(()=>c)):this.Ki(a).next(()=>r(a)))).then(l=>(a.raiseOnCommittedEvent(),l))}Ki(e){return pl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Z(q.FAILED_PRECONDITION,Vm)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return pl(e).put("owner",t)}static D(){return $r.D()}bi(e){const t=pl(e);return t.get("owner").next(r=>this.vi(r)?(X("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):O.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Gt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;B_()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return X("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Gt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Gt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function pl(n){return cn(n,"owner")}function Au(n){return cn(n,"clientMetadata")}function Wg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hg{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Me(),s=Me();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Hg(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nD{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sS{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return B_()?8:HE(on())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new nD;return this.Xi(e,t,a).next(l=>{if(i.result=l,this.zi)return this.es(e,t,a,l.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Pa()<=Be.DEBUG&&X("QueryEngine","SDK will not create cache indexes for query:",ja(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),O.resolve()):(Pa()<=Be.DEBUG&&X("QueryEngine","Query:",ja(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Pa()<=Be.DEBUG&&X("QueryEngine","The SDK decides to create cache indexes for query:",ja(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Vn(t))):O.resolve())}Yi(e,t){if(px(t))return O.resolve(null);let r=Vn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Bd(t,null,"F"),r=Vn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const a=Me(...i);return this.Ji.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.ts(t,l);return this.ns(t,d,a,c.readTime)?this.Yi(e,Bd(t,null,"F")):this.rs(e,d,t,c)}))})))}Zi(e,t,r,s){return px(t)||s.isEqual(Te.min())?O.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const a=this.ts(t,i);return this.ns(t,a,r,s)?O.resolve(null):(Pa()<=Be.DEBUG&&X("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ja(t)),this.rs(e,a,t,BE(s,-1)).next(l=>l))})}ts(e,t){let r=new ht(gT(e));return t.forEach((s,i)=>{Vc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Pa()<=Be.DEBUG&&X("QueryEngine","Using full collection scan to execute query:",ja(t)),this.Ji.getDocumentsMatchingQuery(e,t,cr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rD{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new wt(ke),this._s=new bs(i=>ra(i),Dc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new rS(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function iS(n,e,t,r){return new rD(n,e,t,r)}async function aS(n,e){const t=oe(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const a=[],l=[];let c=Me();for(const d of s){a.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}for(const d of i){l.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(r,c).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:l}))})})}function sD(n,e){const t=oe(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(l,c,d,h){const m=d.batch,p=m.keys();let y=O.resolve();return p.forEach(v=>{y=y.next(()=>h.getEntry(c,v)).next(S=>{const E=d.docVersions.get(v);ve(E!==null),S.version.compareTo(E)<0&&(m.applyToRemoteDocument(S,d),S.isValidDocument()&&(S.setReadTime(d.commitVersion),h.addEntry(S)))})}),y.next(()=>l.mutationQueue.removeMutationBatch(c,m))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let c=Me();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(c=c.add(l.batch.mutations[d].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function oS(n){const e=oe(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function iD(n,e){const t=oe(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const l=[];e.targetChanges.forEach((h,m)=>{const p=s.get(m);if(!p)return;l.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,m).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,m)));let y=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?y=y.withResumeToken(Bt.EMPTY_BYTE_STRING,Te.min()).withLastLimboFreeSnapshotVersion(Te.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(m,y),function(S,E,_){return S.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:_.addedDocuments.size+_.modifiedDocuments.size+_.removedDocuments.size>0}(p,y,h)&&l.push(t.Ur.updateTargetData(i,y))});let c=Zn(),d=Me();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),l.push(lS(i,a,e.documentUpdates).next(h=>{c=h.Ps,d=h.Is})),!r.isEqual(Te.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(m=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(h)}return O.waitFor(l).next(()=>a.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,c,d)).next(()=>c)}).then(i=>(t.os=s,i))}function lS(n,e,t){let r=Me(),s=Me();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let a=Zn();return t.forEach((l,c)=>{const d=i.get(l);c.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),c.isNoDocument()&&c.version.isEqual(Te.min())?(e.removeEntry(l,c.readTime),a=a.insert(l,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),a=a.insert(l,c)):X("LocalStore","Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",c.version)}),{Ps:a,Is:s}})}function aD(n,e){const t=oe(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function _o(n,e){const t=oe(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,O.resolve(s)):t.Ur.allocateTargetId(r).next(a=>(s=new es(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Eo(n,e,t){const r=oe(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!wi(a))throw a;X("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Kd(n,e,t){const r=oe(n);let s=Te.min(),i=Me();return r.persistence.runTransaction("Execute query","readwrite",a=>function(c,d,h){const m=oe(c),p=m._s.get(h);return p!==void 0?O.resolve(m.os.get(p)):m.Ur.getTargetData(d,h)}(r,a,Vn(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,l.targetId).next(c=>{i=c})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,t?s:Te.min(),t?i:Me())).next(l=>(dS(r,pT(e),l),{documents:l,Ts:i})))}function cS(n,e){const t=oe(n),r=oe(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(a=>a?a.target:null))}function uS(n,e){const t=oe(n),r=t.us.get(e)||Te.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,BE(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(dS(t,e,s),s))}function dS(n,e,t){let r=n.us.get(e)||Te.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function oD(n,e,t,r){const s=oe(n);let i=Me(),a=Zn();for(const d of t){const h=e.Es(d.metadata.name);d.document&&(i=i.add(h));const m=e.ds(d);m.setReadTime(e.As(d.metadata.readTime)),a=a.insert(h,m)}const l=s.cs.newChangeBuffer({trackRemovals:!0}),c=await _o(s,function(h){return Vn(Fo(ze.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",d=>lS(d,l,a).next(h=>(l.apply(d),h)).next(h=>s.Ur.removeMatchingKeysForTargetId(d,c.targetId).next(()=>s.Ur.addMatchingKeys(d,i,c.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,h.Ps,h.Is)).next(()=>h.Ps)))}async function lD(n,e,t=Me()){const r=await _o(n,Vn(Fg(e.bundledQuery))),s=oe(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const a=Qt(e.readTime);if(r.snapshotVersion.compareTo(a)>=0)return s.Gr.saveNamedQuery(i,e);const l=r.withResumeToken(Bt.EMPTY_BYTE_STRING,a);return s.os=s.os.insert(l.targetId,l),s.Ur.updateTargetData(i,l).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function qx(n,e){return`firestore_clients_${n}_${e}`}function Wx(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Lm(n,e){return`firestore_targets_${n}_${e}`}class Qd{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,a=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return a&&s.error&&(a=typeof s.error.message=="string"&&typeof s.error.code=="string",a&&(i=new Z(s.error.code,s.error.message))),a?new Qd(e,t,s.state,i):(Gt("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class $l{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new Z(r.error.code,r.error.message))),i?new $l(e,r.state,s):(Gt("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Yd{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Pg();for(let a=0;s&&a<r.activeTargetIds.length;++a)s=GE(r.activeTargetIds[a]),i=i.add(r.activeTargetIds[a]);return s?new Yd(e,i):(Gt("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Gg{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Gg(t.clientId,t.onlineState):(Gt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class cp{constructor(){this.activeTargetIds=Pg()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Om{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new wt(ke),this.started=!1,this.bs=[];const a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=qx(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new cp),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(qx(this.persistenceKey,r));if(s){const i=Yd.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Lm(this.persistenceKey,e));if(s){const i=$l.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Lm(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return X("SharedClientState","READ",e,t),t}setItem(e,t){X("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){X("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(X("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Gt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let a=Jn.oe;if(i!=null)try{const l=JSON.parse(i);ve(typeof l=="number"),a=l}catch(l){Gt("SharedClientState","Failed to read sequence number from WebStorage",l)}return a}(t.newValue);r!==Jn.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Qd(this.currentUser,e,t,r),i=Wx(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=Wx(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Lm(this.persistenceKey,e),i=new $l(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Yd.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Qd.Rs(new mn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return $l.Rs(s,t)}Ls(e){return Gg.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);X("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),a=[],l=[];return i.forEach(c=>{s.has(c)||a.push(c)}),s.forEach(c=>{i.has(c)||l.push(c)}),this.syncEngine.io(a,l).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Pg();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class hS{constructor(){this.so=new cp,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new cp,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cD{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hx{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){X("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){X("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ku=null;function Fm(){return ku===null?ku=function(){return 268435456+Math.round(2147483648*Math.random())}():ku++,"0x"+ku.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uD={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dD{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jn="WebChannelConnection";class hD extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,a){const l=Fm(),c=this.xo(t,r.toUriEncodedString());X("RestConnection",`Sending RPC '${t}' ${l}:`,c,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,i,a),this.No(t,c,d,s).then(h=>(X("RestConnection",`Received RPC '${t}' ${l}: `,h),h),h=>{throw xr("RestConnection",`RPC '${t}' ${l} failed with error: `,h,"url: ",c,"request:",s),h})}Lo(t,r,s,i,a,l){return this.Mo(t,r,s,i,a)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Oo}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,a)=>t[a]=i),s&&s.headers.forEach((i,a)=>t[a]=i)}xo(t,r){const s=uD[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Fm();return new Promise((a,l)=>{const c=new RE;c.setWithCredentials(!0),c.listenOnce(DE.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Yu.NO_ERROR:const h=c.getResponseJson();X(jn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),a(h);break;case Yu.TIMEOUT:X(jn,`RPC '${e}' ${i} timed out`),l(new Z(q.DEADLINE_EXCEEDED,"Request time out"));break;case Yu.HTTP_ERROR:const m=c.getStatus();if(X(jn,`RPC '${e}' ${i} failed with status:`,m,"response text:",c.getResponseText()),m>0){let p=c.getResponseJson();Array.isArray(p)&&(p=p[0]);const y=p==null?void 0:p.error;if(y&&y.status&&y.message){const v=function(E){const _=E.toLowerCase().replace(/_/g,"-");return Object.values(q).indexOf(_)>=0?_:q.UNKNOWN}(y.status);l(new Z(v,y.message))}else l(new Z(q.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new Z(q.UNAVAILABLE,"Connection failed."));break;default:he()}}finally{X(jn,`RPC '${e}' ${i} completed.`)}});const d=JSON.stringify(s);X(jn,`RPC '${e}' ${i} sending request:`,s),c.send(t,"POST",d,r,15)})}Bo(e,t,r){const s=Fm(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=LE(),l=VE(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const h=i.join("");X(jn,`Creating RPC '${e}' stream ${s}: ${h}`,c);const m=a.createWebChannel(h,c);let p=!1,y=!1;const v=new dD({Io:E=>{y?X(jn,`Not sending because RPC '${e}' stream ${s} is closed:`,E):(p||(X(jn,`Opening RPC '${e}' stream ${s} transport.`),m.open(),p=!0),X(jn,`RPC '${e}' stream ${s} sending:`,E),m.send(E))},To:()=>m.close()}),S=(E,_,x)=>{E.listen(_,C=>{try{x(C)}catch(k){setTimeout(()=>{throw k},0)}})};return S(m,_l.EventType.OPEN,()=>{y||(X(jn,`RPC '${e}' stream ${s} transport opened.`),v.yo())}),S(m,_l.EventType.CLOSE,()=>{y||(y=!0,X(jn,`RPC '${e}' stream ${s} transport closed`),v.So())}),S(m,_l.EventType.ERROR,E=>{y||(y=!0,xr(jn,`RPC '${e}' stream ${s} transport errored:`,E),v.So(new Z(q.UNAVAILABLE,"The operation could not be completed")))}),S(m,_l.EventType.MESSAGE,E=>{var _;if(!y){const x=E.data[0];ve(!!x);const C=x,k=C.error||((_=C[0])===null||_===void 0?void 0:_.error);if(k){X(jn,`RPC '${e}' stream ${s} received error:`,k);const M=k.status;let F=function(N){const A=tn[N];if(A!==void 0)return kT(A)}(M),w=k.message;F===void 0&&(F=q.INTERNAL,w="Unknown error status: "+M+" with message "+k.message),y=!0,v.So(new Z(F,w)),m.close()}else X(jn,`RPC '${e}' stream ${s} received:`,x),v.bo(x)}}),S(l,ME.STAT_EVENT,E=>{E.stat===Gf.PROXY?X(jn,`RPC '${e}' stream ${s} detected buffering proxy`):E.stat===Gf.NOPROXY&&X(jn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{v.wo()},0),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mS(){return typeof window<"u"?window:null}function rd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $c(n){return new b2(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kg{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&X("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fS{constructor(e,t,r,s,i,a,l,c){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Kg(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===q.RESOURCE_EXHAUSTED?(Gt(t.toString()),Gt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new Z(q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return X("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(X("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class mD extends fS{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=E2(this.serializer,e),r=function(i){if(!("targetChange"in i))return Te.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?Te.min():a.readTime?Qt(a.readTime):Te.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=sp(this.serializer),t.addTarget=function(i,a){let l;const c=a.target;if(l=$d(c)?{documents:$T(i,c)}:{query:Ch(i,c)._t},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=DT(i,a.resumeToken);const d=np(i,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(Te.min())>0){l.readTime=wo(i,a.snapshotVersion.toTimestamp());const d=np(i,a.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=S2(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=sp(this.serializer),t.removeTarget=e,this.a_(t)}}class fD extends fS{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return ve(!!e.streamToken),this.lastStreamToken=e.streamToken,ve(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){ve(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=T2(e.writeResults,e.commitTime),r=Qt(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=sp(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>yc(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pD extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new Z(q.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Mo(e,rp(t,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Z(q.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Lo(e,rp(t,r),s,a,l,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Z(q.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class gD{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Gt(t),this.D_=!1):X("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yD{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(a=>{r.enqueueAndForget(async()=>{Ei(this)&&(X("RemoteStore","Restarting streams for network reachability change."),await async function(c){const d=oe(c);d.L_.add(4),await Bo(d),d.q_.set("Unknown"),d.L_.delete(4),await Uc(d)}(this))})}),this.q_=new gD(r,s)}}async function Uc(n){if(Ei(n))for(const e of n.B_)await e(!0)}async function Bo(n){for(const e of n.B_)await e(!1)}function jh(n,e){const t=oe(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Jg(t)?Yg(t):qo(t).r_()&&Qg(t,e))}function To(n,e){const t=oe(n),r=qo(t);t.N_.delete(e),r.r_()&&pS(t,e),t.N_.size===0&&(r.r_()?r.o_():Ei(t)&&t.q_.set("Unknown"))}function Qg(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Te.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}qo(n).A_(e)}function pS(n,e){n.Q_.xe(e),qo(n).R_(e)}function Yg(n){n.Q_=new g2({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),qo(n).start(),n.q_.v_()}function Jg(n){return Ei(n)&&!qo(n).n_()&&n.N_.size>0}function Ei(n){return oe(n).L_.size===0}function gS(n){n.Q_=void 0}async function vD(n){n.q_.set("Online")}async function xD(n){n.N_.forEach((e,t)=>{Qg(n,e)})}async function bD(n,e){gS(n),Jg(n)?(n.q_.M_(e),Yg(n)):n.q_.set("Unknown")}async function wD(n,e,t){if(n.q_.set("Online"),e instanceof RT&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const l of i.targetIds)s.N_.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.N_.delete(l),s.Q_.removeTarget(l))}(n,e)}catch(r){X("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Jd(n,r)}else if(e instanceof nd?n.Q_.Ke(e):e instanceof jT?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Te.min()))try{const r=await oS(n.localStore);t.compareTo(r)>=0&&await function(i,a){const l=i.Q_.rt(a);return l.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const h=i.N_.get(d);h&&i.N_.set(d,h.withResumeToken(c.resumeToken,a))}}),l.targetMismatches.forEach((c,d)=>{const h=i.N_.get(c);if(!h)return;i.N_.set(c,h.withResumeToken(Bt.EMPTY_BYTE_STRING,h.snapshotVersion)),pS(i,c);const m=new es(h.target,c,d,h.sequenceNumber);Qg(i,m)}),i.remoteSyncer.applyRemoteEvent(l)}(n,t)}catch(r){X("RemoteStore","Failed to raise snapshot:",r),await Jd(n,r)}}async function Jd(n,e,t){if(!wi(e))throw e;n.L_.add(1),await Bo(n),n.q_.set("Offline"),t||(t=()=>oS(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{X("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Uc(n)})}function yS(n,e){return e().catch(t=>Jd(n,t,e))}async function zo(n){const e=oe(n),t=mi(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;_D(e);)try{const s=await aD(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,ED(e,s)}catch(s){await Jd(e,s)}vS(e)&&xS(e)}function _D(n){return Ei(n)&&n.O_.length<10}function ED(n,e){n.O_.push(e);const t=mi(n);t.r_()&&t.V_&&t.m_(e.mutations)}function vS(n){return Ei(n)&&!mi(n).n_()&&n.O_.length>0}function xS(n){mi(n).start()}async function TD(n){mi(n).p_()}async function SD(n){const e=mi(n);for(const t of n.O_)e.m_(t.mutations)}async function ID(n,e,t){const r=n.O_.shift(),s=Mg.from(r,e,t);await yS(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await zo(n)}async function ND(n,e){e&&mi(n).V_&&await async function(r,s){if(function(a){return AT(a)&&a!==q.ABORTED}(s.code)){const i=r.O_.shift();mi(r).s_(),await yS(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await zo(r)}}(n,e),vS(n)&&xS(n)}async function Gx(n,e){const t=oe(n);t.asyncQueue.verifyOperationInProgress(),X("RemoteStore","RemoteStore received new credentials");const r=Ei(t);t.L_.add(3),await Bo(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Uc(t)}async function up(n,e){const t=oe(n);e?(t.L_.delete(2),await Uc(t)):e||(t.L_.add(2),await Bo(t),t.q_.set("Unknown"))}function qo(n){return n.K_||(n.K_=function(t,r,s){const i=oe(t);return i.w_(),new mD(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:vD.bind(null,n),Ro:xD.bind(null,n),mo:bD.bind(null,n),d_:wD.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Jg(n)?Yg(n):n.q_.set("Unknown")):(await n.K_.stop(),gS(n))})),n.K_}function mi(n){return n.U_||(n.U_=function(t,r,s){const i=oe(t);return i.w_(),new fD(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:TD.bind(null,n),mo:ND.bind(null,n),f_:SD.bind(null,n),g_:ID.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await zo(n)):(await n.U_.stop(),n.O_.length>0&&(X("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xg{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new pn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,l=new Xg(e,t,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Z(q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Wo(n,e){if(Gt("AsyncQueue",`${e}: ${n}`),wi(n))return new Z(q.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class so{constructor(e){this.comparator=e?(t,r)=>e(t,r)||ue.comparator(t.key,r.key):(t,r)=>ue.comparator(t.key,r.key),this.keyedMap=El(),this.sortedSet=new wt(this.comparator)}static emptySet(e){return new so(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof so)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new so;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kx{constructor(){this.W_=new wt(ue.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):he():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class So{constructor(e,t,r,s,i,a,l,c,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach(l=>{a.push({type:0,doc:l})}),new So(e,t,so.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Mc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CD{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class AD{constructor(){this.queries=Qx(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=oe(t),i=s.queries;s.queries=Qx(),i.forEach((a,l)=>{for(const c of l.j_)c.onError(r)})})(this,new Z(q.ABORTED,"Firestore shutting down"))}}function Qx(){return new bs(n=>fT(n),Mc)}async function Zg(n,e){const t=oe(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new CD,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const l=Wo(a,`Initialization of query '${ja(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&t0(t)}async function e0(n,e){const t=oe(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.j_.indexOf(e);a>=0&&(i.j_.splice(a,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function kD(n,e){const t=oe(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const l of a.j_)l.X_(s)&&(r=!0);a.z_=s}}r&&t0(t)}function PD(n,e,t){const r=oe(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function t0(n){n.Y_.forEach(e=>{e.next()})}var dp,Yx;(Yx=dp||(dp={})).ea="default",Yx.Cache="cache";class n0{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new So(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=So.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==dp.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jD{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jx{constructor(e){this.serializer=e}Es(e){return Ur(this.serializer,e)}ds(e){return e.metadata.exists?FT(this.serializer,e.document,!1):St.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Qt(e)}}class RD{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=bS(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=ze.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new Jx(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const a of s.metadata.queries){const l=(t.get(a)||Me()).add(i);t.set(a,l)}}return t}async complete(){const e=await oD(this.localStore,new Jx(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await lD(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function bS(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wS{constructor(e){this.key=e}}class _S{constructor(e){this.key=e}}class ES{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Me(),this.mutatedKeys=Me(),this.Aa=gT(e),this.Ra=new so(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new Kx,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,l=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,m)=>{const p=s.get(h),y=Vc(this.query,m)?m:null,v=!!p&&this.mutatedKeys.has(p.key),S=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let E=!1;p&&y?p.data.isEqual(y.data)?v!==S&&(r.track({type:3,doc:y}),E=!0):this.ga(p,y)||(r.track({type:2,doc:y}),E=!0,(c&&this.Aa(y,c)>0||d&&this.Aa(y,d)<0)&&(l=!0)):!p&&y?(r.track({type:0,doc:y}),E=!0):p&&!y&&(r.track({type:1,doc:p}),E=!0,(c||d)&&(l=!0)),E&&(y?(a=a.add(y),i=S?i.add(h):i.delete(h)):(a=a.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:a,fa:r,ns:l,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((h,m)=>function(y,v){const S=E=>{switch(E){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return he()}};return S(y)-S(v)}(h.type,m.type)||this.Aa(h.doc,m.doc)),this.pa(r),s=s!=null&&s;const l=t&&!s?this.ya():[],c=this.da.size===0&&this.current&&!s?1:0,d=c!==this.Ea;return this.Ea=c,a.length!==0||d?{snapshot:new So(this.query,e.Ra,i,a,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Kx,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Me(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new _S(r))}),this.da.forEach(r=>{e.has(r)||t.push(new wS(r))}),t}ba(e){this.Ta=e.Ts,this.da=Me();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return So.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class DD{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class MD{constructor(e){this.key=e,this.va=!1}}class VD{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new bs(l=>fT(l),Mc),this.Ma=new Map,this.xa=new Set,this.Oa=new wt(ue.comparator),this.Na=new Map,this.La=new Bg,this.Ba={},this.ka=new Map,this.qa=la.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function LD(n,e,t=!0){const r=Rh(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await TS(r,e,t,!0),s}async function OD(n,e){const t=Rh(n);await TS(t,e,!0,!1)}async function TS(n,e,t,r){const s=await _o(n.localStore,Vn(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let l;return r&&(l=await r0(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&jh(n.remoteStore,s),l}async function r0(n,e,t,r,s){n.Ka=(m,p,y)=>async function(S,E,_,x){let C=E.view.ma(_);C.ns&&(C=await Kd(S.localStore,E.query,!1).then(({documents:w})=>E.view.ma(w,C)));const k=x&&x.targetChanges.get(E.targetId),M=x&&x.targetMismatches.get(E.targetId)!=null,F=E.view.applyChanges(C,S.isPrimaryClient,k,M);return hp(S,E.targetId,F.wa),F.snapshot}(n,m,p,y);const i=await Kd(n.localStore,e,!0),a=new ES(e,i.Ts),l=a.ma(i.documents),c=Fc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(l,n.isPrimaryClient,c);hp(n,t,d.wa);const h=new DD(e,t,a);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),d.snapshot}async function FD(n,e,t){const r=oe(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(a=>!Mc(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Eo(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&To(r.remoteStore,s.targetId),Io(r,s.targetId)}).catch(bi)):(Io(r,s.targetId),await Eo(r.localStore,s.targetId,!0))}async function $D(n,e){const t=oe(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),To(t.remoteStore,r.targetId))}async function UD(n,e,t){const r=o0(n);try{const s=await function(a,l){const c=oe(a),d=Vt.now(),h=l.reduce((y,v)=>y.add(v.key),Me());let m,p;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let v=Zn(),S=Me();return c.cs.getEntries(y,h).next(E=>{v=E,v.forEach((_,x)=>{x.isValidDocument()||(S=S.add(_))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,v)).next(E=>{m=E;const _=[];for(const x of l){const C=m2(x,m.get(x.key).overlayedDocument);C!=null&&_.push(new ws(x.key,C,rT(C.value.mapValue),Pt.exists(!0)))}return c.mutationQueue.addMutationBatch(y,d,_,l)}).next(E=>{p=E;const _=E.applyToLocalDocumentSet(m,S);return c.documentOverlayCache.saveOverlays(y,E.batchId,_)})}).then(()=>({batchId:p.batchId,changes:vT(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,l,c){let d=a.Ba[a.currentUser.toKey()];d||(d=new wt(ke)),d=d.insert(l,c),a.Ba[a.currentUser.toKey()]=d}(r,s.batchId,t),await _s(r,s.changes),await zo(r.remoteStore)}catch(s){const i=Wo(s,"Failed to persist write");t.reject(i)}}async function SS(n,e){const t=oe(n);try{const r=await iD(t.localStore,e);e.targetChanges.forEach((s,i)=>{const a=t.Na.get(i);a&&(ve(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.va=!0:s.modifiedDocuments.size>0?ve(a.va):s.removedDocuments.size>0&&(ve(a.va),a.va=!1))}),await _s(t,r,e)}catch(r){await bi(r)}}function Xx(n,e,t){const r=oe(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,a)=>{const l=a.view.Z_(e);l.snapshot&&s.push(l.snapshot)}),function(a,l){const c=oe(a);c.onlineState=l;let d=!1;c.queries.forEach((h,m)=>{for(const p of m.j_)p.Z_(l)&&(d=!0)}),d&&t0(c)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function BD(n,e,t){const r=oe(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let a=new wt(ue.comparator);a=a.insert(i,St.newNoDocument(i,Te.min()));const l=Me().add(i),c=new Oc(Te.min(),new Map,new wt(ke),a,l);await SS(r,c),r.Oa=r.Oa.remove(i),r.Na.delete(e),a0(r)}else await Eo(r.localStore,e,!1).then(()=>Io(r,e,t)).catch(bi)}async function zD(n,e){const t=oe(n),r=e.batch.batchId;try{const s=await sD(t.localStore,e);i0(t,r,null),s0(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await _s(t,s)}catch(s){await bi(s)}}async function qD(n,e,t){const r=oe(n);try{const s=await function(a,l){const c=oe(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let h;return c.mutationQueue.lookupMutationBatch(d,l).next(m=>(ve(m!==null),h=m.keys(),c.mutationQueue.removeMutationBatch(d,m))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,h,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h)).next(()=>c.localDocuments.getDocuments(d,h))})}(r.localStore,e);i0(r,e,t),s0(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await _s(r,s)}catch(s){await bi(s)}}async function WD(n,e){const t=oe(n);Ei(t.remoteStore)||X("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(a){const l=oe(a);return l.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>l.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Wo(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function s0(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function i0(n,e,t){const r=oe(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Io(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||IS(n,r)})}function IS(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(To(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),a0(n))}function hp(n,e,t){for(const r of t)r instanceof wS?(n.La.addReference(r.key,e),HD(n,r)):r instanceof _S?(X("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||IS(n,r.key)):he()}function HD(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(X("SyncEngine","New document in limbo: "+t),n.xa.add(r),a0(n))}function a0(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new ue(ze.fromString(e)),r=n.qa.next();n.Na.set(r,new MD(t)),n.Oa=n.Oa.insert(t,r),jh(n.remoteStore,new es(Vn(Fo(t.path)),r,"TargetPurposeLimboResolution",Jn.oe))}}async function _s(n,e,t){const r=oe(n),s=[],i=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((l,c)=>{a.push(r.Ka(c,e,t).then(d=>{var h;if((d||t)&&r.isPrimaryClient){const m=d?!d.fromCache:(h=t==null?void 0:t.targetChanges.get(c.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(d){s.push(d);const m=Hg.Wi(c.targetId,d);i.push(m)}}))}),await Promise.all(a),r.Ca.d_(s),await async function(c,d){const h=oe(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>O.forEach(d,p=>O.forEach(p.$i,y=>h.persistence.referenceDelegate.addReference(m,p.targetId,y)).next(()=>O.forEach(p.Ui,y=>h.persistence.referenceDelegate.removeReference(m,p.targetId,y)))))}catch(m){if(!wi(m))throw m;X("LocalStore","Failed to update sequence numbers: "+m)}for(const m of d){const p=m.targetId;if(!m.fromCache){const y=h.os.get(p),v=y.snapshotVersion,S=y.withLastLimboFreeSnapshotVersion(v);h.os=h.os.insert(p,S)}}}(r.localStore,i))}async function GD(n,e){const t=oe(n);if(!t.currentUser.isEqual(e)){X("SyncEngine","User change. New user:",e.toKey());const r=await aS(t.localStore,e);t.currentUser=e,function(i,a){i.ka.forEach(l=>{l.forEach(c=>{c.reject(new Z(q.CANCELLED,a))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await _s(t,r.hs)}}function KD(n,e){const t=oe(n),r=t.Na.get(e);if(r&&r.va)return Me().add(r.key);{let s=Me();const i=t.Ma.get(e);if(!i)return s;for(const a of i){const l=t.Fa.get(a);s=s.unionWith(l.view.Va)}return s}}async function QD(n,e){const t=oe(n),r=await Kd(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&hp(t,e.targetId,s.wa),s}async function YD(n,e){const t=oe(n);return uS(t.localStore,e).then(r=>_s(t,r))}async function JD(n,e,t,r){const s=oe(n),i=await function(l,c){const d=oe(l),h=oe(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",m=>h.Mn(m,c).next(p=>p?d.localDocuments.getDocuments(m,p):O.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await zo(s.remoteStore):t==="acknowledged"||t==="rejected"?(i0(s,e,r||null),s0(s,e),function(l,c){oe(oe(l).mutationQueue).On(c)}(s.localStore,e)):he(),await _s(s,i)):X("SyncEngine","Cannot apply mutation batch with id: "+e)}async function XD(n,e){const t=oe(n);if(Rh(t),o0(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await Zx(t,r.toArray());t.Qa=!0,await up(t.remoteStore,!0);for(const i of s)jh(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,a)=>{t.sharedClientState.isLocalQueryTarget(a)?r.push(a):s=s.then(()=>(Io(t,a),Eo(t.localStore,a,!0))),To(t.remoteStore,a)}),await s,await Zx(t,r),function(a){const l=oe(a);l.Na.forEach((c,d)=>{To(l.remoteStore,d)}),l.La.pr(),l.Na=new Map,l.Oa=new wt(ue.comparator)}(t),t.Qa=!1,await up(t.remoteStore,!1)}}async function Zx(n,e,t){const r=oe(n),s=[],i=[];for(const a of e){let l;const c=r.Ma.get(a);if(c&&c.length!==0){l=await _o(r.localStore,Vn(c[0]));for(const d of c){const h=r.Fa.get(d),m=await QD(r,h);m.snapshot&&i.push(m.snapshot)}}else{const d=await cS(r.localStore,a);l=await _o(r.localStore,d),await r0(r,NS(d),a,!1,l.resumeToken)}s.push(l)}return r.Ca.d_(i),s}function NS(n){return dT(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function ZD(n){return function(t){return oe(oe(t).persistence).Qi()}(oe(n).localStore)}async function eM(n,e,t,r){const s=oe(n);if(s.Qa)return void X("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const a=await uS(s.localStore,pT(i[0])),l=Oc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Bt.EMPTY_BYTE_STRING);await _s(s,a,l);break}case"rejected":await Eo(s.localStore,e,!0),Io(s,e,r);break;default:he()}}async function tM(n,e,t){const r=Rh(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){X("SyncEngine","Adding an already active target "+s);continue}const i=await cS(r.localStore,s),a=await _o(r.localStore,i);await r0(r,NS(i),a.targetId,!1,a.resumeToken),jh(r.remoteStore,a)}for(const s of t)r.Ma.has(s)&&await Eo(r.localStore,s,!1).then(()=>{To(r.remoteStore,s),Io(r,s)}).catch(bi)}}function Rh(n){const e=oe(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=SS.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=KD.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=BD.bind(null,e),e.Ca.d_=kD.bind(null,e.eventManager),e.Ca.$a=PD.bind(null,e.eventManager),e}function o0(n){const e=oe(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=zD.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=qD.bind(null,e),e}function nM(n,e,t){const r=oe(n);(async function(i,a,l){try{const c=await a.getMetadata();if(await function(y,v){const S=oe(y),E=Qt(v.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",_=>S.Gr.getBundleMetadata(_,v.id)).then(_=>!!_&&_.createTime.compareTo(E)>=0)}(i.localStore,c))return await a.close(),l._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(c)),Promise.resolve(new Set);l._updateProgress(bS(c));const d=new RD(c,i.localStore,a.serializer);let h=await a.Ua();for(;h;){const p=await d.la(h);p&&l._updateProgress(p),h=await a.Ua()}const m=await d.complete();return await _s(i,m.Ia,void 0),await function(y,v){const S=oe(y);return S.persistence.runTransaction("Save bundle","readwrite",E=>S.Gr.saveBundleMetadata(E,v))}(i.localStore,c),l._completeWith(m.progress),Promise.resolve(m.Pa)}catch(c){return xr("SyncEngine",`Loading bundle failed with ${c}`),l._failWith(c),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class fi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=$c(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return iS(this.persistence,new sS,e.initialUser,this.serializer)}Ga(e){return new zg(Ph.Zr,this.serializer)}Wa(e){return new hS}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fi.provider={build:()=>new fi};class rM extends fi{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){ve(this.persistence.referenceDelegate instanceof Gd);const r=this.persistence.referenceDelegate.garbageCollector;return new ZT(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?Rn.withCacheSize(this.cacheSizeBytes):Rn.DEFAULT;return new zg(r=>Gd.Zr(r,t),this.serializer)}}class l0 extends fi{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await o0(this.Ja.syncEngine),await zo(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return iS(this.persistence,new sS,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new ZT(r,e.asyncQueue,t)}Ha(e,t){const r=new SR(t,this.persistence);return new TR(e.asyncQueue,r)}Ga(e){const t=Wg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Rn.withCacheSize(this.cacheSizeBytes):Rn.DEFAULT;return new qg(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,mS(),rd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new hS}}class CS extends l0{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Om&&(this.sharedClientState.syncEngine={no:JD.bind(null,t),ro:eM.bind(null,t),io:tM.bind(null,t),Qi:ZD.bind(null,t),eo:YD.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await XD(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=mS();if(!Om.D(t))throw new Z(q.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Wg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Om(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class pi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Xx(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=GD.bind(null,this.syncEngine),await up(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new AD}()}createDatastore(e){const t=$c(e.databaseInfo.databaseId),r=function(i){return new hD(i)}(e.databaseInfo);return function(i,a,l,c){return new pD(i,a,l,c)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,a,l){return new yD(r,s,i,a,l)}(this.localStore,this.datastore,e.asyncQueue,t=>Xx(this.syncEngine,t,0),function(){return Hx.D()?new Hx:new cD}())}createSyncEngine(e,t){return function(s,i,a,l,c,d,h){const m=new VD(s,i,a,l,c,d);return h&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=oe(s);X("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Bo(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}pi.provider={build:()=>new pi};function eb(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Gt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sM{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new pn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new jD(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iM{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Z(q.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const a=oe(s),l={documents:i.map(m=>gc(a.serializer,m))},c=await a.Lo("BatchGetDocuments",a.serializer.databaseId,ze.emptyPath(),l,i.length),d=new Map;c.forEach(m=>{const p=_2(a.serializer,m);d.set(p.key.toString(),p)});const h=[];return i.forEach(m=>{const p=d.get(m.toString());ve(!!p),h.push(p)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Uo(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=ue.fromPath(r);this.mutations.push(new Rg(s,this.precondition(s)))}),await async function(r,s){const i=oe(r),a={writes:s.map(l=>yc(i.serializer,l))};await i.Mo("Commit",i.serializer.databaseId,ze.emptyPath(),a)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw he();t=Te.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new Z(q.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Te.min())?Pt.exists(!1):Pt.updateTime(t):Pt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Te.min()))throw new Z(q.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Pt.updateTime(t)}return Pt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aM{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Kg(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new iM(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Rc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!AT(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=mn.UNAUTHENTICATED,this.clientId=$E.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{X("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(X("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new pn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Wo(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function $m(n,e){n.asyncQueue.verifyOperationInProgress(),X("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await aS(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function tb(n,e){n.asyncQueue.verifyOperationInProgress();const t=await c0(n);X("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Gx(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Gx(e.remoteStore,s)),n._onlineComponents=e}async function c0(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){X("FirestoreClient","Using user provided OfflineComponentProvider");try{await $m(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===q.FAILED_PRECONDITION||s.code===q.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;xr("Error using user provided cache. Falling back to memory cache: "+t),await $m(n,new fi)}}else X("FirestoreClient","Using default OfflineComponentProvider"),await $m(n,new fi);return n._offlineComponents}async function Mh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(X("FirestoreClient","Using user provided OnlineComponentProvider"),await tb(n,n._uninitializedComponentsProvider._online)):(X("FirestoreClient","Using default OnlineComponentProvider"),await tb(n,new pi))),n._onlineComponents}function AS(n){return c0(n).then(e=>e.persistence)}function Ho(n){return c0(n).then(e=>e.localStore)}function kS(n){return Mh(n).then(e=>e.remoteStore)}function u0(n){return Mh(n).then(e=>e.syncEngine)}function PS(n){return Mh(n).then(e=>e.datastore)}async function No(n){const e=await Mh(n),t=e.eventManager;return t.onListen=LD.bind(null,e.syncEngine),t.onUnlisten=FD.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=OD.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=$D.bind(null,e.syncEngine),t}function lM(n){return n.asyncQueue.enqueue(async()=>{const e=await AS(n),t=await kS(n);return e.setNetworkEnabled(!0),function(s){const i=oe(s);return i.L_.delete(0),Uc(i)}(t)})}function cM(n){return n.asyncQueue.enqueue(async()=>{const e=await AS(n),t=await kS(n);return e.setNetworkEnabled(!1),async function(s){const i=oe(s);i.L_.add(0),await Bo(i),i.q_.set("Offline")}(t)})}function uM(n,e){const t=new pn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,a){try{const l=await function(d,h){const m=oe(d);return m.persistence.runTransaction("read document","readonly",p=>m.localDocuments.getDocument(p,h))}(s,i);l.isFoundDocument()?a.resolve(l):l.isNoDocument()?a.resolve(null):a.reject(new Z(q.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(l){const c=Wo(l,`Failed to get document '${i} from cache`);a.reject(c)}}(await Ho(n),e,t)),t.promise}function jS(n,e,t={}){const r=new pn;return n.asyncQueue.enqueueAndForget(async()=>function(i,a,l,c,d){const h=new Dh({next:p=>{h.Za(),a.enqueueAndForget(()=>e0(i,m));const y=p.docs.has(l);!y&&p.fromCache?d.reject(new Z(q.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&p.fromCache&&c&&c.source==="server"?d.reject(new Z(q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(p)},error:p=>d.reject(p)}),m=new n0(Fo(l.path),h,{includeMetadataChanges:!0,_a:!0});return Zg(i,m)}(await No(n),n.asyncQueue,e,t,r)),r.promise}function dM(n,e){const t=new pn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,a){try{const l=await Kd(s,i,!0),c=new ES(i,l.Ts),d=c.ma(l.documents),h=c.applyChanges(d,!1);a.resolve(h.snapshot)}catch(l){const c=Wo(l,`Failed to execute query '${i} against cache`);a.reject(c)}}(await Ho(n),e,t)),t.promise}function RS(n,e,t={}){const r=new pn;return n.asyncQueue.enqueueAndForget(async()=>function(i,a,l,c,d){const h=new Dh({next:p=>{h.Za(),a.enqueueAndForget(()=>e0(i,m)),p.fromCache&&c.source==="server"?d.reject(new Z(q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(p)},error:p=>d.reject(p)}),m=new n0(l,h,{includeMetadataChanges:!0,_a:!0});return Zg(i,m)}(await No(n),n.asyncQueue,e,t,r)),r.promise}function hM(n,e,t){const r=new pn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await PS(n);r.resolve(async function(a,l,c){var d;const h=oe(a),{request:m,ut:p,parent:y}=UT(h.serializer,hT(l),c);h.connection.Fo||delete m.parent;const v=(await h.Lo("RunAggregationQuery",h.serializer.databaseId,y,m,1)).filter(E=>!!E.result);ve(v.length===1);const S=(d=v[0].result)===null||d===void 0?void 0:d.aggregateFields;return Object.keys(S).reduce((E,_)=>(E[p[_]]=S[_],E),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function mM(n,e){const t=new Dh(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){oe(s).Y_.add(i),i.next()}(await No(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){oe(s).Y_.delete(i)}(await No(n),t))}}function fM(n,e,t,r){const s=function(a,l){let c;return c=typeof a=="string"?PT().encode(a):a,function(h,m){return new sM(h,m)}(function(h,m){if(h instanceof Uint8Array)return eb(h,m);if(h instanceof ArrayBuffer)return eb(new Uint8Array(h),m);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),l)}(t,$c(e));n.asyncQueue.enqueueAndForget(async()=>{nM(await u0(n),s,r)})}function pM(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=oe(r);return i.persistence.runTransaction("Get named query","readonly",a=>i.Gr.getNamedQuery(a,s))}(await Ho(n),e))}function gM(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=oe(r),a=i.indexManager,l=[];return i.persistence.runTransaction("Configure indexes","readwrite",c=>a.getFieldIndexes(c).next(d=>function(m,p,y,v,S){m=[...m],p=[...p],m.sort(y),p.sort(y);const E=m.length,_=p.length;let x=0,C=0;for(;x<_&&C<E;){const k=y(m[C],p[x]);k<0?S(m[C++]):k>0?v(p[x++]):(x++,C++)}for(;x<_;)v(p[x++]);for(;C<E;)S(m[C++])}(d,s,bR,h=>{l.push(a.addFieldIndex(c,h))},h=>{l.push(a.deleteFieldIndex(c,h))})).next(()=>O.waitFor(l)))}(await Ho(n),e))}function yM(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){oe(r).ss.zi=s}(await Ho(n),e))}function vM(n){return n.asyncQueue.enqueue(async()=>function(t){const r=oe(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Ho(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DS(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nb=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d0(n,e,t){if(!t)throw new Z(q.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function xM(n,e,t,r){if(e===!0&&r===!0)throw new Z(q.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function rb(n){if(!ue.isDocumentKey(n))throw new Z(q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function sb(n){if(ue.isDocumentKey(n))throw new Z(q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Vh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":he()}function $e(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Z(q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Vh(n);throw new Z(q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function MS(n,e){if(e<=0)throw new Z(q.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ib{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Z(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Z(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}xM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=DS((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Z(q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Z(q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Z(q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Bc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ib({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Z(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Z(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ib(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new hR;switch(r.type){case"firstParty":return new gR(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Z(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=nb.get(t);r&&(X("ComponentProvider","Removing Datastore"),nb.delete(t),r.terminate())}(this),Promise.resolve()}}function bM(n,e,t,r={}){var s;const i=(n=$e(n,Bc))._getSettings(),a=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==a&&xr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:a,ssl:!1})),r.mockUserToken){let l,c;if(typeof r.mockUserToken=="string")l=r.mockUserToken,c=mn.MOCK_USER;else{l=IA(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new Z(q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new mn(d)}n._authCredentials=new mR(new OE(l,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new En(this.firestore,e,this._query)}}class Yt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Br(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Yt(this.firestore,e,this._key)}}class Br extends En{constructor(e,t,r){super(e,t,Fo(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Yt(this.firestore,null,new ue(e))}withConverter(e){return new Br(this.firestore,e,this._path)}}function ft(n,e,...t){if(n=mt(n),d0("collection","path",e),n instanceof Bc){const r=ze.fromString(e,...t);return sb(r),new Br(n,null,r)}{if(!(n instanceof Yt||n instanceof Br))throw new Z(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ze.fromString(e,...t));return sb(r),new Br(n.firestore,null,r)}}function cV(n,e){if(n=$e(n,Bc),d0("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Z(q.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new En(n,null,function(r){return new xs(ze.emptyPath(),r)}(e))}function Ze(n,e,...t){if(n=mt(n),arguments.length===1&&(e=$E.newId()),d0("doc","path",e),n instanceof Bc){const r=ze.fromString(e,...t);return rb(r),new Yt(n,null,new ue(r))}{if(!(n instanceof Yt||n instanceof Br))throw new Z(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ze.fromString(e,...t));return rb(r),new Yt(n.firestore,n instanceof Br?n.converter:null,new ue(r))}}function uV(n,e){return n=mt(n),e=mt(e),(n instanceof Yt||n instanceof Br)&&(e instanceof Yt||e instanceof Br)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function VS(n,e){return n=mt(n),e=mt(e),n instanceof En&&e instanceof En&&n.firestore===e.firestore&&Mc(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ab{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Kg(this,"async_queue_retry"),this.Vu=()=>{const r=rd();r&&X("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=rd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=rd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new pn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!wi(e))throw e;X("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(a){let l=a.message||"";return a.stack&&(l=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),l}(r);throw Gt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Xg.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&he()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function mp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class wM{constructor(){this._progressObserver={},this._taskCompletionResolver=new pn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dV=-1;class vt extends Bc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new ab,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ab(e),this._firestoreClient=void 0,await e}}}function hV(n,e,t){t||(t="(default)");const r=Cc(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(li(i,e))return s;throw new Z(q.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new Z(q.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Z(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function _M(n,e){const t=typeof n=="object"?n:G_(),r=typeof n=="string"?n:e||"(default)",s=Cc(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=TA("firestore");i&&bM(s,...i)}return s}function Ot(n){if(n._terminated)throw new Z(q.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||LS(n),n._firestoreClient}function LS(n){var e,t,r;const s=n._freezeSettings(),i=function(l,c,d,h){return new HR(l,c,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,DS(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new oM(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(n._componentsProvider))}function mV(n,e){xr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return OS(n,pi.provider,{build:r=>new l0(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function fV(n){xr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();OS(n,pi.provider,{build:t=>new CS(t,e.cacheSizeBytes)})}function OS(n,e,t){if((n=$e(n,vt))._firestoreClient||n._terminated)throw new Z(q.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new Z(q.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},LS(n)}function pV(n){if(n._initialized&&!n._terminated)throw new Z(q.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new pn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!$r.D())return Promise.resolve();const s=r+"main";await $r.delete(s)}(Wg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function gV(n){return function(t){const r=new pn;return t.asyncQueue.enqueueAndForget(async()=>WD(await u0(t),r)),r.promise}(Ot(n=$e(n,vt)))}function yV(n){return lM(Ot(n=$e(n,vt)))}function vV(n){return cM(Ot(n=$e(n,vt)))}function xV(n){return Lk(n.app,"firestore",n._databaseId.database),n._delete()}function bV(n,e){const t=Ot(n=$e(n,vt)),r=new wM;return fM(t,n._databaseId,e,r),r}function wV(n,e){return pM(Ot(n=$e(n,vt)),e).then(t=>t?new En(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class EM{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ca(Bt.fromBase64String(e))}catch(t){throw new Z(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ca(Bt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Z(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new kt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function _V(){return new fa("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h0{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Z(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Z(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ke(this._lat,e._lat)||ke(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TM=/^__.*__$/;class SM{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ws(e,this.data,this.fieldMask,t,this.fieldTransforms):new $o(e,this.data,t,this.fieldTransforms)}}class FS{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ws(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function $S(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw he()}}class Oh{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Oh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Xd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if($S(this.Cu)&&TM.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class IM{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||$c(e)}Qu(e,t,r,s=!1){return new Oh({Cu:e,methodName:t,qu:r,path:kt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ga(n){const e=n._freezeSettings(),t=$c(n._databaseId);return new IM(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Fh(n,e,t,r,s,i={}){const a=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);x0("Data must be an object, but it was:",a,r);const l=zS(r,a);let c,d;if(i.merge)c=new Xn(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const h=[];for(const m of i.mergeFields){const p=xc(e,m,t);if(!a.contains(p))throw new Z(q.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);WS(h,p)||h.push(p)}c=new Xn(h),d=a.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,d=a.fieldTransforms;return new SM(new bn(l),c,d)}class zc extends pa{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof zc}}function US(n,e,t){return new Oh({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class m0 extends pa{_toFieldTransform(e){return new Lc(e.path,new xo)}isEqual(e){return e instanceof m0}}class f0 extends pa{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=US(this,e,!0),r=this.Ku.map(i=>ya(i,t)),s=new sa(r);return new Lc(e.path,s)}isEqual(e){return e instanceof f0&&li(this.Ku,e.Ku)}}class p0 extends pa{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=US(this,e,!0),r=this.Ku.map(i=>ya(i,t)),s=new ia(r);return new Lc(e.path,s)}isEqual(e){return e instanceof p0&&li(this.Ku,e.Ku)}}class g0 extends pa{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new bo(e.serializer,wT(e.serializer,this.$u));return new Lc(e.path,t)}isEqual(e){return e instanceof g0&&this.$u===e.$u}}function y0(n,e,t,r){const s=n.Qu(1,e,t);x0("Data must be an object, but it was:",s,r);const i=[],a=bn.empty();_i(r,(c,d)=>{const h=$h(e,c,t);d=mt(d);const m=s.Nu(h);if(d instanceof zc)i.push(h);else{const p=ya(d,m);p!=null&&(i.push(h),a.set(h,p))}});const l=new Xn(i);return new FS(a,l,s.fieldTransforms)}function v0(n,e,t,r,s,i){const a=n.Qu(1,e,t),l=[xc(e,r,t)],c=[s];if(i.length%2!=0)throw new Z(q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)l.push(xc(e,i[p])),c.push(i[p+1]);const d=[],h=bn.empty();for(let p=l.length-1;p>=0;--p)if(!WS(d,l[p])){const y=l[p];let v=c[p];v=mt(v);const S=a.Nu(y);if(v instanceof zc)d.push(y);else{const E=ya(v,S);E!=null&&(d.push(y),h.set(y,E))}}const m=new Xn(d);return new FS(h,m,a.fieldTransforms)}function BS(n,e,t,r=!1){return ya(t,n.Qu(r?4:3,e))}function ya(n,e){if(qS(n=mt(n)))return x0("Unsupported field value:",e,n),zS(n,e);if(n instanceof pa)return function(r,s){if(!$S(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let a=0;for(const l of r){let c=ya(l,s.Lu(a));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),a++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=mt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return wT(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Vt.fromDate(r);return{timestampValue:wo(s.serializer,i)}}if(r instanceof Vt){const i=new Vt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:wo(s.serializer,i)}}if(r instanceof h0)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ca)return{bytesValue:DT(s.serializer,r._byteString)};if(r instanceof Yt){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Og(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Lh)return function(a,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(c=>{if(typeof c!="number")throw l.Bu("VectorValues must only contain numeric values.");return jg(l.serializer,c)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Vh(r)}`)}(n,e)}function zS(n,e){const t={};return ZE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):_i(n,(r,s)=>{const i=ya(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function qS(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Vt||n instanceof h0||n instanceof ca||n instanceof Yt||n instanceof pa||n instanceof Lh)}function x0(n,e,t){if(!qS(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Vh(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function xc(n,e,t){if((e=mt(e))instanceof fa)return e._internalPath;if(typeof e=="string")return $h(n,e);throw Xd("Field path arguments must be of type string or ",n,!1,void 0,t)}const NM=new RegExp("[~\\*/\\[\\]]");function $h(n,e,t){if(e.search(NM)>=0)throw Xd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new fa(...e.split("."))._internalPath}catch{throw Xd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Xd(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(i||a)&&(c+=" (found",i&&(c+=` in field ${r}`),a&&(c+=` in document ${s}`),c+=")"),new Z(q.INVALID_ARGUMENT,l+n+c)}function WS(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bc{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Yt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new CM(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Uh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class CM extends bc{data(){return super.data()}}function Uh(n,e){return typeof e=="string"?$h(n,e):e instanceof fa?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HS(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Z(q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class b0{}class qc extends b0{}function ln(n,e,...t){let r=[];e instanceof b0&&r.push(e),r=r.concat(t),function(i){const a=i.filter(c=>c instanceof Go).length,l=i.filter(c=>c instanceof Wc).length;if(a>1||a>0&&l>0)throw new Z(q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Wc extends qc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Wc(e,t,r)}_apply(e){const t=this._parse(e);return KS(e._query,t),new En(e.firestore,e.converter,tp(e._query,t))}_parse(e){const t=ga(e.firestore);return function(i,a,l,c,d,h,m){let p;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new Z(q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){lb(m,h);const y=[];for(const v of m)y.push(ob(c,i,v));p={arrayValue:{values:y}}}else p=ob(c,i,m)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||lb(m,h),p=BS(l,a,m,h==="in"||h==="not-in");return qe.create(d,h,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function zt(n,e,t){const r=e,s=Uh("where",n);return Wc._create(s,r,t)}class Go extends b0{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Go(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ct.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let a=s;const l=i.getFlattenedFilters();for(const c of l)KS(a,c),a=tp(a,c)}(e._query,t),new En(e.firestore,e.converter,tp(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function EV(...n){return n.forEach(e=>QS("or",e)),Go._create("or",n)}function TV(...n){return n.forEach(e=>QS("and",e)),Go._create("and",n)}class w0 extends qc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new w0(e,t)}_apply(e){const t=function(s,i,a){if(s.startAt!==null)throw new Z(q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Z(q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new pc(i,a)}(e._query,this._field,this._direction);return new En(e.firestore,e.converter,function(s,i){const a=s.explicitOrderBy.concat([i]);return new xs(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function SV(n,e="asc"){const t=e,r=Uh("orderBy",n);return w0._create(r,t)}class Bh extends qc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Bh(e,t,r)}_apply(e){return new En(e.firestore,e.converter,Bd(e._query,this._limit,this._limitType))}}function IV(n){return MS("limit",n),Bh._create("limit",n,"F")}function NV(n){return MS("limitToLast",n),Bh._create("limitToLast",n,"L")}class zh extends qc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new zh(e,t,r)}_apply(e){const t=GS(e,this.type,this._docOrFields,this._inclusive);return new En(e.firestore,e.converter,function(s,i){return new xs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function CV(...n){return zh._create("startAt",n,!0)}function AV(...n){return zh._create("startAfter",n,!1)}class qh extends qc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new qh(e,t,r)}_apply(e){const t=GS(e,this.type,this._docOrFields,this._inclusive);return new En(e.firestore,e.converter,function(s,i){return new xs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function kV(...n){return qh._create("endBefore",n,!1)}function PV(...n){return qh._create("endAt",n,!0)}function GS(n,e,t,r){if(t[0]=mt(t[0]),t[0]instanceof bc)return function(i,a,l,c,d){if(!c)throw new Z(q.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);const h=[];for(const m of ro(i))if(m.field.isKeyField())h.push(na(a,c.key));else{const p=c.data.field(m.field);if(Eh(p))throw new Z(q.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){const y=m.field.canonicalString();throw new Z(q.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(p)}return new hi(h,d)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=ga(n.firestore);return function(a,l,c,d,h,m){const p=a.explicitOrderBy;if(h.length>p.length)throw new Z(q.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let v=0;v<h.length;v++){const S=h[v];if(p[v].field.isKeyField()){if(typeof S!="string")throw new Z(q.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof S}`);if(!kg(a)&&S.indexOf("/")!==-1)throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${S}' contains a slash.`);const E=a.path.child(ze.fromString(S));if(!ue.isDocumentKey(E))throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${E}' is not because it contains an odd number of segments.`);const _=new ue(E);y.push(na(l,_))}else{const E=BS(c,d,S);y.push(E)}}return new hi(y,m)}(n._query,n.firestore._databaseId,s,e,t,r)}}function ob(n,e,t){if(typeof(t=mt(t))=="string"){if(t==="")throw new Z(q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!kg(e)&&t.indexOf("/")!==-1)throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ze.fromString(t));if(!ue.isDocumentKey(r))throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return na(n,new ue(r))}if(t instanceof Yt)return na(n,t._key);throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Vh(t)}.`)}function lb(n,e){if(!Array.isArray(n)||n.length===0)throw new Z(q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function KS(n,e){const t=function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Z(q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Z(q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function QS(n,e){if(!(e instanceof Wc||e instanceof Go))throw new Z(q.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class YS{convertValue(e,t="none"){switch(ui(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ct(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(us(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw he()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return _i(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(a=>Ct(a.doubleValue));return new Lh(i)}convertGeoPoint(e){return new h0(Ct(e.latitude),Ct(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Th(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(hc(e));default:return null}}convertTimestamp(e){const t=cs(e);return new Vt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ze.fromString(e);ve(WT(r));const s=new ta(r.get(1),r.get(3)),i=new ue(r.popFirst(5));return s.isEqual(t)||Gt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class AM extends YS{constructor(e){super(),this.firestore=e}convertBytes(e){return new ca(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Yt(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jV(n){return new vc("sum",xc("sum",n))}function RV(n){return new vc("avg",xc("average",n))}function kM(){return new vc("count")}function DV(n,e){var t,r;return n instanceof vc&&e instanceof vc&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function MV(n,e){return VS(n.query,e.query)&&li(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Co extends bc{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new sd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Uh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class sd extends Co{data(e={}){return super.data(e)}}class Ao{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Bi(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new sd(this._firestore,this._userDataWriter,r.key,r,new Bi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Z(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(l=>{const c=new sd(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Bi(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const c=new sd(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Bi(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,h=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),h=a.indexOf(l.doc.key)),{type:PM(l.type),doc:c,oldIndex:d,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function PM(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return he()}}function VV(n,e){return n instanceof Co&&e instanceof Co?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ao&&e instanceof Ao&&n._firestore===e._firestore&&VS(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function On(n){n=$e(n,Yt);const e=$e(n.firestore,vt);return jS(Ot(e),n._key).then(t=>_0(e,n,t))}class Ti extends YS{constructor(e){super(),this.firestore=e}convertBytes(e){return new ca(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Yt(this.firestore,null,t)}}function LV(n){n=$e(n,Yt);const e=$e(n.firestore,vt),t=Ot(e),r=new Ti(e);return uM(t,n._key).then(s=>new Co(e,r,n._key,s,new Bi(s!==null&&s.hasLocalMutations,!0),n.converter))}function OV(n){n=$e(n,Yt);const e=$e(n.firestore,vt);return jS(Ot(e),n._key,{source:"server"}).then(t=>_0(e,n,t))}function Wn(n){n=$e(n,En);const e=$e(n.firestore,vt),t=Ot(e),r=new Ti(e);return HS(n._query),RS(t,n._query).then(s=>new Ao(e,r,n,s))}function FV(n){n=$e(n,En);const e=$e(n.firestore,vt),t=Ot(e),r=new Ti(e);return dM(t,n._query).then(s=>new Ao(e,r,n,s))}function $V(n){n=$e(n,En);const e=$e(n.firestore,vt),t=Ot(e),r=new Ti(e);return RS(t,n._query,{source:"server"}).then(s=>new Ao(e,r,n,s))}function UV(n,e,t){n=$e(n,Yt);const r=$e(n.firestore,vt),s=Wh(n.converter,e,t);return Hc(r,[Fh(ga(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Pt.none())])}function Ft(n,e,t,...r){n=$e(n,Yt);const s=$e(n.firestore,vt),i=ga(s);let a;return a=typeof(e=mt(e))=="string"||e instanceof fa?v0(i,"updateDoc",n._key,e,t,r):y0(i,"updateDoc",n._key,e),Hc(s,[a.toMutation(n._key,Pt.exists(!0))])}function id(n){return Hc($e(n.firestore,vt),[new Uo(n._key,Pt.none())])}function Es(n,e){const t=$e(n.firestore,vt),r=Ze(n),s=Wh(n.converter,e);return Hc(t,[Fh(ga(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Pt.exists(!1))]).then(()=>r)}function ua(n,...e){var t,r,s;n=mt(n);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||mp(e[a])||(i=e[a],a++);const l={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(mp(e[a])){const m=e[a];e[a]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[a+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[a+2]=(s=m.complete)===null||s===void 0?void 0:s.bind(m)}let c,d,h;if(n instanceof Yt)d=$e(n.firestore,vt),h=Fo(n._key.path),c={next:m=>{e[a]&&e[a](_0(d,n,m))},error:e[a+1],complete:e[a+2]};else{const m=$e(n,En);d=$e(m.firestore,vt),h=m._query;const p=new Ti(d);c={next:y=>{e[a]&&e[a](new Ao(d,p,m,y))},error:e[a+1],complete:e[a+2]},HS(n._query)}return function(p,y,v,S){const E=new Dh(S),_=new n0(y,E,v);return p.asyncQueue.enqueueAndForget(async()=>Zg(await No(p),_)),()=>{E.Za(),p.asyncQueue.enqueueAndForget(async()=>e0(await No(p),_))}}(Ot(d),h,l,c)}function BV(n,e){return mM(Ot(n=$e(n,vt)),mp(e)?e:{next:e})}function Hc(n,e){return function(r,s){const i=new pn;return r.asyncQueue.enqueueAndForget(async()=>UD(await u0(r),s,i)),i.promise}(Ot(n),e)}function _0(n,e,t){const r=t.docs.get(e._key),s=new Ti(n);return new Co(n,s,e._key,r,new Bi(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zV(n){return jM(n,{count:kM()})}function jM(n,e){const t=$e(n.firestore,vt),r=Ot(t),s=XE(e,(i,a)=>new CT(a,i.aggregateType,i._internalFieldPath));return hM(r,n._query,s).then(i=>function(l,c,d){const h=new Ti(l);return new EM(c,h,d)}(t,n,i))}class RM{constructor(e){this.kind="memory",this._onlineComponentProvider=pi.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=fi.provider}toJSON(){return{kind:this.kind}}}class DM{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=FM(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class MM{constructor(){this.kind="memoryEager",this._offlineComponentProvider=fi.provider}toJSON(){return{kind:this.kind}}}class VM{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new rM(e)}}toJSON(){return{kind:this.kind}}}function qV(){return new MM}function WV(n){return new VM(n==null?void 0:n.cacheSizeBytes)}function HV(n){return new RM(n)}function GV(n){return new DM(n)}class LM{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=pi.provider,this._offlineComponentProvider={build:t=>new l0(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class OM{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=pi.provider,this._offlineComponentProvider={build:t=>new CS(t,e==null?void 0:e.cacheSizeBytes)}}}function FM(n){return new LM(n==null?void 0:n.forceOwnership)}function KV(){return new OM}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $M={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UM{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ga(e)}set(e,t,r){this._verifyNotCommitted();const s=zs(e,this._firestore),i=Wh(s.converter,t,r),a=Fh(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(a.toMutation(s._key,Pt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=zs(e,this._firestore);let a;return a=typeof(t=mt(t))=="string"||t instanceof fa?v0(this._dataReader,"WriteBatch.update",i._key,t,r,s):y0(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(a.toMutation(i._key,Pt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=zs(e,this._firestore);return this._mutations=this._mutations.concat(new Uo(t._key,Pt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Z(q.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function zs(n,e){if((n=mt(n)).firestore!==e)throw new Z(q.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BM extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=ga(t)}get(t){const r=zs(t,this._firestore),s=new AM(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return he();const a=i[0];if(a.isFoundDocument())return new bc(this._firestore,s,a.key,a,r.converter);if(a.isNoDocument())return new bc(this._firestore,s,r._key,null,r.converter);throw he()})}set(t,r,s){const i=zs(t,this._firestore),a=Wh(i.converter,r,s),l=Fh(this._dataReader,"Transaction.set",i._key,a,i.converter!==null,s);return this._transaction.set(i._key,l),this}update(t,r,s,...i){const a=zs(t,this._firestore);let l;return l=typeof(r=mt(r))=="string"||r instanceof fa?v0(this._dataReader,"Transaction.update",a._key,r,s,i):y0(this._dataReader,"Transaction.update",a._key,r),this._transaction.update(a._key,l),this}delete(t){const r=zs(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=zs(e,this._firestore),r=new Ti(this._firestore);return super.get(e).then(s=>new Co(this._firestore,r,t._key,s._document,new Bi(!1,!1),t.converter))}}function YV(n,e,t){n=$e(n,vt);const r=Object.assign(Object.assign({},$M),t);return function(i){if(i.maxAttempts<1)throw new Z(q.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,a,l){const c=new pn;return i.asyncQueue.enqueueAndForget(async()=>{const d=await PS(i);new aM(i.asyncQueue,d,l,a,c).au()}),c.promise}(Ot(n),s=>e(new BM(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JV(){return new zc("deleteField")}function Le(){return new m0("serverTimestamp")}function XV(...n){return new f0("arrayUnion",n)}function ZV(...n){return new p0("arrayRemove",n)}function eL(n){return new g0("increment",n)}function tL(n){return new Lh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nL(n){return Ot(n=$e(n,vt)),new UM(n,e=>Hc(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rL(n,e){const t=Ot(n=$e(n,vt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return xr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const a=typeof i=="string"?function(d){try{return JSON.parse(d)}catch(h){throw new Z(q.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,l=[];if(Array.isArray(a.indexes))for(const c of a.indexes){const d=cb(c,"collectionGroup"),h=[];if(Array.isArray(c.fields))for(const m of c.fields){const p=$h("setIndexConfiguration",cb(m,"fieldPath"));m.arrayConfig==="CONTAINS"?h.push(new Hi(p,2)):m.order==="ASCENDING"?h.push(new Hi(p,0)):m.order==="DESCENDING"&&h.push(new Hi(p,1))}l.push(new po(po.UNKNOWN_ID,d,h,go.empty()))}return l}(e);return gM(t,r)}function cb(n,e){if(typeof n[e]!="string")throw new Z(q.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zM{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function sL(n){var e;n=$e(n,vt);const t=ub.get(n);if(t)return t;if(((e=Ot(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new zM(n);return ub.set(n,r),r}function iL(n){JS(n,!0)}function aL(n){JS(n,!1)}function oL(n){vM(Ot(n._firestore)).then(e=>X("deleting all persistent cache indexes succeeded")).catch(e=>xr("deleting all persistent cache indexes failed",e))}function JS(n,e){yM(Ot(n._firestore),e).then(t=>X(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>xr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const ub=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lL(n){var e;const t=(e=Ot($e(n.firestore,vt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Ch(t,Vn(n._query))._t}function cL(n,e){var t;const r=XE(e,(i,a)=>new CT(a,i.aggregateType,i._internalFieldPath)),s=(t=Ot($e(n.firestore,vt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:UT(s,hT(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uL{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return E0.instance.onExistenceFilterMismatch(e)}}class E0{constructor(){this.Uu=new Map}static get instance(){return Pu||(Pu=new E0,function(t){if(zd)throw new Error("a TestingHooksSpi instance is already set");zd=t}(Pu)),Pu}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Pu=null;(function(e,t=!0){(function(s){Oo=s})(Vo),mo(new Xi("firestore",(r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new vt(new fR(r.getProvider("auth-internal")),new yR(r.getProvider("app-check-internal")),function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new Z(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ta(d.options.projectId,h)}(a,s),a);return i=Object.assign({useFetchStreams:t},i),l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),ii(Zv,"4.7.3",e),ii(Zv,"4.7.3","esm2017")})();const qM={apiKey:"AIzaSyB_1Dn63ZHRnA-jXytu95WEBWNFQ64Jo_E",authDomain:"dnd-v1-17acc.firebaseapp.com",projectId:"dnd-v1-17acc",storageBucket:"dnd-v1-17acc.firebasestorage.app",messagingSenderId:"976056329393",appId:"1:976056329393:web:7c8170e906162fe4ef2e90"},XS=H_(qM),ds=lR(XS),be=_M(XS),WM=n=>{console.warn("Firestore connection issue:",n)},Um=Object.freeze(Object.defineProperty({__proto__:null,auth:ds,db:be,handleFirestoreError:WM},Symbol.toStringTag,{value:"Module"})),HM=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),Pe=(n,e)=>{throw console.error(`Error in ${e}:`,n),n.code==="unavailable"||n.code==="deadline-exceeded"?new Error("Network connection issue. Please check your internet connection and try again."):n.code==="permission-denied"?new Error("Access denied. Please check your permissions."):n.code==="not-found"?new Error("The requested data was not found."):new Error(`Database error: ${n.message}`)},ZS=async(n,e)=>{try{const t={...e,userId:n,createdAt:Le(),updatedAt:Le()};return{id:(await Es(ft(be,"userProfiles"),t)).id,...t}}catch(t){Pe(t,"createUserProfile")}},va=async n=>{try{const e=ln(ft(be,"userProfiles"),zt("userId","==",n)),t=await Wn(e);if(t.empty)return null;const r=t.docs[0];return{id:r.id,...r.data()}}catch(e){Pe(e,"getUserProfile")}},Zd=async n=>{try{if(!n||n.length===0)return[];const e=[];for(let s=0;s<n.length;s+=10){const i=n.slice(s,s+10),a=ln(ft(be,"userProfiles"),zt("userId","in",i));e.push(Wn(a))}const t=await Promise.all(e),r=[];return t.forEach(s=>{s.docs.forEach(i=>{r.push({id:i.id,...i.data()})})}),r}catch(e){Pe(e,"getUserProfiles")}},GM=async(n,e)=>{try{const t=await va(n);if(!t)throw new Error("User profile not found");const r=Ze(be,"userProfiles",t.id);await Ft(r,{...e,updatedAt:Le()})}catch(t){Pe(t,"updateUserProfile")}},eI=async n=>{try{const e=ln(ft(be,"userProfiles"),zt("username","==",n));return(await Wn(e)).empty}catch(e){Pe(e,"checkUsernameAvailability")}},T0=n=>{const{class:e,level:t,constitution:r,dexterity:s,strength:i}=n,l={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[e]||8,c=Math.floor((r-10)/2),d=Math.max(1,(l+c)*t),h=10,m=Math.floor((s-10)/2),y={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[e]||0,v=h+m+y;return{hp:Math.max(1,d),maxHp:Math.max(1,d),ac:Math.max(10,v)}},tI=async(n,e,t)=>{try{const r=ft(be,"characters"),s=T0(t),i={...t,...s,userId:n,partyId:e,createdAt:new Date,updatedAt:new Date};return{id:(await Es(r,i)).id,...i}}catch(r){throw new Error(`Failed to save character: ${r.message}`)}},Ul=async n=>{try{const e=ft(be,"characters"),t=ln(e,zt("userId","==",n));return(await Wn(t)).docs.map(i=>({id:i.id,...i.data()}))}catch(e){throw new Error(`Failed to get user characters: ${e.message}`)}},nI=async(n,e)=>{try{const t=ft(be,"characters"),r=ln(t,zt("userId","==",n),zt("partyId","==",e)),s=await Wn(r);if(s.empty)return null;const i=s.docs[0];return{id:i.id,...i.data()}}catch(t){throw new Error(`Failed to get character: ${t.message}`)}},hs=async n=>{try{const e=ln(ft(be,"characters"),zt("partyId","==",n));return(await Wn(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){Pe(e,"getPartyCharacters")}},KM=async(n,e)=>{try{const t=Ze(be,"characters",n),r=await On(t);if(!r.exists())throw new Error(`Character document with ID ${n} does not exist`);const s=r.data(),i={...e,updatedAt:new Date};if(e.class||e.level||e.constitution||e.dexterity||e.strength||e.wisdom){const l={...s,...e},c=T0(l);Object.assign(i,c)}return await Ft(t,i),{id:n,...s,...i}}catch(t){throw t}},eh=async n=>{try{const e=Ze(be,"characters",n);return await id(e),!0}catch(e){throw new Error(`Failed to delete character: ${e.message}`)}},QM=async n=>{try{console.log("Debugging characters for user:",n);const e=ln(ft(be,"characters"),zt("userId","==",n)),r=(await Wn(e)).docs.map(a=>({id:a.id,...a.data()}));console.log("All characters for user:",r);const s=r.filter(a=>!a.partyId);s.length>0&&console.warn("Found characters without partyId:",s);const i={};return r.forEach(a=>{a.partyId&&(i[a.partyId]||(i[a.partyId]=[]),i[a.partyId].push(a))}),Object.entries(i).forEach(([a,l])=>{l.length>1&&console.warn(`Multiple characters found for party ${a}:`,l)}),{totalCharacters:r.length,orphanedCharacters:s.length,partyGroups:i}}catch(e){throw console.error("Error debugging characters:",e),e}},YM=async n=>{try{const t=(await Ul(n)).filter(s=>!s.partyId);if(t.length===0)return{deleted:0};const r=t.map(s=>eh(s.id));return await Promise.all(r),{deleted:t.length}}catch(e){throw new Error(`Failed to cleanup orphaned characters: ${e.message}`)}},rI=async(n,e)=>{try{const t={...e,dmId:n,members:[n],createdAt:Le(),updatedAt:Le()};return{id:(await Es(ft(be,"parties"),t)).id,...t}}catch(t){Pe(t,"createParty")}},sI=async n=>{try{const e=ln(ft(be,"parties"),zt("members","array-contains",n));return(await Wn(e)).docs.map(s=>{const i=s.data();return{id:s.id,...i}})}catch(e){Pe(e,"getUserParties")}},iI=async()=>{try{const n=ln(ft(be,"parties"),zt("isPublic","==",!0));return(await Wn(n)).docs.map(r=>{const s=r.data();return{id:r.id,...s}}).sort((r,s)=>{var l,c,d,h;const i=((c=(l=r.createdAt)==null?void 0:l.toDate)==null?void 0:c.call(l))||r.createdAt||new Date(0);return(((h=(d=s.createdAt)==null?void 0:d.toDate)==null?void 0:h.call(d))||s.createdAt||new Date(0))-i})}catch(n){Pe(n,"getPublicParties")}},fp=async(n,e)=>{try{const t=Ze(be,"parties",n),r=await On(t);if(!r.exists())throw new Error("Party not found");const s=r.data();if(s.members.includes(e))throw new Error("User already in party");await Ft(t,{members:[...s.members,e],updatedAt:Le()})}catch(t){Pe(t,"joinParty")}},aI=async(n,e)=>{try{const t=Ze(be,"parties",n),r=await On(t);if(!r.exists())throw new Error("Party not found");if(r.data().dmId!==e)throw new Error("Only the party leader can disband the party");await id(t);const i=ln(ft(be,"characters"),zt("partyId","==",n)),l=(await Wn(i)).docs.map(m=>id(m.ref));await Promise.all(l);const c=ln(ft(be,"campaignStories"),zt("partyId","==",n)),h=(await Wn(c)).docs.map(m=>id(m.ref));await Promise.all(h)}catch(t){Pe(t,"disbandParty")}},oI=async n=>{try{const e=ln(ft(be,"parties"),zt("inviteCode","==",n)),t=await Wn(e);if(t.empty)return null;const r=t.docs[0];return{id:r.id,...r.data()}}catch(e){Pe(e,"getPartyByInviteCode")}},Ko=async n=>{try{const e=Ze(be,"parties",n),t=await On(e);return t.exists()?{id:t.id,...t.data()}:null}catch(e){Pe(e,"getPartyById")}},JM=async(n,e)=>{try{const t={...e,partyId:n,createdAt:Le(),updatedAt:Le()};return{id:(await Es(ft(be,"campaigns"),t)).id,...t}}catch(t){Pe(t,"saveCampaign")}},XM=async n=>{try{const e=ln(ft(be,"campaigns"),zt("partyId","==",n)),t=await Wn(e);if(t.empty)return null;const r=t.docs[0];return{id:r.id,...r.data()}}catch(e){Pe(e,"getCampaignByParty")}},ZM=async(n,e)=>{try{const t=Ze(be,"campaigns",n);await Ft(t,{...e,updatedAt:Le()})}catch(t){Pe(t,"updateCampaign")}},e4=async(n,e)=>{try{const t={...e,partyId:n,status:"active",createdAt:Le(),updatedAt:Le()};return{id:(await Es(ft(be,"combats"),t)).id,...t}}catch(t){Pe(t,"saveCombat")}},t4=async n=>{try{const e=ln(ft(be,"combats"),zt("partyId","==",n),zt("status","==","active")),t=await Wn(e);return t.empty?null:t.docs.map(i=>({id:i.id,...i.data()})).sort((i,a)=>{var d,h,m,p;const l=((h=(d=i.createdAt)==null?void 0:d.toDate)==null?void 0:h.call(d))||i.createdAt||new Date(0);return(((p=(m=a.createdAt)==null?void 0:m.toDate)==null?void 0:p.call(m))||a.createdAt||new Date(0))-l})[0]}catch(e){Pe(e,"getActiveCombat")}},n4=async(n,e)=>{try{const t=Ze(be,"combats",n);await Ft(t,{...e,updatedAt:Le()})}catch(t){Pe(t,"updateCombat")}},S0=(n,e)=>{const t=Ze(be,"parties",n);return ua(t,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})},r4=(n,e)=>{const t=ln(ft(be,"campaigns"),zt("partyId","==",n));return ua(t,r=>{if(r.empty)e(null);else{const s=r.docs[0];e({id:s.id,...s.data()})}})},s4=(n,e)=>{const t=ln(ft(be,"combats"),zt("partyId","==",n),zt("status","==","active"));return ua(t,r=>{if(r.empty)e(null);else{const s=r.docs[0];e({id:s.id,...s.data()})}})},lI=async n=>{try{const e={partyId:n,status:"ready_up",currentPlot:null,storyMessages:[],votingSession:null,readyPlayers:[],lastUpdated:Le(),createdAt:Le()};return{id:(await Es(ft(be,"campaignStories"),e)).id,...e}}catch(e){Pe(e,"createCampaignStory")}},Nt=async n=>{try{const e=ln(ft(be,"campaignStories"),zt("partyId","==",n)),t=await Wn(e);if(t.empty)return null;const r=t.docs[0];return{id:r.id,...r.data()}}catch(e){Pe(e,"getCampaignStory")}},st=async(n,e)=>{try{const t=Ze(be,"campaignStories",n);await Ft(t,{...e,lastUpdated:Le()})}catch(t){Pe(t,"updateCampaignStory")}},i4=async(n,e)=>{try{const t=Ze(be,"campaignStories",n),s=(await On(t)).data(),i={id:`msg_${Date.now()}`,...e,timestamp:new Date};return await Ft(t,{storyMessages:[...s.storyMessages,i],lastUpdated:Le()}),i}catch(t){Pe(t,"addStoryMessage")}},cI=async(n,e)=>{try{const t=Ze(be,"campaignStories",n),i=(await On(t)).data().readyPlayers||[];i.includes(e)||await Ft(t,{readyPlayers:[...i,e],lastUpdated:Le()})}catch(t){Pe(t,"setPlayerReady")}},uI=(n,e)=>{try{const t=Ze(be,"campaignStories",n);return ua(t,r=>{r.exists()?e({id:r.id,...r.data()}):e(null)})}catch(t){Pe(t,"subscribeToCampaignStory")}},dI=async(n,e)=>{try{const t=Ze(be,"campaignStories",n);await Ft(t,{currentSpeaker:e,lastUpdated:Le()})}catch(t){Pe(t,"setCurrentSpeaker")}},a4=async(n,e)=>{try{const t=Ze(be,"campaignStories",n);await Ft(t,{currentController:e,lastUpdated:Le()})}catch(t){Pe(t,"setCurrentController")}},o4=async(n,e)=>{try{const t={partyId:n,status:"active",storyContext:e.storyContext,partyMembers:e.partyMembers,enemies:e.enemies,combatants:e.combatants,initiative:e.initiative,currentTurn:e.currentTurn||0,round:e.round||1,combatState:e.combatState||"active",environmentalFeatures:e.environmentalFeatures,teamUpOpportunities:e.teamUpOpportunities,narrativeElements:e.narrativeElements,battleLog:e.battleLog||[],createdAt:Le(),updatedAt:Le()};return{id:(await Es(ft(be,"combatSessions"),t)).id,...t}}catch(t){Pe(t,"createCombatSession")}},hI=async n=>{try{const e=Ze(be,"combatSessions",n),t=await On(e);return t.exists()?{id:t.id,...t.data()}:null}catch(e){Pe(e,"getCombatSession")}},Di=async(n,e)=>{try{console.log(" updateCombatSession called with:",{combatId:n,updates:e});const t=Ze(be,"combatSessions",n);await Ft(t,{...e,lastUpdated:Le()}),console.log(" updateCombatSession completed successfully")}catch(t){console.error(" Error in updateCombatSession:",t),Pe(t,"updateCombatSession")}},mI=(n,e)=>{try{console.log(" Setting up combat session subscription for:",n);const t=Ze(be,"combatSessions",n);return ua(t,s=>{if(console.log(" Combat session subscription update received:",s.exists()?"Document exists":"Document does not exist"),s.exists()){const i={id:s.id,...s.data()};console.log(" Combat session data from subscription:",i),e(i)}else console.log(" Combat session document does not exist"),e(null)})}catch(t){console.error(" Error in subscribeToCombatSession:",t),Pe(t,"subscribeToCombatSession")}},fI=async(n,e)=>{try{const t=await va(n);if(!t)throw new Error("User profile not found");const r={id:HM(),...e,createdAt:new Date},i=[...t.characterPresets||[],r];return await Ft(Ze(be,"userProfiles",t.id),{characterPresets:i}),r}catch(t){throw new Error(`Failed to save character preset: ${t.message}`)}},pI=async n=>{try{const e=await va(n);return e?e.characterPresets||[]:[]}catch(e){Pe(e,"getUserCharacterPresets")}},gI=async(n,e)=>{try{const t=await va(n);if(!t)throw new Error("User profile not found");const s=(t.characterPresets||[]).filter(a=>a.id!==e),i=Ze(be,"userProfiles",t.id);await Ft(i,{characterPresets:s,updatedAt:Le()})}catch(t){Pe(t,"deleteCharacterPreset")}},l4=async(n,e)=>{try{const t=Ze(be,"campaignStories",n),a={...(await On(t)).data().campaignMetadata||{},...e,lastUpdated:Le()};return await Ft(t,{campaignMetadata:a,lastUpdated:Le()}),a}catch(t){Pe(t,"updateCampaignMetadata")}},c4=async(n,e)=>{try{const t=Ze(be,"campaignStories",n),i=(await On(t)).data().campaignSessions||[],a={id:`session_${Date.now()}`,...e,timestamp:Le()};return await Ft(t,{campaignSessions:[...i,a],lastUpdated:Le()}),a}catch(t){Pe(t,"saveCampaignSession")}},u4=async(n,e)=>{try{const t=Ze(be,"campaignStories",n),i=(await On(t)).data().campaignNotes||[],a={id:`note_${Date.now()}`,content:e.content,type:e.type||"general",timestamp:Le(),createdBy:e.createdBy};return await Ft(t,{campaignNotes:[...i,a],lastUpdated:Le()}),a}catch(t){Pe(t,"addCampaignNote")}},d4=async(n,e)=>{try{const t=Ze(be,"campaignStories",n);await Ft(t,{"campaignMetadata.mainGoal":e,lastUpdated:Le()})}catch(t){Pe(t,"updateCampaignGoal")}},h4=async(n,e)=>{try{const t=Ze(be,"campaignStories",n);return await Ft(t,{storyState:{...e,lastUpdated:Le()},lastUpdated:Le()}),e}catch(t){Pe(t,"saveStoryState")}},m4=async n=>{try{const e=Ze(be,"campaignStories",n);return(await On(e)).data().storyState||null}catch(e){Pe(e,"getStoryState")}},f4=async(n,e)=>{try{const t=Ze(be,"campaignStories",n),a={...(await On(t)).data().storyState||{},...e,lastUpdated:Le()};return await Ft(t,{storyState:a,lastUpdated:Le()}),a}catch(t){Pe(t,"updateStoryState")}},p4=async(n,e)=>{try{const t=(e.partyMembers||[]).map(l=>({...l,id:l.id,isEnemy:!1,userId:l.userId,cooldowns:{},statusEffects:[]})),r=(e.enemies||[]).map(l=>({...l,id:l.id,isEnemy:!0,userId:null,cooldowns:{},statusEffects:[]})),s=[...t,...r],i={partyId:n,status:"active",storyContext:e.storyContext,partyMembers:e.partyMembers,enemies:e.enemies,combatants:s,initiative:e.initiative||[],currentTurn:0,round:1,combatState:"preparation",environmentalFeatures:e.environmentalFeatures||[],teamUpOpportunities:e.teamUpOpportunities||[],narrativeElements:e.narrativeElements||{},statusEffects:{},cooldowns:{},createdAt:Le(),updatedAt:Le()};return{id:(await Es(ft(be,"combatSessions"),i)).id,...i}}catch(t){Pe(t,"createEnhancedCombatSession")}},pp=async(n,e)=>{try{const t=Ze(be,"combatSessions",n);await Ft(t,{...e,updatedAt:Le()})}catch(t){Pe(t,"updateCombatSessionWithNarrative")}},yI=async(n,e)=>{try{console.log(" Adding to combat battle log:",{combatId:n,logEntry:e});const t=Ze(be,"combatSessions",n),r=await On(t);if(r.exists()){const a=[...r.data().battleLog||[],e];await Ft(t,{battleLog:a,lastUpdated:Le()}),console.log(" Battle log updated successfully")}}catch(t){console.error(" Error in addToCombatBattleLog:",t),Pe(t,"addToCombatBattleLog")}},g4=async(n,e,t=null)=>{var r,s;try{const i=Ze(be,"campaignStories",n),l=(await On(i)).data(),c={id:`msg_${Date.now()}`,...e,timestamp:new Date,metadata:{storyStateSnapshot:t?{currentLocation:(r=t.currentLocation)==null?void 0:r.name,activeNPCs:Object.keys(t.activeNPCs||{}),activePlotThreads:((s=t.activePlotThreads)==null?void 0:s.map(d=>d.title))||[],characterRelationships:t.characterArcs?Object.entries(t.characterArcs).map(([d,h])=>({characterId:d,relationships:Object.keys(h.relationships||{})})):[]}:null}};return await Ft(i,{storyMessages:[...l.storyMessages,c],lastUpdated:Le()}),c}catch(i){Pe(i,"addStoryMessageWithMetadata")}},y4=async n=>{var e,t,r,s;try{const i=Ze(be,"campaignStories",n),l=(await On(i)).data();return{storyState:l.storyState||null,campaignMetadata:l.campaignMetadata||null,recentMessages:((e=l.storyMessages)==null?void 0:e.slice(-10))||[],activeNPCs:((t=l.storyState)==null?void 0:t.activeNPCs)||{},characterArcs:((r=l.storyState)==null?void 0:r.characterArcs)||{},plotThreads:((s=l.storyState)==null?void 0:s.activePlotThreads)||[]}}catch(i){Pe(i,"getStoryConsistencyData")}},vI=async n=>{try{const e=Ze(be,"characters",n),t=await On(e);if(!t.exists())throw new Error(`Character document with ID ${n} does not exist`);const r=t.data(),s=T0(r);return await Ft(e,{...s,updatedAt:new Date}),{id:n,...r,...s}}catch(e){throw new Error(`Failed to recalculate character stats: ${e.message}`)}},xI=async n=>{try{const t=(await hs(n)).filter(s=>!s.hp||!s.maxHp||!s.ac).map(s=>vI(s.id));return await Promise.all(t)}catch(e){throw new Error(`Failed to update party character stats: ${e.message}`)}},v4=Object.freeze(Object.defineProperty({__proto__:null,addCampaignNote:u4,addStoryMessage:i4,addStoryMessageWithMetadata:g4,addToCombatBattleLog:yI,checkUsernameAvailability:eI,cleanupOrphanedCharacters:YM,createCampaignStory:lI,createCombatSession:o4,createEnhancedCombatSession:p4,createParty:rI,createUserProfile:ZS,db:be,debugUserCharacters:QM,deleteCharacter:eh,deleteCharacterPreset:gI,disbandParty:aI,getActiveCombat:t4,getCampaignByParty:XM,getCampaignStory:Nt,getCharacterByUserAndParty:nI,getCombatSession:hI,getPartyById:Ko,getPartyByInviteCode:oI,getPartyCharacters:hs,getPublicParties:iI,getStoryConsistencyData:y4,getStoryState:m4,getUserCharacterPresets:pI,getUserCharacters:Ul,getUserParties:sI,getUserProfile:va,getUserProfiles:Zd,joinParty:fp,recalculateCharacterStats:vI,saveCampaign:JM,saveCampaignSession:c4,saveCharacter:tI,saveCharacterPreset:fI,saveCombat:e4,saveStoryState:h4,setCurrentController:a4,setCurrentSpeaker:dI,setPlayerReady:cI,subscribeToCampaign:r4,subscribeToCampaignStory:uI,subscribeToCombat:s4,subscribeToCombatSession:mI,subscribeToParty:S0,updateCampaign:ZM,updateCampaignGoal:d4,updateCampaignMetadata:l4,updateCampaignStory:st,updateCharacter:KM,updateCombat:n4,updateCombatSession:Di,updateCombatSessionWithNarrative:pp,updatePartyCharacterStats:xI,updateStoryState:f4,updateUserProfile:GM},Symbol.toStringTag,{value:"Module"})),bI=()=>{const[n,e]=I.useState(null),[t,r]=I.useState(!0);return I.useEffect(()=>bE(ds,i=>{e(i),r(!1)}),[]),{user:n,loading:t}},x4=async(n,e,t)=>{try{if(console.log("Starting registration for:",n,t),!await eI(t))return console.log("Username not available:",t),{user:null,error:"Username is already taken. Please choose a different username."};console.log("Username available:",t);const s=await GP(ds,n,e);console.log("User created successfully:",s.user.uid);try{await ZS(s.user.uid,{username:t,email:n,displayName:t}),console.log("User profile created successfully")}catch(a){console.error("Error creating user profile:",a)}let i=!1;try{await QP(s.user),console.log("Email verification sent successfully"),i=!0}catch(a){console.error("Error sending email verification:",a)}return await wE(ds),console.log("User signed out after registration"),{user:null,error:null,success:!0}}catch(r){return console.error("Registration error:",r),{user:null,error:r.message}}},b4=async(n,e)=>{try{return{user:(await KP(ds,n,e)).user,error:null}}catch(t){return{user:null,error:t.message}}},w4=async()=>{try{return await wE(ds),{error:null}}catch(n){return{error:n.message}}},xa=n=>bE(ds,async e=>{n(e)}),_4=async()=>{try{return console.log("Testing Firebase connection..."),console.log("Auth domain:",ds.config.authDomain),console.log("Project ID:",ds.config.projectId),{success:!0,message:"Firebase connection successful"}}catch(n){return console.error("Firebase connection test failed:",n),{success:!1,error:n.message}}};function E4(){const[n,e]=I.useState(null),[t,r]=I.useState(null),[s,i]=I.useState(!1),[a,l]=I.useState(!1),c=hr(),h=ps().pathname==="/dashboard";I.useEffect(()=>{const y=xa(async v=>{if(e(v),v)try{const S=await va(v.uid);r(S)}catch(S){console.error("Error loading user profile:",S)}else r(null)});return()=>y()},[c]);const m=async()=>{const{error:y}=await w4();y||(c("/"),l(!1),i(!1))},p=()=>{if(t!=null&&t.username)return t.username;if(n!=null&&n.displayName)return n.displayName;if(n!=null&&n.email){const y=n.email.split("@")[0];if(y.length>15){const v=y.split(/[._]/)[0];return v.charAt(0).toUpperCase()+v.slice(1)}return y}return"Adventurer"};return o.jsx("nav",{className:"bg-gradient-to-r from-slate-900 to-slate-800 text-slate-100 shadow-lg border-b border-slate-600/50 backdrop-blur-sm",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"flex justify-between items-center py-4",children:[o.jsxs(Vs,{to:"/",className:"flex items-center space-x-2 group",children:[o.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-amber-500 to-orange-500 rounded-lg flex items-center justify-center",children:o.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx("span",{className:"text-xl sm:text-2xl font-bold bg-gradient-to-r from-amber-400 to-orange-400 bg-clip-text text-transparent group-hover:from-amber-300 group-hover:to-orange-300 transition-all duration-300",children:"DND-V1"})]}),o.jsx("div",{className:"hidden md:flex items-center space-x-2",children:n?o.jsxs(o.Fragment,{children:[!h&&o.jsx(Vs,{to:"/dashboard",className:"px-4 py-2 text-slate-200 hover:text-amber-400 font-medium transition-colors duration-300",children:"Dashboard"}),o.jsxs("div",{className:"relative ml-4",children:[o.jsxs("button",{onClick:()=>i(!s),className:"flex items-center space-x-2 px-4 py-2 bg-slate-700/50 hover:bg-slate-600/50 rounded-lg transition-all duration-300 border border-slate-600/50 hover:border-slate-500/50",children:[o.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-xs font-bold text-white",children:p().charAt(0).toUpperCase()})}),o.jsx("span",{className:"text-slate-200 font-medium",children:p()}),o.jsx("svg",{className:`w-4 h-4 text-slate-400 transition-transform duration-300 ${s?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),s&&o.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-slate-800/95 backdrop-blur-sm rounded-xl shadow-2xl border border-slate-600/50 z-50",children:o.jsxs("div",{className:"p-4",children:[o.jsxs("div",{className:"flex items-center space-x-3 pb-3 border-b border-slate-600/50",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-sm font-bold text-white",children:p().charAt(0).toUpperCase()})}),o.jsxs("div",{className:"min-w-0 flex-1",children:[o.jsx("div",{className:"font-semibold text-slate-200",children:p()}),o.jsx("div",{className:"text-xs text-slate-400 truncate",children:n.email})]})]}),o.jsxs("button",{onClick:m,className:"w-full flex items-center space-x-2 px-3 py-2 text-sm text-slate-200 hover:bg-slate-700/50 rounded-lg transition-colors duration-300 mt-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),o.jsx("span",{children:"Logout"})]})]})})]})]}):o.jsx(Vs,{to:"/login",className:"px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",children:"Login"})}),o.jsx("div",{className:"md:hidden",children:o.jsx("button",{onClick:()=>l(!a),className:"p-2 text-slate-200 hover:text-amber-400 transition-colors duration-300",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a?o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})})]}),a&&o.jsx("div",{className:"md:hidden pb-4 border-t border-slate-600/50",children:n?o.jsxs("div",{className:"pt-4 space-y-2",children:[!h&&o.jsx(Vs,{to:"/dashboard",className:"block px-4 py-3 text-slate-200 hover:text-amber-400 hover:bg-slate-700/50 rounded-lg transition-all duration-300",onClick:()=>l(!1),children:"Dashboard"}),o.jsxs("div",{className:"pt-4 border-t border-slate-600/50",children:[o.jsxs("div",{className:"flex items-center space-x-3 px-4 py-3",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-sm font-bold text-white",children:p().charAt(0).toUpperCase()})}),o.jsxs("div",{className:"min-w-0 flex-1",children:[o.jsx("div",{className:"font-semibold text-slate-200",children:p()}),o.jsx("div",{className:"text-xs text-slate-400 truncate",children:n.email})]})]}),o.jsxs("button",{onClick:m,className:"w-full flex items-center space-x-2 px-4 py-3 text-slate-200 hover:bg-slate-700/50 rounded-lg transition-colors duration-300",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),o.jsx("span",{children:"Logout"})]})]})]}):o.jsx("div",{className:"pt-4",children:o.jsx(Vs,{to:"/login",className:"block w-full px-4 py-3 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold rounded-lg transition-all duration-300 text-center",onClick:()=>l(!1),children:"Login"})})})]})})}const T4="modulepreload",S4=function(n){return"/DND-V1/"+n},db={},Ai=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=S4(i),i in db)return;db[i]=!0;const a=i.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const m=s[h];if(m.href===i&&(!a||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${l}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":T4,a||(d.as="script",d.crossOrigin=""),d.href=i,document.head.appendChild(d),a)return new Promise((h,m)=>{d.addEventListener("load",h),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i})};class wI{constructor(){this.actionTypes={attack:{name:"Attack",cooldown:0,priority:"normal",description:"A basic physical attack",narrativeTemplate:"{character} {action} with {weapon}!"},spell:{name:"Cast Spell",cooldown:1,priority:"normal",description:"Cast a magical spell",narrativeTemplate:"{character} channels arcane energy into {spell}!"},special:{name:"Special Ability",cooldown:2,priority:"high",description:"Use a special class ability",narrativeTemplate:"{character} unleashes their {ability}!"},item:{name:"Use Item",cooldown:0,priority:"low",description:"Use an item or consumable",narrativeTemplate:"{character} uses {item}!"},defend:{name:"Defend",cooldown:0,priority:"high",description:"Take a defensive stance",narrativeTemplate:"{character} takes a defensive stance!"},environmental:{name:"Environmental Action",cooldown:1,priority:"normal",description:"Use the environment to your advantage",narrativeTemplate:"{character} uses the {environment} to their advantage!"},teamUp:{name:"Team Up",cooldown:3,priority:"high",description:"Coordinate with another party member",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}},this.statusEffects={poisoned:{name:"Poisoned",duration:3,effect:"lose 1 HP per turn",narrative:"is suffering from poison"},burned:{name:"Burned",duration:2,effect:"lose 2 HP per turn",narrative:"is burning with magical flames"},frozen:{name:"Frozen",duration:1,effect:"skip next turn",narrative:"is frozen solid"},paralyzed:{name:"Paralyzed",duration:2,effect:"50% chance to skip turn",narrative:"is paralyzed and can barely move"},confused:{name:"Confused",duration:2,effect:"may attack randomly",narrative:"is confused and disoriented"},blessed:{name:"Blessed",duration:3,effect:"+2 to attack rolls",narrative:"is blessed with divine favor"},hasted:{name:"Hasted",duration:2,effect:"extra action per turn",narrative:"is moving with supernatural speed"}},this.classAbilities={fighter:{name:"Second Wind",description:"Recover some HP",effect:"heal 1d6+2 HP",cooldown:3},wizard:{name:"Arcane Surge",description:"Enhance next spell",effect:"+2 to spell damage",cooldown:2},rogue:{name:"Sneak Attack",description:"Deal extra damage from stealth",effect:"+1d6 damage if target is unaware",cooldown:1},cleric:{name:"Divine Favor",description:"Bless an ally",effect:"target gets +1 to all rolls",cooldown:2}}}initializeCombat(e,t,r){return{combatants:[...e,...t].map(a=>({...a,initiative:this.calculateInitiative(a),statusEffects:[],cooldowns:{},lastAction:null,turnCount:0})).sort((a,l)=>l.initiative-a.initiative),currentTurn:0,round:1,combatState:"active",storyContext:r,environmentalFeatures:this.extractEnvironmentalFeatures(r),teamUpOpportunities:this.identifyTeamUpOpportunities(e),narrativeElements:this.extractNarrativeElements(r)}}async createCombatSession(e,t,r,s){try{const{createCombatSession:i}=await Ai(()=>Promise.resolve().then(()=>v4),void 0);await this.cleanupOldCombatSessions(e);const a=await this.getExistingCombatSession(e);if(a)return console.log(" Found existing combat session:",a.id),a;const l=this.preparePartyMembers(t),c=this.prepareEnemies(r),d=this.initializeCombat(l,c,s),h=await i(e,{storyContext:d.storyContext,partyMembers:d.combatants.filter(m=>!m.id.startsWith("enemy_")),enemies:d.combatants.filter(m=>m.id.startsWith("enemy_")),combatants:d.combatants,initiative:d.combatants.map(m=>({id:m.id,name:m.name,initiative:m.initiative})),currentTurn:d.currentTurn,round:d.round,combatState:d.combatState,environmentalFeatures:d.environmentalFeatures,teamUpOpportunities:d.teamUpOpportunities,narrativeElements:d.narrativeElements});return console.log(" Created new combat session:",h.id),h}catch(i){throw console.error(" Error creating combat session:",i),i}}async getExistingCombatSession(e){try{const{collection:t,query:r,where:s,getDocs:i,updateDoc:a,doc:l}=await Ai(()=>import("./index.esm-cbc72e58.js"),[]),{db:c}=await Ai(()=>Promise.resolve().then(()=>Um),void 0),d=t(c,"combatSessions"),h=r(d,s("partyId","==",e),s("status","==","active")),m=await i(h);if(!m.empty){const p=m.docs[0];return console.log(" Found existing combat session:",p.id),{id:p.id,...p.data()}}return null}catch(t){return console.error("Error checking for existing combat session:",t),null}}async cleanupOldCombatSessions(e){var t,r;console.log(` Starting cleanup for party ${e}`);try{const{collection:s,query:i,where:a,getDocs:l,updateDoc:c,doc:d}=await Ai(()=>import("./index.esm-cbc72e58.js"),[]),{db:h}=await Ai(()=>Promise.resolve().then(()=>Um),void 0),m=s(h,"combatSessions"),p=i(m,a("partyId","==",e),a("status","==","active")),y=await l(p);if(y.size>1){console.log(` Found ${y.size} active combat sessions for party ${e}, cleaning up...`);const k=y.docs.map(M=>({id:M.id,...M.data()}));k.sort((M,F)=>{var N,A,j,D;const w=((A=(N=M.createdAt)==null?void 0:N.toDate)==null?void 0:A.call(N))||M.createdAt||new Date(0);return(((D=(j=F.createdAt)==null?void 0:j.toDate)==null?void 0:D.call(j))||F.createdAt||new Date(0))-w});for(let M=1;M<k.length;M++){const F=d(h,"combatSessions",k[M].id);await c(F,{status:"ended",combatState:"ended",endedAt:new Date,reason:"cleanup_duplicate"}),console.log(` Marked old session ${k[M].id} as ended`)}}const v=i(m,a("partyId","==",e),a("status","==","active")),S=await l(v),E=new Date(Date.now()-5*60*1e3);for(const k of S.docs){const M=k.data();if((((r=(t=M.createdAt)==null?void 0:t.toDate)==null?void 0:r.call(t))||M.createdAt||new Date(0))<E){const w=k(h,"combatSessions",k.id);await c(w,{status:"ended",combatState:"ended",endedAt:new Date,reason:"cleanup_stuck"}),console.log(` Marked stuck session ${k.id} as ended (older than 5 minutes)`)}}const _=s(h,"combats"),x=i(_,a("partyId","==",e),a("status","==","active")),C=await l(x);if(!C.empty){console.log(` Found ${C.size} old combat sessions in legacy collection, cleaning up...`);for(const k of C.docs){const M=k(h,"combats",k.id);await c(M,{status:"ended",endedAt:new Date,reason:"cleanup_legacy"}),console.log(` Marked legacy combat ${k.id} as ended`)}}}catch(s){console.error("Error cleaning up old combat sessions:",s)}}async forceCleanupCombatSessions(e){console.log(` Force cleaning up all combat sessions for party ${e}`);try{const{collection:t,query:r,where:s,getDocs:i,updateDoc:a,doc:l}=await Ai(()=>import("./index.esm-cbc72e58.js"),[]),{db:c}=await Ai(()=>Promise.resolve().then(()=>Um),void 0),d=t(c,"combatSessions"),h=r(d,s("partyId","==",e),s("status","==","active")),m=await i(h);if(!m.empty){console.log(` Found ${m.size} active combat sessions, marking all as ended`);for(const S of m.docs){const E=S(c,"combatSessions",S.id);await a(E,{status:"ended",combatState:"ended",endedAt:new Date,reason:"force_cleanup"}),console.log(` Force marked session ${S.id} as ended`)}}const p=t(c,"combats"),y=r(p,s("partyId","==",e),s("status","==","active")),v=await i(y);if(!v.empty){console.log(` Found ${v.size} legacy combat sessions, marking all as ended`);for(const S of v.docs){const E=S(c,"combats",S.id);await a(E,{status:"ended",endedAt:new Date,reason:"force_cleanup_legacy"}),console.log(` Force marked legacy combat ${S.id} as ended`)}}return console.log(` Force cleanup completed for party ${e}`),!0}catch(t){return console.error("Error in force cleanup:",t),!1}}preparePartyMembers(e){return e.map(t=>{var a,l,c,d,h,m,p,y;let r=t.hp,s=t.maxHp;if(!r||!s){const S={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[t.class]||8,E=((a=t.assignedScores)==null?void 0:a.constitution)||10,_=Math.floor((E-10)/2),x=Math.max(1,(S+_)*(t.level||1));r=x,s=x}let i=t.ac;if(!i){const S=((l=t.assignedScores)==null?void 0:l.dexterity)||10,E=Math.floor((S-10)/2),x={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[t.class]||0;i=Math.max(10,10+E+x)}return{...t,hp:r,maxHp:s,ac:i,initiative:Math.floor(Math.random()*20)+1,strength:((c=t.assignedScores)==null?void 0:c.strength)||10,dexterity:((d=t.assignedScores)==null?void 0:d.dexterity)||10,constitution:((h=t.assignedScores)==null?void 0:h.constitution)||10,intelligence:((m=t.assignedScores)==null?void 0:m.intelligence)||10,wisdom:((p=t.assignedScores)==null?void 0:p.wisdom)||10,charisma:((y=t.assignedScores)==null?void 0:y.charisma)||10,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0}})}prepareEnemies(e){return!e||e.length===0?[{id:"enemy_0",name:"Gnoll Pack",hp:20,maxHp:20,ac:12,level:1,class:"enemy",race:"unknown",initiative:Math.floor(Math.random()*20)+1,strength:12,dexterity:10,constitution:12,intelligence:8,wisdom:8,charisma:6},{id:"enemy_1",name:"Gnoll Pack-Leader",hp:25,maxHp:25,ac:14,level:2,class:"enemy",race:"unknown",initiative:Math.floor(Math.random()*20)+1,strength:14,dexterity:12,constitution:14,intelligence:10,wisdom:10,charisma:8}]:e.map((t,r)=>({id:t.id||`enemy_${r}`,name:t.name||`Enemy ${r+1}`,hp:t.hp||20,maxHp:t.maxHp||t.hp||20,ac:t.ac||12,level:t.level||1,class:t.class||"enemy",race:t.race||"unknown",initiative:t.initiative||Math.floor(Math.random()*20)+1,strength:t.strength||12,dexterity:t.dexterity||10,constitution:t.constitution||12,intelligence:t.intelligence||8,wisdom:t.wisdom||8,charisma:t.charisma||6,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0}))}calculateInitiative(e){var s,i,a;let t=Math.floor(Math.random()*20)+1;return t+={rogue:3,monk:2,ranger:1,fighter:0,cleric:0,wizard:-1,paladin:-1}[(s=e.class)==null?void 0:s.toLowerCase()]||0,(i=e.statusEffects)!=null&&i.includes("hasted")&&(t+=5),(a=e.statusEffects)!=null&&a.includes("paralyzed")&&(t-=3),t}extractEnvironmentalFeatures(e){const t=[],r={forest:["trees","cover","difficult terrain"],cave:["darkness","echoes","tight spaces"],tavern:["furniture","crowds","flammable materials"],castle:["stone walls","narrow corridors","defensive positions"],dungeon:["traps","darkness","confined spaces"],outdoors:["weather","open space","natural cover"]},s=e.toLowerCase();return Object.entries(r).forEach(([i,a])=>{s.includes(i)&&t.push(...a)}),t}identifyTeamUpOpportunities(e){const t=[];return[{classes:["fighter","rogue"],description:"Fighter distracts while Rogue sneaks in for a backstab"},{classes:["wizard","cleric"],description:"Wizard casts area spell while Cleric protects the party"},{classes:["fighter","cleric"],description:"Fighter tanks while Cleric provides healing support"},{classes:["rogue","wizard"],description:"Rogue scouts while Wizard provides magical backup"}].forEach(s=>{s.classes.every(a=>e.some(l=>{var c;return((c=l.class)==null?void 0:c.toLowerCase())===a}))&&t.push(s)}),t}extractNarrativeElements(e){return{mood:this.determineCombatMood(e),stakes:this.determineStakes(e),environmentalHazards:this.identifyHazards(e),npcInvolvement:this.extractNPCs(e)}}determineCombatMood(e){const t=e.toLowerCase();return t.includes("desperate")||t.includes("last stand")?"desperate":t.includes("training")||t.includes("practice")?"casual":t.includes("revenge")||t.includes("vengeance")?"vengeful":t.includes("defense")||t.includes("protect")?"defensive":"standard"}determineStakes(e){const t=e.toLowerCase();return t.includes("life")||t.includes("death")||t.includes("kill")?"life_or_death":t.includes("escape")||t.includes("flee")?"escape":t.includes("capture")||t.includes("arrest")?"capture":t.includes("treasure")||t.includes("loot")?"treasure":"standard"}identifyHazards(e){const t=[],r=e.toLowerCase();return(r.includes("fire")||r.includes("flame"))&&t.push("fire"),(r.includes("water")||r.includes("river")||r.includes("lake"))&&t.push("water"),(r.includes("height")||r.includes("cliff")||r.includes("fall"))&&t.push("height"),(r.includes("trap")||r.includes("pit"))&&t.push("traps"),t}extractNPCs(e){const t=[];return[/(\w+)\s+(?:the\s+)?(?:guard|merchant|wizard|knight|rogue|priest)/gi,/(?:named|called)\s+(\w+)/gi].forEach(s=>{[...e.matchAll(s)].forEach(a=>{t.push(a[1])})}),t}async executeAction(e,t,r,s,i={}){var S,E;console.log(" executeAction called with:",{combatantId:t,actionType:r,targetId:s,additionalData:i});const a=e.combatants.find(_=>_.id===t);let l=e.combatants.find(_=>_.id===s);if(r==="defend"&&!l&&(l=a),console.log(" Found combatant and target:",{combatant:a?{name:a.name,hp:a.hp,maxHp:a.maxHp}:null,target:l?{name:l.name,hp:l.hp,maxHp:l.maxHp}:null}),!a)throw new Error("Invalid combatant");if(!l&&r!=="defend")throw new Error("Invalid target");if(a.cooldowns&&a.cooldowns[r]>0)return{success:!1,message:`${a.name} cannot use ${r} yet (cooldown: ${a.cooldowns[r]} turns)`};const c=this.generateActionNarrative(a,r,l,i),d=this.calculateActionResults(a,r,l,i);console.log(" Action results calculated:",d),this.applyActionEffects(e,a,l,d),this.updateCooldowns(e,a,r);const h=this.checkStatusEffectApplication(a,r,l,d);let m=(e.currentTurn+1)%e.combatants.length,p=0;const y=e.combatants.length;for(;p<y;){const _=e.combatants[m];if(_&&_.hp>0)break;m=(m+1)%e.combatants.length,p++}p>=y&&(console.log(" No alive combatants found, keeping current turn"),m=e.currentTurn);const v={...e,currentTurn:m};return m===0&&(v.round=v.round+1),console.log(" Turn progression in executeAction:",{currentTurn:e.currentTurn,nextTurnIndex:m,totalCombatants:e.combatants.length,nextCombatant:(S=e.combatants[m])==null?void 0:S.name,nextCombatantHp:(E=e.combatants[m])==null?void 0:E.hp,round:v.round,attempts:p}),console.log(" executeAction returning result with damage:",d.damage),console.log(" Target HP after executeAction:",l.hp),console.log(" Updated session currentTurn:",v.currentTurn),{success:!0,narrative:c,results:d,statusEffects:h,environmentalImpact:this.calculateEnvironmentalImpact(e,r,d),targetId:s,updatedSession:v,damage:d.damage,healing:d.healing}}generateActionNarrative(e,t,r,s){let a=this.actionTypes[t].narrativeTemplate;a=a.replace("{character}",e.name),a=a.replace("{action}",this.getActionVerb(t,e.class)),a=a.replace("{weapon}",s.weapon||"their weapon"),a=a.replace("{spell}",s.spell||"a spell"),a=a.replace("{ability}",s.ability||"special ability"),a=a.replace("{item}",s.item||"an item"),a=a.replace("{environment}",s.environment||"surroundings"),a=a.replace("{ally}",s.ally||"ally"),s.specialAttack&&s.specialAttack!=="Standard Action"&&(a=`${e.name} uses ${s.specialAttack}! `+a),s.damageType&&s.damageType!=="physical"&&(a+=` The attack deals ${s.damageType} damage.`);const l=this.getClassFlavor(e.class,t);return l&&(a+=` ${l}`),a}getActionVerb(e,t){var s;return((s={fighter:{attack:"charges forward with a mighty swing",defend:"raises their shield defensively",special:"unleashes their combat expertise"},wizard:{attack:"casts a magical bolt",spell:"weaves arcane energy",special:"channels pure magical power"},rogue:{attack:"strikes from the shadows",defend:"dodges and weaves",special:"executes a perfect sneak attack"},cleric:{attack:"calls upon divine power",spell:"prays for divine intervention",special:"channels holy energy"}}[t==null?void 0:t.toLowerCase()])==null?void 0:s[e])||"performs an action"}getClassFlavor(e,t){var s;return((s={priest:{attack:"Divine energy crackles around their weapon.",spell:"Holy light emanates from their hands.",heal:"A warm, healing glow surrounds them."},wizard:{attack:"Arcane energy flows through their weapon.",spell:"Mystical runes appear in the air.",special:"Ancient magic surges through them."},warrior:{attack:"Their combat training shows in every move.",special:"Years of battle experience guide their strike.",defend:"They adopt a defensive stance with practiced ease."},rogue:{attack:"They move with deadly precision.",special:"Shadow and stealth enhance their attack.",defend:"They dodge and weave with acrobatic grace."},boss:{attack:"Their overwhelming presence fills the battlefield.",special:"Ancient power courses through their veins.",spell:"Reality itself seems to bend to their will."},undead:{attack:"Necrotic energy pulses from their form.",spell:"Death magic swirls around them.",special:"The very air grows cold with their presence."}}[e==null?void 0:e.toLowerCase()])==null?void 0:s[t])||""}calculateActionResults(e,t,r,s){const i={damage:0,healing:0,statusEffects:[],environmentalEffects:[],narrative:"",specialAttack:s.specialAttack||"Standard Action",damageType:s.damageType||"physical",attribute:s.attribute||"strength"};switch(t){case"attack":i.damage=this.calculateAttackDamage(e,r,s);break;case"spell":i.damage=this.calculateSpellDamage(e,r,s);break;case"special":i.damage=this.calculateSpecialDamage(e,r,s);break;case"item":i.healing=this.calculateItemEffect(e,r,s);break;case"defend":i.statusEffects.push({type:"defensive",duration:1});break;case"environmental":i.environmentalEffects=this.calculateEnvironmentalEffects(e,r,s);break;case"teamUp":i.damage=this.calculateTeamUpDamage(e,r,s);break}return i}calculateAttackDamage(e,t,r){console.log(" calculateAttackDamage called for:",{combatant:e.name,target:t.name,combatantClass:e.class,additionalData:r});const s=Math.floor(Math.random()*8)+1,i=Math.floor(((e.strength||10)-10)/2),a=r.weaponBonus||0;console.log(" Base damage calculation:",{baseDamage:s,strengthMod:i,weaponBonus:a,combatantStrength:e.strength||10});let l=1,c=0;if(e.id.startsWith("enemy_")){l=1+(e.level-1)*.3;const d=r.attribute||"strength";c=Math.floor(((e[d]||10)-10)/2);const h=this.calculateEnemyItemBonus(e);let m=0;r.specialAttack&&r.specialAttack!=="Standard Attack"&&(m=Math.floor(Math.random()*4)+2),r.isBossAttack&&(m+=5);let p=(s+i+a+c+h+m)*l;Math.floor(Math.random()*20)+1===20&&(p*=2),console.log(`Enhanced enemy damage calculation for ${e.name}:`,{baseDamage:s,strengthMod:i,weaponBonus:a,attributeMod:c,itemBonus:h,specialBonus:m,levelScaling:l,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,totalDamage:Math.max(1,Math.floor(p))});const y=Math.max(1,Math.floor(p));return console.log(` Enemy ${e.name} final damage: ${y}`),y}else{const d=Math.floor(((e.dexterity||10)-10)/2),h=Math.floor((e.level-1)*.5);let m=s+i+d+a+h;Math.floor(Math.random()*20)+1===20&&(m*=2);const p=Math.max(1,Math.floor(m));return console.log(` Player ${e.name} damage calculation:`,{baseDamage:s,strengthMod:i,dexterityMod:d,weaponBonus:a,levelBonus:h,totalDamage:p}),p}}getEnemyPrimaryAttribute(e){return{Warrior:"strength",Archer:"dexterity",Mage:"intelligence",Cleric:"wisdom",Rogue:"dexterity",Paladin:"strength",Ranger:"dexterity",Wizard:"intelligence",Fighter:"strength"}[e]||"strength"}calculateEnemyItemBonus(e){let t=0;return e.equipment&&(e.equipment.weapon&&(t+=e.equipment.weapon.damageBonus||0),e.equipment.armor&&(t+=e.equipment.armor.defenseBonus||0),e.equipment.accessory&&(t+=e.equipment.accessory.bonus||0)),e.level>3&&(t+=Math.floor((e.level-3)/2)),t}calculateSpellDamage(e,t,r){const s=Math.floor(Math.random()*6)+1,i=Math.floor((e.intelligence-10)/2),a=r.spellLevel||1;if(e.id.startsWith("enemy_")){const l=1+(e.level-1)*.4,c=Math.floor((e.wisdom-10)/2),d=this.calculateEnemyItemBonus(e);let h=(s+i+c+a+d)*l;return Math.floor(Math.random()*20)+1>=19&&(h*=1.5),Math.max(1,Math.floor(h))}else return Math.max(1,s+i+a)}calculateSpecialDamage(e,t,r){var l;if(!this.classAbilities[(l=e.class)==null?void 0:l.toLowerCase()])return 0;const i=Math.floor(Math.random()*10)+2,a=Math.floor((e.level||1)/2);return Math.max(1,i+a)}calculateItemEffect(e,t,r){switch(r.itemType||"potion"){case"healing":return Math.floor(Math.random()*8)+2;case"antidote":return 0;case"blessing":return 0;default:return Math.floor(Math.random()*4)+1}}calculateTeamUpDamage(e,t,r){const s=Math.floor(Math.random()*12)+3;return Math.max(1,s+2)}applyActionEffects(e,t,r,s){if(console.log(" applyActionEffects called with:",{combatant:t.name,target:r.name,results:s,targetHpBefore:r.hp}),s.damage>0){const i=r.hp;r.hp=Math.max(0,r.hp-s.damage),console.log(` Damage applied in applyActionEffects: ${t.name} deals ${s.damage} damage to ${r.name}. HP: ${i}  ${r.hp}`),console.log(" Target details:",{name:r.name,id:r.id,isEnemy:r.id.startsWith("enemy_"),userId:r.userId,oldHp:i,newHp:r.hp})}if(s.healing>0){const i=r.hp;r.hp=Math.min(r.maxHp,r.hp+s.healing),console.log(` Healing applied in applyActionEffects: ${t.name} heals ${r.name} for ${s.healing} HP. HP: ${i}  ${r.hp}`)}r.statusEffects||(r.statusEffects=[]),s.statusEffects.forEach(i=>{r.statusEffects.some(a=>a.type===i.type)||(r.statusEffects.push({type:i.type,duration:i.duration,appliedBy:t.id}),console.log(` Status effect applied: ${i.type} to ${r.name}`))}),console.log(` Final target HP after applyActionEffects: ${r.name} = ${r.hp}`)}updateCooldowns(e,t,r){const s=this.actionTypes[r];t.cooldowns||(t.cooldowns={}),t.cooldowns[r]=s.cooldown,Object.keys(t.cooldowns).forEach(i=>{i!==r&&t.cooldowns[i]>0&&t.cooldowns[i]--})}checkStatusEffectApplication(e,t,r,s){const i=[];if(r.statusEffects||(r.statusEffects=[]),s.damage>10){const a=["stunned","bleeding"],l=a[Math.floor(Math.random()*a.length)];r.statusEffects.some(c=>c.type===l)||i.push({type:l,duration:1,appliedBy:e.id})}return i}calculateEnvironmentalImpact(e,t,r){const s=[];return t==="spell"&&r.damage>8&&s.push("The magical energy disturbs the environment"),t==="environmental"&&s.push("The environment responds to the action"),s}processStatusEffects(e,t){const r=[];return t.statusEffects&&t.statusEffects.forEach((s,i)=>{switch(s.duration--,s.type){case"poisoned":t.hp=Math.max(0,t.hp-1),r.push(`${t.name} takes 1 poison damage`);break;case"burned":t.hp=Math.max(0,t.hp-2),r.push(`${t.name} takes 2 burn damage`);break;case"frozen":r.push(`${t.name} is frozen and cannot act`);break;case"paralyzed":Math.random()<.5&&r.push(`${t.name} is paralyzed and cannot act`);break;case"blessed":r.push(`${t.name} is blessed with divine favor`);break;case"hasted":r.push(`${t.name} moves with supernatural speed`);break}s.duration<=0&&(t.statusEffects.splice(i,1),r.push(`${t.name} is no longer ${s.type}`))}),r}checkCombatEnd(e){const t=e.combatants.filter(a=>!a.id.startsWith("enemy_")),r=e.combatants.filter(a=>a.id.startsWith("enemy_")),s=t.some(a=>a.hp>0),i=r.some(a=>a.hp>0);return s?i?{ended:!1}:{ended:!0,result:"victory",narrative:"The enemies have been defeated!"}:{ended:!0,result:"defeat",narrative:"The party has been defeated..."}}generateCombatSummary(e,t){return{result:t,duration:e.round,participants:e.combatants.map(s=>({name:s.name,finalHp:s.hp,actions:s.turnCount,statusEffects:s.statusEffects.length})),narrative:this.generateCombatNarrative(e,t)}}generateCombatNarrative(e,t){const r=e.combatants.filter(s=>!s.id.startsWith("enemy_"));return e.combatants.filter(s=>s.id.startsWith("enemy_")),t==="victory"?`The party emerges victorious from the battle. ${r.map(s=>s.name).join(", ")} stand triumphant over their fallen foes.`:t==="defeat"?"The battle ends in defeat. The party has been overwhelmed by their enemies.":"The battle ends in a draw, with both sides withdrawing to regroup."}chooseEnemyAction(e,t){const r=this.getAvailableActions(e);return console.log(`Enemy ${e.name} available actions:`,r),r.length===0?(console.log(`No available actions for ${e.name}, defaulting to defend`),{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}):this.makeEnemyDecision(e,r,t)}getAvailableActions(e){var s;const t=[],r=e.cooldowns||{};return console.log("Getting enemy available actions for:",e.name,{cooldowns:r,class:e.class,hasClassAbility:!!this.classAbilities[(s=e.class)==null?void 0:s.toLowerCase()]}),Object.entries(this.actionTypes).forEach(([i,a])=>{(!r.hasOwnProperty(i)||r[i]<=0)&&t.push(i)}),e.class&&this.classAbilities[e.class.toLowerCase()]&&(!r.hasOwnProperty("special")||r.special<=0)&&t.push("special"),console.log("Available actions for enemy:",e.name,t),t}getValidTargets(e,t,r){const s=[],i=r.combatants.filter(a=>a.hp>0);if(i.length===0)return console.log("No alive combatants found"),[];switch(t){case"attack":case"spell":case"special":if(e.id.startsWith("enemy_")){const a=i.filter(l=>!l.id.startsWith("enemy_"));console.log(`Enemy ${e.name} can target players:`,a.map(l=>l.name)),s.push(...a)}else s.push(...i.filter(a=>a.id.startsWith("enemy_")));break;case"heal":case"item":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_")&&a.id!==e.id)):s.push(...i.filter(a=>!a.id.startsWith("enemy_")&&a.id!==e.id));break;case"defend":case"environmental":s.push(e);break;case"teamUp":e.id.startsWith("enemy_")?s.push(...i.filter(a=>a.id.startsWith("enemy_")&&a.id!==e.id)):s.push(...i.filter(a=>!a.id.startsWith("enemy_")&&a.id!==e.id));break;default:s.push(...i.filter(a=>a.id!==e.id))}return console.log(`Valid targets for ${e.name} (${t}):`,s.map(a=>a.name)),s}makeEnemyDecision(e,t,r){var m;if(t.length===0)return console.log("No available actions for enemy, defaulting to defend"),{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"};const s=t[Math.floor(Math.random()*t.length)],i=this.getValidTargets(e,s,r);if(console.log(`Valid targets for ${e.name} (${s}):`,i.map(p=>p.name)),i.length===0)return console.log(`No valid targets for ${e.name} with action ${s}, defaulting to defend`),{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"};const a=i[Math.floor(Math.random()*i.length)];console.log(`Enemy ${e.name} selected target: ${a.name} (ID: ${a.id})`);const l=e.hp/e.maxHp,c=(m=e.class)==null?void 0:m.toLowerCase();if(e.level,c==="priest"||c==="cleric"){if(l<.4&&t.includes("spell"))return{action:"spell",target:e.id,spellType:"healing",specialAttack:"Divine Healing",damageType:"healing",attribute:"wisdom"};if(t.includes("spell")&&a)return{action:"spell",target:a.id,spellType:"divine",specialAttack:"Divine Smite",damageType:"radiant",attribute:"wisdom"}}if((c==="wizard"||c==="mage"||c==="sorcerer")&&t.includes("spell")){const p=["fireball","lightning","ice","arcane"],y=p[Math.floor(Math.random()*p.length)];return{action:"spell",target:a.id,spellType:y,specialAttack:`${y.charAt(0).toUpperCase()+y.slice(1)} Spell`,damageType:y==="fireball"?"fire":y==="lightning"?"lightning":y==="ice"?"cold":"arcane",attribute:"intelligence"}}if((c==="boss"||c==="dragon")&&t.includes("special"))return{action:"special",target:a.id,specialAttack:"Devastating Strike",damageType:"physical",attribute:"strength",isBossAttack:!0};if((c==="undead"||c==="skeleton"||c==="zombie")&&t.includes("spell"))return{action:"spell",target:a.id,spellType:"necrotic",specialAttack:"Death Touch",damageType:"necrotic",attribute:"constitution"};if(l<.3){if(t.includes("item"))return{action:"item",target:e.id,itemType:"healing",specialAttack:"Use Healing Potion",damageType:"healing",attribute:"constitution"};if(t.includes("defend"))return{action:"defend",target:null,specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}}return r.combatants.filter(p=>p.id.startsWith("enemy_")&&p.hp/p.maxHp<.5).length>1&&t.includes("spell")?{action:"spell",target:a.id,spellType:"area",specialAttack:"Area Attack",damageType:"mixed",attribute:"intelligence"}:t.includes("attack")?{action:"attack",target:a.id,specialAttack:"Standard Attack",damageType:"physical",attribute:"strength"}:{action:t[Math.floor(Math.random()*t.length)],target:a.id,specialAttack:"Basic Action",damageType:"physical",attribute:"strength"}}async executeEnemyTurn(e,t){if(t.hp<=0)return console.log("Enemy is dead, skipping turn:",t.name),{success:!1,message:`${t.name} is already defeated`};const r=this.chooseEnemyAction(t,e);return console.log("Enemy decision details:",{enemy:t.name,decision:r,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute}),r?r.target?await this.executeAction(e,t.id,r.action,r.target,{itemType:r.itemType,spellType:r.spellType,specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute,isBossAttack:r.isBossAttack}):await this.executeAction(e,t.id,"defend",t.id,{specialAttack:r.specialAttack,damageType:r.damageType,attribute:r.attribute}):(console.log("No decision made for enemy, defaulting to defend"),await this.executeAction(e,t.id,"defend",t.id,{specialAttack:"Defensive Stance",damageType:"defense",attribute:"dexterity"}))}}const Kn=new wI,I4="3.2.1";function N4(){const[n,e]=I.useState(!1),t=()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()};return o.jsxs("div",{className:"text-xs text-gray-400 text-center mt-2",children:[o.jsxs("div",{className:"flex items-center justify-center gap-2",children:[o.jsxs("span",{children:["Version ",I4]}),o.jsx("button",{onClick:()=>e(!n),className:"text-blue-400 hover:text-blue-300 underline",title:"Having issues? Click for help",children:"Help"})]}),n&&o.jsxs("div",{className:"mt-2 p-2 bg-gray-800 rounded text-left max-w-md mx-auto",children:[o.jsx("p",{className:"mb-2 text-yellow-300 font-semibold",children:"Need Help?"}),o.jsxs("div",{className:"mb-3",children:[o.jsx("p",{className:"mb-2 text-xs font-semibold text-amber-300",children:"Combat Session Issues:"}),o.jsxs("div",{className:"space-y-2 text-xs",children:[o.jsx("button",{onClick:async()=>{console.log(" Force refreshing combat session..."),window.dispatchEvent(new CustomEvent("refreshCombatSession"))},className:"px-2 py-1 bg-amber-600 hover:bg-amber-700 text-white text-xs rounded transition-colors",title:"Refresh combat session if players are in separate sessions",children:" Refresh Combat"}),o.jsx("button",{onClick:async()=>{console.log(" Force cleaning up all combat sessions..."),window.dispatchEvent(new CustomEvent("cleanupCombatSessions"))},className:"px-2 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded transition-colors ml-2",title:"Force cleanup all combat sessions (use if players are stuck in separate sessions)",children:" Cleanup Sessions"})]})]}),o.jsxs("div",{className:"mb-3",children:[o.jsx("p",{className:"mb-2 text-xs font-semibold text-blue-300",children:"Cache Issues:"}),o.jsx("p",{className:"mb-2 text-xs",children:"If players are ending up in separate combat sessions, try clearing your cache:"}),o.jsxs("div",{className:"space-y-1 text-xs",children:[o.jsxs("p",{children:[" ",o.jsx("strong",{children:"Browser:"})," Ctrl+Shift+R (Windows) or Cmd+Shift+R (Mac)"]}),o.jsxs("p",{children:[" ",o.jsx("strong",{children:"Or click:"}),o.jsx("button",{onClick:t,className:"ml-1 text-red-400 hover:text-red-300 underline",children:"Clear All Data & Reload"})]}),o.jsxs("p",{children:[" ",o.jsx("strong",{children:"Mobile:"})," Close and reopen the app"]})]})]}),o.jsx("button",{onClick:()=>e(!1),className:"mt-2 text-gray-500 hover:text-gray-400 text-xs",children:"Close"})]})]})}function C4(){return o.jsxs("div",{className:"relative overflow-hidden",children:[o.jsx("div",{className:"fantasy-container",children:o.jsxs("div",{className:"relative z-10 py-8 sm:py-16 lg:py-24 text-center",children:[o.jsx("h1",{className:"fantasy-title text-5xl sm:text-6xl lg:text-7xl",children:"Manage your D&D world like a real adventurer's tome"}),o.jsx("p",{className:"fantasy-subtitle max-w-2xl mx-auto",children:"Create parties, invite friends, and share story objectives in a beautifully crafted digital environment that feels like a magical grimoire."}),o.jsxs("div",{className:"mt-8 flex justify-center space-x-6",children:[o.jsx(Vs,{to:"/register",className:"fantasy-button text-lg px-8 py-3",children:"Start Your Journey"}),o.jsx(Vs,{to:"/login",className:"fantasy-button text-lg px-8 py-3 bg-gray-600 hover:bg-gray-700",children:"Return to Campaign"})]})]})}),o.jsx("div",{className:"absolute inset-0 bg-gray-700/10 pattern-grid-lg"})]})}function A4(){return o.jsxs("div",{children:[o.jsx(C4,{}),o.jsx("div",{className:"fantasy-container py-16",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Create Parties"}),o.jsx("p",{className:"text-gray-300",children:"Form adventuring parties with your friends and manage your campaign together in a shared space."})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Track Objectives"}),o.jsx("p",{className:"text-gray-300",children:"Keep track of your party's quests, storylines, and achievements in an organized magical tome."})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-gray-100 mb-4",children:"Share Stories"}),o.jsx("p",{className:"text-gray-300",children:"Document your adventures and share them with your fellow party members in an immersive fantasy setting."})]})]})})]})}function k4(){const[n,e]=I.useState(""),[t,r]=I.useState(""),[s,i]=I.useState(!1),[a,l]=I.useState(""),[c,d]=I.useState(""),h=hr(),m=ps();I.useEffect(()=>{var v;(v=m.state)!=null&&v.message&&(d(m.state.message),h(m.pathname,{replace:!0}));const y=xa(S=>{S&&h("/dashboard")});return()=>y()},[h,m]);const p=async y=>{y.preventDefault(),i(!0),l("");const v=await b4(n,t);v.error&&(v.error.includes("auth/invalid-credential")?l("Invalid email or password. Please check your credentials or register a new account."):v.error.includes("auth/user-not-found")?l("No account found with this email. Please register first."):v.error.includes("auth/wrong-password")?l("Incorrect password. Please try again."):v.error.includes("auth/user-disabled")?l("This account has been disabled. Please contact support."):v.error.includes("auth/too-many-requests")?l("Too many failed login attempts. Please try again later."):l(v.error)),i(!1)};return o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card max-w-md mx-auto",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Login"}),c&&o.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded-lg mb-4",children:c}),o.jsxs("form",{onSubmit:p,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-200 mb-2",children:"Email"}),o.jsx("input",{id:"email",type:"email",value:n,onChange:y=>e(y.target.value),className:"fantasy-input",autoComplete:"email",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-200 mb-2",children:"Password"}),o.jsx("input",{id:"password",type:"password",value:t,onChange:y=>r(y.target.value),className:"fantasy-input",autoComplete:"current-password",required:!0})]}),a&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded-lg",children:a}),o.jsx("button",{type:"submit",disabled:s,className:"fantasy-button w-full",children:s?"Logging in...":"Login"})]}),o.jsx("div",{className:"mt-6 text-center",children:o.jsxs("p",{className:"text-gray-300",children:["Don't have an account?"," ",o.jsx("button",{onClick:()=>h("/register"),className:"text-amber-400 hover:text-amber-300 font-medium",children:"Register here"})]})})]})})}function P4(){const[n,e]=I.useState(""),[t,r]=I.useState(""),[s,i]=I.useState(""),[a,l]=I.useState(""),[c,d]=I.useState(""),[h,m]=I.useState(""),p=hr();I.useEffect(()=>{_4().then(v=>{console.log("Firebase test result:",v)})},[]);const y=async v=>{if(v.preventDefault(),d(""),m(""),s!==a){d("Passwords do not match");return}if(!t.trim()){d("Username is required");return}if(t.length<3){d("Username must be at least 3 characters long");return}if(!/^[a-zA-Z0-9_]+$/.test(t)){d("Username can only contain letters, numbers, and underscores");return}console.log("Submitting registration for:",n,t);const{user:S,error:E,success:_}=await x4(n,s,t);if(console.log("Registration result:",{user:S,error:E,success:_}),E){console.log("Setting error:",E),d(E);return}_?(console.log("Registration successful, redirecting to login"),p("/login",{state:{message:"Registration successful! Please check your email to verify your account before logging in."}})):console.log("No success received from registration")};return o.jsx("div",{className:"fantasy-container min-h-screen flex items-center justify-center",children:o.jsxs("div",{className:"fantasy-card w-full max-w-md",children:[o.jsx("h2",{className:"fantasy-title text-center",children:"Begin Your Adventure"}),c&&o.jsx("div",{className:"bg-red-900/20 border border-red-600 text-red-200 px-4 py-3 rounded mb-4",children:c}),h&&o.jsx("div",{className:"bg-green-900/20 border border-green-600 text-green-200 px-4 py-3 rounded mb-4",children:h}),o.jsxs("form",{onSubmit:y,className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-200",children:"Username"}),o.jsx("input",{id:"username",type:"text",required:!0,value:t,onChange:v=>r(v.target.value),className:"fantasy-input mt-1",placeholder:"Choose a unique username"}),o.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Letters, numbers, and underscores only. 3+ characters."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-200",children:"Email"}),o.jsx("input",{id:"email",type:"email",required:!0,value:n,onChange:v=>e(v.target.value),className:"fantasy-input mt-1"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-200",children:"Password"}),o.jsx("input",{id:"password",type:"password",required:!0,value:s,onChange:v=>i(v.target.value),className:"fantasy-input mt-1"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-200",children:"Confirm Password"}),o.jsx("input",{id:"confirmPassword",type:"password",required:!0,value:a,onChange:v=>l(v.target.value),className:"fantasy-input mt-1"})]}),o.jsx("button",{type:"submit",className:"fantasy-button w-full",children:"Register"})]}),o.jsxs("p",{className:"mt-4 text-center text-sm text-gray-300",children:["Already have an account?"," ",o.jsx(Vs,{to:"/login",className:"text-amber-400 hover:text-amber-300",children:"Return to your campaign"})]})]})})}function j4(){const n=hr(),{user:e,loading:t}=bI(),[r,s]=I.useState(null),[i,a]=I.useState([]),[l,c]=I.useState([]),[d,h]=I.useState({}),[m,p]=I.useState({}),[y,v]=I.useState(!0),[S,E]=I.useState(!1),[_,x]=I.useState(!1),[C,k]=I.useState(""),[M,F]=I.useState({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:"",campaignType:"ai-assist"}),w=Array.isArray(i)?i.filter(V=>V&&V.id):[];I.useEffect(()=>{t||(e?b(e.uid):n("/login"))},[e,t,n]),I.useEffect(()=>{if(!(e!=null&&e.uid)||!w.length||S)return;const V=w.filter(Y=>Y&&Y.id);if(V.length===0)return;const K=V.map(Y=>!Y||!Y.id?null:S0(Y.id,fe=>{!fe||!fe.id||S||(a(ae=>ae.filter(U=>U&&U.id).map(U=>U.id===fe.id?fe:U)),A([fe]))})).filter(Boolean);return()=>{K.forEach(Y=>{typeof Y=="function"&&Y()})}},[e==null?void 0:e.uid,i.length,S]);const b=async V=>{try{const K=await va(V);s(K);const fe=(await sI(V)).filter(ae=>ae&&ae.id);await A(fe),a(fe),await N()}catch(K){console.error("Error loading user data:",K),a([]),h({})}finally{v(!1)}},N=async()=>{try{const K=(await iI()).filter(Y=>{var fe;return!((fe=Y.members)!=null&&fe.includes(e==null?void 0:e.uid))});c(K),await j(K)}catch(V){console.error("Error loading public parties:",V.message)}},A=async V=>{try{if(!V||!Array.isArray(V)){console.log("No parties to load profiles for");return}const K=new Set;if(V.forEach(ae=>{ae&&ae.members&&Array.isArray(ae.members)&&ae.members.forEach(te=>K.add(te))}),K.size===0)return;const Y=await Zd(Array.from(K)),fe={};Y.forEach(ae=>{ae&&ae.userId&&(fe[ae.userId]=ae)}),h(fe)}catch(K){console.error("Error loading party member profiles:",K)}},j=async V=>{try{if(!V||!Array.isArray(V)){console.log("No public parties to load profiles for");return}const K=new Set;if(V.forEach(ae=>{ae&&ae.members&&Array.isArray(ae.members)&&ae.members.forEach(te=>K.add(te))}),K.size===0)return;const Y=await Zd(Array.from(K)),fe={};Y.forEach(ae=>{ae&&ae.userId&&(fe[ae.userId]=ae)}),p(fe)}catch(K){console.error("Error loading public party member profiles:",K)}},D=async V=>{try{if(!V){console.error("Invalid party ID for deletion");return}E(!0),v(!0),a(K=>K.filter(Y=>Y&&Y.id!==V)),await aI(V,e.uid),await b(e.uid)}catch(K){console.error("Error deleting party:",K),await b(e.uid)}finally{v(!1),E(!1)}},P=async V=>{try{if(!(e!=null&&e.uid)){alert("User not authenticated. Please log in again.");return}if(!V){alert("Invalid party information.");return}const K=w.find(fe=>fe.id===V);if(!K){alert("Party not found.");return}await nI(e.uid,V)?K.campaignType==="ai-assist"?n(`/campaign/${V}`):K.dmId===e.uid?n(`/manual-campaign-dm/${V}`):n(`/manual-campaign/${V}`):n(`/character-creation/${V}`)}catch(K){console.error("Error in handleContinueCampaign:",K),n(`/character-creation/${V}`)}},Ve=async V=>{if(V.preventDefault(),!e){console.error("You must be logged in to create a party");return}v(!0);try{const K={...M,inviteCode:Math.random().toString(36).substr(2,8).toUpperCase()},Y=await rI(e.uid,K);x(!1),F({name:"",description:"",maxPlayers:6,isPublic:!1,inviteCode:"",campaignType:"ai-assist"}),await b(e.uid),console.log("Party created successfully!")}catch(K){console.error("Error creating party:",K.message)}finally{v(!1)}},je=async()=>{if(!C.trim()){console.error("Please enter an invite code");return}if(!e){console.error("You must be logged in to join a party");return}v(!0);try{const V=await oI(C.toUpperCase());if(!V){console.error("Invalid invite code");return}await fp(V.id,e.uid),k(""),await b(e.uid),console.log("Successfully joined party!")}catch(V){console.error(V.message||"Error joining party. Please try again.")}finally{v(!1)}},Fe=async V=>{if(!e){console.error("You must be logged in to join a party");return}v(!0);try{await fp(V,e.uid),await b(e.uid),console.log("Successfully joined public party!")}catch(K){console.error(K.message||"Error joining party. Please try again.")}finally{v(!1)}},et=()=>r!=null&&r.username?r.username:e!=null&&e.displayName?e.displayName:e!=null&&e.email?e.email.split("@")[0]:"Adventurer";return y?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-amber-400 border-t-transparent mx-auto mb-4"}),o.jsx("p",{className:"text-slate-300 text-lg font-medium",children:S?"Deleting campaign...":"Loading your adventures..."})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsxs("div",{className:"mb-8 sm:mb-12",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("h1",{className:"text-4xl sm:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 via-orange-400 to-amber-500 mb-4 leading-relaxed pb-2",children:"Campaign Dashboard"}),o.jsx("div",{className:"w-24 h-1 bg-gradient-to-r from-amber-400 to-orange-400 mx-auto rounded-full"})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("p",{className:"text-slate-300 text-lg sm:text-xl",children:["Welcome back, ",o.jsx("span",{className:"text-amber-400 font-semibold",children:et()}),"!"]}),o.jsx("p",{className:"text-slate-400 mt-2 text-sm sm:text-base",children:"Create, join, and manage your D&D campaigns"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 sm:gap-8 mb-8 sm:mb-12",children:[o.jsxs("div",{className:"group relative overflow-hidden rounded-xl bg-gradient-to-br from-amber-500/10 to-orange-500/10 border border-amber-500/20 p-6 hover:from-amber-500/20 hover:to-orange-500/20 transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-amber-500/20",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-500/5 to-orange-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-500 rounded-lg flex items-center justify-center mr-4",children:o.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),o.jsx("h3",{className:"text-xl font-bold text-slate-100",children:"Create New Campaign"})]}),o.jsx("p",{className:"text-slate-300 mb-6 text-sm leading-relaxed",children:"Start a new campaign and invite friends to join your adventures."}),o.jsx("button",{onClick:()=>x(!0),className:"w-full bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",disabled:y,children:"Create Campaign"})]})]}),o.jsxs("div",{className:"group relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-600/10 to-slate-500/10 border border-slate-500/20 p-6 hover:from-slate-600/20 hover:to-slate-500/20 transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-slate-500/20",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-slate-600/5 to-slate-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-slate-600 to-slate-500 rounded-lg flex items-center justify-center mr-4",children:o.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),o.jsx("h3",{className:"text-xl font-bold text-slate-100",children:"Join Campaign"})]}),o.jsx("p",{className:"text-slate-300 mb-6 text-sm leading-relaxed",children:"Join an existing campaign using an invite code."}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{type:"text",placeholder:"Enter invite code",value:C,onChange:V=>k(V.target.value),className:"flex-1 bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50",disabled:y}),o.jsx("button",{onClick:je,className:"bg-gradient-to-r from-slate-600 to-slate-500 hover:from-slate-700 hover:to-slate-600 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",disabled:y,children:y?"Joining...":"Join"})]})]})]})]}),_&&o.jsxs("div",{className:"relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600/50 backdrop-blur-sm mb-8",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-500/5 to-orange-500/5"}),o.jsxs("div",{className:"relative z-10 p-6 sm:p-8",children:[o.jsxs("div",{className:"flex items-center mb-6",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 rounded-lg flex items-center justify-center mr-4",children:o.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),o.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Create New Campaign"})]}),o.jsxs("form",{onSubmit:Ve,className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-4",children:"Campaign Type"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{className:`relative cursor-pointer rounded-xl border-2 p-4 transition-all duration-300 ${M.campaignType==="ai-assist"?"border-amber-500 bg-amber-500/10":"border-slate-600 bg-slate-700/30 hover:border-slate-500"}`,onClick:()=>F(V=>({...V,campaignType:"ai-assist"})),children:[o.jsxs("div",{className:"flex items-center mb-3",children:[o.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center mr-3 ${M.campaignType==="ai-assist"?"bg-amber-500":"bg-slate-600"}`,children:o.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),o.jsx("h3",{className:"font-semibold text-slate-100",children:"AI Assist"})]}),o.jsx("p",{className:"text-sm text-slate-300 leading-relaxed",children:"AI-powered storytelling with dynamic encounters, NPCs, and story generation. Perfect for immersive adventures."})]}),o.jsxs("div",{className:`relative cursor-pointer rounded-xl border-2 p-4 transition-all duration-300 ${M.campaignType==="manual"?"border-amber-500 bg-amber-500/10":"border-slate-600 bg-slate-700/30 hover:border-slate-500"}`,onClick:()=>F(V=>({...V,campaignType:"manual"})),children:[o.jsxs("div",{className:"flex items-center mb-3",children:[o.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center mr-3 ${M.campaignType==="manual"?"bg-amber-500":"bg-slate-600"}`,children:o.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),o.jsx("h3",{className:"font-semibold text-slate-100",children:"Manual Campaign"})]}),o.jsx("p",{className:"text-sm text-slate-300 leading-relaxed",children:"Traditional D&D experience with manual story creation. No AI dependencies - full control over your campaign."})]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"party-name",className:"block text-sm font-semibold text-slate-200 mb-2",children:"Campaign Name"}),o.jsx("input",{id:"party-name",type:"text",value:M.name,onChange:V=>F(K=>({...K,name:V.target.value})),className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"max-players",className:"block text-sm font-semibold text-slate-200 mb-2",children:"Max Players"}),o.jsx("input",{id:"max-players",type:"number",min:"2",max:"10",value:M.maxPlayers,onChange:V=>F(K=>({...K,maxPlayers:parseInt(V.target.value)})),className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50"})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"party-theme",className:"block text-sm font-semibold text-slate-200 mb-2",children:"Theme & Description"}),o.jsx("textarea",{id:"party-theme",value:M.description,onChange:V=>F(K=>({...K,description:V.target.value})),className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50",rows:"3",placeholder:"Enter the theme or atmosphere for your campaign..."})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"isPublic",checked:M.isPublic,onChange:V=>F(K=>({...K,isPublic:V.target.checked})),className:"w-4 h-4 text-amber-500 bg-slate-700 border-slate-600 rounded focus:ring-amber-500/50 focus:ring-2"}),o.jsx("label",{htmlFor:"isPublic",className:"ml-2 text-sm font-medium text-slate-300",children:"Public Campaign (visible to all users)"})]}),o.jsxs("div",{className:"flex space-x-4",children:[o.jsx("button",{type:"submit",className:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",disabled:y,children:y?"Creating...":"Create Campaign"}),o.jsx("button",{type:"button",onClick:()=>x(!1),className:"bg-gradient-to-r from-slate-600 to-slate-500 hover:from-slate-700 hover:to-slate-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",disabled:y,children:"Cancel"})]})]})]})]}),o.jsxs("div",{className:"relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600/50 backdrop-blur-sm mb-8",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-500/5 to-orange-500/5"}),o.jsxs("div",{className:"relative z-10 p-6 sm:p-8",children:[o.jsxs("div",{className:"flex items-center mb-6",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 rounded-lg flex items-center justify-center mr-4",children:o.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),o.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"My Campaigns"})]}),w.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-6",children:o.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),o.jsx("h3",{className:"text-xl font-semibold text-slate-300 mb-2",children:"No Campaigns Yet"}),o.jsx("p",{className:"text-slate-400 mb-6",children:"Create your first campaign to start adventuring!"}),o.jsx("button",{onClick:()=>x(!0),className:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold py-3 px-8 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",children:"Create Your First Campaign"})]}):o.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:w.map(V=>{var K;return o.jsxs("div",{className:"group relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-700/50 to-slate-600/50 border border-slate-500/50 p-6 hover:from-slate-700/70 hover:to-slate-600/70 transition-all duration-300 hover:scale-[1.02] hover:shadow-xl",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-500/5 to-orange-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),o.jsxs("div",{className:"relative z-10",children:[o.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-2 group-hover:text-amber-400 transition-colors duration-300",children:V.name}),o.jsx("p",{className:"text-slate-300 text-sm leading-relaxed mb-3",children:V.description}),o.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs sm:text-sm text-slate-400",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),((K=V.members)==null?void 0:K.length)||0," members"]}),o.jsx("div",{className:"flex items-center",children:o.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${V.campaignType==="ai-assist"?"bg-amber-500/20 text-amber-300 border border-amber-500/30":"bg-slate-600/20 text-slate-300 border border-slate-500/30"}`,children:V.campaignType==="ai-assist"?" AI Assist":" Manual"})}),V.members&&V.members.length>0&&o.jsxs("div",{className:"flex items-center",children:[o.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),o.jsx("span",{className:"max-w-xs truncate",children:V.members.map((Y,fe)=>{const ae=d[Y];let te="Unknown";return ae!=null&&ae.username?te=ae.username:ae!=null&&ae.displayName?te=ae.displayName:ae!=null&&ae.email&&(te=ae.email.split("@")[0]),o.jsxs("span",{children:[te,fe<V.members.length-1?", ":""]},Y)})})]})]})]})}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[o.jsxs("button",{onClick:()=>P(V.id),className:"flex-1 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg flex items-center justify-center",children:[o.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Continue"]}),V.dmId===(e==null?void 0:e.uid)&&o.jsxs("button",{onClick:()=>D(V.id),className:"flex-1 bg-gradient-to-r from-slate-600 to-slate-500 hover:from-slate-700 hover:to-slate-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg flex items-center justify-center",children:[o.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]}),V.dmId===(e==null?void 0:e.uid)&&V.inviteCode&&o.jsx("div",{className:"mt-4 p-3 bg-slate-700/30 rounded-lg border border-slate-600/50",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm text-slate-300",children:"Invite Code:"}),o.jsx("span",{className:"text-sm font-mono text-amber-400 bg-slate-800 px-2 py-1 rounded select-all",children:V.inviteCode})]})})]})]},V.id)})})]})]}),l.length>0&&o.jsxs("div",{className:"relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600/50 backdrop-blur-sm mb-8",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-slate-500/5 to-slate-400/5"}),o.jsxs("div",{className:"relative z-10 p-6 sm:p-8",children:[o.jsxs("div",{className:"flex items-center mb-6",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-slate-600 to-slate-500 rounded-lg flex items-center justify-center mr-4",children:o.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})}),o.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Public Campaigns"})]}),o.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:l.map(V=>{var K,Y;return m[V.id],o.jsxs("div",{className:"group relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-700/50 to-slate-600/50 border border-slate-500/50 p-6 hover:from-slate-700/70 hover:to-slate-600/70 transition-all duration-300 hover:scale-[1.02] hover:shadow-xl",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-slate-500/5 to-slate-400/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100 group-hover:text-slate-300 transition-colors duration-300",children:V.name}),o.jsxs("span",{className:"text-sm text-slate-400 bg-slate-600/50 px-2 py-1 rounded-full",children:[((K=V.members)==null?void 0:K.length)||1,"/",V.maxPlayers," players"]})]}),V.description&&o.jsx("p",{className:"text-slate-300 text-sm leading-relaxed mb-4",children:V.description}),o.jsxs("div",{className:"mb-4",children:[o.jsxs("h4",{className:"text-sm font-semibold text-slate-200 mb-2 flex items-center",children:[o.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Members"]}),o.jsx("div",{className:"space-y-1",children:(Y=V.members)==null?void 0:Y.map((fe,ae)=>{const te=m[fe];let U=`User ${ae+1}`;te!=null&&te.username?U=te.username:te!=null&&te.displayName?U=te.displayName:te!=null&&te.email&&(U=te.email.split("@")[0]);const me=fe===V.dmId;return o.jsx("div",{className:"flex items-center justify-between text-sm",children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-slate-300",children:U}),me&&o.jsx("span",{className:"bg-gradient-to-r from-slate-600 to-slate-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"DM"})]})},fe)})})]}),o.jsx("button",{onClick:()=>Fe(V.id),className:"w-full bg-gradient-to-r from-slate-600 to-slate-500 hover:from-slate-700 hover:to-slate-600 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg",disabled:y,children:"Join Campaign"})]})]},V.id)})})]})]})]})})}function R4(){var it,Ye,pt;const n=hr(),{partyId:e}=Mo(),[t,r]=I.useState(null),[s,i]=I.useState(!1),[a,l]=I.useState(""),[c,d]=I.useState("");I.useState(!1);const[h,m]=I.useState(null),[p,y]=I.useState([]),[v,S]=I.useState(!1),[E,_]=I.useState(""),[x,C]=I.useState(!1),[k,M]=I.useState({name:"",race:"",class:"",level:1,background:"",alignment:"",strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10,age:"",height:"",weight:"",eyes:"",skin:"",hair:"",personality:"",ideals:"",bonds:"",flaws:"",backstory:"",equipment:[],spells:[],proficiencies:[],portrait:"/placeholder-character.png"}),[F,w]=I.useState("standard"),[b,N]=I.useState([]),[A,j]=I.useState([]),[D,P]=I.useState({}),[Ve,je]=I.useState(!1),[Fe,et]=I.useState({}),[V,K]=I.useState([]),[Y,fe]=I.useState(null),[ae,te]=I.useState(!1);I.useEffect(()=>{const $=xa(Q=>{if(!Q){n("/login");return}r(Q),e&&(U(e,Q.uid),me(Q.uid,e).catch(ye=>{})),Fn(Q.uid).catch(ye=>{})});return()=>$()},[n,e]);const U=async($,Q)=>{try{const ye=await Ko($);fe(ye),te(ye.dmId===Q),ye.dmId===Q&&ye.campaignType==="manual"&&n(`/manual-campaign-dm/${$}`)}catch(ye){console.error("Error loading party info:",ye)}};I.useEffect(()=>{h&&(M({name:h.name||"",race:h.race||"",class:h.class||"",level:h.level||1,background:h.background||"",alignment:h.alignment||"",strength:h.strength||10,dexterity:h.dexterity||10,constitution:h.constitution||10,intelligence:h.intelligence||10,wisdom:h.wisdom||10,charisma:h.charisma||10,age:h.age||"",height:h.height||"",weight:h.weight||"",eyes:h.eyes||"",skin:h.skin||"",hair:h.hair||"",personality:h.personality||"",ideals:h.ideals||"",bonds:h.bonds||"",flaws:h.flaws||"",backstory:h.backstory||"",equipment:h.equipment||[],spells:h.spells||[],proficiencies:h.proficiencies||[],portrait:h.portrait||"/placeholder-character.png"}),h.weaponChoices&&et(h.weaponChoices),h.spellChoices&&K(h.spellChoices),h.abilityScoreMethod&&w(h.abilityScoreMethod),h.rolledScores&&(N(h.rolledScores),P(h.assignedScores||{}),je(h.rolledScores.length>0)))},[h]),I.useEffect(()=>{t&&e&&(async()=>{try{(await Ul(t.uid)).filter(Ce=>Ce.partyId===e).length>1&&(await Qe(),await me(t.uid,e))}catch{}})()},[t,e]);const me=async($,Q)=>{try{const Ce=(await Ul($)).filter(Xt=>Xt.partyId===Q);if(Ce.length===0){m(null);return}if(Ce.length===1){m(Ce[0]);return}const at=Ce.sort((Xt,Zt)=>{var Ee,B,G,de;const H=((B=(Ee=Xt.updatedAt)==null?void 0:Ee.toDate)==null?void 0:B.call(Ee))||Xt.updatedAt||new Date(0);return(((de=(G=Zt.updatedAt)==null?void 0:G.toDate)==null?void 0:de.call(G))||Zt.updatedAt||new Date(0))-H})[0];m(at),await Ae(Ce,at.id)}catch{}},Ae=async($,Q)=>{try{const ye=$.filter(Ce=>Ce.id!==Q).map(Ce=>eh(Ce.id));await Promise.all(ye)}catch{}},Qe=async()=>{try{const Q=(await Ul(t.uid)).filter(ye=>ye.partyId===e);if(Q.length>0){const ye=Q.map(async Ce=>{try{return await eh(Ce.id),{success:!0,id:Ce.id}}catch(at){return{success:!1,id:Ce.id,error:at}}});await Promise.all(ye),await new Promise(Ce=>setTimeout(Ce,1e3))}}catch{}},Fn=async $=>{try{const Q=await pI($);y(Q)}catch{}},$n=["Human","Elf","Dwarf","Halfling","Dragonborn","Tiefling","Half-Elf","Half-Orc","Gnome","Aarakocra","Genasi","Goliath"],jt=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"],tt=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],rn=["Acolyte","Criminal","Folk Hero","Noble","Sage","Soldier"],We=[15,14,13,12,10,8],qt={Fighter:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Paladin:{"Martial Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"],Shield:["Shield"]},Barbarian:{"Martial Melee Weapon":["Battleaxe","Flail","Glaive","Greataxe","Greatsword","Halberd","Lance","Longsword","Maul","Morningstar","Pike","Rapier","Scimitar","Shortsword","Trident","War pick","Warhammer","Whip"]},Bard:{Weapon:["Rapier","Longsword"]},Druid:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Monk:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Sorcerer:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]},Warlock:{"Simple Weapon":["Club","Dagger","Greatclub","Handaxe","Javelin","Light hammer","Mace","Quarterstaff","Sickle","Spear"]}},Tn={Wizard:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Sorcerer:[{name:"Acid Splash",description:"Throw acid at one or two creatures within 60 feet."},{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Fire Bolt",description:"Hurl a mote of fire at a target within 120 feet for 1d10 fire damage."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shocking Grasp",description:"Lightning springs from your hand, dealing lightning damage and preventing reactions."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Warlock:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Booming Blade",description:"Make a melee attack that deals extra thunder damage if target moves."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Eldritch Blast",description:"A beam of crackling energy that deals force damage and can hit multiple targets."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Green-Flame Blade",description:"Make a melee attack that can also damage a second creature with fire."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mind Sliver",description:"Deal psychic damage and reduce the target's next saving throw."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"Sword Burst",description:"Create a burst of spectral swords that damage all creatures within 5 feet."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."}],Cleric:[{name:"Guidance",description:"Touch a creature to give them +1d4 to their next ability check."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Resistance",description:"Touch a creature to give them +1d4 to their next saving throw."},{name:"Sacred Flame",description:"Flame-like radiance descends on a creature within 60 feet, dealing radiant damage."},{name:"Spare the Dying",description:"Touch a dying creature to stabilize them at 0 hit points."},{name:"Thaumaturgy",description:"Perform minor magical tricks - make your voice boom, cause tremors, or change eye color."}],Druid:[{name:"Control Flames",description:"Manipulate flames within 60 feet - double, halve, or change their color."},{name:"Create Bonfire",description:"Create a bonfire that damages creatures who enter or start their turn in it."},{name:"Druidcraft",description:"Predict weather, make a flower bloom, or create a harmless sensory effect."},{name:"Frostbite",description:"Numb a creature within 60 feet, dealing cold damage and possibly giving disadvantage."},{name:"Gust",description:"Create a strong wind to push creatures or objects within 30 feet."},{name:"Infestation",description:"Summon insects to attack a creature within 30 feet, dealing poison damage."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Lightning Lure",description:"Pull a creature within 15 feet toward you with lightning."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mold Earth",description:"Move earth and stone within 30 feet to create difficult terrain or cover."},{name:"Primal Savagery",description:"Transform your hand into a claw that deals acid damage to a creature you touch."},{name:"Produce Flame",description:"Create a flickering flame in your hand that you can throw for fire damage."},{name:"Ray of Frost",description:"A frigid beam that deals cold damage and reduces target's speed by 10 feet."},{name:"Shape Water",description:"Move and reshape water within 30 feet, or freeze it into simple shapes."},{name:"Shillelagh",description:"Transform a club or quarterstaff into a magical weapon that uses your spellcasting ability."},{name:"Thorn Whip",description:"Create a vine-like whip that pulls a creature toward you and deals piercing damage."},{name:"Thunderclap",description:"Create a burst of thunderous sound that damages all creatures within 5 feet."}],Bard:[{name:"Blade Ward",description:"Take the dodge action, gaining resistance to weapon damage."},{name:"Dancing Lights",description:"Create up to four lights that you can move around within 60 feet."},{name:"Friends",description:"Gain advantage on Charisma checks against one creature for 1 minute."},{name:"Light",description:"Make an object glow like a torch for 1 hour."},{name:"Mage Hand",description:"Create a spectral hand that can manipulate objects within 30 feet."},{name:"Mending",description:"Repair a single break or tear in an object you touch."},{name:"Message",description:"Whisper a message to a creature within 120 feet that only they can hear."},{name:"Minor Illusion",description:"Create a sound or image of an object within 30 feet."},{name:"Prestidigitation",description:"Perform minor magical tricks - clean, soil, chill, warm, flavor, or color objects."},{name:"True Strike",description:"Gain advantage on your next attack against the target within 30 feet."},{name:"Vicious Mockery",description:"Insult a creature within 60 feet, dealing psychic damage and possibly giving disadvantage."}]},_t={Wizard:{cantrips:3,spells:6},Sorcerer:{cantrips:4,spells:2},Warlock:{cantrips:2,spells:2},Cleric:{cantrips:3,spells:2},Druid:{cantrips:2,spells:2},Bard:{cantrips:2,spells:4}},Un=$=>{const ye=[...{Fighter:["Chain mail armor","Light crossbow and 20 bolts","Dungeoneer's pack","5 gp"],Wizard:["Arcane focus","Scholar's pack","Component pouch","5 gp"],Cleric:["Chain mail armor","Light crossbow and 20 bolts","Priest's pack","Shield","Holy symbol","5 gp"],Rogue:["Leather armor","Shortbow and 20 arrows","Burglar's pack","Thieves' tools","5 gp"],Ranger:["Scale mail armor","Longbow and 20 arrows","Explorer's pack","5 gp"],Paladin:["Chain mail armor","Javelins (5)","Priest's pack","Holy symbol","5 gp"],Barbarian:["Javelins (4)","Explorer's pack","5 gp"],Bard:["Leather armor","Diplomat's pack OR entertainer's pack","Lute OR any other musical instrument","5 gp"],Druid:["Leather armor","Druidic focus","Explorer's pack","Shield","5 gp"],Monk:["Dungeoneer's pack OR explorer's pack","5 gp"],Sorcerer:["Component pouch OR arcane focus","Dungeoneer's pack","5 gp"],Warlock:["Component pouch OR arcane focus","Scholar's pack","5 gp"]}[$]||["Adventurer's pack","Simple weapon","5 gp"]];return Fe.weapon&&ye.push(Fe.weapon),Fe.shield&&ye.push(Fe.shield),V.length>0&&ye.push(`Spells: ${V.join(", ")}`),ye},gn=()=>{const $=[];for(let Q=0;Q<4;Q++)$.push(Math.floor(Math.random()*6)+1);return $.sort((Q,ye)=>ye-Q),$.slice(0,3).reduce((Q,ye)=>Q+ye,0)},Jt=()=>{const $=[];for(let Q=0;Q<6;Q++)$.push(gn());return $.sort((Q,ye)=>ye-Q),N($),j([...$]),P({}),je(!0),$},Sn=($,Q)=>{const ye=A.filter(Ce=>Ce!==$);j(ye),P(Ce=>({...Ce,[Q]:$})),rt(Q,$)},In=$=>{const Q=D[$];if(Q){j(Ce=>[...Ce,Q].sort((at,Xt)=>Xt-at));const ye={...D};delete ye[$],P(ye),rt($,10)}},Nn=()=>{const $=["strength","dexterity","constitution","intelligence","wisdom","charisma"],Q={...k};We.forEach((ye,Ce)=>{Q[$[Ce]]=ye}),M(Q),P({}),j([]),je(!1)},rt=($,Q)=>{M(ye=>({...ye,[$]:Q||""}))},ne=async $=>{$.preventDefault(),i(!0),l("");try{const Q={name:k.name,race:k.race,class:k.class,level:k.level,userId:t.uid,partyId:e,weaponChoices:Fe,spellChoices:V,abilityScoreMethod:F,rolledScores:b,assignedScores:D,createdAt:new Date,updatedAt:new Date};await Qe();const ye=await tI(t.uid,e,Q);M(ye),d("Character saved successfully!");const Ce=!h;setTimeout(()=>{(Y==null?void 0:Y.campaignType)==="ai-assist"?n(`/campaign/${e}`):(Y==null?void 0:Y.dmId)===(t==null?void 0:t.uid)?n(`/manual-campaign-dm/${e}`):n(`/manual-campaign/${e}`)},1e3)}catch{l("Failed to save character")}finally{i(!1)}},re=async()=>{if(!E.trim()){alert("Please enter a name for your preset");return}if(!k.name||!k.race||!k.class){alert("Please fill in at least the basic character information (name, race, class) before saving as preset");return}try{const $={name:E,data:{...k,weaponChoices:Fe,spellChoices:V,abilityScoreMethod:F,rolledScores:b,assignedScores:D}},Q=await fI(t.uid,$);_(""),S(!1),await Fn(t.uid),alert("Character preset saved successfully!")}catch($){$.message.includes("User profile not found")?alert("User profile not found. Please try logging out and back in."):$.message.includes("permission")?alert("Permission denied. Please check your account status."):alert(`Failed to save preset: ${$.message}`)}},ie=$=>{$.key==="Enter"&&E.trim()&&re()},we=$=>{const Q=$.data;M({name:(Q.name||"")+" (Copy)",race:Q.race||"",class:Q.class||"",level:Q.level||1,background:Q.background||"",alignment:Q.alignment||"",strength:Q.strength||10,dexterity:Q.dexterity||10,constitution:Q.constitution||10,intelligence:Q.intelligence||10,wisdom:Q.wisdom||10,charisma:Q.charisma||10,age:Q.age||"",height:Q.height||"",weight:Q.weight||"",eyes:Q.eyes||"",skin:Q.skin||"",hair:Q.hair||"",personality:Q.personality||"",ideals:Q.ideals||"",bonds:Q.bonds||"",flaws:Q.flaws||"",backstory:Q.backstory||"",equipment:[],spells:Q.spells||[],proficiencies:Q.proficiencies||[],portrait:Q.portrait||"/placeholder-character.png"}),Q.weaponChoices&&et(Q.weaponChoices),Q.spellChoices&&K(Q.spellChoices),Q.abilityScoreMethod&&w(Q.abilityScoreMethod),Q.rolledScores&&(N(Q.rolledScores),P(Q.assignedScores||{}),je(Q.rolledScores.length>0)),C(!1)},He=async $=>{if(confirm("Are you sure you want to delete this preset? This action cannot be undone."))try{await gI(t.uid,$),await Fn(t.uid),alert("Preset deleted successfully!")}catch{alert("Failed to delete preset. Please try again.")}};if(!t)return null;if(!e)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-300",children:"Loading character creation..."}),o.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"No party ID found"})]})})});try{return o.jsx("div",{className:"fantasy-container py-8",children:o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h1",{className:"fantasy-title text-center",children:"Create Your Character"}),ae&&(Y==null?void 0:Y.campaignType)==="manual"&&o.jsxs("div",{className:"mb-6 p-4 bg-amber-500/20 border border-amber-500/30 rounded-lg",children:[o.jsxs("div",{className:"flex items-center justify-center mb-2",children:[o.jsx("span",{className:"text-amber-400 text-lg mr-2",children:""}),o.jsx("h3",{className:"text-amber-300 font-semibold",children:"Dungeon Master Notice"})]}),o.jsx("p",{className:"text-center text-amber-200 text-sm",children:"As the Dungeon Master in a Manual Campaign, you don't need to create a character. You'll be redirected to the campaign lobby where you can manage the story and encounters."})]}),o.jsx("p",{className:"text-center text-gray-300 mb-6",children:h?"Edit your character below. When you're ready, click 'Ready Up & Join Campaign' at the bottom!":"Create your character to join the campaign. Once created, you'll be able to ready up and join the adventure!"}),h&&o.jsx("div",{className:"mb-6 flex justify-center",children:o.jsx("button",{type:"button",className:"fantasy-button bg-blue-600 hover:bg-blue-700",onClick:()=>{(Y==null?void 0:Y.campaignType)==="ai-assist"?n(`/campaign/${e}`):(Y==null?void 0:Y.dmId)===(t==null?void 0:t.uid)?n(`/manual-campaign-dm/${e}`):n(`/manual-campaign/${e}`)},children:" Back to Campaign"})}),o.jsxs("div",{className:"mb-8 p-4 bg-gray-700 rounded-lg border border-gray-600",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-4",children:"Character Presets"}),o.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[o.jsxs("button",{type:"button",onClick:()=>C(!0),className:"fantasy-button bg-amber-600 hover:bg-amber-700",disabled:p.length===0,children:[" Load Preset (",p.length,")"]}),o.jsx("button",{type:"button",onClick:()=>S(!0),className:"fantasy-button bg-emerald-600 hover:bg-emerald-700",children:" Save as Preset"})]}),p.length>0&&o.jsx("p",{className:"text-sm text-gray-300",children:"Save your current character configuration as a preset to easily recreate it for other parties."})]}),o.jsxs("form",{onSubmit:$=>{ne($)},className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-name",className:"block text-sm font-medium text-gray-200 mb-2",children:"Character Name"}),o.jsx("input",{id:"character-name",name:"character-name",type:"text",value:k.name,onChange:$=>rt("name",$.target.value),className:"fantasy-input",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-race",className:"block text-sm font-medium text-gray-200 mb-2",children:"Race"}),o.jsxs("select",{id:"character-race",name:"character-race",value:k.race,onChange:$=>rt("race",$.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Race"}),$n.map($=>o.jsx("option",{value:$,children:$},$))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-class",className:"block text-sm font-medium text-gray-200 mb-2",children:"Class"}),o.jsxs("select",{id:"character-class",name:"character-class",value:k.class,onChange:$=>rt("class",$.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Class"}),jt.map($=>o.jsx("option",{value:$,children:$},$))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-background",className:"block text-sm font-medium text-gray-200 mb-2",children:"Background"}),o.jsxs("select",{id:"character-background",name:"character-background",value:k.background,onChange:$=>rt("background",$.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Background"}),rn.map($=>o.jsx("option",{value:$,children:$},$))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-alignment",className:"block text-sm font-medium text-gray-200 mb-2",children:"Alignment"}),o.jsxs("select",{id:"character-alignment",name:"character-alignment",value:k.alignment,onChange:$=>rt("alignment",$.target.value),className:"fantasy-input",required:!0,children:[o.jsx("option",{value:"",children:"Select Alignment"}),tt.map($=>o.jsx("option",{value:$,children:$},$))]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Ability Scores"}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{htmlFor:"ability-method-standard",className:"block text-sm font-medium text-gray-200 mb-2",children:"Ability Score Generation Method"}),o.jsxs("div",{className:"flex space-x-4 mb-4",children:[o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{id:"ability-method-standard",type:"radio",name:"abilityMethod",value:"standard",checked:F==="standard",onChange:$=>w($.target.value),className:"mr-2"}),o.jsx("span",{className:"text-gray-200",children:"Standard Array (15, 14, 13, 12, 10, 8)"})]}),o.jsxs("label",{className:"flex items-center",children:[o.jsx("input",{id:"ability-method-roll",type:"radio",name:"abilityMethod",value:"roll",checked:F==="roll",onChange:$=>w($.target.value),className:"mr-2"}),o.jsx("span",{className:"text-gray-200",children:"Roll 4d6, Drop Lowest"})]})]}),F==="standard"&&o.jsx("button",{type:"button",onClick:Nn,className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Apply Standard Array"}),F==="roll"&&o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{type:"button",onClick:Jt,disabled:Ve,className:`fantasy-button ${Ve?"bg-gray-500 cursor-not-allowed":"bg-gray-600 hover:bg-gray-700"}`,children:Ve?"Scores Already Rolled":"Roll Ability Scores"}),Ve&&o.jsx("p",{className:"text-sm text-gray-300",children:"You can only roll once, but you can reassign scores as many times as you like."}),b.length>0&&o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-semibold text-gray-100 mb-2",children:"Rolled Scores"}),o.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:A.map(($,Q)=>o.jsx("span",{className:"bg-amber-900 text-amber-200 border border-amber-600 px-3 py-1 rounded-full text-sm font-medium",children:$},`${$}-${Q}`))}),o.jsx("p",{className:"text-sm text-gray-300",children:"Click on an ability score below to assign your rolled scores. You can reassign them as many times as you want."})]})]})]}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:["strength","dexterity","constitution","intelligence","wisdom","charisma"].map($=>{const Q=D[$],ye=Q||k[$]||10;return o.jsxs("div",{className:"border border-gray-600 rounded-lg p-4",children:[o.jsx("label",{htmlFor:`ability-${$}`,className:"block text-sm font-medium text-gray-200 mb-2 capitalize",children:$}),Q?o.jsxs("div",{className:"space-y-2",children:[o.jsx("div",{className:"text-lg font-bold text-amber-400",children:Q}),o.jsx("button",{type:"button",onClick:()=>In($),className:"text-xs text-red-400 hover:text-red-300",children:"Unassign"})]}):o.jsxs("div",{className:"space-y-2",children:[o.jsx("input",{id:`ability-${$}`,name:`ability-${$}`,type:"number",min:"1",max:"20",value:ye,onChange:Ce=>rt($,parseInt(Ce.target.value)),className:"fantasy-input",required:!0}),A.length>0&&o.jsx("div",{className:"flex flex-wrap gap-1",children:A.map((Ce,at)=>o.jsx("button",{type:"button",onClick:()=>Sn(Ce,$),className:"bg-amber-900 hover:bg-amber-800 border border-amber-600 text-amber-200 px-2 py-1 rounded text-xs font-medium",children:Ce},`${Ce}-${at}`))})]}),o.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Modifier: ",Math.floor((ye-10)/2)]})]},$)})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Physical Description"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-age",className:"block text-sm font-medium text-gray-200 mb-2",children:"Age"}),o.jsx("input",{id:"character-age",name:"character-age",type:"text",placeholder:"Age",value:k.age,onChange:$=>rt("age",$.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-height",className:"block text-sm font-medium text-gray-200 mb-2",children:"Height"}),o.jsx("input",{id:"character-height",name:"character-height",type:"text",placeholder:"Height",value:k.height,onChange:$=>rt("height",$.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-weight",className:"block text-sm font-medium text-gray-200 mb-2",children:"Weight"}),o.jsx("input",{id:"character-weight",name:"character-weight",type:"text",placeholder:"Weight",value:k.weight,onChange:$=>rt("weight",$.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-eyes",className:"block text-sm font-medium text-gray-200 mb-2",children:"Eye Color"}),o.jsx("input",{id:"character-eyes",name:"character-eyes",type:"text",placeholder:"Eye Color",value:k.eyes,onChange:$=>rt("eyes",$.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-skin",className:"block text-sm font-medium text-gray-200 mb-2",children:"Skin Color"}),o.jsx("input",{id:"character-skin",name:"character-skin",type:"text",placeholder:"Skin Color",value:k.skin,onChange:$=>rt("skin",$.target.value),className:"fantasy-input"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-hair",className:"block text-sm font-medium text-gray-200 mb-2",children:"Hair Color"}),o.jsx("input",{id:"character-hair",name:"character-hair",type:"text",placeholder:"Hair Color",value:k.hair,onChange:$=>rt("hair",$.target.value),className:"fantasy-input"})]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Personality"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-personality",className:"block text-sm font-medium text-gray-200 mb-2",children:"Personality Traits"}),o.jsx("textarea",{id:"character-personality",name:"character-personality",value:k.personality,onChange:$=>rt("personality",$.target.value),className:"fantasy-input",rows:"3",placeholder:"Describe your character's personality..."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-ideals",className:"block text-sm font-medium text-gray-200 mb-2",children:"Ideals"}),o.jsx("textarea",{id:"character-ideals",name:"character-ideals",value:k.ideals,onChange:$=>rt("ideals",$.target.value),className:"fantasy-input",rows:"3",placeholder:"What does your character believe in?"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-bonds",className:"block text-sm font-medium text-gray-200 mb-2",children:"Bonds"}),o.jsx("textarea",{id:"character-bonds",name:"character-bonds",value:k.bonds,onChange:$=>rt("bonds",$.target.value),className:"fantasy-input",rows:"3",placeholder:"What connections does your character have?"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"character-flaws",className:"block text-sm font-medium text-gray-200 mb-2",children:"Flaws"}),o.jsx("textarea",{id:"character-flaws",name:"character-flaws",value:k.flaws,onChange:$=>rt("flaws",$.target.value),className:"fantasy-input",rows:"3",placeholder:"What are your character's weaknesses?"})]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Backstory"}),o.jsx("textarea",{id:"character-backstory",name:"character-backstory",value:k.backstory,onChange:$=>rt("backstory",$.target.value),className:"fantasy-input",rows:"6",placeholder:"Tell the story of your character's life before the adventure..."})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Starting Equipment"}),k.class&&qt[k.class]&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Weapons"}),o.jsx("div",{className:"space-y-4",children:Object.entries(qt[k.class]).map(([$,Q])=>o.jsxs("div",{children:[o.jsx("label",{htmlFor:`weapon-${$.toLowerCase().replace(/\s+/g,"")}`,className:"block text-sm font-medium text-gray-200 mb-2",children:$}),o.jsxs("select",{id:`weapon-${$.toLowerCase().replace(/\s+/g,"")}`,name:`weapon-${$.toLowerCase().replace(/\s+/g,"")}`,value:Fe[$.toLowerCase().replace(/\s+/g,"")]||"",onChange:ye=>et(Ce=>({...Ce,[$.toLowerCase().replace(/\s+/g,"")]:ye.target.value})),className:"fantasy-input",children:[o.jsxs("option",{value:"",children:["Select ",$]}),Q.map(ye=>o.jsx("option",{value:ye,children:ye},ye))]})]},$))})]}),k.class&&Tn[k.class]&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Choose Your Cantrips"}),o.jsxs("p",{className:"text-sm text-gray-300 mb-3",children:["Select your starting cantrips (0-level spells). You can choose up to ",((it=_t[k.class])==null?void 0:it.cantrips)||0," cantrips."]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto border border-gray-600 rounded-lg p-4",children:Tn[k.class].map($=>{var Ce;const Q=V.includes($.name),ye=!Q&&V.length>=(((Ce=_t[k.class])==null?void 0:Ce.cantrips)||0);return o.jsx("div",{className:`border rounded-lg p-3 ${Q?"border-amber-500 bg-amber-900/20":"border-gray-600"} ${ye?"opacity-50":"hover:border-gray-500"}`,children:o.jsxs("label",{className:`flex items-start space-x-3 cursor-pointer ${ye?"cursor-not-allowed":""}`,children:[o.jsx("input",{id:`spell-${$.name.toLowerCase().replace(/\s+/g,"-")}`,name:`spell-${$.name.toLowerCase().replace(/\s+/g,"-")}`,type:"checkbox",checked:Q,disabled:ye,onChange:at=>{at.target.checked?K(Xt=>[...Xt,$.name]):K(Xt=>Xt.filter(Zt=>Zt!==$.name))},className:"rounded mt-1"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-medium text-gray-100",children:$.name}),o.jsx("div",{className:"text-sm text-gray-300 mt-1",children:$.description})]})]})},$.name)})}),o.jsxs("div",{className:"flex justify-between items-center mt-3",children:[o.jsxs("p",{className:"text-sm text-gray-400",children:["Selected: ",V.length," / ",((Ye=_t[k.class])==null?void 0:Ye.cantrips)||0," cantrips"]}),V.length>=(((pt=_t[k.class])==null?void 0:pt.cantrips)||0)&&o.jsx("p",{className:"text-sm text-green-400 font-medium",children:" Cantrip selection complete"})]})]}),k.class?o.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:[o.jsxs("h3",{className:"font-semibold text-gray-100 mb-3",children:[k.class," Starting Equipment"]}),o.jsx("ul",{className:"space-y-1",children:Un(k.class).map(($,Q)=>o.jsxs("li",{className:"text-gray-200 flex items-start",children:[o.jsx("span",{className:"text-gray-400 mr-2",children:""}),$]},Q))}),o.jsx("p",{className:"text-sm text-gray-300 mt-3",children:"This equipment will be automatically assigned to your character."})]}):o.jsx("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4",children:o.jsx("p",{className:"text-gray-300",children:"Select a class to see your starting equipment."})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Character Portrait"}),o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("div",{className:"w-32 h-32 bg-gray-600 rounded-lg flex items-center justify-center",children:o.jsx("span",{className:"text-gray-400",children:"Portrait Placeholder"})}),o.jsx("button",{type:"button",className:"fantasy-button",onClick:()=>{},children:"Upload Image"})]})]}),o.jsx("div",{className:"flex justify-center",children:h?o.jsx("button",{type:"submit",className:"fantasy-button bg-blue-600 hover:bg-blue-700",disabled:s,children:s?"Updating Character...":"Update Character"}):o.jsx("button",{type:"submit",className:"fantasy-button",disabled:s,children:s?"Saving Character...":"Save Character"})})]}),v&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"fantasy-card max-w-md w-full mx-4",children:[o.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Save Character Preset"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"preset-name",className:"block text-sm font-medium text-gray-200 mb-2",children:"Preset Name"}),o.jsx("input",{id:"preset-name",name:"preset-name",type:"text",value:E,onChange:$=>_($.target.value),onKeyPress:ie,className:"fantasy-input",placeholder:"Enter a name for your preset",autoFocus:!0})]}),o.jsxs("div",{className:"flex space-x-3",children:[o.jsx("button",{type:"button",onClick:()=>{S(!1),_("")},className:"fantasy-button bg-gray-600 hover:bg-gray-700 flex-1",children:"Cancel"}),o.jsx("button",{type:"button",onClick:re,className:"fantasy-button bg-emerald-600 hover:bg-emerald-700 flex-1",children:"Save Preset"})]})]})]})}),x&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"fantasy-card max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsx("h3",{className:"fantasy-title text-center mb-4",children:"Load Character Preset"}),p.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-gray-300 mb-4",children:"No character presets found."}),o.jsx("p",{className:"text-sm text-gray-400",children:"Create a character and save it as a preset to see it here."}),o.jsx("button",{type:"button",onClick:()=>C(!1),className:"fantasy-button mt-4",children:"Close"})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"grid gap-4",children:p.map($=>o.jsxs("div",{className:"border border-gray-600 rounded-lg p-4 hover:border-gray-500",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-100",children:$.name}),o.jsxs("p",{className:"text-sm text-gray-300",children:[$.data.race," ",$.data.class,"  Level ",$.data.level]}),$.data.background&&o.jsx("p",{className:"text-sm text-gray-400",children:$.data.background}),$.createdAt&&o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Created: ",new Date($.createdAt.toDate()).toLocaleDateString()]})]}),o.jsx("button",{type:"button",onClick:()=>He($.id),className:"text-red-400 hover:text-red-300 text-sm",title:"Delete preset",children:""})]}),o.jsx("div",{className:"flex space-x-2",children:o.jsx("button",{type:"button",onClick:()=>we($),className:"fantasy-button bg-amber-600 hover:bg-amber-700 flex-1",children:"Load Preset"})})]},$.id))}),o.jsx("div",{className:"flex justify-center",children:o.jsx("button",{type:"button",onClick:()=>C(!1),className:"fantasy-button bg-gray-600 hover:bg-gray-700",children:"Cancel"})})]})]})})]})})}catch($){return console.error("Error rendering CharacterCreation:",$),o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-red-400 text-sm",children:"An error occurred while rendering the component."}),o.jsx("p",{className:"text-gray-300",children:"Please try again later."})]})})})}}class D4{constructor(){this.tileTypes={grass:{name:"Grass",color:"bg-green-600",symbol:""},water:{name:"Water",color:"bg-blue-500",symbol:""},mountain:{name:"Mountain",color:"bg-gray-600",symbol:""},forest:{name:"Forest",color:"bg-green-800",symbol:""},desert:{name:"Desert",color:"bg-yellow-600",symbol:""},swamp:{name:"Swamp",color:"bg-green-900",symbol:""},lava:{name:"Lava",color:"bg-red-800",symbol:""},ice:{name:"Ice",color:"bg-blue-200",symbol:""},sand:{name:"Sand",color:"bg-yellow-400",symbol:""},stone:{name:"Stone",color:"bg-gray-500",symbol:""},road:{name:"Road",color:"bg-yellow-800",symbol:""},bridge:{name:"Bridge",color:"bg-amber-700",symbol:""},stairs:{name:"Stairs",color:"bg-gray-400",symbol:""},path:{name:"Path",color:"bg-yellow-700",symbol:""},wall:{name:"Wall",color:"bg-gray-800",symbol:""},door:{name:"Door",color:"bg-amber-800",symbol:""},window:{name:"Window",color:"bg-blue-300",symbol:""},tower:{name:"Tower",color:"bg-gray-700",symbol:""},castle:{name:"Castle",color:"bg-gray-600",symbol:""},house:{name:"House",color:"bg-amber-600",symbol:""},temple:{name:"Temple",color:"bg-purple-700",symbol:""},cave:{name:"Cave",color:"bg-gray-900",symbol:""},chest:{name:"Chest",color:"bg-yellow-700",symbol:""},barrel:{name:"Barrel",color:"bg-amber-900",symbol:""},table:{name:"Table",color:"bg-amber-800",symbol:""},chair:{name:"Chair",color:"bg-amber-700",symbol:""},bed:{name:"Bed",color:"bg-blue-800",symbol:""},fireplace:{name:"Fireplace",color:"bg-red-700",symbol:""},altar:{name:"Altar",color:"bg-purple-800",symbol:""},fountain:{name:"Fountain",color:"bg-blue-400",symbol:""},statue:{name:"Statue",color:"bg-gray-300",symbol:""},tree:{name:"Tree",color:"bg-green-700",symbol:""},bush:{name:"Bush",color:"bg-green-600",symbol:""},npc:{name:"NPC",color:"bg-purple-600",symbol:""},enemy:{name:"Enemy",color:"bg-red-600",symbol:""},player:{name:"Player",color:"bg-blue-600",symbol:""},boss:{name:"Boss",color:"bg-red-800",symbol:""},merchant:{name:"Merchant",color:"bg-green-500",symbol:""},guard:{name:"Guard",color:"bg-blue-700",symbol:""},animal:{name:"Animal",color:"bg-orange-600",symbol:""},portal:{name:"Portal",color:"bg-purple-500",symbol:""},trap:{name:"Trap",color:"bg-red-500",symbol:""},magic:{name:"Magic",color:"bg-purple-400",symbol:""},crystal:{name:"Crystal",color:"bg-cyan-400",symbol:""},empty:{name:"Empty",color:"bg-slate-700",symbol:""}}}async loadCampaignData(e){try{const t=await Nt(e);if(t)return t;{const r={partyId:e,type:"manual",currentScene:"",storyHistory:[],status:"active",playerViewMode:"hidden",createdAt:new Date};return{id:(await Es(ft(be,"campaignStories"),r)).id,...r}}}catch(t){throw console.error("Error loading campaign data:",t),t}}async saveScene(e,t,r){try{const s={...t,currentScene:r,storyHistory:[...(t==null?void 0:t.storyHistory)||[],{timestamp:new Date,content:r,type:"scene"}]};return await st(t.id,s),s}catch(s){throw console.error("Error saving scene:",s),s}}async endSession(e,t){try{const r={...t,status:"ended",endedAt:new Date};return await st(t.id,r),r}catch(r){throw console.error("Error ending session:",r),r}}loadMap(e){try{const t=localStorage.getItem(`campaign-map-${e}`);if(t){const r=JSON.parse(t);return{title:r.title||"Campaign Map",content:r.content||[],size:r.size||{width:15,height:10},subMaps:r.subMaps||{},updatedAt:r.updatedAt}}else return{title:"Campaign Map",content:this.initializeMap({width:15,height:10}),size:{width:15,height:10},subMaps:{},updatedAt:new Date().toISOString()}}catch(t){return console.error("Error loading map:",t),{title:"Campaign Map",content:this.initializeMap({width:15,height:10}),size:{width:15,height:10},subMaps:{},updatedAt:new Date().toISOString()}}}saveMap(e,t){try{const r={title:t.title,content:t.content,size:t.size,subMaps:t.subMaps,updatedAt:new Date().toISOString()};return localStorage.setItem(`campaign-map-${e}`,JSON.stringify(r)),!0}catch(r){throw console.error("Error saving map:",r),r}}convertMapToFirestore(e){const t={};e.content&&Array.isArray(e.content)&&e.content.forEach((s,i)=>{Array.isArray(s)&&s.forEach((a,l)=>{t[`${l}-${i}`]=a})});const r={};return e.subMaps&&typeof e.subMaps=="object"&&Object.keys(e.subMaps).forEach(s=>{const i=e.subMaps[s];if(Array.isArray(i)){const a={};i.forEach((l,c)=>{Array.isArray(l)&&l.forEach((d,h)=>{a[`${h}-${c}`]=d})}),r[s]=a}}),{title:e.title,content:t,size:e.size,subMaps:r,updatedAt:new Date().toISOString()}}convertMapFromFirestore(e){if(!e)return null;const t=[];if(e.content&&typeof e.content=="object"){const s=e.size||{width:15,height:10};for(let i=0;i<s.height;i++){const a=[];for(let l=0;l<s.width;l++){const c=`${l}-${i}`;a.push(e.content[c]||"empty")}t.push(a)}}const r={};return e.subMaps&&typeof e.subMaps=="object"&&Object.keys(e.subMaps).forEach(s=>{const i=e.subMaps[s];if(typeof i=="object"){const a=[];for(let l=0;l<8;l++){const c=[];for(let d=0;d<8;d++){const h=`${d}-${l}`;c.push(i[h]||"empty")}a.push(c)}r[s]=a}}),{title:e.title,content:t,size:e.size,subMaps:r,updatedAt:e.updatedAt}}async saveMapToDatabase(e,t){try{const r=this.convertMapToFirestore(t),s=await Nt(e);if(!s)throw new Error("Campaign story not found");return await st(s.id,{campaignMap:r}),!0}catch(r){throw console.error("Error saving map to database:",r),r}}async loadMapFromDatabase(e){try{const t=await Nt(e);return!t||!t.campaignMap?this.loadMap(e):this.convertMapFromFirestore(t.campaignMap)}catch(t){return console.error("Error loading map from database:",t),this.loadMap(e)}}initializeMap(e){const t=[];for(let r=0;r<e.height;r++){const s=[];for(let i=0;i<e.width;i++)s.push("empty");t.push(s)}return t}initializeSubMap(){const e=[];for(let t=0;t<8;t++){const r=[];for(let s=0;s<8;s++)r.push("empty");e.push(r)}return e}updateMapTile(e,t,r,s){const i=[...e];return i[r][t]=s,i}updateSubMapTile(e,t,r,s){const i=[...e];return i[r][t]=s,i}getTileHasSubMap(e,t,r){const s=`${t}-${r}`;return e[s]&&e[s].some(i=>i.some(a=>a!=="empty"))}saveSubMap(e,t,r,s){const i=`${t}-${r}`;return{...e,[i]:s}}async startCombat(e,t,r,s){if(!r.trim())throw new Error("Please enter enemy details before starting combat");try{const a=r.split(`
`).filter(c=>c.trim()).map((c,d)=>{const[h,m,p,y]=c.split(",").map(v=>v.trim());return{id:`enemy_${d}`,name:h||`Enemy ${d+1}`,hp:parseInt(m)||20,maxHp:parseInt(m)||20,ac:parseInt(p)||12,level:parseInt(y)||1,class:"enemy",race:"unknown"}});return await Kn.createCombatSession(e,t,a,s||"Manual combat encounter")}catch(i){throw console.error("Error starting combat:",i),i}}getTileTypes(){return this.tileTypes}validateMapSize(e,t){return{width:Math.max(5,Math.min(30,e)),height:Math.max(5,Math.min(20,t))}}async setPlayerReady(e,t){try{const r=await Nt(e),s=(r==null?void 0:r.readyPlayers)||[];if(!s.includes(t)){const i={...r,readyPlayers:[...s,t]};await st(e,i)}return!0}catch(r){throw console.error("Error setting player ready:",r),r}}async checkAllPlayersReady(e,t){try{const r=await Nt(e);return((r==null?void 0:r.readyPlayers)||[]).length===t}catch(r){return console.error("Error checking player readiness:",r),!1}}async getPartyData(e){try{return await Ko(e)}catch(t){throw console.error("Error getting party by ID:",t),t}}}const Je=new D4;function M4(){var ye,Ce,at,Xt,Zt;const{partyId:n}=Mo(),e=hr(),[t,r]=I.useState(null),[s,i]=I.useState(!0),[a,l]=I.useState(null),[c,d]=I.useState([]),[h,m]=I.useState({}),[p,y]=I.useState(null),[v,S]=I.useState(!1),[E,_]=I.useState(null),[x,C]=I.useState(!1),[k,M]=I.useState(!1),[F,w]=I.useState([]),[b,N]=I.useState("Campaign Map"),[A,j]=I.useState({width:15,height:10}),[D,P]=I.useState("grass"),[Ve,je]=I.useState("draw"),[Fe,et]=I.useState(!1),[V,K]=I.useState({x:0,y:0}),[Y,fe]=I.useState({}),[ae,te]=I.useState(null),[U,me]=I.useState(!1),[Ae,Qe]=I.useState(!1),[Fn,$n]=I.useState({x:0,y:0});I.useEffect(()=>{const H=xa(ee=>{if(!ee){e("/login");return}r(ee)});return()=>H()},[e]),I.useEffect(()=>{t&&n&&(jt(),Tn())},[t,n]),I.useEffect(()=>{const H=()=>{Qe(!1)};return document.addEventListener("mouseup",H),()=>{document.removeEventListener("mouseup",H)}},[]);const jt=async()=>{try{i(!0);const H=await Ko(n);l(H),S(H.dmId===t.uid);const ee=await hs(n);d(ee);const Ee=ee.find(B=>B.userId===t.uid);if(y(Ee),H.members&&H.members.length>0){const B=await Zd(H.members),G={};B.forEach(de=>{de&&de.userId&&(G[de.userId]=de)}),m(G)}}catch(H){console.error("Error loading lobby data:",H)}finally{i(!1)}},tt=()=>{a.campaignType==="manual"?a.dmId===t.uid?e(`/manual-campaign-dm/${n}`):e(`/manual-campaign/${n}`):e(`/campaign/${n}`)},rn=()=>{localStorage.setItem(`campaign-map-${n}`,JSON.stringify({title:b,content:F,size:A,subMaps:Y,updatedAt:new Date().toISOString()})),M(!1)},We=Je.getTileTypes(),qt=()=>{const H=[];for(let ee=0;ee<A.height;ee++){const Ee=[];for(let B=0;B<A.width;B++)Ee.push("empty");H.push(Ee)}return H},Tn=()=>{const H=localStorage.getItem(`campaign-map-${n}`);if(H){const ee=JSON.parse(H);N(ee.title),w(ee.content||[]),fe(ee.subMaps||{}),ee.size&&j(ee.size)}else w(qt())},_t=(H,ee)=>{if(Ve==="draw"){const Ee=[...F];Ee[ee][H]=D,w(Ee)}else if(Ve==="erase"){const Ee=[...F];Ee[ee][H]="empty",w(Ee)}},Un=(H,ee)=>{Qe(!0),$n({x:H,y:ee}),_t(H,ee)},gn=(H,ee)=>{Ae&&_t(H,ee)},Jt=()=>{Qe(!1)},Sn=()=>{w(qt())},In=()=>{const H=qt();w(H)},Nn=(H,ee,Ee)=>{Ee.preventDefault();const B=`${H}-${ee}`;K({x:H,y:ee}),te(Y[B]||rt()),et(!0)},rt=()=>{const H=[];for(let ee=0;ee<8;ee++){const Ee=[];for(let B=0;B<8;B++)Ee.push("empty");H.push(Ee)}return H},ne=(H,ee)=>{if(Ve==="draw"){const Ee=[...ae];Ee[ee][H]=D,te(Ee)}else if(Ve==="erase"){const Ee=[...ae];Ee[ee][H]="empty",te(Ee)}},re=(H,ee)=>{Qe(!0),$n({x:H,y:ee}),ne(H,ee)},ie=(H,ee)=>{Ae&&ne(H,ee)},we=()=>{const H=`${V.x}-${V.y}`,ee={...Y,[H]:ae};fe(ee),et(!1)},He=()=>{te(rt())},it=(H,ee)=>{const Ee=`${H}-${ee}`;return Y[Ee]&&Y[Ee].some(B=>B.some(G=>G!=="empty"))},Ye=H=>{const ee=h[H];return ee!=null&&ee.username?ee.username:ee!=null&&ee.displayName?ee.displayName:ee!=null&&ee.email?ee.email.split("@")[0]:"Unknown User"},pt=H=>H?H.name&&H.race&&H.class?"Ready":"Incomplete":"No Character",$=H=>{switch(H){case"Ready":return"text-green-400";case"Incomplete":return"text-yellow-400";case"No Character":return"text-red-400";default:return"text-slate-400"}},Q=H=>{switch(H){case"Ready":return"";case"Incomplete":return"";case"No Character":return"";default:return""}};return s?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-amber-400 border-t-transparent mx-auto mb-4"}),o.jsx("p",{className:"text-slate-300 text-lg font-medium",children:"Loading campaign lobby..."})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:o.jsxs("div",{className:"fantasy-container",children:[o.jsx("div",{className:"mb-8",children:o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("h1",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-400 mb-4",children:"Campaign Lobby"}),o.jsx("div",{className:"w-24 h-1 bg-gradient-to-r from-amber-400 to-orange-400 mx-auto rounded-full mb-4"}),o.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-2",children:a.name}),o.jsx("p",{className:"text-slate-400 mb-4",children:a.description}),o.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[o.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${a.campaignType==="ai-assist"?"bg-amber-500/20 text-amber-300 border border-amber-500/30":"bg-slate-600/20 text-slate-300 border border-slate-500/30"}`,children:a.campaignType==="ai-assist"?" AI Assist":" Manual Campaign"}),o.jsxs("div",{className:"text-slate-400",children:[c.filter(H=>H.userId!==a.dmId).length," / ",a.maxPlayers," Players"]})]})]})}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:(()=>{var H,ee;return console.log(" DEBUG - Party Data:",{partyMembers:a.members,dmId:a.dmId,currentUserId:t.uid,filteredMembers:(H=a.members)==null?void 0:H.filter(Ee=>Ee!==a.dmId)}),(ee=a.members)==null?void 0:ee.filter(Ee=>Ee!==a.dmId).map(Ee=>{const B=c.find(ce=>ce.userId===Ee),G=pt(B),de=Ee===t.uid;return o.jsxs("div",{className:`fantasy-card ${de?"ring-2 ring-amber-500/50":""}`,children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mr-3",children:o.jsx("span",{className:"text-slate-300 font-semibold",children:Ye(Ee).charAt(0).toUpperCase()})}),o.jsx("div",{children:o.jsx("h3",{className:"font-semibold text-slate-100",children:Ye(Ee)})})]}),o.jsxs("div",{className:`text-sm font-medium ${$(G)}`,children:[Q(G)," ",G]})]}),B&&o.jsx("div",{className:"space-y-2",children:o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-3",children:[o.jsx("h4",{className:"font-semibold text-slate-100 mb-1",children:B.name}),o.jsxs("p",{className:"text-sm text-slate-400",children:[B.race," ",B.class,"  Level ",B.level]}),B.background&&o.jsx("p",{className:"text-xs text-slate-500 mt-1",children:B.background})]})})]},Ee)})})()}),F&&F.length>0&&o.jsxs("div",{className:"fantasy-card mb-8",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100",children:b}),v&&o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>M(!0),className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 text-sm",children:" Edit Map"}),o.jsx("button",{onClick:()=>me(!0),className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 text-sm",children:" View Characters"})]})]}),o.jsx("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4 overflow-x-auto",children:o.jsx("div",{className:"inline-block",children:F.map((H,ee)=>o.jsx("div",{className:"flex",children:H.map((Ee,B)=>{var G,de,ce;return o.jsxs("div",{className:`w-8 h-8 border border-slate-600 flex items-center justify-center text-xs relative ${((G=We[Ee])==null?void 0:G.color)||"bg-slate-700"}`,title:`${B}, ${ee}: ${((de=We[Ee])==null?void 0:de.name)||"Unknown"}${it(B,ee)?" (Has sub-map)":""}`,onContextMenu:xe=>Nn(B,ee,xe),children:[((ce=We[Ee])==null?void 0:ce.symbol)||"",it(B,ee)&&o.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-purple-500 rounded-full flex items-center justify-center text-[8px] text-white",children:""})]},`${B}-${ee}`)})},ee))})}),o.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-4 items-center justify-between",children:[o.jsxs("div",{className:"text-xs text-slate-400 text-center sm:text-left",children:[" ",o.jsx("strong",{children:"Tip:"})," Right-click on any tile to create or edit sub-maps (detailed areas within tiles)"]}),o.jsx("div",{className:"text-xs text-slate-400 text-center sm:text-right",children:" Purple pins indicate tiles with sub-maps"})]})]}),o.jsxs("div",{className:"mt-8 fantasy-card",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-4",children:"Campaign Information"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Campaign Type:"}),o.jsx("span",{className:"text-slate-200 ml-2",children:a.campaignType==="ai-assist"?"AI-Assisted Storytelling":"Manual D&D Experience"})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Max Players:"}),o.jsx("span",{className:"text-slate-200 ml-2",children:a.maxPlayers})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Dungeon Master:"}),o.jsx("span",{className:"text-slate-200 ml-2",children:Ye(a.dmId)})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Status:"}),o.jsx("span",{className:"text-slate-200 ml-2",children:c.filter(H=>H.userId!==a.dmId).length===((ye=a.members)==null?void 0:ye.length)-1?"Ready to Start":"Waiting for Characters"})]})]}),o.jsx("div",{className:"mt-6 pt-6 border-t border-slate-600",children:o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[o.jsx("div",{className:"text-sm text-slate-400",children:c.filter(H=>H.userId!==a.dmId).length===((Ce=a.members)==null?void 0:Ce.length)-1?"All players have characters and are ready to begin!":"Waiting for all players to create their characters..."}),o.jsx("button",{onClick:tt,disabled:c.filter(H=>H.userId!==a.dmId).length!==((at=a.members)==null?void 0:at.length)-1,className:`px-6 py-3 rounded-lg font-semibold transition-all duration-300 ${c.filter(H=>H.userId!==a.dmId).length===((Xt=a.members)==null?void 0:Xt.length)-1?"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white shadow-lg":"bg-slate-600 text-slate-400 cursor-not-allowed"}`,children:v?a.campaignType==="manual"?" Start Manual Campaign":" Start AI Campaign":a.campaignType==="manual"?" Join Manual Campaign":" Join AI Campaign"})]})})]}),x&&E&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"fantasy-card max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h2",{className:"text-2xl font-bold text-slate-100",children:["Character Sheet: ",E.name]}),o.jsx("button",{onClick:()=>C(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:""})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Basic Information"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Name:"})," ",o.jsx("span",{className:"text-slate-200",children:E.name})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Race:"})," ",o.jsx("span",{className:"text-slate-200",children:E.race})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Class:"})," ",o.jsx("span",{className:"text-slate-200",children:E.class})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Level:"})," ",o.jsx("span",{className:"text-slate-200",children:E.level})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Background:"})," ",o.jsx("span",{className:"text-slate-200",children:E.background})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Alignment:"})," ",o.jsx("span",{className:"text-slate-200",children:E.alignment})]})]})]}),o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Ability Scores"}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Strength:"})," ",o.jsx("span",{className:"text-slate-200",children:E.strength})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Dexterity:"})," ",o.jsx("span",{className:"text-slate-200",children:E.dexterity})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Constitution:"})," ",o.jsx("span",{className:"text-slate-200",children:E.constitution})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Intelligence:"})," ",o.jsx("span",{className:"text-slate-200",children:E.intelligence})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Wisdom:"})," ",o.jsx("span",{className:"text-slate-200",children:E.wisdom})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Charisma:"})," ",o.jsx("span",{className:"text-slate-200",children:E.charisma})]})]})]}),(E.age||E.height||E.weight||E.eyes||E.skin||E.hair)&&o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Physical Description"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[E.age&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Age:"})," ",o.jsx("span",{className:"text-slate-200",children:E.age})]}),E.height&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Height:"})," ",o.jsx("span",{className:"text-slate-200",children:E.height})]}),E.weight&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Weight:"})," ",o.jsx("span",{className:"text-slate-200",children:E.weight})]}),E.eyes&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Eyes:"})," ",o.jsx("span",{className:"text-slate-200",children:E.eyes})]}),E.skin&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Skin:"})," ",o.jsx("span",{className:"text-slate-200",children:E.skin})]}),E.hair&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Hair:"})," ",o.jsx("span",{className:"text-slate-200",children:E.hair})]})]})]})]}),o.jsxs("div",{className:"space-y-4",children:[(E.personality||E.ideals||E.bonds||E.flaws)&&o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Character Traits"}),o.jsxs("div",{className:"space-y-3 text-sm",children:[E.personality&&o.jsxs("div",{children:[o.jsx("div",{className:"text-slate-400 font-medium",children:"Personality:"}),o.jsx("div",{className:"text-slate-200",children:E.personality})]}),E.ideals&&o.jsxs("div",{children:[o.jsx("div",{className:"text-slate-400 font-medium",children:"Ideals:"}),o.jsx("div",{className:"text-slate-200",children:E.ideals})]}),E.bonds&&o.jsxs("div",{children:[o.jsx("div",{className:"text-slate-400 font-medium",children:"Bonds:"}),o.jsx("div",{className:"text-slate-200",children:E.bonds})]}),E.flaws&&o.jsxs("div",{children:[o.jsx("div",{className:"text-slate-400 font-medium",children:"Flaws:"}),o.jsx("div",{className:"text-slate-200",children:E.flaws})]})]})]}),E.backstory&&o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Backstory"}),o.jsx("div",{className:"text-sm text-slate-200 leading-relaxed",children:E.backstory})]}),E.equipment&&E.equipment.length>0&&o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Equipment"}),o.jsx("ul",{className:"space-y-1 text-sm",children:E.equipment.map((H,ee)=>o.jsxs("li",{className:"text-slate-200",children:[" ",H]},ee))})]}),E.spells&&E.spells.length>0&&o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Spells"}),o.jsx("ul",{className:"space-y-1 text-sm",children:E.spells.map((H,ee)=>o.jsxs("li",{className:"text-slate-200",children:[" ",H]},ee))})]})]})]})]})}),U&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"fantasy-card max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"All Party Character Sheets"}),o.jsx("button",{onClick:()=>me(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:""})]}),o.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:c.map(H=>o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:H.name}),o.jsx("span",{className:"text-sm text-slate-400",children:Ye(H.userId)})]}),o.jsxs("div",{className:"space-y-3 text-sm",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Race:"})," ",o.jsx("span",{className:"text-slate-200",children:H.race})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Class:"})," ",o.jsx("span",{className:"text-slate-200",children:H.class})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Level:"})," ",o.jsx("span",{className:"text-slate-200",children:H.level})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Background:"})," ",o.jsx("span",{className:"text-slate-200",children:H.background})]})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"STR:"})," ",o.jsx("span",{className:"text-slate-200",children:H.strength})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"DEX:"})," ",o.jsx("span",{className:"text-slate-200",children:H.dexterity})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"CON:"})," ",o.jsx("span",{className:"text-slate-200",children:H.constitution})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"INT:"})," ",o.jsx("span",{className:"text-slate-200",children:H.intelligence})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"WIS:"})," ",o.jsx("span",{className:"text-slate-200",children:H.wisdom})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"CHA:"})," ",o.jsx("span",{className:"text-slate-200",children:H.charisma})]})]}),o.jsxs("div",{className:"flex justify-between text-xs",children:[o.jsxs("span",{children:[o.jsx("span",{className:"text-slate-400",children:"HP:"})," ",o.jsxs("span",{className:"text-slate-200",children:[H.hp,"/",H.maxHp]})]}),o.jsxs("span",{children:[o.jsx("span",{className:"text-slate-400",children:"AC:"})," ",o.jsx("span",{className:"text-slate-200",children:H.ac})]})]}),H.backstory&&o.jsxs("div",{className:"mt-3",children:[o.jsx("div",{className:"text-slate-400 font-medium text-xs mb-1",children:"Backstory:"}),o.jsx("div",{className:"text-slate-200 text-xs leading-relaxed line-clamp-3",children:H.backstory})]})]})]},H.id))})]})}),k&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"fantasy-card max-w-6xl w-full max-h-[95vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Grid-Based Map Editor"}),o.jsx("button",{onClick:()=>M(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:""})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[o.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Map Settings"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Map Title"}),o.jsx("input",{type:"text",value:b,onChange:H=>N(H.target.value),className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50",placeholder:"Enter map title..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Map Size"}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Width"}),o.jsx("input",{type:"number",min:"5",max:"30",value:A.width,onChange:H=>{j(ee=>({...ee,width:parseInt(H.target.value)})),In()},className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Height"}),o.jsx("input",{type:"number",min:"5",max:"20",value:A.height,onChange:H=>{j(ee=>({...ee,height:parseInt(H.target.value)})),In()},className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50"})]})]})]})]})]}),o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tools"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{onClick:()=>je("draw"),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${Ve==="draw"?"bg-amber-500/20 text-amber-300 border border-amber-500/30":"bg-slate-700/30 text-slate-300 hover:bg-slate-700/50"}`,children:" Draw"}),o.jsx("button",{onClick:()=>je("erase"),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${Ve==="erase"?"bg-red-500/20 text-red-300 border border-red-500/30":"bg-slate-700/30 text-slate-300 hover:bg-slate-700/50"}`,children:" Erase"})]})]}),o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tile Palette"}),o.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-96 overflow-y-auto",children:Object.entries(We).map(([H,ee])=>o.jsxs("button",{onClick:()=>P(H),className:`p-2 rounded-lg border transition-colors ${D===H?"border-amber-500 bg-amber-500/20":"border-slate-600 bg-slate-700/30 hover:border-slate-500"}`,children:[o.jsx("div",{className:`w-6 h-6 ${ee.color} rounded flex items-center justify-center text-xs mx-auto mb-1`,children:ee.symbol}),o.jsx("div",{className:"text-xs text-slate-300 truncate",children:ee.name})]},H))})]}),o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Actions"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{onClick:Sn,className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:" Clear Map"}),o.jsx("button",{onClick:rn,className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:" Save Map"})]})]})]}),o.jsxs("div",{className:"lg:col-span-3",children:[o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Map Canvas"}),o.jsxs("div",{className:"text-sm text-slate-400",children:[A.width,"  ",A.height," grid"]})]}),o.jsx("div",{className:"overflow-auto",children:o.jsx("div",{className:"inline-block",children:F.map((H,ee)=>o.jsx("div",{className:"flex",children:H.map((Ee,B)=>{var G,de,ce;return o.jsxs("button",{onMouseDown:()=>Un(B,ee),onMouseEnter:()=>gn(B,ee),onMouseUp:Jt,onContextMenu:xe=>Nn(B,ee,xe),className:`w-10 h-10 border border-slate-600 flex items-center justify-center text-sm transition-colors hover:border-amber-400 relative select-none ${((G=We[Ee])==null?void 0:G.color)||"bg-slate-700"}`,title:`${B}, ${ee}: ${((de=We[Ee])==null?void 0:de.name)||"Unknown"}${it(B,ee)?" (Right-click for sub-map)":" (Right-click to create sub-map)"}`,children:[((ce=We[Ee])==null?void 0:ce.symbol)||"",it(B,ee)&&o.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-purple-500 rounded-full flex items-center justify-center text-[10px] text-white",children:""})]},`${B}-${ee}`)})},ee))})})]}),o.jsxs("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4 text-xs text-slate-400",children:[o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-3",children:[o.jsx("div",{className:"font-semibold text-slate-300 mb-1",children:"Current Status"}),o.jsxs("div",{children:["Tool: ",o.jsx("span",{className:"text-amber-300",children:Ve==="draw"?" Draw":" Erase"})]}),o.jsxs("div",{children:["Tile: ",o.jsx("span",{className:"text-amber-300",children:(Zt=We[D])==null?void 0:Zt.name})]})]}),o.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-3",children:[o.jsx("div",{className:"font-semibold text-slate-300 mb-1",children:"Instructions"}),o.jsx("div",{children:" Click or drag to place/remove"}),o.jsx("div",{children:" Right-click for sub-maps"}),o.jsx("div",{children:" Purple pins = sub-maps"})]})]})]})]})]})}),Fe&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"fantasy-card max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h2",{className:"text-2xl font-bold text-slate-100",children:["Sub-Map Editor - Tile (",V.x,", ",V.y,")"]}),o.jsx("button",{onClick:()=>et(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:""})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[o.jsx("div",{className:"lg:col-span-2",children:o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Sub-Map (8x8)"}),o.jsx("button",{onClick:He,className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm",children:"Clear"})]}),o.jsx("div",{className:"grid grid-cols-8 gap-1 mb-4",children:ae.map((H,ee)=>H.map((Ee,B)=>{var G,de,ce;return o.jsx("button",{onMouseDown:()=>re(B,ee),onMouseEnter:()=>ie(B,ee),onMouseUp:Jt,className:`w-12 h-12 border border-slate-600 flex items-center justify-center text-lg transition-colors hover:border-amber-400 select-none ${((G=We[Ee])==null?void 0:G.color)||"bg-slate-700"}`,title:`${B}, ${ee}: ${((de=We[Ee])==null?void 0:de.name)||"Empty"}`,children:((ce=We[Ee])==null?void 0:ce.symbol)||""},`sub-${B}-${ee}`)}))})]})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tools"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{onClick:()=>je("draw"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${Ve==="draw"?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:" Draw"}),o.jsx("button",{onClick:()=>je("erase"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${Ve==="erase"?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:" Erase"})]})]}),o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tile Types"}),o.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-80 overflow-y-auto",children:Object.entries(We).map(([H,ee])=>o.jsxs("button",{onClick:()=>P(H),className:`p-2 rounded text-sm font-medium transition-colors flex items-center gap-2 ${D===H?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[o.jsx("span",{className:"text-lg",children:ee.symbol}),o.jsx("span",{className:"truncate",children:ee.name})]},H))})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:we,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded font-medium",children:"Save Sub-Map"}),o.jsx("button",{onClick:()=>et(!1),className:"px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded font-medium",children:"Cancel"})]})]})]})]})})]})})}const ka={INVESTIGATION:"investigation",COMBAT:"combat",PERSUASION:"persuasion",EXPLORATION:"exploration",SOCIAL:"social"},Kr={HIDDEN:"hidden",DISCOVERED:"discovered",IN_PROGRESS:"in_progress",COMPLETED:"completed",FAILED:"failed"},V4=n=>{const e=[{id:"investigate_area",type:ka.INVESTIGATION,title:"Investigate the Area",description:"Search for clues and gather information about the situation",keywords:["search","investigate","examine","look around","check","explore"],state:Kr.HIDDEN,discoveredAt:null,completedAt:null},{id:"resolve_conflict",type:ka.COMBAT,title:"Resolve the Conflict",description:"Engage in combat to overcome the threat",keywords:["fight","attack","defend","combat","battle"],state:Kr.HIDDEN,discoveredAt:null,completedAt:null},{id:"negotiate_peace",type:ka.PERSUASION,title:"Negotiate Peace",description:"Use diplomacy and persuasion to resolve the situation peacefully",keywords:["talk","negotiate","persuade","convince","diplomacy","peace"],state:Kr.HIDDEN,discoveredAt:null,completedAt:null}],t=[];return(n.toLowerCase().includes("thief")||n.toLowerCase().includes("stealth"))&&t.push({id:"stealth_approach",type:ka.EXPLORATION,title:"Stealth Approach",description:"Use stealth to avoid detection and gather information",keywords:["sneak","stealth","hide","silent","unnoticed"],state:Kr.HIDDEN,discoveredAt:null,completedAt:null}),(n.toLowerCase().includes("merchant")||n.toLowerCase().includes("trade"))&&t.push({id:"establish_trade",type:ka.SOCIAL,title:"Establish Trade Relations",description:"Build economic relationships with the locals",keywords:["trade","bargain","deal","commerce","business"],state:Kr.HIDDEN,discoveredAt:null,completedAt:null}),(n.toLowerCase().includes("scholar")||n.toLowerCase().includes("knowledge"))&&t.push({id:"gather_knowledge",type:ka.INVESTIGATION,title:"Gather Ancient Knowledge",description:"Discover and preserve valuable information",keywords:["research","study","learn","knowledge","ancient","lore"],state:Kr.HIDDEN,discoveredAt:null,completedAt:null}),[...e,...t]},hb=n=>n.filter(e=>e.state===Kr.DISCOVERED||e.state===Kr.IN_PROGRESS||e.state===Kr.COMPLETED);class _I{constructor(){this.diceTypes={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20,d100:100},this.difficultyClasses={veryEasy:5,easy:10,medium:15,hard:20,veryHard:25,nearlyImpossible:30},this.actionTypes={attack:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:10,description:"Physical attack roll"},spell:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:12,description:"Spell casting check"},dodge:{primaryAbility:"dexterity",secondaryAbility:"wisdom",baseDC:15,description:"Dodge incoming attacks"},parry:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:18,description:"Parry with weapon"},backflip:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:20,description:"Perform a backflip"},somersault:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:18,description:"Perform a somersault"},cartwheel:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:16,description:"Perform a cartwheel"},wallRun:{primaryAbility:"dexterity",secondaryAbility:"strength",baseDC:22,description:"Run up a wall"},jump:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:12,description:"Jump over obstacles"},climb:{primaryAbility:"strength",secondaryAbility:"dexterity",baseDC:15,description:"Climb surfaces"},swim:{primaryAbility:"strength",secondaryAbility:"constitution",baseDC:14,description:"Swim through water"},fly:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:30,description:"Fly through the air"},persuade:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:15,description:"Persuade someone"},intimidate:{primaryAbility:"charisma",secondaryAbility:"strength",baseDC:16,description:"Intimidate someone"},deceive:{primaryAbility:"charisma",secondaryAbility:"intelligence",baseDC:18,description:"Deceive someone"},spot:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:12,description:"Spot hidden objects or creatures"},listen:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:10,description:"Listen for sounds"},search:{primaryAbility:"intelligence",secondaryAbility:"wisdom",baseDC:14,description:"Search for hidden items"},pickLock:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:20,description:"Pick a lock"},disarmTrap:{primaryAbility:"dexterity",secondaryAbility:"intelligence",baseDC:22,description:"Disarm a trap"},heal:{primaryAbility:"wisdom",secondaryAbility:"intelligence",baseDC:16,description:"Provide medical aid"},craft:{primaryAbility:"intelligence",secondaryAbility:"dexterity",baseDC:18,description:"Craft an item"}},this.impossibleActionPatterns=[/\b(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,/\b(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,/\b(?:jump|leap)\s+(?:to|over|across)\s+(?:the\s+)?(?:moon|sky|clouds?)\b/gi,/\b(?:teleport|blink|phase)\s+(?:to|through)\b/gi,/\b(?:time\s+travel|rewind|fast\s+forward)\b/gi,/\b(?:summon|create)\s+(?:a\s+)?(?:dragon|god|demon)\b/gi,/\b(?:become|turn\s+into)\s+(?:invisible|invincible|immortal)\b/gi,/\b(?:kill|destroy|eliminate)\s+(?:the\s+)?(?:dm|dungeon\s+master|narrator)\b/gi,/\b(?:break|destroy)\s+(?:the\s+)?(?:fourth\s+wall|game|story)\b/gi,/\b(?:skip|ignore)\s+(?:the\s+)?(?:quest|mission|story)\b/gi,/\b(?:teleport|go)\s+(?:to\s+)?(?:the\s+)?(?:end|final\s+boss|treasure)\b/gi,/\b(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,/\b(?:open|unlock)\s+(?:the\s+)?(?:door|chest)\s+(?:without\s+)?(?:key|lockpick)\b/gi,/\b(?:find|locate)\s+(?:the\s+)?(?:hidden\s+)?(?:passage|door)\s+(?:without\s+)?(?:searching)\b/gi],this.circumstanceModifiers={"in darkness":-2,"in bright light":1,"in difficult terrain":-2,"on slippery surface":-3,"in water":-2,"in tight space":-1,"with cover":2,"with high ground":1,"with low ground":-1,"with proper tools":2,"with improvised tools":-1,"without tools":-3,"with magical item":1,"with masterwork item":2,"while injured":-2,"while exhausted":-3,"while hasted":2,"while blessed":1,"while cursed":-2,"while poisoned":-1,"under time pressure":-2,"with preparation":1,"with careful planning":2,"in a hurry":-2,"with authority":1,"with evidence":2,"with witnesses":-1,"in private":1,"in public":-1}}rollDie(e){return Math.floor(Math.random()*e)+1}rollDice(e,t){const r=[];for(let s=0;s<e;s++)r.push(this.rollDie(t));return r}rollWithAdvantage(){const e=this.rollDie(20),t=this.rollDie(20);return{result:Math.max(e,t),rolls:[e,t],advantage:!0}}rollWithDisadvantage(){const e=this.rollDie(20),t=this.rollDie(20);return{result:Math.min(e,t),rolls:[e,t],disadvantage:!0}}getAbilityModifier(e){return Math.floor((e-10)/2)}getProficiencyBonus(e){return Math.floor((e-1)/4)+2}performSkillCheck(e,t,r=[],s=null){const i=this.actionTypes[t];if(!i)throw new Error(`Unknown action type: ${t}`);let a=s||i.baseDC,l=0;r.forEach(x=>{this.circumstanceModifiers[x]&&(l+=this.circumstanceModifiers[x])});const c=this.getAbilityModifier(e[i.primaryAbility]||10),d=this.getAbilityModifier(e[i.secondaryAbility]||10),h=this.getProficiencyBonus(e.level||1),p=this.checkProficiency(e,t)?h:0,y=this.rollDie(20),v=y+c+p+l,S=v>=a,E=v-a;let _="failure";return S?E>=10?_="critical success":E>=5?_="great success":_="success":E<=-10?_="critical failure":E<=-5?_="great failure":_="failure",{actionType:t,roll:y,totalRoll:v,dc:a,primaryMod:c,secondaryMod:d,proficiencyMod:p,circumstanceBonus:l,isSuccess:S,degree:_,margin:E,circumstances:r,character:{name:e.name,level:e.level,[i.primaryAbility]:e[i.primaryAbility],[i.secondaryAbility]:e[i.secondaryAbility]}}}checkProficiency(e,t){const r=e.proficiencies||[],i={Fighter:["attack","dodge","parry"],Rogue:["dodge","pickLock","disarmTrap","spot","listen"],Wizard:["spell","search","craft"],Cleric:["heal","persuade","spot"],Ranger:["spot","listen","climb","swim"],Paladin:["attack","parry","persuade"],Monk:["attack","dodge","backflip","somersault","cartwheel"],Bard:["persuade","deceive","intimidate"],Druid:["heal","spot","listen"],Sorcerer:["spell","persuade"],Warlock:["spell","intimidate"],Barbarian:["attack","intimidate","jump","climb"]}[e.class]||[];return r.includes(t)||i.includes(t)}validateAction(e,t,r={}){const s=e.toLowerCase();for(const S of this.impossibleActionPatterns)if(S.test(s))return{possible:!1,reason:"This action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};let i=this.extractActionsFromDescription(s);if(i=i.filter(S=>S.type!==void 0),i.length===0)return{possible:!0,reason:"No valid action detected. Action appears to be narrative or unsupported.",suggestion:"Try a different action or rephrase your input.",actions:[],overallSuccess:!0,hasCriticalFailures:!1,criticalFailures:[]};const a=r.customContext;let l=[],c=[],d=[];a&&(a.environmentalFeatures&&(c=a.environmentalFeatures,l.push(`Environmental features: ${c.join(", ")}`)),a.npcs&&(d=a.npcs,l.push(`NPCs present: ${d.map(S=>S.name).join(", ")}`)),a.circumstances&&l.push(`Circumstances: ${a.circumstances.join(", ")}`));const h=i.map((S,E)=>{const _=Math.max(0,E*2),x=Array.isArray(S.circumstances)?[...S.circumstances]:[];_>0&&x.push(`while fatigued (action ${E+1} of ${i.length})`),c.forEach(k=>{x.includes(k)||x.push(k)}),a&&a.circumstances&&a.circumstances.forEach(k=>{x.includes(k)||x.push(k)});const C=this.performSkillCheck(t,S.type,x);return{action:S.type,description:S.description,check:C,difficulty:this.getDifficultyDescription(C.dc),position:S.position||E+1,totalInSequence:S.totalInSequence||i.length,quantity:S.quantity||1,keyword:S.keyword,isSequence:S.isSequence||!1,fatiguePenalty:_,contextModifiers:l.length>0?l:null}}),m=h.every(S=>S.check.isSuccess),p=h.filter(S=>S.check.degree==="critical failure"),y=h.filter(S=>!S.check.isSuccess);let v="";if(i.length===1)v=`Single action detected: ${h[0].description}`;else{const S=[...new Set(h.map(_=>_.action))];v=`Multiple actions detected: ${h.reduce((_,x)=>_+x.quantity,0)} total actions across ${S.length} different types`}return a&&(v+=` | Context: ${a.description.substring(0,50)}${a.description.length>50?"...":""}`),{possible:!0,actions:h,overallSuccess:m,hasCriticalFailures:p.length>0,criticalFailures:p,failures:y,totalActions:i.length,summary:v,contextInfo:a?{description:a.description,environmentalFeatures:c,npcs:d,circumstances:a.circumstances||[]}:null,suggestion:this.generateActionSuggestion(h,t)}}extractActionsFromDescription(e){var c,d;const t=[],r=e.toLowerCase(),s=[/\b(\d+)\s+(backflips?|somersaults?|cartwheels?|jumps?|leaps?|hops?)\b/gi,/\b(\d+)\s+(punches?|kicks?|strikes?|attacks?|swings?|slashes?)\b/gi,/\b(\d+)\s+(spells?|casts?|magic\s+spells?)\b/gi,/\b(\d+)\s+(dodges?|evades?|parries?|blocks?)\b/gi,/\b(\d+)\s+(climbs?|scales?|swims?)\b/gi,/\b(\d+)\s+(searches?|looks?|examines?)\b/gi,/\b(\d+)\s+(persuades?|intimidates?|deceives?)\b/gi];s.forEach(h=>{var p;let m;for(;(m=h.exec(r))!==null;){const y=parseInt(m[1]),v=m[2],S=this.mapKeywordToActionType(v);if(S)for(let E=0;E<y;E++){const _=this.extractCircumstances(e);t.push({type:S,description:((p=this.actionTypes[S])==null?void 0:p.description)||`${S} action`,circumstances:_,keyword:v,quantity:y,position:E+1,totalInSequence:y})}}}),Object.entries(this.actionTypes).forEach(([h,m])=>{this.getActionKeywords(h).forEach(y=>{if(!t.some(S=>S.type===h)&&r.includes(y)&&!s.some(E=>new RegExp(E.source.replace(/\\d\+/,"\\d+"),"gi").test(r))){const E=this.extractCircumstances(e);t.push({type:h,description:m.description,circumstances:E,keyword:y,quantity:1,position:1,totalInSequence:1})}})}),[/\b(backflip|somersault|cartwheel|jump|leap|hop)\s+(?:and\s+then\s+)?(punch|kick|strike|attack|swing|slash)\b/gi,/\b(punch|kick|strike|attack|swing|slash)\s+(?:and\s+then\s+)?(backflip|somersault|cartwheel|jump|leap|hop)\b/gi,/\b(dodge|evade|parry|block)\s+(?:and\s+then\s+)?(attack|strike|punch|kick)\b/gi,/\b(attack|strike|punch|kick)\s+(?:and\s+then\s+)?(dodge|evade|parry|block)\b/gi].forEach(h=>{var p,y;let m;for(;(m=h.exec(r))!==null;){const v=this.mapKeywordToActionType(m[1]),S=this.mapKeywordToActionType(m[2]);if(v&&S){const E=this.extractCircumstances(e);t.some(_=>_.type===v&&_.keyword===m[1])||t.push({type:v,description:((p=this.actionTypes[v])==null?void 0:p.description)||`${v} action`,circumstances:E,keyword:m[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),t.some(_=>_.type===S&&_.keyword===m[2])||t.push({type:S,description:((y=this.actionTypes[S])==null?void 0:y.description)||`${S} action`,circumstances:E,keyword:m[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}});const a=/\b(\w+)\s+and\s+(\w+)\b/gi;let l;for(;(l=a.exec(r))!==null;){const h=this.mapKeywordToActionType(l[1]),m=this.mapKeywordToActionType(l[2]);if(h&&m){const p=this.extractCircumstances(e);t.some(y=>y.type===h&&y.keyword===l[1])||t.push({type:h,description:((c=this.actionTypes[h])==null?void 0:c.description)||`${h} action`,circumstances:p,keyword:l[1],quantity:1,position:1,totalInSequence:2,isSequence:!0}),t.some(y=>y.type===m&&y.keyword===l[2])||t.push({type:m,description:((d=this.actionTypes[m])==null?void 0:d.description)||`${m} action`,circumstances:p,keyword:l[2],quantity:1,position:2,totalInSequence:2,isSequence:!0})}}return t}mapKeywordToActionType(e){return{punch:"attack",punches:"attack",kick:"attack",kicks:"attack",strike:"attack",strikes:"attack",attack:"attack",attacks:"attack",swing:"attack",swings:"attack",slash:"attack",slashes:"attack",thrust:"attack",thrusts:"attack",backflip:"backflip",backflips:"backflip",somersault:"somersault",somersaults:"somersault",cartwheel:"cartwheel",cartwheels:"cartwheel",jump:"jump",jumps:"jump",leap:"jump",leaps:"jump",hop:"jump",hops:"jump",climb:"climb",climbs:"climb",scale:"climb",scales:"climb",swim:"swim",swims:"swim",dodge:"dodge",dodges:"dodge",evade:"dodge",evades:"dodge",parry:"parry",parries:"parry",block:"parry",blocks:"parry",spell:"spell",spells:"spell",cast:"spell",casts:"spell","magic spell":"spell","magic spells":"spell",persuade:"persuade",persuades:"persuade",intimidate:"intimidate",intimidates:"intimidate",deceive:"deceive",deceives:"deceive",search:"search",searches:"search",look:"search",looks:"search",examine:"search",examines:"search"}[e.toLowerCase()]}getActionKeywords(e){return{attack:["attack","strike","hit","swing","slash","thrust","punch","kick"],spell:["cast","spell","magic","enchant","charm"],dodge:["dodge","evade","avoid","sidestep"],parry:["parry","block","deflect"],backflip:["backflip","back flip"],somersault:["somersault","forward roll"],cartwheel:["cartwheel"],wallRun:["wall run","run up wall"],jump:["jump","leap","hop"],climb:["climb","scale"],swim:["swim"],fly:["fly","levitate","float"],persuade:["persuade","convince","talk into"],intimidate:["intimidate","threaten","scare"],deceive:["deceive","lie","trick"],spot:["spot","see","notice","observe"],listen:["listen","hear"],search:["search","look for","find"],pickLock:["pick lock","lockpick"],disarmTrap:["disarm","trap"],heal:["heal","cure","treat"],craft:["craft","make","create","build"]}[e]||[]}extractCircumstances(e){const t=[];return Object.keys(this.circumstanceModifiers).forEach(r=>{e.includes(r)&&t.push(r)}),t}getDifficultyDescription(e){return e<=5?"Very Easy":e<=10?"Easy":e<=15?"Medium":e<=20?"Hard":e<=25?"Very Hard":"Nearly Impossible"}generateActionSuggestion(e,t){const r=e.filter(i=>!i.check.isSuccess);return r.length===0?"All actions are within your capabilities. Proceed with confidence!":r.map(i=>{const a=i.action;return i.check.degree==="critical failure"?`The ${a} is extremely difficult for you. Consider an alternative approach or ask for help.`:`The ${a} is challenging. You might want to take your time or use better equipment.`}).join(" ")}performActionSequence(e,t,r={}){const s=[];let i=0;for(let c=0;c<t.length;c++){const d=t[c],h=Array.isArray(d.circumstances)?[...d.circumstances]:[];i>0?h.push("with momentum"):i<0&&h.push("while fatigued");const m=this.performSkillCheck(e,d.type,h);s.push({action:d.type,check:m,sequencePosition:c+1}),m.isSuccess?i+=1:i-=2}const a=s.every(c=>c.check.isSuccess),l=s.filter(c=>c.check.degree==="critical failure");return{actions:s,overallSuccess:a,hasCriticalFailures:l.length>0,criticalFailures:l,sequenceLength:t.length,finalModifier:i}}generateActionNarrative(e,t){const{actionType:r,check:s,degree:i}=e;this.actionTypes[r];const a={attack:{"critical success":`${t.name} executes a perfect ${r}, striking with incredible precision!`,"great success":`${t.name} performs an excellent ${r}, hitting the target solidly.`,success:`${t.name} successfully ${r}s the target.`,failure:`${t.name} attempts to ${r} but misses the mark.`,"great failure":`${t.name} completely fails to ${r}, leaving themselves open.`,"critical failure":`${t.name} botches the ${r} spectacularly, potentially harming themselves!`},backflip:{"critical success":`${t.name} performs a flawless backflip, landing gracefully with perfect form!`,"great success":`${t.name} executes a smooth backflip, impressing onlookers.`,success:`${t.name} manages to complete the backflip successfully.`,failure:`${t.name} attempts a backflip but loses balance and stumbles.`,"great failure":`${t.name} fails the backflip badly, landing awkwardly.`,"critical failure":`${t.name} completely fails the backflip, potentially injuring themselves!`},fly:{"critical success":`${t.name} somehow defies gravity and soars through the air with supernatural grace!`,"great success":`${t.name} manages to achieve brief flight through incredible effort!`,success:`${t.name} makes a valiant attempt at flight, achieving a brief hover.`,failure:`${t.name} tries to fly but only manages an awkward hop.`,"great failure":`${t.name} attempts flight but falls flat on their face.`,"critical failure":`${t.name} tries to fly and crashes spectacularly, looking quite foolish!`}},l=a[r]||a.attack;return l[i]||l.failure}performMultipleSkillChecks(e,t,r,s=[],i=null){var y,v,S,E;const a=[];let l=0;const c=1;for(let _=1;_<=r;_++){const x=l*c,C=[...s];l>0&&C.push(`while fatigued (attempt ${_})`);const k=this.performSkillCheck(e,t,C,i),M={...k,attemptNumber:_,fatigueLevel:l,fatiguePenalty:x,adjustedTotalRoll:k.totalRoll-x,adjustedMargin:k.totalRoll-x-k.dc,adjustedSuccess:k.totalRoll-x>=k.dc};a.push(M),l++}const d=a.filter(_=>_.adjustedSuccess).length,h=a.filter(_=>_.adjustedSuccess&&_.adjustedMargin>=10).length,m=a.filter(_=>!_.adjustedSuccess&&_.adjustedMargin<=-10).length,p=d/r*100;return{actionType:t,numberOfAttempts:r,results:a,statistics:{successfulAttempts:d,criticalSuccesses:h,criticalFailures:m,successRate:p,averageRoll:a.reduce((_,x)=>_+x.roll,0)/r,averageTotalRoll:a.reduce((_,x)=>_+x.adjustedTotalRoll,0)/r,bestRoll:Math.max(...a.map(_=>_.adjustedTotalRoll)),worstRoll:Math.min(...a.map(_=>_.adjustedTotalRoll))},character:{name:e.name,level:e.level,[(y=this.actionTypes[t])==null?void 0:y.primaryAbility]:e[(v=this.actionTypes[t])==null?void 0:v.primaryAbility],[(S=this.actionTypes[t])==null?void 0:S.secondaryAbility]:e[(E=this.actionTypes[t])==null?void 0:E.secondaryAbility]}}}performMultipleDiceRolls(e,t,r="standard"){const s=[];for(let d=1;d<=e;d++){let h;switch(r){case"advantage":h=this.rollWithAdvantage();break;case"disadvantage":h=this.rollWithDisadvantage();break;default:h={result:this.rollDie(t),rolls:[this.rollDie(t)],advantage:!1,disadvantage:!1}}s.push({...h,rollNumber:d,sides:t})}const i=s.map(d=>d.result),a=i.reduce((d,h)=>d+h,0)/e,l=Math.max(...i),c=Math.min(...i);return{numberOfRolls:e,sides:t,rollType:r,results:s,statistics:{average:a,max:l,min:c,total:i.reduce((d,h)=>d+h,0),natural20s:i.filter(d=>d===20).length,natural1s:i.filter(d=>d===1).length}}}generateMultipleAttemptsNarrative(e,t){const{actionType:r,numberOfAttempts:s,statistics:i}=e,a=this.actionTypes[r];if(!a)return`${t.name} attempts ${r} ${s} times.`;const l=i.successRate,c=i.criticalSuccesses,d=i.criticalFailures;let h=`${t.name} attempts to ${a.description} ${s} times. `;return l>=80?h+=`They perform exceptionally well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:l>=60?h+=`They perform well, succeeding ${i.successfulAttempts} out of ${s} attempts.`:l>=40?h+=`They have mixed results, succeeding ${i.successfulAttempts} out of ${s} attempts.`:l>=20?h+=`They struggle, only succeeding ${i.successfulAttempts} out of ${s} attempts.`:h+=`They perform poorly, only succeeding ${i.successfulAttempts} out of ${s} attempts.`,c>0&&(h+=` They achieve ${c} spectacular successes!`),d>0&&(h+=` They suffer ${d} embarrassing failures.`),s>10&&(h+=" The repeated attempts take their toll, and fatigue begins to set in."),h}}class EI{constructor(){this.diceService=new _I,this.storyRules={redirectPatterns:[{pattern:/\b(?:i\s+)?(?:do|perform|execute)\s+\d+\s+(?:backflips?|somersaults?|cartwheels?)\b/gi,response:"While impressive acrobatics are possible, let's focus on actions that advance the story. What's your main goal here?",suggestion:"Try describing a more focused action that helps with the current situation."},{pattern:/\b(?:i\s+)?(?:fly|levitate|float)\s+(?:to|up|over|across)\b/gi,response:"Flight isn't currently possible in this situation. What are you trying to achieve?",suggestion:"Consider climbing, jumping, or finding another way to reach your destination."},{pattern:/\b(?:i\s+)?(?:grab|take|steal)\s+(?:the\s+)?(?:quest\s+item|treasure|artifact)\s+(?:from\s+)?(?:nowhere|thin\s+air)\b/gi,response:"The quest item isn't just lying around. You'll need to find it through exploration and investigation.",suggestion:"Try searching the area, asking NPCs, or following clues to locate the item."},{pattern:/\b(?:i\s+)?(?:attack|kill|destroy)\s+(?:everyone|all|each)\s+(?:enemy|person|creature)\b/gi,response:"While combat is possible, attacking everyone at once isn't practical. Let's focus on the immediate threat.",suggestion:"Choose a specific target or describe a more strategic approach."}],expandPatterns:[{pattern:/\b(?:i\s+)?(?:search|look|examine)\b/gi,response:"What specifically are you searching for or looking at?",suggestion:"Be more specific about what you're searching for or examining."},{pattern:/\b(?:i\s+)?(?:talk|speak|ask)\b/gi,response:"Who would you like to talk to, and what would you like to discuss?",suggestion:"Specify the person and topic of conversation."},{pattern:/\b(?:i\s+)?(?:go|move|walk)\b/gi,response:"Where would you like to go?",suggestion:"Specify your destination or direction."}],encouragePatterns:[{pattern:/\b(?:i\s+)?(?:investigate|explore|examine)\b/gi,response:"Great! Investigation and exploration are key to advancing the story.",suggestion:"What specific aspect would you like to investigate?"},{pattern:/\b(?:i\s+)?(?:help|assist|aid)\b/gi,response:"Helping others is always a noble choice. Who would you like to help?",suggestion:"Specify who needs help and how you can assist them."},{pattern:/\b(?:i\s+)?(?:negotiate|diplomacy|peace)\b/gi,response:"Diplomacy can often achieve more than violence. Good thinking!",suggestion:"How would you like to approach the negotiation?"}]},this.contextResponses={combat:{impossible:"That action isn't possible in combat. Focus on your available combat options.",difficult:"That's a challenging action in combat. Are you sure you want to attempt it?",strategic:"That's a good strategic choice. How do you want to execute it?"},exploration:{impossible:"That action doesn't make sense in this environment. What are you trying to achieve?",difficult:"That will be challenging given the current circumstances.",strategic:"That's a good approach to exploration. Let's see how it goes."},social:{impossible:"That action isn't appropriate in this social situation.",difficult:"That's a bold social move. Are you prepared for the consequences?",strategic:"That's a good approach to the situation. How do you want to proceed?"}}}validatePlayerAction(e,t,r={}){const s=e.toLowerCase(),i=this.checkImpossibleActions(s);if(!i.possible)return{valid:!1,type:"impossible",response:i.response,suggestion:i.suggestion,diceResult:null};const a=this.checkRedirectPatterns(s);if(a.needsRedirect)return{valid:!1,type:"redirect",response:a.response,suggestion:a.suggestion,diceResult:null};const l=this.checkExpandPatterns(s);if(l.needsExpansion)return{valid:!1,type:"expand",response:l.response,suggestion:l.suggestion,diceResult:null};const c=this.diceService.validateAction(e,t,r);return{valid:!0,type:"valid",response:this.generateValidationResponse(c,t,r),suggestion:c.suggestion,diceResult:c}}checkImpossibleActions(e){for(const t of this.diceService.impossibleActionPatterns)if(t.test(e))return{possible:!1,response:"That action is beyond the realm of possibility in this world.",suggestion:"Try a more realistic approach that fits within the story and your character's abilities."};return{possible:!0}}checkRedirectPatterns(e){for(const t of this.storyRules.redirectPatterns)if(t.pattern.test(e))return{needsRedirect:!0,response:t.response,suggestion:t.suggestion};return{needsRedirect:!1}}checkExpandPatterns(e){for(const t of this.storyRules.expandPatterns)if(t.pattern.test(e))return{needsExpansion:!0,response:t.response,suggestion:t.suggestion};return{needsExpansion:!1}}generateValidationResponse(e,t,r){if(!e.overallSuccess)return e.actions.filter(c=>!c.check.isSuccess).filter(c=>c.check.degree==="critical failure").length>0?`The actions you described are beyond your current capabilities. ${e.suggestion}`:`The actions you described are challenging but possible. ${e.suggestion}`;const s=this.generateAtmosphericResponse(e,t,r),i=this.extractEntities(s,r);return{story:s,entities:i}}generateAtmosphericResponse(e,t,r){const{actions:s,overallSuccess:i,hasCriticalFailures:a}=e,l=r==null?void 0:r.customContext;let c=this.getAtmosphericElements(l),d=this.calculateTensionLevel(s,a),h="";return s.length===1?h=this.generateSingleActionResponse(s[0],t,c,d):h=this.generateMultiActionResponse(s,t,c,d),l&&l.environmentalFeatures&&(h+=this.addEnvironmentalDetails(l.environmentalFeatures,d)),l&&l.npcs&&(h+=this.addNPCReactions(l.npcs,s,i)),h+=this.addStoryProgressionHook(s,d,l),h}getAtmosphericElements(e){const t={lighting:"dim",weather:"calm",mood:"neutral",tension:"low"};if(!e)return t;const r=e.description.toLowerCase();return(r.includes("dark")||r.includes("shadow"))&&(t.lighting="dark"),(r.includes("bright")||r.includes("sunlight"))&&(t.lighting="bright"),(r.includes("dim")||r.includes("flickering"))&&(t.lighting="dim"),(r.includes("storm")||r.includes("rain"))&&(t.weather="stormy"),(r.includes("fog")||r.includes("mist"))&&(t.weather="foggy"),r.includes("wind")&&(t.weather="windy"),(r.includes("tension")||r.includes("danger"))&&(t.mood="tense"),(r.includes("peaceful")||r.includes("calm"))&&(t.mood="peaceful"),(r.includes("eerie")||r.includes("creepy"))&&(t.mood="eerie"),t}calculateTensionLevel(e,t){let r="low";const s=e.filter(i=>["attack","spell","dodge","parry"].includes(i.action));return s.length>0&&(r="medium"),s.length>2&&(r="high"),t&&(r="critical"),r}generateSingleActionResponse(e,t,r,s){const{action:i,check:a,keyword:l}=e,c=a.isSuccess;a.degree;const d={attack:{success:{low:`${t.name} strikes true, the blow landing with satisfying impact.`,medium:`${t.name}'s weapon finds its mark, the strike ringing out in the ${r.lighting} light.`,high:`${t.name} delivers a devastating blow, the force of the attack echoing through the ${r.weather} air.`,critical:`${t.name} executes a perfect strike, the precision of the attack leaving no room for error.`},failure:{low:`${t.name} swings wide, the attack missing its intended target.`,medium:`${t.name}'s strike goes awry, the weapon clattering against stone or wood.`,high:`${t.name} completely misses, the failed attack leaving them momentarily vulnerable.`,critical:`${t.name} stumbles in their attack, the botched strike nearly causing them to fall.`}},backflip:{success:{low:`${t.name} executes a graceful backflip, landing softly on their feet.`,medium:`${t.name} performs an impressive backflip, the acrobatic feat drawing attention.`,high:`${t.name} completes a spectacular backflip, the display of agility leaving onlookers amazed.`,critical:`${t.name} achieves a flawless backflip, the perfect form and landing drawing gasps of admiration.`},failure:{low:`${t.name} attempts a backflip but loses balance, stumbling slightly.`,medium:`${t.name} fails the backflip, landing awkwardly and looking embarrassed.`,high:`${t.name} completely botches the backflip, falling hard to the ground.`,critical:`${t.name} crashes spectacularly during the backflip, potentially injuring themselves.`}},search:{success:{low:`${t.name} searches carefully, their trained eyes picking up subtle details.`,medium:`${t.name} conducts a thorough search, methodically examining every corner.`,high:`${t.name} performs an exhaustive search, their attention to detail revealing hidden secrets.`,critical:`${t.name} discovers something extraordinary, their keen observation uncovering a crucial clue.`},failure:{low:`${t.name} looks around but finds nothing of interest.`,medium:`${t.name} searches but misses several obvious details.`,high:`${t.name} fails to notice important clues, their search proving fruitless.`,critical:`${t.name} overlooks critical information, their poor search skills costing them dearly.`}},persuade:{success:{low:`${t.name} makes a reasonable argument, their words carrying some weight.`,medium:`${t.name} presents a compelling case, their charisma swaying the listener.`,high:`${t.name} delivers a masterful persuasion, their words impossible to ignore.`,critical:`${t.name} achieves the impossible, their silver tongue turning enemies into allies.`},failure:{low:`${t.name} tries to persuade but fails to make a convincing argument.`,medium:`${t.name}'s attempt at persuasion falls flat, their words lacking impact.`,high:`${t.name} completely fails to persuade, their poor communication skills evident.`,critical:`${t.name} not only fails to persuade but manages to offend the listener.`}}},h=d[i]||d.attack,m=c?"success":"failure",p=s==="critical"?"high":s;return h[m][p]}generateMultiActionResponse(e,t,r,s){const i=e.length,a=e.filter(c=>c.check.isSuccess).length,l=i-a;return a===i?`${t.name} executes a flawless sequence of actions, each movement flowing seamlessly into the next. The display of skill and coordination is impressive to behold.`:a>l?`${t.name} performs admirably, with most actions succeeding despite the challenging circumstances. A few missteps don't diminish the overall effectiveness.`:l>a?`${t.name} struggles with the complex sequence, many actions failing to achieve their intended results. The difficulty of the task proves overwhelming.`:`${t.name} has mixed results, with some actions succeeding while others fail. The outcome remains uncertain.`}addEnvironmentalDetails(e,t){if(e.length===0)return"";const r={dark:{low:" The darkness seems to swallow sound, making every movement feel more significant.",medium:" Shadows dance in the darkness, creating an atmosphere of uncertainty.",high:" The oppressive darkness makes every action feel more dangerous and urgent.",critical:" The pitch-black environment amplifies every sound, every movement potentially deadly."},stormy:{low:" Rain patters against surfaces, adding a rhythmic backdrop to the scene.",medium:" The storm intensifies, wind and rain making movement more challenging.",high:" The raging storm creates a chaotic environment where every action is a gamble.",critical:" The violent storm threatens to overwhelm all but the most determined efforts."},foggy:{low:" Mist swirls gently, obscuring distant details.",medium:" The fog thickens, reducing visibility and creating an eerie atmosphere.",high:" Dense fog makes navigation difficult and every shadow a potential threat.",critical:" The impenetrable fog isolates you completely, each step into the unknown."}};let s="";return e.forEach(i=>{r[i]&&(s+=r[i][t]||"")}),s}addNPCReactions(e,t,r){if(e.length===0)return"";const s=e.map(i=>i.name).join(" and ");return r?` ${s} watch with growing interest, clearly impressed by your actions.`:` ${s} exchange concerned glances, their confidence in your abilities wavering.`}addStoryProgressionHook(e,t,r){const s=e.some(l=>["attack","spell","dodge","parry"].includes(l.action)),i=e.some(l=>["search","climb","jump"].includes(l.action)),a=e.some(l=>["persuade","intimidate","deceive"].includes(l.action));return s&&t==="high"?" The tension in the air is palpable. Something is about to happen...":i?" Your investigation reveals new possibilities. What will you discover next?":a?" The social dynamics shift with your words. How will others respond?":" The situation continues to unfold. What will you do next?"}generateStoryResponse(e,t,r={}){const s=this.validatePlayerAction(e,t,r);if(!s.valid)return{response:s.response,suggestion:s.suggestion,shouldProceed:!1,diceResult:null};const i=[];return s.diceResult.actions&&s.diceResult.actions.forEach(a=>{const l=this.diceService.generateActionNarrative(a.check,t);i.push(l)}),{response:i.join(" "),suggestion:s.suggestion,shouldProceed:!0,diceResult:s.diceResult}}handleComplexAction(e,t,r={}){const s=this.diceService.extractActionsFromDescription(e.toLowerCase());if(s.length===0)return{response:"I understand your intent. Let's see how this plays out in the story.",shouldProceed:!0,type:"narrative"};if(s.length===1)return this.generateStoryResponse(e,t,r);const i=this.diceService.performActionSequence(t,s,r);return i.overallSuccess?{response:i.actions.map(l=>this.diceService.generateActionNarrative(l.check,t)).join(" "),shouldProceed:!0,type:"sequence",diceResult:i}:i.actions.filter(c=>!c.check.isSuccess).filter(c=>c.check.degree==="critical failure").length>0?{response:"The sequence of actions you described is too complex for your current abilities. Try breaking it down into simpler steps.",shouldProceed:!1,type:"sequence_failure",diceResult:i}:{response:"Some parts of your action sequence are challenging. You might want to simplify your approach.",shouldProceed:!1,type:"sequence_partial",diceResult:i}}provideAlternatives(e,t,r={}){const s=e.toLowerCase(),i=[];return(s.includes("backflip")||s.includes("somersault"))&&i.push({action:"dodge",description:"Try dodging or evading instead of acrobatics",difficulty:"easier"}),(s.includes("fly")||s.includes("levitate"))&&i.push({action:"climb",description:"Try climbing or finding another way up",difficulty:"realistic"}),s.includes("attack everyone")&&i.push({action:"focus",description:"Focus on one target at a time for better effectiveness",difficulty:"strategic"}),s.includes("grab quest item")&&i.push({action:"search",description:"Search the area thoroughly to find the item",difficulty:"appropriate"}),i}maintainStoryCoherence(e,t,r){const s={storyPhase:this.checkStoryPhase(e,t),establishedFacts:this.checkEstablishedFacts(e,t),plotAdvancement:this.checkPlotAdvancement(e,t),characterDevelopment:this.checkCharacterDevelopment(e,r)},i=Object.entries(s).filter(([a,l])=>!l.valid).map(([a,l])=>l.issue);return{coherent:i.length===0,issues:i,suggestions:this.generateCoherenceSuggestions(i,t)}}checkStoryPhase(e,t){const r=t.phase||"exploration",s=e.toLowerCase(),l=({introduction:["attack","kill","destroy"],exploration:["end quest","skip to boss"],combat:["negotiate peace","run away"],resolution:["start new quest","begin adventure"]}[r]||[]).some(c=>s.includes(c));return{valid:!l,issue:l?`This action doesn't fit the current story phase (${r})`:null}}checkEstablishedFacts(e,t){const r=t.establishedFacts||[],s=e.toLowerCase();for(const i of r)if(i.contradicts&&i.contradicts.some(a=>s.includes(a.toLowerCase())))return{valid:!1,issue:`This action contradicts established story facts: ${i.description}`};return{valid:!0}}checkPlotAdvancement(e,t){const r=t.plotPoints||[],s=e.toLowerCase(),i=r.find(a=>a.active);return i&&i.keywords&&!i.keywords.some(l=>s.includes(l.toLowerCase()))?{valid:!1,issue:"This action doesn't address the current plot point"}:{valid:!0}}checkCharacterDevelopment(e,t){const r=t.alignment||"Neutral",s=e.toLowerCase(),l=({"Lawful Good":["steal","deceive","harm innocent"],"Chaotic Evil":["help others","follow rules","show mercy"],"Neutral Good":["harm innocent","betray allies"],"Lawful Evil":["break laws","show mercy","help weak"],"Chaotic Good":["follow strict rules","harm innocent"],"True Neutral":["take extreme actions","show strong emotions"],"Lawful Neutral":["break laws","show mercy","act chaotically"],"Neutral Evil":["help others","follow laws","show mercy"],"Chaotic Neutral":["follow strict rules","show strong loyalty"]}[r]||[]).some(c=>s.includes(c));return{valid:!l,issue:l?`This action doesn't align with your character's alignment (${r})`:null}}generateCoherenceSuggestions(e,t){const r=[];return e.forEach(s=>{s.includes("story phase")?r.push("Consider actions that fit the current phase of the story."):s.includes("established facts")?r.push("Remember what has already been established in the story."):s.includes("plot point")?r.push("Focus on actions that advance the current plot."):s.includes("alignment")&&r.push("Consider actions that align with your character's moral compass.")}),r}extractEntities(e,t={}){const r={enemies:[],items:[],locations:[],statusEffects:[],questHooks:[],npcs:[]};return e.toLowerCase(),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:the\s+)?(?:priest|wizard|mage|sorcerer|warlock|necromancer|lich|vampire|werewolf|ghost|spirit|demon|devil|fiend|beast|creature|monster|boss|mini-boss)/gi,/\b(goblin|orc|troll|dragon|bandit|skeleton|zombie|ghost|spirit|demon|devil|fiend|beast|creature|monster)\b/gi,/(?:mini-boss|boss)\s*[-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/\[Combat\s+Trigger[^]]*[-]\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\]/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.enemies.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.enemies.push({name:p,type:"enemy",subtype:this.determineEnemySubtype(p,e),status:this.determineEnemyStatus(p,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:of\s+[A-Z][a-z]+)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:sword|dagger|staff|wand|scroll|potion|ring|amulet|crown|robe|armor|shield)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cursed|forbidden|ancient|legendary)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.items.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.items.push({name:p,type:"item",subtype:this.determineItemSubtype(p,e),status:this.determineItemStatus(p,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:shrine|temple|castle|tower|dungeon|cave|tunnel|chamber|room|hall|garden|forest|mountain|river|lake|ocean|tavern|inn)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:cliffs|beach|island|valley|peak|summit|depths|heights)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.locations.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.locations.push({name:p,type:"location",subtype:this.determineLocationSubtype(p,e),tags:this.determineLocationTags(p,e)})}}),[/(?:cursed|blessed|enchanted|poisoned|paralyzed|charmed|frightened|invisible|ethereal|ethereal|flying|levitating)/gi,/(?:in\s+darkness|in\s+bright\s+light|under\s+pressure|in\s+a\s+hurry|carefully|stealthily|aggressively|defensively)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[0];p&&!r.statusEffects.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.statusEffects.push({name:p,type:"status_effect",effect:this.determineStatusEffect(p,e)})}}),[/(?:break|destroy|find|retrieve|defeat|save|protect|escort|investigate|explore)\s+(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,/(?:quest|mission|objective|goal|task|duty|responsibility)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.questHooks.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.questHooks.push({name:p,type:"quest_hook",objective:this.determineQuestObjective(p,e)})}}),[/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:merchant|trader|noble|lord|lady|king|queen|prince|princess|mayor|priest|shaman|hunter|fisherman|farmer)/gi,/(?:the\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(?:quest\s+giver|guide|mentor|teacher|master)/gi].forEach(h=>{let m;for(;(m=h.exec(e))!==null;){const p=m[1]||m[0];p&&!r.npcs.some(y=>y.name.toLowerCase()===p.toLowerCase())&&r.npcs.push({name:p,type:"npc",role:this.determineNPCRole(p,e),disposition:"friendly"})}}),r}determineEnemySubtype(e,t){t.toLowerCase();const r=e.toLowerCase();return r.includes("boss")||r.includes("mini-boss")?"boss":r.includes("priest")||r.includes("cleric")?"priest":r.includes("wizard")||r.includes("mage")?"wizard":r.includes("dragon")?"dragon":r.includes("undead")||r.includes("skeleton")||r.includes("zombie")?"undead":r.includes("goblin")||r.includes("orc")||r.includes("troll")?"monster":"enemy"}determineEnemyStatus(e,t){const r=t.toLowerCase();return r.includes("snarls")||r.includes("aggressive")?"hostile":r.includes("defensive")||r.includes("cautious")?"defensive":r.includes("chanting")||r.includes("casting")?"casting":"active"}determineItemSubtype(e,t){const r=e.toLowerCase();return r.includes("sword")||r.includes("dagger")||r.includes("staff")?"weapon":r.includes("potion")||r.includes("scroll")?"consumable":r.includes("ring")||r.includes("amulet")||r.includes("crown")?"accessory":r.includes("armor")||r.includes("robe")||r.includes("shield")?"armor":"item"}determineItemStatus(e,t){const r=t.toLowerCase(),s=e.toLowerCase();return s.includes("cursed")||r.includes("cursed")?"cursed":s.includes("forbidden")||r.includes("forbidden")?"forbidden":s.includes("ancient")||r.includes("ancient")?"ancient":s.includes("legendary")||r.includes("legendary")?"legendary":r.includes("magical")||r.includes("enchanted")?"magical":"normal"}determineLocationSubtype(e,t){const r=e.toLowerCase();return r.includes("shrine")||r.includes("temple")?"religious":r.includes("castle")||r.includes("tower")?"fortification":r.includes("cave")||r.includes("tunnel")?"underground":r.includes("forest")||r.includes("garden")?"natural":r.includes("tavern")||r.includes("inn")?"settlement":"location"}determineLocationTags(e,t){const r=[],s=t.toLowerCase();return(s.includes("ancient")||s.includes("old"))&&r.push("ancient"),(s.includes("dangerous")||s.includes("hostile"))&&r.push("dangerous"),(s.includes("sacred")||s.includes("holy"))&&r.push("sacred"),(s.includes("cursed")||s.includes("evil"))&&r.push("cursed"),(s.includes("coastal")||s.includes("ocean"))&&r.push("coastal"),(s.includes("mountain")||s.includes("high"))&&r.push("mountainous"),r}determineStatusEffect(e,t){const r=e.toLowerCase();return r.includes("cursed")?"disables healing":r.includes("poisoned")?"damage over time":r.includes("paralyzed")?"prevents movement":r.includes("charmed")?"mind control":r.includes("invisible")?"stealth bonus":r.includes("flying")?"flight ability":"unknown effect"}determineQuestObjective(e,t){const r=e.toLowerCase();return r.includes("break")||r.includes("destroy")?"destruction":r.includes("find")||r.includes("retrieve")?"retrieval":r.includes("defeat")||r.includes("kill")?"combat":r.includes("save")||r.includes("protect")?"protection":r.includes("escort")?"escort":r.includes("investigate")||r.includes("explore")?"exploration":"objective"}determineNPCRole(e,t){const r=e.toLowerCase();return r.includes("merchant")||r.includes("trader")?"merchant":r.includes("noble")||r.includes("lord")||r.includes("lady")?"noble":r.includes("king")||r.includes("queen")?"royalty":r.includes("priest")||r.includes("shaman")?"religious":r.includes("quest giver")||r.includes("guide")?"quest_giver":"npc"}}const L4=new EI,O4="https://dnd-v1-backend.onrender.com",Bn=async(n,e="gpt-4",t=1e3,r=.8)=>{try{const s=n.filter(l=>!l||typeof l!="object"?(console.warn("Invalid message object:",l),!1):!l.role||!l.content?(console.warn("Message missing role or content:",l),!1):!0);if(s.length===0)throw new Error("No valid messages to send to API");const i=await fetch(`${O4}/api/openai`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:s,model:e,max_tokens:t,temperature:r})});if(!i.ok){let l="Backend API request failed";try{l=(await i.json()).error||l}catch{l=`${i.status}: ${i.statusText}`}throw i.status===500?l=`AI service error: ${l}. This might be due to missing API key, rate limiting, or network issues.`:i.status===404?l="AI service endpoint not found. Please check the backend configuration.":i.status===503&&(l="AI service temporarily unavailable. Please try again later."),new Error(l)}return await i.json()}catch(s){throw console.error("Backend API Error:",s),new Error(`Failed to communicate with backend: ${s.message}`)}};class F4{constructor(){this.systemPrompt=`You are an experienced Dungeon Master for Dungeons & Dragons 5th Edition. You excel at:
- Creating engaging storylines and plot hooks
- Developing detailed character descriptions and backstories
- Generating multiple story options when specifically requested
- Providing atmospheric descriptions and immersive storytelling
- Balancing combat encounters and managing game mechanics
- Creating memorable NPCs and villains
- Adapting to player choices and creating dynamic narratives
- Maintaining story consistency and character development
- Building upon established relationships and plot threads

IMPORTANT: Only generate multiple options when explicitly requested. When asked to generate a single story introduction, campaign goal, or other content, provide ONLY ONE response.

Always respond in character as a Dungeon Master, providing rich, descriptive content that enhances the gaming experience. Maintain consistency with previous story elements, character relationships, and established plot threads.`,this.diceService=new _I,this.actionValidationService=new EI,this.combatService=new wI}async generateStoryPlots(e,t="",r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class} (${c.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 3 different story plot options for a D&D campaign.

Party Composition: ${s}${i}
Campaign Setting: ${t||"Generic fantasy world"}

IMPORTANT: You MUST format your response EXACTLY as follows for each plot option:

**Plot Option 1:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

**Plot Option 2:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

**Plot Option 3:**
1. Title: "[Plot Title Here]"
2. Summary: [2-3 sentence summary of the plot]
3. Main Conflict: [The main challenge or conflict the party will face]
4. Story Hooks: [How the party gets involved and what motivates them]
5. Estimated Campaign Length: [short/medium/long]

Guidelines for the plots:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

CRITICAL: Do not deviate from this exact format. Each plot must start with "**Plot Option X:**" and use the numbered format exactly as shown above.`;return(await Bn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1e3,.8)).choices[0].message.content}catch(s){throw new Error(`Failed to generate story plots: ${s.message}`)}}async generateCharacterDetails(e){try{const t=`As a Dungeon Master, I need you to expand on this character's details and create a rich, detailed description.

Character: ${e.name} - Level ${e.level} ${e.race} ${e.class}
Background: ${e.background}
Alignment: ${e.alignment}
Personality: ${e.personality||"Not specified"}
Ideals: ${e.ideals||"Not specified"}
Bonds: ${e.bonds||"Not specified"}
Flaws: ${e.flaws||"Not specified"}
Backstory: ${e.backstory||"Not specified"}

Please provide:
1. A detailed physical description (appearance, mannerisms, distinctive features)
2. An expanded personality profile with quirks and habits
3. A deeper backstory with key events and relationships
4. Character motivations and goals
5. Potential story hooks and plot threads related to this character
6. How this character might interact with the party and world

Make the character feel alive and three-dimensional, with details that could drive story development.`;return(await Bn([{role:"system",content:this.systemPrompt},{role:"user",content:t}],"gpt-4",800,.7)).choices[0].message.content}catch(t){throw console.error("Error generating character details:",t),new Error(`Failed to generate character details: ${t.message}`)}}async generateStorySummary(e,t){try{const r=t.map(a=>`${a.name} (${a.race} ${a.class})`).join(", "),s=`As a Dungeon Master, I need you to create a detailed story summary and outline for this campaign plot.

Plot: ${e}
Party: ${r}

Please provide:
1. A detailed campaign overview (3-4 paragraphs)
2. Key story beats and major events
3. Important NPCs and their roles
4. Potential challenges and obstacles
5. Story themes and motifs
6. How each party member might be personally invested
7. Potential branching paths and player choices
8. Climactic moments and resolution possibilities

Make this feel like a professional campaign module with rich storytelling potential.`;return(await Bn([{role:"system",content:this.systemPrompt},{role:"user",content:s}],"gpt-4",1200,.7)).choices[0].message.content}catch(r){throw console.error("Error generating story summary:",r),new Error(`Failed to generate story summary: ${r.message}`)}}async generateMultipleStoryPlots(e,t="",r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class} (${c.alignment})`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, I need you to generate 5 different story plot options for a D&D campaign, each with a detailed summary.

Party Composition: ${s}${i}
Campaign Setting: ${t||"Generic fantasy world"}

For each of the 5 plot options, provide:
1. A compelling title
2. A detailed summary (3-4 paragraphs)
3. The main conflict or challenge
4. Key story beats and major events
5. Important NPCs and their roles
6. Potential story hooks for the party
7. Estimated campaign length (short, medium, or long)
8. Themes and motifs
9. How each party member might be personally invested

Important Guidelines:
- Use the party theme to influence the plot lines and atmosphere
- Incorporate themes and elements from the party theme to create a cohesive narrative
- Consider how the party's background and composition might influence the plot
- Make each plot distinct and appealing to different play styles
- Focus on the characters and their individual stories

Make each plot distinct and appealing to different play styles. Consider the party composition when crafting these options. Number each plot clearly (Plot 1, Plot 2, etc.).`;return(await Bn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",1500,.8)).choices[0].message.content}catch(s){throw console.error("Error generating multiple story plots:",s),new Error(`Failed to generate multiple story plots: ${s.message}`)}}async generateNPC(e,t=""){try{const r=`As a Dungeon Master, I need you to create a detailed NPC for this role and context.

NPC Role: ${e}
Context: ${t||"General campaign context"}

Please provide:
1. A detailed physical description
2. Personality traits and mannerisms
3. Background and motivations
4. Current situation and goals
5. How they might interact with the party
6. Potential story hooks or plot threads they could introduce
7. Their relationship to the world and other NPCs
8. Any secrets or hidden aspects of their character

Make this NPC feel like a real person with depth and complexity.`;return(await Bn([{role:"system",content:this.systemPrompt},{role:"user",content:r}],"gpt-4",800,.7)).choices[0].message.content}catch(r){throw console.error("Error generating NPC:",r),new Error(`Failed to generate NPC: ${r.message}`)}}async generateCombatEncounter(e,t,r="medium",s=""){try{const i=`As a Dungeon Master, I need you to create a detailed combat encounter.

Party Level: ${e}
Party Size: ${t}
Difficulty: ${r}
Theme: ${s||"General fantasy"}

Please provide:
1. A detailed description of the encounter location
2. Enemy types and their motivations
3. Tactical considerations and terrain features
4. Potential story elements or plot hooks
5. Non-combat resolution options
6. Consequences of victory or defeat
7. Environmental hazards or advantages
8. How this encounter fits into the larger story

Make this encounter feel meaningful and story-driven, not just a random fight.`;return(await Bn([{role:"system",content:this.systemPrompt},{role:"user",content:i}],"gpt-4",800,.7)).choices[0].message.content}catch(i){throw console.error("Error generating combat encounter:",i),new Error(`Failed to generate combat encounter: ${i.message}`)}}async generateStoryContinuation(e,t,r,s=null,i="individual",a=null){var l,c,d,h,m;try{const p=e.map(M=>`${M.name} - Level ${M.level} ${M.race} ${M.class}`).join(", ");let y=null,v=null,S="";if(i==="individual"){const M=e[e.length-1];if(M)if(y=this.actionValidationService.validatePlayerAction(r,M,{context:"story",storyState:s}),y.valid&&y.diceResult){if(v=y.diceResult,v.overallSuccess){if(S=`

ACTION VALIDATION: The action is within your character's capabilities.`,v.actions){const F=v.actions.map(w=>`${w.action}: ${w.check.isSuccess?"Success":"Failure"} (Roll: ${w.check.roll}, DC: ${w.check.dc})`).join(", ");S+=`
Dice Results: ${F}`}}else if(S=`

ACTION VALIDATION: Some aspects of this action are challenging for your character.`,v.actions){const w=v.actions.filter(b=>!b.check.isSuccess).map(b=>`${b.action}: Failure (Roll: ${b.check.roll}, DC: ${b.check.dc})`).join(", ");S+=`
Failed Actions: ${w}`}}else y.valid||(S=`

ACTION VALIDATION: ${y.response}`,y.suggestion&&(S+=`
Suggestion: ${y.suggestion}`))}const E=t.map(M=>({role:M.role,content:M.content}));let _="";a&&(_=`
Party Theme: ${a.description||"No theme provided"}`);let x="";s&&(x=`
STORY STATE CONTEXT:
Current Location: ${((l=s.currentLocation)==null?void 0:l.name)||"Unknown"} - ${((c=s.currentLocation)==null?void 0:c.description)||""}
Active NPCs: ${Object.keys(s.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((d=s.activePlotThreads)==null?void 0:d.map(M=>`${M.title} (${Math.round(M.progress*100)}%)`).join(", "))||"None"}
Recent Events: ${((m=(h=s.worldState)==null?void 0:h.recentEvents)==null?void 0:m.slice(-3).map(M=>M.event).join(", "))||"None"}

CHARACTER RELATIONSHIPS:
${e.map(M=>{var b;const F=((b=s.characterArcs)==null?void 0:b[M.id])||{},w=Object.entries(F.relationships||{}).map(([N,A])=>`${N} (${A})`).join(", ");return`${M.name}: ${w||"No established relationships"}`}).join(`
`)}

NPC CONTEXT:
${Object.entries(s.activeNPCs||{}).map(([M,F])=>{var w;return`${M}: ${F.disposition} disposition, knowledge: ${((w=F.knowledge)==null?void 0:w.join(", "))||"none"}, goal: ${F.currentGoal||"unknown"}`}).join(`
`)}`);const C=`As a Dungeon Master, continue the story based on the player's response.

Party: ${p}${_}
Player Response: "${r}" (Type: ${i})
Response Type Context:
- individual: One character's personal action
- team: Group action or decision
- investigate: Looking for clues or information
- combat: Combat-related action
- social: Social interaction or diplomacy${x}

Previous Story Context:
${E.map(M=>`${M.role==="assistant"?"DM":"Player"}: ${M.content}`).join(`
`)}

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

ACTION VALIDATION GUIDELINES:
- If the action validation shows the action is impossible, gently redirect the player while maintaining story flow
- If the action validation shows the action is challenging, incorporate the difficulty into the narrative
- If the action validation shows the action is successful, proceed with the action as described
- Always maintain story coherence and character consistency
- Use the validation results to inform how the action plays out in the story

Please provide a compelling continuation that:
1. Acknowledges the player's action in context of the current situation and location
2. References relevant NPCs and their established relationships with the party
3. Continues or advances active plot threads appropriately
4. Updates character relationships based on the action
5. Maintains location and atmosphere consistency
6. Ends with a clear situation that invites the next player to respond
7. Encourages character interaction and roleplay
8. Provides multiple possible directions for the party to explore
9. Builds upon the established story state and character development
10. Incorporates action validation results naturally into the narrative

Keep your response engaging but concise (2-3 paragraphs maximum). Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.${S}`;return{content:(await Bn([{role:"system",content:this.systemPrompt},...E,{role:"user",content:C}],"gpt-4",800,.8)).choices[0].message.content,actionValidation:y,diceResult:v}}catch(p){throw console.error("Error generating story continuation:",p),new Error(`Failed to generate story continuation: ${p.message}`)}}async generatePlotOptions(e,t=null){try{const r=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class}. ${c.personality||""}. ${c.backstory||""}`).join(`
`);let s="";t&&(s=`
Party Theme: ${t.description||"No theme provided"}`);const i="You are a Dungeon Master for D&D 5e. You MUST generate exactly 3 plot options, no more, no less. Follow the exact format provided. Do not use party names in the plots. Keep summaries brief (1-2 sentences maximum). DO NOT repeat plots or generate duplicates.",a=`Generate exactly 3 distinct campaign plot options for this party. 

REQUIRED FORMAT - Follow this exact structure:

Plot 1: [Title]
[Brief summary - 1-2 sentences maximum]

Plot 2: [Title]  
[Brief summary - 1-2 sentences maximum]

Plot 3: [Title]
[Brief summary - 1-2 sentences maximum]

Party: ${r}${s}

CRITICAL REQUIREMENTS:
- Generate EXACTLY 3 plots, no more, no less
- Use the party theme to influence the plot lines and atmosphere
- Do NOT use the party name in the plots - focus on the characters and theme
- Each summary must be 1-2 sentences maximum
- Follow the exact format above with "Plot 1:", "Plot 2:", "Plot 3:" labels
- Do not add any additional text, explanations, or formatting
- Do not repeat or duplicate any plots
- Stop after Plot 3 - do not generate more plots

Make each plot distinct and appealing to different play styles.`;return(await Bn([{role:"system",content:i},{role:"user",content:a}],"gpt-4",600,.8)).choices[0].message.content}catch(r){throw console.error("Error generating plot options:",r),new Error(`Failed to generate plot options: ${r.message}`)}}async generateStoryIntroduction(e,t,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}. ${d.personality||""}. ${d.backstory||""}`).join(`
`);let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create an engaging story introduction for the beginning of this campaign.

Party: ${i}${a}
Selected Plot: ${t}
Plot Number: ${r}

IMPORTANT: Generate ONLY ONE story introduction for the selected plot above. Do NOT generate introductions for multiple plots or options.

Create an introduction that includes:
1. A vivid description of the starting town/settlement where the party begins
2. How each character arrives or is already present in this location
3. The initial situation or hook that draws the party together
4. A sense of atmosphere and setting that matches the chosen plot
5. An opening scene that gives the party their first decision or action to take

Important Guidelines:
- Use the party theme to influence the atmosphere and context
- Incorporate themes and elements from the party theme to create atmosphere and context
- Consider how the party's background and composition might influence the starting situation
- Focus on the characters and their individual stories
- The story should feel cohesive with the established theme
- Generate ONLY ONE introduction for the selected plot

Make this feel like the opening of an epic adventure. Set the tone, establish the setting, and give the party a clear starting point. End with a situation that requires the party to make a choice or take action.

Keep the introduction engaging but concise (3-4 paragraphs maximum).`;return(await Bn([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",800,.8)).choices[0].message.content}catch(i){throw console.error("Error generating story introduction:",i),new Error(`Failed to generate story introduction: ${i.message}`)}}async generateStructuredStoryResponse(e,t,r,s,i,a=null,l=null){var c,d,h;try{const m=e.map(x=>`${x.name} - Level ${x.level} ${x.race} ${x.class}`).join(", "),p=t.filter(x=>x&&typeof x=="object"&&x.role&&x.content).map(x=>({role:x.role,content:x.content}));let y="";l&&(y=`
Party Theme: ${l.description||"No theme provided"}`);const v=i.length>0?`
Discovered Objectives: ${i.map(x=>x.title).join(", ")}`:"";let S="";a&&(S=`
STORY STATE CONTEXT:
Current Location: ${((c=a.currentLocation)==null?void 0:c.name)||"Unknown"} - ${((d=a.currentLocation)==null?void 0:d.description)||""}
Active NPCs: ${Object.keys(a.activeNPCs||{}).join(", ")||"None"}
Active Plot Threads: ${((h=a.activePlotThreads)==null?void 0:h.map(x=>`${x.title} (${Math.round(x.progress*100)}%)`).join(", "))||"None"}
Character Relationships: ${Object.entries(a.characterArcs||{}).map(([x,C])=>{const k=e.find(M=>M.id===x);return`${k==null?void 0:k.name}: ${Object.entries(C.relationships||{}).map(([M,F])=>`${M} (${F})`).join(", ")||"No relationships"}`}).join("; ")}`);const E=`As a Dungeon Master, continue the story based on the player's response, considering the current story phase and discovered objectives.

Party: ${m}${y}
Current Phase: ${s}
Player Response: "${r}"${v}${S}

Story Phases:
- Investigation: Focus on discovery, clues, and gathering information
- Conflict: Focus on tension, threats, and potential combat
- Resolution: Focus on choices, consequences, and story conclusion

CRITICAL CONSISTENCY REQUIREMENTS:
1. Maintain all established NPC relationships and dispositions from the story state
2. Keep current location details consistent with previous descriptions
3. Continue active plot threads naturally without contradictions
4. Reference previous discoveries and character development
5. Build upon established world state and recent events
6. Ensure character actions align with their established motivations and relationships
7. Maintain the established tone and atmosphere
8. Reference specific NPCs that the party has already met
9. Build upon existing plot threads rather than introducing new unrelated elements
10. Consider character relationships when determining NPC reactions

ENEMY INFORMATION REQUIREMENTS (when in Conflict phase):
If the story involves combat or enemies, provide detailed enemy information in the following format:

**ENEMY_DETAILS:**
[For each enemy present, provide:]
Name: [Enemy name if humanoid, or descriptive name like "Alpha Wolf"]
Type: [Enemy type: humanoid, beast, undead, etc.]
Level: [Enemy level relative to party]
HP: [Hit points]
AC: [Armor class]
Basic Attack: [Description of basic attack and damage]
Special Ability: [Description of special ability or attack]
Stats: [Brief description of key stats like "Strong and aggressive" or "Quick and stealthy"]

IMPORTANT: You MUST format your response EXACTLY as follows:

**STORY_CONTENT:**
[Your main story continuation here - 2-3 paragraphs that acknowledge the player's action, continue the plot, and set up the next situation]

**CURRENT_LOCATION:**
[Updated location description or "No change" if location remains the same]

**ACTIVE_NPCS:**
[List of NPCs currently present or relevant to the scene, separated by commas]

**PLOT_DEVELOPMENTS:**
[Key plot developments or revelations from this response]

**CHARACTER_REACTIONS:**
[How NPCs react to the player's action, if applicable]

**NEXT_ACTIONS:**
[2-3 clear options or directions the party can take next]

**STORY_TONE:**
[The current mood/atmosphere: tense, mysterious, hopeful, dangerous, etc.]

**PHASE_STATUS:**
[Current story phase: investigation, conflict, or resolution]

**ENEMY_DETAILS:** (only include if enemies are present)
[Detailed enemy information as specified above]

Keep your response engaging but concise. Remember that only one player responds at a time, so end with a situation that gives the next player something meaningful to react to.`;return(await Bn([{role:"system",content:this.systemPrompt},...p,{role:"user",content:E}],"gpt-4",1e3,.8)).choices[0].message.content}catch(m){throw console.error("Error generating structured story response:",m),new Error(`Failed to generate structured story response: ${m.message}`)}}async generatePhaseTransition(e,t,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create a phase transition message for the story.

Party: ${i}${a}
Current Phase: ${t}
Story Progress: ${r}

Create a transition that:
1. Acknowledges the progress made so far
2. Signals the shift to the new phase
3. Sets up the new challenges and opportunities
4. Maintains the established tone and atmosphere
5. Gives the party clear direction for the next phase

Make this feel like a natural progression in the story.`;return(await Bn([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating phase transition:",i),new Error(`Failed to generate phase transition: ${i.message}`)}}async generateObjectiveCompletion(e,t,r,s=null){try{const i=e.map(d=>`${d.name} - Level ${d.level} ${d.race} ${d.class}`).join(", ");let a="";s&&(a=`
Party Theme: ${s.description||"No theme provided"}`);const l=`As a Dungeon Master, create a completion message for an objective.

Party: ${i}${a}
Completed Objective: ${t.title}
Story Context: ${r}

Create a completion message that:
1. Celebrates the achievement
2. Provides closure for this objective
3. Sets up the next challenge or objective
4. Maintains story momentum
5. Acknowledges the party's efforts

Make this feel rewarding and meaningful.`;return(await Bn([{role:"system",content:this.systemPrompt},{role:"user",content:l}],"gpt-4",600,.7)).choices[0].message.content}catch(i){throw console.error("Error generating objective completion:",i),new Error(`Failed to generate objective completion: ${i.message}`)}}async generateCampaignContinuation(e,t,r,s,i=null){try{const a=e.map(m=>`${m.name} - Level ${m.level} ${m.race} ${m.class}`).join(", "),l=r.filter(m=>m&&typeof m=="object"&&m.role&&m.content).map(m=>({role:m.role,content:m.content}));let c="";i&&(c=`
Party Theme: ${i.description||"No theme provided"}`);const d=`As a Dungeon Master, continue the ongoing campaign story.

Party: ${a}${c}
Campaign Goal: ${t.mainGoal||"No specific goal"}
Campaign Progress: ${t.campaignProgress||"Beginning"}
Player Response: "${s}"

Previous Story Context:
${l.map(m=>`${m.role==="assistant"?"DM":"Player"}: ${m.content}`).join(`
`)}

Continue the story while:
1. Building toward the main campaign goal
2. Maintaining consistency with previous events
3. Developing character relationships and arcs
4. Creating meaningful choices and consequences
5. Advancing the overall plot

Keep your response engaging but concise (2-3 paragraphs maximum).`;return(await Bn([{role:"system",content:this.systemPrompt},...l,{role:"user",content:d}],"gpt-4",800,.8)).choices[0].message.content}catch(a){throw console.error("Error generating campaign continuation:",a),new Error(`Failed to generate campaign continuation: ${a.message}`)}}async generateCampaignGoal(e,t,r=null){try{const s=e.map(c=>`${c.name} - Level ${c.level} ${c.race} ${c.class}`).join(", ");let i="";r&&(i=`
Party Theme: ${r.description||"No theme provided"}`);const a=`As a Dungeon Master, create a clear campaign goal based on the selected plot.

Party: ${s}${i}
Selected Plot: ${t}

IMPORTANT: Generate ONLY ONE campaign goal for the selected plot above. Do NOT generate multiple goals or options.

Create a campaign goal that:
1. Is clear and achievable
2. Provides direction for the entire campaign
3. Involves all party members
4. Has multiple possible paths to completion
5. Creates meaningful stakes and consequences
6. Is specific to the selected plot only

Make this goal compelling and motivating for the party. Generate ONLY ONE goal.`;return(await Bn([{role:"system",content:this.systemPrompt},{role:"user",content:a}],"gpt-4",600,.7)).choices[0].message.content}catch(s){throw console.error("Error generating campaign goal:",s),new Error(`Failed to generate campaign goal: ${s.message}`)}}async generateSessionSummary(e,t,r,s,i=null){try{const a=s.map(h=>`${h.name} - Level ${h.level} ${h.race} ${h.class}`).join(", ");let l="";i&&(l=`
Party Theme: ${i.description||"No theme provided"}`);const c=`As a Dungeon Master, create a session summary for this campaign session.

Party: ${a}${l}
Campaign Goal: ${e.mainGoal||"No specific goal"}
Objectives: ${r.map(h=>h.title).join(", ")}
Story Messages: ${t.length} total messages

Create a summary that:
1. Recaps the major events of the session
2. Highlights character development and relationships
3. Notes progress toward objectives
4. Sets up expectations for the next session
5. Maintains the established tone and atmosphere

Make this summary engaging and informative.`;return(await Bn([{role:"system",content:this.systemPrompt},{role:"user",content:c}],"gpt-4",800,.7)).choices[0].message.content}catch(a){throw console.error("Error generating session summary:",a),new Error(`Failed to generate session summary: ${a.message}`)}}}const ju=new F4;function $4({validation:n,onClose:e,onProceed:t,onRevise:r}){const[s,i]=I.useState(!1),[a,l]=I.useState(!1),[c,d]=I.useState(null);if(I.useEffect(()=>{if(n!=null&&n.diceResult){i(!0),l(!0);const p=setTimeout(()=>{l(!1),d(n.diceResult)},2e3);return()=>clearTimeout(p)}},[n]),!n)return null;const h=(p,y)=>y==="critical success"?"text-green-800 bg-green-200 border-green-400":y==="great success"?"text-green-700 bg-green-100 border-green-300":y==="success"?"text-green-600 bg-green-50 border-green-200":y==="failure"?"text-red-600 bg-red-50 border-red-200":y==="great failure"?"text-red-700 bg-red-100 border-red-300":y==="critical failure"?"text-red-800 bg-red-200 border-red-400":p?"text-green-600 bg-green-100 border-green-300":"text-red-600 bg-red-100 border-red-300",m=()=>n.diceResult?o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-gradient-to-br from-amber-900 to-amber-800 rounded-2xl p-8 max-w-2xl w-full mx-4 border-4 border-amber-600 shadow-2xl",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"text-amber-200 text-lg font-bold mb-2",children:" THE DICE HAVE BEEN CAST "}),o.jsx("div",{className:"text-amber-300 text-sm",children:"The fate of your party hangs in the balance..."})]}),o.jsxs("div",{className:"bg-amber-950/50 rounded-lg p-4 mb-6 border border-amber-500",children:[o.jsx("div",{className:"text-amber-200 font-bold text-lg mb-2",children:"Your Action"}),o.jsx("div",{className:"text-amber-100 text-sm",children:n.diceResult.actions?n.diceResult.actions.map((p,y)=>o.jsxs("div",{className:"mb-2",children:[o.jsx("span",{className:"font-semibold capitalize",children:p.action}),o.jsxs("span",{className:"text-amber-300",children:[": ",p.description]})]},y)).join(""):"Rolling the dice..."})]}),a?o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"text-6xl mb-4 animate-bounce",children:""}),o.jsx("div",{className:"text-amber-200 text-xl font-bold mb-2",children:"Rolling..."}),o.jsx("div",{className:"text-amber-300 text-sm",children:"The dice tumble across the table"})]}):o.jsxs("div",{className:"space-y-4",children:[n.diceResult.actions?n.diceResult.actions.map((p,y)=>o.jsxs("div",{className:`rounded-lg p-4 border-2 ${h(p.check.isSuccess,p.check.degree)}`,children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("div",{className:"text-lg font-bold capitalize",children:p.action}),o.jsx("div",{className:"text-2xl font-bold",children:p.check.degree?p.check.degree.replace("_"," ").toUpperCase():p.check.isSuccess?"SUCCESS":"FAILURE"})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center mb-3",children:[o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"ROLL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:p.check.roll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"TOTAL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:p.check.totalRoll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"DC"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:p.check.dc})]})]}),o.jsx("div",{className:"text-sm text-amber-200",children:p.description})]},y)):o.jsxs("div",{className:`rounded-lg p-6 border-2 text-center ${h(n.diceResult.isSuccess)}`,children:[o.jsx("div",{className:"text-2xl font-bold mb-4",children:n.diceResult.isSuccess?"SUCCESS!":"FAILURE!"}),o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"ROLL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:n.diceResult.roll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"TOTAL"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:n.diceResult.totalRoll})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("div",{className:"text-xs text-amber-300",children:"DC"}),o.jsx("div",{className:"text-xl font-mono font-bold text-amber-200",children:n.diceResult.dc})]})]})]}),n.diceResult.overallSuccess!==void 0&&o.jsxs("div",{className:`rounded-lg p-4 border-2 text-center ${n.diceResult.overallSuccess?"border-green-400 bg-green-900/50":"border-red-400 bg-red-900/50"}`,children:[o.jsx("div",{className:"text-xl font-bold mb-2",children:n.diceResult.overallSuccess?" MISSION ACCOMPLISHED! ":" THE DICE HAVE SPOKEN... "}),o.jsx("div",{className:"text-sm",children:n.diceResult.overallSuccess?"Your party's combined efforts have succeeded!":"The challenge has proven too great this time..."})]})]}),!a&&o.jsxs("div",{className:"bg-amber-950/50 rounded-lg p-4 mt-6 border border-amber-500",children:[o.jsx("div",{className:"text-amber-200 font-bold mb-2",children:" Dungeon Master's Commentary"}),o.jsx("div",{className:"text-amber-100 text-sm italic",children:typeof n.response=="string"?n.response:n.response.story})]}),!a&&o.jsxs("div",{className:"mt-6 flex justify-center space-x-4",children:[n.type==="valid"?o.jsx("button",{onClick:t,className:"fantasy-button bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:" PROCEED WITH FATE"}):o.jsx("button",{onClick:r,className:"fantasy-button bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:" TRY AGAIN"}),o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transform hover:scale-105 transition-all",children:" CANCEL"})]})]})}):null;return s?m():o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-gradient-to-br from-stone-800 to-stone-900 rounded-lg p-6 max-w-2xl w-full mx-4 border-2 border-stone-600 shadow-xl",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-stone-200",children:" Action Validation"}),o.jsx("button",{onClick:e,className:"text-stone-400 hover:text-stone-200 text-xl",children:""})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"p-4 bg-stone-700 rounded-lg border border-stone-600",children:[o.jsx("h4",{className:"font-semibold text-stone-200 mb-2",children:" Dungeon Master's Response"}),o.jsx("div",{className:"text-stone-300 italic leading-relaxed",children:typeof n.response=="string"?n.response:n.response.story})]}),n.suggestion&&o.jsxs("div",{className:"p-4 bg-blue-900/50 rounded-lg border border-blue-600",children:[o.jsx("h4",{className:"font-semibold text-blue-200 mb-2",children:" Suggestion"}),o.jsx("p",{className:"text-blue-100",children:n.suggestion})]}),n.type!=="valid"&&o.jsxs("div",{className:"p-4 bg-purple-900/50 rounded-lg border border-purple-600",children:[o.jsx("h4",{className:"font-semibold text-purple-200 mb-2",children:" Alternative Approaches"}),o.jsxs("ul",{className:"text-purple-100 text-sm space-y-1",children:[o.jsx("li",{children:" Try a more focused, single action"}),o.jsx("li",{children:" Consider your character's abilities and limitations"}),o.jsx("li",{children:" Think about what would be realistic in this situation"}),o.jsx("li",{children:" Ask for clarification about what you're trying to achieve"})]})]})]}),o.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[n.type==="valid"?o.jsx("button",{onClick:t,className:"fantasy-button bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold",children:"Proceed with Action"}):o.jsx("button",{onClick:r,className:"fantasy-button bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-bold",children:"Revise Action"}),o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700 text-white px-4 py-2 rounded font-bold",children:"Cancel"})]})]})})}function U4({diceResult:n,onClose:e}){if(!n)return null;const t=s=>{switch(s){case"critical success":return"text-green-600 bg-green-100";case"great success":return"text-green-700 bg-green-50";case"success":return"text-blue-600 bg-blue-100";case"failure":return"text-yellow-600 bg-yellow-100";case"great failure":return"text-orange-600 bg-orange-100";case"critical failure":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},r=s=>{switch(s){case"critical success":return"";case"great success":return"";case"success":return"";case"failure":return"";case"great failure":return"";case"critical failure":return"";default:return""}};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-stone-800",children:"Dice Roll Results"}),o.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:""})]}),n.actions?o.jsxs("div",{className:"space-y-4",children:[n.actions.map((s,i)=>o.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:s.action}),o.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${t(s.check.degree)}`,children:[r(s.check.degree)," ",s.check.degree]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Roll:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.roll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Total:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.totalRoll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"DC:"}),o.jsx("span",{className:"font-mono ml-1",children:s.check.dc})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Margin:"}),o.jsxs("span",{className:`font-mono ml-1 ${s.check.margin>=0?"text-green-600":"text-red-600"}`,children:[s.check.margin>=0?"+":"",s.check.margin]})]})]}),s.check.circumstanceBonus!==0&&o.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:["Circumstance bonus: ",s.check.circumstanceBonus>=0?"+":"",s.check.circumstanceBonus]})]},i)),o.jsxs("div",{className:"mt-4 p-3 bg-stone-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-stone-700 mb-2",children:"Overall Result"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${n.overallSuccess?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:n.overallSuccess?" Success":" Partial Failure"}),n.hasCriticalFailures&&o.jsx("span",{className:"text-red-600 text-sm",children:" Critical failures occurred"})]})]})]}):o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"border border-stone-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"font-semibold text-stone-700 capitalize",children:n.actionType}),o.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${t(n.degree)}`,children:[r(n.degree)," ",n.degree]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Roll:"}),o.jsx("span",{className:"font-mono ml-1",children:n.roll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Total:"}),o.jsx("span",{className:"font-mono ml-1",children:n.totalRoll})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"DC:"}),o.jsx("span",{className:"font-mono ml-1",children:n.dc})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-stone-600",children:"Margin:"}),o.jsxs("span",{className:`font-mono ml-1 ${n.margin>=0?"text-green-600":"text-red-600"}`,children:[n.margin>=0?"+":"",n.margin]})]})]}),o.jsxs("div",{className:"mt-2 text-xs text-stone-500",children:[o.jsxs("div",{children:["Primary Mod: ",n.primaryMod>=0?"+":"",n.primaryMod]}),o.jsxs("div",{children:["Proficiency: ",n.proficiencyMod>=0?"+":"",n.proficiencyMod]}),n.circumstanceBonus!==0&&o.jsxs("div",{children:["Circumstance: ",n.circumstanceBonus>=0?"+":"",n.circumstanceBonus]})]})]})}),o.jsx("div",{className:"mt-4 flex justify-end",children:o.jsx("button",{onClick:e,className:"fantasy-button bg-stone-600 hover:bg-stone-700",children:"Close"})})]})})}function B4(){var $,Q,ye,Ce,at,Xt,Zt,H,ee,Ee;const{user:n,loading:e}=bI(),{partyId:t}=Mo(),r=hr(),[s,i]=I.useState(null),[a,l]=I.useState(null),[c,d]=I.useState([]),[h,m]=I.useState([]),[p,y]=I.useState(!0),[v,S]=I.useState(""),[E,_]=I.useState(""),[x,C]=I.useState("storytelling"),[k,M]=I.useState([]),[F,w]=I.useState(null),[b,N]=I.useState(!1),[A,j]=I.useState(null),[D,P]=I.useState(!1),[Ve,je]=I.useState(null),[Fe,et]=I.useState(null),[V,K]=I.useState(!1),[Y,fe]=I.useState(!1),[ae,te]=I.useState(!1),[U,me]=I.useState(!1),[Ae,Qe]=I.useState([]),[Fn,$n]=I.useState(!1),[jt,tt]=I.useState(!1),[rn,We]=I.useState(!1),qt=()=>{var B;return((B=s==null?void 0:s.readyPlayers)==null?void 0:B.length)||0},Tn=()=>c.length,_t=()=>h.sort((B,G)=>B.name.localeCompare(G.name)),Un=B=>B?B.replace(/\*\*(.*?)\*\*/g,'<strong class="text-yellow-400 font-bold">$1</strong>').replace(/\*(.*?)\*/g,'<em class="text-blue-400 italic">$1</em>').replace(/`(.*?)`/g,'<code class="bg-slate-700 px-2 py-1 rounded text-slate-200 font-mono text-sm">$1</code>').replace(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*):/g,'<span class="text-green-400 font-semibold">$1:</span>').replace(/\b(weapon|sword|shield|armor|magic|spell|dragon|monster|treasure|gold|silver|quest|adventure|hero|villain)\b/gi,'<span class="text-orange-400 font-medium">$1</span>').replace(/\b([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\b/g,G=>G.includes("<")||["The","A","An","And","Or","But","In","On","At","To","For","Of","With","By"].includes(G)?G:`<span class="text-purple-400 font-medium">${G}</span>`).replace(/\n/g,"<br>"):"";I.useEffect(()=>{!n&&!e&&r("/login")},[n,e,r]),I.useEffect(()=>{t&&n&&!e&&gn()},[t,n,e]),I.useEffect(()=>{if(s!=null&&s.id){const B=uI(s.id,async G=>{var de,ce,xe,Re,en,De;if(G){i(G),G.deadPlayers&&G.deadPlayers.length>0&&(Qe(G.deadPlayers),$n(!0));const xt=G.currentContent||"",Ge=(G.storyMetadata||{}).phaseStatus||(xt.toLowerCase().includes("phase_status:")?(ce=(de=xt.toLowerCase().split("phase_status:")[1])==null?void 0:de.split(`
`)[0])==null?void 0:ce.trim():null)||(xt.toLowerCase().includes("conflict")?"conflict":null),Rt=["attack","battle","combat","fight","enemy","enemies","monster","creature","ghoul","bandit","goblin","troll"].some(R=>xt.toLowerCase().includes(R));if(G.storyMetadata&&String(G.storyMetadata.phaseStatus).toLowerCase()==="conflict"&&!rn&&!jt){tt(!0);const R=(a==null?void 0:a.members)||[];if(((xe=G.readyPlayers)==null?void 0:xe.length)===R.length&&R.length>0){if(!(h.length===R.length))return;try{const Ie=Ye(((Re=G.storyMetadata)==null?void 0:Re.enemyDetails)||[]),J=await Kn.createCombatSession(t,h.length>0?h:c,Ie,G.currentContent||"Combat encounter");tt(!1),We(!0),r(`/combat/${J.id}`)}catch{tt(!1),We(!1)}setTimeout(()=>{jt&&(tt(!1),We(!1))},5e3)}}else G.storyMetadata&&String(G.storyMetadata.phaseStatus).toLowerCase()!=="conflict"&&(We(!1),tt(!1));(en=G.readyPlayers)!=null&&en.includes(n==null?void 0:n.uid)&&K(!0);const ot=(a==null?void 0:a.members)||[];((De=G.readyPlayers)==null?void 0:De.length)===ot.length&&ot.length>0?fe(!0):fe(!1)}});return et(()=>B),()=>B()}},[s==null?void 0:s.id,n==null?void 0:n.uid,a==null?void 0:a.members,h,r,rn]),I.useEffect(()=>{if(t){console.log(" Setting up real-time subscription for characters:",t);const B=S0(t,async G=>{if(G){console.log(" Party update received:",G),l(G),d(G.members||[]);try{const de=await hs(t);console.log(" Characters reloaded:",de),console.log(" Character count:",de.length),console.log(" Character details:",de.map(ce=>({id:ce.id,name:ce.name,userId:ce.userId,partyId:ce.partyId}))),m(de)}catch(de){console.error(" Error reloading characters:",de)}}});return()=>B()}},[t]),I.useEffect(()=>()=>{Fe&&Fe()},[Fe]);const gn=I.useCallback(async()=>{if(t)try{y(!0);const B=await Ko(t);l(B);const G=(B==null?void 0:B.members)||[];d(G);let de=await Nt(t);de||(de=await lI(t)),i(de);const ce=await hs(t);m(ce);const xe=V4((B==null?void 0:B.description)||"adventure");M(xe)}catch(B){console.error(" Error loading story and characters:",B),S("Failed to load campaign data")}finally{y(!1)}},[t]),Jt=I.useCallback(async()=>{if(!(!n||!s))try{y(!0),await cI(s.id,n.uid)}catch(B){console.error(" Error readying up:",B),S("Failed to ready up")}finally{y(!1)}},[n,s]),Sn=I.useCallback(async()=>{if(!(!n||!s))try{y(!0),te(!0),await st(s.id,{status:"generating"});try{const B=await ju.generateStoryPlots(h,(a==null?void 0:a.description)||"An epic adventure awaits!",k),G=He(B);await st(s.id,{status:"voting",availablePlots:G})}catch(B){console.warn("AI service unavailable, using fallback plots:",B);const G=[{title:"The Lost Artifact",description:"A powerful artifact has been stolen and the party must track it down through dangerous territory.",summary:"An ancient artifact of great power has been stolen from the local temple. The party must follow the trail of the thieves through dangerous wilderness and hostile territory.",campaignLength:"medium"},{title:"The Dark Forest",description:"A mysterious forest has appeared overnight, and strange creatures are emerging from its depths.",summary:"A dark forest has mysteriously appeared on the outskirts of town. Strange creatures and magical phenomena are emerging, and the party must investigate the source.",campaignLength:"short"},{title:"The Dragon's Lair",description:"A dragon has been terrorizing the countryside, and the party must find a way to stop it.",summary:"A fearsome dragon has been attacking villages and stealing livestock. The party must find the dragon's lair and either defeat it or negotiate a peaceful solution.",campaignLength:"long"}];await st(s.id,{status:"voting",availablePlots:G}),S("AI service temporarily unavailable. Using predefined plot options.")}}catch(B){console.error(" Error starting story:",B),S("Failed to start story generation"),await st(s.id,{status:"ready_up"})}finally{y(!1),te(!1)}},[n,s,h,a==null?void 0:a.description,k]),In=I.useCallback(async B=>{var G;try{y(!0);const ce=(((G=s==null?void 0:s.availablePlots)==null?void 0:G.filter(xe=>xe.title&&!xe.title.startsWith("Plot ")))||[])[B];if(!ce){S("Selected plot not found");return}await st(s.id,{status:"generating_story",selectedPlot:B,selectedPlotData:ce,currentContent:`Generating story content for: ${ce.title}...`});try{const xe=await ju.generateStoryIntroduction(h,ce.description,ce.title,a);console.log(" Generated story content:",xe),await st(s.id,{status:"storytelling",currentContent:xe||`The adventure begins with ${ce.title}!`,currentSpeaker:{userId:a.dmId,name:"Dungeon Master",id:"dm",race:"DM",class:"Dungeon Master"}}),console.log(" Plot selected and story generated successfully")}catch(xe){console.warn("AI service unavailable, using fallback story:",xe);const Re=`The adventure begins with ${ce.title}!

${ce.summary}

The party finds themselves at the beginning of this epic journey. The path ahead is uncertain, but the promise of adventure and glory awaits those brave enough to take the first step.

What would you like to do?`;await st(s.id,{status:"storytelling",currentContent:Re,currentSpeaker:{userId:a.dmId,name:"Dungeon Master",id:"dm",race:"DM",class:"Dungeon Master"}}),console.log(" Plot selected with fallback story content"),S("AI service temporarily unavailable. Using simplified story introduction.")}}catch(de){console.error(" Error selecting plot:",de),S("Failed to select plot"),await st(s.id,{status:"voting"})}finally{y(!1)}},[s,h,a]),Nn=I.useCallback(async()=>{var B,G;if(E.trim())try{y(!0),S("");const de=h.find(ce=>ce.userId===(n==null?void 0:n.uid));if(!de){S("You need a character to participate in the story");return}try{const ce=await L4.validatePlayerAction(E,de,{storyState:s,currentContent:(s==null?void 0:s.currentContent)||"",party:a});w(ce),ce.diceResult&&(N(!0),j(ce))}catch(ce){console.warn("Action validation unavailable:",ce)}try{const ce=await ju.generateStructuredStoryResponse(h,(s==null?void 0:s.storyMessages)||[],E,x,hb(k),null,a),xe=it(ce),Re={speaker:((B=s==null?void 0:s.currentSpeaker)==null?void 0:B.name)||de.name,content:E,timestamp:new Date};await st(s.id,{currentContent:xe.storyContent||`${(s==null?void 0:s.currentContent)||""}

${de.name}: "${E}"`,currentSpeaker:null,storyMessages:[...(s==null?void 0:s.storyMessages)||[],Re],storyMetadata:{currentLocation:xe.currentLocation,activeNPCs:xe.activeNPCs,plotDevelopments:xe.plotDevelopments,characterReactions:xe.characterReactions,nextActions:xe.nextActions,storyTone:xe.storyTone,phaseStatus:xe.phaseStatus,enemyDetails:xe.enemyDetails||[]}})}catch(ce){console.warn("AI service unavailable, continuing story manually:",ce);const xe={speaker:((G=s==null?void 0:s.currentSpeaker)==null?void 0:G.name)||de.name,content:E,timestamp:new Date};await st(s.id,{currentContent:`${(s==null?void 0:s.currentContent)||""}

${de.name}: "${E}"`,currentSpeaker:null,storyMessages:[...(s==null?void 0:s.storyMessages)||[],xe]}),S("AI service temporarily unavailable. Story continued manually.")}_(""),w(null),await gn()}catch(de){console.error("Error sending response:",de),S("Failed to send response")}finally{y(!1)}},[E,h,n==null?void 0:n.uid,s,a,x,k,gn]),rt=I.useCallback(()=>{N(!1),j(null)},[]),ne=I.useCallback(()=>{P(!1),je(null)},[]),re=I.useCallback(async()=>{N(!1)},[]),ie=I.useCallback(()=>{N(!1),j(null)},[]),we=I.useCallback(async B=>{try{y(!0),B?await dI(s.id,B):await st(s.id,{currentSpeaker:null})}catch(G){console.error(" Error setting speaker:",G),S("Failed to set speaker")}finally{y(!1)}},[s==null?void 0:s.id]);I.useCallback(async()=>{try{y(!0);const B=await ju.generateStoryContinuation(h,(s==null?void 0:s.storyMessages)||[],"The story continues...",x,hb(k),null,a);await st(s.id,{currentContent:B||"The story continues...",currentSpeaker:null})}catch(B){console.error(" Error continuing story:",B),S("Failed to continue story")}finally{y(!1)}},[h,s,x,k,a]);const He=B=>{try{const de=B.split(/\*\*Plot Option \d+:\*\*/).filter(ce=>ce.trim()).map((ce,xe)=>{const Re=ce.trim().split(`
`).filter(Ge=>Ge.trim());let en=`Plot ${xe+1}`,De="",xt="",lt="";for(let Ge=0;Ge<Re.length;Ge++){const gt=Re[Ge].trim();if(gt.startsWith("1. Title:")){const Rt=gt.match(/1\.\s*Title:\s*"([^"]+)"/);Rt&&(en=Rt[1])}if(gt.startsWith("2. Summary:")){let Rt=gt.replace("2. Summary:","").trim(),ot=Ge+1;for(;ot<Re.length&&!Re[ot].trim().startsWith("3.");)Rt+=" "+Re[ot].trim(),ot++;xt=Rt.trim(),Ge=ot-1}if(gt.startsWith("3. Main Conflict:")){let Rt=gt.replace("3. Main Conflict:","").trim(),ot=Ge+1;for(;ot<Re.length&&!Re[ot].trim().startsWith("4.");)Rt+=" "+Re[ot].trim(),ot++;De=Rt.trim(),Ge=ot-1}if(gt.startsWith("5. Estimated Campaign Length:")){const Rt=gt.match(/5\.\s*Estimated Campaign Length:\s*(short|medium|long)/i);Rt&&(lt=Rt[1].toLowerCase())}}return!De&&xt&&(De=xt),console.log(` Plot ${xe+1} parsed:`,{title:en,description:De,summary:xt,campaignLength:lt}),{id:xe,title:en,description:De||xt||`Plot ${xe+1} description`,summary:xt,campaignLength:lt,index:xe}});return console.log(" Parsed plots:",de),de}catch(G){return console.error(" Error parsing plots:",G),[{id:0,title:"Plot 1",description:"Adventure awaits!",index:0},{id:1,title:"Plot 2",description:"Another exciting journey!",index:1},{id:2,title:"Plot 3",description:"A mysterious quest!",index:2}]}},it=B=>{try{console.log(" Parsing structured response:",B);const G={storyContent:"",currentLocation:"",activeNPCs:[],plotDevelopments:"",characterReactions:"",nextActions:[],storyTone:"",phaseStatus:"",enemyDetails:[]},de=B.match(/\*\*STORY_CONTENT:\*\*\s*([\s\S]*?)(?=\*\*|$)/);de&&(G.storyContent=de[1].trim());const ce=B.match(/\*\*CURRENT_LOCATION:\*\*\s*([\s\S]*?)(?=\*\*|$)/);ce&&(G.currentLocation=ce[1].trim());const xe=B.match(/\*\*ACTIVE_NPCS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);xe&&(G.activeNPCs=xe[1].trim().split(",").map(gt=>gt.trim()).filter(gt=>gt));const Re=B.match(/\*\*PLOT_DEVELOPMENTS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);Re&&(G.plotDevelopments=Re[1].trim());const en=B.match(/\*\*CHARACTER_REACTIONS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);en&&(G.characterReactions=en[1].trim());const De=B.match(/\*\*NEXT_ACTIONS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);De&&(G.nextActions=De[1].trim().split(",").map(gt=>gt.trim()).filter(gt=>gt));const xt=B.match(/\*\*STORY_TONE:\*\*\s*([\s\S]*?)(?=\*\*|$)/);xt&&(G.storyTone=xt[1].trim());const lt=B.match(/\*\*PHASE_STATUS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);lt&&(G.phaseStatus=lt[1].trim());const Ge=B.match(/\*\*ENEMY_DETAILS:\*\*\s*([\s\S]*?)(?=\*\*|$)/);if(Ge){const Rt=Ge[1].trim().split(/(?=Name:)/).filter(ot=>ot.trim());G.enemyDetails=Rt.map((ot,R)=>{const z={},pe=ot.match(/Name:\s*([^\n]+)/);pe&&(z.name=pe[1].trim());const Ie=ot.match(/Type:\s*([^\n]+)/);Ie&&(z.type=Ie[1].trim());const J=ot.match(/Level:\s*([^\n]+)/);J&&(z.level=parseInt(J[1].trim())||1);const Se=ot.match(/HP:\s*([^\n]+)/);if(Se){const Ts=Se[1].trim().match(/(\d+)/);z.hp=Ts?parseInt(Ts[1]):20}const _e=ot.match(/AC:\s*([^\n]+)/);_e&&(z.ac=parseInt(_e[1].trim())||12);const dt=ot.match(/Basic Attack:\s*([^\n]+)/);dt&&(z.basicAttack=dt[1].trim());const Oe=ot.match(/Special Ability:\s*([^\n]+)/);Oe&&(z.specialAbility=Oe[1].trim());const Wt=ot.match(/Stats:\s*([^\n]+)/);return Wt&&(z.stats=Wt[1].trim()),z})}return G}catch(G){return console.error(" Error parsing structured response:",G),{storyContent:B,currentLocation:"",activeNPCs:[],plotDevelopments:"",characterReactions:"",nextActions:[],storyTone:"",phaseStatus:"",enemyDetails:[]}}},Ye=B=>!Array.isArray(B)||B.length===0?[]:B.map((G,de)=>{var De,xt;const ce=`enemy_${de}`,xe=G.stats||"",Re=pt(xe,G.type);return{id:ce,name:G.name||`Enemy ${de+1}`,hp:G.hp||20,maxHp:G.hp||20,ac:G.ac||12,level:G.level||1,class:((De=G.type)==null?void 0:De.toLowerCase())||"enemy",race:((xt=G.type)==null?void 0:xt.toLowerCase())||"unknown",initiative:Math.floor(Math.random()*20)+1,strength:Re.strength,dexterity:Re.dexterity,constitution:Re.constitution,intelligence:Re.intelligence,wisdom:Re.wisdom,charisma:Re.charisma,statusEffects:[],cooldowns:{},lastAction:null,turnCount:0,basicAttack:G.basicAttack||"Basic attack (1d6 damage)",specialAbility:G.specialAbility||"None",type:G.type||"humanoid",stats:G.stats||"Standard enemy stats"}}),pt=(B,G)=>{const de=B.toLowerCase();let ce={strength:12,dexterity:10,constitution:12,intelligence:8,wisdom:8,charisma:6};if(G){const Ge=G.toLowerCase();Ge.includes("goblin")?ce={strength:8,dexterity:14,constitution:10,intelligence:8,wisdom:8,charisma:8}:Ge.includes("orc")||Ge.includes("troll")?ce={strength:16,dexterity:8,constitution:14,intelligence:7,wisdom:9,charisma:6}:Ge.includes("wizard")||Ge.includes("mage")||Ge.includes("sorcerer")?ce={strength:8,dexterity:12,constitution:10,intelligence:16,wisdom:12,charisma:14}:Ge.includes("priest")||Ge.includes("cleric")?ce={strength:12,dexterity:10,constitution:12,intelligence:10,wisdom:16,charisma:12}:Ge.includes("rogue")||Ge.includes("assassin")?ce={strength:10,dexterity:16,constitution:10,intelligence:12,wisdom:10,charisma:12}:Ge.includes("warrior")||Ge.includes("fighter")?ce={strength:16,dexterity:12,constitution:14,intelligence:10,wisdom:10,charisma:8}:(Ge.includes("boss")||Ge.includes("leader"))&&(ce={strength:18,dexterity:14,constitution:16,intelligence:12,wisdom:14,charisma:16})}const xe=de.match(/(?:strong|strength|powerful).*?(\d+)/),Re=de.match(/(?:quick|fast|agile|dexterity).*?(\d+)/),en=de.match(/(?:tough|hardy|constitution).*?(\d+)/),De=de.match(/(?:smart|intelligent|clever).*?(\d+)/),xt=de.match(/(?:wise|wisdom|perceptive).*?(\d+)/),lt=de.match(/(?:charismatic|charming|leadership).*?(\d+)/);return{strength:xe?parseInt(xe[1]):ce.strength,dexterity:Re?parseInt(Re[1]):ce.dexterity,constitution:en?parseInt(en[1]):ce.constitution,intelligence:De?parseInt(De[1]):ce.intelligence,wisdom:xt?parseInt(xt[1]):ce.wisdom,charisma:lt?parseInt(lt[1]):ce.charisma}};return e?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),o.jsx("p",{className:"text-slate-300",children:"Loading campaign..."})]})}):v?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-red-400 mb-4",children:v}),o.jsxs("div",{className:"space-x-4",children:[o.jsx("button",{onClick:()=>{S(""),gn()},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Retry"}),o.jsx("button",{onClick:()=>r("/dashboard"),className:"bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg transition-colors",children:"Back to Dashboard"})]})]})}):s?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:o.jsxs("div",{className:"container mx-auto px-4 py-6",children:[o.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-lg p-6 mb-6",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-3xl font-bold text-slate-200 mb-2",children:(a==null?void 0:a.name)||"Campaign Story"}),o.jsx("p",{className:"text-slate-300",children:(a==null?void 0:a.description)||"Adventure awaits!"})]}),o.jsx("div",{className:"text-right",children:o.jsxs("div",{className:"text-slate-300 text-sm",children:["Status: ",o.jsx("span",{className:"font-semibold text-slate-200",children:(s==null?void 0:s.status)||"unknown"})]})})]})}),(s==null?void 0:s.status)==="ready_up"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-3",children:"Campaign Lobby"}),o.jsx("p",{className:"text-slate-300 text-lg",children:"Waiting for all players to ready up"}),o.jsxs("div",{className:"mt-8 mb-8",children:[o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-4",children:[o.jsxs("div",{className:"text-2xl font-semibold text-slate-300",children:[qt(),"/",Tn()," Players Ready"]}),o.jsxs("div",{className:"text-lg text-slate-400",children:["(",Math.round(qt()/Tn()*100),"%)"]})]}),o.jsx("div",{className:"w-full bg-slate-700 rounded-full h-4 max-w-lg mx-auto",children:o.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-400 h-4 rounded-full transition-all duration-500",style:{width:`${qt()/Tn()*100}%`}})})]})]}),o.jsxs("div",{className:"text-center",children:[V?o.jsx("div",{className:"text-green-400 font-semibold text-xl bg-green-900/30 px-6 py-3 rounded-xl",children:"You are ready!"}):o.jsx("div",{className:"space-y-4",children:h.find(B=>B.userId===(n==null?void 0:n.uid))?o.jsx("button",{onClick:Jt,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Ready Up"}):o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-slate-300",children:"You need to create a character first"}),o.jsx("button",{onClick:()=>r(`/character-creation/${t}`),className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg",children:"Create Character"})]})}),Y&&(a==null?void 0:a.dmId)===(n==null?void 0:n.uid)&&o.jsx("div",{className:"mt-6",children:o.jsx("button",{onClick:Sn,disabled:p||ae,className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:p||ae?"Generating Story...":"Start Story Generation"})}),Y&&(a==null?void 0:a.dmId)!==(n==null?void 0:n.uid)&&o.jsx("div",{className:"mt-6",children:o.jsx("div",{className:"text-blue-400 font-semibold text-lg bg-blue-900/30 px-6 py-3 rounded-xl",children:"Waiting for Dungeon Master to start the story..."})})]})]}),(s==null?void 0:s.status)==="generating"&&o.jsx("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-4",children:"Generating Your Adventure"}),o.jsx("p",{className:"text-slate-300 text-lg mb-8",children:"The Dungeon Master is crafting your story. This may take a moment..."}),o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-400"}),o.jsx("div",{className:"text-slate-300 font-semibold text-lg",children:"Creating Story Plots..."})]})]})}),(s==null?void 0:s.status)==="generating_story"&&o.jsx("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-4",children:"Crafting Your Story"}),o.jsx("p",{className:"text-slate-300 text-lg mb-8",children:"The Dungeon Master is weaving the tale of your adventure..."}),o.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-400"}),o.jsx("div",{className:"text-slate-300 font-semibold text-lg",children:"Generating Story Content..."})]}),(s==null?void 0:s.selectedPlotData)&&o.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 max-w-2xl mx-auto",children:[o.jsxs("h3",{className:"text-slate-200 font-semibold mb-2",children:["Selected Plot: ",s.selectedPlotData.title]}),o.jsx("p",{className:"text-slate-300 text-sm",children:s.selectedPlotData.description})]})]})}),(s==null?void 0:s.status)==="voting"&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 max-w-4xl mx-auto mb-6",children:[o.jsx("h2",{className:"text-3xl font-bold text-slate-200 mb-6 text-center",children:"Choose Your Adventure"}),o.jsx("div",{className:"mb-4 flex justify-center",children:o.jsx("button",{onClick:()=>me(!U),className:"bg-slate-700 hover:bg-slate-600 text-slate-300 px-4 py-2 rounded-lg text-sm transition-colors",children:U?"Hide Debug":"Show Debug"})}),U&&o.jsxs("div",{className:"mb-4 p-4 bg-slate-700/50 rounded-lg",children:[o.jsxs("p",{className:"text-slate-300 text-sm",children:["Debug: Available plots count: ",(($=s==null?void 0:s.availablePlots)==null?void 0:$.length)||0]}),o.jsxs("p",{className:"text-slate-300 text-sm",children:["Debug: Raw plots: ",JSON.stringify((Q=s==null?void 0:s.availablePlots)==null?void 0:Q.slice(0,2))]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Array.isArray(s==null?void 0:s.availablePlots)&&s.availablePlots.length>0?s.availablePlots.map((B,G)=>o.jsxs("div",{className:"bg-slate-800/70 border-2 border-slate-600 rounded-xl p-6 hover:border-slate-500 transition-all duration-300",children:[o.jsx("h3",{className:"font-bold text-slate-200 text-xl mb-3",children:B.title}),o.jsx("p",{className:"text-slate-300 mb-4",children:B.description||"Adventure description here..."}),B.campaignLength&&o.jsxs("div",{className:"mb-4",children:[o.jsx("span",{className:"text-slate-400 text-sm",children:"Length: "}),o.jsx("span",{className:"text-slate-200 font-semibold capitalize",children:B.campaignLength})]}),(a==null?void 0:a.dmId)===(n==null?void 0:n.uid)?o.jsx("button",{onClick:()=>In(G),disabled:p,className:"w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Selecting...":"Choose This Plot"}):o.jsx("div",{className:"text-center py-3",children:o.jsx("span",{className:"text-slate-400 text-sm",children:"Waiting for DM to choose..."})})]},G)):o.jsxs("div",{className:"col-span-3 text-center",children:[o.jsx("p",{className:"text-slate-300",children:"No plots available. Please try generating the story again."}),(a==null?void 0:a.dmId)===(n==null?void 0:n.uid)&&o.jsx("button",{onClick:Sn,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors",children:"Regenerate Plots"})]})}),(a==null?void 0:a.dmId)!==(n==null?void 0:n.uid)&&o.jsx("div",{className:"text-center mt-6",children:o.jsx("p",{className:"text-slate-300 text-lg",children:"Waiting for the Dungeon Master to select a plot..."})})]}),(s==null?void 0:s.status)==="storytelling"&&o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[o.jsx("div",{className:"lg:col-span-1",children:o.jsxs("div",{className:"flex flex-col gap-y-6 lg:sticky lg:top-6",children:[o.jsxs("div",{className:"hidden lg:block bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsx("h3",{className:"font-bold text-slate-200",children:"Party Members"}),o.jsx("button",{onClick:()=>me(!U),className:"text-xs bg-slate-600 hover:bg-slate-500 px-2 py-1 rounded text-slate-200",children:U?"Hide Debug":"Show Debug"})]}),U&&o.jsxs("div",{className:"mb-2 p-2 bg-slate-700/50 rounded text-xs",children:[o.jsxs("p",{className:"text-slate-300",children:["Debug: Characters loaded: ",h.length]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Party members: ",c.length]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Characters: ",JSON.stringify(h.map(B=>({name:B.name,userId:B.userId})))]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Current Speaker: ",JSON.stringify(s==null?void 0:s.currentSpeaker)]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: User UID: ",n==null?void 0:n.uid]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Party DM ID: ",a==null?void 0:a.dmId]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Is DM speaking: ",((ye=s==null?void 0:s.currentSpeaker)==null?void 0:ye.id)==="dm"?"Yes":"No"]}),o.jsxs("p",{className:"text-slate-300",children:["Debug: Is user DM: ",(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)?"Yes":"No"]})]}),o.jsx("div",{className:"space-y-2",children:_t().map(B=>{var ce,xe,Re;const G=((ce=s==null?void 0:s.currentSpeaker)==null?void 0:ce.userId)===B.userId;n==null||n.uid,B.userId;const de=((xe=s==null?void 0:s.currentSpeaker)==null?void 0:xe.userId)===(n==null?void 0:n.uid)||((Re=s==null?void 0:s.currentSpeaker)==null?void 0:Re.id)==="dm"&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)||!(s!=null&&s.currentSpeaker)&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId);return o.jsxs("div",{className:`p-2 rounded transition-colors ${G?"bg-blue-600/30 border border-blue-500":de?"bg-slate-700/50 hover:bg-slate-600/50 cursor-pointer":"bg-slate-700/30 opacity-60 cursor-not-allowed"}`,onClick:de?()=>we(B):void 0,children:[o.jsx("div",{className:"font-semibold text-slate-200 text-xs",children:B.name}),o.jsxs("div",{className:"text-slate-400 text-xs",children:[B.race," ",B.class]}),G&&o.jsx("div",{className:"text-blue-400 text-xs mt-1",children:"Currently Speaking"}),!de&&!G&&o.jsx("div",{className:"text-slate-500 text-xs mt-1",children:"Waiting for turn..."}),de&&!G&&o.jsx("div",{className:"text-green-400 text-xs mt-1",children:"Click to select"})]},B.id)})})]}),(s==null?void 0:s.campaignMetadata)&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Campaign Progress"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Session:"}),o.jsx("span",{className:"text-slate-200 font-semibold",children:s.campaignMetadata.sessionNumber})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Progress:"}),o.jsxs("span",{className:"text-slate-200 font-semibold",children:[s.campaignMetadata.campaignProgress,"%"]})]})]})]}),k.length>0&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Objectives"}),o.jsx("div",{className:"space-y-2",children:k.map((B,G)=>o.jsxs("div",{className:"text-sm",children:[o.jsx("div",{className:"text-slate-300",children:B.title}),o.jsx("div",{className:"text-slate-400 text-xs",children:B.description})]},G))})]})]})}),o.jsxs("div",{className:"lg:col-span-3",children:[(s==null?void 0:s.currentContent)&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-8 mb-8 shadow-lg",children:[o.jsx("div",{className:"mb-6",children:o.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2 border-b border-slate-600 pb-3",children:" Current Story"})}),o.jsx("div",{className:"text-slate-200 leading-8 text-lg max-w-none prose prose-invert prose-lg prose-slate",style:{lineHeight:"1.8",fontSize:"1.125rem",letterSpacing:"0.025em"},dangerouslySetInnerHTML:{__html:Un(s.currentContent)}}),(s==null?void 0:s.storyMetadata)&&o.jsxs("div",{className:"mt-6 p-4 bg-slate-700/30 rounded-lg border border-slate-600",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.storyMetadata.currentLocation&&o.jsxs("div",{children:[o.jsx("span",{className:"text-blue-400 font-semibold",children:" Location:"}),o.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.currentLocation})]}),s.storyMetadata.storyTone&&o.jsxs("div",{children:[o.jsx("span",{className:"text-purple-400 font-semibold",children:" Tone:"}),o.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.storyTone})]}),s.storyMetadata.activeNPCs&&s.storyMetadata.activeNPCs.length>0&&o.jsxs("div",{children:[o.jsx("span",{className:"text-green-400 font-semibold",children:" Active NPCs:"}),o.jsx("span",{className:"text-slate-300 ml-2",children:s.storyMetadata.activeNPCs.join(", ")})]}),s.storyMetadata.phaseStatus&&o.jsxs("div",{children:[o.jsx("span",{className:"text-orange-400 font-semibold",children:" Phase:"}),o.jsx("span",{className:"text-slate-300 ml-2 capitalize",children:s.storyMetadata.phaseStatus})]})]}),s.storyMetadata.nextActions&&s.storyMetadata.nextActions.length>0&&o.jsxs("div",{className:"mt-4",children:[o.jsx("span",{className:"text-yellow-400 font-semibold",children:" Possible Actions:"}),o.jsx("ul",{className:"mt-2 space-y-1",children:s.storyMetadata.nextActions.map((B,G)=>o.jsxs("li",{className:"text-slate-300 text-sm",children:[" ",B]},G))})]})]})]}),s!=null&&s.currentSpeaker?o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mb-6",children:[o.jsxs("h3",{className:"font-bold text-slate-200 mb-4",children:["Current Speaker: ",s.currentSpeaker.name]}),((Ce=s==null?void 0:s.currentSpeaker)==null?void 0:Ce.userId)===(n==null?void 0:n.uid)||((at=s==null?void 0:s.currentSpeaker)==null?void 0:at.id)==="dm"&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)?o.jsxs("div",{className:"space-y-4",children:[o.jsx("textarea",{value:E,onChange:B=>_(B.target.value),placeholder:((Xt=s==null?void 0:s.currentSpeaker)==null?void 0:Xt.id)==="dm"?"Continue the story or describe what happens next...":`What does ${s.currentSpeaker.name} do?`,className:"w-full bg-slate-800/50 border border-slate-600 text-slate-100 px-4 py-3 rounded-lg focus:border-slate-500 focus:outline-none transition-colors min-h-[120px] resize-none",rows:4}),o.jsx("div",{className:"flex space-x-3",children:o.jsx("button",{onClick:Nn,disabled:!E.trim()||p,className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Processing...":((Zt=s==null?void 0:s.currentSpeaker)==null?void 0:Zt.id)==="dm"?"Continue Story":"Send Response"})})]}):o.jsxs("p",{className:"text-slate-300",children:["Waiting for ",s.currentSpeaker.name," to respond..."]})]}):(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mb-6",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-4",children:"Dungeon Master Response"}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("textarea",{value:E,onChange:B=>_(B.target.value),placeholder:"Continue the story or describe what happens next...",className:"w-full bg-slate-800/50 border border-slate-600 text-slate-100 px-4 py-3 rounded-lg focus:border-slate-500 focus:outline-none transition-colors min-h-[120px] resize-none",rows:4}),o.jsx("div",{className:"flex space-x-3",children:o.jsx("button",{onClick:Nn,disabled:!E.trim()||p,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Processing...":"Continue Story"})})]})]}),o.jsxs("div",{className:"lg:hidden bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-4 mb-6",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-3",children:"Party Members"}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:_t().map(B=>{var ce,xe,Re;const G=((ce=s==null?void 0:s.currentSpeaker)==null?void 0:ce.userId)===B.userId;n==null||n.uid,B.userId;const de=((xe=s==null?void 0:s.currentSpeaker)==null?void 0:xe.userId)===(n==null?void 0:n.uid)||((Re=s==null?void 0:s.currentSpeaker)==null?void 0:Re.id)==="dm"&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)||!(s!=null&&s.currentSpeaker)&&(n==null?void 0:n.uid)===(a==null?void 0:a.dmId);return o.jsxs("div",{className:`p-2 rounded transition-colors ${G?"bg-blue-600/30 border border-blue-500":de?"bg-slate-700/50 hover:bg-slate-600/50 cursor-pointer":"bg-slate-700/30 opacity-60 cursor-not-allowed"}`,onClick:de?()=>we(B):void 0,children:[o.jsx("div",{className:"font-semibold text-slate-200 text-xs",children:B.name}),o.jsxs("div",{className:"text-slate-400 text-xs",children:[B.race," ",B.class]}),G&&o.jsx("div",{className:"text-blue-400 text-xs mt-1",children:"Currently Speaking"}),!de&&!G&&o.jsx("div",{className:"text-slate-500 text-xs mt-1",children:"Waiting for turn..."}),de&&!G&&o.jsx("div",{className:"text-green-400 text-xs mt-1",children:"Click to select"})]},B.id)})})]}),(s==null?void 0:s.storyMessages)&&s.storyMessages.length>0&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-700/50 border border-slate-600 rounded-lg p-6 mt-8 shadow-lg",children:[o.jsx("div",{className:"mb-6",children:o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-2 border-b border-slate-600 pb-3",children:" Story History"})}),o.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:s.storyMessages.map((B,G)=>o.jsxs("div",{className:"border-l-4 border-slate-500 pl-4 py-2 bg-slate-800/30 rounded-r-lg",children:[o.jsxs("div",{className:"text-slate-300 text-sm font-semibold mb-2 flex items-center",children:[o.jsx("span",{className:"mr-2",children:""}),B.speaker||"Narrator"]}),o.jsx("div",{className:"text-slate-400 text-sm leading-6 pl-6 border-l border-slate-600",dangerouslySetInnerHTML:{__html:Un(B.content)}})]},G))})]}),Fn&&Ae.length>0&&o.jsx("div",{className:"bg-gradient-to-r from-red-900/50 to-red-800/50 border border-red-600 rounded-lg p-6 mb-6",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"text-red-400 text-xl",children:""}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-red-200 mb-2",children:"Combat Aftermath"}),o.jsx("p",{className:"text-red-100 text-sm mb-3",children:"The battle has ended. Some heroes have fallen, but the story continues..."}),o.jsxs("div",{className:"bg-red-800/30 border border-red-600 rounded p-3 mb-3",children:[o.jsx("h4",{className:"text-red-200 font-semibold mb-2",children:"Fallen Heroes:"}),o.jsx("div",{className:"space-y-2",children:Ae.map((B,G)=>o.jsxs("div",{className:"text-red-200 text-sm",children:[o.jsx("strong",{children:B.name})," (",B.class,", Level ",B.level,") - ",B.deathCause]},G))})]}),o.jsx("p",{className:"text-red-100 text-xs",children:"The fallen heroes will need to create new characters to rejoin the adventure."})]}),o.jsx("button",{onClick:()=>$n(!1),className:"text-red-400 hover:text-red-200 transition-colors",children:""})]})}),v&&o.jsx("div",{className:"bg-gradient-to-r from-red-900/50 to-red-800/50 border border-red-600 rounded-lg p-4 mb-6",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"text-red-400 text-xl",children:""}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-red-200 mb-2",children:"Notice"}),o.jsx("p",{className:"text-red-100 text-sm mb-3",children:v}),v.includes("AI service")&&o.jsxs("div",{className:"bg-red-800/30 border border-red-600 rounded p-3",children:[o.jsxs("p",{className:"text-red-200 text-xs mb-2",children:[o.jsx("strong",{children:"What this means:"})," The AI storytelling service is temporarily unavailable."]}),o.jsx("p",{className:"text-red-200 text-xs mb-2",children:o.jsx("strong",{children:"You can still:"})}),o.jsxs("ul",{className:"text-red-200 text-xs list-disc list-inside space-y-1",children:[o.jsx("li",{children:"Continue the story manually by typing your responses"}),o.jsx("li",{children:"Use the predefined plot options if available"}),o.jsx("li",{children:"Wait a few minutes and try again"})]})]})]}),o.jsx("button",{onClick:()=>S(""),className:"text-red-400 hover:text-red-200 transition-colors",children:""})]})}),U&&o.jsxs("div",{className:"bg-gradient-to-br from-slate-900/50 to-slate-800/50 border border-slate-600 rounded-lg p-6 mb-6",children:[o.jsx("h3",{className:"font-bold text-slate-200 mb-4",children:" Debug Information"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:"Story State"}),o.jsxs("div",{className:"space-y-1 text-slate-400",children:[o.jsxs("div",{children:["Story ID: ",(s==null?void 0:s.id)||"None"]}),o.jsxs("div",{children:["Status: ",(s==null?void 0:s.status)||"None"]}),o.jsxs("div",{children:["Phase: ",((H=s==null?void 0:s.storyMetadata)==null?void 0:H.phaseStatus)||"None"]}),o.jsxs("div",{children:["Ready Players: ",((ee=s==null?void 0:s.readyPlayers)==null?void 0:ee.length)||0,"/",c.length]}),o.jsxs("div",{children:["Current Speaker: ",((Ee=s==null?void 0:s.currentSpeaker)==null?void 0:Ee.name)||"None"]})]})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:"User State"}),o.jsxs("div",{className:"space-y-1 text-slate-400",children:[o.jsxs("div",{children:["User ID: ",(n==null?void 0:n.uid)||"None"]}),o.jsxs("div",{children:["Is DM: ",(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)?"Yes":"No"]}),o.jsxs("div",{children:["Is Ready: ",V?"Yes":"No"]}),o.jsxs("div",{children:["All Ready: ",Y?"Yes":"No"]}),o.jsxs("div",{children:["Combat Loading: ",jt?"Yes":"No"]}),o.jsxs("div",{children:["Has Navigated: ",rn?"Yes":"No"]})]})]})]}),(n==null?void 0:n.uid)===(a==null?void 0:a.dmId)&&o.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-600",children:[o.jsx("h4",{className:"text-slate-300 font-semibold mb-2",children:" Manual Combat Controls"}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:async()=>{console.log(" DM manually triggering combat..."),We(!0),tt(!0);try{const B=await Kn.createCombatSession(t,h.length>0?h:c,[],(s==null?void 0:s.currentContent)||"Manual combat encounter");tt(!1),We(!0),r(`/combat/${B.id}`)}catch(B){console.error(" Failed to create manual combat session:",B),tt(!1),We(!1)}},disabled:jt||rn,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:jt?"Loading...":"Trigger Combat"}),o.jsx("button",{onClick:()=>{We(!1),tt(!1),console.log(" Reset combat navigation state")},className:"bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors",children:"Reset State"})]})]})]})]})]}),b&&o.jsx($4,{validation:A,onClose:rt,onProceed:re,onRevise:ie}),D&&o.jsx(U4,{diceResult:Ve,onClose:ne})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-slate-300",children:"Story not found"}),o.jsx("button",{onClick:()=>r("/dashboard"),className:"mt-4 bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg transition-colors",children:"Back to Dashboard"})]})})}class z4{constructor(){this.scenes=new Map,this.currentScene=null}async createScene(e,t){try{const r={id:`scene_${Date.now()}`,title:t.title,description:t.description,mapLocation:t.mapLocation,objectives:t.objectives||[],problems:t.problems||[],createdAt:new Date,status:"active"},s=await Nt(e);if(!s)throw new Error("Campaign story not found");const i={...s,scenes:[...(s==null?void 0:s.scenes)||[],r],currentScene:r.id};return await st(s.id,i),r}catch(r){throw console.error("Error creating scene:",r),r}}async updateScene(e,t,r){try{const s=await Nt(e);if(!s)throw new Error("Campaign story not found");const i=(s==null?void 0:s.scenes)||[],a=i.findIndex(c=>c.id===t);if(a===-1)throw new Error("Scene not found");i[a]={...i[a],...r};const l={...s,scenes:i};return await st(s.id,l),i[a]}catch(s){throw console.error("Error updating scene:",s),s}}async getCurrentScene(e){try{const t=await Nt(e),r=t==null?void 0:t.currentScene;return r&&((t==null?void 0:t.scenes)||[]).find(i=>i.id===r)||null}catch(t){throw console.error("Error getting current scene:",t),t}}async addObjective(e,t,r){try{const s=await Nt(e);if(!s)throw new Error("Campaign story not found");const i=(s==null?void 0:s.scenes)||[],a=i.findIndex(d=>d.id===t);if(a===-1)throw new Error("Scene not found");const l={id:`obj_${Date.now()}`,text:r,completed:!1,createdAt:new Date};i[a].objectives=[...i[a].objectives||[],l];const c={...s,scenes:i};return await st(s.id,c),l}catch(s){throw console.error("Error adding objective:",s),s}}async addProblem(e,t,r){try{const s=await Nt(e);if(!s)throw new Error("Campaign story not found");const i=(s==null?void 0:s.scenes)||[],a=i.findIndex(d=>d.id===t);if(a===-1)throw new Error("Scene not found");const l={id:`prob_${Date.now()}`,text:r,solved:!1,createdAt:new Date};i[a].problems=[...i[a].problems||[],l];const c={...s,scenes:i};return await st(s.id,c),l}catch(s){throw console.error("Error adding problem:",s),s}}async updatePlayerPosition(e,t,r){try{const s=await Nt(e);if(!s)throw new Error("Campaign story not found");const i=(s==null?void 0:s.playerPositions)||{};i[t]={x:r.x,y:r.y,updatedAt:new Date};const a={...s,playerPositions:i};return await st(s.id,a),i[t]}catch(s){throw console.error("Error updating player position:",s),s}}async getPlayerPositions(e){try{const t=await Nt(e);return(t==null?void 0:t.playerPositions)||{}}catch(t){throw console.error("Error getting player positions:",t),t}}async updatePlayerView(e,t){try{const r=await Nt(e);if(!r)throw new Error("Campaign story not found");const s={...r,playerViewMode:t,lastViewUpdate:new Date};return await st(r.id,s),t}catch(r){throw console.error("Error updating player view:",r),r}}async getPlayerView(e){try{const t=await Nt(e);return(t==null?void 0:t.playerViewMode)||"hidden"}catch(t){throw console.error("Error getting player view:",t),t}}listenToPlayerView(e,t){try{const r=ln(ft(be,"campaignStories"),zt("partyId","==",e));return ua(r,s=>{if(!s.empty){const a=s.docs[0].data(),l=(a==null?void 0:a.playerViewMode)||"hidden";t(l)}},s=>{console.error("Error listening to player view:",s)})}catch(r){return console.error("Error setting up player view listener:",r),null}}listenToCampaignStory(e,t){try{const r=ln(ft(be,"campaignStories"),zt("partyId","==",e));return ua(r,s=>{if(s.empty)t(null);else{const i=s.docs[0],a={id:i.id,...i.data()};t(a)}},s=>{console.error("Error listening to campaign story:",s)})}catch(r){return console.error("Error setting up campaign story listener:",r),null}}}const Er=new z4;function q4(){var rt;const{partyId:n}=Mo(),e=hr(),[t,r]=I.useState(null),[s,i]=I.useState(!0),[a,l]=I.useState([]),[c,d]=I.useState(null),[h,m]=I.useState(!1),[p,y]=I.useState([]),[v,S]=I.useState("Campaign Map"),[E,_]=I.useState({width:15,height:10}),[x,C]=I.useState("grass"),[k,M]=I.useState("draw"),[F,w]=I.useState(!1),[b,N]=I.useState({x:0,y:0}),[A,j]=I.useState({}),[D,P]=I.useState(null),[Ve,je]=I.useState(!1),[Fe,et]=I.useState({x:0,y:0}),[V,K]=I.useState("map"),[Y,fe]=I.useState(!1),[ae,te]=I.useState(!0);I.useEffect(()=>{const ne=xa(re=>{if(!re){e("/login");return}r(re)});return()=>ne()},[e]),I.useEffect(()=>{t&&n&&(Nn(),U())},[t,n]),I.useEffect(()=>{if(!t||!n||Y)return;console.log("Setting up player view listener for party:",n);const ne=Er.listenToPlayerView(n,re=>{console.log("Player view updated to:",re),K(re),te(!1)});return()=>{ne&&ne()}},[t,n,Y]),I.useEffect(()=>{if(!t||!n)return;console.log("Setting up map listener for party:",n);const ne=Er.listenToCampaignStory(n,re=>{if(re&&re.campaignMap){console.log("Map updated:",re.campaignMap);const ie=Je.convertMapFromFirestore(re.campaignMap);ie&&(S(ie.title),y(ie.content),j(ie.subMaps),_(ie.size))}});return()=>{ne&&ne()}},[t,n]),I.useEffect(()=>{const ne=()=>{je(!1)};return document.addEventListener("mouseup",ne),()=>{document.removeEventListener("mouseup",ne)}},[]);const U=async()=>{try{const ne=await Je.loadMapFromDatabase(n);S(ne.title),y(ne.content),j(ne.subMaps),_(ne.size)}catch(ne){console.error("Error loading map:",ne);const re=Je.loadMap(n);S(re.title),y(re.content),j(re.subMaps),_(re.size)}},me=Je.getTileTypes(),Ae=()=>Je.initializeMap(E),Qe=async()=>{try{await Je.saveMapToDatabase(n,{title:v,content:p,size:E,subMaps:A}),m(!1)}catch(ne){console.error("Error saving map:",ne)}},Fn=async(ne,re)=>{let ie;k==="draw"?ie=Je.updateMapTile(p,ne,re,x):k==="erase"&&(ie=Je.updateMapTile(p,ne,re,"empty")),y(ie);try{await Je.saveMapToDatabase(n,{title:v,content:ie,size:E,subMaps:A})}catch(we){console.error("Error saving map to database:",we)}},$n=(ne,re)=>{je(!0),et({x:ne,y:re}),Fn(ne,re)},jt=(ne,re)=>{Ve&&Fn(ne,re)},tt=()=>{je(!1)},rn=async()=>{const ne=Ae();y(ne);try{await Je.saveMapToDatabase(n,{title:v,content:ne,size:E,subMaps:A})}catch(re){console.error("Error saving cleared map to database:",re)}},We=async()=>{const ne=Ae();y(ne);try{await Je.saveMapToDatabase(n,{title:v,content:ne,size:E,subMaps:A})}catch(re){console.error("Error saving resized map to database:",re)}},qt=(ne,re,ie)=>{ie.preventDefault(),N({x:ne,y:re}),P(A[`${ne}-${re}`]||Je.initializeSubMap()),w(!0)},Tn=()=>Je.initializeSubMap(),_t=async(ne,re)=>{let ie;k==="draw"?ie=Je.updateSubMapTile(D,ne,re,x):k==="erase"&&(ie=Je.updateSubMapTile(D,ne,re,"empty")),P(ie)},Un=(ne,re)=>{je(!0),et({x:ne,y:re}),_t(ne,re)},gn=(ne,re)=>{Ve&&_t(ne,re)},Jt=async()=>{const ne=Je.saveSubMap(A,b.x,b.y,D);j(ne),w(!1);try{await Je.saveMapToDatabase(n,{title:v,content:p,size:E,subMaps:ne})}catch(re){console.error("Error saving sub-map to database:",re)}},Sn=()=>{P(Tn())},In=(ne,re)=>Je.getTileHasSubMap(A,ne,re),Nn=async()=>{try{i(!0);const ne=await hs(n);l(ne);const re=await Je.loadCampaignData(n);d(re);const ie=await Je.getPartyData(n);if(fe((ie==null?void 0:ie.dmId)===(t==null?void 0:t.uid)),(ie==null?void 0:ie.dmId)!==(t==null?void 0:t.uid)){const we=await Er.getPlayerView(n);K(we),te(!1)}else te(!1)}catch(ne){console.error("Error loading campaign data:",ne)}finally{i(!1)}};return s?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-amber-400 border-t-transparent mx-auto mb-4"}),o.jsx("p",{className:"text-slate-300 text-lg font-medium",children:"Loading manual campaign..."})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:o.jsxs("div",{className:"fantasy-container",children:[!Y&&ae&&o.jsx("div",{className:"min-h-screen flex items-center justify-center",children:o.jsxs("div",{className:"fantasy-card max-w-md mx-auto text-center",children:[o.jsxs("div",{className:"animate-pulse mb-6",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("div",{className:"text-4xl mb-2",children:""}),o.jsx("div",{className:"text-2xl",children:""})]}),o.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-4",children:"Campaign Starting..."}),o.jsx("p",{className:"text-slate-300 mb-6",children:"Please wait while the Dungeon Master sets up your game."}),o.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[o.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-amber-400 border-t-transparent"}),o.jsx("span",{className:"text-slate-400 text-sm",children:"Waiting for DM..."})]})]})}),(!ae||Y)&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"mb-8",children:o.jsx("div",{className:"mb-6",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-400 mb-2",children:"Manual Campaign"}),o.jsx("p",{className:"text-slate-400",children:"Traditional D&D experience - full control over your story"})]})})}),!Y&&o.jsxs("div",{className:"fantasy-card mb-8",children:[V==="map"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:" Campaign Map"}),p&&p.length>0?o.jsx("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4 overflow-x-auto",children:o.jsx("div",{className:"inline-block",children:p.map((ne,re)=>o.jsx("div",{className:"flex",children:ne.map((ie,we)=>{var He,it,Ye;return o.jsx("div",{className:`w-8 h-8 border border-slate-600 flex items-center justify-center text-xs ${((He=me[ie])==null?void 0:He.color)||"bg-slate-700"}`,title:`${we}, ${re}: ${((it=me[ie])==null?void 0:it.name)||"Unknown"}`,children:((Ye=me[ie])==null?void 0:Ye.symbol)||""},`${we}-${re}`)})},re))})}):o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-slate-400 mb-4",children:"No map available yet."})})]}),V==="scene"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:" Current Scene"}),o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-3",children:(c==null?void 0:c.currentSceneTitle)||"Scene Title"}),o.jsx("p",{className:"text-slate-300 leading-relaxed",children:(c==null?void 0:c.currentSceneDescription)||"The DM is setting up the scene..."})]})]}),V==="combat"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:" Combat View"}),o.jsx("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-6",children:o.jsx("p",{className:"text-slate-300 text-center",children:"Combat is being prepared by the Dungeon Master..."})})]}),V==="hidden"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:" DM is Setting Up"}),o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-12 text-center",children:[o.jsx("div",{className:"text-6xl mb-6 animate-pulse",children:""}),o.jsx("h3",{className:"text-2xl font-bold text-slate-200 mb-4",children:"Please Wait"}),o.jsx("p",{className:"text-slate-300 mb-4 text-lg",children:"The Dungeon Master is preparing something special for you..."}),o.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[o.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-amber-400 border-t-transparent"}),o.jsx("span",{className:"text-slate-400",children:"Setting up the scene"})]}),o.jsx("p",{className:"text-slate-400 text-sm",children:"This screen will automatically update when the DM reveals the content."})]})]})]}),Y&&o.jsxs("div",{className:"fantasy-card mb-8",children:[o.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:"Campaign Map"}),p&&p.length>0?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4 overflow-x-auto",children:o.jsx("div",{className:"inline-block",children:p.map((ne,re)=>o.jsx("div",{className:"flex",children:ne.map((ie,we)=>{var He,it,Ye;return o.jsx("div",{className:`w-8 h-8 border border-slate-600 flex items-center justify-center text-xs ${((He=me[ie])==null?void 0:He.color)||"bg-slate-700"}`,title:`${we}, ${re}: ${((it=me[ie])==null?void 0:it.name)||"Unknown"}`,children:((Ye=me[ie])==null?void 0:Ye.symbol)||""},`${we}-${re}`)})},re))})}),o.jsx("button",{onClick:()=>m(!0),className:"mt-4 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"Edit Map"})]}):o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-slate-400 mb-4",children:"No map created yet."}),o.jsx("button",{onClick:()=>m(!0),className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300",children:"Create Map"})]})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:"Party Members"}),o.jsx("div",{className:"space-y-3",children:a.map(ne=>o.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"font-semibold text-slate-100",children:ne.name}),o.jsxs("p",{className:"text-sm text-slate-400",children:[ne.class,"  Level ",ne.level]})]}),o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"text-sm text-slate-300",children:["HP: ",ne.hp,"/",ne.maxHp]}),o.jsxs("div",{className:"text-xs text-slate-400",children:["AC: ",ne.ac]})]})]})},ne.id))})]}),h&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"fantasy-card max-w-6xl w-full max-h-[95vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Grid-Based Map Editor"}),o.jsx("button",{onClick:()=>m(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:""})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[o.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Map Title"}),o.jsx("input",{type:"text",value:v,onChange:ne=>S(ne.target.value),className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50",placeholder:"Enter map title..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Map Size"}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Width"}),o.jsx("input",{type:"number",min:"5",max:"30",value:E.width,onChange:ne=>{_(re=>({...re,width:parseInt(ne.target.value)})),We()},className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Height"}),o.jsx("input",{type:"number",min:"5",max:"20",value:E.height,onChange:ne=>{_(re=>({...re,height:parseInt(ne.target.value)})),We()},className:"w-full bg-slate-700/50 border border-slate-600/50 text-slate-200 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50"})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Tools"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{onClick:()=>M("draw"),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${k==="draw"?"bg-amber-500/20 text-amber-300 border border-amber-500/30":"bg-slate-700/30 text-slate-300 hover:bg-slate-700/50"}`,children:" Draw"}),o.jsx("button",{onClick:()=>M("erase"),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${k==="erase"?"bg-red-500/20 text-red-300 border border-red-500/30":"bg-slate-700/30 text-slate-300 hover:bg-slate-700/50"}`,children:" Erase"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-200 mb-2",children:"Tiles"}),o.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-96 overflow-y-auto",children:Object.entries(me).map(([ne,re])=>o.jsxs("button",{onClick:()=>C(ne),className:`p-2 rounded-lg border transition-colors ${x===ne?"border-amber-500 bg-amber-500/20":"border-slate-600 bg-slate-700/30 hover:border-slate-500"}`,children:[o.jsx("div",{className:`w-6 h-6 ${re.color} rounded flex items-center justify-center text-xs mx-auto mb-1`,children:re.symbol}),o.jsx("div",{className:"text-xs text-slate-300 truncate",children:re.name})]},ne))})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{onClick:rn,className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"Clear Map"}),o.jsx("button",{onClick:Qe,className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"Save Map"})]})]}),o.jsxs("div",{className:"lg:col-span-3",children:[o.jsx("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4 overflow-auto map-editor",children:o.jsx("div",{className:"inline-block",children:p.map((ne,re)=>o.jsx("div",{className:"flex",children:ne.map((ie,we)=>{var He,it,Ye;return o.jsxs("button",{onMouseDown:()=>$n(we,re),onMouseEnter:()=>jt(we,re),onMouseUp:tt,onContextMenu:pt=>qt(we,re,pt),className:`w-10 h-10 border border-slate-600 flex items-center justify-center text-sm transition-colors hover:border-amber-400 relative ${((He=me[ie])==null?void 0:He.color)||"bg-slate-700"}`,title:`${we}, ${re}: ${((it=me[ie])==null?void 0:it.name)||"Unknown"}${In(we,re)?" (Right-click for sub-map)":" (Right-click to create sub-map)"}`,children:[((Ye=me[ie])==null?void 0:Ye.symbol)||"",In(we,re)&&o.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-purple-500 rounded-full flex items-center justify-center text-[10px] text-white",children:""})]},`${we}-${re}`)})},re))})}),o.jsxs("div",{className:"mt-2 text-xs text-slate-400 text-center",children:["Click or drag to place/remove tiles. Current tool: ",k==="draw"?"Draw":"Erase"," | Selected tile: ",(rt=me[x])==null?void 0:rt.name]})]})]})]})}),F&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"fantasy-card max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h2",{className:"text-2xl font-bold text-slate-100",children:["Sub-Map Editor - Tile (",b.x,", ",b.y,")"]}),o.jsx("button",{onClick:()=>w(!1),className:"text-slate-400 hover:text-slate-200 text-2xl",children:""})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[o.jsx("div",{className:"lg:col-span-2",children:o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4 map-editor",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Sub-Map (8x8)"}),o.jsx("button",{onClick:Sn,className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm",children:"Clear"})]}),o.jsx("div",{className:"grid grid-cols-8 gap-1 mb-4",children:D.map((ne,re)=>ne.map((ie,we)=>{var He,it,Ye;return o.jsx("button",{onMouseDown:()=>Un(we,re),onMouseEnter:()=>gn(we,re),onMouseUp:tt,className:`w-12 h-12 border border-slate-600 flex items-center justify-center text-lg transition-colors hover:border-amber-400 ${((He=me[ie])==null?void 0:He.color)||"bg-slate-700"}`,title:`${we}, ${re}: ${((it=me[ie])==null?void 0:it.name)||"Empty"}`,children:((Ye=me[ie])==null?void 0:Ye.symbol)||""},`sub-${we}-${re}`)}))})]})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tools"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("button",{onClick:()=>M("draw"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${k==="draw"?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:" Draw"}),o.jsx("button",{onClick:()=>M("erase"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${k==="erase"?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:" Erase"})]})]}),o.jsxs("div",{className:"bg-slate-800/50 border border-slate-600/50 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-slate-100 mb-3",children:"Tile Types"}),o.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-80 overflow-y-auto",children:Object.entries(me).map(([ne,re])=>o.jsxs("button",{onClick:()=>C(ne),className:`p-2 rounded text-sm font-medium transition-colors flex items-center gap-2 ${x===ne?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[o.jsx("span",{className:"text-lg",children:re.symbol}),o.jsx("span",{className:"truncate",children:re.name})]},ne))})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:Jt,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded font-medium",children:"Save Sub-Map"}),o.jsx("button",{onClick:()=>w(!1),className:"px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded font-medium",children:"Cancel"})]})]})]})]})})]})]})})}function W4({partyId:n,onMapUpdate:e}){const[t,r]=I.useState([]),[s,i]=I.useState("Campaign Map"),[a,l]=I.useState({width:15,height:10}),[c,d]=I.useState("grass"),[h,m]=I.useState("draw"),[p,y]=I.useState(!1),[v,S]=I.useState({x:0,y:0}),[E,_]=I.useState({}),[x,C]=I.useState(null),[k,M]=I.useState(!1),[F,w]=I.useState({});I.useEffect(()=>{b()},[n]);const b=async()=>{try{const te=await Je.loadMapFromDatabase(n);i(te.title),r(te.content),_(te.subMaps),l(te.size)}catch(te){console.error("Error loading map:",te);const U=Je.loadMap(n);i(U.title),r(U.content),_(U.subMaps),l(U.size)}},N=Je.getTileTypes(),A=async(te,U)=>{let me;if(h==="draw")me=Je.updateMapTile(t,te,U,c);else if(h==="erase")me=Je.updateMapTile(t,te,U,"empty");else if(h==="player"){w(Ae=>({...Ae,[`player_${Date.now()}`]:{x:te,y:U,name:"Player"}}));return}r(me);try{await Je.saveMapToDatabase(n,{title:s,content:me,size:a,subMaps:E}),e&&e({title:s,content:me,size:a,subMaps:E})}catch(Ae){console.error("Error saving map:",Ae)}},j=(te,U)=>{M(!0),A(te,U)},D=(te,U)=>{k&&A(te,U)},P=()=>{M(!1)},Ve=(te,U,me)=>{me.preventDefault(),S({x:te,y:U}),C(E[`${te}-${U}`]||Je.initializeSubMap()),y(!0)},je=()=>Je.initializeSubMap(),Fe=(te,U)=>{h==="draw"?C(Je.updateSubMapTile(x,te,U,c)):h==="erase"&&C(Je.updateSubMapTile(x,te,U,"empty"))},et=(te,U)=>{M(!0),Fe(te,U)},V=(te,U)=>{k&&Fe(te,U)},K=()=>{_(Je.saveSubMap(E,v.x,v.y,x)),y(!1)},Y=()=>{C(je())},fe=(te,U)=>Je.getTileHasSubMap(E,te,U),ae=te=>{w(U=>{const me={...U};return delete me[te],me})};return o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100",children:" Campaign Map"}),o.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Click and drag to edit the map. Changes are saved automatically."})]}),o.jsx("div",{className:"mb-4",children:o.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[o.jsx("button",{onClick:()=>m("draw"),className:`px-3 py-1 rounded text-sm font-medium transition-colors ${h==="draw"?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:" Draw"}),o.jsx("button",{onClick:()=>m("erase"),className:`px-3 py-1 rounded text-sm font-medium transition-colors ${h==="erase"?"bg-red-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:" Erase"}),o.jsx("button",{onClick:()=>m("player"),className:`px-3 py-1 rounded text-sm font-medium transition-colors ${h==="player"?"bg-purple-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:" Player"})]})}),o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Tile Types:"}),o.jsx("div",{className:"grid grid-cols-6 gap-1 max-h-32 overflow-y-auto",children:Object.entries(N).map(([te,U])=>o.jsxs("button",{onClick:()=>d(te),className:`p-2 rounded text-xs transition-colors ${c===te?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,title:U.name,children:[o.jsx("div",{className:"text-lg",children:U.symbol}),o.jsx("div",{className:"text-xs",children:U.name})]},te))})]}),o.jsx("div",{className:"mb-4",children:o.jsx("div",{className:"bg-slate-900 p-4 rounded-lg overflow-auto",children:o.jsx("div",{className:"grid gap-0",style:{gridTemplateColumns:`repeat(${a.width}, 1fr)`,width:"fit-content"},children:t.map((te,U)=>te.map((me,Ae)=>{const Qe=N[me]||N.empty,Fn=fe(Ae,U),$n=Object.values(F).find(jt=>jt.x===Ae&&jt.y===U);return o.jsxs("div",{className:`w-8 h-8 border border-slate-600 cursor-pointer transition-colors relative ${Qe.color}`,onClick:()=>A(Ae,U),onMouseDown:()=>j(Ae,U),onMouseEnter:()=>D(Ae,U),onMouseUp:P,onContextMenu:jt=>Ve(Ae,U,jt),title:`${Qe.name} at (${Ae}, ${U})`,children:[o.jsx("div",{className:"flex items-center justify-center w-full h-full text-xs",children:$n?o.jsx("span",{className:"text-blue-400 font-bold",children:""}):Qe.symbol}),Fn&&o.jsx("div",{className:"absolute top-0 right-0 w-2 h-2 bg-purple-500 rounded-full"})]},`${Ae}-${U}`)}))})})}),Object.keys(F).length>0&&o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Player Positions:"}),o.jsx("div",{className:"space-y-1",children:Object.entries(F).map(([te,U])=>o.jsxs("div",{className:"flex items-center justify-between bg-slate-700 p-2 rounded",children:[o.jsxs("span",{className:"text-sm text-slate-300",children:[U.name," at (",U.x,", ",U.y,")"]}),o.jsx("button",{onClick:()=>ae(te),className:"text-red-400 hover:text-red-300 text-sm",children:""})]},te))})]}),p&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-slate-800 p-6 rounded-lg max-w-2xl w-full mx-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h3",{className:"text-lg font-bold text-slate-100",children:["Sub-Map Editor - Tile (",v.x,", ",v.y,")"]}),o.jsx("button",{onClick:()=>y(!1),className:"text-slate-400 hover:text-slate-300",children:""})]}),o.jsx("div",{className:"bg-slate-900 p-4 rounded-lg overflow-auto mb-4",children:o.jsx("div",{className:"grid grid-cols-8 gap-0 w-fit",children:x.map((te,U)=>te.map((me,Ae)=>{const Qe=N[me]||N.empty;return o.jsx("div",{className:`w-6 h-6 border border-slate-600 cursor-pointer transition-colors ${Qe.color}`,onClick:()=>Fe(Ae,U),onMouseDown:()=>et(Ae,U),onMouseEnter:()=>V(Ae,U),onMouseUp:P,title:`${Qe.name} at (${Ae}, ${U})`,children:o.jsx("div",{className:"flex items-center justify-center w-full h-full text-xs",children:Qe.symbol})},`sub-${Ae}-${U}`)}))})}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:K,className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"Save Sub-Map"}),o.jsx("button",{onClick:Y,className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"Clear Sub-Map"}),o.jsx("button",{onClick:()=>y(!1),className:"bg-gradient-to-r from-slate-500 to-slate-600 hover:from-slate-600 hover:to-slate-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300",children:"Cancel"})]})]})})]})}class H4{constructor(){this.initiativeOrder=[],this.currentTurn=0,this.round=1,this.combatActive=!1}async rollInitiative(e,t){try{const r=t.map(a=>{const l=Math.floor(Math.random()*20)+1,c=a.initiativeModifier||0,d=l+c;return{id:a.id,name:a.name,type:a.type,roll:l,modifier:c,total:d,initiative:d}});r.sort((a,l)=>l.initiative-a.initiative);const s=await Nt(e),i={...s,combat:{...s==null?void 0:s.combat,initiativeOrder:r,currentTurn:0,round:1,active:!0,startedAt:new Date}};return await st(e,i),r}catch(r){throw console.error("Error rolling initiative:",r),r}}async getInitiativeOrder(e){var t;try{const r=await Nt(e);return((t=r==null?void 0:r.combat)==null?void 0:t.initiativeOrder)||[]}catch(r){throw console.error("Error getting initiative order:",r),r}}async nextTurn(e){try{const t=await Nt(e),r=t==null?void 0:t.combat;if(!r||!r.active)throw new Error("No active combat");let s=r.currentTurn+1,i=r.round;s>=r.initiativeOrder.length&&(s=0,i=r.round+1);const a={...t,combat:{...r,currentTurn:s,round:i}};return await st(e,a),{currentTurn:s,round:i,currentParticipant:r.initiativeOrder[s]}}catch(t){throw console.error("Error advancing turn:",t),t}}async endCombat(e){try{const t=await Nt(e),r={...t,combat:{...t==null?void 0:t.combat,active:!1,endedAt:new Date}};return await st(e,r),!0}catch(t){throw console.error("Error ending combat:",t),t}}async getCombatState(e){try{const t=await Nt(e);return(t==null?void 0:t.combat)||null}catch(t){throw console.error("Error getting combat state:",t),t}}async addParticipant(e,t){try{const r=await Nt(e),s=r==null?void 0:r.combat;if(!s||!s.active)throw new Error("No active combat");const i=Math.floor(Math.random()*20)+1,a=t.initiativeModifier||0,l=i+a,c={id:t.id,name:t.name,type:t.type,roll:i,modifier:a,total:l,initiative:l},d=[...s.initiativeOrder,c];d.sort((m,p)=>p.initiative-m.initiative);const h={...r,combat:{...s,initiativeOrder:d}};return await st(e,h),c}catch(r){throw console.error("Error adding participant:",r),r}}async removeParticipant(e,t){try{const r=await Nt(e),s=r==null?void 0:r.combat;if(!s||!s.active)throw new Error("No active combat");const i=s.initiativeOrder.filter(c=>c.id!==t);let a=s.currentTurn;s.currentTurn>=i.length&&(a=0);const l={...r,combat:{...s,initiativeOrder:i,currentTurn:a}};return await st(e,l),!0}catch(r){throw console.error("Error removing participant:",r),r}}}const Ru=new H4;function G4({partyId:n,partyCharacters:e}){const[t,r]=I.useState([]),[s,i]=I.useState(0),[a,l]=I.useState(1),[c,d]=I.useState(!1),[h,m]=I.useState([]),[p,y]=I.useState(!1);I.useEffect(()=>{v()},[n]);const v=async()=>{try{const w=await Ru.getCombatState(n);w&&w.active&&(r(w.initiativeOrder),i(w.currentTurn),l(w.round),d(!0))}catch(w){console.error("Error loading combat state:",w)}},S=async()=>{try{y(!0);const w=[...e.map(N=>({id:N.id,name:N.name,type:"player",initiativeModifier:N.dexterity?Math.floor((N.dexterity-10)/2):0})),...h.map(N=>({id:N.id,name:N.name,type:"enemy",initiativeModifier:N.initiativeModifier||0}))];if(w.length===0){alert("No participants to roll initiative for!");return}const b=await Ru.rollInitiative(n,w);r(b),i(0),l(1),d(!0)}catch(w){console.error("Error starting combat:",w),alert("Failed to start combat")}finally{y(!1)}},E=async()=>{try{const w=await Ru.nextTurn(n);i(w.currentTurn),l(w.round)}catch(w){console.error("Error advancing turn:",w)}},_=async()=>{try{await Ru.endCombat(n),d(!1),r([]),i(0),l(1)}catch(w){console.error("Error ending combat:",w)}},x=()=>{const w={id:`enemy_${Date.now()}`,name:`Enemy ${h.length+1}`,initiativeModifier:0};m([...h,w])},C=w=>{m(h.filter(b=>b.id!==w))},k=(w,b,N)=>{m(h.map(A=>A.id===w?{...A,[b]:N}:A))},F=(()=>t.length===0||s>=t.length?null:t[s])();return o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100",children:" Initiative Tracker"}),o.jsx("div",{className:"flex gap-2",children:c?o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:E,className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 text-sm",children:" Next Turn"}),o.jsx("button",{onClick:_,className:"bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 text-sm",children:" End Combat"})]}):o.jsx("button",{onClick:S,disabled:p,className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 text-sm disabled:opacity-50",children:p?"Rolling...":" Roll Initiative"})})]}),c&&o.jsxs("div",{className:"mb-4 p-3 bg-slate-700 rounded-lg",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-300",children:"Round: "}),o.jsx("span",{className:"text-amber-400 font-bold",children:a})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-300",children:"Turn: "}),o.jsx("span",{className:"text-amber-400 font-bold",children:s+1}),o.jsxs("span",{className:"text-slate-400",children:[" / ",t.length]})]})]}),F&&o.jsxs("div",{className:"mt-2 p-2 bg-slate-600 rounded",children:[o.jsx("span",{className:"text-slate-300",children:"Current: "}),o.jsx("span",{className:`font-bold ${F.type==="player"?"text-blue-400":"text-red-400"}`,children:F.name}),o.jsxs("span",{className:"text-slate-400 ml-2",children:["(Initiative: ",F.initiative,")"]})]})]}),!c&&o.jsxs("div",{className:"mb-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"text-sm font-semibold text-slate-300",children:"Enemies:"}),o.jsx("button",{onClick:x,className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-1 px-3 rounded text-sm transition-all duration-300",children:" Add Enemy"})]}),o.jsx("div",{className:"space-y-2",children:h.map(w=>o.jsxs("div",{className:"flex items-center gap-2 bg-slate-700 p-2 rounded",children:[o.jsx("input",{type:"text",value:w.name,onChange:b=>k(w.id,"name",b.target.value),className:"flex-1 bg-slate-800 border border-slate-600 text-slate-100 px-2 py-1 rounded text-sm focus:border-slate-500 focus:outline-none",placeholder:"Enemy name"}),o.jsx("input",{type:"number",value:w.initiativeModifier,onChange:b=>k(w.id,"initiativeModifier",parseInt(b.target.value)||0),className:"w-16 bg-slate-800 border border-slate-600 text-slate-100 px-2 py-1 rounded text-sm focus:border-slate-500 focus:outline-none",placeholder:"+0"}),o.jsx("button",{onClick:()=>C(w.id),className:"text-red-400 hover:text-red-300 text-sm",children:""})]},w.id))})]}),c&&t.length>0&&o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Initiative Order:"}),o.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:t.map((w,b)=>o.jsxs("div",{className:`flex items-center justify-between p-2 rounded transition-colors ${b===s?"bg-amber-600/30 border border-amber-500":"bg-slate-700 hover:bg-slate-600"}`,children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:`text-sm font-medium ${w.type==="player"?"text-blue-400":"text-red-400"}`,children:w.name}),o.jsxs("span",{className:"text-xs text-slate-400",children:["(",w.type,")"]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("span",{className:"text-xs text-slate-400",children:[w.roll," + ",w.modifier," = ",w.initiative]}),b===s&&o.jsx("span",{className:"text-amber-400 text-sm",children:""})]})]},w.id))})]}),!c&&o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Player Characters:"}),o.jsx("div",{className:"space-y-1",children:e.map(w=>o.jsxs("div",{className:"flex items-center justify-between bg-slate-700 p-2 rounded",children:[o.jsx("span",{className:"text-blue-400 font-medium",children:w.name}),o.jsxs("span",{className:"text-xs text-slate-400",children:["Initiative: +",w.dexterity?Math.floor((w.dexterity-10)/2):0]})]},w.id))})]})]})}class K4{constructor(){this.monsters=this.initializeMonsters(),this.items=this.initializeItems(),this.spells=this.initializeSpells(),this.npcs=this.initializeNPCs()}initializeMonsters(){return[{id:"goblin",name:"Goblin",type:"Humanoid",cr:"1/4",hp:"7 (2d6)",ac:15,speed:"30 ft.",stats:{str:8,dex:14,con:10,int:10,wis:8,cha:8},actions:[{name:"Scimitar",type:"Melee Weapon Attack",attack:"+4",damage:"1d6+2 slashing"},{name:"Shortbow",type:"Ranged Weapon Attack",attack:"+4",damage:"1d6+2 piercing",range:"80/320 ft."}],description:"Small, green-skinned humanoids that live in caves and ruins."},{id:"orc",name:"Orc",type:"Humanoid",cr:"1/2",hp:"15 (2d8+6)",ac:13,speed:"30 ft.",stats:{str:16,dex:12,con:16,int:7,wis:11,cha:10},actions:[{name:"Greataxe",type:"Melee Weapon Attack",attack:"+5",damage:"1d12+3 slashing"},{name:"Javelin",type:"Ranged Weapon Attack",attack:"+5",damage:"1d6+3 piercing",range:"30/120 ft."}],description:"Large, muscular humanoids with tusks and greenish skin."},{id:"dragon",name:"Young Red Dragon",type:"Dragon",cr:"10",hp:"178 (17d10+85)",ac:18,speed:"40 ft., fly 80 ft.",stats:{str:23,dex:14,con:21,int:14,wis:11,cha:19},actions:[{name:"Bite",type:"Melee Weapon Attack",attack:"+10",damage:"2d10+6 piercing"},{name:"Claw",type:"Melee Weapon Attack",attack:"+10",damage:"2d6+6 slashing"},{name:"Fire Breath",type:"Cone",damage:"7d6 fire",save:"DC 17 Dex"}],description:"A young red dragon with scales the color of molten rock."}]}initializeItems(){return[{id:"sword",name:"Longsword",type:"Weapon",rarity:"Common",damage:"1d8 slashing",properties:["Versatile (1d10)"],description:"A well-crafted steel longsword."},{id:"shield",name:"Shield",type:"Armor",rarity:"Common",ac:"+2",description:"A wooden shield reinforced with metal."},{id:"potion_healing",name:"Potion of Healing",type:"Potion",rarity:"Common",effect:"Restores 2d4+2 hit points",description:"A red liquid that glows with magical energy."},{id:"ring_protection",name:"Ring of Protection",type:"Ring",rarity:"Rare",effect:"+1 to AC and saving throws",description:"A simple ring that provides magical protection."}]}initializeSpells(){return[{id:"fireball",name:"Fireball",level:3,school:"Evocation",castingTime:"1 action",range:"150 feet",components:["V","S","M"],duration:"Instantaneous",description:"A bright streak flashes from your pointing finger to a point you choose within range and then blossoms with a low roar into an explosion of flame.",damage:"8d6 fire",save:"DC 15 Dex"},{id:"magic_missile",name:"Magic Missile",level:1,school:"Evocation",castingTime:"1 action",range:"120 feet",components:["V","S"],duration:"Instantaneous",description:"You create three glowing darts of magical force.",damage:"1d4+1 force per missile"},{id:"cure_wounds",name:"Cure Wounds",level:1,school:"Evocation",castingTime:"1 action",range:"Touch",components:["V","S"],duration:"Instantaneous",description:"A creature you touch regains a number of hit points equal to 1d8 + your spellcasting ability modifier.",healing:"1d8 + modifier"}]}initializeNPCs(){return[{id:"merchant",name:"Merchant",type:"Commoner",occupation:"Trader",personality:"Friendly and eager to make a sale",description:"A well-dressed merchant with a cart full of goods.",inventory:["Various trade goods","Basic weapons","Simple tools"]},{id:"guard",name:"City Guard",type:"Guard",occupation:"Law Enforcement",personality:"Vigilant and duty-bound",description:"A stern-looking guard in chain mail with a spear.",equipment:["Chain mail","Spear","Shield"]},{id:"sage",name:"Wise Sage",type:"Scholar",occupation:"Lore Keeper",personality:"Knowledgeable but sometimes absent-minded",description:"An elderly scholar surrounded by books and scrolls.",knowledge:["Ancient history","Arcane lore","Local legends"]}]}searchMonsters(e){return this.monsters.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.type.toLowerCase().includes(e.toLowerCase())||t.description.toLowerCase().includes(e.toLowerCase()))}searchItems(e){return this.items.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.type.toLowerCase().includes(e.toLowerCase())||t.description.toLowerCase().includes(e.toLowerCase()))}searchSpells(e){return this.spells.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.school.toLowerCase().includes(e.toLowerCase())||t.description.toLowerCase().includes(e.toLowerCase()))}searchNPCs(e){return this.npcs.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.occupation.toLowerCase().includes(e.toLowerCase())||t.description.toLowerCase().includes(e.toLowerCase()))}getMonsterById(e){return this.monsters.find(t=>t.id===e)}getItemById(e){return this.items.find(t=>t.id===e)}getSpellById(e){return this.spells.find(t=>t.id===e)}getNPCById(e){return this.npcs.find(t=>t.id===e)}getRandomMonster(){return this.monsters[Math.floor(Math.random()*this.monsters.length)]}getRandomItem(){return this.items[Math.floor(Math.random()*this.items.length)]}getRandomSpell(){return this.spells[Math.floor(Math.random()*this.spells.length)]}getRandomNPC(){return this.npcs[Math.floor(Math.random()*this.npcs.length)]}}const Ps=new K4;function Q4(){const[n,e]=I.useState("monsters"),[t,r]=I.useState(""),[s,i]=I.useState(null),a=[{id:"monsters",name:" Monsters",icon:""},{id:"items",name:" Items",icon:""},{id:"spells",name:" Spells",icon:""},{id:"npcs",name:" NPCs",icon:""}],l=()=>{if(!t.trim())switch(n){case"monsters":return Ps.monsters;case"items":return Ps.items;case"spells":return Ps.spells;case"npcs":return Ps.npcs;default:return[]}switch(n){case"monsters":return Ps.searchMonsters(t);case"items":return Ps.searchItems(t);case"spells":return Ps.searchSpells(t);case"npcs":return Ps.searchNPCs(t);default:return[]}},c=v=>o.jsxs("div",{className:"bg-slate-700 rounded-lg p-4 hover:bg-slate-600 transition-colors cursor-pointer",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h3",{className:"text-lg font-bold text-slate-100",children:v.name}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-xs bg-red-600 text-white px-2 py-1 rounded",children:v.cr}),o.jsx("span",{className:"text-xs bg-slate-600 text-slate-300 px-2 py-1 rounded",children:v.type})]})]}),o.jsx("p",{className:"text-slate-300 text-sm mb-3",children:v.description}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"HP: "}),o.jsx("span",{className:"text-slate-200",children:v.hp})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"AC: "}),o.jsx("span",{className:"text-slate-200",children:v.ac})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Speed: "}),o.jsx("span",{className:"text-slate-200",children:v.speed})]})]}),v.actions&&v.actions.length>0&&o.jsxs("div",{className:"mt-3",children:[o.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-1",children:"Actions:"}),o.jsx("div",{className:"space-y-1",children:v.actions.slice(0,2).map((S,E)=>o.jsxs("div",{className:"text-xs text-slate-400",children:[o.jsxs("span",{className:"font-medium",children:[S.name,":"]})," ",S.damage]},E))})]})]},v.id),d=v=>o.jsxs("div",{className:"bg-slate-700 rounded-lg p-4 hover:bg-slate-600 transition-colors cursor-pointer",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h3",{className:"text-lg font-bold text-slate-100",children:v.name}),o.jsx("span",{className:"text-xs bg-slate-600 text-slate-300 px-2 py-1 rounded",children:v.rarity})]}),o.jsx("p",{className:"text-slate-300 text-sm mb-3",children:v.description}),o.jsxs("div",{className:"text-xs text-slate-400",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Type:"})," ",v.type]}),v.damage&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Damage:"})," ",v.damage]}),v.ac&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"AC Bonus:"})," ",v.ac]}),v.effect&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Effect:"})," ",v.effect]}),v.properties&&v.properties.length>0&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Properties:"})," ",v.properties.join(", ")]})]})]},v.id),h=v=>o.jsxs("div",{className:"bg-slate-700 rounded-lg p-4 hover:bg-slate-600 transition-colors cursor-pointer",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h3",{className:"text-lg font-bold text-slate-100",children:v.name}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("span",{className:"text-xs bg-purple-600 text-white px-2 py-1 rounded",children:["Level ",v.level]}),o.jsx("span",{className:"text-xs bg-slate-600 text-slate-300 px-2 py-1 rounded",children:v.school})]})]}),o.jsx("p",{className:"text-slate-300 text-sm mb-3",children:v.description}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Casting Time: "}),o.jsx("span",{className:"text-slate-200",children:v.castingTime})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Range: "}),o.jsx("span",{className:"text-slate-200",children:v.range})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Duration: "}),o.jsx("span",{className:"text-slate-200",children:v.duration})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Components: "}),o.jsx("span",{className:"text-slate-200",children:v.components.join(", ")})]})]}),(v.damage||v.healing)&&o.jsxs("div",{className:"mt-2 text-xs",children:[v.damage&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Damage: "}),o.jsx("span",{className:"text-slate-200",children:v.damage})]}),v.healing&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Healing: "}),o.jsx("span",{className:"text-slate-200",children:v.healing})]}),v.save&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-400",children:"Save: "}),o.jsx("span",{className:"text-slate-200",children:v.save})]})]})]},v.id),m=v=>o.jsxs("div",{className:"bg-slate-700 rounded-lg p-4 hover:bg-slate-600 transition-colors cursor-pointer",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h3",{className:"text-lg font-bold text-slate-100",children:v.name}),o.jsx("span",{className:"text-xs bg-slate-600 text-slate-300 px-2 py-1 rounded",children:v.type})]}),o.jsx("p",{className:"text-slate-300 text-sm mb-3",children:v.description}),o.jsxs("div",{className:"text-xs text-slate-400 space-y-1",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Occupation:"})," ",v.occupation]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Personality:"})," ",v.personality]}),v.inventory&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Inventory:"})," ",v.inventory.join(", ")]}),v.equipment&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Equipment:"})," ",v.equipment.join(", ")]}),v.knowledge&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Knowledge:"})," ",v.knowledge.join(", ")]})]})]},v.id),p=v=>{switch(n){case"monsters":return c(v);case"items":return d(v);case"spells":return h(v);case"npcs":return m(v);default:return null}},y=l();return o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100",children:" DM Catalogs"}),o.jsx("button",{onClick:()=>{const v=y[Math.floor(Math.random()*y.length)];v&&i(v)},className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 text-sm",children:" Random"})]}),o.jsx("div",{className:"mb-4",children:o.jsx("input",{type:"text",value:t,onChange:v=>r(v.target.value),placeholder:`Search ${n}...`,className:"w-full bg-slate-800 border border-slate-600 text-slate-100 px-3 py-2 rounded-lg focus:border-slate-500 focus:outline-none"})}),o.jsx("div",{className:"flex space-x-1 mb-4",children:a.map(v=>o.jsxs("button",{onClick:()=>e(v.id),className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===v.id?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:[v.icon," ",v.name.split(" ")[1]]},v.id))}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto",children:y.map(p)}),y.length===0&&o.jsx("div",{className:"text-center py-8",children:o.jsxs("p",{className:"text-slate-400",children:["No ",n," found matching your search."]})}),s&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-slate-800 p-6 rounded-lg max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h3",{className:"text-lg font-bold text-slate-100",children:["Selected ",n.slice(0,-1)]}),o.jsx("button",{onClick:()=>i(null),className:"text-slate-400 hover:text-slate-300",children:""})]}),p(s)]})})]})}function Y4(){var fe,ae,te;const{partyId:n}=Mo(),e=hr(),[t,r]=I.useState(null),[s,i]=I.useState(!0),[a,l]=I.useState(null),[c,d]=I.useState([]),[h,m]=I.useState("map");I.useState("");const[p,y]=I.useState(""),[v,S]=I.useState(""),[E,_]=I.useState([]),[x,C]=I.useState([]),[k,M]=I.useState(""),[F,w]=I.useState(""),[b,N]=I.useState("map"),[A,j]=I.useState(!1),D=[{id:"map",name:" Campaign Map",icon:"",description:"Primary campaign map and player view control"},{id:"scene",name:" Scene Manager",icon:"",description:"Manage current scene and objectives"},{id:"players",name:" Player Information",icon:"",description:"View player characters and stats"},{id:"initiative",name:" Initiative Tracker",icon:"",description:"Combat initiative and turn management"},{id:"enemies",name:" Enemy Catalog",icon:"",description:"Monster stats and encounter builder"},{id:"items",name:" Item Catalog",icon:"",description:"Weapons, armor, and magical items"},{id:"spells",name:" Spell Catalog",icon:"",description:"Spell database and reference"},{id:"npcs",name:" NPC Manager",icon:"",description:"Non-player characters and dialogue"},{id:"dice",name:" Dice Roller",icon:"",description:"Quick dice rolling tools"},{id:"notes",name:" Campaign Notes",icon:"",description:"Session notes and story tracking"},{id:"weather",name:" Weather & Time",icon:"",description:"Environmental conditions tracker"}],P=[{id:"map",name:" Campaign Map",description:"Players see the main campaign map"},{id:"scene",name:" Current Scene",description:"Players see the current scene description"},{id:"combat",name:" Combat View",description:"Players see combat initiative and status"},{id:"hidden",name:" Hidden",description:"Players see a loading screen"}];I.useEffect(()=>{const U=xa(me=>{if(!me){e("/login");return}r(me)});return()=>U()},[e]),I.useEffect(()=>{t&&n&&Ve()},[t,n]),I.useEffect(()=>{if(!t||!n)return;console.log("Setting up DM player view listener for party:",n);const U=Er.listenToPlayerView(n,me=>{console.log("DM: Player view updated to:",me),N(me)});return()=>{U&&U()}},[t,n]);const Ve=async()=>{try{i(!0);const U=await Ko(n);if(l(U),U.dmId!==t.uid){e(`/manual-campaign/${n}`);return}const me=await hs(n);d(me);const Ae=await Er.getCurrentScene(n);Ae&&(y(Ae.title),S(Ae.description),_(Ae.objectives||[]),C(Ae.problems||[]))}catch(U){console.error("Error loading campaign data:",U)}finally{i(!1)}},je=async()=>{try{if(!p.trim()||!v.trim()){alert("Please provide both title and description for the scene.");return}const U={title:p,description:v,mapLocation:{x:0,y:0},objectives:E,problems:x};await Er.createScene(n,U),alert("Scene created successfully!")}catch(U){console.error("Error creating scene:",U),alert("Failed to create scene")}},Fe=async()=>{if(k.trim())try{const U=await Er.getCurrentScene(n);if(!U){alert("Please create a scene first.");return}await Er.addObjective(n,U.id,k),_([...E,{id:`obj_${Date.now()}`,text:k,completed:!1}]),M("")}catch(U){console.error("Error adding objective:",U)}},et=async()=>{if(F.trim())try{const U=await Er.getCurrentScene(n);if(!U){alert("Please create a scene first.");return}await Er.addProblem(n,U.id,F),C([...x,{id:`prob_${Date.now()}`,text:F,solved:!1}]),w("")}catch(U){console.error("Error adding problem:",U)}},V=U=>{console.log("Map updated:",U)},K=async U=>{try{console.log("DM changing player view to:",U),N(U),await Er.updatePlayerView(n,U),console.log(`Players now see: ${U}`)}catch(me){console.error("Error updating player view:",me)}},Y=()=>{j(!A)};return s?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-300",children:"Loading DM Campaign..."})]})})})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:o.jsxs("div",{className:"fantasy-container py-8",children:[o.jsx("div",{className:"mb-8",children:o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("h1",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-400 mb-4",children:"DM Campaign Control"}),o.jsx("div",{className:"w-24 h-1 bg-gradient-to-r from-amber-400 to-orange-400 mx-auto rounded-full mb-4"}),o.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-2",children:a==null?void 0:a.name}),o.jsx("p",{className:"text-slate-400 mb-4",children:"Manual Campaign - Dungeon Master Interface"}),o.jsxs("div",{className:"flex items-center justify-center space-x-4 mb-4",children:[o.jsx("div",{className:"px-3 py-1 rounded-full text-sm font-medium bg-slate-600/20 text-slate-300 border border-slate-500/30",children:" Dungeon Master"}),o.jsxs("div",{className:"text-slate-400",children:[c.length," Players"]})]}),o.jsx("div",{className:"flex items-center justify-center",children:o.jsx("div",{className:"bg-slate-700/50 border border-slate-600/50 rounded-lg p-3",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("span",{className:"text-sm text-slate-300",children:"Player View:"}),b==="hidden"?o.jsx("button",{onClick:()=>K("map"),className:"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white px-4 py-2 rounded-lg transition-all duration-300 text-sm font-medium",children:" Show Players"}):o.jsx("button",{onClick:()=>K("hidden"),className:"bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white px-4 py-2 rounded-lg transition-all duration-300 text-sm font-medium",children:" Hide from Players"}),o.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${b==="hidden"?"bg-red-600/20 text-red-300 border border-red-500/30":"bg-green-600/20 text-green-300 border border-green-500/30"}`,children:(fe=P.find(U=>U.id===b))==null?void 0:fe.name})]})})})]})}),o.jsxs("div",{className:"flex gap-6",children:[o.jsx("div",{className:"w-80 flex-shrink-0",children:o.jsxs("div",{className:"fantasy-card sticky top-4",children:[o.jsx("h3",{className:"text-lg font-bold text-slate-100 mb-4 border-b border-slate-600 pb-2",children:" DM Tools"}),o.jsxs("div",{className:"mb-4 p-3 bg-slate-700/30 rounded-lg border border-slate-600/50",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h4",{className:"text-sm font-semibold text-slate-200",children:" Player View"}),o.jsx("button",{onClick:Y,className:"text-xs bg-slate-600 hover:bg-slate-500 text-slate-200 px-2 py-1 rounded transition-colors",children:A?"Hide":"Show"})]}),o.jsxs("div",{className:"text-xs text-slate-400 mb-2",children:["Current: ",(ae=P.find(U=>U.id===b))==null?void 0:ae.name]}),A&&o.jsx("div",{className:"space-y-1",children:P.map(U=>o.jsxs("button",{onClick:()=>K(U.id),className:`w-full text-left p-2 rounded text-xs transition-colors ${b===U.id?"bg-blue-600 text-white":"bg-slate-600/50 hover:bg-slate-500/50 text-slate-300"}`,children:[o.jsx("div",{className:"font-medium",children:U.name}),o.jsx("div",{className:"text-xs opacity-75",children:U.description})]},U.id))})]}),o.jsx("div",{className:"space-y-2 max-h-[calc(100vh-300px)] overflow-y-auto",children:D.map(U=>o.jsx("button",{onClick:()=>m(U.id),className:`w-full text-left p-3 rounded-lg transition-all duration-200 group ${h===U.id?"bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg":"bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 hover:text-white"}`,children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-xl",children:U.icon}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-medium text-sm",children:U.name.split(" ").slice(1).join(" ")}),o.jsx("div",{className:`text-xs mt-1 ${h===U.id?"text-blue-100":"text-slate-400"}`,children:U.description})]})]})},U.id))})]})}),o.jsxs("div",{className:"flex-1 space-y-6",children:[h==="map"&&o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100",children:" Campaign Map"}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"text-sm text-slate-400",children:[o.jsx("span",{className:"text-blue-400 font-semibold",children:c.length})," Players"]}),o.jsxs("div",{className:"text-sm text-slate-400",children:["Scene: ",o.jsx("span",{className:"text-green-400 font-semibold",children:p||"None"})]}),o.jsxs("div",{className:"text-sm text-slate-400",children:["View: ",o.jsx("span",{className:"text-amber-400 font-semibold",children:(te=P.find(U=>U.id===b))==null?void 0:te.name})]})]})]})}),o.jsx("div",{className:"fantasy-card",children:o.jsx(W4,{partyId:n,onMapUpdate:V})})]}),h==="players"&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-4",children:" Player Information"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(U=>o.jsxs("div",{className:"bg-slate-700/50 p-4 rounded-lg",children:[o.jsx("h4",{className:"text-lg font-semibold text-slate-100 mb-2",children:U.name}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("p",{children:[o.jsx("span",{className:"text-slate-400",children:"Class:"})," ",o.jsx("span",{className:"text-slate-200",children:U.class})]}),o.jsxs("p",{children:[o.jsx("span",{className:"text-slate-400",children:"Level:"})," ",o.jsx("span",{className:"text-slate-200",children:U.level})]}),o.jsxs("p",{children:[o.jsx("span",{className:"text-slate-400",children:"HP:"})," ",o.jsxs("span",{className:"text-slate-200",children:[U.hp,"/",U.maxHp]})]}),o.jsxs("p",{children:[o.jsx("span",{className:"text-slate-400",children:"Player:"})," ",o.jsx("span",{className:"text-slate-200",children:U.playerName})]})]})]},U.id))})]}),h==="scene"&&o.jsxs("div",{className:"fantasy-card",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100",children:" Scene Manager"}),o.jsx("button",{onClick:je,className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 text-sm",children:" Save Scene"})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Scene Details:"}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("input",{type:"text",value:p,onChange:U=>y(U.target.value),placeholder:"Scene Title",className:"w-full bg-slate-800 border border-slate-600 text-slate-100 px-3 py-2 rounded-lg focus:border-slate-500 focus:outline-none"}),o.jsx("textarea",{value:v,onChange:U=>S(U.target.value),placeholder:"Describe the scene for your players...",rows:6,className:"w-full bg-slate-800 border border-slate-600 text-slate-100 px-3 py-2 rounded-lg focus:border-slate-500 focus:outline-none resize-none"})]})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Objectives & Problems:"}),o.jsxs("div",{className:"mb-4",children:[o.jsx("h5",{className:"text-xs font-semibold text-slate-400 mb-2",children:"Objectives:"}),o.jsxs("div",{className:"space-y-2",children:[E.map((U,me)=>o.jsxs("div",{className:"flex items-center gap-2 bg-slate-700 p-2 rounded",children:[o.jsx("span",{className:"text-sm text-slate-300",children:U.text}),o.jsx("span",{className:`text-xs px-2 py-1 rounded ${U.completed?"bg-green-600 text-white":"bg-slate-600 text-slate-300"}`,children:U.completed?"":""})]},U.id||me)),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"text",value:k,onChange:U=>M(U.target.value),placeholder:"Add objective...",className:"flex-1 bg-slate-800 border border-slate-600 text-slate-100 px-2 py-1 rounded text-sm focus:border-slate-500 focus:outline-none"}),o.jsx("button",{onClick:Fe,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors",children:""})]})]})]}),o.jsxs("div",{children:[o.jsx("h5",{className:"text-xs font-semibold text-slate-400 mb-2",children:"Problems:"}),o.jsxs("div",{className:"space-y-2",children:[x.map((U,me)=>o.jsxs("div",{className:"flex items-center gap-2 bg-slate-700 p-2 rounded",children:[o.jsx("span",{className:"text-sm text-slate-300",children:U.text}),o.jsx("span",{className:`text-xs px-2 py-1 rounded ${U.solved?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:U.solved?"":""})]},U.id||me)),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"text",value:F,onChange:U=>w(U.target.value),placeholder:"Add problem...",className:"flex-1 bg-slate-800 border border-slate-600 text-slate-100 px-2 py-1 rounded text-sm focus:border-slate-500 focus:outline-none"}),o.jsx("button",{onClick:et,className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors",children:""})]})]})]})]})]})]}),h==="initiative"&&o.jsx(G4,{partyId:n,partyCharacters:c}),h==="enemies"&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-4",children:" Enemy Catalog"}),o.jsx("p",{className:"text-slate-400 mb-4",children:"Monster database and encounter builder coming soon..."}),o.jsxs("div",{className:"bg-slate-700/50 p-6 rounded-lg text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-2",children:"Enemy Catalog"}),o.jsx("p",{className:"text-slate-400",children:"Search monsters, build encounters, and manage combat"})]})]}),h==="items"&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-4",children:" Item Catalog"}),o.jsx("p",{className:"text-slate-400 mb-4",children:"Weapons, armor, and magical items database coming soon..."}),o.jsxs("div",{className:"bg-slate-700/50 p-6 rounded-lg text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-2",children:"Item Catalog"}),o.jsx("p",{className:"text-slate-400",children:"Browse weapons, armor, and magical items"})]})]}),h==="spells"&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-4",children:" Spell Catalog"}),o.jsx("p",{className:"text-slate-400 mb-4",children:"Spell database and reference coming soon..."}),o.jsxs("div",{className:"bg-slate-700/50 p-6 rounded-lg text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-2",children:"Spell Catalog"}),o.jsx("p",{className:"text-slate-400",children:"Search and reference spells by class and level"})]})]}),h==="npcs"&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-4",children:" NPC Manager"}),o.jsx("p",{className:"text-slate-400 mb-4",children:"Non-player characters and dialogue management coming soon..."}),o.jsxs("div",{className:"bg-slate-700/50 p-6 rounded-lg text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-2",children:"NPC Manager"}),o.jsx("p",{className:"text-slate-400",children:"Create and manage NPCs with dialogue trees"})]})]}),h==="dice"&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-4",children:" Dice Roller"}),o.jsx("p",{className:"text-slate-400 mb-4",children:"Quick dice rolling tools coming soon..."}),o.jsxs("div",{className:"bg-slate-700/50 p-6 rounded-lg text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-2",children:"Dice Roller"}),o.jsx("p",{className:"text-slate-400",children:"Quick access to common dice rolls"})]})]}),h==="notes"&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-4",children:" Campaign Notes"}),o.jsx("p",{className:"text-slate-400 mb-4",children:"Session notes and story tracking coming soon..."}),o.jsxs("div",{className:"bg-slate-700/50 p-6 rounded-lg text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-2",children:"Campaign Notes"}),o.jsx("p",{className:"text-slate-400",children:"Track session notes and story progression"})]})]}),h==="weather"&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-4",children:" Weather & Time"}),o.jsx("p",{className:"text-slate-400 mb-4",children:"Environmental conditions tracker coming soon..."}),o.jsxs("div",{className:"bg-slate-700/50 p-6 rounded-lg text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-2",children:"Weather & Time"}),o.jsx("p",{className:"text-slate-400",children:"Track weather conditions and time of day"})]})]}),h==="catalogs"&&o.jsx(Q4,{})]})]})]})})}function J4({deadPlayer:n,combatSession:e,onSpectate:t}){var c,d;const[r,s]=I.useState(0);I.useEffect(()=>{const h=setInterval(()=>{s(m=>m+1)},1e3);return()=>clearInterval(h)},[]);const i=h=>{const m=Math.floor(h/60),p=h%60;return`${m}:${p.toString().padStart(2,"0")}`},a=((c=e==null?void 0:e.partyMembers)==null?void 0:c.filter(h=>h.hp>0))||[],l=((d=e==null?void 0:e.enemies)==null?void 0:d.filter(h=>h.hp>0))||[];return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card bg-red-50 border-red-200",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h1",{className:"text-3xl font-bold text-red-800 mb-4",children:"Character Death"}),o.jsxs("div",{className:"text-xl text-red-700 mb-6",children:[n.name," has fallen in battle..."]}),o.jsxs("div",{className:"bg-white p-6 rounded-lg border border-red-300 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-stone-800 mb-2",children:"Fallen Hero"}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Name:"})," ",n.name]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Class:"})," ",n.class]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Level:"})," ",n.level]}),o.jsxs("p",{className:"text-stone-600 mb-2",children:[o.jsx("strong",{children:"Final HP:"})," ",n.hp,"/",n.maxHp]}),o.jsxs("p",{className:"text-stone-600",children:[o.jsx("strong",{children:"Time of Death:"})," ",i(r)]})]}),o.jsxs("div",{className:"bg-gray-100 p-6 rounded-lg border border-gray-300 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Combat Status"}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"font-semibold text-green-700",children:"Alive Allies"}),o.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.length}),o.jsx("div",{className:"text-xs text-gray-600 mt-1",children:a.map(h=>h.name).join(", ")})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"font-semibold text-red-700",children:"Remaining Enemies"}),o.jsx("p",{className:"text-2xl font-bold text-red-600",children:l.length}),o.jsx("div",{className:"text-xs text-gray-600 mt-1",children:l.map(h=>h.name).join(", ")})]})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[o.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"What happens next?"}),o.jsxs("ul",{className:"text-blue-700 text-sm space-y-1",children:[o.jsx("li",{children:" You must wait for combat to end"}),o.jsx("li",{children:" If your allies win, you'll create a new character"}),o.jsx("li",{children:" If all allies die, the campaign ends"}),o.jsx("li",{children:" Your new character will join the story where it left off"})]})]}),o.jsx("button",{onClick:t,className:"fantasy-button bg-gray-600 hover:bg-gray-700 text-white",children:"Spectate Combat"})]})]})})})}function X4({story:n,deadCharacters:e,combatSummary:t}){var i;const r=hr(),s=()=>{r("/dashboard")};return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-8xl mb-6",children:""}),o.jsx("h1",{className:"text-4xl font-bold text-red-300 mb-4",children:"Campaign Defeat"}),o.jsx("div",{className:"text-xl text-red-200 mb-8",children:"The party has fallen... The story ends here."}),o.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg border border-red-600 mb-6 text-left",children:[o.jsx("h2",{className:"text-2xl font-semibold text-gray-100 mb-4",children:"The Complete Story"}),o.jsx("div",{className:"space-y-4 text-gray-300",children:(i=n==null?void 0:n.storyMessages)==null?void 0:i.map((a,l)=>o.jsxs("div",{className:"border-l-2 border-gray-600 pl-4",children:[o.jsxs("p",{className:"font-semibold text-gray-200",children:[a.sender,":"]}),o.jsx("p",{children:a.content})]},l))})]}),o.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg border border-red-600 mb-6",children:[o.jsx("h2",{className:"text-2xl font-semibold text-gray-100 mb-4",children:"Fallen Heroes"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e==null?void 0:e.map((a,l)=>o.jsxs("div",{className:"bg-red-900/30 p-4 rounded border border-red-600",children:[o.jsx("h3",{className:"text-lg font-semibold text-red-200 mb-2",children:a.name}),o.jsxs("p",{className:"text-gray-300 mb-1",children:[o.jsx("strong",{children:"Class:"})," ",a.class]}),o.jsxs("p",{className:"text-gray-300 mb-1",children:[o.jsx("strong",{children:"Level:"})," ",a.level]}),o.jsxs("p",{className:"text-gray-300 mb-1",children:[o.jsx("strong",{children:"Final HP:"})," ",a.hp,"/",a.maxHp]}),o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"Cause of Death:"})," ",a.deathCause||"Combat wounds"]})]},l))})]}),t&&o.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg border border-red-600 mb-6",children:[o.jsx("h2",{className:"text-2xl font-semibold text-gray-100 mb-4",children:"Final Battle"}),o.jsxs("div",{className:"text-gray-300 space-y-2",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Duration:"})," ",t.duration," rounds"]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Result:"})," ",t.result]}),t.narrative&&o.jsx("p",{className:"italic",children:t.narrative})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-gray-300",children:"The adventure has ended, but new stories await..."}),o.jsx("button",{onClick:s,className:"fantasy-button bg-amber-600 hover:bg-amber-700 text-white px-8 py-3 text-lg",children:"Begin a New Adventure"})]})]})})})}function Z4(){var xt,lt,Ge,gt,Rt,ot;const{sessionId:n}=Mo(),e=hr(),t=ps(),[r,s]=I.useState(null),[i,a]=I.useState(null),[l,c]=I.useState(!0),[d,h]=I.useState([]),[m,p]=I.useState(null),[y,v]=I.useState(null),[S,E]=I.useState(""),[_,x]=I.useState(""),[C,k]=I.useState([]),[M,F]=I.useState([]),[w,b]=I.useState([]),[N,A]=I.useState(!1),[j,D]=I.useState(""),[P,Ve]=I.useState(""),[je,Fe]=I.useState(!1),[et,V]=I.useState(!1),[K,Y]=I.useState(null),[fe,ae]=I.useState(!1),[te,U]=I.useState([]),[me,Ae]=I.useState(null),[Qe,Fn]=I.useState(null),[$n,jt]=I.useState(!1),[tt,rn]=I.useState(-1),[We,qt]=I.useState(null),[Tn,_t]=I.useState(!1),[Un,gn]=I.useState(!1),[Jt,Sn]=I.useState(new Set),[In,Nn]=I.useState([]),[rt,ne]=I.useState(!1),re=I.useRef(null),ie=(xt=t.state)==null?void 0:xt.isTestCombat,we=t.state;I.useEffect(()=>{const R=xa(z=>{if(!z){e("/login");return}s(z)});return()=>R()},[e]),I.useEffect(()=>{ie&&we?He():n&&(async()=>(console.log(" Force refreshing combat data for session:",n),await it()))()},[ie,we,n]),I.useEffect(()=>{const R=async()=>{console.log(" Help button: Force refreshing combat session..."),await it()},z=async()=>{i!=null&&i.partyId&&(console.log(" Help button: Force cleaning up all combat sessions..."),await Kn.forceCleanupCombatSessions(i.partyId),setTimeout(async()=>{await it()},1e3))};return window.addEventListener("refreshCombatSession",R),window.addEventListener("cleanupCombatSessions",z),()=>{window.removeEventListener("refreshCombatSession",R),window.removeEventListener("cleanupCombatSessions",z)}},[i==null?void 0:i.partyId]),I.useEffect(()=>{if(n&&!ie){re.current&&(console.log(" Cleaning up existing subscription"),re.current(),re.current=null),console.log(" Setting up combat session subscription for:",n);const R=mI(n,z=>{var pe;console.log(" Combat session update received:",{currentTurn:z==null?void 0:z.currentTurn,lastProcessedTurn:tt,combatState:z==null?void 0:z.combatState,combatants:(pe=z==null?void 0:z.combatants)==null?void 0:pe.map(Ie=>({name:Ie.name,hp:Ie.hp,isEnemy:Ie.id.startsWith("enemy_")})),sessionId:n,isTestCombat:ie}),a(z),c(!1),(z==null?void 0:z.currentTurn)!==void 0&&(tt!==z.currentTurn&&!je?(console.log(" Updating lastProcessedTurn from",tt,"to",z.currentTurn),rn(z.currentTurn)):je&&tt===z.currentTurn&&(console.log(" Turn processing completed, updating lastProcessedTurn to",z.currentTurn),rn(z.currentTurn))),z&&(z.battleLog&&z.battleLog.length>0&&Nn(z.battleLog),Ye(z),F(z.environmentalFeatures||[]),b(z.teamUpOpportunities||[]),Ee())});return re.current=R,()=>{console.log(" Component unmounting, cleaning up subscription"),re.current&&(re.current(),re.current=null)}}},[n,ie]),I.useEffect(()=>{var R;if(console.log(" Co-op mode turn check:",{combatSession:i?{currentTurn:i.currentTurn,combatState:i.combatState,combatants:(R=i.combatants)==null?void 0:R.map(z=>({name:z.name,hp:z.hp,isEnemy:z.id.startsWith("enemy_")}))}:null,lastProcessedTurn:tt,processingTurn:je,isEnemyTurn:N,isTestCombat:ie}),i&&i.combatState==="active"){const z=H();if(console.log(" Current combatant check:",{currentCombatant:z?{name:z.name,id:z.id,isEnemy:z.id.startsWith("enemy_"),hp:z.hp}:null,currentTurn:i.currentTurn,lastProcessedTurn:tt,shouldProcess:z&&z.id.startsWith("enemy_")&&i.currentTurn!==tt&&!je&&!N}),z&&z.id.startsWith("enemy_")&&i.currentTurn!==tt&&!je&&!N){console.log(" Scheduling enemy turn processing for:",z.name);const Ie=setTimeout(()=>{Ce()},ie?2e3:1e3);return()=>clearTimeout(Ie)}z&&z.id.startsWith("enemy_")&&i.currentTurn===tt&&!je&&!N&&(console.log(" Safety check: Enemy turn appears stuck, forcing turn advance"),setTimeout(()=>{at()},3e3))}},[i==null?void 0:i.currentTurn,tt,je,N,ie,i==null?void 0:i.combatants]),I.useEffect(()=>{i&&Un&&ce()&&setTimeout(()=>{gn(!1),Sn(new Set),at()},1e3)},[Un,Jt.size,(lt=i==null?void 0:i.partyMembers)==null?void 0:lt.length]),I.useEffect(()=>{i&&Ye(i)},[i==null?void 0:i.currentTurn,i==null?void 0:i.combatState]),I.useEffect(()=>{if(i&&i.combatState==="active"&&i.combatants){const R=i.combatants.filter(J=>!J.id.startsWith("enemy_")),z=i.combatants.filter(J=>J.id.startsWith("enemy_")),pe=R.some(J=>J.hp>0),Ie=z.some(J=>J.hp>0);pe?Ie||(ie?e("/test-environment",{state:{...we,combatResult:"victory"}}):Zt("victory")):ie?e("/test-environment",{state:{...we,combatResult:"defeat"}}):Xt()}},[i==null?void 0:i.combatants,i==null?void 0:i.combatState]);const He=async()=>{try{c(!0);const z={id:"test_combat_session",partyMembers:we.partyMembers.map(J=>{if(!J.hp||!J.maxHp||!J.ac){const{class:Se,level:_e,constitution:dt,dexterity:Oe}=J,un={Barbarian:12,Fighter:10,Paladin:10,Ranger:10,Cleric:8,Druid:8,Monk:8,Rogue:8,Bard:8,Sorcerer:6,Warlock:8,Wizard:6}[Se]||8,Ts=Math.floor((dt-10)/2),ba=Math.max(1,(un+Ts)*_e),Gc=10,Kc=Math.floor((Oe-10)/2),wa={Barbarian:3,Monk:2,Fighter:4,Paladin:4,Cleric:4,Ranger:3,Rogue:2,Bard:2,Druid:2,Sorcerer:0,Warlock:0,Wizard:0}[Se]||0,Qc=Math.max(10,Gc+Kc+wa);return{...J,hp:ba,maxHp:ba,ac:Qc}}return J})||[],enemies:we.enemies||[],storyContext:we.storyContext||"Test combat environment",combatState:"initialized",currentTurn:0,combatants:[],round:1};if(!z.enemies||z.enemies.length===0){a({...z,status:"no_enemies",combatState:"ended"}),c(!1);return}const pe=Kn.initializeCombat(z.partyMembers,z.enemies,z.storyContext),Ie={...z,...pe,currentTurn:0,combatState:"active"};a(Ie),c(!1),Ye(Ie),F(Ie.environmentalFeatures||[]),b(Ie.teamUpOpportunities||[])}catch(R){console.error("Error initializing test combat:",R),c(!1)}},it=async()=>{if(n)try{c(!0);const R=Date.now();console.log(` Loading combat data with cache buster: ${R}`);const[z,pe]=await Promise.all([hI(n),Nt(n)]);if(Fn(pe),!z){console.error("No combat session found with ID:",n),e("/dashboard");return}const Ie=z.partyId,J=await hs(Ie);try{await xI(Ie);const _e=await hs(Ie);h(_e)}catch(_e){console.warn("Failed to update character stats:",_e),h(J)}if(z.enemies&&z.enemies.length===0&&!ie){a({...z,status:"no_enemies"});return}let Se=z.combatants||[];if(Se.length===0){const _e=(z.partyMembers||[]).map(Oe=>({...Oe,isEnemy:!1,userId:Oe.userId,cooldowns:Oe.cooldowns||{},statusEffects:Oe.statusEffects||[],hp:Oe.hp??Oe.maxHp??10,maxHp:Oe.maxHp??Oe.hp??10})),dt=(z.enemies||[]).map(Oe=>({...Oe,isEnemy:!0,userId:null,cooldowns:Oe.cooldowns||{},statusEffects:Oe.statusEffects||[],hp:Oe.hp??Oe.maxHp??10,maxHp:Oe.maxHp??Oe.hp??10}));Se=[..._e,...dt]}if(z.combatState==="initialized"){const _e={...z,combatants:Se,combatState:"active",currentTurn:0,round:1};await Di(n,_e),a(_e),Ye(_e),F(_e.environmentalFeatures||[]),b(_e.teamUpOpportunities||[])}else{const _e={...z,combatants:Se};a(_e),Ye(_e),F(_e.environmentalFeatures||[]),b(_e.teamUpOpportunities||[])}}catch(R){console.error("Error loading combat data:",R)}finally{c(!1)}},Ye=R=>{var Se;const z=H(R);if(!z)return;const pe=[],Ie=z.cooldowns||{};Object.entries(Kn.actionTypes).forEach(([_e,dt])=>{(Ie[_e]===0||Ie[_e]===void 0)&&pe.push({type:_e,name:dt.name,description:dt.description,priority:dt.priority,narrativeTemplate:dt.narrativeTemplate})});const J=Kn.classAbilities[(Se=z.class)==null?void 0:Se.toLowerCase()];J&&(Ie.special===0||Ie.special===void 0)&&pe.push({type:"special",name:J.name,description:J.description,priority:"high",narrativeTemplate:"{character} uses their {ability}!"}),M.length>0&&pe.push({type:"environmental",name:"Use Environment",description:"Use the environment to your advantage",priority:"normal",narrativeTemplate:"{character} uses the {environment} to their advantage!"}),w.length>0&&pe.push({type:"teamUp",name:"Team Up",description:"Coordinate with another party member",priority:"high",narrativeTemplate:"{character} coordinates with {ally} for a powerful combination!"}),k(pe)},pt=async R=>{const z=new Date().toLocaleTimeString(),pe={id:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:z,round:(i==null?void 0:i.round)||1,turn:(i==null?void 0:i.currentTurn)||0,...R};if(Nn(Ie=>[...Ie,pe]),!ie&&n)try{await yI(n,pe)}catch(Ie){console.error("Failed to save battle log to database:",Ie)}},$=async()=>{if(i)try{Fe(!0),Nn([]);const R={...i,combatState:"ready",currentTurn:0,round:1};ie?(a(R),Ye(R)):await Di(n,R),await pt({type:"combat_start",description:"Combat is ready to begin!"})}catch(R){console.error("Error starting combat:",R)}finally{Fe(!1)}},Q=async()=>{if(i)try{Fe(!0);const R={...i,combatState:"active"};ie?(a(R),Ye(R)):await Di(n,R),await pt({type:"combat_begin",description:"Fight!"}),ne(!0)}catch(R){console.error("Error beginning combat:",R)}finally{Fe(!1)}},ye=async(R,z,pe={})=>{var Ie;if(console.log(" executeAction called:",{actionType:R,targetId:z,isCurrentUserTurn:ee(),currentTurn:i==null?void 0:i.currentTurn,currentCombatant:(Ie=H())==null?void 0:Ie.name}),!(!i||!ee()))try{Fe(!0);const J=H(),Se=i.combatants.find(Wt=>Wt.id===z),_e=await Kn.executeAction(i,J.id,R,z,pe),dt={...i,currentTurn:_e.updatedSession.currentTurn,round:_e.updatedSession.round,combatants:_e.updatedSession.combatants};if(console.log(" Action executed, updating session:",{oldTurn:i.currentTurn,newTurn:_e.updatedSession.currentTurn,isTestCombat:ie,sessionId:n}),ie)a(dt);else{const Wt={currentTurn:_e.updatedSession.currentTurn,round:_e.updatedSession.round,combatants:_e.updatedSession.combatants};console.log(" Sending database update:",Wt),await Di(n,Wt),console.log(" Database update completed")}await pt({type:_e.success?"action":"action_failed",description:_e.narrative}),_e.damage>0&&Se&&await pt({type:"damage",description:`${Se.name} takes ${_e.damage} damage!`}),_e.healing>0&&Se&&await pt({type:"healing",description:`${Se.name} is healed for ${_e.healing} HP!`}),E(_e.narrative),_e.description&&x(_e.description);const Oe=Kn.checkCombatEnd(dt);if(Oe.ended){ie?e("/test-environment",{state:{...we,combatResult:Oe.result}}):await Zt(Oe.result);return}J.id.startsWith("enemy_")&&(gn(!0),D(_e.narrative),Ve(_e.description)),_e.damage>0&&Se&&(qt({targetId:Se.id,damage:_e.damage,type:"damage"}),_t(!0),setTimeout(()=>_t(!1),2e3)),_e.healing>0&&Se&&(qt({targetId:Se.id,healing:_e.healing,type:"healing"}),_t(!0),setTimeout(()=>_t(!1),2e3)),p(null),v(null)}catch(J){console.error("Error executing action:",J),pt({type:"error",description:"An error occurred while executing the action."})}finally{Fe(!1)}},Ce=async()=>{if(console.log(" processEnemyTurn called"),!i||i.combatState!=="active"){console.log(" Combat not active, returning");return}const R=H();if(console.log(" Current combatant:",R),!R||!R.id.startsWith("enemy_")){console.log(" Not enemy turn, returning");return}console.log(" Processing enemy turn for:",R.name);try{Fe(!0),A(!0),pt({type:"turn_start",actor:R.name,description:`${R.name}'s turn begins`}),console.log(" Choosing enemy action for:",R.name);const z=Kn.chooseEnemyAction(R,i);if(console.log(" Selected action:",z),!z){console.log(" No action selected, advancing turn"),setTimeout(()=>{at()},1e3);return}const pe=z.action,Ie=z.target;if(!pe){setTimeout(()=>{at()},1e3);return}const J=i.combatants.find(_e=>_e.id===Ie);if(!J&&pe!=="defend"){setTimeout(()=>{at()},1e3);return}pt({type:"action",actor:R.name,action:pe,target:(J==null?void 0:J.name)||"self",description:`${R.name} uses ${pe}${J?` on ${J.name}`:""}`}),console.log(" Executing enemy action:",{combatant:R.name,action:pe,target:Ie,additionalData:z});const Se=await Kn.executeAction(i,R.id,pe,Ie,z);if(console.log(" Action result:",Se),Se.success){const _e={...i,currentTurn:Se.updatedSession.currentTurn,round:Se.updatedSession.round,combatants:Se.updatedSession.combatants};if(ie)a(_e);else{const Wt={currentTurn:Se.updatedSession.currentTurn,round:Se.updatedSession.round,combatants:Se.updatedSession.combatants};await Di(n,Wt)}Se.damage&&pt({type:"damage",actor:R.name,target:(J==null?void 0:J.name)||"self",damage:Se.damage,description:`${R.name} deals ${Se.damage} damage to ${(J==null?void 0:J.name)||"self"}`}),Se.healing&&pt({type:"healing",actor:R.name,target:(J==null?void 0:J.name)||"self",healing:Se.healing,description:`${R.name} heals ${(J==null?void 0:J.name)||"self"} for ${Se.healing} HP`}),Se.statusEffects&&Se.statusEffects.length>0&&Se.statusEffects.forEach(Wt=>{pt({type:"status_effect",actor:R.name,target:(J==null?void 0:J.name)||"self",effect:Wt.type,description:`${(J==null?void 0:J.name)||"self"} is affected by ${Wt.type}`})}),Se.targetDied&&pt({type:"death",actor:R.name,target:(J==null?void 0:J.name)||"self",description:`${(J==null?void 0:J.name)||"self"} has been defeated!`}),Se.damage&&J&&(qt({targetId:J.id,damage:Se.damage,type:"damage"}),_t(!0),setTimeout(()=>_t(!1),2e3)),Se.healing&&J&&(qt({targetId:J.id,damage:Se.healing,type:"healing"}),_t(!0),setTimeout(()=>_t(!1),2e3));const dt=Kn.generateActionNarrative(R,pe,J,z);if(D(`${R.name} uses ${pe}!`),Ve(dt),Se.combatEnded){console.log("Combat ended"),ie?e("/test-environment",{state:{...we,combatResult:Se.combatResult}}):await Zt(Se.combatResult);return}if(_e.combatants.filter(Wt=>!Wt.id.startsWith("enemy_")&&Wt.hp>0).length===0){console.log("All players dead, ending combat"),ie?e("/test-environment",{state:{...we,combatResult:"defeat"}}):await Zt("defeat");return}rn(i.currentTurn)}else console.error("Enemy action execution failed:",Se.error),pt({type:"action_failed",actor:R.name,action:pe,description:`${R.name}'s ${pe} failed`}),setTimeout(()=>{at()},1e3)}catch(z){console.error("Error processing enemy turn:",z),pt({type:"error",actor:R.name,description:`Error during ${R.name}'s turn`}),setTimeout(()=>{at()},1e3)}finally{Fe(!1),A(!1)}},at=async()=>{if(!i||i.combatState!=="active")return;const R=i.combatants.filter(un=>!un.id.startsWith("enemy_")),z=i.combatants.filter(un=>un.id.startsWith("enemy_")),pe=R.some(un=>un.hp>0),Ie=z.some(un=>un.hp>0);if(!pe){ie?e("/test-environment",{state:{...we,combatResult:"defeat"}}):await Zt("defeat");return}if(!Ie){ie?e("/test-environment",{state:{...we,combatResult:"victory"}}):await Zt("victory");return}let J=(i.currentTurn+1)%i.combatants.length,Se=0;const _e=i.combatants.length;for(;Se<_e;){const un=i.combatants[J];if(un&&un.hp>0)break;J=(J+1)%i.combatants.length,Se++}if(Se>=_e){ie?e("/test-environment",{state:{...we,combatResult:"draw"}}):await Zt("draw");return}const dt={currentTurn:J};J===0&&(dt.round=i.round+1),console.log(" Advancing turn:",{currentTurn:i.currentTurn,nextTurn:J,updates:dt,isTestCombat:ie,sessionId:n}),ie?a(un=>({...un,...dt})):(console.log(" Sending advanceTurn database update:",dt),await Di(n,dt),console.log(" AdvanceTurn database update completed")),rn(J);const Oe=i.combatants[J];Oe&&await pt({type:"turn_advance",description:` ${Oe.name}'s turn begins`});const Wt={...i,...dt};Ye(Wt)},Xt=async()=>{if(!i||!Qe)return;const R=Kn.generateCombatSummary(i,"defeat"),z=i.partyMembers.filter(pe=>pe.hp<=0);Ae(R),U(z),ae(!0),await pp(n,{status:"ended",combatState:"ended",summary:R}),await st(n,{status:"defeated",currentCombat:null})},Zt=async(R="victory")=>{if(!i)return;const z=Kn.generateCombatSummary(i,R);if(ie)a(pe=>({...pe,status:"ended",combatState:"ended",summary:z})),e("/test-environment");else{await pp(n,{status:"ended",combatState:"ended",summary:z});const pe=i.partyMembers.filter(Ie=>Ie.hp<=0);if(pe.length>0){await st(n,{status:"storytelling",currentCombat:null,deadPlayers:pe.map(J=>({userId:J.userId,name:J.name,class:J.class,level:J.level,deathCause:"Combat wounds"}))});const Ie=pe.find(J=>J.userId===(r==null?void 0:r.uid));e(Ie?`/character-creation/${i.partyId}`:`/campaign/${n}`)}else await st(n,{status:"storytelling",currentCombat:null}),e(`/campaign/${n}`)}},H=(R=i)=>{if(!R)return null;const z=R.combatants||[],pe=R.currentTurn||0;return z.length===0||pe>=z.length?null:z[pe]},ee=()=>{const R=H();if(!R)return console.log(" No current combatant found"),!1;if(ie){const pe=!R.isEnemy;return console.log(" Test mode turn check:",{currentCombatant:R.name,isEnemy:R.isEnemy,isCurrentUserTurn:pe}),pe}const z=R.userId===(r==null?void 0:r.uid);return console.log(" Co-op mode turn check:",{currentCombatant:R.name,currentCombatantUserId:R.userId,currentUserId:r==null?void 0:r.uid,isCurrentUserTurn:z}),z},Ee=()=>{if(i){if(ie){const R=i.combatants.find(z=>!z.isEnemy);R&&R.hp<=0&&(V(!0),Y(R))}else if(r){const R=i.partyMembers.find(z=>z.userId===r.uid)||i.combatants.find(z=>z.userId===r.uid&&!z.isEnemy);R&&R.hp<=0&&(V(!0),Y(R))}}},B=()=>{ie&&e("/dashboard")},G=()=>{jt(!0),V(!1)},de=()=>{if(ie)gn(!1),Sn(new Set),at();else{const R=r==null?void 0:r.uid;R&&Sn(z=>new Set([...z,R]))}},ce=()=>{if(ie)return!0;if(!(i!=null&&i.partyMembers))return!1;const R=i.partyMembers.filter(pe=>pe.hp>0);return Jt.size>=R.length},xe=Array.isArray(i==null?void 0:i.combatants)?i.combatants:Array.isArray(i==null?void 0:i.partyMembers)&&Array.isArray(i==null?void 0:i.enemies)?[...i.partyMembers.map(R=>({...R,isEnemy:!1,userId:R.userId,cooldowns:R.cooldowns||{},statusEffects:R.statusEffects||[],hp:R.hp??R.maxHp??1,maxHp:R.maxHp??R.hp??1})),...i.enemies.map(R=>({...R,isEnemy:!0,userId:null,cooldowns:R.cooldowns||{},statusEffects:R.statusEffects||[],hp:R.hp??R.maxHp??1,maxHp:R.maxHp??R.hp??1}))]:[],Re=R=>{if(!R||!xe.length)return[];const z=xe.filter(J=>J.hp>0),pe=H();if(!pe)return[];const Ie=!pe.id.startsWith("enemy_");switch(R){case"attack":case"spell":case"special":return Ie?z.filter(J=>J.id.startsWith("enemy_")):z.filter(J=>!J.id.startsWith("enemy_"));case"heal":case"item":return Ie?z.filter(J=>!J.id.startsWith("enemy_")&&J.id!==pe.id):z.filter(J=>J.id.startsWith("enemy_")&&J.id!==pe.id);case"defend":case"environmental":return[pe];case"teamUp":return Ie?z.filter(J=>!J.id.startsWith("enemy_")&&J.id!==pe.id):z.filter(J=>J.id.startsWith("enemy_")&&J.id!==pe.id);default:return z}},en=Array.isArray(i==null?void 0:i.enemies)?i.enemies:[];if(!r)return null;if(l)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"Loading Combat..."}),o.jsx("p",{className:"text-gray-300 mb-6",children:"Preparing the battlefield and gathering combatants..."}),o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto"})]})})});if(!i)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsx("div",{className:"text-center py-8",children:o.jsx("div",{className:"text-gray-400",children:"No active combat session found."})})})});if((i.status==="no_enemies"||en.length===0)&&!ie)return o.jsx("div",{className:"fantasy-container py-8",children:o.jsx("div",{className:"fantasy-card",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-4",children:"No Enemies to Fight"}),o.jsx("p",{className:"text-gray-300 mb-6",children:"There are no enemies present in this area. Combat cannot begin."}),o.jsx("p",{className:"text-gray-400 text-sm",children:"The combat session will end automatically."})]})})});const De=H();return fe?o.jsx(X4,{story:Qe,deadCharacters:te,combatSummary:me}):et&&K&&!$n?o.jsx(J4,{deadPlayer:K,combatSession:i,onSpectate:G}):o.jsx("div",{className:"min-h-screen bg-gray-900 text-gray-100 p-4",children:o.jsxs("div",{className:"fantasy-container py-4",children:[o.jsxs("div",{className:"mb-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h1",{className:"fantasy-title mb-0",children:" Combat Arena"}),De&&o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"text-2xl font-bold text-amber-400",children:[" ",De.name,"'s Turn"]}),o.jsxs("div",{className:"text-sm text-gray-400",children:["Round ",(i==null?void 0:i.round)||1,"  Turn ",((i==null?void 0:i.currentTurn)||0)+1]})]})]}),i.storyContext&&o.jsxs("div",{className:"fantasy-card mb-4 bg-gray-800/50 border-gray-600",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-2",children:" Story Context"}),o.jsx("p",{className:"text-gray-300 italic",children:i.storyContext})]})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[o.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[xe.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3 text-sm",children:" Turn Order"}),o.jsx("div",{className:"space-y-1",children:xe.map((R,z)=>{var pe,Ie;return o.jsx("div",{className:`p-2 rounded border transition-colors text-xs ${R.id===((pe=xe[i.currentTurn])==null?void 0:pe.id)?"border-amber-500 bg-amber-900/20":R.hp<=0?"border-red-600 bg-red-900/20 opacity-50":"border-gray-600 bg-gray-700"}`,children:o.jsx("div",{className:"flex justify-between items-center",children:o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"font-medium text-gray-100 truncate",children:[R.name,R.id===((Ie=xe[i.currentTurn])==null?void 0:Ie.id)&&o.jsx("span",{className:"ml-1 text-amber-400",children:""})]}),o.jsxs("div",{className:"text-gray-400",children:[R.hp,"/",R.maxHp," HP"]})]})})},R.id)})})]}),o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"text-sm font-semibold mb-2 text-yellow-400",children:" Battle Log"}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{onClick:()=>{const R=document.getElementById("battle-log-container");R&&(R.scrollTop-=50)},className:"absolute top-0 right-0 z-10 bg-gray-700 hover:bg-gray-600 text-gray-300 text-xs px-2 py-1 rounded-t transition-colors",children:""}),o.jsx("div",{id:"battle-log-container",className:"h-32 overflow-y-auto space-y-1 text-xs pr-8 scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:In.length===0?o.jsx("p",{className:"text-gray-400",children:"No actions recorded yet..."}):In.slice(-8).map(R=>o.jsxs("div",{className:"border-l-2 border-gray-600 pl-2 py-1",children:[o.jsx("div",{className:"flex justify-between items-start mb-1",children:o.jsxs("span",{className:"text-blue-400",children:["R",R.round]})}),o.jsx("div",{className:`${R.type==="damage"?"text-red-400":R.type==="healing"?"text-green-400":R.type==="death"?"text-red-500 font-semibold":R.type==="status_effect"?"text-purple-400":R.type==="action_failed"?"text-orange-400":R.type==="error"?"text-red-500":"text-gray-200"}`,children:R.description})]},R.id))}),o.jsx("button",{onClick:()=>{const R=document.getElementById("battle-log-container");R&&(R.scrollTop+=50)},className:"absolute bottom-0 right-0 z-10 bg-gray-700 hover:bg-gray-600 text-gray-300 text-xs px-2 py-1 rounded-b transition-colors",children:""})]})]})]}),o.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[(()=>De&&xe.length>0)()&&o.jsxs("div",{className:"fantasy-card bg-gray-800/50 border-gray-600",children:[o.jsxs("div",{className:"text-center mb-4",children:[o.jsxs("h2",{className:"text-xl font-bold text-amber-400 mb-1",children:[" ",De.name,"'s Turn"]}),o.jsx("p",{className:"text-gray-300 text-sm",children:ee()?"Select your action below":"Waiting for this player to act"})]}),ee()?o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-bold text-gray-100 mb-3 text-center",children:" Available Actions"}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:C.map((R,z)=>o.jsxs("button",{onClick:()=>p(R),className:`p-3 rounded-lg border-2 transition-all duration-200 text-left hover:scale-105 ${(m==null?void 0:m.type)===R.type?"border-amber-500 bg-amber-900/30 shadow-lg shadow-amber-500/20":"border-gray-600 bg-gray-700 hover:border-gray-500 hover:bg-gray-600"}`,children:[o.jsx("div",{className:"font-bold text-sm text-gray-100 mb-1",children:R.name}),o.jsx("div",{className:"text-xs text-gray-300 mb-1",children:R.description}),o.jsx("div",{className:"text-xs text-gray-400 bg-gray-800 px-1 py-0.5 rounded inline-block",children:R.priority})]},z))})]}),m&&o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-bold text-gray-100 mb-3 text-center",children:" Select Target"}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:Re(m.type).map(R=>o.jsxs("button",{onClick:()=>v(R),className:`p-3 rounded-lg border-2 transition-all duration-200 hover:scale-105 ${(y==null?void 0:y.id)===R.id?"border-red-500 bg-red-900/30 shadow-lg shadow-red-500/20":"border-gray-600 bg-gray-700 hover:border-gray-500 hover:bg-gray-600"}`,children:[o.jsx("div",{className:"font-bold text-sm text-gray-100 mb-1",children:R.name}),o.jsxs("div",{className:"text-xs text-gray-300 mb-1",children:["HP: ",R.hp,"/",R.maxHp," | AC: ",R.ac]}),o.jsx("div",{className:`text-xs px-1 py-0.5 rounded inline-block ${R.id.startsWith("enemy_")?"bg-red-900 text-red-200":"bg-blue-900 text-blue-200"}`,children:R.id.startsWith("enemy_")?" Enemy":" Ally"})]},R.id))}),Re(m.type).length===0&&o.jsx("div",{className:"text-center p-4 bg-gray-700 border border-gray-600 rounded-lg",children:o.jsx("p",{className:"text-gray-300",children:"No valid targets for this action."})})]}),m&&y&&o.jsx("div",{className:"text-center pt-6",children:o.jsx("button",{onClick:()=>ye(m.type,y.id),disabled:je,className:"fantasy-button bg-amber-600 hover:bg-amber-700 text-xl font-bold px-8 py-4 shadow-lg hover:scale-105 transition-all duration-200",children:je?" Executing...":` Execute ${m.name}`})})]}):o.jsxs("div",{className:"bg-blue-900/20 border border-blue-700 rounded-lg p-8 text-center",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsxs("h3",{className:"text-2xl font-bold text-blue-300 mb-4",children:["Waiting for ",De.name," to act"]}),o.jsx("p",{className:"text-blue-200 text-lg",children:De.userId===(r==null?void 0:r.uid)?"It's your turn! Please select an action above.":"Please wait for the current player to make their move."})]})]}),(!xe.length||!en.length)&&o.jsxs("div",{className:"fantasy-card bg-gray-800 border-gray-600",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3",children:"Combat Status"}),o.jsxs("div",{className:"text-gray-300 space-y-2",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Combat State:"})," ",i.combatState]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Combatants:"})," ",xe.length]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Enemies:"})," ",en.length]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Current Turn:"})," ",i.currentTurn]}),i.combatState==="preparation"&&o.jsx("button",{onClick:$,className:"fantasy-button bg-yellow-600 hover:bg-yellow-700 mt-4",children:"Start Combat"})]})]}),S&&o.jsxs("div",{className:"fantasy-card bg-green-900/20 border-green-700",children:[o.jsx("h4",{className:"font-bold text-green-300 mb-2",children:"Action Result"}),o.jsx("p",{className:"text-green-200",children:S}),_&&o.jsx("div",{className:"mt-2 p-3 bg-gray-700 border border-green-600 rounded",children:o.jsx("p",{className:"text-gray-200 italic",children:_})})]}),N&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700 animate-pulse",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-red-300 mb-3 text-xl",children:" Enemy Turn"}),j&&o.jsx("div",{className:"text-red-200 font-bold text-lg mb-3 bg-gray-700 p-3 rounded border border-red-600",children:j}),P&&o.jsx("div",{className:"mt-3 p-4 bg-gray-700 border border-red-600 rounded",children:o.jsx("p",{className:"text-gray-200 italic",children:P})}),o.jsxs("div",{className:"mt-4 flex items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"}),o.jsx("span",{className:"ml-3 text-red-300 font-medium",children:"Enemy is acting..."})]})]})}),Un&&o.jsx("div",{className:"fantasy-card bg-blue-900/20 border-blue-700",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-blue-300 mb-3 text-xl",children:" Enemy Turn Complete"}),o.jsx("p",{className:"text-blue-200 mb-4",children:ie?"The enemy has finished their turn. Click 'Confirm' to proceed to the next turn.":"The enemy has finished their turn. All party members must click 'Confirm' to proceed."}),!ie&&o.jsxs("div",{className:"mb-4 p-3 bg-gray-700 border border-blue-600 rounded",children:[o.jsxs("p",{className:"text-sm text-blue-200",children:[o.jsx("strong",{children:"Ready to continue:"})," ",Jt.size," / ",((Ge=i==null?void 0:i.partyMembers)==null?void 0:Ge.filter(R=>R.hp>0).length)||0," party members"]}),Jt.size>0&&o.jsxs("div",{className:"mt-2 text-xs text-blue-300",children:["Waiting for: ",((ot=(Rt=(gt=i==null?void 0:i.partyMembers)==null?void 0:gt.filter(R=>R.hp>0&&!Jt.has(R.userId)))==null?void 0:Rt.map(R=>R.name))==null?void 0:ot.join(", "))||"None"]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center items-center",children:[o.jsx("button",{onClick:de,disabled:!ie&&Jt.has(r==null?void 0:r.uid),className:`fantasy-button px-8 py-3 text-lg font-semibold ${!ie&&Jt.has(r==null?void 0:r.uid)?"bg-green-700 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 shadow-lg"}`,children:!ie&&Jt.has(r==null?void 0:r.uid)?" Ready":"Confirm"}),ie&&o.jsx("button",{onClick:()=>{gn(!1),Sn(new Set),at()},className:"fantasy-button px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white",children:"Skip Confirmation"})]}),o.jsx("div",{className:"mt-4 p-3 bg-yellow-900/20 border border-yellow-600 rounded",children:o.jsxs("p",{className:"text-sm text-yellow-200",children:[o.jsx("strong",{children:"Note:"})," Review the battle log and enemy actions before continuing to the next turn."]})})]})}),je&&!N&&o.jsx("div",{className:"fantasy-card bg-amber-900/20 border-amber-700",children:o.jsxs("div",{className:"flex items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-amber-500"}),o.jsx("span",{className:"ml-2 text-amber-300 font-medium",children:"Processing turn..."})]})}),(i==null?void 0:i.combatState)==="ready"&&!rt&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"font-bold text-red-300 mb-4 text-2xl",children:" Combat Ready!"}),o.jsx("p",{className:"text-red-200 mb-6 text-lg",children:"All combatants are in position. Click 'Fight!' to begin the battle."}),o.jsx("button",{onClick:Q,disabled:je,className:"fantasy-button px-12 py-4 text-xl font-bold bg-red-600 hover:bg-red-700 shadow-lg",children:je?"Preparing...":"Fight!"})]})})]}),o.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-gray-100 mb-3 text-sm",children:" Combat Status"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-blue-300 mb-2 text-xs",children:" Party"}),o.jsx("div",{className:"space-y-1",children:xe.filter(R=>!R.id.startsWith("enemy_")).map(R=>o.jsx("div",{className:`p-2 rounded border text-xs ${R.hp<=0?"bg-red-900/20 border-red-600":R.hp<R.maxHp*.5?"bg-yellow-900/20 border-yellow-600":"bg-blue-900/20 border-blue-600"} ${(De==null?void 0:De.id)===R.id?"ring-1 ring-amber-400":""}`,children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("span",{className:"font-medium text-gray-100 truncate",children:[R.name,(De==null?void 0:De.id)===R.id&&o.jsx("span",{className:"ml-1 text-amber-400",children:""})]}),o.jsxs("span",{className:`text-xs ${R.hp<=0?"text-red-400":R.hp<R.maxHp*.5?"text-yellow-400":"text-green-400"}`,children:[R.hp,"/",R.maxHp]})]})},R.id))})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-red-300 mb-2 text-xs",children:" Enemies"}),o.jsx("div",{className:"space-y-1",children:xe.filter(R=>R.id.startsWith("enemy_")).map(R=>o.jsx("div",{className:`p-2 rounded border text-xs ${R.hp<=0?"bg-red-900/20 border-red-600":R.hp<R.maxHp*.5?"bg-yellow-900/20 border-yellow-600":"bg-red-900/20 border-red-600"} ${(De==null?void 0:De.id)===R.id?"ring-1 ring-amber-400":""}`,children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("span",{className:"font-medium text-gray-100 truncate",children:[R.name,(De==null?void 0:De.id)===R.id&&o.jsx("span",{className:"ml-1 text-amber-400",children:""})]}),o.jsxs("span",{className:`text-xs ${R.hp<=0?"text-red-400":R.hp<R.maxHp*.5?"text-yellow-400":"text-red-400"}`,children:[R.hp,"/",R.maxHp]})]})},R.id))})]})]})]}),M.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-blue-300 mb-2 text-sm",children:" Environment"}),o.jsx("div",{className:"flex flex-wrap gap-1",children:M.map((R,z)=>o.jsx("span",{className:"px-2 py-1 bg-blue-900 text-blue-200 rounded text-xs",children:R},z))})]}),w.length>0&&o.jsxs("div",{className:"fantasy-card",children:[o.jsx("h3",{className:"font-bold text-purple-300 mb-2 text-sm",children:" Team Up"}),o.jsx("div",{className:"space-y-1",children:w.map((R,z)=>o.jsxs("div",{className:"text-purple-200 text-xs",children:[o.jsxs("strong",{children:[R.classes.join("+"),":"]})," ",R.description]},z))})]}),Tn&&We&&o.jsx("div",{className:"fixed inset-0 pointer-events-none z-50 flex items-center justify-center",children:o.jsxs("div",{className:`text-6xl font-bold animate-bounce px-6 py-4 rounded-lg shadow-lg ${We.type==="damage"?"text-red-400 bg-red-900/80":"text-green-400 bg-green-900/80"}`,children:[We.type==="damage"?"-":"+",We.damage]})}),et&&K&&o.jsx("div",{className:"fantasy-card bg-red-900/20 border-red-700",children:o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h1",{className:"text-3xl font-bold text-red-300 mb-4",children:"Character Death"}),o.jsxs("div",{className:"text-xl text-red-200 mb-6",children:[K.name," has fallen in battle..."]}),o.jsxs("div",{className:"bg-gray-700 p-6 rounded-lg border border-red-600 mb-6",children:[o.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-2",children:"Fallen Hero"}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Name:"})," ",K.name]}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Class:"})," ",K.class]}),o.jsxs("p",{className:"text-gray-300 mb-2",children:[o.jsx("strong",{children:"Level:"})," ",K.level]}),o.jsxs("p",{className:"text-gray-300",children:[o.jsx("strong",{children:"Final HP:"})," ",K.hp,"/",K.maxHp]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-gray-300",children:"Your character has been defeated. You must create a new character to continue."}),o.jsx("button",{onClick:B,className:"fantasy-button bg-red-600 hover:bg-red-700",children:"Create New Character"})]})]})})]})]})]})})}function eV(){const n=ps(),e=n.pathname.split("/campaign-story/")[1];return console.log("Old route detected:",n.pathname),console.log("PartyId extracted:",e),console.log("Redirecting to:",`/campaign/${e}`),o.jsx(M_,{to:`/campaign/${e}`,replace:!0})}function tV(){return o.jsx(mA,{basename:"/DND-V1",future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:o.jsxs("div",{className:"min-h-screen flex flex-col",children:[o.jsx(E4,{}),o.jsx("main",{className:"flex-grow",children:o.jsxs(aA,{children:[o.jsx(sr,{path:"/",element:o.jsx(A4,{})}),o.jsx(sr,{path:"/login",element:o.jsx(k4,{})}),o.jsx(sr,{path:"/register",element:o.jsx(P4,{})}),o.jsx(sr,{path:"/dashboard",element:o.jsx(j4,{})}),o.jsx(sr,{path:"/character-creation/:partyId",element:o.jsx(R4,{})}),o.jsx(sr,{path:"/lobby/:partyId",element:o.jsx(M4,{})}),o.jsx(sr,{path:"/campaign/:partyId",element:o.jsx(B4,{})}),o.jsx(sr,{path:"/manual-campaign/:partyId",element:o.jsx(q4,{})}),o.jsx(sr,{path:"/manual-campaign-dm/:partyId",element:o.jsx(Y4,{})}),o.jsx(sr,{path:"/combat/:sessionId",element:o.jsx(Z4,{})}),o.jsx(sr,{path:"/campaign-story/:partyId",element:o.jsx(eV,{})}),o.jsx(sr,{path:"*",element:o.jsx(M_,{to:"/dashboard",replace:!0})})]})}),o.jsx(N4,{})]})})}Bm.createRoot(document.getElementById("root")).render(o.jsx(Eb.StrictMode,{children:o.jsx(tV,{})}));export{ft as $,YS as A,ca as B,Br as C,Yt as D,cL as E,fa as F,h0 as G,lL as H,aV as I,xr as J,xM as K,wM as L,Es as M,DV as N,MV as O,zM as P,En as Q,TV as R,dV as S,Vt as T,ZV as U,Lh as V,UM as W,XV as X,RV as Y,pV as Z,$E as _,vc as a,cV as a0,bM as a1,kM as a2,oL as a3,id as a4,JV as a5,vV as a6,aL as a7,Ze as a8,_V as a9,wV as aA,ua as aB,BV as aC,EV as aD,SV as aE,GV as aF,KV as aG,FM as aH,ln as aI,VS as aJ,uV as aK,YV as aL,Le as aM,UV as aN,rL as aO,nV as aP,VV as aQ,AV as aR,CV as aS,jV as aT,xV as aU,Ft as aV,tL as aW,gV as aX,zt as aY,nL as aZ,mV as aa,fV as ab,yV as ac,iL as ad,PV as ae,kV as af,Ot as ag,Hc as ah,jM as ai,zV as aj,On as ak,LV as al,OV as am,Wn as an,FV as ao,$V as ap,_M as aq,sL as ar,eL as as,hV as at,IV as au,NV as av,bV as aw,qV as ax,HV as ay,WV as az,EM as b,Co as c,pa as d,vt as e,Z as f,Go as g,qc as h,sd as i,qh as j,Wc as k,Bh as l,w0 as m,Ao as n,zh as o,Bi as p,BM as q,Bt as r,ta as s,ue as t,sV as u,hR as v,kt as w,uL as x,$e as y,rV as z};
